import{a as q2,b as H2,c as Z2,d as va,e as xa}from"./chunk-ZTMNDVP7.js";import{$ as Ms,A as Xa,B as qn,C as vb,D as xg,E as vd,F as Lh,G as rk,H as Ss,I as wg,J as ok,K as wp,L as ak,M as zh,N as oc,O as Tg,P as sk,Q as $o,R as sl,S as Tp,T as kg,U as Oh,V as ha,W as ac,X as Fh,Y as Bh,Z as Ig,_ as Cs,a as W2,aa as Es,b as X2,ba as lk,c as Ts,ca as Nh,d as ks,da as qo,e as Is,ea as jh,f as da,fa as Sg,g as Ph,ga as Cg,h as yb,i as gg,j as vp,k as rc,l as xp,m as Go,ma as Mg,n as bb,na as ck,o as Y2,p as K2,pa as dk,q as Q2,r as yg,s as bg,t as vg,u as J2,v as ek,w as tk,x as Rh,y as ik,z as nk}from"./chunk-5TAL54F7.js";import{$ as Rr,$a as cg,$b as Bt,A as _d,Aa as nc,Ab as Bo,Ac as U2,Ba as uo,Bb as mp,Bc as G2,C as ig,Cb as No,Cc as bd,D as p2,Db as Lr,E as f2,Eb as zr,F as Ha,Fb as Ue,Fc as gb,G as Pr,Ga as mo,Gb as Ge,Gc as jo,Hb as Ki,I as Ah,Ib as pp,Ic as _g,J as Dh,Jb as fp,Jc as In,L as cb,Lb as dn,M as Qr,Mb as P2,N as _2,Nb as R2,Nc as $2,O as ng,Ob as L2,P as rg,Pb as $t,Q as ic,Qb as z2,R as db,Rb as Dt,Rc as ws,S as g2,Sb as pr,Sc as Vo,T as y2,Ta as T2,Tb as kn,Ua as k2,Ub as _p,Uc as xr,Va as I2,Vb as To,Vc as ko,W as b2,Wa as S2,Wb as Ur,X as ho,Xa as ub,Xb as Fn,Xc as Uo,Y as wo,Ya as zn,Yb as Ni,Z as Fo,Za as lg,Zb as ji,_a as C2,_b as pg,a as It,aa as Jr,ab as M2,ac as hn,b as sr,ba as og,bc as rr,c as l2,ca as Tn,cc as O2,d as eg,da as Vn,db as Ze,dc as Or,e as ob,ea as v2,eb as Xe,ec as ui,f as ir,fa as hb,fb as dg,g as Vr,ga as ci,gb as On,gc as F2,h as c2,ha as qi,hb as hg,hc as B2,i as cp,ia as St,ib as Ut,ic as gp,j as ab,jb as Dn,jc as yp,k as sb,ka as ti,kb as E2,l as ei,la as hi,lb as po,lc as N2,m as sa,ma as Un,mb as nr,mc as fg,na as fn,nb as Za,nc as pb,o as d2,oa as lr,ob as A2,oc as fb,p as qa,pa as Xi,pb as mb,pc as _b,q as la,qa as Yi,qb as D2,r as wi,ra as ag,rb as bi,rc as gn,s as dp,sb as ug,sc as Fr,t as h2,ta as gd,tb as mg,tc as j2,u as u2,ua as hp,ub as cr,v as jn,va as x2,vb as Ct,w as tg,wa as w2,wb as Wa,x as ca,xa as sg,xb as _n,xc as vr,y as lb,yb as yd,yc as V2,z as m2,za as up,zc as bp}from"./chunk-4ENE35H2.js";var CS=eg((Rv,Lv)=>{"use strict";(function(w,m){typeof Rv=="object"&&typeof Lv<"u"?Lv.exports=m():typeof define=="function"&&define.amd?define(m):(w=typeof globalThis<"u"?globalThis:w||self,w.mapboxgl=m())})(Rv,function(){"use strict";var w,m,x;function u(r,M){if(!w)w=M;else if(!m)m=M;else{var F="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+w+")(sharedChunk); ("+m+")(sharedChunk); self.onerror = null;",q={};w(q),x=M(q),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(x.workerUrl=window.URL.createObjectURL(new Blob([F],{type:"text/javascript"})))}}u(["exports"],function(r){"use strict";var M="3.3.0";let F,q={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(F==null){let t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{F=process.env.API_URL_REGEX!=null?new RegExp(process.env.API_URL_REGEX):t}catch{F=t}}return F},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!q.API_URL)return null;try{let t=new URL(q.API_URL);return t.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":t.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"};function re(t){return q.API_URL_REGEX.test(t)}function me(t){return t.indexOf("mapbox:")===0}function De(t){return q.API_CDN_URL_REGEX.test(t)}function $e(t){return q.API_SPRITE_REGEX.test(t)}function Mt(t){return q.API_STYLE_REGEX.test(t)&&!$e(t)}let Ui={create:"create",load:"load",fullLoad:"fullLoad"};function Hi(t){let e=t.name.split("?")[0];return De(e)&&e.includes("mapbox-gl.js")?"javascript":De(e)&&e.includes("mapbox-gl.css")?"css":function(i){return q.API_FONTS_REGEX.test(i)}(e)?"fontRange":$e(e)?"sprite":Mt(e)?"style":function(i){return q.API_TILEJSON_REGEX.test(i)}(e)?"tilejson":"other"}function mi(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Yn=$r;function $r(t,e,i,o){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(o-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=i,this.p2y=o}$r.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(e===void 0&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var i=t,o=0;o<8;o++){var s=this.sampleCurveX(i)-t;if(Math.abs(s)<e)return i;var l=this.sampleCurveDerivativeX(i);if(Math.abs(l)<1e-6)break;i-=s/l}var h=0,f=1;for(i=t,o=0;o<20&&(s=this.sampleCurveX(i),!(Math.abs(s-t)<e));o++)t>s?h=i:f=i,i=.5*(f-h)+h;return i},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var qr=mi(Yn),eo=fo;function fo(t,e){this.x=t,this.y=e}fo.prototype={clone:function(){return new fo(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),o=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=o,this},_rotateAround:function(t,e){var i=Math.cos(t),o=Math.sin(t),s=e.y+o*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-o*(this.y-e.y),this.y=s,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},fo.convert=function(t){return t instanceof fo?t:Array.isArray(t)?new fo(t[0],t[1]):t};var nt=mi(eo);let Rs=Math.PI/180,_c=180/Math.PI;function vi(t){return t*Rs}function Mr(t){return t*_c}let Sd=[[0,0],[1,0],[1,1],[0,1]];function lt(t){if(t<=0)return 0;if(t>=1)return 1;let e=t*t,i=e*t;return 4*(t<.5?i:3*(t-e)+i-.75)}function Ho(t,e,i,o){let s=new qr(t,e,i,o);return function(l){return s.solve(l)}}let Hr=Ho(.25,.1,.25,1);function ii(t,e,i){return Math.min(i,Math.max(e,t))}function ml(t,e,i){return(i=ii((i-t)/(e-t),0,1))*i*(3-2*i)}function Ya(t,e,i){let o=i-e,s=((t-e)%o+o)%o+e;return s===e?i:s}function Zo(t,e,i){if(!t.length)return i(null,[]);let o=t.length,s=new Array(t.length),l=null;t.forEach((h,f)=>{e(h,(y,b)=>{y&&(l=y),s[f]=b,--o==0&&i(l,s)})})}function Er(t,...e){for(let i of e)for(let o in i)t[o]=i[o];return t}let Ls=1;function pl(){return Ls++}function gc(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function yc(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function bc(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function zs(t,e){t.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function Ia(t,e){return t.indexOf(e,t.length-e.length)!==-1}function Ar(t,e,i){let o={};for(let s in t)o[s]=e.call(i||this,t[s],s,t);return o}function So(t,e,i){let o={};for(let s in t)e.call(i||this,t[s],s,t)&&(o[s]=t[s]);return o}function _o(t){return Array.isArray(t)?t.map(_o):typeof t=="object"&&t?Ar(t,_o):t}let Cd={};function Pn(t){Cd[t]||(typeof console<"u"&&console.warn(t),Cd[t]=!0)}function Co(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)}function Os(t){let e=0;for(let i,o,s=0,l=t.length,h=l-1;s<l;h=s++)i=t[s],o=t[h],e+=(o.x-i.x)*(i.y+o.y);return e}function Sa([t,e,i]){let o=vi(e+90),s=vi(i);return{x:t*Math.cos(o)*Math.sin(s),y:t*Math.sin(o)*Math.sin(s),z:t*Math.cos(s),azimuthal:e,polar:i}}function pa(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Fs(t){let e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,o,s,l)=>{let h=s||l;return e[o]=!h||h.toLowerCase(),""}),e["max-age"]){let i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let Hn,fl,_l,Mo,Ca,Ka,Le=null;function X(t){try{let e=self[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function ie(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}function de(t,e,i,o){for(;e<i;){let s=e+i>>1;t[s]<o?e=s+1:i=s}return e}function Me(t,e,i,o){for(;e<i;){let s=e+i>>1;t[s]<=o?e=s+1:i=s}return e}function Oe(){return Hn==null&&(Hn=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Hn}let qe={now:()=>Mo!==void 0?Mo:performance.now(),setNow(t){Mo=t},restoreNow(){Mo=void 0},frame(t){let e=requestAnimationFrame(t);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(t,e=0){let{width:i,height:o}=t;Ca||(Ca=document.createElement("canvas"));let s=Ca.getContext("2d",{willReadFrequently:!0});if(!s)throw new Error("failed to create canvas 2d context");return(i>Ca.width||o>Ca.height)&&(Ca.width=i,Ca.height=o),s.clearRect(-e,-e,i+2*e,o+2*e),s.drawImage(t,0,0,i,o),s.getImageData(-e,-e,i+2*e,o+2*e)},resolveURL:t=>(fl||(fl=document.createElement("a")),fl.href=t,fl.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(_l==null&&(_l=window.matchMedia("(prefers-reduced-motion: reduce)")),_l.matches)},hasCanvasFingerprintNoise(){if(Ka!==void 0)return Ka;if(!Oe())return Ka=!1,!1;let t=new OffscreenCanvas(85,1),e=t.getContext("2d",{willReadFrequently:!0}),i=0;for(let s=0;s<t.width;++s)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(s,0,1,1);let o=e.getImageData(0,0,t.width,t.height);i=0;for(let s=0;s<o.data.length;++s)if(s%4!=3&&i++!==o.data[s])return Ka=!0,!0;return Ka=!1,!1}},gt="mapbox-tiles",Ee=500,bt=50,ut,xt;function ni(){try{return caches}catch{}}function Zi(){let t=ni();t&&!ut&&(ut=t.open(gt))}function sn(t){let e=t.indexOf("?");if(e<0)return t;let i=["language","worldview"],o=new URLSearchParams,s=new URLSearchParams(t.slice(e));for(let l of i){let h=s.get(l);h&&o.set(l,h)}return`${t.slice(0,e)}?${o.toString()}`}function Wi(t,e){let i=t.indexOf("?");if(i<0)return`${t}?${new URLSearchParams(e).toString()}`;let o=new URLSearchParams(t.slice(i));for(let s in e)o.set(s,e[s]);return`${t.slice(0,i)}?${o.toString()}`}let Fi=1/0,Ri={supported:!1,testSupport:function(t){!dr&&nn&&(an?Br(t):Gi=t)}},Gi,nn,dr=!1,an=!1,Zr=typeof self<"u"?self:{};function Br(t){let e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,nn),t.isContextLost())return;Ri.supported=!0}catch{}t.deleteTexture(e),dr=!0}Zr.document&&(nn=Zr.document.createElement("img"),nn.onload=function(){Gi&&Br(Gi),Gi=null,an=!0},nn.onerror=function(){dr=!0,Gi=null},nn.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");let to={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(to);class Kn extends Error{constructor(e,i,o){i===401&&re(o)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=o}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}let Zn=pa()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Ce=function(t,e){if(!(/^file:/.test(i=t.url)||/^file:/.test(Zn())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(o,s){let l=new AbortController,h=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,referrer:Zn(),referrerPolicy:o.referrerPolicy,signal:l.signal}),f=!1,y=!1,b=(T=h.url).indexOf("sku=")>0&&re(T);var T;o.type==="json"&&h.headers.set("Accept","application/json");let I=(D,R,L)=>{if(y)return;if(D&&D.message!=="SecurityError"&&Pn(D.toString()),R&&L)return C(R);let B=Date.now();fetch(h).then(j=>{if(j.ok){let Z=b?j.clone():null;return C(j,Z,B)}return s(new Kn(j.statusText,j.status,o.url))}).catch(j=>{j.name!=="AbortError"&&s(new Error(`${j.message} ${o.url}`))})},C=(D,R,L)=>{(o.type==="arrayBuffer"?D.arrayBuffer():o.type==="json"?D.json():D.text()).then(B=>{y||(R&&L&&function(j,Z,K){if(Zi(),!ut)return;let Y=Fs(Z.headers.get("Cache-Control")||"");if(Y["no-store"])return;let ne={status:Z.status,statusText:Z.statusText,headers:new Headers};Z.headers.forEach((he,fe)=>ne.headers.set(fe,he)),Y["max-age"]&&ne.headers.set("Expires",new Date(K+1e3*Y["max-age"]).toUTCString());let te=ne.headers.get("Expires");if(!te||new Date(te).getTime()-K<42e4)return;let se=sn(j.url);if(Z.status===206){let he=j.headers.get("Range");if(!he)return;ne.status=200,se=Wi(se,{range:he})}(function(he,fe){if(xt===void 0)try{new Response(new ReadableStream),xt=!0}catch{xt=!1}xt?fe(he.body):he.blob().then(fe)})(Z,he=>{let fe=new Response(he,ne);Zi(),ut&&ut.then(ve=>ve.put(se,fe)).catch(ve=>Pn(ve.message))})}(h,R,L),f=!0,s(null,B,D.headers.get("Cache-Control"),D.headers.get("Expires")))}).catch(B=>{y||s(new Error(B.message))})};return b?function(D,R){if(Zi(),!ut)return R(null);ut.then(L=>{let B=sn(D.url),j=D.headers.get("Range");j&&(B=Wi(B,{range:j})),L.match(B).then(Z=>{let K=function(Y){if(!Y)return!1;let ne=new Date(Y.headers.get("Expires")||0),te=Fs(Y.headers.get("Cache-Control")||"");return ne>Date.now()&&!te["no-cache"]}(Z);L.delete(B),K&&L.put(B,Z.clone()),R(null,Z,K)}).catch(R)}).catch(R)}(h,I):I(null,null),{cancel:()=>{y=!0,f||l.abort()}}}(t,e);if(pa()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var i;return function(o,s){let l=new XMLHttpRequest;l.open(o.method||"GET",o.url,!0),o.type==="arrayBuffer"&&(l.responseType="arraybuffer");for(let h in o.headers)l.setRequestHeader(h,o.headers[h]);return o.type==="json"&&(l.responseType="text",l.setRequestHeader("Accept","application/json")),l.withCredentials=o.credentials==="include",l.onerror=()=>{s(new Error(l.statusText))},l.onload=()=>{if((l.status>=200&&l.status<300||l.status===0)&&l.response!==null){let h=l.response;if(o.type==="json")try{h=JSON.parse(l.response)}catch(f){return s(f)}s(null,h,l.getResponseHeader("Cache-Control"),l.getResponseHeader("Expires"))}else s(new Kn(l.statusText,l.status,o.url))},l.send(o.body),{cancel:()=>l.abort()}}(t,e)},Ae=function(t,e){return Ce(Er(t,{type:"arrayBuffer"}),e)};function He(t){let e=document.createElement("a");return e.href=t,e.protocol===location.protocol&&e.host===location.host}let tt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",Ke,ot;Ke=[],ot=0;let at=function(t,e){if(Ri.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),ot>=q.MAX_PARALLEL_IMAGE_REQUESTS){let l={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Ke.push(l),l}ot++;let i=!1,o=()=>{if(!i)for(i=!0,ot--;Ke.length&&ot<q.MAX_PARALLEL_IMAGE_REQUESTS;){let l=Ke.shift(),{requestParameters:h,callback:f,cancelled:y}=l;y||(l.cancel=at(h,f).cancel)}},s=Ae(t,(l,h,f,y)=>{o(),l?e(l):h&&(self.createImageBitmap?function(b,T){let I=new Blob([new Uint8Array(b)],{type:"image/png"});createImageBitmap(I).then(C=>{T(null,C)}).catch(C=>{T(new Error(`Could not load image because of ${C.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(h,(b,T)=>e(b,T,f,y)):function(b,T){let I=new Image;I.onload=()=>{T(null,I),URL.revokeObjectURL(I.src),I.onload=null,requestAnimationFrame(()=>{I.src=tt})},I.onerror=()=>T(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let C=new Blob([new Uint8Array(b)],{type:"image/png"});I.src=b.byteLength?URL.createObjectURL(C):tt}(h,(b,T)=>e(b,T,f,y)))});return{cancel:()=>{s.cancel(),o()}}},Je="01",ct="NO_ACCESS_TOKEN",it=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ft(t){let e=t.match(it);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function pi(t){let e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}let kt="mapbox.eventData";function Qi(t){if(!t)return null;let e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(atob(e[1]).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class un{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){let i=Qi(q.ACCESS_TOKEN),o="";return o=i&&i.u?btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,(s,l)=>String.fromCharCode(+("0x"+l)))):q.ACCESS_TOKEN||"",e?`${kt}.${e}:${o}`:`${kt}:${o}`}fetchEventData(){let e=X("localStorage"),i=this.getStorageKey(),o=this.getStorageKey("uuid");if(e)try{let s=localStorage.getItem(i);s&&(this.eventData=JSON.parse(s));let l=localStorage.getItem(o);l&&(this.anonId=l)}catch{Pn("Unable to read from LocalStorage")}}saveEventData(){let e=X("localStorage"),i=this.getStorageKey(),o=this.getStorageKey("uuid"),s=this.anonId;if(e&&s)try{localStorage.setItem(o,s),Object.keys(this.eventData).length>=1&&localStorage.setItem(i,JSON.stringify(this.eventData))}catch{Pn("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,i,o,s){if(!q.EVENTS_URL)return;let l=Ft(q.EVENTS_URL);l.params.push(`access_token=${s||q.ACCESS_TOKEN||""}`);let h={event:this.type,created:new Date(e).toISOString()},f=i?Er(h,i):h,y={url:pi(l),headers:{"Content-Type":"text/plain"},body:JSON.stringify([f])};this.pendingRequest=function(b,T){return Ce(Er(b,{method:"POST"}),T)}(y,b=>{this.pendingRequest=null,o(b),this.saveEventData(),this.processRequests(s)})}queueRequest(e,i){this.queue.push(e),this.processRequests(i)}}let Mn=new class extends un{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){q.EVENTS_URL&&q.ACCESS_TOKEN&&Array.isArray(t)&&t.some(i=>me(i)||re(i))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();let e=Qi(q.ACCESS_TOKEN),i=e?e.u:q.ACCESS_TOKEN,o=i!==this.eventData.tokenU;bc(this.anonId)||(this.anonId=gc(),o=!0);let s=this.queue.shift();if(this.eventData.lastSuccess){let l=new Date(this.eventData.lastSuccess),h=new Date(s),f=(s-this.eventData.lastSuccess)/864e5;o=o||f>=1||f<-1||l.getDate()!==h.getDate()}else o=!0;o?this.postEvent(s,{sdkIdentifier:"mapbox-gl-js",sdkVersion:M,skuId:Je,"enabled.telemetry":!1,userId:this.anonId},l=>{l||(this.eventData.lastSuccess=s,this.eventData.tokenU=i)},t):this.processRequests()}},Qn=Mn.postTurnstileEvent.bind(Mn),wr=new class extends un{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,i,o){this.skuToken=e,this.errorCb=o,q.EVENTS_URL&&(i||q.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(ct)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),bc(this.anonId)||(this.anonId=gc()),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:M,skuId:Je,skuToken:this.skuToken,userId:this.anonId},o=>{o?this.errorCb(o):e&&(this.success[e]=!0)},t))}remove(){this.errorCb=null}},Ai=wr.postMapLoadEvent.bind(wr),go=new class extends un{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){q.EVENTS_URL&&(t||q.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:e,performanceData:i}=this.queue.shift(),o=function(s){let l=performance.getEntriesByType("resource"),h=performance.getEntriesByType("mark"),f=function(D){let R={};if(D){for(let L in D)if(L!=="other")for(let B of D[L]){let j=`${L}ResolveRangeMin`,Z=`${L}ResolveRangeMax`,K=`${L}RequestCount`,Y=`${L}RequestCachedCount`;R[j]=Math.min(R[j]||1/0,B.startTime),R[Z]=Math.max(R[Z]||-1/0,B.responseEnd);let ne=te=>{R[te]===void 0&&(R[te]=0),++R[te]};B.transferSize!==void 0&&B.transferSize===0&&ne(Y),ne(K)}}return R}(function(D,R){let L={};if(D)for(let B of D){let j=R(B);L[j]===void 0&&(L[j]=[]),L[j].push(B)}return L}(l,Hi)),y=window.devicePixelRatio,b=navigator.connection||navigator.mozConnection||navigator.webkitConnection,T=b?b.effectiveType:void 0,I={counters:[],metadata:[],attributes:[]},C=(D,R,L)=>{L!=null&&D.push({name:R,value:L.toString()})};for(let D in f)C(I.counters,D,f[D]);if(s.interactionRange[0]!==1/0&&s.interactionRange[1]!==-1/0&&(C(I.counters,"interactionRangeMin",s.interactionRange[0]),C(I.counters,"interactionRangeMax",s.interactionRange[1])),h)for(let D of Object.keys(Ui)){let R=Ui[D],L=h.find(B=>B.name===R);L&&C(I.counters,R,L.startTime)}return C(I.counters,"visibilityHidden",s.visibilityHidden),C(I.attributes,"style",function(D){if(D)for(let R of D){let L=R.name.split("?")[0];if(Mt(L)){let B=L.split("/").slice(-2);if(B.length===2)return`mapbox://styles/${B[0]}/${B[1]}`}}}(l)),C(I.attributes,"terrainEnabled",s.terrainEnabled?"true":"false"),C(I.attributes,"fogEnabled",s.fogEnabled?"true":"false"),C(I.attributes,"projection",s.projection),C(I.attributes,"zoom",s.zoom),C(I.metadata,"devicePixelRatio",y),C(I.metadata,"connectionEffectiveType",T),C(I.metadata,"navigatorUserAgent",navigator.userAgent),C(I.metadata,"screenWidth",window.screen.width),C(I.metadata,"screenHeight",window.screen.height),C(I.metadata,"windowWidth",window.innerWidth),C(I.metadata,"windowHeight",window.innerHeight),C(I.metadata,"mapWidth",s.width/y),C(I.metadata,"mapHeight",s.height/y),C(I.metadata,"webglRenderer",s.renderer),C(I.metadata,"webglVendor",s.vendor),C(I.metadata,"sdkVersion",M),C(I.metadata,"sdkIdentifier","mapbox-gl-js"),I}(i);for(let s of o.metadata);for(let s of o.counters);for(let s of o.attributes);this.postEvent(e,o,()=>{},t)}},Wo=go.postPerformanceEvent.bind(go),Tr=new class extends un{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,i,o){if(!q.API_URL||!q.SESSION_PATH)return;let s=Ft(q.API_URL+q.SESSION_PATH);s.params.push(`sku=${e||""}`),s.params.push(`access_token=${o||q.ACCESS_TOKEN||""}`);let l={url:pi(s),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(h,f){return Ce(Er(h,{method:"GET"}),f)}(l,h=>{this.pendingRequest=null,i(h),this.saveEventData(),this.processRequests(o)})}getSessionAPI(t,e,i,o){this.skuToken=e,this.errorCb=o,q.SESSION_PATH&&q.API_URL&&(i||q.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(ct)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||this.getSession(i,this.skuToken,o=>{o?this.errorCb(o):e&&(this.success[e]=!0)},t)}remove(){this.errorCb=null}},vc=Tr.getSessionAPI.bind(Tr),Qa=new Set;function gl(t,e,i){i[t]&&i[t].indexOf(e)!==-1||(i[t]=i[t]||[],i[t].push(e))}function su(t,e,i){if(i&&i[t]){let o=i[t].indexOf(e);o!==-1&&i[t].splice(o,1)}}class Bs{constructor(e,i={}){Er(this,i),this.type=e}}class lu extends Bs{constructor(e,i={}){super("error",Er({error:e},i))}}class yl{on(e,i){return this._listeners=this._listeners||{},gl(e,i,this._listeners),this}off(e,i){return su(e,i,this._listeners),su(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},gl(e,i,this._oneTimeListeners),this):new Promise(o=>this.once(e,o))}fire(e,i){typeof e=="string"&&(e=new Bs(e,i||{}));let o=e.type;if(this.listens(o)){e.target=this;let s=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(let f of s)f.call(this,e);let l=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(let f of l)su(o,f,this._oneTimeListeners),f.call(this,e);let h=this._eventedParent;h&&(Er(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),h.fire(e))}else e instanceof lu&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}r.y=void 0;var lf={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Md(t){return(t=Math.round(t))<0?0:t>255?255:t}function cu(t){return Md(t[t.length-1]==="%"?parseFloat(t)/100*255:parseInt(t))}function Ed(t){return(e=t[t.length-1]==="%"?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function du(t,e,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?t+(e-t)*i*6:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}try{r.y={}.parseCSSColor=function(t){var e,i=t.replace(/ /g,"").toLowerCase();if(i in lf)return lf[i].slice();if(i[0]==="#")return i.length===4?(e=parseInt(i.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:i.length===7&&(e=parseInt(i.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var o=i.indexOf("("),s=i.indexOf(")");if(o!==-1&&s+1===i.length){var l=i.substr(0,o),h=i.substr(o+1,s-(o+1)).split(","),f=1;switch(l){case"rgba":if(h.length!==4)return null;f=Ed(h.pop());case"rgb":return h.length!==3?null:[cu(h[0]),cu(h[1]),cu(h[2]),f];case"hsla":if(h.length!==4)return null;f=Ed(h.pop());case"hsl":if(h.length!==3)return null;var y=(parseFloat(h[0])%360+360)%360/360,b=Ed(h[1]),T=Ed(h[2]),I=T<=.5?T*(b+1):T+b-T*b,C=2*T-I;return[Md(255*du(C,I,y+1/3)),Md(255*du(C,I,y)),Md(255*du(C,I,y-1/3)),f];default:return null}}return null}}catch{}class io{constructor(e,i,o,s=1){this.r=e,this.g=i,this.b=o,this.a=s}static parse(e){if(!e)return;if(e instanceof io)return e;if(typeof e!="string")return;let i=r.y(e);return i?new io(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){let[e,i,o,s]=this.toArray();return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(o)},${s})`}toArray(){let{r:e,g:i,b:o,a:s}=this;return s===0?[0,0,0,0]:[255*e/s,255*i/s,255*o/s,s]}toArray01(){let{r:e,g:i,b:o,a:s}=this;return s===0?[0,0,0,0]:[e/s,i/s,o/s,s]}toArray01Scaled(e){let{r:i,g:o,b:s,a:l}=this;return l===0?[0,0,0]:[i/l*e,o/l*e,s/l*e]}toArray01PremultipliedAlpha(){let{r:e,g:i,b:o,a:s}=this;return[e,i,o,s]}toArray01Linear(){let{r:e,g:i,b:o,a:s}=this;return s===0?[0,0,0,0]:[Math.pow(e/s,2.2),Math.pow(i/s,2.2),Math.pow(o/s,2.2),s]}}io.black=new io(0,0,0,1),io.white=new io(1,1,1,1),io.transparent=new io(0,0,0,0),io.red=new io(1,0,0,1),io.blue=new io(0,0,1,1);var Wn=io;function fi(t,e,i){return t*(1-i)+e*i}function cf(t,e,i){return t.map((o,s)=>fi(o,e[s],i))}var Ad=Object.freeze({__proto__:null,array:cf,color:function(t,e,i){return new Wn(fi(t.r,e.r,i),fi(t.g,e.g,i),fi(t.b,e.b,i),fi(t.a,e.a,i))},number:fi});function hu(t,...e){for(let i of e)for(let o in i)t[o]=i[o];return t}class m0 extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}var fa=m0;class uu{constructor(e,i=[]){this.parent=e,this.bindings={};for(let[o,s]of i)this.bindings[o]=s}concat(e){return new uu(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var p0=uu;let bl={kind:"null"},ht={kind:"number"},Li={kind:"string"},zi={kind:"boolean"},Eo={kind:"color"},vl={kind:"object"},Ti={kind:"value"},Dd={kind:"collator"},xl={kind:"formatted"},xc={kind:"resolvedImage"};function no(t,e){return{kind:"array",itemType:t,N:e}}function $n(t){if(t.kind==="array"){let e=$n(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}let Rt=[bl,ht,Li,zi,Eo,xl,vl,no(Ti),xc];function Ns(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Ns(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(let i of Rt)if(!Ns(i,e))return null}}return`Expected ${$n(t)} but found ${$n(e)} instead.`}function jt(t,e){return e.some(i=>i.kind===t.kind)}function Ja(t,e){return e.some(i=>i==="null"?t===null:i==="array"?Array.isArray(t):i==="object"?t&&!Array.isArray(t)&&typeof t=="object":i===typeof t)}class ri{constructor(e,i,o){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class wl{constructor(e,i,o,s,l){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=o,this.fontStack=s,this.textColor=l}}class kr{constructor(e){this.sections=e}static fromString(e){return new kr([new wl(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary.length!==0)}static factory(e){return e instanceof kr?e:kr.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){let e=["format"];for(let i of this.sections){if(i.image){e.push(["image",i.image.namePrimary]);continue}e.push(i.text);let o={};i.fontStack&&(o["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(o["font-scale"]=i.scale),i.textColor&&(o["text-color"]=["rgba"].concat(i.textColor.toArray())),e.push(o)}return e}}class Lt{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,i){return e?new Lt({namePrimary:e,nameSecondary:i,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function df(t,e,i,o){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[t,e,i,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[t,e,i,o]:[t,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function js(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof Wn||t instanceof ri||t instanceof kr||t instanceof Lt)return!0;if(Array.isArray(t)){for(let e of t)if(!js(e))return!1;return!0}if(typeof t=="object"){for(let e in t)if(!js(t[e]))return!1;return!0}return!1}function Jn(t){if(t===null)return bl;if(typeof t=="string")return Li;if(typeof t=="boolean")return zi;if(typeof t=="number")return ht;if(t instanceof Wn)return Eo;if(t instanceof ri)return Dd;if(t instanceof kr)return xl;if(t instanceof Lt)return xc;if(Array.isArray(t)){let e=t.length,i;for(let o of t){let s=Jn(o);if(i){if(i===s)continue;i=Ti;break}i=s}return no(i||Ti,e)}return vl}function Ao(t){let e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof Wn||t instanceof kr||t instanceof Lt?t.toString():JSON.stringify(t)}class es{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!js(e[1]))return i.error("invalid value");let o=e[1],s=Jn(o),l=i.expectedType;return s.kind!=="array"||s.N!==0||!l||l.kind!=="array"||typeof l.N=="number"&&l.N!==0||(s=l),new es(s,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Wn?["rgba"].concat(this.value.toArray()):this.value instanceof kr?this.value.serialize():this.value}}var Ma=es,er=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};let mu={string:Li,number:ht,boolean:zi,object:vl};class pu{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let o,s=1,l=e[0];if(l==="array"){let f,y;if(e.length>2){let b=e[1];if(typeof b!="string"||!(b in mu)||b==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);f=mu[b],s++}else f=Ti;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);y=e[2],s++}o=no(f,y)}else o=mu[l];let h=[];for(;s<e.length;s++){let f=i.parse(e[s],s,Ti);if(!f)return null;h.push(f)}return new pu(o,h)}evaluate(e){for(let i=0;i<this.args.length;i++){let o=this.args[i].evaluate(e);if(!Ns(this.type,Jn(o)))return o;if(i===this.args.length-1)throw new er(`Expected value to be of type ${$n(this.type)}, but found ${$n(Jn(o))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=this.type,i=[e.kind];if(e.kind==="array"){let o=e.itemType;if(o.kind==="string"||o.kind==="number"||o.kind==="boolean"){i.push(o.kind);let s=e.N;(typeof s=="number"||this.args.length>1)&&i.push(s)}}return i.concat(this.args.map(o=>o.serialize()))}}var Ea=pu;class Tl{constructor(e){this.type=xl,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let o=e[1];if(!Array.isArray(o)&&typeof o=="object")return i.error("First argument must be an image or text section.");let s=[],l=!1;for(let h=1;h<=e.length-1;++h){let f=e[h];if(l&&typeof f=="object"&&!Array.isArray(f)){l=!1;let y=null;if(f["font-scale"]&&(y=i.parse(f["font-scale"],1,ht),!y))return null;let b=null;if(f["text-font"]&&(b=i.parse(f["text-font"],1,no(Li)),!b))return null;let T=null;if(f["text-color"]&&(T=i.parse(f["text-color"],1,Eo),!T))return null;let I=s[s.length-1];I.scale=y,I.font=b,I.textColor=T}else{let y=i.parse(e[h],1,Ti);if(!y)return null;let b=y.type.kind;if(b!=="string"&&b!=="value"&&b!=="null"&&b!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");l=!0,s.push({content:y,scale:null,font:null,textColor:null})}}return new Tl(s)}evaluate(e){return new kr(this.sections.map(i=>{let o=i.content.evaluate(e);return Jn(o)===xc?new wl("",o,null,null,null):new wl(Ao(o),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(let i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){let e=["format"];for(let i of this.sections){e.push(i.content.serialize());let o={};i.scale&&(o["font-scale"]=i.scale.serialize()),i.font&&(o["text-font"]=i.font.serialize()),i.textColor&&(o["text-color"]=i.textColor.serialize()),e.push(o)}return e}}class Vs{constructor(e,i){this.type=xc,this.inputPrimary=e,this.inputSecondary=i}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");let o=i.parse(e[1],1,Li);if(!o)return i.error("No image name provided.");if(e.length===2)return new Vs(o);let s=i.parse(e[2],1,Li);return s?new Vs(o,s):i.error("Secondary image variant is not a string.")}evaluate(e){let i=Lt.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return i&&e.availableImages&&(i.available=e.availableImages.indexOf(i.namePrimary)>-1,i.nameSecondary&&i.available&&e.availableImages&&(i.available=e.availableImages.indexOf(i.nameSecondary)>-1)),i}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function kl(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}let Xo={"to-boolean":zi,"to-color":Eo,"to-number":ht,"to-string":Li};class Pd{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let o=e[0],s=[],l=bl;if(o==="to-array"){if(!Array.isArray(e[1]))return null;let h=e[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);l=no(i.expectedType.itemType,h)}else{if(!(h>0&&js(e[1][0])))return null;l=no(Jn(e[1][0]),h)}for(let f=0;f<h;f++){let y=e[1][f],b;if(kl(y)==="array")b=i.parse(y,void 0,l.itemType);else{let T=kl(y);if(T!==l.itemType.kind)return i.error(`Expected ${l.itemType.kind} but found ${T}.`);b=i.registry.literal.parse(["literal",y===void 0?null:y],i)}if(!b)return null;s.push(b)}}else{if((o==="to-boolean"||o==="to-string")&&e.length!==2)return i.error("Expected one argument.");l=Xo[o];for(let h=1;h<e.length;h++){let f=i.parse(e[h],h,Ti);if(!f)return null;s.push(f)}}return new Pd(l,s)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,o;for(let s of this.args){if(i=s.evaluate(e),o=null,i instanceof Wn)return i;if(typeof i=="string"){let l=e.parseColor(i);if(l)return l}else if(Array.isArray(i)&&(o=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:df(i[0],i[1],i[2],i[3]),!o))return new Wn(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new er(o||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(let o of this.args){if(i=o.evaluate(e),i===null)return 0;let s=Number(i);if(!isNaN(s))return s}throw new er(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?kr.fromString(Ao(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Lt.fromString(Ao(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(i=>i.evaluate(e)):Ao(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Tl([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Vs(this.args[0]).serialize();let e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}var Aa=Pd;let wc=["Unknown","Point","LineString","Polygon"];var hf=class{constructor(t,e){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=t,this.options=e}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?wc[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(t){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){let t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:i,y:o}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*e-t[0])+this.featureDistanceData.bearing[1]*(o*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=Wn.parse(t)),e}getConfig(t){return this.options?this.options.get(t):null}};class Us{constructor(e,i,o,s,l){this.name=e,this.type=i,this._evaluate=o,this.args=s,this._overloadIndex=l}evaluate(e){if(!this._evaluate){let i=Us.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){let o=e[0],s=Us.definitions[o];if(!s)return i.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);let l=Array.isArray(s)?s[0]:s.type,h=Array.isArray(s)?[[s[1],s[2]]]:s.overloads,f=[],y=null,b=-1;for(let[T,I]of h){if(Array.isArray(T)&&T.length!==e.length-1)continue;f.push(T),b++,y=new yf(i.registry,i.path,null,i.scope,void 0,i._scope,i.options);let C=[],D=!1;for(let R=1;R<e.length;R++){let L=e[R],B=Array.isArray(T)?T[R-1]:T.type,j=y.parse(L,1+C.length,B);if(!j){D=!0;break}C.push(j)}if(!D)if(Array.isArray(T)&&T.length!==C.length)y.error(`Expected ${T.length} arguments, but found ${C.length} instead.`);else{for(let R=0;R<C.length;R++){let L=Array.isArray(T)?T[R]:T.type,B=C[R];y.concat(R+1).checkSubtype(L,B.type)}if(y.errors.length===0)return new Us(o,l,I,C,b)}}if(f.length===1)i.errors.push(...y.errors);else{let T=(f.length?f:h.map(([C])=>C)).map(uf).join(" | "),I=[];for(let C=1;C<e.length;C++){let D=i.parse(e[C],1+I.length);if(!D)return null;I.push($n(D.type))}i.error(`Expected arguments of type ${T}, but found (${I.join(", ")}) instead.`)}return null}static register(e,i){Us.definitions=i;for(let o in i)e[o]=Us}}function uf(t){return Array.isArray(t)?`(${t.map($n).join(", ")})`:`(${$n(t.type)}...)`}var gi=Us;class Tc{constructor(e,i,o){this.type=Dd,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");let o=e[1];if(typeof o!="object"||Array.isArray(o))return i.error("Collator options argument must be an object.");let s=i.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,zi);if(!s)return null;let l=i.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,zi);if(!l)return null;let h=null;return o.locale&&(h=i.parse(o.locale,1,Li),!h)?null:new Tc(s,l,h)}evaluate(e){return new ri(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){let e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}var fu={exports:{}};fu.exports=function(){function t(o,s,l,h,f){for(;h>l;){if(h-l>600){var y=h-l+1,b=s-l+1,T=Math.log(y),I=.5*Math.exp(2*T/3),C=.5*Math.sqrt(T*I*(y-I)/y)*(b-y/2<0?-1:1);t(o,s,Math.max(l,Math.floor(s-b*I/y+C)),Math.min(h,Math.floor(s+(y-b)*I/y+C)),f)}var D=o[s],R=l,L=h;for(e(o,l,s),f(o[h],D)>0&&e(o,l,h);R<L;){for(e(o,R,L),R++,L--;f(o[R],D)<0;)R++;for(;f(o[L],D)>0;)L--}f(o[l],D)===0?e(o,l,L):e(o,++L,h),L<=s&&(l=L+1),s<=L&&(h=L-1)}}function e(o,s,l){var h=o[s];o[s]=o[l],o[l]=h}function i(o,s){return o<s?-1:o>s?1:0}return function(o,s,l,h,f){t(o,s,l||0,h||o.length-1,f||i)}}();var f0=mi(fu.exports);function _0(t){let e=0;for(let i,o,s=0,l=t.length,h=l-1;s<l;h=s++)i=t[s],o=t[h],e+=(o.x-i.x)*(i.y+o.y);return e}function ts(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function is(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Rd(t,e,i){let o=t[0]-e[0],s=t[1]-e[1],l=t[0]-i[0],h=t[1]-i[1];return o*h-l*s==0&&o*l<=0&&s*h<=0}function Il(t,e,i=!1){let o=!1;for(let f=0,y=e.length;f<y;f++){let b=e[f];for(let T=0,I=b.length,C=I-1;T<I;C=T++){let D=b[C],R=b[T];if(Rd(t,D,R))return i;(l=D)[1]>(s=t)[1]!=(h=R)[1]>s[1]&&s[0]<(h[0]-l[0])*(s[1]-l[1])/(h[1]-l[1])+l[0]&&(o=!o)}}var s,l,h;return o}function _u(t,e,i,o){let s=o[0]-i[0],l=o[1]-i[1],h=(t[0]-i[0])*l-s*(t[1]-i[1]),f=(e[0]-i[0])*l-s*(e[1]-i[1]);return h>0&&f<0||h<0&&f>0}function Da(t,e,i,o){return(s=[o[0]-i[0],o[1]-i[1]])[0]*(l=[e[0]-t[0],e[1]-t[1]])[1]-s[1]*l[0]!=0&&!(!_u(t,e,i,o)||!_u(i,o,t,e));var s,l}let ns=8192;function kc(t,e){let i=(180+t[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,s=Math.pow(2,e.z);return[Math.round(i*s*ns),Math.round(o*s*ns)]}function gu(t,e){for(let i=0;i<e.length;i++)if(Il(t,e[i]))return!0;return!1}function yu(t,e,i){for(let o of i)for(let s=0,l=o.length,h=l-1;s<l;h=s++)if(Da(t,e,o[h],o[s]))return!0;return!1}function Do(t,e){for(let i=0;i<t.length;++i)if(!Il(t[i],e))return!1;for(let i=0;i<t.length-1;++i)if(yu(t[i],t[i+1],e))return!1;return!0}function mf(t,e){for(let i=0;i<e.length;i++)if(Do(t,e[i]))return!0;return!1}function bu(t,e,i){let o=[];for(let s=0;s<t.length;s++){let l=[];for(let h=0;h<t[s].length;h++){let f=kc(t[s][h],i);ts(e,f),l.push(f)}o.push(l)}return o}function vu(t,e,i){let o=[];for(let s=0;s<t.length;s++){let l=bu(t[s],e,i);o.push(l)}return o}function xu(t,e,i,o){if(t[0]<i[0]||t[0]>i[2]){let s=.5*o,l=t[0]-i[0]>s?-o:i[0]-t[0]>s?o:0;l===0&&(l=t[0]-i[2]>s?-o:i[2]-t[0]>s?o:0),t[0]+=l}ts(e,t)}function wu(t,e,i,o){let s=Math.pow(2,o.z)*ns,l=[o.x*ns,o.y*ns],h=[];if(!t)return h;for(let f of t)for(let y of f){let b=[y.x+l[0],y.y+l[1]];xu(b,e,i,s),h.push(b)}return h}function Tu(t,e,i,o){let s=Math.pow(2,o.z)*ns,l=[o.x*ns,o.y*ns],h=[];if(!t)return h;for(let y of t){let b=[];for(let T of y){let I=[T.x+l[0],T.y+l[1]];ts(e,I),b.push(I)}h.push(b)}if(e[2]-e[0]<=s/2){(f=e)[0]=f[1]=1/0,f[2]=f[3]=-1/0;for(let y of h)for(let b of y)xu(b,e,i,s)}var f;return h}class Sl{constructor(e,i){this.type=zi,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(js(e[1])){let o=e[1];if(o.type==="FeatureCollection")for(let s=0;s<o.features.length;++s){let l=o.features[s].geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new Sl(o,o.features[s].geometry)}else if(o.type==="Feature"){let s=o.geometry.type;if(s==="Polygon"||s==="MultiPolygon")return new Sl(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new Sl(o,o)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,o){let s=[1/0,1/0,-1/0,-1/0],l=[1/0,1/0,-1/0,-1/0],h=i.canonicalID();if(!h)return!1;if(o.type==="Polygon"){let f=bu(o.coordinates,l,h),y=wu(i.geometry(),s,l,h);if(!is(s,l))return!1;for(let b of y)if(!Il(b,f))return!1}if(o.type==="MultiPolygon"){let f=vu(o.coordinates,l,h),y=wu(i.geometry(),s,l,h);if(!is(s,l))return!1;for(let b of y)if(!gu(b,f))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,o){let s=[1/0,1/0,-1/0,-1/0],l=[1/0,1/0,-1/0,-1/0],h=i.canonicalID();if(!h)return!1;if(o.type==="Polygon"){let f=bu(o.coordinates,l,h),y=Tu(i.geometry(),s,l,h);if(!is(s,l))return!1;for(let b of y)if(!Do(b,f))return!1}if(o.type==="MultiPolygon"){let f=vu(o.coordinates,l,h),y=Tu(i.geometry(),s,l,h);if(!is(s,l))return!1;for(let b of y)if(!mf(b,f))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Ld=Sl,Ic={exports:{}};Ic.exports=function(){var t={kilometers:1,miles:.621371192237334,nauticalmiles:.5399568034557235,meters:1e3,metres:1e3,yards:1093.6132983377079,feet:3280.839895013123,inches:39370.078740157485},e=1/298.257223563,i=e*(2-e),o=Math.PI/180,s=function(b,T){if(b===void 0)throw new Error("No latitude given.");if(T&&!t[T])throw new Error("Unknown unit "+T+". Use one of: "+Object.keys(t).join(", "));var I=6378.137*o*(T?t[T]:1),C=Math.cos(b*o),D=1/(1-i*(1-C*C)),R=Math.sqrt(D);this.kx=I*R*C,this.ky=I*R*D*(1-i)},l={units:{configurable:!0}};function h(b,T){return b[0]===T[0]&&b[1]===T[1]}function f(b,T,I){var C=y(T[0]-b[0]);return[b[0]+C*I,b[1]+(T[1]-b[1])*I]}function y(b){for(;b<-180;)b+=360;for(;b>180;)b-=360;return b}return s.fromTile=function(b,T,I){var C=Math.PI*(1-2*(b+.5)/Math.pow(2,T)),D=Math.atan(.5*(Math.exp(C)-Math.exp(-C)))/o;return new s(D,I)},l.units.get=function(){return t},s.prototype.distance=function(b,T){var I=y(b[0]-T[0])*this.kx,C=(b[1]-T[1])*this.ky;return Math.sqrt(I*I+C*C)},s.prototype.bearing=function(b,T){var I=y(T[0]-b[0])*this.kx;return Math.atan2(I,(T[1]-b[1])*this.ky)/o},s.prototype.destination=function(b,T,I){var C=I*o;return this.offset(b,Math.sin(C)*T,Math.cos(C)*T)},s.prototype.offset=function(b,T,I){return[b[0]+T/this.kx,b[1]+I/this.ky]},s.prototype.lineDistance=function(b){for(var T=0,I=0;I<b.length-1;I++)T+=this.distance(b[I],b[I+1]);return T},s.prototype.area=function(b){for(var T=0,I=0;I<b.length;I++)for(var C=b[I],D=0,R=C.length,L=R-1;D<R;L=D++)T+=y(C[D][0]-C[L][0])*(C[D][1]+C[L][1])*(I?-1:1);return Math.abs(T)/2*this.kx*this.ky},s.prototype.along=function(b,T){var I=0;if(T<=0)return b[0];for(var C=0;C<b.length-1;C++){var D=b[C],R=b[C+1],L=this.distance(D,R);if((I+=L)>T)return f(D,R,(T-(I-L))/L)}return b[b.length-1]},s.prototype.pointToSegmentDistance=function(b,T,I){var C=T[0],D=T[1],R=y(I[0]-C)*this.kx,L=(I[1]-D)*this.ky,B=0;return R===0&&L===0||((B=(y(b[0]-C)*this.kx*R+(b[1]-D)*this.ky*L)/(R*R+L*L))>1?(C=I[0],D=I[1]):B>0&&(C+=R/this.kx*B,D+=L/this.ky*B)),R=y(b[0]-C)*this.kx,L=(b[1]-D)*this.ky,Math.sqrt(R*R+L*L)},s.prototype.pointOnLine=function(b,T){for(var I,C,D,R,L=1/0,B=0;B<b.length-1;B++){var j=b[B][0],Z=b[B][1],K=y(b[B+1][0]-j)*this.kx,Y=(b[B+1][1]-Z)*this.ky,ne=0;K===0&&Y===0||((ne=(y(T[0]-j)*this.kx*K+(T[1]-Z)*this.ky*Y)/(K*K+Y*Y))>1?(j=b[B+1][0],Z=b[B+1][1]):ne>0&&(j+=K/this.kx*ne,Z+=Y/this.ky*ne));var te=(K=y(T[0]-j)*this.kx)*K+(Y=(T[1]-Z)*this.ky)*Y;te<L&&(L=te,I=j,C=Z,D=B,R=ne)}return{point:[I,C],index:D,t:Math.max(0,Math.min(1,R))}},s.prototype.lineSlice=function(b,T,I){var C=this.pointOnLine(I,b),D=this.pointOnLine(I,T);if(C.index>D.index||C.index===D.index&&C.t>D.t){var R=C;C=D,D=R}var L=[C.point],B=C.index+1,j=D.index;!h(I[B],L[0])&&B<=j&&L.push(I[B]);for(var Z=B+1;Z<=j;Z++)L.push(I[Z]);return h(I[j],D.point)||L.push(D.point),L},s.prototype.lineSliceAlong=function(b,T,I){for(var C=0,D=[],R=0;R<I.length-1;R++){var L=I[R],B=I[R+1],j=this.distance(L,B);if((C+=j)>b&&D.length===0&&D.push(f(L,B,(b-(C-j))/j)),C>=T)return D.push(f(L,B,(T-(C-j))/j)),D;C>b&&D.push(B)}return D},s.prototype.bufferPoint=function(b,T){var I=T/this.ky,C=T/this.kx;return[b[0]-C,b[1]-I,b[0]+C,b[1]+I]},s.prototype.bufferBBox=function(b,T){var I=T/this.ky,C=T/this.kx;return[b[0]-C,b[1]-I,b[2]+C,b[3]+I]},s.prototype.insideBBox=function(b,T){return y(b[0]-T[0])>=0&&y(b[0]-T[2])<=0&&b[1]>=T[1]&&b[1]<=T[3]},Object.defineProperties(s,l),s}();var rs=mi(Ic.exports),ku={exports:{}};ku.exports=function(){var t=function(i,o){if(i===void 0&&(i=[]),o===void 0&&(o=e),this.data=i,this.length=this.data.length,this.compare=o,this.length>0)for(var s=(this.length>>1)-1;s>=0;s--)this._down(s)};function e(i,o){return i<o?-1:i>o?1:0}return t.prototype.push=function(i){this.data.push(i),this.length++,this._up(this.length-1)},t.prototype.pop=function(){if(this.length!==0){var i=this.data[0],o=this.data.pop();return this.length--,this.length>0&&(this.data[0]=o,this._down(0)),i}},t.prototype.peek=function(){return this.data[0]},t.prototype._up=function(i){for(var o=this.data,s=this.compare,l=o[i];i>0;){var h=i-1>>1,f=o[h];if(s(l,f)>=0)break;o[i]=f,i=h}o[i]=l},t.prototype._down=function(i){for(var o=this.data,s=this.compare,l=this.length>>1,h=o[i];i<l;){var f=1+(i<<1),y=o[f],b=f+1;if(b<this.length&&s(o[b],y)<0&&(f=b,y=o[b]),s(y,h)>=0)break;o[i]=y,i=f}o[i]=h},t}();var Po=mi(ku.exports),st=8192;function zd(t,e){return e.dist-t.dist}let Iu=100,Sc=50;function Su(t){let e=[1/0,1/0,-1/0,-1/0];if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}function os(t){return t[1]-t[0]+1}function Yo(t,e){let i=t[1]>=t[0]&&t[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function Cu(t,e){if(t[0]>t[1])return[null,null];let i=os(t);if(e){if(i===2)return[t,null];let o=Math.floor(i/2);return[[t[0],t[0]+o],[t[0]+o,t[1]]]}{if(i===1)return[t,null];let o=Math.floor(i/2)-1;return[[t[0],t[0]+o],[t[0]+o+1,t[1]]]}}function Gs(t,e){let i=[1/0,1/0,-1/0,-1/0];if(!Yo(e,t.length))return i;for(let o=e[0];o<=e[1];++o)ts(i,t[o]);return i}function Od(t){let e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<t.length;++i)for(let o=0;o<t[i].length;++o)ts(e,t[i][o]);return e}function $s(t,e,i){if(Su(t)||Su(e))return NaN;let o=0,s=0;return t[2]<e[0]&&(o=e[0]-t[2]),t[0]>e[2]&&(o=t[0]-e[2]),t[1]>e[3]&&(s=t[1]-e[3]),t[3]<e[1]&&(s=e[1]-t[3]),i.distance([0,0],[o,s])}function Mu(t){return 360*t-180}function g0(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function Cl(t,e){let i=Math.pow(2,e.z),o=(t.y/st+e.y)/i;return[Mu((t.x/st+e.x)/i),g0(o)]}function y0(t,e){let i=[];for(let o=0;o<t.length;++o)i.push(Cl(t[o],e));return i}function pf(t,e,i){let o=i.pointOnLine(e,t).point;return i.distance(t,o)}function ff(t,e,i,o,s){let l=i.slice(o[0],o[1]+1),h=1/0;for(let f=e[0];f<=e[1];++f)if((h=Math.min(h,pf(t[f],l,s)))===0)return 0;return h}function Eu(t,e,i,o,s){let l=Math.min(s.pointToSegmentDistance(t,i,o),s.pointToSegmentDistance(e,i,o)),h=Math.min(s.pointToSegmentDistance(i,t,e),s.pointToSegmentDistance(o,t,e));return Math.min(l,h)}function b0(t,e,i,o,s){if(!Yo(e,t.length)||!Yo(o,i.length))return NaN;let l=1/0;for(let h=e[0];h<e[1];++h)for(let f=o[0];f<o[1];++f){if(Da(t[h],t[h+1],i[f],i[f+1]))return 0;l=Math.min(l,Eu(t[h],t[h+1],i[f],i[f+1],s))}return l}function v0(t,e,i,o,s){if(!Yo(e,t.length)||!Yo(o,i.length))return NaN;let l=1/0;for(let h=e[0];h<=e[1];++h)for(let f=o[0];f<=o[1];++f)if((l=Math.min(l,s.distance(t[h],i[f])))===0)return l;return l}function x0(t,e,i){if(Il(t,e,!0))return 0;let o=1/0;for(let s of e){let l=s.length;if(l<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(s[0]!==s[l-1]&&(o=Math.min(o,i.pointToSegmentDistance(t,s[l-1],s[0])))===0||(o=Math.min(o,pf(t,s,i)))===0)return o}return o}function _f(t,e,i,o){if(!Yo(e,t.length))return NaN;for(let l=e[0];l<=e[1];++l)if(Il(t[l],i,!0))return 0;let s=1/0;for(let l=e[0];l<e[1];++l)for(let h of i)for(let f=0,y=h.length,b=y-1;f<y;b=f++){if(Da(t[l],t[l+1],h[b],h[f]))return 0;s=Math.min(s,Eu(t[l],t[l+1],h[b],h[f],o))}return s}function Cc(t,e){for(let i of t)for(let o=0;o<=i.length-1;++o)if(Il(i[o],e,!0))return!0;return!1}function w0(t,e,i,o=1/0){let s=Od(t),l=Od(e);if(o!==1/0&&$s(s,l,i)>=o)return o;if(is(s,l)){if(Cc(t,e))return 0}else if(Cc(e,t))return 0;let h=o;for(let f of t)for(let y=0,b=f.length,T=b-1;y<b;T=y++)for(let I of e)for(let C=0,D=I.length,R=D-1;C<D;R=C++){if(Da(f[T],f[y],I[R],I[C]))return 0;h=Math.min(h,Eu(f[T],f[y],I[R],I[C],i))}return h}function Fd(t,e,i,o,s,l,h){if(l===null||h===null)return;let f=$s(Gs(o,l),Gs(s,h),i);f<e&&t.push({dist:f,range1:l,range2:h})}function Au(t,e,i,o,s=1/0){let l=Math.min(o.distance(t[0],i[0][0]),s);if(l===0)return l;let h=new Po([{dist:0,range1:[0,t.length-1],range2:[0,0]}],zd),f=e?Sc:Iu,y=Od(i);for(;h.length;){let b=h.pop();if(b.dist>=l)continue;let T=b.range1;if(os(T)<=f){if(!Yo(T,t.length))return NaN;if(e){let I=_f(t,T,i,o);if((l=Math.min(l,I))===0)return l}else for(let I=T[0];I<=T[1];++I){let C=x0(t[I],i,o);if((l=Math.min(l,C))===0)return l}}else{let I=Cu(T,e);if(I[0]!==null){let C=$s(Gs(t,I[0]),y,o);C<l&&h.push({dist:C,range1:I[0],range2:[0,0]})}if(I[1]!==null){let C=$s(Gs(t,I[1]),y,o);C<l&&h.push({dist:C,range1:I[1],range2:[0,0]})}}}return l}function gf(t,e,i,o,s,l=1/0){let h=Math.min(l,s.distance(t[0],i[0]));if(h===0)return h;let f=new Po([{dist:0,range1:[0,t.length-1],range2:[0,i.length-1]}],zd),y=e?Sc:Iu,b=o?Sc:Iu;for(;f.length;){let T=f.pop();if(T.dist>=h)continue;let I=T.range1,C=T.range2;if(os(I)<=y&&os(C)<=b){if(!Yo(I,t.length)||!Yo(C,i.length))return NaN;if(e&&o?h=Math.min(h,b0(t,I,i,C,s)):e||o?e&&!o?h=Math.min(h,ff(i,C,t,I,s)):!e&&o&&(h=Math.min(h,ff(t,I,i,C,s))):h=Math.min(h,v0(t,I,i,C,s)),h===0)return h}else{let D=Cu(I,e),R=Cu(C,o);Fd(f,h,s,t,i,D[0],R[0]),Fd(f,h,s,t,i,D[0],R[1]),Fd(f,h,s,t,i,D[1],R[0]),Fd(f,h,s,t,i,D[1],R[1])}}return h}function Du(t,e,i,o,s=1/0){let l=s,h=Gs(t,[0,t.length-1]);for(let f of i)if(!(l!==1/0&&$s(h,Gs(f,[0,f.length-1]),o)>=l)&&(l=Math.min(l,gf(t,e,f,!0,o,l)),l===0))return l;return l}function Bd(t,e,i,o,s=1/0){let l=s,h=Gs(t,[0,t.length-1]);for(let f of i){if(l!==1/0&&$s(h,Od(f),o)>=l)continue;let y=Au(t,e,f,o,l);if(isNaN(y))return y;if((l=Math.min(l,y))===0)return l}return l}function Pu(t){return t==="Point"||t==="MultiPoint"||t==="LineString"||t==="MultiLineString"||t==="Polygon"||t==="MultiPolygon"}class qs{constructor(e,i){this.type=ht,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(js(e[1])){let o=e[1];if(o.type==="FeatureCollection"){for(let s=0;s<o.features.length;++s)if(Pu(o.features[s].geometry.type))return new qs(o,o.features[s].geometry)}else if(o.type==="Feature"){if(Pu(o.geometry.type))return new qs(o,o.geometry)}else if(Pu(o.type))return new qs(o,o)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){let i=e.geometry(),o=e.canonicalID();if(i!=null&&o!=null){if(e.geometryType()==="Point")return function(s,l,h){let f=[];for(let b of s)for(let T of b)f.push(Cl(T,l));let y=new rs(f[0][1],"meters");return h.type==="Point"||h.type==="MultiPoint"||h.type==="LineString"?gf(f,!1,h.type==="Point"?[h.coordinates]:h.coordinates,h.type==="LineString",y):h.type==="MultiLineString"?Du(f,!1,h.coordinates,y):h.type==="Polygon"||h.type==="MultiPolygon"?Bd(f,!1,h.type==="Polygon"?[h.coordinates]:h.coordinates,y):null}(i,o,this.geometries);if(e.geometryType()==="LineString")return function(s,l,h){let f=[];for(let b of s){let T=[];for(let I of b)T.push(Cl(I,l));f.push(T)}let y=new rs(f[0][0][1],"meters");if(h.type==="Point"||h.type==="MultiPoint"||h.type==="LineString")return Du(h.type==="Point"?[h.coordinates]:h.coordinates,h.type==="LineString",f,y);if(h.type==="MultiLineString"){let b=1/0;for(let T=0;T<h.coordinates.length;T++){let I=Du(h.coordinates[T],!0,f,y,b);if(isNaN(I))return I;if((b=Math.min(b,I))===0)return b}return b}if(h.type==="Polygon"||h.type==="MultiPolygon"){let b=1/0;for(let T=0;T<f.length;T++){let I=Bd(f[T],!0,h.type==="Polygon"?[h.coordinates]:h.coordinates,y,b);if(isNaN(I))return I;if((b=Math.min(b,I))===0)return b}return b}return null}(i,o,this.geometries);if(e.geometryType()==="Polygon")return function(s,l,h){let f=[];for(let b of function(T,I){let C=T.length;if(C<=1)return[T];let D=[],R,L;for(let B=0;B<C;B++){let j=_0(T[B]);j!==0&&(T[B].area=Math.abs(j),L===void 0&&(L=j<0),L===j<0?(R&&D.push(R),R=[T[B]]):R.push(T[B]))}return R&&D.push(R),D}(s)){let T=[];for(let I=0;I<b.length;++I)T.push(y0(b[I],l));f.push(T)}let y=new rs(f[0][0][0][1],"meters");if(h.type==="Point"||h.type==="MultiPoint"||h.type==="LineString")return Bd(h.type==="Point"?[h.coordinates]:h.coordinates,h.type==="LineString",f,y);if(h.type==="MultiLineString"){let b=1/0;for(let T=0;T<h.coordinates.length;T++){let I=Bd(h.coordinates[T],!0,f,y,b);if(isNaN(I))return I;if((b=Math.min(b,I))===0)return b}return b}return h.type==="Polygon"||h.type==="MultiPolygon"?function(b,T,I){let C=1/0;for(let D of b)for(let R of T){let L=w0(D,R,I,C);if(isNaN(L))return L;if((C=Math.min(C,L))===0)return C}return C}(h.type==="Polygon"?[h.coordinates]:h.coordinates,f,y):null}(i,o,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}var Nd=qs;function Mc(t,e){switch(t){case"string":return Ao(e);case"number":return+e;case"boolean":return!!e;case"color":return Wn.parse(e);case"formatted":return kr.fromString(Ao(e));case"resolvedImage":return Lt.fromString(Ao(e))}return e}function Ru(t,e,i,o){return o!==void 0&&(t=o*Math.round(t/o)),e!==void 0&&t<e&&(t=e),i!==void 0&&t>i&&(t=i),t}class Ec{constructor(e,i,o){this.type=e,this.key=i,this.scope=o}static parse(e,i){let o=i.expectedType;if(o==null&&(o=Ti),e.length<2||e.length>3)return i.error("Invalid number of arguments for 'config' expression.");let s=i.parse(e[1],1);if(!(s instanceof Ma))return i.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){let l=i.parse(e[2],2);return l instanceof Ma?new Ec(o,Ao(s.value),Ao(l.value)):i.error("Scope of 'config' expression must be a string literal.")}return new Ec(o,Ao(s.value))}evaluate(e){let i=[this.key,this.scope,e.scope].filter(Boolean).join(""),o=e.getConfig(i);if(!o)return null;let{type:s,value:l,values:h,minValue:f,maxValue:y,stepValue:b}=o,T=o.default.evaluate(e),I=T;if(l){let C=e.scope;e.scope=(C||"").split("").slice(1).join(""),I=l.evaluate(e),e.scope=C}return s&&(I=Mc(s,I)),I===void 0||f===void 0&&y===void 0&&b===void 0||(typeof I=="number"?I=Ru(I,f,y,b):Array.isArray(I)&&(I=I.map(C=>typeof C=="number"?Ru(C,f,y,b):C))),l!==void 0&&I!==void 0&&h&&!h.includes(I)&&(I=T,s&&(I=Mc(s,I))),(s&&s!==this.type||I!==void 0&&Jn(I)!==this.type)&&(I=Mc(this.type.kind,I)),I}eachChild(){}outputDefined(){return!1}serialize(){let e=["config",this.key];return this.scope&&e.concat(this.key),e}}var Ml=Ec;function El(t){if(t instanceof gi&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof Ld||t instanceof Nd)return!1;let e=!0;return t.eachChild(i=>{e&&!El(i)&&(e=!1)}),e}function Ac(t){if(t instanceof gi&&t.name==="feature-state")return!1;let e=!0;return t.eachChild(i=>{e&&!Ac(i)&&(e=!1)}),e}function Dc(t){if(t instanceof Ml)return!1;let e=!0;return t.eachChild(i=>{e&&!Dc(i)&&(e=!1)}),e}function Ir(t,e){if(t instanceof gi&&e.indexOf(t.name)>=0)return!1;let i=!0;return t.eachChild(o=>{i&&!Ir(o,e)&&(i=!1)}),i}class as{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");let o=e[1];return i.scope.has(o)?new as(o,i.scope.get(o)):i.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Wr=as;class Lu{constructor(e,i=[],o,s=new p0,l=[],h,f){this.registry=e,this.path=i,this.key=i.map(y=>`[${y}]`).join(""),this.scope=s,this.errors=l,this.expectedType=o,this._scope=h,this.options=f}parse(e,i,o,s,l={}){return i||o?this.concat(i,o,s)._parse(e,l):this._parse(e,l)}_parse(e,i){function o(s,l,h){return h==="assert"?new Ea(l,[s]):h==="coerce"?new Aa(l,[s]):s}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let s=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(s){let l=s.parse(e,this);if(!l)return null;if(this.expectedType){let h=this.expectedType,f=l.type;if(h.kind!=="string"&&h.kind!=="number"&&h.kind!=="boolean"&&h.kind!=="object"&&h.kind!=="array"||f.kind!=="value")if(h.kind!=="color"&&h.kind!=="formatted"&&h.kind!=="resolvedImage"||f.kind!=="value"&&f.kind!=="string"){if(this.checkSubtype(h,f))return null}else l=o(l,h,i.typeAnnotation||"coerce");else l=o(l,h,i.typeAnnotation||"assert")}if(!(l instanceof Ma)&&l.type.kind!=="resolvedImage"&&zu(l)){let h=new hf(this._scope,this.options);try{l=new Ma(l.type,l.evaluate(h))}catch(f){return this.error(f.message),null}}return l}return Aa.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,o){let s=typeof e=="number"?this.path.concat(e):this.path,l=o?this.scope.concat(o):this.scope;return new Lu(this.registry,s,i||null,l,this.errors,this._scope,this.options)}error(e,...i){let o=`${this.key}${i.map(s=>`[${s}]`).join("")}`;this.errors.push(new fa(o,e))}checkSubtype(e,i){let o=Ns(e,i);return o&&this.error(o),o}}var yf=Lu;function zu(t){if(t instanceof Wr)return zu(t.boundExpression);if(t instanceof gi&&t.name==="error"||t instanceof Tc||t instanceof Ld||t instanceof Nd||t instanceof Ml)return!1;let e=t instanceof Aa||t instanceof Ea,i=!0;return t.eachChild(o=>{i=e?i&&zu(o):i&&o instanceof Ma}),!!i&&El(t)&&Ir(t,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Hs(t,e){let i=t.length-1,o,s,l=0,h=i,f=0;for(;l<=h;)if(f=Math.floor((l+h)/2),o=t[f],s=t[f+1],o<=e){if(f===i||e<s)return f;l=f+1}else{if(!(o>e))throw new er("Input is not a number.");h=f-1}return 0}class jd{constructor(e,i,o){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(let[s,l]of o)this.labels.push(s),this.outputs.push(l)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");let o=i.parse(e[1],1,ht);if(!o)return null;let s=[],l=null;i.expectedType&&i.expectedType.kind!=="value"&&(l=i.expectedType);for(let h=1;h<e.length;h+=2){let f=h===1?-1/0:e[h],y=e[h+1],b=h,T=h+1;if(typeof f!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',b);if(s.length&&s[s.length-1][0]>=f)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',b);let I=i.parse(y,T,l);if(!I)return null;l=l||I.type,s.push([f,I])}return new jd(l,o,s)}evaluate(e){let i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(e);let s=this.input.evaluate(e);if(s<=i[0])return o[0].evaluate(e);let l=i.length;return s>=i[l-1]?o[l-1].evaluate(e):o[Hs(i,s)].evaluate(e)}eachChild(e){e(this.input);for(let i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}var Pc=jd;let bf=.95047,ss=1.08883,vf=4/29,Al=6/29,Ou=3*Al*Al,xf=Al*Al*Al,T0=Math.PI/180,Ko=180/Math.PI;function Vd(t){return t>xf?Math.pow(t,1/3):t/Ou+vf}function Ud(t){return t>Al?t*t*t:Ou*(t-vf)}function Gd(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function $d(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Fu(t){let e=$d(t.r),i=$d(t.g),o=$d(t.b),s=Vd((.4124564*e+.3575761*i+.1804375*o)/bf),l=Vd((.2126729*e+.7151522*i+.072175*o)/1);return{l:116*l-16,a:500*(s-l),b:200*(l-Vd((.0193339*e+.119192*i+.9503041*o)/ss)),alpha:t.a}}function Bu(t){let e=(t.l+16)/116,i=isNaN(t.a)?e:e+t.a/500,o=isNaN(t.b)?e:e-t.b/200;return e=1*Ud(e),i=bf*Ud(i),o=ss*Ud(o),new Wn(Gd(3.2404542*i-1.5371385*e-.4985314*o),Gd(-.969266*i+1.8760108*e+.041556*o),Gd(.0556434*i-.2040259*e+1.0572252*o),t.alpha)}function wf(t,e,i){let o=e-t;return t+i*(o>180||o<-180?o-360*Math.round(o/360):o)}let Dl={forward:Fu,reverse:Bu,interpolate:function(t,e,i){return{l:fi(t.l,e.l,i),a:fi(t.a,e.a,i),b:fi(t.b,e.b,i),alpha:fi(t.alpha,e.alpha,i)}}},Pl={forward:function(t){let{l:e,a:i,b:o}=Fu(t),s=Math.atan2(o,i)*Ko;return{h:s<0?s+360:s,c:Math.sqrt(i*i+o*o),l:e,alpha:t.a}},reverse:function(t){let e=t.h*T0,i=t.c;return Bu({l:t.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:t.alpha})},interpolate:function(t,e,i){return{h:wf(t.h,e.h,i),c:fi(t.c,e.c,i),l:fi(t.l,e.l,i),alpha:fi(t.alpha,e.alpha,i)}}};var Nu=Object.freeze({__proto__:null,hcl:Pl,lab:Dl});class Rc{constructor(e,i,o,s,l){this.type=e,this.operator=i,this.interpolation=o,this.input=s,this.labels=[],this.outputs=[];for(let[h,f]of l)this.labels.push(h),this.outputs.push(f)}static interpolationFactor(e,i,o,s){let l=0;if(e.name==="exponential")l=Rl(i,e.base,o,s);else if(e.name==="linear")l=Rl(i,1,o,s);else if(e.name==="cubic-bezier"){let h=e.controlPoints;l=new qr(h[0],h[1],h[2],h[3]).solve(Rl(i,1,o,s))}return l}static parse(e,i){let[o,s,l,...h]=e;if(!Array.isArray(s)||s.length===0)return i.error("Expected an interpolation type expression.",1);if(s[0]==="linear")s={name:"linear"};else if(s[0]==="exponential"){let b=s[1];if(typeof b!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);s={name:"exponential",base:b}}else{if(s[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(s[0])}`,1,0);{let b=s.slice(1);if(b.length!==4||b.some(T=>typeof T!="number"||T<0||T>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);s={name:"cubic-bezier",controlPoints:b}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(l=i.parse(l,2,ht),!l)return null;let f=[],y=null;o==="interpolate-hcl"||o==="interpolate-lab"?y=Eo:i.expectedType&&i.expectedType.kind!=="value"&&(y=i.expectedType);for(let b=0;b<h.length;b+=2){let T=h[b],I=h[b+1],C=b+3,D=b+4;if(typeof T!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',C);if(f.length&&f[f.length-1][0]>=T)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',C);let R=i.parse(I,D,y);if(!R)return null;y=y||R.type,f.push([T,R])}return y.kind==="number"||y.kind==="color"||y.kind==="array"&&y.itemType.kind==="number"&&typeof y.N=="number"?new Rc(y,o,s,l,f):i.error(`Type ${$n(y)} is not interpolatable.`)}evaluate(e){let i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(e);let s=this.input.evaluate(e);if(s<=i[0])return o[0].evaluate(e);let l=i.length;if(s>=i[l-1])return o[l-1].evaluate(e);let h=Hs(i,s),f=Rc.interpolationFactor(this.interpolation,s,i[h],i[h+1]),y=o[h].evaluate(e),b=o[h+1].evaluate(e);return this.operator==="interpolate"?Ad[this.type.kind.toLowerCase()](y,b,f):this.operator==="interpolate-hcl"?Pl.reverse(Pl.interpolate(Pl.forward(y),Pl.forward(b),f)):Dl.reverse(Dl.interpolate(Dl.forward(y),Dl.forward(b),f))}eachChild(e){e(this.input);for(let i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);let i=[this.operator,e,this.input.serialize()];for(let o=0;o<this.labels.length;o++)i.push(this.labels[o],this.outputs[o].serialize());return i}}function Rl(t,e,i,o){let s=o-i,l=t-i;return s===0?0:e===1?l/s:(Math.pow(e,l)-1)/(Math.pow(e,s)-1)}var yo=Rc;class Ll{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let o=null,s=i.expectedType;s&&s.kind!=="value"&&(o=s);let l=[];for(let f of e.slice(1)){let y=i.parse(f,1+l.length,o,void 0,{typeAnnotation:"omit"});if(!y)return null;o=o||y.type,l.push(y)}let h=s&&l.some(f=>Ns(s,f.type));return new Ll(h?Ti:o,l)}evaluate(e){let i,o=null,s=0;for(let l of this.args){if(s++,o=l.evaluate(e),o&&o instanceof Lt&&!o.available&&(i||(i=o),o=null,s===this.args.length))return i;if(o!==null)break}return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var ju=Ll;class qd{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(let i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);let o=[];for(let l=1;l<e.length-1;l+=2){let h=e[l];if(typeof h!="string")return i.error(`Expected string, but found ${typeof h} instead.`,l);if(/[^a-zA-Z0-9_]/.test(h))return i.error("Variable names must contain only alphanumeric characters or '_'.",l);let f=i.parse(e[l+1],l+1);if(!f)return null;o.push([h,f])}let s=i.parse(e[e.length-1],e.length-1,i.expectedType,o);return s?new qd(o,s):null}outputDefined(){return this.result.outputDefined()}serialize(){let e=["let"];for(let[i,o]of this.bindings)e.push(i,o.serialize());return e.push(this.result.serialize()),e}}var Vu=qd;class ls{constructor(e,i,o){this.type=e,this.index=i,this.input=o}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let o=i.parse(e[1],1,ht),s=i.parse(e[2],2,no(i.expectedType||Ti));return o&&s?new ls(s.type.itemType,o,s):null}evaluate(e){let i=this.index.evaluate(e),o=this.input.evaluate(e);if(i<0)throw new er(`Array index out of bounds: ${i} < 0.`);if(i>=o.length)throw new er(`Array index out of bounds: ${i} > ${o.length-1}.`);if(i!==Math.floor(i))throw new er(`Array index must be an integer, but found ${i} instead.`);return o[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var ki=ls;class Uu{constructor(e,i){this.type=zi,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let o=i.parse(e[1],1,Ti),s=i.parse(e[2],2,Ti);return o&&s?jt(o.type,[zi,Li,ht,bl,Ti])?new Uu(o,s):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${$n(o.type)} instead`):null}evaluate(e){let i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(o==null)return!1;if(!Ja(i,["boolean","string","number","null"]))throw new er(`Expected first argument to be of type boolean, string, number or null, but found ${$n(Jn(i))} instead.`);if(!Ja(o,["string","array"]))throw new er(`Expected second argument to be of type array or string, but found ${$n(Jn(o))} instead.`);return o.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var k0=Uu;class Hd{constructor(e,i,o){this.type=ht,this.needle=e,this.haystack=i,this.fromIndex=o}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let o=i.parse(e[1],1,Ti),s=i.parse(e[2],2,Ti);if(!o||!s)return null;if(!jt(o.type,[zi,Li,ht,bl,Ti]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${$n(o.type)} instead`);if(e.length===4){let l=i.parse(e[3],3,ht);return l?new Hd(o,s,l):null}return new Hd(o,s)}evaluate(e){let i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!Ja(i,["boolean","string","number","null"]))throw new er(`Expected first argument to be of type boolean, string, number or null, but found ${$n(Jn(i))} instead.`);if(!Ja(o,["string","array"]))throw new er(`Expected second argument to be of type array or string, but found ${$n(Jn(o))} instead.`);if(this.fromIndex){let s=this.fromIndex.evaluate(e);return o.indexOf(i,s)}return o.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){let e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Tf=Hd;class Gu{constructor(e,i,o,s,l,h){this.inputType=e,this.type=i,this.input=o,this.cases=s,this.outputs=l,this.otherwise=h}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let o,s;i.expectedType&&i.expectedType.kind!=="value"&&(s=i.expectedType);let l={},h=[];for(let b=2;b<e.length-1;b+=2){let T=e[b],I=e[b+1];Array.isArray(T)||(T=[T]);let C=i.concat(b);if(T.length===0)return C.error("Expected at least one branch label.");for(let R of T){if(typeof R!="number"&&typeof R!="string")return C.error("Branch labels must be numbers or strings.");if(typeof R=="number"&&Math.abs(R)>Number.MAX_SAFE_INTEGER)return C.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof R=="number"&&Math.floor(R)!==R)return C.error("Numeric branch labels must be integer values.");if(o){if(C.checkSubtype(o,Jn(R)))return null}else o=Jn(R);if(l[String(R)]!==void 0)return C.error("Branch labels must be unique.");l[String(R)]=h.length}let D=i.parse(I,b,s);if(!D)return null;s=s||D.type,h.push(D)}let f=i.parse(e[1],1,Ti);if(!f)return null;let y=i.parse(e[e.length-1],e.length-1,s);return y?f.type.kind!=="value"&&i.concat(1).checkSubtype(o,f.type)?null:new Gu(o,s,f,l,h,y):null}evaluate(e){let i=this.input.evaluate(e);return(Jn(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),o=[],s={};for(let h of i){let f=s[this.cases[h]];f===void 0?(s[this.cases[h]]=o.length,o.push([this.cases[h],[h]])):o[f][1].push(h)}let l=h=>this.inputType.kind==="number"?Number(h):h;for(let[h,f]of o)e.push(f.length===1?l(f[0]):f.map(l)),e.push(this.outputs[h].serialize());return e.push(this.otherwise.serialize()),e}}var kf=Gu;class Zd{constructor(e,i,o){this.type=e,this.branches=i,this.otherwise=o}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let o;i.expectedType&&i.expectedType.kind!=="value"&&(o=i.expectedType);let s=[];for(let h=1;h<e.length-1;h+=2){let f=i.parse(e[h],h,zi);if(!f)return null;let y=i.parse(e[h+1],h+1,o);if(!y)return null;s.push([f,y]),o=o||y.type}let l=i.parse(e[e.length-1],e.length-1,o);return l?new Zd(o,s,l):null}evaluate(e){for(let[i,o]of this.branches)if(i.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(let[i,o]of this.branches)e(i),e(o);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var If=Zd;class Lc{constructor(e,i,o,s){this.type=e,this.input=i,this.beginIndex=o,this.endIndex=s}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let o=i.parse(e[1],1,Ti),s=i.parse(e[2],2,ht);if(!o||!s)return null;if(!jt(o.type,[no(Ti),Li,Ti]))return i.error(`Expected first argument to be of type array or string, but found ${$n(o.type)} instead`);if(e.length===4){let l=i.parse(e[3],3,ht);return l?new Lc(o.type,o,s,l):null}return new Lc(o.type,o,s)}evaluate(e){let i=this.input.evaluate(e),o=this.beginIndex.evaluate(e);if(!Ja(i,["string","array"]))throw new er(`Expected first argument to be of type array or string, but found ${$n(Jn(i))} instead.`);if(this.endIndex){let s=this.endIndex.evaluate(e);return i.slice(o,s)}return i.slice(o)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){let e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var zl=Lc;function $u(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function qu(t,e,i,o){return o.compare(e,i)===0}function Ol(t,e,i){let o=t!=="=="&&t!=="!=";return class SS{constructor(l,h,f){this.type=zi,this.lhs=l,this.rhs=h,this.collator=f,this.hasUntypedArgument=l.type.kind==="value"||h.type.kind==="value"}static parse(l,h){if(l.length!==3&&l.length!==4)return h.error("Expected two or three arguments.");let f=l[0],y=h.parse(l[1],1,Ti);if(!y)return null;if(!$u(f,y.type))return h.concat(1).error(`"${f}" comparisons are not supported for type '${$n(y.type)}'.`);let b=h.parse(l[2],2,Ti);if(!b)return null;if(!$u(f,b.type))return h.concat(2).error(`"${f}" comparisons are not supported for type '${$n(b.type)}'.`);if(y.type.kind!==b.type.kind&&y.type.kind!=="value"&&b.type.kind!=="value")return h.error(`Cannot compare types '${$n(y.type)}' and '${$n(b.type)}'.`);o&&(y.type.kind==="value"&&b.type.kind!=="value"?y=new Ea(b.type,[y]):y.type.kind!=="value"&&b.type.kind==="value"&&(b=new Ea(y.type,[b])));let T=null;if(l.length===4){if(y.type.kind!=="string"&&b.type.kind!=="string"&&y.type.kind!=="value"&&b.type.kind!=="value")return h.error("Cannot use collator to compare non-string types.");if(T=h.parse(l[3],3,Dd),!T)return null}return new SS(y,b,T)}evaluate(l){let h=this.lhs.evaluate(l),f=this.rhs.evaluate(l);if(o&&this.hasUntypedArgument){let y=Jn(h),b=Jn(f);if(y.kind!==b.kind||y.kind!=="string"&&y.kind!=="number")throw new er(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${y.kind}, ${b.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){let y=Jn(h),b=Jn(f);if(y.kind!=="string"||b.kind!=="string")return e(l,h,f)}return this.collator?i(l,h,f,this.collator.evaluate(l)):e(l,h,f)}eachChild(l){l(this.lhs),l(this.rhs),this.collator&&l(this.collator)}outputDefined(){return!0}serialize(){let l=[t];return this.eachChild(h=>{l.push(h.serialize())}),l}}}let Hu=Ol("==",function(t,e,i){return e===i},qu),Zu=Ol("!=",function(t,e,i){return e!==i},function(t,e,i,o){return!qu(0,e,i,o)}),I0=Ol("<",function(t,e,i){return e<i},function(t,e,i,o){return o.compare(e,i)<0}),S0=Ol(">",function(t,e,i){return e>i},function(t,e,i,o){return o.compare(e,i)>0}),Sf=Ol("<=",function(t,e,i){return e<=i},function(t,e,i,o){return o.compare(e,i)<=0}),C0=Ol(">=",function(t,e,i){return e>=i},function(t,e,i,o){return o.compare(e,i)>=0});class Wu{constructor(e,i,o,s,l,h){this.type=Li,this.number=e,this.locale=i,this.currency=o,this.unit=s,this.minFractionDigits=l,this.maxFractionDigits=h}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");let o=i.parse(e[1],1,ht);if(!o)return null;let s=e[2];if(typeof s!="object"||Array.isArray(s))return i.error("NumberFormat options argument must be an object.");let l=null;if(s.locale&&(l=i.parse(s.locale,1,Li),!l))return null;let h=null;if(s.currency&&(h=i.parse(s.currency,1,Li),!h))return null;let f=null;if(s.unit&&(f=i.parse(s.unit,1,Li),!f))return null;let y=null;if(s["min-fraction-digits"]&&(y=i.parse(s["min-fraction-digits"],1,ht),!y))return null;let b=null;return s["max-fraction-digits"]&&(b=i.parse(s["max-fraction-digits"],1,ht),!b)?null:new Wu(o,l,h,f,y,b)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){let e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Xu{constructor(e){this.type=ht,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);let o=i.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${$n(o.type)} instead.`):new Xu(o):null}evaluate(e){let i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new er(`Expected value to be of type string or array, but found ${$n(Jn(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){let e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}function Cf(t){return function(){t=1831565813+(t|=0)|0;let e=Math.imul(t^t>>>15,1|t);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}let Yu={"==":Hu,"!=":Zu,">":S0,"<":I0,">=":C0,"<=":Sf,array:Ea,at:ki,boolean:Ea,case:If,coalesce:ju,collator:Tc,format:Tl,image:Vs,in:k0,"index-of":Tf,interpolate:yo,"interpolate-hcl":yo,"interpolate-lab":yo,length:Xu,let:Vu,literal:Ma,match:kf,number:Ea,"number-format":Wu,object:Ea,slice:zl,step:Pc,string:Ea,"to-boolean":Aa,"to-color":Aa,"to-number":Aa,"to-string":Aa,var:Wr,within:Ld,distance:Nd,config:Ml};function Ku(t,[e,i,o,s]){e=e.evaluate(t),i=i.evaluate(t),o=o.evaluate(t);let l=s?s.evaluate(t):1,h=df(e,i,o,l);if(h)throw new er(h);return new Wn(e/255*l,i/255*l,o/255*l,l)}function Mf(t,[e,i,o,s]){e=e.evaluate(t),i=i.evaluate(t),o=o.evaluate(t);let l=s?s.evaluate(t):1,h=function(b,T,I,C){return typeof b=="number"&&b>=0&&b<=360?typeof T=="number"&&T>=0&&T<=100&&typeof I=="number"&&I>=0&&I<=100?C===void 0||typeof C=="number"&&C>=0&&C<=1?null:`Invalid hsla value [${[b,T,I,C].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof C=="number"?[b,T,I,C]:[b,T,I]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof C=="number"?[b,T,I,C]:[b,T,I]).join(", ")}]: 'h' must be between 0 and 360.`}(e,i,o,l);if(h)throw new er(h);let f=`hsla(${e}, ${i}%, ${o}%, ${l})`,y=Wn.parse(f);if(!y)throw new er(`Failed to parse HSLA color: ${f}`);return y}function Qu(t,e){return t in e}function Ju(t,e){let i=e[t];return i===void 0?null:i}function Zs(t){return{type:t}}gi.register(Yu,{error:[{kind:"error"},[Li],(t,[e])=>{throw new er(e.evaluate(t))}],typeof:[Li,[Ti],(t,[e])=>$n(Jn(e.evaluate(t)))],"to-rgba":[no(ht,4),[Eo],(t,[e])=>e.evaluate(t).toArray()],rgb:[Eo,[ht,ht,ht],Ku],rgba:[Eo,[ht,ht,ht,ht],Ku],hsl:[Eo,[ht,ht,ht],Mf],hsla:[Eo,[ht,ht,ht,ht],Mf],has:{type:zi,overloads:[[[Li],(t,[e])=>Qu(e.evaluate(t),t.properties())],[[Li,vl],(t,[e,i])=>Qu(e.evaluate(t),i.evaluate(t))]]},get:{type:Ti,overloads:[[[Li],(t,[e])=>Ju(e.evaluate(t),t.properties())],[[Li,vl],(t,[e,i])=>Ju(e.evaluate(t),i.evaluate(t))]]},"feature-state":[Ti,[Li],(t,[e])=>Ju(e.evaluate(t),t.featureState||{})],properties:[vl,[],t=>t.properties()],"geometry-type":[Li,[],t=>t.geometryType()],id:[Ti,[],t=>t.id()],zoom:[ht,[],t=>t.globals.zoom],pitch:[ht,[],t=>t.globals.pitch||0],"distance-from-center":[ht,[],t=>t.distanceFromCenter()],"measure-light":[ht,[Li],(t,[e])=>t.measureLight(e.evaluate(t))],"heatmap-density":[ht,[],t=>t.globals.heatmapDensity||0],"line-progress":[ht,[],t=>t.globals.lineProgress||0],"raster-value":[ht,[],t=>t.globals.rasterValue||0],"raster-particle-speed":[ht,[],t=>t.globals.rasterParticleSpeed||0],"sky-radial-progress":[ht,[],t=>t.globals.skyRadialProgress||0],accumulated:[Ti,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[ht,Zs(ht),(t,e)=>{let i=0;for(let o of e)i+=o.evaluate(t);return i}],"*":[ht,Zs(ht),(t,e)=>{let i=1;for(let o of e)i*=o.evaluate(t);return i}],"-":{type:ht,overloads:[[[ht,ht],(t,[e,i])=>e.evaluate(t)-i.evaluate(t)],[[ht],(t,[e])=>-e.evaluate(t)]]},"/":[ht,[ht,ht],(t,[e,i])=>e.evaluate(t)/i.evaluate(t)],"%":[ht,[ht,ht],(t,[e,i])=>e.evaluate(t)%i.evaluate(t)],ln2:[ht,[],()=>Math.LN2],pi:[ht,[],()=>Math.PI],e:[ht,[],()=>Math.E],"^":[ht,[ht,ht],(t,[e,i])=>Math.pow(e.evaluate(t),i.evaluate(t))],sqrt:[ht,[ht],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[ht,[ht],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[ht,[ht],(t,[e])=>Math.log(e.evaluate(t))],log2:[ht,[ht],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[ht,[ht],(t,[e])=>Math.sin(e.evaluate(t))],cos:[ht,[ht],(t,[e])=>Math.cos(e.evaluate(t))],tan:[ht,[ht],(t,[e])=>Math.tan(e.evaluate(t))],asin:[ht,[ht],(t,[e])=>Math.asin(e.evaluate(t))],acos:[ht,[ht],(t,[e])=>Math.acos(e.evaluate(t))],atan:[ht,[ht],(t,[e])=>Math.atan(e.evaluate(t))],min:[ht,Zs(ht),(t,e)=>Math.min(...e.map(i=>i.evaluate(t)))],max:[ht,Zs(ht),(t,e)=>Math.max(...e.map(i=>i.evaluate(t)))],abs:[ht,[ht],(t,[e])=>Math.abs(e.evaluate(t))],round:[ht,[ht],(t,[e])=>{let i=e.evaluate(t);return i<0?-Math.round(-i):Math.round(i)}],floor:[ht,[ht],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[ht,[ht],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[zi,[Li,Ti],(t,[e,i])=>t.properties()[e.value]===i.value],"filter-id-==":[zi,[Ti],(t,[e])=>t.id()===e.value],"filter-type-==":[zi,[Li],(t,[e])=>t.geometryType()===e.value],"filter-<":[zi,[Li,Ti],(t,[e,i])=>{let o=t.properties()[e.value],s=i.value;return typeof o==typeof s&&o<s}],"filter-id-<":[zi,[Ti],(t,[e])=>{let i=t.id(),o=e.value;return typeof i==typeof o&&i<o}],"filter->":[zi,[Li,Ti],(t,[e,i])=>{let o=t.properties()[e.value],s=i.value;return typeof o==typeof s&&o>s}],"filter-id->":[zi,[Ti],(t,[e])=>{let i=t.id(),o=e.value;return typeof i==typeof o&&i>o}],"filter-<=":[zi,[Li,Ti],(t,[e,i])=>{let o=t.properties()[e.value],s=i.value;return typeof o==typeof s&&o<=s}],"filter-id-<=":[zi,[Ti],(t,[e])=>{let i=t.id(),o=e.value;return typeof i==typeof o&&i<=o}],"filter->=":[zi,[Li,Ti],(t,[e,i])=>{let o=t.properties()[e.value],s=i.value;return typeof o==typeof s&&o>=s}],"filter-id->=":[zi,[Ti],(t,[e])=>{let i=t.id(),o=e.value;return typeof i==typeof o&&i>=o}],"filter-has":[zi,[Ti],(t,[e])=>e.value in t.properties()],"filter-has-id":[zi,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[zi,[no(Li)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[zi,[no(Ti)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[zi,[Li,no(Ti)],(t,[e,i])=>i.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[zi,[Li,no(Ti)],(t,[e,i])=>function(o,s,l,h){for(;l<=h;){let f=l+h>>1;if(s[f]===o)return!0;s[f]>o?h=f-1:l=f+1}return!1}(t.properties()[e.value],i.value,0,i.value.length-1)],all:{type:zi,overloads:[[[zi,zi],(t,[e,i])=>e.evaluate(t)&&i.evaluate(t)],[Zs(zi),(t,e)=>{for(let i of e)if(!i.evaluate(t))return!1;return!0}]]},any:{type:zi,overloads:[[[zi,zi],(t,[e,i])=>e.evaluate(t)||i.evaluate(t)],[Zs(zi),(t,e)=>{for(let i of e)if(i.evaluate(t))return!0;return!1}]]},"!":[zi,[zi],(t,[e])=>!e.evaluate(t)],"is-supported-script":[zi,[Li],(t,[e])=>{let i=t.globals&&t.globals.isSupportedScript;return!i||i(e.evaluate(t))}],upcase:[Li,[Li],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[Li,[Li],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[Li,Zs(Ti),(t,e)=>e.map(i=>Ao(i.evaluate(t))).join("")],"resolved-locale":[Li,[Dd],(t,[e])=>e.evaluate(t).resolvedLocale()],random:[ht,[ht,ht,Ti],(t,e)=>{let[i,o,s]=e.map(h=>h.evaluate(t));if(i>o||i===o)return i;let l;if(typeof s=="string")l=function(h){let f=0;if(h.length===0)return f;for(let y=0;y<h.length;y++)f=(f<<5)-f+h.charCodeAt(y),f|=0;return f}(s);else{if(typeof s!="number")throw new er(`Invalid seed input: ${s}`);l=s}return i+Cf(l)()*(o-i)}]});var Fl=Yu;function em(t){return{result:"success",value:t}}function Ws(t){return{result:"error",value:t}}function Ef(t,e){return!!t&&!!t.parameters&&t.parameters.indexOf(e)>-1}function Wd(t){return t["property-type"]==="data-driven"}function tm(t){return Ef(t.expression,"measure-light")}function Af(t){return Ef(t.expression,"zoom")}function im(t){return!!t.expression&&t.expression.interpolated}function Xd(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function Df(t){return t}function nm(t,e){let i=e.type==="color",o=t.stops&&typeof t.stops[0][0]=="object",s=o||!(o||t.property!==void 0),l=t.type||(im(e)?"exponential":"interval");if(i&&((t=hu({},t)).stops&&(t.stops=t.stops.map(b=>[b[0],Wn.parse(b[1])])),t.default=Wn.parse(t.default?t.default:e.default)),t.colorSpace&&t.colorSpace!=="rgb"&&!Nu[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let h,f,y;if(l==="exponential")h=Pf;else if(l==="interval")h=E0;else if(l==="categorical"){h=M0,f=Object.create(null);for(let b of t.stops)f[b[0]]=b[1];y=typeof t.stops[0][0]}else{if(l!=="identity")throw new Error(`Unknown function type "${l}"`);h=Rf}if(o){let b={},T=[];for(let D=0;D<t.stops.length;D++){let R=t.stops[D],L=R[0].zoom;b[L]===void 0&&(b[L]={zoom:L,type:t.type,property:t.property,default:t.default,stops:[]},T.push(L)),b[L].stops.push([R[0].value,R[1]])}let I=[];for(let D of T)I.push([b[D].zoom,nm(b[D],e)]);let C={name:"linear"};return{kind:"composite",interpolationType:C,interpolationFactor:yo.interpolationFactor.bind(void 0,C),zoomStops:I.map(D=>D[0]),evaluate:({zoom:D},R)=>Pf({stops:I,base:t.base},e,D).evaluate(D,R)}}if(s){let b=l==="exponential"?{name:"exponential",base:t.base!==void 0?t.base:1}:null;return{kind:"camera",interpolationType:b,interpolationFactor:yo.interpolationFactor.bind(void 0,b),zoomStops:t.stops.map(T=>T[0]),evaluate:({zoom:T})=>h(t,e,T,f,y)}}return{kind:"source",evaluate(b,T){let I=T&&T.properties?T.properties[t.property]:void 0;return I===void 0?zc(t.default,e.default):h(t,e,I,f,y)}}}function zc(t,e,i){return t!==void 0?t:e!==void 0?e:i!==void 0?i:void 0}function M0(t,e,i,o,s){return zc(typeof i===s?o[i]:void 0,t.default,e.default)}function E0(t,e,i){if(kl(i)!=="number")return zc(t.default,e.default);let o=t.stops.length;if(o===1||i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[o-1][0])return t.stops[o-1][1];let s=Hs(t.stops.map(l=>l[0]),i);return t.stops[s][1]}function Pf(t,e,i){let o=t.base!==void 0?t.base:1;if(kl(i)!=="number")return zc(t.default,e.default);let s=t.stops.length;if(s===1||i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[s-1][0])return t.stops[s-1][1];let l=Hs(t.stops.map(T=>T[0]),i),h=function(T,I,C,D){let R=D-C,L=T-C;return R===0?0:I===1?L/R:(Math.pow(I,L)-1)/(Math.pow(I,R)-1)}(i,o,t.stops[l][0],t.stops[l+1][0]),f=t.stops[l][1],y=t.stops[l+1][1],b=Ad[e.type]||Df;if(t.colorSpace&&t.colorSpace!=="rgb"){let T=Nu[t.colorSpace];b=(I,C)=>T.reverse(T.interpolate(T.forward(I),T.forward(C),h))}return typeof f.evaluate=="function"?{evaluate(...T){let I=f.evaluate.apply(void 0,T),C=y.evaluate.apply(void 0,T);if(I!==void 0&&C!==void 0)return b(I,C,h)}}:b(f,y,h)}function Rf(t,e,i){return e.type==="color"?i=Wn.parse(i):e.type==="formatted"?i=kr.fromString(i.toString()):e.type==="resolvedImage"?i=Lt.fromString(i.toString()):kl(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),zc(i,t.default,e.default)}class Yd{constructor(e,i,o,s){this.expression=e,this._warningHistory={},this._evaluator=new hf(o,s),this._defaultValue=i?function(l){return l.type==="color"&&(Xd(l.default)||Array.isArray(l.default))?new Wn(0,0,0,0):l.type==="color"?Wn.parse(l.default)||null:l.default===void 0?null:l.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null}evaluateWithoutErrorHandling(e,i,o,s,l,h,f,y){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=o,this._evaluator.canonical=s||null,this._evaluator.availableImages=l||null,this._evaluator.formattedSection=h,this._evaluator.featureTileCoord=f||null,this._evaluator.featureDistanceData=y||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,o,s,l,h,f,y){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=o||null,this._evaluator.canonical=s||null,this._evaluator.availableImages=l||null,this._evaluator.formattedSection=h||null,this._evaluator.featureTileCoord=f||null,this._evaluator.featureDistanceData=y||null;try{let b=this.expression.evaluate(this._evaluator);if(b==null||typeof b=="number"&&b!=b)return this._defaultValue;if(this._enumValues&&!(b in this._enumValues))throw new er(`Expected value to be one of ${Object.keys(this._enumValues).map(T=>JSON.stringify(T)).join(", ")}, but found ${JSON.stringify(b)} instead.`);return b}catch(b){return this._warningHistory[b.message]||(this._warningHistory[b.message]=!0,typeof console<"u"&&console.warn(b.message)),this._defaultValue}}}function Oc(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in Fl}function Kd(t,e,i,o){let s=new yf(Fl,[],e?function(h){let f={color:Eo,string:Li,number:ht,enum:Li,boolean:zi,formatted:xl,resolvedImage:xc};return h.type==="array"?no(f[h.value]||Ti,h.length):f[h.type]}(e):void 0,void 0,void 0,i,o),l=s.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return l?em(new Yd(l,e,i,o)):Ws(s.errors)}class rm{constructor(e,i,o){this.kind=e,this._styleExpression=i,this.isLightConstant=o,this.isStateDependent=e!=="constant"&&!Ac(i.expression),this.isConfigDependent=!Dc(i.expression)}evaluateWithoutErrorHandling(e,i,o,s,l,h){return this._styleExpression.evaluateWithoutErrorHandling(e,i,o,s,l,h)}evaluate(e,i,o,s,l,h){return this._styleExpression.evaluate(e,i,o,s,l,h)}}class Fc{constructor(e,i,o,s,l){this.kind=e,this.zoomStops=o,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!Ac(i.expression),this.isLightConstant=l,this.isConfigDependent=!Dc(i.expression),this.interpolationType=s}evaluateWithoutErrorHandling(e,i,o,s,l,h){return this._styleExpression.evaluateWithoutErrorHandling(e,i,o,s,l,h)}evaluate(e,i,o,s,l,h){return this._styleExpression.evaluate(e,i,o,s,l,h)}interpolationFactor(e,i,o){return this.interpolationType?yo.interpolationFactor(this.interpolationType,e,i,o):0}}function Qd(t,e,i,o){if((t=Kd(t,e,i,o)).result==="error")return t;let s=t.value.expression,l=El(s);if(!l&&!Wd(e))return Ws([new fa("","data expressions not supported")]);let h=Ir(s,["zoom","pitch","distance-from-center"]);if(!h&&!Af(e))return Ws([new fa("","zoom expressions not supported")]);let f=Ir(s,["measure-light"]);if(!f&&!tm(e))return Ws([new fa("","measure-light expression not supported")]);let y=e.expression&&e.expression.relaxZoomRestriction,b=Nc(s);return b||h||y?b instanceof fa?Ws([b]):b instanceof yo&&!im(e)?Ws([new fa("",'"interpolate" expressions cannot be used with this property')]):em(b?new Fc(l?"camera":"composite",t.value,b.labels,b instanceof yo?b.interpolation:void 0,f):new rm(l?"constant":"source",t.value,f)):Ws([new fa("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Bc{constructor(e,i){this._parameters=e,this._specification=i,hu(this,nm(this._parameters,this._specification))}static deserialize(e){return new Bc(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Nc(t){let e=null;if(t instanceof Vu)e=Nc(t.result);else if(t instanceof ju){for(let i of t.args)if(e=Nc(i),e)break}else(t instanceof Pc||t instanceof yo)&&t.input instanceof gi&&t.input.name==="zoom"&&(e=t);return e instanceof fa||t.eachChild(i=>{let o=Nc(i);o instanceof fa?e=o:e&&o&&e!==o&&(e=new fa("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var A0=Jo,Qo=3;function Jo(t,e,i){var o=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var s=new Int32Array(this.arrayBuffer);t=s[0],this.d=(e=s[1])+2*(i=s[2]);for(var l=0;l<this.d*this.d;l++){var h=s[Qo+l],f=s[Qo+l+1];o.push(h===f?null:s.subarray(h,f))}var y=s[Qo+o.length+1];this.keys=s.subarray(s[Qo+o.length],y),this.bboxes=s.subarray(y),this.insert=this._insertReadonly}else{this.d=e+2*i;for(var b=0;b<this.d*this.d;b++)o.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=i,this.scale=e/t,this.uid=0;var T=i/e*t;this.min=-T,this.max=t+T}Jo.prototype.insert=function(t,e,i,o,s){this._forEachCell(e,i,o,s,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(o),this.bboxes.push(s)},Jo.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Jo.prototype._insertCell=function(t,e,i,o,s,l){this.cells[s].push(l)},Jo.prototype.query=function(t,e,i,o,s){var l=this.min,h=this.max;if(t<=l&&e<=l&&h<=i&&h<=o&&!s)return Array.prototype.slice.call(this.keys);var f=[];return this._forEachCell(t,e,i,o,this._queryCell,f,{},s),f},Jo.prototype._queryCell=function(t,e,i,o,s,l,h,f){var y=this.cells[s];if(y!==null)for(var b=this.keys,T=this.bboxes,I=0;I<y.length;I++){var C=y[I];if(h[C]===void 0){var D=4*C;(f?f(T[D+0],T[D+1],T[D+2],T[D+3]):t<=T[D+2]&&e<=T[D+3]&&i>=T[D+0]&&o>=T[D+1])?(h[C]=!0,l.push(b[C])):h[C]=!1}}},Jo.prototype._forEachCell=function(t,e,i,o,s,l,h,f){for(var y=this._convertToCellCoord(t),b=this._convertToCellCoord(e),T=this._convertToCellCoord(i),I=this._convertToCellCoord(o),C=y;C<=T;C++)for(var D=b;D<=I;D++){var R=this.d*D+C;if((!f||f(this._convertFromCellCoord(C),this._convertFromCellCoord(D),this._convertFromCellCoord(C+1),this._convertFromCellCoord(D+1)))&&s.call(this,t,e,i,o,R,l,h,f))return}},Jo.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},Jo.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},Jo.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=Qo+this.cells.length+1+1,i=0,o=0;o<this.cells.length;o++)i+=this.cells[o].length;var s=new Int32Array(e+i+this.keys.length+this.bboxes.length);s[0]=this.extent,s[1]=this.n,s[2]=this.padding;for(var l=e,h=0;h<t.length;h++){var f=t[h];s[Qo+h]=l,s.set(f,l),l+=f.length}return s[Qo+t.length]=l,s.set(this.keys,l),s[Qo+t.length+1]=l+=this.keys.length,s.set(this.bboxes,l),l+=this.bboxes.length,s.buffer};var Pa=mi(A0);let jc={};function mt(t,e,i={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),jc[e]={klass:t,omit:i.omit||[]}}mt(Object,"Object"),Pa.serialize=function(t,e){let i=t.toArrayBuffer();return e&&e.add(i),{buffer:i}},Pa.deserialize=function(t){return new Pa(t.buffer)},Object.defineProperty(Pa,"name",{value:"Grid"}),mt(Pa,"Grid"),mt(Wn,"Color"),mt(Error,"Error"),mt(kr,"Formatted"),mt(wl,"FormattedSection"),mt(Kn,"AJAXError"),mt(Lt,"ResolvedImage"),mt(Bc,"StylePropertyFunction"),mt(Yd,"StyleExpression",{omit:["_evaluator"]}),mt(Fc,"ZoomDependentExpression"),mt(rm,"ZoomConstantExpression"),mt(gi,"CompoundExpression",{omit:["_evaluate"]});for(let t in Fl)jc[Fl[t]._classRegistryKey]||mt(Fl[t],`Expression${t}`);function Lf(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function Jd(t){return self.ImageBitmap&&t instanceof ImageBitmap}function cs(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(Lf(t)||Jd(t))return e&&e.add(t),t;if(ArrayBuffer.isView(t)){let i=t;return e&&e.add(i.buffer),i}if(t instanceof ImageData)return e&&e.add(t.data.buffer),t;if(Array.isArray(t)){let i=[];for(let o of t)i.push(cs(o,e));return i}if(t instanceof Map){let i={$name:"Map"};for(let[o,s]of t.entries())i[o]=cs(s);return i}if(typeof t=="object"){let i=t.constructor,o=i._classRegistryKey;if(!o)throw new Error(`can't serialize object of unregistered class ${o}`);let s=i.serialize?i.serialize(t,e):{};if(!i.serialize){for(let l in t)t.hasOwnProperty(l)&&(jc[o].omit.indexOf(l)>=0||(s[l]=cs(t[l],e)));t instanceof Error&&(s.message=t.message)}if(s.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(s.$name=o),s}throw new Error("can't serialize object of type "+typeof t)}function Xs(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||Lf(t)||Jd(t)||ArrayBuffer.isView(t)||t instanceof ImageData)return t;if(Array.isArray(t))return t.map(Xs);if(typeof t=="object"){let e=t.$name||"Object";if(e==="Map"){let s=new Map;for(let l of Object.keys(t))l!=="$name"&&s.set(l,Xs(t[l]));return s}let{klass:i}=jc[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(t);let o=Object.create(i.prototype);for(let s of Object.keys(t))s!=="$name"&&(o[s]=Xs(t[s]));return o}throw new Error("can't deserialize object of type "+typeof t)}let yt={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519,"CJK Unified Ideographs Extension B":t=>t>=131072&&t<=173791};function ds(t){for(let e of t)if(om(e.charCodeAt(0)))return!0;return!1}function D0(t){for(let e of t)if(!P0(e.charCodeAt(0)))return!1;return!0}function P0(t){return!(yt.Arabic(t)||yt["Arabic Supplement"](t)||yt["Arabic Extended-A"](t)||yt["Arabic Presentation Forms-A"](t)||yt["Arabic Presentation Forms-B"](t))}function om(t){return!(t!==746&&t!==747&&(t<4352||!(yt["Bopomofo Extended"](t)||yt.Bopomofo(t)||yt["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||yt["CJK Compatibility Ideographs"](t)||yt["CJK Compatibility"](t)||yt["CJK Radicals Supplement"](t)||yt["CJK Strokes"](t)||!(!yt["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||yt["CJK Unified Ideographs Extension A"](t)||yt["CJK Unified Ideographs"](t)||yt["Enclosed CJK Letters and Months"](t)||yt["Hangul Compatibility Jamo"](t)||yt["Hangul Jamo Extended-A"](t)||yt["Hangul Jamo Extended-B"](t)||yt["Hangul Jamo"](t)||yt["Hangul Syllables"](t)||yt.Hiragana(t)||yt["Ideographic Description Characters"](t)||yt.Kanbun(t)||yt["Kangxi Radicals"](t)||yt["Katakana Phonetic Extensions"](t)||yt.Katakana(t)&&t!==12540||!(!yt["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!yt["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||yt["Unified Canadian Aboriginal Syllabics"](t)||yt["Unified Canadian Aboriginal Syllabics Extended"](t)||yt["Vertical Forms"](t)||yt["Yijing Hexagram Symbols"](t)||yt["Yi Syllables"](t)||yt["Yi Radicals"](t))))}function zf(t){return!(om(t)||function(e){return!!(yt["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||yt["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||yt["Letterlike Symbols"](e)||yt["Number Forms"](e)||yt["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||yt["Control Pictures"](e)&&e!==9251||yt["Optical Character Recognition"](e)||yt["Enclosed Alphanumerics"](e)||yt["Geometric Shapes"](e)||yt["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||yt["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||yt["CJK Symbols and Punctuation"](e)||yt.Katakana(e)||yt["Private Use Area"](e)||yt["CJK Compatibility Forms"](e)||yt["Small Form Variants"](e)||yt["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(t))}function Of(t){return t>=1424&&t<=2303||yt["Arabic Presentation Forms-A"](t)||yt["Arabic Presentation Forms-B"](t)}function Ff(t,e){return!(!e&&Of(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||yt.Khmer(t))}function am(t){for(let e of t)if(Of(e.charCodeAt(0)))return!0;return!1}let sm="deferred",lm="loading",cm="loaded",dm=null,ro="unavailable",hs=null,Bf=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(ro="error"),dm&&dm(t)};function hm(){um.fire(new Bs("pluginStateChange",{pluginStatus:ro,pluginURL:hs}))}let um=new yl,us=function(){return ro},mm=function(){if(ro!==sm||!hs)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ro=lm,hm(),hs&&Ae({url:hs},t=>{t?Bf(t):(ro=cm,hm())})},bo={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>ro===cm||bo.applyArabicShaping!=null,isLoading:()=>ro===lm,setState(t){ro=t.pluginStatus,hs=t.pluginURL},isParsed:()=>bo.applyArabicShaping!=null&&bo.processBidirectionalText!=null&&bo.processStyledBidirectionalText!=null,getPluginURL:()=>hs};class yn{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(i,o){for(let s of i)if(!Ff(s.charCodeAt(0),o))return!1;return!0}(e,bo.isLoaded())}}class eh{constructor(e,i,o,s){this.property=e,this.value=i,this.expression=function(l,h,f,y){if(Xd(l))return new Bc(l,h);if(Oc(l)||Array.isArray(l)&&l.length>0){let b=Qd(l,h,f,y);if(b.result==="error")throw new Error(b.value.map(T=>`${T.key}: ${T.message}`).join(", "));return b.value}{let b=l;return typeof l=="string"&&h.type==="color"&&(b=Wn.parse(l)),{kind:"constant",isConfigDependent:!1,evaluate:()=>b}}}(i===void 0?e.specification.default:i,e.specification,o,s)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,o){return this.property.possiblyEvaluate(this,e,i,o)}}class pm{constructor(e,i,o){this.property=e,this.value=new eh(e,void 0,i,o)}transitioned(e,i){return new fm(this.property,this.value,i,Er({},e.transition,this.transition),e.now)}untransitioned(){return new fm(this.property,this.value,null,{},0)}}class Ra{constructor(e,i,o){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=i,this._options=o,this.isConfigDependent=!1}getValue(e){return _o(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new pm(this._values[e].property,this._scope,this._options)),this._values[e].value=new eh(this._values[e].property,i===null?void 0:_o(i),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].value.expression.isConfigDependent}setTransitionOrValue(e,i){i&&(this._options=i);let o=this._properties.properties;if(e)for(let s in e){let l=e[s];if(Ia(s,"-transition")){let h=s.slice(0,-11);o[h]&&this.setTransition(h,l)}else o[s]&&this.setValue(s,l)}}getTransition(e){return _o(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new pm(this._values[e].property)),this._values[e].transition=_o(i)||void 0}serialize(){let e={};for(let i of Object.keys(this._values)){let o=this.getValue(i);o!==void 0&&(e[i]=o);let s=this.getTransition(i);s!==void 0&&(e[`${i}-transition`]=s)}return e}transitioned(e,i){let o=new Ys(this._properties);for(let s of Object.keys(this._values))o._values[s]=this._values[s].transitioned(e,i._values[s]);return o}untransitioned(){let e=new Ys(this._properties);for(let i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class fm{constructor(e,i,o,s,l){let h=s.delay||0,f=s.duration||0;l=l||0,this.property=e,this.value=i,this.begin=l+h,this.end=this.begin+f,e.specification.transition&&(s.delay||s.duration)&&(this.prior=o)}possiblyEvaluate(e,i,o){let s=e.now||0,l=this.value.possiblyEvaluate(e,i,o),h=this.prior;if(h){if(s>this.end)return this.prior=null,l;if(this.value.isDataDriven())return this.prior=null,l;if(s<this.begin)return h.possiblyEvaluate(e,i,o);{let f=(s-this.begin)/(this.end-this.begin);return this.property.interpolate(h.possiblyEvaluate(e,i,o),l,lt(f))}}return l}}class Ys{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,o){let s=new Vc(this._properties);for(let l of Object.keys(this._values))s._values[l]=this._values[l].possiblyEvaluate(e,i,o);return s}hasTransition(){for(let e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class R0{constructor(e,i,o){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=i,this._options=o,this.isConfigDependent=!1}getValue(e){return _o(this._values[e].value)}setValue(e,i){this._values[e]=new eh(this._values[e].property,i===null?void 0:_o(i),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].expression.isConfigDependent}serialize(){let e={};for(let i of Object.keys(this._values)){let o=this.getValue(i);o!==void 0&&(e[i]=o)}return e}possiblyEvaluate(e,i,o){let s=new Vc(this._properties);for(let l of Object.keys(this._values))s._values[l]=this._values[l].possiblyEvaluate(e,i,o);return s}}class Bl{constructor(e,i,o){this.property=e,this.value=i,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,o,s){return this.property.evaluate(this.value,this.parameters,e,i,o,s)}}class Vc{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Qe{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,o){let s=Ad[this.specification.type];return s?s(e,i,o):e}}class At{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,o,s){return new Bl(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},o,s)}:e.expression,i)}interpolate(e,i,o){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new Bl(this,{kind:"constant",value:void 0},e.parameters);let s=Ad[this.specification.type];return s?new Bl(this,{kind:"constant",value:s(e.value.value,i.value.value,o)},e.parameters):e}evaluate(e,i,o,s,l,h){return e.kind==="constant"?e.value:e.evaluate(i,o,s,l,h)}}class Ks{constructor(e){this.specification=e}possiblyEvaluate(e,i,o,s){return!!e.expression.evaluate(i,null,{},o,s)}interpolate(){return!1}}class bn{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];let i=new yn(0,{});for(let o in e){let s=e[o];s.specification.overridable&&this.overridableProperties.push(o);let l=this.defaultPropertyValues[o]=new eh(s,void 0),h=this.defaultTransitionablePropertyValues[o]=new pm(s);this.defaultTransitioningPropertyValues[o]=h.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=l.possiblyEvaluate(i)}}}function Uc(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Gc(t){if(Array.isArray(t))return t.map(Gc);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){let e={};for(let i in t)e[i]=Gc(t[i]);return e}return Uc(t)}mt(At,"DataDrivenProperty"),mt(Qe,"DataConstantProperty"),mt(Ks,"ColorRampProperty");var ye=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function _m(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(let e of t.slice(1))if(!_m(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function vo(t,e="fill"){if(t==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};_m(t)||(t=$c(t));let i=t,o=!0;try{o=function(b){if(!Nl(b))return b;let T=Gc(b);return gm(T),T=Nf(T),T}(i)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(i,null,2)}
        `)}let s=ye[`filter_${e}`],l=Kd(o,s),h=null;if(l.result==="error")throw new Error(l.value.map(b=>`${b.key}: ${b.message}`).join(", "));h=(b,T,I)=>l.value.evaluate(b,T,{},I);let f=null,y=null;if(o!==i){let b=Kd(i,s);if(b.result==="error")throw new Error(b.value.map(T=>`${T.key}: ${T.message}`).join(", "));f=(T,I,C,D,R)=>b.value.evaluate(T,I,{},C,void 0,void 0,D,R),y=!El(b.value.expression)}return{filter:h,dynamicFilter:f||void 0,needGeometry:jf(o),needFeature:!!y}}function Nf(t){if(!Array.isArray(t))return t;let e=function(i){if(L0.has(i[0])){for(let o=1;o<i.length;o++)if(Nl(i[o]))return!0}return i}(t);return e===!0?e:e.map(i=>Nf(i))}function gm(t){let e=!1,i=[];if(t[0]==="case"){for(let o=1;o<t.length-1;o+=2)e=e||Nl(t[o]),i.push(t[o+1]);i.push(t[t.length-1])}else if(t[0]==="match"){e=e||Nl(t[1]);for(let o=2;o<t.length-1;o+=2)i.push(t[o+1]);i.push(t[t.length-1])}else if(t[0]==="step"){e=e||Nl(t[1]);for(let o=1;o<t.length-1;o+=2)i.push(t[o+1])}e&&(t.length=0,t.push("any",...i));for(let o=1;o<t.length;o++)gm(t[o])}function Nl(t){if(!Array.isArray(t))return!1;if((e=t[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<t.length;i++)if(Nl(t[i]))return!0;return!1}let L0=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function z0(t,e){return t<e?-1:t>e?1:0}function jf(t){if(!Array.isArray(t))return!1;if(t[0]==="within"||t[0]==="distance")return!0;for(let e=1;e<t.length;e++)if(jf(t[e]))return!0;return!1}function $c(t){if(!t)return!0;let e=t[0];return t.length<=1?e!=="any":e==="=="?qc(t[1],t[2],"=="):e==="!="?Hc(qc(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?qc(t[1],t[2],e):e==="any"?(i=t.slice(1),["any"].concat(i.map($c))):e==="all"?["all"].concat(t.slice(1).map($c)):e==="none"?["all"].concat(t.slice(1).map($c).map(Hc)):e==="in"?ym(t[1],t.slice(2)):e==="!in"?Hc(ym(t[1],t.slice(2))):e==="has"?Vf(t[1]):e!=="!has"||Hc(Vf(t[1]));var i}function qc(t,e,i){switch(t){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,t,e]}}function ym(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",t,["literal",e.sort(z0)]]:["filter-in-small",t,["literal",e]]}}function Vf(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Hc(t){return["!",t]}let th="";function bm(t,e){return e?`${t}${th}${e}`:t}let Zc="-transition";class oo extends yl{constructor(e,i,o,s){if(super(),this.id=e.id,this.fqid=bm(this.id,o),this.type=e.type,this.scope=o,this.options=s,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),e.slot&&(this.slot=e.slot),i.layout&&(this._unevaluatedLayout=new R0(i.layout,this.scope,s),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),i.paint)){this._transitionablePaint=new Ra(i.paint,this.scope,s);for(let l in e.paint)this.setPaintProperty(l,e.paint[l]);for(let l in e.layout)this.setLayoutProperty(l,e.layout[l]);this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Vc(i.paint)}}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i){if(this.type==="custom"&&e==="visibility")return void(this.visibility=i);let o=this._unevaluatedLayout;o._properties.properties[e]&&(o.setValue(e,i),this.isConfigDependent=this.isConfigDependent||o.isConfigDependent,e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return Ia(e,Zc)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i){let o=this._transitionablePaint,s=o._properties.properties;if(Ia(e,Zc)){let I=e.slice(0,-11);return s[I]&&o.setTransition(I,i||void 0),!1}if(!s[e])return!1;let l=o._values[e],h=l.value.isDataDriven(),f=l.value;o.setValue(e,i),this.isConfigDependent=this.isConfigDependent||o.isConfigDependent,this._handleSpecialPaintPropertyUpdate(e);let y=o._values[e].value,b=y.isDataDriven(),T=Ia(e,"pattern")||e==="line-dasharray";return b||h||T||this._handleOverridablePaintPropertyUpdate(e,f,y)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i){return null}_handleOverridablePaintPropertyUpdate(e,i,o){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){return So({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,i)=>!(e===void 0||i==="layout"&&!Object.keys(e).length||i==="paint"&&!Object.keys(e).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(let e in this.paint._values){let i=this.paint.get(e);if(i instanceof Bl&&Wd(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=vo(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}}let O0={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ih{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ln{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){let i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Bi(t,e=1){let i=0,o=0;return{members:t.map(s=>{let l=O0[s.type].BYTES_PER_ELEMENT,h=i=Wc(i,Math.max(e,l)),f=s.components||1;return o=Math.max(o,l),i+=l*f,{name:s.name,type:s.type,components:f,offset:h}}),size:Wc(i,Math.max(o,e)),alignment:e}}function Wc(t,e){return Math.ceil(t/e)*e}class ea extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){let o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){let s=2*e;return this.int16[s+0]=i,this.int16[s+1]=o,e}}ea.prototype.bytesPerElement=4,mt(ea,"StructArrayLayout2i4");class Xr extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o){let s=this.length;return this.resize(s+1),this.emplace(s,e,i,o)}emplace(e,i,o,s){let l=3*e;return this.int16[l+0]=i,this.int16[l+1]=o,this.int16[l+2]=s,e}}Xr.prototype.bytesPerElement=6,mt(Xr,"StructArrayLayout3i6");class La extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,s){let l=this.length;return this.resize(l+1),this.emplace(l,e,i,o,s)}emplace(e,i,o,s,l){let h=4*e;return this.int16[h+0]=i,this.int16[h+1]=o,this.int16[h+2]=s,this.int16[h+3]=l,e}}La.prototype.bytesPerElement=8,mt(La,"StructArrayLayout4i8");class vm extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,s,l){let h=this.length;return this.resize(h+1),this.emplace(h,e,i,o,s,l)}emplace(e,i,o,s,l,h){let f=5*e;return this.int16[f+0]=i,this.int16[f+1]=o,this.int16[f+2]=s,this.int16[f+3]=l,this.int16[f+4]=h,e}}vm.prototype.bytesPerElement=10,mt(vm,"StructArrayLayout5i10");class xm extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,s,l,h,f){let y=this.length;return this.resize(y+1),this.emplace(y,e,i,o,s,l,h,f)}emplace(e,i,o,s,l,h,f,y){let b=6*e,T=12*e,I=3*e;return this.int16[b+0]=i,this.int16[b+1]=o,this.uint8[T+4]=s,this.uint8[T+5]=l,this.uint8[T+6]=h,this.uint8[T+7]=f,this.float32[I+2]=y,e}}xm.prototype.bytesPerElement=12,mt(xm,"StructArrayLayout2i4ub1f12");class ms extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,s){let l=this.length;return this.resize(l+1),this.emplace(l,e,i,o,s)}emplace(e,i,o,s,l){let h=4*e;return this.float32[h+0]=i,this.float32[h+1]=o,this.float32[h+2]=s,this.float32[h+3]=l,e}}ms.prototype.bytesPerElement=16,mt(ms,"StructArrayLayout4f16");class ps extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,s,l){let h=this.length;return this.resize(h+1),this.emplace(h,e,i,o,s,l)}emplace(e,i,o,s,l,h){let f=6*e,y=3*e;return this.uint16[f+0]=i,this.uint16[f+1]=o,this.uint16[f+2]=s,this.uint16[f+3]=l,this.float32[y+2]=h,e}}ps.prototype.bytesPerElement=12,mt(ps,"StructArrayLayout4ui1f12");class jl extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,s){let l=this.length;return this.resize(l+1),this.emplace(l,e,i,o,s)}emplace(e,i,o,s,l){let h=4*e;return this.uint16[h+0]=i,this.uint16[h+1]=o,this.uint16[h+2]=s,this.uint16[h+3]=l,e}}jl.prototype.bytesPerElement=8,mt(jl,"StructArrayLayout4ui8");class nh extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,s,l,h){let f=this.length;return this.resize(f+1),this.emplace(f,e,i,o,s,l,h)}emplace(e,i,o,s,l,h,f){let y=6*e;return this.int16[y+0]=i,this.int16[y+1]=o,this.int16[y+2]=s,this.int16[y+3]=l,this.int16[y+4]=h,this.int16[y+5]=f,e}}nh.prototype.bytesPerElement=12,mt(nh,"StructArrayLayout6i12");class Xc extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,s,l,h,f,y,b,T,I,C){let D=this.length;return this.resize(D+1),this.emplace(D,e,i,o,s,l,h,f,y,b,T,I,C)}emplace(e,i,o,s,l,h,f,y,b,T,I,C,D){let R=12*e;return this.int16[R+0]=i,this.int16[R+1]=o,this.int16[R+2]=s,this.int16[R+3]=l,this.uint16[R+4]=h,this.uint16[R+5]=f,this.uint16[R+6]=y,this.uint16[R+7]=b,this.int16[R+8]=T,this.int16[R+9]=I,this.int16[R+10]=C,this.int16[R+11]=D,e}}Xc.prototype.bytesPerElement=24,mt(Xc,"StructArrayLayout4i4ui4i24");class wm extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,s,l,h){let f=this.length;return this.resize(f+1),this.emplace(f,e,i,o,s,l,h)}emplace(e,i,o,s,l,h,f){let y=10*e,b=5*e;return this.int16[y+0]=i,this.int16[y+1]=o,this.int16[y+2]=s,this.float32[b+2]=l,this.float32[b+3]=h,this.float32[b+4]=f,e}}wm.prototype.bytesPerElement=20,mt(wm,"StructArrayLayout3i3f20");class Tm extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){let i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}Tm.prototype.bytesPerElement=4,mt(Tm,"StructArrayLayout1ul4");class _a extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){let o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){let s=2*e;return this.uint16[s+0]=i,this.uint16[s+1]=o,e}}_a.prototype.bytesPerElement=4,mt(_a,"StructArrayLayout2ui4");class km extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,s,l,h,f,y,b,T,I,C,D){let R=this.length;return this.resize(R+1),this.emplace(R,e,i,o,s,l,h,f,y,b,T,I,C,D)}emplace(e,i,o,s,l,h,f,y,b,T,I,C,D,R){let L=20*e,B=10*e;return this.int16[L+0]=i,this.int16[L+1]=o,this.int16[L+2]=s,this.int16[L+3]=l,this.int16[L+4]=h,this.float32[B+3]=f,this.float32[B+4]=y,this.float32[B+5]=b,this.float32[B+6]=T,this.int16[L+14]=I,this.uint32[B+8]=C,this.uint16[L+18]=D,this.uint16[L+19]=R,e}}km.prototype.bytesPerElement=40,mt(km,"StructArrayLayout5i4f1i1ul2ui40");class Yc extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,s,l,h,f){let y=this.length;return this.resize(y+1),this.emplace(y,e,i,o,s,l,h,f)}emplace(e,i,o,s,l,h,f,y){let b=8*e;return this.int16[b+0]=i,this.int16[b+1]=o,this.int16[b+2]=s,this.int16[b+4]=l,this.int16[b+5]=h,this.int16[b+6]=f,this.int16[b+7]=y,e}}Yc.prototype.bytesPerElement=16,mt(Yc,"StructArrayLayout3i2i2i16");class rh extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,s,l){let h=this.length;return this.resize(h+1),this.emplace(h,e,i,o,s,l)}emplace(e,i,o,s,l,h){let f=4*e,y=8*e;return this.float32[f+0]=i,this.float32[f+1]=o,this.float32[f+2]=s,this.int16[y+6]=l,this.int16[y+7]=h,e}}rh.prototype.bytesPerElement=16,mt(rh,"StructArrayLayout2f1f2i16");class Im extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,s){let l=this.length;return this.resize(l+1),this.emplace(l,e,i,o,s)}emplace(e,i,o,s,l){let h=12*e,f=3*e;return this.uint8[h+0]=i,this.uint8[h+1]=o,this.float32[f+1]=s,this.float32[f+2]=l,e}}Im.prototype.bytesPerElement=12,mt(Im,"StructArrayLayout2ub2f12");class hr extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o){let s=this.length;return this.resize(s+1),this.emplace(s,e,i,o)}emplace(e,i,o,s){let l=3*e;return this.uint16[l+0]=i,this.uint16[l+1]=o,this.uint16[l+2]=s,e}}hr.prototype.bytesPerElement=6,mt(hr,"StructArrayLayout3ui6");class Vl extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,o,s,l,h,f,y,b,T,I,C,D,R,L,B,j,Z,K,Y,ne){let te=this.length;return this.resize(te+1),this.emplace(te,e,i,o,s,l,h,f,y,b,T,I,C,D,R,L,B,j,Z,K,Y,ne)}emplace(e,i,o,s,l,h,f,y,b,T,I,C,D,R,L,B,j,Z,K,Y,ne,te){let se=30*e,he=15*e,fe=60*e;return this.int16[se+0]=i,this.int16[se+1]=o,this.int16[se+2]=s,this.float32[he+2]=l,this.float32[he+3]=h,this.uint16[se+8]=f,this.uint16[se+9]=y,this.uint32[he+5]=b,this.uint32[he+6]=T,this.uint32[he+7]=I,this.uint16[se+16]=C,this.uint16[se+17]=D,this.uint16[se+18]=R,this.float32[he+10]=L,this.float32[he+11]=B,this.uint8[fe+48]=j,this.uint8[fe+49]=Z,this.uint8[fe+50]=K,this.uint32[he+13]=Y,this.int16[se+28]=ne,this.uint8[fe+58]=te,e}}Vl.prototype.bytesPerElement=60,mt(Vl,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class oh extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,o,s,l,h,f,y,b,T,I,C,D,R,L,B,j,Z,K,Y,ne,te,se,he,fe,ve,_e,Se,ze,ke,Re,we){let Pe=this.length;return this.resize(Pe+1),this.emplace(Pe,e,i,o,s,l,h,f,y,b,T,I,C,D,R,L,B,j,Z,K,Y,ne,te,se,he,fe,ve,_e,Se,ze,ke,Re,we)}emplace(e,i,o,s,l,h,f,y,b,T,I,C,D,R,L,B,j,Z,K,Y,ne,te,se,he,fe,ve,_e,Se,ze,ke,Re,we,Pe){let et=20*e,Fe=40*e,ft=80*e;return this.float32[et+0]=i,this.float32[et+1]=o,this.int16[Fe+4]=s,this.int16[Fe+5]=l,this.int16[Fe+6]=h,this.int16[Fe+7]=f,this.int16[Fe+8]=y,this.int16[Fe+9]=b,this.int16[Fe+10]=T,this.int16[Fe+11]=I,this.int16[Fe+12]=C,this.uint16[Fe+13]=D,this.uint16[Fe+14]=R,this.uint16[Fe+15]=L,this.uint16[Fe+16]=B,this.uint16[Fe+17]=j,this.uint16[Fe+18]=Z,this.uint16[Fe+19]=K,this.uint16[Fe+20]=Y,this.uint16[Fe+21]=ne,this.uint16[Fe+22]=te,this.uint16[Fe+23]=se,this.uint16[Fe+24]=he,this.uint16[Fe+25]=fe,this.uint16[Fe+26]=ve,this.uint16[Fe+27]=_e,this.uint32[et+14]=Se,this.float32[et+15]=ze,this.float32[et+16]=ke,this.float32[et+17]=Re,this.float32[et+18]=we,this.uint8[ft+76]=Pe,e}}oh.prototype.bytesPerElement=80,mt(oh,"StructArrayLayout2f9i15ui1ul4f1ub80");class Kc extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){let i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}Kc.prototype.bytesPerElement=4,mt(Kc,"StructArrayLayout1f4");class fs extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,s,l){let h=this.length;return this.resize(h+1),this.emplace(h,e,i,o,s,l)}emplace(e,i,o,s,l,h){let f=5*e;return this.float32[f+0]=i,this.float32[f+1]=o,this.float32[f+2]=s,this.float32[f+3]=l,this.float32[f+4]=h,e}}fs.prototype.bytesPerElement=20,mt(fs,"StructArrayLayout5f20");class Sm extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,s,l,h,f){let y=this.length;return this.resize(y+1),this.emplace(y,e,i,o,s,l,h,f)}emplace(e,i,o,s,l,h,f,y){let b=7*e;return this.float32[b+0]=i,this.float32[b+1]=o,this.float32[b+2]=s,this.float32[b+3]=l,this.float32[b+4]=h,this.float32[b+5]=f,this.float32[b+6]=y,e}}Sm.prototype.bytesPerElement=28,mt(Sm,"StructArrayLayout7f28");class Qc extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,s){let l=this.length;return this.resize(l+1),this.emplace(l,e,i,o,s)}emplace(e,i,o,s,l){let h=6*e;return this.uint32[3*e+0]=i,this.uint16[h+2]=o,this.uint16[h+3]=s,this.uint16[h+4]=l,e}}Qc.prototype.bytesPerElement=12,mt(Qc,"StructArrayLayout1ul3ui12");class Cm extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){let i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}Cm.prototype.bytesPerElement=2,mt(Cm,"StructArrayLayout1ui2");class Qs extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o){let s=this.length;return this.resize(s+1),this.emplace(s,e,i,o)}emplace(e,i,o,s){let l=3*e;return this.float32[l+0]=i,this.float32[l+1]=o,this.float32[l+2]=s,e}}Qs.prototype.bytesPerElement=12,mt(Qs,"StructArrayLayout3f12");class Jc extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){let o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){let s=2*e;return this.float32[s+0]=i,this.float32[s+1]=o,e}}Jc.prototype.bytesPerElement=8,mt(Jc,"StructArrayLayout2f8");class Mm extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,s,l,h,f,y,b,T,I,C,D,R,L,B){let j=this.length;return this.resize(j+1),this.emplace(j,e,i,o,s,l,h,f,y,b,T,I,C,D,R,L,B)}emplace(e,i,o,s,l,h,f,y,b,T,I,C,D,R,L,B,j){let Z=16*e;return this.float32[Z+0]=i,this.float32[Z+1]=o,this.float32[Z+2]=s,this.float32[Z+3]=l,this.float32[Z+4]=h,this.float32[Z+5]=f,this.float32[Z+6]=y,this.float32[Z+7]=b,this.float32[Z+8]=T,this.float32[Z+9]=I,this.float32[Z+10]=C,this.float32[Z+11]=D,this.float32[Z+12]=R,this.float32[Z+13]=L,this.float32[Z+14]=B,this.float32[Z+15]=j,e}}Mm.prototype.bytesPerElement=64,mt(Mm,"StructArrayLayout16f64");class ed extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,s,l,h,f){let y=this.length;return this.resize(y+1),this.emplace(y,e,i,o,s,l,h,f)}emplace(e,i,o,s,l,h,f,y){let b=10*e,T=5*e;return this.uint16[b+0]=i,this.uint16[b+1]=o,this.uint16[b+2]=s,this.uint16[b+3]=l,this.float32[T+2]=h,this.float32[T+3]=f,this.float32[T+4]=y,e}}ed.prototype.bytesPerElement=20,mt(ed,"StructArrayLayout4ui3f20");class Em extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){let i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[1*e+0]=i,e}}Em.prototype.bytesPerElement=1,mt(Em,"StructArrayLayout1ub1");class Uf extends ih{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Uf.prototype.size=40;class Gf extends km{get(e){return new Uf(this,e)}}mt(Gf,"CollisionBoxArray");class $f extends ih{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}$f.prototype.size=60;class qf extends Vl{get(e){return new $f(this,e)}}mt(qf,"PlacedSymbolArray");class Hf extends ih{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}Hf.prototype.size=80;class Zf extends oh{get(e){return new Hf(this,e)}}mt(Zf,"SymbolInstanceArray");class Wf extends Kc{getoffsetX(e){return this.float32[1*e+0]}}mt(Wf,"GlyphOffsetArray");class td extends ea{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}mt(td,"SymbolLineVertexArray");class Xf extends ih{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Xf.prototype.size=12;class Yf extends Qc{get(e){return new Xf(this,e)}}mt(Yf,"FeatureIndexArray");class id extends _a{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}mt(id,"FillExtrusionCentroidArray");let F0=Bi([{name:"a_pos",components:2,type:"Int16"}],4),Kf=Bi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Rn{constructor(e=[]){this.segments=e}_prepareSegment(e,i,o,s){let l=this.segments[this.segments.length-1];return e>Rn.MAX_VERTEX_ARRAY_LENGTH&&Pn(`Max vertices per segment is ${Rn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!l||l.vertexLength+e>Rn.MAX_VERTEX_ARRAY_LENGTH||l.sortKey!==s)&&(l={vertexOffset:i,primitiveOffset:o,vertexLength:0,primitiveLength:0},s!==void 0&&(l.sortKey=s),this.segments.push(l)),l}prepareSegment(e,i,o,s){return this._prepareSegment(e,i.length,o.length,s)}get(){return this.segments}destroy(){for(let e of this.segments)for(let i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,o,s){return new Rn([{vertexOffset:e,primitiveOffset:i,vertexLength:o,primitiveLength:s,vaos:{},sortKey:0}])}}function Am(t,e){return 256*(t=ii(Math.floor(t),0,255))+ii(Math.floor(e),0,255)}Rn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,mt(Rn,"SegmentVector");let Qf=Bi([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Jf=Bi([{name:"a_dash",components:4,type:"Uint16"}]);var nd={exports:{}},ah={exports:{}};(function(t){t.exports=function(e,i){var o,s,l,h,f,y,b,T;for(s=e.length-(o=3&e.length),l=i,f=3432918353,y=461845907,T=0;T<s;)b=255&e.charCodeAt(T)|(255&e.charCodeAt(++T))<<8|(255&e.charCodeAt(++T))<<16|(255&e.charCodeAt(++T))<<24,++T,l=27492+(65535&(h=5*(65535&(l=(l^=b=(65535&(b=(b=(65535&b)*f+(((b>>>16)*f&65535)<<16)&4294967295)<<15|b>>>17))*y+(((b>>>16)*y&65535)<<16)&4294967295)<<13|l>>>19))+((5*(l>>>16)&65535)<<16)&4294967295))+((58964+(h>>>16)&65535)<<16);switch(b=0,o){case 3:b^=(255&e.charCodeAt(T+2))<<16;case 2:b^=(255&e.charCodeAt(T+1))<<8;case 1:l^=b=(65535&(b=(b=(65535&(b^=255&e.charCodeAt(T)))*f+(((b>>>16)*f&65535)<<16)&4294967295)<<15|b>>>17))*y+(((b>>>16)*y&65535)<<16)&4294967295}return l^=e.length,l=2246822507*(65535&(l^=l>>>16))+((2246822507*(l>>>16)&65535)<<16)&4294967295,l=3266489909*(65535&(l^=l>>>13))+((3266489909*(l>>>16)&65535)<<16)&4294967295,(l^=l>>>16)>>>0}})(ah);var Dm=ah.exports,e_={exports:{}};(function(t){t.exports=function(e,i){for(var o,s=e.length,l=i^s,h=0;s>=4;)o=1540483477*(65535&(o=255&e.charCodeAt(h)|(255&e.charCodeAt(++h))<<8|(255&e.charCodeAt(++h))<<16|(255&e.charCodeAt(++h))<<24))+((1540483477*(o>>>16)&65535)<<16),l=1540483477*(65535&l)+((1540483477*(l>>>16)&65535)<<16)^(o=1540483477*(65535&(o^=o>>>24))+((1540483477*(o>>>16)&65535)<<16)),s-=4,++h;switch(s){case 3:l^=(255&e.charCodeAt(h+2))<<16;case 2:l^=(255&e.charCodeAt(h+1))<<8;case 1:l=1540483477*(65535&(l^=255&e.charCodeAt(h)))+((1540483477*(l>>>16)&65535)<<16)}return l=1540483477*(65535&(l^=l>>>13))+((1540483477*(l>>>16)&65535)<<16),(l^=l>>>15)>>>0}})(e_);var t_=Dm,i_=e_.exports;nd.exports=t_,nd.exports.murmur3=t_,nd.exports.murmur2=i_;var Pm=mi(nd.exports);class rd{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,o,s){this.ids.push(n_(e)),this.positions.push(i,o,s)}eachPosition(e,i){let o=n_(e),s=0,l=this.ids.length-1;for(;s<l;){let h=s+l>>1;this.ids[h]>=o?l=h:s=h+1}for(;this.ids[s]===o;)i(this.positions[3*s],this.positions[3*s+1],this.positions[3*s+2]),s++}static serialize(e,i){let o=new Float64Array(e.ids),s=new Uint32Array(e.positions);return Rm(o,s,0,o.length-1),i&&(i.add(o.buffer),i.add(s.buffer)),{ids:o,positions:s}}static deserialize(e){let i=new rd,o;i.ids=e.ids,i.positions=e.positions;for(let s of i.ids)s!==o&&i.uniqueIds.push(s),o=s;return i.indexed=!0,i}}function n_(t){let e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Pm(String(t))}function Rm(t,e,i,o){for(;i<o;){let s=t[i+o>>1],l=i-1,h=o+1;for(;;){do l++;while(t[l]<s);do h--;while(t[h]>s);if(l>=h)break;sh(t,l,h),sh(e,3*l,3*h),sh(e,3*l+1,3*h+1),sh(e,3*l+2,3*h+2)}h-i<o-h?(Rm(t,e,i,h),i=h+1):(Rm(t,e,h+1,o),o=h)}}function sh(t,e,i){let o=t[e];t[e]=t[i],t[i]=o}mt(rd,"FeaturePositionMap");class za{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}}class lh extends za{constructor(e){super(e),this.current=0}set(e,i,o){this.fetchUniformLocation(e,i)&&this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}}class Nr extends za{constructor(e){super(e),this.current=0}set(e,i,o){this.fetchUniformLocation(e,i)&&this.current!==o&&(this.current=o,this.gl.uniform1f(this.location,o))}}class _s extends za{constructor(e){super(e),this.current=[0,0]}set(e,i,o){this.fetchUniformLocation(e,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1])))}}class r_ extends za{constructor(e){super(e),this.current=[0,0,0]}set(e,i,o){this.fetchUniformLocation(e,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2])))}}class c extends za{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,o){this.fetchUniformLocation(e,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]&&o[3]===this.current[3]||(this.current=o,this.gl.uniform4f(this.location,o[0],o[1],o[2],o[3])))}}class n extends za{constructor(e){super(e),this.current=Wn.transparent}set(e,i,o){this.fetchUniformLocation(e,i)&&(o.r===this.current.r&&o.g===this.current.g&&o.b===this.current.b&&o.a===this.current.a||(this.current=o,this.gl.uniform4f(this.location,o.r,o.g,o.b,o.a)))}}let a=new Float32Array(16);class d extends za{constructor(e){super(e),this.current=a}set(e,i,o){if(this.fetchUniformLocation(e,i)){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let s=1;s<16;s++)if(o[s]!==this.current[s]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}}}let p=new Float32Array(9),g=new Float32Array(4);class v extends za{constructor(e){super(e),this.current=g}set(e,i,o){if(this.fetchUniformLocation(e,i)){for(let s=0;s<4;s++)if(o[s]!==this.current[s]){this.current=o,this.gl.uniformMatrix2fv(this.location,!1,o);break}}}}function k(t){return[Am(255*t.r,255*t.g),Am(255*t.b,255*t.a)]}class S{constructor(e,i,o){this.value=e,this.uniformNames=i.map(s=>`u_${s}`),this.type=o}setUniform(e,i,o,s,l){i.set(e,l,s.constantOr(this.value))}getBinding(e,i){return this.type==="color"?new n(e):new Nr(e)}}class E{constructor(e,i){this.uniformNames=i.map(o=>`u_${o}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,i,o,s,l){let h=l==="u_pattern"||l==="u_dash"?this.pattern:l==="u_pixel_ratio"?this.pixelRatio:null;h&&i.set(e,l,h)}getBinding(e,i){return i==="u_pattern"||i==="u_dash"?new c(e):new Nr(e)}}class A{constructor(e,i,o,s){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=i.map(l=>({name:`a_${l}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new s}populatePaintArray(e,i,o,s,l,h,f){let y=this.paintVertexArray.length,b=this.expression.evaluate(new yn(0,{brightness:h}),i,{},l,s,f);this.paintVertexArray.resize(e),this._setPaintValue(y,e,b)}updatePaintArray(e,i,o,s,l,h,f){let y=this.expression.evaluate({zoom:0,brightness:f},o,s,void 0,l);this._setPaintValue(e,i,y)}_setPaintValue(e,i,o){if(this.type==="color"){let s=k(o);for(let l=e;l<i;l++)this.paintVertexArray.emplace(l,s[0],s[1])}else{for(let s=e;s<i;s++)this.paintVertexArray.emplace(s,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class P{constructor(e,i,o,s,l,h){this.expression=e,this.uniformNames=i.map(f=>`u_${f}_t`),this.type=o,this.useIntegerZoom=s,this.zoom=l,this.maxValue=0,this.paintVertexAttributes=i.map(f=>({name:`a_${f}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new h}populatePaintArray(e,i,o,s,l,h,f){let y=this.expression.evaluate(new yn(this.zoom,{brightness:h}),i,{},l,s,f),b=this.expression.evaluate(new yn(this.zoom+1,{brightness:h}),i,{},l,s,f),T=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(T,e,y,b)}updatePaintArray(e,i,o,s,l,h,f){let y=this.expression.evaluate({zoom:this.zoom,brightness:f},o,s,void 0,l),b=this.expression.evaluate({zoom:this.zoom+1,brightness:f},o,s,void 0,l);this._setPaintValue(e,i,y,b)}_setPaintValue(e,i,o,s){if(this.type==="color"){let l=k(o),h=k(s);for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,l[0],l[1],h[0],h[1])}else{for(let l=e;l<i;l++)this.paintVertexArray.emplace(l,o,s);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,o,s,l){let h=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,f=ii(this.expression.interpolationFactor(h,this.zoom,this.zoom+1),0,1);i.set(e,l,f)}getBinding(e,i){return new Nr(e)}}class z{constructor(e,i,o,s,l){this.expression=e,this.layerId=l,this.paintVertexAttributes=(o==="array"?Jf:Qf).members;for(let h=0;h<i.length;++h);this.paintVertexArray=new s}populatePaintArray(e,i,o){let s=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(s,e,i.patterns&&i.patterns[this.layerId],o)}updatePaintArray(e,i,o,s,l,h,f){this._setPaintValues(e,i,o.patterns&&o.patterns[this.layerId],h)}_setPaintValues(e,i,o,s){if(!s||!o)return;let l=s[o];if(!l)return;let{tl:h,br:f,pixelRatio:y}=l;for(let b=e;b<i;b++)this.paintVertexArray.emplace(b,h[0],h[1],f[0],f[1],y)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class O{constructor(e,i,o=()=>!0){this.binders={},this._buffers=[];let s=[];for(let l in e.paint._values){let h=e.paint.get(l);if(!o(l)||!(h instanceof Bl&&Wd(h.property.specification)))continue;let f=G(l,e.type),y=h.value,b=h.property.specification.type,T=!!h.property.useIntegerZoom,I=l==="line-dasharray"||l.endsWith("pattern"),C=l==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(y.kind!=="constant"||C)if(y.kind==="source"||C||I){let D=Q(l,b,"source");this.binders[l]=I?new z(y,f,b,D,e.id):new A(y,f,b,D),s.push(`/a_${l}`)}else{let D=Q(l,b,"composite");this.binders[l]=new P(y,f,b,T,i,D),s.push(`/z_${l}`)}else this.binders[l]=I?new E(y.value,f):new S(y.value,f,b),s.push(`/u_${l}`)}this.cacheKey=s.sort().join("")}getMaxValue(e){let i=this.binders[e];return i instanceof A||i instanceof P?i.maxValue:0}populatePaintArrays(e,i,o,s,l,h,f){for(let y in this.binders){let b=this.binders[y];(b instanceof A||b instanceof P||b instanceof z)&&b.populatePaintArray(e,i,o,s,l,h,f)}}setConstantPatternPositions(e){for(let i in this.binders){let o=this.binders[i];o instanceof E&&o.setConstantPatternPositions(e)}}updatePaintArrays(e,i,o,s,l,h,f,y){let b=!1,T=Object.keys(e),I=T.length!==0,C=I?T:i.uniqueIds;for(let D in this.binders){let R=this.binders[D];if((R instanceof A||R instanceof P||R instanceof z)&&(R.expression.isStateDependent===!0||R.expression.isLightConstant===!1)){let L=l.paint.get(D);R.expression=L.value;for(let B of C){let j=e[B.toString()];i.eachPosition(B,(Z,K,Y)=>{let ne=s.feature(Z);R.updatePaintArray(K,Y,ne,j,h,f,y)})}if(!I)for(let B of o.uniqueIds){let j=e[B.toString()];o.eachPosition(B,(Z,K,Y)=>{let ne=s.feature(Z);R.updatePaintArray(K,Y,ne,j,h,f,y)})}b=!0}}return b}defines(){let e=[];for(let i in this.binders){let o=this.binders[i];(o instanceof S||o instanceof E)&&e.push(...o.uniformNames.map(s=>`#define HAS_UNIFORM_${s}`))}return e}getBinderAttributes(){let e=[];for(let i in this.binders){let o=this.binders[i];if(o instanceof A||o instanceof P||o instanceof z)for(let s=0;s<o.paintVertexAttributes.length;s++)e.push(o.paintVertexAttributes[s].name)}return e}getBinderUniforms(){let e=[];for(let i in this.binders){let o=this.binders[i];if(o instanceof S||o instanceof E||o instanceof P)for(let s of o.uniformNames)e.push(s)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){let i=[];for(let o in this.binders){let s=this.binders[o];if(s instanceof S||s instanceof E||s instanceof P)for(let l of s.uniformNames)i.push({name:l,property:o,binding:s.getBinding(e,l)})}return i}setUniforms(e,i,o,s,l){for(let{name:h,property:f,binding:y}of o)this.binders[f].setUniform(e,y,l,s.get(f),h)}updatePaintBuffers(){this._buffers=[];for(let e in this.binders){let i=this.binders[e];(i instanceof A||i instanceof P||i instanceof z)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(e){for(let i in this.binders){let o=this.binders[i];(o instanceof A||o instanceof P||o instanceof z)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(let e in this.binders){let i=this.binders[e];(i instanceof A||i instanceof P||i instanceof z)&&i.destroy()}}}class U{constructor(e,i,o=()=>!0){this.programConfigurations={};for(let s of e)this.programConfigurations[s.id]=new O(s,i,o);this.needsUpload=!1,this._featureMap=new rd,this._featureMapWithoutIds=new rd,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,o,s,l,h,f,y){for(let b in this.programConfigurations)this.programConfigurations[b].populatePaintArrays(e,i,s,l,h,f,y);i.id!==void 0?this._featureMap.add(i.id,o,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,o,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,o,s,l,h){for(let f of o)this.needsUpload=this.programConfigurations[f.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,f,s,l,h||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(let i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(let e in this.programConfigurations)this.programConfigurations[e].destroy()}}let V={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function G(t,e){return V[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}let N={"line-pattern":{source:ps,composite:ps},"fill-pattern":{source:ps,composite:ps},"fill-extrusion-pattern":{source:ps,composite:ps},"line-dasharray":{source:jl,composite:jl}},H={color:{source:Jc,composite:ms},number:{source:Kc,composite:Jc}};function Q(t,e,i){let o=N[t];return o&&o[i]||H[e][i]}mt(S,"ConstantBinder"),mt(E,"PatternConstantBinder"),mt(A,"SourceExpressionBinder"),mt(z,"PatternCompositeBinder"),mt(P,"CompositeExpressionBinder"),mt(O,"ProgramConfiguration",{omit:["_buffers"]}),mt(U,"ProgramConfigurationSet");let W=st/Math.PI/2,J=5,$=6,ee=16383,oe=64,ae=[oe,32,16],ce=-W,be=W;function ue(t,e,i,o=W){return i=vi(i),[t*Math.sin(i)*o,-e*o,t*Math.cos(i)*o]}function Ie(t,e,i){return ue(Math.cos(vi(t)),Math.sin(vi(t)),e,i)}let Te=63710088e-1,Be=2*Math.PI*Te;class pe{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new pe(Ya(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){let i=Math.PI/180,o=this.lat*i,s=e.lat*i,l=Math.sin(o)*Math.sin(s)+Math.cos(o)*Math.cos(s)*Math.cos((e.lng-this.lng)*i);return Te*Math.acos(Math.min(l,1))}toBounds(e=0){let i=360*e/40075017,o=i/Math.cos(Math.PI/180*this.lat);return new xe({lng:this.lng-o,lat:this.lat-i},{lng:this.lng+o,lat:this.lat+i})}toEcef(e){return Ie(this.lat,this.lng,W+e*W/Te)}static convert(e){if(e instanceof pe)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new pe(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new pe(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class xe{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof pe?new pe(e.lng,e.lat):pe.convert(e),this}setSouthWest(e){return this._sw=e instanceof pe?new pe(e.lng,e.lat):pe.convert(e),this}extend(e){let i=this._sw,o=this._ne,s,l;if(e instanceof pe)s=e,l=e;else{if(!(e instanceof xe))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(xe.convert(e)):this.extend(pe.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(pe.convert(e)):this;if(s=e._sw,l=e._ne,!s||!l)return this}return i||o?(i.lng=Math.min(s.lng,i.lng),i.lat=Math.min(s.lat,i.lat),o.lng=Math.max(l.lng,o.lng),o.lat=Math.max(l.lat,o.lat)):(this._sw=new pe(s.lng,s.lat),this._ne=new pe(l.lng,l.lat)),this}getCenter(){return new pe((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new pe(this.getWest(),this.getNorth())}getSouthEast(){return new pe(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){let{lng:i,lat:o}=pe.convert(e),s=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(s=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=o&&o<=this._ne.lat&&s}static convert(e){return!e||e instanceof xe?e:new xe(e)}}var le={};(function(t,e){(function(i){function o(l,h,f){var y=s(256*l,256*(h=Math.pow(2,f)-h-1),f),b=s(256*(l+1),256*(h+1),f);return y[0]+","+y[1]+","+b[0]+","+b[1]}function s(l,h,f){var y=2*Math.PI*6378137/256/Math.pow(2,f);return[l*y-2*Math.PI*6378137/2,h*y-2*Math.PI*6378137/2]}i.getURL=function(l,h,f,y,b,T){return T=T||{},l+"?"+["bbox="+o(f,y,b),"format="+(T.format||"image/png"),"service="+(T.service||"WMS"),"version="+(T.version||"1.1.1"),"request="+(T.request||"GetMap"),"srs="+(T.srs||"EPSG:3857"),"width="+(T.width||256),"height="+(T.height||256),"layers="+h].join("&")},i.getTileBBox=o,i.getMercCoords=s,Object.defineProperty(i,"__esModule",{value:!0})})(e)})(0,le);var ge=le;class Ne{constructor(e,i,o){this.z=e,this.x=i,this.y=o,this.key=rt(0,e,e,i,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){let o=ge.getTileBBox(this.x,this.y,this.z),s=function(l,h,f){let y,b="";for(let T=l;T>0;T--)y=1<<T-1,b+=(h&y?1:0)+(f&y?2:0);return b}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",s).replace("{bbox-epsg-3857}",o)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ye{constructor(e,i){this.wrap=e,this.canonical=i,this.key=rt(e,i.z,i.z,i.x,i.y)}}class We{constructor(e,i,o,s,l){this.overscaledZ=e,this.wrap=i,this.canonical=new Ne(o,+s,+l),this.key=i===0&&e===o?this.canonical.key:rt(i,e,o,s,l)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){let i=this.canonical.z-e;return e>this.canonical.z?new We(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new We(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return rt(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{let o=this.canonical.z-e;return rt(this.wrap*+i,e,e,this.canonical.x>>o,this.canonical.y>>o)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;let i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new We(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let i=this.canonical.z+1,o=2*this.canonical.x,s=2*this.canonical.y;return[new We(i,this.wrap,i,o,s),new We(i,this.wrap,i,o+1,s),new We(i,this.wrap,i,o,s+1),new We(i,this.wrap,i,o+1,s+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new We(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new We(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ye(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function rt(t,e,i,o,s){let l=1<<Math.min(i,22),h=l*(s%l)+o%l;return t&&i<22&&(h+=l*l*((t<0?-2*t-1:2*t)%(1<<2*(22-i)))),16*(32*h+i)+(e-i)}let _t=[t=>{let e=t.canonical.x-1,i=t.wrap;return e<0&&(e=(1<<t.canonical.z)-1,i--),new We(t.overscaledZ,i,t.canonical.z,e,t.canonical.y)},t=>{let e=t.canonical.x+1,i=t.wrap;return e===1<<t.canonical.z&&(e=0,i++),new We(t.overscaledZ,i,t.canonical.z,e,t.canonical.y)},t=>new We(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(t.canonical.y===0?1<<t.canonical.z:t.canonical.y)-1),t=>new We(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)];mt(Ne,"CanonicalTileID"),mt(We,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});let Et=0,vt=25.5;function Tt(t){return Be*Math.cos(t*Math.PI/180)}function Xt(t){return(180+t)/360}function Nt(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function qt(t,e){return t/Tt(e)}function Gt(t){return 360*t-180}function yi(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function tn(t,e){return t*Tt(yi(e))}let ai=85.051129;function vn(t){return Math.cos(vi(ii(t,-ai,ai)))}function si(t,e){let i=ii(e,Et,vt),o=Math.pow(2,i);return vn(t)*Be/(512*o)}function Si(t){return 1/Math.cos(t*Math.PI/180)}function li(t,e=0){let i=Math.exp(Math.PI*(1-(t.y+e/st)/(1<<t.z)*2));return 80150034*i/(i*i+1)/st/(1<<t.z)}class Ii{constructor(e,i,o=0){this.x=+e,this.y=+i,this.z=+o}static fromLngLat(e,i=0){let o=pe.convert(e);return new Ii(Xt(o.lng),Nt(o.lat),qt(i,o.lat))}toLngLat(){return new pe(Gt(this.x),yi(this.y))}toAltitude(){return tn(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Be*Si(yi(this.y))}}function rn(t,e,i,o,s,l,h,f,y){let b=(e+o)/2,T=(i+s)/2,I=new nt(b,T);f(I),function(C,D,R,L,B,j){let Z=R-B,K=L-j;return Math.abs((L-D)*Z-(R-C)*K)/Math.hypot(Z,K)}(I.x,I.y,l.x,l.y,h.x,h.y)>=y?(rn(t,e,i,b,T,l,I,f,y),rn(t,b,T,o,s,I,h,f,y)):t.push(h)}function Di(t,e,i){let o=t[0],s=o.x,l=o.y;e(o);let h=[o];for(let f=1;f<t.length;f++){let y=t[f],{x:b,y:T}=y;e(y),rn(h,s,l,b,T,o,y,e,i),s=b,l=T,o=y}return h}function ur(t,e,i,o){if(o(e,i)){let s=e.add(i)._mult(.5);ur(t,e,s,o),ur(t,s,i,o)}else t.push(i)}function Sr(t,e){let i=t[0],o=[i];for(let s=1;s<t.length;s++){let l=t[s];ur(o,i,l,e),i=l}return o}let ao=Math.pow(2,14)-1,ga=-ao-1;function so(t,e){let i=Math.round(t.x*e),o=Math.round(t.y*e);return t.x=ii(i,ga,ao),t.y=ii(o,ga,ao),(i<t.x||i>t.x+1||o<t.y||o>t.y+1)&&Pn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function mr(t,e,i){let o=t.loadGeometry(),s=t.extent,l=st/s;if(e&&i&&i.projection.isReprojectedInTileSpace){let h=1<<e.z,{scale:f,x:y,y:b,projection:T}=i,I=C=>{let D=Gt((e.x+C.x/s)/h),R=yi((e.y+C.y/s)/h),L=T.project(D,R);C.x=(L.x*f-y)*s,C.y=(L.y*f-b)*s};for(let C=0;C<o.length;C++)if(t.type!==1)o[C]=Di(o[C],I,1);else{let D=[];for(let R of o[C])R.x<0||R.x>=s||R.y<0||R.y>=s||(I(R),D.push(R));o[C]=D}}for(let h of o)for(let f of h)so(f,l);return o}function tr(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?mr(t):[]}}function jr(t,e,i,o,s){t.emplaceBack(2*e+(o+1)/2,2*i+(s+1)/2)}function Yr(t,e,i){t.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class lo{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new ea,this.indexArray=new hr,this.segments=new Rn,this.programConfigurations=new U(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,o,s){let l=this.layers[0],h=[],f=null;l.type==="circle"&&(f=l.layout.get("circle-sort-key"));for(let{feature:b,id:T,index:I,sourceLayerIndex:C}of e){let D=this.layers[0]._featureFilter.needGeometry,R=tr(b,D);if(!this.layers[0]._featureFilter.filter(new yn(this.zoom),R,o))continue;let L=f?f.evaluate(R,{},o):void 0,B={id:T,properties:b.properties,type:b.type,sourceLayerIndex:C,index:I,geometry:D?R.geometry:mr(b,o,s),patterns:{},sortKey:L};h.push(B)}f&&h.sort((b,T)=>b.sortKey-T.sortKey);let y=null;s.projection.name==="globe"&&(this.globeExtVertexArray=new nh,y=s.projection);for(let b of h){let{geometry:T,index:I,sourceLayerIndex:C}=b,D=e[I].feature;this.addFeature(b,T,I,i.availableImages,o,y,i.brightness),i.featureIndex.insert(D,T,I,C,this.index)}}update(e,i,o,s,l){let h=Object.keys(e).length!==0;h&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,i,h?this.stateDependentLayers:this.layers,o,s,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,F0.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Kf.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,i,o,s,l,h,f){for(let y of i)for(let b of y){let T=b.x,I=b.y;if(T<0||T>=st||I<0||I>=st)continue;if(h){let R=h.projectTilePoint(T,I,l),L=h.upVector(l,T,I),B=this.globeExtVertexArray;Yr(B,R,L),Yr(B,R,L),Yr(B,R,L),Yr(B,R,L)}let C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),D=C.vertexLength;jr(this.layoutVertexArray,T,I,-1,-1),jr(this.layoutVertexArray,T,I,1,-1),jr(this.layoutVertexArray,T,I,1,1),jr(this.layoutVertexArray,T,I,-1,1),this.indexArray.emplaceBack(D,D+1,D+2),this.indexArray.emplaceBack(D,D+2,D+3),C.vertexLength+=4,C.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{},s,l,f)}}function ya(t,e){for(let i=0;i<t.length;i++)if(Oa(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(Oa(t,e[i]))return!0;return!!ad(t,e)}function gs(t,e,i){return!!Oa(t,e)||!!sd(e,t,i)}function Js(t,e){if(t.length===1)return ch(e,t[0]);for(let i=0;i<e.length;i++){let o=e[i];for(let s=0;s<o.length;s++)if(Oa(t,o[s]))return!0}for(let i=0;i<t.length;i++)if(ch(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(ad(t,e[i]))return!0;return!1}function od(t,e,i){if(t.length>1){if(ad(t,e))return!0;for(let o=0;o<e.length;o++)if(sd(e[o],t,i))return!0}for(let o=0;o<t.length;o++)if(sd(t[o],e,i))return!0;return!1}function ad(t,e){if(t.length===0||e.length===0)return!1;for(let i=0;i<t.length-1;i++){let o=t[i],s=t[i+1];for(let l=0;l<e.length-1;l++)if(Lm(o,s,e[l],e[l+1]))return!0}return!1}function Lm(t,e,i,o){return Co(t,i,o)!==Co(e,i,o)&&Co(t,e,i)!==Co(t,e,o)}function sd(t,e,i){let o=i*i;if(e.length===1)return t.distSqr(e[0])<o;for(let s=1;s<e.length;s++)if(Ul(t,e[s-1],e[s])<o)return!0;return!1}function Ul(t,e,i){let o=e.distSqr(i);if(o===0)return t.distSqr(e);let s=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/o;return t.distSqr(s<0?e:s>1?i:i.sub(e)._mult(s)._add(e))}function ch(t,e){let i,o,s,l=!1;for(let h=0;h<t.length;h++){i=t[h];for(let f=0,y=i.length-1;f<i.length;y=f++)o=i[f],s=i[y],o.y>e.y!=s.y>e.y&&e.x<(s.x-o.x)*(e.y-o.y)/(s.y-o.y)+o.x&&(l=!l)}return l}function Oa(t,e){let i=!1;for(let o=0,s=t.length-1;o<t.length;s=o++){let l=t[o],h=t[s];l.y>e.y!=h.y>e.y&&e.x<(h.x-l.x)*(e.y-l.y)/(h.y-l.y)+l.x&&(i=!i)}return i}function ix(t,e,i,o,s){for(let h of t)if(e<=h.x&&i<=h.y&&o>=h.x&&s>=h.y)return!0;let l=[new nt(e,i),new nt(e,s),new nt(o,s),new nt(o,i)];if(t.length>2){for(let h of l)if(Oa(t,h))return!0}for(let h=0;h<t.length-1;h++)if(bC(t[h],t[h+1],l))return!0;return!1}function bC(t,e,i){let o=i[0],s=i[2];if(t.x<o.x&&e.x<o.x||t.x>s.x&&e.x>s.x||t.y<o.y&&e.y<o.y||t.y>s.y&&e.y>s.y)return!1;let l=Co(t,e,i[0]);return l!==Co(t,e,i[1])||l!==Co(t,e,i[2])||l!==Co(t,e,i[3])}function dh(t,e,i,o,s,l){let h=e.y-t.y,f=t.x-e.x;if(l=l||0){let y=h*h+f*f;if(y===0)return!0;let b=Math.sqrt(y);h/=b,f/=b}return!((i.x-t.x)*h+(i.y-t.y)*f-l<0||(o.x-t.x)*h+(o.y-t.y)*f-l<0||(s.x-t.x)*h+(s.y-t.y)*f-l<0)}function B0(t,e,i,o,s,l,h){return!(dh(t,e,o,s,l,h)||dh(e,i,o,s,l,h)||dh(i,t,o,s,l,h)||dh(o,s,t,e,i,h)||dh(s,l,t,e,i,h)||dh(l,o,t,e,i,h))}function hh(t,e,i){let o=e.paint.get(t).value;return o.kind==="constant"?o.value:i.programConfigurations.get(e.id).getMaxValue(t)}function o_(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function nx(t,e,i,o,s){if(!e[0]&&!e[1])return t;let l=nt.convert(e)._mult(s);i==="viewport"&&l._rotate(-o);let h=[];for(let f=0;f<t.length;f++)h.push(t[f].sub(l));return h}function rx(t,e,i,o){let s=nt.convert(t)._mult(o);return e==="viewport"&&s._rotate(-i),s}mt(lo,"CircleBucket",{omit:["layers"]});let vC=new bn({"circle-sort-key":new At(ye.layout_circle["circle-sort-key"]),visibility:new Qe(ye.layout_circle.visibility)});var xC={paint:new bn({"circle-radius":new At(ye.paint_circle["circle-radius"]),"circle-color":new At(ye.paint_circle["circle-color"]),"circle-blur":new At(ye.paint_circle["circle-blur"]),"circle-opacity":new At(ye.paint_circle["circle-opacity"]),"circle-translate":new Qe(ye.paint_circle["circle-translate"]),"circle-translate-anchor":new Qe(ye.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Qe(ye.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Qe(ye.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new At(ye.paint_circle["circle-stroke-width"]),"circle-stroke-color":new At(ye.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new At(ye.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Qe(ye.paint_circle["circle-emissive-strength"])}),layout:vC},fr={},_r={};Object.defineProperty(_r,"__esModule",{value:!0}),_r.setMatrixArrayType=function(t){_r.ARRAY_TYPE=ax=t},_r.toRadian=function(t){return t*TC},_r.equals=function(t,e){return Math.abs(t-e)<=ox*Math.max(1,Math.abs(t),Math.abs(e))},_r.RANDOM=_r.ARRAY_TYPE=_r.EPSILON=void 0;var ox=1e-6;_r.EPSILON=ox;var ax=typeof Float32Array<"u"?Float32Array:Array;_r.ARRAY_TYPE=ax;var wC=Math.random;_r.RANDOM=wC;var TC=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var xn={};function N0(t){return N0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},N0(t)}Object.defineProperty(xn,"__esModule",{value:!0}),xn.create=function(){var t=new Gl.ARRAY_TYPE(4);return Gl.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},xn.clone=function(t){var e=new Gl.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},xn.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},xn.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},xn.fromValues=function(t,e,i,o){var s=new Gl.ARRAY_TYPE(4);return s[0]=t,s[1]=e,s[2]=i,s[3]=o,s},xn.set=function(t,e,i,o,s){return t[0]=e,t[1]=i,t[2]=o,t[3]=s,t},xn.transpose=function(t,e){if(t===e){var i=e[1];t[1]=e[2],t[2]=i}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},xn.invert=function(t,e){var i=e[0],o=e[1],s=e[2],l=e[3],h=i*l-s*o;return h?(t[0]=l*(h=1/h),t[1]=-o*h,t[2]=-s*h,t[3]=i*h,t):null},xn.adjoint=function(t,e){var i=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=i,t},xn.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},xn.multiply=lx,xn.rotate=function(t,e,i){var o=e[0],s=e[1],l=e[2],h=e[3],f=Math.sin(i),y=Math.cos(i);return t[0]=o*y+l*f,t[1]=s*y+h*f,t[2]=o*-f+l*y,t[3]=s*-f+h*y,t},xn.scale=function(t,e,i){var o=e[1],s=e[2],l=e[3],h=i[0],f=i[1];return t[0]=e[0]*h,t[1]=o*h,t[2]=s*f,t[3]=l*f,t},xn.fromRotation=function(t,e){var i=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=i,t[2]=-i,t[3]=o,t},xn.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},xn.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},xn.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},xn.LDU=function(t,e,i,o){return t[2]=o[2]/o[0],i[0]=o[0],i[1]=o[1],i[3]=o[3]-t[2]*i[1],[t,e,i]},xn.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},xn.subtract=cx,xn.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},xn.equals=function(t,e){var i=t[0],o=t[1],s=t[2],l=t[3],h=e[0],f=e[1],y=e[2],b=e[3];return Math.abs(i-h)<=Gl.EPSILON*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(o-f)<=Gl.EPSILON*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(s-y)<=Gl.EPSILON*Math.max(1,Math.abs(s),Math.abs(y))&&Math.abs(l-b)<=Gl.EPSILON*Math.max(1,Math.abs(l),Math.abs(b))},xn.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},xn.multiplyScalarAndAdd=function(t,e,i,o){return t[0]=e[0]+i[0]*o,t[1]=e[1]+i[1]*o,t[2]=e[2]+i[2]*o,t[3]=e[3]+i[3]*o,t},xn.sub=xn.mul=void 0;var Gl=function(t,e){if(t&&t.__esModule)return t;if(t===null||N0(t)!=="object"&&typeof t!="function")return{default:t};var i=sx(void 0);if(i&&i.has(t))return i.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var h=s?Object.getOwnPropertyDescriptor(t,l):null;h&&(h.get||h.set)?Object.defineProperty(o,l,h):o[l]=t[l]}return o.default=t,i&&i.set(t,o),o}(_r);function sx(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(sx=function(o){return o?i:e})(t)}function lx(t,e,i){var o=e[0],s=e[1],l=e[2],h=e[3],f=i[0],y=i[1],b=i[2],T=i[3];return t[0]=o*f+l*y,t[1]=s*f+h*y,t[2]=o*b+l*T,t[3]=s*b+h*T,t}function cx(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}xn.mul=lx,xn.sub=cx;var En={};function j0(t){return j0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},j0(t)}Object.defineProperty(En,"__esModule",{value:!0}),En.create=function(){var t=new ys.ARRAY_TYPE(6);return ys.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},En.clone=function(t){var e=new ys.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},En.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},En.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},En.fromValues=function(t,e,i,o,s,l){var h=new ys.ARRAY_TYPE(6);return h[0]=t,h[1]=e,h[2]=i,h[3]=o,h[4]=s,h[5]=l,h},En.set=function(t,e,i,o,s,l,h){return t[0]=e,t[1]=i,t[2]=o,t[3]=s,t[4]=l,t[5]=h,t},En.invert=function(t,e){var i=e[0],o=e[1],s=e[2],l=e[3],h=e[4],f=e[5],y=i*l-o*s;return y?(t[0]=l*(y=1/y),t[1]=-o*y,t[2]=-s*y,t[3]=i*y,t[4]=(s*f-l*h)*y,t[5]=(o*h-i*f)*y,t):null},En.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},En.multiply=hx,En.rotate=function(t,e,i){var o=e[0],s=e[1],l=e[2],h=e[3],f=e[4],y=e[5],b=Math.sin(i),T=Math.cos(i);return t[0]=o*T+l*b,t[1]=s*T+h*b,t[2]=o*-b+l*T,t[3]=s*-b+h*T,t[4]=f,t[5]=y,t},En.scale=function(t,e,i){var o=e[1],s=e[2],l=e[3],h=e[4],f=e[5],y=i[0],b=i[1];return t[0]=e[0]*y,t[1]=o*y,t[2]=s*b,t[3]=l*b,t[4]=h,t[5]=f,t},En.translate=function(t,e,i){var o=e[0],s=e[1],l=e[2],h=e[3],f=e[4],y=e[5],b=i[0],T=i[1];return t[0]=o,t[1]=s,t[2]=l,t[3]=h,t[4]=o*b+l*T+f,t[5]=s*b+h*T+y,t},En.fromRotation=function(t,e){var i=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=i,t[2]=-i,t[3]=o,t[4]=0,t[5]=0,t},En.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},En.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},En.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},En.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)},En.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t},En.subtract=ux,En.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t},En.multiplyScalarAndAdd=function(t,e,i,o){return t[0]=e[0]+i[0]*o,t[1]=e[1]+i[1]*o,t[2]=e[2]+i[2]*o,t[3]=e[3]+i[3]*o,t[4]=e[4]+i[4]*o,t[5]=e[5]+i[5]*o,t},En.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},En.equals=function(t,e){var i=t[0],o=t[1],s=t[2],l=t[3],h=t[4],f=t[5],y=e[0],b=e[1],T=e[2],I=e[3],C=e[4],D=e[5];return Math.abs(i-y)<=ys.EPSILON*Math.max(1,Math.abs(i),Math.abs(y))&&Math.abs(o-b)<=ys.EPSILON*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(s-T)<=ys.EPSILON*Math.max(1,Math.abs(s),Math.abs(T))&&Math.abs(l-I)<=ys.EPSILON*Math.max(1,Math.abs(l),Math.abs(I))&&Math.abs(h-C)<=ys.EPSILON*Math.max(1,Math.abs(h),Math.abs(C))&&Math.abs(f-D)<=ys.EPSILON*Math.max(1,Math.abs(f),Math.abs(D))},En.sub=En.mul=void 0;var ys=function(t,e){if(t&&t.__esModule)return t;if(t===null||j0(t)!=="object"&&typeof t!="function")return{default:t};var i=dx(void 0);if(i&&i.has(t))return i.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var h=s?Object.getOwnPropertyDescriptor(t,l):null;h&&(h.get||h.set)?Object.defineProperty(o,l,h):o[l]=t[l]}return o.default=t,i&&i.set(t,o),o}(_r);function dx(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(dx=function(o){return o?i:e})(t)}function hx(t,e,i){var o=e[0],s=e[1],l=e[2],h=e[3],f=e[4],y=e[5],b=i[0],T=i[1],I=i[2],C=i[3],D=i[4],R=i[5];return t[0]=o*b+l*T,t[1]=s*b+h*T,t[2]=o*I+l*C,t[3]=s*I+h*C,t[4]=o*D+l*R+f,t[5]=s*D+h*R+y,t}function ux(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t}En.mul=hx,En.sub=ux;var Ji={};function V0(t){return V0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},V0(t)}Object.defineProperty(Ji,"__esModule",{value:!0}),Ji.create=function(){var t=new ta.ARRAY_TYPE(9);return ta.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},Ji.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},Ji.clone=function(t){var e=new ta.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},Ji.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},Ji.fromValues=function(t,e,i,o,s,l,h,f,y){var b=new ta.ARRAY_TYPE(9);return b[0]=t,b[1]=e,b[2]=i,b[3]=o,b[4]=s,b[5]=l,b[6]=h,b[7]=f,b[8]=y,b},Ji.set=function(t,e,i,o,s,l,h,f,y,b){return t[0]=e,t[1]=i,t[2]=o,t[3]=s,t[4]=l,t[5]=h,t[6]=f,t[7]=y,t[8]=b,t},Ji.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},Ji.transpose=function(t,e){if(t===e){var i=e[1],o=e[2],s=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=o,t[7]=s}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},Ji.invert=function(t,e){var i=e[0],o=e[1],s=e[2],l=e[3],h=e[4],f=e[5],y=e[6],b=e[7],T=e[8],I=T*h-f*b,C=-T*l+f*y,D=b*l-h*y,R=i*I+o*C+s*D;return R?(t[0]=I*(R=1/R),t[1]=(-T*o+s*b)*R,t[2]=(f*o-s*h)*R,t[3]=C*R,t[4]=(T*i-s*y)*R,t[5]=(-f*i+s*l)*R,t[6]=D*R,t[7]=(-b*i+o*y)*R,t[8]=(h*i-o*l)*R,t):null},Ji.adjoint=function(t,e){var i=e[0],o=e[1],s=e[2],l=e[3],h=e[4],f=e[5],y=e[6],b=e[7],T=e[8];return t[0]=h*T-f*b,t[1]=s*b-o*T,t[2]=o*f-s*h,t[3]=f*y-l*T,t[4]=i*T-s*y,t[5]=s*l-i*f,t[6]=l*b-h*y,t[7]=o*y-i*b,t[8]=i*h-o*l,t},Ji.determinant=function(t){var e=t[3],i=t[4],o=t[5],s=t[6],l=t[7],h=t[8];return t[0]*(h*i-o*l)+t[1]*(-h*e+o*s)+t[2]*(l*e-i*s)},Ji.multiply=px,Ji.translate=function(t,e,i){var o=e[0],s=e[1],l=e[2],h=e[3],f=e[4],y=e[5],b=e[6],T=e[7],I=e[8],C=i[0],D=i[1];return t[0]=o,t[1]=s,t[2]=l,t[3]=h,t[4]=f,t[5]=y,t[6]=C*o+D*h+b,t[7]=C*s+D*f+T,t[8]=C*l+D*y+I,t},Ji.rotate=function(t,e,i){var o=e[0],s=e[1],l=e[2],h=e[3],f=e[4],y=e[5],b=e[6],T=e[7],I=e[8],C=Math.sin(i),D=Math.cos(i);return t[0]=D*o+C*h,t[1]=D*s+C*f,t[2]=D*l+C*y,t[3]=D*h-C*o,t[4]=D*f-C*s,t[5]=D*y-C*l,t[6]=b,t[7]=T,t[8]=I,t},Ji.scale=function(t,e,i){var o=i[0],s=i[1];return t[0]=o*e[0],t[1]=o*e[1],t[2]=o*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},Ji.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},Ji.fromRotation=function(t,e){var i=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=i,t[2]=0,t[3]=-i,t[4]=o,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},Ji.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},Ji.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},Ji.fromQuat=function(t,e){var i=e[0],o=e[1],s=e[2],l=e[3],h=i+i,f=o+o,y=s+s,b=i*h,T=o*h,I=o*f,C=s*h,D=s*f,R=s*y,L=l*h,B=l*f,j=l*y;return t[0]=1-I-R,t[3]=T-j,t[6]=C+B,t[1]=T+j,t[4]=1-b-R,t[7]=D-L,t[2]=C-B,t[5]=D+L,t[8]=1-b-I,t},Ji.normalFromMat4=function(t,e){var i=e[0],o=e[1],s=e[2],l=e[3],h=e[4],f=e[5],y=e[6],b=e[7],T=e[8],I=e[9],C=e[10],D=e[11],R=e[12],L=e[13],B=e[14],j=e[15],Z=i*f-o*h,K=i*y-s*h,Y=i*b-l*h,ne=o*y-s*f,te=o*b-l*f,se=s*b-l*y,he=T*L-I*R,fe=T*B-C*R,ve=T*j-D*R,_e=I*B-C*L,Se=I*j-D*L,ze=C*j-D*B,ke=Z*ze-K*Se+Y*_e+ne*ve-te*fe+se*he;return ke?(t[0]=(f*ze-y*Se+b*_e)*(ke=1/ke),t[1]=(y*ve-h*ze-b*fe)*ke,t[2]=(h*Se-f*ve+b*he)*ke,t[3]=(s*Se-o*ze-l*_e)*ke,t[4]=(i*ze-s*ve+l*fe)*ke,t[5]=(o*ve-i*Se-l*he)*ke,t[6]=(L*se-B*te+j*ne)*ke,t[7]=(B*Y-R*se-j*K)*ke,t[8]=(R*te-L*Y+j*Z)*ke,t):null},Ji.projection=function(t,e,i){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/i,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},Ji.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},Ji.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},Ji.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t},Ji.subtract=fx,Ji.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t},Ji.multiplyScalarAndAdd=function(t,e,i,o){return t[0]=e[0]+i[0]*o,t[1]=e[1]+i[1]*o,t[2]=e[2]+i[2]*o,t[3]=e[3]+i[3]*o,t[4]=e[4]+i[4]*o,t[5]=e[5]+i[5]*o,t[6]=e[6]+i[6]*o,t[7]=e[7]+i[7]*o,t[8]=e[8]+i[8]*o,t},Ji.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},Ji.equals=function(t,e){var i=t[0],o=t[1],s=t[2],l=t[3],h=t[4],f=t[5],y=t[6],b=t[7],T=t[8],I=e[0],C=e[1],D=e[2],R=e[3],L=e[4],B=e[5],j=e[6],Z=e[7],K=e[8];return Math.abs(i-I)<=ta.EPSILON*Math.max(1,Math.abs(i),Math.abs(I))&&Math.abs(o-C)<=ta.EPSILON*Math.max(1,Math.abs(o),Math.abs(C))&&Math.abs(s-D)<=ta.EPSILON*Math.max(1,Math.abs(s),Math.abs(D))&&Math.abs(l-R)<=ta.EPSILON*Math.max(1,Math.abs(l),Math.abs(R))&&Math.abs(h-L)<=ta.EPSILON*Math.max(1,Math.abs(h),Math.abs(L))&&Math.abs(f-B)<=ta.EPSILON*Math.max(1,Math.abs(f),Math.abs(B))&&Math.abs(y-j)<=ta.EPSILON*Math.max(1,Math.abs(y),Math.abs(j))&&Math.abs(b-Z)<=ta.EPSILON*Math.max(1,Math.abs(b),Math.abs(Z))&&Math.abs(T-K)<=ta.EPSILON*Math.max(1,Math.abs(T),Math.abs(K))},Ji.sub=Ji.mul=void 0;var ta=function(t,e){if(t&&t.__esModule)return t;if(t===null||V0(t)!=="object"&&typeof t!="function")return{default:t};var i=mx(void 0);if(i&&i.has(t))return i.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var h=s?Object.getOwnPropertyDescriptor(t,l):null;h&&(h.get||h.set)?Object.defineProperty(o,l,h):o[l]=t[l]}return o.default=t,i&&i.set(t,o),o}(_r);function mx(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(mx=function(o){return o?i:e})(t)}function px(t,e,i){var o=e[0],s=e[1],l=e[2],h=e[3],f=e[4],y=e[5],b=e[6],T=e[7],I=e[8],C=i[0],D=i[1],R=i[2],L=i[3],B=i[4],j=i[5],Z=i[6],K=i[7],Y=i[8];return t[0]=C*o+D*h+R*b,t[1]=C*s+D*f+R*T,t[2]=C*l+D*y+R*I,t[3]=L*o+B*h+j*b,t[4]=L*s+B*f+j*T,t[5]=L*l+B*y+j*I,t[6]=Z*o+K*h+Y*b,t[7]=Z*s+K*f+Y*T,t[8]=Z*l+K*y+Y*I,t}function fx(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t}Ji.mul=px,Ji.sub=fx;var Kt={};function U0(t){return U0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},U0(t)}Object.defineProperty(Kt,"__esModule",{value:!0}),Kt.create=function(){var t=new Nn.ARRAY_TYPE(16);return Nn.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},Kt.clone=function(t){var e=new Nn.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},Kt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Kt.fromValues=function(t,e,i,o,s,l,h,f,y,b,T,I,C,D,R,L){var B=new Nn.ARRAY_TYPE(16);return B[0]=t,B[1]=e,B[2]=i,B[3]=o,B[4]=s,B[5]=l,B[6]=h,B[7]=f,B[8]=y,B[9]=b,B[10]=T,B[11]=I,B[12]=C,B[13]=D,B[14]=R,B[15]=L,B},Kt.set=function(t,e,i,o,s,l,h,f,y,b,T,I,C,D,R,L,B){return t[0]=e,t[1]=i,t[2]=o,t[3]=s,t[4]=l,t[5]=h,t[6]=f,t[7]=y,t[8]=b,t[9]=T,t[10]=I,t[11]=C,t[12]=D,t[13]=R,t[14]=L,t[15]=B,t},Kt.identity=gx,Kt.transpose=function(t,e){if(t===e){var i=e[1],o=e[2],s=e[3],l=e[6],h=e[7],f=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=o,t[9]=l,t[11]=e[14],t[12]=s,t[13]=h,t[14]=f}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},Kt.invert=function(t,e){var i=e[0],o=e[1],s=e[2],l=e[3],h=e[4],f=e[5],y=e[6],b=e[7],T=e[8],I=e[9],C=e[10],D=e[11],R=e[12],L=e[13],B=e[14],j=e[15],Z=i*f-o*h,K=i*y-s*h,Y=i*b-l*h,ne=o*y-s*f,te=o*b-l*f,se=s*b-l*y,he=T*L-I*R,fe=T*B-C*R,ve=T*j-D*R,_e=I*B-C*L,Se=I*j-D*L,ze=C*j-D*B,ke=Z*ze-K*Se+Y*_e+ne*ve-te*fe+se*he;return ke?(t[0]=(f*ze-y*Se+b*_e)*(ke=1/ke),t[1]=(s*Se-o*ze-l*_e)*ke,t[2]=(L*se-B*te+j*ne)*ke,t[3]=(C*te-I*se-D*ne)*ke,t[4]=(y*ve-h*ze-b*fe)*ke,t[5]=(i*ze-s*ve+l*fe)*ke,t[6]=(B*Y-R*se-j*K)*ke,t[7]=(T*se-C*Y+D*K)*ke,t[8]=(h*Se-f*ve+b*he)*ke,t[9]=(o*ve-i*Se-l*he)*ke,t[10]=(R*te-L*Y+j*Z)*ke,t[11]=(I*Y-T*te-D*Z)*ke,t[12]=(f*fe-h*_e-y*he)*ke,t[13]=(i*_e-o*fe+s*he)*ke,t[14]=(L*K-R*ne-B*Z)*ke,t[15]=(T*ne-I*K+C*Z)*ke,t):null},Kt.adjoint=function(t,e){var i=e[0],o=e[1],s=e[2],l=e[3],h=e[4],f=e[5],y=e[6],b=e[7],T=e[8],I=e[9],C=e[10],D=e[11],R=e[12],L=e[13],B=e[14],j=e[15];return t[0]=f*(C*j-D*B)-I*(y*j-b*B)+L*(y*D-b*C),t[1]=-(o*(C*j-D*B)-I*(s*j-l*B)+L*(s*D-l*C)),t[2]=o*(y*j-b*B)-f*(s*j-l*B)+L*(s*b-l*y),t[3]=-(o*(y*D-b*C)-f*(s*D-l*C)+I*(s*b-l*y)),t[4]=-(h*(C*j-D*B)-T*(y*j-b*B)+R*(y*D-b*C)),t[5]=i*(C*j-D*B)-T*(s*j-l*B)+R*(s*D-l*C),t[6]=-(i*(y*j-b*B)-h*(s*j-l*B)+R*(s*b-l*y)),t[7]=i*(y*D-b*C)-h*(s*D-l*C)+T*(s*b-l*y),t[8]=h*(I*j-D*L)-T*(f*j-b*L)+R*(f*D-b*I),t[9]=-(i*(I*j-D*L)-T*(o*j-l*L)+R*(o*D-l*I)),t[10]=i*(f*j-b*L)-h*(o*j-l*L)+R*(o*b-l*f),t[11]=-(i*(f*D-b*I)-h*(o*D-l*I)+T*(o*b-l*f)),t[12]=-(h*(I*B-C*L)-T*(f*B-y*L)+R*(f*C-y*I)),t[13]=i*(I*B-C*L)-T*(o*B-s*L)+R*(o*C-s*I),t[14]=-(i*(f*B-y*L)-h*(o*B-s*L)+R*(o*y-s*f)),t[15]=i*(f*C-y*I)-h*(o*C-s*I)+T*(o*y-s*f),t},Kt.determinant=function(t){var e=t[0],i=t[1],o=t[2],s=t[3],l=t[4],h=t[5],f=t[6],y=t[7],b=t[8],T=t[9],I=t[10],C=t[11],D=t[12],R=t[13],L=t[14],B=t[15];return(e*h-i*l)*(I*B-C*L)-(e*f-o*l)*(T*B-C*R)+(e*y-s*l)*(T*L-I*R)+(i*f-o*h)*(b*B-C*D)-(i*y-s*h)*(b*L-I*D)+(o*y-s*f)*(b*R-T*D)},Kt.multiply=yx,Kt.translate=function(t,e,i){var o,s,l,h,f,y,b,T,I,C,D,R,L=i[0],B=i[1],j=i[2];return e===t?(t[12]=e[0]*L+e[4]*B+e[8]*j+e[12],t[13]=e[1]*L+e[5]*B+e[9]*j+e[13],t[14]=e[2]*L+e[6]*B+e[10]*j+e[14],t[15]=e[3]*L+e[7]*B+e[11]*j+e[15]):(s=e[1],l=e[2],h=e[3],f=e[4],y=e[5],b=e[6],T=e[7],I=e[8],C=e[9],D=e[10],R=e[11],t[0]=o=e[0],t[1]=s,t[2]=l,t[3]=h,t[4]=f,t[5]=y,t[6]=b,t[7]=T,t[8]=I,t[9]=C,t[10]=D,t[11]=R,t[12]=o*L+f*B+I*j+e[12],t[13]=s*L+y*B+C*j+e[13],t[14]=l*L+b*B+D*j+e[14],t[15]=h*L+T*B+R*j+e[15]),t},Kt.scale=function(t,e,i){var o=i[0],s=i[1],l=i[2];return t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t[3]=e[3]*o,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*l,t[9]=e[9]*l,t[10]=e[10]*l,t[11]=e[11]*l,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Kt.rotate=function(t,e,i,o){var s,l,h,f,y,b,T,I,C,D,R,L,B,j,Z,K,Y,ne,te,se,he,fe,ve,_e,Se=o[0],ze=o[1],ke=o[2],Re=Math.hypot(Se,ze,ke);return Re<Nn.EPSILON?null:(Se*=Re=1/Re,ze*=Re,ke*=Re,s=Math.sin(i),l=Math.cos(i),y=e[1],b=e[2],T=e[3],C=e[5],D=e[6],R=e[7],B=e[9],j=e[10],Z=e[11],K=Se*Se*(h=1-l)+l,te=Se*ze*h-ke*s,se=ze*ze*h+l,he=ke*ze*h+Se*s,fe=Se*ke*h+ze*s,ve=ze*ke*h-Se*s,_e=ke*ke*h+l,t[0]=(f=e[0])*K+(I=e[4])*(Y=ze*Se*h+ke*s)+(L=e[8])*(ne=ke*Se*h-ze*s),t[1]=y*K+C*Y+B*ne,t[2]=b*K+D*Y+j*ne,t[3]=T*K+R*Y+Z*ne,t[4]=f*te+I*se+L*he,t[5]=y*te+C*se+B*he,t[6]=b*te+D*se+j*he,t[7]=T*te+R*se+Z*he,t[8]=f*fe+I*ve+L*_e,t[9]=y*fe+C*ve+B*_e,t[10]=b*fe+D*ve+j*_e,t[11]=T*fe+R*ve+Z*_e,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},Kt.rotateX=function(t,e,i){var o=Math.sin(i),s=Math.cos(i),l=e[4],h=e[5],f=e[6],y=e[7],b=e[8],T=e[9],I=e[10],C=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=l*s+b*o,t[5]=h*s+T*o,t[6]=f*s+I*o,t[7]=y*s+C*o,t[8]=b*s-l*o,t[9]=T*s-h*o,t[10]=I*s-f*o,t[11]=C*s-y*o,t},Kt.rotateY=function(t,e,i){var o=Math.sin(i),s=Math.cos(i),l=e[0],h=e[1],f=e[2],y=e[3],b=e[8],T=e[9],I=e[10],C=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=l*s-b*o,t[1]=h*s-T*o,t[2]=f*s-I*o,t[3]=y*s-C*o,t[8]=l*o+b*s,t[9]=h*o+T*s,t[10]=f*o+I*s,t[11]=y*o+C*s,t},Kt.rotateZ=function(t,e,i){var o=Math.sin(i),s=Math.cos(i),l=e[0],h=e[1],f=e[2],y=e[3],b=e[4],T=e[5],I=e[6],C=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=l*s+b*o,t[1]=h*s+T*o,t[2]=f*s+I*o,t[3]=y*s+C*o,t[4]=b*s-l*o,t[5]=T*s-h*o,t[6]=I*s-f*o,t[7]=C*s-y*o,t},Kt.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},Kt.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Kt.fromRotation=function(t,e,i){var o,s,l,h=i[0],f=i[1],y=i[2],b=Math.hypot(h,f,y);return b<Nn.EPSILON?null:(h*=b=1/b,f*=b,y*=b,o=Math.sin(e),s=Math.cos(e),t[0]=h*h*(l=1-s)+s,t[1]=f*h*l+y*o,t[2]=y*h*l-f*o,t[3]=0,t[4]=h*f*l-y*o,t[5]=f*f*l+s,t[6]=y*f*l+h*o,t[7]=0,t[8]=h*y*l+f*o,t[9]=f*y*l-h*o,t[10]=y*y*l+s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},Kt.fromXRotation=function(t,e){var i=Math.sin(e),o=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=i,t[7]=0,t[8]=0,t[9]=-i,t[10]=o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Kt.fromYRotation=function(t,e){var i=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=0,t[2]=-i,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=i,t[9]=0,t[10]=o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Kt.fromZRotation=function(t,e){var i=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=i,t[2]=0,t[3]=0,t[4]=-i,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Kt.fromRotationTranslation=bx,Kt.fromQuat2=function(t,e){var i=new Nn.ARRAY_TYPE(3),o=-e[0],s=-e[1],l=-e[2],h=e[3],f=e[4],y=e[5],b=e[6],T=e[7],I=o*o+s*s+l*l+h*h;return I>0?(i[0]=2*(f*h+T*o+y*l-b*s)/I,i[1]=2*(y*h+T*s+b*o-f*l)/I,i[2]=2*(b*h+T*l+f*s-y*o)/I):(i[0]=2*(f*h+T*o+y*l-b*s),i[1]=2*(y*h+T*s+b*o-f*l),i[2]=2*(b*h+T*l+f*s-y*o)),bx(t,e,i),t},Kt.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},Kt.getScaling=vx,Kt.getRotation=function(t,e){var i=new Nn.ARRAY_TYPE(3);vx(i,e);var o=1/i[0],s=1/i[1],l=1/i[2],h=e[0]*o,f=e[1]*s,y=e[2]*l,b=e[4]*o,T=e[5]*s,I=e[6]*l,C=e[8]*o,D=e[9]*s,R=e[10]*l,L=h+T+R,B=0;return L>0?(B=2*Math.sqrt(L+1),t[3]=.25*B,t[0]=(I-D)/B,t[1]=(C-y)/B,t[2]=(f-b)/B):h>T&&h>R?(B=2*Math.sqrt(1+h-T-R),t[3]=(I-D)/B,t[0]=.25*B,t[1]=(f+b)/B,t[2]=(C+y)/B):T>R?(B=2*Math.sqrt(1+T-h-R),t[3]=(C-y)/B,t[0]=(f+b)/B,t[1]=.25*B,t[2]=(I+D)/B):(B=2*Math.sqrt(1+R-h-T),t[3]=(f-b)/B,t[0]=(C+y)/B,t[1]=(I+D)/B,t[2]=.25*B),t},Kt.fromRotationTranslationScale=function(t,e,i,o){var s=e[0],l=e[1],h=e[2],f=e[3],y=s+s,b=l+l,T=h+h,I=s*y,C=s*b,D=s*T,R=l*b,L=l*T,B=h*T,j=f*y,Z=f*b,K=f*T,Y=o[0],ne=o[1],te=o[2];return t[0]=(1-(R+B))*Y,t[1]=(C+K)*Y,t[2]=(D-Z)*Y,t[3]=0,t[4]=(C-K)*ne,t[5]=(1-(I+B))*ne,t[6]=(L+j)*ne,t[7]=0,t[8]=(D+Z)*te,t[9]=(L-j)*te,t[10]=(1-(I+R))*te,t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t},Kt.fromRotationTranslationScaleOrigin=function(t,e,i,o,s){var l=e[0],h=e[1],f=e[2],y=e[3],b=l+l,T=h+h,I=f+f,C=l*b,D=l*T,R=l*I,L=h*T,B=h*I,j=f*I,Z=y*b,K=y*T,Y=y*I,ne=o[0],te=o[1],se=o[2],he=s[0],fe=s[1],ve=s[2],_e=(1-(L+j))*ne,Se=(D+Y)*ne,ze=(R-K)*ne,ke=(D-Y)*te,Re=(1-(C+j))*te,we=(B+Z)*te,Pe=(R+K)*se,et=(B-Z)*se,Fe=(1-(C+L))*se;return t[0]=_e,t[1]=Se,t[2]=ze,t[3]=0,t[4]=ke,t[5]=Re,t[6]=we,t[7]=0,t[8]=Pe,t[9]=et,t[10]=Fe,t[11]=0,t[12]=i[0]+he-(_e*he+ke*fe+Pe*ve),t[13]=i[1]+fe-(Se*he+Re*fe+et*ve),t[14]=i[2]+ve-(ze*he+we*fe+Fe*ve),t[15]=1,t},Kt.fromQuat=function(t,e){var i=e[0],o=e[1],s=e[2],l=e[3],h=i+i,f=o+o,y=s+s,b=i*h,T=o*h,I=o*f,C=s*h,D=s*f,R=s*y,L=l*h,B=l*f,j=l*y;return t[0]=1-I-R,t[1]=T+j,t[2]=C-B,t[3]=0,t[4]=T-j,t[5]=1-b-R,t[6]=D+L,t[7]=0,t[8]=C+B,t[9]=D-L,t[10]=1-b-I,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Kt.frustum=function(t,e,i,o,s,l,h){var f=1/(i-e),y=1/(s-o),b=1/(l-h);return t[0]=2*l*f,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*l*y,t[6]=0,t[7]=0,t[8]=(i+e)*f,t[9]=(s+o)*y,t[10]=(h+l)*b,t[11]=-1,t[12]=0,t[13]=0,t[14]=h*l*2*b,t[15]=0,t},Kt.perspectiveNO=xx,Kt.perspectiveZO=function(t,e,i,o,s){var l,h=1/Math.tan(e/2);return t[0]=h/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0?(t[10]=s*(l=1/(o-s)),t[14]=s*o*l):(t[10]=-1,t[14]=-o),t},Kt.perspectiveFromFieldOfView=function(t,e,i,o){var s=Math.tan(e.upDegrees*Math.PI/180),l=Math.tan(e.downDegrees*Math.PI/180),h=Math.tan(e.leftDegrees*Math.PI/180),f=Math.tan(e.rightDegrees*Math.PI/180),y=2/(h+f),b=2/(s+l);return t[0]=y,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=b,t[6]=0,t[7]=0,t[8]=-(h-f)*y*.5,t[9]=(s-l)*b*.5,t[10]=o/(i-o),t[11]=-1,t[12]=0,t[13]=0,t[14]=o*i/(i-o),t[15]=0,t},Kt.orthoNO=wx,Kt.orthoZO=function(t,e,i,o,s,l,h){var f=1/(e-i),y=1/(o-s),b=1/(l-h);return t[0]=-2*f,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*y,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=b,t[11]=0,t[12]=(e+i)*f,t[13]=(s+o)*y,t[14]=l*b,t[15]=1,t},Kt.lookAt=function(t,e,i,o){var s,l,h,f,y,b,T,I,C,D,R=e[0],L=e[1],B=e[2],j=o[0],Z=o[1],K=o[2],Y=i[0],ne=i[1],te=i[2];return Math.abs(R-Y)<Nn.EPSILON&&Math.abs(L-ne)<Nn.EPSILON&&Math.abs(B-te)<Nn.EPSILON?gx(t):(T=R-Y,I=L-ne,C=B-te,s=Z*(C*=D=1/Math.hypot(T,I,C))-K*(I*=D),l=K*(T*=D)-j*C,h=j*I-Z*T,(D=Math.hypot(s,l,h))?(s*=D=1/D,l*=D,h*=D):(s=0,l=0,h=0),f=I*h-C*l,y=C*s-T*h,b=T*l-I*s,(D=Math.hypot(f,y,b))?(f*=D=1/D,y*=D,b*=D):(f=0,y=0,b=0),t[0]=s,t[1]=f,t[2]=T,t[3]=0,t[4]=l,t[5]=y,t[6]=I,t[7]=0,t[8]=h,t[9]=b,t[10]=C,t[11]=0,t[12]=-(s*R+l*L+h*B),t[13]=-(f*R+y*L+b*B),t[14]=-(T*R+I*L+C*B),t[15]=1,t)},Kt.targetTo=function(t,e,i,o){var s=e[0],l=e[1],h=e[2],f=o[0],y=o[1],b=o[2],T=s-i[0],I=l-i[1],C=h-i[2],D=T*T+I*I+C*C;D>0&&(T*=D=1/Math.sqrt(D),I*=D,C*=D);var R=y*C-b*I,L=b*T-f*C,B=f*I-y*T;return(D=R*R+L*L+B*B)>0&&(R*=D=1/Math.sqrt(D),L*=D,B*=D),t[0]=R,t[1]=L,t[2]=B,t[3]=0,t[4]=I*B-C*L,t[5]=C*R-T*B,t[6]=T*L-I*R,t[7]=0,t[8]=T,t[9]=I,t[10]=C,t[11]=0,t[12]=s,t[13]=l,t[14]=h,t[15]=1,t},Kt.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},Kt.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},Kt.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t[9]=e[9]+i[9],t[10]=e[10]+i[10],t[11]=e[11]+i[11],t[12]=e[12]+i[12],t[13]=e[13]+i[13],t[14]=e[14]+i[14],t[15]=e[15]+i[15],t},Kt.subtract=Tx,Kt.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12]*i,t[13]=e[13]*i,t[14]=e[14]*i,t[15]=e[15]*i,t},Kt.multiplyScalarAndAdd=function(t,e,i,o){return t[0]=e[0]+i[0]*o,t[1]=e[1]+i[1]*o,t[2]=e[2]+i[2]*o,t[3]=e[3]+i[3]*o,t[4]=e[4]+i[4]*o,t[5]=e[5]+i[5]*o,t[6]=e[6]+i[6]*o,t[7]=e[7]+i[7]*o,t[8]=e[8]+i[8]*o,t[9]=e[9]+i[9]*o,t[10]=e[10]+i[10]*o,t[11]=e[11]+i[11]*o,t[12]=e[12]+i[12]*o,t[13]=e[13]+i[13]*o,t[14]=e[14]+i[14]*o,t[15]=e[15]+i[15]*o,t},Kt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},Kt.equals=function(t,e){var i=t[0],o=t[1],s=t[2],l=t[3],h=t[4],f=t[5],y=t[6],b=t[7],T=t[8],I=t[9],C=t[10],D=t[11],R=t[12],L=t[13],B=t[14],j=t[15],Z=e[0],K=e[1],Y=e[2],ne=e[3],te=e[4],se=e[5],he=e[6],fe=e[7],ve=e[8],_e=e[9],Se=e[10],ze=e[11],ke=e[12],Re=e[13],we=e[14],Pe=e[15];return Math.abs(i-Z)<=Nn.EPSILON*Math.max(1,Math.abs(i),Math.abs(Z))&&Math.abs(o-K)<=Nn.EPSILON*Math.max(1,Math.abs(o),Math.abs(K))&&Math.abs(s-Y)<=Nn.EPSILON*Math.max(1,Math.abs(s),Math.abs(Y))&&Math.abs(l-ne)<=Nn.EPSILON*Math.max(1,Math.abs(l),Math.abs(ne))&&Math.abs(h-te)<=Nn.EPSILON*Math.max(1,Math.abs(h),Math.abs(te))&&Math.abs(f-se)<=Nn.EPSILON*Math.max(1,Math.abs(f),Math.abs(se))&&Math.abs(y-he)<=Nn.EPSILON*Math.max(1,Math.abs(y),Math.abs(he))&&Math.abs(b-fe)<=Nn.EPSILON*Math.max(1,Math.abs(b),Math.abs(fe))&&Math.abs(T-ve)<=Nn.EPSILON*Math.max(1,Math.abs(T),Math.abs(ve))&&Math.abs(I-_e)<=Nn.EPSILON*Math.max(1,Math.abs(I),Math.abs(_e))&&Math.abs(C-Se)<=Nn.EPSILON*Math.max(1,Math.abs(C),Math.abs(Se))&&Math.abs(D-ze)<=Nn.EPSILON*Math.max(1,Math.abs(D),Math.abs(ze))&&Math.abs(R-ke)<=Nn.EPSILON*Math.max(1,Math.abs(R),Math.abs(ke))&&Math.abs(L-Re)<=Nn.EPSILON*Math.max(1,Math.abs(L),Math.abs(Re))&&Math.abs(B-we)<=Nn.EPSILON*Math.max(1,Math.abs(B),Math.abs(we))&&Math.abs(j-Pe)<=Nn.EPSILON*Math.max(1,Math.abs(j),Math.abs(Pe))},Kt.sub=Kt.mul=Kt.ortho=Kt.perspective=void 0;var Nn=function(t,e){if(t&&t.__esModule)return t;if(t===null||U0(t)!=="object"&&typeof t!="function")return{default:t};var i=_x(void 0);if(i&&i.has(t))return i.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var h=s?Object.getOwnPropertyDescriptor(t,l):null;h&&(h.get||h.set)?Object.defineProperty(o,l,h):o[l]=t[l]}return o.default=t,i&&i.set(t,o),o}(_r);function _x(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(_x=function(o){return o?i:e})(t)}function gx(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function yx(t,e,i){var o=e[0],s=e[1],l=e[2],h=e[3],f=e[4],y=e[5],b=e[6],T=e[7],I=e[8],C=e[9],D=e[10],R=e[11],L=e[12],B=e[13],j=e[14],Z=e[15],K=i[0],Y=i[1],ne=i[2],te=i[3];return t[0]=K*o+Y*f+ne*I+te*L,t[1]=K*s+Y*y+ne*C+te*B,t[2]=K*l+Y*b+ne*D+te*j,t[3]=K*h+Y*T+ne*R+te*Z,t[4]=(K=i[4])*o+(Y=i[5])*f+(ne=i[6])*I+(te=i[7])*L,t[5]=K*s+Y*y+ne*C+te*B,t[6]=K*l+Y*b+ne*D+te*j,t[7]=K*h+Y*T+ne*R+te*Z,t[8]=(K=i[8])*o+(Y=i[9])*f+(ne=i[10])*I+(te=i[11])*L,t[9]=K*s+Y*y+ne*C+te*B,t[10]=K*l+Y*b+ne*D+te*j,t[11]=K*h+Y*T+ne*R+te*Z,t[12]=(K=i[12])*o+(Y=i[13])*f+(ne=i[14])*I+(te=i[15])*L,t[13]=K*s+Y*y+ne*C+te*B,t[14]=K*l+Y*b+ne*D+te*j,t[15]=K*h+Y*T+ne*R+te*Z,t}function bx(t,e,i){var o=e[0],s=e[1],l=e[2],h=e[3],f=o+o,y=s+s,b=l+l,T=o*f,I=o*y,C=o*b,D=s*y,R=s*b,L=l*b,B=h*f,j=h*y,Z=h*b;return t[0]=1-(D+L),t[1]=I+Z,t[2]=C-j,t[3]=0,t[4]=I-Z,t[5]=1-(T+L),t[6]=R+B,t[7]=0,t[8]=C+j,t[9]=R-B,t[10]=1-(T+D),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function vx(t,e){var i=e[4],o=e[5],s=e[6],l=e[8],h=e[9],f=e[10];return t[0]=Math.hypot(e[0],e[1],e[2]),t[1]=Math.hypot(i,o,s),t[2]=Math.hypot(l,h,f),t}function xx(t,e,i,o,s){var l,h=1/Math.tan(e/2);return t[0]=h/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0?(t[10]=(s+o)*(l=1/(o-s)),t[14]=2*s*o*l):(t[10]=-1,t[14]=-2*o),t}function wx(t,e,i,o,s,l,h){var f=1/(e-i),y=1/(o-s),b=1/(l-h);return t[0]=-2*f,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*y,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*b,t[11]=0,t[12]=(e+i)*f,t[13]=(s+o)*y,t[14]=(h+l)*b,t[15]=1,t}function Tx(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t[9]=e[9]-i[9],t[10]=e[10]-i[10],t[11]=e[11]-i[11],t[12]=e[12]-i[12],t[13]=e[13]-i[13],t[14]=e[14]-i[14],t[15]=e[15]-i[15],t}Kt.perspective=xx,Kt.ortho=wx,Kt.mul=yx,Kt.sub=Tx;var Zt={},Yt={};function G0(t){return G0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},G0(t)}Object.defineProperty(Yt,"__esModule",{value:!0}),Yt.create=Ix,Yt.clone=function(t){var e=new el.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},Yt.length=Sx,Yt.fromValues=function(t,e,i){var o=new el.ARRAY_TYPE(3);return o[0]=t,o[1]=e,o[2]=i,o},Yt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},Yt.set=function(t,e,i,o){return t[0]=e,t[1]=i,t[2]=o,t},Yt.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t},Yt.subtract=Cx,Yt.multiply=Mx,Yt.divide=Ex,Yt.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},Yt.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},Yt.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t},Yt.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t},Yt.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},Yt.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t},Yt.scaleAndAdd=function(t,e,i,o){return t[0]=e[0]+i[0]*o,t[1]=e[1]+i[1]*o,t[2]=e[2]+i[2]*o,t},Yt.distance=Ax,Yt.squaredDistance=Dx,Yt.squaredLength=Px,Yt.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},Yt.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},Yt.normalize=function(t,e){var i=e[0],o=e[1],s=e[2],l=i*i+o*o+s*s;return l>0&&(l=1/Math.sqrt(l)),t[0]=e[0]*l,t[1]=e[1]*l,t[2]=e[2]*l,t},Yt.dot=Rx,Yt.cross=function(t,e,i){var o=e[0],s=e[1],l=e[2],h=i[0],f=i[1],y=i[2];return t[0]=s*y-l*f,t[1]=l*h-o*y,t[2]=o*f-s*h,t},Yt.lerp=function(t,e,i,o){var s=e[0],l=e[1],h=e[2];return t[0]=s+o*(i[0]-s),t[1]=l+o*(i[1]-l),t[2]=h+o*(i[2]-h),t},Yt.hermite=function(t,e,i,o,s,l){var h=l*l,f=h*(2*l-3)+1,y=h*(l-2)+l,b=h*(l-1),T=h*(3-2*l);return t[0]=e[0]*f+i[0]*y+o[0]*b+s[0]*T,t[1]=e[1]*f+i[1]*y+o[1]*b+s[1]*T,t[2]=e[2]*f+i[2]*y+o[2]*b+s[2]*T,t},Yt.bezier=function(t,e,i,o,s,l){var h=1-l,f=h*h,y=l*l,b=f*h,T=3*l*f,I=3*y*h,C=y*l;return t[0]=e[0]*b+i[0]*T+o[0]*I+s[0]*C,t[1]=e[1]*b+i[1]*T+o[1]*I+s[1]*C,t[2]=e[2]*b+i[2]*T+o[2]*I+s[2]*C,t},Yt.random=function(t,e){e=e||1;var i=2*el.RANDOM()*Math.PI,o=2*el.RANDOM()-1,s=Math.sqrt(1-o*o)*e;return t[0]=Math.cos(i)*s,t[1]=Math.sin(i)*s,t[2]=o*e,t},Yt.transformMat4=function(t,e,i){var o=e[0],s=e[1],l=e[2],h=i[3]*o+i[7]*s+i[11]*l+i[15];return t[0]=(i[0]*o+i[4]*s+i[8]*l+i[12])/(h=h||1),t[1]=(i[1]*o+i[5]*s+i[9]*l+i[13])/h,t[2]=(i[2]*o+i[6]*s+i[10]*l+i[14])/h,t},Yt.transformMat3=function(t,e,i){var o=e[0],s=e[1],l=e[2];return t[0]=o*i[0]+s*i[3]+l*i[6],t[1]=o*i[1]+s*i[4]+l*i[7],t[2]=o*i[2]+s*i[5]+l*i[8],t},Yt.transformQuat=function(t,e,i){var o=i[0],s=i[1],l=i[2],h=e[0],f=e[1],y=e[2],b=s*y-l*f,T=l*h-o*y,I=o*f-s*h,C=s*I-l*T,D=l*b-o*I,R=o*T-s*b,L=2*i[3];return T*=L,I*=L,D*=2,R*=2,t[0]=h+(b*=L)+(C*=2),t[1]=f+T+D,t[2]=y+I+R,t},Yt.rotateX=function(t,e,i,o){var s=[],l=[];return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],l[0]=s[0],l[1]=s[1]*Math.cos(o)-s[2]*Math.sin(o),l[2]=s[1]*Math.sin(o)+s[2]*Math.cos(o),t[0]=l[0]+i[0],t[1]=l[1]+i[1],t[2]=l[2]+i[2],t},Yt.rotateY=function(t,e,i,o){var s=[],l=[];return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],l[0]=s[2]*Math.sin(o)+s[0]*Math.cos(o),l[1]=s[1],l[2]=s[2]*Math.cos(o)-s[0]*Math.sin(o),t[0]=l[0]+i[0],t[1]=l[1]+i[1],t[2]=l[2]+i[2],t},Yt.rotateZ=function(t,e,i,o){var s=[],l=[];return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],l[0]=s[0]*Math.cos(o)-s[1]*Math.sin(o),l[1]=s[0]*Math.sin(o)+s[1]*Math.cos(o),l[2]=s[2],t[0]=l[0]+i[0],t[1]=l[1]+i[1],t[2]=l[2]+i[2],t},Yt.angle=function(t,e){var i=t[0],o=t[1],s=t[2],l=e[0],h=e[1],f=e[2],y=Math.sqrt(i*i+o*o+s*s)*Math.sqrt(l*l+h*h+f*f),b=y&&Rx(t,e)/y;return Math.acos(Math.min(Math.max(b,-1),1))},Yt.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t},Yt.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},Yt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},Yt.equals=function(t,e){var i=t[0],o=t[1],s=t[2],l=e[0],h=e[1],f=e[2];return Math.abs(i-l)<=el.EPSILON*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(o-h)<=el.EPSILON*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(s-f)<=el.EPSILON*Math.max(1,Math.abs(s),Math.abs(f))},Yt.forEach=Yt.sqrLen=Yt.len=Yt.sqrDist=Yt.dist=Yt.div=Yt.mul=Yt.sub=void 0;var el=function(t,e){if(t&&t.__esModule)return t;if(t===null||G0(t)!=="object"&&typeof t!="function")return{default:t};var i=kx(void 0);if(i&&i.has(t))return i.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var h=s?Object.getOwnPropertyDescriptor(t,l):null;h&&(h.get||h.set)?Object.defineProperty(o,l,h):o[l]=t[l]}return o.default=t,i&&i.set(t,o),o}(_r);function kx(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(kx=function(o){return o?i:e})(t)}function Ix(){var t=new el.ARRAY_TYPE(3);return el.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Sx(t){return Math.hypot(t[0],t[1],t[2])}function Cx(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function Mx(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function Ex(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t}function Ax(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])}function Dx(t,e){var i=e[0]-t[0],o=e[1]-t[1],s=e[2]-t[2];return i*i+o*o+s*s}function Px(t){var e=t[0],i=t[1],o=t[2];return e*e+i*i+o*o}function Rx(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}Yt.sub=Cx,Yt.mul=Mx,Yt.div=Ex,Yt.dist=Ax,Yt.sqrDist=Dx,Yt.len=Sx,Yt.sqrLen=Px;var tl,kC=(tl=Ix(),function(t,e,i,o,s,l){var h,f;for(e||(e=3),i||(i=0),f=o?Math.min(o*e+i,t.length):t.length,h=i;h<f;h+=e)tl[0]=t[h],tl[1]=t[h+1],tl[2]=t[h+2],s(tl,tl,l),t[h]=tl[0],t[h+1]=tl[1],t[h+2]=tl[2];return t});Yt.forEach=kC;var di={};function $0(t){return $0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$0(t)}Object.defineProperty(di,"__esModule",{value:!0}),di.create=zx,di.clone=function(t){var e=new ba.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},di.fromValues=function(t,e,i,o){var s=new ba.ARRAY_TYPE(4);return s[0]=t,s[1]=e,s[2]=i,s[3]=o,s},di.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},di.set=function(t,e,i,o,s){return t[0]=e,t[1]=i,t[2]=o,t[3]=s,t},di.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},di.subtract=Ox,di.multiply=Fx,di.divide=Bx,di.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},di.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},di.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t[3]=Math.min(e[3],i[3]),t},di.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t[3]=Math.max(e[3],i[3]),t},di.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},di.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},di.scaleAndAdd=function(t,e,i,o){return t[0]=e[0]+i[0]*o,t[1]=e[1]+i[1]*o,t[2]=e[2]+i[2]*o,t[3]=e[3]+i[3]*o,t},di.distance=Nx,di.squaredDistance=jx,di.length=Vx,di.squaredLength=Ux,di.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},di.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},di.normalize=function(t,e){var i=e[0],o=e[1],s=e[2],l=e[3],h=i*i+o*o+s*s+l*l;return h>0&&(h=1/Math.sqrt(h)),t[0]=i*h,t[1]=o*h,t[2]=s*h,t[3]=l*h,t},di.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},di.cross=function(t,e,i,o){var s=i[0]*o[1]-i[1]*o[0],l=i[0]*o[2]-i[2]*o[0],h=i[0]*o[3]-i[3]*o[0],f=i[1]*o[2]-i[2]*o[1],y=i[1]*o[3]-i[3]*o[1],b=i[2]*o[3]-i[3]*o[2],T=e[0],I=e[1],C=e[2],D=e[3];return t[0]=I*b-C*y+D*f,t[1]=-T*b+C*h-D*l,t[2]=T*y-I*h+D*s,t[3]=-T*f+I*l-C*s,t},di.lerp=function(t,e,i,o){var s=e[0],l=e[1],h=e[2],f=e[3];return t[0]=s+o*(i[0]-s),t[1]=l+o*(i[1]-l),t[2]=h+o*(i[2]-h),t[3]=f+o*(i[3]-f),t},di.random=function(t,e){var i,o,s,l,h,f;e=e||1;do h=(i=2*ba.RANDOM()-1)*i+(o=2*ba.RANDOM()-1)*o;while(h>=1);do f=(s=2*ba.RANDOM()-1)*s+(l=2*ba.RANDOM()-1)*l;while(f>=1);var y=Math.sqrt((1-h)/f);return t[0]=e*i,t[1]=e*o,t[2]=e*s*y,t[3]=e*l*y,t},di.transformMat4=function(t,e,i){var o=e[0],s=e[1],l=e[2],h=e[3];return t[0]=i[0]*o+i[4]*s+i[8]*l+i[12]*h,t[1]=i[1]*o+i[5]*s+i[9]*l+i[13]*h,t[2]=i[2]*o+i[6]*s+i[10]*l+i[14]*h,t[3]=i[3]*o+i[7]*s+i[11]*l+i[15]*h,t},di.transformQuat=function(t,e,i){var o=e[0],s=e[1],l=e[2],h=i[0],f=i[1],y=i[2],b=i[3],T=b*o+f*l-y*s,I=b*s+y*o-h*l,C=b*l+h*s-f*o,D=-h*o-f*s-y*l;return t[0]=T*b+D*-h+I*-y-C*-f,t[1]=I*b+D*-f+C*-h-T*-y,t[2]=C*b+D*-y+T*-f-I*-h,t[3]=e[3],t},di.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},di.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},di.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},di.equals=function(t,e){var i=t[0],o=t[1],s=t[2],l=t[3],h=e[0],f=e[1],y=e[2],b=e[3];return Math.abs(i-h)<=ba.EPSILON*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(o-f)<=ba.EPSILON*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(s-y)<=ba.EPSILON*Math.max(1,Math.abs(s),Math.abs(y))&&Math.abs(l-b)<=ba.EPSILON*Math.max(1,Math.abs(l),Math.abs(b))},di.forEach=di.sqrLen=di.len=di.sqrDist=di.dist=di.div=di.mul=di.sub=void 0;var ba=function(t,e){if(t&&t.__esModule)return t;if(t===null||$0(t)!=="object"&&typeof t!="function")return{default:t};var i=Lx(void 0);if(i&&i.has(t))return i.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var h=s?Object.getOwnPropertyDescriptor(t,l):null;h&&(h.get||h.set)?Object.defineProperty(o,l,h):o[l]=t[l]}return o.default=t,i&&i.set(t,o),o}(_r);function Lx(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(Lx=function(o){return o?i:e})(t)}function zx(){var t=new ba.ARRAY_TYPE(4);return ba.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Ox(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}function Fx(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t}function Bx(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t[3]=e[3]/i[3],t}function Nx(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3])}function jx(t,e){var i=e[0]-t[0],o=e[1]-t[1],s=e[2]-t[2],l=e[3]-t[3];return i*i+o*o+s*s+l*l}function Vx(t){return Math.hypot(t[0],t[1],t[2],t[3])}function Ux(t){var e=t[0],i=t[1],o=t[2],s=t[3];return e*e+i*i+o*o+s*s}di.sub=Ox,di.mul=Fx,di.div=Bx,di.dist=Nx,di.sqrDist=jx,di.len=Vx,di.sqrLen=Ux;var IC=function(){var t=zx();return function(e,i,o,s,l,h){var f,y;for(i||(i=4),o||(o=0),y=s?Math.min(s*i+o,e.length):e.length,f=o;f<y;f+=i)t[0]=e[f],t[1]=e[f+1],t[2]=e[f+2],t[3]=e[f+3],l(t,t,h),e[f]=t[0],e[f+1]=t[1],e[f+2]=t[2],e[f+3]=t[3];return e}}();function q0(t){return q0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},q0(t)}di.forEach=IC,Object.defineProperty(Zt,"__esModule",{value:!0}),Zt.create=H0,Zt.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},Zt.setAxisAngle=$x,Zt.getAxisAngle=function(t,e){var i=2*Math.acos(e[3]),o=Math.sin(i/2);return o>ld.EPSILON?(t[0]=e[0]/o,t[1]=e[1]/o,t[2]=e[2]/o):(t[0]=1,t[1]=0,t[2]=0),i},Zt.getAngle=function(t,e){var i=Yx(t,e);return Math.acos(2*i*i-1)},Zt.multiply=qx,Zt.rotateX=function(t,e,i){i*=.5;var o=e[0],s=e[1],l=e[2],h=e[3],f=Math.sin(i),y=Math.cos(i);return t[0]=o*y+h*f,t[1]=s*y+l*f,t[2]=l*y-s*f,t[3]=h*y-o*f,t},Zt.rotateY=function(t,e,i){i*=.5;var o=e[0],s=e[1],l=e[2],h=e[3],f=Math.sin(i),y=Math.cos(i);return t[0]=o*y-l*f,t[1]=s*y+h*f,t[2]=l*y+o*f,t[3]=h*y-s*f,t},Zt.rotateZ=function(t,e,i){i*=.5;var o=e[0],s=e[1],l=e[2],h=e[3],f=Math.sin(i),y=Math.cos(i);return t[0]=o*y+s*f,t[1]=s*y-o*f,t[2]=l*y+h*f,t[3]=h*y-l*f,t},Zt.calculateW=function(t,e){var i=e[0],o=e[1],s=e[2];return t[0]=i,t[1]=o,t[2]=s,t[3]=Math.sqrt(Math.abs(1-i*i-o*o-s*s)),t},Zt.exp=Hx,Zt.ln=Zx,Zt.pow=function(t,e,i){return Zx(t,e),Xx(t,t,i),Hx(t,t),t},Zt.slerp=s_,Zt.random=function(t){var e=ld.RANDOM(),i=ld.RANDOM(),o=ld.RANDOM(),s=Math.sqrt(1-e),l=Math.sqrt(e);return t[0]=s*Math.sin(2*Math.PI*i),t[1]=s*Math.cos(2*Math.PI*i),t[2]=l*Math.sin(2*Math.PI*o),t[3]=l*Math.cos(2*Math.PI*o),t},Zt.invert=function(t,e){var i=e[0],o=e[1],s=e[2],l=e[3],h=i*i+o*o+s*s+l*l,f=h?1/h:0;return t[0]=-i*f,t[1]=-o*f,t[2]=-s*f,t[3]=l*f,t},Zt.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},Zt.fromMat3=Wx,Zt.fromEuler=function(t,e,i,o){var s=.5*Math.PI/180;e*=s,i*=s,o*=s;var l=Math.sin(e),h=Math.cos(e),f=Math.sin(i),y=Math.cos(i),b=Math.sin(o),T=Math.cos(o);return t[0]=l*y*T-h*f*b,t[1]=h*f*T+l*y*b,t[2]=h*y*b-l*f*T,t[3]=h*y*T+l*f*b,t},Zt.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Zt.setAxes=Zt.sqlerp=Zt.rotationTo=Zt.equals=Zt.exactEquals=Zt.normalize=Zt.sqrLen=Zt.squaredLength=Zt.len=Zt.length=Zt.lerp=Zt.dot=Zt.scale=Zt.mul=Zt.add=Zt.set=Zt.copy=Zt.fromValues=Zt.clone=void 0;var ld=a_(_r),SC=a_(Ji),il=a_(Yt),ia=a_(di);function Gx(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(Gx=function(o){return o?i:e})(t)}function a_(t,e){if(!e&&t&&t.__esModule)return t;if(t===null||q0(t)!=="object"&&typeof t!="function")return{default:t};var i=Gx(e);if(i&&i.has(t))return i.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var h=s?Object.getOwnPropertyDescriptor(t,l):null;h&&(h.get||h.set)?Object.defineProperty(o,l,h):o[l]=t[l]}return o.default=t,i&&i.set(t,o),o}function H0(){var t=new ld.ARRAY_TYPE(4);return ld.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function $x(t,e,i){i*=.5;var o=Math.sin(i);return t[0]=o*e[0],t[1]=o*e[1],t[2]=o*e[2],t[3]=Math.cos(i),t}function qx(t,e,i){var o=e[0],s=e[1],l=e[2],h=e[3],f=i[0],y=i[1],b=i[2],T=i[3];return t[0]=o*T+h*f+s*b-l*y,t[1]=s*T+h*y+l*f-o*b,t[2]=l*T+h*b+o*y-s*f,t[3]=h*T-o*f-s*y-l*b,t}function Hx(t,e){var i=e[0],o=e[1],s=e[2],l=e[3],h=Math.sqrt(i*i+o*o+s*s),f=Math.exp(l),y=h>0?f*Math.sin(h)/h:0;return t[0]=i*y,t[1]=o*y,t[2]=s*y,t[3]=f*Math.cos(h),t}function Zx(t,e){var i=e[0],o=e[1],s=e[2],l=e[3],h=Math.sqrt(i*i+o*o+s*s),f=h>0?Math.atan2(h,l)/h:0;return t[0]=i*f,t[1]=o*f,t[2]=s*f,t[3]=.5*Math.log(i*i+o*o+s*s+l*l),t}function s_(t,e,i,o){var s,l,h,f,y,b=e[0],T=e[1],I=e[2],C=e[3],D=i[0],R=i[1],L=i[2],B=i[3];return(l=b*D+T*R+I*L+C*B)<0&&(l=-l,D=-D,R=-R,L=-L,B=-B),1-l>ld.EPSILON?(s=Math.acos(l),h=Math.sin(s),f=Math.sin((1-o)*s)/h,y=Math.sin(o*s)/h):(f=1-o,y=o),t[0]=f*b+y*D,t[1]=f*T+y*R,t[2]=f*I+y*L,t[3]=f*C+y*B,t}function Wx(t,e){var i,o=e[0]+e[4]+e[8];if(o>0)i=Math.sqrt(o+1),t[3]=.5*i,t[0]=(e[5]-e[7])*(i=.5/i),t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{var s=0;e[4]>e[0]&&(s=1),e[8]>e[3*s+s]&&(s=2);var l=(s+1)%3,h=(s+2)%3;i=Math.sqrt(e[3*s+s]-e[3*l+l]-e[3*h+h]+1),t[s]=.5*i,t[3]=(e[3*l+h]-e[3*h+l])*(i=.5/i),t[l]=(e[3*l+s]+e[3*s+l])*i,t[h]=(e[3*h+s]+e[3*s+h])*i}return t}Zt.clone=ia.clone,Zt.fromValues=ia.fromValues,Zt.copy=ia.copy,Zt.set=ia.set,Zt.add=ia.add,Zt.mul=qx;var Xx=ia.scale;Zt.scale=Xx;var Yx=ia.dot;Zt.dot=Yx,Zt.lerp=ia.lerp;var Kx=ia.length;Zt.length=Kx,Zt.len=Kx;var Qx=ia.squaredLength;Zt.squaredLength=Qx,Zt.sqrLen=Qx;var Z0=ia.normalize;Zt.normalize=Z0,Zt.exactEquals=ia.exactEquals,Zt.equals=ia.equals;var Fa,Jx,e1,CC=(Fa=il.create(),Jx=il.fromValues(1,0,0),e1=il.fromValues(0,1,0),function(t,e,i){var o=il.dot(e,i);return o<-.999999?(il.cross(Fa,Jx,e),il.len(Fa)<1e-6&&il.cross(Fa,e1,e),il.normalize(Fa,Fa),$x(t,Fa,Math.PI),t):o>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(il.cross(Fa,e,i),t[0]=Fa[0],t[1]=Fa[1],t[2]=Fa[2],t[3]=1+o,Z0(t,t))});Zt.rotationTo=CC;var W0,X0,MC=(W0=H0(),X0=H0(),function(t,e,i,o,s,l){return s_(W0,e,s,l),s_(X0,i,o,l),s_(t,W0,X0,2*l*(1-l)),t});Zt.sqlerp=MC;var Ba,EC=(Ba=SC.create(),function(t,e,i,o){return Ba[0]=i[0],Ba[3]=i[1],Ba[6]=i[2],Ba[1]=o[0],Ba[4]=o[1],Ba[7]=o[2],Ba[2]=-e[0],Ba[5]=-e[1],Ba[8]=-e[2],Z0(t,Wx(t,Ba))});Zt.setAxes=EC;var xi={};function Y0(t){return Y0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Y0(t)}Object.defineProperty(xi,"__esModule",{value:!0}),xi.create=function(){var t=new xo.ARRAY_TYPE(8);return xo.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},xi.clone=function(t){var e=new xo.ARRAY_TYPE(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},xi.fromValues=function(t,e,i,o,s,l,h,f){var y=new xo.ARRAY_TYPE(8);return y[0]=t,y[1]=e,y[2]=i,y[3]=o,y[4]=s,y[5]=l,y[6]=h,y[7]=f,y},xi.fromRotationTranslationValues=function(t,e,i,o,s,l,h){var f=new xo.ARRAY_TYPE(8);f[0]=t,f[1]=e,f[2]=i,f[3]=o;var y=.5*s,b=.5*l,T=.5*h;return f[4]=y*o+b*i-T*e,f[5]=b*o+T*t-y*i,f[6]=T*o+y*e-b*t,f[7]=-y*t-b*e-T*i,f},xi.fromRotationTranslation=n1,xi.fromTranslation=function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},xi.fromRotation=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},xi.fromMat4=function(t,e){var i=nl.create();t1.getRotation(i,e);var o=new xo.ARRAY_TYPE(3);return t1.getTranslation(o,e),n1(t,i,o),t},xi.copy=r1,xi.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},xi.set=function(t,e,i,o,s,l,h,f,y){return t[0]=e,t[1]=i,t[2]=o,t[3]=s,t[4]=l,t[5]=h,t[6]=f,t[7]=y,t},xi.getDual=function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},xi.setDual=function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},xi.getTranslation=function(t,e){var i=e[4],o=e[5],s=e[6],l=e[7],h=-e[0],f=-e[1],y=-e[2],b=e[3];return t[0]=2*(i*b+l*h+o*y-s*f),t[1]=2*(o*b+l*f+s*h-i*y),t[2]=2*(s*b+l*y+i*f-o*h),t},xi.translate=function(t,e,i){var o=e[0],s=e[1],l=e[2],h=e[3],f=.5*i[0],y=.5*i[1],b=.5*i[2],T=e[4],I=e[5],C=e[6],D=e[7];return t[0]=o,t[1]=s,t[2]=l,t[3]=h,t[4]=h*f+s*b-l*y+T,t[5]=h*y+l*f-o*b+I,t[6]=h*b+o*y-s*f+C,t[7]=-o*f-s*y-l*b+D,t},xi.rotateX=function(t,e,i){var o=-e[0],s=-e[1],l=-e[2],h=e[3],f=e[4],y=e[5],b=e[6],T=e[7],I=f*h+T*o+y*l-b*s,C=y*h+T*s+b*o-f*l,D=b*h+T*l+f*s-y*o,R=T*h-f*o-y*s-b*l;return nl.rotateX(t,e,i),t[4]=I*(h=t[3])+R*(o=t[0])+C*(l=t[2])-D*(s=t[1]),t[5]=C*h+R*s+D*o-I*l,t[6]=D*h+R*l+I*s-C*o,t[7]=R*h-I*o-C*s-D*l,t},xi.rotateY=function(t,e,i){var o=-e[0],s=-e[1],l=-e[2],h=e[3],f=e[4],y=e[5],b=e[6],T=e[7],I=f*h+T*o+y*l-b*s,C=y*h+T*s+b*o-f*l,D=b*h+T*l+f*s-y*o,R=T*h-f*o-y*s-b*l;return nl.rotateY(t,e,i),t[4]=I*(h=t[3])+R*(o=t[0])+C*(l=t[2])-D*(s=t[1]),t[5]=C*h+R*s+D*o-I*l,t[6]=D*h+R*l+I*s-C*o,t[7]=R*h-I*o-C*s-D*l,t},xi.rotateZ=function(t,e,i){var o=-e[0],s=-e[1],l=-e[2],h=e[3],f=e[4],y=e[5],b=e[6],T=e[7],I=f*h+T*o+y*l-b*s,C=y*h+T*s+b*o-f*l,D=b*h+T*l+f*s-y*o,R=T*h-f*o-y*s-b*l;return nl.rotateZ(t,e,i),t[4]=I*(h=t[3])+R*(o=t[0])+C*(l=t[2])-D*(s=t[1]),t[5]=C*h+R*s+D*o-I*l,t[6]=D*h+R*l+I*s-C*o,t[7]=R*h-I*o-C*s-D*l,t},xi.rotateByQuatAppend=function(t,e,i){var o=i[0],s=i[1],l=i[2],h=i[3],f=e[0],y=e[1],b=e[2],T=e[3];return t[0]=f*h+T*o+y*l-b*s,t[1]=y*h+T*s+b*o-f*l,t[2]=b*h+T*l+f*s-y*o,t[3]=T*h-f*o-y*s-b*l,t[4]=(f=e[4])*h+(T=e[7])*o+(y=e[5])*l-(b=e[6])*s,t[5]=y*h+T*s+b*o-f*l,t[6]=b*h+T*l+f*s-y*o,t[7]=T*h-f*o-y*s-b*l,t},xi.rotateByQuatPrepend=function(t,e,i){var o=e[0],s=e[1],l=e[2],h=e[3],f=i[0],y=i[1],b=i[2],T=i[3];return t[0]=o*T+h*f+s*b-l*y,t[1]=s*T+h*y+l*f-o*b,t[2]=l*T+h*b+o*y-s*f,t[3]=h*T-o*f-s*y-l*b,t[4]=o*(T=i[7])+h*(f=i[4])+s*(b=i[6])-l*(y=i[5]),t[5]=s*T+h*y+l*f-o*b,t[6]=l*T+h*b+o*y-s*f,t[7]=h*T-o*f-s*y-l*b,t},xi.rotateAroundAxis=function(t,e,i,o){if(Math.abs(o)<xo.EPSILON)return r1(t,e);var s=Math.hypot(i[0],i[1],i[2]);o*=.5;var l=Math.sin(o),h=l*i[0]/s,f=l*i[1]/s,y=l*i[2]/s,b=Math.cos(o),T=e[0],I=e[1],C=e[2],D=e[3];t[0]=T*b+D*h+I*y-C*f,t[1]=I*b+D*f+C*h-T*y,t[2]=C*b+D*y+T*f-I*h,t[3]=D*b-T*h-I*f-C*y;var R=e[4],L=e[5],B=e[6],j=e[7];return t[4]=R*b+j*h+L*y-B*f,t[5]=L*b+j*f+B*h-R*y,t[6]=B*b+j*y+R*f-L*h,t[7]=j*b-R*h-L*f-B*y,t},xi.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t},xi.multiply=o1,xi.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t},xi.lerp=function(t,e,i,o){var s=1-o;return a1(e,i)<0&&(o=-o),t[0]=e[0]*s+i[0]*o,t[1]=e[1]*s+i[1]*o,t[2]=e[2]*s+i[2]*o,t[3]=e[3]*s+i[3]*o,t[4]=e[4]*s+i[4]*o,t[5]=e[5]*s+i[5]*o,t[6]=e[6]*s+i[6]*o,t[7]=e[7]*s+i[7]*o,t},xi.invert=function(t,e){var i=l_(e);return t[0]=-e[0]/i,t[1]=-e[1]/i,t[2]=-e[2]/i,t[3]=e[3]/i,t[4]=-e[4]/i,t[5]=-e[5]/i,t[6]=-e[6]/i,t[7]=e[7]/i,t},xi.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},xi.normalize=function(t,e){var i=l_(e);if(i>0){i=Math.sqrt(i);var o=e[0]/i,s=e[1]/i,l=e[2]/i,h=e[3]/i,f=e[4],y=e[5],b=e[6],T=e[7],I=o*f+s*y+l*b+h*T;t[0]=o,t[1]=s,t[2]=l,t[3]=h,t[4]=(f-o*I)/i,t[5]=(y-s*I)/i,t[6]=(b-l*I)/i,t[7]=(T-h*I)/i}return t},xi.str=function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},xi.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},xi.equals=function(t,e){var i=t[0],o=t[1],s=t[2],l=t[3],h=t[4],f=t[5],y=t[6],b=t[7],T=e[0],I=e[1],C=e[2],D=e[3],R=e[4],L=e[5],B=e[6],j=e[7];return Math.abs(i-T)<=xo.EPSILON*Math.max(1,Math.abs(i),Math.abs(T))&&Math.abs(o-I)<=xo.EPSILON*Math.max(1,Math.abs(o),Math.abs(I))&&Math.abs(s-C)<=xo.EPSILON*Math.max(1,Math.abs(s),Math.abs(C))&&Math.abs(l-D)<=xo.EPSILON*Math.max(1,Math.abs(l),Math.abs(D))&&Math.abs(h-R)<=xo.EPSILON*Math.max(1,Math.abs(h),Math.abs(R))&&Math.abs(f-L)<=xo.EPSILON*Math.max(1,Math.abs(f),Math.abs(L))&&Math.abs(y-B)<=xo.EPSILON*Math.max(1,Math.abs(y),Math.abs(B))&&Math.abs(b-j)<=xo.EPSILON*Math.max(1,Math.abs(b),Math.abs(j))},xi.sqrLen=xi.squaredLength=xi.len=xi.length=xi.dot=xi.mul=xi.setReal=xi.getReal=void 0;var xo=K0(_r),nl=K0(Zt),t1=K0(Kt);function i1(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(i1=function(o){return o?i:e})(t)}function K0(t,e){if(!e&&t&&t.__esModule)return t;if(t===null||Y0(t)!=="object"&&typeof t!="function")return{default:t};var i=i1(e);if(i&&i.has(t))return i.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var h=s?Object.getOwnPropertyDescriptor(t,l):null;h&&(h.get||h.set)?Object.defineProperty(o,l,h):o[l]=t[l]}return o.default=t,i&&i.set(t,o),o}function n1(t,e,i){var o=.5*i[0],s=.5*i[1],l=.5*i[2],h=e[0],f=e[1],y=e[2],b=e[3];return t[0]=h,t[1]=f,t[2]=y,t[3]=b,t[4]=o*b+s*y-l*f,t[5]=s*b+l*h-o*y,t[6]=l*b+o*f-s*h,t[7]=-o*h-s*f-l*y,t}function r1(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function o1(t,e,i){var o=e[0],s=e[1],l=e[2],h=e[3],f=i[4],y=i[5],b=i[6],T=i[7],I=e[4],C=e[5],D=e[6],R=e[7],L=i[0],B=i[1],j=i[2],Z=i[3];return t[0]=o*Z+h*L+s*j-l*B,t[1]=s*Z+h*B+l*L-o*j,t[2]=l*Z+h*j+o*B-s*L,t[3]=h*Z-o*L-s*B-l*j,t[4]=o*T+h*f+s*b-l*y+I*Z+R*L+C*j-D*B,t[5]=s*T+h*y+l*f-o*b+C*Z+R*B+D*L-I*j,t[6]=l*T+h*b+o*y-s*f+D*Z+R*j+I*B-C*L,t[7]=h*T-o*f-s*y-l*b+R*Z-I*L-C*B-D*j,t}xi.getReal=nl.copy,xi.setReal=nl.copy,xi.mul=o1;var a1=nl.dot;xi.dot=a1;var s1=nl.length;xi.length=s1,xi.len=s1;var l_=nl.squaredLength;xi.squaredLength=l_,xi.sqrLen=l_;var oi={};function Q0(t){return Q0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Q0(t)}Object.defineProperty(oi,"__esModule",{value:!0}),oi.create=c1,oi.clone=function(t){var e=new cd.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},oi.fromValues=function(t,e){var i=new cd.ARRAY_TYPE(2);return i[0]=t,i[1]=e,i},oi.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},oi.set=function(t,e,i){return t[0]=e,t[1]=i,t},oi.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t},oi.subtract=d1,oi.multiply=h1,oi.divide=u1,oi.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},oi.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},oi.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t},oi.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t},oi.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},oi.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t},oi.scaleAndAdd=function(t,e,i,o){return t[0]=e[0]+i[0]*o,t[1]=e[1]+i[1]*o,t},oi.distance=m1,oi.squaredDistance=p1,oi.length=f1,oi.squaredLength=_1,oi.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},oi.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},oi.normalize=function(t,e){var i=e[0],o=e[1],s=i*i+o*o;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t},oi.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},oi.cross=function(t,e,i){var o=e[0]*i[1]-e[1]*i[0];return t[0]=t[1]=0,t[2]=o,t},oi.lerp=function(t,e,i,o){var s=e[0],l=e[1];return t[0]=s+o*(i[0]-s),t[1]=l+o*(i[1]-l),t},oi.random=function(t,e){e=e||1;var i=2*cd.RANDOM()*Math.PI;return t[0]=Math.cos(i)*e,t[1]=Math.sin(i)*e,t},oi.transformMat2=function(t,e,i){var o=e[0],s=e[1];return t[0]=i[0]*o+i[2]*s,t[1]=i[1]*o+i[3]*s,t},oi.transformMat2d=function(t,e,i){var o=e[0],s=e[1];return t[0]=i[0]*o+i[2]*s+i[4],t[1]=i[1]*o+i[3]*s+i[5],t},oi.transformMat3=function(t,e,i){var o=e[0],s=e[1];return t[0]=i[0]*o+i[3]*s+i[6],t[1]=i[1]*o+i[4]*s+i[7],t},oi.transformMat4=function(t,e,i){var o=e[0],s=e[1];return t[0]=i[0]*o+i[4]*s+i[12],t[1]=i[1]*o+i[5]*s+i[13],t},oi.rotate=function(t,e,i,o){var s=e[0]-i[0],l=e[1]-i[1],h=Math.sin(o),f=Math.cos(o);return t[0]=s*f-l*h+i[0],t[1]=s*h+l*f+i[1],t},oi.angle=function(t,e){var i=t[0],o=t[1],s=e[0],l=e[1],h=Math.sqrt(i*i+o*o)*Math.sqrt(s*s+l*l);return Math.acos(Math.min(Math.max(h&&(i*s+o*l)/h,-1),1))},oi.zero=function(t){return t[0]=0,t[1]=0,t},oi.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},oi.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},oi.equals=function(t,e){var i=t[0],o=t[1],s=e[0],l=e[1];return Math.abs(i-s)<=cd.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(o-l)<=cd.EPSILON*Math.max(1,Math.abs(o),Math.abs(l))},oi.forEach=oi.sqrLen=oi.sqrDist=oi.dist=oi.div=oi.mul=oi.sub=oi.len=void 0;var cd=function(t,e){if(t&&t.__esModule)return t;if(t===null||Q0(t)!=="object"&&typeof t!="function")return{default:t};var i=l1(void 0);if(i&&i.has(t))return i.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var h=s?Object.getOwnPropertyDescriptor(t,l):null;h&&(h.get||h.set)?Object.defineProperty(o,l,h):o[l]=t[l]}return o.default=t,i&&i.set(t,o),o}(_r);function l1(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(l1=function(o){return o?i:e})(t)}function c1(){var t=new cd.ARRAY_TYPE(2);return cd.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function d1(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}function h1(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t}function u1(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t}function m1(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1])}function p1(t,e){var i=e[0]-t[0],o=e[1]-t[1];return i*i+o*o}function f1(t){return Math.hypot(t[0],t[1])}function _1(t){var e=t[0],i=t[1];return e*e+i*i}oi.len=f1,oi.sub=d1,oi.mul=h1,oi.div=u1,oi.dist=m1,oi.sqrDist=p1,oi.sqrLen=_1;var AC=function(){var t=c1();return function(e,i,o,s,l,h){var f,y;for(i||(i=2),o||(o=0),y=s?Math.min(s*i+o,e.length):e.length,f=o;f<y;f+=i)t[0]=e[f],t[1]=e[f+1],l(t,t,h),e[f]=t[0],e[f+1]=t[1];return e}}();function J0(t){return J0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},J0(t)}oi.forEach=AC,Object.defineProperty(fr,"__esModule",{value:!0}),r.a7=fr.vec4=r.N=fr.vec3=fr.vec2=fr.quat2=r.bi=fr.quat=r.a6=fr.mat4=r.co=fr.mat3=fr.mat2d=r.b4=fr.mat2=fr.glMatrix=void 0;var DC=bs(_r);fr.glMatrix=DC;var PC=bs(xn);r.b4=fr.mat2=PC;var RC=bs(En);fr.mat2d=RC;var LC=bs(Ji);r.co=fr.mat3=LC;var zC=bs(Kt);r.a6=fr.mat4=zC;var OC=bs(Zt);r.bi=fr.quat=OC;var FC=bs(xi);fr.quat2=FC;var BC=bs(oi);fr.vec2=BC;var NC=bs(Yt);r.N=fr.vec3=NC;var jC=bs(di);function g1(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(g1=function(o){return o?i:e})(t)}function bs(t,e){if(!e&&t&&t.__esModule)return t;if(t===null||J0(t)!=="object"&&typeof t!="function")return{default:t};var i=g1(e);if(i&&i.has(t))return i.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var h=s?Object.getOwnPropertyDescriptor(t,l):null;h&&(h.get||h.set)?Object.defineProperty(o,l,h):o[l]=t[l]}return o.default=t,i&&i.set(t,o),o}r.a7=fr.vec4=jC;class ey{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,o){let s=r.N.dot(i,this.dir);if(Math.abs(s)<1e-6)return!1;let l=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/s;return o[0]=this.pos[0]+this.dir[0]*l,o[1]=this.pos[1]+this.dir[1]*l,o[2]=this.pos[2]+this.dir[2]*l,!0}closestPointOnSphere(e,i,o){if(r.N.equals(this.pos,e)||i===0)return o[0]=o[1]=o[2]=0,!1;let[s,l,h]=this.dir,f=this.pos[0]-e[0],y=this.pos[1]-e[1],b=this.pos[2]-e[2],T=s*s+l*l+h*h,I=2*(f*s+y*l+b*h),C=I*I-4*T*(f*f+y*y+b*b-i*i);if(C<0){let D=Math.max(-I/2,0),R=f+s*D,L=y+l*D,B=b+h*D,j=Math.hypot(R,L,B);return o[0]=R*i/j,o[1]=L*i/j,o[2]=B*i/j,!1}{let D=(-I-Math.sqrt(C))/(2*T);if(D<0){let R=Math.hypot(f,y,b);return o[0]=f*i/R,o[1]=y*i/R,o[2]=b*i/R,!1}return o[0]=f+s*D,o[1]=y+l*D,o[2]=b+h*D,!0}}}class ty{constructor(e,i,o,s,l){this.TL=e,this.TR=i,this.BR=o,this.BL=s,this.horizon=l}static fromInvProjectionMatrix(e,i,o){let s=[-1,1,1],l=[1,1,1],h=[1,-1,1],f=[-1,-1,1],y=r.N.transformMat4(s,s,e),b=r.N.transformMat4(l,l,e),T=r.N.transformMat4(h,h,e),I=r.N.transformMat4(f,f,e);return new ty(y,b,T,I,i/o)}}function zm(t,e,i){let o=1/0,s=-1/0,l=[];for(let h of t){r.N.sub(l,h,e);let f=r.N.dot(l,i);o=Math.min(o,f),s=Math.max(s,f)}return[o,s]}function y1(t,e){let i=!0;for(let o=0;o<t.planes.length;o++){let s=t.planes[o],l=0;for(let h=0;h<e.length;h++)l+=r.N.dot(s,e[h])+s[3]>=0;if(l===0)return 0;l!==e.length&&(i=!1)}return i?2:1}function b1(t,e){for(let i of t.projections){let o=zm(e,t.points[0],i.axis);if(i.projection[1]<o[0]||i.projection[0]>o[1])return 0}return 1}function v1(t,e){let i=0,o=[0,0,0,0];for(let s=0;s<t.length;s++)o[0]=t[s][0],o[1]=t[s][1],o[2]=t[s][2],o[3]=1,r.a7.dot(o,e)>=0&&i++;return i}class iy{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=An.fromPoints(this.points),this.projections=[],this.frustumEdges=[r.N.sub([],this.points[2],this.points[3]),r.N.sub([],this.points[0],this.points[3]),r.N.sub([],this.points[4],this.points[0]),r.N.sub([],this.points[5],this.points[1]),r.N.sub([],this.points[6],this.points[2]),r.N.sub([],this.points[7],this.points[3])];for(let o of this.frustumEdges){let s=[0,-o[2],o[1]],l=[o[2],0,-o[0]];this.projections.push({axis:s,projection:zm(this.points,this.points[0],s)}),this.projections.push({axis:l,projection:zm(this.points,this.points[0],l)})}}static fromInvProjectionMatrix(e,i,o,s){let l=Math.pow(2,o),h=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(b=>{let T=r.a7.transformMat4([],b,e),I=1/T[3]/i*l;return r.a7.mul(T,T,[I,I,s?1/T[3]:I,I])}),f=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(b=>{let T=r.N.sub([],h[b[0]],h[b[1]]),I=r.N.sub([],h[b[2]],h[b[1]]),C=r.N.normalize([],r.N.cross([],T,I)),D=-r.N.dot(C,h[b[1]]);return C.concat(D)}),y=[];for(let b=0;b<h.length;b++)y.push([h[b][0],h[b][1],h[b][2]]);return new iy(y,f)}intersectsPrecise(e,i,o){for(let s=0;s<i.length;s++)if(!v1(e,i[s]))return 0;for(let s=0;s<this.planes.length;s++)if(!v1(e,this.planes[s]))return 0;for(let s of o)for(let l of this.frustumEdges){let h=r.N.cross([],s,l),f=r.N.length(h);if(f===0)continue;r.N.scale(h,h,1/f);let y=zm(this.points,this.points[0],h),b=zm(e,this.points[0],h);if(y[0]>b[1]||b[0]>y[1])return 0}return 1}}class An{static fromPoints(e){let i=[1/0,1/0,1/0],o=[-1/0,-1/0,-1/0];for(let s of e)r.N.min(i,i,s),r.N.max(o,o,s);return new An(i,o)}static fromTileIdAndHeight(e,i,o){let s=1<<e.canonical.z,l=e.canonical.x,h=e.canonical.y;return new An([l/s,h/s,i],[(l+1)/s,(h+1)/s,o])}static applyTransform(e,i){let o=e.getCorners();for(let s=0;s<o.length;++s)r.N.transformMat4(o[s],o[s],i);return An.fromPoints(o)}static projectAabbCorners(e,i){let o=e.getCorners();for(let s=0;s<o.length;++s)r.N.transformMat4(o[s],o[s],i);return o}constructor(e,i){this.min=e,this.max=i,this.center=r.N.scale([],r.N.add([],this.min,this.max),.5)}quadrant(e){let i=[e%2==0,e<2],o=r.N.clone(this.min),s=r.N.clone(this.max);for(let l=0;l<i.length;l++)o[l]=i[l]?this.min[l]:this.center[l],s[l]=i[l]?this.center[l]:this.max[l];return s[2]=this.max[2],new An(o,s)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){let e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?y1(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?y1(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?b1(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?b1(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}mt(An,"Aabb");let VC=Bi([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:c_}=VC,UC=Bi([{name:"a_pos_3",components:3,type:"Int16"}]);var x1=Bi([{name:"a_pos",type:"Int16",components:2}]);function d_(t){return t*W/Te}let GC=[new An([ce,ce,ce],[be,be,be]),new An([ce,ce,ce],[0,0,be]),new An([0,ce,ce],[be,0,be]),new An([ce,0,ce],[0,be,be]),new An([0,0,ce],[be,be,be])];function w1(t,e,i,o=!0){let s=r.N.scale([],t._camera.position,t.worldSize),l=[e,i,1,1];r.a7.transformMat4(l,l,t.pixelMatrixInverse),r.a7.scale(l,l,1/l[3]);let h=r.N.sub([],l,s),f=r.N.normalize([],h),y=t.globeMatrix,b=[y[12],y[13],y[14]],T=r.N.sub([],b,s),I=r.N.length(T),C=r.N.normalize([],T),D=t.worldSize/(2*Math.PI),R=r.N.dot(C,f),L=Math.asin(D/I);if(L<Math.acos(R)){if(!o)return null;let _e=[],Se=[];r.N.scale(_e,f,I/R),r.N.normalize(Se,r.N.sub(Se,_e,T)),r.N.normalize(f,r.N.add(f,T,r.N.scale(f,Se,Math.tan(L)*I)))}let B=[];new ey(s,f).closestPointOnSphere(b,D,B);let j=r.N.normalize([],ie(y,0)),Z=r.N.normalize([],ie(y,1)),K=r.N.normalize([],ie(y,2)),Y=r.N.dot(j,B),ne=r.N.dot(Z,B),te=r.N.dot(K,B),se=Mr(Math.asin(-ne/D)),he=Mr(Math.atan2(Y,te));he=t.center.lng+function(_e,Se){let ze=(Se-_e+180)%360-180;return ze<-180?ze+360:ze}(t.center.lng,he);let fe=Xt(he),ve=ii(Nt(se),0,1);return new Ii(fe,ve)}class $C{constructor(e,i,o){this.a=r.N.sub([],e,o),this.b=r.N.sub([],i,o),this.center=o;let s=r.N.normalize([],this.a),l=r.N.normalize([],this.b);this.angle=Math.acos(r.N.dot(s,l))}}function ny(t,e){if(t.angle===0)return null;let i;return i=t.a[e]===0?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),i<0||i>1?null:function(o,s,l,h){let f=Math.sin(l);return o*(Math.sin((1-h)*l)/f)+s*(Math.sin(h*l)/f)}(t.a[e],t.b[e],t.angle,ii(i,0,1))+t.center[e]}function vs(t){if(t.z<=1)return GC[t.z+2*t.y+t.x];let e=ry(h_(t));return An.fromPoints(e)}function rl(t,e,i){return r.N.scale(t,t,1-i),r.N.scaleAndAdd(t,t,e,i)}function T1(t,e,i){for(let o of t)r.N.transformMat4(o,o,e),r.N.scale(o,o,i)}function k1(t,e,i,o){let s=e/t.worldSize,l=t.globeMatrix;if(i.z<=1){let fe=vs(i).getCorners();return T1(fe,l,s),An.fromPoints(fe)}let h=h_(i,o),f=ry(h,W+d_(t._tileCoverLift));T1(f,l,s);let y=Number.MAX_VALUE,b=[-y,-y,-y],T=[y,y,y];if(h.contains(t.center)){for(let _e of f)r.N.min(T,T,_e),r.N.max(b,b,_e);b[2]=0;let fe=t.point,ve=[fe.x*s,fe.y*s,0];return r.N.min(T,T,ve),r.N.max(b,b,ve),new An(T,b)}if(t._tileCoverLift>0){for(let fe of f)r.N.min(T,T,fe),r.N.max(b,b,fe);return new An(T,b)}let I=[l[12]*s,l[13]*s,l[14]*s],C=h.getCenter(),D=ii(t.center.lat,-ai,ai),R=ii(C.lat,-ai,ai),L=Xt(t.center.lng),B=Nt(D),j=L-Xt(C.lng),Z=B-Nt(R);j>.5?j-=1:j<-.5&&(j+=1);let K=0;if(Math.abs(j)>Math.abs(Z))K=j>=0?1:3;else{K=Z>=0?0:2;let fe=[l[4]*s,l[5]*s,l[6]*s],ve=-Math.sin(vi(Z>=0?h.getSouth():h.getNorth()))*W;r.N.scaleAndAdd(I,I,fe,ve)}let Y=f[K],ne=f[(K+1)%4],te=new $C(Y,ne,I),se=[ny(te,0)||Y[0],ny(te,1)||Y[1],ny(te,2)||Y[2]],he=$l(t.zoom);if(he>0){let fe=function({x:_e,y:Se,z:ze},ke,Re,we,Pe){let et=1/(1<<ze),Fe=_e*et,ft=Fe+et,dt=Se*et,je=dt+et,zt=0,wt=(Fe+ft)/2-we;return wt>.5?zt=-1:wt<-.5&&(zt=1),Fe=((Fe+zt)*ke-(we*=ke))*Re+we,ft=((ft+zt)*ke-we)*Re+we,dt=(dt*ke-(Pe*=ke))*Re+Pe,je=(je*ke-Pe)*Re+Pe,[[Fe,je,0],[ft,je,0],[ft,dt,0],[Fe,dt,0]]}(i,e,t._pixelsPerMercatorPixel,L,B);for(let _e=0;_e<f.length;_e++)rl(f[_e],fe[_e],he);let ve=r.N.add([],fe[K],fe[(K+1)%4]);r.N.scale(ve,ve,.5),rl(se,ve,he)}for(let fe of f)r.N.min(T,T,fe),r.N.max(b,b,fe);return T[2]=Math.min(Y[2],ne[2]),r.N.min(T,T,se),r.N.max(b,b,se),new An(T,b)}function h_({x:t,y:e,z:i},o=!1){let s=1/(1<<i),l=new pe(Gt(t*s),e===(1<<i)-1&&o?-90:yi((e+1)*s)),h=new pe(Gt((t+1)*s),e===0&&o?90:yi(e*s));return new xe(l,h)}function ry(t,e=W){let i=vi(t.getNorth()),o=vi(t.getSouth()),s=Math.cos(i),l=Math.cos(o),h=Math.sin(i),f=Math.sin(o),y=t.getWest(),b=t.getEast();return[ue(l,f,y,e),ue(l,f,b,e),ue(s,h,b,e),ue(s,h,y,e)]}function Om(t,e,i,o){let s=1<<i.z,l=(t/st+i.x)/s;return Ie(yi((e/st+i.y)/s),Gt(l),o)}function u_({min:t,max:e}){return ee/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}let I1=new Float64Array(16);function m_(t){let e=u_(t),i=r.a6.fromScaling(I1,[e,e,e]);return r.a6.translate(i,i,r.N.negate([],t.min))}function oy(t){let e=r.a6.fromTranslation(I1,t.min),i=1/u_(t);return r.a6.scale(e,e,[i,i,i])}function ay(t){let e=st/(2*Math.PI);return t/(2*Math.PI)/e}function S1(t,e){return st/(512*Math.pow(2,t))*u_(vs(e))}function C1(t,e,i,o,s){let l=ay(i),h=[t,e,-i/(2*Math.PI)],f=r.a6.identity(new Float64Array(16));return r.a6.translate(f,f,h),r.a6.scale(f,f,[l,l,l]),r.a6.rotateX(f,f,vi(-s)),r.a6.rotateY(f,f,vi(-o)),f}function $l(t){return ml(J,$,t)}function M1(t,e){let i=Ie(e.lat,e.lng),o=function(l){let h=Ie(l._center.lat,l._center.lng),f=r.N.fromValues(0,1,0),y=r.N.cross([],f,h),b=r.a6.fromRotation([],-l.angle,h);y=r.N.transformMat4(y,y,b),r.a6.fromRotation(b,-l._pitch,y);let T=r.N.normalize([],h);return r.N.scale(T,T,d_(l.cameraToCenterDistance/l.pixelsPerMeter)),r.N.transformMat4(T,T,b),r.N.add([],h,T)}(t),s=r.N.subtract([],o,i);return r.N.angle(s,i)}function sy(t,e){return M1(t,e)>Math.PI/2*1.01}let E1=vi(85),qC=Math.cos(E1),HC=Math.sin(E1),ZC=r.a6.create(),A1=t=>{let e=[];return t.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),t.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function D1(t,e,i,o,s,l,h,f,y){if(l&&t.queryGeometry.isAboveHorizon)return!1;l&&(y*=t.pixelToTileUnitsFactor);let b=t.tileID.canonical,T=i.projection.upVectorScale(b,i.center.lat,i.worldSize).metersToTile;for(let I of e)for(let C of I){let D=C.add(f),R=s&&i.elevation?i.elevation.exaggeration()*s.getElevationAt(D.x,D.y,!0):0,L=i.projection.projectTilePoint(D.x,D.y,b);if(R>0){let K=i.projection.upVector(b,D.x,D.y);L.x+=K[0]*T*R,L.y+=K[1]*T*R,L.z+=K[2]*T*R}let B=l?D:WC(L.x,L.y,L.z,o),j=l?t.tilespaceRays.map(K=>YC(K,R)):t.queryGeometry.screenGeometry,Z=r.a7.transformMat4([],[L.x,L.y,L.z,1],o);if(!h&&l?y*=Z[3]/i.cameraToCenterDistance:h&&!l&&(y*=i.cameraToCenterDistance/Z[3]),l){let K=yi((C.y/st+b.y)/(1<<b.z));y/=i.projection.pixelsPerMeter(K,1)/qt(1,K)}if(gs(j,B,y))return!0}return!1}function WC(t,e,i,o){let s=r.a7.transformMat4([],[t,e,i,1],o);return new nt(s[0]/s[3],s[1]/s[3])}let P1=r.N.fromValues(0,0,0),XC=r.N.fromValues(0,0,1);function YC(t,e){let i=r.N.create();return P1[2]=e,t.intersectsPlane(P1,XC,i),new nt(i[0],i[1])}class R1 extends lo{}function L1(t,{width:e,height:i},o,s){if(s){if(s instanceof Uint8ClampedArray)s=new Uint8Array(s.buffer);else if(s.length!==e*i*o)throw new RangeError("mismatched image size")}else s=new Uint8Array(e*i*o);return t.width=e,t.height=i,t.data=s,t}function z1(t,e,i){let{width:o,height:s}=e;o===t.width&&s===t.height||(ly(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,o),height:Math.min(t.height,s)},i),t.width=o,t.height=s,t.data=e.data)}function ly(t,e,i,o,s,l,h){if(s.width===0||s.height===0)return e;if(s.width>t.width||s.height>t.height||i.x>t.width-s.width||i.y>t.height-s.height)throw new RangeError("out of range source coordinates for image copy");if(s.width>e.width||s.height>e.height||o.x>e.width-s.width||o.y>e.height-s.height)throw new RangeError("out of range destination coordinates for image copy");let f=t.data,y=e.data,b=l===4&&h;for(let T=0;T<s.height;T++){let I=((i.y+T)*t.width+i.x)*l,C=((o.y+T)*e.width+o.x)*l;if(b)for(let D=0;D<s.width;D++){let R=I+D*l+3,L=C+D*l;y[L+0]=255,y[L+1]=255,y[L+2]=255,y[L+3]=f[R]}else for(let D=0;D<s.width*l;D++)y[C+D]=f[I+D]}return e}mt(R1,"HeatmapBucket",{omit:["layers"]});class ql{constructor(e,i){L1(this,e,1,i)}resize(e){z1(this,new ql(e),1)}clone(){return new ql({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,s,l){ly(e,i,o,s,l,1)}}class na{constructor(e,i){L1(this,e,4,i)}resize(e){z1(this,new na(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new na({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,s,l,h){ly(e,i,o,s,l,4,h)}}class O1{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}mt(ql,"AlphaImage"),mt(na,"RGBAImage");let KC=new bn({visibility:new Qe(ye.layout_heatmap.visibility)});var QC={paint:new bn({"heatmap-radius":new At(ye.paint_heatmap["heatmap-radius"]),"heatmap-weight":new At(ye.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Qe(ye.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ks(ye.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Qe(ye.paint_heatmap["heatmap-opacity"])}),layout:KC};function Fm(t){let e={},i=t.resolution||256,o=t.clips?t.clips.length:1,s=t.image||new na({width:i,height:o}),l=(h,f,y)=>{e[t.evaluationKey]=y;let b=t.expression.evaluate(e);b&&(s.data[h+f+0]=Math.floor(255*b.r/b.a),s.data[h+f+1]=Math.floor(255*b.g/b.a),s.data[h+f+2]=Math.floor(255*b.b/b.a),s.data[h+f+3]=Math.floor(255*b.a))};if(t.clips)for(let h=0,f=0;h<o;++h,f+=4*i)for(let y=0,b=0;y<i;y++,b+=4){let T=y/(i-1),{start:I,end:C}=t.clips[h];l(f,b,I*(1-T)+C*T)}else for(let h=0,f=0;h<i;h++,f+=4)l(0,f,h/(i-1));return s}let JC=new bn({visibility:new Qe(ye.layout_hillshade.visibility)});var eM={paint:new bn({"hillshade-illumination-direction":new Qe(ye.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Qe(ye.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Qe(ye.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Qe(ye.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Qe(ye.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Qe(ye.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Qe(ye.paint_hillshade["hillshade-emissive-strength"])}),layout:JC};let tM=Bi([{name:"a_pos",components:2,type:"Int16"}],4),{members:iM}=tM;var cy={exports:{}};function p_(t,e,i){i=i||2;var o,s,l,h,f,y,b,T=e&&e.length,I=T?e[0]*i:t.length,C=F1(t,0,I,i,!0),D=[];if(!C||C.next===C.prev)return D;if(T&&(C=function(L,B,j,Z){var K,Y,ne,te=[];for(K=0,Y=B.length;K<Y;K++)(ne=F1(L,B[K]*Z,K<Y-1?B[K+1]*Z:L.length,Z,!1))===ne.next&&(ne.steiner=!0),te.push(dM(ne));for(te.sort(sM),K=0;K<te.length;K++)j=lM(te[K],j);return j}(t,e,C,i)),t.length>80*i){o=l=t[0],s=h=t[1];for(var R=i;R<I;R+=i)(f=t[R])<o&&(o=f),(y=t[R+1])<s&&(s=y),f>l&&(l=f),y>h&&(h=y);b=(b=Math.max(l-o,h-s))!==0?32767/b:0}return Bm(C,D,i,o,s,b,0),D}function F1(t,e,i,o,s){var l,h;if(s===uy(t,e,i,o)>0)for(l=e;l<i;l+=o)h=j1(l,t[l],t[l+1],h);else for(l=i-o;l>=e;l-=o)h=j1(l,t[l],t[l+1],h);return h&&f_(h,h.next)&&(jm(h),h=h.next),h}function dd(t,e){if(!t)return t;e||(e=t);var i,o=t;do if(i=!1,o.steiner||!f_(o,o.next)&&or(o.prev,o,o.next)!==0)o=o.next;else{if(jm(o),(o=e=o.prev)===o.next)break;i=!0}while(i||o!==e);return e}function Bm(t,e,i,o,s,l,h){if(t){!h&&l&&function(T,I,C,D){var R=T;do R.z===0&&(R.z=dy(R.x,R.y,I,C,D)),R.prevZ=R.prev,R.nextZ=R.next,R=R.next;while(R!==T);R.prevZ.nextZ=null,R.prevZ=null,function(L){var B,j,Z,K,Y,ne,te,se,he=1;do{for(j=L,L=null,Y=null,ne=0;j;){for(ne++,Z=j,te=0,B=0;B<he&&(te++,Z=Z.nextZ);B++);for(se=he;te>0||se>0&&Z;)te!==0&&(se===0||!Z||j.z<=Z.z)?(K=j,j=j.nextZ,te--):(K=Z,Z=Z.nextZ,se--),Y?Y.nextZ=K:L=K,K.prevZ=Y,Y=K;j=Z}Y.nextZ=null,he*=2}while(ne>1)}(R)}(t,o,s,l);for(var f,y,b=t;t.prev!==t.next;)if(f=t.prev,y=t.next,l?rM(t,o,s,l):nM(t))e.push(f.i/i|0),e.push(t.i/i|0),e.push(y.i/i|0),jm(t),t=y.next,b=y.next;else if((t=y)===b){h?h===1?Bm(t=oM(dd(t),e,i),e,i,o,s,l,2):h===2&&aM(t,e,i,o,s,l):Bm(dd(t),e,i,o,s,l,1);break}}}function nM(t){var e=t.prev,i=t,o=t.next;if(or(e,i,o)>=0)return!1;for(var s=e.x,l=i.x,h=o.x,f=e.y,y=i.y,b=o.y,T=s<l?s<h?s:h:l<h?l:h,I=f<y?f<b?f:b:y<b?y:b,C=s>l?s>h?s:h:l>h?l:h,D=f>y?f>b?f:b:y>b?y:b,R=o.next;R!==e;){if(R.x>=T&&R.x<=C&&R.y>=I&&R.y<=D&&uh(s,f,l,y,h,b,R.x,R.y)&&or(R.prev,R,R.next)>=0)return!1;R=R.next}return!0}function rM(t,e,i,o){var s=t.prev,l=t,h=t.next;if(or(s,l,h)>=0)return!1;for(var f=s.x,y=l.x,b=h.x,T=s.y,I=l.y,C=h.y,D=f<y?f<b?f:b:y<b?y:b,R=T<I?T<C?T:C:I<C?I:C,L=f>y?f>b?f:b:y>b?y:b,B=T>I?T>C?T:C:I>C?I:C,j=dy(D,R,e,i,o),Z=dy(L,B,e,i,o),K=t.prevZ,Y=t.nextZ;K&&K.z>=j&&Y&&Y.z<=Z;){if(K.x>=D&&K.x<=L&&K.y>=R&&K.y<=B&&K!==s&&K!==h&&uh(f,T,y,I,b,C,K.x,K.y)&&or(K.prev,K,K.next)>=0||(K=K.prevZ,Y.x>=D&&Y.x<=L&&Y.y>=R&&Y.y<=B&&Y!==s&&Y!==h&&uh(f,T,y,I,b,C,Y.x,Y.y)&&or(Y.prev,Y,Y.next)>=0))return!1;Y=Y.nextZ}for(;K&&K.z>=j;){if(K.x>=D&&K.x<=L&&K.y>=R&&K.y<=B&&K!==s&&K!==h&&uh(f,T,y,I,b,C,K.x,K.y)&&or(K.prev,K,K.next)>=0)return!1;K=K.prevZ}for(;Y&&Y.z<=Z;){if(Y.x>=D&&Y.x<=L&&Y.y>=R&&Y.y<=B&&Y!==s&&Y!==h&&uh(f,T,y,I,b,C,Y.x,Y.y)&&or(Y.prev,Y,Y.next)>=0)return!1;Y=Y.nextZ}return!0}function oM(t,e,i){var o=t;do{var s=o.prev,l=o.next.next;!f_(s,l)&&B1(s,o,o.next,l)&&Nm(s,l)&&Nm(l,s)&&(e.push(s.i/i|0),e.push(o.i/i|0),e.push(l.i/i|0),jm(o),jm(o.next),o=t=l),o=o.next}while(o!==t);return dd(o)}function aM(t,e,i,o,s,l){var h=t;do{for(var f=h.next.next;f!==h.prev;){if(h.i!==f.i&&hM(h,f)){var y=N1(h,f);return h=dd(h,h.next),y=dd(y,y.next),Bm(h,e,i,o,s,l,0),void Bm(y,e,i,o,s,l,0)}f=f.next}h=h.next}while(h!==t)}function sM(t,e){return t.x-e.x}function lM(t,e){var i=function(s,l){var h,f=l,y=s.x,b=s.y,T=-1/0;do{if(b<=f.y&&b>=f.next.y&&f.next.y!==f.y){var I=f.x+(b-f.y)*(f.next.x-f.x)/(f.next.y-f.y);if(I<=y&&I>T&&(T=I,h=f.x<f.next.x?f:f.next,I===y))return h}f=f.next}while(f!==l);if(!h)return null;var C,D=h,R=h.x,L=h.y,B=1/0;f=h;do y>=f.x&&f.x>=R&&y!==f.x&&uh(b<L?y:T,b,R,L,b<L?T:y,b,f.x,f.y)&&(C=Math.abs(b-f.y)/(y-f.x),Nm(f,s)&&(C<B||C===B&&(f.x>h.x||f.x===h.x&&cM(h,f)))&&(h=f,B=C)),f=f.next;while(f!==D);return h}(t,e);if(!i)return e;var o=N1(i,t);return dd(o,o.next),dd(i,i.next)}function cM(t,e){return or(t.prev,t,e.prev)<0&&or(e.next,t,t.next)<0}function dy(t,e,i,o,s){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*s|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*s|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function dM(t){var e=t,i=t;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==t);return i}function uh(t,e,i,o,s,l,h,f){return(s-h)*(e-f)>=(t-h)*(l-f)&&(t-h)*(o-f)>=(i-h)*(e-f)&&(i-h)*(l-f)>=(s-h)*(o-f)}function hM(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(i,o){var s=i;do{if(s.i!==i.i&&s.next.i!==i.i&&s.i!==o.i&&s.next.i!==o.i&&B1(s,s.next,i,o))return!0;s=s.next}while(s!==i);return!1}(t,e)&&(Nm(t,e)&&Nm(e,t)&&function(i,o){var s=i,l=!1,h=(i.x+o.x)/2,f=(i.y+o.y)/2;do s.y>f!=s.next.y>f&&s.next.y!==s.y&&h<(s.next.x-s.x)*(f-s.y)/(s.next.y-s.y)+s.x&&(l=!l),s=s.next;while(s!==i);return l}(t,e)&&(or(t.prev,t,e.prev)||or(t,e.prev,e))||f_(t,e)&&or(t.prev,t,t.next)>0&&or(e.prev,e,e.next)>0)}function or(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function f_(t,e){return t.x===e.x&&t.y===e.y}function B1(t,e,i,o){var s=g_(or(t,e,i)),l=g_(or(t,e,o)),h=g_(or(i,o,t)),f=g_(or(i,o,e));return s!==l&&h!==f||!(s!==0||!__(t,i,e))||!(l!==0||!__(t,o,e))||!(h!==0||!__(i,t,o))||!(f!==0||!__(i,e,o))}function __(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function g_(t){return t>0?1:t<0?-1:0}function Nm(t,e){return or(t.prev,t,t.next)<0?or(t,e,t.next)>=0&&or(t,t.prev,e)>=0:or(t,e,t.prev)<0||or(t,t.next,e)<0}function N1(t,e){var i=new hy(t.i,t.x,t.y),o=new hy(e.i,e.x,e.y),s=t.next,l=e.prev;return t.next=e,e.prev=t,i.next=s,s.prev=i,o.next=i,i.prev=o,l.next=o,o.prev=l,o}function j1(t,e,i,o){var s=new hy(t,e,i);return o?(s.next=o.next,s.prev=o,o.next.prev=s,o.next=s):(s.prev=s,s.next=s),s}function jm(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function hy(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function uy(t,e,i,o){for(var s=0,l=e,h=i-o;l<i;l+=o)s+=(t[h]-t[l])*(t[l+1]+t[h+1]),h=l;return s}cy.exports=p_,cy.exports.default=p_,p_.deviation=function(t,e,i,o){var s=e&&e.length,l=Math.abs(uy(t,0,s?e[0]*i:t.length,i));if(s)for(var h=0,f=e.length;h<f;h++)l-=Math.abs(uy(t,e[h]*i,h<f-1?e[h+1]*i:t.length,i));var y=0;for(h=0;h<o.length;h+=3){var b=o[h]*i,T=o[h+1]*i,I=o[h+2]*i;y+=Math.abs((t[b]-t[I])*(t[T+1]-t[b+1])-(t[b]-t[T])*(t[I+1]-t[b+1]))}return l===0&&y===0?0:Math.abs((y-l)/l)},p_.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},o=0,s=0;s<t.length;s++){for(var l=0;l<t[s].length;l++)for(var h=0;h<e;h++)i.vertices.push(t[s][l][h]);s>0&&i.holes.push(o+=t[s-1].length)}return i};var y_=mi(cy.exports);function my(t,e){let i=t.length;if(i<=1)return[t];let o=[],s,l;for(let h=0;h<i;h++){let f=Os(t[h]);f!==0&&(t[h].area=Math.abs(f),l===void 0&&(l=f<0),l===f<0?(s&&o.push(s),s=[t[h]]):s.push(t[h]))}if(s&&o.push(s),e>1)for(let h=0;h<o.length;h++)o[h].length<=e||(f0(o[h],e,1,o[h].length-1,uM),o[h]=o[h].slice(0,e));return o}function uM(t,e){return e.area-t.area}function py(t,e,i){let o=i.patternDependencies,s=!1;for(let l of e){let h=l.paint.get(`${t}-pattern`);h.isConstant()||(s=!0);let f=h.constantOr(null);f&&(s=!0,o[f]=!0)}return s}function fy(t,e,i,o,s){let l=s.patternDependencies;for(let h of e){let f=h.paint.get(`${t}-pattern`).value;if(f.kind!=="constant"){let y=f.evaluate({zoom:o},i,{},s.availableImages);y=y&&y.name?y.name:y,l[y]=!0,i.patterns[h.id]=y}}return i}class _y{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ea,this.indexArray=new hr,this.indexArray2=new _a,this.programConfigurations=new U(e.layers,e.zoom),this.segments=new Rn,this.segments2=new Rn,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection}populate(e,i,o,s){this.hasPattern=py("fill",this.layers,i);let l=this.layers[0].layout.get("fill-sort-key"),h=[];for(let{feature:f,id:y,index:b,sourceLayerIndex:T}of e){let I=this.layers[0]._featureFilter.needGeometry,C=tr(f,I);if(!this.layers[0]._featureFilter.filter(new yn(this.zoom),C,o))continue;let D=l?l.evaluate(C,{},o,i.availableImages):void 0,R={id:y,properties:f.properties,type:f.type,sourceLayerIndex:T,index:b,geometry:I?C.geometry:mr(f,o,s),patterns:{},sortKey:D};h.push(R)}l&&h.sort((f,y)=>f.sortKey-y.sortKey);for(let f of h){let{geometry:y,index:b,sourceLayerIndex:T}=f;if(this.hasPattern){let I=fy("fill",this.layers,f,this.zoom,i);this.patternFeatures.push(I)}else this.addFeature(f,y,b,o,{},i.availableImages,i.brightness);i.featureIndex.insert(e[b].feature,y,b,T,this.index)}}update(e,i,o,s,l){let h=Object.keys(e).length!==0;h&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,i,h?this.stateDependentLayers:this.layers,o,s,l)}addFeatures(e,i,o,s,l,h){for(let f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,i,o,s,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,iM),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,o,s,l,h=[],f){for(let y of my(i,500)){let b=0;for(let L of y)b+=L.length;let T=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray),I=T.vertexLength,C=[],D=[];for(let L of y){if(L.length===0)continue;L!==y[0]&&D.push(C.length/2);let B=this.segments2.prepareSegment(L.length,this.layoutVertexArray,this.indexArray2),j=B.vertexLength;this.layoutVertexArray.emplaceBack(L[0].x,L[0].y),this.indexArray2.emplaceBack(j+L.length-1,j),C.push(L[0].x),C.push(L[0].y);for(let Z=1;Z<L.length;Z++)this.layoutVertexArray.emplaceBack(L[Z].x,L[Z].y),this.indexArray2.emplaceBack(j+Z-1,j+Z),C.push(L[Z].x),C.push(L[Z].y);B.vertexLength+=L.length,B.primitiveLength+=L.length}let R=y_(C,D);for(let L=0;L<R.length;L+=3)this.indexArray.emplaceBack(I+R[L],I+R[L+1],I+R[L+2]);T.vertexLength+=b,T.primitiveLength+=R.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,l,h,s,f)}}mt(_y,"FillBucket",{omit:["layers","patternFeatures"]});let mM=new bn({"fill-sort-key":new At(ye.layout_fill["fill-sort-key"]),visibility:new Qe(ye.layout_fill.visibility)});var pM={paint:new bn({"fill-antialias":new Qe(ye.paint_fill["fill-antialias"]),"fill-opacity":new At(ye.paint_fill["fill-opacity"]),"fill-color":new At(ye.paint_fill["fill-color"]),"fill-outline-color":new At(ye.paint_fill["fill-outline-color"]),"fill-translate":new Qe(ye.paint_fill["fill-translate"]),"fill-translate-anchor":new Qe(ye.paint_fill["fill-translate-anchor"]),"fill-pattern":new At(ye.paint_fill["fill-pattern"]),"fill-emissive-strength":new Qe(ye.paint_fill["fill-emissive-strength"])}),layout:mM};let fM=Bi([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),_M=Bi([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),gM=Bi([{name:"a_centroid_pos",components:2,type:"Uint16"}]),yM=Bi([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),bM=Bi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:vM}=fM;var b_={},xM=eo,V1=mh;function mh(t,e,i,o,s){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=o,this._values=s,t.readFields(wM,this,e)}function wM(t,e,i){t==1?e.id=i.readVarint():t==2?function(o,s){for(var l=o.readVarint()+o.pos;o.pos<l;){var h=s._keys[o.readVarint()],f=s._values[o.readVarint()];s.properties[h]=f}}(i,e):t==3?e.type=i.readVarint():t==4&&(e._geometry=i.pos)}function TM(t){for(var e,i,o=0,s=0,l=t.length,h=l-1;s<l;h=s++)o+=((i=t[h]).x-(e=t[s]).x)*(e.y+i.y);return o}mh.types=["Unknown","Point","LineString","Polygon"],mh.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,i=t.readVarint()+t.pos,o=1,s=0,l=0,h=0,f=[];t.pos<i;){if(s<=0){var y=t.readVarint();o=7&y,s=y>>3}if(s--,o===1||o===2)l+=t.readSVarint(),h+=t.readSVarint(),o===1&&(e&&f.push(e),e=[]),e.push(new xM(l,h));else{if(o!==7)throw new Error("unknown command "+o);e&&e.push(e[0].clone())}}return e&&f.push(e),f},mh.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,o=0,s=0,l=0,h=1/0,f=-1/0,y=1/0,b=-1/0;t.pos<e;){if(o<=0){var T=t.readVarint();i=7&T,o=T>>3}if(o--,i===1||i===2)(s+=t.readSVarint())<h&&(h=s),s>f&&(f=s),(l+=t.readSVarint())<y&&(y=l),l>b&&(b=l);else if(i!==7)throw new Error("unknown command "+i)}return[h,y,f,b]},mh.prototype.toGeoJSON=function(t,e,i){var o,s,l=this.extent*Math.pow(2,i),h=this.extent*t,f=this.extent*e,y=this.loadGeometry(),b=mh.types[this.type];function T(D){for(var R=0;R<D.length;R++){var L=D[R];D[R]=[360*(L.x+h)/l-180,360/Math.PI*Math.atan(Math.exp((180-360*(L.y+f)/l)*Math.PI/180))-90]}}switch(this.type){case 1:var I=[];for(o=0;o<y.length;o++)I[o]=y[o][0];T(y=I);break;case 2:for(o=0;o<y.length;o++)T(y[o]);break;case 3:for(y=function(D){var R=D.length;if(R<=1)return[D];for(var L,B,j=[],Z=0;Z<R;Z++){var K=TM(D[Z]);K!==0&&(B===void 0&&(B=K<0),B===K<0?(L&&j.push(L),L=[D[Z]]):L.push(D[Z]))}return L&&j.push(L),j}(y),o=0;o<y.length;o++)for(s=0;s<y[o].length;s++)T(y[o][s])}y.length===1?y=y[0]:b="Multi"+b;var C={type:"Feature",geometry:{type:b,coordinates:y},properties:this.properties};return"id"in this&&(C.id=this.id),C};var kM=V1,U1=G1;function G1(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(IM,this,e),this.length=this._features.length}function IM(t,e,i){t===15?e.version=i.readVarint():t===1?e.name=i.readString():t===5?e.extent=i.readVarint():t===2?e._features.push(i.pos):t===3?e._keys.push(i.readString()):t===4&&e._values.push(function(o){for(var s=null,l=o.readVarint()+o.pos;o.pos<l;){var h=o.readVarint()>>3;s=h===1?o.readString():h===2?o.readFloat():h===3?o.readDouble():h===4?o.readVarint64():h===5?o.readVarint():h===6?o.readSVarint():h===7?o.readBoolean():null}return s}(i))}G1.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new kM(this._pbf,e,this.extent,this._keys,this._values)};var SM=U1;function CM(t,e,i){if(t===3){var o=new SM(i,i.readVarint()+i.pos);o.length&&(e[o.name]=o)}}var gy=b_.VectorTile=function(t,e){this.layers=t.readFields(CM,{},e)},v_=b_.VectorTileFeature=V1;function x_(t,e,i,o){let s=[],l=o===0?(h,f,y,b,T,I)=>{h.push(new nt(I,y+(I-f)/(b-f)*(T-y)))}:(h,f,y,b,T,I)=>{h.push(new nt(f+(I-y)/(T-y)*(b-f),I))};for(let h of t){let f=[];for(let y of h){if(y.length<=2)continue;let b=[];for(let C=0;C<y.length-1;C++){let D=y[C].x,R=y[C].y,L=y[C+1].x,B=y[C+1].y,j=o===0?D:R,Z=o===0?L:B;j<e?Z>e&&l(b,D,R,L,B,e):j>i?Z<i&&l(b,D,R,L,B,i):b.push(y[C]),Z<e&&j>=e&&l(b,D,R,L,B,e),Z>i&&j<=i&&l(b,D,R,L,B,i)}let T=y[y.length-1],I=o===0?T.x:T.y;I>=e&&I<=i&&b.push(T),b.length&&(T=b[b.length-1],b[0].x===T.x&&b[0].y===T.y||b.push(b[0]),f.push(b))}f.length&&s.push(f)}return s}function w_(t,e){return t.x-e.x||t.y-e.y}function $1(t,e){return w_(t.min,e.min)===0&&w_(t.max,e.max)===0}function q1(t,e){return!(t.min.x>e.max.x||t.max.x<e.min.x||t.min.y>e.max.y||t.max.y<e.min.y)}function H1(t,e,i){let o=1/st,s=1/(1<<i.canonical.z),l=(e.x*o+i.canonical.x)*s+i.wrap,h=(e.y*o+i.canonical.y)*s;return{min:new nt((t.x*o+i.canonical.x)*s+i.wrap,(t.y*o+i.canonical.y)*s),max:new nt(l,h)}}function MM(t,e,i){let o=1<<i.canonical.z,s=((e.x-i.wrap)*o-i.canonical.x)*st,l=(e.y*o-i.canonical.y)*st;return{min:new nt(((t.x-i.wrap)*o-i.canonical.x)*st,(t.y*o-i.canonical.y)*st),max:new nt(s,l)}}function Z1(t,e,i,o,s,l,h){let f=t.indices,y=t.vertices,b=[];for(let T=o;T<o+s;T+=3){let I=e[i[T+0]+l],C=e[i[T+1]+l],D=e[i[T+2]+l],R=Math.min(I.x,C.x,D.x),L=Math.max(I.x,C.x,D.x),B=Math.min(I.y,C.y,D.y),j=Math.max(I.y,C.y,D.y);b.length=0,t.grid.query(new nt(R,B),new nt(L,j),b);for(let Z=0;Z<b.length;Z++){let K=b[Z];if(B0(y[f[3*K+0]],y[f[3*K+1]],y[f[3*K+2]],I,C,D,h))return!0}}return!1}function W1(t,e,i,o){if(!t||!i)return!1;let s=t.vertices;if(!e.canonical.equals(o.canonical)||e.wrap!==o.wrap){if(i.vertices.length<t.vertices.length)return W1(i,o,t,e);let l=e.canonical,h=o.canonical,f=Math.pow(2,h.z-l.z);s=t.vertices.map(y=>new nt(y.x*l.x*st*f-h.x*st,y.y*l.y*st*f-h.y*st))}return Z1(i,s,t.indices,0,t.indices.length,0,0)}b_.VectorTileLayer=U1;class X1{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){let o=this.toIdx(e,i);return{min:this.minimums[o],max:this.maximums[o]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function Y1(t,e,i,o){let s=0,l=Number.MAX_VALUE;for(let h=0;h<3;h++)if(Math.abs(o[h])<1e-15){if(i[h]<t[h]||i[h]>e[h])return null}else{let f=1/o[h],y=(t[h]-i[h])*f,b=(e[h]-i[h])*f;if(y>b){let T=y;y=b,b=T}if(y>s&&(s=y),b<l&&(l=b),s>l)return null}return s}function K1(t,e,i,o,s,l,h,f,y,b,T){let I=o-t,C=s-e,D=l-i,R=h-t,L=f-e,B=y-i,j=T[1]*B-T[2]*L,Z=T[2]*R-T[0]*B,K=T[0]*L-T[1]*R,Y=I*j+C*Z+D*K;if(Math.abs(Y)<1e-15)return null;let ne=1/Y,te=b[0]-t,se=b[1]-e,he=b[2]-i,fe=(te*j+se*Z+he*K)*ne;if(fe<0||fe>1)return null;let ve=se*D-he*C,_e=he*I-te*D,Se=te*C-se*I,ze=(T[0]*ve+T[1]*_e+T[2]*Se)*ne;return ze<0||fe+ze>1?null:(R*ve+L*_e+B*Se)*ne}function Q1(t,e,i){return(t-e)/(i-e)}function J1(t,e,i,o,s,l,h,f,y){let b=1<<i,T=l-o,I=h-s,C=(t+1)/b*T+o,D=(e+0)/b*I+s,R=(e+1)/b*I+s;f[0]=(t+0)/b*T+o,f[1]=D,y[0]=C,y[1]=R}class ew{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;let i=function(l){let h=Math.ceil(Math.log2(l.dim/8)),f=[],y=Math.ceil(Math.pow(2,h)),b=1/y,T=(D,R,L,B,j)=>{let Z=B?1:0,K=(D+1)*L-Z,Y=R*L,ne=(R+1)*L-Z;j[0]=D*L,j[1]=Y,j[2]=K,j[3]=ne},I=new X1(y),C=[];for(let D=0;D<y*y;D++){T(D%y,Math.floor(D/y),b,!1,C);let R=Hl(C[0],C[1],l),L=Hl(C[2],C[1],l),B=Hl(C[2],C[3],l),j=Hl(C[0],C[3],l);I.minimums.push(Math.min(R,L,B,j)),I.maximums.push(Math.max(R,L,B,j)),I.leaves.push(1)}for(f.push(I),y/=2;y>=1;y/=2){let D=f[f.length-1];I=new X1(y);for(let R=0;R<y*y;R++){T(R%y,Math.floor(R/y),2,!0,C);let L=D.getElevation(C[0],C[1]),B=D.getElevation(C[2],C[1]),j=D.getElevation(C[2],C[3]),Z=D.getElevation(C[0],C[3]),K=D.isLeaf(C[0],C[1]),Y=D.isLeaf(C[2],C[1]),ne=D.isLeaf(C[2],C[3]),te=D.isLeaf(C[0],C[3]),se=Math.min(L.min,B.min,j.min,Z.min),he=Math.max(L.max,B.max,j.max,Z.max),fe=K&&Y&&ne&&te;I.maximums.push(he),I.minimums.push(se),I.leaves.push(he-se<=5&&fe?1:0)}f.push(I)}return f}(this.dem),o=i.length-1,s=i[o];this._addNode(s.minimums[0],s.maximums[0],s.leaves[0]),this._construct(i,0,0,o,0)}raycastRoot(e,i,o,s,l,h,f=1){return Y1([e,i,-100],[o,s,this.maximums[0]*f],l,h)}raycast(e,i,o,s,l,h,f=1){if(!this.nodeCount)return null;let y=this.raycastRoot(e,i,o,s,l,h,f);if(y==null)return null;let b=[],T=[],I=[],C=[],D=[{idx:0,t:y,nodex:0,nodey:0,depth:0}];for(;D.length>0;){let{idx:R,t:L,nodex:B,nodey:j,depth:Z}=D.pop();if(this.leaves[R]){J1(B,j,Z,e,i,o,s,I,C);let Y=1<<Z,ne=(B+0)/Y,te=(B+1)/Y,se=(j+0)/Y,he=(j+1)/Y,fe=Hl(ne,se,this.dem)*f,ve=Hl(te,se,this.dem)*f,_e=Hl(te,he,this.dem)*f,Se=Hl(ne,he,this.dem)*f,ze=K1(I[0],I[1],fe,C[0],I[1],ve,C[0],C[1],_e,l,h),ke=K1(C[0],C[1],_e,I[0],C[1],Se,I[0],I[1],fe,l,h),Re=Math.min(ze!==null?ze:Number.MAX_VALUE,ke!==null?ke:Number.MAX_VALUE);if(Re!==Number.MAX_VALUE)return Re;{let we=r.N.scaleAndAdd([],l,h,L);if(tw(fe,ve,Se,_e,Q1(we[0],I[0],C[0]),Q1(we[1],I[1],C[1]))>=we[2])return L}continue}let K=0;for(let Y=0;Y<this._siblingOffset.length;Y++){J1((B<<1)+this._siblingOffset[Y][0],(j<<1)+this._siblingOffset[Y][1],Z+1,e,i,o,s,I,C),I[2]=-100,C[2]=this.maximums[this.childOffsets[R]+Y]*f;let ne=Y1(I,C,l,h);if(ne!=null){let te=ne;b[Y]=te;let se=!1;for(let he=0;he<K&&!se;he++)te>=b[T[he]]&&(T.splice(he,0,Y),se=!0);se||(T[K]=Y),K++}}for(let Y=0;Y<K;Y++){let ne=T[Y];D.push({idx:this.childOffsets[R]+ne,t:b[ne],nodex:(B<<1)+this._siblingOffset[ne][0],nodey:(j<<1)+this._siblingOffset[ne][1],depth:Z+1})}}return null}_addNode(e,i,o){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(o),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,o,s,l){if(e[s].isLeaf(i,o)===1)return;this.childOffsets[l]||(this.childOffsets[l]=this.nodeCount);let h=s-1,f=e[h],y=0,b=0;for(let T=0;T<this._siblingOffset.length;T++){let I=2*i+this._siblingOffset[T][0],C=2*o+this._siblingOffset[T][1],D=f.getElevation(I,C),R=f.isLeaf(I,C),L=this._addNode(D.min,D.max,R);R&&(y|=1<<T),b||(b=L)}for(let T=0;T<this._siblingOffset.length;T++)y&1<<T||this._construct(e,2*i+this._siblingOffset[T][0],2*o+this._siblingOffset[T][1],h,b+T)}}function tw(t,e,i,o,s,l){return fi(fi(t,i,l),fi(e,o,l),s)}function Hl(t,e,i){let o=i.dim,s=ii(t*o-.5,0,o-1),l=ii(e*o-.5,0,o-1),h=Math.floor(s),f=Math.floor(l),y=Math.min(h+1,o-1),b=Math.min(f+1,o-1);return tw(i.get(h,f),i.get(y,f),i.get(h,b),i.get(y,b),s-h,l-f)}let EM={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function AM(t,e,i){return(256*t*256+256*e+i)/10-1e4}function DM(t,e,i){return 256*t+e+i/256-32768}class T_{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,o,s=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(o&&o!=="mapbox"&&o!=="terrarium")return Pn(`"${o}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;let l=this.dim=i.height-2,h=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=s,this._modifiedForSources={},!s){for(let y=0;y<l;y++)h[this._idx(-1,y)]=h[this._idx(0,y)],h[this._idx(l,y)]=h[this._idx(l-1,y)],h[this._idx(y,-1)]=h[this._idx(y,0)],h[this._idx(y,l)]=h[this._idx(y,l-1)];h[this._idx(-1,-1)]=h[this._idx(0,0)],h[this._idx(l,-1)]=h[this._idx(l-1,0)],h[this._idx(-1,l)]=h[this._idx(0,l-1)],h[this._idx(l,l)]=h[this._idx(l-1,l-1)]}let f=o==="terrarium"?DM:AM;for(let y=0;y<h.length;++y){let b=4*y;this.floatView[y]=f(this.pixels[b],this.pixels[b+1],this.pixels[b+2])}this._timestamp=qe.now()}_buildQuadTree(){this._tree=new ew(this)}get(e,i,o=!1){o&&(e=ii(e,-1,this.dim),i=ii(i,-1,this.dim));let s=this._idx(e,i);return this.floatView[s]}set(e,i,o){let s=this._idx(e,i),l=this.floatView[s];return this.floatView[s]=o,o-l}static getUnpackVector(e){return EM[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){let o=[0,0,0,0],s=T_.getUnpackVector(i),l=Math.floor((e+s[3])/s[2]);return o[2]=l%256,l=Math.floor(l/256),o[1]=l%256,l=Math.floor(l/256),o[0]=l,o}getPixels(){return new O1({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let s=i*this.dim,l=i*this.dim+this.dim,h=o*this.dim,f=o*this.dim+this.dim;switch(i){case-1:s=l-1;break;case 1:l=s+1}switch(o){case-1:h=f-1;break;case 1:f=h+1}let y=-i*this.dim,b=-o*this.dim;for(let T=h;T<f;T++)for(let I=s;I<l;I++){let C=4*this._idx(I,T),D=4*this._idx(I+y,T+b);this.pixels[C+0]=e.pixels[D+0],this.pixels[C+1]=e.pixels[D+1],this.pixels[C+2]=e.pixels[D+2],this.pixels[C+3]=e.pixels[D+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}mt(T_,"DEMData"),mt(ew,"DemMinMaxQuadTree",{omit:["dem"]});class ph{constructor(e,i,o){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=o}static create(e,i,o){let s=o||e.findDEMTileFor(i);if(!s||!s.dem)return;let l=s.dem,h=s.tileID,f=1<<i.canonical.z-h.canonical.z;return new ph(s,l.dim/st/f,[(i.canonical.x/f-h.canonical.x)*l.dim,(i.canonical.y/f-h.canonical.y)*l.dim])}tileCoordToPixel(e,i){let o=i*this._scale+this._offset[1],s=Math.floor(e*this._scale+this._offset[0]),l=Math.floor(o);return new nt(s,l)}getElevationAt(e,i,o,s){let l=e*this._scale+this._offset[0],h=i*this._scale+this._offset[1],f=Math.floor(l),y=Math.floor(h),b=this._dem;return s=!!s,o?fi(fi(b.get(f,y,s),b.get(f,y+1,s),h-y),fi(b.get(f+1,y,s),b.get(f+1,y+1,s),h-y),l-f):b.get(f,y,s)}getElevationAtPixel(e,i,o){return this._dem.get(e,i,!!o)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*qt(1,e)*this._dem.stride}}let PM=v_.types,RM=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],LM=["fill-extrusion-flood-light-ground-radius"],zM=Math.pow(2,13),OM=Math.pow(2,15)-1,iw=new nt(0,1),Zl=2147483648;function Vm(t,e,i,o,s,l,h,f){t.emplaceBack((e<<1)+h,(i<<1)+l,(Math.floor(o*zM)<<1)+s,Math.round(f))}function k_(t,e,i,o,s,l){t.emplaceBack(e.x,e.y,(i.x<<1)+o,(i.y<<1)+s,l)}function Um(t,e,i){t.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class nw{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class rw{constructor(){this.centroidXY=new nt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new nt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new nt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new nt(this.max.x-this.min.x,this.max.y-this.min.y)}}class ow{constructor(){this.acc=new nt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,o){this.accCount++,this.acc._add(i);let s=!!this.borders;i.x<e.min.x?(e.min.x=i.x,s=!0):i.x>e.max.x&&(e.max.x=i.x,s=!0),i.y<e.min.y?(e.min.y=i.y,s=!0):i.y>e.max.y&&(e.max.y=i.y,s=!0),((i.x===0||i.x===st)&&i.x===o.x)!=((i.y===0||i.y===st)&&i.y===o.y)&&this.processBorderOverlap(i,o),s&&this.checkBorderIntersection(i,o)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,fi(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>st!=e.x>st&&this.addBorderIntersection(1,fi(i.y,e.y,(st-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,fi(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>st!=e.y>st&&this.addBorderIntersection(3,fi(i.x,e.x,(st-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);let o=this.borders[e];i<o[0]&&(o[0]=i),i>o[1]&&(o[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;let o=e.x===0?0:1;this.addBorderIntersection(o,i.y),this.addBorderIntersection(o,e.y)}else{let o=e.y===0?2:3;this.addBorderIntersection(o,i.x),this.addBorderIntersection(o,e.x)}}centroid(){return this.accCount===0?new nt(0,0):new nt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0):0}}function aw(t,e){let i=t.add(e)._unit(),o=ii(t.x*i.x+t.y*i.y,-1,1);var s,l,h;return s=Math.acos(o),Math.min(4,Math.max(-4,Math.tan(s)))/4*OM*((l=t).x*(h=e).y-l.y*h.x<0?-1:1)}let FM=[t=>t.x<0,t=>t.x>st,t=>t.y<0,t=>t.y>st];function BM(t,e,i,o){let s=[4];if(o===0)return s;i._mult(o);let l=t.sub(i),h=e.sub(i),f=[t,e,l,h];for(let y=0;y<4;y++)for(let b of f)if(FM[y](b)){s.push(y);break}return s}class sw{constructor(e){this.vertexArray=new vm,this.indexArray=new hr,this.programConfigurations=new U(e.layers,e.zoom,i=>LM.includes(i)),this._segments=new Rn,this.hiddenByLandmarkVertexArray=new Em,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Rn}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,i,o,s=!1){let l=e.length;if(l>2){let h=Math.max(0,this._segments.get().length-1),f=this._segments._prepareSegment(4*l,this.vertexArray.length,2*this._segmentToGroundQuads[h].length),y;h!==this._segments.get().length-1&&(h++,this._segmentToGroundQuads[h]=[],this._segmentToRegionTriCounts[h]=[0,0,0,0,0]);{let b=e[0],T=e[1];y=aw(b.sub(e[l-1])._perp()._unit(),T.sub(b)._perp()._unit())}for(let b=0;b<l;b++){let T=b===l-1?0:b+1,I=e[b],C=e[T],D=e[T===l-1?0:T+1],R=C.sub(I)._perp()._unit(),L=aw(R,D.sub(C)._perp()._unit()),B=y,j=L;if(yy(I,C,i)||s&&dw(I,i)&&dw(C,i)){y=L;continue}let Z=f.vertexLength;k_(this.vertexArray,I,C,1,1,B),k_(this.vertexArray,I,C,1,0,B),k_(this.vertexArray,I,C,0,1,j),k_(this.vertexArray,I,C,0,0,j),f.vertexLength+=4;let K=BM(I,C,R,o);for(let Y of K)this._segmentToGroundQuads[h].push({id:Z,region:Y}),this._segmentToRegionTriCounts[h][Y]+=2,f.primitiveLength+=2;y=L}}}prepareBorderSegments(){if(!this.hasData())return;let e=this._segments.get(),i=e.length;for(let o=0;o<i;o++)this._segmentToGroundQuads[o].sort((s,l)=>s.region-l.region);for(let o=0;o<i;o++){let s=this._segmentToGroundQuads[o],l=e[o],h=this._segmentToRegionTriCounts[o];h.reduce((y,b)=>y+b,0);let f=0;for(let y=0;y<=4;y++){let b=h[y];if(b!==0){let T=this.regionSegments[y];T||(T=this.regionSegments[y]=new Rn);let I={vertexOffset:l.vertexOffset,primitiveOffset:l.primitiveOffset+f,vertexLength:l.vertexLength,primitiveLength:b};T.get().push(I)}f+=b}for(let y=0;y<s.length;y++){let b=s[y].id;this.indexArray.emplaceBack(b,b+1,b+3),this.indexArray.emplaceBack(b,b+3,b+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,o,s,l,h){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,o,s,l,h)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,_M.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,o,s,l,h){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,o,s,l,h)}updateHiddenByLandmark(e){if(!this.hasData())return;let i=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;let o=e.flags&Zl?1:0;for(let s=e.groundVertexArrayOffset;s<i;++s)this.hiddenByLandmarkVertexArray.emplace(s,o);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,yM.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){let i=this.regionSegments[e];i&&i.destroy()}}}}class I_{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new hr,this.footprintVertices=new ea,this.footprintSegments=[],this.layoutVertexArray=new La,this.centroidVertexArray=new id,this.indexArray=new hr,this.programConfigurations=new U(e.layers,e.zoom,i=>RM.includes(i)),this.segments=new Rn,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.groundEffect=new sw(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}populate(e,i,o,s){this.features=[],this.hasPattern=py("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=li(o),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(let{feature:l,id:h,index:f,sourceLayerIndex:y}of e){let b=this.layers[0]._featureFilter.needGeometry,T=tr(l,b);if(!this.layers[0]._featureFilter.filter(new yn(this.zoom),T,o))continue;let I={id:h,sourceLayerIndex:y,index:f,geometry:b?T.geometry:mr(l,o,s),properties:l.properties,type:l.type,patterns:{}},C=this.layoutVertexArray.length;this.hasPattern?this.features.push(fy("fill-extrusion",this.layers,I,this.zoom,i)):this.addFeature(I,I.geometry,f,o,{},i.availableImages,s,i.brightness),i.featureIndex.insert(l,I.geometry,f,y,this.index,C)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,o,s,l,h){for(let f of this.features){let{geometry:y}=f;this.addFeature(f,y,f.index,i,o,s,l,h)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,i,o,s,l){let h=Object.keys(e).length!==0;if(h&&!this.stateDependentLayers.length)return;let f=h?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,i,f,o,s,l),this.groundEffect.update(e,i,f,o,s,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,vM),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,bM.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,gM.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,o,s,l,h,f,y){let b=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,T=[new nt(0,0),new nt(st,st)],I=f.projection,C=I.name==="globe",D=PM[e.type]==="Polygon",R=new ow;R.centroidDataIndex=this.centroidData.length;let L=new rw,B=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},s)<=0,j=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},s);L.height=j,L.vertexArrayOffset=this.layoutVertexArray.length,L.groundVertexArrayOffset=this.groundEffect.vertexArray.length,C&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new nh);let Z=my(i,500);for(let he=Z.length-1;he>=0;he--){let fe=Z[he];(fe.length===0||(K=fe[0]).every(ve=>ve.x<=0)||K.every(ve=>ve.x>=st)||K.every(ve=>ve.y<=0)||K.every(ve=>ve.y>=st))&&Z.splice(he,1)}var K;let Y;if(C)Y=pw(Z,T,s);else{Y=[];for(let he of Z)Y.push({polygon:he,bounds:T})}let ne=D?this.edgeRadius:0,te=ne>0&&this.zoom<17,se=(he,fe)=>{if(he.length===0)return!1;let ve=he[he.length-1];return fe.x===ve.x&&fe.y===ve.y};for(let{polygon:he,bounds:fe}of Y){let ve=0,_e=0;for(let Re of he)D&&!Re[0].equals(Re[Re.length-1])&&Re.push(Re[0]),_e+=D?Re.length-1:Re.length;let Se=this.segments.prepareSegment((D?5:4)*_e,this.layoutVertexArray,this.indexArray);L.footprintSegIdx<0&&(L.footprintSegIdx=this.footprintSegments.length),L.polygonSegIdx<0&&(L.polygonSegIdx=this.polygonSegments.length);let ze={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},ke=new nw;if(ke.vertexOffset=this.footprintVertices.length,ke.indexOffset=3*this.footprintIndices.length,ke.ringIndices=[],D){let Re=[],we=[];ve=Se.vertexLength;for(let et=0;et<he.length;et++){let Fe=he[et];Fe.length&&et!==0&&we.push(Re.length/2);let ft=[],dt,je;dt=Fe[1].sub(Fe[0])._perp()._unit(),ke.ringIndices.push(Fe.length-1);for(let zt=1;zt<Fe.length;zt++){let wt=Fe[zt],pt=Fe[zt===Fe.length-1?1:zt+1],Ve=wt.clone();if(ne){je=pt.sub(wt)._perp()._unit();let Pt=dt.add(je)._unit(),Qt=ne*Math.min(4,1/(dt.x*Pt.x+dt.y*Pt.y));Ve.x+=Qt*Pt.x,Ve.y+=Qt*Pt.y,Ve.x=Math.round(Ve.x),Ve.y=Math.round(Ve.y),dt=je}!B||ne!==0&&!te||se(ft,Ve)||ft.push(Ve),Vm(this.layoutVertexArray,Ve.x,Ve.y,0,0,1,1,0),Se.vertexLength++,this.footprintVertices.emplaceBack(wt.x,wt.y),Re.push(wt.x,wt.y),C&&Um(this.layoutVertexExtArray,I.projectTilePoint(Ve.x,Ve.y,s),I.upVector(s,Ve.x,Ve.y))}B&&(ne===0||te)&&(ft.length!==0&&se(ft,ft[0])&&ft.pop(),this.groundEffect.addData(ft,fe,b))}let Pe=y_(Re,we);for(let et=0;et<Pe.length;et+=3)this.footprintIndices.emplaceBack(ke.vertexOffset+Pe[et+0],ke.vertexOffset+Pe[et+1],ke.vertexOffset+Pe[et+2]),this.indexArray.emplaceBack(ve+Pe[et],ve+Pe[et+2],ve+Pe[et+1]),Se.primitiveLength++;ke.indexCount+=Pe.length,ke.vertexCount+=this.footprintVertices.length-ke.vertexOffset}for(let Re=0;Re<he.length;Re++){let we=he[Re];R.startRing(L,we[0]);let Pe=we.length>4&&hw(we[we.length-2],we[0],we[1]),et=ne?NM(we[we.length-2],we[0],we[1],ne):0,Fe=[],ft,dt,je;dt=we[1].sub(we[0])._perp()._unit();let zt=!0;for(let wt=1,pt=0;wt<we.length;wt++){let Ve=we[wt-1],Pt=we[wt],Qt=we[wt===we.length-1?1:wt+1];if(R.appendEdge(L,Pt,Ve),yy(Pt,Ve,fe)){ne&&(dt=Qt.sub(Pt)._perp()._unit(),zt=!zt);continue}let Ot=Pt.sub(Ve)._perp(),Jt=Ot.x/(Math.abs(Ot.x)+Math.abs(Ot.y)),Vt=Ot.y>0?1:0,_i=Ve.dist(Pt);if(pt+_i>32768&&(pt=0),ne){je=Qt.sub(Pt)._perp()._unit();let Ei=cw(Ve,Pt,Qt,lw(dt,je),ne);isNaN(Ei)&&(Ei=0);let Oi=Pt.sub(Ve)._unit();Ve=Ve.add(Oi.mult(et))._round(),Pt=Pt.add(Oi.mult(-Ei))._round(),et=Ei,dt=je,B&&this.zoom>=17&&(se(Fe,Ve)||Fe.push(Ve),se(Fe,Pt)||Fe.push(Pt))}let Ht=Se.vertexLength,en=we.length>4&&hw(Ve,Pt,Qt),Ci=uw(pt,Pe,zt);if(Vm(this.layoutVertexArray,Ve.x,Ve.y,Jt,Vt,0,0,Ci),Vm(this.layoutVertexArray,Ve.x,Ve.y,Jt,Vt,0,1,Ci),pt+=_i,Ci=uw(pt,en,!zt),Pe=en,Vm(this.layoutVertexArray,Pt.x,Pt.y,Jt,Vt,0,0,Ci),Vm(this.layoutVertexArray,Pt.x,Pt.y,Jt,Vt,0,1,Ci),Se.vertexLength+=4,this.indexArray.emplaceBack(Ht+0,Ht+1,Ht+2),this.indexArray.emplaceBack(Ht+1,Ht+3,Ht+2),Se.primitiveLength+=2,ne){let Ei=ve+(wt===1?we.length-2:wt-2),Oi=wt===1?ve:Ei+1;if(this.indexArray.emplaceBack(Ht+1,Ei,Ht+3),this.indexArray.emplaceBack(Ei,Oi,Ht+3),Se.primitiveLength+=2,ft===void 0&&(ft=Ht),!yy(Qt,we[wt],fe)){let Mi=wt===we.length-1?ft:Se.vertexLength;this.indexArray.emplaceBack(Ht+2,Ht+3,Mi),this.indexArray.emplaceBack(Ht+3,Mi+1,Mi),this.indexArray.emplaceBack(Ht+3,Oi,Mi+1),Se.primitiveLength+=3}zt=!zt}if(C){let Ei=this.layoutVertexExtArray,Oi=I.projectTilePoint(Ve.x,Ve.y,s),Mi=I.projectTilePoint(Pt.x,Pt.y,s),pn=I.upVector(s,Ve.x,Ve.y),$i=I.upVector(s,Pt.x,Pt.y);Um(Ei,Oi,pn),Um(Ei,Oi,pn),Um(Ei,Mi,$i),Um(Ei,Mi,$i)}}D&&(ve+=we.length-1),B&&ne&&this.zoom>=17&&(Fe.length!==0&&se(Fe,Fe[0])&&Fe.pop(),this.groundEffect.addData(Fe,fe,b,ne>0))}this.footprintSegments.push(ke),ze.triangleCount=this.indexArray.length-ze.triangleArrayOffset,this.polygonSegments.push(ze),++L.footprintSegLen,++L.polygonSegLen}if(L.vertexCount=this.layoutVertexArray.length-L.vertexArrayOffset,L.groundVertexCount=this.groundEffect.vertexArray.length-L.groundVertexArrayOffset,L.vertexCount!==0){if(L.centroidXY=R.borders?iw:this.encodeCentroid(R,L),this.centroidData.push(L),R.borders){this.featuresOnBorder.push(R);let he=this.featuresOnBorder.length-1;for(let fe=0;fe<R.borders.length;fe++)R.borders[fe][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[fe].push(he)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,l,h,s,y),this.groundEffect.addPaintPropertiesData(e,o,l,h,s,y),this.maxHeight=Math.max(this.maxHeight,j)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((i,o)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[o].borders[e][0])}splitToSubtiles(){let e=[];for(let f=0;f<this.centroidData.length;f++){let y=this.centroidData[f],b=+(y.min.y+y.max.y>st),T=2*b+(+(y.min.x+y.max.x>st)^b);for(let I=0;I<y.polygonSegLen;I++){let C=y.polygonSegIdx+I;e.push({centroidIdx:f,subtile:T,polygonSegmentIdx:C,triangleSegmentIdx:this.polygonSegments[C].triangleSegIdx})}}let i=new hr;e.sort((f,y)=>f.triangleSegmentIdx===y.triangleSegmentIdx?f.subtile-y.subtile:f.triangleSegmentIdx-y.triangleSegmentIdx);let o=0,s=0,l=0;for(let f of e){if(f.triangleSegmentIdx!==o)break;l++}let h=e.length;for(;s!==e.length;){o=e[s].triangleSegmentIdx;let f=0,y=s,b=s;for(let T=y;T<l&&e[T].subtile===f;T++)b++;for(;y!==l;){let T=e[y];f=T.subtile;let I=this.centroidData[T.centroidIdx].min.clone(),C=this.centroidData[T.centroidIdx].max.clone(),D={vertexOffset:this.segments.segments[o].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[o].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let R=y;R<b;R++){let L=e[R],B=this.polygonSegments[L.polygonSegmentIdx],j=this.centroidData[L.centroidIdx].min,Z=this.centroidData[L.centroidIdx].max,K=this.indexArray.uint16;for(let Y=B.triangleArrayOffset;Y<B.triangleArrayOffset+B.triangleCount;Y++)i.emplaceBack(K[3*Y],K[3*Y+1],K[3*Y+2]);D.primitiveLength+=B.triangleCount,I.x=Math.min(I.x,j.x),I.y=Math.min(I.y,j.y),C.x=Math.max(C.x,Z.x),C.y=Math.max(C.y,Z.y)}D.primitiveLength>0&&this.triangleSubSegments.push({segment:D,min:I,max:C}),y=b;for(let R=y;R<l&&e[R].subtile===e[y].subtile;R++)b++}s=l;for(let T=s;T<h&&e[T].triangleSegmentIdx===e[s].triangleSegmentIdx;T++)l++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,o){let s=0,l=0,h=1<<e.canonical.z;if(i){let L=i.getMinMaxForTile(e);L&&(s=L.min,l=L.max)}l+=this.maxHeight;let f=e.toUnwrapped(),y,b=[f.canonical.x/h+f.wrap,f.canonical.y/h],T=[(f.canonical.x+1)/h+f.wrap,(f.canonical.y+1)/h],I=new Rn,C=(L,B,j)=>[L[0]*(1-j[0])+B[0]*j[0],L[1]*(1-j[1])+B[1]*j[1]],D=[],R=[];for(let L of this.triangleSubSegments){D[0]=L.min.x/st,D[1]=L.min.y/st,R[0]=L.max.x/st,R[1]=L.max.y/st;let B=C(b,T,D),j=C(b,T,R);if(new An([B[0],B[1],s],[j[0],j[1],l]).intersectsPrecise(o)===0){y&&(I.segments.push(y),y=void 0);continue}let Z=L.segment;y&&y.vertexOffset!==Z.vertexOffset&&(I.segments.push(y),y=void 0),y?(y.vertexLength+=Z.vertexLength,y.primitiveLength+=Z.primitiveLength):y={vertexOffset:Z.vertexOffset,primitiveLength:Z.primitiveLength,vertexLength:Z.vertexLength,primitiveOffset:Z.primitiveOffset,sortKey:void 0,vaos:{}}}return y&&I.segments.push(y),I}encodeCentroid(e,i){let o=e.centroid(),s=i.span(),l=Math.min(7,Math.round(s.x*this.tileToMeter/10)),h=Math.min(7,Math.round(s.y*this.tileToMeter/10));return new nt(ii(o.x,1,st-1)<<3|l,ii(o.y,1,st-1)<<3|h)}encodeBorderCentroid(e){if(!e.borders)return new nt(0,0);let i=e.borders,o=Number.MAX_VALUE;if(i[0][0]!==o||i[1][0]!==o){let s=i[0][0]!==o?0:1;return new nt(6|(i[0][0]!==o?0:65528),(i[s][0]+i[s][1])/2<<3|6)}{let s=i[2][0]!==o?2:3;return new nt((i[s][0]+i[s][1])/2<<3|6,6|(i[2][0]!==o?0:65528))}}showCentroid(e){let i=this.centroidData[e.centroidDataIndex];i.flags&=Zl,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);let i=e.vertexArrayOffset,o=e.vertexCount+e.vertexArrayOffset,s=e.flags&Zl?iw:e.centroidXY,l=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==s.y||l!==s.x){for(let h=i;h<o;++h)this.centroidVertexArray.emplace(h,s.x,s.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(let e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;let o=i.getReplacementRegionsForTile(e.toUnwrapped());if(function(l,h){if(l.length!==h.length)return!1;for(let f=0;f<l.length;f++)if(l[f].sourceId!==h[f].sourceId||!$1(l[f],h[f]))return!1;return!0}(this.activeReplacements,o))return;if(this.activeReplacements=o,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(let l of this.centroidData)l.flags&=2147483647;let s=[];for(let l of this.activeReplacements){let h=Math.pow(2,l.footprintTileId.canonical.z-e.canonical.z);for(let f of this.centroidData)if(!(f.flags&Zl||l.min.x>f.max.x||f.min.x>l.max.x||l.min.y>f.max.y||f.min.y>l.max.y))for(let y=0;y<f.footprintSegLen;y++){let b=this.footprintSegments[f.footprintSegIdx+y];if(s.length=0,jM(this.footprintVertices,b.vertexOffset,b.vertexCount,l.footprintTileId.canonical,e.canonical,s),Z1(l.footprint,s,this.footprintIndices.uint16,b.indexOffset,b.indexCount,-b.vertexOffset,-h)){f.flags|=Zl;break}}}for(let l of this.centroidData)this.writeCentroidToBuffer(l);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,o){let s=!1;for(let l=0;l<o.footprintSegLen;l++){let h=this.footprintSegments[o.footprintSegIdx+l],f=0;for(let y of h.ringIndices){for(let b=f,T=y+f-1;b<y+f;T=b++){let I=this.footprintVertices.int16[2*(b+h.vertexOffset)+0],C=this.footprintVertices.int16[2*(b+h.vertexOffset)+1],D=this.footprintVertices.int16[2*(T+h.vertexOffset)+1];C>i!=D>i&&e<(this.footprintVertices.int16[2*(T+h.vertexOffset)+0]-I)*(i-C)/(D-C)+I&&(s=!s)}f=y}}return s}getHeightAtTileCoord(e,i){let o=Number.NEGATIVE_INFINITY,s=!0,l=4*(e+st)*st+(i+st);if(this.partLookup.hasOwnProperty(l)){let h=this.partLookup[l];return h?{height:h.height,hidden:!!(h.flags&Zl)}:void 0}for(let h of this.centroidData)e>h.max.x||h.min.x>e||i>h.max.y||h.min.y>i||this.footprintContainsPoint(e,i,h)&&h&&h.height>o&&(o=h.height,this.partLookup[l]=h,s=!!(h.flags&Zl));if(o!==Number.NEGATIVE_INFINITY)return{height:o,hidden:s};this.partLookup[l]=void 0}}function lw(t,e){let i=t.add(e)._unit();return t.x*i.x+t.y*i.y}function NM(t,e,i,o){let s=e.sub(t)._perp()._unit(),l=i.sub(e)._perp()._unit();return cw(t,e,i,lw(s,l),o)}function cw(t,e,i,o,s){let l=Math.sqrt(1-o*o);return Math.min(t.dist(e)/3,e.dist(i)/3,s*l/o)}function yy(t,e,i){return t.x<i[0].x&&e.x<i[0].x||t.x>i[1].x&&e.x>i[1].x||t.y<i[0].y&&e.y<i[0].y||t.y>i[1].y&&e.y>i[1].y}function dw(t,e){return t.x<e[0].x||t.x>e[1].x||t.y<e[0].y||t.y>e[1].y}function hw(t,e,i){if(t.x<0||t.x>=st||e.x<0||e.x>=st||i.x<0||i.x>=st)return!1;let o=i.sub(e),s=o.perp(),l=t.sub(e);return(o.x*l.x+o.y*l.y)/Math.sqrt((o.x*o.x+o.y*o.y)*(l.x*l.x+l.y*l.y))>-.866&&s.x*l.x+s.y*l.y<0}function uw(t,e,i){let o=e?2|t:-3&t;return i?1|o:-2&o}function mw(){let t=Math.PI/32,e=Math.tan(t),i=Te;return i*Math.sqrt(1+2*e*e)-i}function pw(t,e,i){let o=1<<i.z,s=Gt(i.x/o),l=Gt((i.x+1)/o),h=yi(i.y/o),f=yi((i.y+1)/o);return function(y,b,T,I,C=0,D){let R=[];if(!y.length||!T||!I)return R;let L=(te,se)=>{for(let he of te)R.push({polygon:he,bounds:se})},B=Math.ceil(Math.log2(T)),j=Math.ceil(Math.log2(I)),Z=B-j,K=[];for(let te=0;te<Math.abs(Z);te++)K.push(Z>0?0:1);for(let te=0;te<Math.min(B,j);te++)K.push(0),K.push(1);let Y=y;if(Y=x_(Y,b[0].y-C,b[1].y+C,1),Y=x_(Y,b[0].x-C,b[1].x+C,0),!Y.length)return R;let ne=[];for(K.length?ne.push({polygons:Y,bounds:b,depth:0}):L(Y,b);ne.length;){let te=ne.pop(),se=te.depth,he=K[se],fe=te.bounds[0],ve=te.bounds[1],_e=he===0?fe.x:fe.y,Se=he===0?ve.x:ve.y,ze=D?D(he,_e,Se):.5*(_e+Se),ke=x_(te.polygons,_e-C,ze+C,he),Re=x_(te.polygons,ze-C,Se+C,he);if(ke.length){let we=[fe,new nt(he===0?ze:ve.x,he===1?ze:ve.y)];K.length>se+1?ne.push({polygons:ke,bounds:we,depth:se+1}):L(ke,we)}if(Re.length){let we=[new nt(he===0?ze:fe.x,he===1?ze:fe.y),ve];K.length>se+1?ne.push({polygons:Re,bounds:we,depth:se+1}):L(Re,we)}}return R}(t,e,Math.ceil((l-s)/11.25),Math.ceil((h-f)/11.25),1,(y,b,T)=>{if(y===0)return .5*(b+T);{let I=yi((i.y+b/st)/o);return(Nt(.5*(yi((i.y+T/st)/o)+I))*o-i.y)*st}})}function jM(t,e,i,o,s,l){let h=Math.pow(2,o.z-s.z);for(let f=0;f<i;f++){let y=t.int16[2*(f+e)+0],b=t.int16[2*(f+e)+1];y=(y+s.x*st)*h-o.x*st,b=(b+s.y*st)*h-o.y*st,l.push(new nt(y,b))}}mt(I_,"FillExtrusionBucket",{omit:["layers","features"]}),mt(rw,"PartData"),mt(nw,"FootprintSegment"),mt(ow,"BorderCentroidData"),mt(sw,"GroundEffect");let VM=new bn({visibility:new Qe(ye["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Qe(ye["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var UM={paint:new bn({"fill-extrusion-opacity":new Qe(ye["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new At(ye["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Qe(ye["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Qe(ye["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new At(ye["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new At(ye["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new At(ye["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Qe(ye["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Qe(ye["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Qe(ye["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Qe(ye["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Qe(ye["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Qe(ye["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Qe(ye["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Qe(ye["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new At(ye["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new At(ye["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Qe(ye["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Qe(ye["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Qe(ye["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Qe(ye["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Qe(ye["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:VM};class fh extends nt{constructor(e,i,o){super(e,i),this.z=o}}function Gm(t,e){return t.x*e.x+t.y*e.y}function fw(t,e){if(t.length===1){let i=0,o=e[i++],s;for(;!s||o.equals(s);)if(s=e[i++],!s)return 1/0;for(;i<e.length;i++){let l=e[i],h=t[0],f=s.sub(o),y=l.sub(o),b=h.sub(o),T=Gm(f,f),I=Gm(f,y),C=Gm(y,y),D=Gm(b,f),R=Gm(b,y),L=T*C-I*I,B=(C*D-I*R)/L,j=(T*R-I*D)/L,Z=o.z*(1-B-j)+s.z*B+l.z*j;if(isFinite(Z))return Z}return 1/0}{let i=1/0;for(let o of e)i=Math.min(i,o.z);return i}}function _w(t,e,i,o,s,l,h,f){let y=h*s.getElevationAt(t,e,!0,!0),b=l[0]!==0,T=b?l[1]===0?h*(l[0]/7-450):h*function(I,C,D){let R=Math.floor(C[0]/8),L=Math.floor(C[1]/8),B=10*(C[0]-8*R),j=10*(C[1]-8*L),Z=I.getElevationAt(R,L,!0,!0),K=I.getMeterToDEM(D),Y=Math.floor(.5*(B*K-1)),ne=Math.floor(.5*(j*K-1)),te=I.tileCoordToPixel(R,L),se=2*Y+1,he=2*ne+1,fe=function(Re,we,Pe,et,Fe){return[Re.getElevationAtPixel(we,Pe,!0),Re.getElevationAtPixel(we+Fe,Pe,!0),Re.getElevationAtPixel(we,Pe+Fe,!0),Re.getElevationAtPixel(we+et,Pe+Fe,!0)]}(I,te.x-Y,te.y-ne,se,he),ve=Math.abs(fe[0]-fe[1]),_e=Math.abs(fe[2]-fe[3]),Se=Math.abs(fe[0]-fe[2])+Math.abs(fe[1]-fe[3]),ze=Math.min(.25,.5*K*(ve+_e)/se),ke=Math.min(.25,.5*K*Se/he);return Z+Math.max(ze*B,ke*j)}(s,l,f):y;return{base:y+(i===0)?-1:i,top:b?Math.max(T+o,y+i+2):y+o}}let GM=Bi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:$M}=GM,qM=Bi([{name:"a_packed",components:4,type:"Float32"}]),{members:HM}=qM;class gw{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new ql({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){let o=this.getKey(e,i);return this.positions[o]}trim(){let e=this.width,i=this.height=yc(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,o){let s=[],l=e.length%2==1?-e[e.length-1]*o:0,h=e[0]*o,f=!0;s.push({left:l,right:h,isDash:f,zeroLength:e[0]===0});let y=e[0];for(let b=1;b<e.length;b++){f=!f;let T=e[b];l=y*o,y+=T,h=y*o,s.push({left:l,right:h,isDash:f,zeroLength:T===0})}return s}addRoundDash(e,i,o){let s=i/2;for(let l=-o;l<=o;l++){let h=this.width*(this.nextRow+o+l),f=0,y=e[f];for(let b=0;b<this.width;b++){b/y.right>1&&(y=e[++f]);let T=Math.abs(b-y.left),I=Math.abs(b-y.right),C=Math.min(T,I),D,R=l/o*(s+1);if(y.isDash){let L=s-Math.abs(R);D=Math.sqrt(C*C+L*L)}else D=s-Math.sqrt(C*C+R*R);this.image.data[h+b]=Math.max(0,Math.min(255,D+128))}}}addRegularDash(e,i){for(let y=e.length-1;y>=0;--y){let b=e[y],T=e[y+1];b.zeroLength?e.splice(y,1):T&&T.isDash===b.isDash&&(T.left=b.left,e.splice(y,1))}let o=e[0],s=e[e.length-1];o.isDash===s.isDash&&(o.left=s.left-this.width,s.right=o.right+this.width);let l=this.width*this.nextRow,h=0,f=e[h];for(let y=0;y<this.width;y++){y/f.right>1&&(f=e[++h]);let b=Math.abs(y-f.left),T=Math.abs(y-f.right),I=Math.min(b,T);this.image.data[l+y]=Math.max(0,Math.min(255,(f.isDash?I:-I)+i+128))}}addDash(e,i){let o=this.getKey(e,i);if(this.positions[o])return this.positions[o];let s=i==="round",l=s?7:0,h=2*l+1;if(this.nextRow+h>this.height)return Pn("LineAtlas out of space"),null;e.length===0&&e.push(1);let f=0;for(let T=0;T<e.length;T++)e[T]<0&&(Pn("Negative value is found in line dasharray, replacing values with 0"),e[T]=0),f+=e[T];if(f!==0){let T=this.width/f,I=this.getDashRanges(e,this.width,T);s?this.addRoundDash(I,T,l):this.addRegularDash(I,i==="square"?.5*T:0)}let y=this.nextRow+l;this.nextRow+=h;let b={tl:[y,l],br:[f,0]};return this.positions[o]=b,b}}mt(gw,"LineAtlas");let ZM=v_.types,WM=Math.cos(Math.PI/180*37.5);class by{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new xm,this.layoutVertexArray2=new ms,this.indexArray=new hr,this.programConfigurations=new U(e.layers,e.zoom),this.segments=new Rn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,o,s){this.hasPattern=py("line",this.layers,i);let l=this.layers[0].layout.get("line-sort-key"),h=[];for(let{feature:T,id:I,index:C,sourceLayerIndex:D}of e){let R=this.layers[0]._featureFilter.needGeometry,L=tr(T,R);if(!this.layers[0]._featureFilter.filter(new yn(this.zoom),L,o))continue;let B=l?l.evaluate(L,{},o):void 0,j={id:I,properties:T.properties,type:T.type,sourceLayerIndex:D,index:C,geometry:R?L.geometry:mr(T,o,s),patterns:{},sortKey:B};h.push(j)}l&&h.sort((T,I)=>T.sortKey-I.sortKey);let{lineAtlas:f,featureIndex:y}=i,b=this.addConstantDashes(f);for(let T of h){let{geometry:I,index:C,sourceLayerIndex:D}=T;if(b&&this.addFeatureDashes(T,f),this.hasPattern){let R=fy("line",this.layers,T,this.zoom,i);this.patternFeatures.push(R)}else this.addFeature(T,I,C,o,f.positions,i.availableImages,i.brightness);y.insert(e[C].feature,I,C,D,this.index)}}addConstantDashes(e){let i=!1;for(let o of this.layers){let s=o.paint.get("line-dasharray").value,l=o.layout.get("line-cap").value;if(s.kind!=="constant"||l.kind!=="constant")i=!0;else{let h=l.value,f=s.value;if(!f)continue;e.addDash(f,h)}}return i}addFeatureDashes(e,i){let o=this.zoom;for(let s of this.layers){let l=s.paint.get("line-dasharray").value,h=s.layout.get("line-cap").value;if(l.kind==="constant"&&h.kind==="constant")continue;let f,y;if(l.kind==="constant"){if(f=l.value,!f)continue}else f=l.evaluate({zoom:o},e);y=h.kind==="constant"?h.value:h.evaluate({zoom:o},e),i.addDash(f,y),e.patterns[s.id]=i.getKey(f,y)}}update(e,i,o,s,l){let h=Object.keys(e).length!==0;h&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,i,h?this.stateDependentLayers:this.layers,o,s,l)}addFeatures(e,i,o,s,l,h){for(let f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,i,o,s,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,HM)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,$M),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,o,s,l,h,f){let y=this.layers[0].layout,b=y.get("line-join").evaluate(e,{}),T=y.get("line-cap").evaluate(e,{}),I=y.get("line-miter-limit"),C=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(let D of i)this.addLine(D,e,b,T,I,C);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,l,h,s,f)}addLine(e,i,o,s,l,h){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let j=0;j<e.length-1;j++)this.totalDistance+=e[j].dist(e[j+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let f=ZM[i.type]==="Polygon",y=e.length;for(;y>=2&&e[y-1].equals(e[y-2]);)y--;let b=0;for(;b<y-1&&e[b].equals(e[b+1]);)b++;if(y<(f?3:2))return;o==="bevel"&&(l=1.05);let T=this.overscaling<=16?15*st/(512*this.overscaling):0,I=this.segments.prepareSegment(10*y,this.layoutVertexArray,this.indexArray),C,D,R,L,B;this.e1=this.e2=-1,f&&(C=e[y-2],B=e[b].sub(C)._unit()._perp());for(let j=b;j<y;j++){if(R=j===y-1?f?e[b+1]:void 0:e[j+1],R&&e[j].equals(R))continue;B&&(L=B),C&&(D=C),C=e[j],B=R?R.sub(C)._unit()._perp():L,L=L||B;let Z=L.add(B);Z.x===0&&Z.y===0||Z._unit();let K=L.x*B.x+L.y*B.y,Y=Z.x*B.x+Z.y*B.y,ne=Y!==0?1/Y:1/0,te=2*Math.sqrt(2-2*Y),se=Y<WM&&D&&R,he=L.x*B.y-L.y*B.x>0;if(se&&j>b){let _e=C.dist(D);if(_e>2*T){let Se=C.sub(C.sub(D)._mult(T/_e)._round());this.updateDistance(D,Se),this.addCurrentVertex(Se,L,0,0,I),D=Se}}let fe=D&&R,ve=fe?o:f?"butt":s;if(fe&&ve==="round"&&(ne<h?ve="miter":ne<=2&&(ve="fakeround")),ve==="miter"&&ne>l&&(ve="bevel"),ve==="bevel"&&(ne>2&&(ve="flipbevel"),ne<l&&(ve="miter")),D&&this.updateDistance(D,C),ve==="miter")Z._mult(ne),this.addCurrentVertex(C,Z,0,0,I);else if(ve==="flipbevel"){if(ne>100)Z=B.mult(-1);else{let _e=ne*L.add(B).mag()/L.sub(B).mag();Z._perp()._mult(_e*(he?-1:1))}this.addCurrentVertex(C,Z,0,0,I),this.addCurrentVertex(C,Z.mult(-1),0,0,I)}else if(ve==="bevel"||ve==="fakeround"){let _e=-Math.sqrt(ne*ne-1),Se=he?_e:0,ze=he?0:_e;if(D&&this.addCurrentVertex(C,L,Se,ze,I),ve==="fakeround"){let ke=Math.round(180*te/Math.PI/20);for(let Re=1;Re<ke;Re++){let we=Re/ke;if(we!==.5){let et=we-.5;we+=we*et*(we-1)*((1.0904+K*(K*(3.55645-1.43519*K)-3.2452))*et*et+(.848013+K*(.215638*K-1.06021)))}let Pe=B.sub(L)._mult(we)._add(L)._unit()._mult(he?-1:1);this.addHalfVertex(C,Pe.x,Pe.y,!1,he,0,I)}}R&&this.addCurrentVertex(C,B,-Se,-ze,I)}else if(ve==="butt")this.addCurrentVertex(C,Z,0,0,I);else if(ve==="square"){let _e=D?1:-1;D||this.addCurrentVertex(C,Z,_e,_e,I),this.addCurrentVertex(C,Z,0,0,I),D&&this.addCurrentVertex(C,Z,_e,_e,I)}else ve==="round"&&(D&&(this.addCurrentVertex(C,L,0,0,I),this.addCurrentVertex(C,L,1,1,I,!0)),R&&(this.addCurrentVertex(C,B,-1,-1,I,!0),this.addCurrentVertex(C,B,0,0,I)));if(se&&j<y-1){let _e=C.dist(R);if(_e>2*T){let Se=C.add(R.sub(C)._mult(T/_e)._round());this.updateDistance(C,Se),this.addCurrentVertex(Se,B,0,0,I),C=Se}}}}addCurrentVertex(e,i,o,s,l,h=!1){let f=i.y*s-i.x,y=-i.y-i.x*s;this.addHalfVertex(e,i.x+i.y*o,i.y-i.x*o,h,!1,o,l),this.addHalfVertex(e,f,y,h,!0,-s,l)}addHalfVertex({x:e,y:i},o,s,l,h,f,y){this.layoutVertexArray.emplaceBack((e<<1)+(l?1:0),(i<<1)+(h?1:0),Math.round(63*o)+128,Math.round(63*s)+128,1+(f===0?0:f<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);let b=y.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,b),y.primitiveLength++),h?this.e2=b:this.e1=b}updateScaledDistance(){if(this.lineClips){let e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,i){this.distance+=e.dist(i),this.updateScaledDistance()}}mt(by,"LineBucket",{omit:["layers","patternFeatures"]});let XM=new bn({"line-cap":new At(ye.layout_line["line-cap"]),"line-join":new At(ye.layout_line["line-join"]),"line-miter-limit":new Qe(ye.layout_line["line-miter-limit"]),"line-round-limit":new Qe(ye.layout_line["line-round-limit"]),"line-sort-key":new At(ye.layout_line["line-sort-key"]),visibility:new Qe(ye.layout_line.visibility)});var yw={paint:new bn({"line-opacity":new At(ye.paint_line["line-opacity"]),"line-color":new At(ye.paint_line["line-color"]),"line-translate":new Qe(ye.paint_line["line-translate"]),"line-translate-anchor":new Qe(ye.paint_line["line-translate-anchor"]),"line-width":new At(ye.paint_line["line-width"]),"line-gap-width":new At(ye.paint_line["line-gap-width"]),"line-offset":new At(ye.paint_line["line-offset"]),"line-blur":new At(ye.paint_line["line-blur"]),"line-dasharray":new At(ye.paint_line["line-dasharray"]),"line-pattern":new At(ye.paint_line["line-pattern"]),"line-gradient":new Ks(ye.paint_line["line-gradient"]),"line-trim-offset":new Qe(ye.paint_line["line-trim-offset"]),"line-emissive-strength":new Qe(ye.paint_line["line-emissive-strength"]),"line-border-width":new At(ye.paint_line["line-border-width"]),"line-border-color":new At(ye.paint_line["line-border-color"])}),layout:XM};function bw(t,e,i){return e*(st/(t.tileSize*Math.pow(2,i-t.tileID.overscaledZ)))}function vw(t,e){return 1/bw(t,1,e.tileZoom)}function xw(t,e,i,o){return t.translatePosMatrix(o||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}let ww=t=>{let e=[];Tw(t)&&e.push("RENDER_LINE_DASH"),t.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");let i=t.paint.get("line-trim-offset");return i[0]===0&&i[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),t.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER"),e};function Tw(t){let e=t.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}let kw=new class extends At{possiblyEvaluate(t,e){return e=new yn(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,i,o){return e=Er({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,i,o)}}(yw.paint.properties["line-width"].specification);function Iw(t,e){return e>0?e+2*t:t}kw.useIntegerZoom=!0;let YM=Bi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),KM=Bi([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),QM=Bi([{name:"a_projected_pos",components:4,type:"Float32"}],4);Bi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let JM=Bi([{name:"a_z_offset",components:1,type:"Float32"}],4),eE=Bi([{name:"a_texb",components:2,type:"Uint16"}]),tE=Bi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),iE=Bi([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);Bi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let Sw=Bi([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),nE=Bi([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Bi([{name:"triangle",components:3,type:"Uint16"}]),Bi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Bi([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),Bi([{type:"Float32",name:"offsetX"}]),Bi([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Dr=24;let Na=128;function vy(t,e){let{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new yn(t+1))};if(i.kind==="source")return{kind:"source"};{let{zoomStops:o,interpolationType:s}=i,l=0;for(;l<o.length&&o[l]<=t;)l++;l=Math.max(0,l-1);let h=l;for(;h<o.length&&o[h]<t+1;)h++;h=Math.min(o.length-1,h);let f=o[l],y=o[h];return i.kind==="composite"?{kind:"composite",minZoom:f,maxZoom:y,interpolationType:s}:{kind:"camera",minZoom:f,maxZoom:y,minSize:i.evaluate(new yn(f)),maxSize:i.evaluate(new yn(y)),interpolationType:s}}}function S_(t,{uSize:e,uSizeT:i},{lowerSize:o,upperSize:s}){return t.kind==="source"?o/Na:t.kind==="composite"?fi(o/Na,s/Na,i):e}function _h(t,e){let i=0,o=0;if(t.kind==="constant")o=t.layoutSize;else if(t.kind!=="source"){let{interpolationType:s,minZoom:l,maxZoom:h}=t,f=s?ii(yo.interpolationFactor(s,e,l,h),0,1):0;t.kind==="camera"?o=fi(t.minSize,t.maxSize,f):i=f}return{uSizeT:i,uSize:o}}var rE=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Na,evaluateSizeForFeature:S_,evaluateSizeForZoom:_h,getSizeData:vy});function oE(t,e,i){return t.sections.forEach(o=>{o.text=function(s,l,h){let f=l.layout.get("text-transform").evaluate(h,{});return f==="uppercase"?s=s.toLocaleUpperCase():f==="lowercase"&&(s=s.toLocaleLowerCase()),bo.applyArabicShaping&&(s=bo.applyArabicShaping(s)),s}(o.text,e,i)}),t}let $m={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42","\u2190":"\u2191","\u2192":"\u2193"};function aE(t){return t==="\uFE36"||t==="\uFE48"||t==="\uFE38"||t==="\uFE44"||t==="\uFE42"||t==="\uFE3E"||t==="\uFE3C"||t==="\uFE3A"||t==="\uFE18"||t==="\uFE40"||t==="\uFE10"||t==="\uFE13"||t==="\uFE14"||t==="\uFF40"||t==="\uFFE3"||t==="\uFE11"||t==="\uFE12"}function sE(t){return t==="\uFE35"||t==="\uFE47"||t==="\uFE37"||t==="\uFE43"||t==="\uFE41"||t==="\uFE3D"||t==="\uFE3B"||t==="\uFE39"||t==="\uFE17"||t==="\uFE3F"}var lE={read:function(t,e,i,o,s){var l,h,f=8*s-o-1,y=(1<<f)-1,b=y>>1,T=-7,I=i?s-1:0,C=i?-1:1,D=t[e+I];for(I+=C,l=D&(1<<-T)-1,D>>=-T,T+=f;T>0;l=256*l+t[e+I],I+=C,T-=8);for(h=l&(1<<-T)-1,l>>=-T,T+=o;T>0;h=256*h+t[e+I],I+=C,T-=8);if(l===0)l=1-b;else{if(l===y)return h?NaN:1/0*(D?-1:1);h+=Math.pow(2,o),l-=b}return(D?-1:1)*h*Math.pow(2,l-o)},write:function(t,e,i,o,s,l){var h,f,y,b=8*l-s-1,T=(1<<b)-1,I=T>>1,C=s===23?Math.pow(2,-24)-Math.pow(2,-77):0,D=o?0:l-1,R=o?1:-1,L=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(f=isNaN(e)?1:0,h=T):(h=Math.floor(Math.log(e)/Math.LN2),e*(y=Math.pow(2,-h))<1&&(h--,y*=2),(e+=h+I>=1?C/y:C*Math.pow(2,1-I))*y>=2&&(h++,y/=2),h+I>=T?(f=0,h=T):h+I>=1?(f=(e*y-1)*Math.pow(2,s),h+=I):(f=e*Math.pow(2,I-1)*Math.pow(2,s),h=0));s>=8;t[i+D]=255&f,D+=R,f/=256,s-=8);for(h=h<<s|f,b+=s;b>0;t[i+D]=255&h,D+=R,h/=256,b-=8);t[i+D-R]|=128*L}},Cw=mn,C_=lE;function mn(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}mn.Varint=0,mn.Fixed64=1,mn.Bytes=2,mn.Fixed32=5;var xy=4294967296,Mw=1/xy,Ew=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function ol(t){return t.type===mn.Bytes?t.readVarint()+t.pos:t.pos+1}function gh(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function Aw(t,e,i){var o=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(o);for(var s=i.pos-1;s>=t;s--)i.buf[s+o]=i.buf[s]}function cE(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function dE(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function hE(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function uE(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function mE(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function pE(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function fE(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function _E(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function gE(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function M_(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function yh(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function Dw(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}mn.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var o=this.readVarint(),s=o>>3,l=this.pos;this.type=7&o,t(s,e,this),this.pos===l&&this.skip(o)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=M_(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Dw(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=M_(this.buf,this.pos)+M_(this.buf,this.pos+4)*xy;return this.pos+=8,t},readSFixed64:function(){var t=M_(this.buf,this.pos)+Dw(this.buf,this.pos+4)*xy;return this.pos+=8,t},readFloat:function(){var t=C_.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=C_.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i,o=this.buf;return e=127&(i=o[this.pos++]),i<128?e:(e|=(127&(i=o[this.pos++]))<<7,i<128?e:(e|=(127&(i=o[this.pos++]))<<14,i<128?e:(e|=(127&(i=o[this.pos++]))<<21,i<128?e:function(s,l,h){var f,y,b=h.buf;if(f=(112&(y=b[h.pos++]))>>4,y<128||(f|=(127&(y=b[h.pos++]))<<3,y<128)||(f|=(127&(y=b[h.pos++]))<<10,y<128)||(f|=(127&(y=b[h.pos++]))<<17,y<128)||(f|=(127&(y=b[h.pos++]))<<24,y<128)||(f|=(1&(y=b[h.pos++]))<<31,y<128))return gh(s,f,l);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=o[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&Ew?function(i,o,s){return Ew.decode(i.subarray(o,s))}(this.buf,e,t):function(i,o,s){for(var l="",h=o;h<s;){var f,y,b,T=i[h],I=null,C=T>239?4:T>223?3:T>191?2:1;if(h+C>s)break;C===1?T<128&&(I=T):C===2?(192&(f=i[h+1]))==128&&(I=(31&T)<<6|63&f)<=127&&(I=null):C===3?(y=i[h+2],(192&(f=i[h+1]))==128&&(192&y)==128&&((I=(15&T)<<12|(63&f)<<6|63&y)<=2047||I>=55296&&I<=57343)&&(I=null)):C===4&&(y=i[h+2],b=i[h+3],(192&(f=i[h+1]))==128&&(192&y)==128&&(192&b)==128&&((I=(15&T)<<18|(63&f)<<12|(63&y)<<6|63&b)<=65535||I>=1114112)&&(I=null)),I===null?(I=65533,C=1):I>65535&&(I-=65536,l+=String.fromCharCode(I>>>10&1023|55296),I=56320|1023&I),l+=String.fromCharCode(I),h+=C}return l}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==mn.Bytes)return t.push(this.readVarint(e));var i=ol(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==mn.Bytes)return t.push(this.readSVarint());var e=ol(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==mn.Bytes)return t.push(this.readBoolean());var e=ol(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==mn.Bytes)return t.push(this.readFloat());var e=ol(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==mn.Bytes)return t.push(this.readDouble());var e=ol(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==mn.Bytes)return t.push(this.readFixed32());var e=ol(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==mn.Bytes)return t.push(this.readSFixed32());var e=ol(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==mn.Bytes)return t.push(this.readFixed64());var e=ol(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==mn.Bytes)return t.push(this.readSFixed64());var e=ol(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===mn.Varint)for(;this.buf[this.pos++]>127;);else if(e===mn.Bytes)this.pos=this.readVarint()+this.pos;else if(e===mn.Fixed32)this.pos+=4;else{if(e!==mn.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),yh(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),yh(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),yh(this.buf,-1&t,this.pos),yh(this.buf,Math.floor(t*Mw),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),yh(this.buf,-1&t,this.pos),yh(this.buf,Math.floor(t*Mw),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,i){var o,s;if(e>=0?(o=e%4294967296|0,s=e/4294967296|0):(s=~(-e/4294967296),4294967295^(o=~(-e%4294967296))?o=o+1|0:(o=0,s=s+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),function(l,h,f){f.buf[f.pos++]=127&l|128,l>>>=7,f.buf[f.pos++]=127&l|128,l>>>=7,f.buf[f.pos++]=127&l|128,l>>>=7,f.buf[f.pos++]=127&l|128,f.buf[f.pos]=127&(l>>>=7)}(o,0,i),function(l,h){var f=(7&l)<<4;h.buf[h.pos++]|=f|((l>>>=3)?128:0),l&&(h.buf[h.pos++]=127&l|((l>>>=7)?128:0),l&&(h.buf[h.pos++]=127&l|((l>>>=7)?128:0),l&&(h.buf[h.pos++]=127&l|((l>>>=7)?128:0),l&&(h.buf[h.pos++]=127&l|((l>>>=7)?128:0),l&&(h.buf[h.pos++]=127&l)))))}(s,i)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(o,s,l){for(var h,f,y=0;y<s.length;y++){if((h=s.charCodeAt(y))>55295&&h<57344){if(!f){h>56319||y+1===s.length?(o[l++]=239,o[l++]=191,o[l++]=189):f=h;continue}if(h<56320){o[l++]=239,o[l++]=191,o[l++]=189,f=h;continue}h=f-55296<<10|h-56320|65536,f=null}else f&&(o[l++]=239,o[l++]=191,o[l++]=189,f=null);h<128?o[l++]=h:(h<2048?o[l++]=h>>6|192:(h<65536?o[l++]=h>>12|224:(o[l++]=h>>18|240,o[l++]=h>>12&63|128),o[l++]=h>>6&63|128),o[l++]=63&h|128)}return l}(this.buf,t,this.pos);var i=this.pos-e;i>=128&&Aw(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),C_.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),C_.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var o=this.pos-i;o>=128&&Aw(i,o,this),this.pos=i-1,this.writeVarint(o),this.pos+=o},writeMessage:function(t,e,i){this.writeTag(t,mn.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,cE,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,dE,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,mE,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,hE,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,uE,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,pE,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,fE,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,_E,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,gE,e)},writeBytesField:function(t,e){this.writeTag(t,mn.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,mn.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,mn.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,mn.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,mn.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,mn.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,mn.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,mn.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,mn.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,mn.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};var bh=mi(Cw);let wy=3;function yE(t,e,i){e.glyphs=[],t===1&&i.readMessage(bE,e)}function bE(t,e,i){if(t===3){let{id:o,bitmap:s,width:l,height:h,left:f,top:y,advance:b}=i.readMessage(vE,{});e.glyphs.push({id:o,bitmap:new ql({width:l+2*wy,height:h+2*wy},s),metrics:{width:l,height:h,left:f,top:y,advance:b}})}else t===4?e.ascender=i.readSVarint():t===5&&(e.descender=i.readSVarint())}function vE(t,e,i){t===1?e.id=i.readVarint():t===2?e.bitmap=i.readBytes():t===3?e.width=i.readVarint():t===4?e.height=i.readVarint():t===5?e.left=i.readSVarint():t===6?e.top=i.readSVarint():t===7&&(e.advance=i.readVarint())}let Pw=wy,ra={horizontal:1,vertical:2,horizontalOnly:3};class qm{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,i){let o=new qm;return o.scale=e||1,o.fontStack=i,o}static forImage(e){let i=new qm;return i.imageName=e,i}}class vh{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i){let o=new vh;for(let s=0;s<e.sections.length;s++){let l=e.sections[s];l.image?o.addImageSection(l):o.addTextSection(l,i)}return o}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(i,o){let s="";for(let l=0;l<i.length;l++){let h=i.charCodeAt(l+1)||null,f=i.charCodeAt(l-1)||null;s+=!o&&(h&&zf(h)&&!$m[i[l+1]]||f&&zf(f)&&!$m[i[l-1]])||!$m[i[l]]?i[l]:$m[i[l]]}return s}(this.text,e)}trim(){let e=0;for(let o=0;o<this.text.length&&E_[this.text.charCodeAt(o)];o++)e++;let i=this.text.length;for(let o=this.text.length-1;o>=0&&o>=e&&E_[this.text.charCodeAt(o)];o--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){let o=new vh;return o.text=this.text.substring(e,i),o.sectionIndex=this.sectionIndex.slice(e,i),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(qm.forText(e.scale,e.fontStack||i));let o=this.sections.length-1;for(let s=0;s<e.text.length;++s)this.sectionIndex.push(o)}addImageSection(e){let i=e.image?e.image.namePrimary:"";if(i.length===0)return void Pn("Can't add FormattedSection with an empty image.");let o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCodePoint(o),this.sections.push(qm.forImage(i)),this.sectionIndex.push(this.sections.length-1)):Pn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Ty(t,e,i,o,s,l,h,f,y,b,T,I,C,D,R){let L=vh.fromFeature(t,s);I===ra.vertical&&L.verticalizePunctuation(C);let B=[],j=function(te,se,he,fe,ve,_e){if(!te)return[];let Se=[],ze=function(Pe,et,Fe,ft,dt,je){let zt=0;for(let wt=0;wt<Pe.length();wt++){let pt=Pe.getSection(wt);zt+=Rw(Pe.getCodePoint(wt),pt,ft,dt,et,je)}return zt/Math.max(1,Math.ceil(zt/Fe))}(te,se,he,fe,ve,_e),ke=te.text.indexOf("\u200B")>=0,Re=0;for(let Pe=0;Pe<te.length();Pe++){let et=te.getSection(Pe),Fe=te.getCodePoint(Pe);if(E_[Fe]||(Re+=Rw(Fe,et,fe,ve,se,_e)),Pe<te.length()-1){let ft=!((we=Fe)<11904||!(yt["Bopomofo Extended"](we)||yt.Bopomofo(we)||yt["CJK Compatibility Forms"](we)||yt["CJK Compatibility Ideographs"](we)||yt["CJK Compatibility"](we)||yt["CJK Radicals Supplement"](we)||yt["CJK Strokes"](we)||yt["CJK Symbols and Punctuation"](we)||yt["CJK Unified Ideographs Extension A"](we)||yt["CJK Unified Ideographs"](we)||yt["Enclosed CJK Letters and Months"](we)||yt["Halfwidth and Fullwidth Forms"](we)||yt.Hiragana(we)||yt["Ideographic Description Characters"](we)||yt["Kangxi Radicals"](we)||yt["Katakana Phonetic Extensions"](we)||yt.Katakana(we)||yt["Vertical Forms"](we)||yt["Yi Radicals"](we)||yt["Yi Syllables"](we)));(xE[Fe]||ft||et.imageName)&&Se.push(zw(Pe+1,Re,ze,Se,wE(Fe,te.getCodePoint(Pe+1),ft&&ke),!1))}}var we;return Ow(zw(te.length(),Re,ze,Se,0,!0))}(L,b,l,e,o,D),{processBidirectionalText:Z,processStyledBidirectionalText:K}=bo;if(Z&&L.sections.length===1){let te=Z(L.toString(),j);for(let se of te){let he=new vh;he.text=se,he.sections=L.sections;for(let fe=0;fe<se.length;fe++)he.sectionIndex.push(0);B.push(he)}}else if(K){let te=K(L.text,L.sectionIndex,j);for(let se of te){let he=new vh;he.text=se[0],he.sectionIndex=se[1],he.sections=L.sections,B.push(he)}}else B=function(te,se){let he=[],fe=te.text,ve=0;for(let _e of se)he.push(te.substring(ve,_e)),ve=_e;return ve<fe.length&&he.push(te.substring(ve,fe.length)),he}(L,j);let Y=[],ne={positionedLines:Y,text:L.toString(),top:T[1],bottom:T[1],left:T[0],right:T[0],writingMode:I,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(te,se,he,fe,ve,_e,Se,ze,ke,Re,we,Pe){let et=0,Fe=0,ft=0,dt=ze==="right"?1:ze==="left"?0:.5,je=!1;for(let Qt of ve){let Ot=Qt.getSections();for(let Jt of Ot){if(Jt.imageName)continue;let Vt=se[Jt.fontStack];if(Vt&&(je=Vt.ascender!==void 0&&Vt.descender!==void 0,!je))break}if(!je)break}let zt=0;for(let Qt of ve){Qt.trim();let Ot=Qt.getMaxScale(),Jt=(Ot-1)*Dr,Vt={positionedGlyphs:[],lineOffset:0};te.positionedLines[zt]=Vt;let _i=Vt.positionedGlyphs,Ht=0;if(!Qt.length()){Fe+=_e,++zt;continue}let en=0,Ci=0;for(let Oi=0;Oi<Qt.length();Oi++){let Mi=Qt.getSection(Oi),pn=Qt.getSectionIndex(Oi),$i=Qt.getCodePoint(Oi),Ln=Mi.scale,ar=null,Cr=null,cn=null,wn=Dr,gr=0,yr=!(ke===ra.horizontal||!we&&!om($i)||we&&(E_[$i]||(wt=$i,yt.Arabic(wt)||yt["Arabic Supplement"](wt)||yt["Arabic Extended-A"](wt)||yt["Arabic Presentation Forms-A"](wt)||yt["Arabic Presentation Forms-B"](wt))));if(Mi.imageName){let br=fe[Mi.imageName];if(!br)continue;cn=Mi.imageName,te.iconsInText=te.iconsInText||!0,Cr=br.paddedRect;let on=br.displaySize;Ln=Ln*Dr/Pe,ar={width:on[0],height:on[1],left:0,top:-Pw,advance:yr?on[1]:on[0],localGlyph:!1},gr=je?-ar.height*Ln:Ot*Dr-17-on[1]*Ln,wn=ar.advance;let Lo=(yr?on[0]:on[1])*Ln-Dr*Ot;Lo>0&&Lo>Ht&&(Ht=Lo)}else{let br=he[Mi.fontStack];if(!br)continue;br[$i]&&(Cr=br[$i]);let on=se[Mi.fontStack];if(!on)continue;let Lo=on.glyphs[$i];if(!Lo)continue;if(ar=Lo.metrics,wn=$i!==8203?Dr:0,je){let ec=on.ascender!==void 0?Math.abs(on.ascender):0,co=on.descender!==void 0?Math.abs(on.descender):0,Kr=(ec+co)*Ln;en<Kr&&(en=Kr,Ci=(ec-co)/2*Ln),gr=-ec*Ln}else gr=(Ot-Ln)*Dr-17}yr?(te.verticalizable=!0,_i.push({glyph:$i,imageName:cn,x:et,y:Fe+gr,vertical:yr,scale:Ln,localGlyph:ar.localGlyph,fontStack:Mi.fontStack,sectionIndex:pn,metrics:ar,rect:Cr}),et+=wn*Ln+Re):(_i.push({glyph:$i,imageName:cn,x:et,y:Fe+gr,vertical:yr,scale:Ln,localGlyph:ar.localGlyph,fontStack:Mi.fontStack,sectionIndex:pn,metrics:ar,rect:Cr}),et+=ar.advance*Ln+Re)}_i.length!==0&&(ft=Math.max(et-Re,ft),je?Fw(_i,dt,Ht,Ci,_e*Ot/2):Fw(_i,dt,Ht,0,_e/2)),et=0;let Ei=_e*Ot+Ht;Vt.lineOffset=Math.max(Ht,Jt),Fe+=Ei,++zt}var wt;let pt=Fe,{horizontalAlign:Ve,verticalAlign:Pt}=ky(Se);(function(Qt,Ot,Jt,Vt,_i,Ht){let en=(Ot-Jt)*_i,Ci=-Ht*Vt;for(let Ei of Qt)for(let Oi of Ei.positionedGlyphs)Oi.x+=en,Oi.y+=Ci})(te.positionedLines,dt,Ve,Pt,ft,pt),te.top+=-Pt*pt,te.bottom=te.top+pt,te.left+=-Ve*ft,te.right=te.left+ft,te.hasBaseline=je}(ne,e,i,o,B,h,f,y,I,b,C,R),!function(te){for(let se of te)if(se.positionedGlyphs.length!==0)return!1;return!0}(Y)&&ne}let E_={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},xE={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Rw(t,e,i,o,s,l){if(e.imageName){let h=o[e.imageName];return h?h.displaySize[0]*e.scale*Dr/l+s:0}{let h=i[e.fontStack],f=h&&h.glyphs[t];return f?f.metrics.advance*e.scale+s:0}}function Lw(t,e,i,o){let s=Math.pow(t-e,2);return o?t<e?s/2:2*s:s+Math.abs(i)*i}function wE(t,e,i){let o=0;return t===10&&(o-=1e4),i&&(o+=150),t!==40&&t!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function zw(t,e,i,o,s,l){let h=null,f=Lw(e,i,s,l);for(let y of o){let b=Lw(e-y.x,i,s,l)+y.badness;b<=f&&(h=y,f=b)}return{index:t,x:e,priorBreak:h,badness:f}}function Ow(t){return t?Ow(t.priorBreak).concat(t.index):[]}function ky(t){let e=.5,i=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function Fw(t,e,i,o,s){if(!(e||i||o||s))return;let l=t.length-1,h=t[l],f=(h.x+h.metrics.advance*h.scale)*e;for(let y=0;y<=l;y++)t[y].x-=f,t[y].y+=i+o+s}function TE(t,e,i,o){let{horizontalAlign:s,verticalAlign:l}=ky(o),h=i[0]-t.displaySize[0]*s,f=i[1]-t.displaySize[1]*l;return{imagePrimary:t,imageSecondary:e,top:f,bottom:f+t.displaySize[1],left:h,right:h+t.displaySize[0]}}function Bw(t,e,i,o,s,l){let h=t.imagePrimary,f;if(h.content){let B=h.content,j=h.pixelRatio||1;f=[B[0]/j,B[1]/j,h.displaySize[0]-B[2]/j,h.displaySize[1]-B[3]/j]}let y=e.left*l,b=e.right*l,T,I,C,D;i==="width"||i==="both"?(D=s[0]+y-o[3],I=s[0]+b+o[1]):(D=s[0]+(y+b-h.displaySize[0])/2,I=D+h.displaySize[0]);let R=e.top*l,L=e.bottom*l;return i==="height"||i==="both"?(T=s[1]+R-o[0],C=s[1]+L+o[2]):(T=s[1]+(R+L-h.displaySize[1])/2,C=T+h.displaySize[1]),{imagePrimary:h,imageSecondary:void 0,top:T,right:I,bottom:C,left:D,collisionPadding:f}}class al extends nt{constructor(e,i,o,s,l){super(e,i),this.angle=s,this.z=o,l!==void 0&&(this.segment=l)}clone(){return new al(this.x,this.y,this.z,this.angle,this.segment)}}function Nw(t,e,i,o,s){if(e.segment===void 0)return!0;let l=e,h=e.segment+1,f=0;for(;f>-i/2;){if(h--,h<0)return!1;f-=t[h].dist(l),l=t[h]}f+=t[h].dist(t[h+1]),h++;let y=[],b=0;for(;f<i/2;){let T=t[h],I=t[h+1];if(!I)return!1;let C=t[h-1].angleTo(T)-T.angleTo(I);for(C=Math.abs((C+3*Math.PI)%(2*Math.PI)-Math.PI),y.push({distance:f,angleDelta:C}),b+=C;f-y[0].distance>o;)b-=y.shift().angleDelta;if(b>s)return!1;h++,f+=T.dist(I)}return!0}function jw(t){let e=0;for(let i=0;i<t.length-1;i++)e+=t[i].dist(t[i+1]);return e}function Vw(t,e,i){return t?.6*e*i:0}function Uw(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function kE(t,e,i,o,s,l){let h=Vw(i,s,l),f=Uw(i,o)*l,y=0,b=jw(t)/2;for(let T=0;T<t.length-1;T++){let I=t[T],C=t[T+1],D=I.dist(C);if(y+D>b){let R=(b-y)/D,L=fi(I.x,C.x,R),B=fi(I.y,C.y,R),j=new al(L,B,0,C.angleTo(I),T);return!h||Nw(t,j,f,h,e)?j:void 0}y+=D}}function IE(t,e,i,o,s,l,h,f,y){let b=Vw(o,l,h),T=Uw(o,s),I=T*h,C=t[0].x===0||t[0].x===y||t[0].y===0||t[0].y===y;return e-I<e/4&&(e=I+e/4),Gw(t,C?e/2*f%e:(T/2+2*l)*h*f%e,e,b,i,I,C,!1,y)}function Gw(t,e,i,o,s,l,h,f,y){let b=l/2,T=jw(t),I=0,C=e-i,D=[];for(let R=0;R<t.length-1;R++){let L=t[R],B=t[R+1],j=L.dist(B),Z=B.angleTo(L);for(;C+i<I+j;){C+=i;let K=(C-I)/j,Y=fi(L.x,B.x,K),ne=fi(L.y,B.y,K);if(Y>=0&&Y<y&&ne>=0&&ne<y&&C-b>=0&&C+b<=T){let te=new al(Y,ne,0,Z,R);o&&!Nw(t,te,l,o,s)||D.push(te)}}I+=j}return f||D.length||h||(D=Gw(t,I/2,i,o,s,l,h,!0,y)),D}function $w(t,e,i,o,s){let l=[];for(let h=0;h<t.length;h++){let f=t[h],y;for(let b=0;b<f.length-1;b++){let T=f[b],I=f[b+1];T.x<e&&I.x<e||(T.x<e?T=new nt(e,T.y+(e-T.x)/(I.x-T.x)*(I.y-T.y))._round():I.x<e&&(I=new nt(e,T.y+(e-T.x)/(I.x-T.x)*(I.y-T.y))._round()),T.y<i&&I.y<i||(T.y<i?T=new nt(T.x+(i-T.y)/(I.y-T.y)*(I.x-T.x),i)._round():I.y<i&&(I=new nt(T.x+(i-T.y)/(I.y-T.y)*(I.x-T.x),i)._round()),T.x>=o&&I.x>=o||(T.x>=o?T=new nt(o,T.y+(o-T.x)/(I.x-T.x)*(I.y-T.y))._round():I.x>=o&&(I=new nt(o,T.y+(o-T.x)/(I.x-T.x)*(I.y-T.y))._round()),T.y>=s&&I.y>=s||(T.y>=s?T=new nt(T.x+(s-T.y)/(I.y-T.y)*(I.x-T.x),s)._round():I.y>=s&&(I=new nt(T.x+(s-T.y)/(I.y-T.y)*(I.x-T.x),s)._round()),y&&T.equals(y[y.length-1])||(y=[T],l.push(y)),y.push(I)))))}}return l}function qw(t){let e=0,i=0;for(let h of t)e+=h.w*h.h,i=Math.max(i,h.w);t.sort((h,f)=>f.h-h.h);let o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}],s=0,l=0;for(let h of t)for(let f=o.length-1;f>=0;f--){let y=o[f];if(!(h.w>y.w||h.h>y.h)){if(h.x=y.x,h.y=y.y,l=Math.max(l,h.y+h.h),s=Math.max(s,h.x+h.w),h.w===y.w&&h.h===y.h){let b=o.pop();f<o.length&&(o[f]=b)}else h.h===y.h?(y.x+=h.w,y.w-=h.w):h.w===y.w?(y.y+=h.h,y.h-=h.h):(o.push({x:y.x+h.w,y:y.y,w:y.w-h.w,h:h.h}),y.y+=h.h,y.h-=h.h);break}}return{w:s,h:l,fill:e/(s*l)||0}}mt(al,"Anchor");let Ro=1;class Iy{constructor(e,{pixelRatio:i,version:o,stretchX:s,stretchY:l,content:h}){this.paddedRect=e,this.pixelRatio=i,this.stretchX=s,this.stretchY=l,this.content=h,this.version=o}get tl(){return[this.paddedRect.x+Ro,this.paddedRect.y+Ro]}get br(){return[this.paddedRect.x+this.paddedRect.w-Ro,this.paddedRect.y+this.paddedRect.h-Ro]}get displaySize(){return[(this.paddedRect.w-2*Ro)/this.pixelRatio,(this.paddedRect.h-2*Ro)/this.pixelRatio]}}class Hw{constructor(e,i){let o={},s={};this.haveRenderCallbacks=[];let l=[];this.addImages(e,o,l),this.addImages(i,s,l);let{w:h,h:f}=qw(l),y=new na({width:h||1,height:f||1});for(let b in e){let T=e[b],I=o[b].paddedRect;na.copy(T.data,y,{x:0,y:0},{x:I.x+Ro,y:I.y+Ro},T.data,T.sdf)}for(let b in i){let T=i[b],I=s[b].paddedRect,C=I.x+Ro,D=I.y+Ro,R=T.data.width,L=T.data.height;na.copy(T.data,y,{x:0,y:0},{x:C,y:D},T.data),na.copy(T.data,y,{x:0,y:L-1},{x:C,y:D-1},{width:R,height:1}),na.copy(T.data,y,{x:0,y:0},{x:C,y:D+L},{width:R,height:1}),na.copy(T.data,y,{x:R-1,y:0},{x:C-1,y:D},{width:1,height:L}),na.copy(T.data,y,{x:0,y:0},{x:C+R,y:D},{width:1,height:L})}this.image=y,this.iconPositions=o,this.patternPositions=s}addImages(e,i,o){for(let s in e){let l=e[s],h={x:0,y:0,w:l.data.width+2*Ro,h:l.data.height+2*Ro};o.push(h),i[s]=new Iy(h,l),l.hasRenderCallback&&this.haveRenderCallbacks.push(s)}}patchUpdatedImages(e,i,o){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(s=>e.hasImage(s,o)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,o);for(let s in e.getUpdatedImages(o))this.patchUpdatedImage(this.iconPositions[s],e.getImage(s,o),i),this.patchUpdatedImage(this.patternPositions[s],e.getImage(s,o),i)}patchUpdatedImage(e,i,o){if(!e||!i||e.version===i.version)return;e.version=i.version;let[s,l]=e.tl,h=!!Object.keys(this.patternPositions).length;o.update(i.data,{useMipmap:h},{x:s,y:l})}}mt(Iy,"ImagePosition"),mt(Hw,"ImageAtlas");let Hm=1e20;function Zw(t,e,i,o,s,l,h,f,y){for(let b=e;b<e+o;b++)Ww(t,i*l+b,l,s,h,f,y);for(let b=i;b<i+s;b++)Ww(t,b*l+e,1,o,h,f,y)}function Ww(t,e,i,o,s,l,h){l[0]=0,h[0]=-Hm,h[1]=Hm,s[0]=t[e];for(let f=1,y=0,b=0;f<o;f++){s[f]=t[e+f*i];let T=f*f;do{let I=l[y];b=(s[f]-s[I]+T-I*I)/(f-I)/2}while(b<=h[y]&&--y>-1);y++,l[y]=f,h[y]=b,h[y+1]=Hm}for(let f=0,y=0;f<o;f++){for(;h[y+1]<f;)y++;let b=l[y],T=f-b;t[e+f*i]=s[b]+T*T}}let ja=2,Sy={none:0,ideographs:1,all:2};class xh{constructor(e,i,o){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=o,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,i){this.urls[i]=e}getGlyphs(e,i,o){let s=[],l=this.urls[i]||q.GLYPHS_URL;for(let h in e)for(let f of e[h])s.push({stack:h,id:f});Zo(s,({stack:h,id:f},y)=>{let b=this.entries[h];b||(b=this.entries[h]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let T=b.glyphs[f];if(T!==void 0)return void y(null,{stack:h,id:f,glyph:T});if(T=this._tinySDF(b,h,f),T)return b.glyphs[f]=T,void y(null,{stack:h,id:f,glyph:T});let I=Math.floor(f/256);if(256*I>65535)return void y(new Error("glyphs > 65535 not supported"));if(b.ranges[I])return void y(null,{stack:h,id:f,glyph:T});let C=b.requests[I];C||(C=b.requests[I]=[],xh.loadGlyphRange(h,I,l,this.requestManager,(D,R)=>{if(R){b.ascender=R.ascender,b.descender=R.descender;for(let L in R.glyphs)this._doesCharSupportLocalGlyph(+L)||(b.glyphs[+L]=R.glyphs[+L]);b.ranges[I]=!0}for(let L of C)L(D,R);delete b.requests[I]})),C.push((D,R)=>{D?y(D):R&&y(null,{stack:h,id:f,glyph:R.glyphs[f]||null})})},(h,f)=>{if(h)o(h);else if(f){let y={};for(let{stack:b,id:T,glyph:I}of f)y[b]===void 0&&(y[b]={}),y[b].glyphs===void 0&&(y[b].glyphs={}),y[b].glyphs[T]=I&&{id:I.id,bitmap:I.bitmap.clone(),metrics:I.metrics},y[b].ascender=this.entries[b].ascender,y[b].descender=this.entries[b].descender;o(null,y)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Sy.none&&(this.localGlyphMode===Sy.all?!!this.localFontFamily:!!this.localFontFamily&&(yt["CJK Unified Ideographs"](e)||yt["Hangul Syllables"](e)||yt.Hiragana(e)||yt.Katakana(e)||yt["CJK Symbols and Punctuation"](e)||yt["CJK Unified Ideographs Extension A"](e)||yt["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,i,o){let s=this.localFontFamily;if(!s||!this._doesCharSupportLocalGlyph(o))return;let l=e.tinySDF;if(!l){let L="400";/bold/i.test(i)?L="900":/medium/i.test(i)?L="500":/light/i.test(i)&&(L="200"),l=e.tinySDF=new xh.TinySDF({fontFamily:s,fontWeight:L,fontSize:24*ja,buffer:3*ja,radius:8*ja}),l.fontWeight=L}if(this.localGlyphs[l.fontWeight][o])return this.localGlyphs[l.fontWeight][o];let h=String.fromCodePoint(o),{data:f,width:y,height:b,glyphWidth:T,glyphHeight:I,glyphLeft:C,glyphTop:D,glyphAdvance:R}=l.draw(h);return this.localGlyphs[l.fontWeight][o]={id:o,bitmap:new ql({width:y,height:b},f),metrics:{width:T/ja,height:I/ja,left:C/ja,top:D/ja-27,advance:R/ja,localGlyph:!0}}}}xh.loadGlyphRange=function(t,e,i,o,s){let l=256*e,h=l+255,f=o.transformRequest(o.normalizeGlyphsURL(i).replace("{fontstack}",t).replace("{range}",`${l}-${h}`),to.Glyphs);Ae(f,(y,b)=>{if(y)s(y);else if(b){let T={},I=function(C){return new bh(C).readFields(yE,{})}(b);for(let C of I.glyphs)T[C.id]=C;s(null,{glyphs:T,ascender:I.ascender,descender:I.descender})}})},xh.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:i=8,cutoff:o=.25,fontFamily:s="sans-serif",fontWeight:l="normal",fontStyle:h="normal"}={}){this.buffer=e,this.cutoff=o,this.radius=i;let f=this.size=t+4*e,y=this._createCanvas(f),b=this.ctx=y.getContext("2d",{willReadFrequently:!0});b.font=`${h} ${l} ${t}px ${s}`,b.textBaseline="alphabetic",b.textAlign="left",b.fillStyle="black",this.gridOuter=new Float64Array(f*f),this.gridInner=new Float64Array(f*f),this.f=new Float64Array(f),this.z=new Float64Array(f+1),this.v=new Uint16Array(f)}_createCanvas(t){let e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){let{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:o,actualBoundingBoxLeft:s,actualBoundingBoxRight:l}=this.ctx.measureText(t),h=Math.ceil(i),f=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(l-s))),y=Math.min(this.size-this.buffer,h+Math.ceil(o)),b=f+2*this.buffer,T=y+2*this.buffer,I=Math.max(b*T,0),C=new Uint8ClampedArray(I),D={data:C,width:b,height:T,glyphWidth:f,glyphHeight:y,glyphTop:h,glyphLeft:0,glyphAdvance:e};if(f===0||y===0)return D;let{ctx:R,buffer:L,gridInner:B,gridOuter:j}=this;R.clearRect(L,L,f,y),R.fillText(t,L,L+h);let Z=R.getImageData(L,L,f,y);j.fill(Hm,0,I),B.fill(0,0,I);for(let K=0;K<y;K++)for(let Y=0;Y<f;Y++){let ne=Z.data[4*(K*f+Y)+3]/255;if(ne===0)continue;let te=(K+L)*b+Y+L;if(ne===1)j[te]=0,B[te]=Hm;else{let se=.5-ne;j[te]=se>0?se*se:0,B[te]=se<0?se*se:0}}Zw(j,0,0,b,T,b,this.f,this.v,this.z),Zw(B,L,L,f,y,b,this.f,this.v,this.z);for(let K=0;K<I;K++){let Y=Math.sqrt(j[K])-Math.sqrt(B[K]);C[K]=Math.round(255-255*(Y/this.radius+this.cutoff))}return D}};let Wl=Ro;function Xw(t,e,i,o){let s=[],l=t.imagePrimary,h=l.pixelRatio,f=l.paddedRect.w-2*Wl,y=l.paddedRect.h-2*Wl,b=t.right-t.left,T=t.bottom-t.top,I=l.stretchX||[[0,f]],C=l.stretchY||[[0,y]],D=(_e,Se)=>_e+Se[1]-Se[0],R=I.reduce(D,0),L=C.reduce(D,0),B=f-R,j=y-L,Z=0,K=R,Y=0,ne=L,te=0,se=B,he=0,fe=j;if(l.content&&o){let _e=l.content;Z=A_(I,0,_e[0]),Y=A_(C,0,_e[1]),K=A_(I,_e[0],_e[2]),ne=A_(C,_e[1],_e[3]),te=_e[0]-Z,he=_e[1]-Y,se=_e[2]-_e[0]-K,fe=_e[3]-_e[1]-ne}let ve=(_e,Se,ze,ke)=>{let Re=D_(_e.stretch-Z,K,b,t.left),we=P_(_e.fixed-te,se,_e.stretch,R),Pe=D_(Se.stretch-Y,ne,T,t.top),et=P_(Se.fixed-he,fe,Se.stretch,L),Fe=D_(ze.stretch-Z,K,b,t.left),ft=P_(ze.fixed-te,se,ze.stretch,R),dt=D_(ke.stretch-Y,ne,T,t.top),je=P_(ke.fixed-he,fe,ke.stretch,L),zt=new nt(Re,Pe),wt=new nt(Fe,Pe),pt=new nt(Fe,dt),Ve=new nt(Re,dt),Pt=new nt(we/h,et/h),Qt=new nt(ft/h,je/h),Ot=e*Math.PI/180;if(Ot){let Ci=Math.sin(Ot),Ei=Math.cos(Ot),Oi=[Ei,-Ci,Ci,Ei];zt._matMult(Oi),wt._matMult(Oi),Ve._matMult(Oi),pt._matMult(Oi)}let Jt=_e.stretch+_e.fixed,Vt=ze.stretch+ze.fixed,_i=Se.stretch+Se.fixed,Ht=ke.stretch+ke.fixed,en=t.imageSecondary;return{tl:zt,tr:wt,bl:Ve,br:pt,texPrimary:{x:l.paddedRect.x+Wl+Jt,y:l.paddedRect.y+Wl+_i,w:Vt-Jt,h:Ht-_i},texSecondary:en?{x:en.paddedRect.x+Wl+Jt,y:en.paddedRect.y+Wl+_i,w:Vt-Jt,h:Ht-_i}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Pt,pixelOffsetBR:Qt,minFontScaleX:se/h/b,minFontScaleY:fe/h/T,isSDF:i}};if(o&&(l.stretchX||l.stretchY)){let _e=Yw(I,B,R),Se=Yw(C,j,L);for(let ze=0;ze<_e.length-1;ze++){let ke=_e[ze],Re=_e[ze+1];for(let we=0;we<Se.length-1;we++)s.push(ve(ke,Se[we],Re,Se[we+1]))}}else s.push(ve({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:f+1},{fixed:0,stretch:y+1}));return s}function A_(t,e,i){let o=0;for(let s of t)o+=Math.max(e,Math.min(i,s[1]))-Math.max(e,Math.min(i,s[0]));return o}function Yw(t,e,i){let o=[{fixed:-Wl,stretch:0}];for(let[s,l]of t){let h=o[o.length-1];o.push({fixed:s-h.stretch,stretch:h.stretch}),o.push({fixed:s-h.stretch,stretch:h.stretch+(l-s)})}return o.push({fixed:e+Wl,stretch:i}),o}function D_(t,e,i,o){return t/e*i+o}function P_(t,e,i,o){return t-e*i/o}function SE(t,e,i,o){let s=e+t.positionedLines[o].lineOffset;return o===0?i+s/2:i+(s+(e+t.positionedLines[o-1].lineOffset))/2}function CE(t,e=1,i=!1){let o=1/0,s=1/0,l=-1/0,h=-1/0,f=t[0];for(let D=0;D<f.length;D++){let R=f[D];(!D||R.x<o)&&(o=R.x),(!D||R.y<s)&&(s=R.y),(!D||R.x>l)&&(l=R.x),(!D||R.y>h)&&(h=R.y)}let y=Math.min(l-o,h-s),b=y/2,T=new Po([],ME);if(y===0)return new nt(o,s);for(let D=o;D<l;D+=y)for(let R=s;R<h;R+=y)T.push(new wh(D+b,R+b,b,t));let I=function(D){let R=0,L=0,B=0,j=D[0];for(let Z=0,K=j.length,Y=K-1;Z<K;Y=Z++){let ne=j[Z],te=j[Y],se=ne.x*te.y-te.x*ne.y;L+=(ne.x+te.x)*se,B+=(ne.y+te.y)*se,R+=3*se}return new wh(L/R,B/R,0,D)}(t),C=T.length;for(;T.length;){let D=T.pop();(D.d>I.d||!I.d)&&(I=D,i&&console.log("found best %d after %d probes",Math.round(1e4*D.d)/1e4,C)),D.max-I.d<=e||(b=D.h/2,T.push(new wh(D.p.x-b,D.p.y-b,b,t)),T.push(new wh(D.p.x+b,D.p.y-b,b,t)),T.push(new wh(D.p.x-b,D.p.y+b,b,t)),T.push(new wh(D.p.x+b,D.p.y+b,b,t)),C+=4)}return i&&(console.log(`num probes: ${C}`),console.log(`best distance: ${I.d}`)),I.p}function ME(t,e){return e.max-t.max}class wh{constructor(e,i,o,s){this.p=new nt(e,i),this.h=o,this.d=function(l,h){let f=!1,y=1/0;for(let b=0;b<h.length;b++){let T=h[b];for(let I=0,C=T.length,D=C-1;I<C;D=I++){let R=T[I],L=T[D];R.y>l.y!=L.y>l.y&&l.x<(L.x-R.x)*(l.y-R.y)/(L.y-R.y)+R.x&&(f=!f),y=Math.min(y,Ul(l,R,L))}}return(f?1:-1)*Math.sqrt(y)}(this.p,s),this.max=this.d+this.h*Math.SQRT2}}let Cy=Number.POSITIVE_INFINITY,EE=Math.sqrt(2);function Kw(t,[e,i]){let o=0,s=0;if(i===Cy){e<0&&(e=0);let l=e/EE;switch(t){case"top-right":case"top-left":s=l-7;break;case"bottom-right":case"bottom-left":s=7-l;break;case"bottom":s=7-e;break;case"top":s=e-7}switch(t){case"top-right":case"bottom-right":o=-l;break;case"top-left":case"bottom-left":o=l;break;case"left":o=e;break;case"right":o=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),t){case"top-right":case"top-left":case"top":s=i-7;break;case"bottom-right":case"bottom-left":case"bottom":s=7-i}switch(t){case"top-right":case"bottom-right":case"right":o=-e;break;case"top-left":case"bottom-left":case"left":o=e}}return[o,s]}function My(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function AE(t,e,i,o,s,l,h,f,y,b,T,I,C,D,R){let L=l.textMaxSize.evaluate(e,{},I);L===void 0&&(L=h);let B=t.layers[0].layout,j=B.get("icon-offset").evaluate(e,{},I),Z=Jw(i.horizontal)||i.vertical,K=C.name==="globe",Y=Dr,ne=h/Y,te=t.tilePixelRatio*L/Y,se=(Re=t.overscaling,t.zoom>18&&Re>2&&(Re>>=1),Math.max(st/(512*Re),1)*B.get("symbol-spacing")),he=B.get("text-padding")*t.tilePixelRatio,fe=B.get("icon-padding")*t.tilePixelRatio,ve=vi(B.get("text-max-angle")),_e=B.get("text-rotation-alignment")==="map"&&B.get("symbol-placement")!=="point",Se=B.get("icon-rotation-alignment")==="map"&&B.get("symbol-placement")!=="point",ze=B.get("symbol-placement"),ke=se/2;var Re;let we=B.get("icon-text-fit").evaluate(e,{},I),Pe=B.get("icon-text-fit-padding").evaluate(e,{},I),et=we!=="none",Fe;t.hasAnyIconTextFit===!1&&et&&(t.hasAnyIconTextFit=!0),o&&et&&(t.allowVerticalPlacement&&i.vertical&&(Fe=Bw(o,i.vertical,we,Pe,j,ne)),Z&&(o=Bw(o,Z,we,Pe,j,ne)));let ft=(dt,je,zt)=>{if(je.x<0||je.x>=st||je.y<0||je.y>=st)return;let wt=null;if(K){let{x:pt,y:Ve,z:Pt}=C.projectTilePoint(je.x,je.y,zt);wt={anchor:new al(pt,Ve,Pt,0,void 0),up:C.upVector(zt,je.x,je.y)}}(function(pt,Ve,Pt,Qt,Ot,Jt,Vt,_i,Ht,en,Ci,Ei,Oi,Mi,pn,$i,Ln,ar,Cr,cn,wn,gr,yr,br,on,Lo,ec){let co=pt.addToLineVertexArray(Ve,Qt),Kr,aa,lp,J_,JT,e2,t2,i2=0,n2=0,r2=0,o2=0,Jy=-1,eb=-1,xs={},a2=Pm(""),pd=Pt?Pt.anchor:Ve,tb=Ht.layout.get("icon-text-fit").evaluate(wn,{},on)!=="none",ib=0,nb=0;if(Ht._unevaluatedLayout.getValue("text-radial-offset")===void 0?[ib,nb]=Ht.layout.get("text-offset").evaluate(wn,{},on).map(zo=>zo*Dr):(ib=Ht.layout.get("text-radial-offset").evaluate(wn,{},on)*Dr,nb=Cy),pt.allowVerticalPlacement&&Ot.vertical){let zo=Ot.vertical;if(pn)e2=Ey(zo),_i&&(t2=Ey(_i));else{let Oo=Ht.layout.get("text-rotate").evaluate(wn,{},on)+90;lp=R_(en,pd,Ve,Ci,Ei,Oi,zo,Mi,Oo,$i),_i&&(J_=R_(en,pd,Ve,Ci,Ei,Oi,_i,ar,Oo))}}if(Jt){let zo=Ht.layout.get("icon-rotate").evaluate(wn,{},on),Oo=Xw(Jt,zo,yr,tb),Eh=_i?Xw(_i,zo,yr,tb):void 0;aa=R_(en,pd,Ve,Ci,Ei,Oi,Jt,ar,zo),i2=4*Oo.length;let s2=pt.iconSizeData,fd=null;s2.kind==="source"?(fd=[Na*Ht.layout.get("icon-size").evaluate(wn,{},on)],fd[0]>Xl&&Pn(`${pt.layerIds[0]}: Value for "icon-size" is >= ${Zm}. Reduce your "icon-size".`)):s2.kind==="composite"&&(fd=[Na*gr.compositeIconSizes[0].evaluate(wn,{},on),Na*gr.compositeIconSizes[1].evaluate(wn,{},on)],(fd[0]>Xl||fd[1]>Xl)&&Pn(`${pt.layerIds[0]}: Value for "icon-size" is >= ${Zm}. Reduce your "icon-size".`)),pt.addSymbols(pt.icon,Oo,fd,cn,Cr,wn,!1,Pt,Ve,co.lineStartIndex,co.lineLength,-1,br,on,Lo,ec),Jy=pt.icon.placedSymbolArray.length-1,Eh&&(n2=4*Eh.length,pt.addSymbols(pt.icon,Eh,fd,cn,Cr,wn,ra.vertical,Pt,Ve,co.lineStartIndex,co.lineLength,-1,br,on,Lo,ec),eb=pt.icon.placedSymbolArray.length-1)}for(let zo in Ot.horizontal){let Oo=Ot.horizontal[zo];Kr||(a2=Pm(Oo.text),pn?JT=Ey(Oo):Kr=R_(en,pd,Ve,Ci,Ei,Oi,Oo,Mi,Ht.layout.get("text-rotate").evaluate(wn,{},on),$i));let Eh=Oo.positionedLines.length===1;if(r2+=Qw(pt,Pt,Ve,Oo,Vt,Ht,pn,wn,$i,co,Ot.vertical?ra.horizontal:ra.horizontalOnly,Eh?Object.keys(Ot.horizontal):[zo],xs,Jy,gr,br,on,Lo),Eh)break}Ot.vertical&&(o2+=Qw(pt,Pt,Ve,Ot.vertical,Vt,Ht,pn,wn,$i,co,ra.vertical,["vertical"],xs,eb,gr,br,on,Lo));let tc=-1,rb=(zo,Oo)=>zo?Math.max(zo,Oo):Oo;tc=rb(JT,tc),tc=rb(e2,tc),tc=rb(t2,tc);let WA=tc>-1?1:0;pt.glyphOffsetArray.length>=65535&&Pn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),wn.sortKey!==void 0&&pt.addToSortKeyRanges(pt.symbolInstances.length,wn.sortKey),pt.symbolInstances.emplaceBack(Ve.x,Ve.y,pd.x,pd.y,pd.z,xs.right>=0?xs.right:-1,xs.center>=0?xs.center:-1,xs.left>=0?xs.left:-1,xs.vertical>=0?xs.vertical:-1,Jy,eb,a2,Kr!==void 0?Kr:pt.collisionBoxArray.length,Kr!==void 0?Kr+1:pt.collisionBoxArray.length,lp!==void 0?lp:pt.collisionBoxArray.length,lp!==void 0?lp+1:pt.collisionBoxArray.length,aa!==void 0?aa:pt.collisionBoxArray.length,aa!==void 0?aa+1:pt.collisionBoxArray.length,J_||pt.collisionBoxArray.length,J_?J_+1:pt.collisionBoxArray.length,Ci,r2,o2,i2,n2,WA,0,ib,nb,tc,0,tb?1:0)})(t,je,wt,dt,i,o,s,Fe,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,he,_e,y,0,fe,Se,j,e,l,b,T,I,D,R)};if(ze==="line")for(let dt of $w(e.geometry,0,0,st,st)){let je=IE(dt,se,ve,i.vertical||Z,o,Y,te,t.overscaling,st);for(let zt of je)Z&&DE(t,Z.text,ke,zt)||ft(dt,zt,I)}else if(ze==="line-center"){for(let dt of e.geometry)if(dt.length>1){let je=kE(dt,ve,i.vertical||Z,o,Y,te);je&&ft(dt,je,I)}}else if(e.type==="Polygon")for(let dt of my(e.geometry,0)){let je=CE(dt,16);ft(dt[0],new al(je.x,je.y,0,0,void 0),I)}else if(e.type==="LineString")for(let dt of e.geometry)ft(dt,new al(dt[0].x,dt[0].y,0,0,void 0),I);else if(e.type==="Point")for(let dt of e.geometry)for(let je of dt)ft([je],new al(je.x,je.y,0,0,void 0),I)}let Zm=255,Xl=Zm*Na;function Qw(t,e,i,o,s,l,h,f,y,b,T,I,C,D,R,L,B,j){let Z=function(ne,te,se,he,fe,ve,_e,Se){let ze=[];if(te.positionedLines.length===0)return ze;let ke=he.layout.get("text-rotate").evaluate(ve,{})*Math.PI/180,Re=function(ft){let dt=ft[0],je=ft[1],zt=dt*je;return zt>0?[dt,-je]:zt<0?[-dt,je]:dt===0?[je,dt]:[je,-dt]}(se),we=Math.abs(te.top-te.bottom);for(let ft of te.positionedLines)we-=ft.lineOffset;let Pe=te.positionedLines.length,et=we/Pe,Fe=te.top-se[1];for(let ft=0;ft<Pe;++ft){let dt=te.positionedLines[ft];Fe=SE(te,et,Fe,ft);for(let je of dt.positionedGlyphs){if(!je.rect)continue;let zt=je.rect||{},wt=Pw+1,pt=!0,Ve=1,Pt=0;if(je.imageName){let cn=_e[je.imageName];if(!cn)continue;if(cn.sdf){Pn("SDF images are not supported in formatted text and will be ignored.");continue}pt=!1,Ve=cn.pixelRatio,wt=Ro/Ve}let Qt=(fe||Se)&&je.vertical,Ot=je.metrics.advance*je.scale/2,Jt=je.metrics,Vt=je.rect;if(Vt===null)continue;Se&&te.verticalizable&&(Pt=je.imageName?Ot-je.metrics.width*je.scale/2:0);let _i=fe?[je.x+Ot,je.y]:[0,0],Ht=[0,0],en=[0,0],Ci=!1;fe||(Qt?(en=[je.x+Ot+Re[0],je.y+Re[1]-Pt],Ci=!0):Ht=[je.x+Ot+se[0],je.y+se[1]-Pt]);let Ei=Vt.w*je.scale/(Ve*(je.localGlyph?ja:1)),Oi=Vt.h*je.scale/(Ve*(je.localGlyph?ja:1)),Mi,pn,$i,Ln;if(Qt){let cn=je.y-Fe,wn=new nt(-Ot,Ot-cn),gr=-Math.PI/2,yr=new nt(...en);Mi=new nt(-Ot+Ht[0],Ht[1]),Mi._rotateAround(gr,wn)._add(yr),Mi.x+=-cn+Ot,Mi.y-=(Jt.left-wt)*je.scale;let br=je.imageName?Jt.advance*je.scale:Dr*je.scale,on=String.fromCodePoint(je.glyph);aE(on)?Mi.x+=(1-wt)*je.scale:sE(on)?Mi.x+=br-Jt.height*je.scale+(-wt-1)*je.scale:Mi.x+=je.imageName||Jt.width+2*wt===Vt.w&&Jt.height+2*wt===Vt.h?(br-Oi)/2:(br-(Jt.height+2*wt)*je.scale)/2,pn=new nt(Mi.x,Mi.y-Ei),$i=new nt(Mi.x+Oi,Mi.y),Ln=new nt(Mi.x+Oi,Mi.y-Ei)}else{let cn=(Jt.left-wt)*je.scale-Ot+Ht[0],wn=(-Jt.top-wt)*je.scale+Ht[1],gr=cn+Ei,yr=wn+Oi;Mi=new nt(cn,wn),pn=new nt(gr,wn),$i=new nt(cn,yr),Ln=new nt(gr,yr)}if(ke){let cn;cn=fe?new nt(0,0):Ci?new nt(Re[0],Re[1]):new nt(se[0],se[1]),Mi._rotateAround(ke,cn),pn._rotateAround(ke,cn),$i._rotateAround(ke,cn),Ln._rotateAround(ke,cn)}let ar=new nt(0,0),Cr=new nt(0,0);ze.push({tl:Mi,tr:pn,bl:$i,br:Ln,texPrimary:zt,texSecondary:void 0,writingMode:te.writingMode,glyphOffset:_i,sectionIndex:je.sectionIndex,isSDF:pt,pixelOffsetTL:ar,pixelOffsetBR:Cr,minFontScaleX:0,minFontScaleY:0})}}return ze}(0,o,y,l,h,f,s,t.allowVerticalPlacement),K=t.textSizeData,Y=null;K.kind==="source"?(Y=[Na*l.layout.get("text-size").evaluate(f,{},B)],Y[0]>Xl&&Pn(`${t.layerIds[0]}: Value for "text-size" is >= ${Zm}. Reduce your "text-size".`)):K.kind==="composite"&&(Y=[Na*R.compositeTextSizes[0].evaluate(f,{},B),Na*R.compositeTextSizes[1].evaluate(f,{},B)],(Y[0]>Xl||Y[1]>Xl)&&Pn(`${t.layerIds[0]}: Value for "text-size" is >= ${Zm}. Reduce your "text-size".`)),t.addSymbols(t.text,Z,Y,y,h,f,T,e,i,b.lineStartIndex,b.lineLength,D,L,B,j,!1);for(let ne of I)C[ne]=t.text.placedSymbolArray.length-1;return 4*Z.length}function Jw(t){for(let e in t)return t[e];return null}function R_(t,e,i,o,s,l,h,f,y,b){let T=h.top,I=h.bottom,C=h.left,D=h.right,R=h.collisionPadding;if(R&&(C-=R[0],T-=R[1],D+=R[2],I+=R[3]),y){let L=new nt(C,T),B=new nt(D,T),j=new nt(C,I),Z=new nt(D,I),K=vi(y),Y=new nt(0,0);b&&(Y=new nt(b[0],b[1])),L._rotateAround(K,Y),B._rotateAround(K,Y),j._rotateAround(K,Y),Z._rotateAround(K,Y),C=Math.min(L.x,B.x,j.x,Z.x),D=Math.max(L.x,B.x,j.x,Z.x),T=Math.min(L.y,B.y,j.y,Z.y),I=Math.max(L.y,B.y,j.y,Z.y)}return t.emplaceBack(e.x,e.y,e.z,i.x,i.y,C,T,D,I,f,o,s,l),t.length-1}function Ey(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);let e=t.bottom-t.top;return e>0?Math.max(10,e):null}function DE(t,e,i,o){let s=t.compareText;if(e in s){let l=s[e];for(let h=l.length-1;h>=0;h--)if(o.dist(l[h])<i)return!0}else s[e]=[];return s[e].push(o),!1}function eT(t,e){let i=t.fovAboveCenter,o=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,s=(t._camera.position[2]*t.worldSize-o)/Math.cos(t._pitch),l=Math.sin(i)*s/Math.sin(Math.max(Math.PI/2-t._pitch-i,.01)),h=Math.sin(t._pitch)*l+s;return Math.min(1.01*h,s*(1/t._horizonShift))}function Wm(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};let i=Math.pow(2,-t.z),o=t.x*i,s=(t.x+1)*i,l=t.y*i,h=(t.y+1)*i,f=Gt(o),y=Gt(s),b=yi(l),T=yi(h),I=e.project(f,b),C=e.project(y,b),D=e.project(y,T),R=e.project(f,T),L=Math.min(I.x,C.x,D.x,R.x),B=Math.min(I.y,C.y,D.y,R.y),j=Math.max(I.x,C.x,D.x,R.x),Z=Math.max(I.y,C.y,D.y,R.y),K=i/16;function Y(te,se,he,fe,ve,_e){let Se=(he+ve)/2,ze=(fe+_e)/2,ke=e.project(Gt(Se),yi(ze)),Re=Math.max(0,L-ke.x,B-ke.y,ke.x-j,ke.y-Z);L=Math.min(L,ke.x),j=Math.max(j,ke.x),B=Math.min(B,ke.y),Z=Math.max(Z,ke.y),Re>K&&(Y(te,ke,he,fe,Se,ze),Y(ke,se,Se,ze,ve,_e))}Y(I,C,o,l,s,l),Y(C,D,s,l,s,h),Y(D,R,s,h,o,h),Y(R,I,o,h,o,l),L-=K,B-=K,j+=K,Z+=K;let ne=1/Math.max(j-L,Z-B);return{scale:ne,x:L*ne,y:B*ne,x2:j*ne,y2:Z*ne,projection:e}}function tT(t,{x:e,y:i},o=0){return new nt(((e-o)*t.scale-t.x)*st,(i*t.scale-t.y)*st)}let PE=r.a6.identity(new Float32Array(16));class Yl{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new pe(0,0)}projectTilePoint(e,i,o){return{x:e,y:i,z:0}}locationPoint(e,i,o=!0){return e._coordinatePoint(e.locationCoordinate(i),o)}pixelsPerMeter(e,i){return qt(1,e)*i}pixelSpaceConversion(e,i,o){return 1}farthestPixelDistance(e){return eT(e,e.pixelsPerMeter)}pointCoordinate(e,i,o,s){let l=e.horizonLineFromTop(!1),h=new nt(i,Math.max(l,o));return e.rayIntersectionCoordinate(e.pointRayIntersection(h,s))}pointCoordinate3D(e,i,o){let s=new nt(i,o);if(e.elevation)return e.elevation.pointCoordinate(s);{let l=this.pointCoordinate(e,s.x,s.y,0);return[l.x,l.y,l.z]}}isPointAboveHorizon(e,i){if(e.elevation)return!this.pointCoordinate3D(e,i.x,i.y);let o=e.horizonLineFromTop();return i.y<o}createInversionMatrix(e,i){return PE}createTileMatrix(e,i,o){let s,l,h,f=o.canonical,y=r.a6.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){let b=Wm(f,this);s=1,l=b.x+o.wrap*b.scale,h=b.y,r.a6.scale(y,y,[s/b.scale,s/b.scale,e.pixelsPerMeter/i])}else s=i/e.zoomScale(f.z),l=(f.x+Math.pow(2,f.z)*o.wrap)*s,h=f.y*s;return r.a6.translate(y,y,[l,h,0]),r.a6.scale(y,y,[s/st,s/st,1]),y}upVector(e,i,o){return[0,0,1]}upVectorScale(e,i,o){return{metersToTile:1}}}class RE extends Yl{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];let[i,o]=this.parallels=e.parallels||[29.5,45.5],s=Math.sin(vi(i));this.n=(s+Math.sin(vi(o)))/2,this.c=1+s*(2*this.n-s),this.r0=Math.sqrt(this.c)/this.n}project(e,i){let{n:o,c:s,r0:l}=this,h=vi(e-this.center[0]),f=vi(i),y=Math.sqrt(s-2*o*Math.sin(f))/o;return{x:y*Math.sin(h*o),y:y*Math.cos(h*o)-l,z:0}}unproject(e,i){let{n:o,c:s,r0:l}=this,h=l+i,f=Math.atan2(e,Math.abs(h))*Math.sign(h);h*o<0&&(f-=Math.PI*Math.sign(e)*Math.sign(h));let y=vi(this.center[0])*o;f=Ya(f,-Math.PI-y,Math.PI-y);let b=ii(Mr(f/o)+this.center[0],-180,180),T=Math.asin(ii((s-(e*e+h*h)*o*o)/(2*o),-1,1)),I=ii(Mr(T),-ai,ai);return new pe(b,I)}}let Xm=1.340264,Ym=-.081106,Km=893e-6,Qm=.003796,L_=Math.sqrt(3)/2;class LE extends Yl{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;let o=Math.asin(L_*Math.sin(i)),s=o*o,l=s*s*s;return{x:.5*(e*Math.cos(o)/(L_*(Xm+3*Ym*s+l*(7*Km+9*Qm*s)))/Math.PI+.5),y:1-.5*(o*(Xm+Ym*s+l*(Km+Qm*s))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let o=i=(2*(1-i)-1)*Math.PI,s=o*o,l=s*s*s;for(let T,I,C,D=0;D<12&&(I=o*(Xm+Ym*s+l*(Km+Qm*s))-i,C=Xm+3*Ym*s+l*(7*Km+9*Qm*s),T=I/C,o=ii(o-T,-Math.PI/3,Math.PI/3),s=o*o,l=s*s*s,!(Math.abs(T)<1e-12));++D);let h=L_*e*(Xm+3*Ym*s+l*(7*Km+9*Qm*s))/Math.cos(o),f=Math.asin(Math.sin(o)/L_),y=ii(180*h/Math.PI,-180,180),b=ii(180*f/Math.PI,-ai,ai);return new pe(y,b)}}class zE extends Yl{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){let o=360*(e-.5),s=ii(360*(.5-i),-ai,ai);return new pe(o,s)}}let Th=Math.PI/2;function z_(t){return Math.tan((Th+t)/2)}class OE extends Yl{constructor(e){super(e),this.center=e.center||[0,30];let[i,o]=this.parallels=e.parallels||[30,30],s=vi(i),l=vi(o);this.southernCenter=s+l<0,this.southernCenter&&(s=-s,l=-l);let h=Math.cos(s),f=z_(s);this.n=s===l?Math.sin(s):Math.log(h/Math.cos(l))/Math.log(z_(l)/f),this.f=h*Math.pow(z_(s),this.n)/this.n}project(e,i){i=vi(i),this.southernCenter&&(i=-i),e=vi(e-this.center[0]);let o=1e-6,{n:s,f:l}=this;l>0?i<-Th+o&&(i=-Th+o):i>Th-o&&(i=Th-o);let h=l/Math.pow(z_(i),s),f=h*Math.sin(s*e),y=l-h*Math.cos(s*e);return f=.5*(f/Math.PI+.5),y=.5*(y/Math.PI+.5),{x:f,y:this.southernCenter?y:1-y,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;let{n:o,f:s}=this,l=s-i,h=Math.sign(l),f=Math.sign(o)*Math.sqrt(e*e+l*l),y=Math.atan2(e,Math.abs(l))*h;l*o<0&&(y-=Math.PI*Math.sign(e)*h);let b=ii(Mr(y/o)+this.center[0],-180,180),T=ii(Mr(2*Math.atan(Math.pow(s/f,1/o))-Th),-ai,ai);return new pe(b,this.southernCenter?-T:T)}}class iT extends Yl{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:Xt(e),y:Nt(i),z:0}}unproject(e,i){let o=Gt(e),s=yi(i);return new pe(o,s)}}let nT=vi(ai);class FE extends Yl{project(e,i){let o=(i=vi(i))*i,s=o*o;return{x:.5*((e=vi(e))*(.8707-.131979*o+s*(s*(.003971*o-.001529*s)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+o*(.015085+s*(.028874*o-.044475-.005916*s)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let o=i=(2*(1-i)-1)*Math.PI,s=25,l=0,h=o*o;do{h=o*o;let b=h*h;l=(o*(1.007226+h*(.015085+b*(.028874*h-.044475-.005916*b)))-i)/(1.007226+h*(.045255+b*(.259866*h-.311325-.005916*11*b))),o=ii(o-l,-nT,nT)}while(Math.abs(l)>1e-6&&--s>0);h=o*o;let f=ii(Mr(e/(.8707+h*(h*(h*h*h*(.003971-.001529*h)-.013791)-.131979))),-180,180),y=Mr(o);return new pe(f,y)}}let rT=vi(ai);class BE extends Yl{project(e,i){i=vi(i),e=vi(e);let o=Math.cos(i),s=2/Math.PI,l=Math.acos(o*Math.cos(e/2)),h=Math.sin(l)/l,f=.5*(e*s+2*o*Math.sin(e/2)/h)||0,y=.5*(i+Math.sin(i)/h)||0;return{x:.5*(f/Math.PI+.5),y:1-.5*(y/Math.PI+1),z:0}}unproject(e,i){let o=e=(2*e-.5)*Math.PI,s=i=(2*(1-i)-1)*Math.PI,l=25,h=1e-6,f=0,y=0;do{let b=Math.cos(s),T=Math.sin(s),I=2*T*b,C=T*T,D=b*b,R=Math.cos(o/2),L=Math.sin(o/2),B=2*R*L,j=L*L,Z=1-D*R*R,K=Z?1/Z:0,Y=Z?Math.acos(b*R)*Math.sqrt(1/Z):0,ne=.5*(2*Y*b*L+2*o/Math.PI)-e,te=.5*(Y*T+s)-i,se=.5*K*(D*j+Y*b*R*C)+1/Math.PI,he=K*(B*I/4-Y*T*L),fe=.125*K*(I*L-Y*T*D*B),ve=.5*K*(C*R+Y*j*b)+.5,_e=he*fe-ve*se;f=(te*he-ne*ve)/_e,y=(ne*fe-te*se)/_e,o=ii(o-f,-Math.PI,Math.PI),s=ii(s-y,-rT,rT)}while((Math.abs(f)>h||Math.abs(y)>h)&&--l>0);return new pe(Mr(o),Mr(s))}}class oT extends Yl{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(vi(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){let{scale:o,cosPhi:s}=this;return{x:vi(e)*s*o+.5,y:-Math.sin(vi(i))/s*o+.5,z:0}}unproject(e,i){let{scale:o,cosPhi:s}=this,l=-(i-.5)/o,h=ii(Mr((e-.5)/o)/s,-180,180),f=Math.asin(ii(l*s,-1,1)),y=ii(Mr(f),-ai,ai);return new pe(h,y)}}class NE extends iT{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,o){let s=Om(e,i,o),l=m_(vs(o));return r.N.transformMat4(s,s,l),{x:s[0],y:s[1],z:s[2]}}locationPoint(e,i){let o=Ie(i.lat,i.lng),s=r.N.normalize([],o),l=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude,h=qt(1,0)*st*l;r.N.scaleAndAdd(o,o,s,h);let f=r.a6.identity(new Float64Array(16));return r.a6.multiply(f,e.pixelMatrix,e.globeMatrix),r.N.transformMat4(o,o,f),new nt(o[0],o[1])}pixelsPerMeter(e,i){return qt(1,0)*i}pixelSpaceConversion(e,i,o){let s=qt(1,e)*i,l=fi(qt(1,45)*i,s,o);return this.pixelsPerMeter(e,i)/l}createTileMatrix(e,i,o){let s=oy(vs(o.canonical));return r.a6.multiply(new Float64Array(16),e.globeMatrix,s)}createInversionMatrix(e,i){let{center:o}=e,s=m_(vs(i));return r.a6.rotateY(s,s,vi(o.lng)),r.a6.rotateX(s,s,vi(o.lat)),r.a6.scale(s,s,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(s)}pointCoordinate(e,i,o,s){return w1(e,i,o,!0)||new Ii(0,0)}pointCoordinate3D(e,i,o){let s=this.pointCoordinate(e,i,o,0);return[s.x,s.y,s.z]}isPointAboveHorizon(e,i){return!w1(e,i.x,i.y,!1)}farthestPixelDistance(e){let i=function(s,l){let h=s.cameraToCenterDistance,f=s._centerAltitude*l,y=s._camera,b=s._camera.forward(),T=r.N.add([],r.N.scale([],b,-h),[0,0,f]),I=s.worldSize/(2*Math.PI),C=[0,0,-I],D=s.width/s.height,R=Math.tan(s.fovAboveCenter),L=r.N.scale([],y.up(),R),B=r.N.scale([],y.right(),R*D),j=r.N.normalize([],r.N.add([],r.N.add([],b,L),B)),Z=[],K;if(new ey(T,j).closestPointOnSphere(C,I,Z)){let Y=r.N.add([],Z,C),ne=r.N.sub([],Y,T);K=Math.cos(s.fovAboveCenter)*r.N.length(ne)}else{let Y=r.N.sub([],T,C),ne=r.N.sub([],C,T);r.N.normalize(ne,ne);let te=r.N.length(Y)-I;K=Math.sqrt(te*(te+2*I));let se=Math.acos(K/(I+te))-Math.acos(r.N.dot(b,ne));K*=Math.cos(se)}return 1.01*K}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),o=$l(e.zoom);if(o>0){let s=eT(e,qt(1,e.center.lat)*e.worldSize),l=e.worldSize/(2*Math.PI),h=Math.max(e.width,e.height)/e.worldSize*Math.PI;return fi(i,s+l*(1-Math.cos(h)),Math.pow(o,10))}return i}upVector(e,i,o){return Om(i,o,e,1)}upVectorScale(e){return{metersToTile:d_(u_(vs(e)))}}}function aT(t){let e=t.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new iT(t);case"equirectangular":return new zE(t);case"naturalEarth":return new FE(t);case"equalEarth":return new LE(t);case"winkelTripel":return new BE(t);case"albers":return i?new oT(t):new RE(t);case"lambertConformalConic":return i?new oT(t):new OE(t);case"globe":return new NE(t)}throw new Error(`Invalid projection name: ${t.name}`)}let jE=v_.types,VE=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function O_(t,e,i,o,s,l,h,f,y,b,T,I,C){let D=f?Math.min(Xl,Math.round(f[0])):0,R=f?Math.min(Xl,Math.round(f[1])):0;t.emplaceBack(e,i,Math.round(32*o),Math.round(32*s),l,h,(D<<1)+(y?1:0),R,16*b,16*T,256*I,256*C)}function F_(t,e,i){t.emplaceBack(e,i)}function B_(t,e,i,o,s,l,h){t.emplaceBack(e,i,o,s,l,h)}function N_(t,e,i,o,s){t.emplaceBack(e,i,o,s),t.emplaceBack(e,i,o,s),t.emplaceBack(e,i,o,s),t.emplaceBack(e,i,o,s)}function UE(t){for(let e of t.sections)if(am(e.text))return!0;return!1}class Ay{constructor(e){this.layoutVertexArray=new Xc,this.indexArray=new hr,this.programConfigurations=e,this.segments=new Rn,this.dynamicLayoutVertexArray=new ms,this.opacityVertexArray=new Tm,this.placedSymbolArray=new qf,this.iconTransitioningVertexArray=new _a,this.globeExtVertexArray=new wm,this.zOffsetVertexArray=new Kc}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,i,o,s,l){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,YM.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,QM.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,VE,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,eE.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,KM.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||l)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,JM.members,!0)),this.opacityVertexBuffer.itemSize=1),(o||s)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}mt(Ay,"SymbolBuffers");class Dy{constructor(e,i,o){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new o,this.segments=new Rn,this.collisionVertexArray=new Im,this.collisionVertexArrayExt=new ms}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,tE.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,iE.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}mt(Dy,"CollisionBuffers");class j_{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(h=>h.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=r.a6.identity([]),this.placementViewportMatrix=r.a6.identity([]);let i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=vy(this.zoom,i["text-size"]),this.iconSizeData=vy(this.zoom,i["icon-size"]);let o=this.layers[0].layout,s=o.get("symbol-sort-key"),l=o.get("symbol-z-order");this.canOverlap=o.get("text-allow-overlap")||o.get("icon-allow-overlap")||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=l!=="viewport-y"&&s.constantOr(1)!==void 0,this.sortFeaturesByY=(l==="viewport-y"||l==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=o.get("text-writing-mode").map(h=>ra[h]),this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=o.get("symbol-z-elevate")}createArrays(){this.text=new Ay(new U(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Ay(new U(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Wf,this.lineVertexArray=new td,this.symbolInstances=new Zf}calculateGlyphDependencies(e,i,o,s,l){for(let h=0;h<e.length;h++){let f=e.codePointAt(h);if(f===void 0)break;if(i[f]=!0,s&&l&&f<=65535){let y=$m[e.charAt(h)];y&&(i[y.charCodeAt(0)]=!0)}}}populate(e,i,o,s){let l=this.layers[0],h=l.layout,f=this.projection.name==="globe",y=h.get("text-font"),b=h.get("text-field"),T=h.get("icon-image"),I=(b.value.kind!=="constant"||b.value.value instanceof kr&&!b.value.value.isEmpty()||b.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),C=T.value.kind!=="constant"||!!T.value.value||Object.keys(T.parameters).length>0,D=h.get("symbol-sort-key");if(this.features=[],!I&&!C)return;let R=i.iconDependencies,L=i.glyphDependencies,B=i.availableImages,j=new yn(this.zoom);for(let{feature:Z,id:K,index:Y,sourceLayerIndex:ne}of e){let te=l._featureFilter.needGeometry,se=tr(Z,te);if(!l._featureFilter.filter(j,se,o))continue;if(te||(se.geometry=mr(Z,o,s)),f&&Z.type!==1&&o.z<=5){let _e=se.geometry,Se=.98078528056,ze=(ke,Re)=>{let we=Om(ke.x,ke.y,o,1),Pe=Om(Re.x,Re.y,o,1);return r.N.dot(we,Pe)<Se};for(let ke=0;ke<_e.length;ke++)_e[ke]=Sr(_e[ke],ze)}let he,fe;if(I){let _e=l.getValueAndResolveTokens("text-field",se,o,B),Se=kr.factory(_e);UE(Se)&&(this.hasRTLText=!0),(!this.hasRTLText||us()==="unavailable"||this.hasRTLText&&bo.isParsed())&&(he=oE(Se,l,se))}if(C){let _e=l.getValueAndResolveTokens("icon-image",se,o,B);fe=_e instanceof Lt?_e:Lt.fromString(_e)}if(!he&&!fe)continue;let ve=this.sortFeaturesByKey?D.evaluate(se,{},o):void 0;if(this.features.push({id:K,text:he,icon:fe,index:Y,sourceLayerIndex:ne,geometry:se.geometry,properties:Z.properties,type:jE[Z.type],sortKey:ve}),fe&&(R[fe.namePrimary]=!0,fe.nameSecondary&&(R[fe.nameSecondary]=!0)),he){let _e=y.evaluate(se,{},o).join(","),Se=h.get("text-rotation-alignment")==="map"&&h.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(ra.vertical)>=0;for(let ze of he.sections)if(ze.image)R[ze.image.namePrimary]=!0;else{let ke=ds(he.toString()),Re=ze.fontStack||_e,we=L[Re]=L[Re]||{};this.calculateGlyphDependencies(ze.text,we,Se,this.allowVerticalPlacement,ke)}}}h.get("symbol-placement")==="line"&&(this.features=function(Z){let K={},Y={},ne=[],te=0;function se(_e){ne.push(Z[_e]),te++}function he(_e,Se,ze){let ke=Y[_e];return delete Y[_e],Y[Se]=ke,ne[ke].geometry[0].pop(),ne[ke].geometry[0]=ne[ke].geometry[0].concat(ze[0]),ke}function fe(_e,Se,ze){let ke=K[Se];return delete K[Se],K[_e]=ke,ne[ke].geometry[0].shift(),ne[ke].geometry[0]=ze[0].concat(ne[ke].geometry[0]),ke}function ve(_e,Se,ze){let ke=ze?Se[0][Se[0].length-1]:Se[0][0];return`${_e}:${ke.x}:${ke.y}`}for(let _e=0;_e<Z.length;_e++){let Se=Z[_e],ze=Se.geometry,ke=Se.text?Se.text.toString():null;if(!ke){se(_e);continue}let Re=ve(ke,ze),we=ve(ke,ze,!0);if(Re in Y&&we in K&&Y[Re]!==K[we]){let Pe=fe(Re,we,ze),et=he(Re,we,ne[Pe].geometry);delete K[Re],delete Y[we],Y[ve(ke,ne[et].geometry,!0)]=et,ne[Pe].geometry=null}else Re in Y?he(Re,we,ze):we in K?fe(Re,we,ze):(se(_e),K[Re]=te-1,Y[we]=te-1)}return ne.filter(_e=>_e.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Z,K)=>Z.sortKey-K.sortKey)}update(e,i,o,s,l){let h=Object.keys(e).length!==0;if(h&&!this.stateDependentLayers.length)return;let f=h?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,i,f,o,s,l),this.icon.programConfigurations.updatePaintArrays(e,i,f,o,s,l)}updateZOffset(){let e=(l,h,f)=>{o+=h,o>l.length&&l.resize(o);for(let y=-h;y<0;y++)l.emplace(y+o,f)},i=(l,h,f)=>{s+=h,s>l.length&&l.resize(s);for(let y=-h;y<0;y++)l.emplace(y+s,f)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let o=0,s=0;for(let l=0;l<this.symbolInstances.length;l++){let h=this.symbolInstances.get(l),{numHorizontalGlyphVertices:f,numVerticalGlyphVertices:y,numIconVertices:b}=h,T=h.zOffset,I=b>0;if((f>0||y>0)&&(e(this.text.zOffsetVertexArray,f,T),e(this.text.zOffsetVertexArray,y,T)),I){let{placedIconSymbolIndex:C,verticalPlacedIconSymbolIndex:D}=h;C>=0&&i(this.icon.zOffsetVertexArray,b,T),D>=0&&i(this.icon.zOffsetVertexArray,h.numVerticalIconVertices,T)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=aT(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){let o=this.lineVertexArray.length;if(e.segment!==void 0)for(let{x:s,y:l}of i)this.lineVertexArray.emplaceBack(s,l);return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,i,o,s,l,h,f,y,b,T,I,C,D,R,L,B){let j=e.indexArray,Z=e.layoutVertexArray,K=e.globeExtVertexArray,Y=e.segments.prepareSegment(4*i.length,Z,j,this.canOverlap?h.sortKey:void 0),ne=this.glyphOffsetArray.length,te=Y.vertexLength,se=this.allowVerticalPlacement&&f===ra.vertical?Math.PI/2:0,he=h.text&&h.text.sections;for(let ve=0;ve<i.length;ve++){let{tl:_e,tr:Se,bl:ze,br:ke,texPrimary:Re,texSecondary:we,pixelOffsetTL:Pe,pixelOffsetBR:et,minFontScaleX:Fe,minFontScaleY:ft,glyphOffset:dt,isSDF:je,sectionIndex:zt}=i[ve],wt=Y.vertexLength,pt=dt[1];if(O_(Z,b.x,b.y,_e.x,pt+_e.y,Re.x,Re.y,o,je,Pe.x,Pe.y,Fe,ft),O_(Z,b.x,b.y,Se.x,pt+Se.y,Re.x+Re.w,Re.y,o,je,et.x,Pe.y,Fe,ft),O_(Z,b.x,b.y,ze.x,pt+ze.y,Re.x,Re.y+Re.h,o,je,Pe.x,et.y,Fe,ft),O_(Z,b.x,b.y,ke.x,pt+ke.y,Re.x+Re.w,Re.y+Re.h,o,je,et.x,et.y,Fe,ft),y){let{x:Ve,y:Pt,z:Qt}=y.anchor,[Ot,Jt,Vt]=y.up;B_(K,Ve,Pt,Qt,Ot,Jt,Vt),B_(K,Ve,Pt,Qt,Ot,Jt,Vt),B_(K,Ve,Pt,Qt,Ot,Jt,Vt),B_(K,Ve,Pt,Qt,Ot,Jt,Vt),N_(e.dynamicLayoutVertexArray,Ve,Pt,Qt,se)}else N_(e.dynamicLayoutVertexArray,b.x,b.y,b.z,se);if(B){let Ve=we||Re;F_(e.iconTransitioningVertexArray,Ve.x,Ve.y),F_(e.iconTransitioningVertexArray,Ve.x+Ve.w,Ve.y),F_(e.iconTransitioningVertexArray,Ve.x,Ve.y+Ve.h),F_(e.iconTransitioningVertexArray,Ve.x+Ve.w,Ve.y+Ve.h)}j.emplaceBack(wt,wt+1,wt+2),j.emplaceBack(wt+1,wt+2,wt+3),Y.vertexLength+=4,Y.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(dt[0]),ve!==i.length-1&&zt===i[ve+1].sectionIndex||e.programConfigurations.populatePaintArrays(Z.length,h,h.index,{},D,R,L,he&&he[zt])}let fe=y?y.anchor:b;e.placedSymbolArray.emplaceBack(fe.x,fe.y,fe.z,b.x,b.y,ne,this.glyphOffsetArray.length-ne,te,T,I,b.segment,o?o[0]:0,o?o[1]:0,s[0],s[1],f,0,!1,0,C,0)}_commitLayoutVertex(e,i,o,s,l,h,f){e.emplaceBack(i,o,s,l,h,Math.round(f.x),Math.round(f.y))}_addCollisionDebugVertices(e,i,o,s,l,h,f){let y=o.segments.prepareSegment(4,o.layoutVertexArray,o.indexArray),b=y.vertexLength,T=f.tileAnchorX,I=f.tileAnchorY;for(let D=0;D<4;D++)o.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(o.collisionVertexArrayExt,i,e.padding,f.zOffset),this._commitLayoutVertex(o.layoutVertexArray,s,l,h,T,I,new nt(e.x1,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,s,l,h,T,I,new nt(e.x2,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,s,l,h,T,I,new nt(e.x2,e.y2)),this._commitLayoutVertex(o.layoutVertexArray,s,l,h,T,I,new nt(e.x1,e.y2)),y.vertexLength+=4;let C=o.indexArray;C.emplaceBack(b,b+1),C.emplaceBack(b+1,b+2),C.emplaceBack(b+2,b+3),C.emplaceBack(b+3,b),y.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,o,s,l,h){for(let f=s;f<l;f++){let y=o.get(f),b=this.getSymbolInstanceTextSize(e,h,i,f);this._addCollisionDebugVertices(y,b,this.textCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,h)}}_addIconDebugCollisionBoxes(e,i,o,s,l,h){for(let f=s;f<l;f++){let y=o.get(f),b=this.getSymbolInstanceIconSize(e,i,h.placedIconSymbolIndex);this._addCollisionDebugVertices(y,b,this.iconCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,h)}}generateCollisionDebugBuffers(e,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Dy(Yc,Sw.members,_a),this.iconCollisionBox=new Dy(Yc,Sw.members,_a);let o=_h(this.iconSizeData,e),s=_h(this.textSizeData,e);for(let l=0;l<this.symbolInstances.length;l++){let h=this.symbolInstances.get(l);this._addTextDebugCollisionBoxes(s,e,i,h.textBoxStartIndex,h.textBoxEndIndex,h),this._addTextDebugCollisionBoxes(s,e,i,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h),this._addIconDebugCollisionBoxes(o,e,i,h.iconBoxStartIndex,h.iconBoxEndIndex,h),this._addIconDebugCollisionBoxes(o,e,i,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex,h)}}getSymbolInstanceTextSize(e,i,o,s){let l=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:s),h=S_(this.textSizeData,e,l)/Dr;return this.tilePixelRatio*h}getSymbolInstanceIconSize(e,i,o){let s=this.icon.placedSymbolArray.get(o),l=S_(this.iconSizeData,e,s);return this.tilePixelRatio*l}_commitDebugCollisionVertexUpdate(e,i,o,s){e.emplaceBack(i,-o,-o,s),e.emplaceBack(i,o,-o,s),e.emplaceBack(i,o,o,s),e.emplaceBack(i,-o,o,s)}_updateTextDebugCollisionBoxes(e,i,o,s,l,h){for(let f=s;f<l;f++){let y=o.get(f),b=this.getSymbolInstanceTextSize(e,h,i,f);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,b,y.padding,h.zOffset)}}_updateIconDebugCollisionBoxes(e,i,o,s,l,h){for(let f=s;f<l;f++){let y=o.get(f),b=this.getSymbolInstanceIconSize(e,i,h.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,b,y.padding,h.zOffset)}}updateCollisionDebugBuffers(e,i){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();let o=_h(this.iconSizeData,e),s=_h(this.textSizeData,e);for(let l=0;l<this.symbolInstances.length;l++){let h=this.symbolInstances.get(l);this._updateTextDebugCollisionBoxes(s,e,i,h.textBoxStartIndex,h.textBoxEndIndex,h),this._updateTextDebugCollisionBoxes(s,e,i,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h),this._updateIconDebugCollisionBoxes(o,e,i,h.iconBoxStartIndex,h.iconBoxEndIndex,h),this._updateIconDebugCollisionBoxes(o,e,i,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex,h)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,o,s,l,h,f,y,b){let T={};if(i<o){let{x1:I,y1:C,x2:D,y2:R,padding:L,projectedAnchorX:B,projectedAnchorY:j,projectedAnchorZ:Z,tileAnchorX:K,tileAnchorY:Y,featureIndex:ne}=e.get(i);T.textBox={x1:I,y1:C,x2:D,y2:R,padding:L,projectedAnchorX:B,projectedAnchorY:j,projectedAnchorZ:Z,tileAnchorX:K,tileAnchorY:Y},T.textFeatureIndex=ne}if(s<l){let{x1:I,y1:C,x2:D,y2:R,padding:L,projectedAnchorX:B,projectedAnchorY:j,projectedAnchorZ:Z,tileAnchorX:K,tileAnchorY:Y,featureIndex:ne}=e.get(s);T.verticalTextBox={x1:I,y1:C,x2:D,y2:R,padding:L,projectedAnchorX:B,projectedAnchorY:j,projectedAnchorZ:Z,tileAnchorX:K,tileAnchorY:Y},T.verticalTextFeatureIndex=ne}if(h<f){let{x1:I,y1:C,x2:D,y2:R,padding:L,projectedAnchorX:B,projectedAnchorY:j,projectedAnchorZ:Z,tileAnchorX:K,tileAnchorY:Y,featureIndex:ne}=e.get(h);T.iconBox={x1:I,y1:C,x2:D,y2:R,padding:L,projectedAnchorX:B,projectedAnchorY:j,projectedAnchorZ:Z,tileAnchorX:K,tileAnchorY:Y},T.iconFeatureIndex=ne}if(y<b){let{x1:I,y1:C,x2:D,y2:R,padding:L,projectedAnchorX:B,projectedAnchorY:j,projectedAnchorZ:Z,tileAnchorX:K,tileAnchorY:Y,featureIndex:ne}=e.get(y);T.verticalIconBox={x1:I,y1:C,x2:D,y2:R,padding:L,projectedAnchorX:B,projectedAnchorY:j,projectedAnchorZ:Z,tileAnchorX:K,tileAnchorY:Y},T.verticalIconFeatureIndex=ne}return T}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){let o=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){let o=e.placedSymbolArray.get(i),s=o.vertexStartIndex+4*o.numGlyphs;for(let l=o.vertexStartIndex;l<s;l+=4)e.indexArray.emplaceBack(l,l+1,l+2),e.indexArray.emplaceBack(l+1,l+2,l+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let i=Math.sin(e),o=Math.cos(e),s=[],l=[],h=[];for(let f=0;f<this.symbolInstances.length;++f){h.push(f);let y=this.symbolInstances.get(f);s.push(0|Math.round(i*y.tileAnchorX+o*y.tileAnchorY)),l.push(y.featureIndex)}return h.sort((f,y)=>s[f]-s[y]||l[y]-l[f]),h}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,i){let o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===i?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let i of this.symbolInstanceIndexes){let o=this.symbolInstances.get(i);this.featureSortOrder.push(o.featureIndex);let{rightJustifiedTextSymbolIndex:s,centerJustifiedTextSymbolIndex:l,leftJustifiedTextSymbolIndex:h,verticalPlacedTextSymbolIndex:f,placedIconSymbolIndex:y,verticalPlacedIconSymbolIndex:b}=o;s>=0&&this.addIndicesForPlacedSymbol(this.text,s),l>=0&&l!==s&&this.addIndicesForPlacedSymbol(this.text,l),h>=0&&h!==l&&h!==s&&this.addIndicesForPlacedSymbol(this.text,h),f>=0&&this.addIndicesForPlacedSymbol(this.text,f),y>=0&&this.addIndicesForPlacedSymbol(this.icon,y),b>=0&&this.addIndicesForPlacedSymbol(this.icon,b)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}mt(j_,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),j_.addDynamicAttributes=N_;let GE=new bn({"symbol-placement":new Qe(ye.layout_symbol["symbol-placement"]),"symbol-spacing":new Qe(ye.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Qe(ye.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new At(ye.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Qe(ye.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Qe(ye.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new Qe(ye.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Qe(ye.layout_symbol["icon-ignore-placement"]),"icon-optional":new Qe(ye.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Qe(ye.layout_symbol["icon-rotation-alignment"]),"icon-size":new At(ye.layout_symbol["icon-size"]),"icon-text-fit":new At(ye.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new At(ye.layout_symbol["icon-text-fit-padding"]),"icon-image":new At(ye.layout_symbol["icon-image"]),"icon-rotate":new At(ye.layout_symbol["icon-rotate"]),"icon-padding":new Qe(ye.layout_symbol["icon-padding"]),"icon-keep-upright":new Qe(ye.layout_symbol["icon-keep-upright"]),"icon-offset":new At(ye.layout_symbol["icon-offset"]),"icon-anchor":new At(ye.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Qe(ye.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Qe(ye.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Qe(ye.layout_symbol["text-rotation-alignment"]),"text-field":new At(ye.layout_symbol["text-field"]),"text-font":new At(ye.layout_symbol["text-font"]),"text-size":new At(ye.layout_symbol["text-size"]),"text-max-width":new At(ye.layout_symbol["text-max-width"]),"text-line-height":new At(ye.layout_symbol["text-line-height"]),"text-letter-spacing":new At(ye.layout_symbol["text-letter-spacing"]),"text-justify":new At(ye.layout_symbol["text-justify"]),"text-radial-offset":new At(ye.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Qe(ye.layout_symbol["text-variable-anchor"]),"text-anchor":new At(ye.layout_symbol["text-anchor"]),"text-max-angle":new Qe(ye.layout_symbol["text-max-angle"]),"text-writing-mode":new Qe(ye.layout_symbol["text-writing-mode"]),"text-rotate":new At(ye.layout_symbol["text-rotate"]),"text-padding":new Qe(ye.layout_symbol["text-padding"]),"text-keep-upright":new Qe(ye.layout_symbol["text-keep-upright"]),"text-transform":new At(ye.layout_symbol["text-transform"]),"text-offset":new At(ye.layout_symbol["text-offset"]),"text-allow-overlap":new Qe(ye.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Qe(ye.layout_symbol["text-ignore-placement"]),"text-optional":new Qe(ye.layout_symbol["text-optional"]),visibility:new Qe(ye.layout_symbol.visibility)});var Py={paint:new bn({"icon-opacity":new At(ye.paint_symbol["icon-opacity"]),"icon-emissive-strength":new At(ye.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new At(ye.paint_symbol["text-emissive-strength"]),"icon-color":new At(ye.paint_symbol["icon-color"]),"icon-halo-color":new At(ye.paint_symbol["icon-halo-color"]),"icon-halo-width":new At(ye.paint_symbol["icon-halo-width"]),"icon-halo-blur":new At(ye.paint_symbol["icon-halo-blur"]),"icon-translate":new Qe(ye.paint_symbol["icon-translate"]),"icon-translate-anchor":new Qe(ye.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new At(ye.paint_symbol["icon-image-cross-fade"]),"text-opacity":new At(ye.paint_symbol["text-opacity"]),"text-color":new At(ye.paint_symbol["text-color"],{runtimeType:Eo,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new At(ye.paint_symbol["text-halo-color"]),"text-halo-width":new At(ye.paint_symbol["text-halo-width"]),"text-halo-blur":new At(ye.paint_symbol["text-halo-blur"]),"text-translate":new Qe(ye.paint_symbol["text-translate"]),"text-translate-anchor":new Qe(ye.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Qe(ye.paint_symbol["icon-color-saturation"])}),layout:GE};class sT{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:bl,this.defaultValue=e}evaluate(e){if(e.formattedSection){let i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}mt(sT,"FormatSectionOverride",{omit:["defaultValue"]});class V_ extends oo{constructor(e,i,o){super(e,Py,i,o)}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));let o=this.layout.get("text-writing-mode");if(o){let s=[];for(let l of o)s.indexOf(l)<0&&s.push(l);this.layout._values["text-writing-mode"]=s}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,i,o,s){let l=this.layout.get(e).evaluate(i,{},o,s),h=this._unevaluatedLayout._values[e];return h.isDataDriven()||Oc(h.value)||!l?l:function(f,y){return y.replace(/{([^{}]+)}/g,(b,T)=>T in f?String(f[T]):"")}(i.properties,l)}createBucket(e){return new j_(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(let e of Py.paint.overridableProperties){if(!V_.hasPaintOverride(this.layout,e))continue;let i=this.paint.get(e),o=new sT(i),s=new Yd(o,i.property.specification,this.scope,this.options),l=null;l=i.value.kind==="constant"||i.value.kind==="source"?new rm("source",s):new Fc("composite",s,i.value.zoomStops,i.value._interpolationType),this.paint._values[e]=new Bl(i.property,l,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,o){return!(!this.layout||i.isDataDriven()||o.isDataDriven())&&V_.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){let o=e.get("text-field"),s=Py.paint.properties[i],l=!1,h=f=>{for(let y of f)if(s.overrides&&s.overrides.hasOverride(y))return void(l=!0)};if(o.value.kind==="constant"&&o.value.value instanceof kr)h(o.value.value.sections);else if(o.value.kind==="source"){let f=b=>{l||(b instanceof Ma&&Jn(b.value)===xl?h(b.value.sections):b instanceof Tl?h(b.sections):b.eachChild(f))},y=o.value;y._styleExpression&&f(y._styleExpression.expression)}return l}getProgramIds(){let e=this.paint.get("icon-opacity").constantOr(1)!==0,i=this.paint.get("text-opacity").constantOr(1)!==0,o=[];return e&&o.push("symbolIcon"),i&&o.push("symbolSDF"),o}getDefaultProgramParams(e,i){return{config:new O(this,i),overrideFog:!1}}}let $E=new bn({visibility:new Qe(ye.layout_background.visibility)});var qE={paint:new bn({"background-color":new Qe(ye.paint_background["background-color"]),"background-pattern":new Qe(ye.paint_background["background-pattern"]),"background-opacity":new Qe(ye.paint_background["background-opacity"]),"background-emissive-strength":new Qe(ye.paint_background["background-emissive-strength"])}),layout:$E};let HE=new bn({visibility:new Qe(ye.layout_raster.visibility)});var ZE={paint:new bn({"raster-opacity":new Qe(ye.paint_raster["raster-opacity"]),"raster-color":new Ks(ye.paint_raster["raster-color"]),"raster-color-mix":new Qe(ye.paint_raster["raster-color-mix"]),"raster-color-range":new Qe(ye.paint_raster["raster-color-range"]),"raster-hue-rotate":new Qe(ye.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Qe(ye.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Qe(ye.paint_raster["raster-brightness-max"]),"raster-saturation":new Qe(ye.paint_raster["raster-saturation"]),"raster-contrast":new Qe(ye.paint_raster["raster-contrast"]),"raster-resampling":new Qe(ye.paint_raster["raster-resampling"]),"raster-fade-duration":new Qe(ye.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Qe(ye.paint_raster["raster-emissive-strength"]),"raster-array-band":new Qe(ye.paint_raster["raster-array-band"]),"raster-elevation":new Qe(ye.paint_raster["raster-elevation"])}),layout:HE},Ry=Bi([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Ly{constructor(e,i,o,s){this.context=e,this.format=o,this.texture=e.gl.createTexture(),this.update(i,s)}update(e,i,o){let{width:s,height:l}=e,{context:h}=this,{gl:f}=h;if(f.bindTexture(f.TEXTURE_2D,this.texture),h.pixelStoreUnpackFlipY.set(!1),h.pixelStoreUnpack.set(1),h.pixelStoreUnpackPremultiplyAlpha.set(this.format===f.RGBA&&(!i||i.premultiply!==!1)),o||this.size&&this.size[0]===s&&this.size[1]===l){let{x:y,y:b}=o||{x:0,y:0};if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap)f.texSubImage2D(f.TEXTURE_2D,0,y,b,f.RGBA,f.UNSIGNED_BYTE,e);else{let T=this.format,I=f.UNSIGNED_BYTE;this.format===f.R32F&&(T=f.RED,I=f.FLOAT),f.texSubImage2D(f.TEXTURE_2D,0,y,b,s,l,T,I,e.data)}}else if(this.size=[s,l],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap){let y=this.format;this.format===f.R8&&(y=f.RED),f.texImage2D(f.TEXTURE_2D,0,this.format,y,f.UNSIGNED_BYTE,e)}else{let y=this.format,b=this.format,T=f.UNSIGNED_BYTE;this.format===f.DEPTH_COMPONENT&&(y=f.DEPTH_COMPONENT16,T=f.UNSIGNED_SHORT),this.format===f.R8&&(b=f.RED),this.format===f.R32F&&(T=f.FLOAT,b=f.RED),f.texImage2D(f.TEXTURE_2D,0,y,s,l,0,b,T,e.data)}this.useMipmap=!!(i&&i.useMipmap),this.useMipmap&&f.generateMipmap(f.TEXTURE_2D)}bind(e,i,o=!1){let{context:s}=this,{gl:l}=s;l.bindTexture(l.TEXTURE_2D,this.texture),e!==this.minFilter&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,e),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,this.useMipmap&&!o?e===l.NEAREST?l.NEAREST_MIPMAP_NEAREST:l.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,i),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,o,s){let{context:l}=this,{gl:h}=l;h.bindTexture(h.TEXTURE_2D,this.texture),i!==this.magFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap?e===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),o!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,o),this.wrapS=o),s!==this.wrapT&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,s),this.wrapT=s)}destroy(){let{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class U_{constructor(e,i){this.context=e,this.texture=i}bind(e,i){let{context:o}=this,{gl:s}=o;s.bindTexture(s.TEXTURE_2D,this.texture),e!==this.minFilter&&(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,e),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,i),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,i),this.wrapS=i)}}function G_(t,e,i,o,s,l,h,f){let y=[t,e,1,i,o,1,s,l,1],b=[h,f,1],T=r.co.adjoint([],y),[I,C,D]=r.N.transformMat3(b,b,T);return r.co.multiply(y,y,[I,0,0,0,C,0,0,0,D])}function lT(t,e,i,o,s,l,h,f){let y=function(b,T,I,C,D,R,L,B){let j=G_(0,0,1,0,1,1,0,1),Z=G_(b,T,I,C,D,R,L,B),K=r.co.adjoint([],j);return r.co.multiply(Z,Z,K)}(t,e,i,o,s,l,h,f);return[y[2]/y[8]/st,y[5]/y[8]/st]}function $_(t){return[t[0],Math.min(Math.max(t[1],-ai),ai)]}class cT extends yl{constructor(e,i,o,s){super(),this.id=e,this.dispatcher=o,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(s),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new Bs("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=at(this.map._requestManager.transformRequest(this.url,to.Image),(o,s)=>{this._imageRequest=null,this._loaded=!0,o?this.fire(new lu(o)):s&&(this.image=s instanceof HTMLImageElement?qe.getImageData(s):s,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new U_(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Bs("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof U_||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],o=e[0][1];for(let l of e)l[1]>o&&(o=l[1]),l[1]<i&&(i=l[1]);let s=(o+i)/2;if(s>ai?this.onNorthPole=!0:s<-ai&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){let l=e.map(Ii.fromLngLat);this.tileID=function(h){let f=1/0,y=1/0,b=-1/0,T=-1/0;for(let L of h)f=Math.min(f,L.x),y=Math.min(y,L.y),b=Math.max(b,L.x),T=Math.max(T,L.y);let I=Math.max(b-f,T-y),C=Math.max(0,Math.floor(-Math.log(I)/Math.LN2)),D=Math.pow(2,C),R=Math.floor((f+b)/2*D);return R>1&&(R-=1),new Ne(C,R,Math.floor((y+T)/2*D))}(l),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Bs("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(let j in this.tiles){let Z=this.tiles[j];Z.state!=="loaded"&&(Z.state="loaded",Z.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;let i=Wm(new Ne(0,0,0),this.map.transform.projection),o=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(j){let Z=j[1].x-j[0].x,K=j[1].y-j[0].y,Y=j[2].x-j[1].x,ne=j[2].y-j[1].y,te=j[3].x-j[2].x,se=j[3].y-j[2].y,he=j[0].x-j[3].x,fe=j[0].y-j[3].y,ve=Z*ne-Y*K,_e=Y*se-te*ne,Se=te*fe-he*se,ze=he*K-Z*fe;return ve>0&&_e>0&&Se>0&&ze>0||ve<0&&_e<0&&Se<0&&ze<0}(o))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);let s=Wm(this.tileID,this.map.transform.projection),[l,h,f,y]=this.coordinates.map(j=>{let Z=s.projection.project(j[0],j[1]);return tT(s,Z)._round()});this.perspectiveTransform=lT(l.x,l.y,h.x,h.y,f.x,f.y,y.x,y.y);let b=this._boundsArray=new La;b.emplaceBack(l.x,l.y,0,0),b.emplaceBack(h.x,h.y,st,0),b.emplaceBack(y.x,y.y,0,st),b.emplaceBack(f.x,f.y,st,st),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(b,Ry.members),this.boundsSegments=Rn.simpleSegment(0,0,4,2);let T=[],I=[$_((C=this.coordinates)[0]),$_(C[1]),$_(C[2]),$_(C[3])];var C;let[D,R,L,B]=function(j){let Z=j[0][0],K=Z,Y=j[0][1],ne=Y;for(let te=1;te<j.length;te++)j[te][0]<Z?Z=j[te][0]:j[te][0]>K&&(K=j[te][0]),j[te][1]<Y?Y=j[te][1]:j[te][1]>ne&&(ne=j[te][1]);return[Z,Y,K-Z,ne-Y]}(I);{let j=new La,[Z,K,Y,ne]=function(Pe){let et=Pe[0].x,Fe=et,ft=Pe[0].y,dt=ft;for(let je=1;je<Pe.length;je++)Pe[je].x<et?et=Pe[je].x:Pe[je].x>Fe&&(Fe=Pe[je].x),Pe[je].y<ft?ft=Pe[je].y:Pe[je].y>dt&&(dt=Pe[je].y);return[et,ft,Fe-et,dt-ft]}(o),te=Pe=>[(Pe.x-Z)/Y,(Pe.y-K)/ne],[se,he,fe,ve]=o.map(te),_e=function(Pe,et,Fe,ft,dt,je,zt,wt){let pt=G_(0,0,1,0,1,1,0,1),Ve=G_(Pe,et,Fe,ft,dt,je,zt,wt),Pt=r.co.adjoint([],Ve);return r.co.multiply(pt,pt,Pt)}(se[0],se[1],he[0],he[1],fe[0],fe[1],ve[0],ve[1]);this.elevatedGlobePerspectiveTransform=lT(se[0],se[1],he[0],he[1],fe[0],fe[1],ve[0],ve[1]);let Se=(Pe,et)=>{T.push(Pe.lng);let Fe=Math.round((Pe.lng-D)/L*st),ft=Math.round((Pe.lat-R)/B*st),dt=te(et),je=r.N.transformMat3([],[dt[0],dt[1],1],_e),zt=Math.round(je[0]/je[2]*st),wt=Math.round(je[1]/je[2]*st);j.emplaceBack(Fe,ft,zt,wt)},ze=o[3].x-o[0].x,ke=o[3].y-o[0].y,Re=o[2].x-o[1].x,we=o[2].y-o[1].y;for(let Pe=0;Pe<65;Pe++){let et=Pe/64,Fe=[o[0].x+et*ze,o[0].y+et*ke],ft=[o[1].x+et*Re,o[1].y+et*we],dt=ft[0]-Fe[0],je=ft[1]-Fe[1];for(let zt=0;zt<65;zt++){let wt=zt/64,pt={x:Fe[0]+dt*wt,y:Fe[1]+je*wt,z:0};Se(i.projection.unproject(pt.x,pt.y),pt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(j,Ry.members)}{this.maxLongitudeTriangleSize=0;let j=[],Z=new hr,K=(Y,ne,te)=>{Z.emplaceBack(Y,ne,te);let se=T[Y],he=T[ne],fe=T[te],ve=Math.min(Math.min(se,he),fe),_e=Math.max(Math.max(se,he),fe)-ve;_e>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=_e),j.push(ve+_e/2)};for(let Y=0;Y<64;Y++)for(let ne=0;ne<64;ne++){let te=65*Y+ne,se=te+1,he=te+65,fe=he+1;K(te,he,se),K(se,he,fe)}[j,Z]=function(Y,ne){let te=Array.from({length:Y.length},(fe,ve)=>ve);te.sort((fe,ve)=>Y[fe]-Y[ve]);let se=[],he=new hr;for(let fe=0;fe<te.length;fe++){let ve=te[fe];se.push(Y[ve]);let _e=3*ve,Se=_e+1;he.emplaceBack(ne.uint16[_e],ne.uint16[Se],ne.uint16[Se+1])}return[se,he]}(j,Z),this.elevatedGlobeTrianglesCenterLongitudes=j,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(Z)}this.elevatedGlobeSegments=Rn.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,L/st,0,B/st,0,0,R,D,0])}prepare(){let e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;let i=this.map.painter.context,o=i.gl;!this._dirty||this.texture instanceof U_||(this.texture?this.texture.update(this.image):(this.texture=new Ly(i,this.image,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},i(null)):(e.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){let i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;let o=this.elevatedGlobeTrianglesCenterLongitudes,s=((T,I)=>T+360*Math.round((I-T)/360))(e+180,o[0]),l=new Rn,h=(T,I)=>{l.segments.push({vertexOffset:0,primitiveOffset:T,vertexLength:i.segments[0].vertexLength,primitiveLength:I,sortKey:void 0,vaos:{}})},f=.51*this.maxLongitudeTriangleSize;if(Math.abs(o[0]-s)<=f){let T=Me(o,0,o.length,s+f);return T===o.length||h(T,de(o,T+1,o.length,s+360-f)-T),l}s<o[0]&&(s+=360);let y=de(o,0,o.length,s-f);if(y===o.length)return h(0,o.length),l;h(0,y-0);let b=Me(o,y+1,o.length,s+f);return b!==o.length&&h(b,o.length-b),l}}let WE=(Math.pow(256,2)-1)/16907520;class dT extends oo{constructor(e,i,o){super(e,ZE,i,o),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isLayerDraped(e){return!(e&&e._source instanceof cT&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;let i=this._transitionablePaint._values["raster-color"].value.expression,[o,s]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(o)&&isNaN(s)||o===this._curRampRange[0]&&s===this._curRampRange[1]||(this.colorRamp=Fm({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:o,end:s}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[o,s])}}let XE=new bn({visibility:new Qe(ye["layout_raster-particle"].visibility)});var YE={paint:new bn({"raster-particle-array-band":new Qe(ye["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Qe(ye["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Ks(ye["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Qe(ye["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Qe(ye["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Qe(ye["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Qe(ye["paint_raster-particle"]["raster-particle-reset-rate-factor"])}),layout:XE};class hT extends oo{constructor(e,i,o){super(e,YE,i,o),this._updateColorRamp(),this.onRemove=s=>{this.colorRampTexture&&this.colorRampTexture.destroy(),this.transformFeedbackObject&&s.painter.context.gl.deleteTransformFeedback(this.transformFeedbackObject),this.tileFramebuffer&&this.tileFramebuffer.destroy()},this.lastInvalidatedAt=qe.now()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isLayerDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;let e=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Fm({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=qe.now()}}class KE extends oo{constructor(e,i){super(e,{},i),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}let QE=new bn({visibility:new Qe(ye.layout_sky.visibility)});var JE={paint:new bn({"sky-type":new Qe(ye.paint_sky["sky-type"]),"sky-atmosphere-sun":new Qe(ye.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Qe(ye.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Qe(ye.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Qe(ye.paint_sky["sky-gradient-radius"]),"sky-gradient":new Ks(ye.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Qe(ye.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Qe(ye.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Qe(ye.paint_sky["sky-opacity"])}),layout:QE};function zy(t,e,i){let o=[0,0,1],s=r.bi.identity([]);return r.bi.rotateY(s,s,i?-vi(t)+Math.PI:vi(t)),r.bi.rotateX(s,s,-vi(e)),r.N.transformQuat(o,o,s),r.N.normalize(o,o)}var eA={paint:new bn({})};function uT(t,e){let i=q_(t.projection,t.zoom,t.width,t.height),o=function(l,h,f,y,b){let T=new pe(f.lng-180*Kl,f.lat),I=new pe(f.lng+180*Kl,f.lat),C=l.project(T.lng,T.lat),D=l.project(I.lng,I.lat),R=-Math.atan2(D.y-C.y,D.x-C.x),L=Ii.fromLngLat(f);L.y=ii(L.y,-1+Kl,1-Kl);let B=L.toLngLat(),j=l.project(B.lng,B.lat),Z=Ii.fromLngLat(B);Z.x+=Kl;let K=Z.toLngLat(),Y=l.project(K.lng,K.lat),ne=fT(Y.x-j.x,Y.y-j.y,R),te=Ii.fromLngLat(B);te.y+=Kl;let se=te.toLngLat(),he=l.project(se.lng,se.lat),fe=fT(he.x-j.x,he.y-j.y,R),ve=Math.abs(ne.x)/Math.abs(fe.y),_e=r.a6.identity([]);r.a6.rotateZ(_e,_e,-R*(1-(b?0:y)));let Se=r.a6.identity([]);return r.a6.scale(Se,Se,[1,1-(1-ve)*y,1]),Se[4]=-fe.x/fe.y*y,r.a6.rotateZ(Se,Se,R),r.a6.multiply(Se,_e,Se),Se}(t.projection,0,t.center,i,e),s=mT(t);return r.a6.scale(o,o,[s,s,1]),o}function mT(t){let e=t.projection,i=q_(t.projection,t.zoom,t.width,t.height),o=pT(e,t.center),s=pT(e,pe.convert(e.center));return Math.pow(2,o*i+(1-i)*s)}function q_(t,e,i,o,s=1/0){let l=t.range;if(!l)return 0;let h=Math.min(s,Math.max(i,o)),f=Math.log(h/1024)/Math.LN2;return ml(l[0]+f,l[1]+f,e)}let Kl=1/4e4;function pT(t,e){let i=ii(e.lat,-ai,ai),o=new pe(e.lng-180*Kl,i),s=new pe(e.lng+180*Kl,i),l=t.project(o.lng,i),h=t.project(s.lng,i),f=Ii.fromLngLat(o),y=Ii.fromLngLat(s),b=h.x-l.x,T=h.y-l.y,I=y.x-f.x,C=y.y-f.y,D=Math.sqrt((I*I+C*C)/(b*b+T*T));return Math.log(D)/Math.LN2}function fT(t,e,i){let o=Math.cos(i),s=Math.sin(i);return{x:t*o-e*s,y:t*s+e*o}}function _T(t,e,i){r.a6.identity(t),r.a6.rotateZ(t,t,vi(e[2])),r.a6.rotateX(t,t,vi(e[0])),r.a6.rotateY(t,t,vi(e[1])),r.a6.scale(t,t,i),r.a6.multiply(t,t,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function H_(t,e,i,o,s,l,h,f){let y=[i[0]-e[0],i[1]-e[1],0],b=[o[0]-e[0],o[1]-e[1],0];if(r.N.length(y)<1e-12||r.N.length(b)<1e-12)return r.bi.identity(t);let T=r.N.cross([],y,b);r.N.normalize(T,T),r.N.subtract(b,o,e),y[2]=(l-s)*f,b[2]=(h-s)*f;let I=y;return r.N.cross(I,y,b),r.N.normalize(I,I),r.bi.rotationTo(t,T,I)}function Oy(t,e,i=!1){let o=$l(e.zoom),s=function(l,h,f){let y=h.worldSize,b=[l[12],l[13],l[14]],T=yi(b[1]/y),I=Gt(b[0]/y),C=r.a6.identity([]),D=qt(1,T)*y,R=qt(1,0)*y*si(T,h.zoom),L=1/ay(y),B=R*L;if(f){let Y=q_(h.projection,h.zoom,h.width,h.height,1024);B=L*h.projection.pixelSpaceConversion(h.center.lat,y,Y)}let j=Ie(T,I);r.N.add(j,j,r.N.scale([],r.N.normalize([],j),D*B*b[2]));let Z=function(Y){let ne=[Y[0],Y[1],Y[2]],te=[0,1,0],se=r.N.cross([],te,ne);return r.N.cross(te,ne,se),r.N.squaredLength(te)===0&&(te=[0,1,0],r.N.cross(se,ne,te)),r.N.normalize(se,se),r.N.normalize(te,te),r.N.normalize(ne,ne),[se[0],se[1],se[2],0,te[0],te[1],te[2],0,ne[0],ne[1],ne[2],0,Y[0],Y[1],Y[2],1]}(j);r.a6.scale(C,C,[B,B,B*D]),r.a6.translate(C,C,[-b[0],-b[1],-b[2]]);let K=r.a6.multiply([],h.globeMatrix,Z);return r.a6.multiply(K,K,C),r.a6.multiply(K,K,l),K}(t,e,i);if(o>0){let l=function(h,f){let y=f.worldSize,b=qt(1,0)*y*si(f.center.lat,f.zoom)/ay(y),T=qt(1,f.center.lat)*y,I=r.a6.identity([]);return r.a6.rotateY(I,I,vi(f.center.lng)),r.a6.rotateX(I,I,vi(f.center.lat)),r.a6.translate(I,I,[0,0,W]),r.a6.scale(I,I,[b,b,b*T]),r.a6.translate(I,I,[f.point.x-.5*y,f.point.y-.5*y,0]),r.a6.multiply(I,I,h),r.a6.multiply(I,f.globeMatrix,I)}(t,e);return function(h,f,y){let b=(R,L,B)=>{let j=r.N.length(R),Z=r.N.length(L),K=rl(R,L,B);return r.N.scale(K,K,1/r.N.length(K)*fi(j,Z,B))},T=b([h[0],h[1],h[2]],[f[0],f[1],f[2]],y),I=b([h[4],h[5],h[6]],[f[4],f[5],f[6]],y),C=b([h[8],h[9],h[10]],[f[8],f[9],f[10]],y),D=rl([h[12],h[13],h[14]],[f[12],f[13],f[14]],y);return[T[0],T[1],T[2],0,I[0],I[1],I[2],0,C[0],C[1],C[2],0,D[0],D[1],D[2],1]}(s,l,o)}return s}function gT(t,e,i,o){let s=An.projectAabbCorners(o,i),l=Number.MAX_VALUE,h=-1;for(let b=0;b<s.length;++b){let T=s[b];T[0]=(.5*T[0]+.5)*e.width,T[1]=(.5-.5*T[1])*e.height,T[2]<l&&(h=b,l=T[2])}let f=b=>new nt(s[b][0],s[b][1]),y;switch(h){case 0:case 6:y=[f(1),f(5),f(4),f(7),f(3),f(2),f(1)];break;case 1:case 7:y=[f(0),f(4),f(5),f(6),f(2),f(3),f(0)];break;case 3:case 5:y=[f(1),f(0),f(4),f(7),f(6),f(2),f(1)];break;default:y=[f(1),f(5),f(6),f(7),f(3),f(0),f(1)]}if(ya(t,y))return l}let tA=Bi([{name:"a_pos_3f",components:3,type:"Float32"}]),iA=Bi([{name:"a_color_3f",components:3,type:"Float32"}]),nA=Bi([{name:"a_color_4f",components:4,type:"Float32"}]),rA=Bi([{name:"a_uv_2f",components:2,type:"Float32"}]),oA=Bi([{name:"a_normal_3f",components:3,type:"Float32"}]),aA=Bi([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),sA=Bi([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class yT{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class bT{constructor(){this.instancedDataArray=new Mm,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class Fy{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0}}populate(e,i,o,s){this.tileToMeter=li(o);let l=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(let{feature:h,id:f,index:y,sourceLayerIndex:b}of e){let T=tr(h,l);if(!this.layers[0]._featureFilter.filter(new yn(this.zoom),T,o))continue;let I={id:f,sourceLayerIndex:b,index:y,geometry:l?T.geometry:mr(h,o,s),properties:h.properties,type:h.type,patterns:{}},C=this.addFeature(I,I.geometry,T);C&&i.featureIndex.insert(h,I.geometry,y,b,this.index,this.instancesPerModel[C].instancedDataArray.length,st/32)}this.lookup=null}update(e,i,o,s){for(let l in this.instancesPerModel){let h=this.instancesPerModel[l];for(let f in e)h.idToFeaturesIndex.hasOwnProperty(f)&&this.evaluate(h.features[h.idToFeaturesIndex[f]],e[f],h,!0)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(let i in this.instancesPerModel){let o=this.instancesPerModel[i];for(let s of o.features){let l=this.layers[0],h=s.feature,f=this.canonical,y=l.paint.get("model-rotation").evaluate(h,{},f),b=l.paint.get("model-scale").evaluate(h,{},f),T=l.paint.get("model-translation").evaluate(h,{},f);r.N.exactEquals(s.rotation,y)&&r.N.exactEquals(s.scale,b)&&r.N.exactEquals(s.translation,T)||(this.evaluate(s,s.featureStates,o,!0),e=!0)}}return e}isEmpty(){for(let e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(let i in this.instancesPerModel){let o=this.instancesPerModel[i];o.instancedDataArray.length<0||o.instancedDataArray.length===0||(o.instancedDataBuffer?o.instancedDataBuffer.updateData(o.instancedDataArray):o.instancedDataBuffer=e.createVertexBuffer(o.instancedDataArray,aA.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(let e in this.instancesPerModel){let i=this.instancesPerModel[e];i.instancedDataArray.length!==0&&i.instancedDataBuffer&&i.instancedDataBuffer.destroy()}}addFeature(e,i,o){let s=this.layers[0],l=s.layout.get("model-id").evaluate(o,{},this.canonical);if(!l)return Pn(`modelId is not evaluated for layer ${s.id} and it is not going to get rendered.`),l;this.instancesPerModel[l]||(this.instancesPerModel[l]=new bT);let h=this.instancesPerModel[l],f=h.instancedDataArray,y=new yT(o,f.length);for(let b of i)for(let T of b){if(T.x<0||T.x>=st||T.y<0||T.y>=st)continue;let I=(this.lookupDim-1)/st,C=this.lookupDim*(T.y*I|0)+T.x*I|0;if(this.lookup){if(this.lookup[C]!==0)continue;this.lookup[C]=1}this.instanceCount++;let D=f.length;f.resize(D+1),h.instancesEvaluatedElevation.push(0),f.float32[16*D]=T.x,f.float32[16*D+1]=T.y}return y.instancedDataCount=h.instancedDataArray.length-y.instancedDataOffset,y.instancedDataCount>0&&(e.id&&(h.idToFeaturesIndex[e.id]=h.features.length),h.features.push(y),this.evaluate(y,{},h,!1)),l}evaluate(e,i,o,s){let l=this.layers[0],h=e.feature,f=this.canonical,y=e.rotation=l.paint.get("model-rotation").evaluate(h,i,f),b=e.scale=l.paint.get("model-scale").evaluate(h,i,f),T=e.translation=l.paint.get("model-translation").evaluate(h,i,f),I=l.paint.get("model-color").evaluate(h,i,f);I.a=l.paint.get("model-color-mix-intensity").evaluate(h,i,f);let C=[];this.maxVerticalOffset<T[2]&&(this.maxVerticalOffset=T[2]),this.maxScale=Math.max(Math.max(this.maxScale,b[0]),Math.max(b[1],b[2])),_T(C,y,b);let D=Math.round(100*I.a)+I.b/1.05;for(let R=0;R<e.instancedDataCount;++R){let L=e.instancedDataOffset+R,B=16*L,j=o.instancedDataArray.float32,Z=0;s&&(Z=j[B+6]-o.instancesEvaluatedElevation[L]);let K=0|j[B+1];j[B]=(0|j[B])+I.r/1.05,j[B+1]=K+I.g/1.05,j[B+2]=D,j[B+3]=1/(f.z>10?this.tileToMeter:li(f,K)),j[B+4]=T[0],j[B+5]=T[1],j[B+6]=T[2]+Z,j[B+7]=C[0],j[B+8]=C[1],j[B+9]=C[2],j[B+10]=C[4],j[B+11]=C[5],j[B+12]=C[6],j[B+13]=C[8],j[B+14]=C[9],j[B+15]=C[10],o.instancesEvaluatedElevation[L]=T[2]}}}mt(Fy,"ModelBucket",{omit:["layers"]}),mt(bT,"PerModelAttributes"),mt(yT,"ModelFeature");let lA=new bn({visibility:new Qe(ye.layout_model.visibility),"model-id":new At(ye.layout_model["model-id"])});var cA={paint:new bn({"model-opacity":new Qe(ye.paint_model["model-opacity"]),"model-rotation":new At(ye.paint_model["model-rotation"]),"model-scale":new At(ye.paint_model["model-scale"]),"model-translation":new At(ye.paint_model["model-translation"]),"model-color":new At(ye.paint_model["model-color"]),"model-color-mix-intensity":new At(ye.paint_model["model-color-mix-intensity"]),"model-type":new Qe(ye.paint_model["model-type"]),"model-cast-shadows":new Qe(ye.paint_model["model-cast-shadows"]),"model-receive-shadows":new Qe(ye.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Qe(ye.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new At(ye.paint_model["model-emissive-strength"]),"model-roughness":new At(ye.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new At(ye.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Qe(ye.paint_model["model-cutoff-fade-range"])}),layout:lA};let hd=64,kh={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function vT(t,e,i,o,s,l,h,f,y,b=!1){let T=i.zoom,I=i.project(o),C=si(o.lat,T),D=1/C;r.a6.identity(t),r.a6.translate(t,t,[I.x+h[0]*D,I.y+h[1]*D,h[2]]);let R=1,L=1,B=i.worldSize;if(b){if(i.projection.name==="mercator"){let Y=0;i.elevation&&(Y=i.elevation.getAtPointOrZero(new Ii(I.x/B,I.y/B),0));let ne=r.a7.transformMat4([],[I.x,I.y,Y,1],i.projMatrix)[3]/i.cameraToCenterDistance;R=ne,L=ne*si(i.center.lat,T)}else if(i.projection.name==="globe"){let Y=Oy(t,i),ne=r.a6.multiply([],i.projMatrix,Y),te=[0,0,0,1];r.a7.transformMat4(te,te,ne);let se=te[3]/i.cameraToCenterDistance,he=$l(T),fe=i.projection.pixelsPerMeter(o.lat,B)*si(o.lat,T),ve=i.projection.pixelsPerMeter(i.center.lat,B)*si(i.center.lat,T);R=se/fi(fe,vn(i.center.lat),he),L=se*C/fe,R*=ve,L*=ve}}else R=D;r.a6.scale(t,t,[R,R,L]);let j=[...t],Z=e.orientation,K=[];if(_T(K,[Z[0]+s[0],Z[1]+s[1],Z[2]+s[2]],l),r.a6.multiply(t,j,K),f&&i.elevation){let Y=0,ne=[];if(y&&i.elevation){Y=function(he,fe,ve,_e,Se){let ze=fe.elevation;if(!ze)return 0;let ke=An.projectAabbCorners(ve,_e),Re=qt(1,Se.lat)*fe.worldSize,we=function(Pt,Qt){let Ot=[0,0,1],Jt=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(let Vt of Jt){let _i=Pt[Vt.corners[0]],Ht=Pt[Vt.corners[1]],en=Pt[Vt.corners[2]],Ci=[Ht[0]-_i[0],Ht[1]-_i[1],Qt*(Ht[2]-_i[2])],Ei=r.N.cross(Ci,Ci,[en[0]-_i[0],en[1]-_i[1],Qt*(en[2]-_i[2])]);r.N.normalize(Ei,Ei),Vt.dotProductWithUp=r.N.dot(Ei,Ot)}return Jt.sort((Vt,_i)=>Vt.dotProductWithUp-_i.dotProductWithUp),Jt[0].corners}(ke,Re),Pe=ke[we[0]],et=ke[we[1]],Fe=ke[we[2]],ft=ke[we[3]],dt=ze.getAtPointOrZero(new Ii(Pe[0]/fe.worldSize,Pe[1]/fe.worldSize),0),je=ze.getAtPointOrZero(new Ii(et[0]/fe.worldSize,et[1]/fe.worldSize),0),zt=ze.getAtPointOrZero(new Ii(Fe[0]/fe.worldSize,Fe[1]/fe.worldSize),0),wt=ze.getAtPointOrZero(new Ii(ft[0]/fe.worldSize,ft[1]/fe.worldSize),0),pt=(dt+wt)/2,Ve=(je+zt)/2;return pt>Ve?je<zt?H_(he,et,ft,Pe,je,wt,dt,Re):H_(he,Fe,Pe,ft,zt,dt,wt,Re):dt<wt?H_(he,Pe,et,Fe,dt,je,zt,Re):H_(he,ft,Fe,et,wt,zt,je,Re),Math.max(pt,Ve)}(ne,i,e.aabb,t,o);let te=r.a6.fromQuat([],ne),se=r.a6.multiply([],te,K);r.a6.multiply(t,j,se)}else Y=i.elevation.getAtPointOrZero(new Ii(I.x/B,I.y/B),0);Y!==0&&(t[14]+=Y)}}function Jm(t,e,i=!1){t.uploaded||(t.gfxTexture=new Ly(e,t.image,i?e.gl.R8:e.gl.RGBA,{useMipmap:t.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),t.uploaded=!0,t.image=null)}function dA(t,e,i){t.indexBuffer=e.createIndexBuffer(t.indexArray,!1,!0),t.vertexBuffer=e.createVertexBuffer(t.vertexArray,tA.members,!1,!0),t.normalArray&&(t.normalBuffer=e.createVertexBuffer(t.normalArray,oA.members,!1,!0)),t.texcoordArray&&(t.texcoordBuffer=e.createVertexBuffer(t.texcoordArray,rA.members,!1,!0)),t.colorArray&&(t.colorBuffer=e.createVertexBuffer(t.colorArray,(t.colorArray.bytesPerElement===12?iA:nA).members,!1,!0)),t.featureArray&&(t.pbrBuffer=e.createVertexBuffer(t.featureArray,sA.members,!0)),t.segments=Rn.simpleSegment(0,0,t.vertexArray.length,t.indexArray.length);let o=t.material;o.pbrMetallicRoughness.baseColorTexture&&Jm(o.pbrMetallicRoughness.baseColorTexture,e),o.pbrMetallicRoughness.metallicRoughnessTexture&&Jm(o.pbrMetallicRoughness.metallicRoughnessTexture,e),o.normalTexture&&Jm(o.normalTexture,e),o.occlusionTexture&&Jm(o.occlusionTexture,e,i),o.emissionTexture&&Jm(o.emissionTexture,e)}function By(t,e,i){if(t.meshes)for(let o of t.meshes)dA(o,e,i);if(t.children)for(let o of t.children)By(o,e,i)}function Z_(t){if(t.meshes)for(let e of t.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(t.children)for(let e of t.children)Z_(e)}function Ny(t){if(t.meshes)for(let i of t.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(t.children)for(let i of t.children)Ny(i)}class hA{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class uA{constructor(){this.tasks={},this.taskQueue=[],zs(["process"],this),this.invoker=new hA(this.process),this.nextId=0}add(e,i){let o=this.nextId++,s=function({type:l,isSymbolTile:h,zoom:f}){return f=f||0,l==="message"?0:l!=="maybePrepare"||h?l!=="parseTile"||h?l==="parseTile"&&h?300-f:l==="maybePrepare"&&h?400-f:500:200-f:100-f}(i);if(s===0){pa();try{e()}finally{}return null}return this.tasks[o]={fn:e,metadata:i,priority:s,id:o},this.taskQueue.push(o),this.invoker.trigger(),{cancel:()=>{delete this.tasks[o]}}}process(){pa();try{if(this.taskQueue=this.taskQueue.filter(o=>!!this.tasks[o]),!this.taskQueue.length)return;let e=this.pick();if(e===null)return;let i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let s=0;s<this.taskQueue.length;s++){let l=this.tasks[this.taskQueue[s]];l.priority<i&&(i=l.priority,e=s)}if(e===null)return null;let o=this.taskQueue[e];return this.taskQueue.splice(e,1),o}remove(){this.invoker.remove()}}class xT{constructor(e,i,o){this.target=e,this.parent=i,this.mapId=o,this.callbacks={},this.cancelCallbacks={},zs(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new uA}send(e,i,o,s,l=!1,h){let f=Math.round(1e18*Math.random()).toString(36).substring(0,10);o&&(o.metadata=h,this.callbacks[f]=o);let y=new Set;return this.target.postMessage({id:f,type:e,hasCallback:!!o,targetMapId:s,mustQueue:l,sourceMapId:this.mapId,data:cs(i,y)},y),{cancel:()=>{o&&delete this.callbacks[f],this.target.postMessage({id:f,type:"<cancel>",targetMapId:s,sourceMapId:this.mapId})}}}receive(e){let i=e.data,o=i.id;if(o&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){let s=this.cancelCallbacks[o];delete this.cancelCallbacks[o],s&&s.cancel()}else if(i.mustQueue||pa()){let s=this.callbacks[o],l=this.scheduler.add(()=>this.processTask(o,i),s&&s.metadata||{type:"message"});l&&(this.cancelCallbacks[o]=l)}else this.processTask(o,i)}processTask(e,i){if(delete this.cancelCallbacks[e],i.type==="<response>"){let o=this.callbacks[e];delete this.callbacks[e],o&&(i.error?o(Xs(i.error)):o(null,Xs(i.data)))}else{let o=new Set,s=i.hasCallback?(h,f)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:h?cs(h):null,data:cs(f,o)},o)}:h=>{},l=Xs(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,l,s);else if(this.parent.getWorkerSource){let h=i.type.split(".");this.parent.getWorkerSource(i.sourceMapId,h[0],l.source,l.scope)[h[1]](l,s)}else s(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}let jy=(()=>{class t{constructor(i,o){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=pl();let s=this.workerPool.acquire(this.id);for(let l=0;l<s.length;l++){let h=new t.Actor(s[l],o,this.id);h.name=`Worker ${l}`,this.actors.push(h)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(i,o,s){Zo(this.actors,(l,h)=>{l.send(i,o,h)},s=s||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(i=>{i.remove()}),this.actors=[],this.workerPool.release(this.id)}}return t.Actor=xT,t})();var ep={workerUrl:"",workerClass:null,workerParams:void 0};function mA(){return ep.workerClass!=null?new ep.workerClass:new self.Worker(ep.workerUrl,ep.workerParams)}let Vy="mapboxgl_preloaded_worker_pool";class tp{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<tp.workerCount;)this.workers.push(new mA);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Vy]}numActive(){return Object.keys(this.active).length}}let ip;function W_(){return ip||(ip=new tp),ip}tp.workerCount=2;let X_,Uy,Va,Ih,Gy,Sh=null;function wT(){return pa()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:Uy||q.DRACO_URL}function TT(){if(pa()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Ih)return Ih;let t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Ih=WebAssembly.validate(t)?q.MESHOPT_SIMD_URL:q.MESHOPT_URL,Ih}let Y_={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},pA={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},np={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function kT(t,e,i){let o=i.json.bufferViews.length,s=i.buffers.length;e.bufferView=o,i.json.bufferViews[o]={buffer:s,byteLength:t.byteLength},i.buffers[s]=t}let $y="KHR_draco_mesh_compression";function fA(t,e){let i=t.extensions&&t.extensions[$y];if(!i)return;let o=new Va.Decoder,s=MT(e,i.bufferView),l=new Va.Mesh;if(!o.DecodeArrayToMesh(s,s.byteLength,l))throw new Error("Failed to decode Draco mesh");let h=e.json.accessors[t.indices],f=Y_[h.componentType],y=h.count*f.BYTES_PER_ELEMENT,b=Va._malloc(y);f===Uint16Array?o.GetTrianglesUInt16Array(l,y,b):o.GetTrianglesUInt32Array(l,y,b),kT(Va.memory.buffer.slice(b,b+y),h,e),Va._free(b);for(let T of Object.keys(i.attributes)){let I=o.GetAttributeByUniqueId(l,i.attributes[T]),C=e.json.accessors[t.attributes[T]],D=pA[C.componentType],R=C.count*np[C.type]*Y_[C.componentType].BYTES_PER_ELEMENT,L=Va._malloc(R);o.GetAttributeDataArrayForAllPoints(l,I,Va[D],R,L),kT(Va.memory.buffer.slice(L,L+R),C,e),Va._free(L)}o.destroy(),l.destroy(),delete t.extensions[$y]}let K_="EXT_meshopt_compression";function _A(t,e){if(!t.extensions||!t.extensions[K_])return;let i=t.extensions[K_],o=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),s=new Uint8Array(i.count*i.byteStride);Gy.decodeGltfBuffer(s,i.count,i.byteStride,o,i.mode,i.filter),t.buffer=e.buffers.length,t.byteOffset=0,e.buffers[t.buffer]=s.buffer,delete t.extensions[K_]}let IT=1179937895,ST=new TextDecoder("utf8");function CT(t,e){return new URL(t,e).href}function gA(t,e,i,o){return fetch(CT(t.uri,o)).then(s=>s.arrayBuffer()).then(s=>{e.buffers[i]=s})}function MT(t,e){let i=t.json.bufferViews[e];return new Uint8Array(t.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function yA(t,e,i,o){if(t.uri){let s=CT(t.uri,o);return fetch(s).then(l=>l.blob()).then(l=>createImageBitmap(l)).then(l=>{e.images[i]=l})}if(t.bufferView!==void 0){let s=MT(e,t.bufferView),l=new Blob([s],{type:t.mimeType});return createImageBitmap(l).then(h=>{e.images[i]=h})}}function ET(t,e=0,i){let o={json:null,images:[],buffers:[]};if(new Uint32Array(t,e,1)[0]===IT){let T=new Uint32Array(t,e),I=2,C=(T[I++]>>2)-3,D=T[I++]>>2;if(I++,o.json=JSON.parse(ST.decode(T.subarray(I,I+D))),I+=D,I<C){let R=T[I++];I++;let L=e+(I<<2);o.buffers[0]=t.slice(L,L+R)}}else o.json=JSON.parse(ST.decode(new Uint8Array(t,e)));let{buffers:s,images:l,meshes:h,extensionsUsed:f,bufferViews:y}=o.json,b=Promise.resolve();if(s){let T=[];for(let I=0;I<s.length;I++){let C=s[I];C.uri?T.push(gA(C,o,I,i)):o.buffers[I]||(o.buffers[I]=null)}b=Promise.all(T)}return b.then(()=>{let T=[],I=f&&f.includes($y),C=f&&f.includes(K_);if(I&&T.push(function(){if(!Va)return X_||(X_=function(D){let R,L=null;function B(){R=new Uint8Array(L.buffer)}function j(){throw new Error("Unexpected Draco error.")}let Z={a:{a:j,d:function(K,Y,ne){return R.copyWithin(K,Y,Y+ne)},c:function(K){let Y=R.length,ne=Math.max(K>>>0,Math.ceil(1.2*Y)),te=Math.ceil((ne-Y)/65536);try{return L.grow(te),B(),!0}catch{return!1}},b:j}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(D,Z):D.then(K=>K.arrayBuffer()).then(K=>WebAssembly.instantiate(K,Z))).then(K=>{let{Rb:Y,Qb:ne,P:te,T:se,X:he,Ja:fe,La:ve,Qa:_e,Va:Se,Wa:ze,eb:ke,jb:Re,f:we,e:Pe,yb:et,zb:Fe,Ab:ft,Bb:dt,Db:je,Gb:zt}=K.instance.exports;L=Pe;let wt=(()=>{let pt=0,Ve=0,Pt=0,Qt=0;return Ot=>{Pt&&(Y(Qt),Y(pt),Ve+=Pt,Pt=pt=0),pt||(Ve+=128,pt=ne(Ve));let Jt=Ot.length+7&-8,Vt=pt;Jt>=Ve&&(Pt=Jt,Vt=Qt=ne(Jt));for(let _i=0;_i<Ot.length;_i++)R[Vt+_i]=Ot[_i];return Vt}})();return B(),we(),{memory:Pe,_free:Y,_malloc:ne,Mesh:class{constructor(){this.ptr=te()}destroy(){se(this.ptr)}},Decoder:class{constructor(){this.ptr=fe()}destroy(){Re(this.ptr)}DecodeArrayToMesh(pt,Ve,Pt){let Qt=wt(pt),Ot=ve(this.ptr,Qt,Ve,Pt.ptr);return!!he(Ot)}GetAttributeByUniqueId(pt,Ve){return{ptr:_e(this.ptr,pt.ptr,Ve)}}GetTrianglesUInt16Array(pt,Ve,Pt){Se(this.ptr,pt.ptr,Ve,Pt)}GetTrianglesUInt32Array(pt,Ve,Pt){ze(this.ptr,pt.ptr,Ve,Pt)}GetAttributeDataArrayForAllPoints(pt,Ve,Pt,Qt,Ot){ke(this.ptr,pt.ptr,Ve.ptr,Pt,Qt,Ot)}},DT_INT8:et(),DT_UINT8:Fe(),DT_INT16:ft(),DT_UINT16:dt(),DT_UINT32:je(),DT_FLOAT32:zt()}})}(fetch(wT())),X_.then(D=>{Va=D,X_=void 0}))}()),C&&T.push(function(){if(Gy)return;let D=function(R){let L,B=WebAssembly.instantiateStreaming(R,{}).then(K=>{L=K.instance,L.exports.__wasm_call_ctors()}),j={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Z={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:B,supported:!0,decodeGltfBuffer(K,Y,ne,te,se,he){(function(fe,ve,_e,Se,ze,ke,Re){let we=fe.exports.sbrk,Pe=Se+3&-4,et=we(Pe*ze),Fe=we(ke.length),ft=new Uint8Array(fe.exports.memory.buffer);ft.set(ke,Fe);let dt=ve(et,Se,ze,Fe,ke.length);if(dt===0&&Re&&Re(et,Pe,ze),_e.set(ft.subarray(et,et+Se*ze)),we(et-we(0)),dt!==0)throw new Error(`Malformed buffer data: ${dt}`)})(L,L.exports[Z[se]],K,Y,ne,te,L.exports[j[he]])}}}(fetch(TT()));return D.ready.then(()=>{Gy=D})}()),l)for(let D=0;D<l.length;D++)T.push(yA(l[D],o,D,i));return(T.length?Promise.all(T):Promise.resolve()).then(()=>{if(I&&h)for(let{primitives:D}of h)for(let R of D)fA(R,o);if(C&&h&&y)for(let D of y)_A(D,o);return o})})}class AT{constructor(e,i,o){if(this.triangleCount=i.length/3,this.min=new nt(0,0),this.max=new nt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0||o===0)return;let s=e.map(T=>T.x),l=e.map(T=>T.y);this.min=new nt(Math.min(...s),Math.min(...l)),this.max=new nt(Math.max(...s),Math.max(...l));let h=this.max.sub(this.min);h.x=Math.max(h.x,1),h.y=Math.max(h.y,1);let f=Math.max(h.x,h.y)/o;this.cellsX=Math.max(1,Math.ceil(h.x/f)),this.cellsY=Math.max(1,Math.ceil(h.y/f)),this.xScale=1/f,this.yScale=1/f;let y=[];for(let T=0;T<this.triangleCount;T++){let I=e[i[3*T+0]].sub(this.min),C=e[i[3*T+1]].sub(this.min),D=e[i[3*T+2]].sub(this.min),R=Ql(Math.floor(Math.min(I.x,C.x,D.x)),this.xScale,this.cellsX),L=Ql(Math.floor(Math.max(I.x,C.x,D.x)),this.xScale,this.cellsX),B=Ql(Math.floor(Math.min(I.y,C.y,D.y)),this.yScale,this.cellsY),j=Ql(Math.floor(Math.max(I.y,C.y,D.y)),this.yScale,this.cellsY),Z=new nt(0,0),K=new nt(0,0),Y=new nt(0,0),ne=new nt(0,0);for(let te=B;te<=j;++te){Z.y=K.y=te*f,Y.y=ne.y=(te+1)*f;for(let se=R;se<=L;++se)Z.x=Y.x=se*f,K.x=ne.x=(se+1)*f,(B0(I,C,D,Z,K,ne)||B0(I,C,D,Z,ne,Y))&&y.push({cellIdx:te*this.cellsX+se,triIdx:T})}}if(y.length===0)return;y.sort((T,I)=>T.cellIdx-I.cellIdx||T.triIdx-I.triIdx);let b=0;for(;b<y.length;){let T=y[b].cellIdx,I={start:this.payload.length,len:0};for(;b<y.length&&y[b].cellIdx===T;)++I.len,this.payload.push(y[b++].triIdx);this.cells[T]=I}}query(e,i,o){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let y=0;y<this.lookup.length;y++)this.lookup[y]=0;let s=Ql(e.x-this.min.x,this.xScale,this.cellsX),l=Ql(i.x-this.min.x,this.xScale,this.cellsX),h=Ql(e.y-this.min.y,this.yScale,this.cellsY),f=Ql(i.y-this.min.y,this.yScale,this.cellsY);for(let y=h;y<=f;y++)for(let b=s;b<=l;b++){let T=this.cells[y*this.cellsX+b];if(T)for(let I=0;I<T.len;I++){let C=this.payload[T.start+I],D=Math.floor(C/8),R=1<<C%8;if(!(this.lookup[D]&R)&&(this.lookup[D]|=R,o.push(C),o.length===this.triangleCount))return}}}}function Ql(t,e,i){return Math.max(0,Math.min(i-1,Math.floor(t*e)))}function ud(t,e){let i=t.json.bufferViews[e.bufferView],o=Y_[e.componentType];return new o(t.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==np[e.type]*o.BYTES_PER_ELEMENT?i.byteStride/o.BYTES_PER_ELEMENT:np[e.type]))}function qy(t,e,i,o){let s=Y_[e.componentType],l=function(T){switch(T){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(s),h=t.json.bufferViews[e.bufferView],f=h.byteStride?h.byteStride/s.BYTES_PER_ELEMENT:np[e.type],y=i.float32,b=y.length/i.capacity;for(let T=0,I=0;T<e.count*f;T+=f,I+=b)for(let C=0;C<b;C++)y[I+C]=o[T+C]*l;i._trim()}function bA(t,e,i){let o=t.indices,s=t.attributes,l={};l.indexArray=new hr;let h=e.json.accessors[o],f=h.count/3;l.indexArray.reserve(f);let y=ud(e,h);for(let C=0;C<f;C++)l.indexArray.emplaceBack(y[3*C],y[3*C+1],y[3*C+2]);l.indexArray._trim(),l.vertexArray=new Qs;let b=e.json.accessors[s.POSITION];l.vertexArray.reserve(b.count);let T=ud(e,b);for(let C=0;C<b.count;C++)l.vertexArray.emplaceBack(T[3*C],T[3*C+1],T[3*C+2]);if(l.vertexArray._trim(),l.aabb=new An(b.min,b.max),l.centroid=function(C,D){let R=[0,0,0],L=C.length;if(L>0){for(let B=0;B<L;B++){let j=3*C[B];R[0]+=D[j],R[1]+=D[j+1],R[2]+=D[j+2]}R[0]/=L,R[1]/=L,R[2]/=L}return R}(y,T),s.COLOR_0!==void 0){let C=e.json.accessors[s.COLOR_0],D=np[C.type],R=ud(e,C);l.colorArray=D===3?new Qs:new ms,l.colorArray.resize(C.count),qy(e,C,l.colorArray,R)}if(s.NORMAL!==void 0){l.normalArray=new Qs;let C=e.json.accessors[s.NORMAL];l.normalArray.resize(C.count);let D=ud(e,C);qy(e,C,l.normalArray,D)}if(s.TEXCOORD_0!==void 0&&i.length>0){l.texcoordArray=new Jc;let C=e.json.accessors[s.TEXCOORD_0];l.texcoordArray.resize(C.count);let D=ud(e,C);qy(e,C,l.texcoordArray,D)}if(s._FEATURE_ID_RGBA4444!==void 0){let C=e.json.accessors[s._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(l.featureData=ud(e,C))}s._FEATURE_RGBA4444!==void 0&&(l.featureData=new Uint32Array(ud(e,e.json.accessors[s._FEATURE_RGBA4444]).buffer));let I=t.material;return l.material=function(C,D){let{emissiveFactor:R=[0,0,0],alphaMode:L="OPAQUE",alphaCutoff:B=.5,normalTexture:j,occlusionTexture:Z,emissiveTexture:K,doubleSided:Y}=C,{baseColorFactor:ne=[1,1,1,1],metallicFactor:te=1,roughnessFactor:se=1,baseColorTexture:he,metallicRoughnessTexture:fe}=C.pbrMetallicRoughness||{},ve=Z?D[Z.index]:void 0;if(Z&&Z.extensions&&Z.extensions.KHR_texture_transform&&ve){let _e=Z.extensions.KHR_texture_transform;ve.offsetScale=[_e.offset[0],_e.offset[1],_e.scale[0],_e.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Wn(...ne),metallicFactor:te,roughnessFactor:se,baseColorTexture:he?D[he.index]:void 0,metallicRoughnessTexture:fe?D[fe.index]:void 0},doubleSided:Y,emissiveFactor:R,alphaMode:L,alphaCutoff:B,normalTexture:j?D[j.index]:void 0,occlusionTexture:ve,emissionTexture:K?D[K.index]:void 0,defined:C.defined===void 0}}(I!==void 0?e.json.materials[I]:{defined:!1},i),l}function DT(t,e,i){let{matrix:o,rotation:s,translation:l,scale:h,mesh:f,extras:y,children:b}=t,T={};if(T.matrix=o||r.a6.fromRotationTranslationScale([],s||[0,0,0,1],l||[0,0,0],h||[1,1,1]),f!==void 0){T.meshes=i[f];let I=T.anchor=[0,0];for(let C of T.meshes){let{min:D,max:R}=C.aabb;I[0]+=D[0]+R[0],I[1]+=D[1]+R[1]}I[0]=Math.floor(I[0]/T.meshes.length/2),I[1]=Math.floor(I[1]/T.meshes.length/2)}if(y&&(y.id&&(T.id=y.id),y.lights&&(T.lights=function(I){if(!I.length)return[];let C=function(j){let Z=atob(j),K=new Uint8Array(Z.length);for(let Y=0;Y<Z.length;Y++)K[Y]=Z.codePointAt(Y);return K}(I),D=[],R=C.length/24,L=new Uint16Array(C.buffer),B=new Float32Array(C.buffer);for(let j=0;j<R;j++){let Z=L[2*j*6]/30,K=L[2*j*6+1]/30,Y=L[2*j*6+10]/100,ne=B[6*j+1],te=B[6*j+2],se=B[6*j+3],he=B[6*j+4],fe=se-ne,ve=he-te,_e=Math.hypot(fe,ve);D.push({pos:[ne+.5*fe,te+.5*ve,K],normal:[ve/_e,-fe/_e,0],width:_e,height:Z,depth:Y,points:[ne,te,se,he]})}return D}(y.lights))),b){let I=[];for(let C of b)I.push(DT(e.json.nodes[C],e,i));T.children=I}return T}function vA(t){if(t.vertices.length===0||t.indices.length===0)return null;let[e,i]=[t.vertices[0].clone(),t.vertices[0].clone()];for(let h=1;h<t.vertices.length;++h){let f=t.vertices[h];e.x=Math.min(e.x,f.x),e.y=Math.min(e.y,f.y),i.x=Math.max(i.x,f.x),i.y=Math.max(i.y,f.y)}let o=Math.ceil(Math.max(i.x-e.x,i.y-e.y)/256),s=Math.max(8,o),l=new AT(t.vertices,t.indices,s);return{vertices:t.vertices,indices:t.indices,grid:l,min:e,max:i}}function xA(t){if(!t.extras||!t.extras.ground)return null;let e=t.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;let i=e[0];if(!i||!Array.isArray(i)||i.length===0)return null;let o=[];for(let h of i){if(!Array.isArray(h)||h.length!==2)continue;let f=h[0],y=h[1];typeof f=="number"&&typeof y=="number"&&o.push(new nt(f,y))}if(o.length<3)return null;o.length>1&&o[o.length-1].equals(o[0])&&o.pop();let s=0;for(let h=0;h<o.length;h++){let f=o[h],y=o[(h+1)%o.length],b=o[(h+2)%o.length];s+=(f.x-y.x)*(b.y-y.y)-(b.x-y.x)*(f.y-y.y)}s>0&&o.reverse();let l=y_(o.flatMap(h=>[h.x,h.y]),[]);return l.length===0?null:{vertices:o,indices:l}}function wA(t){let e=[],i=[],o=0;for(let s of t){o=e.length;let l=s.vertexArray.float32,h=s.indexArray.uint16;for(let f=0;f<s.vertexArray.length;f++)e.push(new nt(l[3*f+0],l[3*f+1]));for(let f=0;f<3*s.indexArray.length;f++)i.push(h[f]+o)}if(i.length%3!=0)return null;for(let s=0;s<i.length;s+=3){let l=e[i[s+0]],h=e[i[s+1]],f=e[i[s+2]];(l.x-h.x)*(f.y-h.y)-(f.x-h.x)*(l.y-h.y)>0&&([i[s+1],i[s+2]]=[i[s+2],i[s+1]])}return{vertices:e,indices:i}}function PT(t){let e=function(y,b){let T=[],I=WebGL2RenderingContext;if(y.json.textures)for(let C of y.json.textures){let D={magFilter:I.LINEAR,minFilter:I.NEAREST,wrapS:I.REPEAT,wrapT:I.REPEAT};C.sampler!==void 0&&Object.assign(D,y.json.samplers[C.sampler]),T.push({image:b[C.source],sampler:D,uploaded:!1})}return T}(t,t.images),i=function(y,b){let T=[];for(let I of y.json.meshes){let C=[];for(let D of I.primitives)C.push(bA(D,y,b));T.push(C)}return T}(t,e),{scenes:o,scene:s,nodes:l}=t.json,h=o?o[s||0].nodes:l,f=[];for(let y of h)f.push(DT(l[y],t,i));return function(y,b,T){let I={},C=new Set;for(let D=0;D<y.length;D++){let R=T[b[D]];if(!R.extras)continue;let L=R.extras["mapbox:footprint:version"],B=R.extras["mapbox:footprint:id"];(L||B)&&C.add(D),L==="1.0.0"&&B&&(I[B]=D)}for(let D=0;D<y.length;D++){if(C.has(D))continue;let R=y[D],L=T[b[D]];if(!L.extras)continue;let B=null;R.id in I&&(B=wA(y[I[R.id]].meshes)),B||(B=xA(L)),B&&(R.footprint=vA(B))}if(C.size>0){let D=Array.from(C.values()).sort((R,L)=>R-L);for(let R=D.length-1;R>=0;R--)y.splice(D[R],1)}}(f,h,t.json.nodes),f}function TA(t){t.heightmap=new Float32Array(4096),t.heightmap.fill(-1);let e=t.vertexArray.float32,i=t.aabb.min[0]-1,o=t.aabb.min[1]-1,s=hd/(t.aabb.max[0]-i+2),l=hd/(t.aabb.max[1]-o+2);for(let h=0;h<e.length;h+=3){let f=e[h+2],y=(e[h+0]-i)*s|0,b=(e[h+1]-o)*l|0;f>t.heightmap[b*hd+y]&&(t.heightmap[b*hd+y]=f)}}function kA(t,e){let i={};i.indexArray=new hr,i.indexArray.reserve(4*t.length),i.vertexArray=new Qs,i.vertexArray.reserve(10*t.length),i.colorArray=new ms,i.vertexArray.reserve(10*t.length);let o=0;for(let h of t){let f=Math.min(10,Math.max(4,1.3*h.height))*e,y=[-h.normal[1],h.normal[0],0],b=Math.min(.29,.1*h.width/h.depth),T=h.width-2*h.depth*e*(b+.01),I=r.N.scaleAndAdd([],h.pos,y,T/2),C=r.N.scaleAndAdd([],h.pos,y,-T/2),D=[I[0],I[1],I[2]+h.height],R=[C[0],C[1],C[2]+h.height],L=r.N.scaleAndAdd([],h.normal,y,b);r.N.scale(L,L,f);let B=r.N.scaleAndAdd([],h.normal,y,-b);r.N.scale(B,B,f),r.N.add(L,I,L),r.N.add(B,C,B),I[2]+=.1,C[2]+=.1,i.vertexArray.emplaceBack(L[0],L[1],L[2]),i.vertexArray.emplaceBack(B[0],B[1],B[2]),i.vertexArray.emplaceBack(I[0],I[1],I[2]),i.vertexArray.emplaceBack(C[0],C[1],C[2]),i.vertexArray.emplaceBack(D[0],D[1],D[2]),i.vertexArray.emplaceBack(R[0],R[1],R[2]),i.vertexArray.emplaceBack(I[0],I[1],I[2]),i.vertexArray.emplaceBack(C[0],C[1],C[2]),i.vertexArray.emplaceBack(L[0],L[1],L[2]),i.vertexArray.emplaceBack(B[0],B[1],B[2]);let j=T/f/2;i.colorArray.emplaceBack(-j-b,-1,j,.8),i.colorArray.emplaceBack(j+b,-1,j,.8),i.colorArray.emplaceBack(-j,0,j,1.3),i.colorArray.emplaceBack(j,0,j,1.3),i.colorArray.emplaceBack(j+b,-.8,j,.7),i.colorArray.emplaceBack(j+b,-.8,j,.7),i.colorArray.emplaceBack(0,0,j,1.3),i.colorArray.emplaceBack(0,0,j,1.3),i.colorArray.emplaceBack(j+b,-1.2,j,.8),i.colorArray.emplaceBack(j+b,-1.2,j,.8),i.indexArray.emplaceBack(6+o,4+o,8+o),i.indexArray.emplaceBack(7+o,9+o,5+o),i.indexArray.emplaceBack(0+o,1+o,2+o),i.indexArray.emplaceBack(1+o,3+o,2+o),o+=10}let s={defined:!0,emissiveFactor:[0,0,0]},l={};return l.baseColorFactor=Wn.white,s.pbrMetallicRoughness=l,i.material=s,i.aabb=new An([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}mt(AT,"TriangleGridIndex");class RT{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){let o=e[i];this._stringToNumber[o]=i,this._numberToString[i]=o}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}let IA=["tile","layer","source","sourceLayer","state"];class LT{constructor(e,i,o,s,l){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=o,this._y=s,this.properties=e.properties,this.id=l}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){let e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(let i of IA)this[i]!==void 0&&(e[i]=this[i]);return e}}class zT{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Pa(st,16,0),this.featureIndexArray=new Yf,this.promoteId=i,this.is3DTile=!1}insert(e,i,o,s,l,h=0,f=0){let y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,s,l,h);let b=this.grid;for(let T=0;T<i.length;T++){let I=i[T],C=[1/0,1/0,-1/0,-1/0];for(let D=0;D<I.length;D++){let R=I[D];C[0]=Math.min(C[0],R.x),C[1]=Math.min(C[1],R.y),C[2]=Math.max(C[2],R.x),C[3]=Math.max(C[3],R.y)}f!==0&&(C[0]-=f,C[1]-=f,C[2]+=f,C[3]+=f),C[0]<st&&C[1]<st&&C[2]>=0&&C[3]>=0&&b.insert(y,C[0],C[1],C[2],C[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new gy(new bh(this.rawTileData)).layers,this.sourceLayerCoder=new RT(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(let e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i,o,s){this.loadVTLayers();let l=e.params||{},h=vo(l.filter),f=e.tileResult,y=e.transform,b=f.bufferedTilespaceBounds,T=this.grid.query(b.min.x,b.min.y,b.max.x,b.max.y,(R,L,B,j)=>ix(f.bufferedTilespaceGeometry,R,L,B,j));T.sort(SA);let I=null;y.elevation&&T.length>0&&(I=ph.create(y.elevation,this.tileID));let C={},D;for(let R=0;R<T.length;R++){let L=T[R];if(L===D)continue;D=L;let B=this.featureIndexArray.get(L),j=null;if(this.is3DTile){let Z=this.bucketLayerIDs[0][0],K=i[Z];if(K.type!=="model")continue;let{queryFeature:Y,intersectionZ:ne}=K.queryIntersectsMatchingFeature(f,B.featureIndex,h,y);Y&&this.appendToResult(C,Z,B.featureIndex,Y,ne)}else this.loadMatchingFeature(C,B,h,l.layers,l.availableImages,i,o,s,(Z,K,Y,ne=0)=>(j||(j=mr(Z,this.tileID.canonical,e.tileTransform)),K.queryIntersectsFeature(f,Z,Y,j,this.z,e.transform,e.pixelPosMatrix,I,ne)))}return C}loadMatchingFeature(e,i,o,s,l,h,f,y,b){let{featureIndex:T,bucketIndex:I,sourceLayerIndex:C,layoutVertexArrayOffset:D}=i,R=this.bucketLayerIDs[I];if(s&&!function(Z,K){for(let Y=0;Y<Z.length;Y++)if(K.indexOf(Z[Y])>=0)return!0;return!1}(s,R))return;let L=this.sourceLayerCoder.decode(C),B=this.vtLayers[L].feature(T);if(o.needGeometry){let Z=tr(B,!0);if(!o.filter(new yn(this.tileID.overscaledZ),Z,this.tileID.canonical))return}else if(!o.filter(new yn(this.tileID.overscaledZ),B))return;let j=this.getId(B,L);for(let Z=0;Z<R.length;Z++){let K=R[Z];if(s&&s.indexOf(K)<0)continue;let Y=h[K];if(!Y)continue;let ne={};j!==void 0&&y&&(ne=y.getState(Y.sourceLayer||"_geojsonTileLayer",j));let te=!b||b(B,Y,ne,D);if(!te)continue;let se=new LT(B,this.z,this.x,this.y,j),he=Er({},f[K]);he.paint=OT(he.paint,Y.paint,B,ne,l),he.layout=OT(he.layout,Y.layout,B,ne,l),se.layer=he,this.appendToResult(e,K,T,se,te)}}appendToResult(e,i,o,s,l){let h=e[i];h===void 0&&(h=e[i]=[]),h.push({featureIndex:o,feature:s,intersectionZ:l})}lookupSymbolFeatures(e,i,o,s,l,h,f,y){let b={};this.loadVTLayers();let T=vo(l);for(let I of e)this.loadMatchingFeature(b,{bucketIndex:o,sourceLayerIndex:s,featureIndex:I,layoutVertexArrayOffset:0},T,h,f,y,i);return b}loadFeature(e){let{featureIndex:i,sourceLayerIndex:o}=e;this.loadVTLayers();let s=this.sourceLayerCoder.decode(o),l=this.vtFeatures[s];if(l[i])return l[i];let h=this.vtLayers[s].feature(i);return l[i]=h,h}hasLayer(e){for(let i of this.bucketLayerIDs)for(let o of i)if(e===o)return!0;return!1}getId(e,i){let o=e.id;if(this.promoteId){let s=typeof this.promoteId=="string"?this.promoteId:this.promoteId[i];s!=null&&(o=e.properties[s]),typeof o=="boolean"&&(o=Number(o))}return o}}function OT(t,e,i,o,s){return Ar(t,(l,h)=>{let f=e instanceof Vc?e.get(h):null;return f&&f.evaluate?f.evaluate(i,o,s):f})}function SA(t,e){return e-t}mt(zT,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});let Hy=new Float32Array(262144),md=new Uint8Array(262144);function FT(t){let e=0;if(t.meshes)for(let i of t.meshes)e=Math.max(e,i.aabb.max[2]);if(t.children)for(let i of t.children)e=Math.max(e,FT(i));return e}function BT(t,e,i){if(t.meshes)for(let o of t.meshes)o.aabb.min[0]!==1/0&&i.insert(e,o.aabb.min[0],o.aabb.min[1],o.aabb.max[0],o.aabb.max[1]);if(t.children)for(let o of t.children)BT(o,e,i)}let NT=["","wall","door","roof","window","lamp","logo"];class jT{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:FT(e)}}}getLocalBounds(){if(!this.node.meshes)return new An([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0,i=new An([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(let o of this.node.meshes)this.node.lightMeshIndex!==e&&i.encapsulate(o.aabb),e++;this.aabb=i}return this.aabb}}class Q_{constructor(e,i,o,s,l,h){this.id=i,this.modelTraits|=kh.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,o&&(this.modelTraits|=kh.HasMapboxMeshFeatures),s&&(this.modelTraits|=kh.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=l,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(let f of e)this.nodesInfo.push(new jT(f)),BT(f,h.featureIndexArray.length,h.grid),h.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,h.bucketLayerIDs.length-1,0)}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;let i=this.getNodesInfo();for(let o of i){let s=o.node;this.uploaded?this.updatePbrBuffer(s):By(s,e,!0)}for(let o of i)Z_(o.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(let o of e.meshes)o.pbrBuffer&&(o.pbrBuffer.updateData(o.featureArray),i=!0);return i}needsReEvaluation(e,i,o){let s=e.transform.projectionOptions,l=e.style.getBrightness(),h=this.brightness!==l;return!!(!this.uploaded||this.dirty||s.name!==this.projection.name||rp(o.paint.get("model-color").value,h)||rp(o.paint.get("model-color-mix-intensity").value,h)||rp(o.paint.get("model-roughness").value,h)||rp(o.paint.get("model-emissive-strength").value,h)||rp(o.paint.get("model-height-based-emissive-strength-multiplier").value,h))&&(this.projection=s,this.brightness=l,!0)}evaluateScale(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;let o=this.getNodesInfo(),s=this.id.canonical;for(let l of o){let h=l.feature;l.evaluatedScale=i.paint.get("model-scale").evaluate(h,{},s)}}evaluate(e){let i=this.getNodesInfo();for(let o of i){if(!o.node.meshes)continue;let s=o.feature,l=o.node.meshes&&o.node.meshes[0].featureData,h=o.evaluatedColor[2],f=o.evaluatedRMEA[2],y=this.id.canonical;if(o.hasTranslucentParts=!1,l){for(let b=0;b<NT.length;b++){let T=NT[b];T.length&&(s.properties.part=T);let I=e.paint.get("model-color").evaluate(s,{},y),C=e.paint.get("model-color-mix-intensity").evaluate(s,{},y);o.evaluatedColor[b]=[I.r,I.g,I.b,C],o.evaluatedRMEA[b][0]=e.paint.get("model-roughness").evaluate(s,{},y),o.evaluatedRMEA[b][2]=e.paint.get("model-emissive-strength").evaluate(s,{},y),o.evaluatedRMEA[b][3]=I.a,o.emissionHeightBasedParams[b]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(s,{},y),!o.hasTranslucentParts&&I.a<1&&(o.hasTranslucentParts=!0)}delete s.properties.part,MA(o,h!==o.evaluatedColor[2]||f!==o.evaluatedRMEA[2],this.modelTraits)}else o.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(s,{},y);o.evaluatedScale=e.paint.get("model-scale").evaluate(s,{},y),this.updatePbrBuffer(o.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,o,s){let l=e.findDEMTileFor(o);if(l&&(l.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(l.dem&&l.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=l.tileID.overscaledZ;let h=ph.create(e,o,l);if(!h)return;this.modelTraits&kh.HasMapboxMeshFeatures&&this.updateDEM(e,h,o,s);for(let f of this.getNodesInfo()){let y=f.node;if(!y.footprint||!y.footprint.vertices||!y.footprint.vertices.length)continue;let b=y.footprint.vertices,T=h.getElevationAt(b[0].x,b[0].y,!0,!0);for(let I=1;I<b.length;I++)T=Math.min(T,h.getElevationAt(b[I].x,b[I].y,!0,!0));y.elevation=T}}this.terrainTile=l.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,o,s){let l=i._dem._modifiedForSources[s];if(l===void 0&&(i._dem._modifiedForSources[s]=[],l=i._dem._modifiedForSources[s]),l.includes(o.canonical))return;let h=i._dem.dim;l.push(o.canonical);let f=!1;for(let y of this.getNodesInfo()){let b=y.node;if(!b.footprint||!b.footprint.grid)continue;let T=b.footprint.grid,I=i.tileCoordToPixel(T.min.x,T.min.y),C=i.tileCoordToPixel(T.max.x,T.max.y),D=Math.min(Math.min(h-C.y,I.x),Math.min(I.y,h-C.x));if(D<0)continue;let R=ii(D,2,5),L=Math.max(0,I.x-R),B=Math.max(0,I.y-R),j=Math.min(C.x+R,h-1),Z=Math.min(C.y+R,h-1);for(let te=B;te<=Z;++te)for(let se=L;se<=j;++se)md[te*h+se]=255;let K=0,Y=0;for(let te=0;te<T.cellsY;++te)for(let se=0;se<T.cellsX;++se){if(!T.cells[te*T.cellsX+se])continue;let he=i.tileCoordToPixel(T.min.x+se/T.xScale,T.min.y+te/T.yScale),fe=i.tileCoordToPixel(T.min.x+(se+1)/T.xScale,T.min.y+(te+1)/T.yScale);for(let ve=he.y;ve<=Math.min(fe.y+1,h-1);++ve)for(let _e=he.x;_e<=Math.min(fe.x+1,h-1);++_e)md[ve*h+_e]===255&&(md[ve*h+_e]=0,K+=i.getElevationAtPixel(_e,ve),Y++)}let ne=K/Y;L=Math.max(1,I.x-R),B=Math.max(1,I.y-R),j=Math.min(C.x+R,h-2),Z=Math.min(C.y+R,h-2),f=!0;for(let te=B;te<=Z;++te)for(let se=L;se<=j;++se)md[te*h+se]===0&&(Hy[te*h+se]=i._dem.set(se,te,ne));for(let te=1;te<R;++te){L=Math.max(1,I.x-te),B=Math.max(1,I.y-te),j=Math.min(C.x+te,h-2),Z=Math.min(C.y+te,h-2);for(let se=B;se<=Z;++se)for(let he=L;he<=j;++he){let fe=se*h+he;if(md[fe]===255){let ve=0,_e=0,Se=-1,ze=-1;for(let ke=-1;ke<=1;++ke)for(let Re=-1;Re<=1;++Re){let we=(se+ke)*h+he+Re;if(md[we]>=te)continue;let Pe=Hy[we],et=Math.abs(Pe);et>_e&&(ve=Pe,_e=et,Se=Re,ze=ke)}if(_e>.1){let ke=1-(te+.5*Math.abs(Se*ze))/R,Re=i._dem.get(he,se)+ve*ke,we=i._dem.get(he+Se,se+ze),Pe=i._dem.get(he-Se,se-ze,!0);(Re-we)*(Re-Pe)>0&&(Re=(we+Pe)/2),Hy[fe]=i._dem.set(he,se,Re),md[fe]=te}}}}}f&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=qe.now())}getNodesInfo(){return this.nodesInfo}destroy(){let e=this.getNodesInfo();for(let i of e)Z_(i.node),Ny(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;let o=i.getReplacementRegionsForTile(e.toUnwrapped()),s=this.getNodesInfo();for(let l=0;l<this.nodesInfo.length;l++){let h=s[l].node;s[l].hiddenByReplacement=!!h.footprint&&!o.find(f=>f.footprint===h.footprint)}}getHeightAtTileCoord(e,i){let o=this.getNodesInfo(),s=[];for(let l=0;l<this.nodesInfo.length;l++){let h=o[l],f=h.node.meshes[0];if(e<f.aabb.min[0]||i<f.aabb.min[1]||e>f.aabb.max[0]||i>f.aabb.max[1])continue;let y=(e-f.aabb.min[0])/(f.aabb.max[0]-f.aabb.min[0])*hd|0,b=Math.min(63,(i-f.aabb.min[1])/(f.aabb.max[1]-f.aabb.min[1])*hd|0)*hd+Math.min(63,y);if(!(f.heightmap[b]<0&&h.node.footprint))return h.hiddenByReplacement?void 0:{height:f.heightmap[b],maxHeight:h.feature.properties.height,hidden:!1,verticalScale:h.evaluatedScale[2]};if(h.node.footprint.grid.query(new nt(e,i),new nt(e,i),s),s.length>0)return{height:void 0,maxHeight:h.feature.properties.height,hidden:h.hiddenByReplacement,verticalScale:h.evaluatedScale[2]}}}}function rp(t,e){return!t.isLightConstant&&e}function CA(t,e,i,o,s,l,h,f){let y=(61440&e|(61440&e)>>4)>>8,b=(3840&e|(3840&e)>>4)>>4,T=240&e|(240&e)>>4;i[3]>0&&(y=fi(y,255*i[0],i[3]),b=fi(b,255*i[1],i[3]),T=fi(T,255*i[2],i[3]));let I=y<<8|b,C=T<<8|Math.floor(255*o[3]),D=function(te){let se=ii(te,0,2);return Math.min(Math.round(.5*se*255),255)}(o[2])<<8|15*o[0]<<4|15*o[1],R=ii(s[0],0,1),L=ii(s[1],0,1),B=ii(s[2],0,1),j=ii(s[3],0,1),Z,K,Y,ne;if(R!==L&&h!==l&&L!==R){let te=h-l;K=1/(te*(L-R)),Y=-(l+te*R)/(te*(L-R));let se=ii(s[4],-1,1);ne=Math.pow(10,se),Z=255*B<<8|255*j}else Z=65535,K=0,Y=1,ne=1;if(t.emplaceBack(I,C,D,Z,K,Y,ne),f){let te=f.length;f.clear();for(let se=0;se<te;se++)f.emplaceBack(I,C,D,Z,K,Y,ne)}}function MA(t,e,i){let o=t.node,s=0,l=i&kh.HasMeshoptCompression;for(let h of o.meshes){if(o.lights&&o.lightMeshIndex===s||!h.featureData)continue;h.featureArray=new ed,h.featureArray.reserve(h.featureData.length);let f=e;for(let y of h.featureData){let b=l?65535&y:y>>16&65535,T=l?y>>16&65535:65535&y,I=(15&T)<8?15&T:0,C=t.evaluatedRMEA[I],D=t.evaluatedColor[I],R=t.emissionHeightBasedParams[I],L;if(f&&I===2&&o.lights&&(L=new ed,L.resize(10*o.lights.length)),CA(h.featureArray,b,D,C,R,h.aabb.min[2],h.aabb.max[2],L),L&&f){f=!1;let B=o.meshes[o.lightMeshIndex];B.featureArray=L,B.featureArray._trim()}}h.featureArray._trim(),s++}}function VT(t,e,i,o){let s=1<<t.z;e.lat=yi((o/st+t.y)/s),e.lng=Gt((i/st+t.x)/s)}mt(Q_,"Tiled3dModelBucket",{omit:["layers"]}),mt(jT,"Tiled3dModelFeature");let EA={circle:class extends oo{constructor(t,e,i){super(t,xC,e,i)}createBucket(t){return new lo(t)}queryRadius(t){let e=t;return hh("circle-radius",this,e)+hh("circle-stroke-width",this,e)+o_(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,i,o,s,l,h,f){let y=rx(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),l.angle,t.pixelToTileUnitsFactor),b=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return D1(t,o,l,h,f,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",y,b)}getProgramIds(){return["circle"]}getDefaultProgramParams(t,e){let i=A1(this);return{config:new O(this,e),defines:i,overrideFog:!1}}},heatmap:class extends oo{createBucket(t){return new R1(t)}constructor(t,e,i){super(t,QC,e,i),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Fm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return hh("heatmap-radius",this,t)}queryIntersectsFeature(t,e,i,o,s,l,h,f){let y=this.paint.get("heatmap-radius").evaluate(e,i);return D1(t,o,l,h,f,!0,!0,new nt(0,0),y)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(t,e){return t==="heatmap"?{config:new O(this,e),overrideFog:!1}:{}}},hillshade:class extends oo{constructor(t,e,i){super(t,eM,e,i)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},fill:class extends oo{constructor(t,e,i){super(t,pM,e,i)}getProgramIds(){let t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(t,e){return{config:new O(this,e),overrideFog:!1}}recalculate(t,e){super.recalculate(t,e);let i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new _y(t)}queryRadius(){return o_(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,i,o,s,l){return!t.queryGeometry.isAboveHorizon&&Js(nx(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),l.angle,t.pixelToTileUnitsFactor),o)}isTileClipped(){return!0}},"fill-extrusion":class extends oo{constructor(t,e,i){super(t,UM,e,i),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new I_(t)}queryRadius(){return o_(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(t,e,i,o,s,l,h,f,y){let b=rx(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),l.angle,t.pixelToTileUnitsFactor),T=this.paint.get("fill-extrusion-height").evaluate(e,i),I=this.paint.get("fill-extrusion-base").evaluate(e,i),C=[0,0],D=f&&l.elevation,R=l.elevation?l.elevation.exaggeration():1,L=t.tile.getBucket(this);if(D&&L instanceof I_){let Y=L.centroidVertexArray,ne=y+1;ne<Y.length&&(C[0]=Y.geta_centroid_pos0(ne),C[1]=Y.geta_centroid_pos1(ne))}if(C[0]===0&&C[1]===1)return!1;l.projection.name==="globe"&&(o=pw([o],[new nt(0,0),new nt(st,st)],t.tileID.canonical).map(Y=>Y.polygon).flat());let B=D?f:null,[j,Z]=function(Y,ne,te,se,he,fe,ve,_e,Se,ze,ke){return Y.projection.name==="globe"?function(Re,we,Pe,et,Fe,ft,dt,je,zt,wt,pt){let Ve=[],Pt=[],Qt=Re.projection.upVectorScale(pt,Re.center.lat,Re.worldSize).metersToTile,Ot=[0,0,0,1],Jt=[0,0,0,1],Vt=(Ht,en,Ci,Ei)=>{Ht[0]=en,Ht[1]=Ci,Ht[2]=Ei,Ht[3]=1},_i=mw();Pe>0&&(Pe+=_i),et+=_i;for(let Ht of we){let en=[],Ci=[];for(let Ei of Ht){let Oi=Ei.x+Fe.x,Mi=Ei.y+Fe.y,pn=Re.projection.projectTilePoint(Oi,Mi,pt),$i=Re.projection.upVector(pt,Ei.x,Ei.y),Ln=Pe,ar=et;if(dt){let Cr=_w(Oi,Mi,Pe,et,dt,je,zt,wt);Ln+=Cr.base,ar+=Cr.top}Pe!==0?Vt(Ot,pn.x+$i[0]*Qt*Ln,pn.y+$i[1]*Qt*Ln,pn.z+$i[2]*Qt*Ln):Vt(Ot,pn.x,pn.y,pn.z),Vt(Jt,pn.x+$i[0]*Qt*ar,pn.y+$i[1]*Qt*ar,pn.z+$i[2]*Qt*ar),r.N.transformMat4(Ot,Ot,ft),r.N.transformMat4(Jt,Jt,ft),en.push(new fh(Ot[0],Ot[1],Ot[2])),Ci.push(new fh(Jt[0],Jt[1],Jt[2]))}Ve.push(en),Pt.push(Ci)}return[Ve,Pt]}(Y,ne,te,se,he,fe,ve,_e,Se,ze,ke):ve?function(Re,we,Pe,et,Fe,ft,dt,je,zt){let wt=[],pt=[],Ve=[0,0,0,1];for(let Pt of Re){let Qt=[],Ot=[];for(let Jt of Pt){let Vt=Jt.x+et.x,_i=Jt.y+et.y,Ht=_w(Vt,_i,we,Pe,ft,dt,je,zt);Ve[0]=Vt,Ve[1]=_i,Ve[2]=Ht.base,Ve[3]=1,r.a7.transformMat4(Ve,Ve,Fe),Ve[3]=Math.max(Ve[3],1e-5);let en=new fh(Ve[0]/Ve[3],Ve[1]/Ve[3],Ve[2]/Ve[3]);Ve[0]=Vt,Ve[1]=_i,Ve[2]=Ht.top,Ve[3]=1,r.a7.transformMat4(Ve,Ve,Fe),Ve[3]=Math.max(Ve[3],1e-5);let Ci=new fh(Ve[0]/Ve[3],Ve[1]/Ve[3],Ve[2]/Ve[3]);Qt.push(en),Ot.push(Ci)}wt.push(Qt),pt.push(Ot)}return[wt,pt]}(ne,te,se,he,fe,ve,_e,Se,ze):function(Re,we,Pe,et,Fe){let ft=[],dt=[],je=Fe[8]*we,zt=Fe[9]*we,wt=Fe[10]*we,pt=Fe[11]*we,Ve=Fe[8]*Pe,Pt=Fe[9]*Pe,Qt=Fe[10]*Pe,Ot=Fe[11]*Pe;for(let Jt of Re){let Vt=[],_i=[];for(let Ht of Jt){let en=Ht.x+et.x,Ci=Ht.y+et.y,Ei=Fe[0]*en+Fe[4]*Ci+Fe[12],Oi=Fe[1]*en+Fe[5]*Ci+Fe[13],Mi=Fe[2]*en+Fe[6]*Ci+Fe[14],pn=Fe[3]*en+Fe[7]*Ci+Fe[15],$i=Ei+je,Ln=Oi+zt,ar=Mi+wt,Cr=Math.max(pn+pt,1e-5),cn=Ei+Ve,wn=Oi+Pt,gr=Mi+Qt,yr=Math.max(pn+Ot,1e-5);Vt.push(new fh($i/Cr,Ln/Cr,ar/Cr)),_i.push(new fh(cn/yr,wn/yr,gr/yr))}ft.push(Vt),dt.push(_i)}return[ft,dt]}(ne,te,se,he,fe)}(l,o,I,T,b,h,B,C,R,l.center.lat,t.tileID.canonical),K=t.queryGeometry;return function(Y,ne,te){let se=1/0;Js(te,ne)&&(se=fw(te,ne[0]));for(let he=0;he<ne.length;he++){let fe=ne[he],ve=Y[he];for(let _e=0;_e<fe.length-1;_e++){let Se=fe[_e],ze=[Se,fe[_e+1],ve[_e+1],ve[_e],Se];ya(te,ze)&&(se=Math.min(se,fw(te,ze)))}}return se!==1/0&&se}(j,Z,K.isPointQuery()?K.screenBounds:K.screenGeometry)}},line:class extends oo{constructor(t,e,i){super(t,yw,e,i),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){let e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Pc,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=kw.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new by(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(t,e){let i=ww(this);return{config:new O(this,e),defines:i,overrideFog:!1}}queryRadius(t){let e=t,i=Iw(hh("line-width",this,e),hh("line-gap-width",this,e)),o=hh("line-offset",this,e);return i/2+Math.abs(o)+o_(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,i,o,s,l){if(t.queryGeometry.isAboveHorizon)return!1;let h=nx(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),l.angle,t.pixelToTileUnitsFactor),f=t.pixelToTileUnitsFactor/2*Iw(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),y=this.paint.get("line-offset").evaluate(e,i);return y&&(o=function(b,T){let I=[],C=new nt(0,0);for(let D=0;D<b.length;D++){let R=b[D],L=[];for(let B=0;B<R.length;B++){let j=R[B],Z=R[B+1],K=B===0?C:j.sub(R[B-1])._unit()._perp(),Y=B===R.length-1?C:Z.sub(j)._unit()._perp(),ne=K._add(Y)._unit();ne._mult(1/(ne.x*Y.x+ne.y*Y.y)),L.push(ne._mult(T)._add(j))}I.push(L)}return I}(o,y*t.pixelToTileUnitsFactor)),function(b,T,I){for(let C=0;C<T.length;C++){let D=T[C];if(b.length>=3){for(let R=0;R<D.length;R++)if(Oa(b,D[R]))return!0}if(od(b,D,I))return!0}return!1}(h,o,f)}isTileClipped(){return!0}},symbol:V_,background:class extends oo{constructor(t,e,i){super(t,qE,e,i)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},raster:dT,"raster-particle":hT,sky:class extends oo{constructor(t,e,i){super(t,JE,e,i),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="sky-gradient"?this._updateColorRamp():t!=="sky-atmosphere-sun"&&t!=="sky-atmosphere-halo-color"&&t!=="sky-atmosphere-color"&&t!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Fm({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){let e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if(this.paint.get("sky-type")==="atmosphere"){let o=this.paint.get("sky-atmosphere-sun"),s=!o,l=t.style.light,h=l.properties.get("position");return s&&l.properties.get("anchor")==="viewport"&&Pn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),s?zy(h.azimuthal,90-h.polar,e):zy(o[0],90-o[1],e)}let i=this.paint.get("sky-gradient-center");return zy(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){let t=this.paint.get("sky-type");return t==="atmosphere"?["skyboxCapture","skybox"]:t==="gradient"?["skyboxGradient"]:null}},slot:class extends oo{constructor(t,e,i){super(t,eA,e)}},model:class extends oo{constructor(t,e,i){super(t,cA,e,i),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new Fy(t)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(t){return t instanceof Q_?st-1:0}queryIntersectsFeature(t,e,i,o,s,l){if(!this.modelManager)return!1;let h=this.modelManager,f=t.tile.getBucket(this);if(!(f&&f instanceof Fy))return!1;let y=f;for(let b in y.instancesPerModel){let T=y.instancesPerModel[b];if(T.idToFeaturesIndex.hasOwnProperty(e.id)){let I=T.features[T.idToFeaturesIndex[e.id]],C=h.getModel(b,this.scope);if(!C)return!1;let D=r.a6.create(),R=new pe(0,0),L=y.canonical,B=Number.MAX_VALUE;for(let j=0;j<I.instancedDataCount;++j){let Z=16*(I.instancedDataOffset+j),K=T.instancedDataArray.float32,Y=[K[Z+4],K[Z+5],K[Z+6]];VT(L,R,K[Z],0|K[Z+1]),vT(D,C,l,R,I.rotation,I.scale,Y,!1,!1,!1),l.projection.name==="globe"&&(D=Oy(D,l));let ne=r.a6.multiply([],l.projMatrix,D),te=t.queryGeometry,se=gT(te.isPointQuery()?te.screenBounds:te.screenGeometry,l,ne,C.aabb);se!=null&&(B=Math.min(se,B))}return B!==Number.MAX_VALUE&&B}}return!1}_handleOverridablePaintPropertyUpdate(t,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||t!=="model-color"&&t!=="model-color-mix-intensity"&&t!=="model-rotation"&&t!=="model-scale"&&t!=="model-translation"&&t!=="model-emissive-strength")}_isPropertyZoomDependent(t){let e=this._transitionablePaint._values[t];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof Fc}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(t,e,i,o){let s=t.tile,l=s.getBucket(this),h=null,f=Number.MAX_VALUE;if(!(l&&l instanceof Q_))return{queryFeature:h,intersectionZ:f};let y=l.getNodesInfo()[e];if(y.hiddenByReplacement||!y.node.meshes||!i.filter(new yn(s.tileID.overscaledZ),y.feature,s.tileID.canonical))return{queryFeature:h,intersectionZ:f};let b=y.node,T=o.calculatePosMatrix(s.tileID.toUnwrapped(),o.worldSize),I=y.evaluatedScale,C=0;o.elevation&&b.elevation&&(C=b.elevation*o.elevation.exaggeration()),r.a6.translate(T,T,[(b.anchor?b.anchor[0]:0)*(I[0]-1),(b.anchor?b.anchor[1]:0)*(I[1]-1),C]),r.a6.scale(T,T,I),r.a6.multiply(T,T,b.matrix);let D=t.queryGeometry,R=D.isPointQuery()?D.screenBounds:D.screenGeometry,L=function(j){let Z=r.a6.multiply([],T,j.matrix),K=r.a6.multiply(Z,o.expandedFarZProjMatrix,Z);for(let Y=0;Y<j.meshes.length;++Y){let ne=j.meshes[Y];if(Y===j.lightMeshIndex)continue;let te=gT(R,o,K,ne.aabb);te!=null&&(f=Math.min(te,f))}if(j.children)for(let Y of j.children)L(Y)};if(L(b),f===Number.MAX_VALUE)return{queryFeature:h,intersectionZ:f};let B=new pe(0,0);return VT(s.tileID.canonical,B,y.node.anchor[0],y.node.anchor[1]),h={type:"Feature",geometry:{type:"Point",coordinates:[B.lng,B.lat]},properties:y.feature.properties,id:y.feature.id,state:{},layer:this.serialize()},{queryFeature:h,intersectionZ:f}}}},Wt={read:function(t,e){return t.readFields(Wt._readField,{header_length:0,x:0,y:0,z:0,layers:[]},e)},_readField:function(t,e,i){t===1?e.header_length=i.readFixed32():t===2?e.x=i.readVarint():t===3?e.y=i.readVarint():t===4?e.z=i.readVarint():t===5&&e.layers.push(Wt.Layer.read(i,i.readVarint()+i.pos))},PixelFormat:{PIXEL_FORMAT_UNKNOWN:{value:0,options:{}},PIXEL_FORMAT_UINT32:{value:1,options:{}},PIXEL_FORMAT_UINT16:{value:2,options:{}},PIXEL_FORMAT_UINT8:{value:3,options:{}}},Filter:{}};Wt.Filter.read=function(t,e){return t.readFields(Wt.Filter._readField,{delta_filter:null,filter:null,zigzag_filter:null,bitshuffle_filter:null,byteshuffle_filter:null},e)},Wt.Filter._readField=function(t,e,i){t===1?(e.delta_filter=Wt.Filter.Delta.read(i,i.readVarint()+i.pos),e.filter="delta_filter"):t===2?(e.zigzag_filter=Wt.Filter.Zigzag.read(i,i.readVarint()+i.pos),e.filter="zigzag_filter"):t===3?(e.bitshuffle_filter=Wt.Filter.BitShuffle.read(i,i.readVarint()+i.pos),e.filter="bitshuffle_filter"):t===4&&(e.byteshuffle_filter=Wt.Filter.ByteShuffle.read(i,i.readVarint()+i.pos),e.filter="byteshuffle_filter")},Wt.Filter.Delta={},Wt.Filter.Delta.read=function(t,e){return t.readFields(Wt.Filter.Delta._readField,{block_size:0},e)},Wt.Filter.Delta._readField=function(t,e,i){t===1&&(e.block_size=i.readVarint())},Wt.Filter.Zigzag={},Wt.Filter.Zigzag.read=function(t,e){return t.readFields(Wt.Filter.Zigzag._readField,{},e)},Wt.Filter.Zigzag._readField=function(t,e,i){},Wt.Filter.BitShuffle={},Wt.Filter.BitShuffle.read=function(t,e){return t.readFields(Wt.Filter.BitShuffle._readField,{},e)},Wt.Filter.BitShuffle._readField=function(t,e,i){},Wt.Filter.ByteShuffle={},Wt.Filter.ByteShuffle.read=function(t,e){return t.readFields(Wt.Filter.ByteShuffle._readField,{},e)},Wt.Filter.ByteShuffle._readField=function(t,e,i){},Wt.Codec={},Wt.Codec.read=function(t,e){return t.readFields(Wt.Codec._readField,{gzip_data:null,codec:null,jpeg_image:null,webp_image:null,png_image:null},e)},Wt.Codec._readField=function(t,e,i){t===1?(e.gzip_data=Wt.Codec.GzipData.read(i,i.readVarint()+i.pos),e.codec="gzip_data"):t===2?(e.jpeg_image=Wt.Codec.JpegImage.read(i,i.readVarint()+i.pos),e.codec="jpeg_image"):t===3?(e.webp_image=Wt.Codec.WebpImage.read(i,i.readVarint()+i.pos),e.codec="webp_image"):t===4&&(e.png_image=Wt.Codec.PngImage.read(i,i.readVarint()+i.pos),e.codec="png_image")},Wt.Codec.GzipData={},Wt.Codec.GzipData.read=function(t,e){return t.readFields(Wt.Codec.GzipData._readField,{},e)},Wt.Codec.GzipData._readField=function(t,e,i){},Wt.Codec.JpegImage={},Wt.Codec.JpegImage.read=function(t,e){return t.readFields(Wt.Codec.JpegImage._readField,{},e)},Wt.Codec.JpegImage._readField=function(t,e,i){},Wt.Codec.WebpImage={},Wt.Codec.WebpImage.read=function(t,e){return t.readFields(Wt.Codec.WebpImage._readField,{},e)},Wt.Codec.WebpImage._readField=function(t,e,i){},Wt.Codec.PngImage={},Wt.Codec.PngImage.read=function(t,e){return t.readFields(Wt.Codec.PngImage._readField,{},e)},Wt.Codec.PngImage._readField=function(t,e,i){},Wt.DataIndexEntry={},Wt.DataIndexEntry.read=function(t,e){return t.readFields(Wt.DataIndexEntry._readField,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},e)},Wt.DataIndexEntry._readField=function(t,e,i){t===1?e.first_byte=i.readFixed64():t===2?e.last_byte=i.readFixed64():t===3?e.filters.push(Wt.Filter.read(i,i.readVarint()+i.pos)):t===4?e.codec=Wt.Codec.read(i,i.readVarint()+i.pos):t===5?e.offset=i.readFloat():t===6?e.scale=i.readFloat():t===7&&e.bands.push(i.readString())},Wt.Layer={},Wt.Layer.read=function(t,e){return t.readFields(Wt.Layer._readField,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},e)},Wt.Layer._readField=function(t,e,i){t===1?e.version=i.readVarint():t===2?e.name=i.readString():t===3?e.units=i.readString():t===4?e.tilesize=i.readVarint():t===5?e.buffer=i.readVarint():t===6?e.pixel_format=i.readVarint():t===7&&e.data_index.push(Wt.DataIndexEntry.read(i,i.readVarint()+i.pos))};let Ua={read:function(t,e){return t.readFields(Ua._readField,{uint32_values:null,values:null,fixed32_values:null},e)},_readField:function(t,e,i){t===2?(e.uint32_values=Ua.Uint32Values.read(i,i.readVarint()+i.pos),e.values="uint32_values"):t===3&&(e.fixed32_values=Ua.Fixed32Values.read(i,i.readVarint()+i.pos),e.values="fixed32_values")},Uint32Values:{}};Ua.Uint32Values.read=function(t,e){return t.readFields(Ua.Uint32Values._readField,{values:[]},e)},Ua.Uint32Values._readField=function(t,e,i){t===1&&(e.readValuesInto=function(o){if(o.type!==2)throw new Error(`Unsupported pbf type "${o.type}"`);let s=function(h){return h.type===2?h.readVarint()+h.pos:h.pos+1}(o),l=o.pos;return o.pos=s,function(h){o.pos=l;let f=0;for(;o.pos<s;){let y=o.readVarint();h[f++]=y}return h}}(i))},Ua.Fixed32Values={},Ua.Fixed32Values.read=function(t,e){return t.readFields(Ua.Fixed32Values._readField,{values:[]},e)},Ua.Fixed32Values._readField=function(t,e,i){throw new Error("Not implemented")};class AA{constructor(e=0,i=0,o=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=e,this.resetTtl=o,this.size=0,this.ttl=i}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(e){if(this.has(e)){let i=this.items[e];delete this.items[e],this.size--,i.prev!==null&&(i.prev.next=i.next),i.next!==null&&(i.next.prev=i.prev),this.first===i&&(this.first=i.next),this.last===i&&(this.last=i.prev)}return this}entries(e=this.keys()){return e.map(i=>[i,this.get(i)])}evict(e=!1){if(e||this.size>0){let i=this.first;delete this.items[i.key],--this.size==0?(this.first=null,this.last=null):(this.first=i.next,this.first.prev=null)}return this}expiresAt(e){let i;return this.has(e)&&(i=this.items[e].expiry),i}get(e){let i;if(this.has(e)){let o=this.items[e];this.ttl>0&&o.expiry<=Date.now()?this.delete(e):(i=o.value,this.set(e,i,!0))}return i}has(e){return e in this.items}keys(){let e=[],i=this.first;for(;i!==null;)e.push(i.key),i=i.next;return e}set(e,i,o=!1,s=this.resetTtl){let l;if(o||this.has(e)){if(l=this.items[e],l.value=i,o===!1&&s&&(l.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.last!==l){let h=this.last,f=l.next,y=l.prev;this.first===l&&(this.first=l.next),l.next=null,l.prev=this.last,h.next=l,y!==null&&(y.next=f),f!==null&&(f.prev=y)}}else this.max>0&&this.size===this.max&&this.evict(!0),l=this.items[e]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:e,prev:this.last,next:null,value:i},++this.size==1?this.first=l:this.last.next=l;return this.last=l,this}values(e=this.keys()){return e.map(i=>this.get(i))}}function DA(t,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let o=2;o>=1;o--){let s=o===1?1:0,l=o===2?1:0;for(let h=0;h<e[0];h++){let f=e[1]*h;for(let y=s;y<e[1];y++){let b=e[2]*(y+f);for(let T=l;T<e[2];T++){let I=e[3]*(T+b);for(let C=0;C<e[3];C++){let D=I+C;t[D]+=t[D-i]}}}}i*=e[o]}return t}function PA(t){for(let e=0,i=t.length;e<i;e++)t[e]=t[e]>>>1^-(1&t[e]);return t}function RA(t,e){switch(e){case"uint32":return t;case"uint16":for(let i=0;i<t.length;i+=2){let o=t[i],s=t[i+1];t[i]=(240&o)>>4|(61440&o)>>8|(240&s)<<4|61440&s,t[i+1]=15&o|(3840&o)>>4|(15&s)<<8|(3840&s)<<4}return t;case"uint8":for(let i=0;i<t.length;i+=4){let o=t[i],s=t[i+1],l=t[i+2],h=t[i+3];t[i+0]=(192&o)>>6|(192&s)>>4|(192&l)>>2|192&h,t[i+1]=(48&o)>>4|(48&s)>>2|48&l|(48&h)<<2,t[i+2]=(12&o)>>2|12&s|(12&l)<<2|(12&h)<<4,t[i+3]=3&o|(3&s)<<2|(3&l)<<4|(3&h)<<6}return t;default:throw new Error(`Invalid pixel format, "${e}"`)}}class Jl extends Error{constructor(e){super(e),this.name="MRTError"}}var oa=Uint8Array,Ch=Uint16Array,LA=Int32Array,UT=new oa([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),GT=new oa([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),zA=new oa([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),$T=function(t,e){for(var i=new Ch(31),o=0;o<31;++o)i[o]=e+=1<<t[o-1];var s=new LA(i[30]);for(o=1;o<30;++o)for(var l=i[o];l<i[o+1];++l)s[l]=l-i[o]<<5|o;return{b:i,r:s}},qT=$T(UT,2),HT=qT.b,OA=qT.r;HT[28]=258,OA[258]=28;for(var FA=$T(GT,0).b,Zy=new Ch(32768),Xn=0;Xn<32768;++Xn){var Mh=(43690&Xn)>>1|(21845&Xn)<<1;Zy[Xn]=((65280&(Mh=(61680&(Mh=(52428&Mh)>>2|(13107&Mh)<<2))>>4|(3855&Mh)<<4))>>8|(255&Mh)<<8)>>1}var op=function(t,e,i){for(var o=t.length,s=0,l=new Ch(e);s<o;++s)t[s]&&++l[t[s]-1];var h,f=new Ch(e);for(s=1;s<e;++s)f[s]=f[s-1]+l[s-1]<<1;if(i){h=new Ch(1<<e);var y=15-e;for(s=0;s<o;++s)if(t[s])for(var b=s<<4|t[s],T=e-t[s],I=f[t[s]-1]++<<T,C=I|(1<<T)-1;I<=C;++I)h[Zy[I]>>y]=b}else for(h=new Ch(o),s=0;s<o;++s)t[s]&&(h[s]=Zy[f[t[s]-1]++]>>15-t[s]);return h},ap=new oa(288);for(Xn=0;Xn<144;++Xn)ap[Xn]=8;for(Xn=144;Xn<256;++Xn)ap[Xn]=9;for(Xn=256;Xn<280;++Xn)ap[Xn]=7;for(Xn=280;Xn<288;++Xn)ap[Xn]=8;var ZT=new oa(32);for(Xn=0;Xn<32;++Xn)ZT[Xn]=5;var BA=op(ap,9,1),NA=op(ZT,5,1),Wy=function(t){for(var e=t[0],i=1;i<t.length;++i)t[i]>e&&(e=t[i]);return e},Ga=function(t,e,i){var o=e/8|0;return(t[o]|t[o+1]<<8)>>(7&e)&i},Xy=function(t,e){var i=e/8|0;return(t[i]|t[i+1]<<8|t[i+2]<<16)>>(7&e)},jA=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],$a=function(t,e,i){var o=new Error(e||jA[t]);if(o.code=t,Error.captureStackTrace&&Error.captureStackTrace(o,$a),!i)throw o;return o},VA=new oa(0),UA=typeof TextDecoder<"u"&&new TextDecoder;try{UA.decode(VA,{stream:!0})}catch{}let GA={gzip_data:"gzip"},$A={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},qA={uint32:1,uint16:2,uint8:4},HA={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};class WT{constructor(e=1){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){return this.layers[e]}getHeaderLength(e){let i=new Uint8Array(e),o=new DataView(e);if(i[0]!==13)throw new Jl("File is not a valid MRT.");return o.getUint32(1,!0)}parseHeader(e){let i=new Uint8Array(e),o=this.getHeaderLength(e);if(i.length<o)throw new Jl(`Expected header with length >= ${o} but got buffer of length ${i.length}`);let s=new bh(i.subarray(0,o)),l=Wt.read(s);if(!isNaN(this.x)&&(this.x!==l.x||this.y!==l.y||this.z!==l.z))throw new Jl(`Invalid attempt to parse header ${l.z}/${l.x}/${l.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=l.x,this.y=l.y,this.z=l.z;for(let h of l.layers)this.layers[h.name]=new ZA(h,{cacheSize:this._cacheSize});return this}createDecodingTask(e){let i=[],o=this.getLayer(e.layerName);for(let s=0;s<o.dataIndex.length;s++){let l=o.dataIndex[s],h=l.first_byte-e.firstByte,f=l.last_byte+1-e.firstByte;if(s<e.firstBlock||s>e.lastBlock||o._blocksInProgress.has(s))continue;let y={layerName:o.name,firstByte:h,lastByte:f,pixelFormat:o.pixelFormat,blockIndex:s,blockShape:[l.bands.length].concat(o.bandShape),buffer:o.buffer,codec:l.codec.codec,filters:l.filters.map(b=>b.filter)};o._blocksInProgress.add(s),i.push(y)}return new XT(i,()=>{i.forEach(s=>o._blocksInProgress.delete(s.blockIndex))},(s,l)=>{if(i.forEach(h=>o._blocksInProgress.delete(h.blockIndex)),s)throw s;l.forEach(h=>{this.getLayer(h.layerName).processDecodedData(h)})})}}class ZA{constructor({version:e,name:i,units:o,tilesize:s,pixel_format:l,buffer:h,data_index:f},y){if(this.version=e,this.version!==1)throw new Jl(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=i,this.units=o,this.tileSize=s,this.buffer=h,this.pixelFormat=$A[l],this.dataIndex=f,this.bandShape=[s+2*h,s+2*h,qA[this.pixelFormat]],this._decodedBlocks=function(b=1e3,T=0,I=!1){if(isNaN(b)||b<0)throw new TypeError("Invalid max value");if(isNaN(T)||T<0)throw new TypeError("Invalid ttl value");if(typeof I!="boolean")throw new TypeError("Invalid resetTtl value");return new AA(b,T,I)}(y?y.cacheSize:5),this._blocksInProgress=new Set}processDecodedData(e){let i=e.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.set(i,e.data)}getBlockForBand(e){let i=0;switch(typeof e){case"string":for(let[o,s]of this.dataIndex.entries()){for(let[l,h]of s.bands.entries())if(h===e)return{bandIndex:i+l,blockIndex:o,blockBandIndex:l};i+=s.bands.length}break;case"number":for(let[o,s]of this.dataIndex.entries()){if(e>=i&&e<i+s.bands.length)return{bandIndex:e,blockIndex:o,blockBandIndex:e-i};i+=s.bands.length}break;default:throw new Jl(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new Jl(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let i=1/0,o=-1/0,s=1/0,l=-1/0;for(let h of e){let{blockIndex:f}=this.getBlockForBand(h);if(f<0)throw new Jl(`Invalid band: ${JSON.stringify(h)}`);let y=this.dataIndex[f];s=Math.min(s,f),l=Math.max(l,f),i=Math.min(i,y.first_byte),o=Math.max(o,y.last_byte)}return{layerName:this.name,firstByte:i,lastByte:o,firstBlock:s,lastBlock:l}}hasBand(e){let{blockIndex:i}=this.getBlockForBand(e);return i>=0}hasDataForBand(e){let{blockIndex:i}=this.getBlockForBand(e);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(e){let{blockIndex:i,blockBandIndex:o}=this.getBlockForBand(e),s=this._decodedBlocks.get(i.toString());if(!s)throw new Jl(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);let l=this.dataIndex[i],h=this.bandShape.reduce((b,T)=>b*T,1),f=o*h,y=s.subarray(f,f+h);return{data:y,bytes:new Uint8Array(y.buffer).subarray(y.byteOffset,y.byteOffset+y.byteLength),tileSize:this.tileSize,buffer:this.buffer,offset:l.offset,scale:l.scale}}}class XT{constructor(e,i,o){this.tasks=e,this._onCancel=i,this._onComplete=o,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,i){this._finalized||(this._onComplete(e,i),this._finalized=!0)}}WT.performDecoding=function(t,e){return Promise.all(e.tasks.map(i=>{let{layerName:o,firstByte:s,lastByte:l,pixelFormat:h,blockShape:f,blockIndex:y,filters:b,codec:T}=i,I=new Uint8Array(t).subarray(s,l+1),C=new Uint32Array(f[0]*f[1]*f[2]),D;if(T!=="gzip_data")throw new Error(`Unhandled codec: ${T}`);return D=function(R,L){if(!globalThis.DecompressionStream&&L==="gzip_data")return Promise.resolve(((K=function(te){te[0]==31&&te[1]==139&&te[2]==8||$a(6,"invalid gzip data");var se=te[3],he=10;4&se&&(he+=2+(te[10]|te[11]<<8));for(var fe=(se>>3&1)+(se>>4&1);fe>0;fe-=!te[he++]);return he+(2&se)}(Z=R))+8>Z.length&&$a(6,"invalid gzip data"),function(te,se,he,fe){var ve=te.length;if(!ve||se.f&&!se.l)return he||new oa(0);var _e=!he,Se=_e||se.i!=2,ze=se.i;_e&&(he=new oa(3*ve));var ke=function(co){var Kr=he.length;if(co>Kr){var aa=new oa(Math.max(2*Kr,co));aa.set(he),he=aa}},Re=se.f||0,we=se.p||0,Pe=se.b||0,et=se.l,Fe=se.d,ft=se.m,dt=se.n,je=8*ve;do{if(!et){Re=Ga(te,we,1);var zt=Ga(te,we+1,3);if(we+=3,!zt){var wt=te[(Ci=4+((we+7)/8|0))-4]|te[Ci-3]<<8,pt=Ci+wt;if(pt>ve){ze&&$a(0);break}Se&&ke(Pe+wt),he.set(te.subarray(Ci,pt),Pe),se.b=Pe+=wt,se.p=we=8*pt,se.f=Re;continue}if(zt==1)et=BA,Fe=NA,ft=9,dt=5;else if(zt==2){var Ve=Ga(te,we,31)+257,Pt=Ga(te,we+10,15)+4,Qt=Ve+Ga(te,we+5,31)+1;we+=14;for(var Ot=new oa(Qt),Jt=new oa(19),Vt=0;Vt<Pt;++Vt)Jt[zA[Vt]]=Ga(te,we+3*Vt,7);we+=3*Pt;var _i=Wy(Jt),Ht=(1<<_i)-1,en=op(Jt,_i,1);for(Vt=0;Vt<Qt;){var Ci,Ei=en[Ga(te,we,Ht)];if(we+=15&Ei,(Ci=Ei>>4)<16)Ot[Vt++]=Ci;else{var Oi=0,Mi=0;for(Ci==16?(Mi=3+Ga(te,we,3),we+=2,Oi=Ot[Vt-1]):Ci==17?(Mi=3+Ga(te,we,7),we+=3):Ci==18&&(Mi=11+Ga(te,we,127),we+=7);Mi--;)Ot[Vt++]=Oi}}var pn=Ot.subarray(0,Ve),$i=Ot.subarray(Ve);ft=Wy(pn),dt=Wy($i),et=op(pn,ft,1),Fe=op($i,dt,1)}else $a(1);if(we>je){ze&&$a(0);break}}Se&&ke(Pe+131072);for(var Ln=(1<<ft)-1,ar=(1<<dt)-1,Cr=we;;Cr=we){var cn=(Oi=et[Xy(te,we)&Ln])>>4;if((we+=15&Oi)>je){ze&&$a(0);break}if(Oi||$a(2),cn<256)he[Pe++]=cn;else{if(cn==256){Cr=we,et=null;break}var wn=cn-254;cn>264&&(wn=Ga(te,we,(1<<(br=UT[Vt=cn-257]))-1)+HT[Vt],we+=br);var gr=Fe[Xy(te,we)&ar],yr=gr>>4;if(gr||$a(3),we+=15&gr,$i=FA[yr],yr>3){var br=GT[yr];$i+=Xy(te,we)&(1<<br)-1,we+=br}if(we>je){ze&&$a(0);break}Se&&ke(Pe+131072);var on=Pe+wn;if(Pe<$i){var Lo=0-$i,ec=Math.min($i,on);for(Lo+Pe<0&&$a(3);Pe<ec;++Pe)he[Pe]=fe[Lo+Pe]}for(;Pe<on;++Pe)he[Pe]=he[Pe-$i]}}se.l=et,se.p=Cr,se.b=Pe,se.f=Re,et&&(Re=1,se.m=ft,se.d=Fe,se.n=dt)}while(!Re);return Pe!=he.length&&_e?function(co,Kr,aa){return(Kr==null||Kr<0)&&(Kr=0),(aa==null||aa>co.length)&&(aa=co.length),new oa(co.subarray(Kr,aa))}(he,0,Pe):he.subarray(0,Pe)}(Z.subarray(K,-8),{i:2},new oa(((B=Z)[(j=B.length)-4]|B[j-3]<<8|B[j-2]<<16|B[j-1]<<24)>>>0),void 0)));var B,j,Z,K;let Y=GA[L];if(!Y)throw new Error(`Unhandled codec: ${L}`);let ne=new globalThis.DecompressionStream(Y);return new Response(new Blob([R]).stream().pipeThrough(ne)).arrayBuffer().then(te=>new Uint8Array(te))}(I,T).then(R=>{let L=Ua.read(new bh(R));if(L.values==="uint32_values")return L.uint32_values.readValuesInto(C),new HA[h](C.buffer);throw new Error(`Unhandled numeric data "${L.values}"`)}),D.then(R=>{for(let L=b.length-1;L>=0;L--)switch(b[L]){case"delta_filter":DA(R,f);break;case"zigzag_filter":PA(R);break;case"bitshuffle_filter":RA(R,h);break;default:throw new Error(`Unhandled filter "${b[L]}"`)}return{layerName:o,blockIndex:y,data:R}}).catch(R=>{throw R})}))},mt(XT,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});let YT=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Yy{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[i,o]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");let s=o>>4;if(s!==1)throw new Error(`Got v${s} data when expected v1.`);let l=YT[15&o];if(!l)throw new Error("Unrecognized array type.");let[h]=new Uint16Array(e,2,1),[f]=new Uint32Array(e,4,1);return new Yy(f,h,l,e)}constructor(e,i=64,o=Float64Array,s){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=o,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;let l=YT.indexOf(this.ArrayType),h=2*e*this.ArrayType.BYTES_PER_ELEMENT,f=e*this.IndexArrayType.BYTES_PER_ELEMENT,y=(8-f%8)%8;if(l<0)throw new Error(`Unexpected typed array class: ${o}.`);s&&s instanceof ArrayBuffer?(this.data=s,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+f+y,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+h+f+y),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+f+y,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+l]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){let o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=e,this.coords[this._pos++]=i,o}finish(){let e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Ky(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,o,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:l,coords:h,nodeSize:f}=this,y=[0,l.length-1,0],b=[];for(;y.length;){let T=y.pop()||0,I=y.pop()||0,C=y.pop()||0;if(I-C<=f){for(let B=C;B<=I;B++){let j=h[2*B],Z=h[2*B+1];j>=e&&j<=o&&Z>=i&&Z<=s&&b.push(l[B])}continue}let D=C+I>>1,R=h[2*D],L=h[2*D+1];R>=e&&R<=o&&L>=i&&L<=s&&b.push(l[D]),(T===0?e<=R:i<=L)&&(y.push(C),y.push(D-1),y.push(1-T)),(T===0?o>=R:s>=L)&&(y.push(D+1),y.push(I),y.push(1-T))}return b}within(e,i,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:s,coords:l,nodeSize:h}=this,f=[0,s.length-1,0],y=[],b=o*o;for(;f.length;){let T=f.pop()||0,I=f.pop()||0,C=f.pop()||0;if(I-C<=h){for(let B=C;B<=I;B++)QT(l[2*B],l[2*B+1],e,i)<=b&&y.push(s[B]);continue}let D=C+I>>1,R=l[2*D],L=l[2*D+1];QT(R,L,e,i)<=b&&y.push(s[D]),(T===0?e-o<=R:i-o<=L)&&(f.push(C),f.push(D-1),f.push(1-T)),(T===0?e+o>=R:i+o>=L)&&(f.push(D+1),f.push(I),f.push(1-T))}return y}}function Ky(t,e,i,o,s,l){if(s-o<=i)return;let h=o+s>>1;KT(t,e,h,o,s,l),Ky(t,e,i,o,h-1,1-l),Ky(t,e,i,h+1,s,1-l)}function KT(t,e,i,o,s,l){for(;s>o;){if(s-o>600){let b=s-o+1,T=i-o+1,I=Math.log(b),C=.5*Math.exp(2*I/3),D=.5*Math.sqrt(I*C*(b-C)/b)*(T-b/2<0?-1:1);KT(t,e,i,Math.max(o,Math.floor(i-T*C/b+D)),Math.min(s,Math.floor(i+(b-T)*C/b+D)),l)}let h=e[2*i+l],f=o,y=s;for(sp(t,e,o,i),e[2*s+l]>h&&sp(t,e,o,s);f<y;){for(sp(t,e,f,y),f++,y--;e[2*f+l]<h;)f++;for(;e[2*y+l]>h;)y--}e[2*o+l]===h?sp(t,e,o,y):(y++,sp(t,e,y,s)),y<=i&&(o=y+1),i<=y&&(s=y-1)}}function sp(t,e,i,o){Qy(t,i,o),Qy(e,2*i,2*o),Qy(e,2*i+1,2*o+1)}function Qy(t,e,i){let o=t[e];t[e]=t[i],t[i]=o}function QT(t,e,i,o){let s=t-i,l=e-o;return s*s+l*l}r.$=tT,r.A=Xd,r.B=tm,r.C=gi,r.D=ye,r.E=yl,r.F=bn,r.G=Qe,r.H=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return Sa(t.expression.evaluate(e))}interpolate(t,e,i){return{x:fi(t.x,e.x,i),y:fi(t.y,e.y,i),z:fi(t.z,e.z,i),azimuthal:fi(t.azimuthal,e.azimuthal,i),polar:fi(t.polar,e.polar,i)}}},r.I=Iy,r.J=Ra,r.K=yn,r.L=Ii,r.M=class{constructor(t,e,i,o){this.id=t,this.position=e!=null?new pe(e[0],e[1]):new pe(0,0),this.orientation=i??[0,0,0],this.nodes=o,this.uploaded=!1,this.aabb=new An([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(t,e){if(r.a6.multiply(t.matrix,e,t.matrix),t.meshes)for(let i of t.meshes){let o=An.applyTransform(i.aabb,t.matrix);this.aabb.encapsulate(o)}if(t.children)for(let i of t.children)this._applyTransformations(i,t.matrix)}computeBoundsAndApplyParent(){let t=r.a6.identity([]);for(let e of this.nodes)this._applyTransformations(e,t)}computeModelMatrix(t,e,i,o,s,l,h=!1){vT(this.matrix,this,t.transform,this.position,e,i,o,s,l,h)}upload(t){if(!this.uploaded){for(let e of this.nodes)By(e,t);for(let e of this.nodes)Z_(e);this.uploaded=!0}}destroy(){for(let t of this.nodes)Ny(t)}},r.O=ml,r.P=nt,r.Q=Vc,r.R=to,r.S=$l,r.T=Ly,r.U=fi,r.V=st,r.W=cf,r.X=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return function([i,o]){let s=Sa([1,i,o]);return{x:s.x,y:s.y,z:s.z}}(t.expression.evaluate(e))}interpolate(t,e,i){return{x:fi(t.x,e.x,i),y:fi(t.y,e.y,i),z:fi(t.z,e.z,i)}}},r.Y=function(t,e,i=0,o=!0){let s=new nt(i,i),l=t.sub(s),h=e.add(s),f=[l,new nt(h.x,l.y),h,new nt(l.x,h.y)];return o&&f.push(l.clone()),f},r.Z=Fc,r._=function(t,e){let i=[];for(let o=0;o<t.length;o++){let s=Ya(o-1,-1,t.length-1),l=Ya(o+1,-1,t.length-1),h=t[o],f=t[l],y=t[s].sub(h).unit(),b=f.sub(h).unit(),T=b.angleWithSep(y.x,y.y),I=y.add(b).unit().mult(-1*e/Math.sin(T/2));i.push(h.add(I))}return i},r.a=lu,r.a$=function(t){let e=[];for(let i in t)e.push(t[i]);return e},r.a0=ix,r.a1=function(t,e,i=0){return r.N.fromValues(((e.x-i)*t.scale-t.x)*st,(e.y*t.scale-t.y)*st,tn(e.z,e.y))},r.a2=ey,r.a3=bw,r.a4=function(t){let e=1/0,i=1/0,o=-1/0,s=-1/0;for(let l of t)e=Math.min(e,l.x),i=Math.min(i,l.y),o=Math.max(o,l.x),s=Math.max(s,l.y);return{min:new nt(e,i),max:new nt(o,s)}},r.a5=Xt,r.a8=Oa,r.a9=Di,r.aA=Cf,r.aB=Rn,r.aC=pl,r.aD=Gf,r.aE=j_,r.aF=function(){bo.isLoading()||bo.isLoaded()||us()!=="deferred"||mm()},r.aG=vo,r.aH=tr,r.aI=LT,r.aJ=Fs,r.aK=by,r.aL=_y,r.aM=mr,r.aN=ea,r.aO=Cm,r.aP=x1,r.aQ=y_,r.aR=Ry,r.aS=function(t,e){let i=$l(e.zoom);if(i===0)return vs(t);let o=h_(t),s=ry(o),l=Xt(o.getWest())*e.worldSize,h=Xt(o.getEast())*e.worldSize,f=Nt(o.getNorth())*e.worldSize,y=Nt(o.getSouth())*e.worldSize,b=[l,f,0],T=[h,f,0],I=[l,y,0],C=[h,y,0],D=r.a6.invert([],e.globeMatrix);return r.N.transformMat4(b,b,D),r.N.transformMat4(T,T,D),r.N.transformMat4(I,I,D),r.N.transformMat4(C,C,D),s[0]=rl(s[0],I,i),s[1]=rl(s[1],C,i),s[2]=rl(s[2],T,i),s[3]=rl(s[3],b,i),An.fromPoints(s)},r.aT=m_,r.aU=Om,r.aV=rl,r.aW=Xr,r.aX=UC,r.aY=zs,r.aZ=WT,r.a_=Ae,r.aa=ii,r.ab=W,r.ac=function(t,e){let i={};for(let o=0;o<e.length;o++){let s=e[o];s in t&&(i[s]=t[s])}return i},r.ad=xe,r.ae=Nt,r.af=class{constructor(t){this.entries={},this.scheduler=t}request(t,e,i,o){let s=this.entries[t]=this.entries[t]||{callbacks:[]};if(s.result){let[l,h]=s.result;return this.scheduler?this.scheduler.add(()=>{o(l,h)},e):o(l,h),()=>{}}return s.callbacks.push(o),s.cancel||(s.cancel=i((l,h)=>{s.result=[l,h];for(let f of s.callbacks)this.scheduler?this.scheduler.add(()=>{f(l,h)},e):f(l,h);setTimeout(()=>delete this.entries[t],3e3)})),()=>{s.result||(s.callbacks=s.callbacks.filter(l=>l!==o),s.callbacks.length||(s.cancel(),delete this.entries[t]))}}},r.ag=bm,r.ah=function(t,e,i){let o=JSON.stringify(t.request);return t.data&&(this.deduped.entries[o]={result:[null,t.data]}),this.deduped.request(o,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},s=>{let l=Ae(t.request,(h,f,y,b)=>{h?s(h):f&&s(null,{vectorTile:i?void 0:new gy(new bh(f)),rawData:f,cacheControl:y,expires:b})});return()=>{l.cancel(),s()}},e)},r.ai=function(t){Fi++,Fi>bt&&(t.getActor().send("enforceCacheSizeLimit",Ee),Fi=0)},r.aj=Qn,r.ak=Oe,r.al=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},r.am=We,r.an=dT,r.ao=hT,r.ap=cT,r.aq=function(t,e){let i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let o=0;o<t.length;o++){let s=document.createElement("source");He(t[o])||(i.crossOrigin="Anonymous"),s.src=t[o],i.appendChild(s)}return{cancel:()=>{}}},r.ar=U_,r.as=Wm,r.at=Gt,r.au=yi,r.av=La,r.aw=hr,r.ax=Wn,r.ay=Bi,r.az=Qs,r.b=Bs,r.b$=Bf,r.b0=function(t,e){let i=[];for(let o in t)o in e||i.push(o);return i},r.b1=Zo,r.b2=["type","source","source-layer","minzoom","maxzoom","filter","layout"],r.b3=function(t,e){let{x:i,y:o}=t.point,s=C1(i,o,t.worldSize/t._pixelsPerMercatorPixel,0,0);return r.a6.multiply(s,s,oy(vs(e)))},r.b5=_h,r.b6=ra,r.b7=S_,r.b8=function(t,e,i,o,s){let l=5*e+2;t.float32[l+0]=i,t.float32[l+1]=o,t.float32[l+2]=s},r.b9=N_,r.bA=q_,r.bB=uT,r.bC=function(t){let e=uT(t,!0);return r.b4.invert([],[e[0],e[1],e[4],e[5]])},r.bD=ty,r.bE=function(t){let{x:e,y:i}=t.point,{lng:o,lat:s}=t._center;return C1(e,i,t.worldSize,o,s)},r.bF=Mr,r.bG=J,r.bH=function(t){let e=Math.round((t+45+360)%360/90)%4;return Sd[e]},r.bI=45,r.bJ=Tt,r.bK=d,r.bL=_s,r.bM=r_,r.bN=Nr,r.bO=lh,r.bP=c,r.bQ=function(t,e,i){let o=Math.sqrt(t*t+e*e+i*i),s=o>0?Math.acos(i/o)*_c:0,l=t!==0||e!==0?Math.atan2(-e,-t)*_c+90:0;return l<0&&(l+=360),[o,l,s]},r.bR=li,r.bS=An,r.bT=Sa,r.bU=function(t){return[Math.pow(t[0],1/2.2),Math.pow(t[1],1/2.2),Math.pow(t[2],1/2.2)]},r.bV=function(t){return t({pluginStatus:ro,pluginURL:hs}),um.on("pluginStateChange",t),t},r.bW=jy,r.bX=W_,r.bY=xh,r.bZ=Sy,r.b_=Zn,r.ba=$w,r.bb=ya,r.bc=Dr,r.bd=Kw,r.be=My,r.bf=ky,r.bg=Yy,r.bh=Ya,r.bj=vi,r.bk=ie,r.bl=qt,r.bm=function(t,e,i){t[4*e+0]=i[0],t[4*e+1]=i[1],t[4*e+2]=i[2],t[4*e+3]=i[3]},r.bn=pe,r.bo=aT,r.bp=Ye,r.bq=iy,r.br=mT,r.bs=Ne,r.bt=k1,r.bu=function(t,e,i,o,s,l,h,f,y){if(y.name==="globe")return k1(t,e,new Ne(i,o,s),!1);let b=Wm({z:i,x:o,y:s},y);return new An([(l+b.x/b.scale)*e,e*(b.y/b.scale),h],[(l+b.x2/b.scale)*e,e*(b.y2/b.scale),f])},r.bv=function(t,e,i){let o=0;for(let s=0;s<2;++s){let l=i?i[s]:0;t[s]>l&&(o+=(t[s]-l)*(t[s]-l)),e[s]<l&&(o+=(l-e[s])*(l-e[s]))}return o},r.bw=ai,r.bx=$,r.by=function(t){let e=r.a6.identity(new Float64Array(16));r.a6.multiply(e,t.pixelMatrix,t.globeMatrix);let i=[0,ce,0],o=[0,be,0];return r.N.transformMat4(i,i,e),r.N.transformMat4(o,o,e),[i[0]>0&&i[0]<=t.width&&i[1]>0&&i[1]<=t.height&&!sy(t,new pe(t.center.lat,90)),o[0]>0&&o[0]<=t.width&&o[1]>0&&o[1]<=t.height&&!sy(t,new pe(t.center.lat,-90))]},r.bz=function(t,e){let{scale:i}=t.tileTransform,o=i*st/(t.tileSize*Math.pow(2,e.zoom-t.tileID.overscaledZ+t.tileID.canonical.z));return r.b4.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[o,o])},r.c=PT,r.c$=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},r.c0=me,r.c1=_o,r.c2=function(t,e,i){return t.type==="custom"?new KE(t,e):new EA[t.type](t,e,i)},r.c3=function(t){let e=t.indexOf(th);return e>=0?t.slice(0,e):t},r.c4=function(t){return t.indexOf(th)>=0},r.c5=function(t){let e=t.indexOf(th);return e>=0?t.slice(e+1):""},r.c6=function(t){let e=[],i=t.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),t.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},r.c7=So,r.c8=um,r.c9=Ce,r.cA=ww,r.cB=(t,e,i,o,s,l)=>{let h=t.transform;return{u_matrix:xw(t,e,i,o),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:h.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:s,u_image:0,u_tile_units_to_pixels:vw(e,h),u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:l}},r.cC=(t,e,i,o,s,l,h)=>{let f=t.transform,y=f.calculatePixelsToTileUnitsMatrix(e);return{u_matrix:xw(t,e,i,o),u_pixels_to_tile_units:y,u_device_pixel_ratio:l,u_units_to_pixels:[1/f.pixelsToGLUnits[0],1/f.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:s,u_texsize:Tw(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:vw(e,t.transform),u_alpha_discard_threshold:0,u_trim_offset:h,u_emissive_strength:i.paint.get("line-emissive-strength")}},r.cD=yc,r.cE=Fm,r.cF=mw,r.cG=_t,r.cH=I_,r.cI=Zl,r.cJ=450,r.cK=7,r.cL=WE,r.cM=256,r.cN=oy,r.cO=fs,r.cP=Sm,r.cQ=function(t,e,i,o,s){return ii((t-e)/(i-e)*(s-o)+o,o,s)},r.cR=si,r.cS=Oy,r.cT=[1,1,1],r.cU=ph,r.cV=kh,r.cW=_a,r.cX=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(t){let e=H1(new nt(0,0),new nt(st,st),t),i=[];for(let o of this._activeRegions){if(o.hiddenByOverlap||!q1(e,o))continue;let s=MM(o.min,o.max,t);i.push({min:s.min,max:s.max,sourceId:this._sourceIds[o.priority],footprint:o.footprint,footprintTileId:o.tileId})}return i}setSources(t){this._setSources(t.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{let i=[];for(let o of e.cache.getVisibleCoordinates()){let s=e.cache.getTile(o).buckets[e.layer];if(s)for(let l of s.getNodesInfo()){let h=l.node;h.footprint&&i.push({footprint:h.footprint,id:o.toUnwrapped()})}}return i}})))}_addSource(t){let e=t.getFootprints();if(e.length!==0){for(let i of e){if(!i.footprint)continue;let o=H1(i.footprint.min,i.footprint.max,i.id);this._activeRegions.push({min:o.min,max:o.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:i.id,footprint:i.footprint})}this._sourceIds.push(t.getSourceId())}}_computeReplacement(){this._activeRegions.sort((e,i)=>e.priority-i.priority||w_(e.min,i.min)||w_(e.max,i.max));let t=this._activeRegions.length!==this._prevRegions.length;if(!t){let e=0,i=0;for(;!t&&e!==this._activeRegions.length;){let o=this._activeRegions[e],s=this._prevRegions[i];t=o.priority!==s.priority||!$1(o,s),++e,++i}}if(t){++this._updateTime;let e=i=>{let o=this._activeRegions;if(i>=o.length)return i;let s=o[i].priority;for(;i<o.length&&o[i].priority===s;)++i;return i};if(this._sourceIds.length>1){let i=0,o=e(i);for(;i!==o;){let s=i,l=i;for(;s!==o;){let h=this._activeRegions[s];h.hiddenByOverlap=!1;for(let f=0;f<l;f++){let y=this._activeRegions[f];if(!y.hiddenByOverlap&&q1(h,y)&&(h.hiddenByOverlap=W1(h.footprint,h.tileId,y.footprint,y.tileId),h.hiddenByOverlap))break}++s}i=o,o=e(i)}}}}_setSources(t){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=t.length-1;e>=0;e--)this._addSource(t[e]);this._computeReplacement()}},r.cY=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(let t of this._poleSegments)t.destroy();for(let t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy()}_fillGridMeshWithLods(t,e){let i=new ea,o=new hr,s=[],l=t+1+2,h=e[0]+1,f=e[0]+1+(1+e.length),y=(b,T,I)=>{let C=b===l-1?b-2:b===0?b:b-1;return C+=I?24575:0,[C,T]};for(let b=0;b<l;++b)i.emplaceBack(...y(b,0,!0));for(let b=0;b<h;++b)for(let T=0;T<l;++T)i.emplaceBack(...y(T,b,(T===0||T===l-1)&&!0));for(let b=0;b<e.length;++b){let T=e[b];for(let I=0;I<l;++I)i.emplaceBack(...y(I,T,!0))}for(let b=0;b<e.length;++b){let T=o.length,I=e[b]+1+2,C=new hr;for(let L=0;L<I-1;L++){let B=L===I-2,j=B?l*(f-e.length+b-L):l;for(let Z=0;Z<l-1;Z++){let K=L*l+Z;L===0||B||Z===0||Z===l-2?(C.emplaceBack(K+1,K,K+j),C.emplaceBack(K+j,K+j+1,K+1)):(o.emplaceBack(K+1,K,K+j),o.emplaceBack(K+j,K+j+1,K+1))}}let D=Rn.simpleSegment(0,T,i.length,o.length-T);for(let L=0;L<C.uint16.length;L+=3)o.emplaceBack(C.uint16[L],C.uint16[L+1],C.uint16[L+2]);let R=Rn.simpleSegment(0,T,i.length,o.length-T);s.push({withoutSkirts:D,withSkirts:R})}return{vertices:i,indices:o,segments:s}}_createGrid(t){let e=this._fillGridMeshWithLods(oe,ae);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,x1.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0)}_createPoles(t){let e=new hr;for(let h=0;h<=oe;h++)e.emplaceBack(0,h+1,h+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);let i=new fs,o=new fs,s=new fs,l=new fs;this._poleSegments=[];for(let h=0,f=0;h<J;h++){let y=360/(1<<h);i.emplaceBack(0,-W,0,.5,0),o.emplaceBack(0,-W,0,.5,1),s.emplaceBack(0,-W,0,.5,.5),l.emplaceBack(0,-W,0,.5,.5);for(let b=0;b<=oe;b++){let T=b/oe,I=0,C=fi(0,y,T),[D,R,L]=ue(qC,HC,C,W);i.emplaceBack(D,R,L,T,I),o.emplaceBack(D,R,L,T,1-I);let B=vi(C);T=.5+.5*Math.sin(B),I=.5+.5*Math.cos(B),s.emplaceBack(D,R,L,T,I),l.emplaceBack(D,R,L,T,1-I)}this._poleSegments.push(Rn.simpleSegment(f,0,66,64)),f+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(i,c_,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(o,c_,!1),this._texturedPoleNorthVertexBuffer=t.createVertexBuffer(s,c_,!1),this._texturedPoleSouthVertexBuffer=t.createVertexBuffer(l,c_,!1)}getGridBuffers(t,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}},r.cZ=function(t){return Qa.has(t)},r.c_=Ho,r.ca=n,r.cb=class extends za{constructor(t){super(t),this.current=p}set(t,e,i){if(this.fetchUniformLocation(t,e)){for(let o=0;o<9;o++)if(i[o]!==this.current[o]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},r.cc=lt,r.cd=function(t,e,i){let o=$l(i.zoom),s=t.style.map._antialias,l=e.options.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return o===0&&!s&&!l},r.ce=function(t){let e=t.pixelsPerMeter,i=e/qt(1,t.center.lat),o=r.a6.identity(new Float64Array(16));return r.a6.translate(o,o,[t.point.x,t.point.y,0]),r.a6.scale(o,o,[i,i,e]),Float32Array.from(o)},r.cf=h_,r.cg=function(t){let e=ai-5;t=ii(t,-e,e)/e*90;let i=Math.pow(Math.abs(Math.sin(vi(t))),3);return Math.round(i*(ae.length-1))},r.ch=function(t,e,i,o){let s=e.getNorth(),l=e.getSouth(),h=e.getWest(),f=e.getEast(),y=1<<t.z,b=f-h,T=s-l,I=b/oe,C=-T/ae[i],D=[0,I,0,C,0,0,s,h,0];if(t.z>0){let R=180/o;r.co.multiply(D,D,[R/b+1,0,0,0,R/T+1,0,-.5*R/I,.5*R/C,1])}return D[2]=y,D[5]=t.x,D[8]=t.y,D},r.ci=vs,r.cj=function(t,e,i){let o=r.a6.identity(new Float64Array(16)),s=(e/(1<<t)-.5)*Math.PI*2;return r.a6.rotateY(o,i.globeMatrix,s),Float32Array.from(o)},r.ck=class{isDataAvailableAtPoint(t){let e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;let i=e.getSource().maxzoom,o=1<<i,s=Math.floor(t.x),l=Math.floor((t.x-s)*o),h=Math.floor(t.y*o),f=this.findDEMTileFor(new We(i,s,i,l,h));return!(!f||!f.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);let o=this._source();if(!o||t.y<0||t.y>1)return e;let s=o.getSource().maxzoom,l=1<<s,h=Math.floor(t.x),f=t.x-h,y=new We(s,h,s,Math.floor(f*l),Math.floor(t.y*l)),b=this.findDEMTileFor(y);if(!b||!b.dem)return e;let T=b.dem,I=1<<b.tileID.canonical.z,C=(f*I-b.tileID.canonical.x)*T.dim,D=(t.y*I-b.tileID.canonical.y)*T.dim,R=Math.floor(C),L=Math.floor(D);return(i?this.exaggeration():1)*fi(fi(T.get(R,L),T.get(R,L+1),D-L),fi(T.get(R+1,L),T.get(R+1,L+1),D-L),C-R)}getAtTileOffset(t,e,i){let o=1<<t.canonical.z;return this.getAtPointOrZero(new Ii(t.wrap+(t.canonical.x+e/st)/o,(t.canonical.y+i/st)/o))}getAtTileOffsetFunc(t,e,i,o){return s=>{let l=this.getAtTileOffset(t,s.x,s.y),h=o.upVector(t.canonical,s.x,s.y),f=o.upVectorScale(t.canonical,e,i).metersToTile;return r.N.scale(h,h,l*f),h}}getForTilePoints(t,e,i,o){if(this.isUsingMockSource())return!1;let s=ph.create(this,t,o);return!!s&&(e.forEach(l=>{l[2]=this.exaggeration()*s.getElevationAt(l[0],l[1],i)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;let e=this.findDEMTileFor(t);if(!e||!e.dem)return null;let i=e.dem.tree,o=e.tileID,s=1<<t.canonical.z-o.canonical.z,l=t.canonical.x/s-o.canonical.x,h=t.canonical.y/s-o.canonical.y,f=0;for(let y=0;y<t.canonical.z-o.canonical.z&&!i.leaves[f];y++){l*=2,h*=2;let b=2*Math.floor(h)+Math.floor(l);f=i.childOffsets[f]+b,l%=1,h%=1}return{min:this.exaggeration()*i.minimums[f],max:this.exaggeration()*i.maximums[f]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){let t=this.visibleDemTiles;if(t.length===0)return null;let e=!1,i=Number.MAX_VALUE,o=Number.MIN_VALUE;for(let s of t){let l=this.getMinMaxForTile(s.tileID);l&&(i=Math.min(i,l.min),o=Math.max(o,l.max),e=!0)}return e?{min:i,max:o}:null}},r.cl=d_,r.cm=O1,r.cn=function(t,e){return[Math.pow(t[0],2.2)*e,Math.pow(t[1],2.2)*e,Math.pow(t[2],2.2)*e]},r.cp=S1,r.cq=256,r.cr=function(t,e){let i=[0,0,0],o=m_(vs(e.canonical));return r.N.transformMat4(i,i,o),r.N.transformMat4(i,i,t),i},r.cs=t=>({u_camera_to_center_distance:new Nr(t),u_extrude_scale:new v(t),u_device_pixel_ratio:new Nr(t),u_matrix:new d(t),u_inv_rot_matrix:new d(t),u_merc_center:new _s(t),u_tile_id:new r_(t),u_zoom_transition:new Nr(t),u_up_dir:new r_(t),u_emissive_strength:new Nr(t)}),r.ct=t=>({u_matrix:new d(t),u_pixels_to_tile_units:new v(t),u_device_pixel_ratio:new Nr(t),u_units_to_pixels:new _s(t),u_dash_image:new lh(t),u_gradient_image:new lh(t),u_image_height:new Nr(t),u_texsize:new _s(t),u_tile_units_to_pixels:new Nr(t),u_alpha_discard_threshold:new Nr(t),u_trim_offset:new _s(t),u_emissive_strength:new Nr(t)}),r.cu=t=>({u_matrix:new d(t),u_texsize:new _s(t),u_pixels_to_tile_units:new v(t),u_device_pixel_ratio:new Nr(t),u_image:new lh(t),u_units_to_pixels:new _s(t),u_tile_units_to_pixels:new Nr(t),u_alpha_discard_threshold:new Nr(t),u_trim_offset:new _s(t)}),r.cv=rh,r.cw=nE,r.cx=rE,r.cy=A1,r.cz=(t,e,i,o,s,l)=>{let h=t.transform,f=h.projection.name==="globe",y;if(l.paint.get("circle-pitch-alignment")==="map")if(f){let T=S1(h.zoom,e.canonical)*h._pixelsPerMercatorPixel;y=Float32Array.from([T,0,0,T])}else y=h.calculatePixelsToTileUnitsMatrix(i);else y=new Float32Array([h.pixelsToGLUnits[0],0,0,h.pixelsToGLUnits[1]]);let b={u_camera_to_center_distance:t.transform.getCameraToCenterDistance(h.projection),u_matrix:t.translatePosMatrix(e.projMatrix,i,l.paint.get("circle-translate"),l.paint.get("circle-translate-anchor")),u_device_pixel_ratio:qe.devicePixelRatio,u_extrude_scale:y,u_inv_rot_matrix:ZC,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:l.paint.get("circle-emissive-strength")};if(f){b.u_inv_rot_matrix=o,b.u_merc_center=s,b.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],b.u_zoom_transition=$l(h.zoom);let T=s[0]*st,I=s[1]*st;b.u_up_dir=h.projection.upVector(new Ne(0,0,0),T,I)}return b},r.d=at,r.d0=Hr,r.d1=Si,r.d2=Ie,r.d3=function([t,e,i]){let o=Math.hypot(t,e,i),s=Math.atan2(t,i),l=.5*Math.PI-Math.acos(-e/o);return new pe(Mr(s),Mr(l))},r.d4=Te,r.d5=q,r.d6=sy,r.d7=M1,r.d8=function(t){let e=[0,0,0],i=r.a6.identity(new Float64Array(16));return r.a6.multiply(i,t.pixelMatrix,t.globeMatrix),r.N.transformMat4(e,e,i),new nt(e[0],e[1])},r.d9=function(t){let e=t.navigator?t.navigator.userAgent:null;return!!function(i){if(Le==null){let o=i.navigator?i.navigator.userAgent:null;Le=!!i.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return Le}(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},r.dA=ja,r.dB=RT,r.dC=zT,r.dD=gw,r.dE=Ar,r.dF=Hw,r.dG=function(t,e,i,o,s,l,h,f,y,b,T){t.createArrays(),t.tilePixelRatio=st/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;let I=t.layers[0].layout,C=t.layers[0]._unevaluatedLayout._values,D={};if(t.textSizeData.kind==="composite"){let{minZoom:j,maxZoom:Z}=t.textSizeData;D.compositeTextSizes=[C["text-size"].possiblyEvaluate(new yn(j),f),C["text-size"].possiblyEvaluate(new yn(Z),f)]}if(t.iconSizeData.kind==="composite"){let{minZoom:j,maxZoom:Z}=t.iconSizeData;D.compositeIconSizes=[C["icon-size"].possiblyEvaluate(new yn(j),f),C["icon-size"].possiblyEvaluate(new yn(Z),f)]}D.layoutTextSize=C["text-size"].possiblyEvaluate(new yn(y+1),f),D.layoutIconSize=C["icon-size"].possiblyEvaluate(new yn(y+1),f),D.textMaxSize=C["text-size"].possiblyEvaluate(new yn(18),f);let R=I.get("text-rotation-alignment")==="map"&&I.get("symbol-placement")!=="point",L=I.get("text-size"),B=!1;for(let j of t.features)if(j.icon&&j.icon.nameSecondary){B=!0;break}for(let j of t.features){let Z=I.get("text-font").evaluate(j,{},f).join(","),K=L.evaluate(j,{},f),Y=D.layoutTextSize.evaluate(j,{},f),ne=(D.layoutIconSize.evaluate(j,{},f),{horizontal:{},vertical:void 0}),te=j.text,se,he=[0,0];if(te){let _e=te.toString(),Se=I.get("text-letter-spacing").evaluate(j,{},f)*Dr,ze=I.get("text-line-height").evaluate(j,{},f)*Dr,ke=D0(_e)?Se:0,Re=I.get("text-anchor").evaluate(j,{},f),we=I.get("text-variable-anchor");if(!we){let dt=I.get("text-radial-offset").evaluate(j,{},f);he=dt?Kw(Re,[dt*Dr,Cy]):I.get("text-offset").evaluate(j,{},f).map(je=>je*Dr)}let Pe=R?"center":I.get("text-justify").evaluate(j,{},f),et=I.get("symbol-placement")==="point",Fe=et?I.get("text-max-width").evaluate(j,{},f)*Dr:1/0,ft=dt=>{t.allowVerticalPlacement&&ds(_e)&&(ne.vertical=Ty(te,e,i,s,Z,Fe,ze,Re,dt,ke,he,ra.vertical,!0,Y,K))};if(!R&&we){let dt=Pe==="auto"?we.map(zt=>My(zt)):[Pe],je=!1;for(let zt=0;zt<dt.length;zt++){let wt=dt[zt];if(!ne.horizontal[wt])if(je)ne.horizontal[wt]=ne.horizontal[0];else{let pt=Ty(te,e,i,s,Z,Fe,ze,"center",wt,ke,he,ra.horizontal,!1,Y,K);pt&&(ne.horizontal[wt]=pt,je=pt.positionedLines.length===1)}}ft("left")}else{if(Pe==="auto"&&(Pe=My(Re)),et||I.get("text-writing-mode").indexOf("horizontal")>=0||!ds(_e)){let dt=Ty(te,e,i,s,Z,Fe,ze,Re,Pe,ke,he,ra.horizontal,!1,Y,K);dt&&(ne.horizontal[Pe]=dt)}ft(et?"left":Pe)}}let fe=!1;if(j.icon&&j.icon.namePrimary){let _e=o[j.icon.namePrimary];_e&&(se=TE(s[j.icon.namePrimary],j.icon.nameSecondary?s[j.icon.nameSecondary]:void 0,I.get("icon-offset").evaluate(j,{},f),I.get("icon-anchor").evaluate(j,{},f)),fe=_e.sdf,t.sdfIcons===void 0?t.sdfIcons=_e.sdf:t.sdfIcons!==_e.sdf&&Pn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(_e.pixelRatio!==t.pixelRatio||I.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}let ve=Jw(ne.horizontal)||ne.vertical;t.iconsInText||(t.iconsInText=!!ve&&ve.iconsInText),(ve||se)&&AE(t,j,ne,se,o,D,Y,0,he,fe,h,f,b,T,B)}l&&t.generateCollisionDebugBuffers(y,t.collisionBoxArray)},r.dH=gy,r.dI=bh,r.dJ=T_,r.dK=mi,r.dL=v_,r.dM=b_,r.dN=eo,r.dO=Cw,r.dP=function(t){let e=0;if(new Uint32Array(t,0,1)[0]!==IT){let i=new Uint32Array(t,0,7),[,,o,s,l,h]=i;e=i.byteLength+s+l+h+l,(o!==t.byteLength||e>=t.byteLength)&&Pn("Invalid b3dm header information.")}return ET(t,e)},r.dQ=function(t,e){let i=PT(t);for(let o of i){for(let s of o.meshes)TA(s);o.lights&&(o.lightMeshIndex=o.meshes.length,o.meshes.push(kA(o.lights,e)))}return i},r.dR=Q_,r.dS=xT,r.dT=bo,r.dU=function(t){Zi(),ut&&ut.then(e=>{e.keys().then(i=>{for(let o=0;o<i.length-t;o++)e.delete(i[o])})})},r.da=class{constructor(t,e,i){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){let t=function(){let e="";for(let i=0;i<10;i++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Je,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!me(t))return t;let i=Ft(t);return i.params.push(`sdk=js-${M}`),i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!me(t))return t;let i=Ft(t);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeModelURL(t,e){if(!me(t))return t;let i=Ft(t);return i.path=`/models/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeSourceURL(t,e,i,o){if(!me(t))return t;let s=Ft(t);return s.path=`/v4/${s.authority}.json`,s.params.push("secure"),i&&s.params.push(`language=${i}`),o&&s.params.push(`worldview=${o}`),this._makeAPIURL(s,this._customAccessToken||e)}normalizeSpriteURL(t,e,i,o){let s=Ft(t);return me(t)?(s.path=`/styles/v1${s.path}/sprite${e}${i}`,this._makeAPIURL(s,this._customAccessToken||o)):(s.path+=`${e}${i}`,pi(s))}normalizeTileURL(t,e,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!me(t))return t;let o=Ft(t);o.path=o.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||i&&o.authority!=="raster"&&i===512?"@2x":""}${Ri.supported?".webp":"$1"}`),o.authority==="raster"?o.path=`/${q.RASTER_URL_PREFIX}${o.path}`:o.authority==="rasterarrays"?o.path=`/${q.RASTERARRAYS_URL_PREFIX}${o.path}`:(o.path=o.path.replace(/^.+\/v4\//,"/"),o.path=`/${q.TILE_URL_VERSION}${o.path}`);let s=this._customAccessToken||function(l){for(let h of l){let f=h.match(/^access_token=(.*)$/);if(f)return f[1]}return null}(o.params)||q.ACCESS_TOKEN;return q.REQUIRE_ACCESS_TOKEN&&s&&this._skuToken&&o.params.push(`sku=${this._skuToken}`),this._makeAPIURL(o,s)}canonicalizeTileURL(t,e){let i=Ft(t);if(!i.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!i.path.match(/\.[\w]+$/))return t;let o="mapbox://";i.path.match(/^\/raster\/v1\//)?o+=`raster/${i.path.replace(`/${q.RASTER_URL_PREFIX}/`,"")}`:i.path.match(/^\/rasterarrays\/v1\//)?o+=`rasterarrays/${i.path.replace(`/${q.RASTERARRAYS_URL_PREFIX}/`,"")}`:o+=`tiles/${i.path.replace(`/${q.TILE_URL_VERSION}/`,"")}`;let s=i.params;return e&&(s=s.filter(l=>!l.match(/^access_token=/))),s.length&&(o+=`?${s.join("&")}`),o}canonicalizeTileset(t,e){let i=!!e&&me(e),o=[];for(let s of t.tiles||[])re(s)?o.push(this.canonicalizeTileURL(s,i)):o.push(s);return o}_makeAPIURL(t,e){let i="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",o=Ft(q.API_URL);if(t.protocol=o.protocol,t.authority=o.authority,t.protocol==="http"){let s=t.params.indexOf("secure");s>=0&&t.params.splice(s,1)}if(o.path!=="/"&&(t.path=`${o.path}${t.path}`),!q.REQUIRE_ACCESS_TOKEN)return pi(t);if(e=e||q.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return t.params=t.params.filter(s=>s.indexOf("access_token")===-1),t.params.push(`access_token=${e||""}`),pi(t)}},r.db=function(t,e){e?Qa.add(t):Qa.delete(t)},r.dc=Ri,r.dd=Wo,r.de=vc,r.df=ct,r.dg=Ai,r.dh=function(t){Qa.delete(t)},r.di=Tr,r.dj=wr,r.dk=M,r.dl=function(t,e){Ee=t,bt=e},r.dm=function(t,e,i=!1){if(ro===sm||ro===lm||ro===cm)throw new Error("setRTLTextPlugin cannot be called multiple times.");hs=qe.resolveURL(t),ro=sm,dm=e,hm(),i||mm()},r.dn=us,r.dp=function(){W_().acquire(Vy)},r.dq=function(){let t=ip;t&&(t.isPreloaded()&&t.numActive()===1?(t.release(Vy),ip=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},r.dr=tp,r.ds=function(t){let e=ni();if(!e)return;let i=e.delete(gt);t&&i.catch(t).then(()=>t())},r.dt=ep,r.du=wT,r.dv=function(t){Uy=qe.resolveURL(t),Sh||(Sh=new jy(W_(),new yl)),Sh.broadcast("setDracoUrl",Uy)},r.dw=TT,r.dx=function(t){Ih=qe.resolveURL(t),Sh||(Sh=new jy(W_(),new yl)),Sh.broadcast("setMeshoptUrl",Ih)},r.dy=mt,r.dz=ql,r.e=Er,r.f=qe,r.g=function(t,e){return Ce(Er(t,{type:"json"}),e)},r.h=na,r.i=kl,r.j=hu,r.k=Wd,r.l=function(t){return fetch(t).then(e=>e.arrayBuffer()).then(e=>ET(e,0,t))},r.m=Af,r.n=Oc,r.o=Gc,r.p=qw,r.q=Qd,r.r=Kd,r.s=im,r.t=Ac,r.u=Uc,r.v=Ir,r.w=Pn,r.x=El,r.z=_m}),u(["./shared"],function(r){"use strict";function M(Le){let X=Le?Le.url.toString():void 0;return X?performance.getEntriesByName(X):[]}function F(Le){if(typeof Le=="number"||typeof Le=="boolean"||typeof Le=="string"||Le==null)return JSON.stringify(Le);if(Array.isArray(Le)){let ie="[";for(let de of Le)ie+=`${F(de)},`;return`${ie}]`}let X="{";for(let ie of Object.keys(Le).sort())X+=`${ie}:${F(Le[ie])},`;return`${X}}`}function q(Le){let X="";for(let ie of r.b2)X+=`/${F(Le[ie])}`;return X}class re{constructor(X){this.keyCache={},this._layers={},this._layerConfigs={},X&&this.replace(X)}replace(X,ie){this._layerConfigs={},this._layers={},this.update(X,[],ie)}update(X,ie,de){this._options=de;for(let Oe of X)this._layerConfigs[Oe.id]=Oe,(this._layers[Oe.id]=r.c2(Oe,this.scope,this._options)).compileFilter(),this.keyCache[Oe.id]&&delete this.keyCache[Oe.id];for(let Oe of ie)delete this.keyCache[Oe],delete this._layerConfigs[Oe],delete this._layers[Oe];this.familiesBySource={};let Me=function(Oe,qe){let gt={};for(let bt=0;bt<Oe.length;bt++){let ut=qe&&qe[Oe[bt].id]||q(Oe[bt]);qe&&(qe[Oe[bt].id]=ut);let xt=gt[ut];xt||(xt=gt[ut]=[]),xt.push(Oe[bt])}let Ee=[];for(let bt in gt)Ee.push(gt[bt]);return Ee}(r.a$(this._layerConfigs),this.keyCache);for(let Oe of Me){let qe=Oe.map(ni=>this._layers[ni.id]),gt=qe[0];if(gt.visibility==="none")continue;let Ee=gt.source||"",bt=this.familiesBySource[Ee];bt||(bt=this.familiesBySource[Ee]={});let ut=gt.sourceLayer||"_geojsonTileLayer",xt=bt[ut];xt||(xt=bt[ut]=[]),xt.push(qe)}}}let me=1*r.dA;class De{constructor(X){let ie={},de=[];for(let gt in X){let Ee=X[gt],bt=ie[gt]={};for(let ut in Ee.glyphs){let xt=Ee.glyphs[+ut];if(!xt||xt.bitmap.width===0||xt.bitmap.height===0)continue;let ni=xt.metrics.localGlyph?me:1,Zi={x:0,y:0,w:xt.bitmap.width+2*ni,h:xt.bitmap.height+2*ni};de.push(Zi),bt[ut]=Zi}}let{w:Me,h:Oe}=r.p(de),qe=new r.dz({width:Me||1,height:Oe||1});for(let gt in X){let Ee=X[gt];for(let bt in Ee.glyphs){let ut=Ee.glyphs[+bt];if(!ut||ut.bitmap.width===0||ut.bitmap.height===0)continue;let xt=ie[gt][bt],ni=ut.metrics.localGlyph?me:1;r.dz.copy(ut.bitmap,qe,{x:0,y:0},{x:xt.x+ni,y:xt.y+ni},ut.bitmap)}}this.image=qe,this.positions=ie}}r.dy(De,"GlyphAtlas");class $e{constructor(X){this.tileID=new r.am(X.tileID.overscaledZ,X.tileID.wrap,X.tileID.canonical.z,X.tileID.canonical.x,X.tileID.canonical.y),this.tileZoom=X.tileZoom,this.uid=X.uid,this.zoom=X.zoom,this.canonical=X.tileID.canonical,this.pixelRatio=X.pixelRatio,this.tileSize=X.tileSize,this.source=X.source,this.scope=X.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=X.showCollisionBoxes,this.collectResourceTiming=!!X.collectResourceTiming,this.promoteId=X.promoteId,this.isSymbolTile=X.isSymbolTile,this.tileTransform=r.as(X.tileID.canonical,X.projection),this.projection=X.projection,this.brightness=X.brightness,this.extraShadowCaster=!!X.extraShadowCaster}parse(X,ie,de,Me,Oe){this.status="parsing",this.data=X,this.collisionBoxArray=new r.aD;let qe=new r.dB(Object.keys(X.layers).sort()),gt=new r.dC(this.tileID,this.promoteId);gt.bucketLayerIDs=[];let Ee={},bt=new r.dD(256,256),ut={featureIndex:gt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:bt,availableImages:de,brightness:this.brightness},xt=ie.familiesBySource[this.source];for(let Gi in xt){let nn=X.layers[Gi];if(!nn)continue;let dr=!1,an=!1,Zr=!1;for(let Kn of xt[Gi])Kn[0].type==="symbol"?dr=!0:an=!0,Kn[0].is3D()&&Kn[0].type!=="model"&&(Zr=!0);if(this.extraShadowCaster&&!Zr||this.isSymbolTile===!0&&!dr||this.isSymbolTile===!1&&!an)continue;nn.version===1&&r.w(`Vector tile source "${this.source}" layer "${Gi}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let Br=qe.encode(Gi),to=[];for(let Kn=0;Kn<nn.length;Kn++){let Zn=nn.feature(Kn),Ce=gt.getId(Zn,Gi);to.push({feature:Zn,id:Ce,index:Kn,sourceLayerIndex:Br})}for(let Kn of xt[Gi]){let Zn=Kn[0];(!this.extraShadowCaster||Zn.is3D()&&Zn.type!=="model")&&(this.isSymbolTile!==void 0&&Zn.type==="symbol"!==this.isSymbolTile||Zn.minzoom&&this.zoom<Math.floor(Zn.minzoom)||Zn.maxzoom&&this.zoom>=Zn.maxzoom||Zn.visibility!=="none"&&(Mt(Kn,this.zoom,ut.brightness,de),(Ee[Zn.id]=Zn.createBucket({index:gt.bucketLayerIDs.length,layers:Kn,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Br,sourceID:this.source,projection:this.projection.spec})).populate(to,ut,this.tileID.canonical,this.tileTransform),gt.bucketLayerIDs.push(Kn.map(Ce=>Ce.id))))}}let ni,Zi,sn,Wi;bt.trim();let Fi={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Ri=()=>{if(ni)return this.status="done",Oe(ni);if(this.extraShadowCaster)this.status="done",Oe(null,{buckets:r.a$(Ee).filter(Gi=>!Gi.isEmpty()),featureIndex:gt,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:ut.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Zi&&sn&&Wi){let Gi=new De(Zi),nn=new r.dF(sn,Wi);for(let dr in Ee){let an=Ee[dr];an instanceof r.aE?(Mt(an.layers,this.zoom,ut.brightness,de),r.dG(an,Zi,Gi.positions,sn,nn.iconPositions,this.showCollisionBoxes,de,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):an.hasPattern&&(an instanceof r.aK||an instanceof r.aL||an instanceof r.cH)&&(Mt(an.layers,this.zoom,ut.brightness,de),an.addFeatures(ut,this.tileID.canonical,nn.patternPositions,de,this.tileTransform,this.brightness))}this.status="done",Oe(null,{buckets:r.a$(Ee).filter(dr=>!dr.isEmpty()),featureIndex:gt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Gi.image,lineAtlas:bt,imageAtlas:nn,brightness:ut.brightness})}};if(!this.extraShadowCaster){let Gi=r.dE(ut.glyphDependencies,an=>Object.keys(an).map(Number));Object.keys(Gi).length?Me.send("getGlyphs",{uid:this.uid,stacks:Gi,scope:this.scope},(an,Zr)=>{ni||(ni=an,Zi=Zr,Ri())},void 0,!1,Fi):Zi={};let nn=Object.keys(ut.iconDependencies);nn.length?Me.send("getImages",{icons:nn,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(an,Zr)=>{ni||(ni=an,sn=Zr,Ri())},void 0,!1,Fi):sn={};let dr=Object.keys(ut.patternDependencies);dr.length?Me.send("getImages",{icons:dr,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(an,Zr)=>{ni||(ni=an,Wi=Zr,Ri())},void 0,!1,Fi):Wi={}}Ri()}}function Mt(Le,X,ie,de){let Me=new r.K(X,{brightness:ie});for(let Oe of Le)Oe.recalculate(Me,de)}class Ui extends r.E{constructor(X,ie,de,Me,Oe,qe){super(),this.actor=X,this.layerIndex=ie,this.availableImages=de,this.loadVectorData=Oe||r.ah,this.loading={},this.loaded={},this.deduped=new r.af(X.scheduler),this.isSpriteLoaded=Me,this.scheduler=X.scheduler,this.brightness=qe}loadTile(X,ie){let de=X.uid,Me=X&&X.request,Oe=Me&&Me.collectResourceTiming,qe=this.loading[de]=new $e(X);qe.abort=this.loadVectorData(X,(gt,Ee)=>{let bt=!this.loading[de];if(delete this.loading[de],bt||gt||!Ee)return qe.status="done",bt||(this.loaded[de]=qe),ie(gt);let ut=Ee.rawData,xt={};Ee.expires&&(xt.expires=Ee.expires),Ee.cacheControl&&(xt.cacheControl=Ee.cacheControl),qe.vectorTile=Ee.vectorTile||new r.dH(new r.dI(ut));let ni=()=>{qe.parse(qe.vectorTile,this.layerIndex,this.availableImages,this.actor,(Zi,sn)=>{if(Zi||!sn)return ie(Zi);let Wi={};if(Oe){let Fi=M(Me);Fi.length>0&&(Wi.resourceTiming=JSON.parse(JSON.stringify(Fi)))}ie(null,r.e({rawTileData:ut.slice(0)},sn,xt,Wi))})};this.isSpriteLoaded?ni():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(ni,{type:"parseTile",isSymbolTile:X.isSymbolTile,zoom:X.tileZoom}):ni()}),this.loaded=this.loaded||{},this.loaded[de]=qe})}reloadTile(X,ie){let de=this.loaded,Me=X.uid,Oe=this;if(de&&de[Me]){let qe=de[Me];qe.showCollisionBoxes=X.showCollisionBoxes,qe.projection=X.projection,qe.brightness=X.brightness,qe.tileTransform=r.as(X.tileID.canonical,X.projection),qe.extraShadowCaster=X.extraShadowCaster;let gt=(Ee,bt)=>{let ut=qe.reloadCallback;ut&&(delete qe.reloadCallback,qe.parse(qe.vectorTile,Oe.layerIndex,this.availableImages,Oe.actor,ut)),ie(Ee,bt)};qe.status==="parsing"?qe.reloadCallback=gt:qe.status==="done"&&(qe.vectorTile?qe.parse(qe.vectorTile,this.layerIndex,this.availableImages,this.actor,gt):gt())}else ie(null,void 0)}abortTile(X,ie){let de=X.uid,Me=this.loading[de];Me&&(Me.abort&&Me.abort(),delete this.loading[de]),ie()}removeTile(X,ie){let de=this.loaded,Me=X.uid;de&&de[Me]&&delete de[Me],ie()}}class Hi{loadTile(X,ie){let{uid:de,encoding:Me,rawImageData:Oe,padding:qe}=X,gt=ImageBitmap&&Oe instanceof ImageBitmap?this.getImageData(Oe,qe):Oe;ie(null,new r.dJ(de,gt,Me,qe<1))}getImageData(X,ie){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(X.width,X.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=X.width,this.offscreenCanvas.height=X.height,this.offscreenCanvasContext.drawImage(X,0,0,X.width,X.height);let de=this.offscreenCanvasContext.getImageData(-ie,-ie,X.width+2*ie,X.height+2*ie);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),de}}class mi{decodeRasterArray({task:X,buffer:ie},de){r.aZ.performDecoding(ie,X).then(Me=>{de(null,Me)},Me=>{de(Me)})}}function Yn(Le,X){if(Le.length!==0){$r(Le[0],X);for(var ie=1;ie<Le.length;ie++)$r(Le[ie],!X)}}function $r(Le,X){for(var ie=0,de=0,Me=0,Oe=Le.length,qe=Oe-1;Me<Oe;qe=Me++){var gt=(Le[Me][0]-Le[qe][0])*(Le[qe][1]+Le[Me][1]),Ee=ie+gt;de+=Math.abs(ie)>=Math.abs(gt)?ie-Ee+gt:gt-Ee+ie,ie=Ee}ie+de>=0!=!!X&&Le.reverse()}var qr=r.dK(function Le(X,ie){var de,Me=X&&X.type;if(Me==="FeatureCollection")for(de=0;de<X.features.length;de++)Le(X.features[de],ie);else if(Me==="GeometryCollection")for(de=0;de<X.geometries.length;de++)Le(X.geometries[de],ie);else if(Me==="Feature")Le(X.geometry,ie);else if(Me==="Polygon")Yn(X.coordinates,ie);else if(Me==="MultiPolygon")for(de=0;de<X.coordinates.length;de++)Yn(X.coordinates[de],ie);return X});let eo=r.dL.prototype.toGeoJSON,fo=class{constructor(Le){this._feature=Le,this.extent=r.V,this.type=Le.type,this.properties=Le.tags,"id"in Le&&!isNaN(Le.id)&&(this.id=parseInt(Le.id,10))}loadGeometry(){if(this._feature.type===1){let Le=[];for(let X of this._feature.geometry)Le.push([new r.P(X[0],X[1])]);return Le}{let Le=[];for(let X of this._feature.geometry){let ie=[];for(let de of X)ie.push(new r.P(de[0],de[1]));Le.push(ie)}return Le}}toGeoJSON(Le,X,ie){return eo.call(this,Le,X,ie)}},nt=class{constructor(Le){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=r.V,this.length=Le.length,this._features=Le}feature(Le){return new fo(this._features[Le])}};var Rs={exports:{}},_c=r.dN,vi=r.dM.VectorTileFeature,Mr=Sd;function Sd(Le,X){this.options=X||{},this.features=Le,this.length=Le.length}function lt(Le,X){this.id=typeof Le.id=="number"?Le.id:void 0,this.type=Le.type,this.rawGeometry=Le.type===1?[Le.geometry]:Le.geometry,this.properties=Le.tags,this.extent=X||4096}Sd.prototype.feature=function(Le){return new lt(this.features[Le],this.options.extent)},lt.prototype.loadGeometry=function(){var Le=this.rawGeometry;this.geometry=[];for(var X=0;X<Le.length;X++){for(var ie=Le[X],de=[],Me=0;Me<ie.length;Me++)de.push(new _c(ie[Me][0],ie[Me][1]));this.geometry.push(de)}return this.geometry},lt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Le=this.geometry,X=1/0,ie=-1/0,de=1/0,Me=-1/0,Oe=0;Oe<Le.length;Oe++)for(var qe=Le[Oe],gt=0;gt<qe.length;gt++){var Ee=qe[gt];X=Math.min(X,Ee.x),ie=Math.max(ie,Ee.x),de=Math.min(de,Ee.y),Me=Math.max(Me,Ee.y)}return[X,de,ie,Me]},lt.prototype.toGeoJSON=vi.prototype.toGeoJSON;var Ho=r.dO,Hr=Mr;function ii(Le){var X=new Ho;return function(ie,de){for(var Me in ie.layers)de.writeMessage(3,ml,ie.layers[Me])}(Le,X),X.finish()}function ml(Le,X){var ie;X.writeVarintField(15,Le.version||1),X.writeStringField(1,Le.name||""),X.writeVarintField(5,Le.extent||4096);var de={keys:[],values:[],keycache:{},valuecache:{}};for(ie=0;ie<Le.length;ie++)de.feature=Le.feature(ie),X.writeMessage(2,Ya,de);var Me=de.keys;for(ie=0;ie<Me.length;ie++)X.writeStringField(3,Me[ie]);var Oe=de.values;for(ie=0;ie<Oe.length;ie++)X.writeMessage(4,gc,Oe[ie])}function Ya(Le,X){var ie=Le.feature;ie.id!==void 0&&X.writeVarintField(1,ie.id),X.writeMessage(2,Zo,Le),X.writeVarintField(3,ie.type),X.writeMessage(4,pl,ie)}function Zo(Le,X){var ie=Le.feature,de=Le.keys,Me=Le.values,Oe=Le.keycache,qe=Le.valuecache;for(var gt in ie.properties){var Ee=ie.properties[gt],bt=Oe[gt];if(Ee!==null){bt===void 0&&(de.push(gt),Oe[gt]=bt=de.length-1),X.writeVarint(bt);var ut=typeof Ee;ut!=="string"&&ut!=="boolean"&&ut!=="number"&&(Ee=JSON.stringify(Ee));var xt=ut+":"+Ee,ni=qe[xt];ni===void 0&&(Me.push(Ee),qe[xt]=ni=Me.length-1),X.writeVarint(ni)}}}function Er(Le,X){return(X<<3)+(7&Le)}function Ls(Le){return Le<<1^Le>>31}function pl(Le,X){for(var ie=Le.loadGeometry(),de=Le.type,Me=0,Oe=0,qe=ie.length,gt=0;gt<qe;gt++){var Ee=ie[gt],bt=1;de===1&&(bt=Ee.length),X.writeVarint(Er(1,bt));for(var ut=de===3?Ee.length-1:Ee.length,xt=0;xt<ut;xt++){xt===1&&de!==1&&X.writeVarint(Er(2,ut-1));var ni=Ee[xt].x-Me,Zi=Ee[xt].y-Oe;X.writeVarint(Ls(ni)),X.writeVarint(Ls(Zi)),Me+=ni,Oe+=Zi}de===3&&X.writeVarint(Er(7,1))}}function gc(Le,X){var ie=typeof Le;ie==="string"?X.writeStringField(1,Le):ie==="boolean"?X.writeBooleanField(7,Le):ie==="number"&&(Le%1!=0?X.writeDoubleField(3,Le):Le<0?X.writeSVarintField(6,Le):X.writeVarintField(5,Le))}Rs.exports=ii,Rs.exports.fromVectorTileJs=ii,Rs.exports.fromGeojsonVt=function(Le,X){X=X||{};var ie={};for(var de in Le)ie[de]=new Hr(Le[de].features,X),ie[de].name=de,ie[de].version=X.version,ie[de].extent=X.extent;return ii({layers:ie})},Rs.exports.GeoJSONWrapper=Hr;var yc=r.dK(Rs.exports);let bc={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Le=>Le},zs=Math.fround||(Ia=new Float32Array(1),Le=>(Ia[0]=+Le,Ia[0]));var Ia;let Ar=3,So=5,_o=6;class Cd{constructor(X){this.options=Object.assign(Object.create(bc),X),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(X){let{log:ie,minZoom:de,maxZoom:Me}=this.options;ie&&console.time("total time");let Oe=`prepare ${X.length} points`;ie&&console.time(Oe),this.points=X;let qe=[];for(let Ee=0;Ee<X.length;Ee++){let bt=X[Ee];if(!bt.geometry)continue;let[ut,xt]=bt.geometry.coordinates,ni=zs(Os(ut)),Zi=zs(Sa(xt));qe.push(ni,Zi,1/0,Ee,-1,1),this.options.reduce&&qe.push(0)}let gt=this.trees[Me+1]=this._createTree(qe);ie&&console.timeEnd(Oe);for(let Ee=Me;Ee>=de;Ee--){let bt=+Date.now();gt=this.trees[Ee]=this._createTree(this._cluster(gt,Ee)),ie&&console.log("z%d: %d clusters in %dms",Ee,gt.numItems,+Date.now()-bt)}return ie&&console.timeEnd("total time"),this}getClusters(X,ie){let de=((X[0]+180)%360+360)%360-180,Me=Math.max(-90,Math.min(90,X[1])),Oe=X[2]===180?180:((X[2]+180)%360+360)%360-180,qe=Math.max(-90,Math.min(90,X[3]));if(X[2]-X[0]>=360)de=-180,Oe=180;else if(de>Oe){let xt=this.getClusters([de,Me,180,qe],ie),ni=this.getClusters([-180,Me,Oe,qe],ie);return xt.concat(ni)}let gt=this.trees[this._limitZoom(ie)],Ee=gt.range(Os(de),Sa(qe),Os(Oe),Sa(Me)),bt=gt.data,ut=[];for(let xt of Ee){let ni=this.stride*xt;ut.push(bt[ni+So]>1?Pn(bt,ni,this.clusterProps):this.points[bt[ni+Ar]])}return ut}getChildren(X){let ie=this._getOriginId(X),de=this._getOriginZoom(X),Me="No cluster with the specified id.",Oe=this.trees[de];if(!Oe)throw new Error(Me);let qe=Oe.data;if(ie*this.stride>=qe.length)throw new Error(Me);let gt=this.options.radius/(this.options.extent*Math.pow(2,de-1)),Ee=Oe.within(qe[ie*this.stride],qe[ie*this.stride+1],gt),bt=[];for(let ut of Ee){let xt=ut*this.stride;qe[xt+4]===X&&bt.push(qe[xt+So]>1?Pn(qe,xt,this.clusterProps):this.points[qe[xt+Ar]])}if(bt.length===0)throw new Error(Me);return bt}getLeaves(X,ie,de){let Me=[];return this._appendLeaves(Me,X,ie=ie||10,de=de||0,0),Me}getTile(X,ie,de){let Me=this.trees[this._limitZoom(X)],Oe=Math.pow(2,X),{extent:qe,radius:gt}=this.options,Ee=gt/qe,bt=(de-Ee)/Oe,ut=(de+1+Ee)/Oe,xt={features:[]};return this._addTileFeatures(Me.range((ie-Ee)/Oe,bt,(ie+1+Ee)/Oe,ut),Me.data,ie,de,Oe,xt),ie===0&&this._addTileFeatures(Me.range(1-Ee/Oe,bt,1,ut),Me.data,Oe,de,Oe,xt),ie===Oe-1&&this._addTileFeatures(Me.range(0,bt,Ee/Oe,ut),Me.data,-1,de,Oe,xt),xt.features.length?xt:null}getClusterExpansionZoom(X){let ie=this._getOriginZoom(X)-1;for(;ie<=this.options.maxZoom;){let de=this.getChildren(X);if(ie++,de.length!==1)break;X=de[0].properties.cluster_id}return ie}_appendLeaves(X,ie,de,Me,Oe){let qe=this.getChildren(ie);for(let gt of qe){let Ee=gt.properties;if(Ee&&Ee.cluster?Oe+Ee.point_count<=Me?Oe+=Ee.point_count:Oe=this._appendLeaves(X,Ee.cluster_id,de,Me,Oe):Oe<Me?Oe++:X.push(gt),X.length===de)break}return Oe}_createTree(X){let ie=new r.bg(X.length/this.stride|0,this.options.nodeSize,Float32Array);for(let de=0;de<X.length;de+=this.stride)ie.add(X[de],X[de+1]);return ie.finish(),ie.data=X,ie}_addTileFeatures(X,ie,de,Me,Oe,qe){for(let gt of X){let Ee=gt*this.stride,bt=ie[Ee+So]>1,ut,xt,ni;if(bt)ut=Co(ie,Ee,this.clusterProps),xt=ie[Ee],ni=ie[Ee+1];else{let Wi=this.points[ie[Ee+Ar]];ut=Wi.properties;let[Fi,Ri]=Wi.geometry.coordinates;xt=Os(Fi),ni=Sa(Ri)}let Zi={type:1,geometry:[[Math.round(this.options.extent*(xt*Oe-de)),Math.round(this.options.extent*(ni*Oe-Me))]],tags:ut},sn;sn=bt||this.options.generateId?ie[Ee+Ar]:this.points[ie[Ee+Ar]].id,sn!==void 0&&(Zi.id=sn),qe.features.push(Zi)}}_limitZoom(X){return Math.max(this.options.minZoom,Math.min(Math.floor(+X),this.options.maxZoom+1))}_cluster(X,ie){let{radius:de,extent:Me,reduce:Oe,minPoints:qe}=this.options,gt=de/(Me*Math.pow(2,ie)),Ee=X.data,bt=[],ut=this.stride;for(let xt=0;xt<Ee.length;xt+=ut){if(Ee[xt+2]<=ie)continue;Ee[xt+2]=ie;let ni=Ee[xt],Zi=Ee[xt+1],sn=X.within(Ee[xt],Ee[xt+1],gt),Wi=Ee[xt+So],Fi=Wi;for(let Ri of sn){let Gi=Ri*ut;Ee[Gi+2]>ie&&(Fi+=Ee[Gi+So])}if(Fi>Wi&&Fi>=qe){let Ri,Gi=ni*Wi,nn=Zi*Wi,dr=-1,an=(xt/ut<<5)+(ie+1)+this.points.length;for(let Zr of sn){let Br=Zr*ut;if(Ee[Br+2]<=ie)continue;Ee[Br+2]=ie;let to=Ee[Br+So];Gi+=Ee[Br]*to,nn+=Ee[Br+1]*to,Ee[Br+4]=an,Oe&&(Ri||(Ri=this._map(Ee,xt,!0),dr=this.clusterProps.length,this.clusterProps.push(Ri)),Oe(Ri,this._map(Ee,Br)))}Ee[xt+4]=an,bt.push(Gi/Fi,nn/Fi,1/0,an,-1,Fi),Oe&&bt.push(dr)}else{for(let Ri=0;Ri<ut;Ri++)bt.push(Ee[xt+Ri]);if(Fi>1)for(let Ri of sn){let Gi=Ri*ut;if(!(Ee[Gi+2]<=ie)){Ee[Gi+2]=ie;for(let nn=0;nn<ut;nn++)bt.push(Ee[Gi+nn])}}}}return bt}_getOriginId(X){return X-this.points.length>>5}_getOriginZoom(X){return(X-this.points.length)%32}_map(X,ie,de){if(X[ie+So]>1){let qe=this.clusterProps[X[ie+_o]];return de?Object.assign({},qe):qe}let Me=this.points[X[ie+Ar]].properties,Oe=this.options.map(Me);return de&&Oe===Me?Object.assign({},Oe):Oe}}function Pn(Le,X,ie){return{type:"Feature",id:Le[X+Ar],properties:Co(Le,X,ie),geometry:{type:"Point",coordinates:[(de=Le[X],360*(de-.5)),pa(Le[X+1])]}};var de}function Co(Le,X,ie){let de=Le[X+So],Me=de>=1e4?`${Math.round(de/1e3)}k`:de>=1e3?Math.round(de/100)/10+"k":de,Oe=Le[X+_o],qe=Oe===-1?{}:Object.assign({},ie[Oe]);return Object.assign(qe,{cluster:!0,cluster_id:Le[X+Ar],point_count:de,point_count_abbreviated:Me})}function Os(Le){return Le/360+.5}function Sa(Le){let X=Math.sin(Le*Math.PI/180),ie=.5-.25*Math.log((1+X)/(1-X))/Math.PI;return ie<0?0:ie>1?1:ie}function pa(Le){let X=(180-360*Le)*Math.PI/180;return 360*Math.atan(Math.exp(X))/Math.PI-90}var Fs={exports:{}};Fs.exports=function(){function Le(Ce,Ae,He,tt){for(var Ke,ot=tt,at=He-Ae>>1,Je=He-Ae,ct=Ce[Ae],it=Ce[Ae+1],Ft=Ce[He],pi=Ce[He+1],kt=Ae+3;kt<He;kt+=3){var Qi=X(Ce[kt],Ce[kt+1],ct,it,Ft,pi);if(Qi>ot)Ke=kt,ot=Qi;else if(Qi===ot){var un=Math.abs(kt-at);un<Je&&(Ke=kt,Je=un)}}ot>tt&&(Ke-Ae>3&&Le(Ce,Ae,Ke,tt),Ce[Ke+2]=ot,He-Ke>3&&Le(Ce,Ke,He,tt))}function X(Ce,Ae,He,tt,Ke,ot){var at=Ke-He,Je=ot-tt;if(at!==0||Je!==0){var ct=((Ce-He)*at+(Ae-tt)*Je)/(at*at+Je*Je);ct>1?(He=Ke,tt=ot):ct>0&&(He+=at*ct,tt+=Je*ct)}return(at=Ce-He)*at+(Je=Ae-tt)*Je}function ie(Ce,Ae,He,tt){var Ke={id:Ce===void 0?null:Ce,type:Ae,geometry:He,tags:tt,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ot){var at=ot.geometry,Je=ot.type;if(Je==="Point"||Je==="MultiPoint"||Je==="LineString")de(ot,at);else if(Je==="Polygon"||Je==="MultiLineString")for(var ct=0;ct<at.length;ct++)de(ot,at[ct]);else if(Je==="MultiPolygon")for(ct=0;ct<at.length;ct++)for(var it=0;it<at[ct].length;it++)de(ot,at[ct][it])}(Ke),Ke}function de(Ce,Ae){for(var He=0;He<Ae.length;He+=3)Ce.minX=Math.min(Ce.minX,Ae[He]),Ce.minY=Math.min(Ce.minY,Ae[He+1]),Ce.maxX=Math.max(Ce.maxX,Ae[He]),Ce.maxY=Math.max(Ce.maxY,Ae[He+1])}function Me(Ce,Ae,He,tt){if(Ae.geometry){var Ke=Ae.geometry.coordinates,ot=Ae.geometry.type,at=Math.pow(He.tolerance/((1<<He.maxZoom)*He.extent),2),Je=[],ct=Ae.id;if(He.promoteId?ct=Ae.properties[He.promoteId]:He.generateId&&(ct=tt||0),ot==="Point")Oe(Ke,Je);else if(ot==="MultiPoint")for(var it=0;it<Ke.length;it++)Oe(Ke[it],Je);else if(ot==="LineString")qe(Ke,Je,at,!1);else if(ot==="MultiLineString"){if(He.lineMetrics){for(it=0;it<Ke.length;it++)qe(Ke[it],Je=[],at,!1),Ce.push(ie(ct,"LineString",Je,Ae.properties));return}gt(Ke,Je,at,!1)}else if(ot==="Polygon")gt(Ke,Je,at,!0);else{if(ot!=="MultiPolygon"){if(ot==="GeometryCollection"){for(it=0;it<Ae.geometry.geometries.length;it++)Me(Ce,{id:ct,geometry:Ae.geometry.geometries[it],properties:Ae.properties},He,tt);return}throw new Error("Input data is not a valid GeoJSON object.")}for(it=0;it<Ke.length;it++){var Ft=[];gt(Ke[it],Ft,at,!0),Je.push(Ft)}}Ce.push(ie(ct,ot,Je,Ae.properties))}}function Oe(Ce,Ae){Ae.push(Ee(Ce[0])),Ae.push(bt(Ce[1])),Ae.push(0)}function qe(Ce,Ae,He,tt){for(var Ke,ot,at=0,Je=0;Je<Ce.length;Je++){var ct=Ee(Ce[Je][0]),it=bt(Ce[Je][1]);Ae.push(ct),Ae.push(it),Ae.push(0),Je>0&&(at+=tt?(Ke*it-ct*ot)/2:Math.sqrt(Math.pow(ct-Ke,2)+Math.pow(it-ot,2))),Ke=ct,ot=it}var Ft=Ae.length-3;Ae[2]=1,Le(Ae,0,Ft,He),Ae[Ft+2]=1,Ae.size=Math.abs(at),Ae.start=0,Ae.end=Ae.size}function gt(Ce,Ae,He,tt){for(var Ke=0;Ke<Ce.length;Ke++){var ot=[];qe(Ce[Ke],ot,He,tt),Ae.push(ot)}}function Ee(Ce){return Ce/360+.5}function bt(Ce){var Ae=Math.sin(Ce*Math.PI/180),He=.5-.25*Math.log((1+Ae)/(1-Ae))/Math.PI;return He<0?0:He>1?1:He}function ut(Ce,Ae,He,tt,Ke,ot,at,Je){if(tt/=Ae,ot>=(He/=Ae)&&at<tt)return Ce;if(at<He||ot>=tt)return null;for(var ct=[],it=0;it<Ce.length;it++){var Ft=Ce[it],pi=Ft.geometry,kt=Ft.type,Qi=Ke===0?Ft.minX:Ft.minY,un=Ke===0?Ft.maxX:Ft.maxY;if(Qi>=He&&un<tt)ct.push(Ft);else if(!(un<He||Qi>=tt)){var Mn=[];if(kt==="Point"||kt==="MultiPoint")xt(pi,Mn,He,tt,Ke);else if(kt==="LineString")ni(pi,Mn,He,tt,Ke,!1,Je.lineMetrics);else if(kt==="MultiLineString")sn(pi,Mn,He,tt,Ke,!1);else if(kt==="Polygon")sn(pi,Mn,He,tt,Ke,!0);else if(kt==="MultiPolygon")for(var Qn=0;Qn<pi.length;Qn++){var wr=[];sn(pi[Qn],wr,He,tt,Ke,!0),wr.length&&Mn.push(wr)}if(Mn.length){if(Je.lineMetrics&&kt==="LineString"){for(Qn=0;Qn<Mn.length;Qn++)ct.push(ie(Ft.id,kt,Mn[Qn],Ft.tags));continue}kt!=="LineString"&&kt!=="MultiLineString"||(Mn.length===1?(kt="LineString",Mn=Mn[0]):kt="MultiLineString"),kt!=="Point"&&kt!=="MultiPoint"||(kt=Mn.length===3?"Point":"MultiPoint"),ct.push(ie(Ft.id,kt,Mn,Ft.tags))}}}return ct.length?ct:null}function xt(Ce,Ae,He,tt,Ke){for(var ot=0;ot<Ce.length;ot+=3){var at=Ce[ot+Ke];at>=He&&at<=tt&&(Ae.push(Ce[ot]),Ae.push(Ce[ot+1]),Ae.push(Ce[ot+2]))}}function ni(Ce,Ae,He,tt,Ke,ot,at){for(var Je,ct,it=Zi(Ce),Ft=Ke===0?Fi:Ri,pi=Ce.start,kt=0;kt<Ce.length-3;kt+=3){var Qi=Ce[kt],un=Ce[kt+1],Mn=Ce[kt+2],Qn=Ce[kt+3],wr=Ce[kt+4],Ai=Ke===0?Qi:un,go=Ke===0?Qn:wr,Wo=!1;at&&(Je=Math.sqrt(Math.pow(Qi-Qn,2)+Math.pow(un-wr,2))),Ai<He?go>He&&(ct=Ft(it,Qi,un,Qn,wr,He),at&&(it.start=pi+Je*ct)):Ai>tt?go<tt&&(ct=Ft(it,Qi,un,Qn,wr,tt),at&&(it.start=pi+Je*ct)):Wi(it,Qi,un,Mn),go<He&&Ai>=He&&(ct=Ft(it,Qi,un,Qn,wr,He),Wo=!0),go>tt&&Ai<=tt&&(ct=Ft(it,Qi,un,Qn,wr,tt),Wo=!0),!ot&&Wo&&(at&&(it.end=pi+Je*ct),Ae.push(it),it=Zi(Ce)),at&&(pi+=Je)}var Tr=Ce.length-3;Qi=Ce[Tr],un=Ce[Tr+1],Mn=Ce[Tr+2],(Ai=Ke===0?Qi:un)>=He&&Ai<=tt&&Wi(it,Qi,un,Mn),Tr=it.length-3,ot&&Tr>=3&&(it[Tr]!==it[0]||it[Tr+1]!==it[1])&&Wi(it,it[0],it[1],it[2]),it.length&&Ae.push(it)}function Zi(Ce){var Ae=[];return Ae.size=Ce.size,Ae.start=Ce.start,Ae.end=Ce.end,Ae}function sn(Ce,Ae,He,tt,Ke,ot){for(var at=0;at<Ce.length;at++)ni(Ce[at],Ae,He,tt,Ke,ot,!1)}function Wi(Ce,Ae,He,tt){Ce.push(Ae),Ce.push(He),Ce.push(tt)}function Fi(Ce,Ae,He,tt,Ke,ot){var at=(ot-Ae)/(tt-Ae);return Ce.push(ot),Ce.push(He+(Ke-He)*at),Ce.push(1),at}function Ri(Ce,Ae,He,tt,Ke,ot){var at=(ot-He)/(Ke-He);return Ce.push(Ae+(tt-Ae)*at),Ce.push(ot),Ce.push(1),at}function Gi(Ce,Ae){for(var He=[],tt=0;tt<Ce.length;tt++){var Ke,ot=Ce[tt],at=ot.type;if(at==="Point"||at==="MultiPoint"||at==="LineString")Ke=nn(ot.geometry,Ae);else if(at==="MultiLineString"||at==="Polygon"){Ke=[];for(var Je=0;Je<ot.geometry.length;Je++)Ke.push(nn(ot.geometry[Je],Ae))}else if(at==="MultiPolygon")for(Ke=[],Je=0;Je<ot.geometry.length;Je++){for(var ct=[],it=0;it<ot.geometry[Je].length;it++)ct.push(nn(ot.geometry[Je][it],Ae));Ke.push(ct)}He.push(ie(ot.id,at,Ke,ot.tags))}return He}function nn(Ce,Ae){var He=[];He.size=Ce.size,Ce.start!==void 0&&(He.start=Ce.start,He.end=Ce.end);for(var tt=0;tt<Ce.length;tt+=3)He.push(Ce[tt]+Ae,Ce[tt+1],Ce[tt+2]);return He}function dr(Ce,Ae){if(Ce.transformed)return Ce;var He,tt,Ke,ot=1<<Ce.z,at=Ce.x,Je=Ce.y;for(He=0;He<Ce.features.length;He++){var ct=Ce.features[He],it=ct.geometry,Ft=ct.type;if(ct.geometry=[],Ft===1)for(tt=0;tt<it.length;tt+=2)ct.geometry.push(an(it[tt],it[tt+1],Ae,ot,at,Je));else for(tt=0;tt<it.length;tt++){var pi=[];for(Ke=0;Ke<it[tt].length;Ke+=2)pi.push(an(it[tt][Ke],it[tt][Ke+1],Ae,ot,at,Je));ct.geometry.push(pi)}}return Ce.transformed=!0,Ce}function an(Ce,Ae,He,tt,Ke,ot){return[Math.round(He*(Ce*tt-Ke)),Math.round(He*(Ae*tt-ot))]}function Zr(Ce,Ae,He,tt,Ke){for(var ot=Ae===Ke.maxZoom?0:Ke.tolerance/((1<<Ae)*Ke.extent),at={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:He,y:tt,z:Ae,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Je=0;Je<Ce.length;Je++){at.numFeatures++,Br(at,Ce[Je],ot,Ke);var ct=Ce[Je].minX,it=Ce[Je].minY,Ft=Ce[Je].maxX,pi=Ce[Je].maxY;ct<at.minX&&(at.minX=ct),it<at.minY&&(at.minY=it),Ft>at.maxX&&(at.maxX=Ft),pi>at.maxY&&(at.maxY=pi)}return at}function Br(Ce,Ae,He,tt){var Ke=Ae.geometry,ot=Ae.type,at=[];if(ot==="Point"||ot==="MultiPoint")for(var Je=0;Je<Ke.length;Je+=3)at.push(Ke[Je]),at.push(Ke[Je+1]),Ce.numPoints++,Ce.numSimplified++;else if(ot==="LineString")to(at,Ke,Ce,He,!1,!1);else if(ot==="MultiLineString"||ot==="Polygon")for(Je=0;Je<Ke.length;Je++)to(at,Ke[Je],Ce,He,ot==="Polygon",Je===0);else if(ot==="MultiPolygon")for(var ct=0;ct<Ke.length;ct++){var it=Ke[ct];for(Je=0;Je<it.length;Je++)to(at,it[Je],Ce,He,!0,Je===0)}if(at.length){var Ft=Ae.tags||null;if(ot==="LineString"&&tt.lineMetrics){for(var pi in Ft={},Ae.tags)Ft[pi]=Ae.tags[pi];Ft.mapbox_clip_start=Ke.start/Ke.size,Ft.mapbox_clip_end=Ke.end/Ke.size}var kt={geometry:at,type:ot==="Polygon"||ot==="MultiPolygon"?3:ot==="LineString"||ot==="MultiLineString"?2:1,tags:Ft};Ae.id!==null&&(kt.id=Ae.id),Ce.features.push(kt)}}function to(Ce,Ae,He,tt,Ke,ot){var at=tt*tt;if(tt>0&&Ae.size<(Ke?at:tt))He.numPoints+=Ae.length/3;else{for(var Je=[],ct=0;ct<Ae.length;ct+=3)(tt===0||Ae[ct+2]>at)&&(He.numSimplified++,Je.push(Ae[ct]),Je.push(Ae[ct+1])),He.numPoints++;Ke&&function(it,Ft){for(var pi=0,kt=0,Qi=it.length,un=Qi-2;kt<Qi;un=kt,kt+=2)pi+=(it[kt]-it[un])*(it[kt+1]+it[un+1]);if(pi>0===Ft)for(kt=0,Qi=it.length;kt<Qi/2;kt+=2){var Mn=it[kt],Qn=it[kt+1];it[kt]=it[Qi-2-kt],it[kt+1]=it[Qi-1-kt],it[Qi-2-kt]=Mn,it[Qi-1-kt]=Qn}}(Je,ot),Ce.push(Je)}}function Kn(Ce,Ae){var He=(Ae=this.options=function(Ke,ot){for(var at in ot)Ke[at]=ot[at];return Ke}(Object.create(this.options),Ae)).debug;if(He&&console.time("preprocess data"),Ae.maxZoom<0||Ae.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Ae.promoteId&&Ae.generateId)throw new Error("promoteId and generateId cannot be used together.");var tt=function(Ke,ot){var at=[];if(Ke.type==="FeatureCollection")for(var Je=0;Je<Ke.features.length;Je++)Me(at,Ke.features[Je],ot,Je);else Me(at,Ke.type==="Feature"?Ke:{geometry:Ke},ot);return at}(Ce,Ae);this.tiles={},this.tileCoords=[],He&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Ae.indexMaxZoom,Ae.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(tt=function(Ke,ot){var at=ot.buffer/ot.extent,Je=Ke,ct=ut(Ke,1,-1-at,at,0,-1,2,ot),it=ut(Ke,1,1-at,2+at,0,-1,2,ot);return(ct||it)&&(Je=ut(Ke,1,-at,1+at,0,-1,2,ot)||[],ct&&(Je=Gi(ct,1).concat(Je)),it&&(Je=Je.concat(Gi(it,-1)))),Je}(tt,Ae)).length&&this.splitTile(tt,0,0,0),He&&(tt.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Zn(Ce,Ae,He){return 32*((1<<Ce)*He+Ae)+Ce}return Kn.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Kn.prototype.splitTile=function(Ce,Ae,He,tt,Ke,ot,at){for(var Je=[Ce,Ae,He,tt],ct=this.options,it=ct.debug;Je.length;){tt=Je.pop(),He=Je.pop(),Ae=Je.pop(),Ce=Je.pop();var Ft=1<<Ae,pi=Zn(Ae,He,tt),kt=this.tiles[pi];if(!kt&&(it>1&&console.time("creation"),kt=this.tiles[pi]=Zr(Ce,Ae,He,tt,ct),this.tileCoords.push({z:Ae,x:He,y:tt}),it)){it>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Ae,He,tt,kt.numFeatures,kt.numPoints,kt.numSimplified),console.timeEnd("creation"));var Qi="z"+Ae;this.stats[Qi]=(this.stats[Qi]||0)+1,this.total++}if(kt.source=Ce,Ke){if(Ae===ct.maxZoom||Ae===Ke)continue;var un=1<<Ke-Ae;if(He!==Math.floor(ot/un)||tt!==Math.floor(at/un))continue}else if(Ae===ct.indexMaxZoom||kt.numPoints<=ct.indexMaxPoints)continue;if(kt.source=null,Ce.length!==0){it>1&&console.time("clipping");var Mn,Qn,wr,Ai,go,Wo,Tr=.5*ct.buffer/ct.extent,vc=.5-Tr,Qa=.5+Tr,gl=1+Tr;Mn=Qn=wr=Ai=null,go=ut(Ce,Ft,He-Tr,He+Qa,0,kt.minX,kt.maxX,ct),Wo=ut(Ce,Ft,He+vc,He+gl,0,kt.minX,kt.maxX,ct),Ce=null,go&&(Mn=ut(go,Ft,tt-Tr,tt+Qa,1,kt.minY,kt.maxY,ct),Qn=ut(go,Ft,tt+vc,tt+gl,1,kt.minY,kt.maxY,ct),go=null),Wo&&(wr=ut(Wo,Ft,tt-Tr,tt+Qa,1,kt.minY,kt.maxY,ct),Ai=ut(Wo,Ft,tt+vc,tt+gl,1,kt.minY,kt.maxY,ct),Wo=null),it>1&&console.timeEnd("clipping"),Je.push(Mn||[],Ae+1,2*He,2*tt),Je.push(Qn||[],Ae+1,2*He,2*tt+1),Je.push(wr||[],Ae+1,2*He+1,2*tt),Je.push(Ai||[],Ae+1,2*He+1,2*tt+1)}}},Kn.prototype.getTile=function(Ce,Ae,He){var tt=this.options,Ke=tt.extent,ot=tt.debug;if(Ce<0||Ce>24)return null;var at=1<<Ce,Je=Zn(Ce,Ae=(Ae%at+at)%at,He);if(this.tiles[Je])return dr(this.tiles[Je],Ke);ot>1&&console.log("drilling down to z%d-%d-%d",Ce,Ae,He);for(var ct,it=Ce,Ft=Ae,pi=He;!ct&&it>0;)it--,Ft=Math.floor(Ft/2),pi=Math.floor(pi/2),ct=this.tiles[Zn(it,Ft,pi)];return ct&&ct.source?(ot>1&&console.log("found parent tile z%d-%d-%d",it,Ft,pi),ot>1&&console.time("drilling down"),this.splitTile(ct.source,it,Ft,pi,Ce,Ae,He),ot>1&&console.timeEnd("drilling down"),this.tiles[Je]?dr(this.tiles[Je],Ke):null):null},function(Ce,Ae){return new Kn(Ce,Ae)}}();var Hn=r.dK(Fs.exports);function fl(Le,X){let ie=Le.tileID.canonical;if(!this._geoJSONIndex)return X(null,null);let de=this._geoJSONIndex.getTile(ie.z,ie.x,ie.y);if(!de)return X(null,null);let Me=new nt(de.features),Oe=yc(Me);Oe.byteOffset===0&&Oe.byteLength===Oe.buffer.byteLength||(Oe=new Uint8Array(Oe)),X(null,{vectorTile:Me,rawData:Oe.buffer})}class _l extends Ui{constructor(X,ie,de,Me,Oe,qe){super(X,ie,de,Me,fl,qe),Oe&&(this.loadGeoJSON=Oe)}loadData(X,ie){let de=X&&X.request,Me=de&&de.collectResourceTiming;this.loadGeoJSON(X,(Oe,qe)=>{if(Oe||!qe)return ie(Oe);if(typeof qe!="object")return ie(new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`));{qr(qe,!0);try{if(X.filter){let Ee=r.r(X.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ee.result==="error")throw new Error(Ee.value.map(ut=>`${ut.key}: ${ut.message}`).join(", "));qe={type:"FeatureCollection",features:qe.features.filter(ut=>Ee.value.evaluate({zoom:0},ut))}}this._geoJSONIndex=X.cluster?new Cd(function({superclusterOptions:Ee,clusterProperties:bt}){if(!bt||!Ee)return Ee;let ut={},xt={},ni={accumulated:null,zoom:0},Zi={properties:null},sn=Object.keys(bt);for(let Wi of sn){let[Fi,Ri]=bt[Wi],Gi=r.r(Ri),nn=r.r(typeof Fi=="string"?[Fi,["accumulated"],["get",Wi]]:Fi);ut[Wi]=Gi.value,xt[Wi]=nn.value}return Ee.map=Wi=>{Zi.properties=Wi;let Fi={};for(let Ri of sn)Fi[Ri]=ut[Ri].evaluate(ni,Zi);return Fi},Ee.reduce=(Wi,Fi)=>{Zi.properties=Fi;for(let Ri of sn)ni.accumulated=Wi[Ri],Wi[Ri]=xt[Ri].evaluate(ni,Zi)},Ee}(X)).load(qe.features):Hn(qe,X.geojsonVtOptions)}catch(Ee){return ie(Ee)}this.loaded={};let gt={};if(Me){let Ee=M(de);Ee&&(gt.resourceTiming={},gt.resourceTiming[X.source]=JSON.parse(JSON.stringify(Ee)))}ie(null,gt)}})}reloadTile(X,ie){let de=this.loaded;return de&&de[X.uid]?super.reloadTile(X,ie):this.loadTile(X,ie)}loadGeoJSON(X,ie){if(X.request)r.g(X.request,ie);else{if(typeof X.data!="string")return ie(new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`));try{return ie(null,JSON.parse(X.data))}catch{return ie(new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(X,ie){try{ie(null,this._geoJSONIndex.getClusterExpansionZoom(X.clusterId))}catch(de){ie(de)}}getClusterChildren(X,ie){try{ie(null,this._geoJSONIndex.getChildren(X.clusterId))}catch(de){ie(de)}}getClusterLeaves(X,ie){try{ie(null,this._geoJSONIndex.getLeaves(X.clusterId,X.limit,X.offset))}catch(de){ie(de)}}}class Mo{constructor(X,ie){this.tileID=new r.am(X.tileID.overscaledZ,X.tileID.wrap,X.tileID.canonical.z,X.tileID.canonical.x,X.tileID.canonical.y),this.tileZoom=X.tileZoom,this.uid=X.uid,this.zoom=X.zoom,this.canonical=X.tileID.canonical,this.pixelRatio=X.pixelRatio,this.tileSize=X.tileSize,this.source=X.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=X.projection,this.brightness=ie}parse(X,ie,de,Me){this.status="parsing";let Oe=new r.am(de.tileID.overscaledZ,de.tileID.wrap,de.tileID.canonical.z,de.tileID.canonical.x,de.tileID.canonical.y),qe={},gt=ie.familiesBySource[de.source],Ee=new r.dC(Oe,de.promoteId);return Ee.bucketLayerIDs=[],Ee.is3DTile=!0,r.dP(X).then(bt=>{if(!bt)return Me(new Error("Could not parse tile"));let ut=r.dQ(bt,1/r.bR(de.tileID.canonical)),xt=bt.json.extensionsUsed&&bt.json.extensionsUsed.includes("MAPBOX_mesh_features")||bt.json.asset.extras&&bt.json.asset.extras.MAPBOX_mesh_features,ni=bt.json.extensionsUsed&&bt.json.extensionsUsed.includes("EXT_meshopt_compression"),Zi=new r.K(this.zoom,{brightness:this.brightness});for(let sn in gt)for(let Wi of gt[sn]){let Fi=Wi[0];Ee.bucketLayerIDs.push(Wi.map(Gi=>Gi.id)),Fi.recalculate(Zi,[]);let Ri=new r.dR(ut,Oe,xt,ni,this.brightness,Ee);xt||(Ri.needsUpload=!0),qe[Fi.fqid]=Ri,Ri.evaluate(Fi)}this.status="done",Me(null,{buckets:qe,featureIndex:Ee})}).catch(bt=>Me(new Error(bt.message)))}}class Ca{constructor(X,ie,de,Me,Oe,qe){this.actor=X,this.layerIndex=ie,this.brightness=qe,this.loading={},this.loaded={}}loadTile(X,ie){let de=X.uid,Me=this.loading[de]=new Mo(X,this.brightness);r.a_(X.request,(Oe,qe)=>{let gt=!this.loading[de];return delete this.loading[de],gt||Oe?(Me.status="done",gt||(this.loaded[de]=Me),ie(Oe)):qe&&qe.byteLength!==0?void Me.parse(qe,this.layerIndex,X,(Ee,bt)=>{Me.status="done",this.loaded=this.loaded||{},this.loaded[de]=Me,Ee||!bt?ie(Ee):ie(null,bt)}):(Me.status="done",this.loaded[de]=Me,ie())})}reloadTile(X,ie){let de=this.loaded,Me=X.uid;if(de&&de[Me]){let Oe=de[Me];Oe.projection=X.projection,Oe.brightness=X.brightness;let qe=(gt,Ee)=>{Oe.reloadCallback&&(delete Oe.reloadCallback,this.loadTile(X,ie)),ie(gt,Ee)};Oe.status==="parsing"?Oe.reloadCallback=qe:Oe.status==="done"&&this.loadTile(X,ie)}}abortTile(X,ie){let de=X.uid;this.loading[de]&&delete this.loading[de],ie()}removeTile(X,ie){let de=this.loaded,Me=X.uid;de&&de[Me]&&delete de[Me],ie()}}class Ka{constructor(X){this.self=X,this.actor=new r.dS(X,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=r.bo({name:"mercator"}),this.workerSourceTypes={vector:Ui,geojson:_l,"batched-model":Ca},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(ie,de)=>{if(this.workerSourceTypes[ie])throw new Error(`Worker source with name "${ie}" already registered.`);this.workerSourceTypes[ie]=de},this.self.registerRTLTextPlugin=ie=>{if(r.dT.isParsed())throw new Error("RTL text plugin already registered.");r.dT.applyArabicShaping=ie.applyArabicShaping,r.dT.processBidirectionalText=ie.processBidirectionalText,r.dT.processStyledBidirectionalText=ie.processStyledBidirectionalText}}clearCaches(X,ie,de){delete this.layerIndexes[X],delete this.availableImages[X],delete this.workerSources[X],delete this.demWorkerSources[X],delete this.rasterArrayWorkerSource,de()}checkIfReady(X,ie,de){de()}setReferrer(X,ie){this.referrer=ie}spriteLoaded(X,{scope:ie,isLoaded:de}){if(this.isSpriteLoaded[X]||(this.isSpriteLoaded[X]={}),this.isSpriteLoaded[X][ie]=de,this.workerSources[X]&&this.workerSources[X][ie])for(let Me in this.workerSources[X][ie]){let Oe=this.workerSources[X][ie][Me];for(let qe in Oe)Oe[qe]instanceof Ui&&(Oe[qe].isSpriteLoaded=de,Oe[qe].fire(new r.b("isSpriteLoaded")))}}setImages(X,{scope:ie,images:de},Me){if(this.availableImages[X]||(this.availableImages[X]={}),this.availableImages[X][ie]=de,this.workerSources[X]&&this.workerSources[X][ie]){for(let Oe in this.workerSources[X][ie]){let qe=this.workerSources[X][ie][Oe];for(let gt in qe)qe[gt].availableImages=de}Me()}else Me()}setProjection(X,ie){this.projections[X]=r.bo(ie)}setBrightness(X,ie,de){this.brightness=ie,de()}setLayers(X,ie,de){this.getLayerIndex(X,ie.scope).replace(ie.layers,ie.options),de()}updateLayers(X,ie,de){this.getLayerIndex(X,ie.scope).update(ie.layers,ie.removedIds,ie.options),de()}loadTile(X,ie,de){ie.projection=this.projections[X]||this.defaultProjection,this.getWorkerSource(X,ie.type,ie.source,ie.scope).loadTile(ie,de)}loadDEMTile(X,ie,de){this.getDEMWorkerSource(X,ie.source,ie.scope).loadTile(ie,de)}decodeRasterArray(X,ie,de){this.getRasterArrayWorkerSource().decodeRasterArray(ie,de)}reloadTile(X,ie,de){ie.projection=this.projections[X]||this.defaultProjection,this.getWorkerSource(X,ie.type,ie.source,ie.scope).reloadTile(ie,de)}abortTile(X,ie,de){this.getWorkerSource(X,ie.type,ie.source,ie.scope).abortTile(ie,de)}removeTile(X,ie,de){this.getWorkerSource(X,ie.type,ie.source,ie.scope).removeTile(ie,de)}removeSource(X,ie,de){if(!(this.workerSources[X]&&this.workerSources[X][ie.scope]&&this.workerSources[X][ie.scope][ie.type]&&this.workerSources[X][ie.scope][ie.type][ie.source]))return;let Me=this.workerSources[X][ie.scope][ie.type][ie.source];delete this.workerSources[X][ie.scope][ie.type][ie.source],Me.removeSource!==void 0?Me.removeSource(ie,de):de()}loadWorkerSource(X,ie,de){try{this.self.importScripts(ie.url),de()}catch(Me){de(Me.toString())}}syncRTLPluginState(X,ie,de){try{r.dT.setState(ie);let Me=r.dT.getPluginURL();if(r.dT.isLoaded()&&!r.dT.isParsed()&&Me!=null){this.self.importScripts(Me);let Oe=r.dT.isParsed();de(Oe?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Me}`),Oe)}}catch(Me){de(Me.toString())}}setDracoUrl(X,ie){this.dracoUrl=ie}getAvailableImages(X,ie){this.availableImages[X]||(this.availableImages[X]={});let de=this.availableImages[X][ie];return de||(de=[]),de}getLayerIndex(X,ie){this.layerIndexes[X]||(this.layerIndexes[X]={});let de=this.layerIndexes[X][ie];return de||(de=this.layerIndexes[X][ie]=new re,de.scope=ie),de}getWorkerSource(X,ie,de,Me){if(this.workerSources[X]||(this.workerSources[X]={}),this.workerSources[X][Me]||(this.workerSources[X][Me]={}),this.workerSources[X][Me][ie]||(this.workerSources[X][Me][ie]={}),this.isSpriteLoaded[X]||(this.isSpriteLoaded[X]={}),!this.workerSources[X][Me][ie][de]){let Oe={send:(qe,gt,Ee,bt,ut,xt)=>{this.actor.send(qe,gt,Ee,X,ut,xt)},scheduler:this.actor.scheduler};this.workerSources[X][Me][ie][de]=new this.workerSourceTypes[ie](Oe,this.getLayerIndex(X,Me),this.getAvailableImages(X,Me),this.isSpriteLoaded[X][Me],void 0,this.brightness)}return this.workerSources[X][Me][ie][de]}getDEMWorkerSource(X,ie,de){return this.demWorkerSources[X]||(this.demWorkerSources[X]={}),this.demWorkerSources[X][de]||(this.demWorkerSources[X][de]={}),this.demWorkerSources[X][de][ie]||(this.demWorkerSources[X][de][ie]=new Hi),this.demWorkerSources[X][de][ie]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new mi),this.rasterArrayWorkerSource}enforceCacheSizeLimit(X,ie){r.dU(ie)}getWorkerPerformanceMetrics(X,ie,de){de(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Ka(self)),Ka}),u(["./shared"],function(r){"use strict";function M(c,n){if(Array.isArray(c)){if(!Array.isArray(n)||c.length!==n.length)return!1;for(let a=0;a<c.length;a++)if(!M(c[a],n[a]))return!1;return!0}if(typeof c=="object"&&c!==null&&n!==null){if(typeof n!="object"||Object.keys(c).length!==Object.keys(n).length)return!1;for(let a in c)if(!M(c[a],n[a]))return!1;return!0}return c===n}var F=q;function q(c){return!function(n){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var d,p,g=new Blob([""],{type:"text/javascript"}),v=URL.createObjectURL(g);try{p=new Worker(v),d=!0}catch{d=!1}return p&&p.terminate(),URL.revokeObjectURL(v),d}()?function(){var d=document.createElement("canvas");d.width=d.height=1;var p=d.getContext("2d");if(!p)return!1;var g=p.getImageData(0,0,1,1);return g&&g.width===d.width}()?(re[a=n&&n.failIfMajorPerformanceCaveat]===void 0&&(re[a]=function(d){var p,g=function(v){var k=document.createElement("canvas"),S=Object.create(q.webGLContextAttributes);return S.failIfMajorPerformanceCaveat=v,k.getContext("webgl2",S)}(d);if(!g)return!1;try{p=g.createShader(g.VERTEX_SHADER)}catch{return!1}return!(!p||g.isContextLost())&&(g.shaderSource(p,"void main() {}"),g.compileShader(p),g.getShaderParameter(p,g.COMPILE_STATUS)===!0)}(a)),re[a]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var a}(c)}var re={};function me(c,n,a){let d=document.createElement(c);return n!=null&&(d.className=n),a&&a.appendChild(d),d}function De(c,n,a){let d=document.createElementNS("http://www.w3.org/2000/svg",c);for(let p of Object.keys(n))d.setAttributeNS(null,p,String(n[p]));return a&&a.appendChild(d),d}q.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};let $e=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Mt=$e&&$e.userSelect!==void 0?"userSelect":"WebkitUserSelect",Ui;function Hi(){$e&&Mt&&(Ui=$e[Mt],$e[Mt]="none")}function mi(){$e&&Mt&&($e[Mt]=Ui)}function Yn(c){c.preventDefault(),c.stopPropagation(),window.removeEventListener("click",Yn,!0)}function $r(){window.addEventListener("click",Yn,!0),window.setTimeout(()=>{window.removeEventListener("click",Yn,!0)},0)}function qr(c,n){let a=c.getBoundingClientRect();return nt(c,a,n)}function eo(c,n){let a=c.getBoundingClientRect(),d=[];for(let p=0;p<n.length;p++)d.push(nt(c,a,n[p]));return d}function fo(c){return window.InstallTrigger!==void 0&&c.button===2&&c.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:c.button}function nt(c,n,a){let d=c.offsetWidth===n.width?1:c.offsetWidth/n.width;return new r.P((a.clientX-n.left)*d,(a.clientY-n.top)*d)}class Rs{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(n,a){this._updatedSourceCaches[n]=a,this.setDirty()}discardSourceCacheUpdate(n){delete this._updatedSourceCaches[n]}updateLayer(n){let a=n.scope;this._updatedLayers[a]=this._updatedLayers[a]||new Set,this._updatedLayers[a].add(n.id),this.setDirty()}removeLayer(n){let a=n.scope;this._removedLayers[a]=this._removedLayers[a]||{},this._updatedLayers[a]=this._updatedLayers[a]||new Set,this._removedLayers[a][n.id]=n,this._updatedLayers[a].delete(n.id),this._updatedPaintProps.delete(n.fqid),this.setDirty()}getRemovedLayer(n){return this._removedLayers[n.scope]?this._removedLayers[n.scope][n.id]:null}discardLayerRemoval(n){this._removedLayers[n.scope]&&delete this._removedLayers[n.scope][n.id]}getLayerUpdatesByScope(){let n={};for(let a in this._updatedLayers)n[a]=n[a]||{},n[a].updatedIds=Array.from(this._updatedLayers[a].values());for(let a in this._removedLayers)n[a]=n[a]||{},n[a].removedIds=Object.keys(this._removedLayers[a]);return n}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(n){this._updatedPaintProps.add(n.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(n){this._updatedImages.add(n),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}class _c extends r.E{constructor(n){super(),this.requestManager=n,this.models={"":{}},this.numModelsLoading={}}loadModel(n,a){return r.l(this.requestManager.transformRequest(a,r.R.Model).url).then(d=>{if(!d)return;let p=r.c(d),g=new r.M(n,void 0,void 0,p);return g.computeBoundsAndApplyParent(),g}).catch(d=>{this.fire(new r.a(new Error(`Could not load model ${n} from ${a}: ${d.message}`)))})}load(n,a){this.models[a]||(this.models[a]={});let d=Object.keys(n);this.numModelsLoading[a]=(this.numModelsLoading[a]||0)+d.length;let p=[];for(let g of d)p.push(this.loadModel(g,n[g]));Promise.allSettled(p).then(g=>{for(let v=0;v<g.length;v++){let{status:k,value:S}=g[v];k==="fulfilled"&&S&&(this.models[a][d[v]]=S)}this.numModelsLoading[a]-=d.length,this.fire(new r.b("data",{dataType:"style"}))}).catch(g=>{this.fire(new r.a(new Error(`Could not load models: ${g.message}`)))})}isLoaded(){for(let n in this.numModelsLoading)if(this.numModelsLoading[n]>0)return!1;return!0}hasModel(n,a){return!!this.getModel(n,a)}getModel(n,a){return this.models[a]||(this.models[a]={}),this.models[a][n]}addModel(n,a,d){this.models[d]||(this.models[d]={}),this.hasModel(n,d)&&this.removeModel(n,d),this.load({[n]:this.requestManager.normalizeModelURL(a)},d)}addModels(n,a){let d={};for(let p in n)d[p]=this.requestManager.normalizeModelURL(n[p]);this.load(d,a)}removeModel(n,a){this.models[a]||(this.models[a]={});let d=this.models[a][n];delete this.models[a][n],d.destroy()}listModels(n){return this.models[n]||(this.models[n]={}),Object.keys(this.models[n])}upload(n,a){this.models[a]||(this.models[a]={});for(let d in this.models[a])this.models[a][d].upload(n.context)}}class vi{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(n,a,d){let p=String(a);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][p]=this.stateChanges[n][p]||{},r.e(this.stateChanges[n][p],d),this.deletedStates[n]===null){this.deletedStates[n]={};for(let g in this.state[n])g!==p&&(this.deletedStates[n][g]=null)}else if(this.deletedStates[n]&&this.deletedStates[n][p]===null){this.deletedStates[n][p]={};for(let g in this.state[n][p])d[g]||(this.deletedStates[n][p][g]=null)}else for(let g in d)this.deletedStates[n]&&this.deletedStates[n][p]&&this.deletedStates[n][p][g]===null&&delete this.deletedStates[n][p][g]}removeFeatureState(n,a,d){if(this.deletedStates[n]===null)return;let p=String(a);if(this.deletedStates[n]=this.deletedStates[n]||{},d&&a!==void 0)this.deletedStates[n][p]!==null&&(this.deletedStates[n][p]=this.deletedStates[n][p]||{},this.deletedStates[n][p][d]=null);else if(a!==void 0)if(this.stateChanges[n]&&this.stateChanges[n][p])for(d in this.deletedStates[n][p]={},this.stateChanges[n][p])this.deletedStates[n][p][d]=null;else this.deletedStates[n][p]=null;else this.deletedStates[n]=null}getState(n,a){let d=String(a),p=r.e({},(this.state[n]||{})[d],(this.stateChanges[n]||{})[d]);if(this.deletedStates[n]===null)return{};if(this.deletedStates[n]){let g=this.deletedStates[n][a];if(g===null)return{};for(let v in g)delete p[v]}return p}initializeTileState(n,a){n.setFeatureState(this.state,a)}coalesceChanges(n,a){let d={};for(let p in this.stateChanges){this.state[p]=this.state[p]||{};let g={};for(let v in this.stateChanges[p])this.state[p][v]||(this.state[p][v]={}),r.e(this.state[p][v],this.stateChanges[p][v]),g[v]=this.state[p][v];d[p]=g}for(let p in this.deletedStates){this.state[p]=this.state[p]||{};let g={};if(this.deletedStates[p]===null)for(let v in this.state[p])g[v]={},this.state[p][v]={};else for(let v in this.deletedStates[p]){if(this.deletedStates[p][v]===null)this.state[p][v]={};else if(this.state[p][v])for(let k of Object.keys(this.deletedStates[p][v]))delete this.state[p][v][k];g[v]=this.state[p][v]}d[p]=d[p]||{},r.e(d[p],g)}if(this.stateChanges={},this.deletedStates={},Object.keys(d).length!==0)for(let p in n)n[p].setFeatureState(d,a)}}function Mr(c){let{userImage:n}=c;return!!(n&&n.render&&n.render())&&(c.data.replace(new Uint8Array(n.data.buffer)),!0)}class Sd extends r.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(n){this.images[n]={},this.loaded[n]=!1,this.updatedImages[n]={},this.patterns[n]={},this.callbackDispatchedThisFrame[n]={},this.atlasImage[n]=new r.h({width:1,height:1})}isLoaded(){for(let n in this.loaded)if(!this.loaded[n])return!1;return!0}setLoaded(n,a){if(this.loaded[a]!==n&&(this.loaded[a]=n,n)){for(let{ids:d,callback:p}of this.requestors)this._notify(d,a,p);this.requestors=[]}}hasImage(n,a){return!!this.getImage(n,a)}getImage(n,a){return this.images[a][n]}addImage(n,a,d){this._validate(n,d)&&(this.images[a][n]=d)}_validate(n,a){let d=!0;return this._validateStretch(a.stretchX,a.data&&a.data.width)||(this.fire(new r.a(new Error(`Image "${n}" has invalid "stretchX" value`))),d=!1),this._validateStretch(a.stretchY,a.data&&a.data.height)||(this.fire(new r.a(new Error(`Image "${n}" has invalid "stretchY" value`))),d=!1),this._validateContent(a.content,a)||(this.fire(new r.a(new Error(`Image "${n}" has invalid "content" value`))),d=!1),d}_validateStretch(n,a){if(!n)return!0;let d=0;for(let p of n){if(p[0]<d||p[1]<p[0]||a<p[1])return!1;d=p[1]}return!0}_validateContent(n,a){return!(n&&(n.length!==4||n[0]<0||a.data.width<n[0]||n[1]<0||a.data.height<n[1]||n[2]<0||a.data.width<n[2]||n[3]<0||a.data.height<n[3]||n[2]<n[0]||n[3]<n[1]))}updateImage(n,a,d){d.version=this.images[a][n].version+1,this.images[a][n]=d,this.updatedImages[a][n]=!0}removeImage(n,a){let d=this.images[a][n];delete this.images[a][n],delete this.patterns[a][n],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(n){return Object.keys(this.images[n])}getImages(n,a,d){let p=!0,g=!!this.loaded[a];if(!g)for(let v of n)this.images[a][v]||(p=!1);g||p?this._notify(n,a,d):this.requestors.push({ids:n,scope:a,callback:d})}getUpdatedImages(n){return this.updatedImages[n]}_notify(n,a,d){let p={};for(let g of n){this.images[a][g]||this.fire(new r.b("styleimagemissing",{id:g}));let v=this.images[a][g];v?p[g]={data:v.data.clone(),pixelRatio:v.pixelRatio,sdf:v.sdf,version:v.version,stretchX:v.stretchX,stretchY:v.stretchY,content:v.content,hasRenderCallback:!!(v.userImage&&v.userImage.render)}:r.w(`Image "${g}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}d(null,p)}getPixelSize(n){let{width:a,height:d}=this.atlasImage[n];return{width:a,height:d}}getPattern(n,a){let d=this.patterns[a][n],p=this.getImage(n,a);if(!p)return null;if(d&&d.position.version===p.version)return d.position;if(d)d.position.version=p.version;else{let g={w:p.data.width+2,h:p.data.height+2,x:0,y:0},v=new r.I(g,p);this.patterns[a][n]={bin:g,position:v}}return this._updatePatternAtlas(a),this.patterns[a][n].position}bind(n,a){let d=n.gl,p=this.atlasTexture[a];p?this.dirty&&(p.update(this.atlasImage[a]),this.dirty=!1):(p=new r.T(n,this.atlasImage[a],d.RGBA),this.atlasTexture[a]=p),p.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(n){let a=[];for(let v in this.patterns[n])a.push(this.patterns[n][v].bin);let{w:d,h:p}=r.p(a),g=this.atlasImage[n];g.resize({width:d||1,height:p||1});for(let v in this.patterns[n]){let{bin:k}=this.patterns[n][v],S=k.x+1,E=k.y+1,A=this.images[n][v].data,P=A.width,z=A.height;r.h.copy(A,g,{x:0,y:0},{x:S,y:E},{width:P,height:z}),r.h.copy(A,g,{x:0,y:z-1},{x:S,y:E-1},{width:P,height:1}),r.h.copy(A,g,{x:0,y:0},{x:S,y:E+z},{width:P,height:1}),r.h.copy(A,g,{x:P-1,y:0},{x:S-1,y:E},{width:1,height:z}),r.h.copy(A,g,{x:0,y:0},{x:S+P,y:E},{width:1,height:z})}this.dirty=!0}beginFrame(){for(let n in this.images)this.callbackDispatchedThisFrame[n]={}}dispatchRenderCallbacks(n,a){for(let d of n){if(this.callbackDispatchedThisFrame[a][d])continue;this.callbackDispatchedThisFrame[a][d]=!0;let p=this.images[a][d];Mr(p)&&this.updateImage(d,a,p)}}}class lt{constructor(n,a,d,p){this.message=(n?`${n}: `:"")+d,p&&(this.identifier=p),a!=null&&a.__line__&&(this.line=a.__line__)}}class Ho extends lt{}function Hr(c){let n=c.key,a=c.value,d=c.valueSpec||{},p=c.objectElementValidators||{},g=c.style,v=c.styleSpec,k=[],S=r.i(a);if(S!=="object")return[new lt(n,a,`object expected, ${S} found`)];for(let E in a){let A=E.split(".")[0],P;p[A]?P=p[A]:d[A]?P=Hn:p["*"]?P=p["*"]:d["*"]&&(P=Hn),P?k=k.concat(P({key:(n&&`${n}.`)+E,value:a[E],valueSpec:d[A]||d["*"],style:g,styleSpec:v,object:a,objectKey:E},a)):k.push(new Ho(n,a[E],`unknown property "${E}"`))}for(let E in d)p[E]||d[E].required&&d[E].default===void 0&&a[E]===void 0&&k.push(new lt(n,a,`missing required property "${E}"`));return k}function ii(c){let n=c.value,a=c.valueSpec,d=c.style,p=c.styleSpec,g=c.key,v=c.arrayElementValidator||Hn;if(r.i(n)!=="array")return[new lt(g,n,`array expected, ${r.i(n)} found`)];if(a.length&&n.length!==a.length)return[new lt(g,n,`array length ${a.length} expected, length ${n.length} found`)];if(a["min-length"]&&n.length<a["min-length"])return[new lt(g,n,`array length at least ${a["min-length"]} expected, length ${n.length} found`)];let k={type:a.value,values:a.values,minimum:a.minimum,maximum:a.maximum,function:void 0};p.$version<7&&(k.function=a.function),r.i(a.value)==="object"&&(k=a.value);let S=[];for(let E=0;E<n.length;E++)S=S.concat(v({array:n,arrayIndex:E,value:n[E],valueSpec:k,style:d,styleSpec:p,key:`${g}[${E}]`},!0));return S}function ml(c){let n=c.key,a=c.value,d=c.valueSpec,p=r.i(a);if(p==="number"&&a!=a&&(p="NaN"),p!=="number")return[new lt(n,a,`number expected, ${p} found`)];if("minimum"in d){let g=d.minimum;if(r.i(d.minimum)==="array"&&(g=d.minimum[c.arrayIndex]),a<g)return[new lt(n,a,`${a} is less than the minimum value ${g}`)]}if("maximum"in d){let g=d.maximum;if(r.i(d.maximum)==="array"&&(g=d.maximum[c.arrayIndex]),a>g)return[new lt(n,a,`${a} is greater than the maximum value ${g}`)]}return[]}function Ya(c){let n=c.valueSpec,a=r.u(c.value.type),d,p,g,v={},k=a!=="categorical"&&c.value.property===void 0,S=!k,E=r.i(c.value.stops)==="array"&&r.i(c.value.stops[0])==="array"&&r.i(c.value.stops[0][0])==="object",A=Hr({key:c.key,value:c.value,valueSpec:c.styleSpec.function,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{stops:function(O){if(a==="identity")return[new lt(O.key,O.value,'identity function may not have a "stops" property')];let U=[],V=O.value;return U=U.concat(ii({key:O.key,value:V,valueSpec:O.valueSpec,style:O.style,styleSpec:O.styleSpec,arrayElementValidator:P})),r.i(V)==="array"&&V.length===0&&U.push(new lt(O.key,V,"array must have at least one stop")),U},default:function(O){return Hn({key:O.key,value:O.value,valueSpec:n,style:O.style,styleSpec:O.styleSpec})}}});return a==="identity"&&k&&A.push(new lt(c.key,c.value,'missing required property "property"')),a==="identity"||c.value.stops||A.push(new lt(c.key,c.value,'missing required property "stops"')),a==="exponential"&&c.valueSpec.expression&&!r.s(c.valueSpec)&&A.push(new lt(c.key,c.value,"exponential functions not supported")),c.styleSpec.$version>=8&&(S&&!r.k(c.valueSpec)?A.push(new lt(c.key,c.value,"property functions not supported")):k&&!r.m(c.valueSpec)&&A.push(new lt(c.key,c.value,"zoom functions not supported"))),a!=="categorical"&&!E||c.value.property!==void 0||A.push(new lt(c.key,c.value,'"property" property is required')),A;function P(O){let U=[],V=O.value,G=O.key;if(r.i(V)!=="array")return[new lt(G,V,`array expected, ${r.i(V)} found`)];if(V.length!==2)return[new lt(G,V,`array length 2 expected, length ${V.length} found`)];if(E){if(r.i(V[0])!=="object")return[new lt(G,V,`object expected, ${r.i(V[0])} found`)];if(V[0].zoom===void 0)return[new lt(G,V,"object stop key must have zoom")];if(V[0].value===void 0)return[new lt(G,V,"object stop key must have value")];let N=r.u(V[0].zoom);if(typeof N!="number")return[new lt(G,V[0].zoom,"stop zoom values must be numbers")];if(g&&g>N)return[new lt(G,V[0].zoom,"stop zoom values must appear in ascending order")];N!==g&&(g=N,p=void 0,v={}),U=U.concat(Hr({key:`${G}[0]`,value:V[0],valueSpec:{zoom:{}},style:O.style,styleSpec:O.styleSpec,objectElementValidators:{zoom:ml,value:z}}))}else U=U.concat(z({key:`${G}[0]`,value:V[0],valueSpec:{},style:O.style,styleSpec:O.styleSpec},V));return r.n(r.o(V[1]))?U.concat([new lt(`${G}[1]`,V[1],"expressions are not allowed in function stops.")]):U.concat(Hn({key:`${G}[1]`,value:V[1],valueSpec:n,style:O.style,styleSpec:O.styleSpec}))}function z(O,U){let V=r.i(O.value),G=r.u(O.value),N=O.value!==null?O.value:U;if(d){if(V!==d)return[new lt(O.key,N,`${V} stop domain type must match previous stop domain type ${d}`)]}else d=V;if(V!=="number"&&V!=="string"&&V!=="boolean"&&typeof G!="number"&&typeof G!="string"&&typeof G!="boolean")return[new lt(O.key,N,"stop domain value must be a number, string, or boolean")];if(V!=="number"&&a!=="categorical"){let H=`number expected, ${V} found`;return r.k(n)&&a===void 0&&(H+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new lt(O.key,N,H)]}return a!=="categorical"||V!=="number"||typeof G=="number"&&isFinite(G)&&Math.floor(G)===G?a!=="categorical"&&V==="number"&&typeof G=="number"&&typeof p=="number"&&p!==void 0&&G<p?[new lt(O.key,N,"stop domain values must appear in ascending order")]:(p=G,a==="categorical"&&G in v?[new lt(O.key,N,"stop domain values must be unique")]:(v[G]=!0,[])):[new lt(O.key,N,`integer expected, found ${String(G)}`)]}}function Zo(c){let n=(c.expressionContext==="property"?r.q:r.r)(r.o(c.value),c.valueSpec);if(n.result==="error")return n.value.map(d=>new lt(`${c.key}${d.key}`,c.value,d.message));let a=n.value.expression||n.value._styleExpression.expression;if(c.expressionContext==="property"&&c.propertyKey==="text-font"&&!a.outputDefined())return[new lt(c.key,c.value,`Invalid data expression for "${c.propertyKey}". Output values must be contained as literals within the expression.`)];if(c.expressionContext==="property"&&c.propertyType==="layout"&&!r.t(a))return[new lt(c.key,c.value,'"feature-state" data expressions are not supported with layout properties.')];if(c.expressionContext==="filter")return Er(a,c);if(c.expressionContext&&c.expressionContext.indexOf("cluster")===0){if(!r.v(a,["zoom","feature-state"]))return[new lt(c.key,c.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(c.expressionContext==="cluster-initial"&&!r.x(a))return[new lt(c.key,c.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Er(c,n){let a=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(n.valueSpec&&n.valueSpec.expression)for(let p of n.valueSpec.expression.parameters)a.delete(p);if(a.size===0)return[];let d=[];return c instanceof r.C&&a.has(c.name)?[new lt(n.key,n.value,`["${c.name}"] expression is not supported in a filter for a ${n.object.type} layer with id: ${n.object.id}`)]:(c.eachChild(p=>{d.push(...Er(p,n))}),d)}function Ls(c){let n=c.key,a=c.value,d=c.valueSpec,p=[];return Array.isArray(d.values)?d.values.indexOf(r.u(a))===-1&&p.push(new lt(n,a,`expected one of [${d.values.join(", ")}], ${JSON.stringify(a)} found`)):Object.keys(d.values).indexOf(r.u(a))===-1&&p.push(new lt(n,a,`expected one of [${Object.keys(d.values).join(", ")}], ${JSON.stringify(a)} found`)),p}function pl(c){return r.z(r.o(c.value))?Zo(r.j({},c,{expressionContext:"filter",valueSpec:c.styleSpec[`filter_${c.layerType||"fill"}`]})):gc(c)}function gc(c){let n=c.value,a=c.key;if(r.i(n)!=="array")return[new lt(a,n,`array expected, ${r.i(n)} found`)];let d=c.styleSpec,p,g=[];if(n.length<1)return[new lt(a,n,"filter array must have at least 1 element")];switch(g=g.concat(Ls({key:`${a}[0]`,value:n[0],valueSpec:d.filter_operator,style:c.style,styleSpec:c.styleSpec})),r.u(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&r.u(n[1])==="$type"&&g.push(new lt(a,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":n.length!==3&&g.push(new lt(a,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&(p=r.i(n[1]),p!=="string"&&g.push(new lt(`${a}[1]`,n[1],`string expected, ${p} found`)));for(let v=2;v<n.length;v++)p=r.i(n[v]),r.u(n[1])==="$type"?g=g.concat(Ls({key:`${a}[${v}]`,value:n[v],valueSpec:d.geometry_type,style:c.style,styleSpec:c.styleSpec})):p!=="string"&&p!=="number"&&p!=="boolean"&&g.push(new lt(`${a}[${v}]`,n[v],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let v=1;v<n.length;v++)g=g.concat(gc({key:`${a}[${v}]`,value:n[v],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":p=r.i(n[1]),n.length!==2?g.push(new lt(a,n,`filter array for "${n[0]}" operator must have 2 elements`)):p!=="string"&&g.push(new lt(`${a}[1]`,n[1],`string expected, ${p} found`))}return g}function yc(c,n){let a=c.key,d=c.style,p=c.layer,g=c.styleSpec,v=c.value,k=c.objectKey,S=g[`${n}_${c.layerType}`];if(!S)return[];let E=k.match(/^(.*)-transition$/);if(n==="paint"&&E&&S[E[1]]&&S[E[1]].transition)return Hn({key:a,value:v,valueSpec:g.transition,style:d,styleSpec:g});let A=c.valueSpec||S[k];if(!A)return[new Ho(a,v,`unknown property "${k}"`)];let P;if(r.i(v)==="string"&&r.k(A)&&!A.tokens&&(P=/^{([^}]+)}$/.exec(v))){let O=`\`{ "type": "identity", "property": ${P?JSON.stringify(P[1]):'"_"'} }\``;return[new lt(a,v,`"${k}" does not support interpolation syntax
Use an identity property function instead: ${O}.`)]}let z=[];if(c.layerType==="symbol")k!=="text-field"||!d||d.glyphs||d.imports||z.push(new lt(a,v,'use of "text-field" requires a style "glyphs" property')),k==="text-font"&&r.A(r.o(v))&&r.u(v.type)==="identity"&&z.push(new lt(a,v,'"text-font" does not support identity functions'));else if(c.layerType==="model"&&n==="paint"&&p&&p.layout&&p.layout.hasOwnProperty("model-id")&&r.k(A)&&(r.B(A)||r.m(A))){let O=r.q(r.o(v),A),U=O.value.expression||O.value._styleExpression.expression;U&&!r.v(U,["measure-light"])&&(k==="model-emissive-strength"&&r.x(U)&&r.t(U)||z.push(new lt(a,v,`${k} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return z.concat(Hn({key:c.key,value:v,valueSpec:A,style:d,styleSpec:g,expressionContext:"property",propertyType:n,propertyKey:k}))}function bc(c){return yc(c,"paint")}function zs(c){return yc(c,"layout")}function Ia(c){let n=[],a=c.value,d=c.key,p=c.style,g=c.styleSpec;a.type||a.ref||n.push(new lt(d,a,'either "type" or "ref" is required'));let v=r.u(a.type),k=r.u(a.ref);if(a.id){let S=r.u(a.id);for(let E=0;E<c.arrayIndex;E++){let A=p.layers[E];r.u(A.id)===S&&n.push(new lt(d,a.id,`duplicate layer id "${a.id}", previously used at line ${A.id.__line__}`))}}if("ref"in a){let S;["type","source","source-layer","filter","layout"].forEach(E=>{E in a&&n.push(new lt(d,a[E],`"${E}" is prohibited for ref layers`))}),p.layers.forEach(E=>{r.u(E.id)===k&&(S=E)}),S?S.ref?n.push(new lt(d,a.ref,"ref cannot reference another ref layer")):v=r.u(S.type):typeof k=="string"&&n.push(new lt(d,a.ref,`ref layer "${k}" not found`))}else if(v!=="background"&&v!=="sky"&&v!=="slot")if(a.source){let S=p.sources&&p.sources[a.source],E=S&&r.u(S.type);S?E==="vector"&&v==="raster"?n.push(new lt(d,a.source,`layer "${a.id}" requires a raster source`)):E==="raster"&&v!=="raster"?n.push(new lt(d,a.source,`layer "${a.id}" requires a vector source`)):E!=="vector"||a["source-layer"]?E==="raster-dem"&&v!=="hillshade"?n.push(new lt(d,a.source,"raster-dem source can only be used with layer type 'hillshade'.")):E!=="raster-array"||["raster","raster-particle"].includes(v)?v!=="line"||!a.paint||!a.paint["line-gradient"]&&!a.paint["line-trim-offset"]||E==="geojson"&&S.lineMetrics?v==="raster-particle"&&E!=="raster-array"&&n.push(new lt(d,a.source,`layer "${a.id}" requires a 'raster-array' source.`)):n.push(new lt(d,a,`layer "${a.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):n.push(new lt(d,a.source,"raster-array source can only be used with layer type 'raster'.")):n.push(new lt(d,a,`layer "${a.id}" must specify a "source-layer"`)):n.push(new lt(d,a.source,`source "${a.source}" not found`))}else n.push(new lt(d,a,'missing required property "source"'));return n=n.concat(Hr({key:d,value:a,valueSpec:g.layer,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Hn({key:`${d}.type`,value:a.type,valueSpec:g.layer.type,style:c.style,styleSpec:c.styleSpec,object:a,objectKey:"type"}),filter:S=>pl(r.j({layerType:v},S)),layout:S=>Hr({layer:a,key:S.key,value:S.value,valueSpec:{},style:S.style,styleSpec:S.styleSpec,objectElementValidators:{"*":E=>zs(r.j({layerType:v},E))}}),paint:S=>Hr({layer:a,key:S.key,value:S.value,valueSpec:{},style:S.style,styleSpec:S.styleSpec,objectElementValidators:{"*":E=>bc(r.j({layerType:v,layer:a},E))}})}})),n}function Ar(c){let n=c.value,a=c.key,d=r.i(n);return d!=="string"?[new lt(a,n,`string expected, ${d} found`)]:[]}let So={promoteId:function({key:c,value:n}){if(r.i(n)==="string")return Ar({key:c,value:n});{let a=[];for(let d in n)a.push(...Ar({key:`${c}.${d}`,value:n[d]}));return a}}};function _o(c){let n=c.value,a=c.key,d=c.styleSpec,p=c.style;if(!n.type)return[new lt(a,n,'"type" is required')];let g=r.u(n.type),v=[];switch(["vector","raster","raster-dem","raster-array"].includes(g)&&(n.url||n.tiles||v.push(new Ho(a,n,'Either "url" or "tiles" is required.'))),g){case"vector":case"raster":case"raster-dem":case"raster-array":return v=v.concat(Hr({key:a,value:n,valueSpec:d[`source_${g.replace("-","_")}`],style:c.style,styleSpec:d,objectElementValidators:So})),v;case"geojson":if(v=Hr({key:a,value:n,valueSpec:d.source_geojson,style:p,styleSpec:d,objectElementValidators:So}),n.cluster)for(let k in n.clusterProperties){let[S,E]=n.clusterProperties[k],A=typeof S=="string"?[S,["accumulated"],["get",k]]:S;v.push(...Zo({key:`${a}.${k}.map`,value:E,expressionContext:"cluster-map"})),v.push(...Zo({key:`${a}.${k}.reduce`,value:A,expressionContext:"cluster-reduce"}))}return v;case"video":return Hr({key:a,value:n,valueSpec:d.source_video,style:p,styleSpec:d});case"image":return Hr({key:a,value:n,valueSpec:d.source_image,style:p,styleSpec:d});case"canvas":return[new lt(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ls({key:`${a}.type`,value:n.type,valueSpec:{values:Cd(d)},style:p,styleSpec:d})}}function Cd(c){return c.source.reduce((n,a)=>{let d=c[a];return d.type.type==="enum"&&(n=n.concat(Object.keys(d.type.values))),n},[])}function Pn(c){let n=c.value,a=[];if(!n)return a;let d=r.i(n);return d!=="string"?(a=a.concat([new lt(c.key,n,`string expected, "${d}" found`)]),a):(function(p){let g=p.indexOf("://")===-1;try{return new URL(p,g?"http://example.com":void 0),!0}catch{return!1}}(n)||(a=a.concat([new lt(c.key,n,`invalid url "${n}"`)])),a)}function Co(c){let n=c.value,a=c.styleSpec,d=a.light,p=c.style,g=[],v=r.i(n);if(n===void 0)return g;if(v!=="object")return g=g.concat([new lt("light",n,`object expected, ${v} found`)]),g;for(let k in n){let S=k.match(/^(.*)-transition$/);g=g.concat(S&&d[S[1]]&&d[S[1]].transition?Hn({key:k,value:n[k],valueSpec:a.transition,style:p,styleSpec:a}):d[k]?Hn({key:k,value:n[k],valueSpec:d[k],style:p,styleSpec:a}):[new lt(k,n[k],`unknown property "${k}"`)])}return g}function Os(c){let n=c.value,a=[];if(!n)return a;let d=r.i(n);if(d!=="object")return a=a.concat([new lt("light-3d",n,`object expected, ${d} found`)]),a;let p=c.styleSpec,g=p["light-3d"],v=c.key,k=c.style,S=c.style.lights;for(let P of["type","id"])if(!(P in n))return a=a.concat([new lt("light-3d",n,`missing property ${P} on light`)]),a;if(n.type&&S)for(let P=0;P<c.arrayIndex;P++){let z=r.u(n.type),O=S[P];r.u(O.type)===z&&a.push(new lt(v,n.id,`duplicate light type "${n.type}", previously defined at line ${O.id.__line__}`))}let E=`properties_light_${n.type}`;if(!(E in p))return a=a.concat([new lt("light-3d",n,`Invalid light type ${n.type}`)]),a;let A=p[E];for(let P in n)if(P==="properties"){let z=n[P],O=r.i(z);if(O!=="object")return a=a.concat([new lt("properties",z,`object expected, ${O} found`)]),a;for(let U in z)a=a.concat(A[U]?Hn({key:U,value:z[U],valueSpec:A[U],style:k,styleSpec:p}):[new Ho(c.key,z[U],`unknown property "${U}"`)])}else{let z=P.match(/^(.*)-transition$/);a=a.concat(z&&g[z[1]]&&g[z[1]].transition?Hn({key:P,value:n[P],valueSpec:p.transition,style:k,styleSpec:p}):g[P]?Hn({key:P,value:n[P],valueSpec:g[P],style:k,styleSpec:p}):[new Ho(P,n[P],`unknown property "${P}"`)])}return a}function Sa(c){let n=c.value,a=c.key,d=c.style,p=c.styleSpec,g=p.terrain,v=[],k=r.i(n);if(n===void 0||k==="null")return v;if(k!=="object")return v=v.concat([new lt("terrain",n,`object expected, ${k} found`)]),v;for(let S in n){let E=S.match(/^(.*)-transition$/);v=v.concat(E&&g[E[1]]&&g[E[1]].transition?Hn({key:S,value:n[S],valueSpec:p.transition,style:d,styleSpec:p}):g[S]?Hn({key:S,value:n[S],valueSpec:g[S],style:d,styleSpec:p}):[new Ho(S,n[S],`unknown property "${S}"`)])}if(n.source){let S=d.sources&&d.sources[n.source],E=S&&r.u(S.type);S?E!=="raster-dem"&&v.push(new lt(a,n.source,`terrain cannot be used with a source of type ${String(E)}, it only be used with a "raster-dem" source type`)):v.push(new lt(a,n.source,`source "${n.source}" not found`))}else v.push(new lt(a,n,'terrain is missing required property "source"'));return v}function pa(c){let n=c.value,a=c.style,d=c.styleSpec,p=d.fog,g=[],v=r.i(n);if(n===void 0)return g;if(v!=="object")return g=g.concat([new lt("fog",n,`object expected, ${v} found`)]),g;for(let k in n){let S=k.match(/^(.*)-transition$/);g=g.concat(S&&p[S[1]]&&p[S[1]].transition?Hn({key:k,value:n[k],valueSpec:d.transition,style:a,styleSpec:d}):p[k]?Hn({key:k,value:n[k],valueSpec:p[k],style:a,styleSpec:d}):[new Ho(k,n[k],`unknown property "${k}"`)])}return g}let Fs={"*":()=>[],array:ii,boolean:function(c){let n=c.value,a=c.key,d=r.i(n);return d!=="boolean"?[new lt(a,n,`boolean expected, ${d} found`)]:[]},number:ml,color:function(c){let n=c.key,a=c.value,d=r.i(a);return d!=="string"?[new lt(n,a,`color expected, ${d} found`)]:r.y(a)===null?[new lt(n,a,`color expected, "${a}" found`)]:[]},enum:Ls,filter:pl,function:Ya,layer:Ia,object:Hr,source:_o,model:Pn,light:Co,"light-3d":Os,terrain:Sa,fog:pa,string:Ar,formatted:function(c){return Ar(c).length===0?[]:Zo(c)},resolvedImage:function(c){return Ar(c).length===0?[]:Zo(c)},projection:function(c){let n=c.value,a=c.styleSpec,d=a.projection,p=c.style,g=[],v=r.i(n);if(v==="object")for(let k in n)g=g.concat(Hn({key:k,value:n[k],valueSpec:d[k],style:p,styleSpec:a}));else v!=="string"&&(g=g.concat([new lt("projection",n,`object or string expected, ${v} found`)]));return g},import:function(c){let{value:n,styleSpec:a}=c,v=n,{data:d}=v,p=l2(v,["data"]);Object.defineProperty(p,"__line__",{value:n.__line__,enumerable:!1});let g=Hr(r.j({},c,{value:p,valueSpec:a.import}));return r.u(p.id)===""&&g.push(new lt(`${c.key}.id`,p,"import id can't be an empty string")),d&&(g=g.concat(_l(d,a,{key:`${c.key}.data`}))),g}};function Hn(c,n=!1){let a=c.value,d=c.valueSpec,p=c.styleSpec;if(d.expression&&r.A(r.u(a)))return Ya(c);if(d.expression&&r.n(r.o(a)))return Zo(c);if(d.type&&Fs[d.type]){let g=Fs[d.type](c);return n===!0&&g.length>0&&r.i(c.value)==="array"?Zo(c):g}return Hr(r.j({},c,{valueSpec:d.type?p[d.type]:d}))}function fl(c){let n=c.value,a=c.key,d=Ar(c);return d.length||(n.indexOf("{fontstack}")===-1&&d.push(new lt(a,n,'"glyphs" url must include a "{fontstack}" token')),n.indexOf("{range}")===-1&&d.push(new lt(a,n,'"glyphs" url must include a "{range}" token'))),d}function _l(c,n=r.D,a={}){return Hn({key:a.key||"",value:c,valueSpec:n.$root,styleSpec:n,style:c,objectElementValidators:{glyphs:fl,"*":()=>[]}})}function Mo(c,n=r.D){return Ee(_l(c,n))}let Ca=c=>Ee(_o(c)),Ka=c=>Ee(Co(c)),Le=c=>Ee(Os(c)),X=c=>Ee(Sa(c)),ie=c=>Ee(pa(c)),de=c=>Ee(Ia(c)),Me=c=>Ee(pl(c)),Oe=c=>Ee(bc(c)),qe=c=>Ee(zs(c)),gt=c=>Ee(Pn(c));function Ee(c){return c.slice().sort((n,a)=>n.line&&a.line?n.line-a.line:0)}function bt(c,n){let a=!1;if(n&&n.length)for(let d of n)d instanceof Ho?r.w(d.message):(c.fire(new r.a(new Error(d.message))),a=!0);return a}let ut=new r.F({anchor:new r.G(r.D.light.anchor),position:new r.H(r.D.light.position),color:new r.G(r.D.light.color),intensity:new r.G(r.D.light.intensity)});class xt extends r.E{constructor(n,a="flat"){super(),this._transitionable=new r.J(ut),this.setLight(n,a),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,a,d={}){this._validate(Ka,n,d)||(this._transitionable.setTransitionOrValue(n),this.id=a)}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,a,d){return(!d||d.validate!==!1)&&bt(this,n.call(Mo,r.e({value:a,style:{glyphs:!0,sprite:!0},styleSpec:r.D})))}}let ni=new r.F({source:new r.G(r.D.terrain.source),exaggeration:new r.G(r.D.terrain.exaggeration)}),Zi=class extends r.E{constructor(c,n,a,d){super(),this.scope=a,this._transitionable=new r.J(ni,a,d),this._transitionable.setTransitionOrValue(c,d),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=n}get(){return this._transitionable.serialize()}set(c,n){this._transitionable.setTransitionOrValue(c,n)}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}getExaggeration(c){return this._transitioning.possiblyEvaluate(new r.K(c)).get("exaggeration")}isZoomDependent(){let c=this._transitionable._values.exaggeration;return c!=null&&c.value!=null&&c.value.expression!=null&&c.value.expression instanceof r.Z}},sn=45,Wi=65,Fi=.05;function Ri(c,n,a,d){let p=r.O(sn,Wi,a),[g,v]=Gi(c,d),k=1-Math.min(1,Math.exp((n-g)/(v-g)*-6));return k*=k*k,k=Math.min(1,1.00747*k),k*p*c.alpha}function Gi(c,n){let a=.5/Math.tan(.5*n);return[c.range[0]+a,c.range[1]+a]}function nn(c,n,a,d,p){let g=r.N.transformMat4([],[n,a,d],p.mercatorFogMatrix);return Ri(c,r.N.length(g),p.pitch,p._fov)}function dr(c,n,a,d,p,g,v){let k=[[a,d,0],[p,d,0],[p,g,0],[a,g,0]],S=Number.MAX_VALUE,E=-Number.MAX_VALUE;for(let A of k){let P=r.N.transformMat4([],A,n),z=r.N.length(P);S=Math.min(S,z),E=Math.max(E,z)}return[Ri(c,S,v.pitch,v._fov),Ri(c,E,v.pitch,v._fov)]}let an=new r.F({range:new r.G(r.D.fog.range),color:new r.G(r.D.fog.color),"high-color":new r.G(r.D.fog["high-color"]),"space-color":new r.G(r.D.fog["space-color"]),"horizon-blend":new r.G(r.D.fog["horizon-blend"]),"star-intensity":new r.G(r.D.fog["star-intensity"]),"vertical-range":new r.G(r.D.fog["vertical-range"])});class Zr extends r.E{constructor(n,a,d,p){super(),this._transitionable=new r.J(an,d,new Map(p)),this.set(n,p),this._transitioning=this._transitionable.untransitioned(),this._transform=a,this.properties=new r.Q(an)}get state(){let n=this._transform,a=n.projection.name==="globe",d=r.S(n.zoom),p=this.properties.get("range"),g=[.5,3];return{range:a?[r.U(g[0],p[0],d),r.U(g[1],p[1],d)]:p,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,a,d={}){if(this._validate(ie,n,d))return;let p=r.e({},n);for(let g of Object.keys(r.D.fog))p[g]===void 0&&(p[g]=r.D.fog[g].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,a)}getOpacity(n){if(!this._transform.projection.supportsFog)return 0;let a=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:r.O(sn,Wi,n))*a.a}getOpacityAtLatLng(n,a){return this._transform.projection.supportsFog?function(d,p,g){let v=r.L.fromLngLat(p),k=g.elevation?g.elevation.getAtPointOrZero(v):0;return nn(d,v.x,v.y,k,g)}(this.state,n,a):0}getOpacityForTile(n){if(!this._transform.projection.supportsFog)return[1,1];let a=this._transform.calculateFogTileMatrix(n.toUnwrapped());return dr(this.state,a,0,0,r.V,r.V,this._transform)}getOpacityForBounds(n,a,d,p,g){return this._transform.projection.supportsFog?dr(this.state,n,a,d,p,g,this._transform):[1,1]}getFovAdjustedRange(n){return this._transform.projection.supportsFog?Gi(this.state,n):[0,1]}isVisibleOnFrustum(n){if(!this._transform.projection.supportsFog)return!1;let a=[4,5,6,7];for(let d of a){let p=n.points[d],g;if(p[2]>=0)g=p;else{let v=n.points[d-4];g=r.W(v,p,v[2]/(v[2]-p[2]))}if(nn(this.state,g[0],g[1],0,this._transform)>=Fi)return!0}return!1}updateConfig(n){this._transitionable.setTransitionOrValue(this._options,new Map(n))}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,a,d){return(!d||d.validate!==!1)&&bt(this,n.call(Mo,r.e({value:a,style:{glyphs:!0,sprite:!0},styleSpec:r.D})))}}class Br extends r.E{constructor(n,a,d,p){super(),this.scope=d,this._options=n,this.properties=new r.Q(a),this._transitionable=new r.J(a,d,new Map(p)),this._transitionable.setTransitionOrValue(n.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(n){this._transitionable.setTransitionOrValue(this._options.properties,new Map(n))}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(n,a){this._options=n,this._transitionable.setTransitionOrValue(n.properties,a)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}let to=new r.F({color:new r.G(r.D.properties_light_ambient.color),intensity:new r.G(r.D.properties_light_ambient.intensity)}),Kn=new r.F({direction:new r.X(r.D.properties_light_directional.direction),color:new r.G(r.D.properties_light_directional.color),intensity:new r.G(r.D.properties_light_directional.intensity),"cast-shadows":new r.G(r.D.properties_light_directional["cast-shadows"]),"shadow-intensity":new r.G(r.D.properties_light_directional["shadow-intensity"])});class Zn{constructor(n,a,d,p){this.screenBounds=n,this.cameraPoint=a,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=d,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,p)}static createFromScreenPoints(n,a){let d,p;if(n instanceof r.P||typeof n[0]=="number"){let g=r.P.convert(n);d=[g],p=a.isPointAboveHorizon(g)}else{let g=r.P.convert(n[0]),v=r.P.convert(n[1]);d=[g,v],p=r.Y(g,v).every(k=>a.isPointAboveHorizon(k))}return new Zn(d,a.getCameraPoint(),p,a)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(n){return r.Y(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){let a=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],p=r.Y(a,d,0,!1);return this.cameraPoint.y>d.y&&(this.cameraPoint.x>a.x&&this.cameraPoint.x<d.x?p.splice(3,0,this.cameraPoint):this.cameraPoint.x>=d.x?p[2]=this.cameraPoint:this.cameraPoint.x<=a.x&&(p[3]=this.cameraPoint)),r._(p,n)}bufferedCameraGeometryGlobe(n){let a=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],p=r.Y(a,d,n),g=this.cameraPoint.clone();switch(3*((g.y>a.y)+(g.y>d.y))+((g.x>a.x)+(g.x>d.x))){case 0:p[0]=g,p[4]=g.clone();break;case 1:p.splice(1,0,g);break;case 2:p[1]=g;break;case 3:p.splice(4,0,g);break;case 5:p.splice(2,0,g);break;case 6:p[3]=g;break;case 7:p.splice(3,0,g);break;case 8:p[2]=g}return p}containsTile(n,a,d,p=0){let g=n.queryPadding/a._pixelsPerMercatorPixel+1,v=d?this._bufferedCameraMercator(g,a):this._bufferedScreenMercator(g,a),k=n.tileID.wrap+(v.unwrapped?p:0),S=v.polygon.map(G=>r.$(n.tileTransform,G,k));if(!r.a0(S,0,0,r.V,r.V))return;k=n.tileID.wrap+(this.screenGeometryMercator.unwrapped?p:0);let E=this.screenGeometryMercator.polygon.map(G=>r.a1(n.tileTransform,G,k)),A=E.map(G=>new r.P(G[0],G[1])),P=a.getFreeCameraOptions().position||new r.L(0,0,0),z=r.a1(n.tileTransform,P,k),O=E.map(G=>{let N=r.N.sub(G,G,z);return r.N.normalize(N,N),new r.a2(z,N)}),U=r.a3(n,1,a.zoom)*a._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:A,tilespaceRays:O,bufferedTilespaceGeometry:S,bufferedTilespaceBounds:(V=r.a4(S),V.min.x=r.aa(V.min.x,0,r.V),V.min.y=r.aa(V.min.y,0,r.V),V.max.x=r.aa(V.max.x,0,r.V),V.max.y=r.aa(V.max.y,0,r.V),V),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:U};var V}_bufferedScreenMercator(n,a){let d=He(n);if(this._screenRaycastCache[d])return this._screenRaycastCache[d];{let p;return p=a.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(n),a):{polygon:this.bufferedScreenGeometry(n).map(g=>a.pointCoordinate3D(g)),unwrapped:!0},this._screenRaycastCache[d]=p,p}}_bufferedCameraMercator(n,a){let d=He(n);if(this._cameraRaycastCache[d])return this._cameraRaycastCache[d];{let p;return p=a.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(n),a):{polygon:this.bufferedCameraGeometry(n).map(g=>a.pointCoordinate3D(g)),unwrapped:!0},this._cameraRaycastCache[d]=p,p}}_projectAndResample(n,a){let d=function(g,v){let k=r.a6.multiply([],v.pixelMatrix,v.globeMatrix),S=[0,-r.ab,0,1],E=[0,r.ab,0,1],A=[0,0,0,1];r.a7.transformMat4(S,S,k),r.a7.transformMat4(E,E,k),r.a7.transformMat4(A,A,k);let P=new r.P(S[0]/S[3],S[1]/S[3]),z=new r.P(E[0]/E[3],E[1]/E[3]),O=r.a8(g,P)&&S[3]<A[3],U=r.a8(g,z)&&E[3]<A[3];if(!O&&!U)return null;let V=function(ee,oe,ae){for(let ce=1;ce<ee.length;ce++){let be=Ae(oe.pointCoordinate3D(ee[ce-1]).x),ue=Ae(oe.pointCoordinate3D(ee[ce]).x);if(ae<0){if(be<ue)return{idx:ce,t:-be/(ue-1-be)}}else if(ue<be)return{idx:ce,t:(1-be)/(ue+1-be)}}return null}(g,v,O?-1:1);if(!V)return null;let{idx:G,t:N}=V,H=G>1?Ce(g.slice(0,G),v):[],Q=G<g.length?Ce(g.slice(G),v):[];H=H.map(ee=>new r.P(Ae(ee.x),ee.y)),Q=Q.map(ee=>new r.P(Ae(ee.x),ee.y));let W=[...H];W.length===0&&W.push(Q[Q.length-1]);let J=r.U(W[W.length-1].y,(Q.length===0?H[0]:Q[0]).y,N),$;return $=O?[new r.P(0,J),new r.P(0,0),new r.P(1,0),new r.P(1,J)]:[new r.P(1,J),new r.P(1,1),new r.P(0,1),new r.P(0,J)],W.push(...$),Q.length===0?W.push(H[0]):W.push(...Q),{polygon:W.map(ee=>new r.L(ee.x,ee.y)),unwrapped:!1}}(n,a);if(d)return d;let p=function(g,v){let k=!1,S=-1/0,E=0;for(let P=0;P<g.length-1;P++)g[P].x>S&&(S=g[P].x,E=P);for(let P=0;P<g.length-1;P++){let z=(E+P)%(g.length-1),O=g[z],U=g[z+1];Math.abs(O.x-U.x)>.5&&(O.x<U.x?(O.x+=1,z===0&&(g[g.length-1].x+=1)):(U.x+=1,z+1===g.length-1&&(g[0].x+=1)),k=!0)}let A=r.a5(v.center.lng);return k&&A<Math.abs(A-1)&&g.forEach(P=>{P.x-=1}),{polygon:g,unwrapped:k}}(Ce(n,a).map(g=>new r.P(Ae(g.x),g.y)),a);return{polygon:p.polygon.map(g=>new r.L(g.x,g.y)),unwrapped:p.unwrapped}}}function Ce(c,n){return r.a9(c,a=>{let d=n.pointCoordinate3D(a);a.x=d.x,a.y=d.y},1/256)}function Ae(c){return c<0?1+c%1:c%1}function He(c){return 100*c|0}function tt(c,n,a,d,p){let g=function(v,k){if(v)return p(v);if(k){c.url&&k.tiles&&c.tiles&&delete c.tiles;let S=r.ac(r.e(k,c),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);k.vector_layers&&(S.vectorLayers=k.vector_layers,S.vectorLayerIds=S.vectorLayers.map(E=>E.id)),k.raster_layers&&(S.rasterLayers=k.raster_layers,S.rasterLayerIds=S.rasterLayers.map(E=>E.id)),S.tiles=n.canonicalizeTileset(S,c.url),p(null,S)}};return c.url?r.g(n.transformRequest(n.normalizeSourceURL(c.url,null,a,d),r.R.Source),g):r.f.frame(()=>g(null,c))}class Ke{constructor(n,a,d){this.bounds=r.ad.convert(this.validateBounds(n)),this.minzoom=a||0,this.maxzoom=d||24}validateBounds(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}contains(n){let a=Math.pow(2,n.z),d=Math.floor(r.a5(this.bounds.getWest())*a),p=Math.floor(r.ae(this.bounds.getNorth())*a),g=Math.ceil(r.a5(this.bounds.getEast())*a),v=Math.ceil(r.ae(this.bounds.getSouth())*a);return n.x>=d&&n.x<g&&n.y>=p&&n.y<v}}class ot extends r.E{constructor(n,a,d,p){if(super(),this.id=n,this.dispatcher=d,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,r.e(this,r.ac(a,["url","scheme","tileSize","promoteId"])),this._options=r.e({type:"vector"},a),this._collectResourceTiming=!!a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p),this._tileWorkers={},this._deduped=new r.af}load(n){this._loaded=!1,this.fire(new r.b("dataloading",{dataType:"source"}));let a=Array.isArray(this.map._language)?this.map._language.join():this.map._language,d=this.map._worldview;this._tileJSONRequest=tt(this._options,this.map._requestManager,a,d,(p,g)=>{this._tileJSONRequest=null,this._loaded=!0,p?(a&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${a}`),d&&d.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${d}`),this.fire(new r.a(p))):g&&(r.e(this,g),g.bounds&&(this.tileBounds=new Ke(g.bounds,this.minzoom,this.maxzoom)),r.aj(g.tiles,this.map._requestManager._customAccessToken),this.fire(new r.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.b("data",{dataType:"source",sourceDataType:"content"}))),n&&n(p)})}loaded(){return this._loaded}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest();let n=r.ag(this.id,this.scope);this.load(()=>this.map.style.clearSource(n))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return r.e({},this._options)}loadTile(n,a){let d=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme)),p={request:this.map._requestManager.transformRequest(d,r.R.Tile),data:void 0,uid:n.uid,tileID:n.tileID,tileZoom:n.tileZoom,zoom:n.tileID.overscaledZ,tileSize:this.tileSize*n.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:r.f.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:n.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:n.isExtraShadowCaster};if(p.request.collectResourceTiming=this._collectResourceTiming,n.actor&&n.state!=="expired")n.state==="loading"?n.reloadCallback=a:n.request=n.actor.send("reloadTile",p,g.bind(this));else if(n.actor=this._tileWorkers[d]=this._tileWorkers[d]||this.dispatcher.getActor(),this.dispatcher.ready)n.request=n.actor.send("loadTile",p,g.bind(this),void 0,!0);else{let v=r.ah.call({deduped:this._deduped},p,(k,S)=>{k||!S?g.call(this,k):(p.data={cacheControl:S.cacheControl,expires:S.expires,rawData:S.rawData.slice(0)},n.actor&&n.actor.send("loadTile",p,g.bind(this),void 0,!0))},!0);n.request={cancel:v}}function g(v,k){return delete n.request,n.aborted?a(null):v&&v.status!==404?a(v):(k&&k.resourceTiming&&(n.resourceTiming=k.resourceTiming),this.map._refreshExpiredTiles&&k&&n.setExpiryData(k),n.loadVectorData(k,this.map.painter),r.ai(this.dispatcher),a(null),void(n.reloadCallback&&(this.loadTile(n,n.reloadCallback),n.reloadCallback=null)))}}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(n){n.actor&&n.actor.send("removeTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope}),n.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class at extends r.E{constructor(n,a,d,p){super(),this.id=n,this.dispatcher=d,this.setEventedParent(p),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=r.e({type:"raster"},a),r.e(this,r.ac(a,["url","scheme","tileSize"]))}load(n){this._loaded=!1,this.fire(new r.b("dataloading",{dataType:"source"})),this._tileJSONRequest=tt(this._options,this.map._requestManager,null,null,(a,d)=>{this._tileJSONRequest=null,this._loaded=!0,a?this.fire(new r.a(a)):d&&(r.e(this,d),d.bounds&&(this.tileBounds=new Ke(d.bounds,this.minzoom,this.maxzoom)),r.aj(d.tiles),this.fire(new r.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.b("data",{dataType:"source",sourceDataType:"content"}))),n&&n(a)})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest();let n=r.ag(this.id,this.scope);this.load(()=>this.map.style.clearSource(n))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return r.e({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,a){let d=r.f.devicePixelRatio>=2,p=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),d,this.tileSize);n.request=r.d(this.map._requestManager.transformRequest(p,r.R.Tile),(g,v,k,S)=>(delete n.request,n.aborted?(n.state="unloaded",a(null)):g?(n.state="errored",a(g)):v?(this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:k,expires:S}),n.setTexture(v,this.map.painter),n.state="loaded",r.ai(this.dispatcher),void a(null)):a(null)))}abortTile(n,a){n.request&&(n.request.cancel(),delete n.request),a()}unloadTile(n,a){n.texture&&n.texture instanceof r.T?(n.destroy(!0),n.texture&&n.texture instanceof r.T&&this.map.painter.saveTileTexture(n.texture)):n.destroy(),a()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Je extends at{constructor(n,a,d,p){super(n,a,d,p),this.type="raster-array",this.maxzoom=22,this._options=r.e({type:"raster-array"},a)}triggerRepaint(n){let a=this.map.painter._terrain,d=this.map.style.getSourceCache(this.id);a&&a.enabled&&d&&a._clearRenderCacheForTile(d.id,n.tileID),this.map.triggerRepaint()}loadTile(n,a){let d=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),p=this.map._requestManager.transformRequest(d,r.R.Tile);n.requestParams=p,n.actor||(n.actor=this.dispatcher.getActor()),n.request=n.fetchHeader(void 0,(g,v,k,S)=>{if(delete n.request,n.aborted)return n.state="unloaded",a(null);if(g)return g.code===20?void 0:(n.state="errored",a(g));this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:k,expires:S}),n.state="empty",a(null)})}unloadTile(n){let a=n.texture;a&&a instanceof r.T?(n.destroy(!0),this.map.painter.saveTileTexture(a)):(n.destroy(),n.flushQueues(),n._isHeaderLoaded=!1,delete n._mrt,delete n.textureDescriptor),n.fbo&&(n.fbo.destroy(),delete n.fbo),delete n.request,delete n.requestParams,delete n.neighboringTiles,n.state="unloaded"}prepareTile(n,a,d){n._isHeaderLoaded&&(n.state!=="empty"&&(n.state="reloading"),n.fetchBand(a,d,(p,g)=>{if(p)return n.state="errored",this.fire(new r.a(p)),void this.triggerRepaint(n);g&&(n.setTexture(g,this.map.painter),n.state="loaded",this.triggerRepaint(n))}))}getInitialBand(n){if(!this.rasterLayers)return 0;let a=this.rasterLayers.find(({id:g})=>g===n),d=a&&a.fields,p=d&&d.bands&&d.bands;return p?p[0]:0}getTextureDescriptor(n,a,d){if(!n)return;let p=a.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!p)return;let g=null;a instanceof r.an?g=a.paint.get("raster-array-band"):a instanceof r.ao&&(g=a.paint.get("raster-particle-array-band"));let v=g||this.getInitialBand(p);if(v!=null)if(n.textureDescriptor){if(!n.updateNeeded(p,v)||d)return Object.assign({},n.textureDescriptor,{texture:n.texture})}else this.prepareTile(n,p,v)}}let ct=32,it=33,Ft=new Uint16Array(8184);for(let c=0;c<2046;c++){let n=c+2,a=0,d=0,p=0,g=0,v=0,k=0;for(1&n?p=g=v=ct:a=d=k=ct;(n>>=1)>1;){let E=a+p>>1,A=d+g>>1;1&n?(p=a,g=d,a=v,d=k):(a=p,d=g,p=v,g=k),v=E,k=A}let S=4*c;Ft[S+0]=a,Ft[S+1]=d,Ft[S+2]=p,Ft[S+3]=g}let pi=new Uint16Array(2178),kt=new Uint8Array(1089),Qi=new Uint16Array(1089);function un(c){return c===0?-.03125:c===32?.03125:0}let Mn=(()=>{class c{constructor(a,d,p,g){this.id=c.uniqueIdxCounter,c.uniqueIdxCounter++,this.context=a;let v=a.gl;this.buffer=v.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),a.bindElementBuffer.set(this.buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||g||d.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(a){this.id=c.uniqueIdxCounter,c.uniqueIdxCounter++;let d=this.context.gl;this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,a.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return c.uniqueIdxCounter=0,c})(),Qn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class wr{constructor(n,a,d,p,g,v){this.length=a.length,this.attributes=d,this.itemSize=a.bytesPerElement,this.dynamicDraw=p,this.instanceCount=v,this.context=n;let k=n.gl;this.buffer=k.createBuffer(),n.bindVertexBuffer.set(this.buffer),k.bufferData(k.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?k.DYNAMIC_DRAW:k.STATIC_DRAW),this.dynamicDraw||g||a.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){let a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,a){for(let d=0;d<this.attributes.length;d++){let p=a.attributes[this.attributes[d].name];p!==void 0&&n.enableVertexAttribArray(p)}}setVertexAttribPointers(n,a,d){for(let p=0;p<this.attributes.length;p++){let g=this.attributes[p],v=a.attributes[g.name];v!==void 0&&n.vertexAttribPointer(v,g.components,n[Qn[g.type]],!1,this.itemSize,g.offset+this.itemSize*(d||0))}}setVertexAttribDivisor(n,a,d){for(let p=0;p<this.attributes.length;p++){let g=a.attributes[this.attributes[p].name];g!==void 0&&this.instanceCount&&this.instanceCount>0&&n.vertexAttribDivisor(g,d)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ai{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class go extends Ai{getDefault(){return r.ax.transparent}set(n){let a=this.current;(n.r!==a.r||n.g!==a.g||n.b!==a.b||n.a!==a.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class Wo extends Ai{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class Tr extends Ai{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class vc extends Ai{getDefault(){return[!0,!0,!0,!0]}set(n){let a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||n[3]!==a[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Qa extends Ai{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class gl extends Ai{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class su extends Ai{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){let a=this.current;(n.func!==a.func||n.ref!==a.ref||n.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class Bs extends Ai{getDefault(){let n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){let a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class lu extends Ai{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;let a=this.gl;n?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=n,this.dirty=!1}}class yl extends Ai{getDefault(){return[0,1]}set(n){let a=this.current;(n[0]!==a[0]||n[1]!==a[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class lf extends Ai{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;let a=this.gl;n?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=n,this.dirty=!1}}class Md extends Ai{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class cu extends Ai{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;let a=this.gl;n?a.enable(a.BLEND):a.disable(a.BLEND),this.current=n,this.dirty=!1}}class Ed extends Ai{getDefault(){let n=this.gl;return[n.ONE,n.ZERO,n.ONE,n.ZERO]}set(n){let a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||n[3]!==a[3]||this.dirty)&&(this.gl.blendFuncSeparate(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class du extends Ai{getDefault(){return r.ax.transparent}set(n){let a=this.current;(n.r!==a.r||n.g!==a.g||n.b!==a.b||n.a!==a.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class io extends Ai{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(n,n),this.current=n,this.dirty=!1)}}class Wn extends Ai{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;let a=this.gl;n?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=n,this.dirty=!1}}class fi extends Ai{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class cf extends Ai{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}let Ad=class extends Ai{getDefault(){return null}set(c){(c!==this.current||this.dirty)&&(this.gl.useProgram(c),this.current=c,this.dirty=!1)}};class hu extends Ai{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class m0 extends Ai{getDefault(){let n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){let a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||n[3]!==a[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class fa extends Ai{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;let a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class uu extends Ai{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;let a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class p0 extends Ai{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;let a=this.gl;a.bindTexture(a.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class bl extends Ai{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;let a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class ht extends Ai{getDefault(){return null}set(n){let a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class Li extends Ai{getDefault(){return null}set(n){this.gl&&(n!==this.current||this.dirty)&&(this.gl.bindVertexArray(n),this.current=n,this.dirty=!1)}}class zi extends Ai{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;let a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class Eo extends Ai{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;let a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class vl extends Ai{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;let a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class Ti extends Ai{constructor(n,a){super(n),this.context=n,this.parent=a}getDefault(){return null}}class Dd extends Ti{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class xl extends Ti{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,this.attachment(),a.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class xc extends Ti{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,this.attachment(),a.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class no extends xl{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class $n{constructor(n,a,d,p,g){this.context=n,this.width=a,this.height=d;let v=this.framebuffer=n.gl.createFramebuffer();p&&(this.colorAttachment=new Dd(n,v)),g&&(this.depthAttachmentType=g,this.depthAttachment=g==="renderbuffer"?new xl(n,v):new xc(n,v))}destroy(){let n=this.context.gl;if(this.colorAttachment){let a=this.colorAttachment.get();a&&n.deleteTexture(a)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){let a=this.depthAttachment.get();a&&n.deleteRenderbuffer(a)}else{let a=this.depthAttachment.get();a&&n.deleteTexture(a)}n.deleteFramebuffer(this.framebuffer)}}class Rt{constructor(n,a,d){this.func=n,this.mask=a,this.range=d}}Rt.ReadOnly=!1,Rt.ReadWrite=!0,Rt.disabled=new Rt(519,Rt.ReadOnly,[0,1]);let Ns=7680;class jt{constructor(n,a,d,p,g,v){this.test=n,this.ref=a,this.mask=d,this.fail=p,this.depthFail=g,this.pass=v}}jt.disabled=new jt({func:519,mask:0},0,0,Ns,Ns,Ns);let Ja=771;class ri{constructor(n,a,d,p){this.blendFunction=n,this.blendColor=a,this.mask=d,this.blendEquation=p}}ri.Replace=[1,0,1,0],ri.disabled=new ri(ri.Replace,r.ax.transparent,[!1,!1,!1,!1]),ri.unblended=new ri(ri.Replace,r.ax.transparent,[!0,!0,!0,!0]),ri.alphaBlended=new ri([1,Ja,1,Ja],r.ax.transparent,[!0,!0,!0,!0]),ri.multiply=new ri([774,0,774,0],r.ax.transparent,[!0,!0,!0,!0]);let wl=1029,kr=2305;class Lt{constructor(n,a,d){this.enable=n,this.mode=a,this.frontFace=d}}Lt.disabled=new Lt(!1,wl,kr),Lt.backCCW=new Lt(!0,wl,kr),Lt.backCW=new Lt(!0,wl,2304),Lt.frontCW=new Lt(!0,1028,2304),Lt.frontCCW=new Lt(!0,1028,kr);class df{constructor(n,a){this.gl=n,this.clearColor=new go(this),this.clearDepth=new Wo(this),this.clearStencil=new Tr(this),this.colorMask=new vc(this),this.depthMask=new Qa(this),this.stencilMask=new gl(this),this.stencilFunc=new su(this),this.stencilOp=new Bs(this),this.stencilTest=new lu(this),this.depthRange=new yl(this),this.depthTest=new lf(this),this.depthFunc=new Md(this),this.blend=new cu(this),this.blendFunc=new Ed(this),this.blendColor=new du(this),this.blendEquation=new io(this),this.cullFace=new Wn(this),this.cullFaceSide=new fi(this),this.frontFace=new cf(this),this.program=new Ad(this),this.activeTexture=new hu(this),this.viewport=new m0(this),this.bindFramebuffer=new fa(this),this.bindRenderbuffer=new uu(this),this.bindTexture=new p0(this),this.bindVertexBuffer=new bl(this),this.bindElementBuffer=new ht(this),this.bindVertexArrayOES=new Li(this),this.pixelStoreUnpack=new zi(this),this.pixelStoreUnpackPremultiplyAlpha=new Eo(this),this.pixelStoreUnpackFlipY=new vl(this),this.options=a?It({},a):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=n.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=n.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=n.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=n.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE),this.maxPointSize=n.getParameter(n.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,a,d){return new Mn(this,n,a,d)}createVertexBuffer(n,a,d,p,g){return new wr(this,n,a,d,p,g)}createRenderbuffer(n,a,d){let p=this.gl,g=p.createRenderbuffer();return this.bindRenderbuffer.set(g),p.renderbufferStorage(p.RENDERBUFFER,n,a,d),this.bindRenderbuffer.set(null),g}createFramebuffer(n,a,d,p){return new $n(this,n,a,d,p)}clear({color:n,depth:a,stencil:d,colorMask:p}){let g=this.gl,v=0;n&&(v|=g.COLOR_BUFFER_BIT,this.clearColor.set(n),this.colorMask.set(p||[!0,!0,!0,!0])),a!==void 0&&(v|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),d!==void 0&&(v|=g.STENCIL_BUFFER_BIT,this.clearStencil.set(d),this.stencilMask.set(255)),g.clear(v)}setCullFace(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){M(n.blendFunction,ri.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor),n.blendEquation?this.blendEquation.set(n.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(n.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}var js=r.ay([{name:"a_pos",type:"Float32",components:3}]);class Jn{constructor(n,a,d,p){let g={width:d[0],height:d[1],data:null},v=n.gl;this.targetColorTexture=new r.T(n,g,v.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new r.T(n,g,v.RGBA,{useMipmap:!1}),this.context=n,this.setNumParticles(a,p),this.lastInvalidatedAt=0}setNumParticles(n,a){if(this.numParticles===a)return;(this.particleVertices0||this.particleVertices1||this.particleSegment)&&(this.particleVertices0.destroy(),this.particleVertices1.destroy(),this.particleSegment.destroy());let d=new r.az;d.reserve(Math.round(a));let p=r.aA(n.key);for(let g=0;g<a;g++)d.emplaceBack(p(),p(),p());this.particleVertices0=this.context.createVertexBuffer(d,js.members,!0),this.particleVertices1=this.context.createVertexBuffer(d,js.members,!0),this.particleSegment=r.aB.simpleSegment(0,0,this.particleVertices0.length,0),this.numParticles=a}update(n){return!(this.lastInvalidatedAt<n&&(this.lastInvalidatedAt=r.f.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleVertices0.destroy(),this.particleVertices1.destroy(),this.particleSegment.destroy()}}let Ao={type:2,extent:r.V,loadGeometry:()=>[[new r.P(0,0),new r.P(r.V+1,0),new r.P(r.V+1,r.V+1),new r.P(0,r.V+1),new r.P(0,0)]]};class es{constructor(n,a,d,p,g){this.tileID=n,this.uid=r.aC(),this.uses=0,this.tileSize=a,this.tileZoom=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=g,p&&p.style&&(this._lastUpdatedBrightness=p.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",p&&p.transform&&(this.projection=p.transform.projection)}registerFadeDuration(n){let a=n+this.timeAdded;a<r.f.now()||this.fadeEndTime&&a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=r.as(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(n,a,d){if(this.unloadVectorData(),this.state="loaded",n){n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=function(p,g){let v={};if(!g)return v;for(let k of p){let S=k.layerIds.map(E=>g.getLayer(E)).filter(Boolean);if(S.length!==0){k.layers=S,k.stateDependentLayerIds&&(k.stateDependentLayers=k.stateDependentLayerIds.map(E=>S.filter(A=>A.id===E)[0]));for(let E of S)v[E.fqid]=k}}return v}(n.buckets,a.style),this.hasSymbolBuckets=!1;for(let p in this.buckets){let g=this.buckets[p];if(g instanceof r.aE){if(this.hasSymbolBuckets=!0,!d)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let p in this.buckets){let g=this.buckets[p];if(g instanceof r.aE&&g.hasRTLText){this.hasRTLText=!0,r.aF();break}}this.queryPadding=0;for(let p in this.buckets){let g=this.buckets[p],v=a.style.getOwnLayer(p);if(!v)continue;let k=v.queryRadius(g);this.queryPadding=Math.max(this.queryPadding,k)}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage),n.lineAtlas&&(this.lineAtlas=n.lineAtlas),this._lastUpdatedBrightness=n.brightness}else this.collisionBoxArray=new r.aD}unloadVectorData(){if(this.hasData()){for(let n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(n){return this.buckets[n.fqid]}upload(n){for(let p in this.buckets){let g=this.buckets[p];g.uploadPending()&&g.upload(n)}let a=n.gl,d=this.imageAtlas;if(d&&!d.uploaded){let p=!!Object.keys(d.patternPositions).length;this.imageAtlasTexture=new r.T(n,d.image,a.RGBA,{useMipmap:p}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new r.T(n,this.glyphAtlasImage,a.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new r.T(n,this.lineAtlas.image,a.R8),this.lineAtlas.uploaded=!0)}prepare(n,a,d){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture,d),!a||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;let p=a.style.getBrightness();(this._lastUpdatedBrightness||p)&&(this._lastUpdatedBrightness&&p&&Math.abs(this._lastUpdatedBrightness-p)<.001||(this._lastUpdatedBrightness=p,this.updateBuckets(void 0,a)))}queryRenderedFeatures(n,a,d,p,g,v,k,S){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:p,pixelPosMatrix:k,transform:v,params:g,tileTransform:this.tileTransform},n,a,d):{}}querySourceFeatures(n,a){let d=this.latestFeatureIndex;if(!d||!d.rawTileData)return;let p=d.loadVTLayers(),g=a?a.sourceLayer:"",v=p._geojsonTileLayer||p[g];if(!v)return;let k=r.aG(a&&a.filter),{z:S,x:E,y:A}=this.tileID.canonical,P={z:S,x:E,y:A};for(let z=0;z<v.length;z++){let O=v.feature(z);if(k.needGeometry){let G=r.aH(O,!0);if(!k.filter(new r.K(this.tileID.overscaledZ),G,this.tileID.canonical))continue}else if(!k.filter(new r.K(this.tileID.overscaledZ),O))continue;let U=d.getId(O,g),V=new r.aI(O,S,E,A,U);V.tile=P,n.push(V)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}bucketsLoaded(){for(let n in this.buckets)if(this.buckets[n].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(n){let a=this.expirationTime;if(n.cacheControl){let d=r.aJ(n.cacheControl);d["max-age"]&&(this.expirationTime=Date.now()+1e3*d["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){let d=Date.now(),p=!1;if(this.expirationTime>d)p=!1;else if(a)if(this.expirationTime<a)p=!0;else{let g=this.expirationTime-a;g?this.expirationTime=d+Math.max(g,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(n,a){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(n).length!==0&&a&&this.updateBuckets(n,a)}updateBuckets(n,a){if(!this.latestFeatureIndex)return;let d=this.latestFeatureIndex.loadVTLayers(),p=a.style.listImages(),g=a.style.getBrightness();for(let v in this.buckets){if(!a.style.hasLayer(v))continue;let k=this.buckets[v],S=k.layers[0].sourceLayer||"_geojsonTileLayer",E=d[S],A={};if(n&&(A=n[S],!E||!A||Object.keys(A).length===0))continue;if(k.update(A,E,p,this.imageAtlas&&this.imageAtlas.patternPositions||{},g),k instanceof r.aK||k instanceof r.aL){let z=a.style.getOwnSourceCache(k.layers[0].source);a._terrain&&a._terrain.enabled&&z&&k.programConfigurations.needsUpload&&a._terrain._clearRenderCacheForTile(z.id,this.tileID)}let P=a&&a.style&&a.style.getOwnLayer(v);P&&(this.queryPadding=Math.max(this.queryPadding,P.queryRadius(k)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<r.f.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(n){this.symbolFadeHoldUntil=r.f.now()+n}setTexture(n,a){let d=a.context,p=d.gl;this.texture=this.texture||a.getTileTexture(n.width),this.texture&&this.texture instanceof r.T?this.texture.update(n,{useMipmap:!0}):(this.texture=new r.T(d,n,p.RGBA,{useMipmap:!0}),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE))}setDependencies(n,a){let d={};for(let p of a)d[p]=!0;this.dependencies[n]=d}hasDependency(n,a){for(let d of n){let p=this.dependencies[d];if(p){for(let g of a)if(p[g])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(n,a){if(!a||a.name==="mercator"||this._tileDebugBuffer)return;let d=r.aM(Ao,this.tileID.canonical,this.tileTransform)[0],p=new r.aN,g=new r.aO;for(let v=0;v<d.length;v++){let{x:k,y:S}=d[v];p.emplaceBack(k,S),g.emplaceBack(v)}g.emplaceBack(0),this._tileDebugIndexBuffer=n.createIndexBuffer(g),this._tileDebugBuffer=n.createVertexBuffer(p,r.aP.members),this._tileDebugSegments=r.aB.simpleSegment(0,0,p.length,g.length)}_makeTileBoundsBuffers(n,a){if(this._tileBoundsBuffer||!a||a.name==="mercator")return;let d=r.aM(Ao,this.tileID.canonical,this.tileTransform)[0],p,g;if(this.isRaster){let v=function(k,S){let E=r.as(k,S),A=Math.pow(2,k.z);for(let G=0;G<it;G++)for(let N=0;N<it;N++){let H=r.at((k.x+(N+un(N))/ct)/A),Q=r.au((k.y+(G+un(G))/ct)/A),W=S.project(H,Q),J=G*it+N;pi[2*J+0]=Math.round((W.x*E.scale-E.x)*r.V),pi[2*J+1]=Math.round((W.y*E.scale-E.y)*r.V)}kt.fill(0),Qi.fill(0);for(let G=2045;G>=0;G--){let N=4*G,H=Ft[N+0],Q=Ft[N+1],W=Ft[N+2],J=Ft[N+3],$=H+W>>1,ee=Q+J>>1,oe=$+ee-Q,ae=ee+H-$,ce=Q*it+H,be=J*it+W,ue=ee*it+$,Ie=Math.hypot((pi[2*ce+0]+pi[2*be+0])/2-pi[2*ue+0],(pi[2*ce+1]+pi[2*be+1])/2-pi[2*ue+1])>=16;kt[ue]=kt[ue]||(Ie?1:0),G<1022&&(kt[ue]=kt[ue]||kt[(Q+ae>>1)*it+(H+oe>>1)]||kt[(J+ae>>1)*it+(W+oe>>1)])}let P=new r.av,z=new r.aw,O=0;function U(G,N){let H=N*it+G;return Qi[H]===0&&(P.emplaceBack(pi[2*H+0],pi[2*H+1],G*r.V/ct,N*r.V/ct),Qi[H]=++O),Qi[H]-1}function V(G,N,H,Q,W,J){let $=G+H>>1,ee=N+Q>>1;if(Math.abs(G-W)+Math.abs(N-J)>1&&kt[ee*it+$])V(W,J,G,N,$,ee),V(H,Q,W,J,$,ee);else{let oe=U(G,N),ae=U(H,Q),ce=U(W,J);z.emplaceBack(oe,ae,ce)}}return V(0,0,ct,ct,ct,0),V(ct,ct,0,0,0,ct),{vertices:P,indices:z}}(this.tileID.canonical,a);p=v.vertices,g=v.indices}else{p=new r.av,g=new r.aw;for(let{x:k,y:S}of d)p.emplaceBack(k,S,0,0);let v=r.aQ(p.int16,void 0,4);for(let k=0;k<v.length;k+=3)g.emplaceBack(v[k],v[k+1],v[k+2])}this._tileBoundsBuffer=n.createVertexBuffer(p,r.aR.members),this._tileBoundsIndexBuffer=n.createIndexBuffer(g),this._tileBoundsSegments=r.aB.simpleSegment(0,0,p.length,g.length)}_makeGlobeTileDebugBuffers(n,a){let d=a.projection;if(!d||d.name!=="globe"||a.freezeTileCoverage)return;let p=this.tileID.canonical,g=r.aS(p,a),v=r.aT(g),k=r.S(a.zoom),S;k>0&&(S=r.a6.invert(new Float64Array(16),a.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(n,p,a,v,S,k),this._makeGlobeTileDebugTextBuffer(n,p,a,v,S,k)}_globePoint(n,a,d,p,g,v,k){let S=r.aU(n,a,d);if(v){let E=1<<d.z,A=r.a5(p.center.lng),P=r.ae(p.center.lat),z=(d.x+.5)/E-A,O=0;z>.5?O=-1:z<-.5&&(O=1);let U=(n/r.V+d.x)/E+O,V=(a/r.V+d.y)/E;U=(U-A)*p._pixelsPerMercatorPixel+A,V=(V-P)*p._pixelsPerMercatorPixel+P;let G=[U*p.worldSize,V*p.worldSize,0];r.N.transformMat4(G,G,v),S=r.aV(S,G,k)}return r.N.transformMat4(S,S,g)}_makeGlobeTileDebugBorderBuffer(n,a,d,p,g,v){let k=new r.aN,S=new r.aO,E=new r.aW,A=(z,O,U,V,G)=>{let N=(U-z)/(G-1),H=(V-O)/(G-1),Q=k.length;for(let W=0;W<G;W++){let J=z+W*N,$=O+W*H;k.emplaceBack(J,$);let ee=this._globePoint(J,$,a,d,p,g,v);E.emplaceBack(ee[0],ee[1],ee[2]),S.emplaceBack(Q+W)}},P=r.V;A(0,0,P,0,16),A(P,0,P,P,16),A(P,P,0,P,16),A(0,P,0,0,16),this._tileDebugIndexBuffer=n.createIndexBuffer(S),this._tileDebugBuffer=n.createVertexBuffer(k,r.aP.members),this._globeTileDebugBorderBuffer=n.createVertexBuffer(E,r.aX.members),this._tileDebugSegments=r.aB.simpleSegment(0,0,k.length,S.length)}_makeGlobeTileDebugTextBuffer(n,a,d,p,g,v){let k=r.V/4,S=new r.aN,E=new r.aw,A=new r.aW,P=25;E.reserve(32),S.reserve(P),A.reserve(P);let z=(O,U)=>P*O+U;for(let O=0;O<P;O++){let U=O*k;for(let V=0;V<P;V++){let G=V*k;S.emplaceBack(G,U);let N=this._globePoint(G,U,a,d,p,g,v);A.emplaceBack(N[0],N[1],N[2])}}for(let O=0;O<4;O++)for(let U=0;U<4;U++){let V=z(O,U),G=z(O,U+1),N=z(O+1,U),H=z(O+1,U+1);E.emplaceBack(V,G,N),E.emplaceBack(N,G,H)}this._tileDebugTextIndexBuffer=n.createIndexBuffer(E),this._tileDebugTextBuffer=n.createVertexBuffer(S,r.aP.members),this._globeTileDebugTextBuffer=n.createVertexBuffer(A,r.aX.members),this._tileDebugTextSegments=r.aB.simpleSegment(0,0,P,32)}destroy(n=!1){for(let a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!n&&this.texture&&this.texture instanceof r.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}let Ma={vector:ot,raster:at,"raster-dem":class extends at{constructor(c,n,a,d){super(c,n,a,d),this.type="raster-dem",this.maxzoom=22,this._options=r.e({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(c,n){let a=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function d(p,g){p&&(c.state="errored",n(p)),g&&(c.dem=g,c.dem.onDeserialize(),c.needsHillshadePrepare=!0,c.needsDEMTextureUpload=!0,c.state="loaded",n(null))}c.request=r.d(this.map._requestManager.transformRequest(a,r.R.Tile),(function(p,g,v,k){if(delete c.request,c.aborted)c.state="unloaded",n(null);else if(p)c.state="errored",n(p);else if(g){this.map._refreshExpiredTiles&&c.setExpiryData({cacheControl:v,expires:k});let S=ImageBitmap&&g instanceof ImageBitmap&&r.ak(),E=1-(g.width-r.al(g.width))/2;E<1||c.neighboringTiles||(c.neighboringTiles=this._getNeighboringTiles(c.tileID));let A=S?g:r.f.getImageData(g,E),P={uid:c.uid,coord:c.tileID,source:this.id,scope:this.scope,rawImageData:A,encoding:this.encoding,padding:E};c.actor&&c.state!=="expired"||(c.actor=this.dispatcher.getActor(),c.actor.send("loadDEMTile",P,d.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(c){let n=c.canonical,a=Math.pow(2,n.z),d=(n.x-1+a)%a,p=n.x===0?c.wrap-1:c.wrap,g=(n.x+1+a)%a,v=n.x+1===a?c.wrap+1:c.wrap,k={};return k[new r.am(c.overscaledZ,p,n.z,d,n.y).key]={backfilled:!1},k[new r.am(c.overscaledZ,v,n.z,g,n.y).key]={backfilled:!1},n.y>0&&(k[new r.am(c.overscaledZ,p,n.z,d,n.y-1).key]={backfilled:!1},k[new r.am(c.overscaledZ,c.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},k[new r.am(c.overscaledZ,v,n.z,g,n.y-1).key]={backfilled:!1}),n.y+1<a&&(k[new r.am(c.overscaledZ,p,n.z,d,n.y+1).key]={backfilled:!1},k[new r.am(c.overscaledZ,c.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},k[new r.am(c.overscaledZ,v,n.z,g,n.y+1).key]={backfilled:!1}),k}},"raster-array":Je,geojson:class extends r.E{constructor(c,n,a,d){super(),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=a.getActor(),this.setEventedParent(d),this._data=n.data,this._options=r.e({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;let p=r.V/this.tileSize;this.workerOptions=r.e({source:this.id,scope:this.scope,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*p,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*p,extent:r.V,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:r.V,radius:(n.clusterRadius!==void 0?n.clusterRadius:50)*p,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions)}onAdd(c){this.map=c,this.setData(this._data)}setData(c){return this._data=c,this._updateWorkerData(),this}getClusterExpansionZoom(c,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:c,source:this.id,scope:this.scope},n),this}getClusterChildren(c,n){return this.actor.send("geojson.getClusterChildren",{clusterId:c,source:this.id,scope:this.scope},n),this}getClusterLeaves(c,n,a,d){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:c,limit:n,offset:a},d),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new r.b("dataloading",{dataType:"source"})),this._loaded=!1;let c=r.e({},this.workerOptions);c.scope=this.scope;let n=this._data;typeof n=="string"?(c.request=this.map._requestManager.transformRequest(r.f.resolveURL(n),r.R.Source),c.request.collectResourceTiming=this._collectResourceTiming):c.data=JSON.stringify(n),this._pendingLoad=this.actor.send(`${this.type}.loadData`,c,(a,d)=>{if(this._loaded=!0,this._pendingLoad=null,a)this.fire(new r.a(a));else{let p={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&d&&d.resourceTiming&&d.resourceTiming[this.id]&&(p.resourceTiming=d.resourceTiming[this.id]),this.fire(new r.b("data",p)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(c,n){let a=c.actor?"reloadTile":"loadTile";c.actor=this.actor;let d={type:this.type,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:r.f.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};c.request=this.actor.send(a,d,(p,g)=>(delete c.request,c.destroy(),c.aborted?n(null):p?n(p):(c.loadVectorData(g,this.map.painter,a==="reloadTile"),n(null))),void 0,a==="loadTile")}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.aborted=!0}unloadTile(c){this.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id,scope:this.scope}),c.destroy()}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return r.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends r.ap{constructor(c,n,a,d){super(c,n,a,d),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;let c=this.options;this.urls=[];for(let n of c.urls)this.urls.push(this.map._requestManager.transformRequest(n,r.R.Source).url);r.aq(this.urls,(n,a)=>{this._loaded=!0,n?this.fire(new r.a(n)):a&&(this.video=a,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(c){if(this.video){let n=this.video.seekable;c<n.start(0)||c>n.end(0)?this.fire(new r.a(new lt(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=c}}getVideo(){return this.video}onAdd(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let c=this.map.painter.context,n=c.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new r.T(c,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(c)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:r.ap,model:class extends r.E{constructor(c,n,a,d){super(),this.id=c,this.type="model",this.models=[],this._loaded=!1,this._options=n}load(){let c=[];for(let n in this._options.models){let a=this._options.models[n],d=r.l(this.map._requestManager.transformRequest(a.uri,r.R.Model).url).then(p=>{if(!p)return;let g=r.c(p),v=new r.M(n,a.position,a.orientation,g);v.computeBoundsAndApplyParent(),this.models.push(v)}).catch(p=>{this.fire(new r.a(new Error(`Could not load model ${n} from ${a.uri}: ${p.message}`)))});c.push(d)}return Promise.allSettled(c).then(()=>{this._loaded=!0,this.fire(new r.b("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(n=>{this.fire(new r.a(new Error(`Could not load models: ${n.message}`)))})}onAdd(c){this.map=c,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(c,n){}serialize(){return{type:"model"}}},"batched-model":class extends r.E{constructor(c,n,a,d){super(),this.type="batched-model",this.id=c,this.tileSize=512,this._options=n,this.tiles=this._options.tiles,this.maxzoom=n.maxzoom||19,this.minzoom=n.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=a,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(d)}onAdd(c){this.map=c,this.load()}load(c){this._loaded=!1,this.fire(new r.b("dataloading",{dataType:"source"}));let n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,a=this.map._worldview;this._tileJSONRequest=tt(this._options,this.map._requestManager,n,a,(d,p)=>{this._tileJSONRequest=null,this._loaded=!0,d?(n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${n}`),a&&a.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${a}`),this.fire(new r.a(d))):p&&(r.e(this,p),p.bounds&&(this.tileBounds=new Ke(p.bounds,this.minzoom,this.maxzoom)),r.aj(p.tiles,this.map._requestManager._customAccessToken),this.fire(new r.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.b("data",{dataType:"source",sourceDataType:"content"}))),c&&c(d)})}hasTransition(){return!1}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}loaded(){return this._loaded}loadTile(c,n){let a=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),d={request:this.map._requestManager.transformRequest(a,r.R.Tile),data:void 0,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:c.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(c.actor&&c.state!=="expired")if(c.state==="loading")c.reloadCallback=n;else{if(c.buckets){let g=Object.values(c.buckets);for(let v of g)v.dirty=!0;return void(c.state="loaded")}c.request=c.actor.send("reloadTile",d,p.bind(this))}else c.actor=this.dispatcher.getActor(),c.request=c.actor.send("loadTile",d,p.bind(this),void 0,!0);function p(g,v){return c.aborted?n(null):g&&g.status!==404?n(g):(v&&(v.resourceTiming&&(c.resourceTiming=v.resourceTiming),this.map._refreshExpiredTiles&&c.setExpiryData(v),c.buckets=It(It({},c.buckets),v.buckets),v.featureIndex&&(c.latestFeatureIndex=v.featureIndex)),c.state="loaded",void n(null))}}serialize(){return r.e({},this._options)}},canvas:class extends r.ap{constructor(c,n,a,d){super(c,n,a,d),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(p=>!Array.isArray(p)||p.length!==2||p.some(g=>typeof g!="number"))||this.fire(new r.a(new lt(`sources.${c}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new r.a(new lt(`sources.${c}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new r.a(new lt(`sources.${c}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new r.a(new lt(`sources.${c}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new r.a(new lt(`sources.${c}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new r.a(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let n=this.map.painter.context;this.texture?!c&&!this._playing||this.texture instanceof r.ar||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new r.T(n,this.canvas,n.gl.RGBA,{premultiply:!0}),this._prepareData(n)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let c of[this.canvas.width,this.canvas.height])if(isNaN(c)||c<=0)return!0;return!1}},custom:class extends r.E{constructor(c,n,a,d){super(),this.id=c,this.type="custom",this._dataType="raster",this._dispatcher=a,this._implementation=n,this.setEventedParent(d),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new r.a(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new r.a(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Ke(this._implementation.bounds,this.minzoom,this.maxzoom)),n.update=this._update.bind(this),n.clearTiles=this._clearTiles.bind(this),n.coveringTiles=this._coveringTiles.bind(this),r.e(this,r.ac(n,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return r.ac(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new r.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.b("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(c){this._map=c,this._loaded=!1,this.fire(new r.b("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(c),this.load()}onRemove(c){this._implementation.onRemove&&this._implementation.onRemove(c)}hasTile(c){if(this._implementation.hasTile){let{x:n,y:a,z:d}=c.canonical;return this._implementation.hasTile({x:n,y:a,z:d})}return!this.tileBounds||this.tileBounds.contains(c.canonical)}loadTile(c,n){let{x:a,y:d,z:p}=c.tileID.canonical,g=new AbortController;c.request=Promise.resolve(this._implementation.loadTile({x:a,y:d,z:p},{signal:g.signal})).then((function(v){return delete c.request,c.aborted?(c.state="unloaded",n(null)):v===void 0?(c.state="errored",n(null)):v===null?(this.loadTileData(c,{width:this.tileSize,height:this.tileSize,data:null}),c.state="loaded",n(null)):function(k){return k instanceof ImageData||k instanceof HTMLCanvasElement||k instanceof ImageBitmap||k instanceof HTMLImageElement}(v)?(this.loadTileData(c,v),c.state="loaded",void n(null)):(c.state="errored",n(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(v=>{v.code!==20&&(c.state="errored",n(v))}),c.request.cancel=()=>g.abort()}loadTileData(c,n){c.setTexture(n,this._map.painter)}unloadTile(c,n){if(c.texture&&c.texture instanceof r.T?(c.destroy(!0),c.texture&&c.texture instanceof r.T&&this._map.painter.saveTileTexture(c.texture)):c.destroy(),this._implementation.unloadTile){let{x:a,y:d,z:p}=c.tileID.canonical;this._implementation.unloadTile({x:a,y:d,z:p})}n()}abortTile(c,n){c.request&&c.request.cancel&&(c.request.cancel(),delete c.request),n()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(c=>({x:c.canonical.x,y:c.canonical.y,z:c.canonical.z}))}_clearTiles(){let c=r.ag(this.id,this.scope);this._map.style.clearSource(c)}_update(){this.fire(new r.b("data",{dataType:"source",sourceDataType:"content"}))}}},er=function(c,n,a,d){let p=new Ma[n.type](c,n,a,d);if(p.id!==c)throw new Error(`Expected Source id to be ${c} instead of ${p.id}`);return r.aY(["load","abort","unload","serialize","prepare"],p),p};function mu(c,n){let a=r.a6.identity([]);return r.a6.scale(a,a,[.5*c.width,.5*-c.height,1]),r.a6.translate(a,a,[1,-1,0]),r.a6.multiply(a,a,c.calculateProjMatrix(n.toUnwrapped())),Float32Array.from(a)}function pu(c,n,a,d,p,g,v,k=!1){let S=c.tilesIn(d,v,k);S.sort(Tl);let E=[];for(let P of S)E.push({wrappedTileID:P.tile.tileID.wrapped().key,queryResults:P.tile.queryRenderedFeatures(n,a,c._state,P,p,g,mu(c.transform,P.tile.tileID),k)});let A=function(P){let z={},O={};for(let U of P){let V=U.queryResults,G=U.wrappedTileID,N=O[G]=O[G]||{};for(let H in V){let Q=V[H],W=N[H]=N[H]||{},J=z[H]=z[H]||[];for(let $ of Q)W[$.featureIndex]||(W[$.featureIndex]=!0,J.push($))}}return z}(E);for(let P in A)A[P].forEach(z=>{let O=z.feature,U=O.layer;U&&U.type!=="background"&&U.type!=="sky"&&U.type!=="slot"&&(O.source=U.source,U["source-layer"]&&(O.sourceLayer=U["source-layer"]),O.state=O.id!==void 0?c.getFeatureState(U["source-layer"],O.id):{})});return A}function Ea(c,n){let a=c.getRenderableIds().map(g=>c.getTileByID(g)),d=[],p={};for(let g=0;g<a.length;g++){let v=a[g],k=v.tileID.canonical.key;p[k]||(p[k]=!0,v.querySourceFeatures(d,n))}return d}function Tl(c,n){let a=c.tileID,d=n.tileID;return a.overscaledZ-d.overscaledZ||a.canonical.y-d.canonical.y||a.wrap-d.wrap||a.canonical.x-d.canonical.x}class Vs extends es{constructor(n,a,d,p,g){super(n,a,d,p,g),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(n,a){let d=a.context,p=d.gl;this.texture=this.texture||a.getTileTexture(n.width),this.texture&&this.texture instanceof r.T?this.texture.update(n,{useMipmap:!1,premultiply:!1}):this.texture=new r.T(d,n,p.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(n=16384,a){let d=this._mrt=new r.aZ(30),p=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(n-1)}});return this.entireBuffer=null,this.request=r.a_(p,(g,v,k,S)=>{if(g)a(g);else try{let E=d.getHeaderLength(v);if(E>n)return void(this.request=this.fetchHeader(E,a));d.parseHeader(v),this._isHeaderLoaded=!0;let A=0;for(let P of Object.values(d.layers))A=Math.max(A,P.dataIndex[P.dataIndex.length-1].last_byte);v.byteLength>=A&&(this.entireBuffer=v),a(null,this.entireBuffer||v,k,S)}catch(E){a(E)}}),this.request}fetchBand(n,a,d){let p=this._mrt;if(!this._isHeaderLoaded||!p)return void d(new Error("Tile header is not ready"));let g=this.actor;if(!g)return void d(new Error("Can't fetch tile band without an actor"));let v,k=(P,z)=>{v.complete(P,z),P?d(P):(this.updateTextureDescriptor(n,a),d(null,this.textureDescriptor&&this.textureDescriptor.img))},S=(P,z)=>{if(P)return d(P);let O=g.send("decodeRasterArray",{buffer:z,task:v},k,void 0,!0);this._workQueue.push(()=>{O&&O.cancel(),v.cancel()})},E=p.getLayer(n);if(!E)return void d(new Error(`Unknown sourceLayer "${n}"`));if(E.hasDataForBand(a))return this.updateTextureDescriptor(n,a),void d(null,this.textureDescriptor?this.textureDescriptor.img:null);let A=E.getDataRange([a]);if(v=p.createDecodingTask(A),!v||v.tasks.length)if(this.flushQueues(),this.entireBuffer)S(null,this.entireBuffer.slice(A.firstByte,A.lastByte+1));else{let P=Object.assign({},this.requestParams,{headers:{Range:`bytes=${A.firstByte}-${A.lastByte}`}}),z=r.a_(P,S);this._fetchQueue.push(()=>{z.cancel(),v.cancel()})}else d(null)}updateNeeded(n,a){return(!this.textureDescriptor||this.textureDescriptor.band!==a||this.textureDescriptor.layer!==n)&&this.state!=="errored"}updateTextureDescriptor(n,a){if(!this._mrt)return;let d=this._mrt.getLayer(n);if(!d||!d.hasBand(a)||!d.hasDataForBand(a))return;let{bytes:p,tileSize:g,buffer:v,offset:k,scale:S}=d.getBandView(a),E=g+2*v,A={data:p,width:E,height:E},P=this.texture;P&&P instanceof r.T&&P.update(A,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:n,band:a,img:A,buffer:v,offset:k,tileSize:g,format:d.pixelFormat,mix:[S,256*S,65536*S,16777216*S]}}}class kl{constructor(n,a){this.max=n,this.onRemove=a,this.reset()}reset(){for(let n in this.data)for(let a of this.data[n])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(n,a,d){let p=n.wrapped().key;this.data[p]===void 0&&(this.data[p]=[]);let g={value:a,timeout:void 0};if(d!==void 0&&(g.timeout=setTimeout(()=>{this.remove(n,g)},d)),this.data[p].push(g),this.order.push(p),this.order.length>this.max){let v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){let a=this.data[n].shift();return a.timeout&&clearTimeout(a.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),a.value}getByKey(n){let a=this.data[n];return a?a[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,a){if(!this.has(n))return this;let d=n.wrapped().key,p=a===void 0?0:this.data[d].indexOf(a),g=this.data[d][p];return this.data[d].splice(p,1),g.timeout&&clearTimeout(g.timeout),this.data[d].length===0&&delete this.data[d],this.onRemove(g.value),this.order.splice(this.order.indexOf(d),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){let a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(n){let a=[];for(let d in this.data)for(let p of this.data[d])n(p.value)||a.push(p);for(let d of a)this.remove(d.value.tileID,d)}}class Xo extends r.E{constructor(n,a,d){super(),this.id=n,this._onlySymbols=d,a.on("data",p=>{p.dataType==="source"&&p.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&p.dataType==="source"&&p.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),a.on("error",()=>{this._sourceErrored=!0}),this._source=a,this._tiles={},this._cache=new kl(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=a.minTileCacheSize,this._maxTileCacheSize=a.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new vi,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(n){this.map=n,this._minTileCacheSize=this._minTileCacheSize===void 0&&n?n._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&n?n._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(let n in this._tiles){let a=this._tiles[n];if(a.state!=="errored"&&(a.state!=="loaded"||!a.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let n=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,n&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(n,a){return n.isSymbolTile=this._onlySymbols,n.isExtraShadowCaster=this._shadowCasterTiles[n.tileID.key],this._source.loadTile(n,a)}_unloadTile(n){if(this._source.unloadTile)return this._source.unloadTile(n,()=>{})}_abortTile(n){if(this._source.abortTile)return this._source.abortTile(n,()=>{})}serialize(){return this._source.serialize()}prepare(n){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let a in this._tiles){let d=this._tiles[a];d.upload(n),d.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return r.a$(this._tiles).map(n=>n.tileID).sort(Pd).map(n=>n.key)}getRenderableIds(n,a){let d=[];for(let p in this._tiles)this._isIdRenderable(+p,n,a)&&d.push(this._tiles[p]);return n?d.sort((p,g)=>{let v=p.tileID,k=g.tileID,S=new r.P(v.canonical.x,v.canonical.y)._rotate(this.transform.angle),E=new r.P(k.canonical.x,k.canonical.y)._rotate(this.transform.angle);return v.overscaledZ-k.overscaledZ||E.y-S.y||E.x-S.x}).map(p=>p.tileID.key):d.map(p=>p.tileID).sort(Pd).map(p=>p.key)}hasRenderableParent(n){let a=this.findLoadedParent(n,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(n,a,d){return this._tiles[n]&&this._tiles[n].hasData()&&!this._coveredTiles[n]&&(a||!this._tiles[n].holdingForFade())&&(d||!this._shadowCasterTiles[n])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let n in this._tiles)this._tiles[n].state!=="errored"&&this._reloadTile(+n,"reloading")}}_reloadTile(n,a){let d=this._tiles[n];d&&(d.state!=="loading"&&(d.state=a),this._loadTile(d,this._tileLoaded.bind(this,d,n,a)))}_tileLoaded(n,a,d,p){if(p)if(n.state="errored",p.status!==404)this._source.fire(new r.a(p,{tile:n}));else{if(!(n.tileID.key in this._loadedParentTiles))return void this._source.fire(new r.b("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){let g=this.map.painter.terrain;this.update(this.transform,g.getScaledDemTileSize(),!0),g.resetTileLookupCache(this.id)}else this.update(this.transform)}else n.timeAdded=r.f.now(),d==="expired"&&(n.refreshedUponExpiration=!0),this._setTileReloadTimer(a,n),this._source.type==="raster-dem"&&n.dem&&this._backfillDEM(n),this._state.initializeTileState(n,this.map?this.map.painter:null),this._source.fire(new r.b("data",{dataType:"source",tile:n,coord:n.tileID,sourceCacheId:this.id}))}_backfillDEM(n){let a=this.getRenderableIds();for(let p=0;p<a.length;p++){let g=a[p];if(n.neighboringTiles&&n.neighboringTiles[g]){let v=this.getTileByID(g);d(n,v),d(v,n)}}function d(p,g){if(!p.dem||p.dem.borderReady)return;p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0;let v=g.tileID.canonical.x-p.tileID.canonical.x,k=g.tileID.canonical.y-p.tileID.canonical.y,S=Math.pow(2,p.tileID.canonical.z),E=g.tileID.key;v===0&&k===0||Math.abs(k)>1||(Math.abs(v)>1&&(Math.abs(v+S)===1?v+=S:Math.abs(v-S)===1&&(v-=S)),g.dem&&p.dem&&(p.dem.backfillBorder(g.dem,v,k),p.neighboringTiles&&p.neighboringTiles[E]&&(p.neighboringTiles[E].backfilled=!0)))}}getTile(n){return this.getTileByID(n.key)}getTileByID(n){return this._tiles[n]}_retainLoadedChildren(n,a,d,p){for(let g in this._tiles){let v=this._tiles[g];if(p[g]||!v.hasData()||v.tileID.overscaledZ<=a||v.tileID.overscaledZ>d)continue;let k=v.tileID;for(;v&&v.tileID.overscaledZ>a+1;){let E=v.tileID.scaledTo(v.tileID.overscaledZ-1);v=this._tiles[E.key],v&&v.hasData()&&(k=E)}let S=k;for(;S.overscaledZ>a;)if(S=S.scaledTo(S.overscaledZ-1),n[S.key]){p[k.key]=k;break}}}findLoadedParent(n,a){if(n.key in this._loadedParentTiles){let d=this._loadedParentTiles[n.key];return d&&d.tileID.overscaledZ>=a?d:null}for(let d=n.overscaledZ-1;d>=a;d--){let p=n.scaledTo(d),g=this._getLoadedTile(p);if(g)return g}}_getLoadedTile(n){let a=this._tiles[n.key];return a&&a.hasData()?a:this._cache.getByKey(this._source.reparseOverscaled?n.wrapped().key:n.canonical.key)}updateCacheSize(n,a){a=a||this._source.tileSize;let d=Math.ceil(n.width/a)+1,p=Math.ceil(n.height/a)+1,g=Math.floor(d*p*5),v=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,g):g,k=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,v):v;this._cache.setMaxSize(k)}handleWrapJump(n){let a=Math.round((n-(this._prevLng===void 0?n:this._prevLng))/360);if(this._prevLng=n,a){let d={};for(let p in this._tiles){let g=this._tiles[p];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+a),d[g.tileID.key]=g}this._tiles=d;for(let p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(let p in this._tiles)this._setTileReloadTimer(+p,this._tiles[p])}}update(n,a,d,p){if(this.transform=n,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!d)return;let g;if(this.updateCacheSize(n,a),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain)if(this._source.tileID)g=n.getVisibleUnwrappedCoordinates(this._source.tileID).map(S=>new r.am(S.canonical.z,S.wrap,S.canonical.z,S.canonical.x,S.canonical.y));else if(this.tileCoverLift!==0){let S=n.clone();S.tileCoverLift=this.tileCoverLift,g=S.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.minzoom<=1&&n.projection.name==="globe"&&(g.push(new r.am(1,0,1,0,0)),g.push(new r.am(1,0,1,1,0)),g.push(new r.am(1,0,1,0,1)),g.push(new r.am(1,0,1,1,1)))}else g=n.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(g=g.filter(S=>this._source.hasTile(S)));else g=[];if(g.length>0&&this.castsShadows&&p&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Aa(this._source.type)){let S=n.coveringZoomLevel({tileSize:a||this._source.tileSize,roundZoom:this._source.roundZoom&&!d}),E=Math.min(S,this._source.maxzoom),A=n.extendTileCoverForShadows(g,p,E);for(let P of A)this._shadowCasterTiles[P.key]=!0,g.push(P)}let v=this._updateRetainedTiles(g);if(Aa(this._source.type)&&g.length!==0){let S={},E={},A=Object.keys(v);for(let z of A){let O=v[z],U=this._tiles[z];if(!U||U.fadeEndTime&&U.fadeEndTime<=r.f.now())continue;let V=this.findLoadedParent(O,Math.max(O.overscaledZ-Xo.maxOverzooming,this._source.minzoom));V&&(this._addTile(V.tileID),S[V.tileID.key]=V.tileID),E[z]=O}let P=g[g.length-1].overscaledZ;for(let z in this._tiles){let O=this._tiles[z];if(v[z]||!O.hasData())continue;let U=O.tileID;for(;U.overscaledZ>P;){U=U.scaledTo(U.overscaledZ-1);let V=this._tiles[U.key];if(V&&V.hasData()&&E[U.key]){v[z]=O.tileID;break}}}for(let z in S)v[z]||(this._coveredTiles[z]=!0,v[z]=S[z])}for(let S in v)this._tiles[S].clearFadeHold();let k=r.b0(this._tiles,v);for(let S of k){let E=this._tiles[S];E.hasSymbolBuckets&&!E.holdingForFade()?E.setHoldDuration(this.map._fadeDuration):E.hasSymbolBuckets&&!E.symbolFadeFinished()||this._removeTile(+S)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(let n in this._tiles)this._tiles[n].holdingForFade()&&this._removeTile(+n)}_updateRetainedTiles(n){let a={};if(n.length===0)return a;let d={},p=n.reduce((E,A)=>Math.min(E,A.overscaledZ),1/0),g=n[0].overscaledZ,v=Math.max(g-Xo.maxOverzooming,this._source.minzoom),k=Math.max(g+Xo.maxUnderzooming,this._source.minzoom),S={};for(let E of n){let A=this._addTile(E);a[E.key]=E,A.hasData()||p<this._source.maxzoom&&(S[E.key]=E)}this._retainLoadedChildren(S,p,k,a);for(let E of n){let A=this._tiles[E.key];if(A.hasData())continue;if(E.canonical.z>=this._source.maxzoom){let z=E.children(this._source.maxzoom)[0],O=this.getTile(z);if(O&&O.hasData()){a[z.key]=z;continue}}else{let z=E.children(this._source.maxzoom);if(a[z[0].key]&&a[z[1].key]&&a[z[2].key]&&a[z[3].key])continue}let P=A.wasRequested();for(let z=E.overscaledZ-1;z>=v;--z){let O=E.scaledTo(z);if(d[O.key]||(d[O.key]=!0,A=this.getTile(O),!A&&P&&(A=this._addTile(O)),A&&(a[O.key]=O,P=A.wasRequested(),A.hasData())))break}}return a}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let n in this._tiles){let a=[],d,p=this._tiles[n].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){d=this._loadedParentTiles[p.key];break}a.push(p.key);let g=p.scaledTo(p.overscaledZ-1);if(d=this._getLoadedTile(g),d)break;p=g}for(let g of a)this._loadedParentTiles[g]=d}}_addTile(n){let a=this._tiles[n.key];if(a)return a.isExtraShadowCaster!==!0||this._shadowCasterTiles[n.key]||this._reloadTile(n.key,"reloading"),a;a=this._cache.getAndRemove(n),a&&(this._setTileReloadTimer(n.key,a),a.tileID=n,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[n.key]&&(clearTimeout(this._cacheTimers[n.key]),delete this._cacheTimers[n.key],this._setTileReloadTimer(n.key,a)));let d=!!a;if(!d){let p=this.map?this.map.painter:null,g=this._source.tileSize*n.overscaleFactor();a=this._source.type==="raster-array"?new Vs(n,g,this.transform.tileZoom,p,this._isRaster):new es(n,g,this.transform.tileZoom,p,this._isRaster),this._loadTile(a,this._tileLoaded.bind(this,a,n.key,a.state))}return a?(a.uses++,this._tiles[n.key]=a,d||this._source.fire(new r.b("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a):null}_setTileReloadTimer(n,a){n in this._timers&&(clearTimeout(this._timers[n]),delete this._timers[n]);let d=a.getExpiryTimeout();d&&(this._timers[n]=setTimeout(()=>{this._reloadTile(n,"expired"),delete this._timers[n]},d))}_removeTile(n){let a=this._tiles[n];a&&(a.uses--,delete this._tiles[n],this._timers[n]&&(clearTimeout(this._timers[n]),delete this._timers[n]),a.uses>0||(a.hasData()&&a.state!=="reloading"||a.state==="empty"?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let n in this._tiles)this._removeTile(+n);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(n,a,d){let p=[],g=this.transform;if(!g)return p;let v=g.projection.name==="globe",k=r.a5(g.center.lng);for(let S in this._tiles){let E=this._tiles[S];if(d&&E.clearQueryDebugViz(),E.holdingForFade())continue;let A;if(v){let P=E.tileID.canonical;if(P.z===0){let z=[Math.abs(r.aa(k,...wc(P,-1))-k),Math.abs(r.aa(k,...wc(P,1))-k)];A=[0,2*z.indexOf(Math.min(...z))-1]}else{let z=[Math.abs(r.aa(k,...wc(P,-1))-k),Math.abs(r.aa(k,...wc(P,0))-k),Math.abs(r.aa(k,...wc(P,1))-k)];A=[z.indexOf(Math.min(...z))-1]}}else A=[0];for(let P of A){let z=n.containsTile(E,g,a,P);z&&p.push(z)}}return p}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(n){return this._getRenderableCoordinates(n)}_getRenderableCoordinates(n,a){let d=this.getRenderableIds(n,a).map(g=>this._tiles[g].tileID),p=this.transform.projection.name==="globe";for(let g of d)g.projMatrix=this.transform.calculateProjMatrix(g.toUnwrapped()),g.expandedProjMatrix=p?this.transform.calculateProjMatrix(g.toUnwrapped(),!1,!0):g.projMatrix;return d}sortCoordinatesByDistance(n){let a=n.slice(),d=this.transform._camera.position,p=this.transform._camera.forward(),g={};for(let v of a){let k=1/(1<<v.canonical.z);g[v.key]=((v.canonical.x+.5)*k+v.wrap-d[0])*p[0]+((v.canonical.y+.5)*k-d[1])*p[1]-d[2]*p[2]}return a.sort((v,k)=>g[v.key]-g[k.key]),a}hasTransition(){if(this._source.hasTransition())return!0;if(Aa(this._source.type))for(let n in this._tiles){let a=this._tiles[n];if(a.fadeEndTime!==void 0&&a.fadeEndTime>=r.f.now())return!0}return!1}setFeatureState(n,a,d){this._state.updateState(n=n||"_geojsonTileLayer",a,d)}removeFeatureState(n,a,d){this._state.removeFeatureState(n=n||"_geojsonTileLayer",a,d)}getFeatureState(n,a){return this._state.getState(n=n||"_geojsonTileLayer",a)}setDependencies(n,a,d){let p=this._tiles[n];p&&p.setDependencies(a,d)}reloadTilesForDependencies(n,a){for(let d in this._tiles)this._tiles[d].hasDependency(n,a)&&this._reloadTile(+d,"reloading");this._cache.filter(d=>!d.hasDependency(n,a))}_preloadTiles(n,a){if(!this._sourceLoaded){let S=()=>{this._sourceLoaded&&(this._source.off("data",S),this._preloadTiles(n,a))};return void this._source.on("data",S)}let d=new Map,p=Array.isArray(n)?n:[n],g=this.map.painter.terrain,v=this.usedForTerrain&&g?g.getScaledDemTileSize():this._source.tileSize;for(let S of p){let E=S.coveringTiles({tileSize:v,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(let A of E)d.set(A.key,A);this.usedForTerrain&&S.updateElevation(!1)}let k=Array.from(d.values());r.b1(k,(S,E)=>{let A=new es(S,this._source.tileSize*S.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(A,P=>{this._source.type==="raster-dem"&&A.dem&&this._backfillDEM(A),E(P,A)})},a)}}function Pd(c,n){let a=Math.abs(2*c.wrap)-+(c.wrap<0),d=Math.abs(2*n.wrap)-+(n.wrap<0);return c.overscaledZ-n.overscaledZ||d-a||n.canonical.y-c.canonical.y||n.canonical.x-c.canonical.x}function Aa(c){return c==="raster"||c==="image"||c==="video"||c==="custom"}function wc(c,n){let a=1<<c.z;return[c.x/a+n,(c.x+1)/a+n]}Xo.maxOverzooming=10,Xo.maxUnderzooming=3;class hf{constructor(n){this.style=n,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];let n=!1,a=!1;for(let d in this.style._mergedLayers){let p=this.style._mergedLayers[d];if(p.type==="fill-extrusion")this.layers.push({layer:p,visible:n,visibilityChanged:a});else if(p.type==="model"){let g=this.style.getLayerSource(p);g&&g.type==="batched-model"&&this.layers.push({layer:p,visible:n,visibilityChanged:a})}}}onNewFrame(n){this.layersGotHidden=!1;for(let a of this.layers){let d=a.layer,p=!1;d.type==="fill-extrusion"?p=!d.isHidden(n)&&d.paint.get("fill-extrusion-opacity")>0:d.type==="model"&&(p=!d.isHidden(n)&&d.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!p&&a.visible,a.visible=p}}updateZOffset(n,a){this.currentBuildingBuckets=[];for(let p of this.layers){let g=p.layer,v=this.style.getLayerSourceCache(g),k=1;g.type==="fill-extrusion"&&(k=p.visible?g.paint.get("fill-extrusion-vertical-scale"):0);let S=v?v.getTile(a):null;if(!S&&v&&a.canonical.z>v.getSource().minzoom){let E=a.scaledTo(Math.min(v.getSource().maxzoom,a.overscaledZ-1));for(;E.overscaledZ>=v.getSource().minzoom&&(S=v.getTile(E),!S&&E.overscaledZ!==0);)E=E.scaledTo(E.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:S?S.getBucket(g):null,tileID:S?S.tileID:a,verticalScale:k})}n.hasAnyZOffset=!1;let d=!1;for(let p=0;p<n.symbolInstances.length;p++){let g=n.symbolInstances.get(p),v=g.zOffset,k=this._getHeightAtTileOffset(a,g.tileAnchorX,g.tileAnchorY);g.zOffset=k!==Number.NEGATIVE_INFINITY?k:v,d||v===g.zOffset||(d=!0),n.hasAnyZOffset||g.zOffset===0||(n.hasAnyZOffset=!0)}d&&(n.zOffsetBuffersNeedUpload=!0,n.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(n,a,d,p){let g=a,v=d;if(n.canonical.z!==p.canonical.z){let k=p.canonical,S=1/(1<<n.canonical.z-k.z);g=(a+n.canonical.x*r.V)*S-k.x*r.V|0,v=(d+n.canonical.y*r.V)*S-k.y*r.V|0}return{tileX:g,tileY:v}}_getHeightAtTileOffset(n,a,d){let p,g;for(let v=0;v<this.layers.length;++v){if(this.layers[v].layer.type!=="fill-extrusion")continue;let{bucket:k,tileID:S,verticalScale:E}=this.currentBuildingBuckets[v];if(!k)continue;let{tileX:A,tileY:P}=this._mapCoordToOverlappingTile(n,a,d,S),z=k.getHeightAtTileCoord(A,P);z&&z.height!==void 0&&(z.hidden?p=z.height:g=Math.max(z.height*E,g||0))}if(g!==void 0)return g;for(let v=0;v<this.layers.length;++v){let k=this.layers[v];if(k.layer.type!=="model"||!k.visible)continue;let{bucket:S,tileID:E}=this.currentBuildingBuckets[v];if(!S)continue;let{tileX:A,tileY:P}=this._mapCoordToOverlappingTile(n,a,d,E),z=S.getHeightAtTileCoord(A,P);if(z&&!z.hidden)return z.height===void 0&&p!==void 0?Math.min(z.maxHeight,p)*z.verticalScale:(z.height||0)*z.verticalScale}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Us(c,n){let a={};for(let d in c)d!=="ref"&&(a[d]=c[d]);return r.b2.forEach(d=>{d in n&&(a[d]=n[d])}),a}function uf(c){c=c.slice();let n=Object.create(null);for(let a=0;a<c.length;a++)n[c[a].id]=c[a];for(let a=0;a<c.length;a++)"ref"in c[a]&&(c[a]=Us(c[a],n[c[a].ref]));return c}let gi={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function Tc(c,n,a){a.push({command:gi.addSource,args:[c,n[c]]})}function fu(c,n,a){n.push({command:gi.removeSource,args:[c]}),a[c]=!0}function f0(c,n,a,d){fu(c,a,d),Tc(c,n,a)}function _0(c,n,a){let d;for(d in c[a])if(c[a].hasOwnProperty(d)&&d!=="data"&&!M(c[a][d],n[a][d]))return!1;for(d in n[a])if(n[a].hasOwnProperty(d)&&d!=="data"&&!M(c[a][d],n[a][d]))return!1;return!0}function ts(c,n,a,d,p,g){let v;for(v in n=n||{},c=c||{})c.hasOwnProperty(v)&&(M(c[v],n[v])||a.push({command:g,args:[d,v,n[v],p]}));for(v in n)n.hasOwnProperty(v)&&!c.hasOwnProperty(v)&&(M(c[v],n[v])||a.push({command:g,args:[d,v,n[v],p]}))}function is(c){return c.id}function Rd(c,n){return c[n.id]=n,c}class Il{constructor(n,a){this.reset(n,a)}reset(n,a){this.points=n||[],this._distances=[0];for(let d=1;d<this.points.length;d++)this._distances[d]=this._distances[d-1]+this.points[d].dist(this.points[d-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(this.points.length===1)return this.points[0];n=r.aa(n,0,1);let a=1,d=this._distances[a],p=n*this.paddedLength+this.padding;for(;d<p&&a<this._distances.length;)d=this._distances[++a];let g=a-1,v=this._distances[g],k=d-v,S=k>0?(p-v)/k:0;return this.points[g].mult(1-S).add(this.points[a].mult(S))}}class _u{constructor(n,a,d){let p=this.boxCells=[],g=this.circleCells=[];this.xCellCount=Math.ceil(n/d),this.yCellCount=Math.ceil(a/d);for(let v=0;v<this.xCellCount*this.yCellCount;v++)p.push([]),g.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=a,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,a,d,p,g){this._forEachCell(a,d,p,g,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(a),this.bboxes.push(d),this.bboxes.push(p),this.bboxes.push(g)}insertCircle(n,a,d,p){this._forEachCell(a-p,d-p,a+p,d+p,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(a),this.circles.push(d),this.circles.push(p)}_insertBoxCell(n,a,d,p,g,v){this.boxCells[g].push(v)}_insertCircleCell(n,a,d,p,g,v){this.circleCells[g].push(v)}_query(n,a,d,p,g,v){if(d<0||n>this.width||p<0||a>this.height)return!g&&[];let k=[];if(n<=0&&a<=0&&this.width<=d&&this.height<=p){if(g)return!0;for(let S=0;S<this.boxKeys.length;S++)k.push({key:this.boxKeys[S],x1:this.bboxes[4*S],y1:this.bboxes[4*S+1],x2:this.bboxes[4*S+2],y2:this.bboxes[4*S+3]});for(let S=0;S<this.circleKeys.length;S++){let E=this.circles[3*S],A=this.circles[3*S+1],P=this.circles[3*S+2];k.push({key:this.circleKeys[S],x1:E-P,y1:A-P,x2:E+P,y2:A+P})}return v?k.filter(v):k}return this._forEachCell(n,a,d,p,this._queryCell,k,{hitTest:g,seenUids:{box:{},circle:{}}},v),g?k.length>0:k}_queryCircle(n,a,d,p,g){let v=n-d,k=n+d,S=a-d,E=a+d;if(k<0||v>this.width||E<0||S>this.height)return!p&&[];let A=[];return this._forEachCell(v,S,k,E,this._queryCellCircle,A,{hitTest:p,circle:{x:n,y:a,radius:d},seenUids:{box:{},circle:{}}},g),p?A.length>0:A}query(n,a,d,p,g){return this._query(n,a,d,p,!1,g)}hitTest(n,a,d,p,g){return this._query(n,a,d,p,!0,g)}hitTestCircle(n,a,d,p){return this._queryCircle(n,a,d,!0,p)}_queryCell(n,a,d,p,g,v,k,S){let E=k.seenUids,A=this.boxCells[g];if(A!==null){let z=this.bboxes;for(let O of A)if(!E.box[O]){E.box[O]=!0;let U=4*O;if(n<=z[U+2]&&a<=z[U+3]&&d>=z[U+0]&&p>=z[U+1]&&(!S||S(this.boxKeys[O]))){if(k.hitTest)return v.push(!0),!0;v.push({key:this.boxKeys[O],x1:z[U],y1:z[U+1],x2:z[U+2],y2:z[U+3]})}}}let P=this.circleCells[g];if(P!==null){let z=this.circles;for(let O of P)if(!E.circle[O]){E.circle[O]=!0;let U=3*O;if(this._circleAndRectCollide(z[U],z[U+1],z[U+2],n,a,d,p)&&(!S||S(this.circleKeys[O]))){if(k.hitTest)return v.push(!0),!0;{let V=z[U],G=z[U+1],N=z[U+2];v.push({key:this.circleKeys[O],x1:V-N,y1:G-N,x2:V+N,y2:G+N})}}}}}_queryCellCircle(n,a,d,p,g,v,k,S){let E=k.circle,A=k.seenUids,P=this.boxCells[g];if(P!==null){let O=this.bboxes;for(let U of P)if(!A.box[U]){A.box[U]=!0;let V=4*U;if(this._circleAndRectCollide(E.x,E.y,E.radius,O[V+0],O[V+1],O[V+2],O[V+3])&&(!S||S(this.boxKeys[U])))return v.push(!0),!0}}let z=this.circleCells[g];if(z!==null){let O=this.circles;for(let U of z)if(!A.circle[U]){A.circle[U]=!0;let V=3*U;if(this._circlesCollide(O[V],O[V+1],O[V+2],E.x,E.y,E.radius)&&(!S||S(this.circleKeys[U])))return v.push(!0),!0}}}_forEachCell(n,a,d,p,g,v,k,S){let E=this._convertToXCellCoord(n),A=this._convertToYCellCoord(a),P=this._convertToXCellCoord(d),z=this._convertToYCellCoord(p);for(let O=E;O<=P;O++)for(let U=A;U<=z;U++)if(g.call(this,n,a,d,p,this.xCellCount*U+O,v,k,S))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,a,d,p,g,v){let k=p-n,S=g-a,E=d+v;return E*E>k*k+S*S}_circleAndRectCollide(n,a,d,p,g,v,k){let S=(v-p)/2,E=Math.abs(n-(p+S));if(E>S+d)return!1;let A=(k-g)/2,P=Math.abs(a-(g+A));if(P>A+d)return!1;if(E<=S||P<=A)return!0;let z=E-S,O=P-A;return z*z+O*O<=d*d}}let Da={unknown:0,flipRequired:1,flipNotRequired:2},ns=Math.tan(85*Math.PI/180);function kc(c,n,a,d,p,g,v){let k=r.a6.create();if(a)if(g.name==="globe"){let S=r.b3(p,n);r.a6.multiply(k,k,S)}else{let S=r.b4.invert([],v);k[0]=S[0],k[1]=S[1],k[4]=S[2],k[5]=S[3],d||r.a6.rotateZ(k,k,p.angle)}else r.a6.multiply(k,p.labelPlaneMatrix,c);return k}function gu(c,n,a,d,p,g,v){let k=kc(c,n,a,d,p,g,v);return g.name==="globe"&&a||(k[2]=k[6]=k[10]=k[14]=0),k}function yu(c,n,a,d,p,g,v){if(a){if(g.name==="globe"){let k=kc(c,n,a,d,p,g,v);return r.a6.invert(k,k),r.a6.multiply(k,c,k),k}{let k=r.a6.clone(c),S=r.a6.identity([]);return S[0]=v[0],S[1]=v[1],S[4]=v[2],S[5]=v[3],r.a6.multiply(k,k,S),d||r.a6.rotateZ(k,k,-p.angle),k}}return p.glCoordMatrix}function Do(c,n,a,d){let p=[c,n,a,1];a?r.a7.transformMat4(p,p,d):ku(p,p,d);let g=p[3];return p[0]/=g,p[1]/=g,p[2]/=g,p}function mf(c,n){return Math.min(.5+c/n*.5,1.5)}function bu(c,n){let a=c[0]/c[3],d=c[1]/c[3];return a>=-n[0]&&a<=n[0]&&d>=-n[1]&&d<=n[1]}function vu(c,n,a,d,p,g,v,k,S,E){let A=a.transform,P=d?c.textSizeData:c.iconSizeData,z=r.b5(P,a.transform.zoom),O=A.projection.name==="globe",U=[256/a.width*2+1,256/a.height*2+1],V=d?c.text.dynamicLayoutVertexArray:c.icon.dynamicLayoutVertexArray;V.clear();let G=null;O&&(G=d?c.text.globeExtVertexArray:c.icon.globeExtVertexArray);let N=c.lineVertexArray,H=d?c.text.placedSymbolArray:c.icon.placedSymbolArray,Q=a.transform.width/a.transform.height,W,J=!1;for(let $=0;$<H.length;$++){let ee=H.get($),{numGlyphs:oe,writingMode:ae}=ee;if(ae!==r.b6.vertical||J||W===r.b6.horizontal||(J=!0),W=ae,(ee.hidden||ae===r.b6.vertical)&&!J){rs(oe,V);continue}J=!1;let ce=new r.P(ee.tileAnchorX,ee.tileAnchorY),{x:be,y:ue,z:Ie}=A.projection.projectTilePoint(ce.x,ce.y,E.canonical);if(S){let[rt,_t,Et]=S(ce);be+=rt,ue+=_t,Ie+=Et}let Te=[be,ue,Ie,1];if(r.a7.transformMat4(Te,Te,n),!bu(Te,U)){rs(oe,V);continue}let Be=Te[3],pe=mf(a.transform.getCameraToCenterDistance(A.projection),Be),xe=r.b7(P,z,ee),le=v?xe/pe:xe*pe,ge=Do(be,ue,Ie,p);if(ge[3]<=0){rs(oe,V);continue}let Ne={},Ye=v?null:S,We=Tu(ee,le,!1,k,n,p,g,c.glyphOffsetArray,N,V,G,ge,ce,Ne,Q,Ye,A.projection,E,v);J=We.useVertical,Ye&&We.needsFlipping&&(Ne={}),(We.notEnoughRoom||J||We.needsFlipping&&Tu(ee,le,!0,k,n,p,g,c.glyphOffsetArray,N,V,G,ge,ce,Ne,Q,Ye,A.projection,E,v).notEnoughRoom)&&rs(oe,V)}d?(c.text.dynamicLayoutVertexBuffer.updateData(V),G&&c.text.globeExtVertexBuffer&&c.text.globeExtVertexBuffer.updateData(G)):(c.icon.dynamicLayoutVertexBuffer.updateData(V),G&&c.icon.globeExtVertexBuffer&&c.icon.globeExtVertexBuffer.updateData(G))}function xu(c,n,a,d,p,g,v,k,S,E,A,P,z,O,U,V){let{lineStartIndex:G,glyphStartIndex:N,segment:H}=k,Q=N+k.numGlyphs,W=G+k.lineLength,J=n.getoffsetX(N),$=n.getoffsetX(Q-1),ee=Ic(c*J,a,d,p,g,v,H,G,W,S,E,A,P,z,!0,O,U,V);if(!ee)return null;let oe=Ic(c*$,a,d,p,g,v,H,G,W,S,E,A,P,z,!0,O,U,V);return oe?{first:ee,last:oe}:null}function wu(c,n,a,d){return c===r.b6.horizontal&&Math.abs(d)>Math.abs(a)?{useVertical:!0}:c===r.b6.vertical?d>0?{needsFlipping:!0}:null:n!==Da.unknown&&function(p,g){return p===0||Math.abs(g/p)>ns}(a,d)?n===Da.flipRequired?{needsFlipping:!0}:null:a<0?{needsFlipping:!0}:null}function Tu(c,n,a,d,p,g,v,k,S,E,A,P,z,O,U,V,G,N,H){let Q=n/24,W=c.lineOffsetX*Q,J=c.lineOffsetY*Q,{lineStartIndex:$,glyphStartIndex:ee,numGlyphs:oe,segment:ae,writingMode:ce,flipState:be}=c,ue=$+c.lineLength,Ie=Te=>{if(A){let[le,ge,Ne]=Te.up,Ye=E.length;r.b8(A,Ye+0,le,ge,Ne),r.b8(A,Ye+1,le,ge,Ne),r.b8(A,Ye+2,le,ge,Ne),r.b8(A,Ye+3,le,ge,Ne)}let[Be,pe,xe]=Te.point;r.b9(E,Be,pe,xe,Te.angle)};if(oe>1){let Te=xu(Q,k,W,J,a,P,z,c,S,g,O,V,!1,G,N,H);if(!Te)return{notEnoughRoom:!0};if(d&&!a){let[Be,pe,xe]=Te.first.point,[le,ge,Ne]=Te.last.point;[Be,pe]=Do(Be,pe,xe,v),[le,ge]=Do(le,ge,Ne,v);let Ye=wu(ce,be,(le-Be)*U,ge-pe);if(c.flipState=Ye&&Ye.needsFlipping?Da.flipRequired:Da.flipNotRequired,Ye)return Ye}Ie(Te.first);for(let Be=ee+1;Be<ee+oe-1;Be++){let pe=Ic(Q*k.getoffsetX(Be),W,J,a,P,z,ae,$,ue,S,g,O,V,!1,!1,G,N,H);if(!pe)return E.length-=4*(Be-ee),{notEnoughRoom:!0};Ie(pe)}Ie(Te.last)}else{if(d&&!a){let Be=Do(z.x,z.y,0,p),pe=$+ae+1,xe=new r.P(S.getx(pe),S.gety(pe)),le=Do(xe.x,xe.y,0,p),ge=le[3]>0?le:Ld(z,xe,Be,1,p,void 0,G,N.canonical),Ne=wu(ce,be,(ge[0]-Be[0])*U,ge[1]-Be[1]);if(c.flipState=Ne&&Ne.needsFlipping?Da.flipRequired:Da.flipNotRequired,Ne)return Ne}let Te=Ic(Q*k.getoffsetX(ee),W,J,a,P,z,ae,$,ue,S,g,O,V,!1,!1,G,N,H);if(!Te)return{notEnoughRoom:!0};Ie(Te)}return{}}function Sl(c,n,a,d,p){let{x:g,y:v,z:k}=d.projectTilePoint(c.x,c.y,n);if(!p)return Do(g,v,k,a);let[S,E,A]=p(c);return Do(g+S,v+E,k+A,a)}function Ld(c,n,a,d,p,g,v,k){let S=Sl(c.sub(n)._unit()._add(c),k,p,v,g);return r.N.sub(S,a,S),r.N.normalize(S,S),r.N.scaleAndAdd(S,a,S,d)}function Ic(c,n,a,d,p,g,v,k,S,E,A,P,z,O,U,V,G,N){let H=d?c-n:c+n,Q=H>0?1:-1,W=0;d&&(Q*=-1,W=Math.PI),Q<0&&(W+=Math.PI);let J=k+v+(Q>0?0:1)|0,$=p,ee=p,oe=0,ae=0,ce=Math.abs(H),be=[],ue=[],Ie=g,Te=Ie,Be=()=>Ld(Te,Ie,ee,ce-oe+1,A,z,V,G.canonical);for(;oe+ae<=ce;){if(J+=Q,J<k||J>=S)return null;if(ee=$,Te=Ie,be.push(ee),O&&ue.push(Te),Ie=new r.P(E.getx(J),E.gety(J)),$=P[J],!$){let _t=Sl(Ie,G.canonical,A,V,z);$=_t[3]>0?P[J]=_t:Be()}oe+=ae,ae=r.N.distance(ee,$)}U&&z&&(P[J]&&($=Be(),ae=r.N.distance(ee,$)),P[J]=$);let pe=(ce-oe)/ae,xe=Ie.sub(Te)._mult(pe)._add(Te),le=r.N.sub([],$,ee),ge=r.N.scaleAndAdd([],ee,le,pe),Ne=[0,0,1],Ye=le[0],We=le[1];if(N&&(Ne=V.upVector(G.canonical,xe.x,xe.y),Ne[0]!==0||Ne[1]!==0||Ne[2]!==1)){let _t=[Ne[2],0,-Ne[0]],Et=r.N.cross([],Ne,_t);r.N.normalize(_t,_t),r.N.normalize(Et,Et),Ye=r.N.dot(le,_t),We=r.N.dot(le,Et)}if(a){let _t=r.N.cross([],Ne,le);r.N.normalize(_t,_t),r.N.scaleAndAdd(ge,ge,_t,a*Q)}let rt=W+Math.atan2(We,Ye);return be.push(ge),O&&ue.push(xe),{point:ge,angle:rt,path:be,tilePath:ue,up:Ne}}function rs(c,n){let a=n.length,d=a+4*c;n.resize(d),n.float32.fill(-1/0,4*a,4*d)}function ku(c,n,a){let d=n[0],p=n[1];return c[0]=a[0]*d+a[4]*p+a[12],c[1]=a[1]*d+a[5]*p+a[13],c[3]=a[3]*d+a[7]*p+a[15],c}let Po=100;class st{constructor(n,a,d=new _u(n.width+200,n.height+200,25),p=new _u(n.width+200,n.height+200,25)){this.transform=n,this.grid=d,this.ignoredGrid=p,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+Po,this.screenBottomBoundary=n.height+Po,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=a}placeCollisionBox(n,a,d,p,g,v,k,S){let E=d.projectedAnchorX,A=d.projectedAnchorY,P=d.projectedAnchorZ,z=d.elevation,O=d.tileID,U=n.getProjection();if(z&&O){let[$,ee,oe]=U.upVector(O.canonical,d.tileAnchorX,d.tileAnchorY),ae=U.upVectorScale(O.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;E+=$*z*ae,A+=ee*z*ae,P+=oe*z*ae}let V=this.projectAndGetPerspectiveRatio(k,E,A,P,d.tileID,U.name==="globe"||!!z||this.transform.pitch>0,U),G=v*V.perspectiveRatio,N=(d.x1*a+p.x-d.padding)*G+V.point.x,H=(d.y1*a+p.y-d.padding)*G+V.point.y,Q=(d.x2*a+p.x+d.padding)*G+V.point.x,W=(d.y2*a+p.y+d.padding)*G+V.point.y,J=V.perspectiveRatio<=.55||V.occluded;return!this.isInsideGrid(N,H,Q,W)||!g&&this.grid.hitTest(N,H,Q,W,S)||J?{box:[],offscreen:!1,occluded:V.occluded}:{box:[N,H,Q,W],offscreen:this.isOffscreen(N,H,Q,W),occluded:!1}}placeCollisionCircles(n,a,d,p,g,v,k,S,E,A,P,z,O,U,V){let G=[],N=this.transform.elevation,H=n.getProjection(),Q=N?N.getAtTileOffsetFunc(V,this.transform.center.lat,this.transform.worldSize,H):null,W=new r.P(d.tileAnchorX,d.tileAnchorY),{x:J,y:$,z:ee}=H.projectTilePoint(W.x,W.y,V.canonical);if(Q){let[xe,le,ge]=Q(W);J+=xe,$+=le,ee+=ge}let oe=H.name==="globe",ae=this.projectAndGetPerspectiveRatio(k,J,$,ee,V,oe||!!N||this.transform.pitch>0,H),{perspectiveRatio:ce}=ae,be=(P?v/ce:v*ce)/r.bc,ue=Do(J,$,ee,S),Ie=ae.signedDistanceFromCamera>0?xu(be,g,d.lineOffsetX*be,d.lineOffsetY*be,!1,ue,W,d,p,S,{},N&&!P?Q:null,P&&!!N,H,V,P):null,Te=!1,Be=!1,pe=!0;if(Ie&&!ae.occluded){let xe=.5*O*ce+U,le=new r.P(-100,-100),ge=new r.P(this.screenRightBoundary,this.screenBottomBoundary),Ne=new Il,{first:Ye,last:We}=Ie,rt=Ye.path.length,_t=[];for(let Tt=rt-1;Tt>=1;Tt--)_t.push(Ye.path[Tt]);for(let Tt=1;Tt<We.path.length;Tt++)_t.push(We.path[Tt]);let Et=2.5*xe;E&&(_t=_t.map(([Tt,Xt,Nt],qt)=>(Q&&!oe&&(Nt=Q(qt<rt-1?Ye.tilePath[rt-1-qt]:We.tilePath[qt-rt+2])[2]),Do(Tt,Xt,Nt,E))),_t.some(Tt=>Tt[3]<=0)&&(_t=[]));let vt=[];if(_t.length>0){let Tt=1/0,Xt=-1/0,Nt=1/0,qt=-1/0;for(let Gt of _t)Tt=Math.min(Tt,Gt[0]),Nt=Math.min(Nt,Gt[1]),Xt=Math.max(Xt,Gt[0]),qt=Math.max(qt,Gt[1]);Xt>=le.x&&Tt<=ge.x&&qt>=le.y&&Nt<=ge.y&&(vt=[_t.map(Gt=>new r.P(Gt[0],Gt[1]))],(Tt<le.x||Xt>ge.x||Nt<le.y||qt>ge.y)&&(vt=r.ba(vt,le.x,le.y,ge.x,ge.y)))}for(let Tt of vt){Ne.reset(Tt,.25*xe);let Xt=0;Xt=Ne.length<=.5*xe?1:Math.ceil(Ne.paddedLength/Et)+1;for(let Nt=0;Nt<Xt;Nt++){let qt=Nt/Math.max(Xt-1,1),Gt=Ne.lerp(qt),yi=Gt.x+Po,tn=Gt.y+Po;G.push(yi,tn,xe,0);let ai=yi-xe,vn=tn-xe,si=yi+xe,Si=tn+xe;if(pe=pe&&this.isOffscreen(ai,vn,si,Si),Be=Be||this.isInsideGrid(ai,vn,si,Si),!a&&this.grid.hitTestCircle(yi,tn,xe,z)&&(Te=!0,!A))return{circles:[],offscreen:!1,collisionDetected:Te,occluded:!1}}}}return{circles:!A&&Te||!Be?[]:G,offscreen:pe,collisionDetected:Te,occluded:ae.occluded}}queryRenderedSymbols(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let a=[],d=1/0,p=1/0,g=-1/0,v=-1/0;for(let A of n){let P=new r.P(A.x+Po,A.y+Po);d=Math.min(d,P.x),p=Math.min(p,P.y),g=Math.max(g,P.x),v=Math.max(v,P.y),a.push(P)}let k=this.grid.query(d,p,g,v).concat(this.ignoredGrid.query(d,p,g,v)),S={},E={};for(let A of k){let P=A.key;if(S[P.bucketInstanceId]===void 0&&(S[P.bucketInstanceId]={}),S[P.bucketInstanceId][P.featureIndex])continue;let z=[new r.P(A.x1,A.y1),new r.P(A.x2,A.y1),new r.P(A.x2,A.y2),new r.P(A.x1,A.y2)];r.bb(a,z)&&(S[P.bucketInstanceId][P.featureIndex]=!0,E[P.bucketInstanceId]===void 0&&(E[P.bucketInstanceId]=[]),E[P.bucketInstanceId].push(P.featureIndex))}return E}insertCollisionBox(n,a,d,p,g){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:p,collisionGroupID:g},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,a,d,p,g){let v=a?this.ignoredGrid:this.grid,k={bucketInstanceId:d,featureIndex:p,collisionGroupID:g};for(let S=0;S<n.length;S+=4)v.insertCircle(k,n[S],n[S+1],n[S+2])}projectAndGetPerspectiveRatio(n,a,d,p,g,v,k){let S=[a,d,p,1],E=!1;p||this.transform.pitch>0?(r.a7.transformMat4(S,S,n),this.fogState&&g&&k.name!=="globe"&&(E=function(z,O,U,V,G,N){let H=N.calculateFogTileMatrix(G),Q=[O,U,V];return r.N.transformMat4(Q,Q,H),Ri(z,r.N.length(Q),N.pitch,N._fov)}(this.fogState,a,d,p,g.toUnwrapped(),this.transform)>.9)):ku(S,S,n);let A=S[3];return{point:new r.P((S[0]/A+1)/2*this.transform.width+Po,(-S[1]/A+1)/2*this.transform.height+Po),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(k)/A*.5,1.5),signedDistanceFromCamera:A,occluded:v&&S[2]>A||E}}isOffscreen(n,a,d,p){return d<Po||n>=this.screenRightBoundary||p<Po||a>this.screenBottomBoundary}isInsideGrid(n,a,d,p){return d>=0&&n<this.gridRightBoundary&&p>=0&&a<this.gridBottomBoundary}getViewportMatrix(){let n=r.a6.identity([]);return r.a6.translate(n,n,[-100,-100,0]),n}}function zd(c,n,a){let d=n.createTileMatrix(c,c.worldSize,a.toUnwrapped());return r.a6.multiply(new Float32Array(16),c.projMatrix,d)}function Iu(c,n,a){if(n.projection.name===a.projection.name)return c.projMatrix;let d=a.clone();return d.setProjection(n.projection),zd(d,n.getProjection(),c)}function Sc(c,n,a){return n.name===a.projection.name?c.projMatrix:zd(a,n,c)}class Su{constructor(n,a,d,p){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?a:-a))):p&&d?1:0,this.placed=d}isHidden(){return this.opacity===0&&!this.placed}}class os{constructor(n,a,d,p,g,v=!1){this.text=new Su(n?n.text:null,a,d,g),this.icon=new Su(n?n.icon:null,a,p,g),this.clipped=v}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Yo{constructor(n,a,d,p=!1){this.text=n,this.icon=a,this.skipFade=d,this.clipped=p}}class Cu{constructor(){this.invProjMatrix=r.a6.create(),this.viewportMatrix=r.a6.create(),this.circles=[]}}class Gs{constructor(n,a,d,p,g){this.bucketInstanceId=n,this.featureIndex=a,this.sourceLayerIndex=d,this.bucketIndex=p,this.tileID=g}}class Od{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){let a=++this.maxGroupID;this.collisionGroups[n]={ID:a,predicate:d=>d.collisionGroupID===a}}return this.collisionGroups[n]}}function $s(c,n,a,d,p){let{horizontalAlign:g,verticalAlign:v}=r.bf(c),k=-(g-.5)*n,S=-(v-.5)*a,E=r.bd(c,d);return new r.P(k+E[0]*p,S+E[1]*p)}function Mu(c,n,a,d,p){let g=new r.P(c,n);return a&&g._rotate(d?p:-p),g}class g0{constructor(n,a,d,p,g,v){this.transform=n.clone(),this.projection=n.projection.name,this.collisionIndex=new st(this.transform,g),this.buildingIndex=v,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new Od(d),this.collisionCircleArrays={},this.prevPlacement=p,p&&(p.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,a,d,p){let g=d.getBucket(a),v=d.latestFeatureIndex;if(!g||!v||a.fqid!==g.layerIds[0])return;let k=g.layers[0].layout,S=d.collisionBoxArray,E=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),A=d.tileSize/r.V,P=d.tileID.toUnwrapped();this.transform.setProjection(g.projection);let z=(O=d.tileID,U=g.getProjection(),V=this.transform,U.name===this.projection?V.calculateProjMatrix(O.toUnwrapped()):zd(V,U,O));var O,U,V;let G=k.get("text-pitch-alignment")==="map",N=k.get("text-rotation-alignment")==="map";a.compileFilter();let H=a.dynamicFilter(),Q=a.dynamicFilterNeedsFeature(),W=this.transform.calculatePixelsToTileUnitsMatrix(d),J=gu(z,d.tileID.canonical,G,N,this.transform,g.getProjection(),W),$=null;if(G){let ae=yu(z,d.tileID.canonical,G,N,this.transform,g.getProjection(),W);$=r.a6.multiply([],this.transform.labelPlaneMatrix,ae)}let ee=null;H&&d.latestFeatureIndex&&(ee={unwrappedTileID:P,dynamicFilter:H,dynamicFilterNeedsFeature:Q,featureIndex:d.latestFeatureIndex}),this.retainedQueryData[g.bucketInstanceId]=new Gs(g.bucketInstanceId,v,g.sourceLayerIndex,g.index,d.tileID);let oe={bucket:g,layout:k,posMatrix:z,textLabelPlaneMatrix:J,labelToScreenMatrix:$,clippingData:ee,scale:E,textPixelRatio:A,holdingForFade:d.holdingForFade(),collisionBoxArray:S,partiallyEvaluatedTextSize:r.b5(g.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:r.b5(g.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(g.sourceID)};if(p)for(let ae of g.sortKeyRanges){let{sortKey:ce,symbolInstanceStart:be,symbolInstanceEnd:ue}=ae;n.push({sortKey:ce,symbolInstanceStart:be,symbolInstanceEnd:ue,parameters:oe})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:g.symbolInstances.length,parameters:oe})}attemptAnchorPlacement(n,a,d,p,g,v,k,S,E,A,P,z,O,U,V,G,N,H){let{textOffset0:Q,textOffset1:W,crossTileID:J}=z,$=[Q,W],ee=$s(n,d,p,$,g),oe=this.collisionIndex.placeCollisionBox(U,g,a,Mu(ee.x,ee.y,v,k,this.transform.angle),P,S,E,A.predicate);if(G){let ae=U.getSymbolInstanceIconSize(H,this.transform.zoom,z.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(U,ae,G,Mu(ee.x,ee.y,v,k,this.transform.angle),P,S,E,A.predicate).box.length===0)return}if(oe.box.length>0){let ae;return this.prevPlacement&&this.prevPlacement.variableOffsets[J]&&this.prevPlacement.placements[J]&&this.prevPlacement.placements[J].text&&(ae=this.prevPlacement.variableOffsets[J].anchor),this.variableOffsets[J]={textOffset:$,width:d,height:p,anchor:n,textScale:g,prevAnchor:ae},this.markUsedJustification(U,n,z,V),U.allowVerticalPlacement&&(this.markUsedOrientation(U,V,z),this.placedOrientations[J]=V),{shift:ee,placedGlyphBoxes:oe}}}placeLayerBucketPart(n,a,d,p){let{bucket:g,layout:v,posMatrix:k,textLabelPlaneMatrix:S,labelToScreenMatrix:E,clippingData:A,textPixelRatio:P,holdingForFade:z,collisionBoxArray:O,partiallyEvaluatedTextSize:U,partiallyEvaluatedIconSize:V,collisionGroup:G}=n.parameters,N=v.get("text-optional"),H=v.get("icon-optional"),Q=v.get("text-allow-overlap"),W=v.get("icon-allow-overlap"),J=v.get("text-rotation-alignment")==="map",$=v.get("text-pitch-alignment")==="map",ee=v.get("symbol-z-order")==="viewport-y",oe=v.get("symbol-z-elevate");this.transform.setProjection(g.projection);let ae=Q&&(W||!g.hasIconData()||H),ce=W&&(Q||!g.hasTextData()||N);!g.collisionArrays&&O&&g.deserializeCollisionBoxes(O),d&&p&&g.updateCollisionDebugBuffers(this.transform.zoom,O);let be=(ue,Ie,Te)=>{let{crossTileID:Be,numVerticalGlyphVertices:pe}=ue;if(A){let si={zoom:this.transform.zoom,pitch:this.transform.pitch},Si=null;if(A.dynamicFilterNeedsFeature){let li=this.retainedQueryData[g.bucketInstanceId];Si=A.featureIndex.loadFeature({featureIndex:ue.featureIndex,bucketIndex:li.bucketIndex,sourceLayerIndex:li.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,A.dynamicFilter)(si,Si,this.retainedQueryData[g.bucketInstanceId].tileID.canonical,new r.P(ue.tileAnchorX,ue.tileAnchorY),this.transform.calculateDistanceTileData(A.unwrappedTileID)))return this.placements[Be]=new Yo(!1,!1,!1,!0),void a.add(Be)}if(a.has(Be))return;if(z)return void(this.placements[Be]=new Yo(!1,!1,!1));let xe=!1,le=!1,ge=!0,Ne=!1,Ye=!1,We=null,rt={box:null,offscreen:null,occluded:null},_t={box:null,offscreen:null,occluded:null},Et=null,vt=null,Tt=null,Xt=0,Nt=0,qt=0;Te.textFeatureIndex?Xt=Te.textFeatureIndex:ue.useRuntimeCollisionCircles&&(Xt=ue.featureIndex),Te.verticalTextFeatureIndex&&(Nt=Te.verticalTextFeatureIndex);let Gt=si=>{si.tileID=this.retainedQueryData[g.bucketInstanceId].tileID;let Si=this.transform.elevation;si.elevation=ue.zOffset+(Si?Si.getAtTileOffset(si.tileID,si.tileAnchorX,si.tileAnchorY):0)},yi=Te.textBox;if(yi){Gt(yi);let si=li=>{let Ii=r.b6.horizontal;if(g.allowVerticalPlacement&&!li&&this.prevPlacement){let rn=this.prevPlacement.placedOrientations[Be];rn&&(this.placedOrientations[Be]=rn,Ii=rn,this.markUsedOrientation(g,Ii,ue))}return Ii},Si=(li,Ii)=>{if(g.allowVerticalPlacement&&pe>0&&Te.verticalTextBox){for(let rn of g.writingModes)if(rn===r.b6.vertical?(rt=Ii(),_t=rt):rt=li(),rt&&rt.box&&rt.box.length)break}else rt=li()};if(v.get("text-variable-anchor")){let li=v.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Be]){let Di=this.prevPlacement.variableOffsets[Be];li.indexOf(Di.anchor)>0&&(li=li.filter(ur=>ur!==Di.anchor),li.unshift(Di.anchor))}let Ii=(Di,ur,Sr)=>{let ao=g.getSymbolInstanceTextSize(U,ue,this.transform.zoom,Ie),ga=(Di.x2-Di.x1)*ao+2*Di.padding,so=(Di.y2-Di.y1)*ao+2*Di.padding,mr=ue.hasIconTextFit&&!W?ur:null;mr&&Gt(mr);let tr={box:[],offscreen:!1,occluded:!1},jr=Q?2*li.length:li.length;for(let Yr=0;Yr<jr;++Yr){let lo=this.attemptAnchorPlacement(li[Yr%li.length],Di,ga,so,ao,J,$,P,k,G,Yr>=li.length,ue,Ie,g,Sr,mr,U,V);if(lo&&(tr=lo.placedGlyphBoxes,tr&&tr.box&&tr.box.length)){xe=!0,We=lo.shift;break}}return tr};Si(()=>Ii(yi,Te.iconBox,r.b6.horizontal),()=>{let Di=Te.verticalTextBox;return Di&&Gt(Di),g.allowVerticalPlacement&&!(rt&&rt.box&&rt.box.length)&&pe>0&&Di?Ii(Di,Te.verticalIconBox,r.b6.vertical):{box:null,offscreen:null,occluded:null}}),rt&&(xe=rt.box,ge=rt.offscreen,Ne=rt.occluded);let rn=si(!(!rt||!rt.box));if(!xe&&this.prevPlacement){let Di=this.prevPlacement.variableOffsets[Be];Di&&(this.variableOffsets[Be]=Di,this.markUsedJustification(g,Di.anchor,ue,rn))}}else{let li=(Ii,rn)=>{let Di=g.getSymbolInstanceTextSize(U,ue,this.transform.zoom,Ie),ur=this.collisionIndex.placeCollisionBox(g,Di,Ii,new r.P(0,0),Q,P,k,G.predicate);return ur&&ur.box&&ur.box.length&&(this.markUsedOrientation(g,rn,ue),this.placedOrientations[Be]=rn),ur};Si(()=>li(yi,r.b6.horizontal),()=>{let Ii=Te.verticalTextBox;return g.allowVerticalPlacement&&pe>0&&Ii?(Gt(Ii),li(Ii,r.b6.vertical)):{box:null,offscreen:null,occluded:null}}),si(!!(rt&&rt.box&&rt.box.length))}}if(Et=rt,xe=Et&&Et.box&&Et.box.length>0,ge=Et&&Et.offscreen,Ne=Et&&Et.occluded,ue.useRuntimeCollisionCircles){let si=g.text.placedSymbolArray.get(ue.centerJustifiedTextSymbolIndex>=0?ue.centerJustifiedTextSymbolIndex:ue.verticalPlacedTextSymbolIndex),Si=r.b7(g.textSizeData,U,si),li=v.get("text-padding");vt=this.collisionIndex.placeCollisionCircles(g,Q,si,g.lineVertexArray,g.glyphOffsetArray,Si,k,S,E,d,$,G.predicate,ue.collisionCircleDiameter*Si/r.bc,li,this.retainedQueryData[g.bucketInstanceId].tileID),xe=Q||vt.circles.length>0&&!vt.collisionDetected,ge=ge&&vt.offscreen,Ne=vt.occluded}if(Te.iconFeatureIndex&&(qt=Te.iconFeatureIndex),Te.iconBox){let si=Si=>{Gt(Si);let li=ue.hasIconTextFit&&We?Mu(We.x,We.y,J,$,this.transform.angle):new r.P(0,0),Ii=g.getSymbolInstanceIconSize(V,this.transform.zoom,ue.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(g,Ii,Si,li,W,P,k,G.predicate)};_t&&_t.box&&_t.box.length&&Te.verticalIconBox?(Tt=si(Te.verticalIconBox),le=Tt.box.length>0):(Tt=si(Te.iconBox),le=Tt.box.length>0),ge=ge&&Tt.offscreen,Ye=Tt.occluded}let tn=N||ue.numHorizontalGlyphVertices===0&&pe===0,ai=H||ue.numIconVertices===0;if(tn||ai?ai?tn||(le=le&&xe):xe=le&&xe:le=xe=le&&xe,xe&&Et&&Et.box&&this.collisionIndex.insertCollisionBox(Et.box,v.get("text-ignore-placement"),g.bucketInstanceId,_t&&_t.box&&Nt?Nt:Xt,G.ID),le&&Tt&&this.collisionIndex.insertCollisionBox(Tt.box,v.get("icon-ignore-placement"),g.bucketInstanceId,qt,G.ID),vt&&(xe&&this.collisionIndex.insertCollisionCircles(vt.circles,v.get("text-ignore-placement"),g.bucketInstanceId,Xt,G.ID),d)){let si=g.bucketInstanceId,Si=this.collisionCircleArrays[si];Si===void 0&&(Si=this.collisionCircleArrays[si]=new Cu);for(let li=0;li<vt.circles.length;li+=4)Si.circles.push(vt.circles[li+0]),Si.circles.push(vt.circles[li+1]),Si.circles.push(vt.circles[li+2]),Si.circles.push(vt.collisionDetected?1:0)}let vn=g.projection.name!=="globe";ae=ae&&(vn||!Ne),ce=ce&&(vn||!Ye),this.placements[Be]=new Yo(xe||ae,le||ce,ge||g.justReloaded),a.add(Be)};if(oe&&this.buildingIndex&&(this.buildingIndex.updateZOffset(g,this.retainedQueryData[g.bucketInstanceId].tileID),g.updateZOffset()),ee){let ue=g.getSortedSymbolIndexes(this.transform.angle);for(let Ie=ue.length-1;Ie>=0;--Ie){let Te=ue[Ie];be(g.symbolInstances.get(Te),Te,g.collisionArrays[Te])}g.hasAnyZOffset&&r.w(`${g.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(g.hasAnyZOffset){let ue=g.getSortedIndexesByZOffset();for(let Ie=0;Ie<ue.length;++Ie){let Te=ue[Ie];be(g.symbolInstances.get(Te),Te,g.collisionArrays[Te])}}else for(let ue=n.symbolInstanceStart;ue<n.symbolInstanceEnd;ue++)be(g.symbolInstances.get(ue),ue,g.collisionArrays[ue]);if(d&&g.bucketInstanceId in this.collisionCircleArrays){let ue=this.collisionCircleArrays[g.bucketInstanceId];r.a6.invert(ue.invProjMatrix,k),ue.viewportMatrix=this.collisionIndex.getViewportMatrix()}g.justReloaded=!1}markUsedJustification(n,a,d,p){let{leftJustifiedTextSymbolIndex:g,centerJustifiedTextSymbolIndex:v,rightJustifiedTextSymbolIndex:k,verticalPlacedTextSymbolIndex:S,crossTileID:E}=d,A=r.be(a),P=p===r.b6.vertical?S:A==="left"?g:A==="center"?v:A==="right"?k:-1;g>=0&&(n.text.placedSymbolArray.get(g).crossTileID=P>=0&&g!==P?0:E),v>=0&&(n.text.placedSymbolArray.get(v).crossTileID=P>=0&&v!==P?0:E),k>=0&&(n.text.placedSymbolArray.get(k).crossTileID=P>=0&&k!==P?0:E),S>=0&&(n.text.placedSymbolArray.get(S).crossTileID=P>=0&&S!==P?0:E)}markUsedOrientation(n,a,d){let p=a===r.b6.horizontal||a===r.b6.horizontalOnly?a:0,g=a===r.b6.vertical?a:0,{leftJustifiedTextSymbolIndex:v,centerJustifiedTextSymbolIndex:k,rightJustifiedTextSymbolIndex:S,verticalPlacedTextSymbolIndex:E}=d,A=n.text.placedSymbolArray;v>=0&&(A.get(v).placedOrientation=p),k>=0&&(A.get(k).placedOrientation=p),S>=0&&(A.get(S).placedOrientation=p),E>=0&&(A.get(E).placedOrientation=g)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;let a=this.prevPlacement,d=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;let p=a?a.symbolFadeChange(n):1,g=a?a.opacities:{},v=a?a.variableOffsets:{},k=a?a.placedOrientations:{};for(let S in this.placements){let E=this.placements[S],A=g[S];A?(this.opacities[S]=new os(A,p,E.text,E.icon,null,E.clipped),d=d||E.text!==A.text.placed||E.icon!==A.icon.placed):(this.opacities[S]=new os(null,p,E.text,E.icon,E.skipFade,E.clipped),d=d||E.text||E.icon)}for(let S in g){let E=g[S];if(!this.opacities[S]){let A=new os(E,p,!1,!1);A.isHidden()||(this.opacities[S]=A,d=d||E.text.placed||E.icon.placed)}}for(let S in v)this.variableOffsets[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.variableOffsets[S]=v[S]);for(let S in k)this.placedOrientations[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.placedOrientations[S]=k[S]);d?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:n)}updateLayerOpacities(n,a){let d=new Set;for(let p of a){let g=p.getBucket(n);g&&p.latestFeatureIndex&&n.fqid===g.layerIds[0]&&(this.updateBucketOpacities(g,d,p.collisionBoxArray),g.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(g,p.tileID),g.updateZOffset()))}}updateBucketOpacities(n,a,d){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();let p=n.layers[0].layout,g=!!n.layers[0].dynamicFilter(),v=new os(null,0,!1,!1,!0),k=p.get("text-allow-overlap"),S=p.get("icon-allow-overlap"),E=p.get("text-variable-anchor"),A=p.get("text-rotation-alignment")==="map",P=p.get("text-pitch-alignment")==="map",z=new os(null,0,k&&(S||!n.hasIconData()||p.get("icon-optional")),S&&(k||!n.hasTextData()||p.get("text-optional")),!0);!n.collisionArrays&&d&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(d);let O=(V,G,N)=>{for(let H=0;H<G/4;H++)V.opacityVertexArray.emplaceBack(N)},U=0;for(let V=0;V<n.symbolInstances.length;V++){let G=n.symbolInstances.get(V),{numHorizontalGlyphVertices:N,numVerticalGlyphVertices:H,crossTileID:Q,numIconVertices:W}=G,J=a.has(Q),$=this.opacities[Q];J?$=v:$||($=z,this.opacities[Q]=$),a.add(Q);let ee=N>0||H>0,oe=W>0,ae=this.placedOrientations[Q],ce=ae===r.b6.vertical,be=ae===r.b6.horizontal||ae===r.b6.horizontalOnly;if(!ee&&!oe||$.isHidden()||U++,ee){let ue=_f($.text);O(n.text,N,ce?Cc:ue),O(n.text,H,be?Cc:ue);let Ie=$.text.isHidden(),{leftJustifiedTextSymbolIndex:Te,centerJustifiedTextSymbolIndex:Be,rightJustifiedTextSymbolIndex:pe,verticalPlacedTextSymbolIndex:xe}=G,le=n.text.placedSymbolArray,ge=Ie||ce?1:0;Te>=0&&(le.get(Te).hidden=ge),Be>=0&&(le.get(Be).hidden=ge),pe>=0&&(le.get(pe).hidden=ge),xe>=0&&(le.get(xe).hidden=Ie||be?1:0);let Ne=this.variableOffsets[Q];Ne&&this.markUsedJustification(n,Ne.anchor,G,ae);let Ye=this.placedOrientations[Q];Ye&&(this.markUsedJustification(n,"left",G,Ye),this.markUsedOrientation(n,Ye,G))}if(oe){let ue=_f($.icon),{placedIconSymbolIndex:Ie,verticalPlacedIconSymbolIndex:Te}=G,Be=n.icon.placedSymbolArray,pe=$.icon.isHidden()?1:0;Ie>=0&&(O(n.icon,W,ce?Cc:ue),Be.get(Ie).hidden=pe),Te>=0&&(O(n.icon,G.numVerticalIconVertices,be?Cc:ue),Be.get(Te).hidden=pe)}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){let ue=n.collisionArrays[V];if(ue){let Ie=new r.P(0,0),Te=!0;if(ue.textBox||ue.verticalTextBox){if(E){let pe=this.variableOffsets[Q];pe?(Ie=$s(pe.anchor,pe.width,pe.height,pe.textOffset,pe.textScale),A&&Ie._rotate(P?this.transform.angle:-this.transform.angle)):Te=!1}g&&(Te=!$.clipped),ue.textBox&&Cl(n.textCollisionBox.collisionVertexArray,$.text.placed,!Te||ce,Ie.x,Ie.y),ue.verticalTextBox&&Cl(n.textCollisionBox.collisionVertexArray,$.text.placed,!Te||be,Ie.x,Ie.y)}let Be=Te&&!!(!be&&ue.verticalIconBox);ue.iconBox&&Cl(n.iconCollisionBox.collisionVertexArray,$.icon.placed,Be,G.hasIconTextFit?Ie.x:0,G.hasIconTextFit?Ie.y:0),ue.verticalIconBox&&Cl(n.iconCollisionBox.collisionVertexArray,$.icon.placed,!Be,G.hasIconTextFit?Ie.x:0,G.hasIconTextFit?Ie.y:0)}}}if(n.fullyClipped=U===0,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){let V=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=V.invProjMatrix,n.placementViewportMatrix=V.viewportMatrix,n.collisionCircleArray=V.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,a){let d=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*d>n}setStale(){this.stale=!0}}function Cl(c,n,a,d,p){c.emplaceBack(n?1:0,a?1:0,d||0,p||0),c.emplaceBack(n?1:0,a?1:0,d||0,p||0),c.emplaceBack(n?1:0,a?1:0,d||0,p||0),c.emplaceBack(n?1:0,a?1:0,d||0,p||0)}let y0=Math.pow(2,25),pf=Math.pow(2,24),ff=Math.pow(2,17),Eu=Math.pow(2,16),b0=Math.pow(2,9),v0=Math.pow(2,8),x0=Math.pow(2,1);function _f(c){if(c.opacity===0&&!c.placed)return 0;if(c.opacity===1&&c.placed)return 4294967295;let n=c.placed?1:0,a=Math.floor(127*c.opacity);return a*y0+n*pf+a*ff+n*Eu+a*b0+n*v0+a*x0+n}let Cc=0;class w0{constructor(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&n.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(n,a,d,p,g){let v=this._bucketParts;for(;this._currentTileIndex<n.length;)if(a.getBucketParts(v,p,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,g())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,v.sort((k,S)=>k.sortKey-S.sortKey));this._currentPartIndex<v.length;){let k=v[this._currentPartIndex];if(a.placeLayerBucketPart(k,this._seenCrossTileIDs,d,k.symbolInstanceStart===0),this._currentPartIndex++,g())return!0}return!1}}class Fd{constructor(n,a,d,p,g,v,k,S,E){this.placement=new g0(n,g,v,k,S,E),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=p,this._done=!1}isDone(){return this._done}continuePlacement(n,a,d,p){let g=r.f.now(),v=()=>{let k=r.f.now()-g;return!this._forceFullPlacement&&k>2};for(;this._currentPlacementIndex>=0;){let k=a[n[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if(k.type==="symbol"&&(!k.minzoom||k.minzoom<=S)&&(!k.maxzoom||k.maxzoom>S)){let E=k,A=E.layout.get("symbol-z-elevate"),P=this._inProgressLayer=this._inProgressLayer||new w0(E),z=r.ag(k.source,k.scope);if(P.continuePlacement(A?p[z]:d[z],this.placement,this._showCollisionBoxes,k,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}let Au=512/r.V/2;class gf{constructor(n,a,d){this.tileID=n,this.bucketInstanceId=d,this.index=new r.bg(a.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];let p=n.canonical.x*r.V,g=n.canonical.y*r.V;for(let v=0;v<a.length;v++){let{key:k,crossTileID:S,tileAnchorX:E,tileAnchorY:A}=a.get(v),P=Math.floor((p+E)*Au),z=Math.floor((g+A)*Au);this.index.add(P,z),this.keys.push(k),this.crossTileIDs.push(S)}this.index.finish()}findMatches(n,a,d){let p=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z),g=Au/Math.pow(2,a.canonical.z-this.tileID.canonical.z),v=a.canonical.x*r.V,k=a.canonical.y*r.V;for(let S=0;S<n.length;S++){let E=n.get(S);if(E.crossTileID)continue;let{key:A,tileAnchorX:P,tileAnchorY:z}=E,O=Math.floor((v+P)*g),U=Math.floor((k+z)*g),V=this.index.range(O-p,U-p,O+p,U+p);for(let G of V){let N=this.crossTileIDs[G];if(this.keys[G]===A&&!d.has(N)){d.add(N),E.crossTileID=N;break}}}}}class Du{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Bd{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){let a=Math.round((n-this.lng)/360);if(a!==0)for(let d in this.indexes){let p=this.indexes[d],g={};for(let v in p){let k=p[v];k.tileID=k.tileID.unwrapTo(k.tileID.wrap+a),g[k.tileID.key]=k}this.indexes[d]=g}this.lng=n}addBucket(n,a,d){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let g=0;g<a.symbolInstances.length;g++)a.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]=new Set);let p=this.usedCrossTileIDs[n.overscaledZ];for(let g in this.indexes){let v=this.indexes[g];if(Number(g)>n.overscaledZ)for(let k in v){let S=v[k];S.tileID.isChildOf(n)&&S.findMatches(a.symbolInstances,n,p)}else{let k=v[n.scaledTo(Number(g)).key];k&&k.findMatches(a.symbolInstances,n,p)}}for(let g=0;g<a.symbolInstances.length;g++){let v=a.symbolInstances.get(g);v.crossTileID||(v.crossTileID=d.generate(),p.add(v.crossTileID))}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new gf(n,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(n,a){for(let d of a.crossTileIDs)this.usedCrossTileIDs[n].delete(d)}removeStaleBuckets(n){let a=!1;for(let d in this.indexes){let p=this.indexes[d];for(let g in p)n[p[g].bucketInstanceId]||(this.removeBucketCrossTileIDs(d,p[g]),delete p[g],a=!0)}return a}}class Pu{constructor(){this.layerIndexes={},this.crossTileIDs=new Du,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,a,d,p){let g=this.layerIndexes[n.fqid];g===void 0&&(g=this.layerIndexes[n.fqid]=new Bd);let v=!1,k={};p.name!=="globe"&&g.handleWrapJump(d);for(let S of a){let E=S.getBucket(n);E&&n.fqid===E.layerIds[0]&&(E.bucketInstanceId||(E.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(S.tileID,E,this.crossTileIDs)&&(v=!0),k[E.bucketInstanceId]=!0)}return g.removeStaleBuckets(k)&&(v=!0),v}pruneUnusedLayers(n){let a={};n.forEach(d=>{a[d]=!0});for(let d in this.layerIndexes)a[d]||delete this.layerIndexes[d]}}class qs{constructor(n=0,a=0,d=0,p=0){if(isNaN(n)||n<0||isNaN(a)||a<0||isNaN(d)||d<0||isNaN(p)||p<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=a,this.left=d,this.right=p}interpolate(n,a,d){return a.top!=null&&n.top!=null&&(this.top=r.U(n.top,a.top,d)),a.bottom!=null&&n.bottom!=null&&(this.bottom=r.U(n.bottom,a.bottom,d)),a.left!=null&&n.left!=null&&(this.left=r.U(n.left,a.left,d)),a.right!=null&&n.right!=null&&(this.right=r.U(n.right,a.right,d)),this}getCenter(n,a){let d=r.aa((this.left+n-this.right)/2,0,n),p=r.aa((this.top+a-this.bottom)/2,0,a);return new r.P(d,p)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new qs(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Nd(c,n){let a=r.bk(c,3);r.a6.fromQuat(c,n),r.bm(c,3,a)}function Mc(c,n){let a=r.bi.identity([]);return r.bi.rotateZ(a,a,-n),r.bi.rotateX(a,a,-c),a}function Ru(c,n){let a=[c[0],c[1],0],d=[n[0],n[1],0];if(r.N.length(a)>=1e-15){let v=r.N.normalize([],a);r.N.scale(d,v,r.N.dot(d,v)),n[0]=d[0],n[1]=d[1]}let p=r.N.cross([],n,c);if(r.N.len(p)<1e-15)return null;let g=Math.atan2(-p[1],p[0]);return Mc(Math.atan2(Math.sqrt(c[0]*c[0]+c[1]*c[1]),-c[2]),g)}class Ec{constructor(n,a){this.position=n,this.orientation=a}get position(){return this._position}set position(n){if(n){let a=n instanceof r.L?n:new r.L(n[0],n[1],n[2]);this._renderWorldCopies&&(a.x=r.bh(a.x,0,1)),this._position=a}else this._position=null}lookAtPoint(n,a){if(this.orientation=null,!this.position)return;let d=this.position,p=this._elevation?this._elevation.getAtPointOrZero(r.L.fromLngLat(n)):0,g=r.L.fromLngLat(n,p),v=[g.x-d.x,g.y-d.y,g.z-d.z];a||(a=[0,0,1]),a[2]=Math.abs(a[2]),this.orientation=Ru(v,a)}setPitchBearing(n,a){this.orientation=Mc(r.bj(n),r.bj(-a))}}class Ml{constructor(n,a){this._transform=r.a6.identity([]),this.orientation=a,this.position=n}get mercatorPosition(){let n=this.position;return new r.L(n[0],n[1],n[2])}get position(){let n=r.bk(this._transform,3);return[n[0],n[1],n[2]]}set position(n){var a;n&&r.bm(this._transform,3,[(a=n)[0],a[1],a[2],1])}get orientation(){return this._orientation}set orientation(n){this._orientation=n||r.bi.identity([]),n&&Nd(this._transform,this._orientation)}getPitchBearing(){let n=this.forward(),a=this.right();return{bearing:Math.atan2(-a[1],a[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,a){this._orientation=Mc(n,a),Nd(this._transform,this._orientation)}forward(){let n=r.bk(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){let n=r.bk(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){let n=r.bk(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,a){let d=new Float64Array(16);return r.a6.invert(d,this.getWorldToCamera(n,a)),d}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(n,a,d){let p=this.position;r.N.scale(p,p,-n);let g=new Float64Array(16);return r.a6.fromScaling(g,[d,d,d]),r.a6.translate(g,g,p),g[10]*=a,g}getWorldToCamera(n,a){let d=new Float64Array(16),p=new Float64Array(4),g=this.position;return r.bi.conjugate(p,this._orientation),r.N.scale(g,g,-n),r.a6.fromQuat(d,p),r.a6.translate(d,d,g),d[1]*=-1,d[5]*=-1,d[9]*=-1,d[13]*=-1,d[8]*=a,d[9]*=a,d[10]*=a,d[11]*=a,d}getCameraToClipPerspective(n,a,d,p){let g=new Float64Array(16);return r.a6.perspective(g,n,a,d,p),g}getCameraToClipOrthographic(n,a,d,p,g,v){let k=new Float64Array(16);return r.a6.ortho(k,n,a,d,p,g,v),k}getDistanceToElevation(n,a=!1){let d=n===0?0:r.bl(n,a?r.au(this.position[1]):this.position[1]),p=this.forward();return(d-this.position[2])/p[2]}clone(){return new Ml([...this.position],[...this.orientation])}}let El=(c,n,a)=>(1-a)*c+a*n,Ac=c=>c*c*c*c*c;class Dc{constructor(n,a,d,p,g,v,k){this.tileSize=512,this._renderWorldCopies=g===void 0||g,this._minZoom=n||0,this._maxZoom=a||22,this._minPitch=d??0,this._maxPitch=p??60,this.setProjection(v),this.setMaxBounds(k),this.width=0,this.height=0,this._center=new r.bn(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new qs,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Ml,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){let n=new Dc(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,n.tileSize=this.tileSize,n.mercatorFromTransition=this.mercatorFromTransition,n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._seaLevelZoom=this._seaLevelZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._nearZ=this._nearZ,n._farZ=this._farZ,n._averageElevation=this._averageElevation,n._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n.frustumCorners=this.frustumCorners,n}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(n,a=!1){let d=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||d)&&this._updateCameraOnTerrain(),(n||d)&&this._constrainCamera(a),this._calcMatrices()}getProjection(){return r.ac(this.projection,["name","center","parallels"])}setProjection(n){this.projectionOptions=n||{name:"mercator"};let a=this.projection?this.getProjection():void 0;this.projection=r.bo(this.projectionOptions);let d=!M(a,this.getProjection());return d&&this._calcMatrices(),this.mercatorFromTransition=!1,d}setOrthographicProjectionAtLowPitch(n){return this._orthographicProjectionAtLowPitch!==n&&(this._orthographicProjectionAtLowPitch=n,this._calcMatrices(),!0)}setMercatorFromTransition(){let n=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=r.bo({name:"mercator"});let a=n!==this.projection.name;return a&&this._calcMatrices(),a}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){let n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get cameraWorldSize(){let n=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return r.bl(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new r.P(this.width,this.height)}get bearing(){return r.bh(this.rotation,-180,180)}set bearing(n){this.rotation=n}get rotation(){return-this.angle/Math.PI*180}set rotation(n){let a=-n*Math.PI/180;this.angle!==a&&(this._unmodified=!1,this.angle=a,this._calcMatrices(),this.rotationMatrix=r.b4.create(),r.b4.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(n){let a=r.aa(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==a&&(this._unmodified=!1,this._pitch=a,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){let n=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/n)}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=r.bj(n),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(n){let a=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==a&&(this._unmodified=!1,this._setZoom(a),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(n){this._tileCoverLift!==n&&(this._tileCoverLift=n)}_updateCameraOnTerrain(){let n=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,a=this.elevation&&n===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||n===Number.NEGATIVE_INFINITY&&(!a||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);let d=this._elevation;a||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&d.exaggeration()&&this._centerAltitudeValidForExaggeration!==d.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*d.exaggeration(),this._centerAltitudeValidForExaggeration=d.exaggeration()):(this._centerAltitude=n||0,this._centerAltitudeValidForExaggeration=d.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;let n=this._elevation,a=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],d=this.horizonLineFromTop(),p=0,g=0;for(let v=0;v<a.length;v++){let k=new r.P(a[v][0]*this.width,d+a[v][1]*(this.height-d)),S=n.pointCoordinate(k);if(!S)continue;let E=1/Math.hypot(S[0]-this._camera.position[0],S[1]-this._camera.position[1]);p+=S[3]*E,g+=E}return g===0?NaN:p/g}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;let n=this._seaLevelZoom,a=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),d=this.pixelsPerMeter/this.worldSize*a,p=this._mercatorZfromZoom(n),g=this._mercatorZfromZoom(this._maxZoom),v=Math.max(p-d,g);this._setZoom(this._zoomFromMercatorZ(v))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}computeZoomRelativeTo(n){let a=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude())),d;d=n.z<this._camera.position[2]?[a.x,a.y,a.z]:[n.x,n.y,n.z];let p=r.N.length(r.N.sub([],this._camera.position,d));return r.aa(this._zoomFromMercatorZ(p),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let a=!1;if(n.orientation&&!r.bi.exactEquals(n.orientation,this._camera.orientation)&&(a=this._setCameraOrientation(n.orientation)),n.position){let d=[n.position.x,n.position.y,n.position.z];r.N.exactEquals(d,this._camera.position)||(this._setCameraPosition(d),a=!0)}a&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();let n=this._camera.position,a=new Ec;return a.position=new r.L(n[0],n[1],n[2]),a.orientation=this._camera.orientation,a._elevation=this.elevation,a._renderWorldCopies=this.renderWorldCopies,a}_setCameraOrientation(n){if(!r.bi.length(n))return!1;r.bi.normalize(n,n);let a=r.N.transformQuat([],[0,0,-1],n),d=r.N.transformQuat([],[0,-1,0],n);if(d[2]<0)return!1;let p=Ru(a,d);return!!p&&(this._camera.orientation=p,!0)}_setCameraPosition(n){let a=this.zoomScale(this.minZoom)*this.tileSize,d=this.zoomScale(this.maxZoom)*this.tileSize,p=this.cameraToCenterDistance;n[2]=r.aa(n[2],p/d,p/a),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,a,d){this._unmodified=!1,this._edgeInsets.interpolate(n,a,d),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){let a=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,a)}getVisibleUnwrappedCoordinates(n){let a=[new r.bp(0,n)];if(this.renderWorldCopies){let d=this.pointCoordinate(new r.P(0,0)),p=this.pointCoordinate(new r.P(this.width,0)),g=this.pointCoordinate(new r.P(this.width,this.height)),v=this.pointCoordinate(new r.P(0,this.height)),k=Math.floor(Math.min(d.x,p.x,g.x,v.x)),S=Math.floor(Math.max(d.x,p.x,g.x,v.x)),E=1;for(let A=k-E;A<=S+E;A++)A!==0&&a.push(new r.bp(A,n))}return a}isLODDisabled(n){return(!n||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(n,a,d){let p=[];if(a[0]===0&&a[1]===0)return p;for(let v of n){let k=v.canonical,S=v.overscaledZ,E=v.wrap,A=1<<k.z,P=k.x+1<A,z=k.x>0,O=k.y+1<A,U=k.y>0,V=v.wrap-(z?0:1),G=v.wrap+(P?0:1),N=z?k.x-1:A-1,H=P?k.x+1:0;a[0]<0?(p.push(new r.am(S,G,k.z,H,k.y)),a[1]<0&&O&&(p.push(new r.am(S,E,k.z,k.x,k.y+1)),p.push(new r.am(S,G,k.z,H,k.y+1))),a[1]>0&&U&&(p.push(new r.am(S,E,k.z,k.x,k.y-1)),p.push(new r.am(S,G,k.z,H,k.y-1)))):a[0]>0?(p.push(new r.am(S,V,k.z,N,k.y)),a[1]<0&&O&&(p.push(new r.am(S,E,k.z,k.x,k.y+1)),p.push(new r.am(S,V,k.z,N,k.y+1))),a[1]>0&&U&&(p.push(new r.am(S,E,k.z,k.x,k.y-1)),p.push(new r.am(S,V,k.z,N,k.y-1)))):a[1]<0&&O?p.push(new r.am(S,E,k.z,k.x,k.y+1)):U&&p.push(new r.am(S,E,k.z,k.x,k.y-1))}if(p.length>1){p.sort((S,E)=>S.overscaledZ-E.overscaledZ||S.wrap-E.wrap||S.canonical.z-E.canonical.z||S.canonical.x-E.canonical.x||S.canonical.y-E.canonical.y);let v=0,k=0;for(;k<p.length;)p[k].equals(p[v])?++k:p[++v]=p[k++];p.length=v+1}let g=[];for(let v of p)p.some(k=>v.isChildOf(k))||g.push(v);return p=g.filter(v=>!n.some(k=>!!(v.overscaledZ<d&&k.isChildOf(v))||v.equals(k)||v.isChildOf(k))),p}coveringTiles(n){let a=this.coveringZoomLevel(n),d=a,p=this.elevation&&this.elevation.exaggeration(),g=p&&!n.isTerrainDEM,v=this.projection.name==="mercator";if(n.minzoom!==void 0&&a<n.minzoom)return[];n.maxzoom!==void 0&&a>n.maxzoom&&(a=n.maxzoom);let k=this.locationCoordinate(this.center),S=this.center.lat,E=1<<a,A=[E*k.x,E*k.y,0],P=this.projection.name==="globe",z=!P,O=r.bq.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,a,z),U=P?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),V=E*r.bl(1,this.center.lat),G=this._camera.position[2]/r.bl(1,this.center.lat),N=[E*U.x,E*U.y,G*(z?1:V)],H=P||p,Q=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),W=this.isLODDisabled(!0)?a:0,J;if(this._elevation&&n.isTerrainDEM)J=1e4*this._elevation.exaggeration();else if(this._elevation){let le=this._elevation.getMinMaxForVisibleTiles();J=le?le.max:this._centerAltitude}else J=this._centerAltitude;let $=n.isTerrainDEM?-J:this._elevation?this._elevation.getMinElevationBelowMSL():0,ee=this.projection.isReprojectedInTileSpace?r.br(this):1,oe=le=>{let Ne=new r.L(le.x+25e-6,le.y,le.z),Ye=new r.L(le.x,le.y+25e-6,le.z),We=le.toLngLat(),rt=Ne.toLngLat(),_t=Ye.toLngLat(),Et=this.locationCoordinate(We),vt=this.locationCoordinate(rt),Tt=this.locationCoordinate(_t),Xt=Math.hypot(vt.x-Et.x,vt.y-Et.y),Nt=Math.hypot(Tt.x-Et.x,Tt.y-Et.y);return Math.sqrt(Xt*Nt)*ee/25e-6},ae=le=>{let ge=J,Ne=$;return{aabb:r.bu(this,E,0,0,0,le,Ne,ge,this.projection),zoom:0,x:0,y:0,minZ:Ne,maxZ:ge,wrap:le,fullyVisible:!1}},ce=[],be=[],ue=a,Ie=n.reparseOverscaled?d:a,Te=le=>le*le,Be=Te((G-this._centerAltitude)*V),pe=le=>{if(!this._elevation||!le.tileID||!v)return;let ge=this._elevation.getMinMaxForTile(le.tileID),Ne=le.aabb;ge?(Ne.min[2]=ge.min,Ne.max[2]=ge.max,Ne.center[2]=(Ne.min[2]+Ne.max[2])/2):(le.shouldSplit=xe(le),le.shouldSplit||(Ne.min[2]=Ne.max[2]=Ne.center[2]=this._centerAltitude))},xe=le=>{if(le.zoom<W)return!0;if(le.zoom===ue)return!1;if(le.shouldSplit!=null)return le.shouldSplit;let ge=le.aabb.distanceX(N),Ne=le.aabb.distanceY(N),Ye=Be,We=1;if(P){Ye=Te(le.aabb.distanceZ(N));let Et=Math.pow(2,le.zoom),vt=r.au((le.y+1)/Et),Tt=r.au(le.y/Et),Xt=Math.min(Math.max(S,vt),Tt),Nt=r.bJ(Xt)/r.bJ(S);if(We=Xt===S?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Nt/this._mercatorScaleRatio),this.zoom<=r.bG&&le.zoom===ue-1&&Nt>=.9)return!0}else if(g&&(Ye=Te(le.aabb.distanceZ(N)*V)),this.projection.isReprojectedInTileSpace&&d<=5){let Et=Math.pow(2,le.zoom),vt=oe(new r.L((le.x+.5)/Et,(le.y+.5)/Et));We=vt>.85?1:vt}let rt=ge*ge+Ne*Ne+Ye,_t=Te((1<<ue-le.zoom)*Q*We*((Et,vt)=>{if(vt*Te(.707)<Et)return 1;let Tt=Math.sqrt(vt/Et);return Tt/(1.4144271570014144+(Math.pow(1.1,Tt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Ye,Be),rt));return rt<_t};if(this.renderWorldCopies)for(let le=1;le<=3;le++)ce.push(ae(-le)),ce.push(ae(le));for(ce.push(ae(0));ce.length>0;){let le=ce.pop(),ge=le.x,Ne=le.y,Ye=le.fullyVisible,We=()=>this.projection.name==="globe"&&(le.y===0||le.y===(1<<le.zoom)-1);if(!Ye){let rt=H?le.aabb.intersects(O):le.aabb.intersectsFlat(O);if(rt===0&&We()){let _t=new r.bs(le.zoom,ge,Ne);rt=r.bt(this,E,_t,!0).intersects(O)}if(rt===0)continue;Ye=rt===2}if(le.zoom!==ue&&xe(le))for(let rt=0;rt<4;rt++){let _t=(ge<<1)+rt%2,Et=(Ne<<1)+(rt>>1),vt={aabb:v?le.aabb.quadrant(rt):r.bu(this,E,le.zoom+1,_t,Et,le.wrap,le.minZ,le.maxZ,this.projection),zoom:le.zoom+1,x:_t,y:Et,wrap:le.wrap,fullyVisible:Ye,tileID:void 0,shouldSplit:void 0,minZ:le.minZ,maxZ:le.maxZ};g&&!P&&(vt.tileID=new r.am(le.zoom+1===ue?Ie:le.zoom+1,le.wrap,le.zoom+1,_t,Et),pe(vt)),ce.push(vt)}else{let rt=le.zoom===ue?Ie:le.zoom;if(n.minzoom&&n.minzoom>rt)continue;if(!Ye){let Tt=H?le.aabb.intersectsPrecise(O):le.aabb.intersectsPreciseFlat(O);if(Tt===0&&We()){let Xt=new r.bs(le.zoom,ge,Ne);Tt=r.bt(this,E,Xt,!0).intersectsPrecise(O)}if(Tt===0)continue}let _t=A[0]-(.5+ge+(le.wrap<<le.zoom))*(1<<a-le.zoom),Et=A[1]-.5-Ne,vt=le.tileID?le.tileID:new r.am(rt,le.wrap,le.zoom,ge,Ne);be.push({tileID:vt,distanceSq:_t*_t+Et*Et})}}if(this.fogCullDistSq){let le=this.fogCullDistSq,ge=this.horizonLineFromTop();be=be.filter(Ne=>{let Ye=[0,0,0,1],We=[r.V,r.V,0,1],rt=this.calculateFogTileMatrix(Ne.tileID.toUnwrapped());r.a7.transformMat4(Ye,Ye,rt),r.a7.transformMat4(We,We,rt);let _t=r.a7.min([],Ye,We),Et=r.a7.max([],Ye,We),vt=r.bv(_t,Et);if(vt===0)return!0;let Tt=!1,Xt=this._elevation;if(Xt&&vt>le&&ge!==0){let Nt=this.calculateProjMatrix(Ne.tileID.toUnwrapped()),qt;n.isTerrainDEM||(qt=Xt.getMinMaxForTile(Ne.tileID)),qt||(qt={min:$,max:J});let Gt=r.bH(this.rotation),yi=[Gt[0]*r.V,Gt[1]*r.V,qt.max];r.N.transformMat4(yi,yi,Nt),Tt=(1-yi[1])*this.height*.5<ge}return vt<le||Tt})}return be.sort((le,ge)=>le.distanceSq-ge.distanceSq).map(le=>le.tileID)}resize(n,a){this.width=n,this.height=a,this.pixelsToGLUnits=[2/n,-2/a],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log(n)/Math.LN2}project(n){let a=r.aa(n.lat,-r.bw,r.bw),d=this.projection.project(n.lng,a);return new r.P(d.x*this.worldSize,d.y*this.worldSize)}unproject(n){return this.projection.unproject(n.x/this.worldSize,n.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/r.bl(1,this.center.lat)/this.worldSize}setLocationAtPoint(n,a){let d,p,g=this.centerPoint;if(this.projection.name==="globe"){let k=this.worldSize;d=(a.x-g.x)/k,p=(a.y-g.y)/k}else{let k=this.pointCoordinate(a),S=this.pointCoordinate(g);d=k.x-S.x,p=k.y-S.y}let v=this.locationCoordinate(n);this.setLocation(new r.L(v.x-d,v.y-p))}setLocation(n){this.center=this.coordinateLocation(n),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(n){return this.projection.locationPoint(this,n)}locationPoint3D(n){return this.projection.locationPoint(this,n,!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n){return this.coordinateLocation(this.pointCoordinate3D(n))}locationCoordinate(n,a){let d=a?r.bl(a,n.lat):void 0,p=this.projection.project(n.lng,n.lat);return new r.L(p.x,p.y,d)}coordinateLocation(n){return this.projection.unproject(n.x,n.y)}pointRayIntersection(n,a){let d=a??this._centerAltitude,p=[n.x,n.y,0,1],g=[n.x,n.y,1,1];r.a7.transformMat4(p,p,this.pixelMatrixInverse),r.a7.transformMat4(g,g,this.pixelMatrixInverse);let v=g[3];r.a7.scale(p,p,1/p[3]),r.a7.scale(g,g,1/v);let k=p[2],S=g[2];return{p0:p,p1:g,t:k===S?0:(d-k)/(S-k)}}screenPointToMercatorRay(n){let a=[n.x,n.y,0,1],d=[n.x,n.y,1,1];return r.a7.transformMat4(a,a,this.pixelMatrixInverse),r.a7.transformMat4(d,d,this.pixelMatrixInverse),r.a7.scale(a,a,1/a[3]),r.a7.scale(d,d,1/d[3]),a[2]=r.bl(a[2],this._center.lat)*this.worldSize,d[2]=r.bl(d[2],this._center.lat)*this.worldSize,r.a7.scale(a,a,1/this.worldSize),r.a7.scale(d,d,1/this.worldSize),new r.a2([a[0],a[1],a[2]],r.N.normalize([],r.N.sub([],d,a)))}rayIntersectionCoordinate(n){let{p0:a,p1:d,t:p}=n,g=r.bl(a[2],this._center.lat),v=r.bl(d[2],this._center.lat);return new r.L(r.U(a[0],d[0],p)/this.worldSize,r.U(a[1],d[1],p)/this.worldSize,r.U(g,v,p))}pointCoordinate(n,a=this._centerAltitude){return this.projection.pointCoordinate(this,n.x,n.y,a)}pointCoordinate3D(n){if(!this.elevation)return this.pointCoordinate(n);let a=this.projection.pointCoordinate3D(this,n.x,n.y);if(a)return new r.L(a[0],a[1],a[2]);let d=0,p=this.horizonLineFromTop();if(n.y>p)return this.pointCoordinate(n);let g=.02*p,v=n.clone();for(let k=0;k<10&&p-d>g;k++){v.y=r.U(d,p,.66);let S=this.projection.pointCoordinate3D(this,v.x,v.y);S?(p=v.y,a=S):d=v.y}return a?new r.L(a[0],a[1],a[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){return this.projection.isPointAboveHorizon(this,n)}isPointOnSurface(n){if(n.y<0||n.y>this.height||n.x<0||n.x>this.width)return!1;if(this.elevation||this.zoom>=r.bx)return!this.isPointAboveHorizon(n);let a=this.pointCoordinate(n);return a.y>=0&&a.y<=1}_coordinatePoint(n,a){let d=a&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,p=[n.x*this.worldSize,n.y*this.worldSize,d+n.toAltitude(),1];return r.a7.transformMat4(p,p,this.pixelMatrix),p[3]>0?new r.P(p[0]/p[3],p[1]/p[3]):new r.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){let{top:n,left:a}=this._edgeInsets,d=this.height-this._edgeInsets.bottom,p=this.width-this._edgeInsets.right,g=this.pointLocation3D(new r.P(a,n)),v=this.pointLocation3D(new r.P(p,n)),k=this.pointLocation3D(new r.P(p,d)),S=this.pointLocation3D(new r.P(a,d)),E=Math.min(g.lng,v.lng,k.lng,S.lng),A=Math.max(g.lng,v.lng,k.lng,S.lng),P=Math.min(g.lat,v.lat,k.lat,S.lat),z=Math.max(g.lat,v.lat,k.lat,S.lat),O=Math.pow(2,-this.zoom)/16*270,U=this.projection.name==="globe"?1:4,V=(G,N,H,Q,W)=>{let J=(G+H)/2,$=(N+Q)/2,ee=new r.P(J,$),{lng:oe,lat:ae}=this.pointLocation3D(ee),ce=Math.max(0,E-oe,P-ae,oe-A,ae-z);E=Math.min(E,oe),A=Math.max(A,oe),P=Math.min(P,ae),z=Math.max(z,ae),(W<U||ce>O)&&(V(G,N,J,$,W+1),V(J,$,H,Q,W+1))};if(V(a,n,p,n,1),V(p,n,p,d,1),V(p,d,a,d,1),V(a,d,a,n,1),this.projection.name==="globe"){let[G,N]=r.by(this);G?(z=90,A=180,E=-180):N&&(P=-90,A=180,E=-180)}return new r.ad(new r.bn(E,P),new r.bn(A,z))}_getBoundsRectangular(n,a){let{top:d,left:p}=this._edgeInsets,g=this.height-this._edgeInsets.bottom,v=this.width-this._edgeInsets.right,k=new r.P(p,d),S=new r.P(v,d),E=new r.P(v,g),A=new r.P(p,g),P=this.pointCoordinate(k,n),z=this.pointCoordinate(S,n),O=this.pointCoordinate(E,a),U=this.pointCoordinate(A,a),V=(G,N)=>(N.y-G.y)/(N.x-G.x);return P.y>1&&z.y>=0?P=new r.L((1-U.y)/V(U,P)+U.x,1):P.y<0&&z.y<=1&&(P=new r.L(-U.y/V(U,P)+U.x,0)),z.y>1&&P.y>=0?z=new r.L((1-O.y)/V(O,z)+O.x,1):z.y<0&&P.y<=1&&(z=new r.L(-O.y/V(O,z)+O.x,0)),new r.ad().extend(this.coordinateLocation(P)).extend(this.coordinateLocation(z)).extend(this.coordinateLocation(U)).extend(this.coordinateLocation(O))}_getBoundsRectangularTerrain(){let n=this.elevation;if(!n.visibleDemTiles.length||n.isUsingMockSource())return this._getBoundsRectangular(0,0);let a=n.visibleDemTiles.reduce((d,p)=>{if(p.dem){let g=p.dem.tree;d.min=Math.min(d.min,g.minimums[0]),d.max=Math.max(d.max,g.maximums[0])}return d},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(a.min*n.exaggeration(),a.max*n.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(n=!0){let a=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,d=this.height/2-a*(1-this._horizonShift);return n?Math.max(0,d):d}getMaxBounds(){return this.maxBounds}setMaxBounds(n){this.maxBounds=n,this.minLat=-r.bw,this.maxLat=r.bw,this.minLng=-180,this.maxLng=180,n&&(this.minLat=n.getSouth(),this.maxLat=n.getNorth(),this.minLng=n.getWest(),this.maxLng=n.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=r.a5(this.minLng)*this.tileSize,this.worldMaxX=r.a5(this.maxLng)*this.tileSize,this.worldMinY=r.ae(this.maxLat)*this.tileSize,this.worldMaxY=r.ae(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(n,a){return this.projection.createTileMatrix(this,a,n)}calculateDistanceTileData(n){let a=n.key,d=this._distanceTileDataCache;if(d[a])return d[a];let p=n.canonical,g=1/this.height,v=this.cameraWorldSize,k=v/this.zoomScale(p.z),S=(p.x+Math.pow(2,p.z)*n.wrap)*k,E=p.y*k,A=this.point;A.x*=v/this.worldSize,A.y*=v/this.worldSize;let P=this.angle,z=Math.sin(-P),O=-Math.cos(-P);return d[a]={bearing:[z,O],center:[(A.x-S)*g,(A.y-E)*g],scale:k/r.V*g},d[a]}calculateFogTileMatrix(n){let a=n.key,d=this._fogTileMatrixCache;if(d[a])return d[a];let p=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,n);return r.a6.multiply(p,this.worldToFogMatrix,p),d[a]=new Float32Array(p),d[a]}calculateProjMatrix(n,a=!1,d=!1){let p=n.key,g;if(g=d?this._expandedProjMatrixCache:a?this._alignedProjMatrixCache:this._projMatrixCache,g[p])return g[p];let v=this.calculatePosMatrix(n,this.worldSize),k;return k=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:d?this.expandedFarZProjMatrix:a?this.alignedProjMatrix:this.projMatrix,r.a6.multiply(v,k,v),g[p]=new Float32Array(v),g[p]}calculatePixelsToTileUnitsMatrix(n){let a=n.tileID.key,d=this._pixelsToTileUnitsCache;if(d[a])return d[a];let p=r.bz(n,this);return d[a]=p,d[a]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){let n=1/this.worldSize,a=r.a6.fromScaling([],[n,n,n]);return r.a6.multiply(a,a,this.globeMatrix),a}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;let n=this._elevation;this._updateCameraState();let a=r.bl(1,this._center.lat)*this.worldSize,d=this._computeCameraPosition(a),p=this._camera.forward(),g=r.bl(1,this._center.lat);d[2]/=g,p[2]/=g,r.N.normalize(p,p);let v=n.raycast(d,p,n.exaggeration());if(v){let k=r.N.scaleAndAdd([],d,p,v),S=new r.L(k[0],k[1],r.bl(k[2],r.au(k[1]))),E=(S.z+r.N.length([S.x-d[0],S.y-d[1],S.z-d[2]*g]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(E),this._centerAltitude=S.toAltitude(),this._center=this.coordinateLocation(S),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(n=!1){if(!this._elevation)return;let a=this._elevation,d=r.bl(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(d),g=a.getAtPointOrZero(new r.L(...p)),v=this.pixelsPerMeter/this.worldSize*g,k=this._minimumHeightOverTerrain(),S=p[2]-v;if(S<=k)if(S<0||n){let E=this.locationCoordinate(this._center,this._centerAltitude),A=[p[0],p[1],E.z-p[2]],P=r.N.length(A);A[2]-=(k-S)/this._pixelsPerMercatorPixel;let z=r.N.length(A);if(z===0)return;r.N.scale(A,A,P/z*this._pixelsPerMercatorPixel),this._camera.position=[p[0],p[1],E.z*this._pixelsPerMercatorPixel-A[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let n=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||n){let z=this.center;return z.lat=r.aa(z.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!n)&&(z.lng=r.aa(z.lng,this.minLng,this.maxLng)),this.center=z,void(this._constraining=!1)}let a=this._unmodified,{x:d,y:p}=this.point,g=0,v=d,k=p,S=this.width/2,E=this.height/2,A=this.worldMinY*this.scale,P=this.worldMaxY*this.scale;if(p-E<A&&(k=A+E),p+E>P&&(k=P-E),P-A<this.height&&(g=Math.max(g,this.height/(P-A)),k=(P+A)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){let z=this.worldMinX*this.scale,O=this.worldMaxX*this.scale,U=this.worldSize/2-(z+O)/2;v=(d+U+this.worldSize)%this.worldSize-U,v-S<z&&(v=z+S),v+S>O&&(v=O-S),O-z<this.width&&(g=Math.max(g,this.width/(O-z)),v=(O+z)/2)}v===d&&k===p||(this.center=this.unproject(new r.P(v,k))),g&&(this.zoom+=this.scaleZoom(g)),this._constrainCamera(),this._unmodified=a,this._constraining=!1}_minZoomForBounds(){let n=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(n=Math.max(n,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),n}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;let n=this.centerOffset,a=this.projection.name==="globe",d=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=r.bl(1,this.center.lat)/r.bl(1,r.bI));let p=r.bA(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,p),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;let g=this.projection.zAxisUnit==="meters"?d:1,v=this._camera.getWorldToCamera(this.worldSize,g),k,S=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(S[8]=2*-n.x/this.width,S[9]=2*n.y/this.height,this.isOrthographic){let ae=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),ce=ae*this.aspect,be=-ce,ue=-ae;ce-=n.x,be-=n.x,ae+=n.y,ue+=n.y,k=this._camera.getCameraToClipOrthographic(be,ce,ue,ae,this._nearZ,this._farZ),((Ie,Te,Be,pe)=>{for(let xe=0;xe<16;xe++)Ie[xe]=El(Te[xe],Be[xe],pe)})(k,k,S,Ac(this.pitch>=15?1:this.pitch/15))}else k=S;let E=r.a6.mul([],S,v),A=r.a6.mul([],k,v);if(this.projection.isReprojectedInTileSpace){let ae=this.locationCoordinate(this.center),ce=r.a6.identity([]);r.a6.translate(ce,ce,[ae.x*this.worldSize,ae.y*this.worldSize,0]),r.a6.multiply(ce,ce,r.bB(this)),r.a6.translate(ce,ce,[-ae.x*this.worldSize,-ae.y*this.worldSize,0]),r.a6.multiply(A,A,ce),r.a6.multiply(E,E,ce),this.inverseAdjustmentMatrix=r.bC(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=r.a6.scale([],A,[this.worldSize,this.worldSize,this.worldSize/g,1]),this.projMatrix=A,this.invProjMatrix=r.a6.invert(new Float64Array(16),this.projMatrix),a){let ae=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);ae[8]=2*-n.x/this.width,ae[9]=2*n.y/this.height,this.expandedFarZProjMatrix=r.a6.mul([],ae,v)}else this.expandedFarZProjMatrix=this.projMatrix;let P=r.a6.invert([],k);this.frustumCorners=r.bD.fromInvProjectionMatrix(P,this.horizonLineFromTop(),this.height),this.cameraFrustum=r.bq.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!a);let z=new Float32Array(16);r.a6.identity(z),r.a6.scale(z,z,[1,-1,1]),r.a6.rotateX(z,z,this._pitch),r.a6.rotateZ(z,z,this.angle);let O=r.a6.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=r.a6.clone(O);let U=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;O[8]=2*-n.x/this.width,O[9]=2*(n.y+U)/this.height,this.skyboxMatrix=r.a6.multiply(z,O,z);let V=this.point,G=V.x,N=V.y,H=this.width%2/2,Q=this.height%2/2,W=Math.cos(this.angle),J=Math.sin(this.angle),$=G-Math.round(G)+W*H+J*Q,ee=N-Math.round(N)+W*Q+J*H,oe=new Float64Array(A);if(r.a6.translate(oe,oe,[$>.5?$-1:$,ee>.5?ee-1:ee,0]),this.alignedProjMatrix=oe,A=r.a6.create(),r.a6.scale(A,A,[this.width/2,-this.height/2,1]),r.a6.translate(A,A,[1,-1,0]),this.labelPlaneMatrix=A,A=r.a6.create(),r.a6.scale(A,A,[1,-1,1]),r.a6.translate(A,A,[-1,-1,0]),r.a6.scale(A,A,[2/this.width,2/this.height,1]),this.glCoordMatrix=A,this.pixelMatrix=r.a6.multiply(new Float64Array(16),this.labelPlaneMatrix,E),this._calcFogMatrices(),this._distanceTileDataCache={},A=r.a6.invert(new Float64Array(16),this.pixelMatrix),!A)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=A,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=r.bE(this);let ae=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=r.N.transformMat4(ae,ae,v),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=A;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};let n=this.cameraWorldSizeForFog,a=this.cameraPixelsPerMeter,d=this._camera.position,p=1/this.height/this._pixelsPerMercatorPixel,g=[n,n,a];r.N.scale(g,g,p),r.N.scale(d,d,-1),r.N.multiply(d,d,g);let v=r.a6.create();r.a6.translate(v,v,d),r.a6.scale(v,v,g),this.mercatorFogMatrix=v,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,a,p)}_computeCameraPosition(n){let a=(n=n||this.pixelsPerMeter)/this.pixelsPerMeter,d=this._camera.forward(),p=this.point,g=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*a-n/this.worldSize*this._centerAltitude;return[p.x/this.worldSize-d[0]*g,p.y/this.worldSize-d[1]*g,n/this.worldSize*this._centerAltitude-d[2]*g]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(n){let a=this._maxCameraBoundsDistance()*Math.cos(this._pitch),d=this._camera.position[2],p=n[2],g=1;this.projection.wrap&&(this.center=this.center.wrap()),p>0&&(g=Math.min((a-d)/p,1)),this._camera.position=r.N.scaleAndAdd([],this._camera.position,n,g),this._updateStateFromCamera()}_updateStateFromCamera(){let n=this._camera.position,a=this._camera.forward(),{pitch:d,bearing:p}=this._camera.getPitchBearing(),g=r.bl(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,v=this._mercatorZfromZoom(this._maxZoom)*Math.cos(r.bj(this._maxPitch)),k=Math.max((n[2]-g)/Math.cos(d),v),S=this._zoomFromMercatorZ(k);r.N.scaleAndAdd(n,n,a,k),this._pitch=r.aa(d,r.bj(this.minPitch),r.bj(this.maxPitch)),this.angle=r.bh(p,-Math.PI,Math.PI),this._setZoom(r.aa(S,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new r.L(n[0],n[1],n[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){let n=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(n*this.tileSize))}zoomFromMercatorZAdjusted(n){let a=0,d=r.bx,p=0,g=1/0;for(;d-a>1e-6&&d>a;){let v=a+.5*(d-a),k=this.tileSize*Math.pow(2,v),S=this.getCameraToCenterDistance(this.projection,v,k),E=this.scaleZoom(S/(n*this.tileSize)),A=Math.abs(v-E);A<g&&(g=A,p=v),v<E?a=v:d=v}return p}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(r.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(n,a){let d=Math.min(n.x,a.x),p=Math.max(n.x,a.x),g=Math.min(n.y,a.y),v=Math.max(n.y,a.y);if(g<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;let k=[new r.P(d,g),new r.P(p,v),new r.P(d,v),new r.P(p,g)],S=this.renderWorldCopies?-3:0,E=this.renderWorldCopies?4:1;for(let A of k){let P=this.pointRayIntersection(A);if(P.t<0)return!0;let z=this.rayIntersectionCoordinate(P);if(z.x<S||z.y<0||z.x>E||z.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+r.bF(this.fovAboveCenter)>88||this.anyCornerOffEdge(new r.P(0,0),new r.P(this.width,this.height))}zoomDeltaToMovement(n,a){let d=r.N.length(r.N.sub([],this._camera.position,n)),p=this._zoomFromMercatorZ(d)+a;return d-this._mercatorZfromZoom(p)}getCameraPoint(){if(this.projection.name==="globe"){let n=function([a,d,p],g){let v=[a,d,p,1];r.a7.transformMat4(v,v,g);let k=v[3]=Math.max(v[3],1e-6);return v[0]/=k,v[1]/=k,v[2]/=k,v}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new r.P(n[0],n[1])}{let n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new r.P(0,n))}}getCameraToCenterDistance(n,a=this.zoom,d=this.worldSize){let p=r.bA(n,a,this.width,this.height,1024),g=n.pixelSpaceConversion(this.center.lat,d,p),v=.5/Math.tan(.5*this._fov)*this.height*g;return this.isOrthographic&&(v=El(1,v,Ac(this.pitch>=15?1:this.pitch/15))),v}getWorldToCameraMatrix(){let n=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&r.a6.multiply(n,n,this.globeMatrix),n}getFrustum(n){return r.bq.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n,this.projection.zAxisUnit==="meters")}}let Ir={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,ShadowMap0:10},as=(c,n)=>{if(n>0&&c.terrain&&r.w("Cutoff is currently disabled on terrain"),n<=0||c.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};let a=c.transform,d=Math.max(Math.abs(a._zoom-(c.minCutoffZoom-1)),1),p=a.isLODDisabled(!1)?r.O(60,45,a.pitch):r.O(30,15,a.pitch),g=a._farZ-a._nearZ,v=n*a.height,k=((1-(S=p))*a.cameraToCenterDistance+S*(a._farZ+v))*d;var S;return{shouldRenderCutoff:p<1,uniformValues:{u_cutoff_params:[a._nearZ,a._farZ,(k-a._nearZ)/g,(k-v-a._nearZ)/g]}}},Wr={cascadeCount:2,shadowMapResolution:2048};class Lu{constructor(n,a){this.aabb=n,this.lastCascade=a}}class yf{add(n,a){let d=this.receivers[n.key];d!==void 0?(d.aabb.min[0]=Math.min(d.aabb.min[0],a.min[0]),d.aabb.min[1]=Math.min(d.aabb.min[1],a.min[1]),d.aabb.min[2]=Math.min(d.aabb.min[2],a.min[2]),d.aabb.max[0]=Math.max(d.aabb.max[0],a.max[0]),d.aabb.max[1]=Math.max(d.aabb.max[1],a.max[1]),d.aabb.max[2]=Math.max(d.aabb.max[2],a.max[2])):this.receivers[n.key]=new Lu(a,null)}clear(){this.receivers={}}get(n){return this.receivers[n.key]}computeRequiredCascades(n,a,d){let p=r.bS.fromPoints(n.points),g=0;for(let v in this.receivers){let k=this.receivers[v];if(!k||!p.intersectsAabb(k.aabb))continue;k.aabb.min=p.closestPoint(k.aabb.min),k.aabb.max=p.closestPoint(k.aabb.max);let S=k.aabb.getCorners();for(let E=0;E<d.length;E++){let A=!0;for(let P of S){let z=[P[0]*a,P[1]*a,P[2]];if(r.N.transformMat4(z,z,d[E].matrix),z[0]<-1||z[0]>1||z[1]<-1||z[1]>1){A=!1;break}}if(k.lastCascade=E,g=Math.max(g,E),A)break}}return g+1}}class zu{constructor(n){this.painter=n,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new yf,this._depthMode=new Rt(n.context.gl.LEQUAL,Rt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this.useNormalOffset=!1,n.tp.registerParameter(Wr,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),n.tp.registerParameter(Wr,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32})}destroy(){for(let n of this._cascades)n.texture.destroy(),n.framebuffer.destroy();this._cascades=[]}updateShadowParameters(n,a){let d=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!a||!a.properties)return;let p=a.properties.get("shadow-intensity");if(!a.shadowsEnabled()||p<=0||(this._shadowLayerCount=d.style.order.reduce((U,V)=>{let G=d.style._mergedLayers[V];return U+(G.hasShadowPass()&&!G.isHidden(n.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this._enabled))return;let g=d.context,v=Wr.shadowMapResolution,k=Wr.shadowMapResolution;if(this._cascades.length===0||Wr.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let U=0;U<Wr.cascadeCount;++U){let V=d._shadowMapDebug,G=g.gl,N=g.createFramebuffer(v,k,V,"texture"),H=new r.T(g,{width:v,height:k,data:null},G.DEPTH_COMPONENT);if(N.depthAttachment.set(H.texture),V){let Q=new r.T(g,{width:v,height:k,data:null},G.RGBA);N.colorAttachment.set(Q.texture)}this._cascades.push({framebuffer:N,texture:H,matrix:[],far:0,boundingSphereRadius:0,frustum:new r.bq,scale:0})}}this.shadowDirection=jd(a);let S=0;if(n.elevation){let U=n.elevation,V=[1e4,-1e4];U.visibleDemTiles.filter(G=>G.dem).forEach(G=>{let N=G.dem.tree;V[0]=Math.min(V[0],N.minimums[0]),V[1]=Math.max(V[1],N.maximums[0])}),V[0]!==1e4&&(S=(V[1]-V[0])*U.exaggeration())}let E=1.5*n.cameraToCenterDistance,A=3*E,P=new Float64Array(16);for(let U=0;U<this._cascades.length;++U){let V=this._cascades[U],G=n.height/50,N=1;Wr.cascadeCount===1?N=A:U===0?N=E:(G=E,N=A);let[H,Q]=bf(n,this.shadowDirection,G,N,Wr.shadowMapResolution,S);V.scale=n.scale,V.matrix=H,V.boundingSphereRadius=Q,r.a6.invert(P,V.matrix),V.frustum=r.bq.fromInvProjectionMatrix(P,1,0,!0),V.far=N}let z=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[z].far,this._cascades[z].far],this._uniformValues.u_shadow_intensity=p,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Wr.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Wr.shadowMapResolution,this._uniformValues.u_shadowmap_0=Ir.ShadowMap0,this._uniformValues.u_shadowmap_1=Ir.ShadowMap0+1,this._groundShadowTiles=d.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});let O=d.transform.elevation;for(let U of this._groundShadowTiles){let V={min:0,max:0};if(O){let G=O.getMinMaxForTile(U);G&&(V=G)}this.addShadowReceiver(U.toUnwrapped(),V.min,V.max)}}get enabled(){return this._enabled}set enabled(n){this._enabled=n}drawShadowPass(n,a){if(!this._enabled)return;let d=this.painter,p=d.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(d.transform.getFrustum(0),d.transform.worldSize,this._cascades),p.viewport.set([0,0,Wr.shadowMapResolution,Wr.shadowMapResolution]);for(let g=0;g<this._numCascadesToRender;++g){d.currentShadowCascade=g,p.bindFramebuffer.set(this._cascades[g].framebuffer.framebuffer),p.clear({color:r.ax.white,depth:1});for(let v of n.order){let k=n._mergedLayers[v];if(!k.hasShadowPass()||k.isHidden(d.transform.zoom))continue;let S=n.getLayerSourceCache(k),E=S?a[S.id]:void 0;(k.type==="model"||E&&E.length)&&d.renderLayer(d,S,k,E)}}d.currentShadowCascade=0}drawGroundShadows(){if(!this._enabled)return;let n=this.painter,a=n.style,d=n.context,p=a.directionalLight,g=a.ambientLight;if(!p||!g)return;let v=[],k=as(n,n.longestCutoffRange);k.shouldRenderCutoff&&v.push("RENDER_CUTOFF");let S=Pc(p,g),E=new Rt(d.gl.LEQUAL,Rt.ReadOnly,n.depthRangeFor3D);for(let A of this._groundShadowTiles){let P=A.toUnwrapped(),z=n.isTileAffectedByFog(A),O=n.getOrCreateProgram("groundShadow",{defines:v,overrideFog:z});this.setupShadows(P,O),n.uploadCommonUniforms(d,O,P,null,k);let U={u_matrix:n.transform.calculateProjMatrix(P),u_ground_shadow_factor:S};O.draw(n,d.gl.TRIANGLES,E,jt.disabled,ri.multiply,Lt.disabled,U,"ground_shadow",n.tileExtentBuffer,n.quadTriangleIndexBuffer,n.tileExtentSegments,{},n.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?ri.unblended:ri.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(n){let a=this.painter.transform,d=a.calculatePosMatrix(n,a.worldSize);return r.a6.multiply(d,this._cascades[this.painter.currentShadowCascade].matrix,d),Float32Array.from(d)}calculateShadowPassMatrixFromMatrix(n){return r.a6.multiply(n,this._cascades[this.painter.currentShadowCascade].matrix,n),Float32Array.from(n)}setupShadows(n,a,d,p=0){if(!this._enabled)return;let g=this.painter.transform,v=this.painter.context,k=v.gl,S=this._uniformValues,E=new Float64Array(16),A=g.calculatePosMatrix(n,g.worldSize);for(let P=0;P<this._cascades.length;P++)r.a6.multiply(E,this._cascades[P].matrix,A),S[P===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(E),v.activeTexture.set(k.TEXTURE0+Ir.ShadowMap0+P),this._cascades[P].texture.bind(k.NEAREST,k.CLAMP_TO_EDGE);if(this.useNormalOffset=!!d,this.useNormalOffset){let P=r.bR(n.canonical),z=2/g.tileSize*r.V/Wr.shadowMapResolution,O=z*this._cascades[0].boundingSphereRadius,U=z*this._cascades[this._cascades.length-1].boundingSphereRadius,V=(d==="vector-tile"?1:3)/Math.pow(2,p-n.canonical.z-(1-g.zoom+Math.floor(g.zoom)));S.u_shadow_normal_offset=[P,O*V,U*V],S.u_shadow_bias=[6e-5,.0012,.012]}else S.u_shadow_bias=[36e-5,.0012,.012];a.setShadowUniformValues(v,S)}setupShadowsFromMatrix(n,a,d=!1){if(!this._enabled)return;let p=this.painter.context,g=p.gl,v=this._uniformValues,k=new Float64Array(16);for(let S=0;S<Wr.cascadeCount;S++)r.a6.multiply(k,this._cascades[S].matrix,n),v[S===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(k),p.activeTexture.set(g.TEXTURE0+Ir.ShadowMap0+S),this._cascades[S].texture.bind(g.NEAREST,g.CLAMP_TO_EDGE);this.useNormalOffset=d,d?(v.u_shadow_normal_offset=[1,5,5],v.u_shadow_bias=[6e-5,.0012,.012]):v.u_shadow_bias=[36e-5,.0012,.012],a.setShadowUniformValues(p,v)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(n,a,d,p){if(p[2]>=0)return{};let g=function(S,E,A){let P=A/(1<<S.canonical.z);return new r.bS([S.canonical.x*P+S.wrap*A,S.canonical.y*P+S.wrap*A,0],[(S.canonical.x+1)*P+S.wrap*A,(S.canonical.y+1)*P+S.wrap*A,E])}(n,a,d).getCorners(),v=a/-p[2];p[0]<0?(r.N.add(g[0],g[0],[p[0]*v,0,0]),r.N.add(g[3],g[3],[p[0]*v,0,0])):p[0]>0&&(r.N.add(g[1],g[1],[p[0]*v,0,0]),r.N.add(g[2],g[2],[p[0]*v,0,0])),p[1]<0?(r.N.add(g[0],g[0],[0,p[1]*v,0]),r.N.add(g[1],g[1],[0,p[1]*v,0])):p[1]>0&&(r.N.add(g[2],g[2],[0,p[1]*v,0]),r.N.add(g[3],g[3],[0,p[1]*v,0]));let k={};return k.vertices=g,k.planes=[Hs(g[1],g[0],g[4]),Hs(g[2],g[1],g[5]),Hs(g[3],g[2],g[6]),Hs(g[0],g[3],g[7])],k}addShadowReceiver(n,a,d){this._receivers.add(n,r.bS.fromTileIdAndHeight(n,a,d))}getMaxCascadeForTile(n){let a=this._receivers.get(n);return a&&a.lastCascade?a.lastCascade:0}}function Hs(c,n,a){let d=r.N.sub([],a,n),p=r.N.sub([],c,n),g=r.N.cross([],d,p),v=r.N.length(g);return v===0?[0,0,1,0]:(r.N.scale(g,g,1/v),[g[0],g[1],g[2],-r.N.dot(g,n)])}function jd(c){let n=c.properties.get("direction"),a=r.bQ(n.x,n.y,n.z);a[2]=r.aa(a[2],0,75);let d=r.bT([a[0],a[1],a[2]]);return r.N.fromValues(d.x,d.y,d.z)}function Pc(c,n){let a=c.properties.get("color"),d=c.properties.get("intensity"),p=c.properties.get("direction"),g=[p.x,p.y,p.z],v=n.properties.get("color"),k=n.properties.get("intensity"),S=Math.max(r.N.dot([0,0,1],g),0),E=[0,0,0];r.N.scale(E,v.toArray01Linear().slice(0,3),k);let A=[0,0,0];return r.N.scale(A,a.toArray01Linear().slice(0,3),S*d),r.bU([E[0]>0?E[0]/(E[0]+A[0]):0,E[1]>0?E[1]/(E[1]+A[1]):0,E[2]>0?E[2]/(E[2]+A[2]):0])}function bf(c,n,a,d,p,g){let v=c.zoom,k=c.scale,S=c.worldSize,E=1/S,A=c.aspect,P=Math.sqrt(1+A*A)*Math.tan(.5*c.fovX),z=P*P,O=d-a,U=d+a,V,G;z>O/U?(V=d,G=d*P):(V=.5*U*(1+z),G=.5*Math.sqrt(O*O+2*(d*d+a*a)*z+U*U*z*z));let N=c.projection.pixelsPerMeter(c.center.lat,S),H=c._camera.getCameraToWorldMercator(),Q=[0,0,-V*E];r.N.transformMat4(Q,Q,H);let W=G*E,J=c._edgeInsets;if(!(J.left===0&&J.top===0&&J.right===0&&J.bottom===0||J.left===J.right&&J.top===J.bottom)){let Ye=c._camera.getWorldToCamera(c.worldSize,c.projection.zAxisUnit==="meters"?N:1),We=c._camera.getCameraToClipPerspective(c._fov,c.width/c.height,a,d);We[8]=2*-c.centerOffset.x/c.width,We[9]=2*c.centerOffset.y/c.height;let rt=new Float64Array(16);r.a6.mul(rt,We,Ye);let _t=new Float64Array(16);r.a6.invert(_t,rt);let Et=r.bq.fromInvProjectionMatrix(_t,S,v,!0);for(let vt of Et.points){let Tt=(($=vt)[0]/=k,$[1]/=k,$[2]=r.bl($[2],c._center.lat),$);W=Math.max(W,r.N.len(r.N.subtract([],Q,Tt)))}}var $;W*=p/(p-1);let ee=Math.acos(n[2]),oe=Math.atan2(-n[0],-n[1]),ae=new Ml;ae.position=Q,ae.setPitchBearing(ee,oe);let ce=ae.getWorldToCamera(S,N),be=W*S,ue=Math.min(c._mercatorZfromZoom(17)*S*-2,-2*be),Ie=ae.getCameraToClipOrthographic(-be,be,-be,be,ue,(be+g*N)/n[2]),Te=new Float64Array(16);r.a6.multiply(Te,Ie,ce);let Be=r.N.fromValues(Math.floor(1e6*Q[0])/1e6*S,Math.floor(1e6*Q[1])/1e6*S,0),pe=.5*p,xe=[0,0,0];r.N.transformMat4(xe,Be,Te),r.N.scale(xe,xe,pe);let le=[Math.floor(xe[0]),Math.floor(xe[1]),Math.floor(xe[2])],ge=[0,0,0];r.N.sub(ge,xe,le),r.N.scale(ge,ge,-1/pe);let Ne=new Float64Array(16);return r.a6.identity(Ne),r.a6.translate(Ne,Ne,ge),r.a6.multiply(Te,Ne,Te),[Te,be]}let ss=(c,n)=>bt(c,n&&n.filter(a=>a.identifier!=="source.canvas")),vf=r.ac(gi,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),Al=r.ac(gi,["setCenter","setZoom","setBearing","setPitch"]),Ou={version:8,layers:[],sources:{}},xf={duration:300,delay:0},T0=new Set(["fill","line","background","hillshade","raster"]);class Ko extends r.E{constructor(n,a={}){super(),this.map=n,this.scope=a.scope||"",this.fragments=[],this.importDepth=a.importDepth||0,this.importsCache=a.importsCache||new Map,this.resolvedImports=a.resolvedImports||new Set,this.transition=r.e({},xf),this._buildingIndex=new hf(this),this.crossTileSymbolIndex=new Pu,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=a.styleChanges||new Rs,this.dispatcher=a.dispatcher?a.dispatcher:new r.bW(r.bX(),this),a.imageManager?this.imageManager=a.imageManager:(this.imageManager=new Sd,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=a.glyphManager?a.glyphManager:new r.bY(n._requestManager,a.localFontFamily?r.bZ.all:a.localIdeographFontFamily?r.bZ.ideographs:r.bZ.none,a.localFontFamily||a.localIdeographFontFamily),a.modelManager?this.modelManager=a.modelManager:(this.modelManager=new _c(n._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=a.configOptions?a.configOptions:new Map,this._configDependentLayers=a.configDependentLayers?a.configDependentLayers:new Set,this._config=a.config,this.dispatcher.broadcast("setReferrer",r.b_());let d=this;this._rtlTextPluginCallback=Ko.registerForPluginStateChange(p=>{d.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:p.pluginStatus,pluginURL:p.pluginURL},(g,v)=>{if(r.b$(g),v&&v.every(k=>k))for(let k in d._sourceCaches){let S=d._sourceCaches[k],E=S.getSource().type;E!=="vector"&&E!=="geojson"||S.reload()}})}),this.on("data",p=>{if(p.dataType!=="source"||p.sourceDataType!=="metadata")return;let g=this.getOwnSource(p.sourceId);if(g&&g.vectorLayerIds)for(let v in this._layers){let k=this._layers[v];k.source===g.id&&this._validateLayer(k)}})}loadURL(n,a={}){this.fire(new r.b("dataloading",{dataType:"style"}));let d=typeof a.validate=="boolean"?a.validate:!r.c0(n);n=this.map._requestManager.normalizeStyleURL(n,a.accessToken),this.resolvedImports.add(n);let p=this.importsCache.get(n);if(p)return this._load(p,d);let g=this.map._requestManager.transformRequest(n,r.R.Style);this._request=r.g(g,(v,k)=>{if(this._request=null,v)this.fire(new r.a(v));else if(k)return this.importsCache.set(n,k),this._load(k,d)})}loadJSON(n,a={}){this.fire(new r.b("dataloading",{dataType:"style"})),this._request=r.f.frame(()=>{this._request=null,this._load(n,a.validate!==!1)})}loadEmpty(){this.fire(new r.b("dataloading",{dataType:"style"})),this._load(Ou,!1)}_loadImports(n,a,d){if(this.importDepth>=4)return r.w("Style doesn't support nesting deeper than 5"),Promise.resolve();let p=[];for(let g of n){let v=this._createFragmentStyle(g),k=new Promise(A=>{v.once("style.import.load",A),v.once("error",A)}).then(()=>this.mergeAll());if(p.push(k),this.resolvedImports.has(g.url)){v.loadEmpty();continue}let S=g.data||this.importsCache.get(g.url);S?v.loadJSON(S,{validate:a}):g.url?v.loadURL(g.url,{validate:a}):v.loadEmpty();let E={style:v,id:g.id,config:g.config};if(d){let A=this.fragments.findIndex(({id:P})=>P===d);this.fragments=this.fragments.slice(0,A).concat(E).concat(this.fragments.slice(A))}else this.fragments.push(E)}return Promise.allSettled(p)}_createFragmentStyle(n){let a=this.scope?r.ag(n.id,this.scope):n.id,d=new Ko(this.map,{scope:a,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:n.config,configOptions:this.options,configDependentLayers:this._configDependentLayers});return d.setEventedParent(this.map,{style:d}),d}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});let n=this.isRootStyle();this._shouldPrecompile=n,this.fire(new r.b(n?"style.load":"style.import.load"))}_load(n,a){let d=n.schema;if(this.isRootStyle()&&(n.fragment||d&&n.fragment!==!1)){let v=r.e({},Ou,{imports:[{id:"basemap",data:n,url:""}]});return void this._load(v,a)}if(this.setConfig(this._config,d),a&&ss(this,Mo(n)))return;this._loaded=!0,this.stylesheet=r.c1(n);for(let v in n.sources)this.addSource(v,n.sources[v],{validate:!1,isInitialLoad:!0});n.sprite?this._loadSprite(n.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(n.glyphs,this.scope);let p=uf(this.stylesheet.layers);if(this._order=p.map(v=>v.id),this.stylesheet.light&&r.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){let v=this.stylesheet.lights[0];this.light=new xt(v.properties,v.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new xt(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(let v of p){let k=r.c2(v,this.scope,this.options);k.isConfigDependent&&this._configDependentLayers.add(k.fqid),k.setEventedParent(this,{layer:{id:k.id}}),this._layers[k.id]=k,this._serializedLayers[k.id]=k.serialize();let S=this.getOwnLayerSourceCache(k),E=!!this.directionalLight&&this.directionalLight.shadowsEnabled();S&&k.canCastShadows()&&E&&(S.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);let g=this.stylesheet.terrain;g&&(this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=r.f.hasCanvasFingerprintNoise()),this.disableElevatedTerrain?r.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."):this.terrainSetForDrapingOnly()||this._createTerrain(g,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new r.b("data",{dataType:"style"})),n.imports?this._loadImports(n.imports,a).then(()=>this._reloadImports()):this._reloadImports()}isRootStyle(){return this.importDepth===0}mergeAll(){let n,a,d,p,g,v,k,S;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(E=>{if(E.stylesheet){if(E.light!=null&&(n=E.light),E.stylesheet.lights)for(let A of E.stylesheet.lights)A.type==="ambient"&&E.ambientLight!=null&&(a=E.ambientLight),A.type==="directional"&&E.directionalLight!=null&&(d=E.directionalLight);p=this._prioritizeTerrain(p,E.terrain,E.stylesheet.terrain),E.stylesheet.fog&&E.fog!=null&&(g=E.fog),E.stylesheet.camera!=null&&(S=E.stylesheet.camera),E.stylesheet.projection!=null&&(v=E.stylesheet.projection),E.stylesheet.transition!=null&&(k=E.stylesheet.transition)}}),this.light=n,this.ambientLight=a,this.directionalLight=d,this.fog=g,p===null?delete this.terrain:this.terrain=p,this.camera=S||{"camera-projection":"perspective"},this.projection=v||{name:"mercator"},this.transition=r.e({},xf,k),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(n){let a=d=>{for(let p of d.fragments)a(p.style);n(d)};a(this)}_prioritizeTerrain(n,a,d){let p=n&&n.drapeRenderMode===0;return d===null?a&&a.drapeRenderMode===0?a:p?n:null:a!=null&&(!n||p||a&&a.drapeRenderMode===1)?a:n}mergeTerrain(){let n;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(a=>{n=this._prioritizeTerrain(n,a.terrain,a.stylesheet.terrain)}),n===null?delete this.terrain:this.terrain=n}mergeProjection(){let n;this.forEachFragmentStyle(a=>{a.stylesheet.projection!=null&&(n=a.stylesheet.projection)}),this.projection=n||{name:"mercator"}}mergeSources(){let n={},a={},d={};this.forEachFragmentStyle(p=>{for(let g in p._sourceCaches){let v=r.ag(g,p.scope);n[v]=p._sourceCaches[g]}for(let g in p._otherSourceCaches){let v=r.ag(g,p.scope);a[v]=p._otherSourceCaches[g]}for(let g in p._symbolSourceCaches){let v=r.ag(g,p.scope);d[v]=p._symbolSourceCaches[g]}}),this._mergedSourceCaches=n,this._mergedOtherSourceCaches=a,this._mergedSymbolSourceCaches=d}mergeLayers(){let n={},a=[],d={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(g=>{for(let v of g._order){let k=g._layers[v];if(k.type==="slot"){let S=r.c3(v);if(n[S])continue;n[S]=[]}k.slot&&n[k.slot]?n[k.slot].push(k):a.push(k)}}),this._mergedOrder=[];let p=(g=[])=>{for(let v of g)if(v.type==="slot"){let k=r.c3(v.id);n[k]&&p(n[k])}else{let k=r.ag(v.id,v.scope);this._mergedOrder.push(k),d[k]=v,v.is3D()&&(this._has3DLayers=!0),v.type==="circle"&&(this._hasCircleLayers=!0),v.type==="symbol"&&(this._hasSymbolLayers=!0)}};p(a),this._mergedLayers=d,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(n){return this.stylesheet.camera=r.e({},this.stylesheet.camera,n),this.camera=this.stylesheet.camera,this}setProjection(n){n?this.stylesheet.projection=n:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(n){this._spriteRequest=function(a,d,p){let g,v,k,S=r.f.devicePixelRatio>1?"@2x":"",E=r.g(d.transformRequest(d.normalizeSpriteURL(a,S,".json"),r.R.SpriteJSON),(z,O)=>{E=null,k||(k=z,g=O,P())}),A=r.d(d.transformRequest(d.normalizeSpriteURL(a,S,".png"),r.R.SpriteImage),(z,O)=>{A=null,k||(k=z,v=O,P())});function P(){if(k)p(k);else if(g&&v){let z=r.f.getImageData(v),O={};for(let U in g){let{width:V,height:G,x:N,y:H,sdf:Q,pixelRatio:W,stretchX:J,stretchY:$,content:ee}=g[U],oe=new r.h({width:V,height:G});r.h.copy(z,oe,{x:N,y:H},{x:0,y:0},{width:V,height:G}),O[U]={data:oe,pixelRatio:W,sdf:Q,stretchX:J,stretchY:$,content:ee}}p(null,O)}}return{cancel(){E&&(E.cancel(),E=null),A&&(A.cancel(),A=null)}}}(n,this.map._requestManager,(a,d)=>{if(this._spriteRequest=null,a)this.fire(new r.a(a));else if(d)for(let p in d)this.imageManager.addImage(p,this.scope,d[p]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.b("data",{dataType:"style"}))})}_validateLayer(n){let a=this.getOwnSource(n.source);if(!a)return;let d=n.sourceLayer;d&&(a.type==="geojson"||a.vectorLayerIds&&a.vectorLayerIds.indexOf(d)===-1)&&this.fire(new r.a(new Error(`Source layer "${d}" does not exist on source "${a.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(let n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded())return!1;for(let{style:n}of this.fragments)if(!n.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((n,a)=>{let d=this.fragments[a];return d&&d.style&&(n.data=d.style.serialize()),n})}_serializeSources(){let n={};for(let a in this._sourceCaches){let d=this._sourceCaches[a].getSource();n[d.id]||(n[d.id]=d.serialize())}return n}_serializeLayers(n){let a=[];for(let d of n){let p=this._layers[d];p&&p.type!=="custom"&&a.push(p.serialize())}return a}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(let n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(let n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(n){return!!this.terrain&&(typeof n.isLayerDraped=="function"?n.isLayerDraped(this.getLayerSourceCache(n)):T0.has(n.type))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(n){let a=this.getOwnLayer(n);if(a)return a;this.fire(new r.a(new Error(`The layer '${n}' does not exist in the map's style.`)))}_checkSource(n){let a=this.getOwnSource(n);if(a)return a;this.fire(new r.a(new Error(`The source '${n}' does not exist in the map's style.`)))}update(n){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(n),this.directionalLight&&this.directionalLight.recalculate(n);let a=this.calculateLightsBrightness();n.brightness=a||0,a!==this._brightness&&(this._brightness=a,this.dispatcher.broadcast("setBrightness",a));let d=this._changes.isDirty();if(this._changes.isDirty()){let g=this._changes.getLayerUpdatesByScope();for(let v in g){let{updatedIds:k,removedIds:S}=g[v];(k||S)&&this._updateWorkerLayers(v,k,S)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(n),this.light&&this.light.updateTransitions(n),this.ambientLight&&this.ambientLight.updateTransitions(n),this.directionalLight&&this.directionalLight.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this._changes.reset()}let p={};for(let g in this._mergedSourceCaches){let v=this._mergedSourceCaches[g];p[g]=v.used,v.used=!1,v.tileCoverLift=0}for(let g of this._mergedOrder){let v=this._mergedLayers[g];if(v.recalculate(n,this._availableImages),!v.isHidden(n.zoom)){let k=this.getLayerSourceCache(v);k&&(k.used=!0,k.tileCoverLift=Math.max(k.tileCoverLift,v.tileCoverLift()))}if(!this._precompileDone&&this._shouldPrecompile)for(let k=v.minzoom||0;k<(v.maxzoom||25.5);k++){let S=this.map.painter;if(S){let E=v.getProgramIds();if(!E)continue;for(let A of E){let P=v.getDefaultProgramParams(A,n.zoom);P&&(S.style=this,this.fog&&(S._fogVisible=!0,P.overrideFog=!0,S.getOrCreateProgram(A,P)),S._fogVisible=!1,P.overrideFog=!1,S.getOrCreateProgram(A,P),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(P.overrideRtt=!0,S.getOrCreateProgram(A,P)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(let g in p){let v=this._mergedSourceCaches[g];p[g]!==v.used&&v.getSource().fire(new r.b("data",{sourceDataType:"visibility",dataType:"source",sourceId:v.getSource().id}))}this.light&&this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),d&&this.fire(new r.b("data",{dataType:"style"}))}_updateTilesForChangedImages(){let n=this._changes.getUpdatedImages();if(n.length){for(let a in this._sourceCaches)this._sourceCaches[a].reloadTilesForDependencies(["icons","patterns"],n);this._changes.resetUpdatedImages()}}_updateWorkerLayers(n,a,d){let p=this.getFragmentStyle(n);p&&this.dispatcher.broadcast("updateLayers",{layers:a?p._serializeLayers(a):[],scope:n,removedIds:d||[],options:p.options})}setState(n){if(this._checkLoaded(),ss(this,Mo(n)))return!1;(n=r.c1(n)).layers=uf(n.layers);let a=function(p,g){if(!p)return[{command:gi.setStyle,args:[g]}];let v=[];try{if(!M(p.version,g.version))return[{command:gi.setStyle,args:[g]}];M(p.center,g.center)||v.push({command:gi.setCenter,args:[g.center]}),M(p.zoom,g.zoom)||v.push({command:gi.setZoom,args:[g.zoom]}),M(p.bearing,g.bearing)||v.push({command:gi.setBearing,args:[g.bearing]}),M(p.pitch,g.pitch)||v.push({command:gi.setPitch,args:[g.pitch]}),M(p.sprite,g.sprite)||v.push({command:gi.setSprite,args:[g.sprite]}),M(p.glyphs,g.glyphs)||v.push({command:gi.setGlyphs,args:[g.glyphs]}),M(p.imports,g.imports)||function(P=[],z=[],O){z=z||[];let U=(P=P||[]).map(is),V=z.map(is),G=P.reduce(Rd,{}),N=z.reduce(Rd,{}),H=U.slice(),Q,W,J,$;for(Q=0,W=0;Q<U.length;Q++)J=U[Q],N.hasOwnProperty(J)?W++:(O.push({command:gi.removeImport,args:[J]}),H.splice(H.indexOf(J,W),1));for(Q=0,W=0;Q<V.length;Q++)J=V[V.length-1-Q],H[H.length-1-Q]!==J&&(G.hasOwnProperty(J)?(O.push({command:gi.removeImport,args:[J]}),H.splice(H.lastIndexOf(J,H.length-W),1)):W++,$=H[H.length-Q],O.push({command:gi.addImport,args:[N[J],$]}),H.splice(H.length-Q,0,J));for(let ee of z){let oe=G[ee.id];oe&&!M(oe,ee)&&O.push({command:gi.updateImport,args:[ee.id,ee]})}}(p.imports,g.imports,v),M(p.transition,g.transition)||v.push({command:gi.setTransition,args:[g.transition]}),M(p.light,g.light)||v.push({command:gi.setLight,args:[g.light]}),M(p.fog,g.fog)||v.push({command:gi.setFog,args:[g.fog]}),M(p.projection,g.projection)||v.push({command:gi.setProjection,args:[g.projection]}),M(p.lights,g.lights)||v.push({command:gi.setLights,args:[g.lights]}),M(p.camera,g.camera)||v.push({command:gi.setCamera,args:[g.camera]});let k={},S=[];(function(P,z,O,U){let V;for(V in z=z||{},P=P||{})P.hasOwnProperty(V)&&(z.hasOwnProperty(V)||fu(V,O,U));for(V in z){if(!z.hasOwnProperty(V))continue;let G=z[V];P.hasOwnProperty(V)?M(P[V],G)||(P[V].type==="geojson"&&G.type==="geojson"&&_0(P,z,V)?O.push({command:gi.setGeoJSONSourceData,args:[V,G.data]}):f0(V,z,O,U)):Tc(V,z,O)}})(p.sources,g.sources,S,k);let E=[];p.layers&&p.layers.forEach(P=>{P.source&&k[P.source]?v.push({command:gi.removeLayer,args:[P.id]}):E.push(P)});let A=p.terrain;A&&k[A.source]&&(v.push({command:gi.setTerrain,args:[void 0]}),A=void 0),v=v.concat(S),M(A,g.terrain)||v.push({command:gi.setTerrain,args:[g.terrain]}),function(P,z,O){z=z||[];let U=(P=P||[]).map(is),V=z.map(is),G=P.reduce(Rd,{}),N=z.reduce(Rd,{}),H=U.slice(),Q=Object.create(null),W,J,$,ee,oe,ae,ce;for(W=0,J=0;W<U.length;W++)$=U[W],N.hasOwnProperty($)?J++:(O.push({command:gi.removeLayer,args:[$]}),H.splice(H.indexOf($,J),1));for(W=0,J=0;W<V.length;W++)$=V[V.length-1-W],H[H.length-1-W]!==$&&(G.hasOwnProperty($)?(O.push({command:gi.removeLayer,args:[$]}),H.splice(H.lastIndexOf($,H.length-J),1)):J++,ae=H[H.length-W],O.push({command:gi.addLayer,args:[N[$],ae]}),H.splice(H.length-W,0,$),Q[$]=!0);for(W=0;W<V.length;W++)if($=V[W],ee=G[$],oe=N[$],!Q[$]&&!M(ee,oe))if(M(ee.source,oe.source)&&M(ee["source-layer"],oe["source-layer"])&&M(ee.type,oe.type)){for(ce in ts(ee.layout,oe.layout,O,$,null,gi.setLayoutProperty),ts(ee.paint,oe.paint,O,$,null,gi.setPaintProperty),M(ee.slot,oe.slot)||O.push({command:gi.setSlot,args:[$,oe.slot]}),M(ee.filter,oe.filter)||O.push({command:gi.setFilter,args:[$,oe.filter]}),M(ee.minzoom,oe.minzoom)&&M(ee.maxzoom,oe.maxzoom)||O.push({command:gi.setLayerZoomRange,args:[$,oe.minzoom,oe.maxzoom]}),ee)ee.hasOwnProperty(ce)&&ce!=="layout"&&ce!=="paint"&&ce!=="filter"&&ce!=="metadata"&&ce!=="minzoom"&&ce!=="maxzoom"&&ce!=="slot"&&(ce.indexOf("paint.")===0?ts(ee[ce],oe[ce],O,$,ce.slice(6),gi.setPaintProperty):M(ee[ce],oe[ce])||O.push({command:gi.setLayerProperty,args:[$,ce,oe[ce]]}));for(ce in oe)oe.hasOwnProperty(ce)&&!ee.hasOwnProperty(ce)&&ce!=="layout"&&ce!=="paint"&&ce!=="filter"&&ce!=="metadata"&&ce!=="minzoom"&&ce!=="maxzoom"&&ce!=="slot"&&(ce.indexOf("paint.")===0?ts(ee[ce],oe[ce],O,$,ce.slice(6),gi.setPaintProperty):M(ee[ce],oe[ce])||O.push({command:gi.setLayerProperty,args:[$,ce,oe[ce]]}))}else O.push({command:gi.removeLayer,args:[$]}),ae=H[H.lastIndexOf($)+1],O.push({command:gi.addLayer,args:[oe,ae]})}(E,g.layers,v)}catch(k){console.warn("Unable to compute style diff:",k),v=[{command:gi.setStyle,args:[g]}]}return v}(this.serialize(),n).filter(p=>!(p.command in Al));if(a.length===0)return!1;let d=a.filter(p=>!(p.command in vf));if(d.length>0)throw new Error(`Unimplemented: ${d.map(p=>p.command).join(", ")}.`);return a.forEach(p=>{this[p.command].apply(this,p.args)}),this.stylesheet=n,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(n,a){return this.getImage(n)?this.fire(new r.a(new Error("An image with this name already exists."))):(this.imageManager.addImage(n,this.scope,a),this._afterImageUpdated(n),this)}updateImage(n,a){this.imageManager.updateImage(n,this.scope,a)}getImage(n){return this.imageManager.getImage(n,this.scope)}removeImage(n){return this.getImage(n)?(this.imageManager.removeImage(n,this.scope),this._afterImageUpdated(n),this):this.fire(new r.a(new Error("No image with this name exists.")))}_afterImageUpdated(n){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(n),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new r.b("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(n,a,d={}){return this._checkLoaded(),this._validate(gt,`models.${n}`,a,null,d)||(this.modelManager.addModel(n,a,this.scope),this._changes.setDirty()),this}hasModel(n){return this.modelManager.hasModel(n,this.scope)}removeModel(n){return this.hasModel(n)?(this.modelManager.removeModel(n,this.scope),this):this.fire(new r.a(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(n,a,d={}){if(this._checkLoaded(),this.getOwnSource(n)!==void 0)throw new Error(`There is already a source with ID "${n}".`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(Ca,`sources.${n}`,a,null,d))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);let p=er(n,a,this.dispatcher,this);p.scope=this.scope,p.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(p.id),source:p.serialize(),sourceId:p.id}));let g=v=>{let k=(v?"symbol:":"other:")+p.id,S=r.ag(k,this.scope),E=this._sourceCaches[k]=new Xo(S,p,v);(v?this._symbolSourceCaches:this._otherSourceCaches)[p.id]=E,E.onAdd(this.map)};g(!1),a.type!=="vector"&&a.type!=="geojson"||g(!0),p.onAdd&&p.onAdd(this.map),d.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(n){this._checkLoaded();let a=this.getOwnSource(n);if(!a)throw new Error("There is no source with this ID");for(let p in this._layers)if(this._layers[p].source===n)return this.fire(new r.a(new Error(`Source "${n}" cannot be removed while layer "${p}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===n)return this.fire(new r.a(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));let d=this.getOwnSourceCaches(n);for(let p of d){let g=r.c3(p.id);delete this._sourceCaches[g],this._changes.discardSourceCacheUpdate(p.id),p.fire(new r.b("data",{sourceDataType:"metadata",dataType:"source",sourceId:p.getSource().id})),p.setEventedParent(null),p.clearTiles()}return delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],this.mergeSources(),a.setEventedParent(null),a.onRemove&&a.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(n,a){this._checkLoaded(),this.getOwnSource(n).setData(a),this._changes.setDirty()}getOwnSource(n){let a=this.getOwnSourceCache(n);return a&&a.getSource()}getOwnSources(){let n=[];for(let a in this._otherSourceCaches){let d=this.getOwnSourceCache(a);d&&n.push(d.getSource())}return n}areTilesLoaded(){let n=this._mergedSourceCaches;for(let a in n){let d=n[a]._tiles;for(let p in d){let g=d[p];if(g.state!=="loaded"&&g.state!=="errored")return!1}}return!0}setLights(n){if(this._checkLoaded(),!n)return delete this.ambientLight,void delete this.directionalLight;let a=this._getTransitionParameters();for(let p of n){if(this._validate(Le,"lights",p))return;switch(p.type){case"ambient":if(this.ambientLight){let g=this.ambientLight;g.set(p),g.updateTransitions(a)}else this.ambientLight=new Br(p,to,this.scope,this.options);break;case"directional":if(this.directionalLight){let g=this.directionalLight;g.set(p),g.updateTransitions(a)}else this.directionalLight=new Br(p,Kn,this.scope,this.options)}}let d=new r.K(this.z||0,a);this.ambientLight&&this.ambientLight.recalculate(d),this.directionalLight&&this.directionalLight.recalculate(d),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){let n=this.directionalLight,a=this.ambientLight;if(!n||!a)return;let d=P=>.2126*(P[0]<=.03928?P[0]/12.92:Math.pow((P[0]+.055)/1.055,2.4))+.7152*(P[1]<=.03928?P[1]/12.92:Math.pow((P[1]+.055)/1.055,2.4))+.0722*(P[2]<=.03928?P[2]/12.92:Math.pow((P[2]+.055)/1.055,2.4)),p=n.properties.get("color").toArray01(),g=n.properties.get("intensity"),v=n.properties.get("direction"),k=1-r.bQ(v.x,v.y,v.z)[2]/90,S=d(p)*g*k,E=a.properties.get("color").toArray01(),A=a.properties.get("intensity");return(S+d(E)*A)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;let n=[];return this.directionalLight&&n.push(this.directionalLight.get()),this.ambientLight&&n.push(this.ambientLight.get()),n}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(n){if(!n)return this;if(r.c4(n)){let a=r.c5(n),d=this.fragments.find(({id:g})=>g===a);if(!d)throw new Error(`Style import not found: ${n}`);let p=r.c3(n);return d.style.getFragmentStyle(p)}{let a=this.fragments.find(({id:d})=>d===n);if(!a)throw new Error(`Style import not found: ${n}`);return a.style}}getConfigProperty(n,a){let d=this.getFragmentStyle(n);if(!d)return null;let p=r.ag(a,d.scope),g=d.options.get(p),v=g?g.value||g.default:null;return v?v.serialize():null}setConfigProperty(n,a,d){let p=r.r(d);if(p.result!=="success")return void ss(this,p.value);let g=p.value.expression,v=this.getFragmentStyle(n);if(!v)return;let k=r.ag(a,v.scope),S=v.options.get(k);S&&(this.options.set(k,sr(It({},S),{value:g})),this.updateConfigDependencies())}setConfig(n,a){if(this._config=n,n||a)if(a)for(let d in a){let p,g,v=r.r(a[d].default);if(v.result==="success"&&(p=v.value.expression),n&&n[d]!==void 0){let z=r.r(n[d]);z.result==="success"&&(g=z.value.expression)}let{minValue:k,maxValue:S,stepValue:E,type:A,values:P}=a[d];if(p){let z=r.ag(d,this.scope);this.options.set(z,{default:p,value:g,minValue:k,maxValue:S,stepValue:E,type:A,values:P})}else this.fire(new r.a(new Error(`No schema defined for config option "${d}".`)))}else this.fire(new r.a(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(let n of this._configDependentLayers){let a=this.getLayer(n);a&&(a.possiblyEvaluateVisibility(),this._updateLayer(a))}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this._changes.setDirty()}addLayer(n,a,d={}){this._checkLoaded();let p=n.id;if(this._layers[p])return void this.fire(new r.a(new Error(`Layer with id "${p}" already exists on this map`)));let g;if(n.type==="custom"){if(ss(this,r.c6(n)))return;g=r.c2(n,this.scope,this.options)}else{if(typeof n.source=="object"&&(this.addSource(p,n.source),n=r.c1(n),n=r.e(n,{source:p})),this._validate(de,`layers.${p}`,n,{arrayIndex:-1},d))return;g=r.c2(n,this.scope,this.options),this._validateLayer(g),g.setEventedParent(this,{layer:{id:p}}),this._serializedLayers[g.id]=g.serialize()}g.isConfigDependent&&this._configDependentLayers.add(g.fqid);let v=this._order.length;if(a){let A=this._order.indexOf(a);if(A===-1)return void this.fire(new r.a(new Error(`Layer with id "${a}" does not exist on this map.`)));g.slot===this._layers[a].slot?v=A:r.w(`Layer with id "${a}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(v,0,p),this._layerOrderChanged=!0,this._layers[p]=g;let k=this.getOwnLayerSourceCache(g),S=!!this.directionalLight&&this.directionalLight.shadowsEnabled();k&&g.canCastShadows()&&S&&(k.castsShadows=!0);let E=this._changes.getRemovedLayer(g);if(E&&g.source&&k&&g.type!=="custom"){this._changes.discardLayerRemoval(g);let A=r.ag(g.source,g.scope);E.type!==g.type?this._changes.updateSourceCache(A,"clear"):(this._changes.updateSourceCache(A,"reload"),k.pause())}this._updateLayer(g),g.onAdd&&g.onAdd(this.map),g.scope=this.scope,this.mergeLayers()}moveLayer(n,a){this._checkLoaded();let d=this._checkLayer(n);if(!d||n===a)return;let p=this._order.indexOf(n);this._order.splice(p,1);let g=this._order.length;if(a){let v=this._order.indexOf(a);if(v===-1)return void this.fire(new r.a(new Error(`Layer with id "${a}" does not exist on this map.`)));d.slot===this._layers[a].slot?g=v:r.w(`Layer with id "${a}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(g,0,n),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(n){this._checkLoaded();let a=this._checkLayer(n);if(!a)return;a.setEventedParent(null);let d=this._order.indexOf(n);this._order.splice(d,1),delete this._layers[n],delete this._serializedLayers[n],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(a.fqid),this._changes.removeLayer(a);let p=this.getOwnLayerSourceCache(a);if(p&&p.castsShadows){let g=!1;for(let v in this._layers)if(this._layers[v].source===a.source&&this._layers[v].canCastShadows()){g=!0;break}p.castsShadows=g}a.onRemove&&a.onRemove(this.map),this.mergeLayers()}getOwnLayer(n){return this._layers[n]}hasLayer(n){return n in this._mergedLayers}hasLayerType(n){for(let a in this._layers)if(this._layers[a].type===n)return!0;return!1}setLayerZoomRange(n,a,d){this._checkLoaded();let p=this._checkLayer(n);p&&(p.minzoom===a&&p.maxzoom===d||(a!=null&&(p.minzoom=a),d!=null&&(p.maxzoom=d),this._updateLayer(p)))}setSlot(n,a){this._checkLoaded();let d=this._checkLayer(n);d&&d.slot!==a&&(d.slot=a,this._updateLayer(d))}setFilter(n,a,d={}){this._checkLoaded();let p=this._checkLayer(n);if(p&&!M(p.filter,a))return a==null?(p.filter=void 0,void this._updateLayer(p)):void(this._validate(Me,`layers.${p.id}.filter`,a,{layerType:p.type},d)||(p.filter=r.c1(a),this._updateLayer(p)))}getFilter(n){let a=this._checkLayer(n);if(a)return r.c1(a.filter)}setLayoutProperty(n,a,d,p={}){this._checkLoaded();let g=this._checkLayer(n);if(g&&!M(g.getLayoutProperty(a),d)){if(d!=null&&(!p||p.validate!==!1)&&ss(g,qe.call(Mo,{key:`layers.${n}.layout.${a}`,layerType:g.type,objectKey:a,value:d,styleSpec:r.D,style:{glyphs:!0,sprite:!0}})))return;g.setLayoutProperty(a,d),g.isConfigDependent&&this._configDependentLayers.add(g.fqid),this._updateLayer(g)}}getLayoutProperty(n,a){let d=this._checkLayer(n);if(d)return d.getLayoutProperty(a)}setPaintProperty(n,a,d,p={}){this._checkLoaded();let g=this._checkLayer(n);if(!g||M(g.getPaintProperty(a),d)||d!=null&&(!p||p.validate!==!1)&&ss(g,Oe.call(Mo,{key:`layers.${n}.paint.${a}`,layerType:g.type,objectKey:a,value:d,styleSpec:r.D})))return;let v=g.setPaintProperty(a,d);g.isConfigDependent&&this._configDependentLayers.add(g.fqid),v&&this._updateLayer(g),this._changes.updatePaintProperties(g)}getPaintProperty(n,a){let d=this._checkLayer(n);if(d)return d.getPaintProperty(a)}setFeatureState(n,a){this._checkLoaded();let d=n.source,p=n.sourceLayer,g=this._checkSource(d);if(!g)return;let v=g.type;if(v==="geojson"&&p)return void this.fire(new r.a(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(v==="vector"&&!p)return void this.fire(new r.a(new Error("The sourceLayer parameter must be provided for vector source types.")));n.id===void 0&&this.fire(new r.a(new Error("The feature id parameter must be provided.")));let k=this.getOwnSourceCaches(d);for(let S of k)S.setFeatureState(p,n.id,a)}removeFeatureState(n,a){this._checkLoaded();let d=n.source,p=this._checkSource(d);if(!p)return;let g=p.type,v=g==="vector"?n.sourceLayer:void 0;if(g==="vector"&&!v)return void this.fire(new r.a(new Error("The sourceLayer parameter must be provided for vector source types.")));if(a&&typeof n.id!="string"&&typeof n.id!="number")return void this.fire(new r.a(new Error("A feature id is required to remove its specific state property.")));let k=this.getOwnSourceCaches(d);for(let S of k)S.removeFeatureState(v,n.id,a)}getFeatureState(n){this._checkLoaded();let a=n.source,d=n.sourceLayer,p=this._checkSource(a);if(p){if(p.type!=="vector"||d)return n.id===void 0&&this.fire(new r.a(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(a)[0].getFeatureState(d,n.id);this.fire(new r.a(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(n){return this.stylesheet.transition=r.e({},this.stylesheet.transition,n),this.transition=this.stylesheet.transition,this}getTransition(){return r.e({},this.stylesheet.transition)}serialize(){this._checkLoaded();let n=this.getTerrain(),a=n&&this.terrain&&this.terrain.scope===this.scope?n:this.stylesheet.terrain;return r.c7({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:a,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},d=>d!==void 0)}_updateLayer(n){this._changes.updateLayer(n);let a=this.getLayerSourceCache(n),d=r.ag(n.source,n.scope),p=this._changes.getUpdatedSourceCaches();n.source&&!p[d]&&a&&a.getSource().type!=="raster"&&(this._changes.updateSourceCache(d,"reload"),a.pause()),n.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(n){let a=k=>this._mergedLayers[k].type==="fill-extrusion"||this._mergedLayers[k].type==="model",d=this.order,p={},g=[];for(let k=d.length-1;k>=0;k--){let S=d[k];if(a(S)){p[S]=k;for(let E of n){let A=E[S];if(A)for(let P of A)g.push(P)}}}g.sort((k,S)=>S.intersectionZ-k.intersectionZ);let v=[];for(let k=d.length-1;k>=0;k--){let S=d[k];if(a(S))for(let E=g.length-1;E>=0;E--){let A=g[E].feature;if(p[A.layer.id]<k)break;v.push(A),g.pop()}else for(let E of n){let A=E[S];if(A)for(let P of A)v.push(P.feature)}}return v}queryRenderedFeatures(n,a,d){a&&a.filter&&this._validate(Me,"queryRenderedFeatures.filter",a.filter,null,a),a.scope=this.scope,a.availableImages=this._availableImages,a.serializedLayers=this._serializedLayers;let p={};if(a&&a.layers){if(!Array.isArray(a.layers))return this.fire(new r.a(new Error("parameters.layers must be an Array."))),[];for(let E of a.layers){let A=this._mergedLayers[E];if(!A)return this.fire(new r.a(new Error(`The layer '${E}' does not exist in the map's style and cannot be queried for features.`))),[];p[A.source]=!0}}let g=[],v=a.serializedLayers||{},k=a&&a.layers?a.layers.some(E=>{let A=this.getLayer(E);return A&&A.is3D()}):this.has3DLayers(),S=Zn.createFromScreenPoints(n,d);for(let E in this._mergedSourceCaches){let A=this._mergedSourceCaches[E].getSource();if(!A||A.scope!==a.scope)continue;let P=this._mergedSourceCaches[E].getSource().id;a.layers&&!p[P]||g.push(pu(this._mergedSourceCaches[E],this._mergedLayers,v,S,a,d,k,!!this.map._showQueryGeometry))}return this.placement&&g.push(function(E,A,P,z,O,U,V){let G={},N=U.queryRenderedSymbols(z),H=[];for(let Q of Object.keys(N).map(Number))H.push(V[Q]);H.sort(Tl);for(let Q of H){let W=Q.featureIndex.lookupSymbolFeatures(N[Q.bucketInstanceId],A,Q.bucketIndex,Q.sourceLayerIndex,O.filter,O.layers,O.availableImages,E);for(let J in W){let $=G[J]=G[J]||[],ee=W[J];ee.sort((oe,ae)=>{let ce=Q.featureSortOrder;if(ce){let be=ce.indexOf(oe.featureIndex);return ce.indexOf(ae.featureIndex)-be}return ae.featureIndex-oe.featureIndex});for(let oe of ee)$.push(oe)}}for(let Q in G)G[Q].forEach(W=>{let J=W.feature,$=P(E[Q]);if(!$)return;let ee=$.getFeatureState(J.layer["source-layer"],J.id);J.source=J.layer.source,J.layer["source-layer"]&&(J.sourceLayer=J.layer["source-layer"]),J.state=ee});return G}(this._mergedLayers,v,this.getLayerSourceCache.bind(this),S.screenGeometry,a,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(g)}querySourceFeatures(n,a){a&&a.filter&&this._validate(Me,"querySourceFeatures.filter",a.filter,null,a);let d=this.getOwnSourceCaches(n),p=[];for(let g of d)p=p.concat(Ea(g,a));return p}addSourceType(n,a,d){return Ko.getSourceType(n)?d(new Error(`A source type called "${n}" already exists.`)):(Ko.setSourceType(n,a),a.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:a.workerSourceURL},d):d(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(n,a,d={}){this._checkLoaded();let p=this.light.getLight(),g=!1;for(let k in n)if(!M(n[k],p[k])){g=!0;break}if(!g)return;let v=this._getTransitionParameters();this.light.setLight(n,a,d),this.light.updateTransitions(v)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(n,a=1){if(this._checkLoaded(),!n)return this.terrainSetForDrapingOnly()&&a!==0||delete this.terrain,n===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let d=n,p=n.source==null;if(a===1){if(typeof d.source=="object"){let k="terrain-dem-src";this.addSource(k,d.source),d=r.c1(d),d=r.e(d,{source:k})}let g=r.e({},d),v={};if(this.terrain&&p){g.source=this.terrain.get().source;let k=this.terrain?this.getFragmentStyle(this.terrain.scope):null;k&&(v.style=k.serialize())}if(this._validate(X,"terrain",g,v))return}if(!this.terrain||this.terrain.scope!==this.scope&&!p||this.terrain&&a!==this.terrain.drapeRenderMode){if(!d)return;this._createTerrain(d,a),this.fire(new r.b("data",{dataType:"style"}))}else{let g=this.terrain,v=g.get();for(let k of Object.keys(r.D.terrain))!d.hasOwnProperty(k)&&r.D.terrain[k].default&&(d[k]=r.D.terrain[k].default);for(let k in n)if(!M(n[k],v[k])){g.set(n,this.options),this.stylesheet.terrain=n;let S=this._getTransitionParameters({duration:0});g.updateTransitions(S),this.fire(new r.b("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(n){let a=this.fog=new Zr(n,this.map.transform,this.scope,this.options);this.stylesheet.fog=a.get();let d=this._getTransitionParameters({duration:0});a.updateTransitions(d)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(let n of this.map._markers)n._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){let a=this.fog;if(!M(a.get(),n)){a.set(n,this.options),this.stylesheet.fog=a.get();let d=this._getTransitionParameters({duration:0});a.updateTransitions(d)}}else this._createFog(n);this._markersNeedUpdate=!0}_getTransitionParameters(n){return{now:r.f.now(),transition:r.e(this.transition,n)}}updateDrapeFirstLayers(){if(!this.terrain)return;let n=[],a=[];for(let d in this._mergedLayers)this.isLayerDraped(this._mergedLayers[d])?n.push(d):a.push(d);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...a)}_createTerrain(n,a){let d=this.terrain=new Zi(n,a,this.scope,this.options);a===1&&(this.stylesheet.terrain=n),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();let p=this._getTransitionParameters({duration:0});d.updateTransitions(p)}_force3DLayerUpdate(){for(let n in this._layers){let a=this._layers[n];a.type==="fill-extrusion"&&this._updateLayer(a)}}_forceSymbolLayerUpdate(){for(let n in this._layers){let a=this._layers[n];a.type==="symbol"&&this._updateLayer(a)}}_validate(n,a,d,p,g={}){if(g&&g.validate===!1)return!1;let v=r.e({},this.serialize());return ss(this,n.call(Mo,r.e({key:a,style:v,value:d,styleSpec:r.D},p)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),r.c8.off("pluginStateChange",this._rtlTextPluginCallback);for(let n in this._mergedLayers)this._mergedLayers[n].setEventedParent(null);for(let n in this._mergedSourceCaches)this._mergedSourceCaches[n].clearTiles(),this._mergedSourceCaches[n].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(n){let a=this.getSourceCaches(n);for(let d of a)d.clearTiles()}clearSources(){for(let n in this._mergedSourceCaches)this._mergedSourceCaches[n].clearTiles()}reloadSource(n){let a=this.getSourceCaches(n);for(let d of a)d.resume(),d.reload()}reloadSources(){for(let n of this.getSources())n.reload&&n.reload()}updateSources(n){let a;this.directionalLight&&(a=jd(this.directionalLight));for(let d in this._mergedSourceCaches)this._mergedSourceCaches[d].update(n,void 0,void 0,a)}_generateCollisionBoxes(){for(let n in this._sourceCaches){let a=this._sourceCaches[n];a.resume(),a.reload()}}_updatePlacement(n,a,d,p,g=!1){let v=!1,k=!1,S={},E={};for(let A of this._mergedOrder){let P=this._mergedLayers[A];if(P.type!=="symbol")continue;let z=r.ag(P.source,P.scope),O=S[z];if(!O){let V=this.getLayerSourceCache(P);if(!V)continue;let G=V.getRenderableIds(!0).map(N=>V.getTileByID(N));E[z]=G.slice(),O=S[z]=G.sort((N,H)=>H.tileID.overscaledZ-N.tileID.overscaledZ||(N.tileID.isLessThan(H.tileID)?-1:1))}let U=this.crossTileSymbolIndex.addLayer(P,O,n.center.lng,n.projection);v=v||U}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),g=g||this._layerOrderChanged||d===0,this._layerOrderChanged&&this.fire(new r.b("neworder")),(g||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(r.f.now(),n.zoom))&&(this.pauseablePlacement=new Fd(n,this._mergedOrder,g,a,d,p,this.placement,this.fog&&n.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,S,E),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(r.f.now()),k=!0),v&&this.pauseablePlacement.placement.setStale()),k||v){this._buildingIndex.onNewFrame(n.zoom);for(let A of this._mergedOrder){let P=this._mergedLayers[A];P.type==="symbol"&&this.placement.updateLayerOpacities(P,S[r.ag(P.source,P.scope)])}}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(r.f.now())}_releaseSymbolFadeTiles(){for(let n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}addImport(n,a){this._checkLoaded();let d=this.stylesheet.imports=this.stylesheet.imports||[];if(d.findIndex(({id:g})=>g===n.id)!==-1)return this.fire(new r.a(new Error(`Import with id '${n.id}' already exists in the map's style.`)));if(!a)return d.push(n),this._loadImports([n],!0),this;let p=d.findIndex(({id:g})=>g===a);return p===-1?this.fire(new r.a(new Error(`Import with id "${a}" does not exist on this map.`))):(this.stylesheet.imports=d.slice(0,p).concat(n).concat(d.slice(p)),this._loadImports([n],!0,a),this)}updateImport(n,a){this._checkLoaded();let d=this.stylesheet.imports||[],p=this.getImportIndex(n);return p===-1?this:typeof a=="string"?(this.setImportUrl(n,a),this):(a.url&&a.url!==d[p].url&&this.setImportUrl(n,a.url),M(a.config,d[p].config)||this.setImportConfig(n,a.config),M(a.data,d[p].data)||this.setImportData(n,a.data),this)}moveImport(n,a){this._checkLoaded();let d=this.stylesheet.imports||[],p=this.getImportIndex(n);if(p===-1)return this;let g=this.getImportIndex(a);if(g===-1)return this;let v=d[p],k=this.fragments[p];return d=d.filter(({id:S})=>S!==n),this.fragments=this.fragments.filter(({id:S})=>S!==n),this.stylesheet.imports=d.slice(0,g).concat(v).concat(d.slice(g)),this.fragments=this.fragments.slice(0,g).concat(k).concat(this.fragments.slice(g)),this.mergeLayers(),this}setImportUrl(n,a){this._checkLoaded();let d=this.stylesheet.imports||[],p=this.getImportIndex(n);if(p===-1)return this;d[p].url=a;let g=this.fragments[p];return g.style=this._createFragmentStyle(d[p]),g.style.on("style.import.load",()=>this.mergeAll()),g.style.loadURL(a),this}setImportData(n,a){this._checkLoaded();let d=this.getImportIndex(n),p=this.stylesheet.imports||[];return d===-1?this:a?(this.fragments[d].style.setState(a),this._reloadImports(),this):(delete p[d].data,this.setImportUrl(n,p[d].url))}setImportConfig(n,a){this._checkLoaded();let d=this.getImportIndex(n),p=this.stylesheet.imports||[];if(d===-1)return this;a?p[d].config=a:delete p[d].config;let g=this.fragments[d],v=g.style.stylesheet&&g.style.stylesheet.schema;return g.config=a,g.style.setConfig(a,v),this.updateConfigDependencies(),this}removeImport(n){this._checkLoaded();let a=this.stylesheet.imports||[],d=this.getImportIndex(n);return d===-1||(a.splice(d,1),this.fragments[d].style._remove(),this.fragments.splice(d,1),this._reloadImports()),this}getImportIndex(n){let a=(this.stylesheet.imports||[]).findIndex(d=>d.id===n);return a===-1&&this.fire(new r.a(new Error(`Import '${n}' does not exist in the map's style and cannot be updated.`))),a}getLayer(n){return this._mergedLayers[n]}getSources(){let n=[];for(let a in this._mergedOtherSourceCaches){let d=this._mergedOtherSourceCaches[a];d&&n.push(d.getSource())}return n}getSource(n,a){let d=this.getSourceCache(n,a);return d&&d.getSource()}getLayerSource(n){let a=this.getLayerSourceCache(n);return a&&a.getSource()}getSourceCache(n,a){let d=r.ag(n,a);return this._mergedOtherSourceCaches[d]}getLayerSourceCache(n){let a=r.ag(n.source,n.scope);return n.type==="symbol"?this._mergedSymbolSourceCaches[a]:this._mergedOtherSourceCaches[a]}getSourceCaches(n){let a=[];return this._mergedOtherSourceCaches[n]&&a.push(this._mergedOtherSourceCaches[n]),this._mergedSymbolSourceCaches[n]&&a.push(this._mergedSymbolSourceCaches[n]),a}updateSourceCaches(){let n=this._changes.getUpdatedSourceCaches();for(let a in n){let d=n[a];d==="reload"?this.reloadSource(a):d==="clear"&&this.clearSource(a)}}updateLayers(n){let a=this._changes.getUpdatedPaintProperties();for(let d of a){let p=this.getLayer(d);p&&p.updateTransitions(n)}}getImages(n,a,d){this.imageManager.getImages(a.icons,a.scope,d),this._updateTilesForChangedImages();let p=g=>{g&&g.setDependencies(a.tileID.key,a.type,a.icons)};p(this._otherSourceCaches[a.source]),p(this._symbolSourceCaches[a.source])}getGlyphs(n,a,d){this.glyphManager.getGlyphs(a.stacks,a.scope,d)}getResource(n,a,d){return r.c9(a,d)}getOwnSourceCache(n){return this._otherSourceCaches[n]}getOwnLayerSourceCache(n){return n.type==="symbol"?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}getOwnSourceCaches(n){let a=[];return this._otherSourceCaches[n]&&a.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&a.push(this._symbolSourceCaches[n]),a}_isSourceCacheLoaded(n){let a=this.getOwnSourceCaches(n);return a.length===0?(this.fire(new r.a(new Error(`There is no source with ID '${n}'`))),!1):a.every(d=>d.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(n=>{n.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ko.getSourceType=function(c){return Ma[c]},Ko.setSourceType=function(c,n){Ma[c]=n},Ko.registerForPluginStateChange=r.bV;var Vd=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Ud=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}`,Gd=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,$d="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Fu=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,Bu=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,wf=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Dl=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Pl=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform vec2 u_velocity_res;uniform float u_max_speed;const vec2 INVALID_VELOCITY=vec2(-1);uniform vec2 u_texture_offset;uniform float u_data_offset;uniform vec4 u_data_scale;vec2 lookup_velocity(vec2 uv) {uv=u_texture_offset.x+u_texture_offset.y*uv;vec2 fxy;ivec4 c=_raTexLinearCoord(uv,u_velocity_res,fxy);vec4 tl=texelFetch(u_velocity,c.yz,0);vec4 tr=texelFetch(u_velocity,c.xz,0);vec4 bl=texelFetch(u_velocity,c.yw,0);vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NODATA) {return INVALID_VELOCITY;}if (tr==NODATA) {return INVALID_VELOCITY;}if (bl==NODATA) {return INVALID_VELOCITY;}if (br==NODATA) {return INVALID_VELOCITY;}vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);
#ifdef DATA_FORMAT_UINT32
vec2 velocity=vec2(u_data_offset+dot(t,u_data_scale),0);return velocity;
#else
vec2 velocity=vec2(u_data_offset+dot(t.rg,u_data_scale.yx),-(u_data_offset+dot(t.ba,u_data_scale.yx)));
#endif
return velocity/max(u_max_speed,length(velocity));}
#endif`,Nu=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Rc=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;let Rl=[];ls(Vd,Rl),ls(Gd,Rl),ls(Ud,Rl);let yo={"_prelude_fog.vertex.glsl":Bu,"_prelude_terrain.vertex.glsl":Fu,"_prelude_shadow.vertex.glsl":Nu,"_prelude_fog.fragment.glsl":wf,"_prelude_shadow.fragment.glsl":Rc,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Dl,"_prelude_raster_particle.glsl":Pl},Ll={};ki("",Fu),ki(wf,Bu),ki(Rc,Nu),ki(Dl,""),ki(Pl,"");let ju=ki(Ud,Gd),qd=Vd;var Vu={background:ki(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:ki(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:ki(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:ki("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ki(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:ki(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:ki("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:ki("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:ki("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:ki(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:ki(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:ki(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:ki(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:ki(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
uniform float u_emissive_strength;in float v_height;void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=max(0.01,cutoff_opacity(u_cutoff_params,ground.z));if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff < 0.01 && centroid_pos.x !=0.0));gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:ki(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:ki(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:ki(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:ki(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:ki(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ki(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:ki(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:ki(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float pattern_x=v_linesofar/pattern_size.x*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:ki(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:ki(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;vec2 uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
vec2 uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:ki("precision highp float;uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`precision highp float;
#include "_prelude_raster_array.glsl"
#include "_prelude_raster_particle.glsl"
in vec3 a_pos;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {vec2 pos=a_pos.xy+u_tile_offset;vec2 tex_coords=fract(pos);gl_PointSize=1.0;vec2 velocity=lookup_velocity(tex_coords);if (velocity==INVALID_VELOCITY) {v_particle_speed=0.0;gl_Position=vec4(2.0,2.0,2.0,1.0);} else {v_particle_speed=length(velocity);gl_Position=vec4(2.0*pos-vec2(1.0),0.0,1.0);}}`),rasterParticleTexture:ki("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {v_tex_pos=0.5*a_pos+vec2(0.5);gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:ki("void main() {}",`#include "_prelude_raster_array.glsl"
#include "_prelude_raster_particle.glsl"
in vec3 a_pos;uniform float u_speed_factor;uniform float u_lifetime_delta;uniform float u_rand_seed;out vec3 v_new_particle;const vec3 rand_constants=vec3(12.9898,78.233,4375.85453);float rand(const vec2 co) {float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {float lifetime=a_pos.z;vec2 pos=a_pos.xy;vec2 uv=clamp(pos,vec2(0.0),vec2(1.0));vec2 velocity=lookup_velocity(uv);float next_lifetime=lifetime-u_lifetime_delta;float t=step(0.0,next_lifetime);
#ifdef DATA_FORMAT_UINT32
vec2 dp=vec2(0);
#else
vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;
#endif
vec2 seed=pos*u_rand_seed;vec2 next_pos=pos+dp;vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));v_new_particle=vec3(
vec2(mix(random_pos,next_pos,t)),mix(1.0,next_lifetime,t)
);}`),symbolIcon:ki(`#include "_prelude_lighting.glsl"
uniform sampler2D u_texture;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
in float v_fade_opacity;in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
uniform mediump float u_icon_saturation;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
lowp float alpha=opacity*v_fade_opacity;vec4 out_color;
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b)*alpha;
#else
out_color=texture(u_texture,v_tex_a)*alpha;
#endif
#ifdef SATURATION
vec3 luma=vec3(dot(out_color.rgb,vec3(0.2126,0.7152,0.0722)));out_color.rgb=mix(luma,out_color.rgb,u_icon_saturation);
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
v_tex_a=a_tex/u_texsize;
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
v_fade_opacity=out_fade_opacity;}`),symbolSDF:ki(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}`),symbolTextAndIcon:ki(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}`),terrainRaster:ki(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:ki("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:ki(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,$d),skyboxGradient:ki(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,$d),skyboxCapture:ki(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:ki(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:ki(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:ki(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
return vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=local_pos;
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1);v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:ki(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:ki(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`)};function ls(c,n){let a=c.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let d of a)if(d=d.trim(),d[0]==="#"&&d.includes("if")&&!d.includes("endif")){d=d.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();let p=d.split(" ");for(let g of p)n.includes(g)||n.push(g)}}function ki(c,n){let a=/#include\s+"([^"]+)"/g,d=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,p=n.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);p&&(p=p.map(E=>{let A=E.split(" ");return A[A.length-1]}),p=[...new Set(p)]);let g={},v=[],k=[];if(c=c.replace(a,(E,A)=>(k.push(A),"")),(n=n.replace(a,(E,A)=>(v.push(A),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let S=[...Rl];ls(c,S),ls(n,S);for(let E of[...v,...k])yo[E]||console.error(`Undefined include: ${E}`),Ll[E]||(Ll[E]=[],ls(yo[E],Ll[E])),S=[...S,...Ll[E]];return{fragmentSource:c=c.replace(d,(E,A,P,z,O)=>(g[O]=!0,A==="define"?`
#ifndef HAS_UNIFORM_u_${O}
in ${P} ${z} ${O};
#else
uniform ${P} ${z} u_${O};
#endif
`:A==="initialize"?`
#ifdef HAS_UNIFORM_u_${O}
    ${P} ${z} ${O} = u_${O};
#endif
`:A==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${O}
    in ${P} ${z} ${O};
#endif
`:A==="initialize-attribute"?"":void 0)),vertexSource:n=n.replace(d,(E,A,P,z,O)=>{let U=z==="float"?"vec2":z,V=O.match(/color/)?"color":U;return A==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${O}
in ${P} ${z} a_${O};
#endif
`:g[O]?A==="define"?`
#ifndef HAS_UNIFORM_u_${O}
uniform lowp float u_${O}_t;
in ${P} ${U} a_${O};
out ${P} ${z} ${O};
#else
uniform ${P} ${z} u_${O};
#endif
`:A==="initialize"?V==="vec4"?`
#ifndef HAS_UNIFORM_u_${O}
    ${O} = a_${O};
#else
    ${P} ${z} ${O} = u_${O};
#endif
`:`
#ifndef HAS_UNIFORM_u_${O}
    ${O} = unpack_mix_${V}(a_${O}, u_${O}_t);
#else
    ${P} ${z} ${O} = u_${O};
#endif
`:A==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${O}
    in ${P} ${z} a_${O};
    out ${P} ${z} ${O};
#endif
`:A==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${O}
    ${O} = a_${O};
#endif
`:void 0:A==="define"?`
#ifndef HAS_UNIFORM_u_${O}
uniform lowp float u_${O}_t;
in ${P} ${U} a_${O};
#else
uniform ${P} ${z} u_${O};
#endif
`:A==="define-instanced"?V==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${O}0;
in vec4 a_${O}1;
in vec4 a_${O}2;
in vec4 a_${O}3;
#else
uniform ${P} ${z} u_${O};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${P} ${U} a_${O};
#else
uniform ${P} ${z} u_${O};
#endif
`:A==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${O}
    ${P} ${z} ${O} = a_${O};
#endif
`:V==="vec4"?`
#ifndef HAS_UNIFORM_u_${O}
    ${P} ${z} ${O} = a_${O};
#else
    ${P} ${z} ${O} = u_${O};
#endif
`:`
#ifndef HAS_UNIFORM_u_${O}
    ${P} ${z} ${O} = unpack_mix_${V}(a_${O}, u_${O}_t);
#else
    ${P} ${z} ${O} = u_${O};
#endif
`}),staticAttributes:p,usedDefines:S,vertexIncludes:v,fragmentIncludes:k}}class Uu{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(n,a,d,p,g,v,k,S){this.context=n;let E=this.boundPaintVertexBuffers.length!==p.length;for(let P=0;!E&&P<p.length;P++)this.boundPaintVertexBuffers[P]!==p[P]&&(E=!0);let A=this.boundDynamicVertexBuffers.length!==k.length;for(let P=0;!A&&P<k.length;P++)this.boundDynamicVertexBuffers[P]!==k[P]&&(A=!0);if(!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==d||E||A||this.boundIndexBuffer!==g||this.boundVertexOffset!==v)this.freshBind(a,d,p,g,v,k,S);else{n.bindVertexArrayOES.set(this.vao);for(let P of k)P&&(P.bind(),S&&P.instanceCount&&P.setVertexAttribDivisor(n.gl,a,S));g&&g.dynamicDraw&&g.bind()}}freshBind(n,a,d,p,g,v,k){let S=n.numAttributes,E=this.context,A=E.gl;this.vao&&this.destroy(),this.vao=E.gl.createVertexArray(),E.bindVertexArrayOES.set(this.vao),this.boundProgram=n,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=d,this.boundIndexBuffer=p,this.boundVertexOffset=g,this.boundDynamicVertexBuffers=v,a.enableAttributes(A,n),a.bind(),a.setVertexAttribPointers(A,n,g);for(let P of d)P.enableAttributes(A,n),P.bind(),P.setVertexAttribPointers(A,n,g);for(let P of v)P&&(P.enableAttributes(A,n),P.bind(),P.setVertexAttribPointers(A,n,g),k&&P.instanceCount&&P.setVertexAttribDivisor(A,n,k));p&&p.bind(),E.currentNumAttributes=S}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function k0(c,n){let a=Math.pow(2,n.canonical.z),d=n.canonical.y;return[new r.L(0,d/a).toLngLat().lat,new r.L(0,(d+1)/a).toLngLat().lat]}function Hd(c,n,a,d,p,g,v){let k=c.context,S=k.gl,E=a.hillshadeFBO;if(!E)return;c.prepareDrawTile();let A=c.isTileAffectedByFog(n),P=c.getOrCreateProgram("hillshade",{overrideFog:A});k.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,E.colorAttachment.get());let z=((G,N,H,Q)=>{let W=H.paint.get("hillshade-shadow-color"),J=H.paint.get("hillshade-highlight-color"),$=H.paint.get("hillshade-accent-color"),ee=H.paint.get("hillshade-emissive-strength"),oe=r.bj(H.paint.get("hillshade-illumination-direction"));if(H.paint.get("hillshade-illumination-anchor")==="viewport")oe-=G.transform.angle;else if(G.style&&G.style.enable3dLights()&&G.style.directionalLight){let ce=G.style.directionalLight.properties.get("direction"),be=r.bQ(ce.x,ce.y,ce.z);oe=r.bj(be[1])}let ae=!G.options.moving;return{u_matrix:Q||G.transform.calculateProjMatrix(N.tileID.toUnwrapped(),ae),u_image:0,u_latrange:k0(0,N.tileID),u_light:[H.paint.get("hillshade-exaggeration"),oe],u_shadow:W,u_highlight:J,u_emissive_strength:ee,u_accent:$}})(c,a,d,c.terrain?n.projMatrix:null);c.uploadCommonUniforms(k,P,n.toUnwrapped());let{tileBoundsBuffer:O,tileBoundsIndexBuffer:U,tileBoundsSegments:V}=c.getTileBoundsBuffers(a);P.draw(c,S.TRIANGLES,p,g,v,Lt.disabled,z,d.id,O,U,V)}function Tf(c,n,a){if(!n.needsDEMTextureUpload)return;let d=c.context,p=d.gl;d.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||c.getTileTexture(a.stride);let g=a.getPixels();n.demTexture?n.demTexture.update(g,{premultiply:!1}):n.demTexture=new r.T(d,g,p.R32F,{premultiply:!1}),n.needsDEMTextureUpload=!1}function Gu(c,n,a){let d=c.context,p=d.gl;if(!n.dem)return;let g=n.dem;if(d.activeTexture.set(p.TEXTURE1),Tf(c,n,g),!n.demTexture)return;n.demTexture.bind(p.NEAREST,p.CLAMP_TO_EDGE);let v=g.dim;d.activeTexture.set(p.TEXTURE0);let k=n.hillshadeFBO;if(!k){let z=new r.T(d,{width:v,height:v,data:null},p.RGBA);z.bind(p.LINEAR,p.CLAMP_TO_EDGE),k=n.hillshadeFBO=d.createFramebuffer(v,v,!0,"renderbuffer"),k.colorAttachment.set(z.texture)}d.bindFramebuffer.set(k.framebuffer),d.viewport.set([0,0,v,v]);let{tileBoundsBuffer:S,tileBoundsIndexBuffer:E,tileBoundsSegments:A}=c.getMercatorTileBoundsBuffers(),P=[];c.linearFloatFilteringSupported()&&P.push("TERRAIN_DEM_FLOAT_FORMAT"),c.getOrCreateProgram("hillshadePrepare",{defines:P}).draw(c,p.TRIANGLES,Rt.disabled,jt.disabled,ri.unblended,Lt.disabled,((z,O)=>{let U=O.stride,V=r.a6.create();return r.a6.ortho(V,0,r.V,-r.V,0,0,1),r.a6.translate(V,V,[0,-r.V,0]),{u_matrix:V,u_image:1,u_dimension:[U,U],u_zoom:z.overscaledZ}})(n.tileID,g),a.id,S,E,A),n.needsHillshadePrepare=!1}let kf=c=>({u_matrix:new r.bK(c),u_image0:new r.bO(c),u_skirt_height:new r.bN(c),u_ground_shadow_factor:new r.bM(c)}),Zd=(c,n,a)=>({u_matrix:c,u_image0:0,u_skirt_height:n,u_ground_shadow_factor:a}),If=(c,n,a,d,p,g,v,k,S,E,A,P,z,O,U,V)=>({u_proj_matrix:Float32Array.from(c),u_globe_matrix:n,u_normalize_matrix:Float32Array.from(d),u_merc_matrix:a,u_zoom_transition:p,u_merc_center:g,u_image0:0,u_frustum_tl:v,u_frustum_tr:k,u_frustum_br:S,u_frustum_bl:E,u_globe_pos:A,u_globe_radius:P,u_viewport:z,u_grid_matrix:V?Float32Array.from(V):new Float32Array(9),u_skirt_height:O,u_far_z_cutoff:U});function Lc(c,n){return c!=null&&n!=null&&!(!c.hasData()||!n.hasData())&&c.demTexture!=null&&n.demTexture!=null&&c.tileID.key!==n.tileID.key}let zl=new class{constructor(){this.operations={}}newMorphing(c,n,a,d,p){if(c in this.operations){let g=this.operations[c];g.to.tileID.key!==a.tileID.key&&(g.queued=a)}else this.operations[c]={startTime:d,phase:0,duration:p,from:n,to:a,queued:null}}getMorphValuesForProxy(c){if(!(c in this.operations))return null;let n=this.operations[c];return{from:n.from,to:n.to,phase:n.phase}}update(c){for(let n in this.operations){let a=this.operations[n];for(a.phase=(c-a.startTime)/a.duration;a.phase>=1||!this._validOp(a);)if(!this._nextOp(a,c)){delete this.operations[n];break}}}_nextOp(c,n){return!!c.queued&&(c.from=c.to,c.to=c.queued,c.queued=null,c.phase=0,c.startTime=n,!0)}_validOp(c){return c.from.hasData()&&c.to.hasData()}},$u={0:null,1:"TERRAIN_VERTEX_MORPHING"};function qu(c,n,a){if(n===0)return 0;let d=n<1&&a===514?.25/n:1;return 6*Math.pow(1.5,22-c)*Math.max(n,1)*d}function Ol(c,n){let a=1<<c.z;return!n&&(c.x===0||c.x===a-1)||c.y===0||c.y===a-1}let Hu=c=>({u_matrix:c});function Zu(c,n,a,d,p){if(p>0){let g=r.f.now(),v=(g-c.timeAdded)/p,k=n?(g-n.timeAdded)/p:-1,S=a.getSource(),E=d.coveringZoomLevel({tileSize:S.tileSize,roundZoom:S.roundZoom}),A=!n||Math.abs(n.tileID.overscaledZ-E)>Math.abs(c.tileID.overscaledZ-E),P=A&&c.refreshedUponExpiration?1:r.aa(A?v:1-k,0,1);return c.refreshedUponExpiration&&v>=1&&(c.refreshedUponExpiration=!1),n?{opacity:1,mix:1-P}:{opacity:P,mix:0}}return{opacity:1,mix:0}}class I0 extends Xo{constructor(n){let a={type:"raster-dem",maxzoom:n.transform.maxZoom},d=new r.bW(r.bX(),null),p=er("mock-dem",a,d,n.style);super("mock-dem",p,!1),p.setEventedParent(this),this._sourceLoaded=!0}_loadTile(n,a){n.state="loaded",a(null)}}class S0 extends Xo{constructor(n){let a=er("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},new r.bW(r.bX(),null),n.style);super("proxy",a,!1),a.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,a,d){if(n.freezeTileCoverage)return;this.transform=n;let p=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((g,v)=>{if(g[v.key]="",!this._tiles[v.key]){let k=new es(v,this._source.tileSize*v.overscaleFactor(),n.tileZoom);k.state="loaded",this._tiles[v.key]=k}return g},{});for(let g in this._tiles)g in p||(this.freeFBO(g),this._tiles[g].unloadVectorData(),delete this._tiles[g])}freeFBO(n){let a=this.proxyCachedFBO[n];if(a!==void 0){let d=Object.values(a);this.renderCachePool.push(...d),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach(n=>n.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Sf extends r.am{constructor(n,a,d){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=a,this.projMatrix=d}}class C0 extends r.ck{constructor(n,a){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},n.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),n.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),n.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};let[d,p,g]=function(S){let E=new r.aN,A=new r.aw,P=131;E.reserve(17161),A.reserve(33800);let z=r.V/128,O=r.V+z/2,U=O+z;for(let G=-z;G<U;G+=z)for(let N=-z;N<U;N+=z){let H=N<0||N>O||G<0||G>O?24575:0,Q=r.aa(Math.round(N),0,r.V),W=r.aa(Math.round(G),0,r.V);E.emplaceBack(Q+H,W)}let V=(G,N)=>{let H=N*P+G;A.emplaceBack(H+1,H,H+P),A.emplaceBack(H+P,H+P+1,H+1)};for(let G=1;G<129;G++)for(let N=1;N<129;N++)V(N,G);return[0,129].forEach(G=>{for(let N=0;N<130;N++)V(N,G),V(G,N)}),[E,A,32768]}(),v=n.context;this.gridBuffer=v.createVertexBuffer(d,r.aP.members),this.gridIndexBuffer=v.createIndexBuffer(p),this.gridSegments=r.aB.simpleSegment(0,0,d.length,p.length),this.gridNoSkirtSegments=r.aB.simpleSegment(0,0,d.length,g),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new S0(a.map),this.orthoMatrix=r.a6.create(),r.a6.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,r.V,0,r.V,0,1);let k=v.gl;this._overlapStencilMode=new jt({func:k.GEQUAL,mask:255},0,255,k.KEEP,k.KEEP,k.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=a,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new I0(a.map),this._pendingGroundEffectLayers=[]}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),this._style=n,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(n,a,d){if(n&&n.terrain){this._style!==n&&(this.style=n,this._evaluationZoom=void 0);let p=n.terrain.properties,g=n.terrain.drapeRenderMode===0,v=n.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=r.f.now();let k=n.terrain&&n.terrain.scope,S=p.get("source"),E=g?this._mockSourceCache:n.getSourceCache(S,k);if(!E)return void r.w(`Couldn't find terrain source "${S}".`);if(this.sourceCache=E,this._exaggeration=v?this.calculateExaggeration(a):p.get("exaggeration"),!a.projection.requiresDraping&&v&&this._exaggeration===0)return void this._disable();this.enabled=!0;let A=()=>{this.sourceCache.used&&r.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);let P=this.getScaledDemTileSize();this.sourceCache.update(a,P,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,A(),this._initializing=!0),A(),a.updateElevation(!0,d),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(a),this._emptyDEMTextureDirty=!0,this._previousZoom=a.zoom}else this._disable()}calculateExaggeration(n){let a=this._previousCameraAltitude,d=n.getFreeCameraOptions().position.z/n.pixelsPerMeter*n.worldSize;this._previousCameraAltitude=d;let p=a!=null?d-a:Number.MAX_VALUE;if(Math.abs(p)<2)return this._exaggeration;let g=n.zoom,v=this._style.terrain;if(!this._previousUpdateTimestamp)return v.getExaggeration(g);let k=g-this._previousZoom,S=this._previousUpdateTimestamp,E=g;this._evaluationZoom!=null&&(E=this._evaluationZoom,Math.abs(g-E)>.5&&(k=.5*(g-E+k)),k*p<0&&(E+=k)),this._evaluationZoom=E;let A=v.getExaggeration(E),P=A===v.getExaggeration(Math.max(0,E-.1));if(P&&Math.abs(A-this._exaggeration)<.01)return A;let z=Math.min(.1,.00375*(this._updateTimestamp-S));return(P||A<.1||Math.abs(k)<1e-4)&&(z=Math.min(.2,4*z)),r.U(this._exaggeration,A,z)}resetTileLookupCache(n){this._findCoveringTileCache[n]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(n){n.coord&&n.dataType==="source"?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):n.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(let n in this._style._mergedSourceCaches)this._style._mergedSourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(n=>n.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){let n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;let a=this.proxySourceCache,d=this.painter.transform;this._initializing&&(this._initializing=d._centerAltitude===0&&this.getAtPointOrZero(r.L.fromLngLat(d.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);let p=this.proxyCoords=a.getIds().map(S=>{let E=a.getTileByID(S).tileID;return E.projMatrix=d.calculateProjMatrix(E.toUnwrapped()),E});(function(S,E){let A=E.transform.pointCoordinate(E.transform.getCameraPoint()),P=new r.P(A.x,A.y);S.sort((z,O)=>{if(O.overscaledZ-z.overscaledZ)return O.overscaledZ-z.overscaledZ;let U=new r.P(z.canonical.x+(1<<z.canonical.z)*z.wrap,z.canonical.y),V=new r.P(O.canonical.x+(1<<O.canonical.z)*O.wrap,O.canonical.y),G=P.mult(1<<z.canonical.z);return G.x-=.5,G.y-=.5,G.distSqr(U)-G.distSqr(V)})})(p,this.painter);let g=this.proxyToSource||{};this.proxyToSource={},p.forEach(S=>{this.proxyToSource[S.key]={}}),this.terrainTileForTile={};let v=this._style._mergedSourceCaches;for(let S in v){let E=v[S];if(!E.used||(E!==this.sourceCache&&this.resetTileLookupCache(E.id),this._setupProxiedCoordsForOrtho(E,n[S],g),E.usedForTerrain))continue;let A=n[S];E.getSource().reparseOverscaled&&this._assignTerrainTiles(A)}this.proxiedCoords[a.id]=p.map(S=>new Sf(S,S.key,this.orthoMatrix)),this._assignTerrainTiles(p),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(g),this.renderingToTexture=!1;let k={};this._visibleDemTiles=[];for(let S of this.proxyCoords){let E=this.terrainTileForTile[S.key];if(!E)continue;let A=E.tileID.key;A in k||(this._visibleDemTiles.push(E),k[A]=A)}}_assignTerrainTiles(n){this._initializing||n.forEach(a=>{if(this.terrainTileForTile[a.key])return;let d=this._findTileCoveringTileID(a,this.sourceCache);d&&(this.terrainTileForTile[a.key]=d)})}_prepareDEMTextures(){let n=this.painter.context,a=n.gl;for(let d in this.terrainTileForTile){let p=this.terrainTileForTile[d],g=p.dem;!g||p.demTexture&&!p.needsDEMTextureUpload||(n.activeTexture.set(a.TEXTURE1),Tf(this.painter,p,g))}}_prepareDemTileUniforms(n,a,d,p){if(!a||a.demTexture==null)return!1;let g=n.tileID.canonical,v=Math.pow(2,a.tileID.canonical.z-g.z),k=p||"";return d[`u_dem_tl${k}`]=[g.x*v%1,g.y*v%1],d[`u_dem_scale${k}`]=v,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){let n=this.painter.context,a=n.gl;if(!this._emptyDepthBufferTexture){let d=new r.h({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new r.T(n,d,a.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let n=0,a=this._visibleDemTiles.reduce((d,p)=>{if(!p.dem)return d;let g=p.dem.tree.minimums[0];return g>0&&n++,d+g},0);return n?a/n:0}_updateEmptyDEMTexture(){let n=this.painter.context,a=n.gl;n.activeTexture.set(a.TEXTURE2);let d=this._getLoadedAreaMinimum(),[p,g]=(()=>{let k=new r.cm({width:1,height:1},new Float32Array([d]));return[a.R32F,k]})();this._emptyDEMTextureDirty=!1;let v=this._emptyDEMTexture;return v?v.update(g,{premultiply:!1}):v=this._emptyDEMTexture=new r.T(n,g,p,{premultiply:!1}),v}setupElevationDraw(n,a,d){let p=this.painter.context,g=p.gl,v={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};v.u_exaggeration=this.exaggeration();let k=null,S=null,E=1;if(d&&d.morphing&&this._useVertexMorphing){let z=d.morphing.srcDemTile,O=d.morphing.dstDemTile;E=d.morphing.phase,z&&O&&(this._prepareDemTileUniforms(n,z,v,"_prev")&&(S=z),this._prepareDemTileUniforms(n,O,v)&&(k=O))}let A=z=>z&&z.demTexture&&this.painter.linearFloatFilteringSupported()?g.LINEAR:g.NEAREST,P=z=>{v.u_dem_size=z.size[0]===1?1:z.size[0]-2};if(S&&k)p.activeTexture.set(g.TEXTURE2),k.demTexture.bind(A(k),g.CLAMP_TO_EDGE),p.activeTexture.set(g.TEXTURE4),S.demTexture.bind(A(S),g.CLAMP_TO_EDGE),k.demTexture&&P(k.demTexture),v.u_dem_lerp=E;else{k=this.terrainTileForTile[n.tileID.key],p.activeTexture.set(g.TEXTURE2);let z=this._prepareDemTileUniforms(n,k,v)?k.demTexture:this.emptyDEMTexture;z.bind(A(k),g.CLAMP_TO_EDGE),P(z)}if(p.activeTexture.set(g.TEXTURE3),d&&d.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE),this._depthFBO&&(v.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE),v.u_depth_size_inv=[1,1]),d&&d.useMeterToDem&&k){let z=(1<<k.tileID.canonical.z)*r.bl(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;v.u_meter_to_dem=z}if(d&&d.labelPlaneMatrixInv&&(v.u_label_plane_matrix_inv=d.labelPlaneMatrixInv),a.setTerrainUniformValues(p,v),this.painter.transform.projection.name==="globe"){let z=this.globeUniformValues(this.painter.transform,n.tileID.canonical,d&&d.useDenormalizedUpVectorScale);a.setGlobeUniformValues(p,z)}}globeUniformValues(n,a,d){let p=n.projection;return{u_tile_tl_up:p.upVector(a,0,0),u_tile_tr_up:p.upVector(a,r.V,0),u_tile_br_up:p.upVector(a,r.V,r.V),u_tile_bl_up:p.upVector(a,0,r.V),u_tile_up_scale:d?r.cl(1):p.upVectorScale(a,n.center.lat,n.worldSize).metersToTile}}renderToBackBuffer(n){let a=this.painter,d=this.painter.context;n.length!==0&&(d.bindFramebuffer.set(null),d.viewport.set([0,0,a.width,a.height]),a.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(p,g,v,k,S){if(p.transform.projection.name==="globe")(function(E,A,P,z,O){let U=E.context,V=U.gl,G,N,H=E.transform,Q=r.cd(E,U,H),W=(Ie,Te)=>{if(N===Te)return;let Be=[$u[Te],"PROJECTION_GLOBE_VIEW"];Q&&Be.push("CUSTOM_ANTIALIASING");let pe=E.isTileAffectedByFog(Ie);G=E.getOrCreateProgram("globeRaster",{defines:Be,overrideFog:pe}),N=Te},J=E.colorModeForRenderPass(),$=new Rt(V.LEQUAL,Rt.ReadWrite,E.depthRangeFor3D);zl.update(O);let ee=r.ce(H),oe=[r.a5(H.center.lng),r.ae(H.center.lat)],ae=E.globeSharedBuffers,ce=[H.width*r.f.devicePixelRatio,H.height*r.f.devicePixelRatio],be=Float32Array.from(H.globeMatrix),ue={useDenormalizedUpVectorScale:!0};{let Ie=E.transform,Te=qu(Ie.zoom,A.exaggeration(),A.sourceCache._source.tileSize);N=-1;let Be=V.TRIANGLES;for(let pe of z){let xe=P.getTile(pe),le=jt.disabled,ge=A.prevTerrainTileForTile[pe.key],Ne=A.terrainTileForTile[pe.key];Lc(ge,Ne)&&zl.newMorphing(pe.key,ge,Ne,O,250),U.activeTexture.set(V.TEXTURE0),xe.texture&&xe.texture.bind(V.LINEAR,V.CLAMP_TO_EDGE);let Ye=zl.getMorphValuesForProxy(pe.key),We=Ye?1:0;Ye&&r.j(ue,{morphing:{srcDemTile:Ye.from,dstDemTile:Ye.to,phase:r.cc(Ye.phase)}});let rt=r.cf(pe.canonical),_t=r.cg(rt.getCenter().lat),Et=r.ch(pe.canonical,rt,_t,Ie.worldSize/Ie._pixelsPerMercatorPixel),vt=r.aT(r.ci(pe.canonical)),Tt=If(Ie.expandedFarZProjMatrix,be,ee,vt,r.S(Ie.zoom),oe,Ie.frustumCorners.TL,Ie.frustumCorners.TR,Ie.frustumCorners.BR,Ie.frustumCorners.BL,Ie.globeCenterInViewSpace,Ie.globeRadius,ce,Te,Ie._farZ,Et);if(W(pe,We),G&&(A.setupElevationDraw(xe,G,ue),E.uploadCommonUniforms(U,G,pe.toUnwrapped()),ae)){let[Xt,Nt,qt]=ae.getGridBuffers(_t,Te!==0);G.draw(E,Be,$,le,J,Lt.backCCW,Tt,"globe_raster",Xt,Nt,qt)}}}if(ae&&(E.renderDefaultNorthPole||E.renderDefaultSouthPole)){let Ie=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];Q&&Ie.push("CUSTOM_ANTIALIASING"),G=E.getOrCreateProgram("globeRaster",{defines:Ie});for(let Te of z){let{x:Be,y:pe,z:xe}=Te.canonical,le=pe===0,ge=pe===(1<<xe)-1,[Ne,Ye,We,rt]=ae.getPoleBuffers(xe,!1);if(rt&&(le||ge)){let _t=P.getTile(Te);U.activeTexture.set(V.TEXTURE0),_t.texture&&_t.texture.bind(V.LINEAR,V.CLAMP_TO_EDGE);let Et=r.cj(xe,Be,H),vt=r.aT(r.ci(Te.canonical)),Tt=(Xt,Nt)=>Xt.draw(E,V.TRIANGLES,$,jt.disabled,J,Lt.disabled,If(H.expandedFarZProjMatrix,Et,Et,vt,0,oe,H.frustumCorners.TL,H.frustumCorners.TR,H.frustumCorners.BR,H.frustumCorners.BL,H.globeCenterInViewSpace,H.globeRadius,ce,0,H._farZ),"globe_pole_raster",Nt,We,rt);A.setupElevationDraw(_t,G,ue),E.uploadCommonUniforms(U,G,Te.toUnwrapped()),le&&E.renderDefaultNorthPole&&Tt(G,Ne),ge&&E.renderDefaultSouthPole&&(Et=r.a6.scale(r.a6.create(),Et,[1,-1,1]),Tt(G,Ye))}}}})(p,g,v,k,S);else{let E=p.context,A=E.gl,P,z,O=p.shadowRenderer,U=as(p,p.longestCutoffRange),V=J=>{if(z===J)return;let $=[];$.push($u[J]),U.shouldRenderCutoff&&$.push("RENDER_CUTOFF"),P=p.getOrCreateProgram("terrainRaster",{defines:$}),z=J},G=p.colorModeForRenderPass(),N=new Rt(A.LEQUAL,Rt.ReadWrite,p.depthRangeFor3D);zl.update(S);let H=p.transform,Q=qu(H.zoom,g.exaggeration(),g.sourceCache._source.tileSize),W=[0,0,0];if(O){let J=p.style.directionalLight,$=p.style.ambientLight;J&&$&&(W=Pc(J,$))}{z=-1;let J=A.TRIANGLES,[$,ee]=[g.gridIndexBuffer,g.gridSegments];for(let oe of k){let ae=v.getTile(oe),ce=jt.disabled,be=g.prevTerrainTileForTile[oe.key],ue=g.terrainTileForTile[oe.key];Lc(be,ue)&&zl.newMorphing(oe.key,be,ue,S,250),E.activeTexture.set(A.TEXTURE0),ae.texture&&ae.texture.bind(A.LINEAR,A.CLAMP_TO_EDGE);let Ie=zl.getMorphValuesForProxy(oe.key),Te=Ie?1:0,Be;Ie&&(Be={morphing:{srcDemTile:Ie.from,dstDemTile:Ie.to,phase:r.cc(Ie.phase)}});let pe=Zd(oe.projMatrix,Ol(oe.canonical,H.renderWorldCopies)?Q/10:Q,W);if(V(Te),!P)continue;g.setupElevationDraw(ae,P,Be);let xe=oe.toUnwrapped();O&&O.setupShadows(xe,P),p.uploadCommonUniforms(E,P,xe,null,U),P.draw(p,J,N,ce,G,Lt.backCCW,pe,"terrain_raster",g.gridBuffer,$,ee)}}}}(a,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,a.gpuTimingDeferredRenderEnd(),n.splice(0,n.length))}renderBatch(n){if(this._drapedRenderBatches.length===0)return n+1;this.renderingToTexture=!0;let a=this.painter,d=this.painter.context,p=this.proxySourceCache,g=this.proxiedCoords[p.id],v=this._drapedRenderBatches.shift(),k=a.style.order,S=[],E=0;for(let A of g){let P=p.getTileByID(A.proxyTileKey),z=p.proxyCachedFBO[A.key]?p.proxyCachedFBO[A.key][n]:void 0,O=z!==void 0?p.renderCache[z]:this.pool[E++],U=z!==void 0;if(P.texture=O.tex,U&&!O.dirty){S.push(P.tileID);continue}let V;d.bindFramebuffer.set(O.fb.framebuffer),this.renderedToTile=!1,O.dirty&&(d.clear({color:r.ax.transparent,stencil:0}),O.dirty=!1);for(let G=v.start;G<=v.end;++G){let N=a.style._mergedLayers[k[G]];if(N.isHidden(a.transform.zoom))continue;let H=a.style.getLayerSourceCache(N),Q=H?this.proxyToSource[A.key][H.id]:[A];if(!Q)continue;let W=Q;d.viewport.set([0,0,O.fb.width,O.fb.height]),V!==(H?H.id:null)&&(this._setupStencil(O,Q,N,H),V=H?H.id:null),a.renderLayer(a,H,N,W)}if(this._drapedRenderBatches.length===0)for(let G of this._pendingGroundEffectLayers){let N=a.style._mergedLayers[k[G]];if(N.isHidden(a.transform.zoom))continue;let H=a.style.getLayerSourceCache(N),Q=H?this.proxyToSource[A.key][H.id]:[A];if(!Q)continue;let W=Q;d.viewport.set([0,0,O.fb.width,O.fb.height]),V!==(H?H.id:null)&&(this._setupStencil(O,Q,N,H),V=H?H.id:null),a.renderLayer(a,H,N,W)}this.renderedToTile?(O.dirty=!0,S.push(P.tileID)):U||--E,E===5&&(E=0,this.renderToBackBuffer(S))}return this.renderToBackBuffer(S),this.renderingToTexture=!1,d.bindFramebuffer.set(null),d.viewport.set([0,0,a.width,a.height]),v.end+1}postRender(){}isLayerOrderingCorrect(n){let a=n.order.length,d=-1,p=a;for(let g=0;g<a;++g)this._style.isLayerDraped(n._mergedLayers[n.order[g]])?d=Math.max(d,g):p=Math.min(p,g);return p>d}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter(a=>a.dem).forEach(a=>{n=Math.min(n,a.dem.tree.minimums[0])}),n===0?n:(n-30)*this._exaggeration}raycast(n,a,d){if(!this._visibleDemTiles)return null;let p=this._visibleDemTiles.filter(g=>g.dem).map(g=>{let v=g.tileID,k=1<<v.overscaledZ,{x:S,y:E}=v.canonical,A=S/k,P=(S+1)/k,z=E/k,O=(E+1)/k;return{minx:A,miny:z,maxx:P,maxy:O,t:g.dem.tree.raycastRoot(A,z,P,O,n,a,d),tile:g}});p.sort((g,v)=>(g.t!==null?g.t:Number.MAX_VALUE)-(v.t!==null?v.t:Number.MAX_VALUE));for(let g of p){if(g.t==null)return null;let v=g.tile.dem.tree.raycast(g.minx,g.miny,g.maxx,g.maxy,n,a,d);if(v!=null)return v}return null}_createFBO(){let n=this.painter.context,a=n.gl,d=this.drapeBufferSize;n.activeTexture.set(a.TEXTURE0);let p=new r.T(n,{width:d[0],height:d[1],data:null},a.RGBA);p.bind(a.LINEAR,a.CLAMP_TO_EDGE);let g=n.createFramebuffer(d[0],d[1],!0,null);return g.colorAttachment.set(p.texture),g.depthAttachment=new no(n,g.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,d[0],d[1]),this._stencilRef=0,g.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):g.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&a.texParameterf(a.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:g,tex:p,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(let n in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[n].hasTransition())return!0;return this._style.order.some(n=>{let a=this._style._mergedLayers[n],d=a.isHidden(this.painter.transform.zoom);return a.type==="custom"?!d&&a.shouldRedrape():!d&&a.hasTransition()})}_clearLineLayersFromRenderCache(){let n=!1;for(let d of this._style.getSources())if(d instanceof ot){n=!0;break}if(!n)return;let a={};for(let d=0;d<this._style.order.length;++d){let p=this._style._mergedLayers[this._style.order[d]],g=this._style.getLayerSourceCache(p);if(g&&!a[g.id]&&!p.isHidden(this.painter.transform.zoom)&&p.type==="line"&&p.widthExpression()instanceof r.Z){a[g.id]=!0;for(let v of this.proxyCoords){let k=this.proxyToSource[v.key][g.id];if(k)for(let S of k)this._clearRenderCacheForTile(g.id,S)}}}}_clearRasterLayersFromRenderCache(){let n=!1;for(let d in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[d]._source instanceof at){n=!0;break}if(!n)return;let a={};for(let d=0;d<this._style.order.length;++d){let p=this._style._mergedLayers[this._style.order[d]],g=this._style.getLayerSourceCache(p);if(!g||a[g.id]||p.isHidden(this.painter.transform.zoom)||p.type!=="raster")continue;let v=p.paint.get("raster-fade-duration");for(let k of this.proxyCoords){let S=this.proxyToSource[k.key][g.id];if(S)for(let E of S){let A=Zu(g.getTile(E),g.findLoadedParent(E,0),g,this.painter.transform,v);(A.opacity!==1||A.mix!==0)&&this._clearRenderCacheForTile(g.id,E)}}}}_setupDrapedRenderBatches(){let n=this._style.order,a=n.length;if(a===0)return;let d=[];this._pendingGroundEffectLayers=[];let p,g=0,v=this._style._mergedLayers[n[g]];for(;!this._style.isLayerDraped(v)&&v.isHidden(this.painter.transform.zoom)&&++g<a;)v=this._style._mergedLayers[n[g]];for(;g<a;++g){let k=this._style._mergedLayers[n[g]];k.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(k)?p===void 0&&(p=g):(k.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(g),p!==void 0&&(d.push({start:p,end:g-1}),p=void 0)))}if(p!==void 0&&d.push({start:p,end:g-1}),d.length!==0){let k=d[d.length-1];this._pendingGroundEffectLayers.every(S=>S>k.end)||r.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=d}_setupRenderCache(n){let a=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,a.renderCache.length>a.renderCachePool.length){let v=Object.values(a.proxyCachedFBO);a.proxyCachedFBO={};for(let k=0;k<v.length;++k){let S=Object.values(v[k]);a.renderCachePool.push(...S)}}return}this._clearRasterLayersFromRenderCache();let d=this.proxyCoords,p=this._tilesDirty;for(let v=d.length-1;v>=0;v--){let k=d[v];if(a.getTileByID(k.key),a.proxyCachedFBO[k.key]!==void 0){let S=n[k.key],E=this.proxyToSource[k.key],A=0;for(let P in E){let z=E[P],O=S[P];if(!O||O.length!==z.length||z.some((U,V)=>U!==O[V]||p[P]&&p[P].hasOwnProperty(U.key))){A=-1;break}++A}for(let P in a.proxyCachedFBO[k.key])a.renderCache[a.proxyCachedFBO[k.key][P]].dirty=A<0||A!==Object.values(S).length}}let g=[...this._drapedRenderBatches];g.sort((v,k)=>k.end-k.start-(v.end-v.start));for(let v of g)for(let k of d){if(a.proxyCachedFBO[k.key])continue;let S=a.renderCachePool.pop();S===void 0&&a.renderCache.length<50&&(S=a.renderCache.length,a.renderCache.push(this._createFBO())),S!==void 0&&(a.proxyCachedFBO[k.key]={},a.proxyCachedFBO[k.key][v.start]=S,a.renderCache[S].dirty=!0)}this._tilesDirty={}}_setupStencil(n,a,d,p){if(!p||!this._sourceTilesOverlap[p.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));let g=this.painter.context,v=g.gl;if(a.length<=1)return void(this._overlapStencilType=!1);let k;if(d.isTileClipped())k=a.length,this._overlapStencilMode.test={func:v.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(a[0].overscaledZ>a[a.length-1].overscaledZ))return void(this._overlapStencilType=!1);k=1,this._overlapStencilMode.test={func:v.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+k>255&&(g.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=k,this._overlapStencilMode.ref=this._stencilRef,d.isTileClipped()&&this._renderTileClippingMasks(a,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[n.key]),this._overlapStencilMode):jt.disabled}_renderTileClippingMasks(n,a){let d=this.painter,p=this.painter.context,g=p.gl;d._tileClippingMaskIDs={},p.setColorMode(ri.disabled),p.setDepthMode(Rt.disabled);let v=d.getOrCreateProgram("clippingMask");for(let k of n){let S=d._tileClippingMaskIDs[k.key]=--a;v.draw(d,g.TRIANGLES,Rt.disabled,new jt({func:g.ALWAYS,mask:0},S,255,g.KEEP,g.KEEP,g.REPLACE),ri.disabled,Lt.disabled,Hu(k.projMatrix),"$clipping",d.tileExtentBuffer,d.quadTriangleIndexBuffer,d.tileExtentSegments)}}pointCoordinate(n){let a=this.painter.transform;if(n.x<0||n.x>a.width||n.y<0||n.y>a.height)return null;let d=[n.x,n.y,1,1];r.a7.transformMat4(d,d,a.pixelMatrixInverse),r.a7.scale(d,d,1/d[3]),d[0]/=a.worldSize,d[1]/=a.worldSize;let p=a._camera.position,g=r.bl(1,a.center.lat),v=[p[0],p[1],p[2]/g,0],k=r.N.subtract([],d.slice(0,3),v);r.N.normalize(k,k);let S=this.raycast(v,k,this._exaggeration);return S!==null&&S?(r.N.scaleAndAdd(v,v,k,S),v[3]=v[2],v[2]*=g,v):null}drawDepth(){let n=this.painter,a=n.context,d=this.proxySourceCache,p=Math.ceil(n.width),g=Math.ceil(n.height);if(!this._depthFBO||this._depthFBO.width===p&&this._depthFBO.height===g||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){let v=a.gl,k=a.createFramebuffer(p,g,!0,"renderbuffer");a.activeTexture.set(v.TEXTURE0);let S=new r.T(a,{width:p,height:g,data:null},v.RGBA);S.bind(v.NEAREST,v.CLAMP_TO_EDGE),k.colorAttachment.set(S.texture);let E=a.createRenderbuffer(a.gl.DEPTH_COMPONENT16,p,g);k.depthAttachment.set(E),this._depthFBO=k,this._depthTexture=S}a.bindFramebuffer.set(this._depthFBO.framebuffer),a.viewport.set([0,0,p,g]),function(v,k,S,E){if(v.transform.projection.name==="globe")return;let A=v.context,P=A.gl;A.clear({depth:1});let z=v.getOrCreateProgram("terrainDepth"),O=new Rt(P.LESS,Rt.ReadWrite,v.depthRangeFor3D);for(let U of E){let V=S.getTile(U),G=Zd(U.projMatrix,0,[0,0,0]);k.setupElevationDraw(V,z),z.draw(v,P.TRIANGLES,O,jt.disabled,ri.unblended,Lt.backCCW,G,"terrain_depth",k.gridBuffer,k.gridIndexBuffer,k.gridNoSkirtSegments)}}(n,this,d,this.proxyCoords)}_setupProxiedCoordsForOrtho(n,a,d){if(n.getSource()instanceof r.ap)return this._setupProxiedCoordsForImageSource(n,a,d);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};let p=this.proxiedCoords[n.id]=[],g=this.proxyCoords;for(let S=0;S<g.length;S++){let E=g[S],A=this._findTileCoveringTileID(E,n);if(A){let P=this._createProxiedId(E,A,d[E.key]&&d[E.key][n.id]);p.push(P),this.proxyToSource[E.key][n.id]=[P]}}let v=!1,k=new Set;for(let S=0;S<a.length;S++){let E=n.getTile(a[S]);if(!E||!E.hasData())continue;let A=this._findTileCoveringTileID(E.tileID,this.proxySourceCache);if(A&&A.tileID.canonical.z!==E.tileID.canonical.z){let P=this.proxyToSource[A.tileID.key][n.id],z=this._createProxiedId(A.tileID,E,d[A.tileID.key]&&d[A.tileID.key][n.id]);P?P.splice(P.length-1,0,z):this.proxyToSource[A.tileID.key][n.id]=[z];let O=this.proxyToSource[A.tileID.key][n.id];k.has(O)||k.add(O),p.push(z),v=!0}}if(this._sourceTilesOverlap[n.id]=v,v&&this._debugParams.sortTilesHiZFirst)for(let S of k)S.sort((E,A)=>A.overscaledZ-E.overscaledZ)}_setupProxiedCoordsForImageSource(n,a,d){if(!n.getSource().loaded())return;let p=this.proxiedCoords[n.id]=[],g=this.proxyCoords,v=n.getSource(),k=v.tileID;if(!k)return;let S=new r.P(k.x,k.y)._div(1<<k.z),E=v.coordinates.map(r.L.fromLngLat).reduce((P,z)=>(P.min.x=Math.min(P.min.x,z.x-S.x),P.min.y=Math.min(P.min.y,z.y-S.y),P.max.x=Math.max(P.max.x,z.x-S.x),P.max.y=Math.max(P.max.y,z.y-S.y),P),{min:new r.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new r.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),A=(P,z)=>{let O=P.wrap+P.canonical.x/(1<<P.canonical.z),U=P.canonical.y/(1<<P.canonical.z),V=r.V/(1<<P.canonical.z),G=z.wrap+z.canonical.x/(1<<z.canonical.z),N=z.canonical.y/(1<<z.canonical.z);return O+V<G+E.min.x||O>G+E.max.x||U+V<N+E.min.y||U>N+E.max.y};for(let P=0;P<g.length;P++){let z=g[P];for(let O=0;O<a.length;O++){let U=n.getTile(a[O]);if(!U||!U.hasData()||A(z,U.tileID))continue;let V=this._createProxiedId(z,U,d[z.key]&&d[z.key][n.id]),G=this.proxyToSource[z.key][n.id];G?G.push(V):this.proxyToSource[z.key][n.id]=[V],p.push(V)}}}_createProxiedId(n,a,d){let p=this.orthoMatrix;if(d){let g=d.find(v=>v.key===a.tileID.key);if(g)return g}if(a.tileID.key!==n.key){let g=n.canonical.z-a.tileID.canonical.z,v,k,S;p=r.a6.create();let E=a.tileID.wrap-n.wrap<<n.overscaledZ;g>0?(v=r.V>>g,k=v*((a.tileID.canonical.x<<g)-n.canonical.x+E),S=v*((a.tileID.canonical.y<<g)-n.canonical.y)):(v=r.V<<-g,k=r.V*(a.tileID.canonical.x-(n.canonical.x+E<<-g)),S=r.V*(a.tileID.canonical.y-(n.canonical.y<<-g))),r.a6.ortho(p,0,v,0,v,0,1),r.a6.translate(p,p,[k,S,0])}return new Sf(a.tileID,n.key,p)}_findTileCoveringTileID(n,a){let d=a.getTile(n);if(d&&d.hasData())return d;let p=this._findCoveringTileCache[a.id],g=p[n.key];if(d=g?a.getTileByID(g):null,d&&d.hasData()||g===null)return d;let v=d?d.tileID:n,k=v.overscaledZ,S=a.getSource().minzoom,E=[];if(!g){let P=a.getSource().maxzoom;if(n.canonical.z>=P){let z=n.canonical.z-P;a.getSource().reparseOverscaled?(k=Math.max(n.canonical.z+2,a.transform.tileZoom),v=new r.am(k,n.wrap,P,n.canonical.x>>z,n.canonical.y>>z)):z!==0&&(k=P,v=new r.am(k,n.wrap,P,n.canonical.x>>z,n.canonical.y>>z))}v.key!==n.key&&(E.push(v.key),d=a.getTile(v))}let A=P=>{E.forEach(z=>{p[z]=P}),E.length=0};for(k-=1;k>=S&&(!d||!d.hasData());k--){d&&A(d.tileID.key);let P=v.calculateScaledKey(k);if(d=a.getTileByID(P),d&&d.hasData())break;let z=p[P];if(z===null)break;z===void 0?E.push(P):d=a.getTileByID(z)}return A(d?d.tileID.key:null),d&&d.hasData()?d:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(n,a){let d=this._tilesDirty[n];d||(d=this._tilesDirty[n]={}),d[a.key]=!0}}function Wu(c,n,a){let d=function(k,S,E){let A=r.N.dot(S,k),P=r.N.dot(E,[.2126,.7152,.0722]),z=(U,V,G)=>(1-G)*U+G*V,O=z(1-.3*Math.min(P,1),1,Math.min(A+1,1));return z(.92,1,Math.asin(r.aa(S[2],-1,1))/Math.PI+.5)*O}(c,[0,0,1],n),p=[0,0,0];r.N.scale(p,a.slice(0,3),d);let g=[0,0,0];r.N.scale(g,n.slice(0,3),c[2]);let v=[0,0,0];return r.N.add(v,p,g),r.bU(v)}let Xu=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Cf=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class Yu{static cacheKey(n,a,d,p){let g=`${a}${p?p.cacheKey:""}`;for(let v of d)n.usedDefines.includes(v)&&(g+=`/${v}`);return g}constructor(n,a,d,p,g,v,k){let S=n.gl;this.program=S.createProgram(),this.configuration=p,this.name=a,this.fixedDefines=[...v];let E=p?p.getBinderAttributes():[],A=(d.staticAttributes||[]).concat(E),P=p?p.defines():[];P=P.concat(v.map(N=>`#define ${N}`));let z=`#version 300 es
`,O=z+P.concat("precision mediump float;",qd,ju.fragmentSource).join(`
`);for(let N of d.fragmentIncludes)O+=`
${yo[N]}`;O+=`
${d.fragmentSource}`;let U=z+P.concat("precision highp float;",qd,ju.vertexSource).join(`
`);for(let N of d.vertexIncludes)U+=`
${yo[N]}`;U+=`
${d.vertexSource}`;let V=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(V,O),S.compileShader(V),S.attachShader(this.program,V);let G=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())this.failedToCreate=!0;else{S.shaderSource(G,U),S.compileShader(G),S.attachShader(this.program,G),this.attributes={},this.numAttributes=A.length;for(let N=0;N<this.numAttributes;N++)if(A[N]){let H=A[N].startsWith("a_")?A[N]:`a_${A[N]}`;S.bindAttribLocation(this.program,N,H),this.attributes[H]=N}k&&k.shaderVaryings.length>0&&S.transformFeedbackVaryings(this.program,k.shaderVaryings,k.bufferMode),S.linkProgram(this.program),S.deleteShader(G),S.deleteShader(V),this.fixedUniforms=g(n),this.binderUniforms=p?p.getUniforms(n):[],v.includes("TERRAIN")&&(this.terrainUniforms=(N=>({u_dem:new r.bO(N),u_dem_prev:new r.bO(N),u_dem_tl:new r.bL(N),u_dem_scale:new r.bN(N),u_dem_tl_prev:new r.bL(N),u_dem_scale_prev:new r.bN(N),u_dem_size:new r.bN(N),u_dem_lerp:new r.bN(N),u_exaggeration:new r.bN(N),u_depth:new r.bO(N),u_depth_size_inv:new r.bL(N),u_meter_to_dem:new r.bN(N),u_label_plane_matrix_inv:new r.bK(N)}))(n)),v.includes("GLOBE")&&(this.globeUniforms=(N=>({u_tile_tl_up:new r.bM(N),u_tile_tr_up:new r.bM(N),u_tile_br_up:new r.bM(N),u_tile_bl_up:new r.bM(N),u_tile_up_scale:new r.bN(N)}))(n)),v.includes("FOG")&&(this.fogUniforms=(N=>({u_fog_matrix:new r.bK(N),u_fog_range:new r.bL(N),u_fog_color:new r.bP(N),u_fog_horizon_blend:new r.bN(N),u_fog_vertical_limit:new r.bL(N),u_fog_temporal_offset:new r.bN(N),u_frustum_tl:new r.bM(N),u_frustum_tr:new r.bM(N),u_frustum_br:new r.bM(N),u_frustum_bl:new r.bM(N),u_globe_pos:new r.bM(N),u_globe_radius:new r.bN(N),u_globe_transition:new r.bN(N),u_is_globe:new r.bO(N),u_viewport:new r.bL(N)}))(n)),v.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(N=>({u_cutoff_params:new r.bP(N)}))(n)),v.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(N=>({u_lighting_ambient_color:new r.bM(N),u_lighting_directional_dir:new r.bM(N),u_lighting_directional_color:new r.bM(N),u_ground_radiance:new r.bM(N)}))(n)),v.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(N=>({u_light_matrix_0:new r.bK(N),u_light_matrix_1:new r.bK(N),u_fade_range:new r.bL(N),u_shadow_normal_offset:new r.bM(N),u_shadow_intensity:new r.bN(N),u_shadow_texel_size:new r.bN(N),u_shadow_map_resolution:new r.bN(N),u_shadow_direction:new r.bM(N),u_shadow_bias:new r.bM(N),u_shadowmap_0:new r.bO(N),u_shadowmap_1:new r.bO(N)}))(n))}}setTerrainUniformValues(n,a){if(!this.terrainUniforms)return;let d=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(let p in a)d[p]&&d[p].set(this.program,p,a[p])}}setGlobeUniformValues(n,a){if(!this.globeUniforms)return;let d=this.globeUniforms;if(!this.failedToCreate){n.program.set(this.program);for(let p in a)d[p]&&d[p].set(this.program,p,a[p])}}setFogUniformValues(n,a){if(!this.fogUniforms)return;let d=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(let p in a)d[p].set(this.program,p,a[p])}}setCutoffUniformValues(n,a){if(!this.cutoffUniforms)return;let d=this.cutoffUniforms;if(!this.failedToCreate){n.program.set(this.program);for(let p in a)d[p].set(this.program,p,a[p])}}setLightsUniformValues(n,a){if(!this.lightsUniforms)return;let d=this.lightsUniforms;if(!this.failedToCreate){n.program.set(this.program);for(let p in a)d[p].set(this.program,p,a[p])}}setShadowUniformValues(n,a){if(this.failedToCreate||!this.shadowUniforms)return;let d=this.shadowUniforms;n.program.set(this.program);for(let p in a)d[p].set(this.program,p,a[p])}_drawDebugWireframe(n,a,d,p,g,v,k,S,E,A){let P=n.options.wireframe;if(P.terrain===!1&&P.layers2D===!1&&P.layers3D===!1)return;let z=n.context;if(!(!(!P.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!P.layers2D||n._terrain&&n._terrain.renderingToTexture||!Xu.includes(this.name))||!(!P.layers3D||!Cf.includes(this.name))))return;let O=z.gl,U=n.wireframeDebugCache.getLinesFromTrianglesBuffer(n.frameCounter,g,z);if(!U)return;let V=[...this.fixedDefines];V.push("DEBUG_WIREFRAME");let G=n.getOrCreateProgram(this.name,{config:this.configuration,defines:V});z.program.set(G.program);let N=(W,J,$)=>{if(J[W]&&$[W])for(let ee in J[W])$[W][ee]&&$[W][ee].set($.program,ee,J[W][ee].current)};E&&E.setUniforms(G.program,z,G.binderUniforms,k,{zoom:S}),N("fixedUniforms",this,G),N("terrainUniforms",this,G),N("globeUniforms",this,G),N("fogUniforms",this,G),N("lightsUniforms",this,G),N("shadowUniforms",this,G),U.bind(),z.setColorMode(new ri([O.ONE,O.ONE_MINUS_SRC_ALPHA,O.ZERO,O.ONE],r.ax.transparent,[!0,!0,!0,!1])),z.setDepthMode(new Rt(a.func===O.LESS?O.LEQUAL:a.func,Rt.ReadOnly,a.range)),z.setStencilMode(jt.disabled);let H=3*v.primitiveLength*2,Q=3*v.primitiveOffset*2*2;A&&A>1?O.drawElementsInstanced(O.LINES,H,O.UNSIGNED_SHORT,Q,A):O.drawElements(O.LINES,H,O.UNSIGNED_SHORT,Q),g.bind(),z.program.set(this.program),z.setDepthMode(a),z.setStencilMode(d),z.setColorMode(p)}draw(n,a,d,p,g,v,k,S,E,A,P,z,O,U,V,G,N){let H=n.context,Q=H.gl;if(this.failedToCreate)return;H.program.set(this.program),H.setDepthMode(d),H.setStencilMode(p),H.setColorMode(g),H.setCullFace(v);for(let ee of Object.keys(this.fixedUniforms))this.fixedUniforms[ee].set(this.program,ee,k[ee]);U&&U.setUniforms(this.program,H,this.binderUniforms,z,{zoom:O});let W={[Q.POINTS]:1,[Q.LINES]:2,[Q.TRIANGLES]:3,[Q.LINE_STRIP]:1}[a],J=N&&N.length>0;if(J){for(let ee of N)Q.bindBufferBase(Q.TRANSFORM_FEEDBACK_BUFFER,ee.targetIndex,ee.buffer.buffer);Q.beginTransformFeedback(a)}let $=G&&G>0?1:void 0;for(let ee of P.get()){let oe=ee.vaos||(ee.vaos={});(oe[S]||(oe[S]=new Uu)).bind(H,this,E,U?U.getPaintVertexBuffers():[],A,ee.vertexOffset,V||[],$),G&&G>1?Q.drawElementsInstanced(a,ee.primitiveLength*W,Q.UNSIGNED_SHORT,ee.primitiveOffset*W*2,G):A?Q.drawElements(a,ee.primitiveLength*W,Q.UNSIGNED_SHORT,ee.primitiveOffset*W*2):Q.drawArrays(a,ee.vertexOffset,ee.vertexLength),a===Q.TRIANGLES&&A&&this._drawDebugWireframe(n,d,p,g,A,ee,z,O,U,G)}J&&Q.endTransformFeedback()}}function Ku(c,n){let a=Math.pow(2,n.tileID.overscaledZ),d=n.tileSize*Math.pow(2,c.transform.tileZoom)/a,p=d*(n.tileID.canonical.x+n.tileID.wrap*a),g=d*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/r.a3(n,1,c.transform.tileZoom),u_pixel_coord_upper:[p>>16,g>>16],u_pixel_coord_lower:[65535&p,65535&g]}}let Mf=r.a6.create(),Qu=(c,n,a,d,p,g,v,k,S,E,A,P,z,O,U,V)=>{let G=n.style.light,N=G.properties.get("position"),H=[N.x,N.y,N.z],Q=r.co.create();G.properties.get("anchor")==="viewport"&&(r.co.fromRotation(Q,-n.transform.angle),r.N.transformMat3(H,H,Q));let W=G.properties.get("color"),J=n.transform,$={u_matrix:c,u_lightpos:H,u_lightintensity:G.properties.get("intensity"),u_lightcolor:[W.r,W.g,W.b],u_vertical_gradient:+a,u_opacity:d,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Mf,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:p,u_edge_radius:g,u_flood_light_color:P,u_vertical_scale:z,u_flood_light_intensity:O,u_ground_shadow_factor:U,u_emissive_strength:V};return J.projection.name==="globe"&&($.u_tile_id=[v.canonical.x,v.canonical.y,1<<v.canonical.z],$.u_zoom_transition=S,$.u_inv_rot_matrix=A,$.u_merc_center=E,$.u_up_dir=J.projection.upVector(new r.bs(0,0,0),E[0]*r.V,E[1]*r.V),$.u_height_lift=k),$},Ju=(c,n,a)=>({u_matrix:c,u_edge_radius:n,u_vertical_scale:a}),Zs=(c,n,a,d,p,g,v,k,S,E,A,P,z,O)=>{let U=Qu(c,n,a,d,p,g,v,S,E,A,P,z,O,1,[0,0,0],0),V={u_height_factor:-Math.pow(2,v.overscaledZ)/k.tileSize/8};return r.e(U,Ku(n,k),V)},Fl=(c,n)=>({u_matrix:c,u_emissive_strength:n}),em=(c,n,a,d)=>r.e(Fl(c,n),Ku(a,d)),Ws=(c,n,a)=>({u_matrix:c,u_world:a,u_emissive_strength:n}),Ef=(c,n,a,d,p)=>r.e(em(c,n,a,d),{u_world:p}),Wd=(c,n,a,d)=>{let p=r.V/a.tileSize;return{u_matrix:c,u_camera_to_center_distance:n.getCameraToCenterDistance(d),u_extrude_scale:[n.pixelsToGLUnits[0]/p,n.pixelsToGLUnits[1]/p]}},tm=(c,n,a=1)=>({u_matrix:c,u_color:n,u_overlay:0,u_overlay_scale:a}),Af=r.a6.create(),im=(c,n,a,d,p,g,v)=>{let k=c.transform,S=k.projection.name==="globe",E=S?r.cp(k.zoom,n.canonical)*k._pixelsPerMercatorPixel:r.a3(a,1,g),A={u_matrix:n.projMatrix,u_extrude_scale:E,u_intensity:v,u_inv_rot_matrix:Af,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(S){A.u_inv_rot_matrix=d,A.u_merc_center=p,A.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],A.u_zoom_transition=r.S(k.zoom);let P=p[0]*r.V,z=p[1]*r.V;A.u_up_dir=k.projection.upVector(new r.bs(0,0,0),P,z)}return A};function Xd(c,[n,a,d,p],[g,v]){if(g===v)return[0,0,0,0];let k=255*(c-1)/(c*(v-g));return[n*k,a*k,d*k,p*k]}function Df(c,n,[a,d]){return a===d?0:.5/c+(n-a)*(c-1)/(c*(d-a))}let nm=(c,n,a,d,p,g,v,k,S,E,A,P,z,O,U,V,G,N,H,Q,W)=>{return{u_matrix:c,u_normalize_matrix:n,u_globe_matrix:a,u_merc_matrix:d,u_grid_matrix:p,u_tl_parent:g,u_scale_parent:E,u_fade_t:A.mix,u_opacity:A.opacity*P.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:P.paint.get("raster-brightness-min"),u_brightness_high:P.paint.get("raster-brightness-max"),u_saturation_factor:($=P.paint.get("raster-saturation"),$>0?1-1/(1.001-$):-$),u_contrast_factor:(J=P.paint.get("raster-contrast"),J>0?1/(1-J):1+J),u_spin_weights:zc(P.paint.get("raster-hue-rotate")),u_perspective_transform:z,u_raster_elevation:O,u_zoom_transition:v,u_merc_center:k,u_cutoff_params:S,u_colorization_mix:Xd(r.cq,V,N),u_colorization_offset:Df(r.cq,G,N),u_color_ramp:U,u_texture_offset:[Q/(H+2*Q),H/(H+2*Q)],u_texture_res:[H+2*Q,H+2*Q],u_emissive_strength:W};var J,$};function zc(c){c*=Math.PI/180;let n=Math.sin(c),a=Math.cos(c);return[(2*a+1)/3,(-Math.sqrt(3)*n-a+1)/3,(Math.sqrt(3)*n-a+1)/3]}let M0=(c,n,a,d,p,g,v,k,S,E,A,P)=>({u_matrix:c,u_normalize_matrix:n,u_globe_matrix:a,u_merc_matrix:d,u_grid_matrix:p,u_tl_parent:g,u_scale_parent:E,u_fade_t:A.mix,u_opacity:A.opacity,u_image0:0,u_image1:1,u_raster_elevation:P,u_zoom_transition:v,u_merc_center:k,u_cutoff_params:S}),E0=(c,n,a,d,p,g,v,k)=>({u_tile_offset:c,u_velocity:n,u_color_ramp:d,u_velocity_res:a,u_max_speed:p,u_texture_offset:g,u_data_scale:v,u_data_offset:k}),Pf=(c,n,a,d,p,g,v,k)=>({u_velocity:c,u_velocity_res:n,u_max_speed:a,u_speed_factor:d,u_lifetime_delta:p,u_rand_seed:Math.random(),u_texture_offset:g,u_data_scale:v,u_data_offset:k}),Rf=r.a6.create(),Yd=(c,n,a,d,p,g,v,k,S,E,A,P,z,O,U,V,G,N)=>{let H=p.transform,Q={u_is_size_zoom_constant:+(c==="constant"||c==="source"),u_is_size_feature_constant:+(c==="constant"||c==="camera"),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:H.getCameraToCenterDistance(V),u_rotate_symbol:+a,u_aspect_ratio:H.width/H.height,u_fade_change:p.options.fadeDuration?p.symbolFadeChange:1,u_matrix:g,u_label_plane_matrix:v,u_coord_matrix:k,u_is_text:+S,u_pitch_with_map:+d,u_texsize:E,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Rf,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Rf,u_up_vector:[0,-1,0],u_icon_transition:N||0,u_icon_saturation:G};return V.name==="globe"&&(Q.u_tile_id=[A.canonical.x,A.canonical.y,1<<A.canonical.z],Q.u_zoom_transition=P,Q.u_inv_rot_matrix=O,Q.u_merc_center=z,Q.u_camera_forward=H._camera.forward(),Q.u_ecef_origin=r.cr(H.globeMatrix,A.toUnwrapped()),Q.u_tile_matrix=Float32Array.from(H.globeMatrix),Q.u_up_vector=U),Q},Oc=(c,n,a,d,p,g,v,k,S,E,A,P,z,O,U,V,G)=>r.e(Yd(c,n,a,d,p,g,v,k,S,E,P,z,O,U,V,G,1),{u_gamma_scale:d?p.transform.getCameraToCenterDistance(G)*Math.cos(p.terrain?0:p.transform._pitch):1,u_device_pixel_ratio:r.f.devicePixelRatio,u_is_halo:+A,undefined:void 0}),Kd=(c,n,a,d,p,g,v,k,S,E,A,P,z,O,U,V)=>r.e(Oc(c,n,a,d,p,g,v,k,!0,S,!0,A,P,z,O,U,V),{u_texsize_icon:E,u_texture_icon:1}),rm=(c,n,a,d)=>({u_matrix:c,u_emissive_strength:n,u_opacity:a,u_color:d}),Fc=(c,n,a,d,p,g,v)=>r.e(function(k,S,E,A){let P=E.imageManager.getPattern(k.toString(),S),{width:z,height:O}=E.imageManager.getPixelSize(S),U=Math.pow(2,A.tileID.overscaledZ),V=A.tileSize*Math.pow(2,E.transform.tileZoom)/U,G=V*(A.tileID.canonical.x+A.tileID.wrap*U),N=V*A.tileID.canonical.y;return{u_image:0,u_pattern_tl:P.tl,u_pattern_br:P.br,u_texsize:[z,O],u_pattern_size:P.displaySize,u_tile_units_to_pixels:1/r.a3(A,1,E.transform.tileZoom),u_pixel_coord_upper:[G>>16,N>>16],u_pixel_coord_lower:[65535&G,65535&N]}}(p,g,d,v),{u_matrix:c,u_emissive_strength:n,u_opacity:a}),Qd=(c,n,a,d,p,g,v,k,S,E,A,P,z=[0,0,0],O)=>{let U=d.style.light,V=U.properties.get("position"),G=[-V.x,-V.y,V.z],N=r.co.create();U.properties.get("anchor")==="viewport"&&(r.co.fromRotation(N,-d.transform.angle),r.N.transformMat3(G,G,N));let H=E.alphaMode==="MASK",Q=U.properties.get("color"),W=P.paint.get("model-ambient-occlusion-intensity"),J=P.paint.get("model-color").constantOr(r.ax.white),$=P.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:c,u_lighting_matrix:n,u_normal_matrix:a,u_lightpos:G,u_lightintensity:U.properties.get("intensity"),u_lightcolor:[Q.r,Q.g,Q.b],u_camera_pos:z,u_opacity:p,u_baseTextureIsAlpha:0,u_alphaMask:+H,u_alphaCutoff:E.alphaCutoff,u_baseColorFactor:[g.r,g.g,g.b,g.a],u_emissiveFactor:[v[0],v[1],v[2],1],u_metallicFactor:k,u_roughnessFactor:S,u_baseColorTexture:Ir.BaseColor,u_metallicRoughnessTexture:Ir.MetallicRoughness,u_normalTexture:Ir.Normal,u_occlusionTexture:Ir.Occlusion,u_emissionTexture:Ir.Emission,u_color_mix:[J.r,J.g,J.b,$],u_aoIntensity:W,u_emissive_strength:A,u_occlusionTextureTransform:O||[0,0,0,0]}},Bc=new Float32Array(16),Nc=(c,n=Bc,a=Bc)=>({u_matrix:c,u_instance:n,u_node_matrix:a}),A0={fillExtrusion:c=>({u_matrix:new r.bK(c),u_lightpos:new r.bM(c),u_lightintensity:new r.bN(c),u_lightcolor:new r.bM(c),u_vertical_gradient:new r.bN(c),u_opacity:new r.bN(c),u_edge_radius:new r.bN(c),u_ao:new r.bL(c),u_tile_id:new r.bM(c),u_zoom_transition:new r.bN(c),u_inv_rot_matrix:new r.bK(c),u_merc_center:new r.bL(c),u_up_dir:new r.bM(c),u_height_lift:new r.bN(c),u_flood_light_color:new r.bM(c),u_vertical_scale:new r.bN(c),u_flood_light_intensity:new r.bN(c),u_ground_shadow_factor:new r.bM(c),u_emissive_strength:new r.bN(c)}),fillExtrusionDepth:c=>({u_matrix:new r.bK(c),u_edge_radius:new r.bN(c),u_vertical_scale:new r.bN(c)}),fillExtrusionPattern:c=>({u_matrix:new r.bK(c),u_lightpos:new r.bM(c),u_lightintensity:new r.bN(c),u_lightcolor:new r.bM(c),u_vertical_gradient:new r.bN(c),u_height_factor:new r.bN(c),u_edge_radius:new r.bN(c),u_ao:new r.bL(c),u_tile_id:new r.bM(c),u_zoom_transition:new r.bN(c),u_inv_rot_matrix:new r.bK(c),u_merc_center:new r.bL(c),u_up_dir:new r.bM(c),u_height_lift:new r.bN(c),u_image:new r.bO(c),u_texsize:new r.bL(c),u_pixel_coord_upper:new r.bL(c),u_pixel_coord_lower:new r.bL(c),u_tile_units_to_pixels:new r.bN(c),u_opacity:new r.bN(c)}),fillExtrusionGroundEffect:c=>({u_matrix:new r.bK(c),u_opacity:new r.bN(c),u_ao_pass:new r.bN(c),u_meter_to_tile:new r.bN(c),u_ao:new r.bL(c),u_flood_light_intensity:new r.bN(c),u_flood_light_color:new r.bM(c),u_attenuation:new r.bN(c),u_edge_radius:new r.bN(c),u_fb:new r.bO(c),u_fb_size:new r.bN(c)}),fill:c=>({u_matrix:new r.bK(c),u_emissive_strength:new r.bN(c)}),fillPattern:c=>({u_matrix:new r.bK(c),u_emissive_strength:new r.bN(c),u_image:new r.bO(c),u_texsize:new r.bL(c),u_pixel_coord_upper:new r.bL(c),u_pixel_coord_lower:new r.bL(c),u_tile_units_to_pixels:new r.bN(c)}),fillOutline:c=>({u_matrix:new r.bK(c),u_emissive_strength:new r.bN(c),u_world:new r.bL(c)}),fillOutlinePattern:c=>({u_matrix:new r.bK(c),u_emissive_strength:new r.bN(c),u_world:new r.bL(c),u_image:new r.bO(c),u_texsize:new r.bL(c),u_pixel_coord_upper:new r.bL(c),u_pixel_coord_lower:new r.bL(c),u_tile_units_to_pixels:new r.bN(c)}),circle:r.cs,collisionBox:c=>({u_matrix:new r.bK(c),u_camera_to_center_distance:new r.bN(c),u_extrude_scale:new r.bL(c)}),collisionCircle:c=>({u_matrix:new r.bK(c),u_inv_matrix:new r.bK(c),u_camera_to_center_distance:new r.bN(c),u_viewport_size:new r.bL(c)}),debug:c=>({u_color:new r.ca(c),u_matrix:new r.bK(c),u_overlay:new r.bO(c),u_overlay_scale:new r.bN(c)}),clippingMask:c=>({u_matrix:new r.bK(c)}),heatmap:c=>({u_extrude_scale:new r.bN(c),u_intensity:new r.bN(c),u_matrix:new r.bK(c),u_inv_rot_matrix:new r.bK(c),u_merc_center:new r.bL(c),u_tile_id:new r.bM(c),u_zoom_transition:new r.bN(c),u_up_dir:new r.bM(c)}),heatmapTexture:c=>({u_image:new r.bO(c),u_color_ramp:new r.bO(c),u_opacity:new r.bN(c)}),hillshade:c=>({u_matrix:new r.bK(c),u_image:new r.bO(c),u_latrange:new r.bL(c),u_light:new r.bL(c),u_shadow:new r.ca(c),u_highlight:new r.ca(c),u_emissive_strength:new r.bN(c),u_accent:new r.ca(c)}),hillshadePrepare:c=>({u_matrix:new r.bK(c),u_image:new r.bO(c),u_dimension:new r.bL(c),u_zoom:new r.bN(c)}),line:r.ct,linePattern:r.cu,raster:c=>({u_matrix:new r.bK(c),u_normalize_matrix:new r.bK(c),u_globe_matrix:new r.bK(c),u_merc_matrix:new r.bK(c),u_grid_matrix:new r.cb(c),u_tl_parent:new r.bL(c),u_scale_parent:new r.bN(c),u_fade_t:new r.bN(c),u_opacity:new r.bN(c),u_image0:new r.bO(c),u_image1:new r.bO(c),u_brightness_low:new r.bN(c),u_brightness_high:new r.bN(c),u_saturation_factor:new r.bN(c),u_contrast_factor:new r.bN(c),u_spin_weights:new r.bM(c),u_perspective_transform:new r.bL(c),u_raster_elevation:new r.bN(c),u_zoom_transition:new r.bN(c),u_merc_center:new r.bL(c),u_cutoff_params:new r.bP(c),u_colorization_mix:new r.bP(c),u_colorization_offset:new r.bN(c),u_color_ramp:new r.bO(c),u_texture_offset:new r.bL(c),u_texture_res:new r.bL(c),u_emissive_strength:new r.bN(c)}),rasterParticle:c=>({u_matrix:new r.bK(c),u_normalize_matrix:new r.bK(c),u_globe_matrix:new r.bK(c),u_merc_matrix:new r.bK(c),u_grid_matrix:new r.cb(c),u_tl_parent:new r.bL(c),u_scale_parent:new r.bN(c),u_fade_t:new r.bN(c),u_opacity:new r.bN(c),u_image0:new r.bO(c),u_image1:new r.bO(c),u_raster_elevation:new r.bN(c),u_zoom_transition:new r.bN(c),u_merc_center:new r.bL(c),u_cutoff_params:new r.bP(c)}),rasterParticleTexture:c=>({u_texture:new r.bO(c),u_opacity:new r.bN(c)}),rasterParticleDraw:c=>({u_tile_offset:new r.bL(c),u_velocity:new r.bO(c),u_color_ramp:new r.bO(c),u_velocity_res:new r.bL(c),u_max_speed:new r.bN(c),u_texture_offset:new r.bL(c),u_data_scale:new r.bP(c),u_data_offset:new r.bN(c)}),rasterParticleUpdate:c=>({u_velocity:new r.bO(c),u_velocity_res:new r.bL(c),u_max_speed:new r.bN(c),u_speed_factor:new r.bN(c),u_lifetime_delta:new r.bN(c),u_rand_seed:new r.bN(c),u_texture_offset:new r.bL(c),u_data_scale:new r.bP(c),u_data_offset:new r.bN(c)}),symbolIcon:c=>({u_is_size_zoom_constant:new r.bO(c),u_is_size_feature_constant:new r.bO(c),u_size_t:new r.bN(c),u_size:new r.bN(c),u_camera_to_center_distance:new r.bN(c),u_rotate_symbol:new r.bO(c),u_aspect_ratio:new r.bN(c),u_fade_change:new r.bN(c),u_matrix:new r.bK(c),u_label_plane_matrix:new r.bK(c),u_coord_matrix:new r.bK(c),u_is_text:new r.bO(c),u_pitch_with_map:new r.bO(c),u_texsize:new r.bL(c),u_tile_id:new r.bM(c),u_zoom_transition:new r.bN(c),u_inv_rot_matrix:new r.bK(c),u_merc_center:new r.bL(c),u_camera_forward:new r.bM(c),u_tile_matrix:new r.bK(c),u_up_vector:new r.bM(c),u_ecef_origin:new r.bM(c),u_texture:new r.bO(c),u_icon_transition:new r.bN(c),u_icon_saturation:new r.bN(c)}),symbolSDF:c=>({u_is_size_zoom_constant:new r.bO(c),u_is_size_feature_constant:new r.bO(c),u_size_t:new r.bN(c),u_size:new r.bN(c),u_camera_to_center_distance:new r.bN(c),u_rotate_symbol:new r.bO(c),u_aspect_ratio:new r.bN(c),u_fade_change:new r.bN(c),u_matrix:new r.bK(c),u_label_plane_matrix:new r.bK(c),u_coord_matrix:new r.bK(c),u_is_text:new r.bO(c),u_pitch_with_map:new r.bO(c),u_texsize:new r.bL(c),u_texture:new r.bO(c),u_gamma_scale:new r.bN(c),u_device_pixel_ratio:new r.bN(c),u_tile_id:new r.bM(c),u_zoom_transition:new r.bN(c),u_inv_rot_matrix:new r.bK(c),u_merc_center:new r.bL(c),u_camera_forward:new r.bM(c),u_tile_matrix:new r.bK(c),u_up_vector:new r.bM(c),u_ecef_origin:new r.bM(c),u_is_halo:new r.bO(c)}),symbolTextAndIcon:c=>({u_is_size_zoom_constant:new r.bO(c),u_is_size_feature_constant:new r.bO(c),u_size_t:new r.bN(c),u_size:new r.bN(c),u_camera_to_center_distance:new r.bN(c),u_rotate_symbol:new r.bO(c),u_aspect_ratio:new r.bN(c),u_fade_change:new r.bN(c),u_matrix:new r.bK(c),u_label_plane_matrix:new r.bK(c),u_coord_matrix:new r.bK(c),u_is_text:new r.bO(c),u_pitch_with_map:new r.bO(c),u_texsize:new r.bL(c),u_texsize_icon:new r.bL(c),u_texture:new r.bO(c),u_texture_icon:new r.bO(c),u_gamma_scale:new r.bN(c),u_device_pixel_ratio:new r.bN(c),u_is_halo:new r.bO(c)}),background:c=>({u_matrix:new r.bK(c),u_emissive_strength:new r.bN(c),u_opacity:new r.bN(c),u_color:new r.ca(c)}),backgroundPattern:c=>({u_matrix:new r.bK(c),u_emissive_strength:new r.bN(c),u_opacity:new r.bN(c),u_image:new r.bO(c),u_pattern_tl:new r.bL(c),u_pattern_br:new r.bL(c),u_texsize:new r.bL(c),u_pattern_size:new r.bL(c),u_pixel_coord_upper:new r.bL(c),u_pixel_coord_lower:new r.bL(c),u_tile_units_to_pixels:new r.bN(c)}),terrainRaster:kf,terrainDepth:kf,skybox:c=>({u_matrix:new r.bK(c),u_sun_direction:new r.bM(c),u_cubemap:new r.bO(c),u_opacity:new r.bN(c),u_temporal_offset:new r.bN(c)}),skyboxGradient:c=>({u_matrix:new r.bK(c),u_color_ramp:new r.bO(c),u_center_direction:new r.bM(c),u_radius:new r.bN(c),u_opacity:new r.bN(c),u_temporal_offset:new r.bN(c)}),skyboxCapture:c=>({u_matrix_3f:new r.cb(c),u_sun_direction:new r.bM(c),u_sun_intensity:new r.bN(c),u_color_tint_r:new r.bP(c),u_color_tint_m:new r.bP(c),u_luminance:new r.bN(c)}),globeRaster:c=>({u_proj_matrix:new r.bK(c),u_globe_matrix:new r.bK(c),u_normalize_matrix:new r.bK(c),u_merc_matrix:new r.bK(c),u_zoom_transition:new r.bN(c),u_merc_center:new r.bL(c),u_image0:new r.bO(c),u_grid_matrix:new r.cb(c),u_skirt_height:new r.bN(c),u_far_z_cutoff:new r.bN(c),u_frustum_tl:new r.bM(c),u_frustum_tr:new r.bM(c),u_frustum_br:new r.bM(c),u_frustum_bl:new r.bM(c),u_globe_pos:new r.bM(c),u_globe_radius:new r.bN(c),u_viewport:new r.bL(c)}),globeAtmosphere:c=>({u_frustum_tl:new r.bM(c),u_frustum_tr:new r.bM(c),u_frustum_br:new r.bM(c),u_frustum_bl:new r.bM(c),u_horizon:new r.bN(c),u_transition:new r.bN(c),u_fadeout_range:new r.bN(c),u_color:new r.bP(c),u_high_color:new r.bP(c),u_space_color:new r.bP(c),u_temporal_offset:new r.bN(c),u_horizon_angle:new r.bN(c)}),model:c=>({u_matrix:new r.bK(c),u_lighting_matrix:new r.bK(c),u_normal_matrix:new r.bK(c),u_lightpos:new r.bM(c),u_lightintensity:new r.bN(c),u_lightcolor:new r.bM(c),u_camera_pos:new r.bM(c),u_opacity:new r.bN(c),u_baseColorFactor:new r.bP(c),u_emissiveFactor:new r.bP(c),u_metallicFactor:new r.bN(c),u_roughnessFactor:new r.bN(c),u_baseTextureIsAlpha:new r.bO(c),u_alphaMask:new r.bO(c),u_alphaCutoff:new r.bN(c),u_baseColorTexture:new r.bO(c),u_metallicRoughnessTexture:new r.bO(c),u_normalTexture:new r.bO(c),u_occlusionTexture:new r.bO(c),u_emissionTexture:new r.bO(c),u_color_mix:new r.bP(c),u_aoIntensity:new r.bN(c),u_emissive_strength:new r.bN(c),u_occlusionTextureTransform:new r.bP(c)}),modelDepth:c=>({u_matrix:new r.bK(c),u_instance:new r.bK(c),u_node_matrix:new r.bK(c)}),groundShadow:c=>({u_matrix:new r.bK(c),u_ground_shadow_factor:new r.bM(c)}),stars:c=>({u_matrix:new r.bK(c),u_up:new r.bM(c),u_right:new r.bM(c),u_intensity_multiplier:new r.bN(c)})},Qo;function Jo(c,n,a,d,p,g,v){let k=c.context,S=k.gl,E=c.transform,A=c.getOrCreateProgram("collisionBox"),P=[],z=0,O=0;for(let W=0;W<d.length;W++){let J=d[W],$=n.getTile(J),ee=$.getBucket(a);if(!ee)continue;let oe=Iu(J,ee,E),ae=oe;p[0]===0&&p[1]===0||(ae=c.translatePosMatrix(oe,$,p,g));let ce=v?ee.textCollisionBox:ee.iconCollisionBox,be=ee.collisionCircleArray;if(be.length>0){let ue=r.a6.create(),Ie=ae;r.a6.mul(ue,ee.placementInvProjMatrix,E.glCoordMatrix),r.a6.mul(ue,ue,ee.placementViewportMatrix),P.push({circleArray:be,circleOffset:O,transform:Ie,invTransform:ue,projection:ee.getProjection()}),z+=be.length/4,O=z}ce&&(c.terrain&&c.terrain.setupElevationDraw($,A),A.draw(c,S.LINES,Rt.disabled,jt.disabled,c.colorModeForRenderPass(),Lt.disabled,Wd(ae,E,$,ee.getProjection()),a.id,ce.layoutVertexBuffer,ce.indexBuffer,ce.segments,null,E.zoom,null,[ce.collisionVertexBuffer,ce.collisionVertexBufferExt]))}if(!v||!P.length)return;let U=c.getOrCreateProgram("collisionCircle"),V=new r.cv;V.resize(4*z),V._trim();let G=0;for(let W of P)for(let J=0;J<W.circleArray.length/4;J++){let $=4*J,ee=W.circleArray[$+0],oe=W.circleArray[$+1],ae=W.circleArray[$+2],ce=W.circleArray[$+3];V.emplace(G++,ee,oe,ae,ce,0),V.emplace(G++,ee,oe,ae,ce,1),V.emplace(G++,ee,oe,ae,ce,2),V.emplace(G++,ee,oe,ae,ce,3)}(!Qo||Qo.length<2*z)&&(Qo=function(W){let J=2*W,$=new r.aw;$.resize(J),$._trim();for(let ee=0;ee<J;ee++){let oe=6*ee;$.uint16[oe+0]=4*ee+0,$.uint16[oe+1]=4*ee+1,$.uint16[oe+2]=4*ee+2,$.uint16[oe+3]=4*ee+2,$.uint16[oe+4]=4*ee+3,$.uint16[oe+5]=4*ee+0}return $}(z));let N=k.createIndexBuffer(Qo,!0),H=k.createVertexBuffer(V,r.cw.members,!0);for(let W of P){let J={u_matrix:W.transform,u_inv_matrix:W.invTransform,u_camera_to_center_distance:(Q=E).getCameraToCenterDistance(W.projection),u_viewport_size:[Q.width,Q.height]};U.draw(c,S.TRIANGLES,Rt.disabled,jt.disabled,c.colorModeForRenderPass(),Lt.disabled,J,a.id,H,N,r.aB.simpleSegment(0,2*W.circleOffset,W.circleArray.length,W.circleArray.length/2),null,E.zoom)}var Q;H.destroy(),N.destroy()}let Pa=r.a6.create();function jc(c){let n=c._camera.getWorldToCamera(c.worldSize,1),a=r.a6.multiply([],n,c.globeMatrix);r.a6.invert(a,a);let d=[0,0,0],p=[0,1,0,0];return r.a7.transformMat4(p,p,a),d[0]=p[0],d[1]=p[1],d[2]=p[2],r.N.normalize(d,d),d}function mt({width:c,height:n,anchor:a,textOffset:d,textScale:p},g){let{horizontalAlign:v,verticalAlign:k}=r.bf(a),S=-(v-.5)*c,E=-(k-.5)*n,A=r.bd(a,d);return new r.P((S/p+A[0])*g,(E/p+A[1])*g)}function Lf(c,n,a,d,p,g,v,k,S,E,A){let P=c.text.placedSymbolArray,z=c.text.dynamicLayoutVertexArray,O=c.icon.dynamicLayoutVertexArray,U={},V=c.getProjection(),G=Sc(k,V,g),N=g.elevation,H=V.upVectorScale(k.canonical,g.center.lat,g.worldSize).metersToTile;z.clear();for(let Q=0;Q<P.length;Q++){let W=P.get(Q),{tileAnchorX:J,tileAnchorY:$,numGlyphs:ee}=W,oe=W.hidden||!W.crossTileID||c.allowVerticalPlacement&&!W.placedOrientation?null:d[W.crossTileID];if(oe){let ae=0,ce=0,be=0;if(N){let Ne=N?N.getAtTileOffset(k,J,$):0,[Ye,We,rt]=V.upVector(k.canonical,J,$);ae=Ne*Ye*H,ce=Ne*We*H,be=Ne*rt*H}let[ue,Ie,Te,Be]=Do(W.projectedAnchorX+ae,W.projectedAnchorY+ce,W.projectedAnchorZ+be,a?G:v),pe=mf(g.getCameraToCenterDistance(V),Be),xe=p.evaluateSizeForFeature(c.textSizeData,E,W)*pe/r.bc;a&&(xe*=c.tilePixelRatio/S);let le=mt(oe,xe);a?({x:ue,y:Ie,z:Te}=V.projectTilePoint(J+le.x,$+le.y,k.canonical),[ue,Ie,Te]=Do(ue+ae,Ie+ce,Te+be,v)):(n&&le._rotate(-g.angle),ue+=le.x,Ie+=le.y,Te=0);let ge=c.allowVerticalPlacement&&W.placedOrientation===r.b6.vertical?Math.PI/2:0;for(let Ne=0;Ne<ee;Ne++)r.b9(z,ue,Ie,Te,ge);A&&W.associatedIconIndex>=0&&(U[W.associatedIconIndex]={x:ue,y:Ie,z:Te,angle:ge})}else rs(ee,z)}if(A){O.clear();let Q=c.icon.placedSymbolArray;for(let W=0;W<Q.length;W++){let J=Q.get(W),{numGlyphs:$}=J,ee=U[W];if(J.hidden||!ee)rs($,O);else{let{x:oe,y:ae,z:ce,angle:be}=ee;for(let ue=0;ue<$;ue++)r.b9(O,oe,ae,ce,be)}}c.icon.dynamicLayoutVertexBuffer.updateData(O)}c.text.dynamicLayoutVertexBuffer.updateData(z)}function Jd(c,n,a,d,p,g,v={}){let k=a.paint.get("icon-translate"),S=a.paint.get("text-translate"),E=a.paint.get("icon-translate-anchor"),A=a.paint.get("text-translate-anchor"),P=a.layout.get("icon-rotation-alignment"),z=a.layout.get("text-rotation-alignment"),O=a.layout.get("icon-pitch-alignment"),U=a.layout.get("text-pitch-alignment"),V=a.layout.get("icon-keep-upright"),G=a.layout.get("text-keep-upright"),N=a.paint.get("icon-color-saturation"),H=c.context,Q=H.gl,W=c.transform,J=P==="map",$=z==="map",ee=O==="map",oe=U==="map",ae=a.layout.get("symbol-sort-key").constantOr(1)!==void 0,ce=!1,be=c.depthModeForSublayer(0,Rt.ReadOnly),ue=[r.a5(W.center.lng),r.ae(W.center.lat)],Ie=a.layout.get("text-variable-anchor"),Te=W.projection.name==="globe",Be=[],pe=[0,-1,0];for(let xe of d){let le=n.getTile(xe),ge=le.getBucket(a);if(!ge||ge.projection.name==="mercator"&&Te||ge.fullyClipped)continue;let Ne=ge.projection.name==="globe",Ye=Ne?r.S(W.zoom):0,We=Sc(xe,ge.getProjection(),W),rt=W.calculatePixelsToTileUnitsMatrix(le),_t=Ie&&ge.hasTextData(),Et=ge.hasIconTextFit()&&_t&&ge.hasIconData(),vt=ge.getProjection().createInversionMatrix(W,xe.canonical),Tt=()=>{let vn=J&&a.layout.get("symbol-placement")!=="point",si=[],Si=vn||Et,li=a.paint.get("icon-image-cross-fade").constantOr(0);c.terrainRenderModeElevated()&&ee&&si.push("PITCH_WITH_MAP_TERRAIN"),Ne&&(si.push("PROJECTION_GLOBE_VIEW"),Si&&si.push("PROJECTED_POS_ON_VIEWPORT")),li>0&&si.push("ICON_TRANSITION"),ge.icon.zOffsetVertexBuffer&&si.push("Z_OFFSET"),N<1&&si.push("SATURATION");let Ii=ge.icon.programConfigurations.get(a.id),rn=c.getOrCreateProgram(ge.sdfIcons?"symbolSDF":"symbolIcon",{config:Ii,defines:si}),Di,ur=le.imageAtlasTexture?le.imageAtlasTexture.size:[0,0],Sr=ge.iconSizeData,ao=r.b5(Sr,W.zoom),ga=ee||W.pitch!==0,so=kc(We,le.tileID.canonical,ee,J,W,ge.getProjection(),rt),mr=yu(We,le.tileID.canonical,ee,J,W,ge.getProjection(),rt),tr=c.translatePosMatrix(mr,le,k,E,!0),jr=c.translatePosMatrix(We,le,k,E),Yr=Si?Pa:so,lo=J&&!ee&&!vn,ya=pe;!Te&&!W.mercatorFromTransition||J||(ya=jc(W));let gs=Ne?ya:pe;Di=ge.sdfIcons&&!ge.iconsInText?Oc(Sr.kind,ao,lo,ee,c,jr,Yr,tr,!1,ur,!0,xe,Ye,ue,vt,gs,ge.getProjection()):Yd(Sr.kind,ao,lo,ee,c,jr,Yr,tr,!1,ur,xe,Ye,ue,vt,gs,ge.getProjection(),N,li);let Js=le.imageAtlasTexture?le.imageAtlasTexture:null,od=a.layout.get("icon-size").constantOr(0)!==1||ge.iconsNeedLinear,ad=ge.sdfIcons||c.options.rotating||c.options.zooming||od||ga?Q.LINEAR:Q.NEAREST,Lm=ge.sdfIcons&&a.paint.get("icon-halo-width").constantOr(1)!==0,sd=c.terrain&&ee&&vn?r.a6.invert(r.a6.create(),so):Pa;if(vn&&ge.icon){let Ul=W.elevation,ch=Ul?Ul.getAtTileOffsetFunc(xe,W.center.lat,W.worldSize,ge.getProjection()):null,Oa=gu(We,le.tileID.canonical,ee,J,W,ge.getProjection(),rt);vu(ge,We,c,!1,Oa,mr,ee,V,ch,xe)}return{program:rn,buffers:ge.icon,uniformValues:Di,atlasTexture:Js,atlasTextureIcon:null,atlasInterpolation:ad,atlasInterpolationIcon:null,isSDF:ge.sdfIcons,hasHalo:Lm,tile:le,labelPlaneMatrixInv:sd}},Xt=()=>{let vn=$&&a.layout.get("symbol-placement")!=="point",si=[],Si=vn||Ie||Et;c.terrainRenderModeElevated()&&oe&&si.push("PITCH_WITH_MAP_TERRAIN"),Ne&&(si.push("PROJECTION_GLOBE_VIEW"),Si&&si.push("PROJECTED_POS_ON_VIEWPORT")),ge.text.zOffsetVertexBuffer&&si.push("Z_OFFSET");let li=ge.text.programConfigurations.get(a.id),Ii=c.getOrCreateProgram(ge.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:li,defines:si}),rn,Di=[0,0],ur=null,Sr=ge.textSizeData;ge.iconsInText&&(Di=le.imageAtlasTexture?le.imageAtlasTexture.size:[0,0],ur=le.imageAtlasTexture?le.imageAtlasTexture:null,rn=oe||W.pitch!==0||c.options.rotating||c.options.zooming||Sr.kind==="composite"||Sr.kind==="camera"?Q.LINEAR:Q.NEAREST);let ao=le.glyphAtlasTexture?le.glyphAtlasTexture.size:[0,0],ga=r.b5(Sr,W.zoom),so=kc(We,le.tileID.canonical,oe,$,W,ge.getProjection(),rt),mr=yu(We,le.tileID.canonical,oe,$,W,ge.getProjection(),rt),tr=c.translatePosMatrix(mr,le,S,A,!0),jr=c.translatePosMatrix(We,le,S,A),Yr=Si?Pa:so,lo=$&&!oe&&!vn,ya=pe;!Te&&!W.mercatorFromTransition||$||(ya=jc(W));let gs=Ne?ya:pe,Js;Js=ge.iconsInText?Kd(Sr.kind,ga,lo,oe,c,jr,Yr,tr,ao,Di,xe,Ye,ue,vt,gs,ge.getProjection()):Oc(Sr.kind,ga,lo,oe,c,jr,Yr,tr,!0,ao,!0,xe,Ye,ue,vt,gs,ge.getProjection());let od=le.glyphAtlasTexture?le.glyphAtlasTexture:null,ad=Q.LINEAR,Lm=a.paint.get("text-halo-width").constantOr(1)!==0,sd=c.terrain&&oe&&vn?r.a6.invert(r.a6.create(),so):Pa;if(vn&&ge.text){let Ul=W.elevation,ch=Ul?Ul.getAtTileOffsetFunc(xe,W.center.lat,W.worldSize,ge.getProjection()):null,Oa=gu(We,le.tileID.canonical,oe,$,W,ge.getProjection(),rt);vu(ge,We,c,!0,Oa,mr,oe,G,ch,xe)}return{program:Ii,buffers:ge.text,uniformValues:Js,atlasTexture:od,atlasTextureIcon:ur,atlasInterpolation:ad,atlasInterpolationIcon:rn,isSDF:!0,hasHalo:Lm,tile:le,labelPlaneMatrixInv:sd}},Nt=ge.icon.segments.get().length,qt=ge.text.segments.get().length,Gt=Nt&&!v.onlyText?Tt():null,yi=qt&&!v.onlyIcons?Xt():null,tn=a.paint.get("icon-opacity").constantOr(1),ai=a.paint.get("text-opacity").constantOr(1);if(ae&&ge.canOverlap){ce=!0;let vn=tn&&!v.onlyText?ge.icon.segments.get():[],si=ai&&!v.onlyIcons?ge.text.segments.get():[];for(let Si of vn)Be.push({segments:new r.aB([Si]),sortKey:Si.sortKey,state:Gt});for(let Si of si)Be.push({segments:new r.aB([Si]),sortKey:Si.sortKey,state:yi})}else v.onlyText||Be.push({segments:tn?ge.icon.segments:new r.aB([]),sortKey:0,state:Gt}),v.onlyIcons||Be.push({segments:ai?ge.text.segments:new r.aB([]),sortKey:0,state:yi})}ce&&Be.sort((xe,le)=>xe.sortKey-le.sortKey);for(let xe of Be){let le=xe.state;if(le)if(c.terrain&&c.terrain.setupElevationDraw(le.tile,le.program,{useDepthForOcclusion:W.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:le.labelPlaneMatrixInv}),H.activeTexture.set(Q.TEXTURE0),le.atlasTexture&&le.atlasTexture.bind(le.atlasInterpolation,Q.CLAMP_TO_EDGE,!0),le.atlasTextureIcon&&(H.activeTexture.set(Q.TEXTURE1),le.atlasTextureIcon&&le.atlasTextureIcon.bind(le.atlasInterpolationIcon,Q.CLAMP_TO_EDGE,!0)),c.uploadCommonLightUniforms(c.context,le.program),le.hasHalo){let ge=le.uniformValues;ge.u_is_halo=1,cs(le.buffers,xe.segments,a,c,le.program,be,p,g,ge,2),ge.u_is_halo=0}else{if(le.isSDF){let ge=le.uniformValues;le.hasHalo&&(ge.u_is_halo=1,cs(le.buffers,xe.segments,a,c,le.program,be,p,g,ge,1)),ge.u_is_halo=0}cs(le.buffers,xe.segments,a,c,le.program,be,p,g,le.uniformValues,1)}}}function cs(c,n,a,d,p,g,v,k,S,E){let A=[c.dynamicLayoutVertexBuffer,c.opacityVertexBuffer,c.iconTransitioningVertexBuffer,c.globeExtVertexBuffer,c.zOffsetVertexBuffer];p.draw(d,d.context.gl.TRIANGLES,g,v,k,Lt.disabled,S,a.id,c.layoutVertexBuffer,c.indexBuffer,n,a.paint,d.transform.zoom,c.programConfigurations.get(a.id),A,E)}function Xs(c,n,a,d,p,g,v){let k=c.context.gl,S=a.paint.get("fill-pattern"),E=S&&S.constantOr(1),A,P,z,O,U;v?(P=E&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",A=k.LINES):(P=E?"fillPattern":"fill",A=k.TRIANGLES);for(let V of d){let G=n.getTile(V);if(E&&!G.patternsLoaded())continue;let N=G.getBucket(a);if(!N)continue;c.prepareDrawTile();let H=N.programConfigurations.get(a.id),Q=c.isTileAffectedByFog(V),W=c.getOrCreateProgram(P,{config:H,overrideFog:Q});E&&(c.context.activeTexture.set(k.TEXTURE0),G.imageAtlasTexture&&G.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),H.updatePaintBuffers());let J=S.constantOr(null);if(J&&G.imageAtlas){let oe=G.imageAtlas.patternPositions[J.toString()];oe&&H.setConstantPatternPositions(oe)}let $=c.translatePosMatrix(V.projMatrix,G,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor")),ee=a.paint.get("fill-emissive-strength");if(v){O=N.indexBuffer2,U=N.segments2;let oe=c.terrain&&c.terrain.renderingToTexture?c.terrain.drapeBufferSize:[k.drawingBufferWidth,k.drawingBufferHeight];z=P==="fillOutlinePattern"&&E?Ef($,ee,c,G,oe):Ws($,ee,oe)}else O=N.indexBuffer,U=N.segments,z=E?em($,ee,c,G):Fl($,ee);c.uploadCommonUniforms(c.context,W,V.toUnwrapped()),W.draw(c,A,p,c.stencilModeForClipping(V),g,Lt.disabled,z,a.id,N.layoutVertexBuffer,O,U,a.paint,c.transform.zoom,H,void 0)}}function yt(c,n,a,d,p,g,v,k){a.resetLayerRenderingStats(c);let S=c.context,E=S.gl,A=c.transform,P=a.paint.get("fill-extrusion-pattern"),z=P.constantOr(1),O=a.paint.get("fill-extrusion-opacity"),U=c.style.enable3dLights(),V=a.paint.get(U&&!z?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),G=[a.paint.get("fill-extrusion-ambient-occlusion-intensity"),V],N=a.layout.get("fill-extrusion-edge-radius"),H=N>0&&!a.paint.get("fill-extrusion-rounded-roof"),Q=H?0:N,W=A.projection.name==="globe"?r.cF():0,J=A.projection.name==="globe",$=J?r.S(A.zoom):0,ee=[r.a5(A.center.lng),r.ae(A.center.lat)],oe=a.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),ae=a.paint.get("fill-extrusion-flood-light-intensity"),ce=a.paint.get("fill-extrusion-vertical-scale"),be=as(c,a.paint.get("fill-extrusion-cutoff-fade-range")),ue=a.paint.get("fill-extrusion-emissive-strength"),Ie=[],Te;J&&Ie.push("PROJECTION_GLOBE_VIEW"),G[0]>0&&Ie.push("FAUX_AO"),H&&Ie.push("ZERO_ROOF_RADIUS"),k&&Ie.push("HAS_CENTROID"),ae>0&&Ie.push("FLOOD_LIGHT"),be.shouldRenderCutoff&&Ie.push("RENDER_CUTOFF");let Be=c.renderPass==="shadow",pe=c.shadowRenderer,xe=Be&&!!pe;c.shadowRenderer&&(c.shadowRenderer.useNormalOffset=!0);let le=[0,0,0];if(pe){let Ye=c.style.directionalLight,We=c.style.ambientLight;Ye&&We&&(le=Pc(Ye,We)),Te=Ie.concat(["SHADOWS_SINGLE_CASCADE"])}let ge=xe?"fillExtrusionDepth":z?"fillExtrusionPattern":"fillExtrusion",Ne=a.getLayerRenderingStats();for(let Ye of d){let We=n.getTile(Ye),rt=We.getBucket(a);if(!rt||rt.projection.name!==A.projection.name)continue;let _t=!1;pe&&(_t=pe.getMaxCascadeForTile(Ye.toUnwrapped())===0);let Et=c.isTileAffectedByFog(Ye),vt=rt.programConfigurations.get(a.id),Tt=c.getOrCreateProgram(ge,{config:vt,defines:_t?Te:Ie,overrideFog:Et});if(c.terrain&&c.terrain.setupElevationDraw(We,Tt,{useMeterToDem:!0}),!rt.centroidVertexBuffer){let tn=Tt.attributes.a_centroid_pos;tn!==void 0&&E.vertexAttrib2f(tn,0,0)}!Be&&pe&&pe.setupShadows(We.tileID.toUnwrapped(),Tt,"vector-tile",We.tileID.overscaledZ),z&&(c.context.activeTexture.set(E.TEXTURE0),We.imageAtlasTexture&&We.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),vt.updatePaintBuffers());let Xt=P.constantOr(null);if(Xt&&We.imageAtlas){let tn=We.imageAtlas.patternPositions[Xt.toString()];tn&&vt.setConstantPatternPositions(tn)}let Nt=a.paint.get("fill-extrusion-vertical-gradient"),qt;if(Be&&pe){if(Of(We.tileID,rt,c))continue;let tn=pe.calculateShadowPassMatrixFromTile(We.tileID.toUnwrapped());qt=Ju(tn,Q,ce)}else{let tn=c.translatePosMatrix(Ye.expandedProjMatrix,We,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),ai=A.projection.createInversionMatrix(A,Ye.canonical);qt=z?Zs(tn,c,Nt,O,G,Q,Ye,We,W,$,ee,ai,oe,ce):Qu(tn,c,Nt,O,G,Q,Ye,W,$,ee,ai,oe,ce,ae,le,ue)}c.uploadCommonUniforms(S,Tt,Ye.toUnwrapped(),null,be);let Gt=rt.segments;if(A.projection.name==="mercator"&&!Be&&(Gt=rt.getVisibleSegments(We.tileID,c.terrain,c.transform.getFrustum(0)),!Gt.get().length))continue;if(Ne)if(Be)for(let tn of Gt.get())Ne.numRenderedVerticesInShadowPass+=tn.primitiveLength;else for(let tn of Gt.get())Ne.numRenderedVerticesInTransparentPass+=tn.primitiveLength;let yi=[];(c.terrain||k)&&yi.push(rt.centroidVertexBuffer),J&&yi.push(rt.layoutVertexExtBuffer),Tt.draw(c,S.gl.TRIANGLES,p,g,v,Lt.backCCW,qt,a.id,rt.layoutVertexBuffer,rt.indexBuffer,Gt,a.paint,c.transform.zoom,vt,yi)}c.shadowRenderer&&(c.shadowRenderer.useNormalOffset=!1)}function ds(c,n,a,d,p,g,v,k,S,E,A,P,z,O,U,V,G,N,H){let Q=c.context,W=Q.gl,J=c.transform,$=c.transform.zoom,ee=[],oe=as(c,a.paint.get("fill-extrusion-cutoff-fade-range"));E==="clear"?(ee.push("CLEAR_SUBPASS"),H&&(ee.push("CLEAR_FROM_TEXTURE"),Q.activeTexture.set(W.TEXTURE0),H.bind(W.LINEAR,W.CLAMP_TO_EDGE))):E==="sdf"&&ee.push("SDF_SUBPASS"),G&&ee.push("HAS_CENTROID"),oe.shouldRenderCutoff&&ee.push("RENDER_CUTOFF");let ae=a.layout.get("fill-extrusion-edge-radius"),ce=(be,ue,Ie,Te,Be)=>{let pe=ue.programConfigurations.get(a.id),xe=c.isTileAffectedByFog(be),le=c.getOrCreateProgram("fillExtrusionGroundEffect",{config:pe,defines:ee,overrideFog:xe}),ge=((Ye,We,rt,_t,Et,vt,Tt,Xt,Nt,qt,Gt)=>({u_matrix:We,u_opacity:rt,u_ao_pass:_t?1:0,u_meter_to_tile:Et,u_ao:vt,u_flood_light_intensity:Tt,u_flood_light_color:Xt,u_attenuation:Nt,u_edge_radius:qt,u_fb:0,u_fb_size:Gt}))(0,Te,A,S,Be,[P,z*Be],O,U,V,$>=17?0:ae*Be,H?H.size[0]:0),Ne=[];G&&Ne.push(ue.hiddenByLandmarkVertexBuffer),c.uploadCommonUniforms(Q,le,be.toUnwrapped(),null,oe),le.draw(c,Q.gl.TRIANGLES,p,g,v,k,ge,a.id,ue.vertexBuffer,ue.indexBuffer,Ie,a.paint,$,pe,Ne)};for(let be of d){let ue=n.getTile(be),Ie=ue.getBucket(a);if(!Ie||Ie.projection.name!==J.projection.name||!Ie.groundEffect||Ie.groundEffect&&!Ie.groundEffect.hasData())continue;let Te=Ie.groundEffect,Be=1/Ie.tileToMeter;{let pe=c.translatePosMatrix(be.projMatrix,ue,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),xe=Te.getDefaultSegment();ce(be,Te,xe,pe,Be)}if(N)for(let pe=0;pe<4;pe++){let xe=r.cG[pe](be),le=n.getTile(xe);if(!le)continue;let ge=le.getBucket(a);if(!ge||ge.projection.name!==J.projection.name||!ge.groundEffect||ge.groundEffect&&!ge.groundEffect.hasData())continue;let Ne=ge.groundEffect,Ye,We;pe===0?(Ye=[-r.V,0,0],We=1):pe===1?(Ye=[r.V,0,0],We=0):pe===2?(Ye=[0,-r.V,0],We=3):(Ye=[0,r.V,0],We=2);let rt=Ne.regionSegments[We];if(!rt)continue;let _t=new Float32Array(16);r.a6.translate(_t,be.projMatrix,Ye),ce(be,Ne,rt,c.translatePosMatrix(_t,ue,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),Be)}}}function D0(c,n,a,d,p,g,v){d.centroidVertexArray.length===0&&d.createCentroidsBuffer();let k=g?g.findDEMTileFor(a):null;if(!(k&&k.dem||v))return;let S=N=>new r.P(Math.ceil((N+r.cJ)*r.cK),0),E=N=>{let H=n.getSource().minzoom,Q=J=>{let $=n.getTileByID(J);if($&&$.hasData())return $.getBucket(p)},W=[0,-1,1];for(let J of W){if(N.overscaledZ+J<H)continue;let $=Q(N.calculateScaledKey(N.overscaledZ+J));if($)return $}},A=[0,0,0],P=(N,H)=>(A[0]=Math.min(N.min.y,H.min.y),A[1]=Math.max(N.max.y,H.max.y),A[2]=r.V-H.min.x>N.max.x?H.min.x-r.V:N.max.x,A),z=(N,H)=>(A[0]=Math.min(N.min.x,H.min.x),A[1]=Math.max(N.max.x,H.max.x),A[2]=r.V-H.min.y>N.max.y?H.min.y-r.V:N.max.y,A),O=[(N,H)=>P(N,H),(N,H)=>P(H,N),(N,H)=>z(N,H),(N,H)=>z(H,N)],U=(N,H,Q,W,J,$,ee)=>{if(!g)return 0;let oe=[[$?Q:N,$?N:Q,0],[$?Q:H,$?H:Q,0]],ae=ee<0?r.V+ee:ee,ce=[$?ae:(N+H)/2,$?(N+H)/2:ae,0];return Q===0&&ee<0||Q!==0&&ee>0?g.getForTilePoints(J,[ce],!0,W):oe.push(ce),g.getForTilePoints(a,oe,!0,k),Math.max(oe[0][2],oe[1][2],ce[2])/g.exaggeration()};for(let N=0;N<4;N++){let H=d.borderFeatureIndices[N];if(H.length===0)continue;let Q=r.cG[N](a),W=E(Q);if(!(W&&W instanceof r.cH)||d.borderDoneWithNeighborZ[N]===W.canonical.z)continue;W.centroidVertexArray.length===0&&W.createCentroidsBuffer();let J=g?g.findDEMTileFor(Q):null;if(!(J&&J.dem||v))continue;let $=(N<2?1:5)-N,ee=W.borderDoneWithNeighborZ[$]!==d.canonical.z,oe=W.borderFeatureIndices[$],ae=0;if(d.canonical.z!==W.canonical.z){for(let ce of H)d.showCentroid(d.featuresOnBorder[ce]);if(ee)for(let ce of oe)W.showCentroid(W.featuresOnBorder[ce]);d.borderDoneWithNeighborZ[N]=W.canonical.z,W.borderDoneWithNeighborZ[$]=d.canonical.z}for(let ce of H){let be=d.featuresOnBorder[ce],ue=d.centroidData[be.centroidDataIndex],Ie=be.borders[N],Te;for(;ae<oe.length;){Te=W.featuresOnBorder[oe[ae]];let Be=Te.borders[$];if(Be[1]>Ie[0]+3||Be[0]>Ie[0]-3)break;W.showCentroid(Te),ae++}if(Te&&ae<oe.length){let Be=ae,pe=0;for(;!(Te.borders[$][0]>Ie[1]-3)&&(pe++,++ae!==oe.length);)Te=W.featuresOnBorder[oe[ae]];if(Te=W.featuresOnBorder[oe[Be]],pe>1){let ge=Te.borders[$];Math.abs(Ie[0]-ge[0])<3&&Math.abs(Ie[1]-ge[1])<3&&(pe=1,ae=Be+1)}else if(pe===0){d.showCentroid(be);continue}let xe=W.centroidData[Te.centroidDataIndex];v&&pe===1&&(((V=ue).flags|(G=xe).flags)&r.cI?(V.flags|=r.cI,G.flags|=r.cI):(V.flags&=~r.cI,G.flags&=~r.cI));let le=be.intersectsCount()>1||Te.intersectsCount()>1;if(pe>1)ae=Be,ue.centroidXY=xe.centroidXY=new r.P(0,0);else if(J&&J.dem&&!le){let ge=O[N](ue,xe),Ne=N%2?r.V-1:0,Ye=U(ge[0],Math.min(r.V-1,ge[1]),Ne,J,Q,N<2,ge[2]);ue.centroidXY=xe.centroidXY=S(Ye)}else le?ue.centroidXY=xe.centroidXY=new r.P(0,0):(ue.centroidXY=d.encodeBorderCentroid(be),xe.centroidXY=W.encodeBorderCentroid(Te));d.writeCentroidToBuffer(ue),W.writeCentroidToBuffer(xe)}else d.showCentroid(be)}d.borderDoneWithNeighborZ[N]=W.canonical.z,W.borderDoneWithNeighborZ[$]=d.canonical.z}var V,G;(d.needsCentroidUpdate||!d.centroidVertexBuffer&&d.centroidVertexArray.length!==0)&&d.uploadCentroid(c)}let P0=[1,0,0],om=[0,1,0],zf=[0,0,1];function Of(c,n,a){let d=a.transform,p=a.shadowRenderer;if(!p)return!0;let g=c.toUnwrapped(),v=d.tileSize*p._cascades[a.currentShadowCascade].scale,k=n.maxHeight;if(d.elevation){let V=d.elevation.getMinMaxForTile(c);V&&(k+=V.max)}let S=[...p.shadowDirection];S[2]=-S[2];let E=p.computeSimplifiedTileShadowVolume(g,k,v,S);if(!E)return!1;let A=[P0,om,zf,S,[S[0],0,S[2]],[0,S[1],S[2]]],P=d.projection.name==="globe",z=d.scaleZoom(v),O=r.bq.fromInvProjectionMatrix(d.invProjMatrix,d.worldSize,z,!P),U=p.getCurrentCascadeFrustum();return O.intersectsPrecise(E.vertices,E.planes,A)===0||U.intersectsPrecise(E.vertices,E.planes,A)===0}function Ff(c){return[c[0]*r.cL,c[1]*r.cL,c[2]*r.cL,0]}function am(c,n,a,d,p,g,v,k,S){let E=d.getSource(),A=a.globeSharedBuffers;if(!A)return;let P,z,O;if(n&&(P=d.getTile(n)),E instanceof r.ap?(z=E.texture,O=r.cj(0,0,a.transform)):P&&n&&(z=P.texture,O=r.cj(n.canonical.z,n.canonical.x,a.transform)),!z||!O)return;c||(O=r.a6.scale(r.a6.create(),O,[1,-1,1]));let U=a.context,V=U.gl,G=p.paint.get("raster-resampling")==="nearest"?V.NEAREST:V.LINEAR,N=a.colorModeForDrapableLayerRenderPass(g),H=v.defines;H.push("GLOBE_POLES");let Q=new Rt(V.LEQUAL,Rt.ReadWrite,a.depthRangeFor3D),W=Float32Array.from(a.transform.expandedFarZProjMatrix),J=Float32Array.from(r.aT(r.ci(new r.bs(0,0,0))));a.terrain&&a.terrain.prepareDrawTile(),U.activeTexture.set(V.TEXTURE0),z.bind(G,V.CLAMP_TO_EDGE),U.activeTexture.set(V.TEXTURE1),z.bind(G,V.CLAMP_TO_EDGE),z.useMipmap&&U.extTextureFilterAnisotropic&&a.transform.pitch>20&&V.texParameterf(V.TEXTURE_2D,U.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,U.extTextureFilterAnisotropicMax);let[$,ee,oe,ae]=n?A.getPoleBuffers(n.canonical.z,!1):A.getPoleBuffers(0,!0),ce=p.paint.get("raster-elevation"),be;c?(be=$,a.renderDefaultNorthPole=ce!==0):(be=ee,a.renderDefaultSouthPole=ce!==0);let ue=Ff(v.mix),Ie=((Be,pe,xe,le,ge,Ne,Ye,We,rt,_t,Et,vt,Tt)=>nm(Be,pe,xe,new Float32Array(16),new Float32Array(9),[0,0],le,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Ne,[0,0],We,2,_t,Et,vt,1,0,Tt))(W,J,O,r.S(a.transform.zoom),0,p,0,ce,0,ue,v.offset,v.range,g),Te=a.getOrCreateProgram("raster",{defines:H});a.uploadCommonUniforms(U,Te,null),Te.draw(a,V.TRIANGLES,Q,S,N,k,Ie,p.id,be,oe,ae)}function sm(c){let n=c._nearZ,a=c.projection.farthestPixelDistance(c),d=a-n,p=.2*c.height,g=n+p;return[n,a,(g-p-n)/d,(g-n)/d]}function lm(c,n,a,d){if(c)return n instanceof Je&&c instanceof Vs?n.getTextureDescriptor(c,a,!0):{texture:c.texture,mix:Ff(d.mix),offset:d.offset,buffer:0,tileSize:1}}function cm(c,n,a){if(!c)return null;let d=n.getTextureDescriptor(c,a,!0);if(!d)return null;let{texture:p,mix:g,offset:v,tileSize:k,buffer:S,format:E}=d;if(!p||!E)return null;let A=!1;return E==="uint32"&&(A=!0,g[3]=0,g=Xd(r.cM,g,[0,a.paint.get("raster-particle-max-speed")]),v=Df(r.cM,v,[0,a.paint.get("raster-particle-max-speed")])),{texture:p,textureOffset:[S/(k+2*S),k/(k+2*S)],tileSize:k,scalarData:A,scale:g,offset:v,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[E]]}}function dm(c){let n=c._nearZ,a=c.projection.farthestPixelDistance(c),d=a-n,p=.2*c.height,g=n+p;return[n,a,(g-p-n)/d,(g-n)/d]}let ro=new r.ax(1,0,0,1),hs=new r.ax(0,1,0,1),Bf=new r.ax(0,0,1,1),hm=new r.ax(1,0,1,1),um=new r.ax(0,1,1,1);function us(c,n,a,d,p,g,v){let k=c.context,S=c.transform,E=k.gl,A=S.projection.name==="globe",P=A?["PROJECTION_GLOBE_VIEW"]:[],z=r.a6.clone(a.projMatrix);if(A&&r.S(S.zoom)>0){let ue=r.aS(a.canonical,S),Ie=r.cN(ue);z=r.a6.multiply(new Float32Array(16),S.globeMatrix,Ie),r.a6.multiply(z,S.projMatrix,z)}let O=r.a6.create();O[12]+=2*p/(r.f.devicePixelRatio*S.width),O[13]+=2*g/(r.f.devicePixelRatio*S.height),r.a6.multiply(z,O,z);let U=c.getOrCreateProgram("debug",{defines:P}),V=n.getTileByID(a.key);c.terrain&&c.terrain.setupElevationDraw(V,U);let G=Rt.disabled,N=jt.disabled,H=c.colorModeForRenderPass(),Q="$debug";k.activeTexture.set(E.TEXTURE0),c.emptyTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),A?V._makeGlobeTileDebugBuffers(c.context,S):V._makeDebugTileBoundsBuffers(c.context,S.projection);let W=V._tileDebugBuffer||c.debugBuffer,J=V._tileDebugIndexBuffer||c.debugIndexBuffer,$=V._tileDebugSegments||c.debugSegments;if(U.draw(c,E.LINE_STRIP,G,N,H,Lt.disabled,tm(z,d),Q,W,J,$,null,null,null,[V._globeTileDebugBorderBuffer]),v){let ue=V.latestRawTileData,Ie=Math.floor((ue&&ue.byteLength||0)/1024),Te=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(Te+=` => ${a.overscaledZ}`),Te+=` ${V.state}`,Te+=` ${Ie}kb`,function(Be,pe){Be.initDebugOverlayCanvas();let xe=Be.debugOverlayCanvas,le=Be.context.gl,ge=Be.debugOverlayCanvas.getContext("2d");ge.clearRect(0,0,xe.width,xe.height),ge.shadowColor="white",ge.shadowBlur=2,ge.lineWidth=1.5,ge.strokeStyle="white",ge.textBaseline="top",ge.font="bold 36px Open Sans, sans-serif",ge.fillText(pe,5,5),ge.strokeText(pe,5,5),Be.debugOverlayTexture.update(xe),Be.debugOverlayTexture.bind(le.LINEAR,le.CLAMP_TO_EDGE)}(c,Te)}let ee=n.getTile(a).tileSize,oe=512/Math.min(ee,512)*(a.overscaledZ/S.zoom)*.5,ae=V._tileDebugTextBuffer||c.debugBuffer,ce=V._tileDebugTextIndexBuffer||c.quadTriangleIndexBuffer,be=V._tileDebugTextSegments||c.debugSegments;U.draw(c,E.TRIANGLES,G,N,ri.alphaBlended,Lt.disabled,tm(z,r.ax.transparent,oe),Q,ae,ce,be,null,null,null,[V._globeTileDebugTextBuffer])}function mm(c,n,a,d){yn(c,0,n+a/2,c.transform.width,a,d)}function bo(c,n,a,d){yn(c,n-a/2,0,a,c.transform.height,d)}function yn(c,n,a,d,p,g){let v=c.context,k=v.gl;k.enable(k.SCISSOR_TEST),k.scissor(n*r.f.devicePixelRatio,a*r.f.devicePixelRatio,d*r.f.devicePixelRatio,p*r.f.devicePixelRatio),v.clear({color:g}),k.disable(k.SCISSOR_TEST)}let eh=r.ay([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:pm}=eh;function Ra(c,n,a,d){c.emplaceBack(n,a,d)}class fm{constructor(n){this.vertexArray=new r.az,this.indices=new r.aw,Ra(this.vertexArray,-1,-1,1),Ra(this.vertexArray,1,-1,1),Ra(this.vertexArray,-1,1,1),Ra(this.vertexArray,1,1,1),Ra(this.vertexArray,-1,-1,-1),Ra(this.vertexArray,1,-1,-1),Ra(this.vertexArray,-1,1,-1),Ra(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,pm),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=r.aB.simpleSegment(0,0,36,12)}}function Ys(c,n,a,d,p,g){let v=c.context.gl,k=n.paint.get("sky-atmosphere-color"),S=n.paint.get("sky-atmosphere-halo-color"),E=n.paint.get("sky-atmosphere-sun-intensity"),A=((P,z,O,U,V)=>({u_matrix_3f:P,u_sun_direction:z,u_sun_intensity:O,u_color_tint_r:[U.r,U.g,U.b,U.a],u_color_tint_m:[V.r,V.g,V.b,V.a],u_luminance:5e-5}))(r.co.fromMat4(r.co.create(),d),p,E,k,S);v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,v.TEXTURE_CUBE_MAP_POSITIVE_X+g,n.skyboxTexture,0),a.draw(c,v.TRIANGLES,Rt.disabled,jt.disabled,ri.unblended,Lt.frontCW,A,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}let R0=r.ay([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Bl{constructor(n){let a=new r.cO;a.emplaceBack(-1,1,1,0,0),a.emplaceBack(1,1,1,1,0),a.emplaceBack(1,-1,1,1,1),a.emplaceBack(-1,-1,1,0,1);let d=new r.aw;d.emplaceBack(0,1,2),d.emplaceBack(2,3,0),this.vertexBuffer=n.createVertexBuffer(a,R0.members),this.indexBuffer=n.createIndexBuffer(d),this.segments=r.aB.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}let Vc=r.ay([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Qe{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class At{constructor(n){this.colorModeAlphaBlendedWriteRGB=new ri([1,Ja,1,Ja],r.ax.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new ri([1,0,1,0],r.ax.transparent,[!1,!1,!1,!0]),this.params=new Qe,this.updateNeeded=!0,n.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),n.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),n.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),n.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(n){let a=n.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Bl(a);let d=this.params.sizeRange,p=this.params.intensityRange,g=function(A){let P=r.aA(30),z=[];for(let O=0;O<A;++O){let U=2*Math.PI*P(),V=Math.acos(1-2*P())-.5*Math.PI;z.push(r.N.fromValues(Math.cos(V)*Math.cos(U),Math.cos(V)*Math.sin(U),Math.sin(V)))}return z}(this.params.starsCount),v=r.aA(300),k=new r.cP,S=new r.aw,E=0;for(let A=0;A<g.length;++A){let P=r.N.scale([],g[A],200),z=Math.max(0,1+.01*d*(1*v()-.5)),O=Math.max(0,1+.01*p*(1*v()-.5));k.emplaceBack(P[0],P[1],P[2],-1,-1,z,O),k.emplaceBack(P[0],P[1],P[2],1,-1,z,O),k.emplaceBack(P[0],P[1],P[2],1,1,z,O),k.emplaceBack(P[0],P[1],P[2],-1,1,z,O),S.emplaceBack(E+0,E+1,E+2),S.emplaceBack(E+0,E+2,E+3),E+=4}this.starsVx=a.createVertexBuffer(k,Vc.members),this.starsIdx=a.createIndexBuffer(S),this.starsSegments=r.aB.simpleSegment(0,0,k.length,S.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(n,a){let d=n.context,p=d.gl,g=n.transform,v=new Rt(p.LEQUAL,Rt.ReadOnly,[0,1]),k=r.S(g.zoom),S=a.properties.get("color").toArray01(),E=a.properties.get("high-color").toArray01(),A=a.properties.get("space-color").toArray01PremultipliedAlpha(),P=5e-4,z=r.cQ(a.properties.get("horizon-blend"),0,1,P,.25),O=r.cd(n,d,g)&&z===P?g.worldSize/(2*Math.PI*1.025)-1:g.globeRadius,U=n.frameCounter/1e3%1,V=r.N.length(g.globeCenterInViewSpace),G=Math.sqrt(Math.pow(V,2)-Math.pow(O,2)),N=Math.acos(G/V),H=Q=>{let W=g.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Q&&W.push("ALPHA_PASS");let J=n.getOrCreateProgram("globeAtmosphere",{defines:W}),$=((oe,ae,ce,be,ue,Ie,Te,Be,pe,xe,le,ge)=>({u_frustum_tl:oe,u_frustum_tr:ae,u_frustum_br:ce,u_frustum_bl:be,u_horizon:ue,u_transition:Ie,u_fadeout_range:Te,u_color:Be,u_high_color:pe,u_space_color:xe,u_temporal_offset:le,u_horizon_angle:ge}))(g.frustumCorners.TL,g.frustumCorners.TR,g.frustumCorners.BR,g.frustumCorners.BL,g.frustumCorners.horizon,k,z,S,E,A,U,N);n.uploadCommonUniforms(d,J);let ee=this.atmosphereBuffer;ee&&J.draw(n,p.TRIANGLES,v,jt.disabled,Q?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Lt.backCW,$,Q?"atmosphere_glow_alpha":"atmosphere_glow",ee.vertexBuffer,ee.indexBuffer,ee.segments)};H(!1),H(!0)}drawStars(n,a){let d=r.aa(a.properties.get("star-intensity"),0,1);if(d===0)return;let p=n.context,g=p.gl,v=n.transform,k=n.getOrCreateProgram("stars"),S=r.bi.identity([]);r.bi.rotateX(S,S,-v._pitch),r.bi.rotateZ(S,S,-v.angle),r.bi.rotateX(S,S,r.bj(v._center.lat)),r.bi.rotateY(S,S,-r.bj(v._center.lng));let E=r.a6.fromQuat(new Float32Array(16),S),A=r.a6.multiply([],v.starsProjMatrix,E),P=r.co.fromMat4([],E),z=r.co.invert([],P),O=[0,1,0];r.N.transformMat3(O,O,z),r.N.scale(O,O,this.params.sizeMultiplier);let U=[1,0,0];r.N.transformMat3(U,U,z),r.N.scale(U,U,this.params.sizeMultiplier);let V=(G=O,N=U,H=d,{u_matrix:Float32Array.from(A),u_up:G,u_right:N,u_intensity_multiplier:H});var G,N,H;n.uploadCommonUniforms(p,k),this.starsVx&&this.starsIdx&&k.draw(n,g.TRIANGLES,Rt.disabled,jt.disabled,this.colorModeAlphaBlendedWriteRGB,Lt.disabled,V,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Ks(c,n){let a=[...c],d=n.cameraWorldSizeForFog/n.worldSize,p=r.a6.identity([]);return r.a6.scale(p,p,[d,d,1]),r.a6.multiply(a,p,a),r.a6.multiply(a,n.worldToFogMatrix,a),a}function bn(c,n,a,d){let p=a.material,g=d.context,{baseColorTexture:v,metallicRoughnessTexture:k}=p.pbrMetallicRoughness,{normalTexture:S,occlusionTexture:E,emissionTexture:A}=p;function P(z,O,U){if(z&&(c.push(O),g.activeTexture.set(g.gl.TEXTURE0+U),z.gfxTexture)){let{minFilter:V,magFilter:G,wrapS:N,wrapT:H}=z.sampler;z.gfxTexture.bindExtraParam(V,G,N,H)}}P(v,"HAS_TEXTURE_u_baseColorTexture",Ir.BaseColor),P(k,"HAS_TEXTURE_u_metallicRoughnessTexture",Ir.MetallicRoughness),P(S,"HAS_TEXTURE_u_normalTexture",Ir.Normal),P(E,"HAS_TEXTURE_u_occlusionTexture",Ir.Occlusion),P(A,"HAS_TEXTURE_u_emissionTexture",Ir.Emission),a.texcoordBuffer&&(c.push("HAS_ATTRIBUTE_a_uv_2f"),n.push(a.texcoordBuffer)),a.colorBuffer&&(c.push(a.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),n.push(a.colorBuffer)),a.normalBuffer&&(c.push("HAS_ATTRIBUTE_a_normal_3f"),n.push(a.normalBuffer)),a.pbrBuffer&&(c.push("HAS_ATTRIBUTE_a_pbr"),c.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),n.push(a.pbrBuffer)),p.alphaMode!=="OPAQUE"&&p.alphaMode!=="MASK"||c.push("UNPREMULT_TEXTURE_IN_SHADER"),p.defined||c.push("DIFFUSE_SHADED"),c.push("USE_STANDARD_DERIVATIVES")}function Uc(c,n,a,d,p,g){let v=a.paint.get("model-opacity"),k=n.context,S=new Rt(n.context.gl.LEQUAL,Rt.ReadWrite,n.depthRangeFor3D),E=n.transform,A=c.mesh,P=A.material,z=P.pbrMetallicRoughness,O=n.style.fog,U;U=n.transform.projection.zAxisUnit==="pixels"?[...c.nodeModelMatrix]:r.a6.multiply([],d.zScaleMatrix,c.nodeModelMatrix),r.a6.multiply(U,d.negCameraPosMatrix,U);let V=r.a6.invert([],U);r.a6.transpose(V,V);let G=a.paint.get("model-emissive-strength").constantOr(0),N=Qd(new Float32Array(c.worldViewProjection),new Float32Array(U),new Float32Array(V),n,v,z.baseColorFactor,P.emissiveFactor,z.metallicFactor,z.roughnessFactor,P,G,a),H={defines:[]},Q=[];bn(H.defines,Q,A,n);let W=n.shadowRenderer;W&&(W.useNormalOffset=!1);let J=null;if(O){let oe=Ks(c.nodeModelMatrix,n.transform);if(J=new Float32Array(oe),E.projection.name!=="globe"){let ae=A.aabb.min,ce=A.aabb.max,[be,ue]=O.getOpacityForBounds(oe,ae[0],ae[1],ce[0],ce[1]);H.overrideFog=be>=Fi||ue>=Fi}}let $=as(n,a.paint.get("model-cutoff-fade-range"));$.shouldRenderCutoff&&H.defines.push("RENDER_CUTOFF");let ee=n.getOrCreateProgram("model",H);n.uploadCommonUniforms(k,ee,null,J,$),n.renderPass!=="shadow"&&W&&W.setupShadowsFromMatrix(c.nodeModelMatrix,ee),ee.draw(n,k.gl.TRIANGLES,S,p,g,A.material.doubleSided?Lt.disabled:Lt.backCCW,N,a.id,A.vertexBuffer,A.indexBuffer,A.segments,a.paint,n.transform.zoom,void 0,Q)}function Gc(c,n,a,d,p,g,v){let k;k=c.projection.name==="globe"?r.cS(a,c):[...a],r.a6.multiply(k,k,n.matrix);let S=r.a6.multiply([],d,k);if(n.meshes)for(let E of n.meshes){if(E.material.alphaMode!=="BLEND"){v.push({mesh:E,depth:0,modelIndex:p,worldViewProjection:S,nodeModelMatrix:k});continue}let A=r.N.transformMat4([],E.centroid,S);A[2]>0&&g.push({mesh:E,depth:A[2],modelIndex:p,worldViewProjection:S,nodeModelMatrix:k})}if(n.children)for(let E of n.children)Gc(c,E,a,d,p,g,v)}function ye(c,n,a,d){let p=a.shadowRenderer;if(!p)return;let g=p.getShadowPassDepthMode(),v=p.getShadowPassColorMode(),k=p.calculateShadowPassMatrixFromMatrix(n),S=Nc(k);a.getOrCreateProgram("modelDepth",{defines:a._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(a,a.context.gl.TRIANGLES,g,jt.disabled,v,Lt.backCCW,S,d.id,c.vertexBuffer,c.indexBuffer,c.segments,d.paint,a.transform.zoom,void 0,void 0)}function _m(c,n,a){let d=n.updateZoomBasedPaintProperties(),p=function(g,v,k){let S,E,A,P=g.terrain?g.terrain.exaggeration():0;if(g.terrain&&P>0){let z=g.terrain,O=z.findDEMTileFor(k);O&&O.dem?S=r.cU.create(z,k,O):P=0}if(P===0&&(v.terrainElevationMin=0,v.terrainElevationMax=0),P===v.validForExaggeration&&(P===0||S&&S._demTile&&S._demTile.tileID===v.validForDEMTile.id&&S._dem._timestamp===v.validForDEMTile.timestamp))return!1;for(let z in v.instancesPerModel){let O=v.instancesPerModel[z];for(let U=0;U<O.instancedDataArray.length;++U){let V=(S?P*S.getElevationAt(0|O.instancedDataArray.float32[16*U],0|O.instancedDataArray.float32[16*U+1],!0,!0):0)+O.instancesEvaluatedElevation[U];O.instancedDataArray.float32[16*U+6]=V,E=E?Math.min(v.terrainElevationMin,V):V,A=A?Math.max(v.terrainElevationMax,V):V}}return v.terrainElevationMin=E||0,v.terrainElevationMax=A||0,v.validForExaggeration=P,v.validForDEMTile=S&&S._demTile?{id:S._demTile.tileID,timestamp:S._dem._timestamp}:{id:void 0,timestamp:0},!0}(c,n,a);(d||p)&&(n.uploaded=!1,n.upload(c.context))}let vo={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new r.bS([0,0,0],[r.V,r.V,0])};function Nf(c,n){let a=1<<c.canonical.z,d=n.getFreeCameraOptions().position,p=n.elevation,g=c.canonical.x/a,v=(c.canonical.x+1)/a,k=c.canonical.y/a,S=(c.canonical.y+1)/a,E=n._centerAltitude;if(p){let O=p.getMinMaxForTile(c);O&&O.max>E&&(E=O.max)}let A=r.aa(d.x,g,v)-d.x,P=r.aa(d.y,k,S)-d.y,z=r.bl(E,n.center.lat)-d.z;return n._zoomFromMercatorZ(Math.sqrt(A*A+P*P+z*z))}function gm(c,n,a,d,p,g,v){let k=c.context,S=c.renderPass==="shadow",E=c.shadowRenderer,A=S&&E?E.getShadowPassDepthMode():new Rt(k.gl.LEQUAL,Rt.ReadWrite,c.depthRangeFor3D),P=c.isTileAffectedByFog(g);if(a.meshes)for(let z of a.meshes){let O=["MODEL_POSITION_ON_GPU"],U=[],V,G,N;d.instancedDataArray.length>20&&O.push("INSTANCED_ARRAYS");let H=as(c,n.paint.get("model-cutoff-fade-range"));if(H.shouldRenderCutoff&&O.push("RENDER_CUTOFF"),S&&E)V=c.getOrCreateProgram("modelDepth",{defines:O}),G=Nc(v.shadowTileMatrix,v.shadowTileMatrix,Float32Array.from(a.matrix)),N=E.getShadowPassColorMode();else{bn(O,U,z,c),V=c.getOrCreateProgram("model",{defines:O,overrideFog:P});let W=z.material,J=W.pbrMetallicRoughness,$=n.paint.get("model-opacity"),ee=n.paint.get("model-emissive-strength").constantOr(0);G=Qd(g.expandedProjMatrix,Float32Array.from(a.matrix),new Float32Array(16),c,$,J.baseColorFactor,W.emissiveFactor,J.metallicFactor,J.roughnessFactor,W,ee,n,p),E&&(v.shadowUniformsInitialized?V.setShadowUniformValues(k,E.getShadowUniformValues()):(E.setupShadows(g.toUnwrapped(),V,"model-tile",g.overscaledZ),v.shadowUniformsInitialized=!0)),N=H.shouldRenderCutoff||$<1||W.alphaMode!=="OPAQUE"?ri.alphaBlended:ri.unblended}c.uploadCommonUniforms(k,V,g.toUnwrapped(),null,H);let Q=z.material.doubleSided?Lt.disabled:Lt.backCCW;if(d.instancedDataArray.length>20)U.push(d.instancedDataBuffer),V.draw(c,k.gl.TRIANGLES,A,jt.disabled,N,Q,G,n.id,z.vertexBuffer,z.indexBuffer,z.segments,n.paint,c.transform.zoom,void 0,U,d.instancedDataArray.length);else{let W=S?"u_instance":"u_normal_matrix";for(let J=0;J<d.instancedDataArray.length;++J)G[W]=new Float32Array(d.instancedDataArray.arrayBuffer,64*J,16),V.draw(c,k.gl.TRIANGLES,A,jt.disabled,N,Q,G,n.id,z.vertexBuffer,z.indexBuffer,z.segments,n.paint,c.transform.zoom,void 0,U)}}if(a.children)for(let z of a.children)gm(c,n,z,d,p,g,v)}let Nl=[1,-1,1];function L0(c,n,a,d){if(!a.modelManager)return!0;let p=a.modelManager;if(!a.shadowRenderer)return!0;let g=a.shadowRenderer,v=n.aabb,k=!0,S=c.maxHeight;if(S===0){let A=0;for(let P in c.instancesPerModel){let z=p.getModel(P,d);z?A=Math.max(A,Math.max(Math.max(z.aabb.max[0],z.aabb.max[1]),z.aabb.max[2])):k=!1}S=c.maxScale*A*1.41+c.maxVerticalOffset,k&&(c.maxHeight=S)}v.max[2]=S,v.min[2]+=c.terrainElevationMin,v.max[2]+=c.terrainElevationMax,r.N.transformMat4(v.min,v.min,n.tileMatrix),r.N.transformMat4(v.max,v.max,n.tileMatrix);let E=v.intersects(g.getCurrentCascadeFrustum());return a.currentShadowCascade===0&&(c.isInsideFirstShadowMapFrustum=E===2),E===0}class z0{}class jf{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(n,a,d){{let P=this._storage.get(a.id);if(P)return P.lastUsedFrameIdx=n,P.buf}let p=d.gl,g=p.getBufferParameter(p.ELEMENT_ARRAY_BUFFER,p.BUFFER_SIZE),v=new ArrayBuffer(g),k=new Int16Array(v);p.getBufferSubData(p.ELEMENT_ARRAY_BUFFER,0,new Int16Array(v));let S=new r.cW;for(let P=0;P<g/2;P+=3){let z=k[P],O=k[P+1],U=k[P+2];S.emplaceBack(z,O),S.emplaceBack(O,U),S.emplaceBack(U,z)}let E=d.bindVertexArrayOES.current,A=new z0;return A.buf=new Mn(d,S),A.lastUsedFrameIdx=n,this._storage.set(a.id,A),d.bindVertexArrayOES.set(E),A.buf}update(n){for(let[a,d]of this._storage)n-d.lastUsedFrameIdx>30&&(d.buf.destroy(),this._storage.delete(a))}destroy(){for(let[n,a]of this._storage)a.buf.destroy(),this._storage.delete(n)}}class $c{registerParameter(n,a,d,p,g){}registerButton(n,a,d){}}let qc={symbol:function(c,n,a,d,p){if(c.renderPass!=="translucent")return;let g=jt.disabled,v=c.colorModeForRenderPass();a.layout.get("text-variable-anchor")&&function(E,A,P,z,O,U,V){let G=A.transform,N=O==="map",H=U==="map";for(let Q of E){let W=z.getTile(Q),J=W.getBucket(P);if(!J||!J.text||!J.text.segments.get().length)continue;let $=r.b5(J.textSizeData,G.zoom),ee=Sc(Q,J.getProjection(),G),oe=G.calculatePixelsToTileUnitsMatrix(W),ae=kc(ee,W.tileID.canonical,H,N,G,J.getProjection(),oe),ce=J.hasIconTextFit()&&J.hasIconData();if($){let be=Math.pow(2,G.zoom-W.tileID.overscaledZ);Lf(J,N,H,V,r.cx,G,ae,Q,be,$,ce)}}}(d,c,a,n,a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),p);let k=a.paint.get("icon-opacity").constantOr(1)!==0,S=a.paint.get("text-opacity").constantOr(1)!==0;a.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(k||S)?Jd(c,n,a,d,g,v):(k&&Jd(c,n,a,d,g,v,{onlyIcons:!0}),S&&Jd(c,n,a,d,g,v,{onlyText:!0})),n.map.showCollisionBoxes&&(Jo(c,n,a,d,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),!0),Jo(c,n,a,d,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),!1))},circle:function(c,n,a,d){if(c.renderPass!=="translucent")return;let p=a.paint.get("circle-opacity"),g=a.paint.get("circle-stroke-width"),v=a.paint.get("circle-stroke-opacity"),k=a.layout.get("circle-sort-key").constantOr(1)!==void 0,S=a.paint.get("circle-emissive-strength");if(p.constantOr(1)===0&&(g.constantOr(1)===0||v.constantOr(1)===0))return;let E=c.context,A=E.gl,P=c.transform,z=c.depthModeForSublayer(0,Rt.ReadOnly),O=jt.disabled,U=c.colorModeForDrapableLayerRenderPass(S),V=P.projection.name==="globe",G=[r.a5(P.center.lng),r.ae(P.center.lat)],N=[];for(let Q=0;Q<d.length;Q++){let W=d[Q],J=n.getTile(W),$=J.getBucket(a);if(!$||$.projection.name!==P.projection.name)continue;let ee=$.programConfigurations.get(a.id),oe=r.cy(a),ae=c.isTileAffectedByFog(W);V&&oe.push("PROJECTION_GLOBE_VIEW");let ce=c.getOrCreateProgram("circle",{config:ee,defines:oe,overrideFog:ae}),be=$.layoutVertexBuffer,ue=$.globeExtVertexBuffer,Ie=$.indexBuffer,Te=P.projection.createInversionMatrix(P,W.canonical),Be={programConfiguration:ee,program:ce,layoutVertexBuffer:be,globeExtVertexBuffer:ue,indexBuffer:Ie,uniformValues:r.cz(c,W,J,Te,G,a),tile:J};if(k){let pe=$.segments.get();for(let xe of pe)N.push({segments:new r.aB([xe]),sortKey:xe.sortKey,state:Be})}else N.push({segments:$.segments,sortKey:0,state:Be})}k&&N.sort((Q,W)=>Q.sortKey-W.sortKey);let H={useDepthForOcclusion:P.depthOcclusionForSymbolsAndCircles};for(let Q of N){let{programConfiguration:W,program:J,layoutVertexBuffer:$,globeExtVertexBuffer:ee,indexBuffer:oe,uniformValues:ae,tile:ce}=Q.state,be=Q.segments;c.terrain&&c.terrain.setupElevationDraw(ce,J,H),c.uploadCommonUniforms(E,J,ce.tileID.toUnwrapped()),J.draw(c,A.TRIANGLES,z,O,U,Lt.disabled,ae,a.id,$,oe,be,a.paint,P.zoom,W,[ee])}},heatmap:function(c,n,a,d){if(a.paint.get("heatmap-opacity")!==0)if(c.renderPass==="offscreen"){let p=c.context,g=p.gl,v=jt.disabled,k=new ri([g.ONE,g.ONE,g.ONE,g.ONE],r.ax.transparent,[!0,!0,!0,!0]);(function(O,U,V,G){let N=O.gl,H=U.width*G,Q=U.height*G;O.activeTexture.set(N.TEXTURE1),O.viewport.set([0,0,H,Q]);let W=V.heatmapFbo;if(!W||W&&(W.width!==H||W.height!==Q)){W&&W.destroy();let J=N.createTexture();N.bindTexture(N.TEXTURE_2D,J),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_WRAP_S,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_WRAP_T,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_MIN_FILTER,N.LINEAR),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_MAG_FILTER,N.LINEAR),W=V.heatmapFbo=O.createFramebuffer(H,Q,!0,null),function($,ee,oe,ae,ce,be){let ue=$.gl;ue.texImage2D(ue.TEXTURE_2D,0,$.extRenderToTextureHalfFloat?ue.RGBA16F:ue.RGBA,ce,be,0,ue.RGBA,$.extRenderToTextureHalfFloat?ue.HALF_FLOAT:ue.UNSIGNED_BYTE,null),ae.colorAttachment.set(oe)}(O,0,J,W,H,Q)}else N.bindTexture(N.TEXTURE_2D,W.colorAttachment.get()),O.bindFramebuffer.set(W.framebuffer)})(p,c,a,c.transform.projection.name==="globe"?.5:.25),p.clear({color:r.ax.transparent});let S=c.transform,E=S.projection.name==="globe",A=E?["PROJECTION_GLOBE_VIEW"]:[],P=E?Lt.frontCCW:Lt.disabled,z=[r.a5(S.center.lng),r.ae(S.center.lat)];for(let O=0;O<d.length;O++){let U=d[O];if(n.hasRenderableParent(U))continue;let V=n.getTile(U),G=V.getBucket(a);if(!G||G.projection.name!==S.projection.name)continue;let N=c.isTileAffectedByFog(U),H=G.programConfigurations.get(a.id),Q=c.getOrCreateProgram("heatmap",{config:H,defines:A,overrideFog:N}),{zoom:W}=c.transform;c.terrain&&c.terrain.setupElevationDraw(V,Q),c.uploadCommonUniforms(p,Q,U.toUnwrapped());let J=S.projection.createInversionMatrix(S,U.canonical);Q.draw(c,g.TRIANGLES,Rt.disabled,v,k,P,im(c,U,V,J,z,W,a.paint.get("heatmap-intensity")),a.id,G.layoutVertexBuffer,G.indexBuffer,G.segments,a.paint,c.transform.zoom,H,E?[G.globeExtVertexBuffer]:null)}p.viewport.set([0,0,c.width,c.height])}else c.renderPass==="translucent"&&(c.context.setColorMode(c.colorModeForRenderPass()),function(p,g){let v=p.context,k=v.gl,S=g.heatmapFbo;if(!S)return;v.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,S.colorAttachment.get()),v.activeTexture.set(k.TEXTURE1);let E=g.colorRampTexture;E||(E=g.colorRampTexture=new r.T(v,g.colorRamp,k.RGBA)),E.bind(k.LINEAR,k.CLAMP_TO_EDGE),p.getOrCreateProgram("heatmapTexture").draw(p,k.TRIANGLES,Rt.disabled,jt.disabled,p.colorModeForRenderPass(),Lt.disabled,((A,P,z,O)=>({u_image:0,u_color_ramp:1,u_opacity:P.paint.get("heatmap-opacity")}))(0,g),g.id,p.viewportBuffer,p.quadTriangleIndexBuffer,p.viewportSegments,g.paint,p.transform.zoom)}(c,a))},line:function(c,n,a,d){if(c.renderPass!=="translucent")return;let p=a.paint.get("line-opacity"),g=a.paint.get("line-width");if(p.constantOr(1)===0||g.constantOr(1)===0)return;let v=a.paint.get("line-emissive-strength"),k=c.depthModeForSublayer(0,Rt.ReadOnly),S=c.colorModeForDrapableLayerRenderPass(v),E=c.terrain&&c.terrain.renderingToTexture?1:r.f.devicePixelRatio,A=a.paint.get("line-dasharray"),P=A.constantOr(1),z=a.layout.get("line-cap"),O=a.paint.get("line-pattern"),U=O.constantOr(1),V=a.paint.get("line-pattern").constantOr(1),G=a.paint.get("line-opacity").constantOr(1)!==1,N=!V&&G,H=a.paint.get("line-gradient"),Q=U?"linePattern":"line",W=c.context,J=W.gl,$=r.cA(a);c.terrain&&c.terrain.clipOrMaskOverlapStencilType()&&(N=!1);for(let ee of d){let oe=n.getTile(ee);if(U&&!oe.patternsLoaded())continue;let ae=oe.getBucket(a);if(!ae)continue;c.prepareDrawTile();let ce=ae.programConfigurations.get(a.id),be=c.isTileAffectedByFog(ee),ue=c.getOrCreateProgram(Q,{config:ce,defines:$,overrideFog:be}),Ie=O.constantOr(null);if(Ie&&oe.imageAtlas){let Ye=oe.imageAtlas.patternPositions[Ie.toString()];Ye&&ce.setConstantPatternPositions(Ye)}let Te=A.constantOr(null),Be=z.constantOr(null);if(!U&&Te&&Be&&oe.lineAtlas){let Ye=oe.lineAtlas.getDash(Te,Be);Ye&&ce.setConstantPatternPositions(Ye)}let[pe,xe]=a.paint.get("line-trim-offset");(Be==="round"||Be==="square")&&pe!==xe&&(pe===0&&(pe-=1),xe===1&&(xe+=1));let le=c.terrain?ee.projMatrix:null,ge=U?r.cB(c,oe,a,le,E,[pe,xe]):r.cC(c,oe,a,le,ae.lineClipsArray.length,E,[pe,xe]);if(H){let Ye=ae.gradients[a.id],We=Ye.texture;if(a.gradientVersion!==Ye.version){let rt=256;if(a.stepInterpolant){let _t=n.getSource().maxzoom,Et=ee.canonical.z===_t?Math.ceil(1<<c.transform.maxZoom-ee.canonical.z):1;rt=r.aa(r.cD(ae.maxLineLength/r.V*1024*Et),256,W.maxTextureSize)}Ye.gradient=r.cE({expression:a.gradientExpression(),evaluationKey:"lineProgress",resolution:rt,image:Ye.gradient||void 0,clips:ae.lineClipsArray}),Ye.texture?Ye.texture.update(Ye.gradient):Ye.texture=new r.T(W,Ye.gradient,J.RGBA),Ye.version=a.gradientVersion,We=Ye.texture}W.activeTexture.set(J.TEXTURE1),We.bind(a.stepInterpolant?J.NEAREST:J.LINEAR,J.CLAMP_TO_EDGE)}P&&(W.activeTexture.set(J.TEXTURE0),oe.lineAtlasTexture&&oe.lineAtlasTexture.bind(J.LINEAR,J.REPEAT),ce.updatePaintBuffers()),U&&(W.activeTexture.set(J.TEXTURE0),oe.imageAtlasTexture&&oe.imageAtlasTexture.bind(J.LINEAR,J.CLAMP_TO_EDGE),ce.updatePaintBuffers()),c.uploadCommonUniforms(W,ue,ee.toUnwrapped());let Ne=Ye=>{ue.draw(c,J.TRIANGLES,k,Ye,S,Lt.disabled,ge,a.id,ae.layoutVertexBuffer,ae.indexBuffer,ae.segments,a.paint,c.transform.zoom,ce,[ae.layoutVertexBuffer2])};if(N){let Ye=c.stencilModeForClipping(ee).ref;Ye===0&&c.terrain&&W.clear({stencil:0});let We={func:J.EQUAL,mask:255};ge.u_alpha_discard_threshold=.8,Ne(new jt(We,Ye,255,J.KEEP,J.KEEP,J.INVERT)),ge.u_alpha_discard_threshold=0,Ne(new jt(We,Ye,255,J.KEEP,J.KEEP,J.KEEP))}else Ne(c.stencilModeForClipping(ee))}N&&(c.resetStencilClippingMasks(),c.terrain&&W.clear({stencil:0}))},fill:function(c,n,a,d){let p=a.paint.get("fill-color"),g=a.paint.get("fill-opacity");if(g.constantOr(1)===0)return;let v=a.paint.get("fill-emissive-strength"),k=c.colorModeForDrapableLayerRenderPass(v),S=a.paint.get("fill-pattern"),E=c.opaquePassEnabledForLayer()&&!S.constantOr(1)&&p.constantOr(r.ax.transparent).a===1&&g.constantOr(0)===1?"opaque":"translucent";if(c.renderPass===E){let A=c.depthModeForSublayer(1,c.renderPass==="opaque"?Rt.ReadWrite:Rt.ReadOnly);Xs(c,n,a,d,A,k,!1)}if(c.renderPass==="translucent"&&a.paint.get("fill-antialias")){let A=c.depthModeForSublayer(a.getPaintProperty("fill-outline-color")?2:0,Rt.ReadOnly);Xs(c,n,a,d,A,k,!0)}},"fill-extrusion":function(c,n,a,d){let p=a.paint.get("fill-extrusion-opacity"),g=c.context,v=g.gl,k=c.terrain,S=k&&k.renderingToTexture;if(p===0)return;let E=c.conflationActive&&c.layerUsedInConflation(a,n.getSource());if(E&&function(A,P,z,O){for(let U of O){let V=P.getTile(U).getBucket(z);V&&(V.updateReplacement(U,A.replacementSource),V.uploadCentroid(A.context))}}(c,n,a,d),k||E)for(let A of d){let P=n.getTile(A).getBucket(a);P&&D0(c.context,n,A,P,a,k,E)}if(c.renderPass==="shadow"&&c.shadowRenderer){let A=c.shadowRenderer;if(k&&p<.65&&a._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof r.Z)return;let P=A.getShadowPassDepthMode(),z=A.getShadowPassColorMode();yt(c,n,a,d,P,jt.disabled,z,E)}else if(c.renderPass==="translucent"){let A=!a.paint.get("fill-extrusion-pattern").constantOr(1),P=a.paint.get("fill-extrusion-color").constantOr(r.ax.white);if(!S&&P.a!==0){let z=new Rt(c.context.gl.LEQUAL,Rt.ReadWrite,c.depthRangeFor3D);p===1&&A?yt(c,n,a,d,z,jt.disabled,ri.unblended,E):(yt(c,n,a,d,z,jt.disabled,ri.disabled,E),yt(c,n,a,d,z,c.stencilModeFor3D(),c.colorModeForRenderPass(),E),c.resetStencilClippingMasks())}if(c.style.enable3dLights()&&A&&(!k&&c.transform.projection.name!=="globe"||S)){let z=a.paint.get("fill-extrusion-opacity"),O=a.paint.get("fill-extrusion-ambient-occlusion-intensity"),U=a.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),V=a.paint.get("fill-extrusion-flood-light-intensity"),G=a.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),N=O>0&&U>0,H=V>0,Q=(J,$,ee)=>(1-ee)*J+ee*$,W=J=>{let $=c.depthModeForSublayer(1,Rt.ReadOnly,v.LEQUAL,!0),ee=a.paint.get(J?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),oe=Q(.1,3,ee),ae=c._showOverdrawInspector;if(!ae){let ce=new jt({func:v.ALWAYS,mask:255},255,255,v.KEEP,v.KEEP,v.REPLACE),be=new ri([v.ONE,v.ONE,v.ONE,v.ONE],r.ax.transparent,[!1,!1,!1,!0],v.MIN);ds(c,n,a,d,$,ce,be,Lt.disabled,J,"sdf",z,O,U,V,G,oe,E,!1)}{let ce=ae?jt.disabled:new jt({func:v.EQUAL,mask:255},255,255,v.KEEP,v.DECR,v.DECR),be=ae?c.colorModeForRenderPass():new ri([v.ONE_MINUS_DST_ALPHA,v.DST_ALPHA,v.ONE,v.ONE],r.ax.transparent,[!0,!0,!0,!0]);ds(c,n,a,d,$,ce,be,Lt.disabled,J,"color",z,O,U,V,G,oe,E,!1)}};if(S){let J=($,ee,oe)=>{let ae=c.depthModeForSublayer(1,Rt.ReadOnly,v.LEQUAL,!1),ce=a.paint.get($?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),be=Q(.1,3,ce);{let ue=new ri([v.ONE,v.ONE,v.ONE,v.ONE],r.ax.transparent,[!1,!1,!1,!0]);ds(c,n,a,d,ae,jt.disabled,ue,Lt.disabled,$,"clear",z,O,U,V,G,be,E,ee)}{let ue=new jt({func:v.ALWAYS,mask:255},255,255,v.KEEP,v.KEEP,v.REPLACE),Ie=new ri([v.ONE,v.ONE,v.ONE,v.ONE],r.ax.transparent,[!1,!1,!1,!0],v.MIN);ds(c,n,a,d,ae,ue,Ie,Lt.disabled,$,"sdf",z,O,U,V,G,be,E,ee)}{let ue=$?v.ZERO:v.ONE_MINUS_DST_ALPHA,Ie=new jt({func:v.EQUAL,mask:255},255,255,v.KEEP,v.DECR,v.DECR),Te=new ri([ue,v.DST_ALPHA,v.ONE_MINUS_DST_ALPHA,v.ZERO],r.ax.transparent,[!0,!0,!0,!0]);ds(c,n,a,d,ae,Ie,Te,Lt.disabled,$,"color",z,O,U,V,G,be,E,ee)}{let ue=new ri([v.ONE,v.ONE,v.ONE,$?v.ZERO:v.ONE],r.ax.transparent,[!1,!1,!1,!0],$?v.FUNC_ADD:v.MAX);ds(c,n,a,d,ae,jt.disabled,ue,Lt.disabled,$,"clear",z,O,U,V,G,be,E,ee,oe)}};if(N||H){let $;if(c.prepareDrawTile(),k){let ee=k.drapeBufferSize[0],oe=k.drapeBufferSize[1];$=k.framebufferCopyTexture,$&&(!$||$.size[0]===ee&&$.size[1]===oe)||($&&$.destroy(),$=k.framebufferCopyTexture=new r.T(g,new r.h({width:ee,height:oe}),v.RGBA)),$.bind(v.LINEAR,v.CLAMP_TO_EDGE),v.copyTexImage2D(v.TEXTURE_2D,0,v.RGBA,0,0,ee,oe,0)}N&&J(!0,!1,$),H&&J(!1,!0,$)}}else N&&W(!0),H&&W(!1)}}},hillshade:function(c,n,a,d){if(c.renderPass!=="offscreen"&&c.renderPass!=="translucent"||c.style.disableElevatedTerrain)return;let p=c.context,g=c.terrain&&c.terrain.renderingToTexture,[v,k]=c.renderPass!=="translucent"||g?[{},d]:c.stencilConfigForOverlap(d);for(let S of k){let E=n.getTile(S);if(E.needsHillshadePrepare&&c.renderPass==="offscreen")Gu(c,E,a);else if(c.renderPass==="translucent"){let A=c.depthModeForSublayer(0,Rt.ReadOnly),P=a.paint.get("hillshade-emissive-strength"),z=c.colorModeForDrapableLayerRenderPass(P),O=g&&c.terrain?c.terrain.stencilModeForRTTOverlap(S):v[S.overscaledZ];Hd(c,S,E,a,A,O,z)}}p.viewport.set([0,0,c.width,c.height]),c.resetStencilClippingMasks()},raster:function(c,n,a,d,p,g){if(c.renderPass!=="translucent"||a.paint.get("raster-opacity")===0)return;let v=c.transform.projection.name==="globe",k=a.paint.get("raster-elevation")!==0,S=k&&v;if(c.renderElevatedRasterBackface&&!S)return;let E=c.context,A=E.gl,P=n.getSource(),z=function($,ee,oe,ae){let ce=ee.paint.get("raster-color"),be=$.type==="raster-array",ue=[],Ie=ee.paint.get("raster-resampling"),Te=ee.paint.get("raster-color-mix"),Be=ee.paint.get("raster-color-range"),pe=[Te[0],Te[1],Te[2],0],xe=Te[3],le=Ie==="nearest"?ae.NEAREST:ae.LINEAR;if(be&&(ue.push("RASTER_ARRAY"),ce||ue.push("RASTER_COLOR"),Ie==="linear"&&ue.push("RASTER_ARRAY_LINEAR"),le=ae.NEAREST,!Be&&$.rasterLayers)){let ge=$.rasterLayers.find(({id:Ne})=>Ne===ee.sourceLayer);ge&&ge.fields&&ge.fields.range&&(Be=ge.fields.range)}if(Be=Be||[0,1],ce){ue.push("RASTER_COLOR"),oe.activeTexture.set(ae.TEXTURE2),ee.updateColorRamp(Be);let ge=ee.colorRampTexture;ge||(ge=ee.colorRampTexture=new r.T(oe,ee.colorRamp,ae.RGBA)),ge.bind(ae.LINEAR,ae.CLAMP_TO_EDGE)}return{mix:pe,range:Be,offset:xe,defines:ue,resampling:le}}(P,a,E,A);if(P instanceof r.ap&&!d.length&&!v)return;let O=a.paint.get("raster-emissive-strength"),U=c.colorModeForDrapableLayerRenderPass(O),V=c.terrain&&c.terrain.renderingToTexture,G=!c.options.moving,N=a.paint.get("raster-resampling")==="nearest"?A.NEAREST:A.LINEAR;if(P instanceof r.ap&&!d.length&&(P.onNorthPole||P.onSouthPole)){let $=k?c.stencilModeFor3D():jt.disabled;return void am(!!P.onNorthPole,null,c,n,a,O,z,Lt.disabled,$)}if(!d.length)return;let[H,Q]=P instanceof r.ap||V?[{},d]:c.stencilConfigForOverlap(d),W=Q[Q.length-1].overscaledZ;S&&z.defines.push("PROJECTION_GLOBE_VIEW"),k&&z.defines.push("RENDER_CUTOFF");let J=($,ee,oe)=>{for(let ae of $){let ce=ae.toUnwrapped(),be=n.getTile(ae);if(V&&(!be||!be.hasData()))continue;E.activeTexture.set(A.TEXTURE0);let ue=lm(be,P,a,z);if(!ue||!ue.texture)continue;let{texture:Ie,mix:Te,offset:Be,tileSize:pe,buffer:xe}=ue,le,ge;V?(le=Rt.disabled,ge=ae.projMatrix):k?(le=new Rt(A.LEQUAL,Rt.ReadWrite,c.depthRangeFor3D),ge=v?Float32Array.from(c.transform.expandedFarZProjMatrix):c.transform.calculateProjMatrix(ce,G)):(le=c.depthModeForSublayer(ae.overscaledZ-W,a.paint.get("raster-opacity")===1?Rt.ReadWrite:Rt.ReadOnly,A.LESS),ge=c.transform.calculateProjMatrix(ce,G));let Ne=c.terrain&&V?c.terrain.stencilModeForRTTOverlap(ae):H[ae.overscaledZ],Ye=g?0:a.paint.get("raster-fade-duration");be.registerFadeDuration(Ye);let We=n.findLoadedParent(ae,0),rt=Zu(be,We,n,c.transform,Ye),_t,Et;c.terrain&&c.terrain.prepareDrawTile(),E.activeTexture.set(A.TEXTURE0),Ie.bind(N,A.CLAMP_TO_EDGE),E.activeTexture.set(A.TEXTURE1),We?(We.texture&&We.texture.bind(N,A.CLAMP_TO_EDGE),_t=Math.pow(2,We.tileID.overscaledZ-be.tileID.overscaledZ),Et=[be.tileID.canonical.x*_t%1,be.tileID.canonical.y*_t%1]):Ie.bind(N,A.CLAMP_TO_EDGE),Ie.useMipmap&&E.extTextureFilterAnisotropic&&c.transform.pitch>20&&A.texParameterf(A.TEXTURE_2D,E.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,E.extTextureFilterAnisotropicMax);let vt=c.transform,Tt,Xt=k?sm(vt):[0,0,0,0],Nt,qt,Gt,yi,tn,ai=0;if(S&&P instanceof r.ap&&P.coordinates.length>3)Nt=Float32Array.from(r.aT(r.ci(new r.bs(0,0,0)))),qt=Float32Array.from(vt.globeMatrix),Gt=Float32Array.from(r.ce(vt)),yi=[r.a5(vt.center.lng),r.ae(vt.center.lat)],Tt=P.elevatedGlobePerspectiveTransform,tn=P.elevatedGlobeGridMatrix||new Float32Array(9);else if(S){let li=r.cf(ae.canonical);ai=r.cg(li.getCenter().lat),Nt=Float32Array.from(r.aT(r.ci(ae.canonical))),qt=Float32Array.from(vt.globeMatrix),Gt=Float32Array.from(r.ce(vt)),yi=[r.a5(vt.center.lng),r.ae(vt.center.lat)],Tt=[0,0],tn=Float32Array.from(r.ch(ae.canonical,li,ai,vt.worldSize/vt._pixelsPerMercatorPixel))}else Tt=P instanceof r.ap?P.perspectiveTransform:[0,0],Nt=new Float32Array(16),qt=new Float32Array(9),Gt=new Float32Array(16),yi=[0,0],tn=new Float32Array(9);let vn=nm(ge,Nt,qt,Gt,tn,Et||[0,0],r.S(c.transform.zoom),yi,Xt,_t||1,rt,a,Tt,k?a.paint.get("raster-elevation"):0,2,Te,Be,z.range,pe,xe,O),si=c.isTileAffectedByFog(ae),Si=c.getOrCreateProgram("raster",{defines:z.defines,overrideFog:si});if(c.uploadCommonUniforms(E,Si,ce),P instanceof r.ap){let li=P.elevatedGlobeVertexBuffer,Ii=P.elevatedGlobeIndexBuffer;if(V||!v)P.boundsBuffer&&P.boundsSegments&&Si.draw(c,A.TRIANGLES,le,jt.disabled,U,Lt.disabled,vn,a.id,P.boundsBuffer,c.quadTriangleIndexBuffer,P.boundsSegments);else if(li&&Ii){let rn=vt.zoom<=r.bG?P.elevatedGlobeSegments:P.getSegmentsForLongitude(vt.center.lng);rn&&Si.draw(c,A.TRIANGLES,le,jt.disabled,U,ee,vn,a.id,li,Ii,rn)}}else if(S){le=new Rt(A.LEQUAL,Rt.ReadOnly,c.depthRangeFor3D);let li=c.globeSharedBuffers;if(li){let[Ii,rn,Di]=li.getGridBuffers(ai,!1);Si.draw(c,A.TRIANGLES,le,oe||Ne,c.colorModeForRenderPass(),ee,vn,a.id,Ii,rn,Di)}}else{let{tileBoundsBuffer:li,tileBoundsIndexBuffer:Ii,tileBoundsSegments:rn}=c.getTileBoundsBuffers(be);Si.draw(c,A.TRIANGLES,le,Ne,U,Lt.disabled,vn,a.id,li,Ii,rn)}}if(!(P instanceof r.ap)&&S)for(let ae of $){let ce=ae.canonical.y===(1<<ae.canonical.z)-1;ae.canonical.y===0&&am(!0,ae,c,n,a,O,z,ee,oe||jt.disabled),ce&&am(!1,ae,c,n,a,O,z,ee===Lt.frontCW?Lt.backCW:Lt.frontCW,oe||jt.disabled)}};S?J(Q,c.renderElevatedRasterBackface?Lt.backCW:Lt.frontCW,c.stencilModeFor3D()):J(Q,Lt.disabled,void 0),c.resetStencilClippingMasks()},"raster-particle":function(c,n,a,d,p,g){c.renderPass==="offscreen"&&function(v,k,S,E){if(!E.length)return;let A=v.context,P=A.gl,z=k.getSource();if(!(z instanceof Je))return;let O=[];for(let G of E){let N=k.getTile(G);if(!(N instanceof Vs))continue;let H=cm(N,z,S);if(!H)continue;let Q=[H.tileSize,H.tileSize],W=S.tileFramebuffer;W||(W=S.tileFramebuffer=A.createFramebuffer(Q[0],Q[1],!0,null));let J=N.rasterParticleState,$=S.paint.get("raster-particle-count");J||(J=N.rasterParticleState=new Jn(A,G,Q,$));let ee=J.update(S.lastInvalidatedAt);J.numParticles!==$&&J.setNumParticles(G,$);let oe=J.targetColorTexture;J.targetColorTexture=J.backgroundColorTexture,J.backgroundColorTexture=oe;let ae=J.particleVertices0;J.particleVertices0=J.particleVertices1,J.particleVertices1=ae,O.push([G,H,J,ee])}if(O.length===0)return;let U=r.f.now(),V=S.previousDrawTimestamp?.001*(U-S.previousDrawTimestamp):.0167;if(S.previousDrawTimestamp=U,S.hasColorMap()){A.activeTexture.set(P.TEXTURE0+2);let G=S.colorRampTexture;G||(G=S.colorRampTexture=new r.T(A,S.colorRamp,P.RGBA)),G.bind(P.LINEAR,P.CLAMP_TO_EDGE)}A.bindFramebuffer.set(S.tileFramebuffer.framebuffer),A.activeTexture.set(P.TEXTURE0),function(G,N,H){let Q=G.context,W=Q.gl,J=N.tileFramebuffer;Q.activeTexture.set(W.TEXTURE0);let $={u_texture:0,u_opacity:1.05*(oe=N.paint.get("raster-particle-fade-opacity-factor"))/(oe+.05)},ee=G.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var oe;for(let ae of H){let[,,ce,be]=ae;J.colorAttachment.set(ce.targetColorTexture.texture),Q.viewport.set([0,0,J.width,J.height]),Q.clear({color:r.ax.transparent}),be&&(ce.backgroundColorTexture.bind(W.NEAREST,W.CLAMP_TO_EDGE),ee.draw(G,W.TRIANGLES,Rt.disabled,jt.disabled,ri.alphaBlended,Lt.disabled,$,N.id,G.viewportBuffer,G.quadTriangleIndexBuffer,G.viewportSegments))}}(v,S,O),function(G,N,H,Q){let W=G.context.gl,J=H.tileFramebuffer,$=G.transform.projection.name==="globe",ee=H.paint.get("raster-particle-max-speed");for(let oe of Q){let[ae,ce,be]=oe;ce.texture.bind(W.LINEAR,W.CLAMP_TO_EDGE),J.colorAttachment.set(be.targetColorTexture.texture);let ue=G.getOrCreateProgram("rasterParticleDraw",{defines:ce.defines,overrideFog:!1}),Ie=ce.scalarData?[]:[0,1,2,3].map(pe=>r.cG[pe](ae));Ie.push(ae);let Te=ae.canonical.x,Be=ae.canonical.y;for(let pe of Ie){let xe=N.getTile($?pe.wrapped():pe);if(!xe)continue;let le=xe.rasterParticleState;if(!le)continue;let ge=E0([pe.canonical.x+(1<<pe.canonical.z)*(pe.wrap-ae.wrap)-Te,pe.canonical.y-Be],0,ce.texture.size,2,ee,ce.textureOffset,ce.scale,ce.offset);ue.draw(G,W.POINTS,Rt.disabled,jt.disabled,ri.alphaBlended,Lt.disabled,ge,H.id,le.particleVertices0,void 0,le.particleSegment)}}}(v,k,S,O),function(G,N,H,Q){let W=G.context.gl,J=N.transformFeedbackObject;J||(J=N.transformFeedbackObject=W.createTransformFeedback()),W.bindTransformFeedback(W.TRANSFORM_FEEDBACK,N.transformFeedbackObject);let $=N.paint.get("raster-particle-max-speed"),ee=Q*N.paint.get("raster-particle-speed-factor")*.3,oe=(ae=N.paint.get("raster-particle-reset-rate-factor"),Math.pow(ae,6));var ae;for(let ce of H){let[,be,ue]=ce;be.texture.bind(W.LINEAR,W.CLAMP_TO_EDGE);let Ie=Pf(0,be.texture.size,$,ee,oe,be.textureOffset,be.scale,be.offset);G.getOrCreateProgram("rasterParticleUpdate",{defines:be.defines,transformFeedback:{bufferMode:W.SEPARATE_ATTRIBS,shaderVaryings:["v_new_particle"]}}).draw(G,W.POINTS,Rt.disabled,jt.disabled,ri.disabled,Lt.disabled,Ie,N.id,ue.particleVertices0,void 0,ue.particleSegment,{},void 0,void 0,void 0,void 0,[{buffer:ue.particleVertices1,targetIndex:0}])}W.bindTransformFeedback(W.TRANSFORM_FEEDBACK,null)}(v,S,O,V)}(c,n,a,d),c.renderPass==="translucent"&&(function(v,k,S,E,A){let P=v.context,z=P.gl,O=!v.options.moving,U=v.transform.projection.name==="globe";if(!E.length)return;let[V,G]=v.stencilConfigForOverlap(E),N=[];U&&N.push("PROJECTION_GLOBE_VIEW");for(let H of G){let Q=H.toUnwrapped(),W=k.getTile(H);if(!W.rasterParticleState)continue;let J=W.rasterParticleState,$=100;W.registerFadeDuration($);let ee=k.findLoadedParent(H,0),oe=Zu(W,ee,k,v.transform,$),ae,ce;v.terrain&&v.terrain.prepareDrawTile(),P.activeTexture.set(z.TEXTURE0),J.targetColorTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),P.activeTexture.set(z.TEXTURE1),ee&&ee.rasterParticleState?(ee.rasterParticleState.targetColorTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),ae=Math.pow(2,ee.tileID.overscaledZ-W.tileID.overscaledZ),ce=[W.tileID.canonical.x*ae%1,W.tileID.canonical.y*ae%1]):J.targetColorTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE);let be=U?Float32Array.from(v.transform.expandedFarZProjMatrix):v.transform.calculateProjMatrix(Q,O),ue=v.transform,Ie=dm(ue),Te=r.cf(H.canonical),Be=r.cg(Te.getCenter().lat),pe,xe,le,ge,Ne;U?(pe=Float32Array.from(r.aT(r.ci(H.canonical))),xe=Float32Array.from(ue.globeMatrix),le=Float32Array.from(r.ce(ue)),ge=[r.a5(ue.center.lng),r.ae(ue.center.lat)],Ne=Float32Array.from(r.ch(H.canonical,Te,Be,ue.worldSize/ue._pixelsPerMercatorPixel))):(pe=new Float32Array(16),xe=new Float32Array(9),le=new Float32Array(16),ge=[0,0],Ne=new Float32Array(9));let Ye=M0(be,pe,xe,le,Ne,ce||[0,0],r.S(v.transform.zoom),ge,Ie,ae||1,oe,250),We=v.isTileAffectedByFog(H),rt=v.getOrCreateProgram("rasterParticle",{defines:N,overrideFog:We});if(v.uploadCommonUniforms(P,rt,Q),U){let _t=new Rt(z.LEQUAL,Rt.ReadWrite,v.depthRangeFor3D),Et=0,vt=v.globeSharedBuffers;if(vt){let[Tt,Xt,Nt]=vt.getGridBuffers(Be,Et!==0);rt.draw(v,z.TRIANGLES,_t,jt.disabled,ri.alphaBlended,Lt.backCCW,Ye,S.id,Tt,Xt,Nt)}}else{let _t=v.depthModeForSublayer(0,Rt.ReadOnly),Et=V[H.overscaledZ],{tileBoundsBuffer:vt,tileBoundsIndexBuffer:Tt,tileBoundsSegments:Xt}=v.getTileBoundsBuffers(W);rt.draw(v,z.TRIANGLES,_t,Et,ri.alphaBlended,Lt.disabled,Ye,S.id,vt,Tt,Xt)}}v.resetStencilClippingMasks()}(c,n,a,d),c.style.map.triggerRepaint())},background:function(c,n,a,d){let p=a.paint.get("background-color"),g=a.paint.get("background-opacity"),v=a.paint.get("background-emissive-strength");if(g===0)return;let k=c.context,S=k.gl,E=c.transform,A=E.tileSize,P=a.paint.get("background-pattern");if(c.isPatternMissing(P,a.scope))return;let z=!P&&p.a===1&&g===1&&c.opaquePassEnabledForLayer()?"opaque":"translucent";if(c.renderPass!==z)return;let O=jt.disabled,U=c.depthModeForSublayer(0,z==="opaque"?Rt.ReadWrite:Rt.ReadOnly),V=c.colorModeForDrapableLayerRenderPass(v),G=P?"backgroundPattern":"background",N,H=d;H||(N=c.getBackgroundTiles(),H=Object.values(N).map(Q=>Q.tileID)),P&&(k.activeTexture.set(S.TEXTURE0),c.imageManager.bind(c.context,a.scope));for(let Q of H){let W=c.isTileAffectedByFog(Q),J=c.getOrCreateProgram(G,{overrideFog:W}),$=Q.toUnwrapped(),ee=d?Q.projMatrix:c.transform.calculateProjMatrix($);c.prepareDrawTile();let oe=n?n.getTile(Q):N?N[Q.key]:new es(Q,A,E.zoom,c),ae=P?Fc(ee,v,g,c,P,a.scope,{tileID:Q,tileSize:A}):rm(ee,v,g,p);c.uploadCommonUniforms(k,J,$);let{tileBoundsBuffer:ce,tileBoundsIndexBuffer:be,tileBoundsSegments:ue}=c.getTileBoundsBuffers(oe);J.draw(c,S.TRIANGLES,U,O,V,Lt.disabled,ae,a.id,ce,be,ue)}},sky:function(c,n,a){let d=c._atmosphere?r.S(c.transform.zoom):1,p=a.paint.get("sky-opacity")*d;if(p===0)return;let g=c.context,v=a.paint.get("sky-type"),k=new Rt(g.gl.LEQUAL,Rt.ReadOnly,[0,1]),S=c.frameCounter/1e3%1;v==="atmosphere"?c.renderPass==="offscreen"?a.needsSkyboxCapture(c)&&(function(E,A,P,z){let O=E.context,U=O.gl,V=A.skyboxFbo;if(!V){V=A.skyboxFbo=O.createFramebuffer(32,32,!0,null),A.skyboxGeometry=new fm(O),A.skyboxTexture=O.gl.createTexture(),U.bindTexture(U.TEXTURE_CUBE_MAP,A.skyboxTexture),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_MIN_FILTER,U.LINEAR),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_MAG_FILTER,U.LINEAR);for(let Q=0;Q<6;++Q)U.texImage2D(U.TEXTURE_CUBE_MAP_POSITIVE_X+Q,0,U.RGBA,32,32,0,U.RGBA,U.UNSIGNED_BYTE,null)}O.bindFramebuffer.set(V.framebuffer),O.viewport.set([0,0,32,32]);let G=A.getCenter(E,!0),N=E.getOrCreateProgram("skyboxCapture"),H=new Float64Array(16);r.a6.identity(H),r.a6.rotateY(H,H,.5*-Math.PI),Ys(E,A,N,H,G,0),r.a6.identity(H),r.a6.rotateY(H,H,.5*Math.PI),Ys(E,A,N,H,G,1),r.a6.identity(H),r.a6.rotateX(H,H,.5*-Math.PI),Ys(E,A,N,H,G,2),r.a6.identity(H),r.a6.rotateX(H,H,.5*Math.PI),Ys(E,A,N,H,G,3),r.a6.identity(H),Ys(E,A,N,H,G,4),r.a6.identity(H),r.a6.rotateY(H,H,Math.PI),Ys(E,A,N,H,G,5),O.viewport.set([0,0,E.width,E.height])}(c,a),a.markSkyboxValid(c)):c.renderPass==="sky"&&function(E,A,P,z,O){let U=E.context,V=U.gl,G=E.transform,N=E.getOrCreateProgram("skybox");U.activeTexture.set(V.TEXTURE0),V.bindTexture(V.TEXTURE_CUBE_MAP,A.skyboxTexture);let H=((Q,W,J,$,ee)=>({u_matrix:Q,u_sun_direction:W,u_cubemap:0,u_opacity:$,u_temporal_offset:ee}))(G.skyboxMatrix,A.getCenter(E,!1),0,z,O);E.uploadCommonUniforms(U,N),N.draw(E,V.TRIANGLES,P,jt.disabled,E.colorModeForRenderPass(),Lt.backCW,H,"skybox",A.skyboxGeometry.vertexBuffer,A.skyboxGeometry.indexBuffer,A.skyboxGeometry.segment)}(c,a,k,p,S):v==="gradient"&&c.renderPass==="sky"&&function(E,A,P,z,O){let U=E.context,V=U.gl,G=E.transform,N=E.getOrCreateProgram("skyboxGradient");A.skyboxGeometry||(A.skyboxGeometry=new fm(U)),U.activeTexture.set(V.TEXTURE0);let H=A.colorRampTexture;H||(H=A.colorRampTexture=new r.T(U,A.colorRamp,V.RGBA)),H.bind(V.LINEAR,V.CLAMP_TO_EDGE);let Q=((W,J,$,ee,oe)=>({u_matrix:W,u_color_ramp:0,u_center_direction:J,u_radius:r.bj($),u_opacity:ee,u_temporal_offset:oe}))(G.skyboxMatrix,A.getCenter(E,!1),A.paint.get("sky-gradient-radius"),z,O);E.uploadCommonUniforms(U,N),N.draw(E,V.TRIANGLES,P,jt.disabled,E.colorModeForRenderPass(),Lt.backCW,Q,"skyboxGradient",A.skyboxGeometry.vertexBuffer,A.skyboxGeometry.indexBuffer,A.skyboxGeometry.segment)}(c,a,k,p,S)},debug:function(c,n,a,d,p,g){for(let v=0;v<a.length;v++)if(p){let E=new r.ax(d.r*.8,d.g*.8,d.b*.8,1);us(c,n,a[v],d,-1,-1,g),us(c,n,a[v],d,-1,1,g),us(c,n,a[v],d,1,1,g),us(c,n,a[v],d,1,-1,g),us(c,n,a[v],E,0,0,g)}else us(c,n,a[v],d,0,0,g)},custom:function(c,n,a,d){let p=c.context,g=a.implementation;if(!c.transform.projection.unsupportedLayers||!c.transform.projection.unsupportedLayers.includes("custom")||c.terrain&&(c.terrain.renderingToTexture||c.renderPass==="offscreen")&&a.isLayerDraped(n)){if(c.renderPass==="offscreen"){let v=g.prerender;if(v){if(c.setCustomLayerDefaults(),p.setColorMode(c.colorModeForRenderPass()),c.transform.projection.name==="globe"){let k=c.transform.pointMerc;v.call(g,p.gl,c.transform.customLayerMatrix(),c.transform.getProjection(),c.transform.globeToMercatorMatrix(),r.S(c.transform.zoom),[k.x,k.y],c.transform.pixelsPerMeterRatio)}else v.call(g,p.gl,c.transform.customLayerMatrix());p.setDirty(),c.setBaseState()}}else if(c.renderPass==="translucent"){if(c.terrain&&c.terrain.renderingToTexture){let k=g.renderToTile;if(k){let S=d[0].canonical,E=new r.L(S.x+d[0].wrap*(1<<S.z),S.y,S.z);p.setDepthMode(Rt.disabled),p.setStencilMode(jt.disabled),p.setColorMode(c.colorModeForRenderPass()),c.setCustomLayerDefaults(),k.call(g,p.gl,E),p.setDirty(),c.setBaseState()}return}c.setCustomLayerDefaults(),p.setColorMode(c.colorModeForRenderPass()),p.setStencilMode(jt.disabled);let v=g.renderingMode==="3d"?new Rt(c.context.gl.LEQUAL,Rt.ReadWrite,c.depthRangeFor3D):c.depthModeForSublayer(0,Rt.ReadOnly);if(p.setDepthMode(v),c.transform.projection.name==="globe"){let k=c.transform.pointMerc;g.render(p.gl,c.transform.customLayerMatrix(),c.transform.getProjection(),c.transform.globeToMercatorMatrix(),r.S(c.transform.zoom),[k.x,k.y],c.transform.pixelsPerMeterRatio)}else g.render(p.gl,c.transform.customLayerMatrix());p.setDirty(),c.setBaseState(),p.bindFramebuffer.set(null)}}else r.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(c,n,a,d){if(c.renderPass==="opaque")return;let p=a.paint.get("model-opacity");if(p===0)return;let g=a.paint.get("model-cast-shadows");if(c.renderPass==="shadow"&&(!g||c.terrain&&p<.65&&a._transitionablePaint._values["model-opacity"].value.expression instanceof r.Z))return;let v=c.shadowRenderer,k=a.paint.get("model-receive-shadows");v&&(v.useNormalOffset=!0,k||(v.enabled=!1));let S=()=>{v&&(v.useNormalOffset=!0,k||(v.enabled=!0))},E=n.getSource();if(c.renderPass==="light-beam"&&E.type!=="batched-model")return;if(E.type==="vector"||E.type==="geojson")return function(N,H,Q,W){let J=N.transform;if(J.projection.name!=="mercator")return void r.w(`Drawing 3D models for ${J.projection.name} projection is not yet implemented`);let $=J.getFreeCameraOptions().position;if(!N.modelManager)return;let ee=N.modelManager;Q.modelManager=ee;let oe=N.shadowRenderer;if(!Q._unevaluatedLayout._values.hasOwnProperty("model-id"))return;let ae=Q._unevaluatedLayout._values["model-id"],ce=It({},Q.layout.get("model-id").parameters);for(let be of W){let ue=H.getTile(be).getBucket(Q);if(!ue||ue.projection.name!==J.projection.name)continue;let Ie=Nf(be,J);ce.zoom=Ie;let Te=ae.possiblyEvaluate(ce);if(_m(N,ue,be),vo.shadowUniformsInitialized=!1,vo.useSingleShadowCascade=!!oe&&oe.getMaxCascadeForTile(be.toUnwrapped())===0,N.renderPass==="shadow"&&oe){if(N.currentShadowCascade===1&&ue.isInsideFirstShadowMapFrustum)continue;let xe=J.calculatePosMatrix(be.toUnwrapped(),J.worldSize);if(vo.tileMatrix.set(xe),vo.shadowTileMatrix=Float32Array.from(oe.calculateShadowPassMatrixFromMatrix(xe)),vo.aabb.min.fill(0),vo.aabb.max[0]=vo.aabb.max[1]=r.V,vo.aabb.max[2]=0,L0(ue,vo,N,Q.scope))continue}let Be=1<<be.canonical.z,pe=[(($.x-be.wrap)*Be-be.canonical.x)*r.V,($.y*Be-be.canonical.y)*r.V,$.z*Be*r.V];for(let xe in ue.instancesPerModel){let le=ue.instancesPerModel[xe];le.features.length>0&&(xe=Te.evaluate(le.features[0].feature,{}));let ge=ee.getModel(xe,Q.scope);if(ge&&ge.uploaded)for(let Ne of ge.nodes)gm(N,Q,Ne,le,pe,be,vo)}}}(c,n,a,d),void S();if(!E.loaded())return;if(E.type==="batched-model")return function(N,H,Q,W){Q.resetLayerRenderingStats(N);let J=N.context,$=N.transform,ee=N.style.fog,oe=N.shadowRenderer;if($.projection.name!=="mercator")return void r.w(`Drawing 3D landmark models for ${$.projection.name} projection is not yet implemented`);let ae=N.transform.getFreeCameraOptions().position,ce=r.N.scale([],[ae.x,ae.y,ae.z],N.transform.worldSize);r.N.negate(ce,ce);let be=r.a6.identity([]),ue=r.cR($.center.lat,$.zoom),Ie=r.a6.fromScaling([],[1,1,1/ue]);r.a6.translate(be,be,ce);let Te=Q.paint.get("model-opacity"),Be=new Rt(J.gl.LEQUAL,Rt.ReadWrite,N.depthRangeFor3D),pe=new Rt(J.gl.LEQUAL,Rt.ReadOnly,N.depthRangeFor3D),xe=new r.bS([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),le=N.renderPass==="shadow",ge=le&&oe?oe.getCurrentCascadeFrustum():$.getFrustum($.scaleZoom($.worldSize)),Ne=Q.getLayerRenderingStats(),Ye=function(We,rt){for(let _t of W){let Et=H.getTile(_t).getBucket(Q);if(!Et||!Et.uploaded)continue;let vt=!1;oe&&(vt=oe.getMaxCascadeForTile(_t.toUnwrapped())===0);let Tt=$.calculatePosMatrix(_t.toUnwrapped(),$.worldSize),Xt=Et.modelTraits;for(let Nt of Et.getNodesInfo()){if(Nt.hiddenByReplacement||!Nt.node.meshes)continue;let qt=Nt.evaluatedScale,Gt=Nt.node,yi=0;if(N.terrain&&Gt.elevation&&(yi=Gt.elevation*N.terrain.exaggeration()),qt[0]<=1&&qt[1]<=1&&qt[2]<=1&&(()=>{let rn=Nt.getLocalBounds();return xe.min=[...rn.min],xe.max=[...rn.max],xe.min[2]+=yi,xe.max[2]+=yi,r.N.transformMat4(xe.min,xe.min,Tt),r.N.transformMat4(xe.max,xe.max,Tt),xe})().intersects(ge)===0)continue;let tn=N.renderPass==="light-beam",ai=[...Tt];r.a6.translate(ai,ai,[(Gt.anchor?Gt.anchor[0]:0)*(qt[0]-1),(Gt.anchor?Gt.anchor[1]:0)*(qt[1]-1),yi]),r.N.exactEquals(qt,r.cT)||r.a6.scale(ai,ai,qt),r.a6.multiply(ai,ai,Gt.matrix);let vn=r.a6.multiply([],Ie,ai);r.a6.multiply(vn,be,vn);let si=r.a6.invert([],vn);r.a6.transpose(si,si),r.a6.scale(si,si,Nl);let Si=r.a6.multiply([],$.expandedFarZProjMatrix,ai),li=Xt&r.cV.HasMapboxMeshFeatures,Ii=li?0:Nt.evaluatedRMEA[0][2];for(let rn=0;rn<Gt.meshes.length;++rn){let Di=Gt.meshes[rn],ur=rn===Gt.lightMeshIndex;if(ur){if(!tn&&!N.terrain&&N.shadowRenderer){N.currentLayer<N.firstLightBeamLayer&&(N.firstLightBeamLayer=N.currentLayer);continue}}else if(tn)continue;let Sr={defines:[]},ao=[];if(bn(Sr.defines,ao,Di,N),li||Sr.defines.push("DIFFUSE_SHADED"),vt&&Sr.defines.push("SHADOWS_SINGLE_CASCADE"),Ne&&(le?Ne.numRenderedVerticesInShadowPass+=Di.vertexArray.length:Ne.numRenderedVerticesInTransparentPass+=Di.vertexArray.length),le){ye(Di,ai,N,Q);continue}let ga=null;if(ee){let lo=Ks(ai,N.transform);if(ga=new Float32Array(lo),$.projection.name!=="globe"){let ya=Di.aabb.min,gs=Di.aabb.max,[Js,od]=ee.getOpacityForBounds(lo,ya[0],ya[1],gs[0],gs[1]);Sr.overrideFog=Js>=Fi||od>=Fi}}let so=Di.material,mr;so.occlusionTexture&&so.occlusionTexture.offsetScale&&(mr=so.occlusionTexture.offsetScale,Sr.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!le&&oe&&(oe.useNormalOffset=!!Di.normalBuffer);let tr=N.getOrCreateProgram("model",Sr);!le&&oe&&oe.setupShadowsFromMatrix(ai,tr,oe.useNormalOffset),N.uploadCommonUniforms(J,tr,_t.toUnwrapped(),ga);let jr=so.pbrMetallicRoughness;jr.metallicFactor=.9,jr.roughnessFactor=.5;let Yr=Qd(new Float32Array(Si),new Float32Array(vn),new Float32Array(si),N,Te,jr.baseColorFactor,so.emissiveFactor,jr.metallicFactor,jr.roughnessFactor,so,Ii,Q,[0,0,0],mr);tr.draw(N,J.gl.TRIANGLES,rt&&!ur?Be:pe,jt.disabled,We?ur||Te<1||Nt.hasTranslucentParts?ri.alphaBlended:ri.unblended:ri.disabled,Lt.backCCW,Yr,Q.id,Di.vertexBuffer,Di.indexBuffer,Di.segments,Q.paint,N.transform.zoom,void 0,ao)}}}};(function(We,rt,_t,Et){let vt=We.terrain?We.terrain.exaggeration():0,Tt=We.transform.zoom;for(let Xt of Et){let Nt=rt.getTile(Xt).getBucket(_t);Nt&&(We.conflationActive&&Nt.updateReplacement(Xt,We.replacementSource),Nt.evaluateScale(We,_t),We.terrain&&vt>0&&Nt.elevationUpdate(We.terrain,vt,Xt,_t.source),Nt.needsReEvaluation(We,Tt,_t)&&Nt.evaluate(_t))}})(N,H,Q,W),Te===1?Ye(!0,!0):(Ye(!1,!0),Ye(!0,!1))}(c,n,a,d),void S();let A=E.getModels(),P=[],z=c.transform.getFreeCameraOptions().position,O=r.N.scale([],[z.x,z.y,z.z],c.transform.worldSize);r.N.negate(O,O);let U=[],V=[],G=0;for(let N of A){let H=a.paint.get("model-rotation").constantOr(null),Q=a.paint.get("model-scale").constantOr(null),W=a.paint.get("model-translation").constantOr(null);N.computeModelMatrix(c,H,Q,W,!0,!0,!1);let J=r.a6.identity([]),$=r.cR(N.position.lat,c.transform.zoom),ee=r.a6.fromScaling([],[1,1,1/$]);r.a6.translate(J,J,O),P.push({zScaleMatrix:ee,negCameraPosMatrix:J});for(let oe of N.nodes)Gc(c.transform,oe,N.matrix,c.transform.expandedFarZProjMatrix,G,U,V);G++}if(U.sort((N,H)=>H.depth-N.depth),c.renderPass!=="shadow"){if(p===1)for(let N of V)Uc(N,c,a,P[N.modelIndex],jt.disabled,c.colorModeForRenderPass());else{for(let N of V)Uc(N,c,a,P[N.modelIndex],jt.disabled,ri.disabled);for(let N of V)Uc(N,c,a,P[N.modelIndex],c.stencilModeFor3D(),c.colorModeForRenderPass());c.resetStencilClippingMasks()}for(let N of U)Uc(N,c,a,P[N.modelIndex],jt.disabled,c.colorModeForRenderPass());S()}else{for(let N of V)ye(N.mesh,N.nodeModelMatrix,c,a);for(let N of U)ye(N.mesh,N.nodeModelMatrix,c,a);S()}}},ym={model:function(c,n,a){let d=c.scope,p=n.getSource();if(!p.loaded())return;if(p.type==="vector"||p.type==="geojson")return void(a.modelManager&&a.modelManager.upload(a,d));if(p.type==="batched-model")return;let g=p.getModels();for(let v of g)v.upload(a.context)},raster:function(c,n,a){let d=n.getSource();if(!(d instanceof Je&&d.loaded()))return;let p=c.sourceLayer||d.rasterLayerIds&&d.rasterLayerIds[0];if(!p)return;let g=c.paint.get("raster-array-band")||d.getInitialBand(p);if(g==null)return;let v=n.getIds().map(k=>n.getTileByID(k));for(let k of v)k.updateNeeded(p,g)&&d.prepareTile(k,p,g)},"raster-particle":function(c,n,a){let d=n.getSource();if(!(d instanceof Je&&d.loaded()))return;let p=c.sourceLayer||d.rasterLayerIds&&d.rasterLayerIds[0];if(!p)return;let g=c.paint.get("raster-particle-array-band")||d.getInitialBand(p);if(g==null)return;let v=n.getIds().map(k=>n.getTileByID(k));for(let k of v)k.updateNeeded(p,g)&&d.prepareTile(k,p,g)}};class Vf{constructor(n,a,d,p){this.context=new df(n,a),this.transform=d,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=p,this._debugParams={showTerrainProxyTiles:!1},p.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),this.setup(),this.numSublayers=Xo.maxUnderzooming+Xo.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new r.cX,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new zu(this),this._wireframeDebugCache=new jf,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(n,a){let d=!!n&&!!n.terrain&&this.transform.projection.supportsTerrain;if(!(d||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new C0(this,n));let p=this._terrain;this.transform.elevation=d?p:null,p.update(n,this.transform,a),this.transform.elevation&&!p.enabled&&(this.transform.elevation=null)}_updateFog(n){let a=n.fog;if(!a||this.transform.projection.name==="globe"||a.getOpacity(this.transform.pitch)<1||a.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);let[d,p]=a.getFovAdjustedRange(this.transform._fov);if(d>p)return void(this.transform.fogCullDistSq=null);let g=d+.78*(p-d);this.transform.fogCullDistSq=g*g}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(n,a){if(this.width=n*r.f.devicePixelRatio,this.height=a*r.f.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let d of this.style.order)this.style._mergedLayers[d].resize()}setup(){let n=this.context,a=new r.aN;a.emplaceBack(0,0),a.emplaceBack(r.V,0),a.emplaceBack(0,r.V),a.emplaceBack(r.V,r.V),this.tileExtentBuffer=n.createVertexBuffer(a,r.aP.members),this.tileExtentSegments=r.aB.simpleSegment(0,0,4,2);let d=new r.aN;d.emplaceBack(0,0),d.emplaceBack(r.V,0),d.emplaceBack(0,r.V),d.emplaceBack(r.V,r.V),this.debugBuffer=n.createVertexBuffer(d,r.aP.members),this.debugSegments=r.aB.simpleSegment(0,0,4,5);let p=new r.aN;p.emplaceBack(-1,-1),p.emplaceBack(1,-1),p.emplaceBack(-1,1),p.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(p,r.aP.members),this.viewportSegments=r.aB.simpleSegment(0,0,4,2);let g=new r.av;g.emplaceBack(0,0,0,0),g.emplaceBack(r.V,0,r.V,0),g.emplaceBack(0,r.V,0,r.V),g.emplaceBack(r.V,r.V,r.V,r.V),this.mercatorBoundsBuffer=n.createVertexBuffer(g,r.aR.members),this.mercatorBoundsSegments=r.aB.simpleSegment(0,0,4,2);let v=new r.aw;v.emplaceBack(0,1,2),v.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(v);let k=new r.aO;for(let E of[0,1,3,2,0])k.emplaceBack(E);this.debugIndexBuffer=n.createIndexBuffer(k),this.emptyTexture=new r.T(n,new r.h({width:1,height:1},Uint8Array.of(0,0,0,0)),n.gl.RGBA),this.identityMat=r.a6.create();let S=this.context.gl;this.stencilClearMode=new jt({func:S.ALWAYS,mask:0},0,255,S.ZERO,S.ZERO,S.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(n){return n._makeTileBoundsBuffers(this.context,this.transform.projection),n._tileBoundsBuffer?{tileBoundsBuffer:n._tileBoundsBuffer,tileBoundsIndexBuffer:n._tileBoundsIndexBuffer,tileBoundsSegments:n._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){let n=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,n.TRIANGLES,Rt.disabled,this.stencilClearMode,ri.disabled,Lt.disabled,Hu(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(n,a,d){if(!a||this.currentStencilSource===a.id||!n.isTileClipped()||!d||d.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let k=!1;for(let S of d)if(this._tileClippingMaskIDs[S.key]===void 0){k=!0;break}if(!k)return}this.currentStencilSource=a.id;let p=this.context,g=p.gl;this.nextStencilID+d.length>256&&this.clearStencil(),p.setColorMode(ri.disabled),p.setDepthMode(Rt.disabled);let v=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(let k of d){let S=a.getTile(k),E=this._tileClippingMaskIDs[k.key]=this.nextStencilID++,{tileBoundsBuffer:A,tileBoundsIndexBuffer:P,tileBoundsSegments:z}=this.getTileBoundsBuffers(S);v.draw(this,g.TRIANGLES,Rt.disabled,new jt({func:g.ALWAYS,mask:0},E,255,g.KEEP,g.KEEP,g.REPLACE),ri.disabled,Lt.disabled,Hu(k.projMatrix),"$clipping",A,P,z)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let n=this.nextStencilID++,a=this.context.gl;return new jt({func:a.NOTEQUAL,mask:255},n,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);let a=this.context.gl;return new jt({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,a.KEEP,a.KEEP,a.REPLACE)}stencilConfigForOverlap(n){let a=this.context.gl,d=n.sort((v,k)=>k.overscaledZ-v.overscaledZ),p=d[d.length-1].overscaledZ,g=d[0].overscaledZ-p+1;if(g>1){this.currentStencilSource=void 0,this.nextStencilID+g>256&&this.clearStencil();let v={};for(let k=0;k<g;k++)v[k+p]=new jt({func:a.GEQUAL,mask:255},k+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=g,[v,d]}return[{[p]:jt.disabled},d]}colorModeForRenderPass(){let n=this.context.gl;return this._showOverdrawInspector?new ri([n.CONSTANT_COLOR,n.ONE,n.CONSTANT_COLOR,n.ONE],new r.ax(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?ri.unblended:ri.alphaBlended}colorModeForDrapableLayerRenderPass(n){let a=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new ri([a.ONE,a.ONE_MINUS_SRC_ALPHA,a.CONSTANT_ALPHA,a.ONE_MINUS_SRC_ALPHA],new r.ax(0,0,0,n===void 0?0:n),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(n,a,d,p=!1){if(!this.opaquePassEnabledForLayer()&&!p)return Rt.disabled;let g=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new Rt(d||this.context.gl.LEQUAL,a,[g,g])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(n,a){this._wireframeDebugCache.update(this.frameCounter),this.style=n,this.options=a;let d=this.style._mergedLayers,p=this.style.order,g=p.map($=>d[$]),v=this.style._mergedSourceCaches;this.imageManager=n.imageManager,this.modelManager=n.modelManager,this.symbolFadeChange=n.placement.symbolFadeChange(r.f.now()),this.imageManager.beginFrame();let k=0,S=!1;for(let $ in v){let ee=v[$];ee.used&&(ee.prepare(this.context),ee.getSource().usedInConflation&&++k)}for(let $ of g)$.isHidden(this.transform.zoom)||this.prepareLayer($);let E={},A={},P={},z={},O={};for(let $ in v){let ee=v[$];E[$]=ee.getVisibleCoordinates(),A[$]=E[$].slice().reverse(),P[$]=ee.getVisibleCoordinates(!0).reverse(),z[$]=ee.getShadowCasterCoordinates(),O[$]=ee.sortCoordinatesByDistance(E[$])}let U=$=>{let ee=this.style.getLayerSourceCache($);return ee&&ee.used?ee.getSource():null};if(k){let $=[];for(let ee of g)this.layerUsedInConflation(ee,U(ee))&&$.push(ee);if($&&$.length>1){let ee=[];for(let oe of $){let ae=this.style.getLayerSourceCache(oe);ae&&ae.used&&ae.getSource().usedInConflation&&ee.push({layer:oe.fqid,cache:ae})}this.replacementSource.setSources(ee),S=!0}}S||this.replacementSource.clear(),this.conflationActive=S,this.minCutoffZoom=0,this.longestCutoffRange=0;for(let $ of g){let ee=$.cutoffRange();if(this.longestCutoffRange=Math.max(ee,this.longestCutoffRange),ee>0){let oe=U($);oe&&(this.minCutoffZoom=Math.max(oe.minzoom,this.minCutoffZoom)),$.minzoom&&(this.minCutoffZoom=Math.max($.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let $=0;$<g.length;$++)if(g[$].is3D()){this.opaquePassCutoff=$;break}let V=this.style&&this.style.fog;V?(this._fogVisible=V.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=V.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(P),this.opaquePassCutoff=0);let G=this._shadowRenderer;if(G){G.updateShadowParameters(this.transform,this.style.directionalLight);for(let $ in v)for(let ee of E[$]){let oe={min:0,max:0};this.terrain&&(oe=this.terrain.getMinMaxForTile(ee)||oe),G.addShadowReceiver(ee.toUnwrapped(),oe.min,oe.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new r.cY(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new At(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!r.cZ(this.context.gl))return;this.renderPass="offscreen";for(let $ of g){let ee=n.getLayerSourceCache($);if(!$.hasOffscreenPass()||$.isHidden(this.transform.zoom))continue;let oe=ee?A[ee.id]:void 0;($.type==="custom"||$.type==="raster"||$.type==="raster-particle"||$.isSky()||oe&&oe.length)&&this.renderLayer(this,ee,$,oe)}this.depthRangeFor3D=[0,1-(g.length+2)*this.numSublayers*this.depthEpsilon];let N=this.terrain;N&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&N.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,z)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let H=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Q=(()=>{if(a.showOverdrawInspector)return r.ax.black;if(this.style.fog&&this.transform.projection.supportsFog&&!H){let $=this.style.fog.properties.get("color").toArray01();return new r.ax(...$)}if(this.style.fog&&this.transform.projection.supportsFog&&H){let $=this.style.fog.properties.get("space-color").toArray01();return new r.ax(...$)}return r.ax.transparent})();if(this.context.clear({color:Q,depth:1}),this.clearStencil(),this._showOverdrawInspector=a.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&H&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){let $=g[this.currentLayer],ee=n.getLayerSourceCache($);if($.isSky())continue;let oe=ee?($.is3D()?O:A)[ee.id]:void 0;this._renderTileClippingMasks($,ee,oe),this.renderLayer(this,ee,$,oe)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&H&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||r.S(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){let $=g[this.currentLayer],ee=n.getLayerSourceCache($);$.isSky()&&this.renderLayer(this,ee,$,ee?A[ee.id]:void 0)}function W($,ee){let oe;return ee&&(oe=($.type==="symbol"?P:$.is3D()?O:A)[ee.id]),oe}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<p.length;){let $=g[this.currentLayer];if($.type==="raster"){let ee=n.getLayerSourceCache($);this.renderLayer(this,ee,$,W($,ee))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let J=0;for(G&&(J=G.getShadowCastingLayerCount());this.currentLayer<p.length;){let $=g[this.currentLayer],ee=n.getLayerSourceCache($);if($.isSky())++this.currentLayer;else if(N&&this.style.isLayerDraped($)){if($.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=N.renderBatch(this.currentLayer)}else{if(this._renderTileClippingMasks($,ee,ee?E[ee.id]:void 0),this.renderLayer(this,ee,$,W($,ee)),!N&&G&&J>0&&$.hasShadowPass()&&--J==0&&(G.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){let oe=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=oe;this.currentLayer++){let ae=g[this.currentLayer];if(!ae.hasLightBeamPass())continue;let ce=n.getLayerSourceCache(ae);this.renderLayer(this,ce,ae,ce?A[ce.id]:void 0)}this.currentLayer=oe,this.renderPass="translucent"}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let $=null;g.forEach(ee=>{let oe=n.getLayerSourceCache(ee);oe&&!ee.isHidden(this.transform.zoom)&&oe.getVisibleCoordinates().length&&(!$||$.getSource().maxzoom<oe.getSource().maxzoom)&&($=oe)}),$&&this.options.showTileBoundaries&&qc.debug(this,$,$.getVisibleCoordinates(),r.ax.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&qc.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new r.ax(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function($){let ee=$.transform.padding;mm($,$.transform.height-(ee.top||0),3,ro),mm($,ee.bottom||0,3,hs),bo($,ee.left||0,3,Bf),bo($,$.transform.width-(ee.right||0),3,hm);let oe=$.transform.centerPoint;(function(ae,ce,be,ue){yn(ae,ce-1,be-10,2,20,ue),yn(ae,ce-10,be-1,20,2,ue)})($,oe.x,$.transform.height-oe.y,um)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),S||(this.conflationActive=!1)}prepareLayer(n){this.gpuTimingStart(n);let{unsupportedLayers:a}=this.transform.projection,d=!a||!a.includes(n.type);if(ym[n.type]&&(d||this.terrain&&n.type==="custom")){let p=this.style.getLayerSourceCache(n);ym[n.type](n,p,this)}this.gpuTimingEnd()}renderLayer(n,a,d,p){d.isHidden(this.transform.zoom)||(d.type==="background"||d.type==="sky"||d.type==="custom"||d.type==="model"||d.type==="raster"||d.type==="raster-particle"||p&&p.length)&&(this.id=d.id,this.gpuTimingStart(d),(!n.transform.projection.unsupportedLayers||!n.transform.projection.unsupportedLayers.includes(d.type)||n.terrain&&d.type==="custom")&&qc[d.type](n,a,d,p,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;let a=this.context.extTimerQuery,d=this.context.gl,p=this.gpuTimers[n.id];p||(p=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:d.createQuery()}),p.calls++,d.beginQuery(a.TIME_ELAPSED_EXT,p.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){let n=this.context.extTimerQuery,a=this.context.gl,d=a.createQuery();this.deferredRenderGpuTimeQueries.push(d),a.beginQuery(n.TIME_ELAPSED_EXT,d)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){let n=this.gpuTimers;return this.gpuTimers={},n}collectDeferredRenderGpuQueries(){let n=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],n}queryGpuTimers(n){let a={};for(let d in n){let p=n[d],g=this.context.extTimerQuery,v=g.getQueryParameter(p.query,this.context.gl.QUERY_RESULT)/1e6;g.deleteQueryEXT(p.query),a[d]=v}return a}queryGpuTimeDeferredRender(n){if(!this.options.gpuTimingDeferredRender)return 0;let a=this.context.extTimerQuery,d=this.context.gl,p=0;for(let g of n)p+=a.getQueryParameter(g,d.QUERY_RESULT)/1e6,a.deleteQueryEXT(g);return p}translatePosMatrix(n,a,d,p,g){if(!d[0]&&!d[1])return n;let v=g?p==="map"?this.transform.angle:0:p==="viewport"?-this.transform.angle:0;if(v){let E=Math.sin(v),A=Math.cos(v);d=[d[0]*A-d[1]*E,d[0]*E+d[1]*A]}let k=[g?d[0]:r.a3(a,d[0],this.transform.zoom),g?d[1]:r.a3(a,d[1],this.transform.zoom),0],S=new Float32Array(16);return r.a6.translate(S,n,k),S}saveTileTexture(n){let a=n.size[0],d=this._tileTextures[a];d?d.push(n):this._tileTextures[a]=[n]}getTileTexture(n){let a=this._tileTextures[n];return a&&a.length>0?a.pop():null}isPatternMissing(n,a){return n===null||n!==void 0&&!this.imageManager.getPattern(n.toString(),a)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(n,a,d){let p=d===void 0?this.terrain&&this.terrain.renderingToTexture:d,g=this.terrain&&this.terrain.exaggeration()===0,v=[];return this.style&&this.style.enable3dLights()&&(n==="globeRaster"||n==="terrainRaster"?(v.push("LIGHTING_3D_MODE"),v.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):p||v.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||v.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?v.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):v.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(v.push("TERRAIN"),this.linearFloatFilteringSupported()&&v.push("TERRAIN_DEM_FLOAT_FORMAT"),g&&v.push("ZERO_EXAGGERATION")),this.transform.projection.name==="globe"&&v.push("GLOBE"),!this._fogVisible||p||a!==void 0&&!a||v.push("FOG","FOG_DITHERING"),p&&v.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&v.push("OVERDRAW_INSPECTOR"),v}getOrCreateProgram(n,a){this.cache=this.cache||{};let d=a&&a.defines||[],p=a&&a.config,g=a&&a.transformFeedback,v=this.currentGlobalDefines(n,a&&a.overrideFog,a&&a.overrideRtt).concat(d),k=Yu.cacheKey(Vu[n],n,v,p);return this.cache[k]||(this.cache[k]=new Yu(this.context,n,Vu[n],p,A0[n],v,g)),this.cache[k]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new r.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(n,a){if(this.style.enable3dLights()){let d=this.style.directionalLight,p=this.style.ambientLight;if(d&&p){let g=((v,k)=>{let S=v.properties.get("direction"),E=v.properties.get("color").toArray01(),A=v.properties.get("intensity"),P=k.properties.get("color").toArray01(),z=k.properties.get("intensity"),O=[S.x,S.y,S.z],U=r.cn(P,z),V=r.cn(E,A);return{u_lighting_ambient_color:U,u_lighting_directional_dir:O,u_lighting_directional_color:V,u_ground_radiance:Wu(O,V,U)}})(d,p);a.setLightsUniformValues(n,g)}}}uploadCommonUniforms(n,a,d,p,g){if(this.uploadCommonLightUniforms(n,a),this.terrain&&this.terrain.renderingToTexture)return;let v=this.style.fog;if(v){let k=v.getOpacity(this.transform.pitch),S=((E,A,P,z,O,U,V,G,N,H,Q,W)=>{let J=E.transform,$=A.properties.get("color").toArray01();$[3]=z;let ee=E.frameCounter/1e3%1,[oe,ae]=A.properties.get("vertical-range");return{u_fog_matrix:P?J.calculateFogTileMatrix(P):W||E.identityMat,u_fog_range:A.getFovAdjustedRange(J._fov),u_fog_color:$,u_fog_horizon_blend:A.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(oe,ae),ae],u_fog_temporal_offset:ee,u_frustum_tl:O,u_frustum_tr:U,u_frustum_br:V,u_frustum_bl:G,u_globe_pos:N,u_globe_radius:H,u_viewport:Q,u_globe_transition:r.S(J.zoom),u_is_globe:+(J.projection.name==="globe")}})(this,v,d,k,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*r.f.devicePixelRatio,this.transform.height*r.f.devicePixelRatio],p);a.setFogUniformValues(n,S)}g&&a.setCutoffUniformValues(n,g.uniformValues)}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){let n=this.canvasCopy();n&&(this.frameCopies.push(n),this.tileLoaded=!1)}canvasCopy(){let n=this.context.gl,a=n.createTexture();return n.bindTexture(n.TEXTURE_2D,a),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),a}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;let n=this.style&&this.style.fog;return!!n&&n.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){let n=this._backgroundTiles,a=this._backgroundTiles={},d=this.transform.coveringTiles({tileSize:512});for(let p of d)a[p.key]=n[p.key]||new es(p,512,this.transform.tileZoom,this);return a}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(n,a){return!(!n.is3D()||n.minzoom&&n.minzoom>this.transform.zoom||n.sourceLayer!=="building"&&(!a||a.type!=="batched-model"))}isTileAffectedByFog(n){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let a=this._cachedTileFogOpacities[n.key];return a||(this._cachedTileFogOpacities[n.key]=a=this.style.fog.getOpacityForTile(n)),a[0]>=Fi||a[1]>=Fi}}function Hc(c,n){let a=!1,d=null,p=()=>{d=null,a&&(c(),d=setTimeout(p,n),a=!1)};return()=>(a=!0,d||p(),d)}class th{constructor(n){this._hashName=n&&encodeURIComponent(n),r.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Hc(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,window.addEventListener("hashchange",this._onHashChange,!1),n.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){let n=this._map;if(!n)return"";let a=bm(n);if(this._hashName){let d=this._hashName,p=!1,g=location.hash.slice(1).split("&").map(v=>{let k=v.split("=")[0];return k===d?(p=!0,`${k}=${a}`):v}).filter(v=>v);return p||g.push(`${d}=${a}`),`#${g.join("&")}`}return`#${a}`}_getCurrentHash(){let n=location.hash.replace("#","");if(this._hashName){let a;return n.split("&").map(d=>d.split("=")).forEach(d=>{d[0]===this._hashName&&(a=d)}),(a&&a[1]||"").split("/")}return n.split("/")}_onHashChange(){let n=this._map;if(!n)return!1;let a=this._getCurrentHash();if(a.length>=3&&!a.some(d=>isNaN(d))){let d=n.dragRotate.isEnabled()&&n.touchZoomRotate.isEnabled()?+(a[3]||0):n.getBearing();return n.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:d,pitch:+(a[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function bm(c,n){let a=c.getCenter(),d=Math.round(100*c.getZoom())/100,p=Math.ceil((d*Math.LN2+Math.log(512/360/.5))/Math.LN10),g=Math.pow(10,p),v=Math.round(a.lng*g)/g,k=Math.round(a.lat*g)/g,S=c.getBearing(),E=c.getPitch(),A=n?`/${v}/${k}/${d}`:`${d}/${k}/${v}`;return(S||E)&&(A+="/"+Math.round(10*S)/10),E&&(A+=`/${Math.round(E)}`),A}let Zc={linearity:.3,easing:r.c_(0,0,.3,1)},oo=r.e({deceleration:2500,maxSpeed:1400},Zc),O0=r.e({deceleration:20,maxSpeed:1400},Zc),ih=r.e({deceleration:1e3,maxSpeed:360},Zc),ln=r.e({deceleration:1e3,maxSpeed:90},Zc);class Bi{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:r.f.now(),settings:n})}_drainInertiaBuffer(){let n=this._inertiaBuffer,a=r.f.now();for(;n.length>0&&a-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;let a={zoom:0,bearing:0,pitch:0,pan:new r.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:g}of this._inertiaBuffer)a.zoom+=g.zoomDelta||0,a.bearing+=g.bearingDelta||0,a.pitch+=g.pitchDelta||0,g.panDelta&&a.pan._add(g.panDelta),g.around&&(a.around=g.around),g.pinchAround&&(a.pinchAround=g.pinchAround);let d=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,p={};if(a.pan.mag()){let g=ea(a.pan.mag(),d,r.e({},oo,n||{}));p.offset=a.pan.mult(g.amount/a.pan.mag()),p.center=this._map.transform.center,Wc(p,g)}if(a.zoom){let g=ea(a.zoom,d,O0);p.zoom=this._map.transform.zoom+g.amount,Wc(p,g)}if(a.bearing){let g=ea(a.bearing,d,ih);p.bearing=this._map.transform.bearing+r.aa(g.amount,-179,179),Wc(p,g)}if(a.pitch){let g=ea(a.pitch,d,ln);p.pitch=this._map.transform.pitch+g.amount,Wc(p,g)}if(p.zoom||p.bearing){let g=a.pinchAround===void 0?a.around:a.pinchAround;p.around=g?this._map.unproject(g):this._map.getCenter()}return this.clear(),p.noMoveStart=!0,p}}function Wc(c,n){(!c.duration||c.duration<n.duration)&&(c.duration=n.duration,c.easing=n.easing)}function ea(c,n,a){let{maxSpeed:d,linearity:p,deceleration:g}=a,v=r.aa(c*p/(n/1e3),-d,d),k=Math.abs(v)/(g*p);return{easing:a.easing,duration:1e3*k,amount:v*(k/2)}}class Xr extends r.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,a,d,p={}){let g=qr(a.getCanvasContainer(),d),v=a.unproject(g);super(n,r.e({point:g,lngLat:v,originalEvent:d},p)),this._defaultPrevented=!1,this.target=a}}class La extends r.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,a,d){let p=n==="touchend"?d.changedTouches:d.touches,g=eo(a.getCanvasContainer(),p),v=g.map(S=>a.unproject(S)),k=g.reduce((S,E,A,P)=>S.add(E.div(P.length)),new r.P(0,0));super(n,{points:g,point:k,lngLats:v,lngLat:a.unproject(k),originalEvent:d}),this._defaultPrevented=!1}}class vm extends r.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,a,d){super(n,{originalEvent:d}),this._defaultPrevented=!1}}class xm{constructor(n,a){this._map=n,this._clickTolerance=a.clickTolerance}reset(){this._mousedownPos=void 0}wheel(n){return this._firePreventable(new vm(n.type,this._map,n))}mousedown(n,a){return this._mousedownPos=a,this._firePreventable(new Xr(n.type,this._map,n))}mouseup(n){this._map.fire(new Xr(n.type,this._map,n))}preclick(n){let a=r.e({},n);a.type="preclick",this._map.fire(new Xr(a.type,this._map,a))}click(n,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||(this.preclick(n),this._map.fire(new Xr(n.type,this._map,n)))}dblclick(n){return this._firePreventable(new Xr(n.type,this._map,n))}mouseover(n){this._map.fire(new Xr(n.type,this._map,n))}mouseout(n){this._map.fire(new Xr(n.type,this._map,n))}touchstart(n){return this._firePreventable(new La(n.type,this._map,n))}touchmove(n){this._map.fire(new La(n.type,this._map,n))}touchend(n){this._map.fire(new La(n.type,this._map,n))}touchcancel(n){this._map.fire(new La(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ms{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(n){this._map.fire(new Xr(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Xr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new Xr(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ps{constructor(n,a){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,a){this.isEnabled()&&n.shiftKey&&n.button===0&&(Hi(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(n,a){if(!this._active)return;let d=a,p=this._startPos,g=this._lastPos;if(!p||!g||g.equals(d)||!this._box&&d.dist(p)<this._clickTolerance)return;this._lastPos=d,this._box||(this._box=me("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));let v=Math.min(p.x,d.x),k=Math.max(p.x,d.x),S=Math.min(p.y,d.y),E=Math.max(p.y,d.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${v}px,${S}px)`,this._box.style.width=k-v+"px",this._box.style.height=E-S+"px")})}mouseupWindow(n,a){if(!this._active)return;let d=this._startPos,p=a;if(d&&n.button===0){if(this.reset(),$r(),d.x!==p.x||d.y!==p.y)return this._map.fire(new r.b("boxzoomend",{originalEvent:n})),{cameraAnimation:g=>g.fitScreenCoordinates(d,p,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}}keydown(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),mi(),delete this._startPos,delete this._lastPos}_fireEvent(n,a){return this._map.fire(new r.b(n,{originalEvent:a}))}}function jl(c,n){let a={};for(let d=0;d<c.length;d++)a[c[d].identifier]=n[d];return a}class nh{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(n,a,d){(this.centroid||d.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=n.timeStamp),d.length===this.numTouches&&(this.centroid=function(p){let g=new r.P(0,0);for(let v of p)g._add(v);return g.div(p.length)}(a),this.touches=jl(d,a)))}touchmove(n,a,d){if(this.aborted||!this.centroid)return;let p=jl(d,a);for(let g in this.touches){let v=p[g];(!v||v.dist(this.touches[g])>30)&&(this.aborted=!0)}}touchend(n,a,d){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),d.length===0){let p=!this.aborted&&this.centroid;if(this.reset(),p)return p}}}class Xc{constructor(n){this.singleTap=new nh(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(n,a,d){this.singleTap.touchstart(n,a,d)}touchmove(n,a,d){this.singleTap.touchmove(n,a,d)}touchend(n,a,d){let p=this.singleTap.touchend(n,a,d);if(p){let g=n.timeStamp-this.lastTime<500,v=!this.lastTap||this.lastTap.dist(p)<30;if(g&&v||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=p,this.count===this.numTaps)return this.reset(),p}}}class wm{constructor(){this._zoomIn=new Xc({numTouches:1,numTaps:2}),this._zoomOut=new Xc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,a,d){this._zoomIn.touchstart(n,a,d),this._zoomOut.touchstart(n,a,d)}touchmove(n,a,d){this._zoomIn.touchmove(n,a,d),this._zoomOut.touchmove(n,a,d)}touchend(n,a,d){let p=this._zoomIn.touchend(n,a,d),g=this._zoomOut.touchend(n,a,d);return p?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:v=>v.easeTo({duration:300,zoom:v.getZoom()+1,around:v.unproject(p)},{originalEvent:n})}):g?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:v=>v.easeTo({duration:300,zoom:v.getZoom()-1,around:v.unproject(g)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}let Tm={0:1,2:2};class _a{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(n,a){return!1}_move(n,a){return{}}mousedown(n,a){if(this._lastPoint)return;let d=fo(n);this._correctButton(n,d)&&(this._lastPoint=a,this._eventButton=d)}mousemoveWindow(n,a){let d=this._lastPoint;if(d){if(n.preventDefault(),this._eventButton!=null&&function(p,g){let v=Tm[g];return p.buttons===void 0||(p.buttons&v)!==v}(n,this._eventButton))this.reset();else if(this._moved||!(a.dist(d)<this._clickTolerance))return this._moved=!0,this._lastPoint=a,this._move(d,a)}}mouseupWindow(n){this._lastPoint&&fo(n)===this._eventButton&&(this._moved&&$r(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class km extends _a{mousedown(n,a){super.mousedown(n,a),this._lastPoint&&(this._active=!0)}_correctButton(n,a){return a===0&&!n.ctrlKey}_move(n,a){return{around:a,panDelta:a.sub(n)}}}class Yc extends _a{_correctButton(n,a){return a===0&&n.ctrlKey||a===2}_move(n,a){let d=.8*(a.x-n.x);if(d)return this._active=!0,{bearingDelta:d}}contextmenu(n){n.preventDefault()}}class rh extends _a{_correctButton(n,a){return a===0&&n.ctrlKey||a===2}_move(n,a){let d=-.5*(a.y-n.y);if(d)return this._active=!0,{pitchDelta:d}}contextmenu(n){n.preventDefault()}}class Im{constructor(n,a){this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=a.clickTolerance||1,this.reset(),r.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new r.P(0,0)}touchstart(n,a,d){return this._calculateTransform(n,a,d)}touchmove(n,a,d){if(this._active&&!(d.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(d.length===1&&!r.c$())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return n.cancelable&&n.preventDefault(),this._calculateTransform(n,a,d)}}touchend(n,a,d){this._calculateTransform(n,a,d),this._active&&d.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,a,d){d.length>0&&(this._active=!0);let p=jl(d,a),g=new r.P(0,0),v=new r.P(0,0),k=0;for(let E in p){let A=p[E],P=this._touches[E];P&&(g._add(A),v._add(A.sub(P)),k++,p[E]=A)}if(this._touches=p,k<this._minTouches||!v.mag())return;let S=v.div(k);return this._sum._add(S),this._sum.mag()<this._clickTolerance?void 0:{around:g.div(k),panDelta:S}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=me("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class hr{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(n){}_move(n,a,d){return{}}touchstart(n,a,d){this._firstTwoTouches||d.length<2||(this._firstTwoTouches=[d[0].identifier,d[1].identifier],this._start([a[0],a[1]]))}touchmove(n,a,d){let p=this._firstTwoTouches;if(!p)return;n.preventDefault();let[g,v]=p,k=Vl(d,a,g),S=Vl(d,a,v);if(!k||!S)return;let E=this._aroundCenter?null:k.add(S).div(2);return this._move([k,S],E,n)}touchend(n,a,d){if(!this._firstTwoTouches)return;let[p,g]=this._firstTwoTouches,v=Vl(d,a,p),k=Vl(d,a,g);v&&k||(this._active&&$r(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Vl(c,n,a){for(let d=0;d<c.length;d++)if(c[d].identifier===a)return n[d]}function oh(c,n){return Math.log(c/n)/Math.LN2}class Kc extends hr{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,a){let d=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(oh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:oh(this._distance,d),pinchAround:a}}}function fs(c,n){return 180*c.angleWith(n)/Math.PI}class Sm extends hr{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,a){let d=this._vector;if(this._vector=n[0].sub(n[1]),d&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:fs(this._vector,d),pinchAround:a}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());let a=25/(Math.PI*this._minDiameter)*360,d=this._startVector;if(!d)return!1;let p=fs(n,d);return Math.abs(p)<a}}function Qc(c){return Math.abs(c.y)>Math.abs(c.x)}class Cm extends hr{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(n){this._lastPoints=n,Qc(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,a,d){let p=this._lastPoints;if(!p)return;let g=n[0].sub(p[0]),v=n[1].sub(p[1]);return this._map._cooperativeGestures&&!r.c$()&&d.touches.length<3||(this._valid=this.gestureBeginsVertically(g,v,d.timeStamp),!this._valid)?void 0:(this._lastPoints=n,this._active=!0,{pitchDelta:(g.y+v.y)/2*-.5})}gestureBeginsVertically(n,a,d){if(this._valid!==void 0)return this._valid;let p=n.mag()>=2,g=a.mag()>=2;if(!p&&!g)return;if(!p||!g)return this._firstMove==null&&(this._firstMove=d),d-this._firstMove<100&&void 0;let v=n.y>0==a.y>0;return Qc(n)&&Qc(a)&&v}}let Qs={panStep:100,bearingStep:15,pitchStep:10};class Jc{constructor(){let n=Qs;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let a=0,d=0,p=0,g=0,v=0;switch(n.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:n.shiftKey?d=-1:(n.preventDefault(),g=-1);break;case 39:n.shiftKey?d=1:(n.preventDefault(),g=1);break;case 38:n.shiftKey?p=1:(n.preventDefault(),v=-1);break;case 40:n.shiftKey?p=-1:(n.preventDefault(),v=1);break;default:return}return this._rotationDisabled&&(d=0,p=0),{cameraAnimation:k=>{let S=k.getZoom();k.easeTo({duration:300,easeId:"keyboardHandler",easing:Mm,zoom:a?Math.round(S)+a*(n.shiftKey?2:1):S,bearing:k.getBearing()+d*this._bearingStep,pitch:k.getPitch()+p*this._pitchStep,offset:[-g*this._panStep,-v*this._panStep],center:k.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Mm(c){return c*(2-c)}let ed=4.000244140625,Em=1/450;class Uf{constructor(n,a){this._map=n,this._el=n.getCanvasContainer(),this._handler=a,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Em,r.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&n.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(n.ctrlKey||n.metaKey||this.isZooming()||r.c$()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let a=n.deltaMode===WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY,d=r.f.now(),p=d-(this._lastWheelEventTime||0);this._lastWheelEventTime=d,a!==0&&a%ed==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":p>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(p*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),n.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=n,this._delta-=a,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let a=qr(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:a,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let n=this._map.transform;this._type==="wheel"&&n.projection.wrap&&(n._center.lng>=180||n._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);let a=()=>n._terrainEnabled()&&this._aroundCoord?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(this._delta!==0){let E=this._type==="wheel"&&Math.abs(this._delta)>ed?this._wheelZoomRate:this._defaultZoomRate,A=2/(1+Math.exp(-Math.abs(this._delta*E)));this._delta<0&&A!==0&&(A=1/A);let P=a(),z=Math.pow(2,P),O=typeof this._targetZoom=="number"?n.zoomScale(this._targetZoom):z;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(O*A))),this._type==="wheel"&&(this._startZoom=P,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}let d=typeof this._targetZoom=="number"?this._targetZoom:a(),p=this._startZoom,g=this._easing,v,k=!1;if(this._type==="wheel"&&p&&g){let E=Math.min((r.f.now()-this._lastWheelEventTime)/200,1),A=g(E);v=r.U(p,d,A),E<1?this._frameId||(this._frameId=!0):k=!0}else v=d,k=!0;this._active=!0,k&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let S=v-a();return S*this._lastDelta<0&&(S=0),{noInertia:!0,needsRenderFrame:!k,zoomDelta:S,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let a=r.d0;if(this._prevEase){let d=this._prevEase,p=(r.f.now()-d.start)/d.duration,g=d.easing(p+.01)-d.easing(p),v=.27/Math.sqrt(g*g+1e-4)*.01,k=Math.sqrt(.0729-v*v);a=r.c_(v,k,.25,1)}return this._prevEase={start:r.f.now(),duration:n,easing:a},a}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=me("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Gf{constructor(n,a){this._clickZoom=n,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class $f{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(n,a){return n.preventDefault(),{cameraAnimation:d=>{d.easeTo({duration:300,zoom:d.getZoom()+(n.shiftKey?-1:1),around:d.unproject(a)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class qf{constructor(){this._tap=new Xc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(n,a,d){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?d.length>0&&(this._swipePoint=a[0],this._swipeTouch=d[0].identifier):this._tap.touchstart(n,a,d))}touchmove(n,a,d){if(this._tapTime){if(this._swipePoint){if(d[0].identifier!==this._swipeTouch)return;let p=a[0],g=p.y-this._swipePoint.y;return this._swipePoint=p,n.preventDefault(),this._active=!0,{zoomDelta:g/128}}}else this._tap.touchmove(n,a,d)}touchend(n,a,d){this._tapTime?this._swipePoint&&d.length===0&&this.reset():this._tap.touchend(n,a,d)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Hf{constructor(n,a,d){this._el=n,this._mousePan=a,this._touchPan=d}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Zf{constructor(n,a,d){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=a,this._mousePitch=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Wf{constructor(n,a,d,p){this._el=n,this._touchZoom=a,this._touchRotate=d,this._tapDragZoom=p,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let td=c=>c.zoom||c.drag||c.pitch||c.rotate;class Xf extends r.b{}class Yf{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,a){let d=r.N.sub([],a,n);this.radius=r.N.length(d[2]<0?r.N.div([],d,this.constants):[d[0],d[1],0])}projectRay(n){r.N.div(n,n,this.constants),r.N.normalize(n,n),r.N.mul(n,n,this.constants);let a=r.N.scale([],n,this.radius);if(a[2]>0){let d=r.N.scale([],[0,0,1],r.N.dot(a,[0,0,1])),p=r.N.scale([],r.N.normalize([],[a[0],a[1],0]),this.radius),g=r.N.add([],a,r.N.scale([],r.N.sub([],r.N.add([],p,d),a),2));a[0]=g[0],a[1]=g[1]}return a}}function id(c){return c.panDelta&&c.panDelta.mag()||c.zoomDelta||c.bearingDelta||c.pitchDelta}class F0{constructor(n,a){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Bi(n),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Yf,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(a),r.aY(["handleEvent","handleWindowEvent"],this);let d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[window,"blur",void 0]];for(let[p,g,v]of this._listeners){let k=p===document?this.handleWindowEvent:this.handleEvent;p.addEventListener(g,k,v)}}destroy(){for(let[n,a,d]of this._listeners){let p=n===document?this.handleWindowEvent:this.handleEvent;n.removeEventListener(a,p,d)}}_addDefaultHandlers(n){let a=this._map,d=a.getCanvasContainer();this._add("mapEvent",new xm(a,n));let p=a.boxZoom=new ps(a,n);this._add("boxZoom",p);let g=new wm,v=new $f;a.doubleClickZoom=new Gf(v,g),this._add("tapZoom",g),this._add("clickZoom",v);let k=new qf;this._add("tapDragZoom",k);let S=a.touchPitch=new Cm(a);this._add("touchPitch",S);let E=new Yc(n),A=new rh(n);a.dragRotate=new Zf(n,E,A),this._add("mouseRotate",E,["mousePitch"]),this._add("mousePitch",A,["mouseRotate"]);let P=new km(n),z=new Im(a,n);a.dragPan=new Hf(d,P,z),this._add("mousePan",P),this._add("touchPan",z,["touchZoom","touchRotate"]);let O=new Sm,U=new Kc;a.touchZoomRotate=new Wf(d,U,O,k),this._add("touchRotate",O,["touchPan","touchZoom"]),this._add("touchZoom",U,["touchPan","touchRotate"]),this._add("blockableMapEvent",new ms(a));let V=a.scrollZoom=new Uf(a,this);this._add("scrollZoom",V,["mousePan"]);let G=a.keyboard=new Jc;this._add("keyboard",G);for(let N of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[N]&&a[N].enable(n[N])}_add(n,a,d){this._handlers.push({handlerName:n,handler:a,allowed:d}),this._handlersById[n]=a}stop(n){if(!this._updatingCamera){for(let{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[],this._originalZoom=void 0}}isActive(){for(let{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!td(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(n,a,d){for(let p in n)if(p!==d&&(!a||a.indexOf(p)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){let a=[];for(let d of n)this._el.contains(d.target)&&a.push(d);return a}handleEvent(n,a){this._updatingCamera=!0;let d=n.type==="renderFrame",p=d?void 0:n,g={needsRenderFrame:!1},v={},k={},S=n.touches?this._getMapTouches(n.touches):void 0,E=S?eo(this._el,S):d?void 0:qr(this._el,n);for(let{handlerName:z,handler:O,allowed:U}of this._handlers){if(!O.isEnabled())continue;let V;this._blockedByActive(k,U,z)?O.reset():O[a||n.type]&&(V=O[a||n.type](n,E,S),this.mergeHandlerResult(g,v,V,z,p),V&&V.needsRenderFrame&&this._triggerRenderFrame()),(V||O.isActive())&&(k[z]=O)}let A={};for(let z in this._previousActiveHandlers)k[z]||(A[z]=p);this._previousActiveHandlers=k,(Object.keys(A).length||id(g))&&(this._changes.push([g,v,A]),this._triggerRenderFrame()),(Object.keys(k).length||id(g))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:P}=g;P&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],P(this._map))}mergeHandlerResult(n,a,d,p,g){if(!d)return;r.e(n,d);let v={handlerName:p,originalEvent:d.originalEvent||g};d.zoomDelta!==void 0&&(a.zoom=v),d.panDelta!==void 0&&(a.drag=v),d.pitchDelta!==void 0&&(a.pitch=v),d.bearingDelta!==void 0&&(a.rotate=v)}_applyChanges(){let n={},a={},d={};for(let[p,g,v]of this._changes)p.panDelta&&(n.panDelta=(n.panDelta||new r.P(0,0))._add(p.panDelta)),p.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+p.zoomDelta),p.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+p.bearingDelta),p.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+p.pitchDelta),p.around!==void 0&&(n.around=p.around),p.aroundCoord!==void 0&&(n.aroundCoord=p.aroundCoord),p.pinchAround!==void 0&&(n.pinchAround=p.pinchAround),p.noInertia&&(n.noInertia=p.noInertia),r.e(a,g),r.e(d,v);this._updateMapTransform(n,a,d),this._changes=[]}_updateMapTransform(n,a,d){let p=this._map,g=p.transform,v=H=>[H.x,H.y,H.z];if((H=>{let Q=this._eventsInProgress.drag;return Q&&!this._handlersById[Q.handlerName].isActive()})()&&!id(n)){let H=g.zoom;g.cameraElevationReference="sea",this._originalZoom!=null&&g._orthographicProjectionAtLowPitch&&g.projection.name!=="globe"&&g.pitch===0?(g.cameraElevationReference="ground",g.zoom=this._originalZoom):(g.recenterOnTerrain(),g.cameraElevationReference="ground"),H!==g.zoom&&this._map._update(!0)}if(g._isCameraConstrained&&p._stop(!0),!id(n))return void this._fireEvents(a,d,!0);let{panDelta:k,zoomDelta:S,bearingDelta:E,pitchDelta:A,around:P,aroundCoord:z,pinchAround:O}=n;g._isCameraConstrained&&(S>0&&(S=0),g._isCameraConstrained=!1),O!==void 0&&(P=O),(S||(H=>a[H]&&!this._eventsInProgress[H])("drag"))&&P&&(this._dragOrigin=v(g.pointCoordinate3D(P)),this._originalZoom=g.zoom,this._trackingEllipsoid.setup(g._camera.position,this._dragOrigin)),g.cameraElevationReference="sea",p._stop(!0),P=P||p.transform.centerPoint,E&&(g.bearing+=E),A&&(g.pitch+=A),g._updateCameraState();let U=[0,0,0];if(k)if(g.projection.name==="mercator"){let H=this._trackingEllipsoid.projectRay(g.screenPointToMercatorRay(P).dir),Q=this._trackingEllipsoid.projectRay(g.screenPointToMercatorRay(P.sub(k)).dir);U[0]=Q[0]-H[0],U[1]=Q[1]-H[1]}else{let H=g.pointCoordinate(P);if(g.projection.name==="globe"){k=k.rotate(-g.angle);let Q=g._pixelsPerMercatorPixel/g.worldSize;U[0]=-k.x*r.d1(r.au(H.y))*Q,U[1]=-k.y*r.d1(g.center.lat)*Q}else{let Q=g.pointCoordinate(P.sub(k));H&&Q&&(U[0]=Q.x-H.x,U[1]=Q.y-H.y)}}let V=g.zoom,G=[0,0,0];if(S){let H=v(z||g.pointCoordinate3D(P)),Q={dir:r.N.normalize([],r.N.sub([],H,g._camera.position))};if(Q.dir[2]<0){let W=g.zoomDeltaToMovement(H,S);r.N.scale(G,Q.dir,W)}}let N=r.N.add(U,U,G);g._translateCameraConstrained(N),S&&Math.abs(g.zoom-V)>1e-4&&g.recenterOnTerrain(),g.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(a,d,!0)}_fireEvents(n,a,d){let p=td(this._eventsInProgress),g=td(n),v={};for(let A in n){let{originalEvent:P}=n[A];this._eventsInProgress[A]||(v[`${A}start`]=P),this._eventsInProgress[A]=n[A]}!p&&g&&this._fireEvent("movestart",g.originalEvent);for(let A in v)this._fireEvent(A,v[A]);g&&this._fireEvent("move",g.originalEvent);for(let A in n){let{originalEvent:P}=n[A];this._fireEvent(A,P)}let k={},S;for(let A in this._eventsInProgress){let{handlerName:P,originalEvent:z}=this._eventsInProgress[A];this._handlersById[P].isActive()||(delete this._eventsInProgress[A],S=a[P]||z,k[`${A}end`]=S)}for(let A in k)this._fireEvent(A,k[A]);let E=td(this._eventsInProgress);if(d&&(p||g)&&!E){this._updatingCamera=!0;let A=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),P=z=>z!==0&&-this._bearingSnap<z&&z<this._bearingSnap;A?(P(A.bearing||this._map.getBearing())&&(A.bearing=0),this._map.easeTo(A,{originalEvent:S})):(this._map.fire(new r.b("moveend",{originalEvent:S})),P(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,a){this._map.fire(new r.b(n,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{this._frameId=void 0,this.handleEvent(new Xf("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}let Kf="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Rn extends r.E{constructor(n,a){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=a.bearingSnap,this._respectPrefersReducedMotion=a.respectPrefersReducedMotion!==!1,r.aY(["_renderFrameCallback"],this)}getCenter(){return new r.bn(this.transform.center.lng,this.transform.center.lat)}setCenter(n,a){return this.jumpTo({center:n},a)}panBy(n,a,d){return n=r.P.convert(n).mult(-1),this.panTo(this.transform.center,r.e({offset:n},a),d)}panTo(n,a,d){return this.easeTo(r.e({center:n},a),d)}getZoom(){return this.transform.zoom}setZoom(n,a){return this.jumpTo({zoom:n},a),this}zoomTo(n,a,d){return this.easeTo(r.e({zoom:n},a),d)}zoomIn(n,a){return this.zoomTo(this.getZoom()+1,n,a),this}zoomOut(n,a){return this.zoomTo(this.getZoom()-1,n,a),this}getBearing(){return this.transform.bearing}setBearing(n,a){return this.jumpTo({bearing:n},a),this}getPadding(){return this.transform.padding}setPadding(n,a){return this.jumpTo({padding:n},a),this}rotateTo(n,a,d){return this.easeTo(r.e({bearing:n},a),d)}resetNorth(n,a){return this.rotateTo(0,r.e({duration:1e3},n),a),this}resetNorthPitch(n,a){return this.easeTo(r.e({bearing:0,pitch:0,duration:1e3},n),a),this}snapToNorth(n,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,a):this}getPitch(){return this.transform.pitch}setPitch(n,a){return this.jumpTo({pitch:n},a),this}cameraForBounds(n,a){n=r.ad.convert(n);let d=a&&a.bearing||0,p=a&&a.pitch||0,g=n.getNorthWest(),v=n.getSouthEast();return this._cameraForBounds(this.transform,g,v,d,p,a)}_extendCameraOptions(n){let a={top:0,bottom:0,right:0,left:0};if(typeof(n=r.e({padding:a,offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding=="number"){let d=n.padding;n.padding={top:d,bottom:d,right:d,left:d}}return n.padding=r.e(a,n.padding),n}_minimumAABBFrustumDistance(n,a){let d=a.max[0]-a.min[0],p=a.max[1]-a.min[1];return d/p>n.aspect?d/(2*Math.tan(.5*n.fovX)*n.aspect):p/(2*Math.tan(.5*n.fovY)*n.aspect)}_cameraForBoundsOnGlobe(n,a,d,p,g,v){let k=n.clone(),S=this._extendCameraOptions(v);k.bearing=p,k.pitch=g;let E=r.bn.convert(a),A=r.bn.convert(d),P=.5*(E.lat+A.lat),z=.5*(E.lng+A.lng),O=r.d2(P,z),U=r.N.normalize([],O),V=r.N.normalize([],r.N.cross([],U,[0,1,0])),G=r.N.cross([],V,U),N=[V[0],V[1],V[2],0,G[0],G[1],G[2],0,U[0],U[1],U[2],0,0,0,0,1],H=[O,r.d2(E.lat,E.lng),r.d2(A.lat,E.lng),r.d2(A.lat,A.lng),r.d2(E.lat,A.lng),r.d2(P,E.lng),r.d2(P,A.lng),r.d2(E.lat,z),r.d2(A.lat,z)],Q=r.bS.fromPoints(H.map(ge=>[r.N.dot(V,ge),r.N.dot(G,ge),r.N.dot(U,ge)])),W=r.N.transformMat4([],Q.center,N);r.N.squaredLength(W)===0&&r.N.set(W,0,0,1),r.N.normalize(W,W),r.N.scale(W,W,r.ab),k.center=r.d3(W);let J=k.getWorldToCameraMatrix(),$=r.a6.invert(new Float64Array(16),J);Q=r.bS.applyTransform(Q,r.a6.multiply([],J,N)),r.N.transformMat4(W,W,J);let ee=.5*(Q.max[2]-Q.min[2]),oe=this._minimumAABBFrustumDistance(k,Q),ae=r.N.scale([],[0,0,1],ee),ce=r.N.add(ae,W,ae),be=oe+(k.pitch===0?0:r.N.distance(W,ce)),ue=k.globeCenterInViewSpace,Ie=r.N.sub([],W,[ue[0],ue[1],ue[2]]);r.N.normalize(Ie,Ie),r.N.scale(Ie,Ie,be);let Te=r.N.add([],W,Ie);r.N.transformMat4(Te,Te,$);let Be=r.d4/r.ab,pe=r.N.length(Te),xe=r.bl(Math.max(pe*Be-r.d4,Number.EPSILON),0),le=Math.min(k.zoomFromMercatorZAdjusted(xe),S.maxZoom);return le>.5*(r.bG+r.bx)?(k.setProjection({name:"mercator"}),k.zoom=le,this._cameraForBounds(k,a,d,p,g,v)):{center:k.center,zoom:le,bearing:p,pitch:g}}queryTerrainElevation(n,a){let d=this.transform.elevation;return d?(a=r.e({},{exaggerated:!0},a),d.getAtPoint(r.L.fromLngLat(n),null,a.exaggerated)):null}_cameraForBounds(n,a,d,p,g,v){if(n.projection.name==="globe")return this._cameraForBoundsOnGlobe(n,a,d,p,g,v);let k=n.clone(),S=this._extendCameraOptions(v),E=k.padding;k.bearing=p,k.pitch=g;let A=r.bn.convert(a),P=r.bn.convert(d),z=new r.bn(A.lng,P.lat),O=new r.bn(P.lng,A.lat),U=k.project(A),V=k.project(P),G=this.queryTerrainElevation(A),N=this.queryTerrainElevation(P),H=this.queryTerrainElevation(z),Q=this.queryTerrainElevation(O),W=[[U.x,U.y,Math.min(G||0,N||0,H||0,Q||0)],[V.x,V.y,Math.max(G||0,N||0,H||0,Q||0)]],J=r.bS.fromPoints(W),$=k.getWorldToCameraMatrix(),ee=r.a6.invert(new Float64Array(16),$);J=r.bS.applyTransform(J,$);let oe=r.N.sub([],J.max,J.min),ae=E.left||0,ce=E.right||0,be=E.bottom||0,ue=E.top||0,{left:Ie,right:Te,top:Be,bottom:pe}=S.padding,xe=.5*(ae+ce),le=.5*(ue+be),ge=Math.min(k.scaleZoom(k.scale*Math.min((k.width-(ae+ce+Ie+Te))/oe[0],(k.height-(be+ue+pe+Be))/oe[1])),S.maxZoom),Ne=k.scale/k.zoomScale(ge);J=new r.bS([J.min[0]-(Ie+xe)*Ne,J.min[1]-(pe+le)*Ne,J.min[2]],[J.max[0]+(Te+xe)*Ne,J.max[1]+(Be+le)*Ne,J.max[2]]);let Ye=.5*oe[2],We=this._minimumAABBFrustumDistance(k,J),rt=[0,0,1,0];r.a7.transformMat4(rt,rt,$),r.a7.normalize(rt,rt);let _t=r.N.scale([],rt,We+Ye),Et=r.N.add([],J.center,_t),vt=(typeof S.offset.x=="number"&&typeof S.offset.y=="number"?new r.P(S.offset.x,S.offset.y):r.P.convert(S.offset)).rotate(-r.bj(p));J.center[0]-=vt.x*Ne,J.center[1]+=vt.y*Ne,r.N.transformMat4(J.center,J.center,ee),r.N.transformMat4(Et,Et,ee);let Tt=[J.center[0],J.center[1],Et[2]*k.pixelsPerMeter];r.N.scale(Tt,Tt,1/k.worldSize);let Xt=r.at(Tt[0]),Nt=r.au(Tt[1]),qt=Math.min(k._zoomFromMercatorZ(Tt[2]),S.maxZoom),Gt=new r.bn(Xt,Nt);return k.mercatorFromTransition&&qt<.5*(r.bG+r.bx)?(k.setProjection({name:"globe"}),k.zoom=qt,this._cameraForBounds(k,a,d,p,g,v)):{center:Gt,zoom:qt,bearing:p,pitch:g}}fitBounds(n,a,d){let p=this.cameraForBounds(n,a);return this._fitInternal(p,a,d)}fitScreenCoordinates(n,a,d,p,g){let v=r.P.convert(n),k=r.P.convert(a),S=new r.P(Math.min(v.x,k.x),Math.min(v.y,k.y)),E=new r.P(Math.max(v.x,k.x),Math.max(v.y,k.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(v,k))return this;let A=this.transform.pointLocation3D(S),P=this.transform.pointLocation3D(E),z=this.transform.pointLocation3D(new r.P(S.x,E.y)),O=this.transform.pointLocation3D(new r.P(E.x,S.y)),U=[Math.min(A.lng,P.lng,z.lng,O.lng),Math.min(A.lat,P.lat,z.lat,O.lat)],V=[Math.max(A.lng,P.lng,z.lng,O.lng),Math.max(A.lat,P.lat,z.lat,O.lat)],G=p&&p.pitch?p.pitch:this.getPitch(),N=this._cameraForBounds(this.transform,U,V,d,G,p);return this._fitInternal(N,p,g)}_fitInternal(n,a,d){return n?(delete(a=r.e(n,a)).padding,a.linear?this.easeTo(a,d):this.flyTo(a,d)):this}jumpTo(n,a){this.stop();let d=n.preloadOnly?this.transform.clone():this.transform,p=!1,g=!1,v=!1;return"zoom"in n&&d.zoom!==+n.zoom&&(p=!0,d.zoom=+n.zoom),n.center!==void 0&&(d.center=r.bn.convert(n.center)),"bearing"in n&&d.bearing!==+n.bearing&&(g=!0,d.bearing=+n.bearing),"pitch"in n&&d.pitch!==+n.pitch&&(v=!0,d.pitch=+n.pitch),n.padding==null||d.isPaddingEqual(n.padding)||(d.padding=n.padding),n.preloadOnly?(this._preloadTiles(d),this):(this.fire(new r.b("movestart",a)).fire(new r.b("move",a)),p&&this.fire(new r.b("zoomstart",a)).fire(new r.b("zoom",a)).fire(new r.b("zoomend",a)),g&&this.fire(new r.b("rotatestart",a)).fire(new r.b("rotate",a)).fire(new r.b("rotateend",a)),v&&this.fire(new r.b("pitchstart",a)).fire(new r.b("pitch",a)).fire(new r.b("pitchend",a)),this.fire(new r.b("moveend",a)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||r.w(Kf),this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,a){let d=this.transform;if(!d.projection.supportsFreeCamera)return r.w(Kf),this;this.stop();let p=d.zoom,g=d.pitch,v=d.bearing;d.setFreeCameraOptions(n);let k=p!==d.zoom,S=g!==d.pitch,E=v!==d.bearing;return this.fire(new r.b("movestart",a)).fire(new r.b("move",a)),k&&this.fire(new r.b("zoomstart",a)).fire(new r.b("zoom",a)).fire(new r.b("zoomend",a)),E&&this.fire(new r.b("rotatestart",a)).fire(new r.b("rotate",a)).fire(new r.b("rotateend",a)),S&&this.fire(new r.b("pitchstart",a)).fire(new r.b("pitch",a)).fire(new r.b("pitchend",a)),this.fire(new r.b("moveend",a)),this}easeTo(n,a){this._stop(!1,n.easeId),((n=r.e({offset:[0,0],duration:500,easing:r.d0},n)).animate===!1||this._prefersReducedMotion(n))&&(n.duration=0);let d=this.transform,p=this.getZoom(),g=this.getBearing(),v=this.getPitch(),k=this.getPadding(),S="zoom"in n?+n.zoom:p,E="bearing"in n?this._normalizeBearing(n.bearing,g):g,A="pitch"in n?+n.pitch:v,P="padding"in n?n.padding:d.padding,z=r.P.convert(n.offset),O,U,V;if(d.projection.name==="globe"){let ae=r.L.fromLngLat(d.center),ce=z.rotate(-d.angle);ae.x+=ce.x/d.worldSize,ae.y+=ce.y/d.worldSize;let be=ae.toLngLat(),ue=r.bn.convert(n.center||be);this._normalizeCenter(ue),O=d.centerPoint.add(ce),U=new r.P(ae.x,ae.y).mult(d.worldSize),V=new r.P(r.a5(ue.lng),r.ae(ue.lat)).mult(d.worldSize).sub(U)}else{O=d.centerPoint.add(z);let ae=d.pointLocation(O),ce=r.bn.convert(n.center||ae);this._normalizeCenter(ce),U=d.project(ae),V=d.project(ce).sub(U)}let G=d.zoomScale(S-p),N,H;n.around&&(N=r.bn.convert(n.around),H=d.locationPoint(N));let Q=this._zooming||S!==p,W=this._rotating||g!==E,J=this._pitching||A!==v,$=!d.isPaddingEqual(P),ee=ae=>ce=>{if(Q&&(ae.zoom=r.U(p,S,ce)),W&&(ae.bearing=r.U(g,E,ce)),J&&(ae.pitch=r.U(v,A,ce)),$&&(ae.interpolatePadding(k,P,ce),O=ae.centerPoint.add(z)),N)ae.setLocationAtPoint(N,H);else{let be=ae.zoomScale(ae.zoom-p),ue=S>p?Math.min(2,G):Math.max(.5,G),Ie=Math.pow(ue,1-ce),Te=ae.unproject(U.add(V.mult(ce*Ie)).mult(be));ae.setLocationAtPoint(ae.renderWorldCopies?Te.wrap():Te,O)}return n.preloadOnly||this._fireMoveEvents(a),ae};if(n.preloadOnly){let ae=this._emulate(ee,n.duration,d);return this._preloadTiles(ae),this}let oe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Q,this._rotating=W,this._pitching=J,this._easeId=n.easeId,this._prepareEase(a,n.noMoveStart,oe),this._ease(ee(d),ae=>{d.cameraElevationReference==="sea"&&d.recenterOnTerrain(),this._afterEase(a,ae)},n),this}_prepareEase(n,a,d={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),a||d.moving||this.fire(new r.b("movestart",n)),this._zooming&&!d.zooming&&this.fire(new r.b("zoomstart",n)),this._rotating&&!d.rotating&&this.fire(new r.b("rotatestart",n)),this._pitching&&!d.pitching&&this.fire(new r.b("pitchstart",n))}_fireMoveEvents(n){this.fire(new r.b("move",n)),this._zooming&&this.fire(new r.b("zoom",n)),this._rotating&&this.fire(new r.b("rotate",n)),this._pitching&&this.fire(new r.b("pitch",n))}_afterEase(n,a){if(this._easeId&&a&&this._easeId===a)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";let d=this._zooming,p=this._rotating,g=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,d&&this.fire(new r.b("zoomend",n)),p&&this.fire(new r.b("rotateend",n)),g&&this.fire(new r.b("pitchend",n)),this.fire(new r.b("moveend",n))}flyTo(n,a){if(this._prefersReducedMotion(n)){let pe=r.ac(n,["center","zoom","bearing","pitch","around"]);return this.jumpTo(pe,a)}this.stop(),n=r.e({offset:[0,0],speed:1.2,curve:1.42,easing:r.d0},n);let d=this.transform,p=this.getZoom(),g=this.getBearing(),v=this.getPitch(),k="zoom"in n?r.aa(+n.zoom,d.minZoom,d.maxZoom):p,S="bearing"in n?this._normalizeBearing(n.bearing,g):g,E="pitch"in n?+n.pitch:v,A=d.zoomScale(k-p),P=r.P.convert(n.offset),z=d.centerPoint.add(P),O=d.pointLocation(z),U=n.center;if(U&&n.padding){let pe=this._cameraForBounds(this.transform,U,U,S,E,n);pe&&(U=pe.center)}U=r.bn.convert(U||O),this._normalizeCenter(U);let V=d.project(O),G=d.project(U).sub(V),N=n.curve,H=Math.max(d.width,d.height),Q=H/A,W=G.mag();if("minZoom"in n){let pe=r.aa(Math.min(n.minZoom,p,k),d.minZoom,d.maxZoom),xe=H/d.zoomScale(pe-p);N=Math.sqrt(xe/W*2)}let J=N*N;function $(pe){let xe=(Q*Q-H*H+(pe?-1:1)*J*J*W*W)/(2*(pe?Q:H)*J*W);return Math.log(Math.sqrt(xe*xe+1)-xe)}function ee(pe){return(Math.exp(pe)-Math.exp(-pe))/2}function oe(pe){return(Math.exp(pe)+Math.exp(-pe))/2}let ae=$(0),ce=function(pe){return oe(ae)/oe(ae+N*pe)},be=function(pe){return H*((oe(ae)*(ee(xe=ae+N*pe)/oe(xe))-ee(ae))/J)/W;var xe},ue=($(1)-ae)/N;if(Math.abs(W)<1e-6||!isFinite(ue)){if(Math.abs(H-Q)<1e-6)return this.easeTo(n,a);let pe=Q<H?-1:1;ue=Math.abs(Math.log(Q/H))/N,be=function(){return 0},ce=function(xe){return Math.exp(pe*N*xe)}}n.duration="duration"in n?+n.duration:1e3*ue/("screenSpeed"in n?+n.screenSpeed/N:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);let Ie=g!==S,Te=E!==v,Be=pe=>xe=>{let le=xe*ue,ge=1/ce(le);pe.zoom=xe===1?k:p+pe.scaleZoom(ge),Ie&&(pe.bearing=r.U(g,S,xe)),Te&&(pe.pitch=r.U(v,E,xe));let Ne=xe===1?U:pe.unproject(V.add(G.mult(be(le))).mult(ge));return pe.setLocationAtPoint(pe.renderWorldCopies?Ne.wrap():Ne,z),pe._updateCameraOnTerrain(),n.preloadOnly||this._fireMoveEvents(a),pe};if(n.preloadOnly){let pe=this._emulate(Be,n.duration,d);return this._preloadTiles(pe),this}return this._zooming=!0,this._rotating=Ie,this._pitching=Te,this._prepareEase(a,!1),this._ease(Be(d),()=>this._afterEase(a),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(n,a){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){let d=this._onEaseEnd;this._onEaseEnd=void 0,d.call(this,a)}if(!n){let d=this.handlers;d&&d.stop(!1)}return this}_ease(n,a,d){d.animate===!1||d.duration===0?(n(1),a()):(this._easeStart=r.f.now(),this._easeOptions=d,this._onEaseFrame=n,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){let n=Math.min((r.f.now()-this._easeStart)/this._easeOptions.duration,1),a=this._onEaseFrame;a&&a(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,a){n=r.bh(n,-180,180);let d=Math.abs(n-a);return Math.abs(n-360-a)<d&&(n-=360),Math.abs(n+360-a)<d&&(n+=360),n}_normalizeCenter(n){let a=this.transform;if(a.maxBounds||a.projection.name!=="globe"&&!a.renderWorldCopies)return;let d=n.lng-a.center.lng;n.lng+=d>180?-360:d<-180?360:0}_prefersReducedMotion(n){return this._respectPrefersReducedMotion&&r.f.prefersReducedMotion&&!(n&&n.essential)}_emulate(n,a,d){let p=Math.ceil(15*a/1e3),g=[],v=n(d.clone());for(let k=0;k<=p;k++){let S=v(k/p);g.push(S.clone())}return g}}class Am{constructor(n={}){this.options=n,r.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){let a=this.options&&this.options.compact;return this._map=n,this._container=me("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=me("button","mapboxgl-ctrl-attrib-button",this._container),me("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=me("div","mapboxgl-ctrl-attrib-inner",this._container),a&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),a===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(n,a){let d=this._map._getUIString(`AttributionControl.${a}`);n.removeAttribute("title"),n.firstElementChild&&n.firstElementChild.setAttribute("title",d)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));let a=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||r.d5.ACCESS_TOKEN}];if(n){let d=a.reduce((p,g,v)=>(g.value&&(p+=`${g.key}=${g.value}${v<a.length-1?"&":""}`),p),"?");n.href=`${r.d5.FEEDBACK_URL}/${d}#${bm(this._map,!0)}`,n.rel="noopener nofollow",this._setElementTitle(n,"MapFeedback")}}_updateData(n){!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this._map.style.stylesheet){let p=this._map.style.stylesheet;this.styleOwner=p.owner,this.styleId=p.id}let a=this._map.style._mergedSourceCaches;for(let p in a){let g=a[p];if(g.used){let v=g.getSource();v.attribution&&n.indexOf(v.attribution)<0&&n.push(v.attribution)}}n.sort((p,g)=>p.length-g.length),n=n.filter((p,g)=>{for(let v=g+1;v<n.length;v++)if(n[v].indexOf(p)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));let d=n.join(" | ");d!==this._attribHTML&&(this._attribHTML=d,n.length?(this._innerContainer.innerHTML=d,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Qf{constructor(){r.aY(["_updateLogo","_updateCompact"],this)}onAdd(n){this._map=n,this._container=me("div","mapboxgl-ctrl");let a=me("a","mapboxgl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://www.mapbox.com/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&n.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;let n=this._map.style._sourceCaches;if(Object.entries(n).length===0)return!0;for(let a in n){let d=n[a].getSource();if(d.hasOwnProperty("mapbox_logo")&&!d.mapbox_logo)return!1}return!0}_updateCompact(){let n=this._container.children;if(n.length){let a=n[0];this._map.getCanvasContainer().offsetWidth<250?a.classList.add("mapboxgl-compact"):a.classList.remove("mapboxgl-compact")}}}class Jf{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){let a=++this._id;return this._queue.push({callback:n,id:a,cancelled:!1}),a}remove(n){let a=this._currentlyRunning,d=a?this._queue.concat(a):this._queue;for(let p of d)if(p.id===n)return void(p.cancelled=!0)}run(n=0){let a=this._currentlyRunning=this._queue;this._queue=[];for(let d of a)if(!d.cancelled&&(d.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function nd(c,n,a){if(c=new r.bn(c.lng,c.lat),n){let d=new r.bn(c.lng-360,c.lat),p=new r.bn(c.lng+360,c.lat),g=360*Math.ceil(Math.abs(c.lng-a.center.lng)/360),v=a.locationPoint(c).distSqr(n),k=n.x<0||n.y<0||n.x>a.width||n.y>a.height;a.locationPoint(d).distSqr(n)<v&&(k||Math.abs(d.lng-a.center.lng)<g)?c=d:a.locationPoint(p).distSqr(n)<v&&(k||Math.abs(p.lng-a.center.lng)<g)&&(c=p)}for(;Math.abs(c.lng-a.center.lng)>180;){let d=a.locationPoint(c);if(d.x>=0&&d.y>=0&&d.x<=a.width&&d.y<=a.height)break;c.lng>a.center.lng?c.lng-=360:c.lng+=360}return c}let ah={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Dm extends r.E{constructor(n,a){if(super(),(n instanceof HTMLElement||a)&&(n=r.e({element:n},a)),r.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&n.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=n&&n.occludedOpacity||.2,n&&n.element)this._element=n.element,this._offset=r.P.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=me("div");let g=41,v=27,k=De("svg",{display:"block",height:g*this._scale+"px",width:v*this._scale+"px",viewBox:`0 0 ${v} ${g}`},this._element),S=De("radialGradient",{id:"shadowGradient"},De("defs",{},k));De("stop",{offset:"10%","stop-opacity":.4},S),De("stop",{offset:"100%","stop-opacity":.05},S),De("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},k),De("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},k),De("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},k),De("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},k),this._offset=r.P.convert(n&&n.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",g=>{g.preventDefault()}),this._element.addEventListener("mousedown",g=>{g.preventDefault()});let d=this._element.classList;for(let g in ah)d.remove(`mapboxgl-marker-anchor-${g}`);d.add(`mapboxgl-marker-anchor-${this._anchor}`);let p=n&&n.className?n.className.trim().split(/\s+/):[];d.add(...p),this._popup=null}addTo(n){return n===this._map||(this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._updateMoving),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),n.on("click",this._onMapClick)),this}remove(){let n=this._map;return n&&(n.off("click",this._onMapClick),n.off("move",this._updateMoving),n.off("moveend",this._update),n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler),n.off("mouseup",this._onUp),n.off("touchend",this._onUp),n.off("mousemove",this._onMove),n.off("touchmove",this._onMove),n.off("remove",this._clearFadeTimer),n._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=r.bn.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){let p=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[p,-1*(38.1-13.5+p)],"bottom-right":[-p,-1*(38.1-13.5+p)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=n,n._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(n){let a=n.code,d=n.charCode||n.keyCode;a!=="Space"&&a!=="Enter"&&d!==32&&d!==13||this.togglePopup()}_onMapClick(n){let a=n.originalEvent.target,d=this._element;this._popup&&(a===d||d.contains(a))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){let n=this._popup;return n?(n.isOpen()?(n.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(n.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){let n=this._map,a=this._pos;if(!n||!a)return!1;let d=n.unproject(a),p=n.getFreeCameraOptions();if(!p.position)return!1;let g=p.position.toLngLat();return g.distanceTo(d)<.9*g.distanceTo(this._lngLat)}_evaluateOpacity(){let n=this._map;if(!n)return;let a=this._pos;if(!a||a.x<0||a.x>n.transform.width||a.y<0||a.y>n.transform.height)return void this._clearFadeTimer();let d=n.unproject(a),p;n._showingGlobe()&&r.d6(n.transform,this._lngLat)?p=0:(p=1-n._queryFogOpacity(d),n.transform._terrainEnabled()&&n.getTerrain()&&this._behindTerrain()&&(p*=this._occludedOpacity)),this._element.style.opacity=`${p}`,this._element.style.pointerEvents=p>0?"auto":"none",this._popup&&this._popup._setOpacity(p),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){let n=this._pos;if(!n||!this._map)return;let a=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${n.x}px,${n.y}px)
            ${ah[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${a.x}px,${a.y}px)
        `}_calculateXYTransform(){let n=this._pos,a=this._map,d=this.getPitchAlignment();if(!a||!n||d!=="map")return"";if(!a._showingGlobe()){let S=a.getPitch();return S?`rotateX(${S}deg)`:""}let p=r.bF(r.d7(a.transform,this._lngLat)),g=n.sub(r.d8(a.transform)),v=Math.abs(g.x)+Math.abs(g.y);if(v===0)return"";let k=p/v;return`rotateX(${-g.y*k}deg) rotateY(${g.x*k}deg)`}_calculateZTransform(){let n=this._pos,a=this._map;if(!a||!n)return"";let d=0,p=this.getRotationAlignment();if(p==="map")if(a._showingGlobe()){let g=a.project(new r.bn(this._lngLat.lng,this._lngLat.lat+.001)),v=a.project(new r.bn(this._lngLat.lng,this._lngLat.lat-.001)).sub(g);d=r.bF(Math.atan2(v.y,v.x))-90}else d=-a.getBearing();else if(p==="horizon"){let g=r.O(4,6,a.getZoom()),v=r.d8(a.transform);v.y+=g*a.transform.height;let k=n.sub(v),S=r.bF(Math.atan2(k.y,k.x));d=(S>90?S-270:S+90)*(1-g)}return d+=this._rotation,d?`rotateZ(${d}deg)`:""}_update(n){cancelAnimationFrame(this._updateFrameId);let a=this._map;a&&(a.transform.renderWorldCopies&&(this._lngLat=nd(this._lngLat,this._pos,a.transform)),this._pos=a.project(this._lngLat),n===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),a._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(a._showingGlobe()||a.getTerrain()||a.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(n){return this._offset=r.P.convert(n),this._update(),this}addClassName(n){return this._element.classList.add(n),this}removeClassName(n){return this._element.classList.remove(n),this}toggleClassName(n){return this._element.classList.toggle(n)}_onMove(n){let a=this._map;if(!a)return;let d=this._pointerdownPos,p=this._positionDelta;if(d&&p){if(!this._isDragging){let g=this._clickTolerance||a._clickTolerance;if(n.point.dist(d)<g)return;this._isDragging=!0}this._pos=n.point.sub(p),this._lngLat=a.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new r.b("dragstart"))),this.fire(new r.b("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;let n=this._map;n&&(n.off("mousemove",this._onMove),n.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new r.b("dragend")),this._state="inactive"}_addDragHandler(n){let a=this._map,d=this._pos;a&&d&&this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(d),this._pointerdownPos=n.point,this._state="pending",a.on("mousemove",this._onMove),a.on("touchmove",this._onMove),a.once("mouseup",this._onUp),a.once("touchend",this._onUp))}setDraggable(n){this._draggable=!!n;let a=this._map;return a&&(n?(a.on("mousedown",this._addDragHandler),a.on("touchstart",this._addDragHandler)):(a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(n){return this._occludedOpacity=n||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}let e_={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},t_=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function i_(c=new r.P(0,0),n="bottom"){if(typeof c=="number"){let a=Math.round(Math.sqrt(.5*Math.pow(c,2)));switch(n){case"top":return new r.P(0,c);case"top-left":return new r.P(a,a);case"top-right":return new r.P(-a,a);case"bottom":return new r.P(0,-c);case"bottom-left":return new r.P(a,-a);case"bottom-right":return new r.P(-a,-a);case"left":return new r.P(c,0);case"right":return new r.P(-c,0)}return new r.P(0,0)}return c instanceof r.P||Array.isArray(c)?r.P.convert(c):r.P.convert(c[n]||[0,0])}class Pm{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;let a=r.cc((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-a)+this._end*a}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,a,d){this._start=this.getValue(a),this._end=n,this._startTime=a,this._endTime=a+d}}let rd={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},n_={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1};class Rm{constructor(){this.showOverdrawInspector=!1,this.showTileBoundaries=!1,this.showParseStatus=!1,this.continuousRedraw=!1,this.showTileAABBs=!1,this.showPadding=!1,this.showTerrainWireframe=!1,this.showLayers2DWireframe=!1,this.showLayers3DWireframe=!1}}let sh={showCompass:!0,showZoom:!0,visualizePitch:!1};class za{constructor(n,a,d=!1){this._clickTolerance=10,this.element=a,this.mouseRotate=new Yc({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,d&&(this.mousePitch=new rh({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),r.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),a.addEventListener("mousedown",this.mousedown),a.addEventListener("touchstart",this.touchstart,{passive:!1}),a.addEventListener("touchmove",this.touchmove),a.addEventListener("touchend",this.touchend),a.addEventListener("touchcancel",this.reset)}down(n,a){this.mouseRotate.mousedown(n,a),this.mousePitch&&this.mousePitch.mousedown(n,a),Hi()}move(n,a){let d=this.map,p=this.mouseRotate.mousemoveWindow(n,a),g=p&&p.bearingDelta;if(g&&d.setBearing(d.getBearing()+g),this.mousePitch){let v=this.mousePitch.mousemoveWindow(n,a),k=v&&v.pitchDelta;k&&d.setPitch(d.getPitch()+k)}}off(){let n=this.element;n.removeEventListener("mousedown",this.mousedown),n.removeEventListener("touchstart",this.touchstart,{passive:!1}),n.removeEventListener("touchmove",this.touchmove),n.removeEventListener("touchend",this.touchend),n.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){mi(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(n){this.down(r.e({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),qr(this.element,n)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(n){this.move(n,qr(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){n.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=eo(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){n.targetTouches.length!==1?this.reset():(this._lastPos=eo(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){n.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}let lh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Nr={maxWidth:100,unit:"metric"},_s={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"};return{version:r.dk,supported:F,setRTLTextPlugin:r.dm,getRTLTextPluginStatus:r.dn,Map:class extends Rn{constructor(c){let n=c;if((c=r.e({},n_,c)).minZoom!=null&&c.maxZoom!=null&&c.minZoom>c.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(c.minPitch!=null&&c.maxPitch!=null&&c.minPitch>c.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(c.minPitch!=null&&c.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(c.maxPitch!=null&&c.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(c.antialias&&r.d9(window)&&(c.antialias=!1,r.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Dc(c.minZoom,c.maxZoom,c.minPitch,c.maxPitch,c.renderWorldCopies),c),this._repaint=!1,this._interactive=c.interactive,this._minTileCacheSize=c.minTileCacheSize,this._maxTileCacheSize=c.maxTileCacheSize,this._failIfMajorPerformanceCaveat=c.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=c.preserveDrawingBuffer,this._antialias=c.antialias,this._trackResize=c.trackResize,this._bearingSnap=c.bearingSnap,this._refreshExpiredTiles=c.refreshExpiredTiles,this._fadeDuration=c.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=c.crossSourceCollisions,this._collectResourceTiming=c.collectResourceTiming,this._language=this._parseLanguage(c.language),this._worldview=c.worldview,this._renderTaskQueue=new Jf,this._domRenderTaskQueue=new Jf,this._controls=[],this._markers=[],this._popups=[],this._mapId=r.aC(),this._locale=r.e({},rd,c.locale),this._clickTolerance=c.clickTolerance,this._cooperativeGestures=c.cooperativeGestures,this._performanceMetricsCollection=c.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Pm(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new r.da(c.transformRequest,c.accessToken,c.testMode),this._silenceAuthErrors=!!c.testMode,this._contextCreateOptions=c.contextCreateOptions?It({},c.contextCreateOptions):{},typeof c.container=="string"){let a=document.getElementById(c.container);if(!a)throw new Error(`Container '${c.container.toString()}' not found.`);this._container=a}else{if(!(c.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=c.container}if(this._container.childNodes.length>0&&r.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),c.maxBounds&&this.setMaxBounds(c.maxBounds),r.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._debugParams=new Rm,this._tp=c.devtools?new $c(this):new $c,this._tp.registerParameter(this._debugParams,["Debug"],"showOverdrawInspector",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"showTileBoundaries",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"showParseStatus",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"continuousRedraw",void 0,a=>{this.repaint=a}),this._tp.registerParameter(this._debugParams,["Debug"],"showTileAABBs",void 0,a=>{this.showTileAABBs=a}),this._tp.registerParameter(this._debugParams,["Debug"],"showPadding",void 0,a=>{this.showPadding=a}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showTerrainWireframe",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showLayers2DWireframe",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showLayers3DWireframe",void 0,()=>{this._update()}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new F0(this,c),this._localFontFamily=c.localFontFamily,this._localIdeographFontFamily=c.localIdeographFontFamily,(c.style||!c.testMode)&&this.setStyle(c.style||r.d5.DEFAULT_STYLE,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),c.projection&&this.setProjection(c.projection),c.hash&&(this._hash=new th(typeof c.hash=="string"&&c.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){n.center==null&&n.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch});let a=c.bounds;a&&(this.resize(),this.fitBounds(a,r.e({},c.fitBoundsOptions,{duration:0})))}this.resize(),c.attributionControl&&this.addControl(new Am({customAttribution:c.customAttribution})),this._logoControl=new Qf,this.addControl(this._logoControl,c.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",a=>{this._update(a.dataType==="style"),this.fire(new r.b(`${a.dataType}data`,a))}),this.on("dataloading",a=>{this.fire(new r.b(`${a.dataType}dataloading`,a))})}_getMapId(){return this._mapId}addControl(c,n){if(n===void 0&&(n=c.getDefaultPosition?c.getDefaultPosition():"top-right"),!c||!c.onAdd)return this.fire(new r.a(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let a=c.onAdd(this);this._controls.push(c);let d=this._controlPositions[n];return n.indexOf("bottom")!==-1?d.insertBefore(a,d.firstChild):d.appendChild(a),this}removeControl(c){if(!c||!c.onRemove)return this.fire(new r.a(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let n=this._controls.indexOf(c);return n>-1&&this._controls.splice(n,1),c.onRemove(this),this}hasControl(c){return this._controls.indexOf(c)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(c){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));let n=!this._moving;return n&&this.fire(new r.b("movestart",c)).fire(new r.b("move",c)),this.fire(new r.b("resize",c)),n&&this.fire(new r.b("moveend",c)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(c){return this.transform.setMaxBounds(r.ad.convert(c)),this._update()}setMinZoom(c){if((c=c??-2)>=-2&&c<=this.transform.maxZoom)return this.transform.minZoom=c,this._update(),this.getZoom()<c?this.setZoom(c):this.fire(new r.b("zoomstart")).fire(new r.b("zoom")).fire(new r.b("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(c){if((c=c??22)>=this.transform.minZoom)return this.transform.maxZoom=c,this._update(),this.getZoom()>c?this.setZoom(c):this.fire(new r.b("zoomstart")).fire(new r.b("zoom")).fire(new r.b("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(c){if((c=c??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(c>=0&&c<=this.transform.maxPitch)return this.transform.minPitch=c,this._update(),this.getPitch()<c?this.setPitch(c):this.fire(new r.b("pitchstart")).fire(new r.b("pitch")).fire(new r.b("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(c){if((c=c??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(c>=this.transform.minPitch)return this.transform.maxPitch=c,this._update(),this.getPitch()>c?this.setPitch(c):this.fire(new r.b("pitchstart")).fire(new r.b("pitch")).fire(new r.b("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(c){return this.transform.renderWorldCopies=c,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(c){return c==="auto"?navigator.language:Array.isArray(c)?c.length===0?void 0:c.map(n=>n==="auto"?navigator.language:n):c}setLanguage(c){let n=this._parseLanguage(c);if(!this.style||n===this._language)return this;this._language=n,this.style.reloadSources();for(let a of this._controls)a._setLanguage&&a._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(c){return this.style&&c!==this._worldview?(this._worldview=c,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(c){return this._lazyInitEmptyStyle(),c?typeof c=="string"&&(c={name:c}):c=null,this._useExplicitProjection=!!c,this._prioritizeAndUpdateProjection(c,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;let c=this.transform,n=c.projection.name,a;n==="globe"&&c.zoom>=r.bx?(c.setMercatorFromTransition(),a=!0):n==="mercator"&&c.zoom<r.bx&&(c.setProjection({name:"globe"}),a=!0),a&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(c,n){return this._updateProjection(c||n||{name:"mercator"})}_updateProjection(c){let n;return n=c.name==="globe"&&this.transform.zoom>=r.bx?this.transform.setMercatorFromTransition():this.transform.setProjection(c),this.style.applyProjectionUpdate(),n&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(c){return this.transform.locationPoint3D(r.bn.convert(c))}unproject(c){return this.transform.pointLocation3D(r.P.convert(c))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(c,n,a){if(c==="mouseenter"||c==="mouseover"){let d=!1,p=v=>{let k=n.filter(E=>this.getLayer(E)),S=k.length?this.queryRenderedFeatures(v.point,{layers:k}):[];S.length?d||(d=!0,a.call(this,new Xr(c,this,v.originalEvent,{features:S}))):d=!1},g=()=>{d=!1};return{layers:new Set(n),listener:a,delegates:{mousemove:p,mouseout:g}}}if(c==="mouseleave"||c==="mouseout"){let d=!1,p=v=>{let k=n.filter(S=>this.getLayer(S));(k.length?this.queryRenderedFeatures(v.point,{layers:k}):[]).length?d=!0:d&&(d=!1,a.call(this,new Xr(c,this,v.originalEvent)))},g=v=>{d&&(d=!1,a.call(this,new Xr(c,this,v.originalEvent)))};return{layers:new Set(n),listener:a,delegates:{mousemove:p,mouseout:g}}}{let d=p=>{let g=n.filter(k=>this.getLayer(k)),v=g.length?this.queryRenderedFeatures(p.point,{layers:g}):[];v.length&&(p.features=v,a.call(this,p),delete p.features)};return{layers:new Set(n),listener:a,delegates:{[c]:d}}}}on(c,n,a){if(a===void 0)return super.on(c,n);if(Array.isArray(n)||(n=[n]),n){for(let p of n)if(!this._isValidId(p))return this}let d=this._createDelegatedListener(c,n,a);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[c]=this._delegatedListeners[c]||[],this._delegatedListeners[c].push(d);for(let p in d.delegates)this.on(p,d.delegates[p]);return this}once(c,n,a){if(a===void 0)return super.once(c,n);if(Array.isArray(n)||(n=[n]),n){for(let p of n)if(!this._isValidId(p))return this}let d=this._createDelegatedListener(c,n,a);for(let p in d.delegates)this.once(p,d.delegates[p]);return this}off(c,n,a){if(a===void 0)return super.off(c,n);n=new Set(Array.isArray(n)?n:[n]);for(let g of n)if(!this._isValidId(g))return this;let d=(g,v)=>{if(g.size!==v.size)return!1;for(let k of g)if(!v.has(k))return!1;return!0},p=this._delegatedListeners?this._delegatedListeners[c]:void 0;return p&&(g=>{for(let v=0;v<g.length;v++){let k=g[v];if(k.listener===a&&d(k.layers,n)){for(let S in k.delegates)this.off(S,k.delegates[S]);return g.splice(v,1),this}}})(p),this}queryRenderedFeatures(c,n){if(!this.style)return[];if(n!==void 0||c===void 0||c instanceof r.P||Array.isArray(c)||(n=c,c=void 0),c=c||[[0,0],[this.transform.width,this.transform.height]],(n=n||{}).layers&&Array.isArray(n.layers)){for(let a of n.layers)if(!this._isValidId(a))return[]}return this.style.queryRenderedFeatures(c,n,this.transform)}querySourceFeatures(c,n){return this._isValidId(c)?this.style.querySourceFeatures(c,n):[]}isPointOnSurface(c){let{name:n}=this.transform.projection;return n!=="globe"&&n!=="mercator"&&r.w(`${n} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(r.P.convert(c))}setStyle(c,n){return(n=r.e({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n)).diff!==!1&&n.localIdeographFontFamily===this._localIdeographFontFamily&&n.localFontFamily===this._localFontFamily&&this.style&&c?(this._diffStyle(c,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(c,n))}_getUIString(c){let n=this._locale[c];if(n==null)throw new Error(`Missing UI string '${c}'`);return n}_updateStyle(c,n){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),c&&(this.style=new Ko(this,n||{}),this.style.setEventedParent(this,{style:this.style}),typeof c=="string"?this.style.loadURL(c):this.style.loadJSON(c)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ko(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(c,n){if(typeof c=="string"){let a=this._requestManager.normalizeStyleURL(c),d=this._requestManager.transformRequest(a,r.R.Style);r.g(d,(p,g)=>{p?this.fire(new r.a(p)):g&&this._updateDiff(g,n)})}else typeof c=="object"&&this._updateDiff(c,n)}_updateDiff(c,n){try{this.style.setState(c)&&this._update(!0)}catch(a){r.w(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(c,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(r.w("There is no style added to the map."),!1)}_isValidId(c){return c==null?(this.fire(new r.a(new Error("IDs can't be empty."))),!1):!r.c4(c)||(this.fire(new r.a(new Error(`IDs can't contain special symbols: "${c}".`))),!1)}addSource(c,n){return this._isValidId(c)?(this._lazyInitEmptyStyle(),this.style.addSource(c,n),this._update(!0)):this}isSourceLoaded(c){return!!this._isValidId(c)&&!!this.style&&this.style._isSourceCacheLoaded(c)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(c,n,a){this._lazyInitEmptyStyle(),this.style.addSourceType(c,n,a)}removeSource(c){return this._isValidId(c)?(this.style.removeSource(c),this._updateTerrain(),this._update(!0)):this}getSource(c){return this._isValidId(c)?this.style.getOwnSource(c):null}addImage(c,n,{pixelRatio:a=1,sdf:d=!1,stretchX:p,stretchY:g,content:v}={}){if(this._lazyInitEmptyStyle(),n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap){let{width:k,height:S,data:E}=r.f.getImageData(n);this.style.addImage(c,{data:new r.h({width:k,height:S},E),pixelRatio:a,stretchX:p,stretchY:g,content:v,sdf:d,version:0})}else if(n.width===void 0||n.height===void 0)this.fire(new r.a(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{let{width:k,height:S}=n,E=n;this.style.addImage(c,{data:new r.h({width:k,height:S},new Uint8Array(E.data)),pixelRatio:a,stretchX:p,stretchY:g,content:v,sdf:d,version:0,userImage:E}),E.onAdd&&E.onAdd(this,c)}}updateImage(c,n){this._lazyInitEmptyStyle();let a=this.style.getImage(c);if(!a)return void this.fire(new r.a(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let d=n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap?r.f.getImageData(n):n,{width:p,height:g}=d,v=d.data;if(p===void 0||g===void 0)return void this.fire(new r.a(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(p!==a.data.width||g!==a.data.height)return void this.fire(new r.a(new Error(`The width and height of the updated image (${p}, ${g})
                must be that same as the previous version of the image
                (${a.data.width}, ${a.data.height})`)));let k=!(n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap);a.data.replace(v,k),this.style.updateImage(c,a)}hasImage(c){return c?!!this.style&&!!this.style.getImage(c):(this.fire(new r.a(new Error("Missing required image id"))),!1)}removeImage(c){this.style.removeImage(c)}loadImage(c,n){r.d(this._requestManager.transformRequest(c,r.R.Image),(a,d)=>{n(a,d instanceof HTMLImageElement?r.f.getImageData(d):d)})}listImages(){return this.style.listImages()}addModel(c,n){this._lazyInitEmptyStyle(),this.style.addModel(c,n)}hasModel(c){return c?this.style.hasModel(c):(this.fire(new r.a(new Error("Missing required model id"))),!1)}removeModel(c){this.style.removeModel(c)}listModels(){return this.style.listModels()}addLayer(c,n){return this._isValidId(c.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(c,n),this._update(!0)):this}getSlot(c){let n=this.getLayer(c);return n&&n.slot||null}setSlot(c,n){return this.style.setSlot(c,n),this.style.mergeLayers(),this._update(!0)}addImport(c,n){return this.style.addImport(c,n),this}updateImport(c,n){return typeof n!="string"&&n.id!==c?(this.removeImport(c),this.addImport(n)):(this.style.updateImport(c,n),this._update(!0))}removeImport(c){return this.style.removeImport(c),this}moveImport(c,n){return this.style.moveImport(c,n),this._update(!0)}moveLayer(c,n){return this._isValidId(c)?(this.style.moveLayer(c,n),this._update(!0)):this}removeLayer(c){return this._isValidId(c)?(this.style.removeLayer(c),this._update(!0)):this}getLayer(c){return this._isValidId(c)?this.style.getOwnLayer(c):null}setLayerZoomRange(c,n,a){return this._isValidId(c)?(this.style.setLayerZoomRange(c,n,a),this._update(!0)):this}setFilter(c,n,a={}){return this._isValidId(c)?(this.style.setFilter(c,n,a),this._update(!0)):this}getFilter(c){return this._isValidId(c)?this.style.getFilter(c):null}setPaintProperty(c,n,a,d={}){return this._isValidId(c)?(this.style.setPaintProperty(c,n,a,d),this._update(!0)):this}getPaintProperty(c,n){return this._isValidId(c)?this.style.getPaintProperty(c,n):null}setLayoutProperty(c,n,a,d={}){return this._isValidId(c)?(this.style.setLayoutProperty(c,n,a,d),this._update(!0)):this}getLayoutProperty(c,n){return this._isValidId(c)?this.style.getLayoutProperty(c,n):null}getConfigProperty(c,n){return this.style.getConfigProperty(c,n)}setConfigProperty(c,n,a){return this.style.setConfigProperty(c,n,a),this._update(!0)}setLights(c){if(this._lazyInitEmptyStyle(),c&&c.length===1&&c[0].type==="flat"){let n=c[0];n.properties?this.style.setFlatLight(n.properties,n.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(c),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){let c=this.style.getLights()||[];return c.length===0&&c.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),c}setLight(c,n={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:c}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(c){return this._lazyInitEmptyStyle(),!c&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(c),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(c){return this._lazyInitEmptyStyle(),this.style.setFog(c),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(c){return this.style.setCamera(c),this._triggerCameraUpdate(c)}_triggerCameraUpdate(c){return this._update(this.transform.setOrthographicProjectionAtLowPitch(c["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(c){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(r.bn.convert(c),this.transform):0}setFeatureState(c,n){return this._isValidId(c.source)?(this.style.setFeatureState(c,n),this._update()):this}removeFeatureState(c,n){return this._isValidId(c.source)?(this.style.removeFeatureState(c,n),this._update()):this}getFeatureState(c){return this._isValidId(c.source)?this.style.getFeatureState(c):null}_updateContainerDimensions(){if(!this._container)return;let c=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300,a,d,p,g=this._container;for(;g&&(!d||!p);){let v=window.getComputedStyle(g).transform;v&&v!=="none"&&(a=v.match(/matrix.*\((.+)\)/)[1].split(", "),a[0]&&a[0]!=="0"&&a[0]!=="1"&&(d=a[0]),a[3]&&a[3]!=="0"&&a[3]!=="1"&&(p=a[3])),g=g.parentElement}this._containerWidth=d?Math.abs(c/d):c,this._containerHeight=p?Math.abs(n/p):n}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&r.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){let c=this._container;c.classList.add("mapboxgl-map"),(this._missingCSSCanary=me("div","mapboxgl-canary",c)).style.visibility="hidden",this._detectMissingCSS();let n=this._canvasContainer=me("div","mapboxgl-canvas-container",c);this._canvas=me("canvas","mapboxgl-canvas",n),this._interactive&&(n.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);let a=this._controlContainer=me("div","mapboxgl-control-container",c),d=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(p=>{d[p]=me("div",`mapboxgl-ctrl-${p}`,a)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(c,n){let a=r.f.devicePixelRatio||1;this._canvas.width=a*Math.ceil(c),this._canvas.height=a*Math.ceil(n),this._canvas.style.width=`${c}px`,this._canvas.style.height=`${n}px`}_addMarker(c){this._markers.push(c)}_removeMarker(c){let n=this._markers.indexOf(c);n!==-1&&this._markers.splice(n,1)}_addPopup(c){this._popups.push(c)}_removePopup(c){let n=this._popups.indexOf(c);n!==-1&&this._popups.splice(n,1)}_setupPainter(){let c=r.e({},F.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl2",c);n?(r.db(n,!0),this.painter=new Vf(n,this._contextCreateOptions,this.transform,this._tp),this.on("data",a=>{a.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),r.dc.testSupport(n)):this.fire(new r.a(new Error("Failed to initialize WebGL")))}_contextLost(c){c.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new r.b("webglcontextlost",{originalEvent:c}))}_contextRestored(c){this._setupPainter(),this.resize(),this._update(),this.fire(new r.b("webglcontextrestored",{originalEvent:c}))}_onMapScroll(c){if(c.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(c){return this.style?(this._styleDirty=this._styleDirty||c,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(c){return this._update(),this._renderTaskQueue.add(c)}_cancelRenderFrame(c){this._renderTaskQueue.remove(c)}_requestDomTask(c){!this.loaded()||this.loaded()&&!this.isMoving()?c():this._domRenderTaskQueue.add(c)}_render(c){let n;this.fire(new r.b("renderstart"));let a=this.painter.context.extTimerQuery,d=r.f.now(),p=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(n=p.createQuery(),p.beginQuery(a.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(c),this._domRenderTaskQueue.run(c),this._removed)return;this._updateProjectionTransition();let g=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;let S=this.transform.zoom,E=this.transform.pitch,A=r.f.now(),P=new r.K(S,{now:A,fadeDuration:g,pitch:E,transition:this.style.transition});this.style.update(P)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let v=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),v=this._updateAverageElevation(d),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):v=this._updateAverageElevation(d),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,g,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries||this._debugParams.showTileBoundaries,showParseStatus:this.showParseStatus||this._debugParams.showParseStatus,wireframe:{terrain:this.showTerrainWireframe||this._debugParams.showTerrainWireframe,layers2D:this.showLayers2DWireframe||this._debugParams.showLayers2DWireframe,layers3D:this.showLayers3DWireframe||this._debugParams.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector||this._debugParams.showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs||this._debugParams.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:g,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding||this._debugParams.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new r.b("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new r.b("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){let S=r.f.now()-d;p.endQuery(a.TIME_ELAPSED_EXT),setTimeout(()=>{let E=p.getQueryParameter(n,p.QUERY_RESULT)/1e6;p.deleteQuery(n),this.fire(new r.b("gpu-timing-frame",{cpuTime:S,gpuTime:E}))},50)}if(this.listens("gpu-timing-layer")){let S=this.painter.collectGpuTimers();setTimeout(()=>{let E=this.painter.queryGpuTimers(S);this.fire(new r.b("gpu-timing-layer",{layerTimes:E}))},50)}if(this.listens("gpu-timing-deferred-render")){let S=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{let E=this.painter.queryGpuTimeDeferredRender(S);this.fire(new r.b("gpu-timing-deferred-render",{gpuTime:E}))},50)}let k=this._sourcesDirty||this._styleDirty||this._placementDirty||v;if(k||this._repaint)this.triggerRepaint();else{let S=!this.isMoving()&&this.loaded();if(S&&(v=this._updateAverageElevation(d,!0)),v)this.triggerRepaint();else if(this._triggerFrame(!1),S&&(this.fire(new r.b("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){let E=this._calculateSpeedIndex();this.fire(new r.b("speedindexcompleted",{speedIndex:E})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||k||(this._fullyLoaded=!0,this._performanceMetricsCollection&&r.dd(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(c){for(let n of this._markers)c&&!this.getRenderWorldCopies()&&(n._lngLat=n._lngLat.wrap()),n._update();for(let n of this._popups)!c||this.getRenderWorldCopies()||n._trackPointer||(n._lngLat=n._lngLat.wrap()),n._update()}_updateAverageElevation(c,n=!1){let a=p=>(this.transform.averageElevation=p,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&a(0);let d=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(d||(n||c-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(c)){let p=this.transform.averageElevation,g=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(g)?g=0:this._averageElevationLastSampledAt=c;let v=Math.abs(p-g);if(v>1){if(this._isInitialLoad||d)return this._averageElevation.jumpTo(g),a(g);this._averageElevation.easeTo(g,c,300)}else if(v>1e-4)return this._averageElevation.jumpTo(g),a(g)}return!!this._averageElevation.isEasing(c)&&a(this._averageElevation.getValue(c))}_authenticate(){r.de(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,c=>{if(c&&(c.message===r.df||c.status===401)){let n=this.painter.context.gl;r.db(n,!1),this._logoControl instanceof Qf&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new r.a(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),r.dg(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){let c=this._isDragging();this.painter.updateTerrain(this.style,c)}_calculateSpeedIndex(){let c=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());let a=this.painter.context.gl,d=a.createFramebuffer();function p(g){a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,g,0);let v=new Uint8Array(a.drawingBufferWidth*a.drawingBufferHeight*4);return a.readPixels(0,0,a.drawingBufferWidth,a.drawingBufferHeight,a.RGBA,a.UNSIGNED_BYTE,v),v}return a.bindFramebuffer(a.FRAMEBUFFER,d),this._canvasPixelComparison(p(c),n.canvasCopies.map(p),n.timeStamps)}_canvasPixelComparison(c,n,a){let d=a[1]-a[0],p=c.length/4;for(let g=0;g<n.length;g++){let v=n[g],k=0;for(let S=0;S<v.length;S+=4)v[S]===c[S]&&v[S+1]===c[S+1]&&v[S+2]===c[S+2]&&v[S+3]===c[S+3]&&(k+=1);d+=(a[g+2]-a[g+1])*(1-k/p)}return d}remove(){this._hash&&this._hash.remove();for(let n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);let c=this.painter.context.gl.getExtension("WEBGL_lose_context");c&&c.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),r.dh(this.painter.context.gl),r.di.remove(),r.dj.remove(),this._removed=!0,this.fire(new r.b("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(c){this._renderNextFrame=this._renderNextFrame||c,this.style&&!this._frame&&(this._frame=r.f.frame(n=>{let a=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,a&&this._render(n)}))}_preloadTiles(c){let n=this.style?Object.values(this.style._sourceCaches):[];return r.b1(n,(a,d)=>a._preloadTiles(c,d),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(c){this._trackResize&&this.resize({originalEvent:c})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(c){this._showTileBoundaries!==c&&(this._showTileBoundaries=c,this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(c){this._showParseStatus!==c&&(this._showParseStatus=c,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(c){this._showTerrainWireframe!==c&&(this._showTerrainWireframe=c,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(c){this._showLayers2DWireframe!==c&&(this._showLayers2DWireframe=c,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(c){this._showLayers3DWireframe!==c&&(this._showLayers3DWireframe=c,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(c){this._speedIndexTiming!==c&&(this._speedIndexTiming=c,this._update())}get showPadding(){return!!this._showPadding}set showPadding(c){this._showPadding!==c&&(this._showPadding=c,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(c){this._showCollisionBoxes!==c&&(this._showCollisionBoxes=c,c?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(c){this._showOverdrawInspector!==c&&(this._showOverdrawInspector=c,this._update())}get repaint(){return!!this._repaint}set repaint(c){this._repaint!==c&&(this._repaint=c,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(c){this._vertices=c,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(c){this._showTileAABBs!==c&&(this._showTileAABBs=c,c&&this._update())}_setCacheLimits(c,n){r.dl(c,n)}get version(){return r.dk}},NavigationControl:class{constructor(c){this.options=r.e({},sh,c),this._container=me("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(r.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",n=>{this._map&&this._map.zoomIn({},{originalEvent:n})}),me("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",n=>{this._map&&this._map.zoomOut({},{originalEvent:n})}),me("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(r.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",n=>{let a=this._map;a&&(this.options.visualizePitch?a.resetNorthPitch({},{originalEvent:n}):a.resetNorth({},{originalEvent:n}))}),this._compassIcon=me("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){let c=this._map;if(!c)return;let n=c.getZoom(),a=n===c.getMaxZoom(),d=n===c.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=d,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",d.toString())}_rotateCompassArrow(){let c=this._map;if(!c)return;let n=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(c.transform.pitch*(Math.PI/180)),.5)}) rotateX(${c.transform.pitch}deg) rotateZ(${c.transform.angle*(180/Math.PI)}deg)`:`rotate(${c.transform.angle*(180/Math.PI)}deg)`;c._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=n)})}onAdd(c){return this._map=c,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),c.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&c.on("pitch",this._rotateCompassArrow),c.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new za(c,this._compass,this.options.visualizePitch)),this._container}onRemove(){let c=this._map;c&&(this._container.remove(),this.options.showZoom&&c.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&c.off("pitch",this._rotateCompassArrow),c.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(c,n){let a=me("button",c,this._container);return a.type="button",a.addEventListener("click",n),a}_setButtonTitle(c,n){if(!this._map)return;let a=this._map._getUIString(`NavigationControl.${n}`);c.setAttribute("aria-label",a),c.firstElementChild&&c.firstElementChild.setAttribute("title",a)}},GeolocateControl:class extends r.E{constructor(c){super();let n=navigator.geolocation;this.options=r.e({geolocation:n},lh,c),r.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Hc(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(c){return this._map=c,this._container=me("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(c){let n=(a=!!this.options.geolocation)=>{this._supportsGeolocation=a,c(a)};this._supportsGeolocation!==void 0?c(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(a=>n(a.state!=="denied")).catch(()=>n()):n()}_isOutOfMapMaxBounds(c){let n=this._map.getMaxBounds(),a=c.coords;return!!n&&(a.longitude<n.getWest()||a.longitude>n.getEast()||a.latitude<n.getSouth()||a.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(c){if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new r.b("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.b("geolocate",c)),this._finish()}}_updateCamera(c){let n=new r.bn(c.coords.longitude,c.coords.latitude),a=c.coords.accuracy,d=this._map.getBearing(),p=r.e({bearing:d},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(a),p,{geolocateSource:!0})}_updateMarker(c){if(c){let n=new r.bn(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){let c=this._map.transform,n=r.bl(1,c._center.lat)*c.worldSize,a=Math.ceil(2*this._accuracy*n);this._circleElement.style.width=`${a}px`,this._circleElement.style.height=`${a}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(c){if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.b("error",c)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(c){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=me("button","mapboxgl-ctrl-geolocate",this._container),me("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",c===!1){r.w("Geolocation support is not available so the GeolocateControl will be disabled.");let n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}else{let n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=me("div","mapboxgl-user-location"),this._dotElement.appendChild(me("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(me("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Dm({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=me("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Dm({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new r.b("trackuserlocationend")))})}}_onDeviceOrientation(c){this._userLocationDotMarker&&(c.webkitCompassHeading?this._heading=c.webkitCompassHeading:c.absolute===!0&&(this._heading=-1*c.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return r.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new r.b("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new r.b("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new r.b("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let c;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(c={maximumAge:6e5,timeout:0},this._noTimeout=!0):(c=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,c),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){let c=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(n=>{n==="granted"&&c()}).catch(console.error):c()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Am,ScaleControl:class{constructor(c){this.options=r.e({},Nr,c),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),r.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){let c=this.options.maxWidth||100,n=this._map,a=n._containerHeight/2,d=n._containerWidth/2-c/2,p=n.unproject([d,a]),g=n.unproject([d+c,a]),v=p.distanceTo(g);if(this.options.unit==="imperial"){let k=3.2808*v;k>5280?this._setScale(c,k/5280,"mile"):this._setScale(c,k,"foot")}else this.options.unit==="nautical"?this._setScale(c,v/1852,"nautical-mile"):v>=1e3?this._setScale(c,v/1e3,"kilometer"):this._setScale(c,v,"meter")}_setScale(c,n,a){this._map._requestDomTask(()=>{let d=function(g){let v=Math.pow(10,`${Math.floor(g)}`.length-1),k=g/v;return k=k>=10?10:k>=5?5:k>=3?3:k>=2?2:k>=1?1:function(S){let E=Math.pow(10,Math.ceil(-Math.log(S)/Math.LN10));return Math.round(S*E)/E}(k),v*k}(n),p=d/n;this._container.innerHTML=this._isNumberFormatSupported&&a!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:a}).format(d):`${d}&nbsp;${_s[a]}`,this._container.style.width=c*p+"px"})}onAdd(c){return this._map=c,this._language=c.getLanguage(),this._container=me("div","mapboxgl-ctrl mapboxgl-ctrl-scale",c.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(c){this._language=c,this._update()}setUnit(c){this.options.unit=c,this._update()}},FullscreenControl:class{constructor(c){this._fullscreen=!1,c&&c.container&&(c.container instanceof HTMLElement?this._container=c.container:r.w("Full screen control 'container' must be a DOM element.")),r.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(c){return this._map=c,this._container||(this._container=this._map.getContainer()),this._controlContainer=me("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",r.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){let c=this._fullscreenButton=me("button","mapboxgl-ctrl-fullscreen",this._controlContainer);me("span","mapboxgl-ctrl-icon",c).setAttribute("aria-hidden","true"),c.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){let c=this._getTitle();this._fullscreenButton.setAttribute("aria-label",c),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",c)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends r.E{constructor(c){super(),this.options=r.e(Object.create(e_),c),r.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(c&&c.className?c.className.trim().split(/\s+/):[])}addTo(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&c.on("preclick",this._onClose),this.options.closeOnMove&&c.on("move",this._onClose),c.on("remove",this.remove),this._update(),c._addPopup(this),this._focusFirstElement(),this._trackPointer?(c.on("mousemove",this._onMouseEvent),c.on("mouseup",this._onMouseEvent),c._canvasContainer.classList.add("mapboxgl-track-pointer")):c.on("move",this._update),this.fire(new r.b("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);let c=this._map;return c&&(c.off("move",this._update),c.off("move",this._onClose),c.off("preclick",this._onClose),c.off("click",this._onClose),c.off("remove",this.remove),c.off("mousemove",this._onMouseEvent),c.off("mouseup",this._onMouseEvent),c.off("drag",this._onMouseEvent),c._canvasContainer&&c._canvasContainer.classList.remove("mapboxgl-track-pointer"),c._removePopup(this),this._map=void 0),this.fire(new r.b("close")),this}getLngLat(){return this._lngLat}setLngLat(c){this._lngLat=r.bn.convert(c),this._pos=null,this._trackPointer=!1,this._update();let n=this._map;return n&&(n.on("move",this._update),n.off("mousemove",this._onMouseEvent),n._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();let c=this._map;return c&&(c.off("move",this._update),c.on("mousemove",this._onMouseEvent),c.on("drag",this._onMouseEvent),c._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(c){return this.setDOMContent(document.createTextNode(c))}setHTML(c){let n=document.createDocumentFragment(),a=document.createElement("body"),d;for(a.innerHTML=c;d=a.firstChild,d;)n.appendChild(d);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(c){return this.options.maxWidth=c,this._update(),this}setDOMContent(c){let n=this._content;if(n)for(;n.hasChildNodes();)n.firstChild&&n.removeChild(n.firstChild);else n=this._content=me("div","mapboxgl-popup-content",this._container||void 0);if(n.appendChild(c),this.options.closeButton){let a=this._closeButton=me("button","mapboxgl-popup-close-button",n);a.type="button",a.setAttribute("aria-label","Close popup"),a.setAttribute("aria-hidden","true"),a.innerHTML="&#215;",a.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(c){return this._classList.add(c),this._updateClassList(),this}removeClassName(c){return this._classList.delete(c),this._updateClassList(),this}setOffset(c){return this.options.offset=c,this._update(),this}toggleClassName(c){let n;return this._classList.delete(c)?n=!1:(this._classList.add(c),n=!0),this._updateClassList(),n}_onMouseEvent(c){this._update(c.point)}_getAnchor(c){if(this.options.anchor)return this.options.anchor;let n=this._map,a=this._container,d=this._pos;if(!n||!a||!d)return"bottom";let p=a.offsetWidth,g=a.offsetHeight,v=d.x<p/2,k=d.x>n.transform.width-p/2;if(d.y+c<g)return v?"top-left":k?"top-right":"top";if(d.y>n.transform.height-g){if(v)return"bottom-left";if(k)return"bottom-right"}return v?"left":k?"right":"bottom"}_updateClassList(){let c=this._container;if(!c)return;let n=[...this._classList];n.push("mapboxgl-popup"),this._anchor&&n.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&n.push("mapboxgl-popup-track-pointer"),c.className=n.join(" ")}_update(c){let n=this._map,a=this._content;if(!n||!this._lngLat&&!this._trackPointer||!a)return;let d=this._container;if(d||(d=this._container=me("div","mapboxgl-popup",n.getContainer()),this._tip=me("div","mapboxgl-popup-tip",d),d.appendChild(a)),this.options.maxWidth&&d.style.maxWidth!==this.options.maxWidth&&(d.style.maxWidth=this.options.maxWidth),n.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=nd(this._lngLat,this._pos,n.transform)),!this._trackPointer||c){let p=this._pos=this._trackPointer&&c?c:n.project(this._lngLat),g=i_(this.options.offset),v=this._anchor=this._getAnchor(g.y),k=i_(this.options.offset,v),S=p.add(k).round();n._requestDomTask(()=>{this._container&&v&&(this._container.style.transform=`${ah[v]} translate(${S.x}px,${S.y}px)`)})}if(!this._marker&&n._showingGlobe()){let p=r.d6(n.transform,this._lngLat)?0:1;this._setOpacity(p)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let c=this._container.querySelector(t_);c&&c.focus()}_onClose(){this.remove()}_setOpacity(c){this._container&&(this._container.style.opacity=`${c}`),this._content&&(this._content.style.pointerEvents=c?"auto":"none")}},Marker:Dm,Style:Ko,LngLat:r.bn,LngLatBounds:r.ad,Point:r.P,MercatorCoordinate:r.L,FreeCameraOptions:Ec,Evented:r.E,config:r.d5,prewarm:r.dp,clearPrewarmedResources:r.dq,get accessToken(){return r.d5.ACCESS_TOKEN},set accessToken(c){r.d5.ACCESS_TOKEN=c},get baseApiUrl(){return r.d5.API_URL},set baseApiUrl(c){r.d5.API_URL=c},get workerCount(){return r.dr.workerCount},set workerCount(c){r.dr.workerCount=c},get maxParallelImageRequests(){return r.d5.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(c){r.d5.MAX_PARALLEL_IMAGE_REQUESTS=c},clearStorage(c){r.ds(c)},get workerUrl(){return r.dt.workerUrl},set workerUrl(c){r.dt.workerUrl=c},get workerClass(){return r.dt.workerClass},set workerClass(c){r.dt.workerClass=c},get workerParams(){return r.dt.workerParams},set workerParams(c){r.dt.workerParams=c},get dracoUrl(){return r.du()},set dracoUrl(c){r.dv(c)},get meshoptUrl(){return r.dw()},set meshoptUrl(c){r.dx(c)},setNow:r.f.setNow,restoreNow:r.f.restoreNow}});var _=x;return _})});var XS=eg($v=>{"use strict";Object.defineProperty($v,"__esModule",{value:!0});function u3(w){return w}$v.asTypedEventEmitter=u3});var YS=eg(af=>{"use strict";var m3=af&&af.__spreadArrays||function(){for(var w=0,m=0,x=arguments.length;m<x;m++)w+=arguments[m].length;for(var u=Array(w),_=0,m=0;m<x;m++)for(var r=arguments[m],M=0,F=r.length;M<F;M++,_++)u[_]=r[M];return u};Object.defineProperty(af,"__esModule",{value:!0});var p3=function(){function w(){var m=this;this.events={},this.maxListeners=1/0,this.emit=function(x){for(var u=[],_=1;_<arguments.length;_++)u[_-1]=arguments[_];if(m.events[x]){for(var r=m.events[x].length,M=Array.from(m.events[x]),F=0,q=M;F<q.length;F++){var re=q[F];re.apply(void 0,u)}return!!r}return!1},this.on=function(x,u){return m.addListener(x,u),m},this.once=function(x,u){var _=function(){for(var r=[],M=0;M<arguments.length;M++)r[M]=arguments[M];u.apply(void 0,r),m.removeListener(x,_)};return m.addListener(x,_),m},this.addListener=function(x,u){return x in m.events?m.events[x].push(u):m.events[x]=[u],m.maxListeners!==1/0&&m.maxListeners<=m.events[x].length&&console.warn('Maximum event listeners for "'+x+'" event!'),m},this.removeListener=function(x,u){if(x in m.events){var _=m.events[x].indexOf(u);_!==-1&&m.events[x].splice(_,1)}return m},this.hasListeners=function(x){return m.events[x]&&!!m.events[x].length},this.prependListener=function(x,u){return x in m.events?m.events[x].unshift(u):m.events[x]=[u],m},this.prependOnceListener=function(x,u){var _=function(){for(var r=[],M=0;M<arguments.length;M++)r[M]=arguments[M];u.apply(void 0,r),m.removeListener(x,_)};return m.prependListener(x,_),m},this.off=function(x,u){return m.removeListener(x,u)},this.removeAllListeners=function(x){return delete m.events[x],m},this.setMaxListeners=function(x){return m.maxListeners=x,m},this.getMaxListeners=function(){return m.maxListeners},this.listeners=function(x){return m3(m.events[x])},this.rawListeners=function(x){return m.events[x]},this.eventNames=function(){return Object.keys(m.events)},this.listenerCount=function(x){return m.events[x]&&m.events[x].length||0}}return w}();af.EventEmitter=p3});var qv=eg(d0=>{"use strict";function KS(w){for(var m in w)d0.hasOwnProperty(m)||(d0[m]=w[m])}Object.defineProperty(d0,"__esModule",{value:!0});KS(XS());KS(YS())});var Vi="primary",Np=Symbol("RouteTitle"),Ib=class{constructor(m){this.params=m||{}}has(m){return Object.prototype.hasOwnProperty.call(this.params,m)}get(m){if(this.has(m)){let x=this.params[m];return Array.isArray(x)?x[0]:x}return null}getAll(m){if(this.has(m)){let x=this.params[m];return Array.isArray(x)?x:[x]}return[]}get keys(){return Object.keys(this.params)}};function qh(w){return new Ib(w)}function XA(w,m,x){let u=x.path.split("/");if(u.length>w.length||x.pathMatch==="full"&&(m.hasChildren()||u.length<w.length))return null;let _={};for(let r=0;r<u.length;r++){let M=u[r],F=w[r];if(M.startsWith(":"))_[M.substring(1)]=F;else if(M!==F.path)return null}return{consumed:w.slice(0,u.length),posParams:_}}function YA(w,m){if(w.length!==m.length)return!1;for(let x=0;x<w.length;++x)if(!As(w[x],m[x]))return!1;return!0}function As(w,m){let x=w?Sb(w):void 0,u=m?Sb(m):void 0;if(!x||!u||x.length!=u.length)return!1;let _;for(let r=0;r<x.length;r++)if(_=x[r],!bk(w[_],m[_]))return!1;return!0}function Sb(w){return[...Object.keys(w),...Object.getOwnPropertySymbols(w)]}function bk(w,m){if(Array.isArray(w)&&Array.isArray(m)){if(w.length!==m.length)return!1;let x=[...w].sort(),u=[...m].sort();return x.every((_,r)=>u[r]===_)}else return w===m}function vk(w){return w.length>0?w[w.length-1]:null}function hc(w){return h2(w)?w:L2(w)?la(Promise.resolve(w)):wi(w)}var KA={exact:wk,subset:Tk},xk={exact:QA,subset:JA,ignored:()=>!0};function hk(w,m,x){return KA[x.paths](w.root,m.root,x.matrixParams)&&xk[x.queryParams](w.queryParams,m.queryParams)&&!(x.fragment==="exact"&&w.fragment!==m.fragment)}function QA(w,m){return As(w,m)}function wk(w,m,x){if(!wd(w.segments,m.segments)||!Dg(w.segments,m.segments,x)||w.numberOfChildren!==m.numberOfChildren)return!1;for(let u in m.children)if(!w.children[u]||!wk(w.children[u],m.children[u],x))return!1;return!0}function JA(w,m){return Object.keys(m).length<=Object.keys(w).length&&Object.keys(m).every(x=>bk(w[x],m[x]))}function Tk(w,m,x){return kk(w,m,m.segments,x)}function kk(w,m,x,u){if(w.segments.length>x.length){let _=w.segments.slice(0,x.length);return!(!wd(_,x)||m.hasChildren()||!Dg(_,x,u))}else if(w.segments.length===x.length){if(!wd(w.segments,x)||!Dg(w.segments,x,u))return!1;for(let _ in m.children)if(!w.children[_]||!Tk(w.children[_],m.children[_],u))return!1;return!0}else{let _=x.slice(0,w.segments.length),r=x.slice(w.segments.length);return!wd(w.segments,_)||!Dg(w.segments,_,u)||!w.children[Vi]?!1:kk(w.children[Vi],m,r,u)}}function Dg(w,m,x){return m.every((u,_)=>xk[x](w[_].parameters,u.parameters))}var sc=class{constructor(m=new Sn([],{}),x={},u=null){this.root=m,this.queryParams=x,this.fragment=u}get queryParamMap(){return this._queryParamMap??=qh(this.queryParams),this._queryParamMap}toString(){return iD.serialize(this)}},Sn=class{constructor(m,x){this.segments=m,this.children=x,this.parent=null,Object.values(x).forEach(u=>u.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Pg(this)}},xd=class{constructor(m,x){this.path=m,this.parameters=x}get parameterMap(){return this._parameterMap??=qh(this.parameters),this._parameterMap}toString(){return Sk(this)}};function eD(w,m){return wd(w,m)&&w.every((x,u)=>As(x.parameters,m[u].parameters))}function wd(w,m){return w.length!==m.length?!1:w.every((x,u)=>x.path===m[u].path)}function tD(w,m){let x=[];return Object.entries(w.children).forEach(([u,_])=>{u===Vi&&(x=x.concat(m(_,u)))}),Object.entries(w.children).forEach(([u,_])=>{u!==Vi&&(x=x.concat(m(_,u)))}),x}var jp=(()=>{let m=class m{};m.\u0275fac=function(_){return new(_||m)},m.\u0275prov=Tn({token:m,factory:()=>new Ap,providedIn:"root"});let w=m;return w})(),Ap=class{parse(m){let x=new Mb(m);return new sc(x.parseRootSegment(),x.parseQueryParams(),x.parseFragment())}serialize(m){let x=`/${kp(m.root,!0)}`,u=oD(m.queryParams),_=typeof m.fragment=="string"?`#${nD(m.fragment)}`:"";return`${x}${u}${_}`}},iD=new Ap;function Pg(w){return w.segments.map(m=>Sk(m)).join("/")}function kp(w,m){if(!w.hasChildren())return Pg(w);if(m){let x=w.children[Vi]?kp(w.children[Vi],!1):"",u=[];return Object.entries(w.children).forEach(([_,r])=>{_!==Vi&&u.push(`${_}:${kp(r,!1)}`)}),u.length>0?`${x}(${u.join("//")})`:x}else{let x=tD(w,(u,_)=>_===Vi?[kp(w.children[Vi],!1)]:[`${_}:${kp(u,!1)}`]);return Object.keys(w.children).length===1&&w.children[Vi]!=null?`${Pg(w)}/${x[0]}`:`${Pg(w)}/(${x.join("//")})`}}function Ik(w){return encodeURIComponent(w).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Eg(w){return Ik(w).replace(/%3B/gi,";")}function nD(w){return encodeURI(w)}function Cb(w){return Ik(w).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Rg(w){return decodeURIComponent(w)}function uk(w){return Rg(w.replace(/\+/g,"%20"))}function Sk(w){return`${Cb(w.path)}${rD(w.parameters)}`}function rD(w){return Object.entries(w).map(([m,x])=>`;${Cb(m)}=${Cb(x)}`).join("")}function oD(w){let m=Object.entries(w).map(([x,u])=>Array.isArray(u)?u.map(_=>`${Eg(x)}=${Eg(_)}`).join("&"):`${Eg(x)}=${Eg(u)}`).filter(x=>x);return m.length?`?${m.join("&")}`:""}var aD=/^[^\/()?;#]+/;function xb(w){let m=w.match(aD);return m?m[0]:""}var sD=/^[^\/()?;=#]+/;function lD(w){let m=w.match(sD);return m?m[0]:""}var cD=/^[^=?&#]+/;function dD(w){let m=w.match(cD);return m?m[0]:""}var hD=/^[^&#]+/;function uD(w){let m=w.match(hD);return m?m[0]:""}var Mb=class{constructor(m){this.url=m,this.remaining=m}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new Sn([],{}):new Sn([],this.parseChildren())}parseQueryParams(){let m={};if(this.consumeOptional("?"))do this.parseQueryParam(m);while(this.consumeOptional("&"));return m}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let m=[];for(this.peekStartsWith("(")||m.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),m.push(this.parseSegment());let x={};this.peekStartsWith("/(")&&(this.capture("/"),x=this.parseParens(!0));let u={};return this.peekStartsWith("(")&&(u=this.parseParens(!1)),(m.length>0||Object.keys(x).length>0)&&(u[Vi]=new Sn(m,x)),u}parseSegment(){let m=xb(this.remaining);if(m===""&&this.peekStartsWith(";"))throw new Jr(4009,!1);return this.capture(m),new xd(Rg(m),this.parseMatrixParams())}parseMatrixParams(){let m={};for(;this.consumeOptional(";");)this.parseParam(m);return m}parseParam(m){let x=lD(this.remaining);if(!x)return;this.capture(x);let u="";if(this.consumeOptional("=")){let _=xb(this.remaining);_&&(u=_,this.capture(u))}m[Rg(x)]=Rg(u)}parseQueryParam(m){let x=dD(this.remaining);if(!x)return;this.capture(x);let u="";if(this.consumeOptional("=")){let M=uD(this.remaining);M&&(u=M,this.capture(u))}let _=uk(x),r=uk(u);if(m.hasOwnProperty(_)){let M=m[_];Array.isArray(M)||(M=[M],m[_]=M),M.push(r)}else m[_]=r}parseParens(m){let x={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let u=xb(this.remaining),_=this.remaining[u.length];if(_!=="/"&&_!==")"&&_!==";")throw new Jr(4010,!1);let r;u.indexOf(":")>-1?(r=u.slice(0,u.indexOf(":")),this.capture(r),this.capture(":")):m&&(r=Vi);let M=this.parseChildren();x[r]=Object.keys(M).length===1?M[Vi]:new Sn([],M),this.consumeOptional("//")}return x}peekStartsWith(m){return this.remaining.startsWith(m)}consumeOptional(m){return this.peekStartsWith(m)?(this.remaining=this.remaining.substring(m.length),!0):!1}capture(m){if(!this.consumeOptional(m))throw new Jr(4011,!1)}};function Ck(w){return w.segments.length>0?new Sn([],{[Vi]:w}):w}function Mk(w){let m={};for(let[u,_]of Object.entries(w.children)){let r=Mk(_);if(u===Vi&&r.segments.length===0&&r.hasChildren())for(let[M,F]of Object.entries(r.children))m[M]=F;else(r.segments.length>0||r.hasChildren())&&(m[u]=r)}let x=new Sn(w.segments,m);return mD(x)}function mD(w){if(w.numberOfChildren===1&&w.children[Vi]){let m=w.children[Vi];return new Sn(w.segments.concat(m.segments),m.children)}return w}function Hh(w){return w instanceof sc}function pD(w,m,x=null,u=null){let _=Ek(w);return Ak(_,m,x,u)}function Ek(w){let m;function x(r){let M={};for(let q of r.children){let re=x(q);M[q.outlet]=re}let F=new Sn(r.url,M);return r===w&&(m=F),F}let u=x(w.root),_=Ck(u);return m??_}function Ak(w,m,x,u){let _=w;for(;_.parent;)_=_.parent;if(m.length===0)return wb(_,_,_,x,u);let r=fD(m);if(r.toRoot())return wb(_,_,new Sn([],{}),x,u);let M=_D(r,_,w),F=M.processChildren?Cp(M.segmentGroup,M.index,r.commands):Pk(M.segmentGroup,M.index,r.commands);return wb(_,M.segmentGroup,F,x,u)}function Lg(w){return typeof w=="object"&&w!=null&&!w.outlets&&!w.segmentPath}function Dp(w){return typeof w=="object"&&w!=null&&w.outlets}function wb(w,m,x,u,_){let r={};u&&Object.entries(u).forEach(([q,re])=>{r[q]=Array.isArray(re)?re.map(me=>`${me}`):`${re}`});let M;w===m?M=x:M=Dk(w,m,x);let F=Ck(Mk(M));return new sc(F,r,_)}function Dk(w,m,x){let u={};return Object.entries(w.children).forEach(([_,r])=>{r===m?u[_]=x:u[_]=Dk(r,m,x)}),new Sn(w.segments,u)}var zg=class{constructor(m,x,u){if(this.isAbsolute=m,this.numberOfDoubleDots=x,this.commands=u,m&&u.length>0&&Lg(u[0]))throw new Jr(4003,!1);let _=u.find(Dp);if(_&&_!==vk(u))throw new Jr(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function fD(w){if(typeof w[0]=="string"&&w.length===1&&w[0]==="/")return new zg(!0,0,w);let m=0,x=!1,u=w.reduce((_,r,M)=>{if(typeof r=="object"&&r!=null){if(r.outlets){let F={};return Object.entries(r.outlets).forEach(([q,re])=>{F[q]=typeof re=="string"?re.split("/"):re}),[..._,{outlets:F}]}if(r.segmentPath)return[..._,r.segmentPath]}return typeof r!="string"?[..._,r]:M===0?(r.split("/").forEach((F,q)=>{q==0&&F==="."||(q==0&&F===""?x=!0:F===".."?m++:F!=""&&_.push(F))}),_):[..._,r]},[]);return new zg(x,m,u)}var Gh=class{constructor(m,x,u){this.segmentGroup=m,this.processChildren=x,this.index=u}};function _D(w,m,x){if(w.isAbsolute)return new Gh(m,!0,0);if(!x)return new Gh(m,!1,NaN);if(x.parent===null)return new Gh(x,!0,0);let u=Lg(w.commands[0])?0:1,_=x.segments.length-1+u;return gD(x,_,w.numberOfDoubleDots)}function gD(w,m,x){let u=w,_=m,r=x;for(;r>_;){if(r-=_,u=u.parent,!u)throw new Jr(4005,!1);_=u.segments.length}return new Gh(u,!1,_-r)}function yD(w){return Dp(w[0])?w[0].outlets:{[Vi]:w}}function Pk(w,m,x){if(w??=new Sn([],{}),w.segments.length===0&&w.hasChildren())return Cp(w,m,x);let u=bD(w,m,x),_=x.slice(u.commandIndex);if(u.match&&u.pathIndex<w.segments.length){let r=new Sn(w.segments.slice(0,u.pathIndex),{});return r.children[Vi]=new Sn(w.segments.slice(u.pathIndex),w.children),Cp(r,0,_)}else return u.match&&_.length===0?new Sn(w.segments,{}):u.match&&!w.hasChildren()?Eb(w,m,x):u.match?Cp(w,0,_):Eb(w,m,x)}function Cp(w,m,x){if(x.length===0)return new Sn(w.segments,{});{let u=yD(x),_={};if(Object.keys(u).some(r=>r!==Vi)&&w.children[Vi]&&w.numberOfChildren===1&&w.children[Vi].segments.length===0){let r=Cp(w.children[Vi],m,x);return new Sn(w.segments,r.children)}return Object.entries(u).forEach(([r,M])=>{typeof M=="string"&&(M=[M]),M!==null&&(_[r]=Pk(w.children[r],m,M))}),Object.entries(w.children).forEach(([r,M])=>{u[r]===void 0&&(_[r]=M)}),new Sn(w.segments,_)}}function bD(w,m,x){let u=0,_=m,r={match:!1,pathIndex:0,commandIndex:0};for(;_<w.segments.length;){if(u>=x.length)return r;let M=w.segments[_],F=x[u];if(Dp(F))break;let q=`${F}`,re=u<x.length-1?x[u+1]:null;if(_>0&&q===void 0)break;if(q&&re&&typeof re=="object"&&re.outlets===void 0){if(!pk(q,re,M))return r;u+=2}else{if(!pk(q,{},M))return r;u++}_++}return{match:!0,pathIndex:_,commandIndex:u}}function Eb(w,m,x){let u=w.segments.slice(0,m),_=0;for(;_<x.length;){let r=x[_];if(Dp(r)){let q=vD(r.outlets);return new Sn(u,q)}if(_===0&&Lg(x[0])){let q=w.segments[m];u.push(new xd(q.path,mk(x[0]))),_++;continue}let M=Dp(r)?r.outlets[Vi]:`${r}`,F=_<x.length-1?x[_+1]:null;M&&F&&Lg(F)?(u.push(new xd(M,mk(F))),_+=2):(u.push(new xd(M,{})),_++)}return new Sn(u,{})}function vD(w){let m={};return Object.entries(w).forEach(([x,u])=>{typeof u=="string"&&(u=[u]),u!==null&&(m[x]=Eb(new Sn([],{}),0,u))}),m}function mk(w){let m={};return Object.entries(w).forEach(([x,u])=>m[x]=`${u}`),m}function pk(w,m,x){return w==x.path&&As(m,x.parameters)}var Mp="imperative",Gr=function(w){return w[w.NavigationStart=0]="NavigationStart",w[w.NavigationEnd=1]="NavigationEnd",w[w.NavigationCancel=2]="NavigationCancel",w[w.NavigationError=3]="NavigationError",w[w.RoutesRecognized=4]="RoutesRecognized",w[w.ResolveStart=5]="ResolveStart",w[w.ResolveEnd=6]="ResolveEnd",w[w.GuardsCheckStart=7]="GuardsCheckStart",w[w.GuardsCheckEnd=8]="GuardsCheckEnd",w[w.RouteConfigLoadStart=9]="RouteConfigLoadStart",w[w.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",w[w.ChildActivationStart=11]="ChildActivationStart",w[w.ChildActivationEnd=12]="ChildActivationEnd",w[w.ActivationStart=13]="ActivationStart",w[w.ActivationEnd=14]="ActivationEnd",w[w.Scroll=15]="Scroll",w[w.NavigationSkipped=16]="NavigationSkipped",w}(Gr||{}),Ta=class{constructor(m,x){this.id=m,this.url=x}},Zh=class extends Ta{constructor(m,x,u="imperative",_=null){super(m,x),this.type=Gr.NavigationStart,this.navigationTrigger=u,this.restoredState=_}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},Ds=class extends Ta{constructor(m,x,u){super(m,x),this.urlAfterRedirects=u,this.type=Gr.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},wa=function(w){return w[w.Redirect=0]="Redirect",w[w.SupersededByNewNavigation=1]="SupersededByNewNavigation",w[w.NoDataFromResolver=2]="NoDataFromResolver",w[w.GuardRejected=3]="GuardRejected",w}(wa||{}),Og=function(w){return w[w.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",w[w.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",w}(Og||{}),lc=class extends Ta{constructor(m,x,u,_){super(m,x),this.reason=u,this.code=_,this.type=Gr.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},cc=class extends Ta{constructor(m,x,u,_){super(m,x),this.reason=u,this.code=_,this.type=Gr.NavigationSkipped}},Pp=class extends Ta{constructor(m,x,u,_){super(m,x),this.error=u,this.target=_,this.type=Gr.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},Fg=class extends Ta{constructor(m,x,u,_){super(m,x),this.urlAfterRedirects=u,this.state=_,this.type=Gr.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Ab=class extends Ta{constructor(m,x,u,_){super(m,x),this.urlAfterRedirects=u,this.state=_,this.type=Gr.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Db=class extends Ta{constructor(m,x,u,_,r){super(m,x),this.urlAfterRedirects=u,this.state=_,this.shouldActivate=r,this.type=Gr.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},Pb=class extends Ta{constructor(m,x,u,_){super(m,x),this.urlAfterRedirects=u,this.state=_,this.type=Gr.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Rb=class extends Ta{constructor(m,x,u,_){super(m,x),this.urlAfterRedirects=u,this.state=_,this.type=Gr.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Lb=class{constructor(m){this.route=m,this.type=Gr.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},zb=class{constructor(m){this.route=m,this.type=Gr.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},Ob=class{constructor(m){this.snapshot=m,this.type=Gr.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Fb=class{constructor(m){this.snapshot=m,this.type=Gr.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Bb=class{constructor(m){this.snapshot=m,this.type=Gr.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Nb=class{constructor(m){this.snapshot=m,this.type=Gr.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Bg=class{constructor(m,x,u){this.routerEvent=m,this.position=x,this.anchor=u,this.type=Gr.Scroll}toString(){let m=this.position?`${this.position[0]}, ${this.position[1]}`:null;return`Scroll(anchor: '${this.anchor}', position: '${m}')`}},Rp=class{},Lp=class{constructor(m){this.url=m}};var jb=class{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new Vp,this.attachRef=null}},Vp=(()=>{let m=class m{constructor(){this.contexts=new Map}onChildOutletCreated(u,_){let r=this.getOrCreateContext(u);r.outlet=_,this.contexts.set(u,r)}onChildOutletDestroyed(u){let _=this.getContext(u);_&&(_.outlet=null,_.attachRef=null)}onOutletDeactivated(){let u=this.contexts;return this.contexts=new Map,u}onOutletReAttached(u){this.contexts=u}getOrCreateContext(u){let _=this.getContext(u);return _||(_=new jb,this.contexts.set(u,_)),_}getContext(u){return this.contexts.get(u)||null}};m.\u0275fac=function(_){return new(_||m)},m.\u0275prov=Tn({token:m,factory:m.\u0275fac,providedIn:"root"});let w=m;return w})(),Ng=class{constructor(m){this._root=m}get root(){return this._root.value}parent(m){let x=this.pathFromRoot(m);return x.length>1?x[x.length-2]:null}children(m){let x=Vb(m,this._root);return x?x.children.map(u=>u.value):[]}firstChild(m){let x=Vb(m,this._root);return x&&x.children.length>0?x.children[0].value:null}siblings(m){let x=Ub(m,this._root);return x.length<2?[]:x[x.length-2].children.map(_=>_.value).filter(_=>_!==m)}pathFromRoot(m){return Ub(m,this._root).map(x=>x.value)}};function Vb(w,m){if(w===m.value)return m;for(let x of m.children){let u=Vb(w,x);if(u)return u}return null}function Ub(w,m){if(w===m.value)return[m];for(let x of m.children){let u=Ub(w,x);if(u.length)return u.unshift(m),u}return[]}var ua=class{constructor(m,x){this.value=m,this.children=x}toString(){return`TreeNode(${this.value})`}};function Uh(w){let m={};return w&&w.children.forEach(x=>m[x.value.outlet]=x),m}var jg=class extends Ng{constructor(m,x){super(m),this.snapshot=x,Qb(this,m)}toString(){return this.snapshot.toString()}};function Rk(w){let m=xD(w),x=new sa([new xd("",{})]),u=new sa({}),_=new sa({}),r=new sa({}),M=new sa(""),F=new dc(x,u,r,M,_,Vi,w,m.root);return F.snapshot=m.root,new jg(new ua(F,[]),m)}function xD(w){let m={},x={},u={},_="",r=new zp([],m,u,_,x,Vi,w,null,{});return new Vg("",new ua(r,[]))}var dc=class{constructor(m,x,u,_,r,M,F,q){this.urlSubject=m,this.paramsSubject=x,this.queryParamsSubject=u,this.fragmentSubject=_,this.dataSubject=r,this.outlet=M,this.component=F,this._futureSnapshot=q,this.title=this.dataSubject?.pipe(jn(re=>re[Np]))??wi(void 0),this.url=m,this.params=x,this.queryParams=u,this.fragment=_,this.data=r}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(jn(m=>qh(m))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(jn(m=>qh(m))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function Kb(w,m,x="emptyOnly"){let u,{routeConfig:_}=w;return m!==null&&(x==="always"||_?.path===""||!m.component&&!m.routeConfig?.loadComponent)?u={params:It(It({},m.params),w.params),data:It(It({},m.data),w.data),resolve:It(It(It(It({},w.data),m.data),_?.data),w._resolvedData)}:u={params:It({},w.params),data:It({},w.data),resolve:It(It({},w.data),w._resolvedData??{})},_&&zk(_)&&(u.resolve[Np]=_.title),u}var zp=class{get title(){return this.data?.[Np]}constructor(m,x,u,_,r,M,F,q,re){this.url=m,this.params=x,this.queryParams=u,this.fragment=_,this.data=r,this.outlet=M,this.component=F,this.routeConfig=q,this._resolve=re}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=qh(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=qh(this.queryParams),this._queryParamMap}toString(){let m=this.url.map(u=>u.toString()).join("/"),x=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${m}', path:'${x}')`}},Vg=class extends Ng{constructor(m,x){super(x),this.url=m,Qb(this,x)}toString(){return Lk(this._root)}};function Qb(w,m){m.value._routerState=w,m.children.forEach(x=>Qb(w,x))}function Lk(w){let m=w.children.length>0?` { ${w.children.map(Lk).join(", ")} } `:"";return`${w.value}${m}`}function Tb(w){if(w.snapshot){let m=w.snapshot,x=w._futureSnapshot;w.snapshot=x,As(m.queryParams,x.queryParams)||w.queryParamsSubject.next(x.queryParams),m.fragment!==x.fragment&&w.fragmentSubject.next(x.fragment),As(m.params,x.params)||w.paramsSubject.next(x.params),YA(m.url,x.url)||w.urlSubject.next(x.url),As(m.data,x.data)||w.dataSubject.next(x.data)}else w.snapshot=w._futureSnapshot,w.dataSubject.next(w._futureSnapshot.data)}function Gb(w,m){let x=As(w.params,m.params)&&eD(w.url,m.url),u=!w.parent!=!m.parent;return x&&!u&&(!w.parent||Gb(w.parent,m.parent))}function zk(w){return typeof w.title=="string"||w.title===null}var wD=(()=>{let m=class m{constructor(){this.activated=null,this._activatedRoute=null,this.name=Vi,this.activateEvents=new Ut,this.deactivateEvents=new Ut,this.attachEvents=new Ut,this.detachEvents=new Ut,this.parentContexts=St(Vp),this.location=St(Za),this.changeDetector=St(On),this.environmentInjector=St(up),this.inputBinder=St(qg,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(u){if(u.name){let{firstChange:_,previousValue:r}=u.name;if(_)return;this.isTrackedInParentContexts(r)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(r)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(u){return this.parentContexts.getContext(u)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let u=this.parentContexts.getContext(this.name);u?.route&&(u.attachRef?this.attach(u.attachRef,u.route):this.activateWith(u.route,u.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Jr(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Jr(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Jr(4012,!1);this.location.detach();let u=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(u.instance),u}attach(u,_){this.activated=u,this._activatedRoute=_,this.location.insert(u.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(u.instance)}deactivate(){if(this.activated){let u=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(u)}}activateWith(u,_){if(this.isActivated)throw new Jr(4013,!1);this._activatedRoute=u;let r=this.location,F=u.snapshot.component,q=this.parentContexts.getOrCreateContext(this.name).children,re=new $b(u,q,r.injector);this.activated=r.createComponent(F,{index:r.length,injector:re,environmentInjector:_??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}};m.\u0275fac=function(_){return new(_||m)},m.\u0275dir=fn({type:m,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[lr]});let w=m;return w})(),$b=class{constructor(m,x,u){this.route=m,this.childContexts=x,this.parent=u}get(m,x){return m===dc?this.route:m===Vp?this.childContexts:this.parent.get(m,x)}},qg=new ci(""),fk=(()=>{let m=class m{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(u){this.unsubscribeFromRouteData(u),this.subscribeToRouteData(u)}unsubscribeFromRouteData(u){this.outletDataSubscriptions.get(u)?.unsubscribe(),this.outletDataSubscriptions.delete(u)}subscribeToRouteData(u){let{activatedRoute:_}=u,r=tg([_.queryParams,_.params,_.data]).pipe(wo(([M,F,q],re)=>(q=It(It(It({},M),F),q),re===0?wi(q):Promise.resolve(q)))).subscribe(M=>{if(!u.isActivated||!u.activatedComponentRef||u.activatedRoute!==_||_.component===null){this.unsubscribeFromRouteData(u);return}let F=j2(_.component);if(!F){this.unsubscribeFromRouteData(u);return}for(let{templateName:q}of F.inputs)u.activatedComponentRef.setInput(q,M[q])});this.outletDataSubscriptions.set(u,r)}};m.\u0275fac=function(_){return new(_||m)},m.\u0275prov=Tn({token:m,factory:m.\u0275fac});let w=m;return w})();function TD(w,m,x){let u=Op(w,m._root,x?x._root:void 0);return new jg(u,m)}function Op(w,m,x){if(x&&w.shouldReuseRoute(m.value,x.value.snapshot)){let u=x.value;u._futureSnapshot=m.value;let _=kD(w,m,x);return new ua(u,_)}else{if(w.shouldAttach(m.value)){let r=w.retrieve(m.value);if(r!==null){let M=r.route;return M.value._futureSnapshot=m.value,M.children=m.children.map(F=>Op(w,F)),M}}let u=ID(m.value),_=m.children.map(r=>Op(w,r));return new ua(u,_)}}function kD(w,m,x){return m.children.map(u=>{for(let _ of x.children)if(w.shouldReuseRoute(u.value,_.value.snapshot))return Op(w,u,_);return Op(w,u)})}function ID(w){return new dc(new sa(w.url),new sa(w.params),new sa(w.queryParams),new sa(w.fragment),new sa(w.data),w.outlet,w.component,w)}var Ok="ngNavigationCancelingError";function Fk(w,m){let{redirectTo:x,navigationBehaviorOptions:u}=Hh(m)?{redirectTo:m,navigationBehaviorOptions:void 0}:m,_=Bk(!1,wa.Redirect);return _.url=x,_.navigationBehaviorOptions=u,_}function Bk(w,m){let x=new Error(`NavigationCancelingError: ${w||""}`);return x[Ok]=!0,x.cancellationCode=m,x}function SD(w){return Nk(w)&&Hh(w.url)}function Nk(w){return!!w&&w[Ok]}var CD=(()=>{let m=class m{};m.\u0275fac=function(_){return new(_||m)},m.\u0275cmp=hi({type:m,selectors:[["ng-component"]],standalone:!0,features:[ui],decls:1,vars:0,template:function(_,r){_&1&&Ki(0,"router-outlet")},dependencies:[wD],encapsulation:2});let w=m;return w})();function MD(w,m){return w.providers&&!w._injector&&(w._injector=mb(w.providers,m,`Route: ${w.path}`)),w._injector??m}function Jb(w){let m=w.children&&w.children.map(Jb),x=m?sr(It({},w),{children:m}):It({},w);return!x.component&&!x.loadComponent&&(m||x.loadChildren)&&x.outlet&&x.outlet!==Vi&&(x.component=CD),x}function Ps(w){return w.outlet||Vi}function ED(w,m){let x=w.filter(u=>Ps(u)===m);return x.push(...w.filter(u=>Ps(u)!==m)),x}function Up(w){if(!w)return null;if(w.routeConfig?._injector)return w.routeConfig._injector;for(let m=w.parent;m;m=m.parent){let x=m.routeConfig;if(x?._loadedInjector)return x._loadedInjector;if(x?._injector)return x._injector}return null}var AD=(w,m,x,u)=>jn(_=>(new qb(m,_.targetRouterState,_.currentRouterState,x,u).activate(w),_)),qb=class{constructor(m,x,u,_,r){this.routeReuseStrategy=m,this.futureState=x,this.currState=u,this.forwardEvent=_,this.inputBindingEnabled=r}activate(m){let x=this.futureState._root,u=this.currState?this.currState._root:null;this.deactivateChildRoutes(x,u,m),Tb(this.futureState.root),this.activateChildRoutes(x,u,m)}deactivateChildRoutes(m,x,u){let _=Uh(x);m.children.forEach(r=>{let M=r.value.outlet;this.deactivateRoutes(r,_[M],u),delete _[M]}),Object.values(_).forEach(r=>{this.deactivateRouteAndItsChildren(r,u)})}deactivateRoutes(m,x,u){let _=m.value,r=x?x.value:null;if(_===r)if(_.component){let M=u.getContext(_.outlet);M&&this.deactivateChildRoutes(m,x,M.children)}else this.deactivateChildRoutes(m,x,u);else r&&this.deactivateRouteAndItsChildren(x,u)}deactivateRouteAndItsChildren(m,x){m.value.component&&this.routeReuseStrategy.shouldDetach(m.value.snapshot)?this.detachAndStoreRouteSubtree(m,x):this.deactivateRouteAndOutlet(m,x)}detachAndStoreRouteSubtree(m,x){let u=x.getContext(m.value.outlet),_=u&&m.value.component?u.children:x,r=Uh(m);for(let M of Object.values(r))this.deactivateRouteAndItsChildren(M,_);if(u&&u.outlet){let M=u.outlet.detach(),F=u.children.onOutletDeactivated();this.routeReuseStrategy.store(m.value.snapshot,{componentRef:M,route:m,contexts:F})}}deactivateRouteAndOutlet(m,x){let u=x.getContext(m.value.outlet),_=u&&m.value.component?u.children:x,r=Uh(m);for(let M of Object.values(r))this.deactivateRouteAndItsChildren(M,_);u&&(u.outlet&&(u.outlet.deactivate(),u.children.onOutletDeactivated()),u.attachRef=null,u.route=null)}activateChildRoutes(m,x,u){let _=Uh(x);m.children.forEach(r=>{this.activateRoutes(r,_[r.value.outlet],u),this.forwardEvent(new Nb(r.value.snapshot))}),m.children.length&&this.forwardEvent(new Fb(m.value.snapshot))}activateRoutes(m,x,u){let _=m.value,r=x?x.value:null;if(Tb(_),_===r)if(_.component){let M=u.getOrCreateContext(_.outlet);this.activateChildRoutes(m,x,M.children)}else this.activateChildRoutes(m,x,u);else if(_.component){let M=u.getOrCreateContext(_.outlet);if(this.routeReuseStrategy.shouldAttach(_.snapshot)){let F=this.routeReuseStrategy.retrieve(_.snapshot);this.routeReuseStrategy.store(_.snapshot,null),M.children.onOutletReAttached(F.contexts),M.attachRef=F.componentRef,M.route=F.route.value,M.outlet&&M.outlet.attach(F.componentRef,F.route.value),Tb(F.route.value),this.activateChildRoutes(m,null,M.children)}else{let F=Up(_.snapshot);M.attachRef=null,M.route=_,M.injector=F,M.outlet&&M.outlet.activateWith(_,M.injector),this.activateChildRoutes(m,null,M.children)}}else this.activateChildRoutes(m,null,u)}},Ug=class{constructor(m){this.path=m,this.route=this.path[this.path.length-1]}},$h=class{constructor(m,x){this.component=m,this.route=x}};function DD(w,m,x){let u=w._root,_=m?m._root:null;return Ip(u,_,x,[u.value])}function PD(w){let m=w.routeConfig?w.routeConfig.canActivateChild:null;return!m||m.length===0?null:{node:w,guards:m}}function Xh(w,m){let x=Symbol(),u=m.get(w,x);return u===x?typeof w=="function"&&!v2(w)?w:m.get(w):u}function Ip(w,m,x,u,_={canDeactivateChecks:[],canActivateChecks:[]}){let r=Uh(m);return w.children.forEach(M=>{RD(M,r[M.value.outlet],x,u.concat([M.value]),_),delete r[M.value.outlet]}),Object.entries(r).forEach(([M,F])=>Ep(F,x.getContext(M),_)),_}function RD(w,m,x,u,_={canDeactivateChecks:[],canActivateChecks:[]}){let r=w.value,M=m?m.value:null,F=x?x.getContext(w.value.outlet):null;if(M&&r.routeConfig===M.routeConfig){let q=LD(M,r,r.routeConfig.runGuardsAndResolvers);q?_.canActivateChecks.push(new Ug(u)):(r.data=M.data,r._resolvedData=M._resolvedData),r.component?Ip(w,m,F?F.children:null,u,_):Ip(w,m,x,u,_),q&&F&&F.outlet&&F.outlet.isActivated&&_.canDeactivateChecks.push(new $h(F.outlet.component,M))}else M&&Ep(m,F,_),_.canActivateChecks.push(new Ug(u)),r.component?Ip(w,null,F?F.children:null,u,_):Ip(w,null,x,u,_);return _}function LD(w,m,x){if(typeof x=="function")return x(w,m);switch(x){case"pathParamsChange":return!wd(w.url,m.url);case"pathParamsOrQueryParamsChange":return!wd(w.url,m.url)||!As(w.queryParams,m.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Gb(w,m)||!As(w.queryParams,m.queryParams);case"paramsChange":default:return!Gb(w,m)}}function Ep(w,m,x){let u=Uh(w),_=w.value;Object.entries(u).forEach(([r,M])=>{_.component?m?Ep(M,m.children.getContext(r),x):Ep(M,null,x):Ep(M,m,x)}),_.component?m&&m.outlet&&m.outlet.isActivated?x.canDeactivateChecks.push(new $h(m.outlet.component,_)):x.canDeactivateChecks.push(new $h(null,_)):x.canDeactivateChecks.push(new $h(null,_))}function Gp(w){return typeof w=="function"}function zD(w){return typeof w=="boolean"}function OD(w){return w&&Gp(w.canLoad)}function FD(w){return w&&Gp(w.canActivate)}function BD(w){return w&&Gp(w.canActivateChild)}function ND(w){return w&&Gp(w.canDeactivate)}function jD(w){return w&&Gp(w.canMatch)}function jk(w){return w instanceof u2||w?.name==="EmptyError"}var Ag=Symbol("INITIAL_VALUE");function Wh(){return wo(w=>tg(w.map(m=>m.pipe(Qr(1),ho(Ag)))).pipe(jn(m=>{for(let x of m)if(x!==!0){if(x===Ag)return Ag;if(x===!1||x instanceof sc)return x}return!0}),Pr(m=>m!==Ag),Qr(1)))}function VD(w,m){return ca(x=>{let{targetSnapshot:u,currentSnapshot:_,guards:{canActivateChecks:r,canDeactivateChecks:M}}=x;return M.length===0&&r.length===0?wi(sr(It({},x),{guardsResult:!0})):UD(M,u,_,w).pipe(ca(F=>F&&zD(F)?GD(u,r,w,m):wi(F)),jn(F=>sr(It({},x),{guardsResult:F})))})}function UD(w,m,x,u){return la(w).pipe(ca(_=>WD(_.component,_.route,x,m,u)),ic(_=>_!==!0,!0))}function GD(w,m,x,u){return la(m).pipe(Dh(_=>m2(qD(_.route.parent,u),$D(_.route,u),ZD(w,_.path,x),HD(w,_.route,x))),ic(_=>_!==!0,!0))}function $D(w,m){return w!==null&&m&&m(new Bb(w)),wi(!0)}function qD(w,m){return w!==null&&m&&m(new Ob(w)),wi(!0)}function HD(w,m,x){let u=m.routeConfig?m.routeConfig.canActivate:null;if(!u||u.length===0)return wi(!0);let _=u.map(r=>_d(()=>{let M=Up(m)??x,F=Xh(r,M),q=FD(F)?F.canActivate(m,w):nc(M,()=>F(m,w));return hc(q).pipe(ic())}));return wi(_).pipe(Wh())}function ZD(w,m,x){let u=m[m.length-1],r=m.slice(0,m.length-1).reverse().map(M=>PD(M)).filter(M=>M!==null).map(M=>_d(()=>{let F=M.guards.map(q=>{let re=Up(M.node)??x,me=Xh(q,re),De=BD(me)?me.canActivateChild(u,w):nc(re,()=>me(u,w));return hc(De).pipe(ic())});return wi(F).pipe(Wh())}));return wi(r).pipe(Wh())}function WD(w,m,x,u,_){let r=m&&m.routeConfig?m.routeConfig.canDeactivate:null;if(!r||r.length===0)return wi(!0);let M=r.map(F=>{let q=Up(m)??_,re=Xh(F,q),me=ND(re)?re.canDeactivate(w,m,x,u):nc(q,()=>re(w,m,x,u));return hc(me).pipe(ic())});return wi(M).pipe(Wh())}function XD(w,m,x,u){let _=m.canLoad;if(_===void 0||_.length===0)return wi(!0);let r=_.map(M=>{let F=Xh(M,w),q=OD(F)?F.canLoad(m,x):nc(w,()=>F(m,x));return hc(q)});return wi(r).pipe(Wh(),Vk(u))}function Vk(w){return c2(Rr(m=>{if(Hh(m))throw Fk(w,m)}),jn(m=>m===!0))}function YD(w,m,x,u){let _=m.canMatch;if(!_||_.length===0)return wi(!0);let r=_.map(M=>{let F=Xh(M,w),q=jD(F)?F.canMatch(m,x):nc(w,()=>F(m,x));return hc(q)});return wi(r).pipe(Wh(),Vk(u))}var Fp=class{constructor(m){this.segmentGroup=m||null}},Gg=class extends Error{constructor(m){super(),this.urlTree=m}};function Vh(w){return dp(new Fp(w))}function KD(w){return dp(new Jr(4e3,!1))}function QD(w){return dp(Bk(!1,wa.GuardRejected))}var Hb=class{constructor(m,x){this.urlSerializer=m,this.urlTree=x}lineralizeSegments(m,x){let u=[],_=x.root;for(;;){if(u=u.concat(_.segments),_.numberOfChildren===0)return wi(u);if(_.numberOfChildren>1||!_.children[Vi])return KD(m.redirectTo);_=_.children[Vi]}}applyRedirectCommands(m,x,u){let _=this.applyRedirectCreateUrlTree(x,this.urlSerializer.parse(x),m,u);if(x.startsWith("/"))throw new Gg(_);return _}applyRedirectCreateUrlTree(m,x,u,_){let r=this.createSegmentGroup(m,x.root,u,_);return new sc(r,this.createQueryParams(x.queryParams,this.urlTree.queryParams),x.fragment)}createQueryParams(m,x){let u={};return Object.entries(m).forEach(([_,r])=>{if(typeof r=="string"&&r.startsWith(":")){let F=r.substring(1);u[_]=x[F]}else u[_]=r}),u}createSegmentGroup(m,x,u,_){let r=this.createSegments(m,x.segments,u,_),M={};return Object.entries(x.children).forEach(([F,q])=>{M[F]=this.createSegmentGroup(m,q,u,_)}),new Sn(r,M)}createSegments(m,x,u,_){return x.map(r=>r.path.startsWith(":")?this.findPosParam(m,r,_):this.findOrReturn(r,u))}findPosParam(m,x,u){let _=u[x.path.substring(1)];if(!_)throw new Jr(4001,!1);return _}findOrReturn(m,x){let u=0;for(let _ of x){if(_.path===m.path)return x.splice(u),_;u++}return m}},Zb={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function JD(w,m,x,u,_){let r=ev(w,m,x);return r.matched?(u=MD(m,u),YD(u,m,x,_).pipe(jn(M=>M===!0?r:It({},Zb)))):wi(r)}function ev(w,m,x){if(m.path==="**")return eP(x);if(m.path==="")return m.pathMatch==="full"&&(w.hasChildren()||x.length>0)?It({},Zb):{matched:!0,consumedSegments:[],remainingSegments:x,parameters:{},positionalParamSegments:{}};let _=(m.matcher||XA)(x,w,m);if(!_)return It({},Zb);let r={};Object.entries(_.posParams??{}).forEach(([F,q])=>{r[F]=q.path});let M=_.consumed.length>0?It(It({},r),_.consumed[_.consumed.length-1].parameters):r;return{matched:!0,consumedSegments:_.consumed,remainingSegments:x.slice(_.consumed.length),parameters:M,positionalParamSegments:_.posParams??{}}}function eP(w){return{matched:!0,parameters:w.length>0?vk(w).parameters:{},consumedSegments:w,remainingSegments:[],positionalParamSegments:{}}}function _k(w,m,x,u){return x.length>0&&nP(w,x,u)?{segmentGroup:new Sn(m,iP(u,new Sn(x,w.children))),slicedSegments:[]}:x.length===0&&rP(w,x,u)?{segmentGroup:new Sn(w.segments,tP(w,x,u,w.children)),slicedSegments:x}:{segmentGroup:new Sn(w.segments,w.children),slicedSegments:x}}function tP(w,m,x,u){let _={};for(let r of x)if(Hg(w,m,r)&&!u[Ps(r)]){let M=new Sn([],{});_[Ps(r)]=M}return It(It({},u),_)}function iP(w,m){let x={};x[Vi]=m;for(let u of w)if(u.path===""&&Ps(u)!==Vi){let _=new Sn([],{});x[Ps(u)]=_}return x}function nP(w,m,x){return x.some(u=>Hg(w,m,u)&&Ps(u)!==Vi)}function rP(w,m,x){return x.some(u=>Hg(w,m,u))}function Hg(w,m,x){return(w.hasChildren()||m.length>0)&&x.pathMatch==="full"?!1:x.path===""}function oP(w,m,x,u){return Ps(w)!==u&&(u===Vi||!Hg(m,x,w))?!1:ev(m,w,x).matched}function aP(w,m,x){return m.length===0&&!w.children[x]}var Wb=class{};function sP(w,m,x,u,_,r,M="emptyOnly"){return new Xb(w,m,x,u,_,M,r).recognize()}var lP=31,Xb=class{constructor(m,x,u,_,r,M,F){this.injector=m,this.configLoader=x,this.rootComponentType=u,this.config=_,this.urlTree=r,this.paramsInheritanceStrategy=M,this.urlSerializer=F,this.applyRedirects=new Hb(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(m){return new Jr(4002,`'${m.segmentGroup}'`)}recognize(){let m=_k(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(m).pipe(jn(x=>{let u=new zp([],Object.freeze({}),Object.freeze(It({},this.urlTree.queryParams)),this.urlTree.fragment,{},Vi,this.rootComponentType,null,{}),_=new ua(u,x),r=new Vg("",_),M=pD(u,[],this.urlTree.queryParams,this.urlTree.fragment);return M.queryParams=this.urlTree.queryParams,r.url=this.urlSerializer.serialize(M),this.inheritParamsAndData(r._root,null),{state:r,tree:M}}))}match(m){return this.processSegmentGroup(this.injector,this.config,m,Vi).pipe(Ah(u=>{if(u instanceof Gg)return this.urlTree=u.urlTree,this.match(u.urlTree.root);throw u instanceof Fp?this.noMatchError(u):u}))}inheritParamsAndData(m,x){let u=m.value,_=Kb(u,x,this.paramsInheritanceStrategy);u.params=Object.freeze(_.params),u.data=Object.freeze(_.data),m.children.forEach(r=>this.inheritParamsAndData(r,u))}processSegmentGroup(m,x,u,_){return u.segments.length===0&&u.hasChildren()?this.processChildren(m,x,u):this.processSegment(m,x,u,u.segments,_,!0).pipe(jn(r=>r instanceof ua?[r]:[]))}processChildren(m,x,u){let _=[];for(let r of Object.keys(u.children))r==="primary"?_.unshift(r):_.push(r);return la(_).pipe(Dh(r=>{let M=u.children[r],F=ED(x,r);return this.processSegmentGroup(m,F,M,r)}),y2((r,M)=>(r.push(...M),r)),cb(null),g2(),ca(r=>{if(r===null)return Vh(u);let M=Uk(r);return cP(M),wi(M)}))}processSegment(m,x,u,_,r,M){return la(x).pipe(Dh(F=>this.processSegmentAgainstRoute(F._injector??m,x,F,u,_,r,M).pipe(Ah(q=>{if(q instanceof Fp)return wi(null);throw q}))),ic(F=>!!F),Ah(F=>{if(jk(F))return aP(u,_,r)?wi(new Wb):Vh(u);throw F}))}processSegmentAgainstRoute(m,x,u,_,r,M,F){return oP(u,_,r,M)?u.redirectTo===void 0?this.matchSegmentAgainstRoute(m,_,u,r,M):this.allowRedirects&&F?this.expandSegmentAgainstRouteUsingRedirect(m,_,x,u,r,M):Vh(_):Vh(_)}expandSegmentAgainstRouteUsingRedirect(m,x,u,_,r,M){let{matched:F,consumedSegments:q,positionalParamSegments:re,remainingSegments:me}=ev(x,_,r);if(!F)return Vh(x);_.redirectTo.startsWith("/")&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>lP&&(this.allowRedirects=!1));let De=this.applyRedirects.applyRedirectCommands(q,_.redirectTo,re);return this.applyRedirects.lineralizeSegments(_,De).pipe(ca($e=>this.processSegment(m,u,x,$e.concat(me),M,!1)))}matchSegmentAgainstRoute(m,x,u,_,r){let M=JD(x,u,_,m,this.urlSerializer);return u.path==="**"&&(x.children={}),M.pipe(wo(F=>F.matched?(m=u._injector??m,this.getChildConfig(m,u,_).pipe(wo(({routes:q})=>{let re=u._loadedInjector??m,{consumedSegments:me,remainingSegments:De,parameters:$e}=F,Mt=new zp(me,$e,Object.freeze(It({},this.urlTree.queryParams)),this.urlTree.fragment,hP(u),Ps(u),u.component??u._loadedComponent??null,u,uP(u)),{segmentGroup:Ui,slicedSegments:Hi}=_k(x,me,De,q);if(Hi.length===0&&Ui.hasChildren())return this.processChildren(re,q,Ui).pipe(jn(Yn=>Yn===null?null:new ua(Mt,Yn)));if(q.length===0&&Hi.length===0)return wi(new ua(Mt,[]));let mi=Ps(u)===r;return this.processSegment(re,q,Ui,Hi,mi?Vi:r,!0).pipe(jn(Yn=>new ua(Mt,Yn instanceof ua?[Yn]:[])))}))):Vh(x)))}getChildConfig(m,x,u){return x.children?wi({routes:x.children,injector:m}):x.loadChildren?x._loadedRoutes!==void 0?wi({routes:x._loadedRoutes,injector:x._loadedInjector}):XD(m,x,u,this.urlSerializer).pipe(ca(_=>_?this.configLoader.loadChildren(m,x).pipe(Rr(r=>{x._loadedRoutes=r.routes,x._loadedInjector=r.injector})):QD(x))):wi({routes:[],injector:m})}};function cP(w){w.sort((m,x)=>m.value.outlet===Vi?-1:x.value.outlet===Vi?1:m.value.outlet.localeCompare(x.value.outlet))}function dP(w){let m=w.value.routeConfig;return m&&m.path===""}function Uk(w){let m=[],x=new Set;for(let u of w){if(!dP(u)){m.push(u);continue}let _=m.find(r=>u.value.routeConfig===r.value.routeConfig);_!==void 0?(_.children.push(...u.children),x.add(_)):m.push(u)}for(let u of x){let _=Uk(u.children);m.push(new ua(u.value,_))}return m.filter(u=>!x.has(u))}function hP(w){return w.data||{}}function uP(w){return w.resolve||{}}function mP(w,m,x,u,_,r){return ca(M=>sP(w,m,x,u,M.extractedUrl,_,r).pipe(jn(({state:F,tree:q})=>sr(It({},M),{targetSnapshot:F,urlAfterRedirects:q}))))}function pP(w,m){return ca(x=>{let{targetSnapshot:u,guards:{canActivateChecks:_}}=x;if(!_.length)return wi(x);let r=new Set(_.map(q=>q.route)),M=new Set;for(let q of r)if(!M.has(q))for(let re of Gk(q))M.add(re);let F=0;return la(M).pipe(Dh(q=>r.has(q)?fP(q,u,w,m):(q.data=Kb(q,q.parent,w).resolve,wi(void 0))),Rr(()=>F++),db(1),ca(q=>F===M.size?wi(x):qa))})}function Gk(w){let m=w.children.map(x=>Gk(x)).flat();return[w,...m]}function fP(w,m,x,u){let _=w.routeConfig,r=w._resolve;return _?.title!==void 0&&!zk(_)&&(r[Np]=_.title),_P(r,w,m,u).pipe(jn(M=>(w._resolvedData=M,w.data=Kb(w,w.parent,x).resolve,null)))}function _P(w,m,x,u){let _=Sb(w);if(_.length===0)return wi({});let r={};return la(_).pipe(ca(M=>gP(w[M],m,x,u).pipe(ic(),Rr(F=>{r[M]=F}))),db(1),_2(r),Ah(M=>jk(M)?qa:dp(M)))}function gP(w,m,x,u){let _=Up(m)??u,r=Xh(w,_),M=r.resolve?r.resolve(m,x):nc(_,()=>r(m,x));return hc(M)}function kb(w){return wo(m=>{let x=w(m);return x?la(x).pipe(jn(()=>m)):wi(m)})}var $k=(()=>{let m=class m{buildTitle(u){let _,r=u.root;for(;r!==void 0;)_=this.getResolvedTitleForRoute(r)??_,r=r.children.find(M=>M.outlet===Vi);return _}getResolvedTitleForRoute(u){return u.data[Np]}};m.\u0275fac=function(_){return new(_||m)},m.\u0275prov=Tn({token:m,factory:()=>St(yP),providedIn:"root"});let w=m;return w})(),yP=(()=>{let m=class m extends $k{constructor(u){super(),this.title=u}updateTitle(u){let _=this.buildTitle(u);_!==void 0&&this.title.setTitle(_)}};m.\u0275fac=function(_){return new(_||m)(qi(Z2))},m.\u0275prov=Tn({token:m,factory:m.\u0275fac,providedIn:"root"});let w=m;return w})(),$p=new ci("",{providedIn:"root",factory:()=>({})}),Bp=new ci(""),tv=(()=>{let m=class m{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=St(fg)}loadComponent(u){if(this.componentLoaders.get(u))return this.componentLoaders.get(u);if(u._loadedComponent)return wi(u._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(u);let _=hc(u.loadComponent()).pipe(jn(qk),Rr(M=>{this.onLoadEndListener&&this.onLoadEndListener(u),u._loadedComponent=M}),rg(()=>{this.componentLoaders.delete(u)})),r=new sb(_,()=>new ei).pipe(ab());return this.componentLoaders.set(u,r),r}loadChildren(u,_){if(this.childrenLoaders.get(_))return this.childrenLoaders.get(_);if(_._loadedRoutes)return wi({routes:_._loadedRoutes,injector:_._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(_);let M=bP(_,this.compiler,u,this.onLoadEndListener).pipe(rg(()=>{this.childrenLoaders.delete(_)})),F=new sb(M,()=>new ei).pipe(ab());return this.childrenLoaders.set(_,F),F}};m.\u0275fac=function(_){return new(_||m)},m.\u0275prov=Tn({token:m,factory:m.\u0275fac,providedIn:"root"});let w=m;return w})();function bP(w,m,x,u){return hc(w.loadChildren()).pipe(jn(qk),ca(_=>_ instanceof A2||Array.isArray(_)?wi(_):la(m.compileModuleAsync(_))),jn(_=>{u&&u(w);let r,M,F=!1;return Array.isArray(_)?(M=_,F=!0):(r=_.create(x).injector,M=r.get(Bp,[],{optional:!0,self:!0}).flat()),{routes:M.map(Jb),injector:r}}))}function vP(w){return w&&typeof w=="object"&&"default"in w}function qk(w){return vP(w)?w.default:w}var iv=(()=>{let m=class m{};m.\u0275fac=function(_){return new(_||m)},m.\u0275prov=Tn({token:m,factory:()=>St(xP),providedIn:"root"});let w=m;return w})(),xP=(()=>{let m=class m{shouldProcessUrl(u){return!0}extract(u){return u}merge(u,_){return u}};m.\u0275fac=function(_){return new(_||m)},m.\u0275prov=Tn({token:m,factory:m.\u0275fac,providedIn:"root"});let w=m;return w})(),Hk=new ci(""),Zk=new ci("");function wP(w,m,x){let u=w.get(Zk),_=w.get(vr);return w.get(Dn).runOutsideAngular(()=>{if(!_.startViewTransition||u.skipNextTransition)return u.skipNextTransition=!1,Promise.resolve();let r,M=new Promise(re=>{r=re}),F=_.startViewTransition(()=>(r(),TP(w))),{onViewTransitionCreated:q}=u;return q&&nc(w,()=>q({transition:F,from:m,to:x})),M})}function TP(w){return new Promise(m=>{E2(m,{injector:w})})}var nv=(()=>{let m=class m{get hasRequestedNavigation(){return this.navigationId!==0}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new ei,this.transitionAbortSubject=new ei,this.configLoader=St(tv),this.environmentInjector=St(up),this.urlSerializer=St(jp),this.rootContexts=St(Vp),this.location=St(bd),this.inputBindingEnabled=St(qg,{optional:!0})!==null,this.titleStrategy=St($k),this.options=St($p,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=St(iv),this.createViewTransition=St(Hk,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>wi(void 0),this.rootComponentType=null;let u=r=>this.events.next(new Lb(r)),_=r=>this.events.next(new zb(r));this.configLoader.onLoadEndListener=_,this.configLoader.onLoadStartListener=u}complete(){this.transitions?.complete()}handleNavigationRequest(u){let _=++this.navigationId;this.transitions?.next(sr(It(It({},this.transitions.value),u),{id:_}))}setupNavigations(u,_,r){return this.transitions=new sa({id:0,currentUrlTree:_,currentRawUrl:_,extractedUrl:this.urlHandlingStrategy.extract(_),urlAfterRedirects:this.urlHandlingStrategy.extract(_),rawUrl:_,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:Mp,restoredState:null,currentSnapshot:r.snapshot,targetSnapshot:null,currentRouterState:r,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(Pr(M=>M.id!==0),jn(M=>sr(It({},M),{extractedUrl:this.urlHandlingStrategy.extract(M.rawUrl)})),wo(M=>{this.currentTransition=M;let F=!1,q=!1;return wi(M).pipe(Rr(re=>{this.currentNavigation={id:re.id,initialUrl:re.rawUrl,extractedUrl:re.extractedUrl,trigger:re.source,extras:re.extras,previousNavigation:this.lastSuccessfulNavigation?sr(It({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),wo(re=>{let me=!u.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),De=re.extras.onSameUrlNavigation??u.onSameUrlNavigation;if(!me&&De!=="reload"){let $e="";return this.events.next(new cc(re.id,this.urlSerializer.serialize(re.rawUrl),$e,Og.IgnoredSameUrlNavigation)),re.resolve(null),qa}if(this.urlHandlingStrategy.shouldProcessUrl(re.rawUrl))return wi(re).pipe(wo($e=>{let Mt=this.transitions?.getValue();return this.events.next(new Zh($e.id,this.urlSerializer.serialize($e.extractedUrl),$e.source,$e.restoredState)),Mt!==this.transitions?.getValue()?qa:Promise.resolve($e)}),mP(this.environmentInjector,this.configLoader,this.rootComponentType,u.config,this.urlSerializer,this.paramsInheritanceStrategy),Rr($e=>{M.targetSnapshot=$e.targetSnapshot,M.urlAfterRedirects=$e.urlAfterRedirects,this.currentNavigation=sr(It({},this.currentNavigation),{finalUrl:$e.urlAfterRedirects});let Mt=new Fg($e.id,this.urlSerializer.serialize($e.extractedUrl),this.urlSerializer.serialize($e.urlAfterRedirects),$e.targetSnapshot);this.events.next(Mt)}));if(me&&this.urlHandlingStrategy.shouldProcessUrl(re.currentRawUrl)){let{id:$e,extractedUrl:Mt,source:Ui,restoredState:Hi,extras:mi}=re,Yn=new Zh($e,this.urlSerializer.serialize(Mt),Ui,Hi);this.events.next(Yn);let $r=Rk(this.rootComponentType).snapshot;return this.currentTransition=M=sr(It({},re),{targetSnapshot:$r,urlAfterRedirects:Mt,extras:sr(It({},mi),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=Mt,wi(M)}else{let $e="";return this.events.next(new cc(re.id,this.urlSerializer.serialize(re.extractedUrl),$e,Og.IgnoredByUrlHandlingStrategy)),re.resolve(null),qa}}),Rr(re=>{let me=new Ab(re.id,this.urlSerializer.serialize(re.extractedUrl),this.urlSerializer.serialize(re.urlAfterRedirects),re.targetSnapshot);this.events.next(me)}),jn(re=>(this.currentTransition=M=sr(It({},re),{guards:DD(re.targetSnapshot,re.currentSnapshot,this.rootContexts)}),M)),VD(this.environmentInjector,re=>this.events.next(re)),Rr(re=>{if(M.guardsResult=re.guardsResult,Hh(re.guardsResult))throw Fk(this.urlSerializer,re.guardsResult);let me=new Db(re.id,this.urlSerializer.serialize(re.extractedUrl),this.urlSerializer.serialize(re.urlAfterRedirects),re.targetSnapshot,!!re.guardsResult);this.events.next(me)}),Pr(re=>re.guardsResult?!0:(this.cancelNavigationTransition(re,"",wa.GuardRejected),!1)),kb(re=>{if(re.guards.canActivateChecks.length)return wi(re).pipe(Rr(me=>{let De=new Pb(me.id,this.urlSerializer.serialize(me.extractedUrl),this.urlSerializer.serialize(me.urlAfterRedirects),me.targetSnapshot);this.events.next(De)}),wo(me=>{let De=!1;return wi(me).pipe(pP(this.paramsInheritanceStrategy,this.environmentInjector),Rr({next:()=>De=!0,complete:()=>{De||this.cancelNavigationTransition(me,"",wa.NoDataFromResolver)}}))}),Rr(me=>{let De=new Rb(me.id,this.urlSerializer.serialize(me.extractedUrl),this.urlSerializer.serialize(me.urlAfterRedirects),me.targetSnapshot);this.events.next(De)}))}),kb(re=>{let me=De=>{let $e=[];De.routeConfig?.loadComponent&&!De.routeConfig._loadedComponent&&$e.push(this.configLoader.loadComponent(De.routeConfig).pipe(Rr(Mt=>{De.component=Mt}),jn(()=>{})));for(let Mt of De.children)$e.push(...me(Mt));return $e};return tg(me(re.targetSnapshot.root)).pipe(cb(null),Qr(1))}),kb(()=>this.afterPreactivation()),wo(()=>{let{currentSnapshot:re,targetSnapshot:me}=M,De=this.createViewTransition?.(this.environmentInjector,re.root,me.root);return De?la(De).pipe(jn(()=>M)):wi(M)}),jn(re=>{let me=TD(u.routeReuseStrategy,re.targetSnapshot,re.currentRouterState);return this.currentTransition=M=sr(It({},re),{targetRouterState:me}),this.currentNavigation.targetRouterState=me,M}),Rr(()=>{this.events.next(new Rp)}),AD(this.rootContexts,u.routeReuseStrategy,re=>this.events.next(re),this.inputBindingEnabled),Qr(1),Rr({next:re=>{F=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new Ds(re.id,this.urlSerializer.serialize(re.extractedUrl),this.urlSerializer.serialize(re.urlAfterRedirects))),this.titleStrategy?.updateTitle(re.targetRouterState.snapshot),re.resolve(!0)},complete:()=>{F=!0}}),Fo(this.transitionAbortSubject.pipe(Rr(re=>{throw re}))),rg(()=>{!F&&!q&&this.cancelNavigationTransition(M,"",wa.SupersededByNewNavigation),this.currentNavigation?.id===M.id&&(this.currentNavigation=null)}),Ah(re=>{if(q=!0,Nk(re))this.events.next(new lc(M.id,this.urlSerializer.serialize(M.extractedUrl),re.message,re.cancellationCode)),SD(re)?this.events.next(new Lp(re.url)):M.resolve(!1);else{this.events.next(new Pp(M.id,this.urlSerializer.serialize(M.extractedUrl),re,M.targetSnapshot??void 0));try{M.resolve(u.errorHandler(re))}catch(me){this.options.resolveNavigationPromiseOnError?M.resolve(!1):M.reject(me)}}return qa}))}))}cancelNavigationTransition(u,_,r){let M=new lc(u.id,this.urlSerializer.serialize(u.extractedUrl),_,r);this.events.next(M),u.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){return this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))).toString()!==this.currentTransition?.extractedUrl.toString()&&!this.currentTransition?.extras.skipLocationChange}};m.\u0275fac=function(_){return new(_||m)},m.\u0275prov=Tn({token:m,factory:m.\u0275fac,providedIn:"root"});let w=m;return w})();function kP(w){return w!==Mp}var IP=(()=>{let m=class m{};m.\u0275fac=function(_){return new(_||m)},m.\u0275prov=Tn({token:m,factory:()=>St(SP),providedIn:"root"});let w=m;return w})(),Yb=class{shouldDetach(m){return!1}store(m,x){}shouldAttach(m){return!1}retrieve(m){return null}shouldReuseRoute(m,x){return m.routeConfig===x.routeConfig}},SP=(()=>{let m=class m extends Yb{};m.\u0275fac=(()=>{let u;return function(r){return(u||(u=gd(m)))(r||m)}})(),m.\u0275prov=Tn({token:m,factory:m.\u0275fac,providedIn:"root"});let w=m;return w})(),Wk=(()=>{let m=class m{};m.\u0275fac=function(_){return new(_||m)},m.\u0275prov=Tn({token:m,factory:()=>St(CP),providedIn:"root"});let w=m;return w})(),CP=(()=>{let m=class m extends Wk{constructor(){super(...arguments),this.location=St(bd),this.urlSerializer=St(jp),this.options=St($p,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=St(iv),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new sc,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=Rk(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(u){return this.location.subscribe(_=>{_.type==="popstate"&&u(_.url,_.state)})}handleRouterEvent(u,_){if(u instanceof Zh)this.stateMemento=this.createStateMemento();else if(u instanceof cc)this.rawUrlTree=_.initialUrl;else if(u instanceof Fg){if(this.urlUpdateStrategy==="eager"&&!_.extras.skipLocationChange){let r=this.urlHandlingStrategy.merge(_.finalUrl,_.initialUrl);this.setBrowserUrl(r,_)}}else u instanceof Rp?(this.currentUrlTree=_.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(_.finalUrl,_.initialUrl),this.routerState=_.targetRouterState,this.urlUpdateStrategy==="deferred"&&(_.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,_))):u instanceof lc&&(u.code===wa.GuardRejected||u.code===wa.NoDataFromResolver)?this.restoreHistory(_):u instanceof Pp?this.restoreHistory(_,!0):u instanceof Ds&&(this.lastSuccessfulId=u.id,this.currentPageId=this.browserPageId)}setBrowserUrl(u,_){let r=this.urlSerializer.serialize(u);if(this.location.isCurrentPathEqualTo(r)||_.extras.replaceUrl){let M=this.browserPageId,F=It(It({},_.extras.state),this.generateNgRouterState(_.id,M));this.location.replaceState(r,"",F)}else{let M=It(It({},_.extras.state),this.generateNgRouterState(_.id,this.browserPageId+1));this.location.go(r,"",M)}}restoreHistory(u,_=!1){if(this.canceledNavigationResolution==="computed"){let r=this.browserPageId,M=this.currentPageId-r;M!==0?this.location.historyGo(M):this.currentUrlTree===u.finalUrl&&M===0&&(this.resetState(u),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(_&&this.resetState(u),this.resetUrlToCurrentUrlTree())}resetState(u){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,u.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(u,_){return this.canceledNavigationResolution==="computed"?{navigationId:u,\u0275routerPageId:_}:{navigationId:u}}};m.\u0275fac=(()=>{let u;return function(r){return(u||(u=gd(m)))(r||m)}})(),m.\u0275prov=Tn({token:m,factory:m.\u0275fac,providedIn:"root"});let w=m;return w})(),Sp=function(w){return w[w.COMPLETE=0]="COMPLETE",w[w.FAILED=1]="FAILED",w[w.REDIRECTING=2]="REDIRECTING",w}(Sp||{});function Xk(w,m){w.events.pipe(Pr(x=>x instanceof Ds||x instanceof lc||x instanceof Pp||x instanceof cc),jn(x=>x instanceof Ds||x instanceof cc?Sp.COMPLETE:(x instanceof lc?x.code===wa.Redirect||x.code===wa.SupersededByNewNavigation:!1)?Sp.REDIRECTING:Sp.FAILED),Pr(x=>x!==Sp.REDIRECTING),Qr(1)).subscribe(()=>{m()})}function MP(w){throw w}var EP={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},AP={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},ll=(()=>{let m=class m{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.isNgZoneEnabled=!1,this.console=St(N2),this.stateManager=St(Wk),this.options=St($p,{optional:!0})||{},this.pendingTasks=St(D2),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=St(nv),this.urlSerializer=St(jp),this.location=St(bd),this.urlHandlingStrategy=St(iv),this._events=new ei,this.errorHandler=this.options.errorHandler||MP,this.navigated=!1,this.routeReuseStrategy=St(IP),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=St(Bp,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!St(qg,{optional:!0}),this.eventsSubscription=new Vr,this.isNgZoneEnabled=St(Dn)instanceof Dn&&Dn.isInAngularZone(),this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:u=>{this.console.warn(u)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){let u=this.navigationTransitions.events.subscribe(_=>{try{let r=this.navigationTransitions.currentTransition,M=this.navigationTransitions.currentNavigation;if(r!==null&&M!==null){if(this.stateManager.handleRouterEvent(_,M),_ instanceof lc&&_.code!==wa.Redirect&&_.code!==wa.SupersededByNewNavigation)this.navigated=!0;else if(_ instanceof Ds)this.navigated=!0;else if(_ instanceof Lp){let F=this.urlHandlingStrategy.merge(_.url,r.currentRawUrl),q={info:r.extras.info,skipLocationChange:r.extras.skipLocationChange,replaceUrl:this.urlUpdateStrategy==="eager"||kP(r.source)};this.scheduleNavigation(F,Mp,null,q,{resolve:r.resolve,reject:r.reject,promise:r.promise})}}PP(_)&&this._events.next(_)}catch(r){this.navigationTransitions.transitionAbortSubject.next(r)}});this.eventsSubscription.add(u)}resetRootComponentType(u){this.routerState.root.component=u,this.navigationTransitions.rootComponentType=u}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),Mp,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((u,_)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(u,"popstate",_)},0)})}navigateToSyncWithBrowser(u,_,r){let M={replaceUrl:!0},F=r?.navigationId?r:null;if(r){let re=It({},r);delete re.navigationId,delete re.\u0275routerPageId,Object.keys(re).length!==0&&(M.state=re)}let q=this.parseUrl(u);this.scheduleNavigation(q,_,F,M)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(u){this.config=u.map(Jb),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(u,_={}){let{relativeTo:r,queryParams:M,fragment:F,queryParamsHandling:q,preserveFragment:re}=_,me=re?this.currentUrlTree.fragment:F,De=null;switch(q){case"merge":De=It(It({},this.currentUrlTree.queryParams),M);break;case"preserve":De=this.currentUrlTree.queryParams;break;default:De=M||null}De!==null&&(De=this.removeEmptyProps(De));let $e;try{let Mt=r?r.snapshot:this.routerState.snapshot.root;$e=Ek(Mt)}catch{(typeof u[0]!="string"||!u[0].startsWith("/"))&&(u=[]),$e=this.currentUrlTree.root}return Ak($e,u,De,me??null)}navigateByUrl(u,_={skipLocationChange:!1}){let r=Hh(u)?u:this.parseUrl(u),M=this.urlHandlingStrategy.merge(r,this.rawUrlTree);return this.scheduleNavigation(M,Mp,null,_)}navigate(u,_={skipLocationChange:!1}){return DP(u),this.navigateByUrl(this.createUrlTree(u,_),_)}serializeUrl(u){return this.urlSerializer.serialize(u)}parseUrl(u){try{return this.urlSerializer.parse(u)}catch{return this.urlSerializer.parse("/")}}isActive(u,_){let r;if(_===!0?r=It({},EP):_===!1?r=It({},AP):r=_,Hh(u))return hk(this.currentUrlTree,u,r);let M=this.parseUrl(u);return hk(this.currentUrlTree,M,r)}removeEmptyProps(u){return Object.entries(u).reduce((_,[r,M])=>(M!=null&&(_[r]=M),_),{})}scheduleNavigation(u,_,r,M,F){if(this.disposed)return Promise.resolve(!1);let q,re,me;F?(q=F.resolve,re=F.reject,me=F.promise):me=new Promise(($e,Mt)=>{q=$e,re=Mt});let De=this.pendingTasks.add();return Xk(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(De))}),this.navigationTransitions.handleNavigationRequest({source:_,restoredState:r,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:u,extras:M,resolve:q,reject:re,promise:me,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),me.catch($e=>Promise.reject($e))}};m.\u0275fac=function(_){return new(_||m)},m.\u0275prov=Tn({token:m,factory:m.\u0275fac,providedIn:"root"});let w=m;return w})();function DP(w){for(let m=0;m<w.length;m++)if(w[m]==null)throw new Jr(4008,!1)}function PP(w){return!(w instanceof Rp)&&!(w instanceof Lp)}var Yk=(()=>{let m=class m{constructor(u,_,r,M,F,q){this.router=u,this.route=_,this.tabIndexAttribute=r,this.renderer=M,this.el=F,this.locationStrategy=q,this.href=null,this.commands=null,this.onChanges=new ei,this.preserveFragment=!1,this.skipLocationChange=!1,this.replaceUrl=!1;let re=F.nativeElement.tagName?.toLowerCase();this.isAnchorElement=re==="a"||re==="area",this.isAnchorElement?this.subscription=u.events.subscribe(me=>{me instanceof Ds&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(u){this.tabIndexAttribute!=null||this.isAnchorElement||this.applyAttributeValue("tabindex",u)}ngOnChanges(u){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(u){u!=null?(this.commands=Array.isArray(u)?u:[u],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(u,_,r,M,F){let q=this.urlTree;if(q===null||this.isAnchorElement&&(u!==0||_||r||M||F||typeof this.target=="string"&&this.target!="_self"))return!0;let re={skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info};return this.router.navigateByUrl(q,re),!this.isAnchorElement}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){let u=this.urlTree;this.href=u!==null&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(u)):null;let _=this.href===null?null:I2(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",_)}applyAttributeValue(u,_){let r=this.renderer,M=this.el.nativeElement;_!==null?r.setAttribute(M,u,_):r.removeAttribute(M,u)}get urlTree(){return this.commands===null?null:this.router.createUrlTree(this.commands,{relativeTo:this.relativeTo!==void 0?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}};m.\u0275fac=function(_){return new(_||m)(Xe(ll),Xe(dc),hp("tabindex"),Xe(C2),Xe(zn),Xe(bp))},m.\u0275dir=fn({type:m,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(_,r){_&1&&$t("click",function(F){return r.onClick(F.button,F.ctrlKey,F.shiftKey,F.altKey,F.metaKey)}),_&2&&cr("target",r.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[ti.HasDecoratorInputTransform,"preserveFragment","preserveFragment",gn],skipLocationChange:[ti.HasDecoratorInputTransform,"skipLocationChange","skipLocationChange",gn],replaceUrl:[ti.HasDecoratorInputTransform,"replaceUrl","replaceUrl",gn],routerLink:"routerLink"},standalone:!0,features:[nr,lr]});let w=m;return w})();var $g=class{};var RP=(()=>{let m=class m{constructor(u,_,r,M,F){this.router=u,this.injector=r,this.preloadingStrategy=M,this.loader=F}setUpPreloading(){this.subscription=this.router.events.pipe(Pr(u=>u instanceof Ds),Dh(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(u,_){let r=[];for(let M of _){M.providers&&!M._injector&&(M._injector=mb(M.providers,u,`Route: ${M.path}`));let F=M._injector??u,q=M._loadedInjector??F;(M.loadChildren&&!M._loadedRoutes&&M.canLoad===void 0||M.loadComponent&&!M._loadedComponent)&&r.push(this.preloadConfig(F,M)),(M.children||M._loadedRoutes)&&r.push(this.processRoutes(q,M.children??M._loadedRoutes))}return la(r).pipe(lb())}preloadConfig(u,_){return this.preloadingStrategy.preload(_,()=>{let r;_.loadChildren&&_.canLoad===void 0?r=this.loader.loadChildren(u,_):r=wi(null);let M=r.pipe(ca(F=>F===null?wi(void 0):(_._loadedRoutes=F.routes,_._loadedInjector=F.injector,this.processRoutes(F.injector??u,F.routes))));if(_.loadComponent&&!_._loadedComponent){let F=this.loader.loadComponent(_);return la([M,F]).pipe(lb())}else return M})}};m.\u0275fac=function(_){return new(_||m)(qi(ll),qi(fg),qi(up),qi($g),qi(tv))},m.\u0275prov=Tn({token:m,factory:m.\u0275fac,providedIn:"root"});let w=m;return w})(),Kk=new ci(""),LP=(()=>{let m=class m{constructor(u,_,r,M,F={}){this.urlSerializer=u,this.transitions=_,this.viewportScroller=r,this.zone=M,this.options=F,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},F.scrollPositionRestoration||="disabled",F.anchorScrolling||="disabled"}init(){this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(u=>{u instanceof Zh?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=u.navigationTrigger,this.restoredId=u.restoredState?u.restoredState.navigationId:0):u instanceof Ds?(this.lastId=u.id,this.scheduleScrollEvent(u,this.urlSerializer.parse(u.urlAfterRedirects).fragment)):u instanceof cc&&u.code===Og.IgnoredSameUrlNavigation&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(u,this.urlSerializer.parse(u.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(u=>{u instanceof Bg&&(u.position?this.options.scrollPositionRestoration==="top"?this.viewportScroller.scrollToPosition([0,0]):this.options.scrollPositionRestoration==="enabled"&&this.viewportScroller.scrollToPosition(u.position):u.anchor&&this.options.anchorScrolling==="enabled"?this.viewportScroller.scrollToAnchor(u.anchor):this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(u,_){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new Bg(u,this.lastSource==="popstate"?this.store[this.restoredId]:null,_))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}};m.\u0275fac=function(_){dg()},m.\u0275prov=Tn({token:m,factory:m.\u0275fac});let w=m;return w})();function Qk(w,...m){return sg([{provide:Bp,multi:!0,useValue:w},[],{provide:dc,useFactory:Jk,deps:[ll]},{provide:fb,multi:!0,useFactory:eI},m.map(x=>x.\u0275providers)])}function Jk(w){return w.routerState.root}function qp(w,m){return{\u0275kind:w,\u0275providers:m}}function eI(){let w=St(uo);return m=>{let x=w.get(_b);if(m!==x.components[0])return;let u=w.get(ll),_=w.get(tI);w.get(rv)===1&&u.initialNavigation(),w.get(iI,null,hb.Optional)?.setUpPreloading(),w.get(Kk,null,hb.Optional)?.init(),u.resetRootComponentType(x.componentTypes[0]),_.closed||(_.next(),_.complete(),_.unsubscribe())}}var tI=new ci("",{factory:()=>new ei}),rv=new ci("",{providedIn:"root",factory:()=>1});function zP(){return qp(2,[{provide:rv,useValue:0},{provide:pb,multi:!0,deps:[uo],useFactory:m=>{let x=m.get(V2,Promise.resolve());return()=>x.then(()=>new Promise(u=>{let _=m.get(ll),r=m.get(tI);Xk(_,()=>{u(!0)}),m.get(nv).afterPreactivation=()=>(u(!0),r.closed?wi(void 0):r),_.initialNavigation()}))}}])}function OP(){return qp(3,[{provide:pb,multi:!0,useFactory:()=>{let m=St(ll);return()=>{m.setUpLocationChangeListener()}}},{provide:rv,useValue:2}])}var iI=new ci("");function FP(w){return qp(0,[{provide:iI,useExisting:RP},{provide:$g,useExisting:w}])}function BP(){return qp(8,[fk,{provide:qg,useExisting:fk}])}function NP(w){let m=[{provide:Hk,useValue:wP},{provide:Zk,useValue:It({skipNextTransition:!!w?.skipInitialTransition},w)}];return qp(9,m)}var gk=new ci("ROUTER_FORROOT_GUARD"),jP=[bd,{provide:jp,useClass:Ap},ll,Vp,{provide:dc,useFactory:Jk,deps:[ll]},tv,[]],nI=(()=>{let m=class m{constructor(u){}static forRoot(u,_){return{ngModule:m,providers:[jP,[],{provide:Bp,multi:!0,useValue:u},{provide:gk,useFactory:$P,deps:[[ll,new x2,new w2]]},{provide:$p,useValue:_||{}},_?.useHash?UP():GP(),VP(),_?.preloadingStrategy?FP(_.preloadingStrategy).\u0275providers:[],_?.initialNavigation?qP(_):[],_?.bindToComponentInputs?BP().\u0275providers:[],_?.enableViewTransitions?NP().\u0275providers:[],HP()]}}static forChild(u){return{ngModule:m,providers:[{provide:Bp,multi:!0,useValue:u}]}}};m.\u0275fac=function(_){return new(_||m)(qi(gk,8))},m.\u0275mod=Un({type:m}),m.\u0275inj=Vn({});let w=m;return w})();function VP(){return{provide:Kk,useFactory:()=>{let w=St($2),m=St(Dn),x=St($p),u=St(nv),_=St(jp);return x.scrollOffset&&w.setOffset(x.scrollOffset),new LP(_,u,w,m,x)}}}function UP(){return{provide:bp,useClass:G2}}function GP(){return{provide:bp,useClass:U2}}function $P(w){return"guarded"}function qP(w){return[w.initialNavigation==="disabled"?OP().\u0275providers:[],w.initialNavigation==="enabledBlocking"?zP().\u0275providers:[]]}var yk=new ci("");function HP(){return[{provide:yk,useFactory:eI},{provide:fb,multi:!0,useExisting:yk}]}var rI=[];var WP="@",XP=(()=>{let m=class m{constructor(u,_,r,M,F){this.doc=u,this.delegate=_,this.zone=r,this.animationType=M,this.moduleImpl=F,this._rendererFactoryPromise=null,this.scheduler=St(S2,{optional:!0})}ngOnDestroy(){this._engine?.flush()}loadImpl(){return(this.moduleImpl??import("./chunk-54A2FKAL.js")).catch(_=>{throw new Jr(5300,!1)}).then(({\u0275createEngine:_,\u0275AnimationRendererFactory:r})=>{this._engine=_(this.animationType,this.doc,this.scheduler);let M=new r(this.delegate,this._engine,this.zone);return this.delegate=M,M})}createRenderer(u,_){let r=this.delegate.createRenderer(u,_);if(r.\u0275type===0)return r;typeof r.throwOnSyntheticProps=="boolean"&&(r.throwOnSyntheticProps=!1);let M=new ov(r);return _?.data?.animation&&!this._rendererFactoryPromise&&(this._rendererFactoryPromise=this.loadImpl()),this._rendererFactoryPromise?.then(F=>{let q=F.createRenderer(u,_);M.use(q)}).catch(F=>{M.use(r)}),M}begin(){this.delegate.begin?.()}end(){this.delegate.end?.()}whenRenderingDone(){return this.delegate.whenRenderingDone?.()??Promise.resolve()}};m.\u0275fac=function(_){dg()},m.\u0275prov=Tn({token:m,factory:m.\u0275fac});let w=m;return w})(),ov=class{constructor(m){this.delegate=m,this.replay=[],this.\u0275type=1}use(m){if(this.delegate=m,this.replay!==null){for(let x of this.replay)x(m);this.replay=null}}get data(){return this.delegate.data}destroy(){this.replay=null,this.delegate.destroy()}createElement(m,x){return this.delegate.createElement(m,x)}createComment(m){return this.delegate.createComment(m)}createText(m){return this.delegate.createText(m)}get destroyNode(){return this.delegate.destroyNode}appendChild(m,x){this.delegate.appendChild(m,x)}insertBefore(m,x,u,_){this.delegate.insertBefore(m,x,u,_)}removeChild(m,x,u){this.delegate.removeChild(m,x,u)}selectRootElement(m,x){return this.delegate.selectRootElement(m,x)}parentNode(m){return this.delegate.parentNode(m)}nextSibling(m){return this.delegate.nextSibling(m)}setAttribute(m,x,u,_){this.delegate.setAttribute(m,x,u,_)}removeAttribute(m,x,u){this.delegate.removeAttribute(m,x,u)}addClass(m,x){this.delegate.addClass(m,x)}removeClass(m,x){this.delegate.removeClass(m,x)}setStyle(m,x,u,_){this.delegate.setStyle(m,x,u,_)}removeStyle(m,x,u){this.delegate.removeStyle(m,x,u)}setProperty(m,x,u){this.shouldReplay(x)&&this.replay.push(_=>_.setProperty(m,x,u)),this.delegate.setProperty(m,x,u)}setValue(m,x){this.delegate.setValue(m,x)}listen(m,x,u){return this.shouldReplay(x)&&this.replay.push(_=>_.listen(m,x,u)),this.delegate.listen(m,x,u)}shouldReplay(m){return this.replay!==null&&m.startsWith(WP)}};function oI(w="animations"){return sg([{provide:lg,useFactory:(m,x,u)=>new XP(m,x,u,w),deps:[vr,q2,Dn]},{provide:mo,useValue:w==="noop"?"NoopAnimations":"BrowserAnimations"}])}var aI={providers:[Qk(rI),oI()]};var YP=["*"];var KP=[[["","mat-card-avatar",""],["","matCardAvatar",""]],[["mat-card-title"],["mat-card-subtitle"],["","mat-card-title",""],["","mat-card-subtitle",""],["","matCardTitle",""],["","matCardSubtitle",""]],"*"],QP=["[mat-card-avatar], [matCardAvatar]",`mat-card-title, mat-card-subtitle,
      [mat-card-title], [mat-card-subtitle],
      [matCardTitle], [matCardSubtitle]`,"*"],JP=new ci("MAT_CARD_CONFIG"),Yh=(()=>{let m=class m{constructor(u){this.appearance=u?.appearance||"raised"}};m.\u0275fac=function(_){return new(_||m)(Xe(JP,8))},m.\u0275cmp=hi({type:m,selectors:[["mat-card"]],hostAttrs:[1,"mat-mdc-card","mdc-card"],hostVars:4,hostBindings:function(_,r){_&2&&_n("mat-mdc-card-outlined",r.appearance==="outlined")("mdc-card--outlined",r.appearance==="outlined")},inputs:{appearance:"appearance"},exportAs:["matCard"],standalone:!0,features:[ui],ngContentSelectors:YP,decls:1,vars:0,template:function(_,r){_&1&&(pr(),kn(0))},styles:['.mdc-card{display:flex;flex-direction:column;box-sizing:border-box}.mdc-card::after{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:1px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none;pointer-events:none}@media screen and (forced-colors: active){.mdc-card::after{border-color:CanvasText}}.mdc-card--outlined::after{border:none}.mdc-card__content{border-radius:inherit;height:100%}.mdc-card__media{position:relative;box-sizing:border-box;background-repeat:no-repeat;background-position:center;background-size:cover}.mdc-card__media::before{display:block;content:""}.mdc-card__media:first-child{border-top-left-radius:inherit;border-top-right-radius:inherit}.mdc-card__media:last-child{border-bottom-left-radius:inherit;border-bottom-right-radius:inherit}.mdc-card__media--square::before{margin-top:100%}.mdc-card__media--16-9::before{margin-top:56.25%}.mdc-card__media-content{position:absolute;top:0;right:0;bottom:0;left:0;box-sizing:border-box}.mdc-card__primary-action{display:flex;flex-direction:column;box-sizing:border-box;position:relative;outline:none;color:inherit;text-decoration:none;cursor:pointer;overflow:hidden}.mdc-card__primary-action:first-child{border-top-left-radius:inherit;border-top-right-radius:inherit}.mdc-card__primary-action:last-child{border-bottom-left-radius:inherit;border-bottom-right-radius:inherit}.mdc-card__actions{display:flex;flex-direction:row;align-items:center;box-sizing:border-box;min-height:52px;padding:8px}.mdc-card__actions--full-bleed{padding:0}.mdc-card__action-buttons,.mdc-card__action-icons{display:flex;flex-direction:row;align-items:center;box-sizing:border-box}.mdc-card__action-icons{color:rgba(0, 0, 0, 0.6);flex-grow:1;justify-content:flex-end}.mdc-card__action-buttons+.mdc-card__action-icons{margin-left:16px;margin-right:0}[dir=rtl] .mdc-card__action-buttons+.mdc-card__action-icons,.mdc-card__action-buttons+.mdc-card__action-icons[dir=rtl]{margin-left:0;margin-right:16px}.mdc-card__action{display:inline-flex;flex-direction:row;align-items:center;box-sizing:border-box;justify-content:center;cursor:pointer;user-select:none}.mdc-card__action:focus{outline:none}.mdc-card__action--button{margin-left:0;margin-right:8px;padding:0 8px}[dir=rtl] .mdc-card__action--button,.mdc-card__action--button[dir=rtl]{margin-left:8px;margin-right:0}.mdc-card__action--button:last-child{margin-left:0;margin-right:0}[dir=rtl] .mdc-card__action--button:last-child,.mdc-card__action--button:last-child[dir=rtl]{margin-left:0;margin-right:0}.mdc-card__actions--full-bleed .mdc-card__action--button{justify-content:space-between;width:100%;height:auto;max-height:none;margin:0;padding:8px 16px;text-align:left}[dir=rtl] .mdc-card__actions--full-bleed .mdc-card__action--button,.mdc-card__actions--full-bleed .mdc-card__action--button[dir=rtl]{text-align:right}.mdc-card__action--icon{margin:-6px 0;padding:12px}.mdc-card__action--icon:not(:disabled){color:rgba(0, 0, 0, 0.6)}.mat-mdc-card{border-radius:var(--mdc-elevated-card-container-shape);background-color:var(--mdc-elevated-card-container-color);border-width:0;border-style:solid;border-color:var(--mdc-elevated-card-container-color);box-shadow:var(--mdc-elevated-card-container-elevation)}.mat-mdc-card .mdc-card::after{border-radius:var(--mdc-elevated-card-container-shape)}.mat-mdc-card-outlined{border-width:var(--mdc-outlined-card-outline-width);border-style:solid;border-color:var(--mdc-outlined-card-outline-color);border-radius:var(--mdc-outlined-card-container-shape);background-color:var(--mdc-outlined-card-container-color);box-shadow:var(--mdc-outlined-card-container-elevation)}.mat-mdc-card-outlined .mdc-card::after{border-radius:var(--mdc-outlined-card-container-shape)}.mat-mdc-card-title{font-family:var(--mat-card-title-text-font);line-height:var(--mat-card-title-text-line-height);font-size:var(--mat-card-title-text-size);letter-spacing:var(--mat-card-title-text-tracking);font-weight:var(--mat-card-title-text-weight)}.mat-mdc-card-subtitle{color:var(--mat-card-subtitle-text-color);font-family:var(--mat-card-subtitle-text-font);line-height:var(--mat-card-subtitle-text-line-height);font-size:var(--mat-card-subtitle-text-size);letter-spacing:var(--mat-card-subtitle-text-tracking);font-weight:var(--mat-card-subtitle-text-weight)}.mat-mdc-card{position:relative}.mat-mdc-card-title,.mat-mdc-card-subtitle{display:block;margin:0}.mat-mdc-card-avatar~.mat-mdc-card-header-text .mat-mdc-card-title,.mat-mdc-card-avatar~.mat-mdc-card-header-text .mat-mdc-card-subtitle{padding:16px 16px 0}.mat-mdc-card-header{display:flex;padding:16px 16px 0}.mat-mdc-card-content{display:block;padding:0 16px}.mat-mdc-card-content:first-child{padding-top:16px}.mat-mdc-card-content:last-child{padding-bottom:16px}.mat-mdc-card-title-group{display:flex;justify-content:space-between;width:100%}.mat-mdc-card-avatar{height:40px;width:40px;border-radius:50%;flex-shrink:0;margin-bottom:16px;object-fit:cover}.mat-mdc-card-avatar~.mat-mdc-card-header-text .mat-mdc-card-subtitle,.mat-mdc-card-avatar~.mat-mdc-card-header-text .mat-mdc-card-title{line-height:normal}.mat-mdc-card-sm-image{width:80px;height:80px}.mat-mdc-card-md-image{width:112px;height:112px}.mat-mdc-card-lg-image{width:152px;height:152px}.mat-mdc-card-xl-image{width:240px;height:240px}.mat-mdc-card-subtitle~.mat-mdc-card-title,.mat-mdc-card-title~.mat-mdc-card-subtitle,.mat-mdc-card-header .mat-mdc-card-header-text .mat-mdc-card-title,.mat-mdc-card-header .mat-mdc-card-header-text .mat-mdc-card-subtitle,.mat-mdc-card-title-group .mat-mdc-card-title,.mat-mdc-card-title-group .mat-mdc-card-subtitle{padding-top:0}.mat-mdc-card-content>:last-child:not(.mat-mdc-card-footer){margin-bottom:0}.mat-mdc-card-actions-align-end{justify-content:flex-end}'],encapsulation:2,changeDetection:0});let w=m;return w})();var sI=(()=>{let m=class m{};m.\u0275fac=function(_){return new(_||m)},m.\u0275dir=fn({type:m,selectors:[["mat-card-content"]],hostAttrs:[1,"mat-mdc-card-content"],standalone:!0});let w=m;return w})();var lI=(()=>{let m=class m{};m.\u0275fac=function(_){return new(_||m)},m.\u0275cmp=hi({type:m,selectors:[["mat-card-header"]],hostAttrs:[1,"mat-mdc-card-header"],standalone:!0,features:[ui],ngContentSelectors:QP,decls:4,vars:0,consts:[[1,"mat-mdc-card-header-text"]],template:function(_,r){_&1&&(pr(KP),kn(0),Ue(1,"div",0),kn(2,1),Ge(),kn(3,2))},encapsulation:2,changeDetection:0});let w=m;return w})();var Kh=(()=>{let m=class m{};m.\u0275fac=function(_){return new(_||m)},m.\u0275mod=Un({type:m}),m.\u0275inj=Vn({imports:[qn,In,qn]});let w=m;return w})();function eR(w,m){if(w&1&&(Ue(0,"span"),Bt(1),Ge()),w&2){let x=Dt();Ze(),hn(x.title)}}function tR(w,m){w&1&&(Ue(0,"div",6),Bt(1,"\xA0"),Ge())}function iR(w,m){if(w&1&&(Ue(0,"mat-option",8),Bt(1),Ge()),w&2){let x=m.$implicit;Ct("value",x),Ze(),hn(x.name)}}function nR(w,m){if(w&1){let x=dn();Ue(0,"mat-select",7),$t("ngModelChange",function(_){Xi(x);let r=Dt();return Yi(r.currentProject=_)})("selectionChange",function(){Xi(x);let _=Dt();return Yi(_.projectSelectionChanged.emit(_.currentProject))}),Lr(1,iR,2,2,"mat-option",8,mp),Ge()}if(w&2){let x=Dt();Ct("ngModel",x.currentProject),Ze(),zr(x.projects)}}var cI=(()=>{let m=class m{constructor(){this.logo="./assets/logo.svg",this.title="",this.homePath="/home",this.projectSelectionChanged=new Ut,this.showProjectSelect=!1}ngOnChanges(){this.currentProject!==void 0?this.showProjectSelect=!0:this.showProjectSelect=!1}};m.\u0275fac=function(_){return new(_||m)},m.\u0275cmp=hi({type:m,selectors:[["lib-ng-left-toolbar"]],inputs:{logo:"logo",title:"title",homePath:"homePath",projects:"projects",currentProject:"currentProject"},outputs:{projectSelectionChanged:"projectSelectionChanged"},standalone:!0,features:[lr,ui],decls:6,vars:5,consts:[[1,"card"],[1,"logo",3,"routerLink"],["alt","logo",3,"src"],[4,"ngIf"],["class","vl",4,"ngIf"],["name","space-select","id","space-select",3,"ngModel","ngModelChange","selectionChange",4,"ngIf"],[1,"vl"],["name","space-select","id","space-select",3,"ngModel","ngModelChange","selectionChange"],[3,"value"]],template:function(_,r){_&1&&(Ue(0,"mat-card",0)(1,"div",1),Ki(2,"img",2),bi(3,eR,2,1,"span",3),Ge(),bi(4,tR,2,0,"div",4)(5,nR,3,1,"mat-select",5),Ge()),_&2&&(Ze(),Ct("routerLink",r.homePath),Ze(),Ct("src",r.logo,k2),Ze(),Ct("ngIf",r.title),Ze(),Ct("ngIf",(r.projects==null?null:r.projects.length)&&r.showProjectSelect),Ze(),Ct("ngIf",(r.projects==null?null:r.projects.length)&&r.showProjectSelect))},dependencies:[In,jo,nI,Yk,Kh,Yh,Ms,Cs,Ss,Is,Ts,ks],styles:[".card[_ngcontent-%COMP%]{padding:10px;height:100%;display:flex;flex-direction:row;justify-content:flex-start;align-items:center;gap:10px}.logo[_ngcontent-%COMP%]{height:100%;cursor:pointer;display:flex;flex-direction:row;align-items:center;gap:10px}.logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:100%}.vl[_ngcontent-%COMP%]{border-left-width:1px;border-left-style:solid;border-left-color:#eee;height:100%}mat-select[_ngcontent-%COMP%]{min-width:100px}  .mat-mdc-select-value{padding-right:10px}mat-card[_ngcontent-%COMP%]{z-index:10}"]});let w=m;return w})();var dI={transformMenu:ws("transformMenu",[ko("void",xr({opacity:0,transform:"scale(0.8)"})),Uo("void => enter",Vo("120ms cubic-bezier(0, 0, 0.2, 1)",xr({opacity:1,transform:"scale(1)"}))),Uo("* => void",Vo("100ms 25ms linear",xr({opacity:0})))]),fadeInItems:ws("fadeInItems",[ko("showing",xr({opacity:1})),Uo("void => *",[xr({opacity:0}),Vo("400ms 100ms cubic-bezier(0.55, 0, 0.55, 0.2)")])])},eF=dI.fadeInItems,tF=dI.transformMenu;var rR=new ci("mat-menu-scroll-strategy",{providedIn:"root",factory:()=>{let w=St(ha);return()=>w.scrollStrategies.reposition()}});function oR(w){return()=>w.scrollStrategies.reposition()}var aR={provide:rR,deps:[ha],useFactory:oR};var hI=(()=>{let m=class m{};m.\u0275fac=function(_){return new(_||m)},m.\u0275mod=Un({type:m}),m.\u0275inj=Vn({providers:[aR],imports:[In,Lh,qn,ac,ak,qn]});let w=m;return w})();var uI=(()=>{let m=class m{};m.\u0275fac=function(_){return new(_||m)},m.\u0275mod=Un({type:m}),m.\u0275inj=Vn({imports:[qn,qn]});let w=m;return w})();var mI=(()=>{let m=class m{};m.\u0275fac=function(_){return new(_||m)},m.\u0275mod=Un({type:m}),m.\u0275inj=Vn({imports:[Y2,In,qn,Lh,rk,uI]});let w=m;return w})();var uc=(()=>{let m=class m{constructor(u){this.darkMode=M2(!1),this.document=St(vr),this.renderer=u.createRenderer(null,null),hg(()=>{this.darkMode()?this.renderer.addClass(this.document.body,"dark-theme"):this.renderer.removeClass(this.document.body,"dark-theme")}),this._getOSDarkModeSetting()}_getOSDarkModeSetting(){window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches&&this.darkMode.set(!0)}};m.\u0275fac=function(_){return new(_||m)(qi(lg))},m.\u0275prov=Tn({token:m,factory:m.\u0275fac,providedIn:"root"});let w=m;return w})();function sR(w,m){if(w&1){let x=dn();Ue(0,"button",4),$t("click",function(){Xi(x);let _=Dt();return Yi(_.showContext=!_.showContext)}),Bt(1),Ge()}if(w&2){let x=Dt();_n("superadmin",x.superAdmin),Ze(),rr(" ",x.letter," ")}}function lR(w,m){if(w&1&&(Ue(0,"mat-option",9),Bt(1),Ge()),w&2){let x=m.$implicit;Ct("value",x),Ze(),hn(x)}}function cR(w,m){if(w&1){let x=dn();Ue(0,"button",10),$t("click",function(){let r=Xi(x).$implicit,M=Dt(2);return Yi(M.handleMenuItemClick(r))}),Ue(1,"mat-icon"),Bt(2),Ge(),Bt(3),Ge()}if(w&2){let x=m.$implicit;Ze(2),hn(x.icon),Ze(),rr(" ",x.label," ")}}function dR(w,m){if(w&1){let x=dn();Ue(0,"button",11),$t("click",function(){Xi(x);let _=Dt(2);return Yi(_.signInOut("out"))}),Ue(1,"mat-icon"),Bt(2,"logout"),Ge(),Bt(3),Ge()}if(w&2){let x=Dt(2);Ze(3),rr(" ",x.signOutLabel," ")}}function hR(w,m){if(w&1){let x=dn();Ue(0,"button",11),$t("click",function(){Xi(x);let _=Dt(2);return Yi(_.signInOut("in"))}),Ue(1,"mat-icon"),Bt(2,"login"),Ge(),Bt(3),Ge()}if(w&2){let x=Dt(2);Ze(3),rr(" ",x.signInLabel," ")}}function uR(w,m){if(w&1){let x=dn();Ue(0,"button",11),$t("click",function(){Xi(x);let _=Dt(2);return Yi(_.clickedCreateFromAnonymous.emit())}),Ue(1,"mat-icon"),Bt(2,"person_add"),Ge(),Bt(3),Ge()}if(w&2){let x=Dt(2);Ze(3),rr(" ",x.createUserLabel," ")}}function mR(w,m){if(w&1){let x=dn();Ue(0,"mat-card",5)(1,"mat-form-field")(2,"mat-label"),Bt(3,"Language"),Ge(),Ue(4,"mat-select",6),$t("ngModelChange",function(_){Xi(x);let r=Dt();return Yi(r.language=_)})("selectionChange",function(){Xi(x);let _=Dt();return Yi(_.changedLanguage.emit(_.language))}),Lr(5,lR,2,2,"mat-option",9,mp),Ge()(),Ue(7,"div",7),Lr(8,cR,4,2,"button",12,mp),Ge(),bi(10,dR,4,1,"button",8)(11,hR,4,1,"button",8)(12,uR,4,1,"button",8),Ge()}if(w&2){let x=Dt();Ze(4),Ct("ngModel",x.language),Ze(),zr(x.languageOptions),Ze(3),zr(x.menuItems),Ze(2),Ct("ngIf",x.user&&!x.isAnonymous),Ze(),Ct("ngIf",!x.user||x.isAnonymous),Ze(),Ct("ngIf",x.isAnonymous)}}var pI=["*","*"],_I=(()=>{let m=class m{constructor(){this._themeService=St(uc),this.darkMode=this._themeService.darkMode,this.showProfileMenu=!0,this.language="en",this.languageOptions=["en","da","de"],this.signInLabel="Sign in",this.signOutLabel="Sign out",this.createUserLabel="Create user",this.user=null,this.superAdmin=!0,this.menuItems=[],this.changedLanguage=new Ut,this.updatedUserPreferences=new Ut,this.clickedSignIn=new Ut,this.clickedSignOut=new Ut,this.clickedCreateFromAnonymous=new Ut,this.clickedSignInFromAnonymous=new Ut,this.letter="",this.showContext=!1,this.isAnonymous=!1}ngOnChanges(){if(this.user){if(this.user.authData?.isAnonymous){this.isAnonymous=!0,this.letter="A";return}else this.isAnonymous=!1;this.letter=this.user.displayName[0].toUpperCase(),this.language=this.user.profileData.preferences.language}}toggleDarkMode(){this._themeService.darkMode.set(!this.darkMode())}setLanguage(u){this.showContext=!1,u.stopImmediatePropagation(),u.preventDefault(),this.changedLanguage.emit(this.language)}signInOut(u){if(this.showContext=!1,this.isAnonymous)return this.clickedSignInFromAnonymous.emit();u=="in"?this.clickedSignIn.emit():this.clickedSignOut.emit()}handleMenuItemClick(u){u.click(),this.showContext=!1}};m.\u0275fac=function(_){return new(_||m)},m.\u0275cmp=hi({type:m,selectors:[["lib-ng-right-toolbar"]],inputs:{showProfileMenu:"showProfileMenu",language:"language",languageOptions:"languageOptions",signInLabel:"signInLabel",signOutLabel:"signOutLabel",createUserLabel:"createUserLabel",user:"user",superAdmin:"superAdmin",menuItems:"menuItems"},outputs:{changedLanguage:"changedLanguage",updatedUserPreferences:"updatedUserPreferences",clickedSignIn:"clickedSignIn",clickedSignOut:"clickedSignOut",clickedCreateFromAnonymous:"clickedCreateFromAnonymous",clickedSignInFromAnonymous:"clickedSignInFromAnonymous"},standalone:!0,features:[lr,ui],ngContentSelectors:pI,decls:8,vars:5,consts:[[1,"card"],["mat-icon-button","","aria-label","Toggle dark mode",1,"btn",3,"click"],["mat-mini-fab","","aria-label","Profile","class","btn","color","primary",3,"superadmin","click",4,"ngIf"],["class","context",4,"ngIf"],["mat-mini-fab","","aria-label","Profile","color","primary",1,"btn",3,"click"],[1,"context"],["name","language","id","language-select",3,"ngModel","ngModelChange","selectionChange"],[1,"buttons"],["mat-stroked-button","",3,"click",4,"ngIf"],[3,"value"],["mat-button","",3,"click"],["mat-stroked-button","",3,"click"],["mat-button",""]],template:function(_,r){_&1&&(pr(pI),Ue(0,"mat-card",0),kn(1,0,["#icons",""]),Ue(2,"button",1),$t("click",function(){return r.toggleDarkMode()}),Ue(3,"mat-icon"),Bt(4),Ge()(),kn(5,1,["#iconsAfter",""]),bi(6,sR,2,3,"button",2),Ge(),bi(7,mR,13,4,"mat-card",3)),_&2&&(_n("unfolded",r.showContext),Ze(4),hn(r.darkMode()?"light_mode":"dark_mode"),Ze(2),Ct("ngIf",r.showProfileMenu),Ze(),Ct("ngIf",r.showContext))},dependencies:[In,jo,Is,Ts,ks,Ms,Bh,Fh,Cs,Ss,hI,xa,va,Kh,Yh,qo,Es,Nh,lk,mI],styles:[".card[_ngcontent-%COMP%]{padding:10px;height:100%;display:flex;flex-direction:row;justify-content:flex-end;align-items:center;gap:10px}.card.unfolded[_ngcontent-%COMP%]{border-bottom-left-radius:0;border-bottom-right-radius:0}.context[_ngcontent-%COMP%]{border-top-left-radius:0;border-top-right-radius:0;padding:10px}.btn[_ngcontent-%COMP%]{transform:scale(.7)}#language-select[_ngcontent-%COMP%]{width:100%}.superadmin[_ngcontent-%COMP%]{border:3px solid gold}.buttons[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px;margin-bottom:10px}mat-card[_ngcontent-%COMP%]{z-index:10}"]});let w=m;return w})();var pR=["*"],gI=(()=>{let m=class m{};m.\u0275fac=function(_){return new(_||m)},m.\u0275cmp=hi({type:m,selectors:[["lib-standard-page"]],standalone:!0,features:[ui],ngContentSelectors:pR,decls:3,vars:0,consts:[[1,"container"],[1,"inner-container"]],template:function(_,r){_&1&&(pr(),Ue(0,"div",0)(1,"div",1),kn(2),Ge()())},dependencies:[In],styles:[".container[_ngcontent-%COMP%]{position:absolute;display:flex;flex-direction:row;justify-content:center;inset:120px 20px 0;overflow-y:auto}.inner-container[_ngcontent-%COMP%]{width:60vw;display:flex;flex-direction:column;gap:20px}@media only screen and (max-width: 600px){.inner-container[_ngcontent-%COMP%]{width:calc(100% - 4px)}}"]});let w=m;return w})();function fR(w,m){}var Td=class{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.ariaModal=!0,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.closeOnNavigation=!0,this.closeOnDestroy=!0,this.closeOnOverlayDetachments=!0}};var dv=(()=>{let m=class m extends Tg{constructor(u,_,r,M,F,q,re,me){super(),this._elementRef=u,this._focusTrapFactory=_,this._config=M,this._interactivityChecker=F,this._ngZone=q,this._overlayRef=re,this._focusMonitor=me,this._platform=St(da),this._focusTrap=null,this._elementFocusedBeforeDialogWasOpened=null,this._closeInteractionType=null,this._ariaLabelledByQueue=[],this._changeDetectorRef=St(On),this.attachDomPortal=De=>{this._portalOutlet.hasAttached();let $e=this._portalOutlet.attachDomPortal(De);return this._contentAttached(),$e},this._document=r,this._config.ariaLabelledBy&&this._ariaLabelledByQueue.push(this._config.ariaLabelledBy)}_addAriaLabelledBy(u){this._ariaLabelledByQueue.push(u),this._changeDetectorRef.markForCheck()}_removeAriaLabelledBy(u){let _=this._ariaLabelledByQueue.indexOf(u);_>-1&&(this._ariaLabelledByQueue.splice(_,1),this._changeDetectorRef.markForCheck())}_contentAttached(){this._initializeFocusTrap(),this._handleBackdropClicks(),this._captureInitialFocus()}_captureInitialFocus(){this._trapFocus()}ngOnDestroy(){this._restoreFocus()}attachComponentPortal(u){this._portalOutlet.hasAttached();let _=this._portalOutlet.attachComponentPortal(u);return this._contentAttached(),_}attachTemplatePortal(u){this._portalOutlet.hasAttached();let _=this._portalOutlet.attachTemplatePortal(u);return this._contentAttached(),_}_recaptureFocus(){this._containsFocus()||this._trapFocus()}_forceFocus(u,_){this._interactivityChecker.isFocusable(u)||(u.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{let r=()=>{u.removeEventListener("blur",r),u.removeEventListener("mousedown",r),u.removeAttribute("tabindex")};u.addEventListener("blur",r),u.addEventListener("mousedown",r)})),u.focus(_)}_focusByCssSelector(u,_){let r=this._elementRef.nativeElement.querySelector(u);r&&this._forceFocus(r,_)}_trapFocus(){let u=this._elementRef.nativeElement;switch(this._config.autoFocus){case!1:case"dialog":this._containsFocus()||u.focus();break;case!0:case"first-tabbable":this._focusTrap?.focusInitialElementWhenReady().then(_=>{_||this._focusDialogContainer()});break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this._config.autoFocus);break}}_restoreFocus(){let u=this._config.restoreFocus,_=null;if(typeof u=="string"?_=this._document.querySelector(u):typeof u=="boolean"?_=u?this._elementFocusedBeforeDialogWasOpened:null:u&&(_=u),this._config.restoreFocus&&_&&typeof _.focus=="function"){let r=gg(),M=this._elementRef.nativeElement;(!r||r===this._document.body||r===M||M.contains(r))&&(this._focusMonitor?(this._focusMonitor.focusVia(_,this._closeInteractionType),this._closeInteractionType=null):_.focus())}this._focusTrap&&this._focusTrap.destroy()}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){let u=this._elementRef.nativeElement,_=gg();return u===_||u.contains(_)}_initializeFocusTrap(){this._platform.isBrowser&&(this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._document&&(this._elementFocusedBeforeDialogWasOpened=gg()))}_handleBackdropClicks(){this._overlayRef.backdropClick().subscribe(()=>{this._config.disableClose&&this._recaptureFocus()})}};m.\u0275fac=function(_){return new(_||m)(Xe(zn),Xe(vg),Xe(vr,8),Xe(Td),Xe(bg),Xe(Dn),Xe(Oh),Xe(Rh))},m.\u0275cmp=hi({type:m,selectors:[["cdk-dialog-container"]],viewQuery:function(_,r){if(_&1&&Fn($o,7),_&2){let M;Ni(M=ji())&&(r._portalOutlet=M.first)}},hostAttrs:["tabindex","-1",1,"cdk-dialog-container"],hostVars:6,hostBindings:function(_,r){_&2&&cr("id",r._config.id||null)("role",r._config.role)("aria-modal",r._config.ariaModal)("aria-labelledby",r._config.ariaLabel?null:r._ariaLabelledByQueue[0])("aria-label",r._config.ariaLabel)("aria-describedby",r._config.ariaDescribedBy||null)},standalone:!0,features:[po,ui],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(_,r){_&1&&bi(0,fR,0,0,"ng-template",0)},dependencies:[$o],styles:[".cdk-dialog-container{display:block;width:100%;height:100%;min-height:inherit;max-height:inherit}"],encapsulation:2});let w=m;return w})(),Wp=class{constructor(m,x){this.overlayRef=m,this.config=x,this.closed=new ei,this.disableClose=x.disableClose,this.backdropClick=m.backdropClick(),this.keydownEvents=m.keydownEvents(),this.outsidePointerEvents=m.outsidePointerEvents(),this.id=x.id,this.keydownEvents.subscribe(u=>{u.keyCode===27&&!this.disableClose&&!rc(u)&&(u.preventDefault(),this.close(void 0,{focusOrigin:"keyboard"}))}),this.backdropClick.subscribe(()=>{this.disableClose||this.close(void 0,{focusOrigin:"mouse"})}),this._detachSubscription=m.detachments().subscribe(()=>{x.closeOnOverlayDetachments!==!1&&this.close()})}close(m,x){if(this.containerInstance){let u=this.closed;this.containerInstance._closeInteractionType=x?.focusOrigin||"program",this._detachSubscription.unsubscribe(),this.overlayRef.dispose(),u.next(m),u.complete(),this.componentInstance=this.containerInstance=null}}updatePosition(){return this.overlayRef.updatePosition(),this}updateSize(m="",x=""){return this.overlayRef.updateSize({width:m,height:x}),this}addPanelClass(m){return this.overlayRef.addPanelClass(m),this}removePanelClass(m){return this.overlayRef.removePanelClass(m),this}},_R=new ci("DialogScrollStrategy",{providedIn:"root",factory:()=>{let w=St(ha);return()=>w.scrollStrategies.block()}}),gR=new ci("DialogData"),yR=new ci("DefaultDialogConfig");var bR=0,hv=(()=>{let m=class m{get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}constructor(u,_,r,M,F,q){this._overlay=u,this._injector=_,this._defaultOptions=r,this._parentDialog=M,this._overlayContainer=F,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new ei,this._afterOpenedAtThisLevel=new ei,this._ariaHiddenElements=new Map,this.afterAllClosed=_d(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(ho(void 0))),this._scrollStrategy=q}open(u,_){let r=this._defaultOptions||new Td;_=It(It({},r),_),_.id=_.id||`cdk-dialog-${bR++}`,_.id&&this.getDialogById(_.id);let M=this._getOverlayConfig(_),F=this._overlay.create(M),q=new Wp(F,_),re=this._attachContainer(F,q,_);return q.containerInstance=re,this._attachDialogContent(u,q,re,_),this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(q),q.closed.subscribe(()=>this._removeOpenDialog(q,!0)),this.afterOpened.next(q),q}closeAll(){sv(this.openDialogs,u=>u.close())}getDialogById(u){return this.openDialogs.find(_=>_.id===u)}ngOnDestroy(){sv(this._openDialogsAtThisLevel,u=>{u.config.closeOnDestroy===!1&&this._removeOpenDialog(u,!1)}),sv(this._openDialogsAtThisLevel,u=>u.close()),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete(),this._openDialogsAtThisLevel=[]}_getOverlayConfig(u){let _=new Tp({positionStrategy:u.positionStrategy||this._overlay.position().global().centerHorizontally().centerVertically(),scrollStrategy:u.scrollStrategy||this._scrollStrategy(),panelClass:u.panelClass,hasBackdrop:u.hasBackdrop,direction:u.direction,minWidth:u.minWidth,minHeight:u.minHeight,maxWidth:u.maxWidth,maxHeight:u.maxHeight,width:u.width,height:u.height,disposeOnNavigation:u.closeOnNavigation});return u.backdropClass&&(_.backdropClass=u.backdropClass),_}_attachContainer(u,_,r){let M=r.injector||r.viewContainerRef?.injector,F=[{provide:Td,useValue:r},{provide:Wp,useValue:_},{provide:Oh,useValue:u}],q;r.container?typeof r.container=="function"?q=r.container:(q=r.container.type,F.push(...r.container.providers(r))):q=dv;let re=new zh(q,r.viewContainerRef,uo.create({parent:M||this._injector,providers:F}),r.componentFactoryResolver);return u.attach(re).instance}_attachDialogContent(u,_,r,M){if(u instanceof To){let F=this._createInjector(M,_,r,void 0),q={$implicit:M.data,dialogRef:_};M.templateContext&&(q=It(It({},q),typeof M.templateContext=="function"?M.templateContext():M.templateContext)),r.attachTemplatePortal(new oc(u,null,q,F))}else{let F=this._createInjector(M,_,r,this._injector),q=r.attachComponentPortal(new zh(u,M.viewContainerRef,F,M.componentFactoryResolver));_.componentRef=q,_.componentInstance=q.instance}}_createInjector(u,_,r,M){let F=u.injector||u.viewContainerRef?.injector,q=[{provide:gR,useValue:u.data},{provide:Wp,useValue:_}];return u.providers&&(typeof u.providers=="function"?q.push(...u.providers(_,u,r)):q.push(...u.providers)),u.direction&&(!F||!F.get(Xa,null,{optional:!0}))&&q.push({provide:Xa,useValue:{value:u.direction,change:wi()}}),uo.create({parent:F||M,providers:q})}_removeOpenDialog(u,_){let r=this.openDialogs.indexOf(u);r>-1&&(this.openDialogs.splice(r,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((M,F)=>{M?F.setAttribute("aria-hidden",M):F.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),_&&this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(){let u=this._overlayContainer.getContainerElement();if(u.parentElement){let _=u.parentElement.children;for(let r=_.length-1;r>-1;r--){let M=_[r];M!==u&&M.nodeName!=="SCRIPT"&&M.nodeName!=="STYLE"&&!M.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(M,M.getAttribute("aria-hidden")),M.setAttribute("aria-hidden","true"))}}}_getAfterAllClosed(){let u=this._parentDialog;return u?u._getAfterAllClosed():this._afterAllClosedAtThisLevel}};m.\u0275fac=function(_){return new(_||m)(qi(ha),qi(uo),qi(yR,8),qi(m,12),qi(kg),qi(_R))},m.\u0275prov=Tn({token:m,factory:m.\u0275fac,providedIn:"root"});let w=m;return w})();function sv(w,m){let x=w.length;for(;x--;)m(w[x])}var bI=(()=>{let m=class m{};m.\u0275fac=function(_){return new(_||m)},m.\u0275mod=Un({type:m}),m.\u0275inj=Vn({providers:[hv],imports:[ac,sl,nk,sl]});let w=m;return w})();function vR(w,m){}var Xp=class{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.ariaModal=!0,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.delayFocusTrap=!0,this.closeOnNavigation=!0}},uv="mdc-dialog--open",vI="mdc-dialog--opening",xI="mdc-dialog--closing",xR=150,wR=75,TR=(()=>{let m=class m extends dv{constructor(u,_,r,M,F,q,re,me,De){super(u,_,r,M,F,q,re,De),this._animationMode=me,this._animationStateChanged=new Ut,this._animationsEnabled=this._animationMode!=="NoopAnimations",this._actionSectionCount=0,this._hostElement=this._elementRef.nativeElement,this._enterAnimationDuration=this._animationsEnabled?TI(this._config.enterAnimationDuration)??xR:0,this._exitAnimationDuration=this._animationsEnabled?TI(this._config.exitAnimationDuration)??wR:0,this._animationTimer=null,this._finishDialogOpen=()=>{this._clearAnimationClasses(),this._openAnimationDone(this._enterAnimationDuration)},this._finishDialogClose=()=>{this._clearAnimationClasses(),this._animationStateChanged.emit({state:"closed",totalTime:this._exitAnimationDuration})}}_contentAttached(){super._contentAttached(),this._startOpenAnimation()}_startOpenAnimation(){this._animationStateChanged.emit({state:"opening",totalTime:this._enterAnimationDuration}),this._animationsEnabled?(this._hostElement.style.setProperty(wI,`${this._enterAnimationDuration}ms`),this._requestAnimationFrame(()=>this._hostElement.classList.add(vI,uv)),this._waitForAnimationToComplete(this._enterAnimationDuration,this._finishDialogOpen)):(this._hostElement.classList.add(uv),Promise.resolve().then(()=>this._finishDialogOpen()))}_startExitAnimation(){this._animationStateChanged.emit({state:"closing",totalTime:this._exitAnimationDuration}),this._hostElement.classList.remove(uv),this._animationsEnabled?(this._hostElement.style.setProperty(wI,`${this._exitAnimationDuration}ms`),this._requestAnimationFrame(()=>this._hostElement.classList.add(xI)),this._waitForAnimationToComplete(this._exitAnimationDuration,this._finishDialogClose)):Promise.resolve().then(()=>this._finishDialogClose())}_updateActionSectionCount(u){this._actionSectionCount+=u,this._changeDetectorRef.markForCheck()}_clearAnimationClasses(){this._hostElement.classList.remove(vI,xI)}_waitForAnimationToComplete(u,_){this._animationTimer!==null&&clearTimeout(this._animationTimer),this._animationTimer=setTimeout(_,u)}_requestAnimationFrame(u){this._ngZone.runOutsideAngular(()=>{typeof requestAnimationFrame=="function"?requestAnimationFrame(u):u()})}_captureInitialFocus(){this._config.delayFocusTrap||this._trapFocus()}_openAnimationDone(u){this._config.delayFocusTrap&&this._trapFocus(),this._animationStateChanged.next({state:"opened",totalTime:u})}ngOnDestroy(){super.ngOnDestroy(),this._animationTimer!==null&&clearTimeout(this._animationTimer)}attachComponentPortal(u){let _=super.attachComponentPortal(u);return _.location.nativeElement.classList.add("mat-mdc-dialog-component-host"),_}};m.\u0275fac=function(_){return new(_||m)(Xe(zn),Xe(vg),Xe(vr,8),Xe(Xp),Xe(bg),Xe(Dn),Xe(Oh),Xe(mo,8),Xe(Rh))},m.\u0275cmp=hi({type:m,selectors:[["mat-dialog-container"]],hostAttrs:["tabindex","-1",1,"mat-mdc-dialog-container","mdc-dialog"],hostVars:10,hostBindings:function(_,r){_&2&&(P2("id",r._config.id),cr("aria-modal",r._config.ariaModal)("role",r._config.role)("aria-labelledby",r._config.ariaLabel?null:r._ariaLabelledByQueue[0])("aria-label",r._config.ariaLabel)("aria-describedby",r._config.ariaDescribedBy||null),_n("_mat-animation-noopable",!r._animationsEnabled)("mat-mdc-dialog-container-with-actions",r._actionSectionCount>0))},standalone:!0,features:[po,ui],decls:3,vars:0,consts:[[1,"mdc-dialog__container"],[1,"mat-mdc-dialog-surface","mdc-dialog__surface"],["cdkPortalOutlet",""]],template:function(_,r){_&1&&(Ue(0,"div",0)(1,"div",1),bi(2,vR,0,0,"ng-template",2),Ge()())},dependencies:[$o],styles:['.mdc-elevation-overlay{position:absolute;border-radius:inherit;pointer-events:none;opacity:var(--mdc-elevation-overlay-opacity, 0);transition:opacity 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-dialog,.mdc-dialog__scrim{position:fixed;top:0;left:0;align-items:center;justify-content:center;box-sizing:border-box;width:100%;height:100%}.mdc-dialog{display:none;z-index:var(--mdc-dialog-z-index, 7)}.mdc-dialog .mdc-dialog__content{padding:20px 24px 20px 24px}.mdc-dialog .mdc-dialog__surface{min-width:280px}@media(max-width: 592px){.mdc-dialog .mdc-dialog__surface{max-width:calc(100vw - 32px)}}@media(min-width: 592px){.mdc-dialog .mdc-dialog__surface{max-width:560px}}.mdc-dialog .mdc-dialog__surface{max-height:calc(100% - 32px)}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-width:none}@media(max-width: 960px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-height:560px;width:560px}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{right:-12px}}@media(max-width: 720px)and (max-width: 672px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{width:calc(100vw - 112px)}}@media(max-width: 720px)and (min-width: 672px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{width:560px}}@media(max-width: 720px)and (max-height: 720px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-height:calc(100vh - 160px)}}@media(max-width: 720px)and (min-height: 720px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-height:560px}}@media(max-width: 720px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{right:-12px}}@media(max-width: 720px)and (max-height: 400px),(max-width: 600px),(min-width: 720px)and (max-height: 400px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{height:100%;max-height:100vh;max-width:100vw;width:100vw;border-radius:0}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{order:-1;left:-12px}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__header{padding:0 16px 9px;justify-content:flex-start}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__title{margin-left:calc(16px - 2 * 12px)}}@media(min-width: 960px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{width:calc(100vw - 400px)}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{right:-12px}}.mdc-dialog.mdc-dialog__scrim--hidden .mdc-dialog__scrim{opacity:0}.mdc-dialog__scrim{opacity:0;z-index:-1}.mdc-dialog__container{display:flex;flex-direction:row;align-items:center;justify-content:space-around;box-sizing:border-box;height:100%;opacity:0;pointer-events:none}.mdc-dialog__surface{position:relative;display:flex;flex-direction:column;flex-grow:0;flex-shrink:0;box-sizing:border-box;max-width:100%;max-height:100%;pointer-events:auto;overflow-y:auto;outline:0;transform:scale(0.8)}.mdc-dialog__surface .mdc-elevation-overlay{width:100%;height:100%;top:0;left:0}[dir=rtl] .mdc-dialog__surface,.mdc-dialog__surface[dir=rtl]{text-align:right}@media screen and (forced-colors: active),(-ms-high-contrast: active){.mdc-dialog__surface{outline:2px solid windowText}}.mdc-dialog__surface::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:2px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}@media screen and (forced-colors: active){.mdc-dialog__surface::before{border-color:CanvasText}}@media screen and (-ms-high-contrast: active),screen and (-ms-high-contrast: none){.mdc-dialog__surface::before{content:none}}.mdc-dialog__title{display:block;margin-top:0;position:relative;flex-shrink:0;box-sizing:border-box;margin:0 0 1px;padding:0 24px 9px}.mdc-dialog__title::before{display:inline-block;width:0;height:40px;content:"";vertical-align:0}[dir=rtl] .mdc-dialog__title,.mdc-dialog__title[dir=rtl]{text-align:right}.mdc-dialog--scrollable .mdc-dialog__title{margin-bottom:1px;padding-bottom:15px}.mdc-dialog--fullscreen .mdc-dialog__header{align-items:baseline;border-bottom:1px solid rgba(0,0,0,0);display:inline-flex;justify-content:space-between;padding:0 24px 9px;z-index:1}@media screen and (forced-colors: active){.mdc-dialog--fullscreen .mdc-dialog__header{border-bottom-color:CanvasText}}.mdc-dialog--fullscreen .mdc-dialog__header .mdc-dialog__close{right:-12px}.mdc-dialog--fullscreen .mdc-dialog__title{margin-bottom:0;padding:0;border-bottom:0}.mdc-dialog--fullscreen.mdc-dialog--scrollable .mdc-dialog__title{border-bottom:0;margin-bottom:0}.mdc-dialog--fullscreen .mdc-dialog__close{top:5px}.mdc-dialog--fullscreen.mdc-dialog--scrollable .mdc-dialog__actions{border-top:1px solid rgba(0,0,0,0)}@media screen and (forced-colors: active){.mdc-dialog--fullscreen.mdc-dialog--scrollable .mdc-dialog__actions{border-top-color:CanvasText}}.mdc-dialog--fullscreen--titleless .mdc-dialog__close{margin-top:4px}.mdc-dialog--fullscreen--titleless.mdc-dialog--scrollable .mdc-dialog__close{margin-top:0}.mdc-dialog__content{flex-grow:1;box-sizing:border-box;margin:0;overflow:auto}.mdc-dialog__content>:first-child{margin-top:0}.mdc-dialog__content>:last-child{margin-bottom:0}.mdc-dialog__title+.mdc-dialog__content,.mdc-dialog__header+.mdc-dialog__content{padding-top:0}.mdc-dialog--scrollable .mdc-dialog__title+.mdc-dialog__content{padding-top:8px;padding-bottom:8px}.mdc-dialog__content .mdc-deprecated-list:first-child:last-child{padding:6px 0 0}.mdc-dialog--scrollable .mdc-dialog__content .mdc-deprecated-list:first-child:last-child{padding:0}.mdc-dialog__actions{display:flex;position:relative;flex-shrink:0;flex-wrap:wrap;align-items:center;justify-content:flex-end;box-sizing:border-box;min-height:52px;margin:0;padding:8px;border-top:1px solid rgba(0,0,0,0)}@media screen and (forced-colors: active){.mdc-dialog__actions{border-top-color:CanvasText}}.mdc-dialog--stacked .mdc-dialog__actions{flex-direction:column;align-items:flex-end}.mdc-dialog__button{margin-left:8px;margin-right:0;max-width:100%;text-align:right}[dir=rtl] .mdc-dialog__button,.mdc-dialog__button[dir=rtl]{margin-left:0;margin-right:8px}.mdc-dialog__button:first-child{margin-left:0;margin-right:0}[dir=rtl] .mdc-dialog__button:first-child,.mdc-dialog__button:first-child[dir=rtl]{margin-left:0;margin-right:0}[dir=rtl] .mdc-dialog__button,.mdc-dialog__button[dir=rtl]{text-align:left}.mdc-dialog--stacked .mdc-dialog__button:not(:first-child){margin-top:12px}.mdc-dialog--open,.mdc-dialog--opening,.mdc-dialog--closing{display:flex}.mdc-dialog--opening .mdc-dialog__scrim{transition:opacity 150ms linear}.mdc-dialog--opening .mdc-dialog__container{transition:opacity 75ms linear,transform 150ms 0ms cubic-bezier(0, 0, 0.2, 1)}.mdc-dialog--closing .mdc-dialog__scrim,.mdc-dialog--closing .mdc-dialog__container{transition:opacity 75ms linear}.mdc-dialog--closing .mdc-dialog__container{transform:none}.mdc-dialog--closing .mdc-dialog__surface{transform:none}.mdc-dialog--open .mdc-dialog__scrim{opacity:1}.mdc-dialog--open .mdc-dialog__container{opacity:1}.mdc-dialog--open .mdc-dialog__surface{transform:none}.mdc-dialog--open.mdc-dialog__surface-scrim--shown .mdc-dialog__surface-scrim{opacity:1}.mdc-dialog--open.mdc-dialog__surface-scrim--hiding .mdc-dialog__surface-scrim{transition:opacity 75ms linear}.mdc-dialog--open.mdc-dialog__surface-scrim--showing .mdc-dialog__surface-scrim{transition:opacity 150ms linear}.mdc-dialog__surface-scrim{display:none;opacity:0;position:absolute;width:100%;height:100%;z-index:1}.mdc-dialog__surface-scrim--shown .mdc-dialog__surface-scrim,.mdc-dialog__surface-scrim--showing .mdc-dialog__surface-scrim,.mdc-dialog__surface-scrim--hiding .mdc-dialog__surface-scrim{display:block}.mdc-dialog-scroll-lock{overflow:hidden}.mdc-dialog--no-content-padding .mdc-dialog__content{padding:0}.mdc-dialog--sheet .mdc-dialog__container .mdc-dialog__close{right:12px;top:9px;position:absolute;z-index:1}.mdc-dialog__scrim--removed{pointer-events:none}.mdc-dialog__scrim--removed .mdc-dialog__scrim,.mdc-dialog__scrim--removed .mdc-dialog__surface-scrim{display:none}.mat-mdc-dialog-content{max-height:65vh}.mat-mdc-dialog-container{position:static;display:block}.mat-mdc-dialog-container,.mat-mdc-dialog-container .mdc-dialog__container,.mat-mdc-dialog-container .mdc-dialog__surface{max-height:inherit;min-height:inherit;min-width:inherit;max-width:inherit}.mat-mdc-dialog-container .mdc-dialog__surface{width:100%;height:100%}.mat-mdc-dialog-component-host{display:contents}.mat-mdc-dialog-container{--mdc-dialog-container-elevation: var(--mdc-dialog-container-elevation-shadow);outline:0}.mat-mdc-dialog-container .mdc-dialog__surface{background-color:var(--mdc-dialog-container-color, white)}.mat-mdc-dialog-container .mdc-dialog__surface{box-shadow:var(--mdc-dialog-container-elevation, 0px 11px 15px -7px rgba(0, 0, 0, 0.2), 0px 24px 38px 3px rgba(0, 0, 0, 0.14), 0px 9px 46px 8px rgba(0, 0, 0, 0.12))}.mat-mdc-dialog-container .mdc-dialog__surface{border-radius:var(--mdc-dialog-container-shape, 4px)}.mat-mdc-dialog-container .mdc-dialog__title{font-family:var(--mdc-dialog-subhead-font, Roboto, sans-serif);line-height:var(--mdc-dialog-subhead-line-height, 1.5rem);font-size:var(--mdc-dialog-subhead-size, 1rem);font-weight:var(--mdc-dialog-subhead-weight, 400);letter-spacing:var(--mdc-dialog-subhead-tracking, 0.03125em)}.mat-mdc-dialog-container .mdc-dialog__title{color:var(--mdc-dialog-subhead-color, rgba(0, 0, 0, 0.87))}.mat-mdc-dialog-container .mdc-dialog__content{font-family:var(--mdc-dialog-supporting-text-font, Roboto, sans-serif);line-height:var(--mdc-dialog-supporting-text-line-height, 1.5rem);font-size:var(--mdc-dialog-supporting-text-size, 1rem);font-weight:var(--mdc-dialog-supporting-text-weight, 400);letter-spacing:var(--mdc-dialog-supporting-text-tracking, 0.03125em)}.mat-mdc-dialog-container .mdc-dialog__content{color:var(--mdc-dialog-supporting-text-color, rgba(0, 0, 0, 0.6))}.mat-mdc-dialog-container .mdc-dialog__container{transition:opacity linear var(--mat-dialog-transition-duration, 0ms)}.mat-mdc-dialog-container .mdc-dialog__surface{transition:transform var(--mat-dialog-transition-duration, 0ms) 0ms cubic-bezier(0, 0, 0.2, 1)}.mat-mdc-dialog-container._mat-animation-noopable .mdc-dialog__container,.mat-mdc-dialog-container._mat-animation-noopable .mdc-dialog__surface{transition:none}.cdk-overlay-pane.mat-mdc-dialog-panel{max-width:var(--mat-dialog-container-max-width, 80vw);min-width:var(--mat-dialog-container-min-width, 0)}@media(max-width: 599px){.cdk-overlay-pane.mat-mdc-dialog-panel{max-width:var(--mat-dialog-container-small-max-width, 80vw)}}.mat-mdc-dialog-title{padding:var(--mat-dialog-headline-padding, 0 24px 9px)}.mat-mdc-dialog-content{display:block}.mat-mdc-dialog-container .mat-mdc-dialog-content{padding:var(--mat-dialog-content-padding, 20px 24px)}.mat-mdc-dialog-container-with-actions .mat-mdc-dialog-content{padding:var(--mat-dialog-with-actions-content-padding, 20px 24px)}.mat-mdc-dialog-container .mat-mdc-dialog-title+.mat-mdc-dialog-content{padding-top:0}.mat-mdc-dialog-actions{padding:var(--mat-dialog-actions-padding, 8px);justify-content:var(--mat-dialog-actions-alignment, start)}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-start,.mat-mdc-dialog-actions[align=start]{justify-content:start}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-center,.mat-mdc-dialog-actions[align=center]{justify-content:center}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-end,.mat-mdc-dialog-actions[align=end]{justify-content:flex-end}.mat-mdc-dialog-actions .mat-button-base+.mat-button-base,.mat-mdc-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:8px}[dir=rtl] .mat-mdc-dialog-actions .mat-button-base+.mat-button-base,[dir=rtl] .mat-mdc-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:0;margin-right:8px}'],encapsulation:2});let w=m;return w})(),wI="--mat-dialog-transition-duration";function TI(w){return w==null?null:typeof w=="number"?w:w.endsWith("ms")?xp(w.substring(0,w.length-2)):w.endsWith("s")?xp(w.substring(0,w.length-1))*1e3:w==="0"?0:null}var Yg=function(w){return w[w.OPEN=0]="OPEN",w[w.CLOSING=1]="CLOSING",w[w.CLOSED=2]="CLOSED",w}(Yg||{}),mv=class{constructor(m,x,u){this._ref=m,this._containerInstance=u,this._afterOpened=new ei,this._beforeClosed=new ei,this._state=Yg.OPEN,this.disableClose=x.disableClose,this.id=m.id,m.addPanelClass("mat-mdc-dialog-panel"),u._animationStateChanged.pipe(Pr(_=>_.state==="opened"),Qr(1)).subscribe(()=>{this._afterOpened.next(),this._afterOpened.complete()}),u._animationStateChanged.pipe(Pr(_=>_.state==="closed"),Qr(1)).subscribe(()=>{clearTimeout(this._closeFallbackTimeout),this._finishDialogClose()}),m.overlayRef.detachments().subscribe(()=>{this._beforeClosed.next(this._result),this._beforeClosed.complete(),this._finishDialogClose()}),Ha(this.backdropClick(),this.keydownEvents().pipe(Pr(_=>_.keyCode===27&&!this.disableClose&&!rc(_)))).subscribe(_=>{this.disableClose||(_.preventDefault(),kR(this,_.type==="keydown"?"keyboard":"mouse"))})}close(m){this._result=m,this._containerInstance._animationStateChanged.pipe(Pr(x=>x.state==="closing"),Qr(1)).subscribe(x=>{this._beforeClosed.next(m),this._beforeClosed.complete(),this._ref.overlayRef.detachBackdrop(),this._closeFallbackTimeout=setTimeout(()=>this._finishDialogClose(),x.totalTime+100)}),this._state=Yg.CLOSING,this._containerInstance._startExitAnimation()}afterOpened(){return this._afterOpened}afterClosed(){return this._ref.closed}beforeClosed(){return this._beforeClosed}backdropClick(){return this._ref.backdropClick}keydownEvents(){return this._ref.keydownEvents}updatePosition(m){let x=this._ref.config.positionStrategy;return m&&(m.left||m.right)?m.left?x.left(m.left):x.right(m.right):x.centerHorizontally(),m&&(m.top||m.bottom)?m.top?x.top(m.top):x.bottom(m.bottom):x.centerVertically(),this._ref.updatePosition(),this}updateSize(m="",x=""){return this._ref.updateSize(m,x),this}addPanelClass(m){return this._ref.addPanelClass(m),this}removePanelClass(m){return this._ref.removePanelClass(m),this}getState(){return this._state}_finishDialogClose(){this._state=Yg.CLOSED,this._ref.close(this._result,{focusOrigin:this._closeInteractionType}),this.componentInstance=null}};function kR(w,m,x){return w._closeInteractionType=m,w.close(x)}var pv=new ci("MatMdcDialogData"),IR=new ci("mat-mdc-dialog-default-options"),SR=new ci("mat-mdc-dialog-scroll-strategy",{providedIn:"root",factory:()=>{let w=St(ha);return()=>w.scrollStrategies.block()}});var CR=0,fv=(()=>{let m=class m{get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}_getAfterAllClosed(){let u=this._parentDialog;return u?u._getAfterAllClosed():this._afterAllClosedAtThisLevel}constructor(u,_,r,M,F,q,re,me){this._overlay=u,this._defaultOptions=M,this._scrollStrategy=F,this._parentDialog=q,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new ei,this._afterOpenedAtThisLevel=new ei,this.dialogConfigClass=Xp,this.afterAllClosed=_d(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(ho(void 0))),this._dialog=_.get(hv),this._dialogRefConstructor=mv,this._dialogContainerType=TR,this._dialogDataToken=pv}open(u,_){let r;_=It(It({},this._defaultOptions||new Xp),_),_.id=_.id||`mat-mdc-dialog-${CR++}`,_.scrollStrategy=_.scrollStrategy||this._scrollStrategy();let M=this._dialog.open(u,sr(It({},_),{positionStrategy:this._overlay.position().global().centerHorizontally().centerVertically(),disableClose:!0,closeOnDestroy:!1,closeOnOverlayDetachments:!1,container:{type:this._dialogContainerType,providers:()=>[{provide:this.dialogConfigClass,useValue:_},{provide:Td,useValue:_}]},templateContext:()=>({dialogRef:r}),providers:(F,q,re)=>(r=new this._dialogRefConstructor(F,_,re),r.updatePosition(_?.position),[{provide:this._dialogContainerType,useValue:re},{provide:this._dialogDataToken,useValue:q.data},{provide:this._dialogRefConstructor,useValue:r}])}));return r.componentRef=M.componentRef,r.componentInstance=M.componentInstance,this.openDialogs.push(r),this.afterOpened.next(r),r.afterClosed().subscribe(()=>{let F=this.openDialogs.indexOf(r);F>-1&&(this.openDialogs.splice(F,1),this.openDialogs.length||this._getAfterAllClosed().next())}),r}closeAll(){this._closeDialogs(this.openDialogs)}getDialogById(u){return this.openDialogs.find(_=>_.id===u)}ngOnDestroy(){this._closeDialogs(this._openDialogsAtThisLevel),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete()}_closeDialogs(u){let _=u.length;for(;_--;)u[_].close()}};m.\u0275fac=function(_){return new(_||m)(qi(ha),qi(uo),qi(bd,8),qi(IR,8),qi(SR),qi(m,12),qi(kg),qi(mo,8))},m.\u0275prov=Tn({token:m,factory:m.\u0275fac,providedIn:"root"});let w=m;return w})();var kI=(()=>{let m=class m{};m.\u0275fac=function(_){return new(_||m)},m.\u0275dir=fn({type:m,selectors:[["","mat-dialog-content",""],["mat-dialog-content"],["","matDialogContent",""]],hostAttrs:[1,"mat-mdc-dialog-content","mdc-dialog__content"],standalone:!0});let w=m;return w})();var II=(()=>{let m=class m{};m.\u0275fac=function(_){return new(_||m)},m.\u0275mod=Un({type:m}),m.\u0275inj=Vn({providers:[fv],imports:[bI,ac,sl,qn,qn]});let w=m;return w})();function yv(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var Id=yv();function DI(w){Id=w}var PI=/[&<>"']/,MR=new RegExp(PI.source,"g"),RI=/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,ER=new RegExp(RI.source,"g"),AR={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},SI=w=>AR[w];function ma(w,m){if(m){if(PI.test(w))return w.replace(MR,SI)}else if(RI.test(w))return w.replace(ER,SI);return w}var DR=/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig;function PR(w){return w.replace(DR,(m,x)=>(x=x.toLowerCase(),x==="colon"?":":x.charAt(0)==="#"?x.charAt(1)==="x"?String.fromCharCode(parseInt(x.substring(2),16)):String.fromCharCode(+x.substring(1)):""))}var RR=/(^|[^\[])\^/g;function Bn(w,m){let x=typeof w=="string"?w:w.source;m=m||"";let u={replace:(_,r)=>{let M=typeof r=="string"?r:r.source;return M=M.replace(RR,"$1"),x=x.replace(_,M),u},getRegex:()=>new RegExp(x,m)};return u}function CI(w){try{w=encodeURI(w).replace(/%25/g,"%")}catch{return null}return w}var Kp={exec:()=>null};function MI(w,m){let x=w.replace(/\|/g,(r,M,F)=>{let q=!1,re=M;for(;--re>=0&&F[re]==="\\";)q=!q;return q?"|":" |"}),u=x.split(/ \|/),_=0;if(u[0].trim()||u.shift(),u.length>0&&!u[u.length-1].trim()&&u.pop(),m)if(u.length>m)u.splice(m);else for(;u.length<m;)u.push("");for(;_<u.length;_++)u[_]=u[_].trim().replace(/\\\|/g,"|");return u}function Kg(w,m,x){let u=w.length;if(u===0)return"";let _=0;for(;_<u;){let r=w.charAt(u-_-1);if(r===m&&!x)_++;else if(r!==m&&x)_++;else break}return w.slice(0,u-_)}function LR(w,m){if(w.indexOf(m[1])===-1)return-1;let x=0;for(let u=0;u<w.length;u++)if(w[u]==="\\")u++;else if(w[u]===m[0])x++;else if(w[u]===m[1]&&(x--,x<0))return u;return-1}function EI(w,m,x,u){let _=m.href,r=m.title?ma(m.title):null,M=w[1].replace(/\\([\[\]])/g,"$1");if(w[0].charAt(0)!=="!"){u.state.inLink=!0;let F={type:"link",raw:x,href:_,title:r,text:M,tokens:u.inlineTokens(M)};return u.state.inLink=!1,F}return{type:"image",raw:x,href:_,title:r,text:ma(M)}}function zR(w,m){let x=w.match(/^(\s+)(?:```)/);if(x===null)return m;let u=x[1];return m.split(`
`).map(_=>{let r=_.match(/^\s+/);if(r===null)return _;let[M]=r;return M.length>=u.length?_.slice(u.length):_}).join(`
`)}var Jh=class{options;rules;lexer;constructor(m){this.options=m||Id}space(m){let x=this.rules.block.newline.exec(m);if(x&&x[0].length>0)return{type:"space",raw:x[0]}}code(m){let x=this.rules.block.code.exec(m);if(x){let u=x[0].replace(/^ {1,4}/gm,"");return{type:"code",raw:x[0],codeBlockStyle:"indented",text:this.options.pedantic?u:Kg(u,`
`)}}}fences(m){let x=this.rules.block.fences.exec(m);if(x){let u=x[0],_=zR(u,x[3]||"");return{type:"code",raw:u,lang:x[2]?x[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):x[2],text:_}}}heading(m){let x=this.rules.block.heading.exec(m);if(x){let u=x[2].trim();if(/#$/.test(u)){let _=Kg(u,"#");(this.options.pedantic||!_||/ $/.test(_))&&(u=_.trim())}return{type:"heading",raw:x[0],depth:x[1].length,text:u,tokens:this.lexer.inline(u)}}}hr(m){let x=this.rules.block.hr.exec(m);if(x)return{type:"hr",raw:x[0]}}blockquote(m){let x=this.rules.block.blockquote.exec(m);if(x){let u=Kg(x[0].replace(/^ *>[ \t]?/gm,""),`
`),_=this.lexer.state.top;this.lexer.state.top=!0;let r=this.lexer.blockTokens(u);return this.lexer.state.top=_,{type:"blockquote",raw:x[0],tokens:r,text:u}}}list(m){let x=this.rules.block.list.exec(m);if(x){let u=x[1].trim(),_=u.length>1,r={type:"list",raw:"",ordered:_,start:_?+u.slice(0,-1):"",loose:!1,items:[]};u=_?`\\d{1,9}\\${u.slice(-1)}`:`\\${u}`,this.options.pedantic&&(u=_?u:"[*+-]");let M=new RegExp(`^( {0,3}${u})((?:[	 ][^\\n]*)?(?:\\n|$))`),F="",q="",re=!1;for(;m;){let me=!1;if(!(x=M.exec(m))||this.rules.block.hr.test(m))break;F=x[0],m=m.substring(F.length);let De=x[2].split(`
`,1)[0].replace(/^\t+/,Yn=>" ".repeat(3*Yn.length)),$e=m.split(`
`,1)[0],Mt=0;this.options.pedantic?(Mt=2,q=De.trimStart()):(Mt=x[2].search(/[^ ]/),Mt=Mt>4?1:Mt,q=De.slice(Mt),Mt+=x[1].length);let Ui=!1;if(!De&&/^ *$/.test($e)&&(F+=$e+`
`,m=m.substring($e.length+1),me=!0),!me){let Yn=new RegExp(`^ {0,${Math.min(3,Mt-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),$r=new RegExp(`^ {0,${Math.min(3,Mt-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),qr=new RegExp(`^ {0,${Math.min(3,Mt-1)}}(?:\`\`\`|~~~)`),eo=new RegExp(`^ {0,${Math.min(3,Mt-1)}}#`);for(;m;){let fo=m.split(`
`,1)[0];if($e=fo,this.options.pedantic&&($e=$e.replace(/^ {1,4}(?=( {4})*[^ ])/g,"  ")),qr.test($e)||eo.test($e)||Yn.test($e)||$r.test(m))break;if($e.search(/[^ ]/)>=Mt||!$e.trim())q+=`
`+$e.slice(Mt);else{if(Ui||De.search(/[^ ]/)>=4||qr.test(De)||eo.test(De)||$r.test(De))break;q+=`
`+$e}!Ui&&!$e.trim()&&(Ui=!0),F+=fo+`
`,m=m.substring(fo.length+1),De=$e.slice(Mt)}}r.loose||(re?r.loose=!0:/\n *\n *$/.test(F)&&(re=!0));let Hi=null,mi;this.options.gfm&&(Hi=/^\[[ xX]\] /.exec(q),Hi&&(mi=Hi[0]!=="[ ] ",q=q.replace(/^\[[ xX]\] +/,""))),r.items.push({type:"list_item",raw:F,task:!!Hi,checked:mi,loose:!1,text:q,tokens:[]}),r.raw+=F}r.items[r.items.length-1].raw=F.trimEnd(),r.items[r.items.length-1].text=q.trimEnd(),r.raw=r.raw.trimEnd();for(let me=0;me<r.items.length;me++)if(this.lexer.state.top=!1,r.items[me].tokens=this.lexer.blockTokens(r.items[me].text,[]),!r.loose){let De=r.items[me].tokens.filter(Mt=>Mt.type==="space"),$e=De.length>0&&De.some(Mt=>/\n.*\n/.test(Mt.raw));r.loose=$e}if(r.loose)for(let me=0;me<r.items.length;me++)r.items[me].loose=!0;return r}}html(m){let x=this.rules.block.html.exec(m);if(x)return{type:"html",block:!0,raw:x[0],pre:x[1]==="pre"||x[1]==="script"||x[1]==="style",text:x[0]}}def(m){let x=this.rules.block.def.exec(m);if(x){let u=x[1].toLowerCase().replace(/\s+/g," "),_=x[2]?x[2].replace(/^<(.*)>$/,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",r=x[3]?x[3].substring(1,x[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):x[3];return{type:"def",tag:u,raw:x[0],href:_,title:r}}}table(m){let x=this.rules.block.table.exec(m);if(!x||!/[:|]/.test(x[2]))return;let u=MI(x[1]),_=x[2].replace(/^\||\| *$/g,"").split("|"),r=x[3]&&x[3].trim()?x[3].replace(/\n[ \t]*$/,"").split(`
`):[],M={type:"table",raw:x[0],header:[],align:[],rows:[]};if(u.length===_.length){for(let F of _)/^ *-+: *$/.test(F)?M.align.push("right"):/^ *:-+: *$/.test(F)?M.align.push("center"):/^ *:-+ *$/.test(F)?M.align.push("left"):M.align.push(null);for(let F of u)M.header.push({text:F,tokens:this.lexer.inline(F)});for(let F of r)M.rows.push(MI(F,M.header.length).map(q=>({text:q,tokens:this.lexer.inline(q)})));return M}}lheading(m){let x=this.rules.block.lheading.exec(m);if(x)return{type:"heading",raw:x[0],depth:x[2].charAt(0)==="="?1:2,text:x[1],tokens:this.lexer.inline(x[1])}}paragraph(m){let x=this.rules.block.paragraph.exec(m);if(x){let u=x[1].charAt(x[1].length-1)===`
`?x[1].slice(0,-1):x[1];return{type:"paragraph",raw:x[0],text:u,tokens:this.lexer.inline(u)}}}text(m){let x=this.rules.block.text.exec(m);if(x)return{type:"text",raw:x[0],text:x[0],tokens:this.lexer.inline(x[0])}}escape(m){let x=this.rules.inline.escape.exec(m);if(x)return{type:"escape",raw:x[0],text:ma(x[1])}}tag(m){let x=this.rules.inline.tag.exec(m);if(x)return!this.lexer.state.inLink&&/^<a /i.test(x[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\/a>/i.test(x[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(x[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(x[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:x[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:x[0]}}link(m){let x=this.rules.inline.link.exec(m);if(x){let u=x[2].trim();if(!this.options.pedantic&&/^</.test(u)){if(!/>$/.test(u))return;let M=Kg(u.slice(0,-1),"\\");if((u.length-M.length)%2===0)return}else{let M=LR(x[2],"()");if(M>-1){let q=(x[0].indexOf("!")===0?5:4)+x[1].length+M;x[2]=x[2].substring(0,M),x[0]=x[0].substring(0,q).trim(),x[3]=""}}let _=x[2],r="";if(this.options.pedantic){let M=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(_);M&&(_=M[1],r=M[3])}else r=x[3]?x[3].slice(1,-1):"";return _=_.trim(),/^</.test(_)&&(this.options.pedantic&&!/>$/.test(u)?_=_.slice(1):_=_.slice(1,-1)),EI(x,{href:_&&_.replace(this.rules.inline.anyPunctuation,"$1"),title:r&&r.replace(this.rules.inline.anyPunctuation,"$1")},x[0],this.lexer)}}reflink(m,x){let u;if((u=this.rules.inline.reflink.exec(m))||(u=this.rules.inline.nolink.exec(m))){let _=(u[2]||u[1]).replace(/\s+/g," "),r=x[_.toLowerCase()];if(!r){let M=u[0].charAt(0);return{type:"text",raw:M,text:M}}return EI(u,r,u[0],this.lexer)}}emStrong(m,x,u=""){let _=this.rules.inline.emStrongLDelim.exec(m);if(!_||_[3]&&u.match(/[\p{L}\p{N}]/u))return;if(!(_[1]||_[2]||"")||!u||this.rules.inline.punctuation.exec(u)){let M=[..._[0]].length-1,F,q,re=M,me=0,De=_[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(De.lastIndex=0,x=x.slice(-1*m.length+M);(_=De.exec(x))!=null;){if(F=_[1]||_[2]||_[3]||_[4]||_[5]||_[6],!F)continue;if(q=[...F].length,_[3]||_[4]){re+=q;continue}else if((_[5]||_[6])&&M%3&&!((M+q)%3)){me+=q;continue}if(re-=q,re>0)continue;q=Math.min(q,q+re+me);let $e=[..._[0]][0].length,Mt=m.slice(0,M+_.index+$e+q);if(Math.min(M,q)%2){let Hi=Mt.slice(1,-1);return{type:"em",raw:Mt,text:Hi,tokens:this.lexer.inlineTokens(Hi)}}let Ui=Mt.slice(2,-2);return{type:"strong",raw:Mt,text:Ui,tokens:this.lexer.inlineTokens(Ui)}}}}codespan(m){let x=this.rules.inline.code.exec(m);if(x){let u=x[2].replace(/\n/g," "),_=/[^ ]/.test(u),r=/^ /.test(u)&&/ $/.test(u);return _&&r&&(u=u.substring(1,u.length-1)),u=ma(u,!0),{type:"codespan",raw:x[0],text:u}}}br(m){let x=this.rules.inline.br.exec(m);if(x)return{type:"br",raw:x[0]}}del(m){let x=this.rules.inline.del.exec(m);if(x)return{type:"del",raw:x[0],text:x[2],tokens:this.lexer.inlineTokens(x[2])}}autolink(m){let x=this.rules.inline.autolink.exec(m);if(x){let u,_;return x[2]==="@"?(u=ma(x[1]),_="mailto:"+u):(u=ma(x[1]),_=u),{type:"link",raw:x[0],text:u,href:_,tokens:[{type:"text",raw:u,text:u}]}}}url(m){let x;if(x=this.rules.inline.url.exec(m)){let u,_;if(x[2]==="@")u=ma(x[0]),_="mailto:"+u;else{let r;do r=x[0],x[0]=this.rules.inline._backpedal.exec(x[0])?.[0]??"";while(r!==x[0]);u=ma(x[0]),x[1]==="www."?_="http://"+x[0]:_=x[0]}return{type:"link",raw:x[0],text:u,href:_,tokens:[{type:"text",raw:u,text:u}]}}}inlineText(m){let x=this.rules.inline.text.exec(m);if(x){let u;return this.lexer.state.inRawBlock?u=x[0]:u=ma(x[0]),{type:"text",raw:x[0],text:u}}}},OR=/^(?: *(?:\n|$))+/,FR=/^( {4}[^\n]+(?:\n(?: *(?:\n|$))*)?)+/,BR=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,Jp=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,NR=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,LI=/(?:[*+-]|\d{1,9}[.)])/,zI=Bn(/^(?!bull |blockCode|fences|blockquote|heading|html)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html))+?)\n {0,3}(=+|-+) *(?:\n+|$)/).replace(/bull/g,LI).replace(/blockCode/g,/ {4}/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).getRegex(),bv=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,jR=/^[^\n]+/,vv=/(?!\s*\])(?:\\.|[^\[\]\\])+/,VR=Bn(/^ {0,3}\[(label)\]: *(?:\n *)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n *)?| *\n *)(title))? *(?:\n+|$)/).replace("label",vv).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),UR=Bn(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,LI).getRegex(),e0="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",xv=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,GR=Bn("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n *)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$))","i").replace("comment",xv).replace("tag",e0).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),OI=Bn(bv).replace("hr",Jp).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",e0).getRegex(),$R=Bn(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",OI).getRegex(),wv={blockquote:$R,code:FR,def:VR,fences:BR,heading:NR,hr:Jp,html:GR,lheading:zI,list:UR,newline:OR,paragraph:OI,table:Kp,text:jR},AI=Bn("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",Jp).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",e0).getRegex(),qR=sr(It({},wv),{table:AI,paragraph:Bn(bv).replace("hr",Jp).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",AI).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",e0).getRegex()}),HR=sr(It({},wv),{html:Bn(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",xv).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:Kp,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:Bn(bv).replace("hr",Jp).replace("heading",` *#{1,6} *[^
]`).replace("lheading",zI).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()}),FI=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,ZR=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,BI=/^( {2,}|\\)\n(?!\s*$)/,WR=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,ef="\\p{P}\\p{S}",XR=Bn(/^((?![*_])[\spunctuation])/,"u").replace(/punctuation/g,ef).getRegex(),YR=/\[[^[\]]*?\]\([^\(\)]*?\)|`[^`]*?`|<[^<>]*?>/g,KR=Bn(/^(?:\*+(?:((?!\*)[punct])|[^\s*]))|^_+(?:((?!_)[punct])|([^\s_]))/,"u").replace(/punct/g,ef).getRegex(),QR=Bn("^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)[punct](\\*+)(?=[\\s]|$)|[^punct\\s](\\*+)(?!\\*)(?=[punct\\s]|$)|(?!\\*)[punct\\s](\\*+)(?=[^punct\\s])|[\\s](\\*+)(?!\\*)(?=[punct])|(?!\\*)[punct](\\*+)(?!\\*)(?=[punct])|[^punct\\s](\\*+)(?=[^punct\\s])","gu").replace(/punct/g,ef).getRegex(),JR=Bn("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)[punct](_+)(?=[\\s]|$)|[^punct\\s](_+)(?!_)(?=[punct\\s]|$)|(?!_)[punct\\s](_+)(?=[^punct\\s])|[\\s](_+)(?!_)(?=[punct])|(?!_)[punct](_+)(?!_)(?=[punct])","gu").replace(/punct/g,ef).getRegex(),eL=Bn(/\\([punct])/,"gu").replace(/punct/g,ef).getRegex(),tL=Bn(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),iL=Bn(xv).replace("(?:-->|$)","-->").getRegex(),nL=Bn("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",iL).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),Jg=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,rL=Bn(/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/).replace("label",Jg).replace("href",/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),NI=Bn(/^!?\[(label)\]\[(ref)\]/).replace("label",Jg).replace("ref",vv).getRegex(),jI=Bn(/^!?\[(ref)\](?:\[\])?/).replace("ref",vv).getRegex(),oL=Bn("reflink|nolink(?!\\()","g").replace("reflink",NI).replace("nolink",jI).getRegex(),Tv={_backpedal:Kp,anyPunctuation:eL,autolink:tL,blockSkip:YR,br:BI,code:ZR,del:Kp,emStrongLDelim:KR,emStrongRDelimAst:QR,emStrongRDelimUnd:JR,escape:FI,link:rL,nolink:jI,punctuation:XR,reflink:NI,reflinkSearch:oL,tag:nL,text:WR,url:Kp},aL=sr(It({},Tv),{link:Bn(/^!?\[(label)\]\((.*?)\)/).replace("label",Jg).getRegex(),reflink:Bn(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",Jg).getRegex()}),_v=sr(It({},Tv),{escape:Bn(FI).replace("])","~|])").getRegex(),url:Bn(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])([\s\S]*?[^\s~])\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/}),sL=sr(It({},_v),{br:Bn(BI).replace("{2,}","*").getRegex(),text:Bn(_v.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()}),Qg={normal:wv,gfm:qR,pedantic:HR},Yp={normal:Tv,gfm:_v,breaks:sL,pedantic:aL},dl=class w{tokens;options;state;tokenizer;inlineQueue;constructor(m){this.tokens=[],this.tokens.links=Object.create(null),this.options=m||Id,this.options.tokenizer=this.options.tokenizer||new Jh,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let x={block:Qg.normal,inline:Yp.normal};this.options.pedantic?(x.block=Qg.pedantic,x.inline=Yp.pedantic):this.options.gfm&&(x.block=Qg.gfm,this.options.breaks?x.inline=Yp.breaks:x.inline=Yp.gfm),this.tokenizer.rules=x}static get rules(){return{block:Qg,inline:Yp}}static lex(m,x){return new w(x).lex(m)}static lexInline(m,x){return new w(x).inlineTokens(m)}lex(m){m=m.replace(/\r\n|\r/g,`
`),this.blockTokens(m,this.tokens);for(let x=0;x<this.inlineQueue.length;x++){let u=this.inlineQueue[x];this.inlineTokens(u.src,u.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(m,x=[]){this.options.pedantic?m=m.replace(/\t/g,"    ").replace(/^ +$/gm,""):m=m.replace(/^( *)(\t+)/gm,(F,q,re)=>q+"    ".repeat(re.length));let u,_,r,M;for(;m;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some(F=>(u=F.call({lexer:this},m,x))?(m=m.substring(u.raw.length),x.push(u),!0):!1))){if(u=this.tokenizer.space(m)){m=m.substring(u.raw.length),u.raw.length===1&&x.length>0?x[x.length-1].raw+=`
`:x.push(u);continue}if(u=this.tokenizer.code(m)){m=m.substring(u.raw.length),_=x[x.length-1],_&&(_.type==="paragraph"||_.type==="text")?(_.raw+=`
`+u.raw,_.text+=`
`+u.text,this.inlineQueue[this.inlineQueue.length-1].src=_.text):x.push(u);continue}if(u=this.tokenizer.fences(m)){m=m.substring(u.raw.length),x.push(u);continue}if(u=this.tokenizer.heading(m)){m=m.substring(u.raw.length),x.push(u);continue}if(u=this.tokenizer.hr(m)){m=m.substring(u.raw.length),x.push(u);continue}if(u=this.tokenizer.blockquote(m)){m=m.substring(u.raw.length),x.push(u);continue}if(u=this.tokenizer.list(m)){m=m.substring(u.raw.length),x.push(u);continue}if(u=this.tokenizer.html(m)){m=m.substring(u.raw.length),x.push(u);continue}if(u=this.tokenizer.def(m)){m=m.substring(u.raw.length),_=x[x.length-1],_&&(_.type==="paragraph"||_.type==="text")?(_.raw+=`
`+u.raw,_.text+=`
`+u.raw,this.inlineQueue[this.inlineQueue.length-1].src=_.text):this.tokens.links[u.tag]||(this.tokens.links[u.tag]={href:u.href,title:u.title});continue}if(u=this.tokenizer.table(m)){m=m.substring(u.raw.length),x.push(u);continue}if(u=this.tokenizer.lheading(m)){m=m.substring(u.raw.length),x.push(u);continue}if(r=m,this.options.extensions&&this.options.extensions.startBlock){let F=1/0,q=m.slice(1),re;this.options.extensions.startBlock.forEach(me=>{re=me.call({lexer:this},q),typeof re=="number"&&re>=0&&(F=Math.min(F,re))}),F<1/0&&F>=0&&(r=m.substring(0,F+1))}if(this.state.top&&(u=this.tokenizer.paragraph(r))){_=x[x.length-1],M&&_.type==="paragraph"?(_.raw+=`
`+u.raw,_.text+=`
`+u.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=_.text):x.push(u),M=r.length!==m.length,m=m.substring(u.raw.length);continue}if(u=this.tokenizer.text(m)){m=m.substring(u.raw.length),_=x[x.length-1],_&&_.type==="text"?(_.raw+=`
`+u.raw,_.text+=`
`+u.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=_.text):x.push(u);continue}if(m){let F="Infinite loop on byte: "+m.charCodeAt(0);if(this.options.silent){console.error(F);break}else throw new Error(F)}}return this.state.top=!0,x}inline(m,x=[]){return this.inlineQueue.push({src:m,tokens:x}),x}inlineTokens(m,x=[]){let u,_,r,M=m,F,q,re;if(this.tokens.links){let me=Object.keys(this.tokens.links);if(me.length>0)for(;(F=this.tokenizer.rules.inline.reflinkSearch.exec(M))!=null;)me.includes(F[0].slice(F[0].lastIndexOf("[")+1,-1))&&(M=M.slice(0,F.index)+"["+"a".repeat(F[0].length-2)+"]"+M.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(F=this.tokenizer.rules.inline.blockSkip.exec(M))!=null;)M=M.slice(0,F.index)+"["+"a".repeat(F[0].length-2)+"]"+M.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;(F=this.tokenizer.rules.inline.anyPunctuation.exec(M))!=null;)M=M.slice(0,F.index)+"++"+M.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;m;)if(q||(re=""),q=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some(me=>(u=me.call({lexer:this},m,x))?(m=m.substring(u.raw.length),x.push(u),!0):!1))){if(u=this.tokenizer.escape(m)){m=m.substring(u.raw.length),x.push(u);continue}if(u=this.tokenizer.tag(m)){m=m.substring(u.raw.length),_=x[x.length-1],_&&u.type==="text"&&_.type==="text"?(_.raw+=u.raw,_.text+=u.text):x.push(u);continue}if(u=this.tokenizer.link(m)){m=m.substring(u.raw.length),x.push(u);continue}if(u=this.tokenizer.reflink(m,this.tokens.links)){m=m.substring(u.raw.length),_=x[x.length-1],_&&u.type==="text"&&_.type==="text"?(_.raw+=u.raw,_.text+=u.text):x.push(u);continue}if(u=this.tokenizer.emStrong(m,M,re)){m=m.substring(u.raw.length),x.push(u);continue}if(u=this.tokenizer.codespan(m)){m=m.substring(u.raw.length),x.push(u);continue}if(u=this.tokenizer.br(m)){m=m.substring(u.raw.length),x.push(u);continue}if(u=this.tokenizer.del(m)){m=m.substring(u.raw.length),x.push(u);continue}if(u=this.tokenizer.autolink(m)){m=m.substring(u.raw.length),x.push(u);continue}if(!this.state.inLink&&(u=this.tokenizer.url(m))){m=m.substring(u.raw.length),x.push(u);continue}if(r=m,this.options.extensions&&this.options.extensions.startInline){let me=1/0,De=m.slice(1),$e;this.options.extensions.startInline.forEach(Mt=>{$e=Mt.call({lexer:this},De),typeof $e=="number"&&$e>=0&&(me=Math.min(me,$e))}),me<1/0&&me>=0&&(r=m.substring(0,me+1))}if(u=this.tokenizer.inlineText(r)){m=m.substring(u.raw.length),u.raw.slice(-1)!=="_"&&(re=u.raw.slice(-1)),q=!0,_=x[x.length-1],_&&_.type==="text"?(_.raw+=u.raw,_.text+=u.text):x.push(u);continue}if(m){let me="Infinite loop on byte: "+m.charCodeAt(0);if(this.options.silent){console.error(me);break}else throw new Error(me)}}return x}},eu=class{options;constructor(m){this.options=m||Id}code(m,x,u){let _=(x||"").match(/^\S*/)?.[0];return m=m.replace(/\n$/,"")+`
`,_?'<pre><code class="language-'+ma(_)+'">'+(u?m:ma(m,!0))+`</code></pre>
`:"<pre><code>"+(u?m:ma(m,!0))+`</code></pre>
`}blockquote(m){return`<blockquote>
${m}</blockquote>
`}html(m,x){return m}heading(m,x,u){return`<h${x}>${m}</h${x}>
`}hr(){return`<hr>
`}list(m,x,u){let _=x?"ol":"ul",r=x&&u!==1?' start="'+u+'"':"";return"<"+_+r+`>
`+m+"</"+_+`>
`}listitem(m,x,u){return`<li>${m}</li>
`}checkbox(m){return"<input "+(m?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph(m){return`<p>${m}</p>
`}table(m,x){return x&&(x=`<tbody>${x}</tbody>`),`<table>
<thead>
`+m+`</thead>
`+x+`</table>
`}tablerow(m){return`<tr>
${m}</tr>
`}tablecell(m,x){let u=x.header?"th":"td";return(x.align?`<${u} align="${x.align}">`:`<${u}>`)+m+`</${u}>
`}strong(m){return`<strong>${m}</strong>`}em(m){return`<em>${m}</em>`}codespan(m){return`<code>${m}</code>`}br(){return"<br>"}del(m){return`<del>${m}</del>`}link(m,x,u){let _=CI(m);if(_===null)return u;m=_;let r='<a href="'+m+'"';return x&&(r+=' title="'+x+'"'),r+=">"+u+"</a>",r}image(m,x,u){let _=CI(m);if(_===null)return u;m=_;let r=`<img src="${m}" alt="${u}"`;return x&&(r+=` title="${x}"`),r+=">",r}text(m){return m}},Qp=class{strong(m){return m}em(m){return m}codespan(m){return m}del(m){return m}html(m){return m}text(m){return m}link(m,x,u){return""+u}image(m,x,u){return""+u}br(){return""}},hl=class w{options;renderer;textRenderer;constructor(m){this.options=m||Id,this.options.renderer=this.options.renderer||new eu,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new Qp}static parse(m,x){return new w(x).parse(m)}static parseInline(m,x){return new w(x).parseInline(m)}parse(m,x=!0){let u="";for(let _=0;_<m.length;_++){let r=m[_];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[r.type]){let M=r,F=this.options.extensions.renderers[M.type].call({parser:this},M);if(F!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(M.type)){u+=F||"";continue}}switch(r.type){case"space":continue;case"hr":{u+=this.renderer.hr();continue}case"heading":{let M=r;u+=this.renderer.heading(this.parseInline(M.tokens),M.depth,PR(this.parseInline(M.tokens,this.textRenderer)));continue}case"code":{let M=r;u+=this.renderer.code(M.text,M.lang,!!M.escaped);continue}case"table":{let M=r,F="",q="";for(let me=0;me<M.header.length;me++)q+=this.renderer.tablecell(this.parseInline(M.header[me].tokens),{header:!0,align:M.align[me]});F+=this.renderer.tablerow(q);let re="";for(let me=0;me<M.rows.length;me++){let De=M.rows[me];q="";for(let $e=0;$e<De.length;$e++)q+=this.renderer.tablecell(this.parseInline(De[$e].tokens),{header:!1,align:M.align[$e]});re+=this.renderer.tablerow(q)}u+=this.renderer.table(F,re);continue}case"blockquote":{let M=r,F=this.parse(M.tokens);u+=this.renderer.blockquote(F);continue}case"list":{let M=r,F=M.ordered,q=M.start,re=M.loose,me="";for(let De=0;De<M.items.length;De++){let $e=M.items[De],Mt=$e.checked,Ui=$e.task,Hi="";if($e.task){let mi=this.renderer.checkbox(!!Mt);re?$e.tokens.length>0&&$e.tokens[0].type==="paragraph"?($e.tokens[0].text=mi+" "+$e.tokens[0].text,$e.tokens[0].tokens&&$e.tokens[0].tokens.length>0&&$e.tokens[0].tokens[0].type==="text"&&($e.tokens[0].tokens[0].text=mi+" "+$e.tokens[0].tokens[0].text)):$e.tokens.unshift({type:"text",text:mi+" "}):Hi+=mi+" "}Hi+=this.parse($e.tokens,re),me+=this.renderer.listitem(Hi,Ui,!!Mt)}u+=this.renderer.list(me,F,q);continue}case"html":{let M=r;u+=this.renderer.html(M.text,M.block);continue}case"paragraph":{let M=r;u+=this.renderer.paragraph(this.parseInline(M.tokens));continue}case"text":{let M=r,F=M.tokens?this.parseInline(M.tokens):M.text;for(;_+1<m.length&&m[_+1].type==="text";)M=m[++_],F+=`
`+(M.tokens?this.parseInline(M.tokens):M.text);u+=x?this.renderer.paragraph(F):F;continue}default:{let M='Token with "'+r.type+'" type was not found.';if(this.options.silent)return console.error(M),"";throw new Error(M)}}}return u}parseInline(m,x){x=x||this.renderer;let u="";for(let _=0;_<m.length;_++){let r=m[_];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[r.type]){let M=this.options.extensions.renderers[r.type].call({parser:this},r);if(M!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(r.type)){u+=M||"";continue}}switch(r.type){case"escape":{let M=r;u+=x.text(M.text);break}case"html":{let M=r;u+=x.html(M.text);break}case"link":{let M=r;u+=x.link(M.href,M.title,this.parseInline(M.tokens,x));break}case"image":{let M=r;u+=x.image(M.href,M.title,M.text);break}case"strong":{let M=r;u+=x.strong(this.parseInline(M.tokens,x));break}case"em":{let M=r;u+=x.em(this.parseInline(M.tokens,x));break}case"codespan":{let M=r;u+=x.codespan(M.text);break}case"br":{u+=x.br();break}case"del":{let M=r;u+=x.del(this.parseInline(M.tokens,x));break}case"text":{let M=r;u+=x.text(M.text);break}default:{let M='Token with "'+r.type+'" type was not found.';if(this.options.silent)return console.error(M),"";throw new Error(M)}}}return u}},Qh=class{options;constructor(m){this.options=m||Id}static passThroughHooks=new Set(["preprocess","postprocess","processAllTokens"]);preprocess(m){return m}postprocess(m){return m}processAllTokens(m){return m}},gv=class{defaults=yv();options=this.setOptions;parse=this.#e(dl.lex,hl.parse);parseInline=this.#e(dl.lexInline,hl.parseInline);Parser=hl;Renderer=eu;TextRenderer=Qp;Lexer=dl;Tokenizer=Jh;Hooks=Qh;constructor(...m){this.use(...m)}walkTokens(m,x){let u=[];for(let _ of m)switch(u=u.concat(x.call(this,_)),_.type){case"table":{let r=_;for(let M of r.header)u=u.concat(this.walkTokens(M.tokens,x));for(let M of r.rows)for(let F of M)u=u.concat(this.walkTokens(F.tokens,x));break}case"list":{let r=_;u=u.concat(this.walkTokens(r.items,x));break}default:{let r=_;this.defaults.extensions?.childTokens?.[r.type]?this.defaults.extensions.childTokens[r.type].forEach(M=>{let F=r[M].flat(1/0);u=u.concat(this.walkTokens(F,x))}):r.tokens&&(u=u.concat(this.walkTokens(r.tokens,x)))}}return u}use(...m){let x=this.defaults.extensions||{renderers:{},childTokens:{}};return m.forEach(u=>{let _=It({},u);if(_.async=this.defaults.async||_.async||!1,u.extensions&&(u.extensions.forEach(r=>{if(!r.name)throw new Error("extension name required");if("renderer"in r){let M=x.renderers[r.name];M?x.renderers[r.name]=function(...F){let q=r.renderer.apply(this,F);return q===!1&&(q=M.apply(this,F)),q}:x.renderers[r.name]=r.renderer}if("tokenizer"in r){if(!r.level||r.level!=="block"&&r.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let M=x[r.level];M?M.unshift(r.tokenizer):x[r.level]=[r.tokenizer],r.start&&(r.level==="block"?x.startBlock?x.startBlock.push(r.start):x.startBlock=[r.start]:r.level==="inline"&&(x.startInline?x.startInline.push(r.start):x.startInline=[r.start]))}"childTokens"in r&&r.childTokens&&(x.childTokens[r.name]=r.childTokens)}),_.extensions=x),u.renderer){let r=this.defaults.renderer||new eu(this.defaults);for(let M in u.renderer){if(!(M in r))throw new Error(`renderer '${M}' does not exist`);if(M==="options")continue;let F=M,q=u.renderer[F],re=r[F];r[F]=(...me)=>{let De=q.apply(r,me);return De===!1&&(De=re.apply(r,me)),De||""}}_.renderer=r}if(u.tokenizer){let r=this.defaults.tokenizer||new Jh(this.defaults);for(let M in u.tokenizer){if(!(M in r))throw new Error(`tokenizer '${M}' does not exist`);if(["options","rules","lexer"].includes(M))continue;let F=M,q=u.tokenizer[F],re=r[F];r[F]=(...me)=>{let De=q.apply(r,me);return De===!1&&(De=re.apply(r,me)),De}}_.tokenizer=r}if(u.hooks){let r=this.defaults.hooks||new Qh;for(let M in u.hooks){if(!(M in r))throw new Error(`hook '${M}' does not exist`);if(M==="options")continue;let F=M,q=u.hooks[F],re=r[F];Qh.passThroughHooks.has(M)?r[F]=me=>{if(this.defaults.async)return Promise.resolve(q.call(r,me)).then($e=>re.call(r,$e));let De=q.call(r,me);return re.call(r,De)}:r[F]=(...me)=>{let De=q.apply(r,me);return De===!1&&(De=re.apply(r,me)),De}}_.hooks=r}if(u.walkTokens){let r=this.defaults.walkTokens,M=u.walkTokens;_.walkTokens=function(F){let q=[];return q.push(M.call(this,F)),r&&(q=q.concat(r.call(this,F))),q}}this.defaults=It(It({},this.defaults),_)}),this}setOptions(m){return this.defaults=It(It({},this.defaults),m),this}lexer(m,x){return dl.lex(m,x??this.defaults)}parser(m,x){return hl.parse(m,x??this.defaults)}#e(m,x){return(u,_)=>{let r=It({},_),M=It(It({},this.defaults),r);this.defaults.async===!0&&r.async===!1&&(M.silent||console.warn("marked(): The async option was set to true by an extension. The async: false option sent to parse will be ignored."),M.async=!0);let F=this.#t(!!M.silent,!!M.async);if(typeof u>"u"||u===null)return F(new Error("marked(): input parameter is undefined or null"));if(typeof u!="string")return F(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(u)+", string expected"));if(M.hooks&&(M.hooks.options=M),M.async)return Promise.resolve(M.hooks?M.hooks.preprocess(u):u).then(q=>m(q,M)).then(q=>M.hooks?M.hooks.processAllTokens(q):q).then(q=>M.walkTokens?Promise.all(this.walkTokens(q,M.walkTokens)).then(()=>q):q).then(q=>x(q,M)).then(q=>M.hooks?M.hooks.postprocess(q):q).catch(F);try{M.hooks&&(u=M.hooks.preprocess(u));let q=m(u,M);M.hooks&&(q=M.hooks.processAllTokens(q)),M.walkTokens&&this.walkTokens(q,M.walkTokens);let re=x(q,M);return M.hooks&&(re=M.hooks.postprocess(re)),re}catch(q){return F(q)}}}#t(m,x){return u=>{if(u.message+=`
Please report this to https://github.com/markedjs/marked.`,m){let _="<p>An error occurred:</p><pre>"+ma(u.message+"",!0)+"</pre>";return x?Promise.resolve(_):_}if(x)return Promise.reject(u);throw u}}},kd=new gv;function Cn(w,m){return kd.parse(w,m)}Cn.options=Cn.setOptions=function(w){return kd.setOptions(w),Cn.defaults=kd.defaults,DI(Cn.defaults),Cn};Cn.getDefaults=yv;Cn.defaults=Id;Cn.use=function(...w){return kd.use(...w),Cn.defaults=kd.defaults,DI(Cn.defaults),Cn};Cn.walkTokens=function(w,m){return kd.walkTokens(w,m)};Cn.parseInline=kd.parseInline;Cn.Parser=hl;Cn.parser=hl.parse;Cn.Renderer=eu;Cn.TextRenderer=Qp;Cn.Lexer=dl;Cn.lexer=dl.lex;Cn.Tokenizer=Jh;Cn.Hooks=Qh;Cn.parse=Cn;var kB=Cn.options,IB=Cn.setOptions,SB=Cn.use,CB=Cn.walkTokens,MB=Cn.parseInline;var EB=hl.parse,AB=dl.lex;function lL(w,m){if(w&1&&(Ue(0,"h2",2),Bt(1),Ge()),w&2){let x=Dt();Ze(),hn(x.data.title)}}var VI=(()=>{let m=class m{constructor(u){this.data=u,this.htmlContent="",this._parseMarkdown()}_parseMarkdown(){return ir(this,null,function*(){this.htmlContent=yield Cn.parse(this.data.content)})}};m.\u0275fac=function(_){return new(_||m)(Xe(pv))},m.\u0275cmp=hi({type:m,selectors:[["lib-md-dialog"]],standalone:!0,features:[ui],decls:2,vars:2,consts:[["class","title","mat-dialog-title","",4,"ngIf"],[1,"mat-typography",3,"innerHTML"],["mat-dialog-title","",1,"title"]],template:function(_,r){_&1&&(bi(0,lL,2,1,"h2",0),Ki(1,"mat-dialog-content",1)),_&2&&(Ct("ngIf",r.data.title),Ze(),Ct("innerHTML",r.htmlContent,T2))},dependencies:[In,jo,kI],styles:["[_nghost-%COMP%]     h2{margin-top:25px;font-size:1.6em;line-height:1.1em}[_nghost-%COMP%]     h3{margin-top:10px;font-size:1.2em;line-height:1em}[_nghost-%COMP%]     a{all:unset;text-decoration:underline dotted;cursor:pointer}.title[_ngcontent-%COMP%]{padding-top:25px;padding-left:25px}"]});let w=m;return w})();function cL(w,m){if(w&1&&(Ue(0,"mat-option",8),Bt(1),Ge()),w&2){let x=m.$implicit;Ct("value",x),Ze(),hn(x)}}function dL(w,m){if(w&1){let x=dn();Ue(0,"mat-select",7),$t("ngModelChange",function(_){Xi(x);let r=Dt(2);return Yi(r.seletcedLanguage=_)})("selectionChange",function(){Xi(x);let _=Dt(2);return Yi(_.changedLanguage.emit(_.seletcedLanguage))}),Lr(1,cL,2,2,"mat-option",8,No),Ge()}if(w&2){let x=Dt(2);Ct("ngModel",x.seletcedLanguage),Ze(),zr(x.languageOptions)}}function hL(w,m){if(w&1){let x=dn();Ue(0,"div",null,3)(2,"div",4)(3,"button",5),$t("click",function(){Xi(x);let _=Dt();return Yi(_.showInfo())}),Ue(4,"mat-icon"),Bt(5,"info_outline"),Ge()(),bi(6,dL,3,1,"mat-select",6),Ge()()}if(w&2){let x=Dt();Ze(6),Ct("ngIf",x.languageOptions.length)}}var uL=["*"],UI=(()=>{let m=class m{constructor(){this._themeService=St(uc),this.dialog=St(fv),this.title="",this.info="",this.languageOptions=[],this.seletcedLanguage=this.languageOptions[0],this.changedLanguage=new Ut,this.darkMode=this._themeService.darkMode,this.logoPath=cg(()=>this.darkMode()?"./assets/logo_dark.svg":"./assets/logo.svg")}showInfo(){this.dialog.open(VI,{data:{content:this.info}})}};m.\u0275fac=function(_){return new(_||m)},m.\u0275cmp=hi({type:m,selectors:[["lib-ng-demo-layout"]],inputs:{title:"title",info:"info",languageOptions:"languageOptions",seletcedLanguage:"seletcedLanguage"},outputs:{changedLanguage:"changedLanguage"},standalone:!0,features:[ui],ngContentSelectors:uL,decls:5,vars:4,consts:[[3,"logo","title"],[3,"showProfileMenu"],[4,"ngIf"],["iconsAfter",""],[1,"actions"],["mat-icon-button","","aria-label","Show info",1,"btn",3,"click"],["style","text-align: right; width: 85px; margin-left: -30px;",3,"ngModel","ngModelChange","selectionChange",4,"ngIf"],[2,"text-align","right","width","85px","margin-left","-30px",3,"ngModel","ngModelChange","selectionChange"],[3,"value"]],template:function(_,r){_&1&&(pr(),Ki(0,"lib-ng-left-toolbar",0),Ue(1,"lib-ng-right-toolbar",1),bi(2,hL,7,1,"div",2),Ge(),Ue(3,"lib-standard-page"),kn(4),Ge()),_&2&&(Ct("logo",r.logoPath())("title",r.title),Ze(),Ct("showProfileMenu",!1),Ze(),Ct("ngIf",r.info))},dependencies:[In,jo,cI,_I,gI,xa,va,qo,Nh,II,Ms,Cs,Ss,Is,Ts,ks],styles:["lib-ng-left-toolbar[_ngcontent-%COMP%]{position:absolute;top:20px;left:20px;height:50px}lib-ng-right-toolbar[_ngcontent-%COMP%]{position:absolute;top:20px;right:20px;height:50px}.content[_ngcontent-%COMP%]{position:absolute;inset:0;display:flex;justify-content:center;align-items:center}.actions[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;gap:10px}"]});let w=m;return w})();var pL=0,kv=new ci("CdkAccordion"),GI=(()=>{let m=class m{constructor(){this._stateChanges=new ei,this._openCloseAllActions=new ei,this.id=`cdk-accordion-${pL++}`,this.multi=!1}openAll(){this.multi&&this._openCloseAllActions.next(!0)}closeAll(){this._openCloseAllActions.next(!1)}ngOnChanges(u){this._stateChanges.next(u)}ngOnDestroy(){this._stateChanges.complete(),this._openCloseAllActions.complete()}};m.\u0275fac=function(_){return new(_||m)},m.\u0275dir=fn({type:m,selectors:[["cdk-accordion"],["","cdkAccordion",""]],inputs:{multi:[ti.HasDecoratorInputTransform,"multi","multi",gn]},exportAs:["cdkAccordion"],standalone:!0,features:[Or([{provide:kv,useExisting:m}]),nr,lr]});let w=m;return w})(),fL=0,$I=(()=>{let m=class m{get expanded(){return this._expanded}set expanded(u){if(this._expanded!==u){if(this._expanded=u,this.expandedChange.emit(u),u){this.opened.emit();let _=this.accordion?this.accordion.id:this.id;this._expansionDispatcher.notify(this.id,_)}else this.closed.emit();this._changeDetectorRef.markForCheck()}}constructor(u,_,r){this.accordion=u,this._changeDetectorRef=_,this._expansionDispatcher=r,this._openCloseAllSubscription=Vr.EMPTY,this.closed=new Ut,this.opened=new Ut,this.destroyed=new Ut,this.expandedChange=new Ut,this.id=`cdk-accordion-child-${fL++}`,this._expanded=!1,this.disabled=!1,this._removeUniqueSelectionListener=()=>{},this._removeUniqueSelectionListener=r.listen((M,F)=>{this.accordion&&!this.accordion.multi&&this.accordion.id===F&&this.id!==M&&(this.expanded=!1)}),this.accordion&&(this._openCloseAllSubscription=this._subscribeToOpenCloseAllActions())}ngOnDestroy(){this.opened.complete(),this.closed.complete(),this.destroyed.emit(),this.destroyed.complete(),this._removeUniqueSelectionListener(),this._openCloseAllSubscription.unsubscribe()}toggle(){this.disabled||(this.expanded=!this.expanded)}close(){this.disabled||(this.expanded=!1)}open(){this.disabled||(this.expanded=!0)}_subscribeToOpenCloseAllActions(){return this.accordion._openCloseAllActions.subscribe(u=>{this.disabled||(this.expanded=u)})}};m.\u0275fac=function(_){return new(_||m)(Xe(kv,12),Xe(On),Xe(wg))},m.\u0275dir=fn({type:m,selectors:[["cdk-accordion-item"],["","cdkAccordionItem",""]],inputs:{expanded:[ti.HasDecoratorInputTransform,"expanded","expanded",gn],disabled:[ti.HasDecoratorInputTransform,"disabled","disabled",gn]},outputs:{closed:"closed",opened:"opened",destroyed:"destroyed",expandedChange:"expandedChange"},exportAs:["cdkAccordionItem"],standalone:!0,features:[Or([{provide:kv,useValue:void 0}]),nr]});let w=m;return w})(),qI=(()=>{let m=class m{};m.\u0275fac=function(_){return new(_||m)},m.\u0275mod=Un({type:m}),m.\u0275inj=Vn({});let w=m;return w})();var _L=["body"];function gL(w,m){}var yL=[[["mat-expansion-panel-header"]],"*",[["mat-action-row"]]],bL=["mat-expansion-panel-header","*","mat-action-row"];function vL(w,m){if(w&1&&(Ue(0,"span",2),ag(),Ue(1,"svg",3),Ki(2,"path",4),Ge()()),w&2){let x=Dt();Ct("@indicatorRotate",x._getExpandedState())}}var xL=[[["mat-panel-title"]],[["mat-panel-description"]],"*"],wL=["mat-panel-title","mat-panel-description","*"],Iv=new ci("MAT_ACCORDION"),HI="225ms cubic-bezier(0.4,0.0,0.2,1)",ZI={indicatorRotate:ws("indicatorRotate",[ko("collapsed, void",xr({transform:"rotate(0deg)"})),ko("expanded",xr({transform:"rotate(180deg)"})),Uo("expanded <=> collapsed, void => collapsed",Vo(HI))]),bodyExpansion:ws("bodyExpansion",[ko("collapsed, void",xr({height:"0px",visibility:"hidden"})),ko("expanded",xr({height:"*",visibility:""})),Uo("expanded <=> collapsed, void => collapsed",Vo(HI))])},WI=new ci("MAT_EXPANSION_PANEL"),TL=(()=>{let m=class m{constructor(u,_){this._template=u,this._expansionPanel=_}};m.\u0275fac=function(_){return new(_||m)(Xe(To),Xe(WI,8))},m.\u0275dir=fn({type:m,selectors:[["ng-template","matExpansionPanelContent",""]],standalone:!0});let w=m;return w})(),kL=0,XI=new ci("MAT_EXPANSION_PANEL_DEFAULT_OPTIONS"),Mv=(()=>{let m=class m extends $I{get hideToggle(){return this._hideToggle||this.accordion&&this.accordion.hideToggle}set hideToggle(u){this._hideToggle=u}get togglePosition(){return this._togglePosition||this.accordion&&this.accordion.togglePosition}set togglePosition(u){this._togglePosition=u}constructor(u,_,r,M,F,q,re){super(u,_,r),this._viewContainerRef=M,this._animationMode=q,this._hideToggle=!1,this.afterExpand=new Ut,this.afterCollapse=new Ut,this._inputChanges=new ei,this._headerId=`mat-expansion-panel-header-${kL++}`,this._bodyAnimationDone=new ei,this.accordion=u,this._document=F,this._bodyAnimationDone.pipe(ng((me,De)=>me.fromState===De.fromState&&me.toState===De.toState)).subscribe(me=>{me.fromState!=="void"&&(me.toState==="expanded"?this.afterExpand.emit():me.toState==="collapsed"&&this.afterCollapse.emit())}),re&&(this.hideToggle=re.hideToggle)}_hasSpacing(){return this.accordion?this.expanded&&this.accordion.displayMode==="default":!1}_getExpandedState(){return this.expanded?"expanded":"collapsed"}toggle(){this.expanded=!this.expanded}close(){this.expanded=!1}open(){this.expanded=!0}ngAfterContentInit(){this._lazyContent&&this._lazyContent._expansionPanel===this&&this.opened.pipe(ho(null),Pr(()=>this.expanded&&!this._portal),Qr(1)).subscribe(()=>{this._portal=new oc(this._lazyContent._template,this._viewContainerRef)})}ngOnChanges(u){this._inputChanges.next(u)}ngOnDestroy(){super.ngOnDestroy(),this._bodyAnimationDone.complete(),this._inputChanges.complete()}_containsFocus(){if(this._body){let u=this._document.activeElement,_=this._body.nativeElement;return u===_||_.contains(u)}return!1}};m.\u0275fac=function(_){return new(_||m)(Xe(Iv,12),Xe(On),Xe(wg),Xe(Za),Xe(vr),Xe(mo,8),Xe(XI,8))},m.\u0275cmp=hi({type:m,selectors:[["mat-expansion-panel"]],contentQueries:function(_,r,M){if(_&1&&Ur(M,TL,5),_&2){let F;Ni(F=ji())&&(r._lazyContent=F.first)}},viewQuery:function(_,r){if(_&1&&Fn(_L,5),_&2){let M;Ni(M=ji())&&(r._body=M.first)}},hostAttrs:[1,"mat-expansion-panel"],hostVars:6,hostBindings:function(_,r){_&2&&_n("mat-expanded",r.expanded)("_mat-animation-noopable",r._animationMode==="NoopAnimations")("mat-expansion-panel-spacing",r._hasSpacing())},inputs:{hideToggle:[ti.HasDecoratorInputTransform,"hideToggle","hideToggle",gn],togglePosition:"togglePosition"},outputs:{afterExpand:"afterExpand",afterCollapse:"afterCollapse"},exportAs:["matExpansionPanel"],standalone:!0,features:[Or([{provide:Iv,useValue:void 0},{provide:WI,useExisting:m}]),nr,po,lr,ui],ngContentSelectors:bL,decls:7,vars:4,consts:[["role","region",1,"mat-expansion-panel-content",3,"id"],["body",""],[1,"mat-expansion-panel-body"],[3,"cdkPortalOutlet"]],template:function(_,r){_&1&&(pr(yL),kn(0),Ue(1,"div",0,1),$t("@bodyExpansion.done",function(F){return r._bodyAnimationDone.next(F)}),Ue(3,"div",2),kn(4,1),bi(5,gL,0,0,"ng-template",3),Ge(),kn(6,2),Ge()),_&2&&(Ze(),Ct("@bodyExpansion",r._getExpandedState())("id",r.id),cr("aria-labelledby",r._headerId),Ze(4),Ct("cdkPortalOutlet",r._portal))},dependencies:[$o],styles:['.mat-expansion-panel{box-sizing:content-box;display:block;margin:0;overflow:hidden;transition:margin 225ms cubic-bezier(0.4, 0, 0.2, 1),box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);position:relative;background:var(--mat-expansion-container-background-color);color:var(--mat-expansion-container-text-color);border-radius:var(--mat-expansion-container-shape)}.mat-expansion-panel:not([class*=mat-elevation-z]){box-shadow:0px 3px 1px -2px rgba(0, 0, 0, 0.2), 0px 2px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12)}.mat-accordion .mat-expansion-panel:not(.mat-expanded),.mat-accordion .mat-expansion-panel:not(.mat-expansion-panel-spacing){border-radius:0}.mat-accordion .mat-expansion-panel:first-of-type{border-top-right-radius:var(--mat-expansion-container-shape);border-top-left-radius:var(--mat-expansion-container-shape)}.mat-accordion .mat-expansion-panel:last-of-type{border-bottom-right-radius:var(--mat-expansion-container-shape);border-bottom-left-radius:var(--mat-expansion-container-shape)}.cdk-high-contrast-active .mat-expansion-panel{outline:solid 1px}.mat-expansion-panel.ng-animate-disabled,.ng-animate-disabled .mat-expansion-panel,.mat-expansion-panel._mat-animation-noopable{transition:none}.mat-expansion-panel-content{display:flex;flex-direction:column;overflow:visible;font-family:var(--mat-expansion-container-text-font);font-size:var(--mat-expansion-container-text-size);font-weight:var(--mat-expansion-container-text-weight);line-height:var(--mat-expansion-container-text-line-height);letter-spacing:var(--mat-expansion-container-text-tracking)}.mat-expansion-panel-content[style*="visibility: hidden"] *{visibility:hidden !important}.mat-expansion-panel-body{padding:0 24px 16px}.mat-expansion-panel-spacing{margin:16px 0}.mat-accordion>.mat-expansion-panel-spacing:first-child,.mat-accordion>*:first-child:not(.mat-expansion-panel) .mat-expansion-panel-spacing{margin-top:0}.mat-accordion>.mat-expansion-panel-spacing:last-child,.mat-accordion>*:last-child:not(.mat-expansion-panel) .mat-expansion-panel-spacing{margin-bottom:0}.mat-action-row{border-top-style:solid;border-top-width:1px;display:flex;flex-direction:row;justify-content:flex-end;padding:16px 8px 16px 24px;border-top-color:var(--mat-expansion-actions-divider-color)}.mat-action-row .mat-button-base,.mat-action-row .mat-mdc-button-base{margin-left:8px}[dir=rtl] .mat-action-row .mat-button-base,[dir=rtl] .mat-action-row .mat-mdc-button-base{margin-left:0;margin-right:8px}'],encapsulation:2,data:{animation:[ZI.bodyExpansion]},changeDetection:0});let w=m;return w})();var Ev=(()=>{let m=class m{constructor(u,_,r,M,F,q,re){this.panel=u,this._element=_,this._focusMonitor=r,this._changeDetectorRef=M,this._animationMode=q,this._parentChangeSubscription=Vr.EMPTY,this.tabIndex=0;let me=u.accordion?u.accordion._stateChanges.pipe(Pr(De=>!!(De.hideToggle||De.togglePosition))):qa;this.tabIndex=parseInt(re||"")||0,this._parentChangeSubscription=Ha(u.opened,u.closed,me,u._inputChanges.pipe(Pr(De=>!!(De.hideToggle||De.disabled||De.togglePosition)))).subscribe(()=>this._changeDetectorRef.markForCheck()),u.closed.pipe(Pr(()=>u._containsFocus())).subscribe(()=>r.focusVia(_,"program")),F&&(this.expandedHeight=F.expandedHeight,this.collapsedHeight=F.collapsedHeight)}get disabled(){return this.panel.disabled}_toggle(){this.disabled||this.panel.toggle()}_isExpanded(){return this.panel.expanded}_getExpandedState(){return this.panel._getExpandedState()}_getPanelId(){return this.panel.id}_getTogglePosition(){return this.panel.togglePosition}_showToggle(){return!this.panel.hideToggle&&!this.panel.disabled}_getHeaderHeight(){let u=this._isExpanded();return u&&this.expandedHeight?this.expandedHeight:!u&&this.collapsedHeight?this.collapsedHeight:null}_keydown(u){switch(u.keyCode){case 32:case 13:rc(u)||(u.preventDefault(),this._toggle());break;default:this.panel.accordion&&this.panel.accordion._handleHeaderKeydown(u);return}}focus(u,_){u?this._focusMonitor.focusVia(this._element,u,_):this._element.nativeElement.focus(_)}ngAfterViewInit(){this._focusMonitor.monitor(this._element).subscribe(u=>{u&&this.panel.accordion&&this.panel.accordion._handleHeaderFocus(this)})}ngOnDestroy(){this._parentChangeSubscription.unsubscribe(),this._focusMonitor.stopMonitoring(this._element)}};m.\u0275fac=function(_){return new(_||m)(Xe(Mv,1),Xe(zn),Xe(Rh),Xe(On),Xe(XI,8),Xe(mo,8),hp("tabindex"))},m.\u0275cmp=hi({type:m,selectors:[["mat-expansion-panel-header"]],hostAttrs:["role","button",1,"mat-expansion-panel-header","mat-focus-indicator"],hostVars:15,hostBindings:function(_,r){_&1&&$t("click",function(){return r._toggle()})("keydown",function(F){return r._keydown(F)}),_&2&&(cr("id",r.panel._headerId)("tabindex",r.disabled?-1:r.tabIndex)("aria-controls",r._getPanelId())("aria-expanded",r._isExpanded())("aria-disabled",r.panel.disabled),Wa("height",r._getHeaderHeight()),_n("mat-expanded",r._isExpanded())("mat-expansion-toggle-indicator-after",r._getTogglePosition()==="after")("mat-expansion-toggle-indicator-before",r._getTogglePosition()==="before")("_mat-animation-noopable",r._animationMode==="NoopAnimations"))},inputs:{expandedHeight:"expandedHeight",collapsedHeight:"collapsedHeight",tabIndex:[ti.HasDecoratorInputTransform,"tabIndex","tabIndex",u=>u==null?0:Fr(u)]},standalone:!0,features:[nr,ui],ngContentSelectors:wL,decls:5,vars:3,consts:[[1,"mat-content"],["class","mat-expansion-indicator"],[1,"mat-expansion-indicator"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 -960 960 960","aria-hidden","true","focusable","false"],["d","M480-345 240-585l56-56 184 184 184-184 56 56-240 240Z"]],template:function(_,r){_&1&&(pr(xL),Ue(0,"span",0),kn(1),kn(2,1),kn(3,2),Ge(),bi(4,vL,3,1,"span",1)),_&2&&(_n("mat-content-hide-toggle",!r._showToggle()),Ze(4),Bo(4,r._showToggle()?4:-1))},styles:['.mat-expansion-panel-header{display:flex;flex-direction:row;align-items:center;padding:0 24px;border-radius:inherit;transition:height 225ms cubic-bezier(0.4, 0, 0.2, 1);height:var(--mat-expansion-header-collapsed-state-height);font-family:var(--mat-expansion-header-text-font);font-size:var(--mat-expansion-header-text-size);font-weight:var(--mat-expansion-header-text-weight);line-height:var(--mat-expansion-header-text-line-height);letter-spacing:var(--mat-expansion-header-text-tracking)}.mat-expansion-panel-header.mat-expanded{height:var(--mat-expansion-header-expanded-state-height)}.mat-expansion-panel-header[aria-disabled=true]{color:var(--mat-expansion-header-disabled-state-text-color)}.mat-expansion-panel-header:not([aria-disabled=true]){cursor:pointer}.mat-expansion-panel:not(.mat-expanded) .mat-expansion-panel-header:not([aria-disabled=true]):hover{background:var(--mat-expansion-header-hover-state-layer-color)}@media(hover: none){.mat-expansion-panel:not(.mat-expanded) .mat-expansion-panel-header:not([aria-disabled=true]):hover{background:var(--mat-expansion-container-background-color)}}.mat-expansion-panel .mat-expansion-panel-header:not([aria-disabled=true]).cdk-keyboard-focused,.mat-expansion-panel .mat-expansion-panel-header:not([aria-disabled=true]).cdk-program-focused{background:var(--mat-expansion-header-focus-state-layer-color)}.mat-expansion-panel-header._mat-animation-noopable{transition:none}.mat-expansion-panel-header:focus,.mat-expansion-panel-header:hover{outline:none}.mat-expansion-panel-header.mat-expanded:focus,.mat-expansion-panel-header.mat-expanded:hover{background:inherit}.mat-expansion-panel-header.mat-expansion-toggle-indicator-before{flex-direction:row-reverse}.mat-expansion-panel-header.mat-expansion-toggle-indicator-before .mat-expansion-indicator{margin:0 16px 0 0}[dir=rtl] .mat-expansion-panel-header.mat-expansion-toggle-indicator-before .mat-expansion-indicator{margin:0 0 0 16px}.mat-content{display:flex;flex:1;flex-direction:row;overflow:hidden}.mat-content.mat-content-hide-toggle{margin-right:8px}[dir=rtl] .mat-content.mat-content-hide-toggle{margin-right:0;margin-left:8px}.mat-expansion-toggle-indicator-before .mat-content.mat-content-hide-toggle{margin-left:24px;margin-right:0}[dir=rtl] .mat-expansion-toggle-indicator-before .mat-content.mat-content-hide-toggle{margin-right:24px;margin-left:0}.mat-expansion-panel-header-title{color:var(--mat-expansion-header-text-color)}.mat-expansion-panel-header-title,.mat-expansion-panel-header-description{display:flex;flex-grow:1;flex-basis:0;margin-right:16px;align-items:center}[dir=rtl] .mat-expansion-panel-header-title,[dir=rtl] .mat-expansion-panel-header-description{margin-right:0;margin-left:16px}.mat-expansion-panel-header[aria-disabled=true] .mat-expansion-panel-header-title,.mat-expansion-panel-header[aria-disabled=true] .mat-expansion-panel-header-description{color:inherit}.mat-expansion-panel-header-description{flex-grow:2;color:var(--mat-expansion-header-description-color)}.mat-expansion-indicator::after{border-style:solid;border-width:0 2px 2px 0;content:"";display:inline-block;padding:3px;transform:rotate(45deg);vertical-align:middle;color:var(--mat-expansion-header-indicator-color);display:inline-block;display:var(--mat-expansion-legacy-header-indicator-display, inline-block)}.mat-expansion-indicator svg{width:24px;height:24px;margin:0 -8px;vertical-align:middle;fill:var(--mat-expansion-header-indicator-color);display:none;display:var(--mat-expansion-header-indicator-display, none)}.cdk-high-contrast-active .mat-expansion-panel-content{border-top:1px solid;border-top-left-radius:0;border-top-right-radius:0}'],encapsulation:2,data:{animation:[ZI.indicatorRotate]},changeDetection:0});let w=m;return w})();var YI=(()=>{let m=class m{};m.\u0275fac=function(_){return new(_||m)},m.\u0275dir=fn({type:m,selectors:[["mat-panel-title"]],hostAttrs:[1,"mat-expansion-panel-header-title"],standalone:!0});let w=m;return w})(),KI=(()=>{let m=class m extends GI{constructor(){super(...arguments),this._ownHeaders=new _p,this.hideToggle=!1,this.displayMode="default",this.togglePosition="after"}ngAfterContentInit(){this._headers.changes.pipe(ho(this._headers)).subscribe(u=>{this._ownHeaders.reset(u.filter(_=>_.panel.accordion===this)),this._ownHeaders.notifyOnChanges()}),this._keyManager=new yg(this._ownHeaders).withWrap().withHomeAndEnd()}_handleHeaderKeydown(u){this._keyManager.onKeydown(u)}_handleHeaderFocus(u){this._keyManager.updateActiveItem(u)}ngOnDestroy(){super.ngOnDestroy(),this._keyManager?.destroy(),this._ownHeaders.destroy()}};m.\u0275fac=(()=>{let u;return function(r){return(u||(u=gd(m)))(r||m)}})(),m.\u0275dir=fn({type:m,selectors:[["mat-accordion"]],contentQueries:function(_,r,M){if(_&1&&Ur(M,Ev,5),_&2){let F;Ni(F=ji())&&(r._headers=F)}},hostAttrs:[1,"mat-accordion"],hostVars:2,hostBindings:function(_,r){_&2&&_n("mat-accordion-multi",r.multi)},inputs:{hideToggle:[ti.HasDecoratorInputTransform,"hideToggle","hideToggle",gn],displayMode:"displayMode",togglePosition:"togglePosition"},exportAs:["matAccordion"],standalone:!0,features:[Or([{provide:Iv,useExisting:m}]),nr,po]});let w=m;return w})(),QI=(()=>{let m=class m{};m.\u0275fac=function(_){return new(_||m)},m.\u0275mod=Un({type:m}),m.\u0275inj=Vn({imports:[qn,qI,sl]});let w=m;return w})();function Av(w){if(!Array.isArray(w))throw new Error("Expected input to be an array.");if(w.length<2)throw new Error("Expected input to be an array with length >= 2, got "+w.length+".");if(w.some(function(m){return!Number.isFinite(m)}))throw new Error("Expected all coordinates to be finite numbers.")}function eS(w,m,x){return(x/60+m)/60+w}function t0(w){return 180*w/Math.PI}function iu(w){return w*Math.PI/180}function tS(w,m){return{apply:function(x){var u=x[0],_=x[1],r=x.slice(2);return[u+w,_+m].concat(r)},unapply:function(x){var u=x[0],_=x[1],r=x.slice(2);return[u-w,_-m].concat(r)}}}Number.isFinite===void 0&&(Number.isFinite=function(w){return typeof w=="number"&&isFinite(w)});var iS=tS(6e5,2e5),SL=iS.apply,CL=iS.unapply;var nS=tS(26e5,12e5),z4=nS.apply,ML=nS.unapply;function rS(w,m){var x=1/m,u=2*x-Math.pow(x,2);return{fromCartesian:function(_){var r,M,F,q,re,me=_[0],De=_[1],$e=_[2],Mt=Math.atan(De/me),Ui=Math.sqrt(Math.pow(me,2)+Math.pow(De,2)),Hi=Math.atan($e/((1-u)*Ui));do r=M,F=q,q=w/Math.sqrt(1-u*Math.pow(Math.sin(Hi),2)),re=Ui/Math.cos(Hi)-q,Hi=Math.atan($e/((1-u*q/(q+re))*Ui)),M=Math.abs(q-F);while(isNaN(r)||M<r);var mi=t0(Hi);return[t0(Mt),mi,re]},toCartesian:function(_){var r=_[0],M=_[2],F=M===void 0?0:M,q=iu(_[1]),re=iu(r),me=w/Math.sqrt(1-u*Math.pow(Math.sin(q),2));return[(me+F)*Math.cos(q)*Math.cos(re),(me+F)*Math.cos(q)*Math.sin(re),(me*(1-u)+F)*Math.sin(q)]}}}var oS=rS(6377397155e-3,299.15281285),EL=oS.fromCartesian,AL=oS.toCartesian,aS=rS(6378137,298.257223563),DL=aS.fromCartesian,PL=aS.toCartesian,JI=1/299.15281285,tu=iu(eS(46,57,8.66)),sS=iu(eS(7,26,22.5)),tf=2*JI-Math.pow(JI,2),i0=6377397155e-3*Math.sqrt(1-tf)/(1-tf*Math.pow(Math.sin(tu),2)),mc=Math.sqrt(1+tf/(1-tf)*Math.pow(Math.cos(tu),4)),ul=Math.asin(Math.sin(tu)/mc),pc=Math.sqrt(tf),lS=Math.log(Math.tan(Math.PI/4+ul/2))-mc*Math.log(Math.tan(Math.PI/4+tu/2))+mc*pc/2*Math.log((1+pc*Math.sin(tu))/(1-pc*Math.sin(tu)));function RL(w){var m,x=[(m=PL(w))[0]-674.374,m[1]-15.056,m[2]-405.346],u=EL(x),_=function(r){var M=r[0],F=iu(r[1]),q=iu(M),re=mc*Math.log(Math.tan(Math.PI/4+F/2))-mc*pc/2*Math.log((1+pc*Math.sin(F))/(1-pc*Math.sin(F)))+lS,me=2*(Math.atan(Math.exp(re))-Math.PI/4),De=mc*(q-sS),$e=Math.asin(Math.cos(ul)*Math.sin(me)-Math.sin(ul)*Math.cos(me)*Math.cos(De)),Mt=Math.atan(Math.sin(De)/(Math.sin(ul)*Math.tan(me)+Math.cos(ul)*Math.cos(De)));return[i0*Mt,i0/2*Math.log((1+Math.sin($e))/(1-Math.sin($e)))]}(u);return w.length>2?[].concat(_,[u[2]]):_}function cS(w){var m=function(r){var M,F,q,re,me=r[0],De=2*(Math.atan(Math.exp(r[1]/i0))-Math.PI/4),$e=me/i0,Mt=Math.asin(Math.cos(ul)*Math.sin(De)+Math.sin(ul)*Math.cos(De)*Math.cos($e)),Ui=Math.atan(Math.sin($e)/(Math.cos(ul)*Math.cos($e)-Math.sin(ul)*Math.tan(De))),Hi=sS+Ui/mc,mi=Mt;do M=F,q=re,re=(Math.log(Math.tan(Math.PI/4+Mt/2))-lS)/mc+pc*Math.log(Math.tan(Math.PI/4+Math.asin(pc*Math.sin(mi))/2)),mi=2*Math.atan(Math.exp(re))-Math.PI/2,F=Math.abs(re-q);while(isNaN(M)||F<M);var Yn=t0(mi);return[t0(Hi),Yn]}(w);m.push(w[2]);var x,u=[(x=AL(m))[0]+674.374,x[1]+15.056,x[2]+405.346],_=DL(u);return w.length>2?_:_.slice(0,2)}var dS={__proto__:null,project:function(w){return Av(w),SL(RL(w))},unproject:function(w){return Av(w),cS(CL(w))}};function LL(w){return Av(w),cS(ML(w))}var hS=LL;function uS(w,m){let[x,u]=hS([w,m]);return{latitude:u,longitude:x}}function mS(w,m){let[x,u]=dS.unproject([w,m]);return{latitude:u,longitude:x}}function fS(w,m,x=1){return ir(this,null,function*(){return new Promise(u=>{let _=[],r=[],M=null;w.bbox!==void 0&&m.bbox!==void 0&&(M=Dv([w.bbox,m.bbox]));let F=pS(w,M,x),q=pS(m,M,x);for(let re of F){let me=null,De=1/0,$e=re.geometry.coordinates;for(let Mt of q){let Ui=Mt.geometry.coordinates,Hi=zL($e,Ui);Hi<De&&(De=Hi,me=Mt)}if(De<=x&&me){let Mt={type:"Feature",geometry:{type:"LineString",coordinates:[$e,me.geometry.coordinates]},properties:{distance:De,connectingPoint:re.properties,connectedPoint:me.properties}};_.push({featureA:re,featureB:me,distance:De,connection:Mt})}else r.push(re)}u({successful:_,unsuccesful:r})})})}function Dv(w){if(!w.length)return null;let m=-1/0,x=-1/0,u=1/0,_=1/0;for(let r of w)m=Math.max(m,r[0]),x=Math.max(x,r[1]),u=Math.min(u,r[2]),_=Math.min(_,r[3]);return m>u||x>_?null:[m,x,u,_]}function _S(w,m,x=1){let[u,_]=w,[r,M,F,q]=m,re=r-x/(111132*Math.cos(Math.PI*(M/180))),me=M-x/111132,De=F+x/(111132*Math.cos(Math.PI*(M/180))),$e=q+x/111132;return u>=re&&u<=De&&_>=me&&_<=$e}function gS(w){return ir(this,null,function*(){return new Promise(m=>{let x=1/0,u=1/0,_=-1/0,r=-1/0;for(let M of w)x=Math.min(x,M[0]),u=Math.min(u,M[1]),_=Math.max(_,M[0]),r=Math.max(r,M[1]);m([x,u,_,r])})})}function zL(w,m){let[x,u]=w,[_,r]=m,M=6371e3,F=n0(u),q=n0(r),re=n0(r-u),me=n0(_-x),De=Math.sin(re/2)*Math.sin(re/2)+Math.cos(F)*Math.cos(q)*Math.sin(me/2)*Math.sin(me/2),$e=2*Math.atan2(Math.sqrt(De),Math.sqrt(1-De));return M*$e}function pS(w,m=null,x=0){let u=w.features.filter(_=>_.geometry.type.toLowerCase()==="point").filter(_=>_.geometry.coordinates!==void 0).filter(_=>m?_S(_.geometry.coordinates,m,x):!0);return u===void 0?[]:u}function yS(w,m=null,x=0){return w.features=w.features.filter(u=>u.geometry.type.toLowerCase()==="point").filter(u=>u.geometry.coordinates!==void 0).filter(u=>m?_S(u.geometry.coordinates,m,x):!0)??[],w}function n0(w){return w*Math.PI/180}function bS(w,m){return{type:"Feature",geometry:{type:"Point",coordinates:w},properties:m}}function nu(w,m=!0){return ir(this,null,function*(){let x={type:"FeatureCollection",features:w};if(m){let u=[];w.forEach(_=>{_.geometry.coordinates!==void 0&&u.push(_.geometry.coordinates)}),x.bbox=yield gS(u)}return x})}function OL(w,m="data.zip"){let x=document.createElement("a"),u=URL.createObjectURL(w);x.href=u,x.download=m,document.body.appendChild(x),x.click(),document.body.removeChild(x),URL.revokeObjectURL(u)}function nf(w,m){let x=JSON.stringify(w);return FL(x,m+".json","text/json")}function FL(w,m,x="text/plain"){let u=new Blob([w],{type:x});return OL(u,m)}function BL(w,m){if(w&1&&(Ue(0,"mat-option",2),Bt(1),Ge()),w&2){let x=m.$implicit;Ct("value",x.value),Ze(),hn(x.label)}}var fc=function(w){return w.LV03="SwissGrid LV03",w.LV95="SwissGrid LV95",w}(fc||{}),vS=(()=>{let m=class m{constructor(){this.crsOptions=Object.values(fc).map(u=>({value:u,label:u.toString()})),this.selectedOption=fc.LV95,this.selectedCRS=new Ut,this.selectedCRS.emit(fc.LV95)}};m.\u0275fac=function(_){return new(_||m)},m.\u0275cmp=hi({type:m,selectors:[["app-crs-select"]],outputs:{selectedCRS:"selectedCRS"},standalone:!0,features:[ui],decls:6,vars:1,consts:[[2,"width","100%"],[3,"ngModel","ngModelChange","selectionChange"],[3,"value"]],template:function(_,r){_&1&&(Ue(0,"mat-form-field",0)(1,"mat-label"),Bt(2,"CRS"),Ge(),Ue(3,"mat-select",1),$t("ngModelChange",function(F){return r.selectedOption=F})("selectionChange",function(){return r.selectedCRS.emit(r.selectedOption)}),Lr(4,BL,2,2,"mat-option",2,No),Ge()()),_&2&&(Ze(3),Ct("ngModel",r.selectedOption),Ze(),zr(r.crsOptions))},dependencies:[In,Ms,Bh,Fh,Cs,Ss,Ig,Is,Ts,ks]});let w=m;return w})();var NL=()=>[vS],jL=()=>[import("./chunk-IUH45MVL.js").then(w=>w.LayerListComponent)],VL=()=>[import("./chunk-D3EL2JKS.js").then(w=>w.FindByNameComponent)];function UL(w,m){if(w&1&&(pp(0),Ue(1,"span"),Bt(2),Ge(),fp()),w&2){let x=Dt();Ze(2),hn(x.txt().dxfAnalyzerInstructions)}}function GL(w,m){if(w&1){let x=dn();Ue(0,"button",6),$t("click",function(){Xi(x);let _=Dt(2);return Yi(_.downloadGeoJSON())}),Ue(1,"mat-icon"),Bt(2,"download"),Ge(),Bt(3),Ge()}if(w&2){let x=Dt(2);Ze(3),rr(" ",x.txt().downloadSelectionGeoJSON," ")}}function $L(w,m){if(w&1&&(pp(0),Ue(1,"span"),Bt(2),Ge(),Ue(3,"div",4),bi(4,GL,4,1,"button",5),Ge(),fp()),w&2){let x=Dt();Ze(2),rr("",x.selection.length," elements in selection"),Ze(2),Ct("ngIf",x.selection.length)}}function qL(w,m){w&1&&Ki(0,"app-crs-select")}function HL(w,m){if(w&1){let x=dn();Ue(0,"app-layer-list",7),$t("selection",function(_){Xi(x);let r=Dt();return Yi(r.updateSelection(_))}),Ge()}}function ZL(w,m){if(w&1){let x=dn();Ue(0,"app-find-by-name",7),$t("selection",function(_){Xi(x);let r=Dt();return Yi(r.updateSelection(_))}),Ge()}}var xS=(()=>{let m=class m{constructor(){this._translationService=St(jh),this.txt=this._translationService.translatedContent,this.showOnMap=new Ut,this.selectedCRS=fc.LV95,this.selection=[],this.crsSelectVisible=!1,this.analyzeLayersVisible=!1,this.findByNameVisible=!1}updateSelection(u){return ir(this,null,function*(){this.selection=u;let _=yield this._buildGeoJSON();this.showOnMap.emit(_)})}downloadGeoJSON(){return ir(this,null,function*(){let u=yield this._buildGeoJSON();nf(u,"export.geojson")})}setCRS(u){this.selectedCRS=u}_buildGeoJSON(){return ir(this,null,function*(){let u=[];return this.selection.forEach(_=>{if(_.position!==void 0){let r=0,M=0;if(this.selectedCRS===fc.LV95){let q=uS(_.position.x,_.position.y);r=q.latitude,M=q.longitude}else if(this.selectedCRS===fc.LV03){let q=mS(_.position.x,_.position.y);r=q.latitude,M=q.longitude}let F=bS([M,r],_);u.push(F)}}),nu(u)})}};m.\u0275fac=function(_){return new(_||m)},m.\u0275cmp=hi({type:m,selectors:[["app-dxf-analyzer"]],outputs:{showOnMap:"showOnMap"},standalone:!0,features:[ui],decls:25,vars:8,consts:[[1,"toolbar"],[4,"ngIf"],[3,"click"],[3,"selectedCRS"],[1,"row"],["mat-stroked-button","",3,"click",4,"ngIf"],["mat-stroked-button","",3,"click"],[3,"selection"]],template:function(_,r){_&1&&(Ue(0,"div",0),bi(1,UL,3,1,"ng-container",1)(2,$L,5,2,"ng-container",1),Ge(),Ue(3,"mat-accordion")(4,"mat-expansion-panel")(5,"mat-expansion-panel-header",2),$t("click",function(){return r.crsSelectVisible=!0}),Ue(6,"mat-panel-title",3),$t("selectedCRS",function(F){return r.setCRS(F)}),Bt(7),Ge()(),bi(8,qL,1,0),ug(9,8,NL),Ge(),Ue(11,"mat-expansion-panel")(12,"mat-expansion-panel-header",2),$t("click",function(){return r.analyzeLayersVisible=!0}),Ue(13,"mat-panel-title"),Bt(14),Ge()(),bi(15,HL,1,0),ug(16,15,jL),Ge(),Ue(18,"mat-expansion-panel")(19,"mat-expansion-panel-header",2),$t("click",function(){return r.findByNameVisible=!0}),Ue(20,"mat-panel-title"),Bt(21),Ge()(),bi(22,ZL,1,0),ug(23,22,VL),Ge()()),_&2&&(Ze(),Ct("ngIf",!r.selection.length),Ze(),Ct("ngIf",r.selection.length),Ze(5),hn(r.txt().selectCRS),Ze(2),mg(r.crsSelectVisible),Ze(5),hn(r.txt().analyzeLayers),Ze(2),mg(r.analyzeLayersVisible),Ze(5),hn(r.txt().findByEntityName),Ze(2),mg(r.findByNameVisible))},dependencies:[In,jo,qo,Es,xa,va,QI,KI,Mv,Ev,YI],styles:[".toolbar[_ngcontent-%COMP%]{border-radius:5px;border:3px solid khaki;padding:10px;margin-bottom:30px;display:flex;flex-direction:column;align-items:center;gap:10px}.row[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:center;gap:10px}"]});let w=m;return w})();function Pv(w){return ir(this,null,function*(){return new Promise((m,x)=>{let u=document.createElement("input");u.style.display="none",u.setAttribute("type","file"),w!==void 0&&u.setAttribute("accept",w),document.body.appendChild(u),u.click(),u.addEventListener("change",_=>{let r=_.target?.files[0];u.remove(),r&&m(r),x()})})})}function wS(w=".json,.JSON"){return ir(this,null,function*(){let m=yield Pv(w);return new Promise((x,u)=>{let _=new FileReader;_.readAsText(m),_.onload=()=>{let r=_.result;(typeof r=="string"||r instanceof String)&&x(JSON.parse(r)),u("Not a string")},_.onerror=()=>{u("File read failed")}})})}var WL=new ci("MAT_PROGRESS_BAR_DEFAULT_OPTIONS");var kS=(()=>{let m=class m{constructor(u,_,r,M,F){this._elementRef=u,this._ngZone=_,this._changeDetectorRef=r,this._animationMode=M,this._isNoopAnimation=!1,this._defaultColor="primary",this._value=0,this._bufferValue=0,this.animationEnd=new Ut,this._mode="determinate",this._transitionendHandler=q=>{this.animationEnd.observers.length===0||!q.target||!q.target.classList.contains("mdc-linear-progress__primary-bar")||(this.mode==="determinate"||this.mode==="buffer")&&this._ngZone.run(()=>this.animationEnd.next({value:this.value}))},this._isNoopAnimation=M==="NoopAnimations",F&&(F.color&&(this.color=this._defaultColor=F.color),this.mode=F.mode||this.mode)}get color(){return this._color||this._defaultColor}set color(u){this._color=u}get value(){return this._value}set value(u){this._value=TS(u||0),this._changeDetectorRef.markForCheck()}get bufferValue(){return this._bufferValue||0}set bufferValue(u){this._bufferValue=TS(u||0),this._changeDetectorRef.markForCheck()}get mode(){return this._mode}set mode(u){this._mode=u,this._changeDetectorRef.markForCheck()}ngAfterViewInit(){this._ngZone.runOutsideAngular(()=>{this._elementRef.nativeElement.addEventListener("transitionend",this._transitionendHandler)})}ngOnDestroy(){this._elementRef.nativeElement.removeEventListener("transitionend",this._transitionendHandler)}_getPrimaryBarTransform(){return`scaleX(${this._isIndeterminate()?1:this.value/100})`}_getBufferBarFlexBasis(){return`${this.mode==="buffer"?this.bufferValue:100}%`}_isIndeterminate(){return this.mode==="indeterminate"||this.mode==="query"}};m.\u0275fac=function(_){return new(_||m)(Xe(zn),Xe(Dn),Xe(On),Xe(mo,8),Xe(WL,8))},m.\u0275cmp=hi({type:m,selectors:[["mat-progress-bar"]],hostAttrs:["role","progressbar","aria-valuemin","0","aria-valuemax","100","tabindex","-1",1,"mat-mdc-progress-bar","mdc-linear-progress"],hostVars:10,hostBindings:function(_,r){_&2&&(cr("aria-valuenow",r._isIndeterminate()?null:r.value)("mode",r.mode),yd("mat-"+r.color),_n("_mat-animation-noopable",r._isNoopAnimation)("mdc-linear-progress--animation-ready",!r._isNoopAnimation)("mdc-linear-progress--indeterminate",r._isIndeterminate()))},inputs:{color:"color",value:[ti.HasDecoratorInputTransform,"value","value",Fr],bufferValue:[ti.HasDecoratorInputTransform,"bufferValue","bufferValue",Fr],mode:"mode"},outputs:{animationEnd:"animationEnd"},exportAs:["matProgressBar"],standalone:!0,features:[nr,ui],decls:7,vars:4,consts:[["aria-hidden","true",1,"mdc-linear-progress__buffer"],[1,"mdc-linear-progress__buffer-bar"],[1,"mdc-linear-progress__buffer-dots"],["aria-hidden","true",1,"mdc-linear-progress__bar","mdc-linear-progress__primary-bar"],[1,"mdc-linear-progress__bar-inner"],["aria-hidden","true",1,"mdc-linear-progress__bar","mdc-linear-progress__secondary-bar"]],template:function(_,r){_&1&&(Ue(0,"div",0),Ki(1,"div",1)(2,"div",2),Ge(),Ue(3,"div",3),Ki(4,"span",4),Ge(),Ue(5,"div",5),Ki(6,"span",4),Ge()),_&2&&(Ze(),Wa("flex-basis",r._getBufferBarFlexBasis()),Ze(2),Wa("transform",r._getPrimaryBarTransform()))},styles:[`@keyframes mdc-linear-progress-primary-indeterminate-translate{0%{transform:translateX(0)}20%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(0)}59.15%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(var(--mdc-linear-progress-primary-half))}100%{transform:translateX(var(--mdc-linear-progress-primary-full))}}@keyframes mdc-linear-progress-primary-indeterminate-scale{0%{transform:scaleX(0.08)}36.65%{animation-timing-function:cubic-bezier(0.334731, 0.12482, 0.785844, 1);transform:scaleX(0.08)}69.15%{animation-timing-function:cubic-bezier(0.06, 0.11, 0.6, 1);transform:scaleX(0.661479)}100%{transform:scaleX(0.08)}}@keyframes mdc-linear-progress-secondary-indeterminate-translate{0%{animation-timing-function:cubic-bezier(0.15, 0, 0.515058, 0.409685);transform:translateX(0)}25%{animation-timing-function:cubic-bezier(0.31033, 0.284058, 0.8, 0.733712);transform:translateX(var(--mdc-linear-progress-secondary-quarter))}48.35%{animation-timing-function:cubic-bezier(0.4, 0.627035, 0.6, 0.902026);transform:translateX(var(--mdc-linear-progress-secondary-half))}100%{transform:translateX(var(--mdc-linear-progress-secondary-full))}}@keyframes mdc-linear-progress-secondary-indeterminate-scale{0%{animation-timing-function:cubic-bezier(0.205028, 0.057051, 0.57661, 0.453971);transform:scaleX(0.08)}19.15%{animation-timing-function:cubic-bezier(0.152313, 0.196432, 0.648374, 1.004315);transform:scaleX(0.457104)}44.15%{animation-timing-function:cubic-bezier(0.257759, -0.003163, 0.211762, 1.38179);transform:scaleX(0.72796)}100%{transform:scaleX(0.08)}}@keyframes mdc-linear-progress-primary-indeterminate-translate-reverse{0%{transform:translateX(0)}20%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(0)}59.15%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(var(--mdc-linear-progress-primary-half-neg))}100%{transform:translateX(var(--mdc-linear-progress-primary-full-neg))}}@keyframes mdc-linear-progress-secondary-indeterminate-translate-reverse{0%{animation-timing-function:cubic-bezier(0.15, 0, 0.515058, 0.409685);transform:translateX(0)}25%{animation-timing-function:cubic-bezier(0.31033, 0.284058, 0.8, 0.733712);transform:translateX(var(--mdc-linear-progress-secondary-quarter-neg))}48.35%{animation-timing-function:cubic-bezier(0.4, 0.627035, 0.6, 0.902026);transform:translateX(var(--mdc-linear-progress-secondary-half-neg))}100%{transform:translateX(var(--mdc-linear-progress-secondary-full-neg))}}@keyframes mdc-linear-progress-buffering-reverse{from{transform:translateX(-10px)}}.mdc-linear-progress{position:relative;width:100%;transform:translateZ(0);outline:1px solid rgba(0,0,0,0);overflow-x:hidden;transition:opacity 250ms 0ms cubic-bezier(0.4, 0, 0.6, 1)}@media screen and (forced-colors: active){.mdc-linear-progress{outline-color:CanvasText}}.mdc-linear-progress__bar{position:absolute;top:0;bottom:0;margin:auto 0;width:100%;animation:none;transform-origin:top left;transition:transform 250ms 0ms cubic-bezier(0.4, 0, 0.6, 1)}.mdc-linear-progress__bar-inner{display:inline-block;position:absolute;width:100%;animation:none;border-top-style:solid}.mdc-linear-progress__buffer{display:flex;position:absolute;top:0;bottom:0;margin:auto 0;width:100%;overflow:hidden}.mdc-linear-progress__buffer-dots{background-repeat:repeat-x;flex:auto;transform:rotate(180deg);-webkit-mask-image:url("data:image/svg+xml,%3Csvg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' enable-background='new 0 0 5 2' xml:space='preserve' viewBox='0 0 5 2' preserveAspectRatio='xMinYMin slice'%3E%3Ccircle cx='1' cy='1' r='1'/%3E%3C/svg%3E");mask-image:url("data:image/svg+xml,%3Csvg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' enable-background='new 0 0 5 2' xml:space='preserve' viewBox='0 0 5 2' preserveAspectRatio='xMinYMin slice'%3E%3Ccircle cx='1' cy='1' r='1'/%3E%3C/svg%3E");animation:mdc-linear-progress-buffering 250ms infinite linear}.mdc-linear-progress__buffer-bar{flex:0 1 100%;transition:flex-basis 250ms 0ms cubic-bezier(0.4, 0, 0.6, 1)}.mdc-linear-progress__primary-bar{transform:scaleX(0)}.mdc-linear-progress__secondary-bar{display:none}.mdc-linear-progress--indeterminate .mdc-linear-progress__bar{transition:none}.mdc-linear-progress--indeterminate .mdc-linear-progress__primary-bar{left:-145.166611%}.mdc-linear-progress--indeterminate .mdc-linear-progress__secondary-bar{left:-54.888891%;display:block}.mdc-linear-progress--indeterminate.mdc-linear-progress--animation-ready .mdc-linear-progress__primary-bar{animation:mdc-linear-progress-primary-indeterminate-translate 2s infinite linear}.mdc-linear-progress--indeterminate.mdc-linear-progress--animation-ready .mdc-linear-progress__primary-bar>.mdc-linear-progress__bar-inner{animation:mdc-linear-progress-primary-indeterminate-scale 2s infinite linear}.mdc-linear-progress--indeterminate.mdc-linear-progress--animation-ready .mdc-linear-progress__secondary-bar{animation:mdc-linear-progress-secondary-indeterminate-translate 2s infinite linear}.mdc-linear-progress--indeterminate.mdc-linear-progress--animation-ready .mdc-linear-progress__secondary-bar>.mdc-linear-progress__bar-inner{animation:mdc-linear-progress-secondary-indeterminate-scale 2s infinite linear}[dir=rtl] .mdc-linear-progress:not([dir=ltr]) .mdc-linear-progress__bar,.mdc-linear-progress[dir=rtl]:not([dir=ltr]) .mdc-linear-progress__bar{right:0;-webkit-transform-origin:center right;transform-origin:center right}[dir=rtl] .mdc-linear-progress:not([dir=ltr]).mdc-linear-progress--animation-ready .mdc-linear-progress__primary-bar,.mdc-linear-progress[dir=rtl]:not([dir=ltr]).mdc-linear-progress--animation-ready .mdc-linear-progress__primary-bar{animation-name:mdc-linear-progress-primary-indeterminate-translate-reverse}[dir=rtl] .mdc-linear-progress:not([dir=ltr]).mdc-linear-progress--animation-ready .mdc-linear-progress__secondary-bar,.mdc-linear-progress[dir=rtl]:not([dir=ltr]).mdc-linear-progress--animation-ready .mdc-linear-progress__secondary-bar{animation-name:mdc-linear-progress-secondary-indeterminate-translate-reverse}[dir=rtl] .mdc-linear-progress:not([dir=ltr]) .mdc-linear-progress__buffer-dots,.mdc-linear-progress[dir=rtl]:not([dir=ltr]) .mdc-linear-progress__buffer-dots{animation:mdc-linear-progress-buffering-reverse 250ms infinite linear;transform:rotate(0)}[dir=rtl] .mdc-linear-progress:not([dir=ltr]).mdc-linear-progress--indeterminate .mdc-linear-progress__primary-bar,.mdc-linear-progress[dir=rtl]:not([dir=ltr]).mdc-linear-progress--indeterminate .mdc-linear-progress__primary-bar{right:-145.166611%;left:auto}[dir=rtl] .mdc-linear-progress:not([dir=ltr]).mdc-linear-progress--indeterminate .mdc-linear-progress__secondary-bar,.mdc-linear-progress[dir=rtl]:not([dir=ltr]).mdc-linear-progress--indeterminate .mdc-linear-progress__secondary-bar{right:-54.888891%;left:auto}.mdc-linear-progress--closed{opacity:0}.mdc-linear-progress--closed-animation-off .mdc-linear-progress__buffer-dots{animation:none}.mdc-linear-progress--closed-animation-off.mdc-linear-progress--indeterminate .mdc-linear-progress__bar,.mdc-linear-progress--closed-animation-off.mdc-linear-progress--indeterminate .mdc-linear-progress__bar .mdc-linear-progress__bar-inner{animation:none}@keyframes mdc-linear-progress-buffering{from{transform:rotate(180deg) translateX(calc(var(--mdc-linear-progress-track-height) * -2.5))}}.mdc-linear-progress__bar-inner{border-color:var(--mdc-linear-progress-active-indicator-color)}.mdc-linear-progress__buffer-dots{background-color:var(--mdc-linear-progress-track-color)}@media(forced-colors: active){.mdc-linear-progress__buffer-dots{background-color:ButtonBorder}}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){.mdc-linear-progress__buffer-dots{background-color:rgba(0,0,0,0);background-image:url("data:image/svg+xml,%3Csvg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' enable-background='new 0 0 5 2' xml:space='preserve' viewBox='0 0 5 2' preserveAspectRatio='none slice'%3E%3Ccircle cx='1' cy='1' r='1' fill='rgba(244, 67, 54, 0.25)'/%3E%3C/svg%3E")}}.mdc-linear-progress__buffer-bar{background-color:var(--mdc-linear-progress-track-color)}.mdc-linear-progress{height:max(var(--mdc-linear-progress-track-height), var(--mdc-linear-progress-active-indicator-height))}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){.mdc-linear-progress{height:4px}}.mdc-linear-progress__bar{height:var(--mdc-linear-progress-active-indicator-height)}.mdc-linear-progress__bar-inner{border-top-width:var(--mdc-linear-progress-active-indicator-height)}.mdc-linear-progress__buffer{height:var(--mdc-linear-progress-track-height)}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){.mdc-linear-progress__buffer-dots{background-size:10px var(--mdc-linear-progress-track-height)}}.mdc-linear-progress__buffer{border-radius:var(--mdc-linear-progress-track-shape)}.mat-mdc-progress-bar{display:block;text-align:start;--mdc-linear-progress-primary-half: 83.67142%;--mdc-linear-progress-primary-full: 200.611057%;--mdc-linear-progress-secondary-quarter: 37.651913%;--mdc-linear-progress-secondary-half: 84.386165%;--mdc-linear-progress-secondary-full: 160.277782%;--mdc-linear-progress-primary-half-neg: -83.67142%;--mdc-linear-progress-primary-full-neg: -200.611057%;--mdc-linear-progress-secondary-quarter-neg: -37.651913%;--mdc-linear-progress-secondary-half-neg: -84.386165%;--mdc-linear-progress-secondary-full-neg: -160.277782%}.mat-mdc-progress-bar[mode=query]{transform:scaleX(-1)}.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__buffer-dots,.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__primary-bar,.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__secondary-bar,.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__bar-inner.mdc-linear-progress__bar-inner{animation:none}.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__primary-bar,.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__buffer-bar{transition:transform 1ms}`],encapsulation:2,changeDetection:0});let w=m;return w})();function TS(w,m=0,x=100){return Math.max(m,Math.min(x,w))}var IS=(()=>{let m=class m{};m.\u0275fac=function(_){return new(_||m)},m.\u0275mod=Un({type:m}),m.\u0275inj=Vn({imports:[qn]});let w=m;return w})();var r0=ob(CS());var zv=(()=>{let m=class m{constructor(){this._themeService=St(uc),this.center=[8.5,47.4],this.zoom=2,this.clickedMap=new Ut,this.clickedFeature=new Ut,this.hoveredFeature=new Ut,this._darkMode=this._themeService.darkMode,this._styleId=cg(()=>this._darkMode()?"dark-v11":"light-v11"),this._sourceIds=[],this._storeReady=new Promise(u=>{this._mapReadyPromiseResolve=u}),this._sources={},this._sourceLayers={},hg(()=>{this._map!==void 0&&this._updateStyle()})}get sources(){return this._sources}ngOnChanges(u){u.center&&this._map?.flyTo({center:this.center,essential:!0}),u.zoom&&this._map?.flyTo({center:this.center,zoom:this.zoom,essential:!0})}ngAfterViewInit(){this._init()}loadGeoJSON(u,_,r,M=!0){this.addSource(u,{type:"geojson",data:_,cluster:M},r),this.fitGeoJSONBBOX(_)}fitGeoJSONBBOX(u){return ir(this,null,function*(){let _=u.bbox;_!==void 0&&(yield this._mapReadyPromiseResolve(),this._map?.fitBounds([[_[0],_[1]],[_[2],_[3]]]))})}addSource(u,_,r,M=!0){return ir(this,null,function*(){this._sources[u]=_,yield this._mapReadyPromiseResolve(),this._map!==void 0&&(this._deleteSourceIfExists(u),this._sourceIds.push(u),this._map?.addSource(u,_),r!==void 0&&this.addSourceLayer(u,r,M))})}addSourceLayer(u,_,r=!0){this._sourceLayers[u]={layer:_,clickable:r},this._map?.addLayer(_),r&&this._setLayerEvents()}zoomToCoordinate(u){let _=this._map?.getZoom();if(!_)return;let r=_+1;this._map?.flyTo({center:u,zoom:r})}_deleteSourceIfExists(u){this._map?.getSource(u)!==void 0&&(this._map?.removeLayer(`${u}-layer`),this._map?.removeSource(u))}_init(){r0.default.accessToken="pk.eyJ1IjoibWFkc2hvbHRlbiIsImEiOiJjbHZjZGprOHQwMWxnMm5tdnZ4amVpdG85In0.FddkqYy2LDkXH8xfCNYbjg",this._map=new r0.Map({container:"map",style:this._getMapStyleURL(),center:this.center,zoom:this.zoom}),this._mapReadyPromiseResolve(),this._initEventListeners(this._map)}_initEventListeners(u){u.on("click","dxf",_=>{console.log(_)}),u.on("click",_=>{console.log(_),this.clickedMap.emit(_.lngLat)})}_getMapStyleURL(){return`mapbox://styles/mapbox/${this._styleId()}`}_updateStyle(){if(this._map===void 0)return;let u=this._map.getZoom(),_=this._map.getCenter();this._init(),setTimeout(()=>{this._reAppendLayers(),this._map?.flyTo({center:_,zoom:u})},500)}_reAppendLayers(){Object.keys(this._sources).forEach(u=>{this._map?.addSource(u,this._sources[u]),this._map?.addLayer(this._sourceLayers[u].layer)}),this._setLayerEvents()}_setLayerEvents(){Object.keys(this._sourceLayers).forEach(u=>{let _=this._sourceLayers[u],r=_.layer;_.clickable&&(this._map?.on("click",r.id,M=>{if(M.features===void 0)return;let F=M.features[0].properties;F&&!F.cluster&&this.clickedFeature.emit(M.features[0].properties)}),this._map?.on("mouseenter",r.id,M=>{let F=this._map?.getCanvas();if(F!==void 0&&(F.style.cursor="pointer"),M.features===void 0)return;let q=M.features[0].properties;q&&!q.cluster&&this.hoveredFeature.emit(M.features[0])}),this._map?.on("mouseleave",r.id,M=>{let F=this._map?.getCanvas();F!==void 0&&(F.style.cursor=""),this.hoveredFeature.emit(void 0)})),this._map?.on("click",r.id,M=>{if(M.features===void 0)return;let F=M.features[0].properties;F&&F.cluster&&this.zoomToCoordinate(M.lngLat)})})}};m.\u0275fac=function(_){return new(_||m)},m.\u0275cmp=hi({type:m,selectors:[["lib-ng-mapbox"]],inputs:{center:"center",zoom:"zoom"},outputs:{clickedMap:"clickedMap",clickedFeature:"clickedFeature",hoveredFeature:"hoveredFeature"},standalone:!0,features:[lr,ui],decls:1,vars:0,consts:[["id","map"]],template:function(_,r){_&1&&Ki(0,"div",0)},dependencies:[In],styles:["#map[_ngcontent-%COMP%]{width:inherit;height:inherit}"]});let w=m;return w})();function Uv(w,m,x){for(let u in m)if(m.hasOwnProperty(u)){let _=m[u];_?w.setProperty(u,_,x?.has(u)?"important":""):w.removeProperty(u)}return w}function ru(w,m){let x=m?"":"none";Uv(w.style,{"touch-action":m?"":"none","-webkit-user-drag":m?"":"none","-webkit-tap-highlight-color":m?"":"transparent","user-select":x,"-ms-user-select":x,"-webkit-user-select":x,"-moz-user-select":x})}function MS(w,m,x){Uv(w.style,{position:m?"":"fixed",top:m?"":"0",opacity:m?"":"0",left:m?"":"-999em"},x)}function l0(w,m){return m&&m!="none"?w+" "+m:w}function ES(w){let m=w.toLowerCase().indexOf("ms")>-1?1:1e3;return parseFloat(w)*m}function KL(w){let m=getComputedStyle(w),x=Ov(m,"transition-property"),u=x.find(F=>F==="transform"||F==="all");if(!u)return 0;let _=x.indexOf(u),r=Ov(m,"transition-duration"),M=Ov(m,"transition-delay");return ES(r[_])+ES(M[_])}function Ov(w,m){return w.getPropertyValue(m).split(",").map(u=>u.trim())}function Gv(w){let m=w.getBoundingClientRect();return{top:m.top,right:m.right,bottom:m.bottom,left:m.left,width:m.width,height:m.height,x:m.x,y:m.y}}function Bv(w,m,x){let{top:u,bottom:_,left:r,right:M}=w;return x>=u&&x<=_&&m>=r&&m<=M}function of(w,m,x){w.top+=m,w.bottom=w.top+w.height,w.left+=x,w.right=w.left+w.width}function AS(w,m,x,u){let{top:_,right:r,bottom:M,left:F,width:q,height:re}=w,me=q*m,De=re*m;return u>_-De&&u<M+De&&x>F-me&&x<r+me}var c0=class{constructor(m){this._document=m,this.positions=new Map}clear(){this.positions.clear()}cache(m){this.clear(),this.positions.set(this._document,{scrollPosition:this.getViewportScrollPosition()}),m.forEach(x=>{this.positions.set(x,{scrollPosition:{top:x.scrollTop,left:x.scrollLeft},clientRect:Gv(x)})})}handleScroll(m){let x=vp(m),u=this.positions.get(x);if(!u)return null;let _=u.scrollPosition,r,M;if(x===this._document){let re=this.getViewportScrollPosition();r=re.top,M=re.left}else r=x.scrollTop,M=x.scrollLeft;let F=_.top-r,q=_.left-M;return this.positions.forEach((re,me)=>{re.clientRect&&x!==me&&x.contains(me)&&of(re.clientRect,F,q)}),_.top=r,_.left=M,{top:F,left:q}}getViewportScrollPosition(){return{top:window.scrollY,left:window.scrollX}}};function DS(w){let m=w.cloneNode(!0),x=m.querySelectorAll("[id]"),u=w.nodeName.toLowerCase();m.removeAttribute("id");for(let _=0;_<x.length;_++)x[_].removeAttribute("id");return u==="canvas"?LS(w,m):(u==="input"||u==="select"||u==="textarea")&&RS(w,m),PS("canvas",w,m,LS),PS("input, textarea, select",w,m,RS),m}function PS(w,m,x,u){let _=m.querySelectorAll(w);if(_.length){let r=x.querySelectorAll(w);for(let M=0;M<_.length;M++)u(_[M],r[M])}}var QL=0;function RS(w,m){m.type!=="file"&&(m.value=w.value),m.type==="radio"&&m.name&&(m.name=`mat-clone-${m.name}-${QL++}`)}function LS(w,m){let x=m.getContext("2d");if(x)try{x.drawImage(w,0,0)}catch{}}var zS=Ph({passive:!0}),o0=Ph({passive:!1}),JL=800,Fv=new Set(["position"]),Nv=class{get disabled(){return this._disabled||!!(this._dropContainer&&this._dropContainer.disabled)}set disabled(m){m!==this._disabled&&(this._disabled=m,this._toggleNativeDragInteractions(),this._handles.forEach(x=>ru(x,m)))}constructor(m,x,u,_,r,M){this._config=x,this._document=u,this._ngZone=_,this._viewportRuler=r,this._dragDropRegistry=M,this._passiveTransform={x:0,y:0},this._activeTransform={x:0,y:0},this._hasStartedDragging=!1,this._moveEvents=new ei,this._pointerMoveSubscription=Vr.EMPTY,this._pointerUpSubscription=Vr.EMPTY,this._scrollSubscription=Vr.EMPTY,this._resizeSubscription=Vr.EMPTY,this._boundaryElement=null,this._nativeInteractionsEnabled=!0,this._handles=[],this._disabledHandles=new Set,this._direction="ltr",this.dragStartDelay=0,this._disabled=!1,this.beforeStarted=new ei,this.started=new ei,this.released=new ei,this.ended=new ei,this.entered=new ei,this.exited=new ei,this.dropped=new ei,this.moved=this._moveEvents,this._pointerDown=F=>{if(this.beforeStarted.next(),this._handles.length){let q=this._getTargetHandle(F);q&&!this._disabledHandles.has(q)&&!this.disabled&&this._initializeDragSequence(q,F)}else this.disabled||this._initializeDragSequence(this._rootElement,F)},this._pointerMove=F=>{let q=this._getPointerPositionOnPage(F);if(!this._hasStartedDragging){let me=Math.abs(q.x-this._pickupPositionOnPage.x),De=Math.abs(q.y-this._pickupPositionOnPage.y);if(me+De>=this._config.dragStartThreshold){let Mt=Date.now()>=this._dragStartTime+this._getDragStartDelay(F),Ui=this._dropContainer;if(!Mt){this._endDragSequence(F);return}(!Ui||!Ui.isDragging()&&!Ui.isReceiving())&&(F.preventDefault(),this._hasStartedDragging=!0,this._ngZone.run(()=>this._startDragSequence(F)))}return}F.preventDefault();let re=this._getConstrainedPointerPosition(q);if(this._hasMoved=!0,this._lastKnownPointerPosition=q,this._updatePointerDirectionDelta(re),this._dropContainer)this._updateActiveDropContainer(re,q);else{let me=this.constrainPosition?this._initialDomRect:this._pickupPositionOnPage,De=this._activeTransform;De.x=re.x-me.x+this._passiveTransform.x,De.y=re.y-me.y+this._passiveTransform.y,this._applyRootElementTransform(De.x,De.y)}this._moveEvents.observers.length&&this._ngZone.run(()=>{this._moveEvents.next({source:this,pointerPosition:re,event:F,distance:this._getDragDistance(re),delta:this._pointerDirectionDelta})})},this._pointerUp=F=>{this._endDragSequence(F)},this._nativeDragStart=F=>{if(this._handles.length){let q=this._getTargetHandle(F);q&&!this._disabledHandles.has(q)&&!this.disabled&&F.preventDefault()}else this.disabled||F.preventDefault()},this.withRootElement(m).withParent(x.parentDragRef||null),this._parentPositions=new c0(u),M.registerDragItem(this)}getPlaceholderElement(){return this._placeholder}getRootElement(){return this._rootElement}getVisibleElement(){return this.isDragging()?this.getPlaceholderElement():this.getRootElement()}withHandles(m){this._handles=m.map(u=>Go(u)),this._handles.forEach(u=>ru(u,this.disabled)),this._toggleNativeDragInteractions();let x=new Set;return this._disabledHandles.forEach(u=>{this._handles.indexOf(u)>-1&&x.add(u)}),this._disabledHandles=x,this}withPreviewTemplate(m){return this._previewTemplate=m,this}withPlaceholderTemplate(m){return this._placeholderTemplate=m,this}withRootElement(m){let x=Go(m);return x!==this._rootElement&&(this._rootElement&&this._removeRootElementListeners(this._rootElement),this._ngZone.runOutsideAngular(()=>{x.addEventListener("mousedown",this._pointerDown,o0),x.addEventListener("touchstart",this._pointerDown,zS),x.addEventListener("dragstart",this._nativeDragStart,o0)}),this._initialTransform=void 0,this._rootElement=x),typeof SVGElement<"u"&&this._rootElement instanceof SVGElement&&(this._ownerSVGElement=this._rootElement.ownerSVGElement),this}withBoundaryElement(m){return this._boundaryElement=m?Go(m):null,this._resizeSubscription.unsubscribe(),m&&(this._resizeSubscription=this._viewportRuler.change(10).subscribe(()=>this._containInsideBoundaryOnResize())),this}withParent(m){return this._parentDragRef=m,this}dispose(){this._removeRootElementListeners(this._rootElement),this.isDragging()&&this._rootElement?.remove(),this._anchor?.remove(),this._destroyPreview(),this._destroyPlaceholder(),this._dragDropRegistry.removeDragItem(this),this._removeSubscriptions(),this.beforeStarted.complete(),this.started.complete(),this.released.complete(),this.ended.complete(),this.entered.complete(),this.exited.complete(),this.dropped.complete(),this._moveEvents.complete(),this._handles=[],this._disabledHandles.clear(),this._dropContainer=void 0,this._resizeSubscription.unsubscribe(),this._parentPositions.clear(),this._boundaryElement=this._rootElement=this._ownerSVGElement=this._placeholderTemplate=this._previewTemplate=this._anchor=this._parentDragRef=null}isDragging(){return this._hasStartedDragging&&this._dragDropRegistry.isDragging(this)}reset(){this._rootElement.style.transform=this._initialTransform||"",this._activeTransform={x:0,y:0},this._passiveTransform={x:0,y:0}}disableHandle(m){!this._disabledHandles.has(m)&&this._handles.indexOf(m)>-1&&(this._disabledHandles.add(m),ru(m,!0))}enableHandle(m){this._disabledHandles.has(m)&&(this._disabledHandles.delete(m),ru(m,this.disabled))}withDirection(m){return this._direction=m,this}_withDropContainer(m){this._dropContainer=m}getFreeDragPosition(){let m=this.isDragging()?this._activeTransform:this._passiveTransform;return{x:m.x,y:m.y}}setFreeDragPosition(m){return this._activeTransform={x:0,y:0},this._passiveTransform.x=m.x,this._passiveTransform.y=m.y,this._dropContainer||this._applyRootElementTransform(m.x,m.y),this}withPreviewContainer(m){return this._previewContainer=m,this}_sortFromLastPointerPosition(){let m=this._lastKnownPointerPosition;m&&this._dropContainer&&this._updateActiveDropContainer(this._getConstrainedPointerPosition(m),m)}_removeSubscriptions(){this._pointerMoveSubscription.unsubscribe(),this._pointerUpSubscription.unsubscribe(),this._scrollSubscription.unsubscribe()}_destroyPreview(){this._preview?.remove(),this._previewRef?.destroy(),this._preview=this._previewRef=null}_destroyPlaceholder(){this._placeholder?.remove(),this._placeholderRef?.destroy(),this._placeholder=this._placeholderRef=null}_endDragSequence(m){if(this._dragDropRegistry.isDragging(this)&&(this._removeSubscriptions(),this._dragDropRegistry.stopDragging(this),this._toggleNativeDragInteractions(),this._handles&&(this._rootElement.style.webkitTapHighlightColor=this._rootElementTapHighlight),!!this._hasStartedDragging))if(this.released.next({source:this,event:m}),this._dropContainer)this._dropContainer._stopScrolling(),this._animatePreviewToPlaceholder().then(()=>{this._cleanupDragArtifacts(m),this._cleanupCachedDimensions(),this._dragDropRegistry.stopDragging(this)});else{this._passiveTransform.x=this._activeTransform.x;let x=this._getPointerPositionOnPage(m);this._passiveTransform.y=this._activeTransform.y,this._ngZone.run(()=>{this.ended.next({source:this,distance:this._getDragDistance(x),dropPoint:x,event:m})}),this._cleanupCachedDimensions(),this._dragDropRegistry.stopDragging(this)}}_startDragSequence(m){rf(m)&&(this._lastTouchEventTime=Date.now()),this._toggleNativeDragInteractions();let x=this._dropContainer;if(x){let u=this._rootElement,_=u.parentNode,r=this._placeholder=this._createPlaceholderElement(),M=this._anchor=this._anchor||this._document.createComment(""),F=this._getShadowRoot();_.insertBefore(M,u),this._initialTransform=u.style.transform||"",this._preview=this._createPreviewElement(),MS(u,!1,Fv),this._document.body.appendChild(_.replaceChild(r,u)),this._getPreviewInsertionPoint(_,F).appendChild(this._preview),this.started.next({source:this,event:m}),x.start(),this._initialContainer=x,this._initialIndex=x.getItemIndex(this)}else this.started.next({source:this,event:m}),this._initialContainer=this._initialIndex=void 0;this._parentPositions.cache(x?x.getScrollableParents():[])}_initializeDragSequence(m,x){this._parentDragRef&&x.stopPropagation();let u=this.isDragging(),_=rf(x),r=!_&&x.button!==0,M=this._rootElement,F=vp(x),q=!_&&this._lastTouchEventTime&&this._lastTouchEventTime+JL>Date.now(),re=_?ek(x):J2(x);if(F&&F.draggable&&x.type==="mousedown"&&x.preventDefault(),u||r||q||re)return;if(this._handles.length){let $e=M.style;this._rootElementTapHighlight=$e.webkitTapHighlightColor||"",$e.webkitTapHighlightColor="transparent"}this._hasStartedDragging=this._hasMoved=!1,this._removeSubscriptions(),this._initialDomRect=this._rootElement.getBoundingClientRect(),this._pointerMoveSubscription=this._dragDropRegistry.pointerMove.subscribe(this._pointerMove),this._pointerUpSubscription=this._dragDropRegistry.pointerUp.subscribe(this._pointerUp),this._scrollSubscription=this._dragDropRegistry.scrolled(this._getShadowRoot()).subscribe($e=>this._updateOnScroll($e)),this._boundaryElement&&(this._boundaryRect=Gv(this._boundaryElement));let me=this._previewTemplate;this._pickupPositionInElement=me&&me.template&&!me.matchSize?{x:0,y:0}:this._getPointerPositionInElement(this._initialDomRect,m,x);let De=this._pickupPositionOnPage=this._lastKnownPointerPosition=this._getPointerPositionOnPage(x);this._pointerDirectionDelta={x:0,y:0},this._pointerPositionAtLastDirectionChange={x:De.x,y:De.y},this._dragStartTime=Date.now(),this._dragDropRegistry.startDragging(this,x)}_cleanupDragArtifacts(m){MS(this._rootElement,!0,Fv),this._anchor.parentNode.replaceChild(this._rootElement,this._anchor),this._destroyPreview(),this._destroyPlaceholder(),this._initialDomRect=this._boundaryRect=this._previewRect=this._initialTransform=void 0,this._ngZone.run(()=>{let x=this._dropContainer,u=x.getItemIndex(this),_=this._getPointerPositionOnPage(m),r=this._getDragDistance(_),M=x._isOverContainer(_.x,_.y);this.ended.next({source:this,distance:r,dropPoint:_,event:m}),this.dropped.next({item:this,currentIndex:u,previousIndex:this._initialIndex,container:x,previousContainer:this._initialContainer,isPointerOverContainer:M,distance:r,dropPoint:_,event:m}),x.drop(this,u,this._initialIndex,this._initialContainer,M,r,_,m),this._dropContainer=this._initialContainer})}_updateActiveDropContainer({x:m,y:x},{x:u,y:_}){let r=this._initialContainer._getSiblingContainerFromPosition(this,m,x);!r&&this._dropContainer!==this._initialContainer&&this._initialContainer._isOverContainer(m,x)&&(r=this._initialContainer),r&&r!==this._dropContainer&&this._ngZone.run(()=>{this.exited.next({item:this,container:this._dropContainer}),this._dropContainer.exit(this),this._dropContainer=r,this._dropContainer.enter(this,m,x,r===this._initialContainer&&r.sortingDisabled?this._initialIndex:void 0),this.entered.next({item:this,container:r,currentIndex:r.getItemIndex(this)})}),this.isDragging()&&(this._dropContainer._startScrollingIfNecessary(u,_),this._dropContainer._sortItem(this,m,x,this._pointerDirectionDelta),this.constrainPosition?this._applyPreviewTransform(m,x):this._applyPreviewTransform(m-this._pickupPositionInElement.x,x-this._pickupPositionInElement.y))}_createPreviewElement(){let m=this._previewTemplate,x=this.previewClass,u=m?m.template:null,_;if(u&&m){let r=m.matchSize?this._initialDomRect:null,M=m.viewContainer.createEmbeddedView(u,m.context);M.detectChanges(),_=FS(M,this._document),this._previewRef=M,m.matchSize?BS(_,r):_.style.transform=s0(this._pickupPositionOnPage.x,this._pickupPositionOnPage.y)}else _=DS(this._rootElement),BS(_,this._initialDomRect),this._initialTransform&&(_.style.transform=this._initialTransform);return Uv(_.style,{"pointer-events":"none",margin:"0",position:"fixed",top:"0",left:"0","z-index":`${this._config.zIndex||1e3}`},Fv),ru(_,!1),_.classList.add("cdk-drag-preview"),_.setAttribute("dir",this._direction),x&&(Array.isArray(x)?x.forEach(r=>_.classList.add(r)):_.classList.add(x)),_}_animatePreviewToPlaceholder(){if(!this._hasMoved)return Promise.resolve();let m=this._placeholder.getBoundingClientRect();this._preview.classList.add("cdk-drag-animating"),this._applyPreviewTransform(m.left,m.top);let x=KL(this._preview);return x===0?Promise.resolve():this._ngZone.runOutsideAngular(()=>new Promise(u=>{let _=M=>{(!M||vp(M)===this._preview&&M.propertyName==="transform")&&(this._preview?.removeEventListener("transitionend",_),u(),clearTimeout(r))},r=setTimeout(_,x*1.5);this._preview.addEventListener("transitionend",_)}))}_createPlaceholderElement(){let m=this._placeholderTemplate,x=m?m.template:null,u;return x?(this._placeholderRef=m.viewContainer.createEmbeddedView(x,m.context),this._placeholderRef.detectChanges(),u=FS(this._placeholderRef,this._document)):u=DS(this._rootElement),u.style.pointerEvents="none",u.classList.add("cdk-drag-placeholder"),u}_getPointerPositionInElement(m,x,u){let _=x===this._rootElement?null:x,r=_?_.getBoundingClientRect():m,M=rf(u)?u.targetTouches[0]:u,F=this._getViewportScrollPosition(),q=M.pageX-r.left-F.left,re=M.pageY-r.top-F.top;return{x:r.left-m.left+q,y:r.top-m.top+re}}_getPointerPositionOnPage(m){let x=this._getViewportScrollPosition(),u=rf(m)?m.touches[0]||m.changedTouches[0]||{pageX:0,pageY:0}:m,_=u.pageX-x.left,r=u.pageY-x.top;if(this._ownerSVGElement){let M=this._ownerSVGElement.getScreenCTM();if(M){let F=this._ownerSVGElement.createSVGPoint();return F.x=_,F.y=r,F.matrixTransform(M.inverse())}}return{x:_,y:r}}_getConstrainedPointerPosition(m){let x=this._dropContainer?this._dropContainer.lockAxis:null,{x:u,y:_}=this.constrainPosition?this.constrainPosition(m,this,this._initialDomRect,this._pickupPositionInElement):m;if(this.lockAxis==="x"||x==="x"?_=this._pickupPositionOnPage.y-(this.constrainPosition?this._pickupPositionInElement.y:0):(this.lockAxis==="y"||x==="y")&&(u=this._pickupPositionOnPage.x-(this.constrainPosition?this._pickupPositionInElement.x:0)),this._boundaryRect){let{x:r,y:M}=this.constrainPosition?{x:0,y:0}:this._pickupPositionInElement,F=this._boundaryRect,{width:q,height:re}=this._getPreviewRect(),me=F.top+M,De=F.bottom-(re-M),$e=F.left+r,Mt=F.right-(q-r);u=OS(u,$e,Mt),_=OS(_,me,De)}return{x:u,y:_}}_updatePointerDirectionDelta(m){let{x,y:u}=m,_=this._pointerDirectionDelta,r=this._pointerPositionAtLastDirectionChange,M=Math.abs(x-r.x),F=Math.abs(u-r.y);return M>this._config.pointerDirectionChangeThreshold&&(_.x=x>r.x?1:-1,r.x=x),F>this._config.pointerDirectionChangeThreshold&&(_.y=u>r.y?1:-1,r.y=u),_}_toggleNativeDragInteractions(){if(!this._rootElement||!this._handles)return;let m=this._handles.length>0||!this.isDragging();m!==this._nativeInteractionsEnabled&&(this._nativeInteractionsEnabled=m,ru(this._rootElement,m))}_removeRootElementListeners(m){m.removeEventListener("mousedown",this._pointerDown,o0),m.removeEventListener("touchstart",this._pointerDown,zS),m.removeEventListener("dragstart",this._nativeDragStart,o0)}_applyRootElementTransform(m,x){let u=s0(m,x),_=this._rootElement.style;this._initialTransform==null&&(this._initialTransform=_.transform&&_.transform!="none"?_.transform:""),_.transform=l0(u,this._initialTransform)}_applyPreviewTransform(m,x){let u=this._previewTemplate?.template?void 0:this._initialTransform,_=s0(m,x);this._preview.style.transform=l0(_,u)}_getDragDistance(m){let x=this._pickupPositionOnPage;return x?{x:m.x-x.x,y:m.y-x.y}:{x:0,y:0}}_cleanupCachedDimensions(){this._boundaryRect=this._previewRect=void 0,this._parentPositions.clear()}_containInsideBoundaryOnResize(){let{x:m,y:x}=this._passiveTransform;if(m===0&&x===0||this.isDragging()||!this._boundaryElement)return;let u=this._rootElement.getBoundingClientRect(),_=this._boundaryElement.getBoundingClientRect();if(_.width===0&&_.height===0||u.width===0&&u.height===0)return;let r=_.left-u.left,M=u.right-_.right,F=_.top-u.top,q=u.bottom-_.bottom;_.width>u.width?(r>0&&(m+=r),M>0&&(m-=M)):m=0,_.height>u.height?(F>0&&(x+=F),q>0&&(x-=q)):x=0,(m!==this._passiveTransform.x||x!==this._passiveTransform.y)&&this.setFreeDragPosition({y:x,x:m})}_getDragStartDelay(m){let x=this.dragStartDelay;return typeof x=="number"?x:rf(m)?x.touch:x?x.mouse:0}_updateOnScroll(m){let x=this._parentPositions.handleScroll(m);if(x){let u=vp(m);this._boundaryRect&&u!==this._boundaryElement&&u.contains(this._boundaryElement)&&of(this._boundaryRect,x.top,x.left),this._pickupPositionOnPage.x+=x.left,this._pickupPositionOnPage.y+=x.top,this._dropContainer||(this._activeTransform.x-=x.left,this._activeTransform.y-=x.top,this._applyRootElementTransform(this._activeTransform.x,this._activeTransform.y))}}_getViewportScrollPosition(){return this._parentPositions.positions.get(this._document)?.scrollPosition||this._parentPositions.getViewportScrollPosition()}_getShadowRoot(){return this._cachedShadowRoot===void 0&&(this._cachedShadowRoot=yb(this._rootElement)),this._cachedShadowRoot}_getPreviewInsertionPoint(m,x){let u=this._previewContainer||"global";if(u==="parent")return m;if(u==="global"){let _=this._document;return x||_.fullscreenElement||_.webkitFullscreenElement||_.mozFullScreenElement||_.msFullscreenElement||_.body}return Go(u)}_getPreviewRect(){return(!this._previewRect||!this._previewRect.width&&!this._previewRect.height)&&(this._previewRect=this._preview?this._preview.getBoundingClientRect():this._initialDomRect),this._previewRect}_getTargetHandle(m){return this._handles.find(x=>m.target&&(m.target===x||x.contains(m.target)))}};function s0(w,m){return`translate3d(${Math.round(w)}px, ${Math.round(m)}px, 0)`}function OS(w,m,x){return Math.max(m,Math.min(x,w))}function rf(w){return w.type[0]==="t"}function FS(w,m){let x=w.rootNodes;if(x.length===1&&x[0].nodeType===m.ELEMENT_NODE)return x[0];let u=m.createElement("div");return x.forEach(_=>u.appendChild(_)),u}function BS(w,m){w.style.width=`${m.width}px`,w.style.height=`${m.height}px`,w.style.transform=s0(m.left,m.top)}function e3(w,m,x){let u=NS(m,w.length-1),_=NS(x,w.length-1);if(u===_)return;let r=w[u],M=_<u?-1:1;for(let F=u;F!==_;F+=M)w[F]=w[F+M];w[_]=r}function NS(w,m){return Math.max(0,Math.min(m,w))}var jv=class{constructor(m,x){this._element=m,this._dragDropRegistry=x,this._itemPositions=[],this.orientation="vertical",this._previousSwap={drag:null,delta:0,overlaps:!1}}start(m){this.withItems(m)}sort(m,x,u,_){let r=this._itemPositions,M=this._getItemIndexFromPointerPosition(m,x,u,_);if(M===-1&&r.length>0)return null;let F=this.orientation==="horizontal",q=r.findIndex(mi=>mi.drag===m),re=r[M],me=r[q].clientRect,De=re.clientRect,$e=q>M?1:-1,Mt=this._getItemOffsetPx(me,De,$e),Ui=this._getSiblingOffsetPx(q,r,$e),Hi=r.slice();return e3(r,q,M),r.forEach((mi,Yn)=>{if(Hi[Yn]===mi)return;let $r=mi.drag===m,qr=$r?Mt:Ui,eo=$r?m.getPlaceholderElement():mi.drag.getRootElement();mi.offset+=qr,F?(eo.style.transform=l0(`translate3d(${Math.round(mi.offset)}px, 0, 0)`,mi.initialTransform),of(mi.clientRect,0,qr)):(eo.style.transform=l0(`translate3d(0, ${Math.round(mi.offset)}px, 0)`,mi.initialTransform),of(mi.clientRect,qr,0))}),this._previousSwap.overlaps=Bv(De,x,u),this._previousSwap.drag=re.drag,this._previousSwap.delta=F?_.x:_.y,{previousIndex:q,currentIndex:M}}enter(m,x,u,_){let r=_==null||_<0?this._getItemIndexFromPointerPosition(m,x,u):_,M=this._activeDraggables,F=M.indexOf(m),q=m.getPlaceholderElement(),re=M[r];if(re===m&&(re=M[r+1]),!re&&(r==null||r===-1||r<M.length-1)&&this._shouldEnterAsFirstChild(x,u)&&(re=M[0]),F>-1&&M.splice(F,1),re&&!this._dragDropRegistry.isDragging(re)){let me=re.getRootElement();me.parentElement.insertBefore(q,me),M.splice(r,0,m)}else Go(this._element).appendChild(q),M.push(m);q.style.transform="",this._cacheItemPositions()}withItems(m){this._activeDraggables=m.slice(),this._cacheItemPositions()}withSortPredicate(m){this._sortPredicate=m}reset(){this._activeDraggables.forEach(m=>{let x=m.getRootElement();if(x){let u=this._itemPositions.find(_=>_.drag===m)?.initialTransform;x.style.transform=u||""}}),this._itemPositions=[],this._activeDraggables=[],this._previousSwap.drag=null,this._previousSwap.delta=0,this._previousSwap.overlaps=!1}getActiveItemsSnapshot(){return this._activeDraggables}getItemIndex(m){return(this.orientation==="horizontal"&&this.direction==="rtl"?this._itemPositions.slice().reverse():this._itemPositions).findIndex(u=>u.drag===m)}updateOnScroll(m,x){this._itemPositions.forEach(({clientRect:u})=>{of(u,m,x)}),this._itemPositions.forEach(({drag:u})=>{this._dragDropRegistry.isDragging(u)&&u._sortFromLastPointerPosition()})}_cacheItemPositions(){let m=this.orientation==="horizontal";this._itemPositions=this._activeDraggables.map(x=>{let u=x.getVisibleElement();return{drag:x,offset:0,initialTransform:u.style.transform||"",clientRect:Gv(u)}}).sort((x,u)=>m?x.clientRect.left-u.clientRect.left:x.clientRect.top-u.clientRect.top)}_getItemOffsetPx(m,x,u){let _=this.orientation==="horizontal",r=_?x.left-m.left:x.top-m.top;return u===-1&&(r+=_?x.width-m.width:x.height-m.height),r}_getSiblingOffsetPx(m,x,u){let _=this.orientation==="horizontal",r=x[m].clientRect,M=x[m+u*-1],F=r[_?"width":"height"]*u;if(M){let q=_?"left":"top",re=_?"right":"bottom";u===-1?F-=M.clientRect[q]-r[re]:F+=r[q]-M.clientRect[re]}return F}_shouldEnterAsFirstChild(m,x){if(!this._activeDraggables.length)return!1;let u=this._itemPositions,_=this.orientation==="horizontal";if(u[0].drag!==this._activeDraggables[0]){let M=u[u.length-1].clientRect;return _?m>=M.right:x>=M.bottom}else{let M=u[0].clientRect;return _?m<=M.left:x<=M.top}}_getItemIndexFromPointerPosition(m,x,u,_){let r=this.orientation==="horizontal",M=this._itemPositions.findIndex(({drag:F,clientRect:q})=>{if(F===m)return!1;if(_){let re=r?_.x:_.y;if(F===this._previousSwap.drag&&this._previousSwap.overlaps&&re===this._previousSwap.delta)return!1}return r?x>=Math.floor(q.left)&&x<Math.floor(q.right):u>=Math.floor(q.top)&&u<Math.floor(q.bottom)});return M===-1||!this._sortPredicate(M,m)?-1:M}},jS=.05,$S=.05,ka=function(w){return w[w.NONE=0]="NONE",w[w.UP=1]="UP",w[w.DOWN=2]="DOWN",w}(ka||{}),Io=function(w){return w[w.NONE=0]="NONE",w[w.LEFT=1]="LEFT",w[w.RIGHT=2]="RIGHT",w}(Io||{}),Vv=class{constructor(m,x,u,_,r){this._dragDropRegistry=x,this._ngZone=_,this._viewportRuler=r,this.disabled=!1,this.sortingDisabled=!1,this.autoScrollDisabled=!1,this.autoScrollStep=2,this.enterPredicate=()=>!0,this.sortPredicate=()=>!0,this.beforeStarted=new ei,this.entered=new ei,this.exited=new ei,this.dropped=new ei,this.sorted=new ei,this.receivingStarted=new ei,this.receivingStopped=new ei,this._isDragging=!1,this._draggables=[],this._siblings=[],this._activeSiblings=new Set,this._viewportScrollSubscription=Vr.EMPTY,this._verticalScrollDirection=ka.NONE,this._horizontalScrollDirection=Io.NONE,this._stopScrollTimers=new ei,this._cachedShadowRoot=null,this._startScrollInterval=()=>{this._stopScrolling(),f2(0,d2).pipe(Fo(this._stopScrollTimers)).subscribe(()=>{let M=this._scrollNode,F=this.autoScrollStep;this._verticalScrollDirection===ka.UP?M.scrollBy(0,-F):this._verticalScrollDirection===ka.DOWN&&M.scrollBy(0,F),this._horizontalScrollDirection===Io.LEFT?M.scrollBy(-F,0):this._horizontalScrollDirection===Io.RIGHT&&M.scrollBy(F,0)})},this.element=Go(m),this._document=u,this.withScrollableParents([this.element]),x.registerDropContainer(this),this._parentPositions=new c0(u),this._sortStrategy=new jv(this.element,x),this._sortStrategy.withSortPredicate((M,F)=>this.sortPredicate(M,F,this))}dispose(){this._stopScrolling(),this._stopScrollTimers.complete(),this._viewportScrollSubscription.unsubscribe(),this.beforeStarted.complete(),this.entered.complete(),this.exited.complete(),this.dropped.complete(),this.sorted.complete(),this.receivingStarted.complete(),this.receivingStopped.complete(),this._activeSiblings.clear(),this._scrollNode=null,this._parentPositions.clear(),this._dragDropRegistry.removeDropContainer(this)}isDragging(){return this._isDragging}start(){this._draggingStarted(),this._notifyReceivingSiblings()}enter(m,x,u,_){this._draggingStarted(),_==null&&this.sortingDisabled&&(_=this._draggables.indexOf(m)),this._sortStrategy.enter(m,x,u,_),this._cacheParentPositions(),this._notifyReceivingSiblings(),this.entered.next({item:m,container:this,currentIndex:this.getItemIndex(m)})}exit(m){this._reset(),this.exited.next({item:m,container:this})}drop(m,x,u,_,r,M,F,q={}){this._reset(),this.dropped.next({item:m,currentIndex:x,previousIndex:u,container:this,previousContainer:_,isPointerOverContainer:r,distance:M,dropPoint:F,event:q})}withItems(m){let x=this._draggables;return this._draggables=m,m.forEach(u=>u._withDropContainer(this)),this.isDragging()&&(x.filter(_=>_.isDragging()).every(_=>m.indexOf(_)===-1)?this._reset():this._sortStrategy.withItems(this._draggables)),this}withDirection(m){return this._sortStrategy.direction=m,this}connectedTo(m){return this._siblings=m.slice(),this}withOrientation(m){return this._sortStrategy.orientation=m,this}withScrollableParents(m){let x=Go(this.element);return this._scrollableElements=m.indexOf(x)===-1?[x,...m]:m.slice(),this}getScrollableParents(){return this._scrollableElements}getItemIndex(m){return this._isDragging?this._sortStrategy.getItemIndex(m):this._draggables.indexOf(m)}isReceiving(){return this._activeSiblings.size>0}_sortItem(m,x,u,_){if(this.sortingDisabled||!this._domRect||!AS(this._domRect,jS,x,u))return;let r=this._sortStrategy.sort(m,x,u,_);r&&this.sorted.next({previousIndex:r.previousIndex,currentIndex:r.currentIndex,container:this,item:m})}_startScrollingIfNecessary(m,x){if(this.autoScrollDisabled)return;let u,_=ka.NONE,r=Io.NONE;if(this._parentPositions.positions.forEach((M,F)=>{F===this._document||!M.clientRect||u||AS(M.clientRect,jS,m,x)&&([_,r]=t3(F,M.clientRect,this._sortStrategy.direction,m,x),(_||r)&&(u=F))}),!_&&!r){let{width:M,height:F}=this._viewportRuler.getViewportSize(),q={width:M,height:F,top:0,right:M,bottom:F,left:0};_=qS(q,x),r=HS(q,m),u=window}u&&(_!==this._verticalScrollDirection||r!==this._horizontalScrollDirection||u!==this._scrollNode)&&(this._verticalScrollDirection=_,this._horizontalScrollDirection=r,this._scrollNode=u,(_||r)&&u?this._ngZone.runOutsideAngular(this._startScrollInterval):this._stopScrolling())}_stopScrolling(){this._stopScrollTimers.next()}_draggingStarted(){let m=Go(this.element).style;this.beforeStarted.next(),this._isDragging=!0,this._initialScrollSnap=m.msScrollSnapType||m.scrollSnapType||"",m.scrollSnapType=m.msScrollSnapType="none",this._sortStrategy.start(this._draggables),this._cacheParentPositions(),this._viewportScrollSubscription.unsubscribe(),this._listenToScrollEvents()}_cacheParentPositions(){let m=Go(this.element);this._parentPositions.cache(this._scrollableElements),this._domRect=this._parentPositions.positions.get(m).clientRect}_reset(){this._isDragging=!1;let m=Go(this.element).style;m.scrollSnapType=m.msScrollSnapType=this._initialScrollSnap,this._siblings.forEach(x=>x._stopReceiving(this)),this._sortStrategy.reset(),this._stopScrolling(),this._viewportScrollSubscription.unsubscribe(),this._parentPositions.clear()}_isOverContainer(m,x){return this._domRect!=null&&Bv(this._domRect,m,x)}_getSiblingContainerFromPosition(m,x,u){return this._siblings.find(_=>_._canReceive(m,x,u))}_canReceive(m,x,u){if(!this._domRect||!Bv(this._domRect,x,u)||!this.enterPredicate(m,this))return!1;let _=this._getShadowRoot().elementFromPoint(x,u);if(!_)return!1;let r=Go(this.element);return _===r||r.contains(_)}_startReceiving(m,x){let u=this._activeSiblings;!u.has(m)&&x.every(_=>this.enterPredicate(_,this)||this._draggables.indexOf(_)>-1)&&(u.add(m),this._cacheParentPositions(),this._listenToScrollEvents(),this.receivingStarted.next({initiator:m,receiver:this,items:x}))}_stopReceiving(m){this._activeSiblings.delete(m),this._viewportScrollSubscription.unsubscribe(),this.receivingStopped.next({initiator:m,receiver:this})}_listenToScrollEvents(){this._viewportScrollSubscription=this._dragDropRegistry.scrolled(this._getShadowRoot()).subscribe(m=>{if(this.isDragging()){let x=this._parentPositions.handleScroll(m);x&&this._sortStrategy.updateOnScroll(x.top,x.left)}else this.isReceiving()&&this._cacheParentPositions()})}_getShadowRoot(){if(!this._cachedShadowRoot){let m=yb(Go(this.element));this._cachedShadowRoot=m||this._document}return this._cachedShadowRoot}_notifyReceivingSiblings(){let m=this._sortStrategy.getActiveItemsSnapshot().filter(x=>x.isDragging());this._siblings.forEach(x=>x._startReceiving(this,m))}};function qS(w,m){let{top:x,bottom:u,height:_}=w,r=_*$S;return m>=x-r&&m<=x+r?ka.UP:m>=u-r&&m<=u+r?ka.DOWN:ka.NONE}function HS(w,m){let{left:x,right:u,width:_}=w,r=_*$S;return m>=x-r&&m<=x+r?Io.LEFT:m>=u-r&&m<=u+r?Io.RIGHT:Io.NONE}function t3(w,m,x,u,_){let r=qS(m,_),M=HS(m,u),F=ka.NONE,q=Io.NONE;if(r){let re=w.scrollTop;r===ka.UP?re>0&&(F=ka.UP):w.scrollHeight-re>w.clientHeight&&(F=ka.DOWN)}if(M){let re=w.scrollLeft;x==="rtl"?M===Io.RIGHT?re<0&&(q=Io.RIGHT):w.scrollWidth+re>w.clientWidth&&(q=Io.LEFT):M===Io.LEFT?re>0&&(q=Io.LEFT):w.scrollWidth-re>w.clientWidth&&(q=Io.RIGHT)}return[F,q]}var a0=Ph({passive:!1,capture:!0}),i3=(()=>{let m=class m{constructor(u,_){this._ngZone=u,this._dropInstances=new Set,this._dragInstances=new Set,this._activeDragInstances=[],this._globalListeners=new Map,this._draggingPredicate=r=>r.isDragging(),this.pointerMove=new ei,this.pointerUp=new ei,this.scroll=new ei,this._preventDefaultWhileDragging=r=>{this._activeDragInstances.length>0&&r.preventDefault()},this._persistentTouchmoveListener=r=>{this._activeDragInstances.length>0&&(this._activeDragInstances.some(this._draggingPredicate)&&r.preventDefault(),this.pointerMove.next(r))},this._document=_}registerDropContainer(u){this._dropInstances.has(u)||this._dropInstances.add(u)}registerDragItem(u){this._dragInstances.add(u),this._dragInstances.size===1&&this._ngZone.runOutsideAngular(()=>{this._document.addEventListener("touchmove",this._persistentTouchmoveListener,a0)})}removeDropContainer(u){this._dropInstances.delete(u)}removeDragItem(u){this._dragInstances.delete(u),this.stopDragging(u),this._dragInstances.size===0&&this._document.removeEventListener("touchmove",this._persistentTouchmoveListener,a0)}startDragging(u,_){if(!(this._activeDragInstances.indexOf(u)>-1)&&(this._activeDragInstances.push(u),this._activeDragInstances.length===1)){let r=_.type.startsWith("touch");this._globalListeners.set(r?"touchend":"mouseup",{handler:M=>this.pointerUp.next(M),options:!0}).set("scroll",{handler:M=>this.scroll.next(M),options:!0}).set("selectstart",{handler:this._preventDefaultWhileDragging,options:a0}),r||this._globalListeners.set("mousemove",{handler:M=>this.pointerMove.next(M),options:a0}),this._ngZone.runOutsideAngular(()=>{this._globalListeners.forEach((M,F)=>{this._document.addEventListener(F,M.handler,M.options)})})}}stopDragging(u){let _=this._activeDragInstances.indexOf(u);_>-1&&(this._activeDragInstances.splice(_,1),this._activeDragInstances.length===0&&this._clearGlobalListeners())}isDragging(u){return this._activeDragInstances.indexOf(u)>-1}scrolled(u){let _=[this.scroll];return u&&u!==this._document&&_.push(new cp(r=>this._ngZone.runOutsideAngular(()=>{let F=q=>{this._activeDragInstances.length&&r.next(q)};return u.addEventListener("scroll",F,!0),()=>{u.removeEventListener("scroll",F,!0)}}))),Ha(..._)}ngOnDestroy(){this._dragInstances.forEach(u=>this.removeDragItem(u)),this._dropInstances.forEach(u=>this.removeDropContainer(u)),this._clearGlobalListeners(),this.pointerMove.complete(),this.pointerUp.complete()}_clearGlobalListeners(){this._globalListeners.forEach((u,_)=>{this._document.removeEventListener(_,u.handler,u.options)}),this._globalListeners.clear()}};m.\u0275fac=function(_){return new(_||m)(qi(Dn),qi(vr))},m.\u0275prov=Tn({token:m,factory:m.\u0275fac,providedIn:"root"});let w=m;return w})(),n3={dragStartThreshold:5,pointerDirectionChangeThreshold:5},r3=(()=>{let m=class m{constructor(u,_,r,M){this._document=u,this._ngZone=_,this._viewportRuler=r,this._dragDropRegistry=M}createDrag(u,_=n3){return new Nv(u,_,this._document,this._ngZone,this._viewportRuler,this._dragDropRegistry)}createDropList(u){return new Vv(u,this._dragDropRegistry,this._document,this._ngZone,this._viewportRuler)}};m.\u0275fac=function(_){return new(_||m)(qi(vr),qi(Dn),qi(wp),qi(i3))},m.\u0275prov=Tn({token:m,factory:m.\u0275fac,providedIn:"root"});let w=m;return w})(),VS=new ci("CDK_DRAG_PARENT");var US=new ci("CdkDragHandle");var o3=new ci("CdkDragPlaceholder");var a3=new ci("CdkDragPreview");var s3=new ci("CDK_DRAG_CONFIG"),l3="cdk-drag",c3=new ci("CdkDropList"),ZS=(()=>{let m=class m{get disabled(){return this._disabled||this.dropContainer&&this.dropContainer.disabled}set disabled(u){this._disabled=u,this._dragRef.disabled=this._disabled}constructor(u,_,r,M,F,q,re,me,De,$e,Mt){this.element=u,this.dropContainer=_,this._ngZone=M,this._viewContainerRef=F,this._dir=re,this._changeDetectorRef=De,this._selfHandle=$e,this._parentDrag=Mt,this._destroyed=new ei,this.started=new Ut,this.released=new Ut,this.ended=new Ut,this.entered=new Ut,this.exited=new Ut,this.dropped=new Ut,this.moved=new cp(Ui=>{let Hi=this._dragRef.moved.pipe(jn(mi=>({source:this,pointerPosition:mi.pointerPosition,event:mi.event,delta:mi.delta,distance:mi.distance}))).subscribe(Ui);return()=>{Hi.unsubscribe()}}),this._dragRef=me.createDrag(u,{dragStartThreshold:q&&q.dragStartThreshold!=null?q.dragStartThreshold:5,pointerDirectionChangeThreshold:q&&q.pointerDirectionChangeThreshold!=null?q.pointerDirectionChangeThreshold:5,zIndex:q?.zIndex}),this._dragRef.data=this,m._dragInstances.push(this),q&&this._assignDefaults(q),_&&(this._dragRef._withDropContainer(_._dropListRef),_.addItem(this)),this._syncInputs(this._dragRef),this._handleEvents(this._dragRef)}getPlaceholderElement(){return this._dragRef.getPlaceholderElement()}getRootElement(){return this._dragRef.getRootElement()}reset(){this._dragRef.reset()}getFreeDragPosition(){return this._dragRef.getFreeDragPosition()}setFreeDragPosition(u){this._dragRef.setFreeDragPosition(u)}ngAfterViewInit(){this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.pipe(Qr(1),Fo(this._destroyed)).subscribe(()=>{this._updateRootElement(),this._setupHandlesListener(),this.freeDragPosition&&this._dragRef.setFreeDragPosition(this.freeDragPosition)})})}ngOnChanges(u){let _=u.rootElementSelector,r=u.freeDragPosition;_&&!_.firstChange&&this._updateRootElement(),r&&!r.firstChange&&this.freeDragPosition&&this._dragRef.setFreeDragPosition(this.freeDragPosition)}ngOnDestroy(){this.dropContainer&&this.dropContainer.removeItem(this);let u=m._dragInstances.indexOf(this);u>-1&&m._dragInstances.splice(u,1),this._ngZone.runOutsideAngular(()=>{this._destroyed.next(),this._destroyed.complete(),this._dragRef.dispose()})}_updateRootElement(){let u=this.element.nativeElement,_=u;this.rootElementSelector&&(_=u.closest!==void 0?u.closest(this.rootElementSelector):u.parentElement?.closest(this.rootElementSelector)),this._dragRef.withRootElement(_||u)}_getBoundaryElement(){let u=this.boundaryElement;return u?typeof u=="string"?this.element.nativeElement.closest(u):Go(u):null}_syncInputs(u){u.beforeStarted.subscribe(()=>{if(!u.isDragging()){let _=this._dir,r=this.dragStartDelay,M=this._placeholderTemplate?{template:this._placeholderTemplate.templateRef,context:this._placeholderTemplate.data,viewContainer:this._viewContainerRef}:null,F=this._previewTemplate?{template:this._previewTemplate.templateRef,context:this._previewTemplate.data,matchSize:this._previewTemplate.matchSize,viewContainer:this._viewContainerRef}:null;u.disabled=this.disabled,u.lockAxis=this.lockAxis,u.dragStartDelay=typeof r=="object"&&r?r:xp(r),u.constrainPosition=this.constrainPosition,u.previewClass=this.previewClass,u.withBoundaryElement(this._getBoundaryElement()).withPlaceholderTemplate(M).withPreviewTemplate(F).withPreviewContainer(this.previewContainer||"global"),_&&u.withDirection(_.value)}}),u.beforeStarted.pipe(Qr(1)).subscribe(()=>{if(this._parentDrag){u.withParent(this._parentDrag._dragRef);return}let _=this.element.nativeElement.parentElement;for(;_;){if(_.classList.contains(l3)){u.withParent(m._dragInstances.find(r=>r.element.nativeElement===_)?._dragRef||null);break}_=_.parentElement}})}_handleEvents(u){u.started.subscribe(_=>{this.started.emit({source:this,event:_.event}),this._changeDetectorRef.markForCheck()}),u.released.subscribe(_=>{this.released.emit({source:this,event:_.event})}),u.ended.subscribe(_=>{this.ended.emit({source:this,distance:_.distance,dropPoint:_.dropPoint,event:_.event}),this._changeDetectorRef.markForCheck()}),u.entered.subscribe(_=>{this.entered.emit({container:_.container.data,item:this,currentIndex:_.currentIndex})}),u.exited.subscribe(_=>{this.exited.emit({container:_.container.data,item:this})}),u.dropped.subscribe(_=>{this.dropped.emit({previousIndex:_.previousIndex,currentIndex:_.currentIndex,previousContainer:_.previousContainer.data,container:_.container.data,isPointerOverContainer:_.isPointerOverContainer,item:this,distance:_.distance,dropPoint:_.dropPoint,event:_.event})})}_assignDefaults(u){let{lockAxis:_,dragStartDelay:r,constrainPosition:M,previewClass:F,boundaryElement:q,draggingDisabled:re,rootElementSelector:me,previewContainer:De}=u;this.disabled=re??!1,this.dragStartDelay=r||0,_&&(this.lockAxis=_),M&&(this.constrainPosition=M),F&&(this.previewClass=F),q&&(this.boundaryElement=q),me&&(this.rootElementSelector=me),De&&(this.previewContainer=De)}_setupHandlesListener(){this._handles.changes.pipe(ho(this._handles),Rr(u=>{let _=u.filter(r=>r._parentDrag===this).map(r=>r.element);this._selfHandle&&this.rootElementSelector&&_.push(this.element),this._dragRef.withHandles(_)}),wo(u=>Ha(...u.map(_=>_._stateChanges.pipe(ho(_))))),Fo(this._destroyed)).subscribe(u=>{let _=this._dragRef,r=u.element.nativeElement;u.disabled?_.disableHandle(r):_.enableHandle(r)})}};m._dragInstances=[],m.\u0275fac=function(_){return new(_||m)(Xe(zn),Xe(c3,12),Xe(vr),Xe(Dn),Xe(Za),Xe(s3,8),Xe(Xa,8),Xe(r3),Xe(On),Xe(US,10),Xe(VS,12))},m.\u0275dir=fn({type:m,selectors:[["","cdkDrag",""]],contentQueries:function(_,r,M){if(_&1&&(Ur(M,a3,5),Ur(M,o3,5),Ur(M,US,5)),_&2){let F;Ni(F=ji())&&(r._previewTemplate=F.first),Ni(F=ji())&&(r._placeholderTemplate=F.first),Ni(F=ji())&&(r._handles=F)}},hostAttrs:[1,"cdk-drag"],hostVars:4,hostBindings:function(_,r){_&2&&_n("cdk-drag-disabled",r.disabled)("cdk-drag-dragging",r._dragRef.isDragging())},inputs:{data:[ti.None,"cdkDragData","data"],lockAxis:[ti.None,"cdkDragLockAxis","lockAxis"],rootElementSelector:[ti.None,"cdkDragRootElement","rootElementSelector"],boundaryElement:[ti.None,"cdkDragBoundary","boundaryElement"],dragStartDelay:[ti.None,"cdkDragStartDelay","dragStartDelay"],freeDragPosition:[ti.None,"cdkDragFreeDragPosition","freeDragPosition"],disabled:[ti.HasDecoratorInputTransform,"cdkDragDisabled","disabled",gn],constrainPosition:[ti.None,"cdkDragConstrainPosition","constrainPosition"],previewClass:[ti.None,"cdkDragPreviewClass","previewClass"],previewContainer:[ti.None,"cdkDragPreviewContainer","previewContainer"]},outputs:{started:"cdkDragStarted",released:"cdkDragReleased",ended:"cdkDragEnded",entered:"cdkDragEntered",exited:"cdkDragExited",dropped:"cdkDragDropped",moved:"cdkDragMoved"},exportAs:["cdkDrag"],standalone:!0,features:[Or([{provide:VS,useExisting:m}]),nr,lr]});let w=m;return w})();var d3=[[["","fixedTop",""]],"*"],h3=["[fixedTop]","*"],WS=(()=>{let m=class m{constructor(){this._themeService=St(uc),this.darkMode=this._themeService.darkMode,this.allowSizeChange=!0,this.clickedClose=new Ut}};m.\u0275fac=function(_){return new(_||m)},m.\u0275cmp=hi({type:m,selectors:[["lib-ng-dragable-window"]],inputs:{allowSizeChange:"allowSizeChange"},outputs:{clickedClose:"clickedClose"},standalone:!0,features:[ui],ngContentSelectors:h3,decls:9,vars:4,consts:[["cdkDrag","",1,"window"],["cdkDragHandle","",1,"btn-row"],["mat-icon-button","","aria-label","Close dialog",3,"click"]],template:function(_,r){_&1&&(pr(d3),Ue(0,"mat-card",0)(1,"mat-card-header")(2,"div",1)(3,"button",2),$t("click",function(){return r.clickedClose.emit()}),Ue(4,"mat-icon"),Bt(5,"close"),Ge()()(),kn(6),Ge(),Ue(7,"mat-card-content"),kn(8,1),Ge()()),_&2&&Wa("background-color",r.darkMode()?"rgba(0,0,0,0.5)":"rgba(255,255,255,0.5)")("resize",r.allowSizeChange?"both":"none")},dependencies:[In,Kh,Yh,sI,lI,qo,Nh,xa,va,ZS],styles:[".window[_ngcontent-%COMP%]{position:absolute;top:100px;left:20px;min-width:200px;min-height:50px;max-width:80vw;z-index:10;border:1px solid}mat-card-header[_ngcontent-%COMP%]{padding:0;display:flex;flex-direction:column}.btn-row[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:row;justify-content:flex-end;padding:0}mat-card-header[_ngcontent-%COMP%]:hover{cursor:move}mat-card-content[_ngcontent-%COMP%]{max-height:60vh;overflow-y:auto}"]});let w=m;return w})();var eC=ob(qv());function QS(w,m){let x=0,u=0,_=0,r=0,M=()=>{document.onmouseup=null,document.onmousemove=null,w.classList.remove("drag")},F=re=>{re.preventDefault(),x=_-re.clientX,u=r-re.clientY,_=re.clientX,r=re.clientY,w.style.top=`${w.offsetTop-u}px`,w.style.left=`${w.offsetLeft-x}px`},q=re=>{re.preventDefault(),_=re.clientX,r=re.clientY,w.classList.add("drag"),document.onmouseup=M,document.onmousemove=F};m.onmousedown=q}var JS=ob(qv()),Hv=class{constructor(){this.backgroundColor="rgba(0, 0, 0, 0.8)",this.textColor="white",this.textSize="0.8em",this.borderWidth="2px",this.borderRadius="5px",this.borderColor="#000",this.padding="10px",this.showCloseButton=!0}},h0=class{constructor(m){this._parentDiv=m,this._windowDiv=document.createElement("div"),this._infoDiv=document.createElement("div"),this._contentDiv=document.createElement("div"),this._styles=new Hv,this.events=new JS.EventEmitter,this._createLegendDiv()}setContent(m){this.clearContent(),this._contentDiv?.appendChild(m)}clearContent(){this._contentDiv.innerHTML=""}setVisibility(m){this._windowDiv.style.display=m?"flex":"none"}setPosition(m="70px",x="20px"){this._windowDiv.style.top=m,this._windowDiv.style.left=x}setInfoText(m){this._infoDiv.style.display="flex",this._infoDiv.innerText=m}hideInfoText(){this._infoDiv.style.display="none"}_createLegendDiv(){this._windowDiv.id="dragable",this._windowDiv.style.zIndex="100",this._windowDiv.style.position="absolute",this._windowDiv.style.display="flex",this._windowDiv.style.flexDirection="column",this._windowDiv.style.top="70px",this._windowDiv.style.left="20px",this._windowDiv.style.zIndex="100",this._windowDiv.style.fontSize=this._styles.textSize,this._windowDiv.style.color=this._styles.textColor,this._windowDiv.style.borderRadius=this._styles.borderRadius,this._windowDiv.style.padding=this._styles.padding,this._windowDiv.style.backgroundColor=this._styles.backgroundColor,this._windowDiv.style.maxWidth="50vw",this._windowDiv.style.maxHeight="500px",this._parentDiv.appendChild(this._windowDiv);let m=document.createElement("div");if(this._windowDiv.id="dragzone",m.style.display="flex",m.style.justifyContent="flex-end",m.style.marginBottom="10px",m.style.alignItems="center",m.style.cursor="move",m.style.borderTopLeftRadius=this._styles.borderRadius,m.style.borderTopRightRadius=this._styles.borderRadius,m.style.width="100%",this._windowDiv.appendChild(m),QS(this._windowDiv,m),this._styles.showCloseButton){let x=document.createElement("span");x.classList.add("material-icons"),x.style.pointerEvents="auto",x.style.cursor="pointer",x.addEventListener("click",()=>{this.setVisibility(!1),this.events.emit("clickedClose")}),x.style.fontSize=this._styles.textSize,x.innerText="close",m.appendChild(x)}this._infoDiv.style.display="none",this._infoDiv.style.marginBottom="10px",this._infoDiv.style.maxWidth="200px",this._infoDiv.style.fontStyle="oblique",this._infoDiv.style.fontSize="0.9em",this._windowDiv.appendChild(this._infoDiv),this._contentDiv.style.overflowY="auto",this._windowDiv.appendChild(this._contentDiv),this._windowDiv.addEventListener("mousedown",x=>{x.stopPropagation()})}};var Zv=class{constructor(){this.boxRadius="2px",this.clickable=!0}},u0=class w extends h0{constructor(m){super(m),this._items=[],this._legendStyles=new Zv,this.events=new eC.EventEmitter}static getInstance(m){return this._instance?this._instance:(this._instance=new w(m),this._instance)}setItems(m){this._items=m,this._createColorLegend()}_createColorLegend(){this._legend=document.createElement("div"),this._legend.style.display="flex",this._legend.style.flexDirection="column",this._legend.style.gap="5px",this._items.forEach(m=>{let x=document.createElement("div");x.style.display="flex",x.style.width="100%",x.style.flexDirection="row",x.style.alignItems="center",x.style.gap="10px",this._legendStyles.clickable&&(x.style.cursor="pointer",x.addEventListener("click",()=>this.events.emit("clickedRow",m))),this._legend?.appendChild(x);let u=document.createElement("div");u.style.width="15px",u.style.height="15px",u.style.backgroundColor=m.color,u.style.borderRadius=this._legendStyles.boxRadius,x.appendChild(u);let _=document.createElement("div");_.innerText=m.text,x.appendChild(_)}),this.setContent(this._legend)}};function _3(w,m){w&1&&kn(0)}var Kv=["*"],g3=["tabListContainer"],y3=["tabList"],b3=["tabListInner"],v3=["nextPaginator"],x3=["previousPaginator"];function w3(w,m){}var T3=w=>({animationDuration:w}),k3=(w,m)=>({value:w,params:m}),I3=["tabBodyWrapper"],S3=["tabHeader"];function C3(w,m){}function M3(w,m){if(w&1&&bi(0,C3,0,0,"ng-template",10),w&2){let x=Dt().$implicit;Ct("cdkPortalOutlet",x.templateLabel)}}function E3(w,m){if(w&1&&Bt(0),w&2){let x=Dt().$implicit;hn(x.textLabel)}}function A3(w,m){if(w&1){let x=dn();Ue(0,"div",4,5),$t("click",function(){let _=Xi(x),r=_.$implicit,M=_.$index,F=Dt(),q=pg(1);return Yi(F._handleClick(r,q,M))})("cdkFocusChange",function(_){let M=Xi(x).$index,F=Dt();return Yi(F._tabFocusChanged(_,M))}),Ki(2,"span",6)(3,"div",7),Ue(4,"span",8)(5,"span",9),bi(6,M3,1,1,null,10)(7,E3,1,1),Ge()()()}if(w&2){let x=m.$implicit,u=m.$index,_=pg(1),r=Dt();_n("mdc-tab--active",r.selectedIndex===u),Ct("id",r._getTabLabelId(u))("ngClass",x.labelClass)("disabled",x.disabled)("fitInkBarToContent",r.fitInkBarToContent),cr("tabIndex",r._getTabIndex(u))("aria-posinset",u+1)("aria-setsize",r._tabs.length)("aria-controls",r._getTabContentId(u))("aria-selected",r.selectedIndex===u)("aria-label",x.ariaLabel||null)("aria-labelledby",!x.ariaLabel&&x.ariaLabelledby?x.ariaLabelledby:null),Ze(3),Ct("matRippleTrigger",_)("matRippleDisabled",x.disabled||r.disableRipple),Ze(3),Bo(6,x.templateLabel?6:7)}}function D3(w,m){w&1&&kn(0)}function P3(w,m){if(w&1){let x=dn();Ue(0,"mat-tab-body",11),$t("_onCentered",function(){Xi(x);let _=Dt();return Yi(_._removeTabBodyWrapperHeight())})("_onCentering",function(_){Xi(x);let r=Dt();return Yi(r._setTabBodyWrapperHeight(_))}),Ge()}if(w&2){let x=m.$implicit,u=m.$index,_=Dt();_n("mat-mdc-tab-body-active",_.selectedIndex===u),Ct("id",_._getTabContentId(u))("ngClass",x.bodyClass)("content",x.content)("position",x.position)("origin",x.origin)("animationDuration",_.animationDuration)("preserveContent",_.preserveContent),cr("tabindex",_.contentTabIndex!=null&&_.selectedIndex===u?_.contentTabIndex:null)("aria-labelledby",_._getTabLabelId(u))("aria-hidden",_.selectedIndex!==u)}}var R3=new ci("MatTabContent"),L3=(()=>{let m=class m{constructor(u){this.template=u}};m.\u0275fac=function(_){return new(_||m)(Xe(To))},m.\u0275dir=fn({type:m,selectors:[["","matTabContent",""]],standalone:!0,features:[Or([{provide:R3,useExisting:m}])]});let w=m;return w})(),z3=new ci("MatTabLabel"),nC=new ci("MAT_TAB"),O3=(()=>{let m=class m extends sk{constructor(u,_,r){super(u,_),this._closestTab=r}};m.\u0275fac=function(_){return new(_||m)(Xe(To),Xe(Za),Xe(nC,8))},m.\u0275dir=fn({type:m,selectors:[["","mat-tab-label",""],["","matTabLabel",""]],standalone:!0,features:[Or([{provide:z3,useExisting:m}]),po]});let w=m;return w})(),rC=new ci("MAT_TAB_GROUP"),Qv=(()=>{let m=class m{get templateLabel(){return this._templateLabel}set templateLabel(u){this._setTemplateLabelInput(u)}get content(){return this._contentPortal}constructor(u,_){this._viewContainerRef=u,this._closestTabGroup=_,this.disabled=!1,this._explicitContent=void 0,this.textLabel="",this._contentPortal=null,this._stateChanges=new ei,this.position=null,this.origin=null,this.isActive=!1}ngOnChanges(u){(u.hasOwnProperty("textLabel")||u.hasOwnProperty("disabled"))&&this._stateChanges.next()}ngOnDestroy(){this._stateChanges.complete()}ngOnInit(){this._contentPortal=new oc(this._explicitContent||this._implicitContent,this._viewContainerRef)}_setTemplateLabelInput(u){u&&u._closestTab===this&&(this._templateLabel=u)}};m.\u0275fac=function(_){return new(_||m)(Xe(Za),Xe(rC,8))},m.\u0275cmp=hi({type:m,selectors:[["mat-tab"]],contentQueries:function(_,r,M){if(_&1&&(Ur(M,O3,5),Ur(M,L3,7,To)),_&2){let F;Ni(F=ji())&&(r.templateLabel=F.first),Ni(F=ji())&&(r._explicitContent=F.first)}},viewQuery:function(_,r){if(_&1&&Fn(To,7),_&2){let M;Ni(M=ji())&&(r._implicitContent=M.first)}},hostAttrs:["hidden",""],inputs:{disabled:[ti.HasDecoratorInputTransform,"disabled","disabled",gn],textLabel:[ti.None,"label","textLabel"],ariaLabel:[ti.None,"aria-label","ariaLabel"],ariaLabelledby:[ti.None,"aria-labelledby","ariaLabelledby"],labelClass:"labelClass",bodyClass:"bodyClass"},exportAs:["matTab"],standalone:!0,features:[Or([{provide:nC,useExisting:m}]),nr,lr,ui],ngContentSelectors:Kv,decls:1,vars:0,template:function(_,r){_&1&&(pr(),bi(0,_3,1,0,"ng-template"))},encapsulation:2});let w=m;return w})(),Wv="mdc-tab-indicator--active",tC="mdc-tab-indicator--no-transition",Xv=class{constructor(m){this._items=m}hide(){this._items.forEach(m=>m.deactivateInkBar())}alignToElement(m){let x=this._items.find(_=>_.elementRef.nativeElement===m),u=this._currentItem;if(x!==u&&(u?.deactivateInkBar(),x)){let _=u?.elementRef.nativeElement.getBoundingClientRect?.();x.activateInkBar(_),this._currentItem=x}}},F3=(()=>{let m=class m{constructor(){this._elementRef=St(zn),this._fitToContent=!1}get fitInkBarToContent(){return this._fitToContent}set fitInkBarToContent(u){this._fitToContent!==u&&(this._fitToContent=u,this._inkBarElement&&this._appendInkBarElement())}activateInkBar(u){let _=this._elementRef.nativeElement;if(!u||!_.getBoundingClientRect||!this._inkBarContentElement){_.classList.add(Wv);return}let r=_.getBoundingClientRect(),M=u.width/r.width,F=u.left-r.left;_.classList.add(tC),this._inkBarContentElement.style.setProperty("transform",`translateX(${F}px) scaleX(${M})`),_.getBoundingClientRect(),_.classList.remove(tC),_.classList.add(Wv),this._inkBarContentElement.style.setProperty("transform","")}deactivateInkBar(){this._elementRef.nativeElement.classList.remove(Wv)}ngOnInit(){this._createInkBarElement()}ngOnDestroy(){this._inkBarElement?.remove(),this._inkBarElement=this._inkBarContentElement=null}_createInkBarElement(){let u=this._elementRef.nativeElement.ownerDocument||document,_=this._inkBarElement=u.createElement("span"),r=this._inkBarContentElement=u.createElement("span");_.className="mdc-tab-indicator",r.className="mdc-tab-indicator__content mdc-tab-indicator__content--underline",_.appendChild(this._inkBarContentElement),this._appendInkBarElement()}_appendInkBarElement(){this._inkBarElement;let u=this._fitToContent?this._elementRef.nativeElement.querySelector(".mdc-tab__content"):this._elementRef.nativeElement;u.appendChild(this._inkBarElement)}};m.\u0275fac=function(_){return new(_||m)},m.\u0275dir=fn({type:m,inputs:{fitInkBarToContent:[ti.HasDecoratorInputTransform,"fitInkBarToContent","fitInkBarToContent",Fr]},features:[nr]});let w=m;return w})();var oC=(()=>{let m=class m extends F3{constructor(u){super(),this.elementRef=u,this.disabled=!1}focus(){this.elementRef.nativeElement.focus()}getOffsetLeft(){return this.elementRef.nativeElement.offsetLeft}getOffsetWidth(){return this.elementRef.nativeElement.offsetWidth}};m.\u0275fac=function(_){return new(_||m)(Xe(zn))},m.\u0275dir=fn({type:m,selectors:[["","matTabLabelWrapper",""]],hostVars:3,hostBindings:function(_,r){_&2&&(cr("aria-disabled",!!r.disabled),_n("mat-mdc-tab-disabled",r.disabled))},inputs:{fitInkBarToContent:"fitInkBarToContent",disabled:[ti.HasDecoratorInputTransform,"disabled","disabled",gn]},standalone:!0,features:[nr,po]});let w=m;return w})(),iC=Ph({passive:!0}),B3=650,N3=100,j3=(()=>{let m=class m{get selectedIndex(){return this._selectedIndex}set selectedIndex(u){let _=isNaN(u)?0:u;this._selectedIndex!=_&&(this._selectedIndexChanged=!0,this._selectedIndex=_,this._keyManager&&this._keyManager.updateActiveItem(_))}constructor(u,_,r,M,F,q,re){this._elementRef=u,this._changeDetectorRef=_,this._viewportRuler=r,this._dir=M,this._ngZone=F,this._platform=q,this._animationMode=re,this._scrollDistance=0,this._selectedIndexChanged=!1,this._destroyed=new ei,this._showPaginationControls=!1,this._disableScrollAfter=!0,this._disableScrollBefore=!0,this._stopScrolling=new ei,this.disablePagination=!1,this._selectedIndex=0,this.selectFocusedIndex=new Ut,this.indexFocused=new Ut,F.runOutsideAngular(()=>{ig(u.nativeElement,"mouseleave").pipe(Fo(this._destroyed)).subscribe(()=>{this._stopInterval()})})}ngAfterViewInit(){ig(this._previousPaginator.nativeElement,"touchstart",iC).pipe(Fo(this._destroyed)).subscribe(()=>{this._handlePaginatorPress("before")}),ig(this._nextPaginator.nativeElement,"touchstart",iC).pipe(Fo(this._destroyed)).subscribe(()=>{this._handlePaginatorPress("after")})}ngAfterContentInit(){let u=this._dir?this._dir.change:wi("ltr"),_=this._viewportRuler.change(150),r=()=>{this.updatePagination(),this._alignInkBarToSelectedTab()};this._keyManager=new yg(this._items).withHorizontalOrientation(this._getLayoutDirection()).withHomeAndEnd().withWrap().skipPredicate(()=>!1),this._keyManager.updateActiveItem(this._selectedIndex),this._ngZone.onStable.pipe(Qr(1)).subscribe(r),Ha(u,_,this._items.changes,this._itemsResized()).pipe(Fo(this._destroyed)).subscribe(()=>{this._ngZone.run(()=>{Promise.resolve().then(()=>{this._scrollDistance=Math.max(0,Math.min(this._getMaxScrollDistance(),this._scrollDistance)),r()})}),this._keyManager.withHorizontalOrientation(this._getLayoutDirection())}),this._keyManager.change.subscribe(M=>{this.indexFocused.emit(M),this._setTabFocus(M)})}_itemsResized(){return typeof ResizeObserver!="function"?qa:this._items.changes.pipe(ho(this._items),wo(u=>new cp(_=>this._ngZone.runOutsideAngular(()=>{let r=new ResizeObserver(M=>_.next(M));return u.forEach(M=>r.observe(M.elementRef.nativeElement)),()=>{r.disconnect()}}))),b2(1),Pr(u=>u.some(_=>_.contentRect.width>0&&_.contentRect.height>0)))}ngAfterContentChecked(){this._tabLabelCount!=this._items.length&&(this.updatePagination(),this._tabLabelCount=this._items.length,this._changeDetectorRef.markForCheck()),this._selectedIndexChanged&&(this._scrollToLabel(this._selectedIndex),this._checkScrollingControls(),this._alignInkBarToSelectedTab(),this._selectedIndexChanged=!1,this._changeDetectorRef.markForCheck()),this._scrollDistanceChanged&&(this._updateTabScrollPosition(),this._scrollDistanceChanged=!1,this._changeDetectorRef.markForCheck())}ngOnDestroy(){this._keyManager?.destroy(),this._destroyed.next(),this._destroyed.complete(),this._stopScrolling.complete()}_handleKeydown(u){if(!rc(u))switch(u.keyCode){case 13:case 32:if(this.focusIndex!==this.selectedIndex){let _=this._items.get(this.focusIndex);_&&!_.disabled&&(this.selectFocusedIndex.emit(this.focusIndex),this._itemSelected(u))}break;default:this._keyManager.onKeydown(u)}}_onContentChanges(){let u=this._elementRef.nativeElement.textContent;u!==this._currentTextContent&&(this._currentTextContent=u||"",this._ngZone.run(()=>{this.updatePagination(),this._alignInkBarToSelectedTab(),this._changeDetectorRef.markForCheck()}))}updatePagination(){this._checkPaginationEnabled(),this._checkScrollingControls(),this._updateTabScrollPosition()}get focusIndex(){return this._keyManager?this._keyManager.activeItemIndex:0}set focusIndex(u){!this._isValidIndex(u)||this.focusIndex===u||!this._keyManager||this._keyManager.setActiveItem(u)}_isValidIndex(u){return this._items?!!this._items.toArray()[u]:!0}_setTabFocus(u){if(this._showPaginationControls&&this._scrollToLabel(u),this._items&&this._items.length){this._items.toArray()[u].focus();let _=this._tabListContainer.nativeElement;this._getLayoutDirection()=="ltr"?_.scrollLeft=0:_.scrollLeft=_.scrollWidth-_.offsetWidth}}_getLayoutDirection(){return this._dir&&this._dir.value==="rtl"?"rtl":"ltr"}_updateTabScrollPosition(){if(this.disablePagination)return;let u=this.scrollDistance,_=this._getLayoutDirection()==="ltr"?-u:u;this._tabList.nativeElement.style.transform=`translateX(${Math.round(_)}px)`,(this._platform.TRIDENT||this._platform.EDGE)&&(this._tabListContainer.nativeElement.scrollLeft=0)}get scrollDistance(){return this._scrollDistance}set scrollDistance(u){this._scrollTo(u)}_scrollHeader(u){let _=this._tabListContainer.nativeElement.offsetWidth,r=(u=="before"?-1:1)*_/3;return this._scrollTo(this._scrollDistance+r)}_handlePaginatorClick(u){this._stopInterval(),this._scrollHeader(u)}_scrollToLabel(u){if(this.disablePagination)return;let _=this._items?this._items.toArray()[u]:null;if(!_)return;let r=this._tabListContainer.nativeElement.offsetWidth,{offsetLeft:M,offsetWidth:F}=_.elementRef.nativeElement,q,re;this._getLayoutDirection()=="ltr"?(q=M,re=q+F):(re=this._tabListInner.nativeElement.offsetWidth-M,q=re-F);let me=this.scrollDistance,De=this.scrollDistance+r;q<me?this.scrollDistance-=me-q:re>De&&(this.scrollDistance+=Math.min(re-De,q-me))}_checkPaginationEnabled(){if(this.disablePagination)this._showPaginationControls=!1;else{let u=this._tabListInner.nativeElement.scrollWidth>this._elementRef.nativeElement.offsetWidth;u||(this.scrollDistance=0),u!==this._showPaginationControls&&this._changeDetectorRef.markForCheck(),this._showPaginationControls=u}}_checkScrollingControls(){this.disablePagination?this._disableScrollAfter=this._disableScrollBefore=!0:(this._disableScrollBefore=this.scrollDistance==0,this._disableScrollAfter=this.scrollDistance==this._getMaxScrollDistance(),this._changeDetectorRef.markForCheck())}_getMaxScrollDistance(){let u=this._tabListInner.nativeElement.scrollWidth,_=this._tabListContainer.nativeElement.offsetWidth;return u-_||0}_alignInkBarToSelectedTab(){let u=this._items&&this._items.length?this._items.toArray()[this.selectedIndex]:null,_=u?u.elementRef.nativeElement:null;_?this._inkBar.alignToElement(_):this._inkBar.hide()}_stopInterval(){this._stopScrolling.next()}_handlePaginatorPress(u,_){_&&_.button!=null&&_.button!==0||(this._stopInterval(),p2(B3,N3).pipe(Fo(Ha(this._stopScrolling,this._destroyed))).subscribe(()=>{let{maxScrollDistance:r,distance:M}=this._scrollHeader(u);(M===0||M>=r)&&this._stopInterval()}))}_scrollTo(u){if(this.disablePagination)return{maxScrollDistance:0,distance:0};let _=this._getMaxScrollDistance();return this._scrollDistance=Math.max(0,Math.min(_,u)),this._scrollDistanceChanged=!0,this._checkScrollingControls(),{maxScrollDistance:_,distance:this._scrollDistance}}};m.\u0275fac=function(_){return new(_||m)(Xe(zn),Xe(On),Xe(wp),Xe(Xa,8),Xe(Dn),Xe(da),Xe(mo,8))},m.\u0275dir=fn({type:m,inputs:{disablePagination:[ti.HasDecoratorInputTransform,"disablePagination","disablePagination",gn],selectedIndex:[ti.HasDecoratorInputTransform,"selectedIndex","selectedIndex",Fr]},outputs:{selectFocusedIndex:"selectFocusedIndex",indexFocused:"indexFocused"},features:[nr]});let w=m;return w})(),V3=(()=>{let m=class m extends j3{constructor(u,_,r,M,F,q,re){super(u,_,r,M,F,q,re),this.disableRipple=!1}ngAfterContentInit(){this._inkBar=new Xv(this._items),super.ngAfterContentInit()}_itemSelected(u){u.preventDefault()}};m.\u0275fac=function(_){return new(_||m)(Xe(zn),Xe(On),Xe(wp),Xe(Xa,8),Xe(Dn),Xe(da),Xe(mo,8))},m.\u0275cmp=hi({type:m,selectors:[["mat-tab-header"]],contentQueries:function(_,r,M){if(_&1&&Ur(M,oC,4),_&2){let F;Ni(F=ji())&&(r._items=F)}},viewQuery:function(_,r){if(_&1&&(Fn(g3,7),Fn(y3,7),Fn(b3,7),Fn(v3,5),Fn(x3,5)),_&2){let M;Ni(M=ji())&&(r._tabListContainer=M.first),Ni(M=ji())&&(r._tabList=M.first),Ni(M=ji())&&(r._tabListInner=M.first),Ni(M=ji())&&(r._nextPaginator=M.first),Ni(M=ji())&&(r._previousPaginator=M.first)}},hostAttrs:[1,"mat-mdc-tab-header"],hostVars:4,hostBindings:function(_,r){_&2&&_n("mat-mdc-tab-header-pagination-controls-enabled",r._showPaginationControls)("mat-mdc-tab-header-rtl",r._getLayoutDirection()=="rtl")},inputs:{disableRipple:[ti.HasDecoratorInputTransform,"disableRipple","disableRipple",gn]},standalone:!0,features:[nr,po,ui],ngContentSelectors:Kv,decls:13,vars:10,consts:[["aria-hidden","true","type","button","mat-ripple","","tabindex","-1",1,"mat-mdc-tab-header-pagination","mat-mdc-tab-header-pagination-before",3,"matRippleDisabled","disabled","click","mousedown","touchend"],["previousPaginator",""],[1,"mat-mdc-tab-header-pagination-chevron"],[1,"mat-mdc-tab-label-container",3,"keydown"],["tabListContainer",""],["role","tablist",1,"mat-mdc-tab-list",3,"cdkObserveContent"],["tabList",""],[1,"mat-mdc-tab-labels"],["tabListInner",""],["aria-hidden","true","type","button","mat-ripple","","tabindex","-1",1,"mat-mdc-tab-header-pagination","mat-mdc-tab-header-pagination-after",3,"matRippleDisabled","disabled","mousedown","click","touchend"],["nextPaginator",""]],template:function(_,r){_&1&&(pr(),Ue(0,"button",0,1),$t("click",function(){return r._handlePaginatorClick("before")})("mousedown",function(F){return r._handlePaginatorPress("before",F)})("touchend",function(){return r._stopInterval()}),Ki(2,"div",2),Ge(),Ue(3,"div",3,4),$t("keydown",function(F){return r._handleKeydown(F)}),Ue(5,"div",5,6),$t("cdkObserveContent",function(){return r._onContentChanges()}),Ue(7,"div",7,8),kn(9),Ge()()(),Ue(10,"button",9,10),$t("mousedown",function(F){return r._handlePaginatorPress("after",F)})("click",function(){return r._handlePaginatorClick("after")})("touchend",function(){return r._stopInterval()}),Ki(12,"div",2),Ge()),_&2&&(_n("mat-mdc-tab-header-pagination-disabled",r._disableScrollBefore),Ct("matRippleDisabled",r._disableScrollBefore||r.disableRipple)("disabled",r._disableScrollBefore||null),Ze(3),_n("_mat-animation-noopable",r._animationMode==="NoopAnimations"),Ze(7),_n("mat-mdc-tab-header-pagination-disabled",r._disableScrollAfter),Ct("matRippleDisabled",r._disableScrollAfter||r.disableRipple)("disabled",r._disableScrollAfter||null))},dependencies:[vd,bb],styles:[".mat-mdc-tab-header{display:flex;overflow:hidden;position:relative;flex-shrink:0}.mdc-tab-indicator .mdc-tab-indicator__content{transition-duration:var(--mat-tab-animation-duration, 250ms)}.mat-mdc-tab-header-pagination{-webkit-user-select:none;user-select:none;position:relative;display:none;justify-content:center;align-items:center;min-width:32px;cursor:pointer;z-index:2;-webkit-tap-highlight-color:rgba(0,0,0,0);touch-action:none;box-sizing:content-box;background:none;border:none;outline:0;padding:0}.mat-mdc-tab-header-pagination::-moz-focus-inner{border:0}.mat-mdc-tab-header-pagination .mat-ripple-element{opacity:.12;background-color:var(--mat-tab-header-inactive-ripple-color)}.mat-mdc-tab-header-pagination-controls-enabled .mat-mdc-tab-header-pagination{display:flex}.mat-mdc-tab-header-pagination-before,.mat-mdc-tab-header-rtl .mat-mdc-tab-header-pagination-after{padding-left:4px}.mat-mdc-tab-header-pagination-before .mat-mdc-tab-header-pagination-chevron,.mat-mdc-tab-header-rtl .mat-mdc-tab-header-pagination-after .mat-mdc-tab-header-pagination-chevron{transform:rotate(-135deg)}.mat-mdc-tab-header-rtl .mat-mdc-tab-header-pagination-before,.mat-mdc-tab-header-pagination-after{padding-right:4px}.mat-mdc-tab-header-rtl .mat-mdc-tab-header-pagination-before .mat-mdc-tab-header-pagination-chevron,.mat-mdc-tab-header-pagination-after .mat-mdc-tab-header-pagination-chevron{transform:rotate(45deg)}.mat-mdc-tab-header-pagination-chevron{border-style:solid;border-width:2px 2px 0 0;height:8px;width:8px;border-color:var(--mat-tab-header-pagination-icon-color)}.mat-mdc-tab-header-pagination-disabled{box-shadow:none;cursor:default;pointer-events:none}.mat-mdc-tab-header-pagination-disabled .mat-mdc-tab-header-pagination-chevron{opacity:.4}.mat-mdc-tab-list{flex-grow:1;position:relative;transition:transform 500ms cubic-bezier(0.35, 0, 0.25, 1)}._mat-animation-noopable .mat-mdc-tab-list{transition:none}._mat-animation-noopable span.mdc-tab-indicator__content,._mat-animation-noopable span.mdc-tab__text-label{transition:none}.mat-mdc-tab-label-container{display:flex;flex-grow:1;overflow:hidden;z-index:1;border-bottom-style:solid;border-bottom-width:var(--mat-tab-header-divider-height);border-bottom-color:var(--mat-tab-header-divider-color)}.mat-mdc-tab-group-inverted-header .mat-mdc-tab-label-container{border-bottom:none;border-top-style:solid;border-top-width:var(--mat-tab-header-divider-height);border-top-color:var(--mat-tab-header-divider-color)}.mat-mdc-tab-labels{display:flex;flex:1 0 auto}[mat-align-tabs=center]>.mat-mdc-tab-header .mat-mdc-tab-labels{justify-content:center}[mat-align-tabs=end]>.mat-mdc-tab-header .mat-mdc-tab-labels{justify-content:flex-end}.mat-mdc-tab::before{margin:5px}.cdk-high-contrast-active .mat-mdc-tab[aria-disabled=true]{color:GrayText}"],encapsulation:2});let w=m;return w})(),U3=new ci("MAT_TABS_CONFIG"),G3={translateTab:ws("translateTab",[ko("center, void, left-origin-center, right-origin-center",xr({transform:"none"})),ko("left",xr({transform:"translate3d(-100%, 0, 0)",minHeight:"1px",visibility:"hidden"})),ko("right",xr({transform:"translate3d(100%, 0, 0)",minHeight:"1px",visibility:"hidden"})),Uo("* => left, * => right, left => center, right => center",Vo("{{animationDuration}} cubic-bezier(0.35, 0, 0.25, 1)")),Uo("void => left-origin-center",[xr({transform:"translate3d(-100%, 0, 0)",visibility:"hidden"}),Vo("{{animationDuration}} cubic-bezier(0.35, 0, 0.25, 1)")]),Uo("void => right-origin-center",[xr({transform:"translate3d(100%, 0, 0)",visibility:"hidden"}),Vo("{{animationDuration}} cubic-bezier(0.35, 0, 0.25, 1)")])])},$3=(()=>{let m=class m extends $o{constructor(u,_,r,M){super(u,_,M),this._host=r,this._centeringSub=Vr.EMPTY,this._leavingSub=Vr.EMPTY}ngOnInit(){super.ngOnInit(),this._centeringSub=this._host._beforeCentering.pipe(ho(this._host._isCenterPosition(this._host._position))).subscribe(u=>{u&&!this.hasAttached()&&this.attach(this._host._content)}),this._leavingSub=this._host._afterLeavingCenter.subscribe(()=>{this._host.preserveContent||this.detach()})}ngOnDestroy(){super.ngOnDestroy(),this._centeringSub.unsubscribe(),this._leavingSub.unsubscribe()}};m.\u0275fac=function(_){return new(_||m)(Xe(ub),Xe(Za),Xe(og(()=>aC)),Xe(vr))},m.\u0275dir=fn({type:m,selectors:[["","matTabBodyHost",""]],standalone:!0,features:[po]});let w=m;return w})(),aC=(()=>{let m=class m{set position(u){this._positionIndex=u,this._computePositionAnimationState()}constructor(u,_,r){this._elementRef=u,this._dir=_,this._dirChangeSubscription=Vr.EMPTY,this._translateTabComplete=new ei,this._onCentering=new Ut,this._beforeCentering=new Ut,this._afterLeavingCenter=new Ut,this._onCentered=new Ut(!0),this.animationDuration="500ms",this.preserveContent=!1,_&&(this._dirChangeSubscription=_.change.subscribe(M=>{this._computePositionAnimationState(M),r.markForCheck()})),this._translateTabComplete.pipe(ng((M,F)=>M.fromState===F.fromState&&M.toState===F.toState)).subscribe(M=>{this._isCenterPosition(M.toState)&&this._isCenterPosition(this._position)&&this._onCentered.emit(),this._isCenterPosition(M.fromState)&&!this._isCenterPosition(this._position)&&this._afterLeavingCenter.emit()})}ngOnInit(){this._position=="center"&&this.origin!=null&&(this._position=this._computePositionFromOrigin(this.origin))}ngOnDestroy(){this._dirChangeSubscription.unsubscribe(),this._translateTabComplete.complete()}_onTranslateTabStarted(u){let _=this._isCenterPosition(u.toState);this._beforeCentering.emit(_),_&&this._onCentering.emit(this._elementRef.nativeElement.clientHeight)}_getLayoutDirection(){return this._dir&&this._dir.value==="rtl"?"rtl":"ltr"}_isCenterPosition(u){return u=="center"||u=="left-origin-center"||u=="right-origin-center"}_computePositionAnimationState(u=this._getLayoutDirection()){this._positionIndex<0?this._position=u=="ltr"?"left":"right":this._positionIndex>0?this._position=u=="ltr"?"right":"left":this._position="center"}_computePositionFromOrigin(u){let _=this._getLayoutDirection();return _=="ltr"&&u<=0||_=="rtl"&&u>0?"left-origin-center":"right-origin-center"}};m.\u0275fac=function(_){return new(_||m)(Xe(zn),Xe(Xa,8),Xe(On))},m.\u0275cmp=hi({type:m,selectors:[["mat-tab-body"]],viewQuery:function(_,r){if(_&1&&Fn($o,5),_&2){let M;Ni(M=ji())&&(r._portalHost=M.first)}},hostAttrs:[1,"mat-mdc-tab-body"],inputs:{_content:[ti.None,"content","_content"],origin:"origin",animationDuration:"animationDuration",preserveContent:"preserveContent",position:"position"},outputs:{_onCentering:"_onCentering",_beforeCentering:"_beforeCentering",_afterLeavingCenter:"_afterLeavingCenter",_onCentered:"_onCentered"},standalone:!0,features:[ui],decls:3,vars:6,consts:[["cdkScrollable","",1,"mat-mdc-tab-body-content"],["content",""],["matTabBodyHost",""]],template:function(_,r){_&1&&(Ue(0,"div",0,1),$t("@translateTab.start",function(F){return r._onTranslateTabStarted(F)})("@translateTab.done",function(F){return r._translateTabComplete.next(F)}),bi(2,w3,0,0,"ng-template",2),Ge()),_&2&&Ct("@translateTab",B2(3,k3,r._position,F2(1,T3,r.animationDuration)))},dependencies:[$3,ok],styles:['.mat-mdc-tab-body{top:0;left:0;right:0;bottom:0;position:absolute;display:block;overflow:hidden;outline:0;flex-basis:100%}.mat-mdc-tab-body.mat-mdc-tab-body-active{position:relative;overflow-x:hidden;overflow-y:auto;z-index:1;flex-grow:1}.mat-mdc-tab-group.mat-mdc-tab-group-dynamic-height .mat-mdc-tab-body.mat-mdc-tab-body-active{overflow-y:hidden}.mat-mdc-tab-body-content{height:100%;overflow:auto}.mat-mdc-tab-group-dynamic-height .mat-mdc-tab-body-content{overflow:hidden}.mat-mdc-tab-body-content[style*="visibility: hidden"]{display:none}'],encapsulation:2,data:{animation:[G3.translateTab]}});let w=m;return w})(),q3=0,H3=!0,sC=(()=>{let m=class m{get fitInkBarToContent(){return this._fitInkBarToContent}set fitInkBarToContent(u){this._fitInkBarToContent=u,this._changeDetectorRef.markForCheck()}get selectedIndex(){return this._selectedIndex}set selectedIndex(u){this._indexToSelect=isNaN(u)?null:u}get animationDuration(){return this._animationDuration}set animationDuration(u){let _=u+"";this._animationDuration=/^\d+$/.test(_)?u+"ms":_}get contentTabIndex(){return this._contentTabIndex}set contentTabIndex(u){this._contentTabIndex=isNaN(u)?null:u}get backgroundColor(){return this._backgroundColor}set backgroundColor(u){if(!H3)throw new Error("mat-tab-group background color must be set through the Sass theming API");let _=this._elementRef.nativeElement.classList;_.remove("mat-tabs-with-background",`mat-background-${this.backgroundColor}`),u&&_.add("mat-tabs-with-background",`mat-background-${u}`),this._backgroundColor=u}constructor(u,_,r,M){this._elementRef=u,this._changeDetectorRef=_,this._animationMode=M,this._tabs=new _p,this._indexToSelect=0,this._lastFocusedTabIndex=null,this._tabBodyWrapperHeight=0,this._tabsSubscription=Vr.EMPTY,this._tabLabelSubscription=Vr.EMPTY,this._fitInkBarToContent=!1,this.stretchTabs=!0,this.dynamicHeight=!1,this._selectedIndex=null,this.headerPosition="above",this.disablePagination=!1,this.disableRipple=!1,this.preserveContent=!1,this.selectedIndexChange=new Ut,this.focusChange=new Ut,this.animationDone=new Ut,this.selectedTabChange=new Ut(!0),this._isServer=!St(da).isBrowser,this._groupId=q3++,this.animationDuration=r&&r.animationDuration?r.animationDuration:"500ms",this.disablePagination=r&&r.disablePagination!=null?r.disablePagination:!1,this.dynamicHeight=r&&r.dynamicHeight!=null?r.dynamicHeight:!1,r?.contentTabIndex!=null&&(this.contentTabIndex=r.contentTabIndex),this.preserveContent=!!r?.preserveContent,this.fitInkBarToContent=r&&r.fitInkBarToContent!=null?r.fitInkBarToContent:!1,this.stretchTabs=r&&r.stretchTabs!=null?r.stretchTabs:!0}ngAfterContentChecked(){let u=this._indexToSelect=this._clampTabIndex(this._indexToSelect);if(this._selectedIndex!=u){let _=this._selectedIndex==null;if(!_){this.selectedTabChange.emit(this._createChangeEvent(u));let r=this._tabBodyWrapper.nativeElement;r.style.minHeight=r.clientHeight+"px"}Promise.resolve().then(()=>{this._tabs.forEach((r,M)=>r.isActive=M===u),_||(this.selectedIndexChange.emit(u),this._tabBodyWrapper.nativeElement.style.minHeight="")})}this._tabs.forEach((_,r)=>{_.position=r-u,this._selectedIndex!=null&&_.position==0&&!_.origin&&(_.origin=u-this._selectedIndex)}),this._selectedIndex!==u&&(this._selectedIndex=u,this._lastFocusedTabIndex=null,this._changeDetectorRef.markForCheck())}ngAfterContentInit(){this._subscribeToAllTabChanges(),this._subscribeToTabLabels(),this._tabsSubscription=this._tabs.changes.subscribe(()=>{let u=this._clampTabIndex(this._indexToSelect);if(u===this._selectedIndex){let _=this._tabs.toArray(),r;for(let M=0;M<_.length;M++)if(_[M].isActive){this._indexToSelect=this._selectedIndex=M,this._lastFocusedTabIndex=null,r=_[M];break}!r&&_[u]&&Promise.resolve().then(()=>{_[u].isActive=!0,this.selectedTabChange.emit(this._createChangeEvent(u))})}this._changeDetectorRef.markForCheck()})}_subscribeToAllTabChanges(){this._allTabs.changes.pipe(ho(this._allTabs)).subscribe(u=>{this._tabs.reset(u.filter(_=>_._closestTabGroup===this||!_._closestTabGroup)),this._tabs.notifyOnChanges()})}ngOnDestroy(){this._tabs.destroy(),this._tabsSubscription.unsubscribe(),this._tabLabelSubscription.unsubscribe()}realignInkBar(){this._tabHeader&&this._tabHeader._alignInkBarToSelectedTab()}updatePagination(){this._tabHeader&&this._tabHeader.updatePagination()}focusTab(u){let _=this._tabHeader;_&&(_.focusIndex=u)}_focusChanged(u){this._lastFocusedTabIndex=u,this.focusChange.emit(this._createChangeEvent(u))}_createChangeEvent(u){let _=new Yv;return _.index=u,this._tabs&&this._tabs.length&&(_.tab=this._tabs.toArray()[u]),_}_subscribeToTabLabels(){this._tabLabelSubscription&&this._tabLabelSubscription.unsubscribe(),this._tabLabelSubscription=Ha(...this._tabs.map(u=>u._stateChanges)).subscribe(()=>this._changeDetectorRef.markForCheck())}_clampTabIndex(u){return Math.min(this._tabs.length-1,Math.max(u||0,0))}_getTabLabelId(u){return`mat-tab-label-${this._groupId}-${u}`}_getTabContentId(u){return`mat-tab-content-${this._groupId}-${u}`}_setTabBodyWrapperHeight(u){if(!this.dynamicHeight||!this._tabBodyWrapperHeight)return;let _=this._tabBodyWrapper.nativeElement;_.style.height=this._tabBodyWrapperHeight+"px",this._tabBodyWrapper.nativeElement.offsetHeight&&(_.style.height=u+"px")}_removeTabBodyWrapperHeight(){let u=this._tabBodyWrapper.nativeElement;this._tabBodyWrapperHeight=u.clientHeight,u.style.height="",this.animationDone.emit()}_handleClick(u,_,r){_.focusIndex=r,u.disabled||(this.selectedIndex=r)}_getTabIndex(u){let _=this._lastFocusedTabIndex??this.selectedIndex;return u===_?0:-1}_tabFocusChanged(u,_){u&&u!=="mouse"&&u!=="touch"&&(this._tabHeader.focusIndex=_)}};m.\u0275fac=function(_){return new(_||m)(Xe(zn),Xe(On),Xe(U3,8),Xe(mo,8))},m.\u0275cmp=hi({type:m,selectors:[["mat-tab-group"]],contentQueries:function(_,r,M){if(_&1&&Ur(M,Qv,5),_&2){let F;Ni(F=ji())&&(r._allTabs=F)}},viewQuery:function(_,r){if(_&1&&(Fn(I3,5),Fn(S3,5)),_&2){let M;Ni(M=ji())&&(r._tabBodyWrapper=M.first),Ni(M=ji())&&(r._tabHeader=M.first)}},hostAttrs:[1,"mat-mdc-tab-group"],hostVars:10,hostBindings:function(_,r){_&2&&(yd("mat-"+(r.color||"primary")),Wa("--mat-tab-animation-duration",r.animationDuration),_n("mat-mdc-tab-group-dynamic-height",r.dynamicHeight)("mat-mdc-tab-group-inverted-header",r.headerPosition==="below")("mat-mdc-tab-group-stretch-tabs",r.stretchTabs))},inputs:{color:"color",fitInkBarToContent:[ti.HasDecoratorInputTransform,"fitInkBarToContent","fitInkBarToContent",gn],stretchTabs:[ti.HasDecoratorInputTransform,"mat-stretch-tabs","stretchTabs",gn],dynamicHeight:[ti.HasDecoratorInputTransform,"dynamicHeight","dynamicHeight",gn],selectedIndex:[ti.HasDecoratorInputTransform,"selectedIndex","selectedIndex",Fr],headerPosition:"headerPosition",animationDuration:"animationDuration",contentTabIndex:[ti.HasDecoratorInputTransform,"contentTabIndex","contentTabIndex",Fr],disablePagination:[ti.HasDecoratorInputTransform,"disablePagination","disablePagination",gn],disableRipple:[ti.HasDecoratorInputTransform,"disableRipple","disableRipple",gn],preserveContent:[ti.HasDecoratorInputTransform,"preserveContent","preserveContent",gn],backgroundColor:"backgroundColor"},outputs:{selectedIndexChange:"selectedIndexChange",focusChange:"focusChange",animationDone:"animationDone",selectedTabChange:"selectedTabChange"},exportAs:["matTabGroup"],standalone:!0,features:[Or([{provide:rC,useExisting:m}]),nr,ui],ngContentSelectors:Kv,decls:9,vars:6,consts:[[3,"selectedIndex","disableRipple","disablePagination","indexFocused","selectFocusedIndex"],["tabHeader",""],[1,"mat-mdc-tab-body-wrapper"],["tabBodyWrapper",""],["role","tab","matTabLabelWrapper","","cdkMonitorElementFocus","",1,"mdc-tab","mat-mdc-tab","mat-mdc-focus-indicator",3,"id","ngClass","disabled","fitInkBarToContent","click","cdkFocusChange"],["tabNode",""],[1,"mdc-tab__ripple"],["mat-ripple","",1,"mat-mdc-tab-ripple",3,"matRippleTrigger","matRippleDisabled"],[1,"mdc-tab__content"],[1,"mdc-tab__text-label"],[3,"cdkPortalOutlet"],["role","tabpanel",3,"id","ngClass","content","position","origin","animationDuration","preserveContent","_onCentered","_onCentering"],["class","mdc-tab mat-mdc-tab mat-mdc-focus-indicator","role","tab","matTabLabelWrapper","","cdkMonitorElementFocus","",3,"id","mdc-tab--active","ngClass","disabled","fitInkBarToContent"],["role","tabpanel",3,"id","mat-mdc-tab-body-active","ngClass","content","position","origin","animationDuration","preserveContent"]],template:function(_,r){_&1&&(pr(),Ue(0,"mat-tab-header",0,1),$t("indexFocused",function(F){return r._focusChanged(F)})("selectFocusedIndex",function(F){return r.selectedIndex=F}),Lr(2,A3,8,16,"div",12,No),Ge(),bi(4,D3,1,0),Ue(5,"div",2,3),Lr(7,P3,1,12,"mat-tab-body",13,No),Ge()),_&2&&(Ct("selectedIndex",r.selectedIndex||0)("disableRipple",r.disableRipple)("disablePagination",r.disablePagination),Ze(2),zr(r._tabs),Ze(2),Bo(4,r._isServer?4:-1),Ze(),_n("_mat-animation-noopable",r._animationMode==="NoopAnimations"),Ze(2),zr(r._tabs))},dependencies:[V3,oC,ik,gb,vd,$o,aC],styles:['.mdc-tab{min-width:90px;padding-right:24px;padding-left:24px;display:flex;flex:1 0 auto;justify-content:center;box-sizing:border-box;margin:0;padding-top:0;padding-bottom:0;border:none;outline:none;text-align:center;white-space:nowrap;cursor:pointer;-webkit-appearance:none;z-index:1}.mdc-tab::-moz-focus-inner{padding:0;border:0}.mdc-tab[hidden]{display:none}.mdc-tab--min-width{flex:0 1 auto}.mdc-tab__content{display:flex;align-items:center;justify-content:center;height:inherit;pointer-events:none}.mdc-tab__text-label{transition:150ms color linear;display:inline-block;line-height:1;z-index:2}.mdc-tab__icon{transition:150ms color linear;z-index:2}.mdc-tab--stacked .mdc-tab__content{flex-direction:column;align-items:center;justify-content:center}.mdc-tab--stacked .mdc-tab__text-label{padding-top:6px;padding-bottom:4px}.mdc-tab--active .mdc-tab__text-label,.mdc-tab--active .mdc-tab__icon{transition-delay:100ms}.mdc-tab:not(.mdc-tab--stacked) .mdc-tab__icon+.mdc-tab__text-label{padding-left:8px;padding-right:0}[dir=rtl] .mdc-tab:not(.mdc-tab--stacked) .mdc-tab__icon+.mdc-tab__text-label,.mdc-tab:not(.mdc-tab--stacked) .mdc-tab__icon+.mdc-tab__text-label[dir=rtl]{padding-left:0;padding-right:8px}.mdc-tab-indicator{display:flex;position:absolute;top:0;left:0;justify-content:center;width:100%;height:100%;pointer-events:none;z-index:1}.mdc-tab-indicator__content{transform-origin:left;opacity:0}.mdc-tab-indicator__content--underline{align-self:flex-end;box-sizing:border-box;width:100%;border-top-style:solid}.mdc-tab-indicator__content--icon{align-self:center;margin:0 auto}.mdc-tab-indicator--active .mdc-tab-indicator__content{opacity:1}.mdc-tab-indicator .mdc-tab-indicator__content{transition:250ms transform cubic-bezier(0.4, 0, 0.2, 1)}.mdc-tab-indicator--no-transition .mdc-tab-indicator__content{transition:none}.mdc-tab-indicator--fade .mdc-tab-indicator__content{transition:150ms opacity linear}.mdc-tab-indicator--active.mdc-tab-indicator--fade .mdc-tab-indicator__content{transition-delay:100ms}.mat-mdc-tab-ripple{position:absolute;top:0;left:0;bottom:0;right:0;pointer-events:none}.mat-mdc-tab{-webkit-tap-highlight-color:rgba(0,0,0,0);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;text-decoration:none;background:none;font-family:var(--mat-tab-header-label-text-font);font-size:var(--mat-tab-header-label-text-size);letter-spacing:var(--mat-tab-header-label-text-tracking);line-height:var(--mat-tab-header-label-text-line-height);font-weight:var(--mat-tab-header-label-text-weight)}.mat-mdc-tab .mdc-tab-indicator__content--underline{border-color:var(--mdc-tab-indicator-active-indicator-color)}.mat-mdc-tab .mdc-tab-indicator__content--underline{border-top-width:var(--mdc-tab-indicator-active-indicator-height)}.mat-mdc-tab .mdc-tab-indicator__content--underline{border-radius:var(--mdc-tab-indicator-active-indicator-shape)}.mat-mdc-tab:not(.mdc-tab--stacked){height:var(--mdc-secondary-navigation-tab-container-height)}.mat-mdc-tab:not(:disabled).mdc-tab--active .mdc-tab__icon{fill:currentColor}.mat-mdc-tab:not(:disabled):hover.mdc-tab--active .mdc-tab__icon{fill:currentColor}.mat-mdc-tab:not(:disabled):focus.mdc-tab--active .mdc-tab__icon{fill:currentColor}.mat-mdc-tab:not(:disabled):active.mdc-tab--active .mdc-tab__icon{fill:currentColor}.mat-mdc-tab:disabled.mdc-tab--active .mdc-tab__icon{fill:currentColor}.mat-mdc-tab:not(:disabled):not(.mdc-tab--active) .mdc-tab__icon{fill:currentColor}.mat-mdc-tab:not(:disabled):hover:not(.mdc-tab--active) .mdc-tab__icon{fill:currentColor}.mat-mdc-tab:not(:disabled):focus:not(.mdc-tab--active) .mdc-tab__icon{fill:currentColor}.mat-mdc-tab:not(:disabled):active:not(.mdc-tab--active) .mdc-tab__icon{fill:currentColor}.mat-mdc-tab:disabled:not(.mdc-tab--active) .mdc-tab__icon{fill:currentColor}.mat-mdc-tab.mdc-tab{flex-grow:0}.mat-mdc-tab:hover .mdc-tab__text-label{color:var(--mat-tab-header-inactive-hover-label-text-color)}.mat-mdc-tab:focus .mdc-tab__text-label{color:var(--mat-tab-header-inactive-focus-label-text-color)}.mat-mdc-tab.mdc-tab--active .mdc-tab__text-label{color:var(--mat-tab-header-active-label-text-color)}.mat-mdc-tab.mdc-tab--active .mdc-tab__ripple::before,.mat-mdc-tab.mdc-tab--active .mat-ripple-element{background-color:var(--mat-tab-header-active-ripple-color)}.mat-mdc-tab.mdc-tab--active:hover .mdc-tab__text-label{color:var(--mat-tab-header-active-hover-label-text-color)}.mat-mdc-tab.mdc-tab--active:hover .mdc-tab-indicator__content--underline{border-color:var(--mat-tab-header-active-hover-indicator-color)}.mat-mdc-tab.mdc-tab--active:focus .mdc-tab__text-label{color:var(--mat-tab-header-active-focus-label-text-color)}.mat-mdc-tab.mdc-tab--active:focus .mdc-tab-indicator__content--underline{border-color:var(--mat-tab-header-active-focus-indicator-color)}.mat-mdc-tab.mat-mdc-tab-disabled{opacity:.4;pointer-events:none}.mat-mdc-tab.mat-mdc-tab-disabled .mdc-tab__content{pointer-events:none}.mat-mdc-tab.mat-mdc-tab-disabled .mdc-tab__ripple::before,.mat-mdc-tab.mat-mdc-tab-disabled .mat-ripple-element{background-color:var(--mat-tab-header-disabled-ripple-color)}.mat-mdc-tab .mdc-tab__ripple::before{content:"";display:block;position:absolute;top:0;left:0;right:0;bottom:0;opacity:0;pointer-events:none;background-color:var(--mat-tab-header-inactive-ripple-color)}.mat-mdc-tab .mdc-tab__text-label{color:var(--mat-tab-header-inactive-label-text-color);display:inline-flex;align-items:center}.mat-mdc-tab .mdc-tab__content{position:relative;pointer-events:auto}.mat-mdc-tab:hover .mdc-tab__ripple::before{opacity:.04}.mat-mdc-tab.cdk-program-focused .mdc-tab__ripple::before,.mat-mdc-tab.cdk-keyboard-focused .mdc-tab__ripple::before{opacity:.12}.mat-mdc-tab .mat-ripple-element{opacity:.12;background-color:var(--mat-tab-header-inactive-ripple-color)}.mat-mdc-tab-group.mat-mdc-tab-group-stretch-tabs>.mat-mdc-tab-header .mat-mdc-tab{flex-grow:1}.mat-mdc-tab-group{display:flex;flex-direction:column;max-width:100%}.mat-mdc-tab-group.mat-tabs-with-background>.mat-mdc-tab-header,.mat-mdc-tab-group.mat-tabs-with-background>.mat-mdc-tab-header-pagination{background-color:var(--mat-tab-header-with-background-background-color)}.mat-mdc-tab-group.mat-tabs-with-background.mat-primary>.mat-mdc-tab-header .mat-mdc-tab .mdc-tab__text-label{color:var(--mat-tab-header-with-background-foreground-color)}.mat-mdc-tab-group.mat-tabs-with-background.mat-primary>.mat-mdc-tab-header .mdc-tab-indicator__content--underline{border-color:var(--mat-tab-header-with-background-foreground-color)}.mat-mdc-tab-group.mat-tabs-with-background:not(.mat-primary)>.mat-mdc-tab-header .mat-mdc-tab:not(.mdc-tab--active) .mdc-tab__text-label{color:var(--mat-tab-header-with-background-foreground-color)}.mat-mdc-tab-group.mat-tabs-with-background:not(.mat-primary)>.mat-mdc-tab-header .mat-mdc-tab:not(.mdc-tab--active) .mdc-tab-indicator__content--underline{border-color:var(--mat-tab-header-with-background-foreground-color)}.mat-mdc-tab-group.mat-tabs-with-background>.mat-mdc-tab-header .mat-mdc-tab-header-pagination-chevron,.mat-mdc-tab-group.mat-tabs-with-background>.mat-mdc-tab-header .mat-mdc-focus-indicator::before,.mat-mdc-tab-group.mat-tabs-with-background>.mat-mdc-tab-header-pagination .mat-mdc-tab-header-pagination-chevron,.mat-mdc-tab-group.mat-tabs-with-background>.mat-mdc-tab-header-pagination .mat-mdc-focus-indicator::before{border-color:var(--mat-tab-header-with-background-foreground-color)}.mat-mdc-tab-group.mat-tabs-with-background>.mat-mdc-tab-header .mat-ripple-element,.mat-mdc-tab-group.mat-tabs-with-background>.mat-mdc-tab-header .mdc-tab__ripple::before,.mat-mdc-tab-group.mat-tabs-with-background>.mat-mdc-tab-header-pagination .mat-ripple-element,.mat-mdc-tab-group.mat-tabs-with-background>.mat-mdc-tab-header-pagination .mdc-tab__ripple::before{background-color:var(--mat-tab-header-with-background-foreground-color)}.mat-mdc-tab-group.mat-tabs-with-background>.mat-mdc-tab-header .mat-mdc-tab-header-pagination-chevron,.mat-mdc-tab-group.mat-tabs-with-background>.mat-mdc-tab-header-pagination .mat-mdc-tab-header-pagination-chevron{color:var(--mat-tab-header-with-background-foreground-color)}.mat-mdc-tab-group.mat-mdc-tab-group-inverted-header{flex-direction:column-reverse}.mat-mdc-tab-group.mat-mdc-tab-group-inverted-header .mdc-tab-indicator__content--underline{align-self:flex-start}.mat-mdc-tab-body-wrapper{position:relative;overflow:hidden;display:flex;transition:height 500ms cubic-bezier(0.35, 0, 0.25, 1)}.mat-mdc-tab-body-wrapper._mat-animation-noopable{transition:none !important;animation:none !important}'],encapsulation:2});let w=m;return w})(),Yv=class{};var lC=(()=>{let m=class m{};m.\u0275fac=function(_){return new(_||m)},m.\u0275mod=Un({type:m}),m.\u0275inj=Vn({imports:[qn,qn]});let w=m;return w})();function W3(w,m){if(w&1){let x=dn();Ue(0,"div",1)(1,"button",2),$t("click",function(){Xi(x);let _=Dt();return Yi(_.action())}),Bt(2),Ge()()}if(w&2){let x=Dt();Ze(2),rr(" ",x.data.action," ")}}var X3=["label"];function Y3(w,m){}var K3=Math.pow(2,31)-1,sf=class{constructor(m,x){this._overlayRef=x,this._afterDismissed=new ei,this._afterOpened=new ei,this._onAction=new ei,this._dismissedByAction=!1,this.containerInstance=m,m._onExit.subscribe(()=>this._finishDismiss())}dismiss(){this._afterDismissed.closed||this.containerInstance.exit(),clearTimeout(this._durationTimeoutId)}dismissWithAction(){this._onAction.closed||(this._dismissedByAction=!0,this._onAction.next(),this._onAction.complete(),this.dismiss()),clearTimeout(this._durationTimeoutId)}closeWithAction(){this.dismissWithAction()}_dismissAfter(m){this._durationTimeoutId=setTimeout(()=>this.dismiss(),Math.min(m,K3))}_open(){this._afterOpened.closed||(this._afterOpened.next(),this._afterOpened.complete())}_finishDismiss(){this._overlayRef.dispose(),this._onAction.closed||this._onAction.complete(),this._afterDismissed.next({dismissedByAction:this._dismissedByAction}),this._afterDismissed.complete(),this._dismissedByAction=!1}afterDismissed(){return this._afterDismissed}afterOpened(){return this.containerInstance._onEnter}onAction(){return this._onAction}},cC=new ci("MatSnackBarData"),ou=class{constructor(){this.politeness="assertive",this.announcementMessage="",this.duration=0,this.data=null,this.horizontalPosition="center",this.verticalPosition="bottom"}},Q3=(()=>{let m=class m{};m.\u0275fac=function(_){return new(_||m)},m.\u0275dir=fn({type:m,selectors:[["","matSnackBarLabel",""]],hostAttrs:[1,"mat-mdc-snack-bar-label","mdc-snackbar__label"],standalone:!0});let w=m;return w})(),J3=(()=>{let m=class m{};m.\u0275fac=function(_){return new(_||m)},m.\u0275dir=fn({type:m,selectors:[["","matSnackBarActions",""]],hostAttrs:[1,"mat-mdc-snack-bar-actions","mdc-snackbar__actions"],standalone:!0});let w=m;return w})(),ez=(()=>{let m=class m{};m.\u0275fac=function(_){return new(_||m)},m.\u0275dir=fn({type:m,selectors:[["","matSnackBarAction",""]],hostAttrs:[1,"mat-mdc-snack-bar-action","mdc-snackbar__action"],standalone:!0});let w=m;return w})(),dC=(()=>{let m=class m{constructor(u,_){this.snackBarRef=u,this.data=_}action(){this.snackBarRef.dismissWithAction()}get hasAction(){return!!this.data.action}};m.\u0275fac=function(_){return new(_||m)(Xe(sf),Xe(cC))},m.\u0275cmp=hi({type:m,selectors:[["simple-snack-bar"]],hostAttrs:[1,"mat-mdc-simple-snack-bar"],exportAs:["matSnackBar"],standalone:!0,features:[ui],decls:3,vars:2,consts:[["matSnackBarLabel",""],["matSnackBarActions",""],["mat-button","","matSnackBarAction","",3,"click"]],template:function(_,r){_&1&&(Ue(0,"div",0),Bt(1),Ge(),bi(2,W3,3,1,"div",1)),_&2&&(Ze(),rr(" ",r.data.message,`
`),Ze(),Bo(2,r.hasAction?2:-1))},dependencies:[Es,Q3,J3,ez],styles:[".mat-mdc-simple-snack-bar{display:flex}"],encapsulation:2,changeDetection:0});let w=m;return w})(),tz={snackBarState:ws("state",[ko("void, hidden",xr({transform:"scale(0.8)",opacity:0})),ko("visible",xr({transform:"scale(1)",opacity:1})),Uo("* => visible",Vo("150ms cubic-bezier(0, 0, 0.2, 1)")),Uo("* => void, * => hidden",Vo("75ms cubic-bezier(0.4, 0.0, 1, 1)",xr({opacity:0})))])},iz=0,nz=(()=>{let m=class m extends Tg{constructor(u,_,r,M,F){super(),this._ngZone=u,this._elementRef=_,this._changeDetectorRef=r,this._platform=M,this.snackBarConfig=F,this._document=St(vr),this._trackedModals=new Set,this._announceDelay=150,this._destroyed=!1,this._onAnnounce=new ei,this._onExit=new ei,this._onEnter=new ei,this._animationState="void",this._liveElementId=`mat-snack-bar-container-live-${iz++}`,this.attachDomPortal=q=>{this._assertNotAttached();let re=this._portalOutlet.attachDomPortal(q);return this._afterPortalAttached(),re},F.politeness==="assertive"&&!F.announcementMessage?this._live="assertive":F.politeness==="off"?this._live="off":this._live="polite",this._platform.FIREFOX&&(this._live==="polite"&&(this._role="status"),this._live==="assertive"&&(this._role="alert"))}attachComponentPortal(u){this._assertNotAttached();let _=this._portalOutlet.attachComponentPortal(u);return this._afterPortalAttached(),_}attachTemplatePortal(u){this._assertNotAttached();let _=this._portalOutlet.attachTemplatePortal(u);return this._afterPortalAttached(),_}onAnimationEnd(u){let{fromState:_,toState:r}=u;if((r==="void"&&_!=="void"||r==="hidden")&&this._completeExit(),r==="visible"){let M=this._onEnter;this._ngZone.run(()=>{M.next(),M.complete()})}}enter(){this._destroyed||(this._animationState="visible",this._changeDetectorRef.markForCheck(),this._changeDetectorRef.detectChanges(),this._screenReaderAnnounce())}exit(){return this._ngZone.run(()=>{this._animationState="hidden",this._changeDetectorRef.markForCheck(),this._elementRef.nativeElement.setAttribute("mat-exit",""),clearTimeout(this._announceTimeoutId)}),this._onExit}ngOnDestroy(){this._destroyed=!0,this._clearFromModals(),this._completeExit()}_completeExit(){queueMicrotask(()=>{this._onExit.next(),this._onExit.complete()})}_afterPortalAttached(){let u=this._elementRef.nativeElement,_=this.snackBarConfig.panelClass;_&&(Array.isArray(_)?_.forEach(F=>u.classList.add(F)):u.classList.add(_)),this._exposeToModals();let r=this._label.nativeElement,M="mdc-snackbar__label";r.classList.toggle(M,!r.querySelector(`.${M}`))}_exposeToModals(){let u=this._liveElementId,_=this._document.querySelectorAll('body > .cdk-overlay-container [aria-modal="true"]');for(let r=0;r<_.length;r++){let M=_[r],F=M.getAttribute("aria-owns");this._trackedModals.add(M),F?F.indexOf(u)===-1&&M.setAttribute("aria-owns",F+" "+u):M.setAttribute("aria-owns",u)}}_clearFromModals(){this._trackedModals.forEach(u=>{let _=u.getAttribute("aria-owns");if(_){let r=_.replace(this._liveElementId,"").trim();r.length>0?u.setAttribute("aria-owns",r):u.removeAttribute("aria-owns")}}),this._trackedModals.clear()}_assertNotAttached(){this._portalOutlet.hasAttached()}_screenReaderAnnounce(){this._announceTimeoutId||this._ngZone.runOutsideAngular(()=>{this._announceTimeoutId=setTimeout(()=>{let u=this._elementRef.nativeElement.querySelector("[aria-hidden]"),_=this._elementRef.nativeElement.querySelector("[aria-live]");if(u&&_){let r=null;this._platform.isBrowser&&document.activeElement instanceof HTMLElement&&u.contains(document.activeElement)&&(r=document.activeElement),u.removeAttribute("aria-hidden"),_.appendChild(u),r?.focus(),this._onAnnounce.next(),this._onAnnounce.complete()}},this._announceDelay)})}};m.\u0275fac=function(_){return new(_||m)(Xe(Dn),Xe(zn),Xe(On),Xe(da),Xe(ou))},m.\u0275cmp=hi({type:m,selectors:[["mat-snack-bar-container"]],viewQuery:function(_,r){if(_&1&&(Fn($o,7),Fn(X3,7)),_&2){let M;Ni(M=ji())&&(r._portalOutlet=M.first),Ni(M=ji())&&(r._label=M.first)}},hostAttrs:[1,"mdc-snackbar","mat-mdc-snack-bar-container","mdc-snackbar--open"],hostVars:1,hostBindings:function(_,r){_&1&&z2("@state.done",function(F){return r.onAnimationEnd(F)}),_&2&&R2("@state",r._animationState)},standalone:!0,features:[po,ui],decls:6,vars:3,consts:[[1,"mdc-snackbar__surface"],[1,"mat-mdc-snack-bar-label"],["label",""],["aria-hidden","true"],["cdkPortalOutlet",""]],template:function(_,r){_&1&&(Ue(0,"div",0)(1,"div",1,2)(3,"div",3),bi(4,Y3,0,0,"ng-template",4),Ge(),Ki(5,"div"),Ge()()),_&2&&(Ze(5),cr("aria-live",r._live)("role",r._role)("id",r._liveElementId))},dependencies:[$o],styles:['.mdc-snackbar{display:none;position:fixed;right:0;bottom:0;left:0;align-items:center;justify-content:center;box-sizing:border-box;pointer-events:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mdc-snackbar--opening,.mdc-snackbar--open,.mdc-snackbar--closing{display:flex}.mdc-snackbar--open .mdc-snackbar__label,.mdc-snackbar--open .mdc-snackbar__actions{visibility:visible}.mdc-snackbar__surface{padding-left:0;padding-right:8px;display:flex;align-items:center;justify-content:flex-start;box-sizing:border-box;transform:scale(0.8);opacity:0}.mdc-snackbar__surface::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:1px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}@media screen and (forced-colors: active){.mdc-snackbar__surface::before{border-color:CanvasText}}[dir=rtl] .mdc-snackbar__surface,.mdc-snackbar__surface[dir=rtl]{padding-left:8px;padding-right:0}.mdc-snackbar--open .mdc-snackbar__surface{transform:scale(1);opacity:1;pointer-events:auto}.mdc-snackbar--closing .mdc-snackbar__surface{transform:scale(1)}.mdc-snackbar__label{padding-left:16px;padding-right:8px;width:100%;flex-grow:1;box-sizing:border-box;margin:0;visibility:hidden;padding-top:14px;padding-bottom:14px}[dir=rtl] .mdc-snackbar__label,.mdc-snackbar__label[dir=rtl]{padding-left:8px;padding-right:16px}.mdc-snackbar__label::before{display:inline;content:attr(data-mdc-snackbar-label-text)}.mdc-snackbar__actions{display:flex;flex-shrink:0;align-items:center;box-sizing:border-box;visibility:hidden}.mdc-snackbar__action+.mdc-snackbar__dismiss{margin-left:8px;margin-right:0}[dir=rtl] .mdc-snackbar__action+.mdc-snackbar__dismiss,.mdc-snackbar__action+.mdc-snackbar__dismiss[dir=rtl]{margin-left:0;margin-right:8px}.mat-mdc-snack-bar-container{margin:8px;position:static}.mat-mdc-snack-bar-container .mdc-snackbar__surface{min-width:344px}@media(max-width: 480px),(max-width: 344px){.mat-mdc-snack-bar-container .mdc-snackbar__surface{min-width:100%}}@media(max-width: 480px),(max-width: 344px){.mat-mdc-snack-bar-container{width:100vw}}.mat-mdc-snack-bar-container .mdc-snackbar__surface{max-width:672px}.mat-mdc-snack-bar-container .mdc-snackbar__surface{box-shadow:0px 3px 5px -1px rgba(0, 0, 0, 0.2), 0px 6px 10px 0px rgba(0, 0, 0, 0.14), 0px 1px 18px 0px rgba(0, 0, 0, 0.12)}.mat-mdc-snack-bar-container .mdc-snackbar__surface{background-color:var(--mdc-snackbar-container-color)}.mat-mdc-snack-bar-container .mdc-snackbar__surface{border-radius:var(--mdc-snackbar-container-shape)}.mat-mdc-snack-bar-container .mdc-snackbar__label{color:var(--mdc-snackbar-supporting-text-color)}.mat-mdc-snack-bar-container .mdc-snackbar__label{font-size:var(--mdc-snackbar-supporting-text-size);font-family:var(--mdc-snackbar-supporting-text-font);font-weight:var(--mdc-snackbar-supporting-text-weight);line-height:var(--mdc-snackbar-supporting-text-line-height)}.mat-mdc-snack-bar-container .mat-mdc-button.mat-mdc-snack-bar-action:not(:disabled){color:var(--mat-snack-bar-button-color);--mat-text-button-state-layer-color:currentColor;--mat-text-button-ripple-color:currentColor}.mat-mdc-snack-bar-container .mat-mdc-button.mat-mdc-snack-bar-action:not(:disabled) .mat-ripple-element{opacity:.1}.mat-mdc-snack-bar-container .mdc-snackbar__label::before{display:none}.mat-mdc-snack-bar-handset,.mat-mdc-snack-bar-container,.mat-mdc-snack-bar-label{flex:1 1 auto}.mat-mdc-snack-bar-handset .mdc-snackbar__surface{width:100%}'],encapsulation:2,data:{animation:[tz.snackBarState]}});let w=m;return w})();function rz(){return new ou}var oz=new ci("mat-snack-bar-default-options",{providedIn:"root",factory:rz}),Jv=(()=>{let m=class m{get _openedSnackBarRef(){let u=this._parentSnackBar;return u?u._openedSnackBarRef:this._snackBarRefAtThisLevel}set _openedSnackBarRef(u){this._parentSnackBar?this._parentSnackBar._openedSnackBarRef=u:this._snackBarRefAtThisLevel=u}constructor(u,_,r,M,F,q){this._overlay=u,this._live=_,this._injector=r,this._breakpointObserver=M,this._parentSnackBar=F,this._defaultConfig=q,this._snackBarRefAtThisLevel=null,this.simpleSnackBarComponent=dC,this.snackBarContainerComponent=nz,this.handsetCssClass="mat-mdc-snack-bar-handset"}openFromComponent(u,_){return this._attach(u,_)}openFromTemplate(u,_){return this._attach(u,_)}open(u,_="",r){let M=It(It({},this._defaultConfig),r);return M.data={message:u,action:_},M.announcementMessage===u&&(M.announcementMessage=void 0),this.openFromComponent(this.simpleSnackBarComponent,M)}dismiss(){this._openedSnackBarRef&&this._openedSnackBarRef.dismiss()}ngOnDestroy(){this._snackBarRefAtThisLevel&&this._snackBarRefAtThisLevel.dismiss()}_attachSnackBarContainer(u,_){let r=_&&_.viewContainerRef&&_.viewContainerRef.injector,M=uo.create({parent:r||this._injector,providers:[{provide:ou,useValue:_}]}),F=new zh(this.snackBarContainerComponent,_.viewContainerRef,M),q=u.attach(F);return q.instance.snackBarConfig=_,q.instance}_attach(u,_){let r=It(It(It({},new ou),this._defaultConfig),_),M=this._createOverlay(r),F=this._attachSnackBarContainer(M,r),q=new sf(F,M);if(u instanceof To){let re=new oc(u,null,{$implicit:r.data,snackBarRef:q});q.instance=F.attachTemplatePortal(re)}else{let re=this._createInjector(r,q),me=new zh(u,void 0,re),De=F.attachComponentPortal(me);q.instance=De.instance}return this._breakpointObserver.observe(Q2.HandsetPortrait).pipe(Fo(M.detachments())).subscribe(re=>{M.overlayElement.classList.toggle(this.handsetCssClass,re.matches)}),r.announcementMessage&&F._onAnnounce.subscribe(()=>{this._live.announce(r.announcementMessage,r.politeness)}),this._animateSnackBar(q,r),this._openedSnackBarRef=q,this._openedSnackBarRef}_animateSnackBar(u,_){u.afterDismissed().subscribe(()=>{this._openedSnackBarRef==u&&(this._openedSnackBarRef=null),_.announcementMessage&&this._live.clear()}),this._openedSnackBarRef?(this._openedSnackBarRef.afterDismissed().subscribe(()=>{u.containerInstance.enter()}),this._openedSnackBarRef.dismiss()):u.containerInstance.enter(),_.duration&&_.duration>0&&u.afterOpened().subscribe(()=>u._dismissAfter(_.duration))}_createOverlay(u){let _=new Tp;_.direction=u.direction;let r=this._overlay.position().global(),M=u.direction==="rtl",F=u.horizontalPosition==="left"||u.horizontalPosition==="start"&&!M||u.horizontalPosition==="end"&&M,q=!F&&u.horizontalPosition!=="center";return F?r.left("0"):q?r.right("0"):r.centerHorizontally(),u.verticalPosition==="top"?r.top("0"):r.bottom("0"),_.positionStrategy=r,this._overlay.create(_)}_createInjector(u,_){let r=u&&u.viewContainerRef&&u.viewContainerRef.injector;return uo.create({parent:r||this._injector,providers:[{provide:sf,useValue:_},{provide:cC,useValue:u.data}]})}};m.\u0275fac=function(_){return new(_||m)(qi(ha),qi(tk),qi(uo),qi(K2),qi(m,12),qi(oz))},m.\u0275prov=Tn({token:m,factory:m.\u0275fac,providedIn:"root"});let w=m;return w})();var hC=(()=>{let m=class m{};m.\u0275fac=function(_){return new(_||m)},m.\u0275mod=Un({type:m}),m.\u0275inj=Vn({providers:[Jv],imports:[ac,sl,qo,qn,dC,qn]});let w=m;return w})();var az=["knob"],sz=["valueIndicatorContainer"];function lz(w,m){if(w&1&&(Ue(0,"div",4,5)(2,"div",6)(3,"span",7),Bt(4),Ge()()()),w&2){let x=Dt();Ze(4),hn(x.valueIndicatorText)}}var cz=["trackActive"];function dz(w,m){if(w&1&&Ki(0,"div"),w&2){let x=m.$implicit,u=m.$index,_=Dt(3);yd(x===0?"mdc-slider__tick-mark--active":"mdc-slider__tick-mark--inactive"),Wa("transform",_._calcTickMarkTransform(u))}}function hz(w,m){if(w&1&&Lr(0,dz,1,4,"div",9,No),w&2){let x=Dt(2);zr(x._tickMarks)}}function uz(w,m){if(w&1&&(Ue(0,"div",7,8),bi(2,hz,2,0),Ge()),w&2){let x=Dt();Ze(2),Bo(2,x._cachedWidth?2:-1)}}function mz(w,m){if(w&1&&Ki(0,"mat-slider-visual-thumb",6),w&2){let x=Dt();Ct("discrete",x.discrete)("thumbPosition",1)("valueIndicatorText",x.startValueIndicatorText)}}var pz=["*"],Pi=function(w){return w[w.START=1]="START",w[w.END=2]="END",w}(Pi||{}),au=function(w){return w[w.ACTIVE=0]="ACTIVE",w[w.INACTIVE=1]="INACTIVE",w}(au||{}),ex=new ci("_MatSlider"),uC=new ci("_MatSliderThumb"),fz=new ci("_MatSliderRangeThumb"),mC=new ci("_MatSliderVisualThumb");var _z=(()=>{let m=class m{constructor(u,_,r,M){this._cdr=u,this._ngZone=_,this._slider=M,this._isHovered=!1,this._isActive=!1,this._isValueIndicatorVisible=!1,this._platform=St(da),this._onPointerMove=F=>{if(this._sliderInput._isFocused)return;let q=this._hostElement.getBoundingClientRect(),re=this._slider._isCursorOnSliderThumb(F,q);this._isHovered=re,re?this._showHoverRipple():this._hideRipple(this._hoverRippleRef)},this._onMouseLeave=()=>{this._isHovered=!1,this._hideRipple(this._hoverRippleRef)},this._onFocus=()=>{this._hideRipple(this._hoverRippleRef),this._showFocusRipple(),this._hostElement.classList.add("mdc-slider__thumb--focused")},this._onBlur=()=>{this._isActive||this._hideRipple(this._focusRippleRef),this._isHovered&&this._showHoverRipple(),this._hostElement.classList.remove("mdc-slider__thumb--focused")},this._onDragStart=F=>{F.button===0&&(this._isActive=!0,this._showActiveRipple())},this._onDragEnd=()=>{this._isActive=!1,this._hideRipple(this._activeRippleRef),this._sliderInput._isFocused||this._hideRipple(this._focusRippleRef),this._platform.SAFARI&&this._showHoverRipple()},this._hostElement=r.nativeElement}ngAfterViewInit(){this._ripple.radius=24,this._sliderInput=this._slider._getInput(this.thumbPosition),this._sliderInputEl=this._sliderInput._hostElement;let u=this._sliderInputEl;this._ngZone.runOutsideAngular(()=>{u.addEventListener("pointermove",this._onPointerMove),u.addEventListener("pointerdown",this._onDragStart),u.addEventListener("pointerup",this._onDragEnd),u.addEventListener("pointerleave",this._onMouseLeave),u.addEventListener("focus",this._onFocus),u.addEventListener("blur",this._onBlur)})}ngOnDestroy(){let u=this._sliderInputEl;u&&(u.removeEventListener("pointermove",this._onPointerMove),u.removeEventListener("pointerdown",this._onDragStart),u.removeEventListener("pointerup",this._onDragEnd),u.removeEventListener("pointerleave",this._onMouseLeave),u.removeEventListener("focus",this._onFocus),u.removeEventListener("blur",this._onBlur))}_showHoverRipple(){this._isShowingRipple(this._hoverRippleRef)||(this._hoverRippleRef=this._showRipple({enterDuration:0,exitDuration:0}),this._hoverRippleRef?.element.classList.add("mat-mdc-slider-hover-ripple"))}_showFocusRipple(){this._isShowingRipple(this._focusRippleRef)||(this._focusRippleRef=this._showRipple({enterDuration:0,exitDuration:0},!0),this._focusRippleRef?.element.classList.add("mat-mdc-slider-focus-ripple"))}_showActiveRipple(){this._isShowingRipple(this._activeRippleRef)||(this._activeRippleRef=this._showRipple({enterDuration:225,exitDuration:400}),this._activeRippleRef?.element.classList.add("mat-mdc-slider-active-ripple"))}_isShowingRipple(u){return u?.state===vb.FADING_IN||u?.state===vb.VISIBLE}_showRipple(u,_){if(!this._slider.disabled&&(this._showValueIndicator(),this._slider._isRange&&this._slider._getThumb(this.thumbPosition===Pi.START?Pi.END:Pi.START)._showValueIndicator(),!(this._slider._globalRippleOptions?.disabled&&!_)))return this._ripple.launch({animation:this._slider._noopAnimations?{enterDuration:0,exitDuration:0}:u,centered:!0,persistent:!0})}_hideRipple(u){if(u?.fadeOut(),this._isShowingAnyRipple())return;this._slider._isRange||this._hideValueIndicator();let _=this._getSibling();_._isShowingAnyRipple()||(this._hideValueIndicator(),_._hideValueIndicator())}_showValueIndicator(){this._hostElement.classList.add("mdc-slider__thumb--with-indicator")}_hideValueIndicator(){this._hostElement.classList.remove("mdc-slider__thumb--with-indicator")}_getSibling(){return this._slider._getThumb(this.thumbPosition===Pi.START?Pi.END:Pi.START)}_getValueIndicatorContainer(){return this._valueIndicatorContainer?.nativeElement}_getKnob(){return this._knob.nativeElement}_isShowingAnyRipple(){return this._isShowingRipple(this._hoverRippleRef)||this._isShowingRipple(this._focusRippleRef)||this._isShowingRipple(this._activeRippleRef)}};m.\u0275fac=function(_){return new(_||m)(Xe(On),Xe(Dn),Xe(zn),Xe(ex))},m.\u0275cmp=hi({type:m,selectors:[["mat-slider-visual-thumb"]],viewQuery:function(_,r){if(_&1&&(Fn(vd,5),Fn(az,5),Fn(sz,5)),_&2){let M;Ni(M=ji())&&(r._ripple=M.first),Ni(M=ji())&&(r._knob=M.first),Ni(M=ji())&&(r._valueIndicatorContainer=M.first)}},hostAttrs:[1,"mdc-slider__thumb","mat-mdc-slider-visual-thumb"],inputs:{discrete:"discrete",thumbPosition:"thumbPosition",valueIndicatorText:"valueIndicatorText"},standalone:!0,features:[Or([{provide:mC,useExisting:m}]),ui],decls:4,vars:2,consts:[["class","mdc-slider__value-indicator-container"],[1,"mdc-slider__thumb-knob"],["knob",""],["matRipple","",1,"mat-mdc-focus-indicator",3,"matRippleDisabled"],[1,"mdc-slider__value-indicator-container"],["valueIndicatorContainer",""],[1,"mdc-slider__value-indicator"],[1,"mdc-slider__value-indicator-text"]],template:function(_,r){_&1&&(bi(0,lz,5,1,"div",0),Ki(1,"div",1,2)(3,"div",3)),_&2&&(Bo(0,r.discrete?0:-1),Ze(3),Ct("matRippleDisabled",!0))},dependencies:[vd],styles:[".mat-mdc-slider-visual-thumb .mat-ripple{height:100%;width:100%}.mat-mdc-slider .mdc-slider__tick-marks{justify-content:start}.mat-mdc-slider .mdc-slider__tick-marks .mdc-slider__tick-mark--active,.mat-mdc-slider .mdc-slider__tick-marks .mdc-slider__tick-mark--inactive{position:absolute;left:2px}"],encapsulation:2,changeDetection:0});let w=m;return w})(),pC=(()=>{let m=class m{get disabled(){return this._disabled}set disabled(u){this._disabled=u;let _=this._getInput(Pi.END),r=this._getInput(Pi.START);_&&(_.disabled=this._disabled),r&&(r.disabled=this._disabled)}get discrete(){return this._discrete}set discrete(u){this._discrete=u,this._updateValueIndicatorUIs()}get min(){return this._min}set min(u){let _=isNaN(u)?this._min:u;this._min!==_&&this._updateMin(_)}_updateMin(u){let _=this._min;this._min=u,this._isRange?this._updateMinRange({old:_,new:u}):this._updateMinNonRange(u),this._onMinMaxOrStepChange()}_updateMinRange(u){let _=this._getInput(Pi.END),r=this._getInput(Pi.START),M=_.value,F=r.value;r.min=u.new,_.min=Math.max(u.new,r.value),r.max=Math.min(_.max,_.value),r._updateWidthInactive(),_._updateWidthInactive(),u.new<u.old?this._onTranslateXChangeBySideEffect(_,r):this._onTranslateXChangeBySideEffect(r,_),M!==_.value&&this._onValueChange(_),F!==r.value&&this._onValueChange(r)}_updateMinNonRange(u){let _=this._getInput(Pi.END);if(_){let r=_.value;_.min=u,_._updateThumbUIByValue(),this._updateTrackUI(_),r!==_.value&&this._onValueChange(_)}}get max(){return this._max}set max(u){let _=isNaN(u)?this._max:u;this._max!==_&&this._updateMax(_)}_updateMax(u){let _=this._max;this._max=u,this._isRange?this._updateMaxRange({old:_,new:u}):this._updateMaxNonRange(u),this._onMinMaxOrStepChange()}_updateMaxRange(u){let _=this._getInput(Pi.END),r=this._getInput(Pi.START),M=_.value,F=r.value;_.max=u.new,r.max=Math.min(u.new,_.value),_.min=r.value,_._updateWidthInactive(),r._updateWidthInactive(),u.new>u.old?this._onTranslateXChangeBySideEffect(r,_):this._onTranslateXChangeBySideEffect(_,r),M!==_.value&&this._onValueChange(_),F!==r.value&&this._onValueChange(r)}_updateMaxNonRange(u){let _=this._getInput(Pi.END);if(_){let r=_.value;_.max=u,_._updateThumbUIByValue(),this._updateTrackUI(_),r!==_.value&&this._onValueChange(_)}}get step(){return this._step}set step(u){let _=isNaN(u)?this._step:u;this._step!==_&&this._updateStep(_)}_updateStep(u){this._step=u,this._isRange?this._updateStepRange():this._updateStepNonRange(),this._onMinMaxOrStepChange()}_updateStepRange(){let u=this._getInput(Pi.END),_=this._getInput(Pi.START),r=u.value,M=_.value,F=_.value;u.min=this._min,_.max=this._max,u.step=this._step,_.step=this._step,this._platform.SAFARI&&(u.value=u.value,_.value=_.value),u.min=Math.max(this._min,_.value),_.max=Math.min(this._max,u.value),_._updateWidthInactive(),u._updateWidthInactive(),u.value<F?this._onTranslateXChangeBySideEffect(_,u):this._onTranslateXChangeBySideEffect(u,_),r!==u.value&&this._onValueChange(u),M!==_.value&&this._onValueChange(_)}_updateStepNonRange(){let u=this._getInput(Pi.END);if(u){let _=u.value;u.step=this._step,this._platform.SAFARI&&(u.value=u.value),u._updateThumbUIByValue(),_!==u.value&&this._onValueChange(u)}}constructor(u,_,r,M,F,q){this._ngZone=u,this._cdr=_,this._elementRef=r,this._dir=M,this._globalRippleOptions=F,this._disabled=!1,this._discrete=!1,this.showTickMarks=!1,this._min=0,this.disableRipple=!1,this._max=100,this._step=1,this.displayWith=re=>`${re}`,this._rippleRadius=24,this.startValueIndicatorText="",this.endValueIndicatorText="",this._isRange=!1,this._isRtl=!1,this._hasViewInitialized=!1,this._tickMarkTrackWidth=0,this._hasAnimation=!1,this._resizeTimer=null,this._platform=St(da),this._knobRadius=8,this._thumbsOverlap=!1,this._noopAnimations=q==="NoopAnimations",this._dirChangeSubscription=this._dir.change.subscribe(()=>this._onDirChange()),this._isRtl=this._dir.value==="rtl"}ngAfterViewInit(){this._platform.isBrowser&&this._updateDimensions();let u=this._getInput(Pi.END),_=this._getInput(Pi.START);this._isRange=!!u&&!!_,this._cdr.detectChanges();let r=this._getThumb(Pi.END);this._rippleRadius=r._ripple.radius,this._inputPadding=this._rippleRadius-this._knobRadius,this._isRange?this._initUIRange(u,_):this._initUINonRange(u),this._updateTrackUI(u),this._updateTickMarkUI(),this._updateTickMarkTrackUI(),this._observeHostResize(),this._cdr.detectChanges()}_initUINonRange(u){u.initProps(),u.initUI(),this._updateValueIndicatorUI(u),this._hasViewInitialized=!0,u._updateThumbUIByValue()}_initUIRange(u,_){u.initProps(),u.initUI(),_.initProps(),_.initUI(),u._updateMinMax(),_._updateMinMax(),u._updateStaticStyles(),_._updateStaticStyles(),this._updateValueIndicatorUIs(),this._hasViewInitialized=!0,u._updateThumbUIByValue(),_._updateThumbUIByValue()}ngOnDestroy(){this._dirChangeSubscription.unsubscribe(),this._resizeObserver?.disconnect(),this._resizeObserver=null}_onDirChange(){this._isRtl=this._dir.value==="rtl",this._isRange?this._onDirChangeRange():this._onDirChangeNonRange(),this._updateTickMarkUI()}_onDirChangeRange(){let u=this._getInput(Pi.END),_=this._getInput(Pi.START);u._setIsLeftThumb(),_._setIsLeftThumb(),u.translateX=u._calcTranslateXByValue(),_.translateX=_._calcTranslateXByValue(),u._updateStaticStyles(),_._updateStaticStyles(),u._updateWidthInactive(),_._updateWidthInactive(),u._updateThumbUIByValue(),_._updateThumbUIByValue()}_onDirChangeNonRange(){this._getInput(Pi.END)._updateThumbUIByValue()}_observeHostResize(){typeof ResizeObserver>"u"||!ResizeObserver||this._ngZone.runOutsideAngular(()=>{this._resizeObserver=new ResizeObserver(()=>{this._isActive()||(this._resizeTimer&&clearTimeout(this._resizeTimer),this._onResize())}),this._resizeObserver.observe(this._elementRef.nativeElement)})}_isActive(){return this._getThumb(Pi.START)._isActive||this._getThumb(Pi.END)._isActive}_getValue(u=Pi.END){let _=this._getInput(u);return _?_.value:this.min}_skipUpdate(){return!!(this._getInput(Pi.START)?._skipUIUpdate||this._getInput(Pi.END)?._skipUIUpdate)}_updateDimensions(){this._cachedWidth=this._elementRef.nativeElement.offsetWidth,this._cachedLeft=this._elementRef.nativeElement.getBoundingClientRect().left}_setTrackActiveStyles(u){let _=this._trackActive.nativeElement.style;_.left=u.left,_.right=u.right,_.transformOrigin=u.transformOrigin,_.transform=u.transform}_calcTickMarkTransform(u){return`translateX(${u*(this._tickMarkTrackWidth/(this._tickMarks.length-1))}px`}_onTranslateXChange(u){this._hasViewInitialized&&(this._updateThumbUI(u),this._updateTrackUI(u),this._updateOverlappingThumbUI(u))}_onTranslateXChangeBySideEffect(u,_){this._hasViewInitialized&&(u._updateThumbUIByValue(),_._updateThumbUIByValue())}_onValueChange(u){this._hasViewInitialized&&(this._updateValueIndicatorUI(u),this._updateTickMarkUI(),this._cdr.detectChanges())}_onMinMaxOrStepChange(){this._hasViewInitialized&&(this._updateTickMarkUI(),this._updateTickMarkTrackUI(),this._cdr.markForCheck())}_onResize(){if(this._hasViewInitialized){if(this._updateDimensions(),this._isRange){let u=this._getInput(Pi.END),_=this._getInput(Pi.START);u._updateThumbUIByValue(),_._updateThumbUIByValue(),u._updateStaticStyles(),_._updateStaticStyles(),u._updateMinMax(),_._updateMinMax(),u._updateWidthInactive(),_._updateWidthInactive()}else{let u=this._getInput(Pi.END);u&&u._updateThumbUIByValue()}this._updateTickMarkUI(),this._updateTickMarkTrackUI(),this._cdr.detectChanges()}}_areThumbsOverlapping(){let u=this._getInput(Pi.START),_=this._getInput(Pi.END);return!u||!_?!1:_.translateX-u.translateX<20}_updateOverlappingThumbClassNames(u){let _=u.getSibling(),r=this._getThumb(u.thumbPosition);this._getThumb(_.thumbPosition)._hostElement.classList.remove("mdc-slider__thumb--top"),r._hostElement.classList.toggle("mdc-slider__thumb--top",this._thumbsOverlap)}_updateOverlappingThumbUI(u){!this._isRange||this._skipUpdate()||this._thumbsOverlap!==this._areThumbsOverlapping()&&(this._thumbsOverlap=!this._thumbsOverlap,this._updateOverlappingThumbClassNames(u))}_updateThumbUI(u){if(this._skipUpdate())return;let _=this._getThumb(u.thumbPosition===Pi.END?Pi.END:Pi.START);_._hostElement.style.transform=`translateX(${u.translateX}px)`}_updateValueIndicatorUI(u){if(this._skipUpdate())return;let _=this.displayWith(u.value);if(this._hasViewInitialized?u._valuetext=_:u._hostElement.setAttribute("aria-valuetext",_),this.discrete){u.thumbPosition===Pi.START?this.startValueIndicatorText=_:this.endValueIndicatorText=_;let r=this._getThumb(u.thumbPosition);_.length<3?r._hostElement.classList.add("mdc-slider__thumb--short-value"):r._hostElement.classList.remove("mdc-slider__thumb--short-value")}}_updateValueIndicatorUIs(){let u=this._getInput(Pi.END),_=this._getInput(Pi.START);u&&this._updateValueIndicatorUI(u),_&&this._updateValueIndicatorUI(_)}_updateTickMarkTrackUI(){if(!this.showTickMarks||this._skipUpdate())return;let u=this._step&&this._step>0?this._step:1,r=(Math.floor(this.max/u)*u-this.min)/(this.max-this.min);this._tickMarkTrackWidth=this._cachedWidth*r-6}_updateTrackUI(u){this._skipUpdate()||(this._isRange?this._updateTrackUIRange(u):this._updateTrackUINonRange(u))}_updateTrackUIRange(u){let _=u.getSibling();if(!_||!this._cachedWidth)return;let r=Math.abs(_.translateX-u.translateX)/this._cachedWidth;u._isLeftThumb&&this._cachedWidth?this._setTrackActiveStyles({left:"auto",right:`${this._cachedWidth-_.translateX}px`,transformOrigin:"right",transform:`scaleX(${r})`}):this._setTrackActiveStyles({left:`${_.translateX}px`,right:"auto",transformOrigin:"left",transform:`scaleX(${r})`})}_updateTrackUINonRange(u){this._isRtl?this._setTrackActiveStyles({left:"auto",right:"0px",transformOrigin:"right",transform:`scaleX(${1-u.fillPercentage})`}):this._setTrackActiveStyles({left:"0px",right:"auto",transformOrigin:"left",transform:`scaleX(${u.fillPercentage})`})}_updateTickMarkUI(){if(!this.showTickMarks||this.step===void 0||this.min===void 0||this.max===void 0)return;let u=this.step>0?this.step:1;this._isRange?this._updateTickMarkUIRange(u):this._updateTickMarkUINonRange(u),this._isRtl&&this._tickMarks.reverse()}_updateTickMarkUINonRange(u){let _=this._getValue(),r=Math.max(Math.floor((_-this.min)/u),0),M=Math.max(Math.floor((this.max-_)/u),0);this._isRtl?r++:M++,this._tickMarks=Array(r).fill(au.ACTIVE).concat(Array(M).fill(au.INACTIVE))}_updateTickMarkUIRange(u){let _=this._getValue(),r=this._getValue(Pi.START),M=Math.max(Math.floor((r-this.min)/u),0),F=Math.max(Math.floor((_-r)/u)+1,0),q=Math.max(Math.floor((this.max-_)/u),0);this._tickMarks=Array(M).fill(au.INACTIVE).concat(Array(F).fill(au.ACTIVE),Array(q).fill(au.INACTIVE))}_getInput(u){if(u===Pi.END&&this._input)return this._input;if(this._inputs?.length)return u===Pi.START?this._inputs.first:this._inputs.last}_getThumb(u){return u===Pi.END?this._thumbs?.last:this._thumbs?.first}_setTransition(u){this._hasAnimation=!this._platform.IOS&&u&&!this._noopAnimations,this._elementRef.nativeElement.classList.toggle("mat-mdc-slider-with-animation",this._hasAnimation)}_isCursorOnSliderThumb(u,_){let r=_.width/2,M=_.x+r,F=_.y+r,q=u.clientX-M,re=u.clientY-F;return Math.pow(q,2)+Math.pow(re,2)<Math.pow(r,2)}};m.\u0275fac=function(_){return new(_||m)(Xe(Dn),Xe(On),Xe(zn),Xe(Xa,8),Xe(xg,8),Xe(mo,8))},m.\u0275cmp=hi({type:m,selectors:[["mat-slider"]],contentQueries:function(_,r,M){if(_&1&&(Ur(M,uC,5),Ur(M,fz,4)),_&2){let F;Ni(F=ji())&&(r._input=F.first),Ni(F=ji())&&(r._inputs=F)}},viewQuery:function(_,r){if(_&1&&(Fn(cz,5),Fn(mC,5)),_&2){let M;Ni(M=ji())&&(r._trackActive=M.first),Ni(M=ji())&&(r._thumbs=M)}},hostAttrs:[1,"mat-mdc-slider","mdc-slider"],hostVars:12,hostBindings:function(_,r){_&2&&(yd("mat-"+(r.color||"primary")),_n("mdc-slider--range",r._isRange)("mdc-slider--disabled",r.disabled)("mdc-slider--discrete",r.discrete)("mdc-slider--tick-marks",r.showTickMarks)("_mat-animation-noopable",r._noopAnimations))},inputs:{disabled:[ti.HasDecoratorInputTransform,"disabled","disabled",gn],discrete:[ti.HasDecoratorInputTransform,"discrete","discrete",gn],showTickMarks:[ti.HasDecoratorInputTransform,"showTickMarks","showTickMarks",gn],min:[ti.HasDecoratorInputTransform,"min","min",Fr],color:"color",disableRipple:[ti.HasDecoratorInputTransform,"disableRipple","disableRipple",gn],max:[ti.HasDecoratorInputTransform,"max","max",Fr],step:[ti.HasDecoratorInputTransform,"step","step",Fr],displayWith:"displayWith"},exportAs:["matSlider"],standalone:!0,features:[Or([{provide:ex,useExisting:m}]),nr,ui],ngContentSelectors:pz,decls:9,vars:5,consts:[[1,"mdc-slider__track"],[1,"mdc-slider__track--inactive"],[1,"mdc-slider__track--active"],[1,"mdc-slider__track--active_fill"],["trackActive",""],["class","mdc-slider__tick-marks"],[3,"discrete","thumbPosition","valueIndicatorText"],[1,"mdc-slider__tick-marks"],["tickMarkContainer",""],[3,"class","transform"]],template:function(_,r){_&1&&(pr(),kn(0),Ue(1,"div",0),Ki(2,"div",1),Ue(3,"div",2),Ki(4,"div",3,4),Ge(),bi(6,uz,3,1,"div",5),Ge(),bi(7,mz,1,3,"mat-slider-visual-thumb",6),Ki(8,"mat-slider-visual-thumb",6)),_&2&&(Ze(6),Bo(6,r.showTickMarks?6:-1),Ze(),Bo(7,r._isRange?7:-1),Ze(),Ct("discrete",r.discrete)("thumbPosition",2)("valueIndicatorText",r.endValueIndicatorText))},dependencies:[_z],styles:['.mdc-slider{cursor:pointer;height:48px;margin:0 24px;position:relative;touch-action:pan-y}.mdc-slider .mdc-slider__track{position:absolute;top:50%;transform:translateY(-50%);width:100%}.mdc-slider .mdc-slider__track--active,.mdc-slider .mdc-slider__track--inactive{display:flex;height:100%;position:absolute;width:100%}.mdc-slider .mdc-slider__track--active{overflow:hidden}.mdc-slider .mdc-slider__track--active_fill{border-top-style:solid;box-sizing:border-box;height:100%;width:100%;position:relative;-webkit-transform-origin:left;transform-origin:left}[dir=rtl] .mdc-slider .mdc-slider__track--active_fill,.mdc-slider .mdc-slider__track--active_fill[dir=rtl]{-webkit-transform-origin:right;transform-origin:right}.mdc-slider .mdc-slider__track--inactive{left:0;top:0}.mdc-slider .mdc-slider__track--inactive::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:1px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}@media screen and (forced-colors: active){.mdc-slider .mdc-slider__track--inactive::before{border-color:CanvasText}}.mdc-slider .mdc-slider__value-indicator-container{bottom:44px;left:50%;left:var(--slider-value-indicator-container-left, 50%);pointer-events:none;position:absolute;right:var(--slider-value-indicator-container-right);transform:translateX(-50%);transform:var(--slider-value-indicator-container-transform, translateX(-50%))}.mdc-slider .mdc-slider__value-indicator{transition:transform 100ms 0ms cubic-bezier(0.4, 0, 1, 1);align-items:center;border-radius:4px;display:flex;height:32px;padding:0 12px;transform:scale(0);transform-origin:bottom}.mdc-slider .mdc-slider__value-indicator::before{border-left:6px solid rgba(0,0,0,0);border-right:6px solid rgba(0,0,0,0);border-top:6px solid;bottom:-5px;content:"";height:0;left:50%;left:var(--slider-value-indicator-caret-left, 50%);position:absolute;right:var(--slider-value-indicator-caret-right);transform:translateX(-50%);transform:var(--slider-value-indicator-caret-transform, translateX(-50%));width:0}.mdc-slider .mdc-slider__value-indicator::after{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:1px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}@media screen and (forced-colors: active){.mdc-slider .mdc-slider__value-indicator::after{border-color:CanvasText}}.mdc-slider .mdc-slider__thumb--with-indicator .mdc-slider__value-indicator-container{pointer-events:auto}.mdc-slider .mdc-slider__thumb--with-indicator .mdc-slider__value-indicator{transition:transform 100ms 0ms cubic-bezier(0, 0, 0.2, 1);transform:scale(1)}@media(prefers-reduced-motion){.mdc-slider .mdc-slider__value-indicator,.mdc-slider .mdc-slider__thumb--with-indicator .mdc-slider__value-indicator{transition:none}}.mdc-slider .mdc-slider__thumb{display:flex;left:-24px;outline:none;position:absolute;user-select:none;height:48px;width:48px}.mdc-slider .mdc-slider__thumb--top{z-index:1}.mdc-slider .mdc-slider__thumb--top .mdc-slider__thumb-knob,.mdc-slider .mdc-slider__thumb--top.mdc-slider__thumb:hover .mdc-slider__thumb-knob,.mdc-slider .mdc-slider__thumb--top.mdc-slider__thumb--focused .mdc-slider__thumb-knob{border-style:solid;border-width:1px;box-sizing:content-box}.mdc-slider .mdc-slider__thumb-knob{box-sizing:border-box;left:50%;position:absolute;top:50%;transform:translate(-50%, -50%)}.mdc-slider .mdc-slider__tick-marks{align-items:center;box-sizing:border-box;display:flex;height:100%;justify-content:space-between;padding:0 1px;position:absolute;width:100%}.mdc-slider--discrete .mdc-slider__thumb,.mdc-slider--discrete .mdc-slider__track--active_fill{transition:transform 80ms ease}@media(prefers-reduced-motion){.mdc-slider--discrete .mdc-slider__thumb,.mdc-slider--discrete .mdc-slider__track--active_fill{transition:none}}.mdc-slider--disabled{cursor:auto}.mdc-slider--disabled .mdc-slider__thumb{pointer-events:none}.mdc-slider__input{cursor:pointer;left:2px;margin:0;height:44px;opacity:0;pointer-events:none;position:absolute;top:2px;width:44px}.mat-mdc-slider{display:inline-block;box-sizing:border-box;outline:none;vertical-align:middle;margin-left:8px;margin-right:8px;width:auto;min-width:112px;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-slider .mdc-slider__thumb-knob{background-color:var(--mdc-slider-handle-color);border-color:var(--mdc-slider-handle-color)}.mat-mdc-slider .mdc-slider__thumb--top .mdc-slider__thumb-knob,.mat-mdc-slider .mdc-slider__thumb--top.mdc-slider__thumb:hover .mdc-slider__thumb-knob,.mat-mdc-slider .mdc-slider__thumb--top.mdc-slider__thumb--focused .mdc-slider__thumb-knob{border-color:#fff}.mat-mdc-slider.mdc-slider--disabled .mdc-slider__thumb-knob{background-color:var(--mdc-slider-disabled-handle-color);border-color:var(--mdc-slider-disabled-handle-color)}.mat-mdc-slider.mdc-slider--disabled .mdc-slider__thumb--top .mdc-slider__thumb-knob,.mat-mdc-slider.mdc-slider--disabled .mdc-slider__thumb--top.mdc-slider__thumb:hover .mdc-slider__thumb-knob,.mat-mdc-slider.mdc-slider--disabled .mdc-slider__thumb--top.mdc-slider__thumb--focused .mdc-slider__thumb-knob{border-color:#fff}.mat-mdc-slider .mdc-slider__thumb::before,.mat-mdc-slider .mdc-slider__thumb::after{background-color:var(--mdc-slider-handle-color)}.mat-mdc-slider .mdc-slider__thumb:hover::before,.mat-mdc-slider .mdc-slider__thumb.mdc-ripple-surface--hover::before{opacity:var(--mdc-ripple-hover-opacity)}.mat-mdc-slider .mdc-slider__thumb.mdc-ripple-upgraded--background-focused::before,.mat-mdc-slider .mdc-slider__thumb:not(.mdc-ripple-upgraded):focus::before{transition-duration:75ms;opacity:var(--mdc-ripple-focus-opacity)}.mat-mdc-slider .mdc-slider__thumb:not(.mdc-ripple-upgraded)::after{transition:opacity 150ms linear}.mat-mdc-slider .mdc-slider__thumb:not(.mdc-ripple-upgraded):active::after{transition-duration:75ms;opacity:var(--mdc-ripple-press-opacity)}.mat-mdc-slider .mdc-slider__thumb.mdc-ripple-upgraded{--mdc-ripple-fg-opacity:var(--mdc-ripple-press-opacity)}.mat-mdc-slider .mdc-slider__track--active_fill{border-color:var(--mdc-slider-active-track-color)}.mat-mdc-slider.mdc-slider--disabled .mdc-slider__track--active_fill{border-color:var(--mdc-slider-disabled-active-track-color)}.mat-mdc-slider .mdc-slider__track--inactive{background-color:var(--mdc-slider-inactive-track-color);opacity:.24}.mat-mdc-slider.mdc-slider--disabled .mdc-slider__track--inactive{background-color:var(--mdc-slider-disabled-inactive-track-color);opacity:.24}.mat-mdc-slider .mdc-slider__tick-mark--active{background-color:var(--mdc-slider-with-tick-marks-active-container-color);opacity:var(--mdc-slider-with-tick-marks-active-container-opacity)}.mat-mdc-slider.mdc-slider--disabled .mdc-slider__tick-mark--active{background-color:var(--mdc-slider-with-tick-marks-active-container-color);opacity:var(--mdc-slider-with-tick-marks-active-container-opacity)}.mat-mdc-slider .mdc-slider__tick-mark--inactive{background-color:var(--mdc-slider-with-tick-marks-inactive-container-color);opacity:var(--mdc-slider-with-tick-marks-inactive-container-opacity)}.mat-mdc-slider.mdc-slider--disabled .mdc-slider__tick-mark--inactive{background-color:var(--mdc-slider-with-tick-marks-disabled-container-color);opacity:var(--mdc-slider-with-tick-marks-inactive-container-opacity)}.mat-mdc-slider .mdc-slider__value-indicator{background-color:var(--mdc-slider-label-container-color);opacity:1}.mat-mdc-slider .mdc-slider__value-indicator::before{border-top-color:var(--mdc-slider-label-container-color)}.mat-mdc-slider .mdc-slider__value-indicator{color:var(--mdc-slider-label-label-text-color)}.mat-mdc-slider .mdc-slider__track{height:var(--mdc-slider-inactive-track-height)}.mat-mdc-slider .mdc-slider__track--active{height:var(--mdc-slider-active-track-height);top:calc((var(--mdc-slider-inactive-track-height) - var(--mdc-slider-active-track-height)) / 2)}.mat-mdc-slider .mdc-slider__track--active_fill{border-top-width:var(--mdc-slider-active-track-height)}.mat-mdc-slider .mdc-slider__track--inactive{height:var(--mdc-slider-inactive-track-height)}.mat-mdc-slider .mdc-slider__tick-mark--active,.mat-mdc-slider .mdc-slider__tick-mark--inactive{height:var(--mdc-slider-with-tick-marks-container-size);width:var(--mdc-slider-with-tick-marks-container-size)}.mat-mdc-slider.mdc-slider--disabled{opacity:0.38}.mat-mdc-slider .mdc-slider__value-indicator-text{letter-spacing:var(--mdc-slider-label-label-text-tracking);font-size:var(--mdc-slider-label-label-text-size);font-family:var(--mdc-slider-label-label-text-font);font-weight:var(--mdc-slider-label-label-text-weight);line-height:var(--mdc-slider-label-label-text-line-height)}.mat-mdc-slider .mdc-slider__track--active{border-radius:var(--mdc-slider-active-track-shape)}.mat-mdc-slider .mdc-slider__track--inactive{border-radius:var(--mdc-slider-inactive-track-shape)}.mat-mdc-slider .mdc-slider__thumb-knob{border-radius:var(--mdc-slider-handle-shape);width:var(--mdc-slider-handle-width);height:var(--mdc-slider-handle-height);border-style:solid;border-width:calc(var(--mdc-slider-handle-height) / 2) calc(var(--mdc-slider-handle-width) / 2)}.mat-mdc-slider .mdc-slider__tick-mark--active,.mat-mdc-slider .mdc-slider__tick-mark--inactive{border-radius:var(--mdc-slider-with-tick-marks-container-shape)}.mat-mdc-slider .mdc-slider__thumb:hover .mdc-slider__thumb-knob{background-color:var(--mdc-slider-hover-handle-color);border-color:var(--mdc-slider-hover-handle-color)}.mat-mdc-slider .mdc-slider__thumb:hover .mdc-slider__thumb--top .mdc-slider__thumb-knob,.mat-mdc-slider .mdc-slider__thumb:hover .mdc-slider__thumb--top.mdc-slider__thumb:hover .mdc-slider__thumb-knob,.mat-mdc-slider .mdc-slider__thumb:hover .mdc-slider__thumb--top.mdc-slider__thumb--focused .mdc-slider__thumb-knob{border-color:#fff}.mat-mdc-slider .mdc-slider__thumb--focused .mdc-slider__thumb-knob{background-color:var(--mdc-slider-focus-handle-color);border-color:var(--mdc-slider-focus-handle-color)}.mat-mdc-slider .mdc-slider__thumb--focused .mdc-slider__thumb--top .mdc-slider__thumb-knob,.mat-mdc-slider .mdc-slider__thumb--focused .mdc-slider__thumb--top.mdc-slider__thumb:hover .mdc-slider__thumb-knob,.mat-mdc-slider .mdc-slider__thumb--focused .mdc-slider__thumb--top.mdc-slider__thumb--focused .mdc-slider__thumb-knob{border-color:#fff}.mat-mdc-slider .mdc-slider__thumb:not(:disabled):active .mdc-slider__thumb--top .mdc-slider__thumb-knob,.mat-mdc-slider .mdc-slider__thumb:not(:disabled):active .mdc-slider__thumb--top.mdc-slider__thumb:hover .mdc-slider__thumb-knob,.mat-mdc-slider .mdc-slider__thumb:not(:disabled):active .mdc-slider__thumb--top.mdc-slider__thumb--focused .mdc-slider__thumb-knob{border-color:#fff}.mat-mdc-slider .mdc-slider__thumb--top .mdc-slider__thumb-knob,.mat-mdc-slider .mdc-slider__thumb--top.mdc-slider__thumb:hover .mdc-slider__thumb-knob,.mat-mdc-slider .mdc-slider__thumb--top.mdc-slider__thumb--focused .mdc-slider__thumb-knob{border-color:var(--mdc-slider-with-overlap-handle-outline-color);border-width:var(--mdc-slider-with-overlap-handle-outline-width)}.mat-mdc-slider .mdc-slider__thumb-knob{box-shadow:var(--mdc-slider-handle-elevation)}.mat-mdc-slider .mdc-slider__input{box-sizing:content-box;pointer-events:auto}.mat-mdc-slider .mdc-slider__input.mat-mdc-slider-input-no-pointer-events{pointer-events:none}.mat-mdc-slider .mdc-slider__input.mat-slider__right-input{left:auto;right:0}.mat-mdc-slider .mdc-slider__thumb,.mat-mdc-slider .mdc-slider__track--active_fill{transition-duration:0ms}.mat-mdc-slider.mat-mdc-slider-with-animation .mdc-slider__thumb,.mat-mdc-slider.mat-mdc-slider-with-animation .mdc-slider__track--active_fill{transition-duration:80ms}.mat-mdc-slider.mdc-slider--discrete .mdc-slider__thumb,.mat-mdc-slider.mdc-slider--discrete .mdc-slider__track--active_fill{transition-duration:0ms}.mat-mdc-slider.mat-mdc-slider-with-animation .mdc-slider__thumb,.mat-mdc-slider.mat-mdc-slider-with-animation .mdc-slider__track--active_fill{transition-duration:80ms}.mat-mdc-slider .mdc-slider__track,.mat-mdc-slider .mdc-slider__thumb{pointer-events:none}.mat-mdc-slider .mdc-slider__value-indicator-container{transform:var(--mat-slider-value-indicator-container-transform)}.mat-mdc-slider .mdc-slider__value-indicator{width:var(--mat-slider-value-indicator-width);height:var(--mat-slider-value-indicator-height);padding:var(--mat-slider-value-indicator-padding);opacity:var(--mat-slider-value-indicator-opacity);border-radius:var(--mat-slider-value-indicator-border-radius)}.mat-mdc-slider .mdc-slider__value-indicator::before{display:var(--mat-slider-value-indicator-caret-display)}.mat-mdc-slider .mdc-slider__value-indicator-text{width:var(--mat-slider-value-indicator-width);transform:var(--mat-slider-value-indicator-text-transform)}.mat-mdc-slider .mat-ripple .mat-ripple-element{background-color:var(--mat-slider-ripple-color)}.mat-mdc-slider .mat-ripple .mat-mdc-slider-hover-ripple{background-color:var(--mat-slider-hover-state-layer-color)}.mat-mdc-slider .mat-ripple .mat-mdc-slider-focus-ripple,.mat-mdc-slider .mat-ripple .mat-mdc-slider-active-ripple{background-color:var(--mat-slider-focus-state-layer-color)}.mat-mdc-slider._mat-animation-noopable.mdc-slider--discrete .mdc-slider__thumb,.mat-mdc-slider._mat-animation-noopable.mdc-slider--discrete .mdc-slider__track--active_fill,.mat-mdc-slider._mat-animation-noopable .mdc-slider__value-indicator{transition:none}.mat-mdc-slider .mat-mdc-focus-indicator::before{border-radius:50%}.mat-mdc-slider .mdc-slider__value-indicator{word-break:normal}.mat-mdc-slider .mdc-slider__value-indicator-text{text-align:center}.mdc-slider__thumb--focused .mat-mdc-focus-indicator::before{content:""}'],encapsulation:2,changeDetection:0});let w=m;return w})();var gz={provide:W2,useExisting:og(()=>tx),multi:!0};var tx=(()=>{let m=class m{get value(){return Fr(this._hostElement.value,0)}set value(u){u=isNaN(u)?0:u;let _=u+"";if(!this._hasSetInitialValue){this._initialValue=_;return}this._isActive||this._setValue(_)}_setValue(u){this._hostElement.value=u,this._updateThumbUIByValue(),this._slider._onValueChange(this),this._cdr.detectChanges(),this._slider._cdr.markForCheck()}get translateX(){return this._slider.min>=this._slider.max?(this._translateX=this._tickMarkOffset,this._translateX):(this._translateX===void 0&&(this._translateX=this._calcTranslateXByValue()),this._translateX)}set translateX(u){this._translateX=u}get min(){return Fr(this._hostElement.min,0)}set min(u){this._hostElement.min=u+"",this._cdr.detectChanges()}get max(){return Fr(this._hostElement.max,0)}set max(u){this._hostElement.max=u+"",this._cdr.detectChanges()}get step(){return Fr(this._hostElement.step,0)}set step(u){this._hostElement.step=u+"",this._cdr.detectChanges()}get disabled(){return gn(this._hostElement.disabled)}set disabled(u){this._hostElement.disabled=u,this._cdr.detectChanges(),this._slider.disabled!==this.disabled&&(this._slider.disabled=this.disabled)}get percentage(){return this._slider.min>=this._slider.max?this._slider._isRtl?1:0:(this.value-this._slider.min)/(this._slider.max-this._slider.min)}get fillPercentage(){return this._slider._cachedWidth?this._translateX===0?0:this.translateX/this._slider._cachedWidth:this._slider._isRtl?1:0}_setIsFocused(u){this._isFocused=u}constructor(u,_,r,M){this._ngZone=u,this._elementRef=_,this._cdr=r,this._slider=M,this.valueChange=new Ut,this.dragStart=new Ut,this.dragEnd=new Ut,this.thumbPosition=Pi.END,this._knobRadius=8,this._tickMarkOffset=3,this._isActive=!1,this._isFocused=!1,this._hasSetInitialValue=!1,this._destroyed=new ei,this._skipUIUpdate=!1,this._onTouchedFn=()=>{},this._isControlInitialized=!1,this._platform=St(da),this._hostElement=_.nativeElement,this._ngZone.runOutsideAngular(()=>{this._hostElement.addEventListener("pointerdown",this._onPointerDown.bind(this)),this._hostElement.addEventListener("pointermove",this._onPointerMove.bind(this)),this._hostElement.addEventListener("pointerup",this._onPointerUp.bind(this))})}ngOnDestroy(){this._hostElement.removeEventListener("pointerdown",this._onPointerDown),this._hostElement.removeEventListener("pointermove",this._onPointerMove),this._hostElement.removeEventListener("pointerup",this._onPointerUp),this._destroyed.next(),this._destroyed.complete(),this.dragStart.complete(),this.dragEnd.complete()}initProps(){this._updateWidthInactive(),this.disabled!==this._slider.disabled&&(this._slider.disabled=!0),this.step=this._slider.step,this.min=this._slider.min,this.max=this._slider.max,this._initValue()}initUI(){this._updateThumbUIByValue()}_initValue(){this._hasSetInitialValue=!0,this._initialValue===void 0?this.value=this._getDefaultValue():(this._hostElement.value=this._initialValue,this._updateThumbUIByValue(),this._slider._onValueChange(this),this._cdr.detectChanges())}_getDefaultValue(){return this.min}_onBlur(){this._setIsFocused(!1),this._onTouchedFn()}_onFocus(){this._setIsFocused(!0)}_onChange(){this.valueChange.emit(this.value),this._isActive&&this._updateThumbUIByValue({withAnimation:!0})}_onInput(){this._onChangeFn?.(this.value),(this._slider.step||!this._isActive)&&this._updateThumbUIByValue({withAnimation:!0}),this._slider._onValueChange(this)}_onNgControlValueChange(){(!this._isActive||!this._isFocused)&&(this._slider._onValueChange(this),this._updateThumbUIByValue()),this._slider.disabled=this._formControl.disabled}_onPointerDown(u){if(!(this.disabled||u.button!==0)){if(this._platform.IOS){let _=this._slider._isCursorOnSliderThumb(u,this._slider._getThumb(this.thumbPosition)._hostElement.getBoundingClientRect());this._isActive=_,this._updateWidthActive(),this._slider._updateDimensions();return}this._isActive=!0,this._setIsFocused(!0),this._updateWidthActive(),this._slider._updateDimensions(),this._slider.step||this._updateThumbUIByPointerEvent(u,{withAnimation:!0}),this.disabled||(this._handleValueCorrection(u),this.dragStart.emit({source:this,parent:this._slider,value:this.value}))}}_handleValueCorrection(u){this._skipUIUpdate=!0,setTimeout(()=>{this._skipUIUpdate=!1,this._fixValue(u)},0)}_fixValue(u){let _=u.clientX-this._slider._cachedLeft,r=this._slider._cachedWidth,M=this._slider.step===0?1:this._slider.step,F=Math.floor((this._slider.max-this._slider.min)/M),q=this._slider._isRtl?1-_/r:_/r,me=Math.round(q*F)/F*(this._slider.max-this._slider.min)+this._slider.min,De=Math.round(me/M)*M,$e=this.value;if(De===$e){this._slider._onValueChange(this),this._slider.step>0?this._updateThumbUIByValue():this._updateThumbUIByPointerEvent(u,{withAnimation:this._slider._hasAnimation});return}this.value=De,this.valueChange.emit(this.value),this._onChangeFn?.(this.value),this._slider._onValueChange(this),this._slider.step>0?this._updateThumbUIByValue():this._updateThumbUIByPointerEvent(u,{withAnimation:this._slider._hasAnimation})}_onPointerMove(u){!this._slider.step&&this._isActive&&this._updateThumbUIByPointerEvent(u)}_onPointerUp(){this._isActive&&(this._isActive=!1,this._platform.SAFARI&&this._setIsFocused(!1),this.dragEnd.emit({source:this,parent:this._slider,value:this.value}),setTimeout(()=>this._updateWidthInactive(),this._platform.IOS?10:0))}_clamp(u){let _=this._tickMarkOffset,r=this._slider._cachedWidth-this._tickMarkOffset;return Math.max(Math.min(u,r),_)}_calcTranslateXByValue(){return this._slider._isRtl?(1-this.percentage)*(this._slider._cachedWidth-this._tickMarkOffset*2)+this._tickMarkOffset:this.percentage*(this._slider._cachedWidth-this._tickMarkOffset*2)+this._tickMarkOffset}_calcTranslateXByPointerEvent(u){return u.clientX-this._slider._cachedLeft}_updateWidthActive(){}_updateWidthInactive(){this._hostElement.style.padding=`0 ${this._slider._inputPadding}px`,this._hostElement.style.width=`calc(100% + ${this._slider._inputPadding-this._tickMarkOffset*2}px)`,this._hostElement.style.left=`-${this._slider._rippleRadius-this._tickMarkOffset}px`}_updateThumbUIByValue(u){this.translateX=this._clamp(this._calcTranslateXByValue()),this._updateThumbUI(u)}_updateThumbUIByPointerEvent(u,_){this.translateX=this._clamp(this._calcTranslateXByPointerEvent(u)),this._updateThumbUI(_)}_updateThumbUI(u){this._slider._setTransition(!!u?.withAnimation),this._slider._onTranslateXChange(this)}writeValue(u){(this._isControlInitialized||u!==null)&&(this.value=u)}registerOnChange(u){this._onChangeFn=u,this._isControlInitialized=!0}registerOnTouched(u){this._onTouchedFn=u}setDisabledState(u){this.disabled=u}focus(){this._hostElement.focus()}blur(){this._hostElement.blur()}};m.\u0275fac=function(_){return new(_||m)(Xe(Dn),Xe(zn),Xe(On),Xe(ex))},m.\u0275dir=fn({type:m,selectors:[["input","matSliderThumb",""]],hostAttrs:["type","range",1,"mdc-slider__input"],hostVars:1,hostBindings:function(_,r){_&1&&$t("change",function(){return r._onChange()})("input",function(){return r._onInput()})("blur",function(){return r._onBlur()})("focus",function(){return r._onFocus()}),_&2&&cr("aria-valuetext",r._valuetext)},inputs:{value:[ti.HasDecoratorInputTransform,"value","value",Fr]},outputs:{valueChange:"valueChange",dragStart:"dragStart",dragEnd:"dragEnd"},exportAs:["matSliderThumb"],standalone:!0,features:[Or([gz,{provide:uC,useExisting:m}]),nr]});let w=m;return w})();var fC=(()=>{let m=class m{};m.\u0275fac=function(_){return new(_||m)},m.\u0275mod=Un({type:m}),m.\u0275inj=Vn({imports:[qn,Lh]});let w=m;return w})();function vz(w,m){if(w&1&&(Ue(0,"mat-option",10),Bt(1),Ue(2,"span",11),Bt(3),gp(4,"json"),Ge()()),w&2){let x=m.$implicit;Ct("value",x.key),Ze(),hn(x.key),Ze(2),rr("(ex. ",yp(4,3,x.exampleValue),")")}}function xz(w,m){if(w&1&&(Ue(0,"mat-option",10),Bt(1),Ue(2,"span",11),Bt(3),gp(4,"json"),Ge()()),w&2){let x=m.$implicit;Ct("value",x.key),Ze(),hn(x.key),Ze(2),rr("(ex. ",yp(4,3,x.exampleValue),")")}}function wz(w,m){if(w&1&&Ki(0,"lib-ng-simple-table",12),w&2){let x=Dt();Ct("data",x.matchTableData)("columnDefs",x.matchColumnDefs)("filterLabel",x.txt().filter)}}function Tz(w,m){if(w&1){let x=dn();Ue(0,"button",13),$t("click",function(){Xi(x);let _=Dt();return Yi(_.downloadMappings())}),Ue(1,"mat-icon"),Bt(2,"download"),Ge(),Bt(3),Ge()}if(w&2){let x=Dt();Ct("matTooltip",x.txt().downloadMappingsTooltip),Ze(3),rr(" ",x.txt().downloadMappings," ")}}function kz(w,m){if(w&1){let x=dn();Ue(0,"button",13),$t("click",function(){Xi(x);let _=Dt();return Yi(_.downloadUnmapped())}),Ue(1,"mat-icon"),Bt(2,"download"),Ge(),Bt(3),Ge()}if(w&2){let x=Dt();Ct("matTooltip",x.txt().downloadUnmappableTooltip),Ze(3),rr(" ",x.txt().downloadUnmappable," ")}}var _C=(()=>{let m=class m{constructor(){this._snackbar=St(Jv),this._translationService=St(jh),this.txt=this._translationService.translatedContent,this.gisFeaturesUpdated=new Ut,this.pairsUpdated=new Ut,this.threshold=1,this.intersectionProcessed=!1,this.matchTableData=[],this.matchColumnDefs=[],this.dxfProperties=[],this.dxfIdentifierProp="handle",this.geoJSONProperties=[],this.geoJSONIdentifierProp=""}ngOnChanges(){this.dxfFeatures!==void 0&&this.gisFeatures!==void 0&&this._getProperties()}filterOverlapping(){if(this.dxfFeatures?.bbox===void 0){this._snackbar.open("No BBOX found for BBOX");return}if(this.gisFeatures?.bbox===void 0){this._snackbar.open("No BBOX found for geoJSON");return}let u=Dv([this.dxfFeatures.bbox,this.gisFeatures.bbox]);this.gisFeatures=yS(this.gisFeatures,u,this.threshold),u&&(this.gisFeatures.bbox=u),this.gisFeaturesUpdated.emit(this.gisFeatures),this.intersectionProcessed=!0}onSliderDrag(u){u.stopImmediatePropagation()}matchPoints(){return ir(this,null,function*(){if(this.dxfFeatures===void 0||this.gisFeatures===void 0)return;this._pairingResults=yield fS(this.dxfFeatures,this.gisFeatures,this.threshold),this.updateTable();let u=[];this._pairingResults.successful.forEach(r=>u.push(r.connection));let _=yield nu(u,!1);this.pairsUpdated.emit(_)})}_getProperties(){let u=this.gisFeatures?.features[0].properties;u!==void 0&&(this.geoJSONProperties=Object.keys(u).map(F=>({key:F,exampleValue:u[F]})));let _=this.geoJSONProperties.map(F=>F.key);this.geoJSONIdentifierProp=_.includes("baumnummer")?"baumnummer":this.geoJSONProperties[0].key;let r=this.dxfFeatures?.features[0].properties;r!==void 0&&(this.dxfProperties=Object.keys(r).map(F=>({key:F,exampleValue:r[F]})));let M=this.dxfProperties.map(F=>F.key);this.dxfIdentifierProp=M.includes("handle")?"handle":this.dxfProperties[0].key}updateTable(){this.matchTableData=[],this._pairingResults?.successful.forEach(u=>{let _={};_.distance=Math.round(u.distance*1e3),_[this.dxfIdentifierProp]=this._formatPropValue(u.featureA.properties[this.dxfIdentifierProp]),_[this.geoJSONIdentifierProp]=this._formatPropValue(u.featureB.properties[this.geoJSONIdentifierProp]),this.matchTableData.push(_)}),this.matchColumnDefs=[new Mg(this.dxfIdentifierProp,this.dxfIdentifierProp),new Mg(this.geoJSONIdentifierProp,this.geoJSONIdentifierProp),new Mg("distance",`${this.txt().distance} [mm]`)]}downloadMappings(){return ir(this,null,function*(){let u=this._pairingResults?.successful.map(r=>r.connection);if(u===void 0)return;let _=yield nu(u,!1);_.properties={mappingDistance:this.threshold},nf(_,"mapped")})}downloadUnmapped(){return ir(this,null,function*(){if(this._pairingResults?.unsuccesful===void 0)return;let u=yield nu(this._pairingResults?.unsuccesful);u.properties={mappingDistance:this.threshold},nf(u,"unmapped")})}_formatPropValue(u){return typeof u=="string"?u:JSON.stringify(u)}};m.\u0275fac=function(_){return new(_||m)},m.\u0275cmp=hi({type:m,selectors:[["app-feature-mapper"]],inputs:{dxfFeatures:"dxfFeatures",gisFeatures:"gisFeatures"},outputs:{gisFeaturesUpdated:"gisFeaturesUpdated",pairsUpdated:"pairsUpdated"},standalone:!0,features:[lr,ui],decls:32,vars:15,consts:[[1,"col"],[1,"row"],["min","0","max","10","step","0.2",2,"width","50%"],["matSliderThumb","",3,"ngModel","ngModelChange","mousedown"],[2,"width","100%"],[3,"ngModel","ngModelChange","selectionChange"],["mat-flat-button","",2,"width","50%",3,"matTooltip","disabled","click"],["mat-flat-button","",2,"width","50%",3,"matTooltip","click"],[3,"data","columnDefs","filterLabel",4,"ngIf"],["style","width: 50%;","mat-stroked-button","",3,"matTooltip","click",4,"ngIf"],[3,"value"],[1,"smaller"],[3,"data","columnDefs","filterLabel"],["mat-stroked-button","",2,"width","50%",3,"matTooltip","click"]],template:function(_,r){_&1&&(Ue(0,"div",0)(1,"div",1)(2,"mat-slider",2)(3,"input",3),$t("ngModelChange",function(F){return r.threshold=F})("mousedown",function(F){return r.onSliderDrag(F)}),Ge()(),Ue(4,"span"),Bt(5),Ge()(),Ue(6,"div",1)(7,"mat-form-field",4)(8,"mat-label"),Bt(9),Ge(),Ue(10,"mat-select",5),$t("ngModelChange",function(F){return r.dxfIdentifierProp=F})("selectionChange",function(){return r.updateTable()}),Lr(11,vz,5,5,"mat-option",10,No),Ge()(),Ue(13,"mat-form-field",4)(14,"mat-label"),Bt(15),Ge(),Ue(16,"mat-select",5),$t("ngModelChange",function(F){return r.geoJSONIdentifierProp=F})("selectionChange",function(){return r.updateTable()}),Lr(17,xz,5,5,"mat-option",10,No),Ge()()(),Ue(19,"div",1)(20,"button",6),$t("click",function(){return r.filterOverlapping()}),Ue(21,"mat-icon"),Bt(22,"join_inner"),Ge(),Bt(23),Ge(),Ue(24,"button",7),$t("click",function(){return r.matchPoints()}),Ue(25,"mat-icon"),Bt(26,"link"),Ge(),Bt(27),Ge()(),bi(28,wz,1,3,"lib-ng-simple-table",8),Ue(29,"div",1),bi(30,Tz,4,2,"button",9)(31,kz,4,2,"button",9),Ge()()),_&2&&(Ze(3),Ct("ngModel",r.threshold),Ze(2),O2("",r.txt().threshold,": ",r.threshold," m"),Ze(4),hn(r.txt().dxfIdentifier),Ze(),Ct("ngModel",r.dxfIdentifierProp),Ze(),zr(r.dxfProperties),Ze(4),hn(r.txt().gisIdentifier),Ze(),Ct("ngModel",r.geoJSONIdentifierProp),Ze(),zr(r.geoJSONProperties),Ze(3),Ct("matTooltip",r.txt().intersectionOnlyTooltip)("disabled",r.intersectionProcessed),Ze(3),rr(" ",r.txt().intersectionOnly," "),Ze(),Ct("matTooltip",r.txt().matchPointsTooltip),Ze(3),rr(" ",r.txt().matchPoints," "),Ze(),Ct("ngIf",r.matchTableData.length),Ze(2),Ct("ngIf",r.matchTableData.length),Ze(),Ct("ngIf",r.matchTableData.length))},dependencies:[In,jo,_g,qo,Es,xa,va,hC,fC,pC,tx,Is,X2,Ts,ks,Cg,Sg,ck,Ms,Bh,Fh,Cs,Ss,Ig],styles:[".row[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;width:100%;gap:10px}.col[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}.smaller[_ngcontent-%COMP%]{font-size:.6em}"]});let w=m;return w})();function Iz(w,m){if(w&1&&(Ue(0,"div",1)(1,"span",2),Bt(2),Ge(),Ue(3,"span",3),Bt(4),gp(5,"json"),Ge()()),w&2){let x=m.$implicit,u=Dt();Ze(2),hn(x),Ze(2),hn(yp(5,2,u.object[x]))}}var gC=(()=>{let m=class m{constructor(){this.keys=[]}ngOnChanges(){console.log(this.object),this.keys=Object.keys(this.object)}};m.\u0275fac=function(_){return new(_||m)},m.\u0275cmp=hi({type:m,selectors:[["lib-list-object-values"]],inputs:{object:"object"},standalone:!0,features:[lr,ui],decls:3,vars:0,consts:[[1,"col"],[1,"row"],[1,"property"],[1,"value"],["class","row"]],template:function(_,r){_&1&&(Ue(0,"div",0),Lr(1,Iz,6,4,"div",4,No),Ge()),_&2&&(Ze(),zr(r.keys))},dependencies:[In,_g],styles:[".col[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}.row[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;gap:20px}.property[_ngcontent-%COMP%]{font-size:.8em}"]});let w=m;return w})();var Sz=["appWindow"];function Cz(w,m){if(w&1&&(Ue(0,"div",8)(1,"span"),Bt(2),Ge()()),w&2){let x=Dt(2);Ze(2),hn(x.txt().initialInstructions)}}function Mz(w,m){if(w&1){let x=dn();Ue(0,"button",13),$t("click",function(){Xi(x);let _=Dt(2);return Yi(_.uploadDXF())}),Ue(1,"mat-icon"),Bt(2,"upload"),Ge(),Bt(3),Ge()}if(w&2){let x=Dt(2);Ct("matTooltip",x.txt().uploadDXFTooltip),Ze(3),rr(" ",x.txt().uploadDXF," ")}}function Ez(w,m){if(w&1){let x=dn();Ue(0,"button",13),$t("click",function(){Xi(x);let _=Dt(2);return Yi(_.uploadGeoJSON())}),Ue(1,"mat-icon"),Bt(2,"upload"),Ge(),Bt(3),Ge()}if(w&2){let x=Dt(2);Ct("matTooltip",x.txt().uploadGeoJSONTooltip),Ze(3),rr(" ",x.txt().uploadGeoJSON," ")}}function Az(w,m){w&1&&Ki(0,"mat-progress-bar",14)}function Dz(w,m){if(w&1&&(Ue(0,"div"),Bt(1),Ge()),w&2){let x=Dt(3);Ze(),rr(" ",x.txt().noGeoDataAvailable," ")}}function Pz(w,m){if(w&1&&(Ue(0,"div"),Bt(1),Ge()),w&2){let x=Dt(3);Ze(),rr(" ",x.txt().noDXFSelectionAvailable," ")}}function Rz(w,m){if(w&1){let x=dn();Ue(0,"app-feature-mapper",19),$t("gisFeaturesUpdated",function(_){Xi(x);let r=Dt(3);return Yi(r.plotGISFeatures(_,!1))})("pairsUpdated",function(_){Xi(x);let r=Dt(3);return Yi(r.plotPairingLines(_))}),Ge()}if(w&2){let x=Dt(3);Ct("dxfFeatures",x.dxfFeatureCollection)("gisFeatures",x.gisFeatureCollection)}}function Lz(w,m){if(w&1){let x=dn();Ue(0,"mat-tab-group")(1,"mat-tab",15)(2,"app-dxf-analyzer",16),$t("showOnMap",function(_){Xi(x);let r=Dt(2);return Yi(r.mapFromDXF(_))}),Ge()(),Ue(3,"mat-tab",17),bi(4,Dz,2,1,"div",12)(5,Pz,2,1,"div",12)(6,Rz,1,2,"app-feature-mapper",18),Ge()()}if(w&2){let x=Dt(2);Ze(4),Ct("ngIf",!x.gisFeatureCollection),Ze(),Ct("ngIf",x.gisFeatureCollection&&!x.dxfFeatureCollection),Ze(),Ct("ngIf",x.dxfEntitiesLoaded&&x.geoJSONLoaded)}}function zz(w,m){if(w&1){let x=dn();Ue(0,"lib-ng-dragable-window",5),$t("clickedClose",function(){Xi(x);let _=Dt();return Yi(_.showUIWindow=!1)}),Ue(1,"div",6),bi(2,Cz,3,1,"div",7),Ue(3,"div",8),bi(4,Mz,4,2,"button",9)(5,Ez,4,2,"button",9),Ge()(),Ue(6,"div",10),bi(7,Az,1,0,"mat-progress-bar",11)(8,Lz,7,3,"mat-tab-group",12),Ge()()}if(w&2){let x=Dt();Ze(2),Ct("ngIf",x.pristine),Ze(2),Ct("ngIf",!x.dxfLoaded),Ze(),Ct("ngIf",!x.geoJSONLoaded),Ze(2),Ct("ngIf",x.processing),Ze(),Ct("ngIf",x.dxfLoaded)}}function Oz(w,m){if(w&1){let x=dn();Ue(0,"lib-ng-dragable-window",20),$t("clickedClose",function(){Xi(x);let _=Dt();return Yi(_.selectedFeature=void 0)}),Ki(1,"lib-list-object-values",21),Ge()}if(w&2){let x=Dt();Ze(),Ct("object",x.selectedFeature)}}var yC=(()=>{let m=class m{constructor(){this._dxfProcessor=St(dk),this._translationService=St(jh),this.txt=this._translationService.translatedContent,this.language=this._translationService.language,this.languages=this._translationService.languages,this.processing=!1,this.dxfLoaded=!1,this.dxfEntitiesLoaded=!1,this.geoJSONLoaded=!1,this.mapShown=!1,this.showUIWindow=!0,this.pristine=!0,this.lngLat=[12.5114245,55.6713366],this.zoom=2,this._dxfPlotColor="rgba(255,0,0,0.5)",this._gisPlotColor="rgba(0,0,255,0.5)"}uploadDXF(){return ir(this,null,function*(){this.pristine=!1,console.time("Process DXF");let u=yield Pv(".dxf");this.processing=!0,yield this._dxfProcessor.processDXF(u),console.timeEnd("Process DXF"),this.processing=!1,this.dxfLoaded=!0})}uploadGeoJSON(){return ir(this,null,function*(){this.pristine=!1,this.mapShown=!0;let u=yield wS(".json,.geojson");this.gisFeatureCollection=u,this.plotGISFeatures(u),this.geoJSONLoaded=!0,this.showUIWindow=!0,this._updateColorLegend()})}plotGISFeatures(u,_=!0){let r={id:"geojson-layer",type:"circle",source:"geojson",paint:{"circle-radius":4,"circle-stroke-width":2,"circle-color":this._gisPlotColor,"circle-stroke-color":"white"}};this.mapbox.loadGeoJSON("geojson",u,r,_)}plotPairingLines(u){console.log(u);let _={id:"pairs-layer",type:"line",source:"geojson",paint:{"line-color":"magenta"}};this.mapbox.loadGeoJSON("pairs",u,_,!1);let r=this.mapbox.sources;console.log(r)}mapFromDXF(u){this.mapShown=!0,this.dxfFeatureCollection=u;let _={id:"dxf-layer",type:"circle",source:"dxf",paint:{"circle-radius":4,"circle-stroke-width":2,"circle-color":this._dxfPlotColor,"circle-stroke-color":"white"}};this.mapbox.loadGeoJSON("dxf",u,_,!1),this.showUIWindow=!0,this.dxfEntitiesLoaded=!0,this._updateColorLegend()}handleLanguageChange(u){this._translationService.language=u}_updateColorLegend(){let u=[];this.geoJSONLoaded&&u.push({color:this._gisPlotColor,text:"geoJSON",id:"geojson"}),this.dxfEntitiesLoaded&&u.push({color:this._dxfPlotColor,text:"DXF",id:"dxf"}),this._colorLegend=u0.getInstance(document.body),this._colorLegend?.setItems(u),this._colorLegend.setPosition("calc(100vh - 120px)","calc(100vw - 120px)")}};m.\u0275fac=function(_){return new(_||m)},m.\u0275cmp=hi({type:m,selectors:[["app-root"]],viewQuery:function(_,r){if(_&1&&(Fn(zv,5),Fn(Sz,5)),_&2){let M;Ni(M=ji())&&(r.mapbox=M.first),Ni(M=ji())&&(r.appWindow=M.first)}},standalone:!0,features:[ui],decls:6,vars:8,consts:[[3,"title","info","languageOptions","seletcedLanguage","changedLanguage"],[3,"clickedClose",4,"ngIf"],["id","props",3,"clickedClose",4,"ngIf"],["appWindow",""],[3,"center","zoom","clickedFeature"],[3,"clickedClose"],["fixedTop","",1,"col","top"],["class","row",4,"ngIf"],[1,"row"],["mat-flat-button","","style","width: 50%",3,"matTooltip","click",4,"ngIf"],[1,"col",2,"width","500px"],["mode","indeterminate",4,"ngIf"],[4,"ngIf"],["mat-flat-button","",2,"width","50%",3,"matTooltip","click"],["mode","indeterminate"],["label","DXF Extract"],[3,"showOnMap"],["label","Mapping"],[3,"dxfFeatures","gisFeatures","gisFeaturesUpdated","pairsUpdated",4,"ngIf"],[3,"dxfFeatures","gisFeatures","gisFeaturesUpdated","pairsUpdated"],["id","props",3,"clickedClose"],[3,"object"]],template:function(_,r){_&1&&(Ue(0,"lib-ng-demo-layout",0),$t("changedLanguage",function(F){return r.handleLanguageChange(F)}),Ge(),bi(1,zz,9,5,"lib-ng-dragable-window",1)(2,Oz,2,1,"lib-ng-dragable-window",2),pp(3,null,3),Ue(5,"lib-ng-mapbox",4),$t("clickedFeature",function(F){return r.selectedFeature=F}),Ge(),fp()),_&2&&(Ct("title",r.txt().title)("info",r.txt().info)("languageOptions",r.languages)("seletcedLanguage",r.language()),Ze(),Ct("ngIf",r.showUIWindow),Ze(),Ct("ngIf",r.selectedFeature),Ze(3),Ct("center",r.lngLat)("zoom",r.zoom))},dependencies:[In,jo,UI,zv,xS,qo,Es,xa,va,IS,kS,WS,lC,Qv,sC,_C,Cg,Sg,gC],styles:[".row[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;width:100%;gap:10px}.col[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}.top[_ngcontent-%COMP%]{padding:20px}lib-ng-mapbox[_ngcontent-%COMP%]{position:absolute;top:0;right:0;left:0;height:100vh}  .mat-mdc-tab-body-wrapper{margin-top:20px!important}#props[_ngcontent-%COMP%]{position:absolute;top:0;width:200px;right:400px;max-height:400px}"]});let w=m;return w})();H2(yC,aI).catch(w=>console.error(w));
