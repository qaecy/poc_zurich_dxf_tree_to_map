var pe=Object.create;var ae=Object.defineProperty;var ue=Object.getOwnPropertyDescriptor;var fe=Object.getOwnPropertyNames;var be=Object.getPrototypeOf,ce=Object.prototype.hasOwnProperty;var de=(s,t)=>()=>(t||s((t={exports:{}}).exports,t),t.exports);var he=(s,t,e,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let u of fe(t))!ce.call(s,u)&&u!==e&&ae(s,u,{get:()=>t[u],enumerable:!(a=ue(t,u))||a.enumerable});return s};var ve=(s,t,e)=>(e=s!=null?pe(be(s)):{},he(t||!s||!s.__esModule?ae(e,"default",{value:s,enumerable:!0}):e,s));var ne=de((se,j)=>{"use strict";(function(s,t){"use strict";typeof define=="function"&&define.amd?define(t):typeof j=="object"&&j.exports?j.exports=t():s.log=t()})(se,function(){"use strict";var s=function(){},t="undefined",e=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),a=["trace","debug","info","warn","error"],u={},n=null;function x(h,g){var p=h[g];if(typeof p.bind=="function")return p.bind(h);try{return Function.prototype.bind.call(p,h)}catch{return function(){return Function.prototype.apply.apply(p,[h,arguments])}}}function i(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function Q(h){return h==="debug"&&(h="log"),typeof console===t?!1:h==="trace"&&e?i:console[h]!==void 0?x(console,h):console.log!==void 0?x(console,"log"):s}function P(){for(var h=this.getLevel(),g=0;g<a.length;g++){var p=a[g];this[p]=g<h?s:this.methodFactory(p,h,this.name)}if(this.log=this.debug,typeof console===t&&h<this.levels.SILENT)return"No console available for logging"}function $(h){return function(){typeof console!==t&&(P.call(this),this[h].apply(this,arguments))}}function ee(h,g,p){return Q(h)||$.apply(this,arguments)}function W(h,g){var p=this,T,L,w,v="loglevel";typeof h=="string"?v+=":"+h:typeof h=="symbol"&&(v=void 0);function q(c){var k=(a[c]||"silent").toUpperCase();if(!(typeof window===t||!v)){try{window.localStorage[v]=k;return}catch{}try{window.document.cookie=encodeURIComponent(v)+"="+k+";"}catch{}}}function l(){var c;if(!(typeof window===t||!v)){try{c=window.localStorage[v]}catch{}if(typeof c===t)try{var k=window.document.cookie,J=encodeURIComponent(v),te=k.indexOf(J+"=");te!==-1&&(c=/^([^;]+)/.exec(k.slice(te+J.length+1))[1])}catch{}return p.levels[c]===void 0&&(c=void 0),c}}function o(){if(!(typeof window===t||!v)){try{window.localStorage.removeItem(v)}catch{}try{window.document.cookie=encodeURIComponent(v)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function b(c){var k=c;if(typeof k=="string"&&p.levels[k.toUpperCase()]!==void 0&&(k=p.levels[k.toUpperCase()]),typeof k=="number"&&k>=0&&k<=p.levels.SILENT)return k;throw new TypeError("log.setLevel() called with invalid level: "+c)}p.name=h,p.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},p.methodFactory=g||ee,p.getLevel=function(){return w??L??T},p.setLevel=function(c,k){return w=b(c),k!==!1&&q(w),P.call(p)},p.setDefaultLevel=function(c){L=b(c),l()||p.setLevel(c,!1)},p.resetLevel=function(){w=null,o(),P.call(p)},p.enableAll=function(c){p.setLevel(p.levels.TRACE,c)},p.disableAll=function(c){p.setLevel(p.levels.SILENT,c)},p.rebuild=function(){if(n!==p&&(T=b(n.getLevel())),P.call(p),n===p)for(var c in u)u[c].rebuild()},T=b(n?n.getLevel():"WARN");var m=l();m!=null&&(w=b(m)),P.call(p)}n=new W,n.getLogger=function(g){if(typeof g!="symbol"&&typeof g!="string"||g==="")throw new TypeError("You must supply a name when creating a logger.");var p=u[g];return p||(p=u[g]=new W(g,n.methodFactory)),p};var K=typeof window!==t?window.log:void 0;return n.noConflict=function(){return typeof window!==t&&window.log===n&&(window.log=K),n},n.getLoggers=function(){return u},n.default=n,n})});var O=class{constructor(t){this._pointer=0,this._eof=!1,this._data=t}next(){if(!this.hasNext())throw this._eof?new Error("Cannot call 'next' after EOF group has been read"):new Error("Unexpected end of input: EOF group not read before end of file. Ended on code "+this._data[this._pointer]);let t={code:parseInt(this._data[this._pointer])};return this._pointer++,t.value=ie(t.code,this._data[this._pointer].trim()),this._pointer++,t.code===0&&t.value==="EOF"&&(this._eof=!0),this.lastReadGroup=t,t}peek(){if(!this.hasNext())throw this._eof?new Error("Cannot call 'next' after EOF group has been read"):new Error("Unexpected end of input: EOF group not read before end of file. Ended on code "+this._data[this._pointer]);let t={code:parseInt(this._data[this._pointer])};return t.value=ie(t.code,this._data[this._pointer+1].trim()),t}rewind(t=1){this._pointer=this._pointer-t*2}hasNext(){return!(this._eof||this._pointer>this._data.length-2)}isEOF(){return this._eof}};function ie(s,t){return s<=9?t:s>=10&&s<=59?parseFloat(t):s>=60&&s<=99?parseInt(t):s>=100&&s<=109?t:s>=110&&s<=149?parseFloat(t):s>=160&&s<=179?parseInt(t):s>=210&&s<=239?parseFloat(t):s>=270&&s<=289?parseInt(t):s>=290&&s<=299?ke(t):s>=300&&s<=369?t:s>=370&&s<=389?parseInt(t):s>=390&&s<=399?t:s>=400&&s<=409?parseInt(t):s>=410&&s<=419?t:s>=420&&s<=429?parseInt(t):s>=430&&s<=439?t:s>=440&&s<=459?parseInt(t):s>=460&&s<=469?parseFloat(t):s>=470&&s<=481||s===999||s>=1e3&&s<=1009?t:s>=1010&&s<=1059?parseFloat(t):s>=1060&&s<=1071?parseInt(t):(console.log("WARNING: Group code does not have a defined type: %j",{code:s,value:t}),t)}function ke(s){if(s==="0")return!1;if(s==="1")return!0;throw TypeError("String '"+s+"' cannot be cast to Boolean type")}var Z=[0,16711680,16776960,65280,65535,255,16711935,16777215,8421504,12632256,16711680,16744319,13369344,13395558,10027008,10046540,8323072,8339263,4980736,4990502,16727808,16752511,13382400,13401958,10036736,10051404,8331008,8343359,4985600,4992806,16744192,16760703,13395456,13408614,10046464,10056268,8339200,8347455,4990464,4995366,16760576,16768895,13408512,13415014,10056192,10061132,8347392,8351551,4995328,4997670,16776960,16777087,13421568,13421670,10000384,10000460,8355584,8355647,5000192,5000230,12582656,14679935,10079232,11717734,7510016,8755276,6258432,7307071,3755008,4344870,8388352,12582783,6736896,10079334,5019648,7510092,4161280,6258495,2509824,3755046,4194048,10485631,3394560,8375398,2529280,6264908,2064128,5209919,1264640,3099686,65280,8388479,52224,6736998,38912,5019724,32512,4161343,19456,2509862,65343,8388511,52275,6737023,38950,5019743,32543,4161359,19475,2509871,65407,8388543,52326,6737049,38988,5019762,32575,4161375,19494,2509881,65471,8388575,52377,6737074,39026,5019781,32607,4161391,19513,2509890,65535,8388607,52428,6737100,39064,5019800,32639,4161407,19532,2509900,49151,8380415,39372,6730444,29336,5014936,24447,4157311,14668,2507340,32767,8372223,26316,6724044,19608,5010072,16255,4153215,9804,2505036,16383,8364031,13260,6717388,9880,5005208,8063,4149119,4940,2502476,255,8355839,204,6710988,152,5000344,127,4145023,76,2500172,4129023,10452991,3342540,8349388,2490520,6245528,2031743,5193599,1245260,3089996,8323327,12550143,6684876,10053324,4980888,7490712,4128895,6242175,2490444,3745356,12517631,14647295,10027212,11691724,7471256,8735896,6226047,7290751,3735628,4335180,16711935,16744447,13369548,13395660,9961624,9981080,8323199,8339327,4980812,4990540,16711871,16744415,13369497,13395634,9961586,9981061,8323167,8339311,4980793,4990530,16711807,16744383,13369446,13395609,9961548,9981042,8323135,8339295,4980774,4990521,16711743,16744351,13369395,13395583,9961510,9981023,8323103,8339279,4980755,4990511,3355443,5987163,8684676,11382189,14079702,16777215];function xe(s){return Z[s]}function r(s){let t={};s.rewind();let e=s.next(),a=e.code;if(t.x=e.value,a+=10,e=s.next(),e.code!=a)throw new Error("Expected code for point value to be "+a+" but got "+e.code+".");return t.y=e.value,a+=10,e=s.next(),e.code!=a?(s.rewind(),t):(t.z=e.value,t)}function d(s,t,e){switch(t.code){case 0:s.type=t.value;break;case 5:s.handle=t.value;break;case 6:s.lineType=t.value;break;case 8:s.layer=t.value;break;case 48:s.lineTypeScale=t.value;break;case 60:s.visible=t.value===0;break;case 62:s.colorIndex=t.value,s.color=xe(Math.abs(t.value));break;case 67:s.inPaperSpace=t.value!==0;break;case 100:break;case 101:for(;t.code!=0;)t=e.next();e.rewind();break;case 330:s.ownerHandle=t.value;break;case 347:s.materialObjectHandle=t.value;break;case 370:s.lineweight=t.value;break;case 420:s.color=t.value;break;case 1e3:s.extendedData=s.extendedData||{},s.extendedData.customStrings=s.extendedData.customStrings||[],s.extendedData.customStrings.push(t.value);break;case 1001:s.extendedData=s.extendedData||{},s.extendedData.applicationName=t.value;break;default:return!1}return!0}var N=class{constructor(){this.ForEntityName="3DFACE"}parseEntity(t,e){let a={type:e.value,vertices:[]};for(e=t.next();!t.isEOF()&&e.code!==0;){switch(e.code){case 70:a.shape=(e.value&1)===1,a.hasContinuousLinetypePattern=(e.value&128)===128;break;case 10:a.vertices=ge(t,e),e=t.lastReadGroup;break;default:d(a,e,t);break}e=t.next()}return a}};function ge(s,t){var e=[],a=!1,u=!1,n=4;for(let i=0;i<=n;i++){for(var x={};!s.isEOF()&&!(t.code===0||u);){switch(t.code){case 10:case 11:case 12:case 13:if(a){u=!0;continue}x.x=t.value,a=!0;break;case 20:case 21:case 22:case 23:x.y=t.value;break;case 30:case 31:case 32:case 33:x.z=t.value;break;default:return e}t=s.next()}e.push(x),a=!1,u=!1}return s.rewind(),e}var D=class{constructor(){this.ForEntityName="ARC"}parseEntity(t,e){let a={type:e.value};for(e=t.next();!t.isEOF()&&e.code!==0;){switch(e.code){case 10:a.center=r(t);break;case 40:a.radius=e.value;break;case 50:a.startAngle=Math.PI/180*e.value;break;case 51:a.endAngle=Math.PI/180*e.value,a.angleLength=a.endAngle-a.startAngle;break;case 210:a.extrusionDirectionX=e.value;break;case 220:a.extrusionDirectionY=e.value;break;case 230:a.extrusionDirectionZ=e.value;break;default:d(a,e,t);break}e=t.next()}return a}};var S=class{constructor(){this.ForEntityName="ATTDEF"}parseEntity(t,e){var a={type:e.value,scale:1,textStyle:"STANDARD"};for(e=t.next();!t.isEOF()&&e.code!==0;){switch(e.code){case 1:a.text=e.value;break;case 2:a.tag=e.value;break;case 3:a.prompt=e.value;break;case 7:a.textStyle=e.value;break;case 10:a.startPoint=r(t);break;case 11:a.endPoint=r(t);break;case 39:a.thickness=e.value;break;case 40:a.textHeight=e.value;break;case 41:a.scale=e.value;break;case 50:a.rotation=e.value;break;case 51:a.obliqueAngle=e.value;break;case 70:a.invisible=!!(e.value&1),a.constant=!!(e.value&2),a.verificationRequired=!!(e.value&4),a.preset=!!(e.value&8);break;case 71:a.backwards=!!(e.value&2),a.mirrored=!!(e.value&4);break;case 72:a.horizontalJustification=e.value;break;case 73:a.fieldLength=e.value;break;case 74:a.verticalJustification=e.value;break;case 100:break;case 210:a.extrusionDirectionX=e.value;break;case 220:a.extrusionDirectionY=e.value;break;case 230:a.extrusionDirectionZ=e.value;break;default:d(a,e,t);break}e=t.next()}return a}};var A=class{constructor(){this.ForEntityName="CIRCLE"}parseEntity(t,e){let a={type:e.value};for(e=t.next();!t.isEOF()&&e.code!==0;){switch(e.code){case 10:a.center=r(t);break;case 40:a.radius=e.value;break;case 50:a.startAngle=Math.PI/180*e.value;break;case 51:let u=Math.PI/180*e.value;u<a.startAngle?a.angleLength=u+2*Math.PI-a.startAngle:a.angleLength=u-a.startAngle,a.endAngle=u;break;default:d(a,e,t);break}e=t.next()}return a}};var I=class{constructor(){this.ForEntityName="DIMENSION"}parseEntity(t,e){let a={type:e.value};for(e=t.next();!t.isEOF()&&e.code!==0;){switch(e.code){case 2:a.block=e.value;break;case 10:a.anchorPoint=r(t);break;case 11:a.middleOfText=r(t);break;case 12:a.insertionPoint=r(t);break;case 13:a.linearOrAngularPoint1=r(t);break;case 14:a.linearOrAngularPoint2=r(t);break;case 15:a.diameterOrRadiusPoint=r(t);break;case 16:a.arcPoint=r(t);break;case 70:a.dimensionType=e.value;break;case 71:a.attachmentPoint=e.value;break;case 42:a.actualMeasurement=e.value;break;case 1:a.text=e.value;break;case 50:a.angle=e.value;break;default:d(a,e,t);break}e=t.next()}return a}};var R=class{constructor(){this.ForEntityName="ELLIPSE"}parseEntity(t,e){let a={type:e.value};for(e=t.next();!t.isEOF()&&e.code!==0;){switch(e.code){case 10:a.center=r(t);break;case 11:a.majorAxisEndPoint=r(t);break;case 40:a.axisRatio=e.value;break;case 41:a.startAngle=e.value;break;case 42:a.endAngle=e.value;break;case 2:a.name=e.value;break;default:d(a,e,t);break}e=t.next()}return a}};var _=class{constructor(){this.ForEntityName="INSERT"}parseEntity(t,e){let a={type:e.value};for(e=t.next();!t.isEOF()&&e.code!==0;){switch(e.code){case 2:a.name=e.value;break;case 41:a.xScale=e.value;break;case 42:a.yScale=e.value;break;case 43:a.zScale=e.value;break;case 10:a.position=r(t);break;case 50:a.rotation=e.value;break;case 70:a.columnCount=e.value;break;case 71:a.rowCount=e.value;break;case 44:a.columnSpacing=e.value;break;case 45:a.rowSpacing=e.value;break;case 210:a.extrusionDirection=r(t);break;default:d(a,e,t);break}e=t.next()}return a}};var H=class{constructor(){this.ForEntityName="LINE"}parseEntity(t,e){let a={type:e.value,vertices:[]};for(e=t.next();!t.isEOF()&&e.code!==0;){switch(e.code){case 10:a.vertices.unshift(r(t));break;case 11:a.vertices.push(r(t));break;case 210:a.extrusionDirection=r(t);break;case 100:break;default:d(a,e,t);break}e=t.next()}return a}};var V=class{constructor(){this.ForEntityName="LWPOLYLINE"}parseEntity(t,e){let a={type:e.value,vertices:[]},u=0;for(e=t.next();!t.isEOF()&&e.code!==0;){switch(e.code){case 38:a.elevation=e.value;break;case 39:a.depth=e.value;break;case 70:a.shape=(e.value&1)===1,a.hasContinuousLinetypePattern=(e.value&128)===128;break;case 90:u=e.value;break;case 10:a.vertices=ye(u,t);break;case 43:e.value!==0&&(a.width=e.value);break;case 210:a.extrusionDirectionX=e.value;break;case 220:a.extrusionDirectionY=e.value;break;case 230:a.extrusionDirectionZ=e.value;break;default:d(a,e,t);break}e=t.next()}return a}};function ye(s,t){if(!s||s<=0)throw Error("n must be greater than 0 verticies");let e=[],a=!1,u=!1,n=t.lastReadGroup;for(let x=0;x<s;x++){let i={};for(;!t.isEOF()&&!(n.code===0||u);){switch(n.code){case 10:if(a){u=!0;continue}i.x=n.value,a=!0;break;case 20:i.y=n.value;break;case 30:i.z=n.value;break;case 40:i.startWidth=n.value;break;case 41:i.endWidth=n.value;break;case 42:n.value!=0&&(i.bulge=n.value);break;default:return t.rewind(),a&&e.push(i),t.rewind(),e}n=t.next()}e.push(i),a=!1,u=!1}return t.rewind(),e}var M=class{constructor(){this.ForEntityName="MTEXT"}parseEntity(t,e){let a={type:e.value};for(e=t.next();!t.isEOF()&&e.code!==0;){switch(e.code){case 3:a.text?a.text+=e.value:a.text=e.value;break;case 1:a.text?a.text+=e.value:a.text=e.value;break;case 10:a.position=r(t);break;case 11:a.directionVector=r(t);break;case 40:a.height=e.value;break;case 41:a.width=e.value;break;case 50:a.rotation=e.value;break;case 71:a.attachmentPoint=e.value;break;case 72:a.drawingDirection=e.value;break;default:d(a,e,t);break}e=t.next()}return a}};var B=class{constructor(){this.ForEntityName="POINT"}parseEntity(t,e){let u={type:e.value};for(e=t.next();!t.isEOF()&&e.code!==0;){switch(e.code){case 10:u.position=r(t);break;case 39:u.thickness=e.value;break;case 210:u.extrusionDirection=r(t);break;case 100:break;default:d(u,e,t);break}e=t.next()}return u}};var U=class{constructor(){this.ForEntityName="VERTEX"}parseEntity(t,e){var a={type:e.value};for(e=t.next();!t.isEOF()&&e.code!==0;){switch(e.code){case 10:a.x=e.value;break;case 20:a.y=e.value;break;case 30:a.z=e.value;break;case 40:break;case 41:break;case 42:e.value!=0&&(a.bulge=e.value);break;case 70:a.curveFittingVertex=(e.value&1)!==0,a.curveFitTangent=(e.value&2)!==0,a.splineVertex=(e.value&8)!==0,a.splineControlPoint=(e.value&16)!==0,a.threeDPolylineVertex=(e.value&32)!==0,a.threeDPolylineMesh=(e.value&64)!==0,a.polyfaceMeshVertex=(e.value&128)!==0;break;case 50:break;case 71:a.faceA=e.value;break;case 72:a.faceB=e.value;break;case 73:a.faceC=e.value;break;case 74:a.faceD=e.value;break;default:d(a,e,t);break}e=t.next()}return a}};var Y=class{constructor(){this.ForEntityName="POLYLINE"}parseEntity(t,e){var a={type:e.value,vertices:[]};for(e=t.next();!t.isEOF()&&e.code!==0;){switch(e.code){case 10:break;case 20:break;case 30:break;case 39:a.thickness=e.value;break;case 40:break;case 41:break;case 70:a.shape=(e.value&1)!==0,a.includesCurveFitVertices=(e.value&2)!==0,a.includesSplineFitVertices=(e.value&4)!==0,a.is3dPolyline=(e.value&8)!==0,a.is3dPolygonMesh=(e.value&16)!==0,a.is3dPolygonMeshClosed=(e.value&32)!==0,a.isPolyfaceMesh=(e.value&64)!==0,a.hasContinuousLinetypePattern=(e.value&128)!==0;break;case 71:break;case 72:break;case 73:break;case 74:break;case 75:break;case 210:a.extrusionDirection=r(t);break;default:d(a,e,t);break}e=t.next()}return a.vertices=me(t,e),a}};function me(s,t){let e=new U,a=[];for(;!s.isEOF();)if(t.code===0){if(t.value==="VERTEX")a.push(e.parseEntity(s,t)),t=s.lastReadGroup;else if(t.value==="SEQEND"){Ee(s,t);break}}return a}function Ee(s,t){let e={type:t.value};for(t=s.next();!s.isEOF()&&t.code!=0;)d(e,t,s),t=s.next();return e}var z=class{constructor(){this.ForEntityName="SOLID"}parseEntity(t,e){let a={type:e.value,points:[]};for(e=t.next();!t.isEOF()&&e.code!==0;){switch(e.code){case 10:a.points[0]=r(t);break;case 11:a.points[1]=r(t);break;case 12:a.points[2]=r(t);break;case 13:a.points[3]=r(t);break;case 210:a.extrusionDirection=r(t);break;default:d(a,e,t);break}e=t.next()}return a}};var G=class{constructor(){this.ForEntityName="SPLINE"}parseEntity(t,e){let a={type:e.value};for(e=t.next();!t.isEOF()&&e.code!==0;){switch(e.code){case 10:a.controlPoints||(a.controlPoints=[]),a.controlPoints.push(r(t));break;case 11:a.fitPoints||(a.fitPoints=[]),a.fitPoints.push(r(t));break;case 12:a.startTangent=r(t);break;case 13:a.endTangent=r(t);break;case 40:a.knotValues||(a.knotValues=[]),a.knotValues.push(e.value);break;case 70:e.value&1&&(a.closed=!0),e.value&2&&(a.periodic=!0),e.value&4&&(a.rational=!0),e.value&8&&(a.planar=!0),e.value&16&&(a.planar=!0,a.linear=!0);break;case 71:a.degreeOfSplineCurve=e.value;break;case 72:a.numberOfKnots=e.value;break;case 73:a.numberOfControlPoints=e.value;break;case 74:a.numberOfFitPoints=e.value;break;case 210:a.normalVector=r(t);break;default:d(a,e,t);break}e=t.next()}return a}};var X=class{constructor(){this.ForEntityName="TEXT"}parseEntity(t,e){let a={type:e.value};for(e=t.next();!t.isEOF()&&e.code!==0;){switch(e.code){case 10:a.startPoint=r(t);break;case 11:a.endPoint=r(t);break;case 40:a.textHeight=e.value;break;case 41:a.xScale=e.value;break;case 50:a.rotation=e.value;break;case 1:a.text=e.value;break;case 72:a.halign=e.value;break;case 73:a.valign=e.value;break;default:d(a,e,t);break}e=t.next()}return a}};var f=ve(ne());f.default.setLevel("error");function we(s){s.registerEntityHandler(N),s.registerEntityHandler(D),s.registerEntityHandler(S),s.registerEntityHandler(A),s.registerEntityHandler(I),s.registerEntityHandler(R),s.registerEntityHandler(_),s.registerEntityHandler(H),s.registerEntityHandler(V),s.registerEntityHandler(M),s.registerEntityHandler(B),s.registerEntityHandler(Y),s.registerEntityHandler(z),s.registerEntityHandler(G),s.registerEntityHandler(X)}var C=class{constructor(){this._entityHandlers={},we(this)}parse(t){return typeof t=="string"?this._parse(t):(console.error("Cannot read dxf source of type `"+typeof t),null)}registerEntityHandler(t){let e=new t;this._entityHandlers[e.ForEntityName]=e}parseSync(t){return this.parse(t)}parseStream(t){let e="",a=this;return new Promise((u,n)=>{t.on("data",x=>{e+=x}),t.on("end",()=>{try{u(a._parse(e))}catch(x){n(x)}}),t.on("error",x=>{n(x)})})}_parse(t){let e={},a=0,u=t.split(/\r\n|\r|\n/g),n=new O(u);if(!n.hasNext())throw Error("Empty file");let x=this,i;function Q(){for(i=n.next();!n.isEOF();)if(i.code===0&&i.value==="SECTION"){if(i=n.next(),i.code!==2){console.error("Unexpected code %s after 0:SECTION",oe(i)),i=n.next();continue}i.value==="HEADER"?(f.default.debug("> HEADER"),e.header=P(),f.default.debug("<")):i.value==="BLOCKS"?(f.default.debug("> BLOCKS"),e.blocks=$(),f.default.debug("<")):i.value==="ENTITIES"?(f.default.debug("> ENTITIES"),e.entities=w(!1),f.default.debug("<")):i.value==="TABLES"?(f.default.debug("> TABLES"),e.tables=W(),f.default.debug("<")):i.value==="EOF"?f.default.debug("EOF"):f.default.warn("Skipping section '%s'",i.value)}else i=n.next()}function P(){let l=null,o=null,b={};for(i=n.next();;){if(E(i,0,"ENDSEC")){l&&(b[l]=o);break}else i.code===9?(l&&(b[l]=o),l=i.value):i.code===10?o={x:i.value}:i.code===20?o.y=i.value:i.code===30?o.z=i.value:o=i.value;i=n.next()}return i=n.next(),b}function $(){let l={};for(i=n.next();i.value!=="EOF"&&!E(i,0,"ENDSEC");)if(E(i,0,"BLOCK")){f.default.debug("block {");let o=ee();f.default.debug("}"),q(o),o.name?l[o.name]=o:f.default.error('block with handle "'+o.handle+'" is missing a name.')}else F(i),i=n.next();return l}function ee(){let l={};for(i=n.next();i.value!=="EOF";){switch(i.code){case 1:l.xrefPath=i.value,i=n.next();break;case 2:l.name=i.value,i=n.next();break;case 3:l.name2=i.value,i=n.next();break;case 5:l.handle=i.value,i=n.next();break;case 8:l.layer=i.value,i=n.next();break;case 10:l.position=v(i),i=n.next();break;case 67:l.paperSpace=!!(i.value&&i.value==1),i=n.next();break;case 70:i.value!=0&&(l.type=i.value),i=n.next();break;case 100:i=n.next();break;case 330:l.ownerHandle=i.value,i=n.next();break;case 0:if(i.value=="ENDBLK")break;l.entities=w(!0);break;default:F(i),i=n.next()}if(E(i,0,"ENDBLK")){i=n.next();break}}return l}function W(){let l={};for(i=n.next();i.value!=="EOF"&&!E(i,0,"ENDSEC");)E(i,0,"TABLE")?(i=n.next(),L[i.value]?(f.default.debug(i.value+" Table {"),l[L[i.value].tableName]=h(i),f.default.debug("}")):f.default.debug("Unhandled Table "+i.value)):i=n.next();return i=n.next(),l}let K="ENDTAB";function h(l){let o=L[l.value],b={},m=0;for(i=n.next();!E(i,0,K);)switch(i.code){case 5:b.handle=i.value,i=n.next();break;case 330:b.ownerHandle=i.value,i=n.next();break;case 100:i.value==="AcDbSymbolTable"||F(i),i=n.next();break;case 70:m=i.value,i=n.next();break;case 0:i.value===o.dxfSymbolName?b[o.tableRecordsProperty]=o.parseTableRecords():(F(i),i=n.next());break;default:F(i),i=n.next()}let c=b[o.tableRecordsProperty];if(c){let k=(()=>{if(c.constructor===Array)return c.length;if(typeof c=="object")return Object.keys(c).length})();m!==k&&f.default.warn("Parsed "+k+" "+o.dxfSymbolName+"'s but expected "+m)}return i=n.next(),b}function g(){let l=[],o={};for(f.default.debug("ViewPort {"),i=n.next();!E(i,0,K);)switch(i.code){case 2:o.name=i.value,i=n.next();break;case 10:o.lowerLeftCorner=v(i),i=n.next();break;case 11:o.upperRightCorner=v(i),i=n.next();break;case 12:o.center=v(i),i=n.next();break;case 13:o.snapBasePoint=v(i),i=n.next();break;case 14:o.snapSpacing=v(i),i=n.next();break;case 15:o.gridSpacing=v(i),i=n.next();break;case 16:o.viewDirectionFromTarget=v(i),i=n.next();break;case 17:o.viewTarget=v(i),i=n.next();break;case 42:o.lensLength=i.value,i=n.next();break;case 43:o.frontClippingPlane=i.value,i=n.next();break;case 44:o.backClippingPlane=i.value,i=n.next();break;case 45:o.viewHeight=i.value,i=n.next();break;case 50:o.snapRotationAngle=i.value,i=n.next();break;case 51:o.viewTwistAngle=i.value,i=n.next();break;case 79:o.orthographicType=i.value,i=n.next();break;case 110:o.ucsOrigin=v(i),i=n.next();break;case 111:o.ucsXAxis=v(i),i=n.next();break;case 112:o.ucsYAxis=v(i),i=n.next();break;case 110:o.ucsOrigin=v(i),i=n.next();break;case 281:o.renderMode=i.value,i=n.next();break;case 281:o.defaultLightingType=i.value,i=n.next();break;case 292:o.defaultLightingOn=i.value,i=n.next();break;case 330:o.ownerHandle=i.value,i=n.next();break;case 63:case 421:case 431:o.ambientColor=i.value,i=n.next();break;case 0:i.value==="VPORT"&&(f.default.debug("}"),l.push(o),f.default.debug("ViewPort {"),o={},i=n.next());break;default:F(i),i=n.next();break}return f.default.debug("}"),l.push(o),l}function p(){let l={},o={},b=0,m;for(f.default.debug("LType {"),i=n.next();!E(i,0,"ENDTAB");)switch(i.code){case 2:o.name=i.value,m=i.value,i=n.next();break;case 3:o.description=i.value,i=n.next();break;case 73:b=i.value,b>0&&(o.pattern=[]),i=n.next();break;case 40:o.patternLength=i.value,i=n.next();break;case 49:o.pattern.push(i.value),i=n.next();break;case 0:f.default.debug("}"),b>0&&b!==o.pattern.length&&f.default.warn("lengths do not match on LTYPE pattern"),l[m]=o,o={},f.default.debug("LType {"),i=n.next();break;default:i=n.next()}return f.default.debug("}"),l[m]=o,l}function T(){let l={},o={},b;for(f.default.debug("Layer {"),i=n.next();!E(i,0,"ENDTAB");)switch(i.code){case 2:o.name=i.value,b=i.value,i=n.next();break;case 62:o.visible=i.value>=0,o.colorIndex=Math.abs(i.value),o.color=Pe(o.colorIndex),i=n.next();break;case 70:o.frozen=(i.value&1)!=0||(i.value&2)!=0,i=n.next();break;case 0:i.value==="LAYER"&&(f.default.debug("}"),l[b]=o,f.default.debug("Layer {"),o={},b=void 0,i=n.next());break;default:F(i),i=n.next();break}return f.default.debug("}"),l[b]=o,l}let L={VPORT:{tableRecordsProperty:"viewPorts",tableName:"viewPort",dxfSymbolName:"VPORT",parseTableRecords:g},LTYPE:{tableRecordsProperty:"lineTypes",tableName:"lineType",dxfSymbolName:"LTYPE",parseTableRecords:p},LAYER:{tableRecordsProperty:"layers",tableName:"layer",dxfSymbolName:"LAYER",parseTableRecords:T}};function w(l){let o=[],b=l?"ENDBLK":"ENDSEC";for(l||(i=n.next());;)if(i.code===0){if(i.value===b)break;let m=x._entityHandlers[i.value];if(m!=null){f.default.debug(i.value+" {");let c=m.parseEntity(n,i);i=n.lastReadGroup,f.default.debug("}"),q(c),o.push(c)}else{f.default.warn("Unhandled entity "+i.value),i=n.next();continue}}else i=n.next();return b=="ENDSEC"&&(i=n.next()),o}function v(l){let o={},b=l.code;if(o.x=l.value,b+=10,l=n.next(),l.code!=b)throw new Error("Expected code for point value to be "+b+" but got "+l.code+".");return o.y=l.value,b+=10,l=n.next(),l.code!=b?(n.rewind(),o):(o.z=l.value,o)}function q(l){if(!l)throw new TypeError("entity cannot be undefined or null");l.handle||(l.handle=a++)}return Q(),e}};function E(s,t,e){return s.code===t&&s.value===e}function F(s){f.default.debug("unhandled group "+oe(s))}function oe(s){return s.code+":"+s.value}function Pe(s){return Z[s]}var le=C;addEventListener("message",({data:s})=>{let t=new le;try{let e=t.parseSync(s);postMessage(e)}catch(e){postMessage({error:e})}});
