import{a as eA,b as tA,c as iA,d as rA,e as sA,f as za}from"./chunk-75HSGEFW.js";import{a as FE,b as OE,c as NE,d as Na,e as Eo}from"./chunk-OH7ISQS6.js";import{$ as KE,A as XE,B as Kl,C as Ss,D as Ax,E as ZE,F as d1,G as Mu,H as u1,I as $E,J as zh,K as D5,L as YE,M as z2,N as L5,O as p1,P as Bh,Q as F5,R as JE,S as Oa,T as C0,U as B2,V as O5,W as f1,X as sl,Y as Uh,Z as N5,_ as z5,a as zE,aa as Vh,b as BE,ba as Gh,c as Lh,ca as Vc,d as Fh,da as QE,e as Oh,ea as Hh,f as Qo,fa as ho,g as c1,ga as Gc,h as Ex,ha as U2,i as C5,j as N2,k as Nh,l as A0,m as Tu,n as Fa,na as nA,o as I5,oa as jh,p as UE,pa as Hc,q as VE,r as GE,s as P5,t as R5,u as k5,v as HE,va as B5,w as jE,wa as oA,x as WE,y as h1,z as qE}from"./chunk-RD7FKTWQ.js";import{$ as Ra,$a as v5,$b as zn,A as gx,Ab as wu,Ac as RE,B as rE,Ba as I2,Bc as O2,C as bu,Ca as Dh,Cb as ka,Cc as kE,Da as Jo,Db as P2,Dc as DE,E as f5,Eb as Ko,Ec as Su,F as sE,Fb as Js,G as oE,Gb as Ks,H as rl,Hb as xt,Hc as Mx,I as go,Ia as yo,Ib as It,Ic as E5,Jb as Ln,Jc as Ds,K as a1,Kb as R2,L as l1,Lb as k2,Lc as A5,Mc as _r,N as _x,Nb as vr,O as No,Ob as wE,P as aE,Pb as SE,Q as m5,Qb as TE,Qc as LE,R as g5,Rb as zi,S as kh,Sb as ME,T as yx,Tb as di,U as lE,Ub as ks,Uc,V as cE,Va as fE,Vb as Pr,Vc as Da,Wa as mE,Wb as D2,Xa as gE,Xb as ha,Xc as to,Y as hE,Ya as _E,Yb as zs,Yc as da,Z as Yo,Za as xx,Zb as Br,_ as la,_a as Ir,_b as Nn,_c as La,a as Ti,ab as x5,ac as T5,b as Ns,ba as _o,bb as Yl,bc as Bi,c as QM,ca as zo,cb as yE,cc as Or,d as o1,da as A2,dc as xs,e as UN,ea as jr,ec as EE,f as T2,fa as hs,fb as Ct,fc as Qs,g as yr,ga as dE,gb as Et,gc as Yi,h as ws,ha as vx,hb as b5,i as lo,ia as Sn,ib as ts,ic as AE,j as eE,ja as Sr,jb as wl,jc as CE,k as M2,ka as ai,kb as mn,kc as L2,l as fx,lb as Ur,lc as F2,m as mx,ma as wn,mb as vE,n as fn,na as $i,nb as co,nc as IE,o as tl,oa as ds,ob as Es,oc as M5,pa as lr,pb as Jl,pc as wx,q as tE,qa as Ms,qb as xE,qc as Sx,r as $l,ra as Pn,rb as bx,rc as Tx,s as il,sa as Rn,sb as bE,t as Xn,ta as _5,tb as ln,tc as Wr,u as E2,ub as w5,uc as vo,v as iE,va as Bc,vb as S5,vc as PE,w as nE,wa as C2,wb as vs,x as ys,xa as uE,xb as si,y as p5,ya as pE,yb as ca,z as nl,za as y5,zb as Fr,zc as eo}from"./chunk-NV65B5NU.js";var tI=o1((U8,V8)=>{"use strict";(function(o,e){typeof U8=="object"&&typeof V8<"u"?V8.exports=e():typeof define=="function"&&define.amd?define(e):(o=typeof globalThis<"u"?globalThis:o||self,o.mapboxgl=e())})(U8,function(){"use strict";var o,e,t;function s(i,f){if(!o)o=f;else if(!e)e=f;else{var v="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+o+")(sharedChunk); ("+e+")(sharedChunk); self.onerror = null;",x={};o(x),t=f(x),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(t.workerUrl=window.URL.createObjectURL(new Blob([v],{type:"text/javascript"})))}}s(["exports"],function(i){"use strict";var f="3.3.0";let v,x={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(v==null){let r=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{v=process.env.API_URL_REGEX!=null?new RegExp(process.env.API_URL_REGEX):r}catch{v=r}}return v},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!x.API_URL)return null;try{let r=new URL(x.API_URL);return r.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":r.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"};function M(r){return x.API_URL_REGEX.test(r)}function C(r){return r.indexOf("mapbox:")===0}function D(r){return x.API_CDN_URL_REGEX.test(r)}function L(r){return x.API_SPRITE_REGEX.test(r)}function N(r){return x.API_STYLE_REGEX.test(r)&&!L(r)}let j={create:"create",load:"load",fullLoad:"fullLoad"};function Z(r){let n=r.name.split("?")[0];return D(n)&&n.includes("mapbox-gl.js")?"javascript":D(n)&&n.includes("mapbox-gl.css")?"css":function(l){return x.API_FONTS_REGEX.test(l)}(n)?"fontRange":L(n)?"sprite":N(n)?"style":function(l){return x.API_TILEJSON_REGEX.test(l)}(n)?"tilejson":"other"}function G(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var H=me;function me(r,n,l,d){this.cx=3*r,this.bx=3*(l-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(d-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=n,this.p2x=l,this.p2y=d}me.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,n){if(n===void 0&&(n=1e-6),r<0)return 0;if(r>1)return 1;for(var l=r,d=0;d<8;d++){var p=this.sampleCurveX(l)-r;if(Math.abs(p)<n)return l;var m=this.sampleCurveDerivativeX(l);if(Math.abs(m)<1e-6)break;l-=p/m}var y=0,w=1;for(l=r,d=0;d<20&&(p=this.sampleCurveX(l),!(Math.abs(p-r)<n));d++)r>p?y=l:w=l,l=.5*(w-y)+y;return l},solve:function(r,n){return this.sampleCurveY(this.solveCurveX(r,n))}};var ne=G(H),fe=Ee;function Ee(r,n){this.x=r,this.y=n}Ee.prototype={clone:function(){return new Ee(this.x,this.y)},add:function(r){return this.clone()._add(r)},sub:function(r){return this.clone()._sub(r)},multByPoint:function(r){return this.clone()._multByPoint(r)},divByPoint:function(r){return this.clone()._divByPoint(r)},mult:function(r){return this.clone()._mult(r)},div:function(r){return this.clone()._div(r)},rotate:function(r){return this.clone()._rotate(r)},rotateAround:function(r,n){return this.clone()._rotateAround(r,n)},matMult:function(r){return this.clone()._matMult(r)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(r){return this.x===r.x&&this.y===r.y},dist:function(r){return Math.sqrt(this.distSqr(r))},distSqr:function(r){var n=r.x-this.x,l=r.y-this.y;return n*n+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith:function(r){return this.angleWithSep(r.x,r.y)},angleWithSep:function(r,n){return Math.atan2(this.x*n-this.y*r,this.x*r+this.y*n)},_matMult:function(r){var n=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=n,this},_add:function(r){return this.x+=r.x,this.y+=r.y,this},_sub:function(r){return this.x-=r.x,this.y-=r.y,this},_mult:function(r){return this.x*=r,this.y*=r,this},_div:function(r){return this.x/=r,this.y/=r,this},_multByPoint:function(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint:function(r){return this.x/=r.x,this.y/=r.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var r=this.y;return this.y=this.x,this.x=-r,this},_rotate:function(r){var n=Math.cos(r),l=Math.sin(r),d=l*this.x+n*this.y;return this.x=n*this.x-l*this.y,this.y=d,this},_rotateAround:function(r,n){var l=Math.cos(r),d=Math.sin(r),p=n.y+d*(this.x-n.x)+l*(this.y-n.y);return this.x=n.x+l*(this.x-n.x)-d*(this.y-n.y),this.y=p,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ee.convert=function(r){return r instanceof Ee?r:Array.isArray(r)?new Ee(r[0],r[1]):r};var de=G(fe);let we=Math.PI/180,Le=180/Math.PI;function De(r){return r*we}function se(r){return r*Le}let Ce=[[0,0],[1,0],[1,1],[0,1]];function Ne(r){if(r<=0)return 0;if(r>=1)return 1;let n=r*r,l=n*r;return 4*(r<.5?l:3*(r-n)+l-.75)}function zt(r,n,l,d){let p=new ne(r,n,l,d);return function(m){return p.solve(m)}}let Ge=zt(.25,.1,.25,1);function Xe(r,n,l){return Math.min(l,Math.max(n,r))}function ht(r,n,l){return(l=Xe((l-r)/(n-r),0,1))*l*(3-2*l)}function Ot(r,n,l){let d=l-n,p=((r-n)%d+d)%d+n;return p===n?l:p}function bt(r,n,l){if(!r.length)return l(null,[]);let d=r.length,p=new Array(r.length),m=null;r.forEach((y,w)=>{n(y,(T,E)=>{T&&(m=T),p[w]=E,--d==0&&l(m,p)})})}function Tt(r,...n){for(let l of n)for(let d in l)r[d]=l[d];return r}let Nt=1;function Bt(){return Nt++}function Yt(){return function r(n){return n?(n^Math.random()*(16>>n/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,r)}()}function Wi(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))}function wt(r){return!!r&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(r)}function ei(r,n){r.forEach(l=>{n[l]&&(n[l]=n[l].bind(n))})}function vi(r,n){return r.indexOf(n,r.length-n.length)!==-1}function Pi(r,n,l){let d={};for(let p in r)d[p]=n.call(l||this,r[p],p,r);return d}function Fi(r,n,l){let d={};for(let p in r)n.call(l||this,r[p],p,r)&&(d[p]=r[p]);return d}function Ri(r){return Array.isArray(r)?r.map(Ri):typeof r=="object"&&r?Pi(r,Ri):r}let br={};function Ui(r){br[r]||(typeof console<"u"&&console.warn(r),br[r]=!0)}function st(r,n,l){return(l.y-r.y)*(n.x-r.x)>(n.y-r.y)*(l.x-r.x)}function $r(r){let n=0;for(let l,d,p=0,m=r.length,y=m-1;p<m;y=p++)l=r[p],d=r[y],n+=(d.x-l.x)*(l.y+d.y);return n}function Ki([r,n,l]){let d=De(n+90),p=De(l);return{x:r*Math.cos(d)*Math.sin(p),y:r*Math.sin(d)*Math.sin(p),z:r*Math.cos(p),azimuthal:n,polar:l}}function yn(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Qi(r){let n={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,d,p,m)=>{let y=p||m;return n[d]=!y||y.toLowerCase(),""}),n["max-age"]){let l=parseInt(n["max-age"],10);isNaN(l)?delete n["max-age"]:n["max-age"]=l}return n}let Gn,Fn,Ie,be,_t,li,ze=null;function te(r){try{let n=self[r];return n.setItem("_mapbox_test_",1),n.removeItem("_mapbox_test_"),!0}catch{return!1}}function he(r,n){return[r[4*n],r[4*n+1],r[4*n+2],r[4*n+3]]}function Se(r,n,l,d){for(;n<l;){let p=n+l>>1;r[p]<d?n=p+1:l=p}return n}function He(r,n,l,d){for(;n<l;){let p=n+l>>1;r[p]<=d?n=p+1:l=p}return n}function Ye(){return Gn==null&&(Gn=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Gn}let at={now:()=>be!==void 0?be:performance.now(),setNow(r){be=r},restoreNow(){be=void 0},frame(r){let n=requestAnimationFrame(r);return{cancel:()=>cancelAnimationFrame(n)}},getImageData(r,n=0){let{width:l,height:d}=r;_t||(_t=document.createElement("canvas"));let p=_t.getContext("2d",{willReadFrequently:!0});if(!p)throw new Error("failed to create canvas 2d context");return(l>_t.width||d>_t.height)&&(_t.width=l,_t.height=d),p.clearRect(-n,-n,l+2*n,d+2*n),p.drawImage(r,0,0,l,d),p.getImageData(-n,-n,l+2*n,d+2*n)},resolveURL:r=>(Fn||(Fn=document.createElement("a")),Fn.href=r,Fn.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Ie==null&&(Ie=window.matchMedia("(prefers-reduced-motion: reduce)")),Ie.matches)},hasCanvasFingerprintNoise(){if(li!==void 0)return li;if(!Ye())return li=!1,!1;let r=new OffscreenCanvas(85,1),n=r.getContext("2d",{willReadFrequently:!0}),l=0;for(let p=0;p<r.width;++p)n.fillStyle=`rgba(${l++},${l++},${l++}, 255)`,n.fillRect(p,0,1,1);let d=n.getImageData(0,0,r.width,r.height);l=0;for(let p=0;p<d.data.length;++p)if(p%4!=3&&l++!==d.data[p])return li=!0,!0;return li=!1,!1}},ye="mapbox-tiles",Ve=500,pt=50,ut,St;function Vt(){try{return caches}catch{}}function Mi(){let r=Vt();r&&!ut&&(ut=r.open(ye))}function en(r){let n=r.indexOf("?");if(n<0)return r;let l=["language","worldview"],d=new URLSearchParams,p=new URLSearchParams(r.slice(n));for(let m of l){let y=p.get(m);y&&d.set(m,y)}return`${r.slice(0,n)}?${d.toString()}`}function Oi(r,n){let l=r.indexOf("?");if(l<0)return`${r}?${new URLSearchParams(n).toString()}`;let d=new URLSearchParams(r.slice(l));for(let p in n)d.set(p,n[p]);return`${r.slice(0,l)}?${d.toString()}`}let yi=1/0,Vi={supported:!1,testSupport:function(r){!ni&&Zt&&(gi?$n(r):Pe=r)}},Pe,Zt,ni=!1,gi=!1,qi=typeof self<"u"?self:{};function $n(r){let n=r.createTexture();r.bindTexture(r.TEXTURE_2D,n);try{if(r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,Zt),r.isContextLost())return;Vi.supported=!0}catch{}r.deleteTexture(n),ni=!0}qi.document&&(Zt=qi.document.createElement("img"),Zt.onload=function(){Pe&&$n(Pe),Pe=null,gi=!0},Zt.onerror=function(){ni=!0,Pe=null},Zt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");let fr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(fr);class mr extends Error{constructor(n,l,d){l===401&&M(d)&&(n+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(n),this.status=l,this.url=d}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}let Mr=yn()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,et=function(r,n){if(!(/^file:/.test(l=r.url)||/^file:/.test(Mr())&&!/^\w+:/.test(l))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(d,p){let m=new AbortController,y=new Request(d.url,{method:d.method||"GET",body:d.body,credentials:d.credentials,headers:d.headers,referrer:Mr(),referrerPolicy:d.referrerPolicy,signal:m.signal}),w=!1,T=!1,E=(I=y.url).indexOf("sku=")>0&&M(I);var I;d.type==="json"&&y.headers.set("Accept","application/json");let R=(B,V,W)=>{if(T)return;if(B&&B.message!=="SecurityError"&&Ui(B.toString()),V&&W)return F(V);let $=Date.now();fetch(y).then(J=>{if(J.ok){let le=E?J.clone():null;return F(J,le,$)}return p(new mr(J.statusText,J.status,d.url))}).catch(J=>{J.name!=="AbortError"&&p(new Error(`${J.message} ${d.url}`))})},F=(B,V,W)=>{(d.type==="arrayBuffer"?B.arrayBuffer():d.type==="json"?B.json():B.text()).then($=>{T||(V&&W&&function(J,le,pe){if(Mi(),!ut)return;let ue=Qi(le.headers.get("Cache-Control")||"");if(ue["no-store"])return;let Me={status:le.status,statusText:le.statusText,headers:new Headers};le.headers.forEach((Be,We)=>Me.headers.set(We,Be)),ue["max-age"]&&Me.headers.set("Expires",new Date(pe+1e3*ue["max-age"]).toUTCString());let xe=Me.headers.get("Expires");if(!xe||new Date(xe).getTime()-pe<42e4)return;let ke=en(J.url);if(le.status===206){let Be=J.headers.get("Range");if(!Be)return;Me.status=200,ke=Oi(ke,{range:Be})}(function(Be,We){if(St===void 0)try{new Response(new ReadableStream),St=!0}catch{St=!1}St?We(Be.body):Be.blob().then(We)})(le,Be=>{let We=new Response(Be,Me);Mi(),ut&&ut.then(Ke=>Ke.put(ke,We)).catch(Ke=>Ui(Ke.message))})}(y,V,W),w=!0,p(null,$,B.headers.get("Cache-Control"),B.headers.get("Expires")))}).catch($=>{T||p(new Error($.message))})};return E?function(B,V){if(Mi(),!ut)return V(null);ut.then(W=>{let $=en(B.url),J=B.headers.get("Range");J&&($=Oi($,{range:J})),W.match($).then(le=>{let pe=function(ue){if(!ue)return!1;let Me=new Date(ue.headers.get("Expires")||0),xe=Qi(ue.headers.get("Cache-Control")||"");return Me>Date.now()&&!xe["no-cache"]}(le);W.delete($),pe&&W.put($,le.clone()),V(null,le,pe)}).catch(V)}).catch(V)}(y,R):R(null,null),{cancel:()=>{T=!0,w||m.abort()}}}(r,n);if(yn()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",r,n,void 0,!0)}var l;return function(d,p){let m=new XMLHttpRequest;m.open(d.method||"GET",d.url,!0),d.type==="arrayBuffer"&&(m.responseType="arraybuffer");for(let y in d.headers)m.setRequestHeader(y,d.headers[y]);return d.type==="json"&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials=d.credentials==="include",m.onerror=()=>{p(new Error(m.statusText))},m.onload=()=>{if((m.status>=200&&m.status<300||m.status===0)&&m.response!==null){let y=m.response;if(d.type==="json")try{y=JSON.parse(m.response)}catch(w){return p(w)}p(null,y,m.getResponseHeader("Cache-Control"),m.getResponseHeader("Expires"))}else p(new mr(m.statusText,m.status,d.url))},m.send(d.body),{cancel:()=>m.abort()}}(r,n)},lt=function(r,n){return et(Tt(r,{type:"arrayBuffer"}),n)};function kt(r){let n=document.createElement("a");return n.href=r,n.protocol===location.protocol&&n.host===location.host}let Wt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",Ht,Jt;Ht=[],Jt=0;let Kt=function(r,n){if(Vi.supported&&(r.headers||(r.headers={}),r.headers.accept="image/webp,*/*"),Jt>=x.MAX_PARALLEL_IMAGE_REQUESTS){let m={requestParameters:r,callback:n,cancelled:!1,cancel(){this.cancelled=!0}};return Ht.push(m),m}Jt++;let l=!1,d=()=>{if(!l)for(l=!0,Jt--;Ht.length&&Jt<x.MAX_PARALLEL_IMAGE_REQUESTS;){let m=Ht.shift(),{requestParameters:y,callback:w,cancelled:T}=m;T||(m.cancel=Kt(y,w).cancel)}},p=lt(r,(m,y,w,T)=>{d(),m?n(m):y&&(self.createImageBitmap?function(E,I){let R=new Blob([new Uint8Array(E)],{type:"image/png"});createImageBitmap(R).then(F=>{I(null,F)}).catch(F=>{I(new Error(`Could not load image because of ${F.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(y,(E,I)=>n(E,I,w,T)):function(E,I){let R=new Image;R.onload=()=>{I(null,R),URL.revokeObjectURL(R.src),R.onload=null,requestAnimationFrame(()=>{R.src=Wt})},R.onerror=()=>I(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let F=new Blob([new Uint8Array(E)],{type:"image/png"});R.src=E.byteLength?URL.createObjectURL(F):Wt}(y,(E,I)=>n(E,I,w,T)))});return{cancel:()=>{p.cancel(),d()}}},Gt="01",ri="NO_ACCESS_TOKEN",$t=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Gi(r){let n=r.match($t);if(!n)throw new Error("Unable to parse URL object");return{protocol:n[1],authority:n[2],path:n[3]||"/",params:n[4]?n[4].split("&"):[]}}function kn(r){let n=r.params.length?`?${r.params.join("&")}`:"";return`${r.protocol}://${r.authority}${r.path}${n}`}let bi="mapbox.eventData";function Te(r){if(!r)return null;let n=r.split(".");if(!n||n.length!==3)return null;try{return JSON.parse(decodeURIComponent(atob(n[1]).split("").map(l=>"%"+("00"+l.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Qe{constructor(n){this.type=n,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(n){let l=Te(x.ACCESS_TOKEN),d="";return d=l&&l.u?btoa(encodeURIComponent(l.u).replace(/%([0-9A-F]{2})/g,(p,m)=>String.fromCharCode(+("0x"+m)))):x.ACCESS_TOKEN||"",n?`${bi}.${n}:${d}`:`${bi}:${d}`}fetchEventData(){let n=te("localStorage"),l=this.getStorageKey(),d=this.getStorageKey("uuid");if(n)try{let p=localStorage.getItem(l);p&&(this.eventData=JSON.parse(p));let m=localStorage.getItem(d);m&&(this.anonId=m)}catch{Ui("Unable to read from LocalStorage")}}saveEventData(){let n=te("localStorage"),l=this.getStorageKey(),d=this.getStorageKey("uuid"),p=this.anonId;if(n&&p)try{localStorage.setItem(d,p),Object.keys(this.eventData).length>=1&&localStorage.setItem(l,JSON.stringify(this.eventData))}catch{Ui("Unable to write to LocalStorage")}}processRequests(n){}postEvent(n,l,d,p){if(!x.EVENTS_URL)return;let m=Gi(x.EVENTS_URL);m.params.push(`access_token=${p||x.ACCESS_TOKEN||""}`);let y={event:this.type,created:new Date(n).toISOString()},w=l?Tt(y,l):y,T={url:kn(m),headers:{"Content-Type":"text/plain"},body:JSON.stringify([w])};this.pendingRequest=function(E,I){return et(Tt(E,{method:"POST"}),I)}(T,E=>{this.pendingRequest=null,d(E),this.saveEventData(),this.processRequests(p)})}queueRequest(n,l){this.queue.push(n),this.processRequests(l)}}let ct=new class extends Qe{constructor(r){super("appUserTurnstile"),this._customAccessToken=r}postTurnstileEvent(r,n){x.EVENTS_URL&&x.ACCESS_TOKEN&&Array.isArray(r)&&r.some(l=>C(l)||M(l))&&this.queueRequest(Date.now(),n)}processRequests(r){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();let n=Te(x.ACCESS_TOKEN),l=n?n.u:x.ACCESS_TOKEN,d=l!==this.eventData.tokenU;wt(this.anonId)||(this.anonId=Yt(),d=!0);let p=this.queue.shift();if(this.eventData.lastSuccess){let m=new Date(this.eventData.lastSuccess),y=new Date(p),w=(p-this.eventData.lastSuccess)/864e5;d=d||w>=1||w<-1||m.getDate()!==y.getDate()}else d=!0;d?this.postEvent(p,{sdkIdentifier:"mapbox-gl-js",sdkVersion:f,skuId:Gt,"enabled.telemetry":!1,userId:this.anonId},m=>{m||(this.eventData.lastSuccess=p,this.eventData.tokenU=l)},r):this.processRequests()}},gt=ct.postTurnstileEvent.bind(ct),ft=new class extends Qe{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(r,n,l,d){this.skuToken=n,this.errorCb=d,x.EVENTS_URL&&(l||x.ACCESS_TOKEN?this.queueRequest({id:r,timestamp:Date.now()},l):this.errorCb(new Error(ri)))}processRequests(r){if(this.pendingRequest||this.queue.length===0)return;let{id:n,timestamp:l}=this.queue.shift();n&&this.success[n]||(this.anonId||this.fetchEventData(),wt(this.anonId)||(this.anonId=Yt()),this.postEvent(l,{sdkIdentifier:"mapbox-gl-js",sdkVersion:f,skuId:Gt,skuToken:this.skuToken,userId:this.anonId},d=>{d?this.errorCb(d):n&&(this.success[n]=!0)},r))}remove(){this.errorCb=null}},Qt=ft.postMapLoadEvent.bind(ft),ji=new class extends Qe{constructor(){super("gljs.performance")}postPerformanceEvent(r,n){x.EVENTS_URL&&(r||x.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:n},r)}processRequests(r){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:n,performanceData:l}=this.queue.shift(),d=function(p){let m=performance.getEntriesByType("resource"),y=performance.getEntriesByType("mark"),w=function(B){let V={};if(B){for(let W in B)if(W!=="other")for(let $ of B[W]){let J=`${W}ResolveRangeMin`,le=`${W}ResolveRangeMax`,pe=`${W}RequestCount`,ue=`${W}RequestCachedCount`;V[J]=Math.min(V[J]||1/0,$.startTime),V[le]=Math.max(V[le]||-1/0,$.responseEnd);let Me=xe=>{V[xe]===void 0&&(V[xe]=0),++V[xe]};$.transferSize!==void 0&&$.transferSize===0&&Me(ue),Me(pe)}}return V}(function(B,V){let W={};if(B)for(let $ of B){let J=V($);W[J]===void 0&&(W[J]=[]),W[J].push($)}return W}(m,Z)),T=window.devicePixelRatio,E=navigator.connection||navigator.mozConnection||navigator.webkitConnection,I=E?E.effectiveType:void 0,R={counters:[],metadata:[],attributes:[]},F=(B,V,W)=>{W!=null&&B.push({name:V,value:W.toString()})};for(let B in w)F(R.counters,B,w[B]);if(p.interactionRange[0]!==1/0&&p.interactionRange[1]!==-1/0&&(F(R.counters,"interactionRangeMin",p.interactionRange[0]),F(R.counters,"interactionRangeMax",p.interactionRange[1])),y)for(let B of Object.keys(j)){let V=j[B],W=y.find($=>$.name===V);W&&F(R.counters,V,W.startTime)}return F(R.counters,"visibilityHidden",p.visibilityHidden),F(R.attributes,"style",function(B){if(B)for(let V of B){let W=V.name.split("?")[0];if(N(W)){let $=W.split("/").slice(-2);if($.length===2)return`mapbox://styles/${$[0]}/${$[1]}`}}}(m)),F(R.attributes,"terrainEnabled",p.terrainEnabled?"true":"false"),F(R.attributes,"fogEnabled",p.fogEnabled?"true":"false"),F(R.attributes,"projection",p.projection),F(R.attributes,"zoom",p.zoom),F(R.metadata,"devicePixelRatio",T),F(R.metadata,"connectionEffectiveType",I),F(R.metadata,"navigatorUserAgent",navigator.userAgent),F(R.metadata,"screenWidth",window.screen.width),F(R.metadata,"screenHeight",window.screen.height),F(R.metadata,"windowWidth",window.innerWidth),F(R.metadata,"windowHeight",window.innerHeight),F(R.metadata,"mapWidth",p.width/T),F(R.metadata,"mapHeight",p.height/T),F(R.metadata,"webglRenderer",p.renderer),F(R.metadata,"webglVendor",p.vendor),F(R.metadata,"sdkVersion",f),F(R.metadata,"sdkIdentifier","mapbox-gl-js"),R}(l);for(let p of d.metadata);for(let p of d.counters);for(let p of d.attributes);this.postEvent(n,d,()=>{},r)}},cn=ji.postPerformanceEvent.bind(ji),Ji=new class extends Qe{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(r,n,l,d){if(!x.API_URL||!x.SESSION_PATH)return;let p=Gi(x.API_URL+x.SESSION_PATH);p.params.push(`sku=${n||""}`),p.params.push(`access_token=${d||x.ACCESS_TOKEN||""}`);let m={url:kn(p),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(y,w){return et(Tt(y,{method:"GET"}),w)}(m,y=>{this.pendingRequest=null,l(y),this.saveEventData(),this.processRequests(d)})}getSessionAPI(r,n,l,d){this.skuToken=n,this.errorCb=d,x.SESSION_PATH&&x.API_URL&&(l||x.ACCESS_TOKEN?this.queueRequest({id:r,timestamp:Date.now()},l):this.errorCb(new Error(ri)))}processRequests(r){if(this.pendingRequest||this.queue.length===0)return;let{id:n,timestamp:l}=this.queue.shift();n&&this.success[n]||this.getSession(l,this.skuToken,d=>{d?this.errorCb(d):n&&(this.success[n]=!0)},r)}remove(){this.errorCb=null}},Qn=Ji.getSessionAPI.bind(Ji),Dn=new Set;function Hn(r,n,l){l[r]&&l[r].indexOf(n)!==-1||(l[r]=l[r]||[],l[r].push(n))}function gs(r,n,l){if(l&&l[r]){let d=l[r].indexOf(n);d!==-1&&l[r].splice(d,1)}}class Ls{constructor(n,l={}){Tt(this,l),this.type=n}}class Cs extends Ls{constructor(n,l={}){super("error",Tt({error:n},l))}}class So{on(n,l){return this._listeners=this._listeners||{},Hn(n,l,this._listeners),this}off(n,l){return gs(n,l,this._listeners),gs(n,l,this._oneTimeListeners),this}once(n,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},Hn(n,l,this._oneTimeListeners),this):new Promise(d=>this.once(n,d))}fire(n,l){typeof n=="string"&&(n=new Ls(n,l||{}));let d=n.type;if(this.listens(d)){n.target=this;let p=this._listeners&&this._listeners[d]?this._listeners[d].slice():[];for(let w of p)w.call(this,n);let m=this._oneTimeListeners&&this._oneTimeListeners[d]?this._oneTimeListeners[d].slice():[];for(let w of m)gs(d,w,this._oneTimeListeners),w.call(this,n);let y=this._eventedParent;y&&(Tt(n,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),y.fire(n))}else n instanceof Cs&&console.error(n.error);return this}listens(n){return!!(this._listeners&&this._listeners[n]&&this._listeners[n].length>0||this._oneTimeListeners&&this._oneTimeListeners[n]&&this._oneTimeListeners[n].length>0||this._eventedParent&&this._eventedParent.listens(n))}setEventedParent(n,l){return this._eventedParent=n,this._eventedParentData=l,this}}i.y=void 0;var as={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function or(r){return(r=Math.round(r))<0?0:r>255?255:r}function n0(r){return or(r[r.length-1]==="%"?parseFloat(r)/100*255:parseInt(r))}function rs(r){return(n=r[r.length-1]==="%"?parseFloat(r)/100:parseFloat(r))<0?0:n>1?1:n;var n}function Ga(r,n,l){return l<0?l+=1:l>1&&(l-=1),6*l<1?r+(n-r)*l*6:2*l<1?n:3*l<2?r+(n-r)*(2/3-l)*6:r}try{i.y={}.parseCSSColor=function(r){var n,l=r.replace(/ /g,"").toLowerCase();if(l in as)return as[l].slice();if(l[0]==="#")return l.length===4?(n=parseInt(l.substr(1),16))>=0&&n<=4095?[(3840&n)>>4|(3840&n)>>8,240&n|(240&n)>>4,15&n|(15&n)<<4,1]:null:l.length===7&&(n=parseInt(l.substr(1),16))>=0&&n<=16777215?[(16711680&n)>>16,(65280&n)>>8,255&n,1]:null;var d=l.indexOf("("),p=l.indexOf(")");if(d!==-1&&p+1===l.length){var m=l.substr(0,d),y=l.substr(d+1,p-(d+1)).split(","),w=1;switch(m){case"rgba":if(y.length!==4)return null;w=rs(y.pop());case"rgb":return y.length!==3?null:[n0(y[0]),n0(y[1]),n0(y[2]),w];case"hsla":if(y.length!==4)return null;w=rs(y.pop());case"hsl":if(y.length!==3)return null;var T=(parseFloat(y[0])%360+360)%360/360,E=rs(y[1]),I=rs(y[2]),R=I<=.5?I*(E+1):I+E-I*E,F=2*I-R;return[or(255*Ga(F,R,T+1/3)),or(255*Ga(F,R,T)),or(255*Ga(F,R,T-1/3)),w];default:return null}}return null}}catch{}class fo{constructor(n,l,d,p=1){this.r=n,this.g=l,this.b=d,this.a=p}static parse(n){if(!n)return;if(n instanceof fo)return n;if(typeof n!="string")return;let l=i.y(n);return l?new fo(l[0]/255*l[3],l[1]/255*l[3],l[2]/255*l[3],l[3]):void 0}toString(){let[n,l,d,p]=this.toArray();return`rgba(${Math.round(n)},${Math.round(l)},${Math.round(d)},${p})`}toArray(){let{r:n,g:l,b:d,a:p}=this;return p===0?[0,0,0,0]:[255*n/p,255*l/p,255*d/p,p]}toArray01(){let{r:n,g:l,b:d,a:p}=this;return p===0?[0,0,0,0]:[n/p,l/p,d/p,p]}toArray01Scaled(n){let{r:l,g:d,b:p,a:m}=this;return m===0?[0,0,0]:[l/m*n,d/m*n,p/m*n]}toArray01PremultipliedAlpha(){let{r:n,g:l,b:d,a:p}=this;return[n,l,d,p]}toArray01Linear(){let{r:n,g:l,b:d,a:p}=this;return p===0?[0,0,0,0]:[Math.pow(n/p,2.2),Math.pow(l/p,2.2),Math.pow(d/p,2.2),p]}}fo.black=new fo(0,0,0,1),fo.white=new fo(1,1,1,1),fo.transparent=new fo(0,0,0,0),fo.red=new fo(1,0,0,1),fo.blue=new fo(0,0,1,1);var qr=fo;function Tn(r,n,l){return r*(1-l)+n*l}function Ws(r,n,l){return r.map((d,p)=>Tn(d,n[p],l))}var wa=Object.freeze({__proto__:null,array:Ws,color:function(r,n,l){return new qr(Tn(r.r,n.r,l),Tn(r.g,n.g,l),Tn(r.b,n.b,l),Tn(r.a,n.a,l))},number:Tn});function r0(r,...n){for(let l of n)for(let d in l)r[d]=l[d];return r}class Vo extends Error{constructor(n,l){super(l),this.message=l,this.key=n}}var Go=Vo;class Md{constructor(n,l=[]){this.parent=n,this.bindings={};for(let[d,p]of l)this.bindings[d]=p}concat(n){return new Md(this,n)}get(n){if(this.bindings[n])return this.bindings[n];if(this.parent)return this.parent.get(n);throw new Error(`${n} not found in scope.`)}has(n){return!!this.bindings[n]||!!this.parent&&this.parent.has(n)}}var op=Md;let $0={kind:"null"},ci={kind:"number"},hr={kind:"string"},dr={kind:"boolean"},Sa={kind:"color"},Y0={kind:"object"},Yn={kind:"value"},ap={kind:"collator"},J0={kind:"formatted"},Ed={kind:"resolvedImage"};function Ho(r,n){return{kind:"array",itemType:r,N:n}}function bs(r){if(r.kind==="array"){let n=bs(r.itemType);return typeof r.N=="number"?`array<${n}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${n}>`}return r.kind}let ki=[$0,ci,hr,dr,Sa,J0,Y0,Ho(Yn),Ed];function s0(r,n){if(n.kind==="error")return null;if(r.kind==="array"){if(n.kind==="array"&&(n.N===0&&n.itemType.kind==="value"||!s0(r.itemType,n.itemType))&&(typeof r.N!="number"||r.N===n.N))return null}else{if(r.kind===n.kind)return null;if(r.kind==="value"){for(let l of ki)if(!s0(l,n))return null}}return`Expected ${bs(r)} but found ${bs(n)} instead.`}function tn(r,n){return n.some(l=>l.kind===r.kind)}function gc(r,n){return n.some(l=>l==="null"?r===null:l==="array"?Array.isArray(r):l==="object"?r&&!Array.isArray(r)&&typeof r=="object":l===typeof r)}class Mn{constructor(n,l,d){this.sensitivity=n?l?"variant":"case":l?"accent":"base",this.locale=d,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(n,l){return this.collator.compare(n,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class K0{constructor(n,l,d,p,m){this.text=n.normalize?n.normalize():n,this.image=l,this.scale=d,this.fontStack=p,this.textColor=m}}class ro{constructor(n){this.sections=n}static fromString(n){return new ro([new K0(n,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(n=>n.text.length!==0||n.image&&n.image.namePrimary.length!==0)}static factory(n){return n instanceof ro?n:ro.fromString(n)}toString(){return this.sections.length===0?"":this.sections.map(n=>n.text).join("")}serialize(){let n=["format"];for(let l of this.sections){if(l.image){n.push(["image",l.image.namePrimary]);continue}n.push(l.text);let d={};l.fontStack&&(d["text-font"]=["literal",l.fontStack.split(",")]),l.scale&&(d["font-scale"]=l.scale),l.textColor&&(d["text-color"]=["rgba"].concat(l.textColor.toArray())),n.push(d)}return n}}class Di{constructor(n){this.namePrimary=n.namePrimary,n.nameSecondary&&(this.nameSecondary=n.nameSecondary),this.available=n.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(n,l){return n?new Di({namePrimary:n,nameSecondary:l,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function S_(r,n,l,d){return typeof r=="number"&&r>=0&&r<=255&&typeof n=="number"&&n>=0&&n<=255&&typeof l=="number"&&l>=0&&l<=255?d===void 0||typeof d=="number"&&d>=0&&d<=1?null:`Invalid rgba value [${[r,n,l,d].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof d=="number"?[r,n,l,d]:[r,n,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function o0(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof qr||r instanceof Mn||r instanceof ro||r instanceof Di)return!0;if(Array.isArray(r)){for(let n of r)if(!o0(n))return!1;return!0}if(typeof r=="object"){for(let n in r)if(!o0(r[n]))return!1;return!0}return!1}function Is(r){if(r===null)return $0;if(typeof r=="string")return hr;if(typeof r=="boolean")return dr;if(typeof r=="number")return ci;if(r instanceof qr)return Sa;if(r instanceof Mn)return ap;if(r instanceof ro)return J0;if(r instanceof Di)return Ed;if(Array.isArray(r)){let n=r.length,l;for(let d of r){let p=Is(d);if(l){if(l===p)continue;l=Yn;break}l=p}return Ho(l||Yn,n)}return Y0}function Ta(r){let n=typeof r;return r===null?"":n==="string"||n==="number"||n==="boolean"?String(r):r instanceof qr||r instanceof ro||r instanceof Di?r.toString():JSON.stringify(r)}class _c{constructor(n,l){this.type=n,this.value=l}static parse(n,l){if(n.length!==2)return l.error(`'literal' expression requires exactly one argument, but found ${n.length-1} instead.`);if(!o0(n[1]))return l.error("invalid value");let d=n[1],p=Is(d),m=l.expectedType;return p.kind!=="array"||p.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(p=m),new _c(p,d)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof qr?["rgba"].concat(this.value.toArray()):this.value instanceof ro?this.value.serialize():this.value}}var kl=_c,Ps=class{constructor(r){this.name="ExpressionEvaluationError",this.message=r}toJSON(){return this.message}};let Cf={string:hr,number:ci,boolean:dr,object:Y0};class If{constructor(n,l){this.type=n,this.args=l}static parse(n,l){if(n.length<2)return l.error("Expected at least one argument.");let d,p=1,m=n[0];if(m==="array"){let w,T;if(n.length>2){let E=n[1];if(typeof E!="string"||!(E in Cf)||E==="object")return l.error('The item type argument of "array" must be one of string, number, boolean',1);w=Cf[E],p++}else w=Yn;if(n.length>3){if(n[2]!==null&&(typeof n[2]!="number"||n[2]<0||n[2]!==Math.floor(n[2])))return l.error('The length argument to "array" must be a positive integer literal',2);T=n[2],p++}d=Ho(w,T)}else d=Cf[m];let y=[];for(;p<n.length;p++){let w=l.parse(n[p],p,Yn);if(!w)return null;y.push(w)}return new If(d,y)}evaluate(n){for(let l=0;l<this.args.length;l++){let d=this.args[l].evaluate(n);if(!s0(this.type,Is(d)))return d;if(l===this.args.length-1)throw new Ps(`Expected value to be of type ${bs(this.type)}, but found ${bs(Is(d))} instead.`)}return null}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){let n=this.type,l=[n.kind];if(n.kind==="array"){let d=n.itemType;if(d.kind==="string"||d.kind==="number"||d.kind==="boolean"){l.push(d.kind);let p=n.N;(typeof p=="number"||this.args.length>1)&&l.push(p)}}return l.concat(this.args.map(d=>d.serialize()))}}var Dl=If;class Q0{constructor(n){this.type=J0,this.sections=n}static parse(n,l){if(n.length<2)return l.error("Expected at least one argument.");let d=n[1];if(!Array.isArray(d)&&typeof d=="object")return l.error("First argument must be an image or text section.");let p=[],m=!1;for(let y=1;y<=n.length-1;++y){let w=n[y];if(m&&typeof w=="object"&&!Array.isArray(w)){m=!1;let T=null;if(w["font-scale"]&&(T=l.parse(w["font-scale"],1,ci),!T))return null;let E=null;if(w["text-font"]&&(E=l.parse(w["text-font"],1,Ho(hr)),!E))return null;let I=null;if(w["text-color"]&&(I=l.parse(w["text-color"],1,Sa),!I))return null;let R=p[p.length-1];R.scale=T,R.font=E,R.textColor=I}else{let T=l.parse(n[y],1,Yn);if(!T)return null;let E=T.type.kind;if(E!=="string"&&E!=="value"&&E!=="null"&&E!=="resolvedImage")return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,p.push({content:T,scale:null,font:null,textColor:null})}}return new Q0(p)}evaluate(n){return new ro(this.sections.map(l=>{let d=l.content.evaluate(n);return Is(d)===Ed?new K0("",d,null,null,null):new K0(Ta(d),null,l.scale?l.scale.evaluate(n):null,l.font?l.font.evaluate(n).join(","):null,l.textColor?l.textColor.evaluate(n):null)}))}eachChild(n){for(let l of this.sections)n(l.content),l.scale&&n(l.scale),l.font&&n(l.font),l.textColor&&n(l.textColor)}outputDefined(){return!1}serialize(){let n=["format"];for(let l of this.sections){n.push(l.content.serialize());let d={};l.scale&&(d["font-scale"]=l.scale.serialize()),l.font&&(d["text-font"]=l.font.serialize()),l.textColor&&(d["text-color"]=l.textColor.serialize()),n.push(d)}return n}}class a0{constructor(n,l){this.type=Ed,this.inputPrimary=n,this.inputSecondary=l}static parse(n,l){if(n.length<2)return l.error("Expected two or more arguments.");let d=l.parse(n[1],1,hr);if(!d)return l.error("No image name provided.");if(n.length===2)return new a0(d);let p=l.parse(n[2],1,hr);return p?new a0(d,p):l.error("Secondary image variant is not a string.")}evaluate(n){let l=Di.fromString(this.inputPrimary.evaluate(n),this.inputSecondary?this.inputSecondary.evaluate(n):void 0);return l&&n.availableImages&&(l.available=n.availableImages.indexOf(l.namePrimary)>-1,l.nameSecondary&&l.available&&n.availableImages&&(l.available=n.availableImages.indexOf(l.nameSecondary)>-1)),l}eachChild(n){n(this.inputPrimary),this.inputSecondary&&n(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function eh(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}let Ha={"to-boolean":dr,"to-color":Sa,"to-number":ci,"to-string":hr};class lp{constructor(n,l){this.type=n,this.args=l}static parse(n,l){if(n.length<2)return l.error("Expected at least one argument.");let d=n[0],p=[],m=$0;if(d==="to-array"){if(!Array.isArray(n[1]))return null;let y=n[1].length;if(l.expectedType){if(l.expectedType.kind!=="array")return l.error(`Expected ${l.expectedType.kind} but found array.`);m=Ho(l.expectedType.itemType,y)}else{if(!(y>0&&o0(n[1][0])))return null;m=Ho(Is(n[1][0]),y)}for(let w=0;w<y;w++){let T=n[1][w],E;if(eh(T)==="array")E=l.parse(T,void 0,m.itemType);else{let I=eh(T);if(I!==m.itemType.kind)return l.error(`Expected ${m.itemType.kind} but found ${I}.`);E=l.registry.literal.parse(["literal",T===void 0?null:T],l)}if(!E)return null;p.push(E)}}else{if((d==="to-boolean"||d==="to-string")&&n.length!==2)return l.error("Expected one argument.");m=Ha[d];for(let y=1;y<n.length;y++){let w=l.parse(n[y],y,Yn);if(!w)return null;p.push(w)}}return new lp(m,p)}evaluate(n){if(this.type.kind==="boolean")return!!this.args[0].evaluate(n);if(this.type.kind==="color"){let l,d;for(let p of this.args){if(l=p.evaluate(n),d=null,l instanceof qr)return l;if(typeof l=="string"){let m=n.parseColor(l);if(m)return m}else if(Array.isArray(l)&&(d=l.length<3||l.length>4?`Invalid rbga value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:S_(l[0],l[1],l[2],l[3]),!d))return new qr(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new Ps(d||`Could not parse color from value '${typeof l=="string"?l:String(JSON.stringify(l))}'`)}if(this.type.kind==="number"){let l=null;for(let d of this.args){if(l=d.evaluate(n),l===null)return 0;let p=Number(l);if(!isNaN(p))return p}throw new Ps(`Could not convert ${JSON.stringify(l)} to number.`)}return this.type.kind==="formatted"?ro.fromString(Ta(this.args[0].evaluate(n))):this.type.kind==="resolvedImage"?Di.fromString(Ta(this.args[0].evaluate(n))):this.type.kind==="array"?this.args.map(l=>l.evaluate(n)):Ta(this.args[0].evaluate(n))}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Q0([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new a0(this.args[0]).serialize();let n=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(l=>{n.push(l.serialize())}),n}}var Ll=lp;let Ad=["Unknown","Point","LineString","Polygon"];var T_=class{constructor(r,n){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=r,this.options=n}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ad[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(r){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){let r=this.featureDistanceData.center,n=this.featureDistanceData.scale,{x:l,y:d}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(l*n-r[0])+this.featureDistanceData.bearing[1]*(d*n-r[1])}return 0}parseColor(r){let n=this._parseColorCache[r];return n||(n=this._parseColorCache[r]=qr.parse(r)),n}getConfig(r){return this.options?this.options.get(r):null}};class l0{constructor(n,l,d,p,m){this.name=n,this.type=l,this._evaluate=d,this.args=p,this._overloadIndex=m}evaluate(n){if(!this._evaluate){let l=l0.definitions[this.name];this._evaluate=Array.isArray(l)?l[2]:l.overloads[this._overloadIndex][1]}return this._evaluate(n,this.args)}eachChild(n){this.args.forEach(n)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(n=>n.serialize()))}static parse(n,l){let d=n[0],p=l0.definitions[d];if(!p)return l.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0);let m=Array.isArray(p)?p[0]:p.type,y=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,w=[],T=null,E=-1;for(let[I,R]of y){if(Array.isArray(I)&&I.length!==n.length-1)continue;w.push(I),E++,T=new R_(l.registry,l.path,null,l.scope,void 0,l._scope,l.options);let F=[],B=!1;for(let V=1;V<n.length;V++){let W=n[V],$=Array.isArray(I)?I[V-1]:I.type,J=T.parse(W,1+F.length,$);if(!J){B=!0;break}F.push(J)}if(!B)if(Array.isArray(I)&&I.length!==F.length)T.error(`Expected ${I.length} arguments, but found ${F.length} instead.`);else{for(let V=0;V<F.length;V++){let W=Array.isArray(I)?I[V]:I.type,$=F[V];T.concat(V+1).checkSubtype(W,$.type)}if(T.errors.length===0)return new l0(d,m,R,F,E)}}if(w.length===1)l.errors.push(...T.errors);else{let I=(w.length?w:y.map(([F])=>F)).map(M_).join(" | "),R=[];for(let F=1;F<n.length;F++){let B=l.parse(n[F],1+R.length);if(!B)return null;R.push(bs(B.type))}l.error(`Expected arguments of type ${I}, but found (${R.join(", ")}) instead.`)}return null}static register(n,l){l0.definitions=l;for(let d in l)n[d]=l0}}function M_(r){return Array.isArray(r)?`(${r.map(bs).join(", ")})`:`(${bs(r.type)}...)`}var jn=l0;class Cd{constructor(n,l,d){this.type=ap,this.locale=d,this.caseSensitive=n,this.diacriticSensitive=l}static parse(n,l){if(n.length!==2)return l.error("Expected one argument.");let d=n[1];if(typeof d!="object"||Array.isArray(d))return l.error("Collator options argument must be an object.");let p=l.parse(d["case-sensitive"]!==void 0&&d["case-sensitive"],1,dr);if(!p)return null;let m=l.parse(d["diacritic-sensitive"]!==void 0&&d["diacritic-sensitive"],1,dr);if(!m)return null;let y=null;return d.locale&&(y=l.parse(d.locale,1,hr),!y)?null:new Cd(p,m,y)}evaluate(n){return new Mn(this.caseSensitive.evaluate(n),this.diacriticSensitive.evaluate(n),this.locale?this.locale.evaluate(n):null)}eachChild(n){n(this.caseSensitive),n(this.diacriticSensitive),this.locale&&n(this.locale)}outputDefined(){return!1}serialize(){let n={};return n["case-sensitive"]=this.caseSensitive.serialize(),n["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(n.locale=this.locale.serialize()),["collator",n]}}var Pf={exports:{}};Pf.exports=function(){function r(d,p,m,y,w){for(;y>m;){if(y-m>600){var T=y-m+1,E=p-m+1,I=Math.log(T),R=.5*Math.exp(2*I/3),F=.5*Math.sqrt(I*R*(T-R)/T)*(E-T/2<0?-1:1);r(d,p,Math.max(m,Math.floor(p-E*R/T+F)),Math.min(y,Math.floor(p+(T-E)*R/T+F)),w)}var B=d[p],V=m,W=y;for(n(d,m,p),w(d[y],B)>0&&n(d,m,y);V<W;){for(n(d,V,W),V++,W--;w(d[V],B)<0;)V++;for(;w(d[W],B)>0;)W--}w(d[m],B)===0?n(d,m,W):n(d,++W,y),W<=p&&(m=W+1),p<=W&&(y=W-1)}}function n(d,p,m){var y=d[p];d[p]=d[m],d[m]=y}function l(d,p){return d<p?-1:d>p?1:0}return function(d,p,m,y,w){r(d,p,m||0,y||d.length-1,w||l)}}();var Ty=G(Pf.exports);function My(r){let n=0;for(let l,d,p=0,m=r.length,y=m-1;p<m;y=p++)l=r[p],d=r[y],n+=(d.x-l.x)*(l.y+d.y);return n}function yc(r,n){r[0]=Math.min(r[0],n[0]),r[1]=Math.min(r[1],n[1]),r[2]=Math.max(r[2],n[0]),r[3]=Math.max(r[3],n[1])}function vc(r,n){return!(r[0]<=n[0]||r[2]>=n[2]||r[1]<=n[1]||r[3]>=n[3])}function cp(r,n,l){let d=r[0]-n[0],p=r[1]-n[1],m=r[0]-l[0],y=r[1]-l[1];return d*y-m*p==0&&d*m<=0&&p*y<=0}function th(r,n,l=!1){let d=!1;for(let w=0,T=n.length;w<T;w++){let E=n[w];for(let I=0,R=E.length,F=R-1;I<R;F=I++){let B=E[F],V=E[I];if(cp(r,B,V))return l;(m=B)[1]>(p=r)[1]!=(y=V)[1]>p[1]&&p[0]<(y[0]-m[0])*(p[1]-m[1])/(y[1]-m[1])+m[0]&&(d=!d)}}var p,m,y;return d}function Rf(r,n,l,d){let p=d[0]-l[0],m=d[1]-l[1],y=(r[0]-l[0])*m-p*(r[1]-l[1]),w=(n[0]-l[0])*m-p*(n[1]-l[1]);return y>0&&w<0||y<0&&w>0}function Fl(r,n,l,d){return(p=[d[0]-l[0],d[1]-l[1]])[0]*(m=[n[0]-r[0],n[1]-r[1]])[1]-p[1]*m[0]!=0&&!(!Rf(r,n,l,d)||!Rf(l,d,r,n));var p,m}let xc=8192;function Id(r,n){let l=(180+r[0])/360,d=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,p=Math.pow(2,n.z);return[Math.round(l*p*xc),Math.round(d*p*xc)]}function kf(r,n){for(let l=0;l<n.length;l++)if(th(r,n[l]))return!0;return!1}function Df(r,n,l){for(let d of l)for(let p=0,m=d.length,y=m-1;p<m;y=p++)if(Fl(r,n,d[y],d[p]))return!0;return!1}function Ma(r,n){for(let l=0;l<r.length;++l)if(!th(r[l],n))return!1;for(let l=0;l<r.length-1;++l)if(Df(r[l],r[l+1],n))return!1;return!0}function E_(r,n){for(let l=0;l<n.length;l++)if(Ma(r,n[l]))return!0;return!1}function Lf(r,n,l){let d=[];for(let p=0;p<r.length;p++){let m=[];for(let y=0;y<r[p].length;y++){let w=Id(r[p][y],l);yc(n,w),m.push(w)}d.push(m)}return d}function Ff(r,n,l){let d=[];for(let p=0;p<r.length;p++){let m=Lf(r[p],n,l);d.push(m)}return d}function Of(r,n,l,d){if(r[0]<l[0]||r[0]>l[2]){let p=.5*d,m=r[0]-l[0]>p?-d:l[0]-r[0]>p?d:0;m===0&&(m=r[0]-l[2]>p?-d:l[2]-r[0]>p?d:0),r[0]+=m}yc(n,r)}function Nf(r,n,l,d){let p=Math.pow(2,d.z)*xc,m=[d.x*xc,d.y*xc],y=[];if(!r)return y;for(let w of r)for(let T of w){let E=[T.x+m[0],T.y+m[1]];Of(E,n,l,p),y.push(E)}return y}function zf(r,n,l,d){let p=Math.pow(2,d.z)*xc,m=[d.x*xc,d.y*xc],y=[];if(!r)return y;for(let T of r){let E=[];for(let I of T){let R=[I.x+m[0],I.y+m[1]];yc(n,R),E.push(R)}y.push(E)}if(n[2]-n[0]<=p/2){(w=n)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(let T of y)for(let E of T)Of(E,n,l,p)}var w;return y}class ih{constructor(n,l){this.type=dr,this.geojson=n,this.geometries=l}static parse(n,l){if(n.length!==2)return l.error(`'within' expression requires exactly one argument, but found ${n.length-1} instead.`);if(o0(n[1])){let d=n[1];if(d.type==="FeatureCollection")for(let p=0;p<d.features.length;++p){let m=d.features[p].geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new ih(d,d.features[p].geometry)}else if(d.type==="Feature"){let p=d.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new ih(d,d.geometry)}else if(d.type==="Polygon"||d.type==="MultiPolygon")return new ih(d,d)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return function(l,d){let p=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],y=l.canonicalID();if(!y)return!1;if(d.type==="Polygon"){let w=Lf(d.coordinates,m,y),T=Nf(l.geometry(),p,m,y);if(!vc(p,m))return!1;for(let E of T)if(!th(E,w))return!1}if(d.type==="MultiPolygon"){let w=Ff(d.coordinates,m,y),T=Nf(l.geometry(),p,m,y);if(!vc(p,m))return!1;for(let E of T)if(!kf(E,w))return!1}return!0}(n,this.geometries);if(n.geometryType()==="LineString")return function(l,d){let p=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],y=l.canonicalID();if(!y)return!1;if(d.type==="Polygon"){let w=Lf(d.coordinates,m,y),T=zf(l.geometry(),p,m,y);if(!vc(p,m))return!1;for(let E of T)if(!Ma(E,w))return!1}if(d.type==="MultiPolygon"){let w=Ff(d.coordinates,m,y),T=zf(l.geometry(),p,m,y);if(!vc(p,m))return!1;for(let E of T)if(!E_(E,w))return!1}return!0}(n,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var hp=ih,Pd={exports:{}};Pd.exports=function(){var r={kilometers:1,miles:.621371192237334,nauticalmiles:.5399568034557235,meters:1e3,metres:1e3,yards:1093.6132983377079,feet:3280.839895013123,inches:39370.078740157485},n=1/298.257223563,l=n*(2-n),d=Math.PI/180,p=function(E,I){if(E===void 0)throw new Error("No latitude given.");if(I&&!r[I])throw new Error("Unknown unit "+I+". Use one of: "+Object.keys(r).join(", "));var R=6378.137*d*(I?r[I]:1),F=Math.cos(E*d),B=1/(1-l*(1-F*F)),V=Math.sqrt(B);this.kx=R*V*F,this.ky=R*V*B*(1-l)},m={units:{configurable:!0}};function y(E,I){return E[0]===I[0]&&E[1]===I[1]}function w(E,I,R){var F=T(I[0]-E[0]);return[E[0]+F*R,E[1]+(I[1]-E[1])*R]}function T(E){for(;E<-180;)E+=360;for(;E>180;)E-=360;return E}return p.fromTile=function(E,I,R){var F=Math.PI*(1-2*(E+.5)/Math.pow(2,I)),B=Math.atan(.5*(Math.exp(F)-Math.exp(-F)))/d;return new p(B,R)},m.units.get=function(){return r},p.prototype.distance=function(E,I){var R=T(E[0]-I[0])*this.kx,F=(E[1]-I[1])*this.ky;return Math.sqrt(R*R+F*F)},p.prototype.bearing=function(E,I){var R=T(I[0]-E[0])*this.kx;return Math.atan2(R,(I[1]-E[1])*this.ky)/d},p.prototype.destination=function(E,I,R){var F=R*d;return this.offset(E,Math.sin(F)*I,Math.cos(F)*I)},p.prototype.offset=function(E,I,R){return[E[0]+I/this.kx,E[1]+R/this.ky]},p.prototype.lineDistance=function(E){for(var I=0,R=0;R<E.length-1;R++)I+=this.distance(E[R],E[R+1]);return I},p.prototype.area=function(E){for(var I=0,R=0;R<E.length;R++)for(var F=E[R],B=0,V=F.length,W=V-1;B<V;W=B++)I+=T(F[B][0]-F[W][0])*(F[B][1]+F[W][1])*(R?-1:1);return Math.abs(I)/2*this.kx*this.ky},p.prototype.along=function(E,I){var R=0;if(I<=0)return E[0];for(var F=0;F<E.length-1;F++){var B=E[F],V=E[F+1],W=this.distance(B,V);if((R+=W)>I)return w(B,V,(I-(R-W))/W)}return E[E.length-1]},p.prototype.pointToSegmentDistance=function(E,I,R){var F=I[0],B=I[1],V=T(R[0]-F)*this.kx,W=(R[1]-B)*this.ky,$=0;return V===0&&W===0||(($=(T(E[0]-F)*this.kx*V+(E[1]-B)*this.ky*W)/(V*V+W*W))>1?(F=R[0],B=R[1]):$>0&&(F+=V/this.kx*$,B+=W/this.ky*$)),V=T(E[0]-F)*this.kx,W=(E[1]-B)*this.ky,Math.sqrt(V*V+W*W)},p.prototype.pointOnLine=function(E,I){for(var R,F,B,V,W=1/0,$=0;$<E.length-1;$++){var J=E[$][0],le=E[$][1],pe=T(E[$+1][0]-J)*this.kx,ue=(E[$+1][1]-le)*this.ky,Me=0;pe===0&&ue===0||((Me=(T(I[0]-J)*this.kx*pe+(I[1]-le)*this.ky*ue)/(pe*pe+ue*ue))>1?(J=E[$+1][0],le=E[$+1][1]):Me>0&&(J+=pe/this.kx*Me,le+=ue/this.ky*Me));var xe=(pe=T(I[0]-J)*this.kx)*pe+(ue=(I[1]-le)*this.ky)*ue;xe<W&&(W=xe,R=J,F=le,B=$,V=Me)}return{point:[R,F],index:B,t:Math.max(0,Math.min(1,V))}},p.prototype.lineSlice=function(E,I,R){var F=this.pointOnLine(R,E),B=this.pointOnLine(R,I);if(F.index>B.index||F.index===B.index&&F.t>B.t){var V=F;F=B,B=V}var W=[F.point],$=F.index+1,J=B.index;!y(R[$],W[0])&&$<=J&&W.push(R[$]);for(var le=$+1;le<=J;le++)W.push(R[le]);return y(R[J],B.point)||W.push(B.point),W},p.prototype.lineSliceAlong=function(E,I,R){for(var F=0,B=[],V=0;V<R.length-1;V++){var W=R[V],$=R[V+1],J=this.distance(W,$);if((F+=J)>E&&B.length===0&&B.push(w(W,$,(E-(F-J))/J)),F>=I)return B.push(w(W,$,(I-(F-J))/J)),B;F>E&&B.push($)}return B},p.prototype.bufferPoint=function(E,I){var R=I/this.ky,F=I/this.kx;return[E[0]-F,E[1]-R,E[0]+F,E[1]+R]},p.prototype.bufferBBox=function(E,I){var R=I/this.ky,F=I/this.kx;return[E[0]-F,E[1]-R,E[2]+F,E[3]+R]},p.prototype.insideBBox=function(E,I){return T(E[0]-I[0])>=0&&T(E[0]-I[2])<=0&&E[1]>=I[1]&&E[1]<=I[3]},Object.defineProperties(p,m),p}();var bc=G(Pd.exports),Bf={exports:{}};Bf.exports=function(){var r=function(l,d){if(l===void 0&&(l=[]),d===void 0&&(d=n),this.data=l,this.length=this.data.length,this.compare=d,this.length>0)for(var p=(this.length>>1)-1;p>=0;p--)this._down(p)};function n(l,d){return l<d?-1:l>d?1:0}return r.prototype.push=function(l){this.data.push(l),this.length++,this._up(this.length-1)},r.prototype.pop=function(){if(this.length!==0){var l=this.data[0],d=this.data.pop();return this.length--,this.length>0&&(this.data[0]=d,this._down(0)),l}},r.prototype.peek=function(){return this.data[0]},r.prototype._up=function(l){for(var d=this.data,p=this.compare,m=d[l];l>0;){var y=l-1>>1,w=d[y];if(p(m,w)>=0)break;d[l]=w,l=y}d[l]=m},r.prototype._down=function(l){for(var d=this.data,p=this.compare,m=this.length>>1,y=d[l];l<m;){var w=1+(l<<1),T=d[w],E=w+1;if(E<this.length&&p(d[E],T)<0&&(w=E,T=d[E]),p(T,y)>=0)break;d[l]=T,l=w}d[l]=y},r}();var Ea=G(Bf.exports),ii=8192;function dp(r,n){return n.dist-r.dist}let Uf=100,Rd=50;function Vf(r){let n=[1/0,1/0,-1/0,-1/0];if(n.length!==r.length)return!1;for(let l=0;l<n.length;l++)if(n[l]!==r[l])return!1;return!0}function wc(r){return r[1]-r[0]+1}function ja(r,n){let l=r[1]>=r[0]&&r[1]<n;return l||console.warn("Distance Expression: Index is out of range"),l}function Gf(r,n){if(r[0]>r[1])return[null,null];let l=wc(r);if(n){if(l===2)return[r,null];let d=Math.floor(l/2);return[[r[0],r[0]+d],[r[0]+d,r[1]]]}{if(l===1)return[r,null];let d=Math.floor(l/2)-1;return[[r[0],r[0]+d],[r[0]+d+1,r[1]]]}}function c0(r,n){let l=[1/0,1/0,-1/0,-1/0];if(!ja(n,r.length))return l;for(let d=n[0];d<=n[1];++d)yc(l,r[d]);return l}function up(r){let n=[1/0,1/0,-1/0,-1/0];for(let l=0;l<r.length;++l)for(let d=0;d<r[l].length;++d)yc(n,r[l][d]);return n}function h0(r,n,l){if(Vf(r)||Vf(n))return NaN;let d=0,p=0;return r[2]<n[0]&&(d=n[0]-r[2]),r[0]>n[2]&&(d=r[0]-n[2]),r[1]>n[3]&&(p=r[1]-n[3]),r[3]<n[1]&&(p=n[1]-r[3]),l.distance([0,0],[d,p])}function Hf(r){return 360*r-180}function Ey(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function nh(r,n){let l=Math.pow(2,n.z),d=(r.y/ii+n.y)/l;return[Hf((r.x/ii+n.x)/l),Ey(d)]}function Ay(r,n){let l=[];for(let d=0;d<r.length;++d)l.push(nh(r[d],n));return l}function A_(r,n,l){let d=l.pointOnLine(n,r).point;return l.distance(r,d)}function C_(r,n,l,d,p){let m=l.slice(d[0],d[1]+1),y=1/0;for(let w=n[0];w<=n[1];++w)if((y=Math.min(y,A_(r[w],m,p)))===0)return 0;return y}function jf(r,n,l,d,p){let m=Math.min(p.pointToSegmentDistance(r,l,d),p.pointToSegmentDistance(n,l,d)),y=Math.min(p.pointToSegmentDistance(l,r,n),p.pointToSegmentDistance(d,r,n));return Math.min(m,y)}function Cy(r,n,l,d,p){if(!ja(n,r.length)||!ja(d,l.length))return NaN;let m=1/0;for(let y=n[0];y<n[1];++y)for(let w=d[0];w<d[1];++w){if(Fl(r[y],r[y+1],l[w],l[w+1]))return 0;m=Math.min(m,jf(r[y],r[y+1],l[w],l[w+1],p))}return m}function Iy(r,n,l,d,p){if(!ja(n,r.length)||!ja(d,l.length))return NaN;let m=1/0;for(let y=n[0];y<=n[1];++y)for(let w=d[0];w<=d[1];++w)if((m=Math.min(m,p.distance(r[y],l[w])))===0)return m;return m}function Py(r,n,l){if(th(r,n,!0))return 0;let d=1/0;for(let p of n){let m=p.length;if(m<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(p[0]!==p[m-1]&&(d=Math.min(d,l.pointToSegmentDistance(r,p[m-1],p[0])))===0||(d=Math.min(d,A_(r,p,l)))===0)return d}return d}function I_(r,n,l,d){if(!ja(n,r.length))return NaN;for(let m=n[0];m<=n[1];++m)if(th(r[m],l,!0))return 0;let p=1/0;for(let m=n[0];m<n[1];++m)for(let y of l)for(let w=0,T=y.length,E=T-1;w<T;E=w++){if(Fl(r[m],r[m+1],y[E],y[w]))return 0;p=Math.min(p,jf(r[m],r[m+1],y[E],y[w],d))}return p}function kd(r,n){for(let l of r)for(let d=0;d<=l.length-1;++d)if(th(l[d],n,!0))return!0;return!1}function Ry(r,n,l,d=1/0){let p=up(r),m=up(n);if(d!==1/0&&h0(p,m,l)>=d)return d;if(vc(p,m)){if(kd(r,n))return 0}else if(kd(n,r))return 0;let y=d;for(let w of r)for(let T=0,E=w.length,I=E-1;T<E;I=T++)for(let R of n)for(let F=0,B=R.length,V=B-1;F<B;V=F++){if(Fl(w[I],w[T],R[V],R[F]))return 0;y=Math.min(y,jf(w[I],w[T],R[V],R[F],l))}return y}function pp(r,n,l,d,p,m,y){if(m===null||y===null)return;let w=h0(c0(d,m),c0(p,y),l);w<n&&r.push({dist:w,range1:m,range2:y})}function Wf(r,n,l,d,p=1/0){let m=Math.min(d.distance(r[0],l[0][0]),p);if(m===0)return m;let y=new Ea([{dist:0,range1:[0,r.length-1],range2:[0,0]}],dp),w=n?Rd:Uf,T=up(l);for(;y.length;){let E=y.pop();if(E.dist>=m)continue;let I=E.range1;if(wc(I)<=w){if(!ja(I,r.length))return NaN;if(n){let R=I_(r,I,l,d);if((m=Math.min(m,R))===0)return m}else for(let R=I[0];R<=I[1];++R){let F=Py(r[R],l,d);if((m=Math.min(m,F))===0)return m}}else{let R=Gf(I,n);if(R[0]!==null){let F=h0(c0(r,R[0]),T,d);F<m&&y.push({dist:F,range1:R[0],range2:[0,0]})}if(R[1]!==null){let F=h0(c0(r,R[1]),T,d);F<m&&y.push({dist:F,range1:R[1],range2:[0,0]})}}}return m}function P_(r,n,l,d,p,m=1/0){let y=Math.min(m,p.distance(r[0],l[0]));if(y===0)return y;let w=new Ea([{dist:0,range1:[0,r.length-1],range2:[0,l.length-1]}],dp),T=n?Rd:Uf,E=d?Rd:Uf;for(;w.length;){let I=w.pop();if(I.dist>=y)continue;let R=I.range1,F=I.range2;if(wc(R)<=T&&wc(F)<=E){if(!ja(R,r.length)||!ja(F,l.length))return NaN;if(n&&d?y=Math.min(y,Cy(r,R,l,F,p)):n||d?n&&!d?y=Math.min(y,C_(l,F,r,R,p)):!n&&d&&(y=Math.min(y,C_(r,R,l,F,p))):y=Math.min(y,Iy(r,R,l,F,p)),y===0)return y}else{let B=Gf(R,n),V=Gf(F,d);pp(w,y,p,r,l,B[0],V[0]),pp(w,y,p,r,l,B[0],V[1]),pp(w,y,p,r,l,B[1],V[0]),pp(w,y,p,r,l,B[1],V[1])}}return y}function qf(r,n,l,d,p=1/0){let m=p,y=c0(r,[0,r.length-1]);for(let w of l)if(!(m!==1/0&&h0(y,c0(w,[0,w.length-1]),d)>=m)&&(m=Math.min(m,P_(r,n,w,!0,d,m)),m===0))return m;return m}function fp(r,n,l,d,p=1/0){let m=p,y=c0(r,[0,r.length-1]);for(let w of l){if(m!==1/0&&h0(y,up(w),d)>=m)continue;let T=Wf(r,n,w,d,m);if(isNaN(T))return T;if((m=Math.min(m,T))===0)return m}return m}function Xf(r){return r==="Point"||r==="MultiPoint"||r==="LineString"||r==="MultiLineString"||r==="Polygon"||r==="MultiPolygon"}class d0{constructor(n,l){this.type=ci,this.geojson=n,this.geometries=l}static parse(n,l){if(n.length!==2)return l.error(`'distance' expression requires either one argument, but found ' ${n.length-1} instead.`);if(o0(n[1])){let d=n[1];if(d.type==="FeatureCollection"){for(let p=0;p<d.features.length;++p)if(Xf(d.features[p].geometry.type))return new d0(d,d.features[p].geometry)}else if(d.type==="Feature"){if(Xf(d.geometry.type))return new d0(d,d.geometry)}else if(Xf(d.type))return new d0(d,d)}return l.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(n){let l=n.geometry(),d=n.canonicalID();if(l!=null&&d!=null){if(n.geometryType()==="Point")return function(p,m,y){let w=[];for(let E of p)for(let I of E)w.push(nh(I,m));let T=new bc(w[0][1],"meters");return y.type==="Point"||y.type==="MultiPoint"||y.type==="LineString"?P_(w,!1,y.type==="Point"?[y.coordinates]:y.coordinates,y.type==="LineString",T):y.type==="MultiLineString"?qf(w,!1,y.coordinates,T):y.type==="Polygon"||y.type==="MultiPolygon"?fp(w,!1,y.type==="Polygon"?[y.coordinates]:y.coordinates,T):null}(l,d,this.geometries);if(n.geometryType()==="LineString")return function(p,m,y){let w=[];for(let E of p){let I=[];for(let R of E)I.push(nh(R,m));w.push(I)}let T=new bc(w[0][0][1],"meters");if(y.type==="Point"||y.type==="MultiPoint"||y.type==="LineString")return qf(y.type==="Point"?[y.coordinates]:y.coordinates,y.type==="LineString",w,T);if(y.type==="MultiLineString"){let E=1/0;for(let I=0;I<y.coordinates.length;I++){let R=qf(y.coordinates[I],!0,w,T,E);if(isNaN(R))return R;if((E=Math.min(E,R))===0)return E}return E}if(y.type==="Polygon"||y.type==="MultiPolygon"){let E=1/0;for(let I=0;I<w.length;I++){let R=fp(w[I],!0,y.type==="Polygon"?[y.coordinates]:y.coordinates,T,E);if(isNaN(R))return R;if((E=Math.min(E,R))===0)return E}return E}return null}(l,d,this.geometries);if(n.geometryType()==="Polygon")return function(p,m,y){let w=[];for(let E of function(I,R){let F=I.length;if(F<=1)return[I];let B=[],V,W;for(let $=0;$<F;$++){let J=My(I[$]);J!==0&&(I[$].area=Math.abs(J),W===void 0&&(W=J<0),W===J<0?(V&&B.push(V),V=[I[$]]):V.push(I[$]))}return V&&B.push(V),B}(p)){let I=[];for(let R=0;R<E.length;++R)I.push(Ay(E[R],m));w.push(I)}let T=new bc(w[0][0][0][1],"meters");if(y.type==="Point"||y.type==="MultiPoint"||y.type==="LineString")return fp(y.type==="Point"?[y.coordinates]:y.coordinates,y.type==="LineString",w,T);if(y.type==="MultiLineString"){let E=1/0;for(let I=0;I<y.coordinates.length;I++){let R=fp(y.coordinates[I],!0,w,T,E);if(isNaN(R))return R;if((E=Math.min(E,R))===0)return E}return E}return y.type==="Polygon"||y.type==="MultiPolygon"?function(E,I,R){let F=1/0;for(let B of E)for(let V of I){let W=Ry(B,V,R,F);if(isNaN(W))return W;if((F=Math.min(F,W))===0)return F}return F}(y.type==="Polygon"?[y.coordinates]:y.coordinates,w,T):null}(l,d,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}var mp=d0;function Dd(r,n){switch(r){case"string":return Ta(n);case"number":return+n;case"boolean":return!!n;case"color":return qr.parse(n);case"formatted":return ro.fromString(Ta(n));case"resolvedImage":return Di.fromString(Ta(n))}return n}function Zf(r,n,l,d){return d!==void 0&&(r=d*Math.round(r/d)),n!==void 0&&r<n&&(r=n),l!==void 0&&r>l&&(r=l),r}class Ld{constructor(n,l,d){this.type=n,this.key=l,this.scope=d}static parse(n,l){let d=l.expectedType;if(d==null&&(d=Yn),n.length<2||n.length>3)return l.error("Invalid number of arguments for 'config' expression.");let p=l.parse(n[1],1);if(!(p instanceof kl))return l.error("Key name of 'config' expression must be a string literal.");if(n.length>=3){let m=l.parse(n[2],2);return m instanceof kl?new Ld(d,Ta(p.value),Ta(m.value)):l.error("Scope of 'config' expression must be a string literal.")}return new Ld(d,Ta(p.value))}evaluate(n){let l=[this.key,this.scope,n.scope].filter(Boolean).join(""),d=n.getConfig(l);if(!d)return null;let{type:p,value:m,values:y,minValue:w,maxValue:T,stepValue:E}=d,I=d.default.evaluate(n),R=I;if(m){let F=n.scope;n.scope=(F||"").split("").slice(1).join(""),R=m.evaluate(n),n.scope=F}return p&&(R=Dd(p,R)),R===void 0||w===void 0&&T===void 0&&E===void 0||(typeof R=="number"?R=Zf(R,w,T,E):Array.isArray(R)&&(R=R.map(F=>typeof F=="number"?Zf(F,w,T,E):F))),m!==void 0&&R!==void 0&&y&&!y.includes(R)&&(R=I,p&&(R=Dd(p,R))),(p&&p!==this.type||R!==void 0&&Is(R)!==this.type)&&(R=Dd(this.type.kind,R)),R}eachChild(){}outputDefined(){return!1}serialize(){let n=["config",this.key];return this.scope&&n.concat(this.key),n}}var rh=Ld;function sh(r){if(r instanceof jn&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof hp||r instanceof mp)return!1;let n=!0;return r.eachChild(l=>{n&&!sh(l)&&(n=!1)}),n}function Fd(r){if(r instanceof jn&&r.name==="feature-state")return!1;let n=!0;return r.eachChild(l=>{n&&!Fd(l)&&(n=!1)}),n}function Od(r){if(r instanceof rh)return!1;let n=!0;return r.eachChild(l=>{n&&!Od(l)&&(n=!1)}),n}function so(r,n){if(r instanceof jn&&n.indexOf(r.name)>=0)return!1;let l=!0;return r.eachChild(d=>{l&&!so(d,n)&&(l=!1)}),l}class Sc{constructor(n,l){this.type=l.type,this.name=n,this.boundExpression=l}static parse(n,l){if(n.length!==2||typeof n[1]!="string")return l.error("'var' expression requires exactly one string literal argument.");let d=n[1];return l.scope.has(d)?new Sc(d,l.scope.get(d)):l.error(`Unknown variable "${d}". Make sure "${d}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(n){return this.boundExpression.evaluate(n)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Do=Sc;class $f{constructor(n,l=[],d,p=new op,m=[],y,w){this.registry=n,this.path=l,this.key=l.map(T=>`[${T}]`).join(""),this.scope=p,this.errors=m,this.expectedType=d,this._scope=y,this.options=w}parse(n,l,d,p,m={}){return l||d?this.concat(l,d,p)._parse(n,m):this._parse(n,m)}_parse(n,l){function d(p,m,y){return y==="assert"?new Dl(m,[p]):y==="coerce"?new Ll(m,[p]):p}if(n!==null&&typeof n!="string"&&typeof n!="boolean"&&typeof n!="number"||(n=["literal",n]),Array.isArray(n)){if(n.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let p=typeof n[0]=="string"?this.registry[n[0]]:void 0;if(p){let m=p.parse(n,this);if(!m)return null;if(this.expectedType){let y=this.expectedType,w=m.type;if(y.kind!=="string"&&y.kind!=="number"&&y.kind!=="boolean"&&y.kind!=="object"&&y.kind!=="array"||w.kind!=="value")if(y.kind!=="color"&&y.kind!=="formatted"&&y.kind!=="resolvedImage"||w.kind!=="value"&&w.kind!=="string"){if(this.checkSubtype(y,w))return null}else m=d(m,y,l.typeAnnotation||"coerce");else m=d(m,y,l.typeAnnotation||"assert")}if(!(m instanceof kl)&&m.type.kind!=="resolvedImage"&&Yf(m)){let y=new T_(this._scope,this.options);try{m=new kl(m.type,m.evaluate(y))}catch(w){return this.error(w.message),null}}return m}return Ll.parse(["to-array",n],this)}return this.error(n===void 0?"'undefined' value invalid. Use null instead.":typeof n=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof n} instead.`)}concat(n,l,d){let p=typeof n=="number"?this.path.concat(n):this.path,m=d?this.scope.concat(d):this.scope;return new $f(this.registry,p,l||null,m,this.errors,this._scope,this.options)}error(n,...l){let d=`${this.key}${l.map(p=>`[${p}]`).join("")}`;this.errors.push(new Go(d,n))}checkSubtype(n,l){let d=s0(n,l);return d&&this.error(d),d}}var R_=$f;function Yf(r){if(r instanceof Do)return Yf(r.boundExpression);if(r instanceof jn&&r.name==="error"||r instanceof Cd||r instanceof hp||r instanceof mp||r instanceof rh)return!1;let n=r instanceof Ll||r instanceof Dl,l=!0;return r.eachChild(d=>{l=n?l&&Yf(d):l&&d instanceof kl}),!!l&&sh(r)&&so(r,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function u0(r,n){let l=r.length-1,d,p,m=0,y=l,w=0;for(;m<=y;)if(w=Math.floor((m+y)/2),d=r[w],p=r[w+1],d<=n){if(w===l||n<p)return w;m=w+1}else{if(!(d>n))throw new Ps("Input is not a number.");y=w-1}return 0}class gp{constructor(n,l,d){this.type=n,this.input=l,this.labels=[],this.outputs=[];for(let[p,m]of d)this.labels.push(p),this.outputs.push(m)}static parse(n,l){if(n.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return l.error("Expected an even number of arguments.");let d=l.parse(n[1],1,ci);if(!d)return null;let p=[],m=null;l.expectedType&&l.expectedType.kind!=="value"&&(m=l.expectedType);for(let y=1;y<n.length;y+=2){let w=y===1?-1/0:n[y],T=n[y+1],E=y,I=y+1;if(typeof w!="number")return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(p.length&&p[p.length-1][0]>=w)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);let R=l.parse(T,I,m);if(!R)return null;m=m||R.type,p.push([w,R])}return new gp(m,d,p)}evaluate(n){let l=this.labels,d=this.outputs;if(l.length===1)return d[0].evaluate(n);let p=this.input.evaluate(n);if(p<=l[0])return d[0].evaluate(n);let m=l.length;return p>=l[m-1]?d[m-1].evaluate(n):d[u0(l,p)].evaluate(n)}eachChild(n){n(this.input);for(let l of this.outputs)n(l)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}serialize(){let n=["step",this.input.serialize()];for(let l=0;l<this.labels.length;l++)l>0&&n.push(this.labels[l]),n.push(this.outputs[l].serialize());return n}}var Nd=gp;let k_=.95047,Tc=1.08883,D_=4/29,oh=6/29,Jf=3*oh*oh,L_=oh*oh*oh,ky=Math.PI/180,Wa=180/Math.PI;function _p(r){return r>L_?Math.pow(r,1/3):r/Jf+D_}function yp(r){return r>oh?r*r*r:Jf*(r-D_)}function vp(r){return 255*(r<=.0031308?12.92*r:1.055*Math.pow(r,1/2.4)-.055)}function xp(r){return(r/=255)<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function Kf(r){let n=xp(r.r),l=xp(r.g),d=xp(r.b),p=_p((.4124564*n+.3575761*l+.1804375*d)/k_),m=_p((.2126729*n+.7151522*l+.072175*d)/1);return{l:116*m-16,a:500*(p-m),b:200*(m-_p((.0193339*n+.119192*l+.9503041*d)/Tc)),alpha:r.a}}function Qf(r){let n=(r.l+16)/116,l=isNaN(r.a)?n:n+r.a/500,d=isNaN(r.b)?n:n-r.b/200;return n=1*yp(n),l=k_*yp(l),d=Tc*yp(d),new qr(vp(3.2404542*l-1.5371385*n-.4985314*d),vp(-.969266*l+1.8760108*n+.041556*d),vp(.0556434*l-.2040259*n+1.0572252*d),r.alpha)}function F_(r,n,l){let d=n-r;return r+l*(d>180||d<-180?d-360*Math.round(d/360):d)}let ah={forward:Kf,reverse:Qf,interpolate:function(r,n,l){return{l:Tn(r.l,n.l,l),a:Tn(r.a,n.a,l),b:Tn(r.b,n.b,l),alpha:Tn(r.alpha,n.alpha,l)}}},lh={forward:function(r){let{l:n,a:l,b:d}=Kf(r),p=Math.atan2(d,l)*Wa;return{h:p<0?p+360:p,c:Math.sqrt(l*l+d*d),l:n,alpha:r.a}},reverse:function(r){let n=r.h*ky,l=r.c;return Qf({l:r.l,a:Math.cos(n)*l,b:Math.sin(n)*l,alpha:r.alpha})},interpolate:function(r,n,l){return{h:F_(r.h,n.h,l),c:Tn(r.c,n.c,l),l:Tn(r.l,n.l,l),alpha:Tn(r.alpha,n.alpha,l)}}};var em=Object.freeze({__proto__:null,hcl:lh,lab:ah});class zd{constructor(n,l,d,p,m){this.type=n,this.operator=l,this.interpolation=d,this.input=p,this.labels=[],this.outputs=[];for(let[y,w]of m)this.labels.push(y),this.outputs.push(w)}static interpolationFactor(n,l,d,p){let m=0;if(n.name==="exponential")m=ch(l,n.base,d,p);else if(n.name==="linear")m=ch(l,1,d,p);else if(n.name==="cubic-bezier"){let y=n.controlPoints;m=new ne(y[0],y[1],y[2],y[3]).solve(ch(l,1,d,p))}return m}static parse(n,l){let[d,p,m,...y]=n;if(!Array.isArray(p)||p.length===0)return l.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){let E=p[1];if(typeof E!="number")return l.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:E}}else{if(p[0]!=="cubic-bezier")return l.error(`Unknown interpolation type ${String(p[0])}`,1,0);{let E=p.slice(1);if(E.length!==4||E.some(I=>typeof I!="number"||I<0||I>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:E}}}if(n.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(m=l.parse(m,2,ci),!m)return null;let w=[],T=null;d==="interpolate-hcl"||d==="interpolate-lab"?T=Sa:l.expectedType&&l.expectedType.kind!=="value"&&(T=l.expectedType);for(let E=0;E<y.length;E+=2){let I=y[E],R=y[E+1],F=E+3,B=E+4;if(typeof I!="number")return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',F);if(w.length&&w[w.length-1][0]>=I)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',F);let V=l.parse(R,B,T);if(!V)return null;T=T||V.type,w.push([I,V])}return T.kind==="number"||T.kind==="color"||T.kind==="array"&&T.itemType.kind==="number"&&typeof T.N=="number"?new zd(T,d,p,m,w):l.error(`Type ${bs(T)} is not interpolatable.`)}evaluate(n){let l=this.labels,d=this.outputs;if(l.length===1)return d[0].evaluate(n);let p=this.input.evaluate(n);if(p<=l[0])return d[0].evaluate(n);let m=l.length;if(p>=l[m-1])return d[m-1].evaluate(n);let y=u0(l,p),w=zd.interpolationFactor(this.interpolation,p,l[y],l[y+1]),T=d[y].evaluate(n),E=d[y+1].evaluate(n);return this.operator==="interpolate"?wa[this.type.kind.toLowerCase()](T,E,w):this.operator==="interpolate-hcl"?lh.reverse(lh.interpolate(lh.forward(T),lh.forward(E),w)):ah.reverse(ah.interpolate(ah.forward(T),ah.forward(E),w))}eachChild(n){n(this.input);for(let l of this.outputs)n(l)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}serialize(){let n;n=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);let l=[this.operator,n,this.input.serialize()];for(let d=0;d<this.labels.length;d++)l.push(this.labels[d],this.outputs[d].serialize());return l}}function ch(r,n,l,d){let p=d-l,m=r-l;return p===0?0:n===1?m/p:(Math.pow(n,m)-1)/(Math.pow(n,p)-1)}var ra=zd;class hh{constructor(n,l){this.type=n,this.args=l}static parse(n,l){if(n.length<2)return l.error("Expectected at least one argument.");let d=null,p=l.expectedType;p&&p.kind!=="value"&&(d=p);let m=[];for(let w of n.slice(1)){let T=l.parse(w,1+m.length,d,void 0,{typeAnnotation:"omit"});if(!T)return null;d=d||T.type,m.push(T)}let y=p&&m.some(w=>s0(p,w.type));return new hh(y?Yn:d,m)}evaluate(n){let l,d=null,p=0;for(let m of this.args){if(p++,d=m.evaluate(n),d&&d instanceof Di&&!d.available&&(l||(l=d),d=null,p===this.args.length))return l;if(d!==null)break}return d}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){let n=["coalesce"];return this.eachChild(l=>{n.push(l.serialize())}),n}}var tm=hh;class bp{constructor(n,l){this.type=l.type,this.bindings=[].concat(n),this.result=l}evaluate(n){return this.result.evaluate(n)}eachChild(n){for(let l of this.bindings)n(l[1]);n(this.result)}static parse(n,l){if(n.length<4)return l.error(`Expected at least 3 arguments, but found ${n.length-1} instead.`);let d=[];for(let m=1;m<n.length-1;m+=2){let y=n[m];if(typeof y!="string")return l.error(`Expected string, but found ${typeof y} instead.`,m);if(/[^a-zA-Z0-9_]/.test(y))return l.error("Variable names must contain only alphanumeric characters or '_'.",m);let w=l.parse(n[m+1],m+1);if(!w)return null;d.push([y,w])}let p=l.parse(n[n.length-1],n.length-1,l.expectedType,d);return p?new bp(d,p):null}outputDefined(){return this.result.outputDefined()}serialize(){let n=["let"];for(let[l,d]of this.bindings)n.push(l,d.serialize());return n.push(this.result.serialize()),n}}var im=bp;class Mc{constructor(n,l,d){this.type=n,this.index=l,this.input=d}static parse(n,l){if(n.length!==3)return l.error(`Expected 2 arguments, but found ${n.length-1} instead.`);let d=l.parse(n[1],1,ci),p=l.parse(n[2],2,Ho(l.expectedType||Yn));return d&&p?new Mc(p.type.itemType,d,p):null}evaluate(n){let l=this.index.evaluate(n),d=this.input.evaluate(n);if(l<0)throw new Ps(`Array index out of bounds: ${l} < 0.`);if(l>=d.length)throw new Ps(`Array index out of bounds: ${l} > ${d.length-1}.`);if(l!==Math.floor(l))throw new Ps(`Array index must be an integer, but found ${l} instead.`);return d[l]}eachChild(n){n(this.index),n(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Jn=Mc;class nm{constructor(n,l){this.type=dr,this.needle=n,this.haystack=l}static parse(n,l){if(n.length!==3)return l.error(`Expected 2 arguments, but found ${n.length-1} instead.`);let d=l.parse(n[1],1,Yn),p=l.parse(n[2],2,Yn);return d&&p?tn(d.type,[dr,hr,ci,$0,Yn])?new nm(d,p):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${bs(d.type)} instead`):null}evaluate(n){let l=this.needle.evaluate(n),d=this.haystack.evaluate(n);if(d==null)return!1;if(!gc(l,["boolean","string","number","null"]))throw new Ps(`Expected first argument to be of type boolean, string, number or null, but found ${bs(Is(l))} instead.`);if(!gc(d,["string","array"]))throw new Ps(`Expected second argument to be of type array or string, but found ${bs(Is(d))} instead.`);return d.indexOf(l)>=0}eachChild(n){n(this.needle),n(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Dy=nm;class wp{constructor(n,l,d){this.type=ci,this.needle=n,this.haystack=l,this.fromIndex=d}static parse(n,l){if(n.length<=2||n.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);let d=l.parse(n[1],1,Yn),p=l.parse(n[2],2,Yn);if(!d||!p)return null;if(!tn(d.type,[dr,hr,ci,$0,Yn]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${bs(d.type)} instead`);if(n.length===4){let m=l.parse(n[3],3,ci);return m?new wp(d,p,m):null}return new wp(d,p)}evaluate(n){let l=this.needle.evaluate(n),d=this.haystack.evaluate(n);if(!gc(l,["boolean","string","number","null"]))throw new Ps(`Expected first argument to be of type boolean, string, number or null, but found ${bs(Is(l))} instead.`);if(!gc(d,["string","array"]))throw new Ps(`Expected second argument to be of type array or string, but found ${bs(Is(d))} instead.`);if(this.fromIndex){let p=this.fromIndex.evaluate(n);return d.indexOf(l,p)}return d.indexOf(l)}eachChild(n){n(this.needle),n(this.haystack),this.fromIndex&&n(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){let n=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),n]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var O_=wp;class rm{constructor(n,l,d,p,m,y){this.inputType=n,this.type=l,this.input=d,this.cases=p,this.outputs=m,this.otherwise=y}static parse(n,l){if(n.length<5)return l.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if(n.length%2!=1)return l.error("Expected an even number of arguments.");let d,p;l.expectedType&&l.expectedType.kind!=="value"&&(p=l.expectedType);let m={},y=[];for(let E=2;E<n.length-1;E+=2){let I=n[E],R=n[E+1];Array.isArray(I)||(I=[I]);let F=l.concat(E);if(I.length===0)return F.error("Expected at least one branch label.");for(let V of I){if(typeof V!="number"&&typeof V!="string")return F.error("Branch labels must be numbers or strings.");if(typeof V=="number"&&Math.abs(V)>Number.MAX_SAFE_INTEGER)return F.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof V=="number"&&Math.floor(V)!==V)return F.error("Numeric branch labels must be integer values.");if(d){if(F.checkSubtype(d,Is(V)))return null}else d=Is(V);if(m[String(V)]!==void 0)return F.error("Branch labels must be unique.");m[String(V)]=y.length}let B=l.parse(R,E,p);if(!B)return null;p=p||B.type,y.push(B)}let w=l.parse(n[1],1,Yn);if(!w)return null;let T=l.parse(n[n.length-1],n.length-1,p);return T?w.type.kind!=="value"&&l.concat(1).checkSubtype(d,w.type)?null:new rm(d,p,w,m,y,T):null}evaluate(n){let l=this.input.evaluate(n);return(Is(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(n)}eachChild(n){n(this.input),this.outputs.forEach(n),n(this.otherwise)}outputDefined(){return this.outputs.every(n=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){let n=["match",this.input.serialize()],l=Object.keys(this.cases).sort(),d=[],p={};for(let y of l){let w=p[this.cases[y]];w===void 0?(p[this.cases[y]]=d.length,d.push([this.cases[y],[y]])):d[w][1].push(y)}let m=y=>this.inputType.kind==="number"?Number(y):y;for(let[y,w]of d)n.push(w.length===1?m(w[0]):w.map(m)),n.push(this.outputs[y].serialize());return n.push(this.otherwise.serialize()),n}}var N_=rm;class Sp{constructor(n,l,d){this.type=n,this.branches=l,this.otherwise=d}static parse(n,l){if(n.length<4)return l.error(`Expected at least 3 arguments, but found only ${n.length-1}.`);if(n.length%2!=0)return l.error("Expected an odd number of arguments.");let d;l.expectedType&&l.expectedType.kind!=="value"&&(d=l.expectedType);let p=[];for(let y=1;y<n.length-1;y+=2){let w=l.parse(n[y],y,dr);if(!w)return null;let T=l.parse(n[y+1],y+1,d);if(!T)return null;p.push([w,T]),d=d||T.type}let m=l.parse(n[n.length-1],n.length-1,d);return m?new Sp(d,p,m):null}evaluate(n){for(let[l,d]of this.branches)if(l.evaluate(n))return d.evaluate(n);return this.otherwise.evaluate(n)}eachChild(n){for(let[l,d]of this.branches)n(l),n(d);n(this.otherwise)}outputDefined(){return this.branches.every(([n,l])=>l.outputDefined())&&this.otherwise.outputDefined()}serialize(){let n=["case"];return this.eachChild(l=>{n.push(l.serialize())}),n}}var z_=Sp;class Bd{constructor(n,l,d,p){this.type=n,this.input=l,this.beginIndex=d,this.endIndex=p}static parse(n,l){if(n.length<=2||n.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);let d=l.parse(n[1],1,Yn),p=l.parse(n[2],2,ci);if(!d||!p)return null;if(!tn(d.type,[Ho(Yn),hr,Yn]))return l.error(`Expected first argument to be of type array or string, but found ${bs(d.type)} instead`);if(n.length===4){let m=l.parse(n[3],3,ci);return m?new Bd(d.type,d,p,m):null}return new Bd(d.type,d,p)}evaluate(n){let l=this.input.evaluate(n),d=this.beginIndex.evaluate(n);if(!gc(l,["string","array"]))throw new Ps(`Expected first argument to be of type array or string, but found ${bs(Is(l))} instead.`);if(this.endIndex){let p=this.endIndex.evaluate(n);return l.slice(d,p)}return l.slice(d)}eachChild(n){n(this.input),n(this.beginIndex),this.endIndex&&n(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){let n=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),n]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var dh=Bd;function sm(r,n){return r==="=="||r==="!="?n.kind==="boolean"||n.kind==="string"||n.kind==="number"||n.kind==="null"||n.kind==="value":n.kind==="string"||n.kind==="number"||n.kind==="value"}function om(r,n,l,d){return d.compare(n,l)===0}function uh(r,n,l){let d=r!=="=="&&r!=="!=";return class eI{constructor(m,y,w){this.type=dr,this.lhs=m,this.rhs=y,this.collator=w,this.hasUntypedArgument=m.type.kind==="value"||y.type.kind==="value"}static parse(m,y){if(m.length!==3&&m.length!==4)return y.error("Expected two or three arguments.");let w=m[0],T=y.parse(m[1],1,Yn);if(!T)return null;if(!sm(w,T.type))return y.concat(1).error(`"${w}" comparisons are not supported for type '${bs(T.type)}'.`);let E=y.parse(m[2],2,Yn);if(!E)return null;if(!sm(w,E.type))return y.concat(2).error(`"${w}" comparisons are not supported for type '${bs(E.type)}'.`);if(T.type.kind!==E.type.kind&&T.type.kind!=="value"&&E.type.kind!=="value")return y.error(`Cannot compare types '${bs(T.type)}' and '${bs(E.type)}'.`);d&&(T.type.kind==="value"&&E.type.kind!=="value"?T=new Dl(E.type,[T]):T.type.kind!=="value"&&E.type.kind==="value"&&(E=new Dl(T.type,[E])));let I=null;if(m.length===4){if(T.type.kind!=="string"&&E.type.kind!=="string"&&T.type.kind!=="value"&&E.type.kind!=="value")return y.error("Cannot use collator to compare non-string types.");if(I=y.parse(m[3],3,ap),!I)return null}return new eI(T,E,I)}evaluate(m){let y=this.lhs.evaluate(m),w=this.rhs.evaluate(m);if(d&&this.hasUntypedArgument){let T=Is(y),E=Is(w);if(T.kind!==E.kind||T.kind!=="string"&&T.kind!=="number")throw new Ps(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${T.kind}, ${E.kind}) instead.`)}if(this.collator&&!d&&this.hasUntypedArgument){let T=Is(y),E=Is(w);if(T.kind!=="string"||E.kind!=="string")return n(m,y,w)}return this.collator?l(m,y,w,this.collator.evaluate(m)):n(m,y,w)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}serialize(){let m=[r];return this.eachChild(y=>{m.push(y.serialize())}),m}}}let am=uh("==",function(r,n,l){return n===l},om),lm=uh("!=",function(r,n,l){return n!==l},function(r,n,l,d){return!om(0,n,l,d)}),Ly=uh("<",function(r,n,l){return n<l},function(r,n,l,d){return d.compare(n,l)<0}),Fy=uh(">",function(r,n,l){return n>l},function(r,n,l,d){return d.compare(n,l)>0}),B_=uh("<=",function(r,n,l){return n<=l},function(r,n,l,d){return d.compare(n,l)<=0}),Oy=uh(">=",function(r,n,l){return n>=l},function(r,n,l,d){return d.compare(n,l)>=0});class cm{constructor(n,l,d,p,m,y){this.type=hr,this.number=n,this.locale=l,this.currency=d,this.unit=p,this.minFractionDigits=m,this.maxFractionDigits=y}static parse(n,l){if(n.length!==3)return l.error("Expected two arguments.");let d=l.parse(n[1],1,ci);if(!d)return null;let p=n[2];if(typeof p!="object"||Array.isArray(p))return l.error("NumberFormat options argument must be an object.");let m=null;if(p.locale&&(m=l.parse(p.locale,1,hr),!m))return null;let y=null;if(p.currency&&(y=l.parse(p.currency,1,hr),!y))return null;let w=null;if(p.unit&&(w=l.parse(p.unit,1,hr),!w))return null;let T=null;if(p["min-fraction-digits"]&&(T=l.parse(p["min-fraction-digits"],1,ci),!T))return null;let E=null;return p["max-fraction-digits"]&&(E=l.parse(p["max-fraction-digits"],1,ci),!E)?null:new cm(d,m,y,w,T,E)}evaluate(n){return new Intl.NumberFormat(this.locale?this.locale.evaluate(n):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(n):void 0,unit:this.unit?this.unit.evaluate(n):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(n):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(n):void 0}).format(this.number.evaluate(n))}eachChild(n){n(this.number),this.locale&&n(this.locale),this.currency&&n(this.currency),this.unit&&n(this.unit),this.minFractionDigits&&n(this.minFractionDigits),this.maxFractionDigits&&n(this.maxFractionDigits)}outputDefined(){return!1}serialize(){let n={};return this.locale&&(n.locale=this.locale.serialize()),this.currency&&(n.currency=this.currency.serialize()),this.unit&&(n.unit=this.unit.serialize()),this.minFractionDigits&&(n["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(n["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),n]}}class hm{constructor(n){this.type=ci,this.input=n}static parse(n,l){if(n.length!==2)return l.error(`Expected 1 argument, but found ${n.length-1} instead.`);let d=l.parse(n[1],1);return d?d.type.kind!=="array"&&d.type.kind!=="string"&&d.type.kind!=="value"?l.error(`Expected argument of type string or array, but found ${bs(d.type)} instead.`):new hm(d):null}evaluate(n){let l=this.input.evaluate(n);if(typeof l=="string"||Array.isArray(l))return l.length;throw new Ps(`Expected value to be of type string or array, but found ${bs(Is(l))} instead.`)}eachChild(n){n(this.input)}outputDefined(){return!1}serialize(){let n=["length"];return this.eachChild(l=>{n.push(l.serialize())}),n}}function U_(r){return function(){r=1831565813+(r|=0)|0;let n=Math.imul(r^r>>>15,1|r);return n=n+Math.imul(n^n>>>7,61|n)^n,((n^n>>>14)>>>0)/4294967296}}let dm={"==":am,"!=":lm,">":Fy,"<":Ly,">=":Oy,"<=":B_,array:Dl,at:Jn,boolean:Dl,case:z_,coalesce:tm,collator:Cd,format:Q0,image:a0,in:Dy,"index-of":O_,interpolate:ra,"interpolate-hcl":ra,"interpolate-lab":ra,length:hm,let:im,literal:kl,match:N_,number:Dl,"number-format":cm,object:Dl,slice:dh,step:Nd,string:Dl,"to-boolean":Ll,"to-color":Ll,"to-number":Ll,"to-string":Ll,var:Do,within:hp,distance:mp,config:rh};function um(r,[n,l,d,p]){n=n.evaluate(r),l=l.evaluate(r),d=d.evaluate(r);let m=p?p.evaluate(r):1,y=S_(n,l,d,m);if(y)throw new Ps(y);return new qr(n/255*m,l/255*m,d/255*m,m)}function V_(r,[n,l,d,p]){n=n.evaluate(r),l=l.evaluate(r),d=d.evaluate(r);let m=p?p.evaluate(r):1,y=function(E,I,R,F){return typeof E=="number"&&E>=0&&E<=360?typeof I=="number"&&I>=0&&I<=100&&typeof R=="number"&&R>=0&&R<=100?F===void 0||typeof F=="number"&&F>=0&&F<=1?null:`Invalid hsla value [${[E,I,R,F].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof F=="number"?[E,I,R,F]:[E,I,R]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof F=="number"?[E,I,R,F]:[E,I,R]).join(", ")}]: 'h' must be between 0 and 360.`}(n,l,d,m);if(y)throw new Ps(y);let w=`hsla(${n}, ${l}%, ${d}%, ${m})`,T=qr.parse(w);if(!T)throw new Ps(`Failed to parse HSLA color: ${w}`);return T}function pm(r,n){return r in n}function fm(r,n){let l=n[r];return l===void 0?null:l}function p0(r){return{type:r}}jn.register(dm,{error:[{kind:"error"},[hr],(r,[n])=>{throw new Ps(n.evaluate(r))}],typeof:[hr,[Yn],(r,[n])=>bs(Is(n.evaluate(r)))],"to-rgba":[Ho(ci,4),[Sa],(r,[n])=>n.evaluate(r).toArray()],rgb:[Sa,[ci,ci,ci],um],rgba:[Sa,[ci,ci,ci,ci],um],hsl:[Sa,[ci,ci,ci],V_],hsla:[Sa,[ci,ci,ci,ci],V_],has:{type:dr,overloads:[[[hr],(r,[n])=>pm(n.evaluate(r),r.properties())],[[hr,Y0],(r,[n,l])=>pm(n.evaluate(r),l.evaluate(r))]]},get:{type:Yn,overloads:[[[hr],(r,[n])=>fm(n.evaluate(r),r.properties())],[[hr,Y0],(r,[n,l])=>fm(n.evaluate(r),l.evaluate(r))]]},"feature-state":[Yn,[hr],(r,[n])=>fm(n.evaluate(r),r.featureState||{})],properties:[Y0,[],r=>r.properties()],"geometry-type":[hr,[],r=>r.geometryType()],id:[Yn,[],r=>r.id()],zoom:[ci,[],r=>r.globals.zoom],pitch:[ci,[],r=>r.globals.pitch||0],"distance-from-center":[ci,[],r=>r.distanceFromCenter()],"measure-light":[ci,[hr],(r,[n])=>r.measureLight(n.evaluate(r))],"heatmap-density":[ci,[],r=>r.globals.heatmapDensity||0],"line-progress":[ci,[],r=>r.globals.lineProgress||0],"raster-value":[ci,[],r=>r.globals.rasterValue||0],"raster-particle-speed":[ci,[],r=>r.globals.rasterParticleSpeed||0],"sky-radial-progress":[ci,[],r=>r.globals.skyRadialProgress||0],accumulated:[Yn,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[ci,p0(ci),(r,n)=>{let l=0;for(let d of n)l+=d.evaluate(r);return l}],"*":[ci,p0(ci),(r,n)=>{let l=1;for(let d of n)l*=d.evaluate(r);return l}],"-":{type:ci,overloads:[[[ci,ci],(r,[n,l])=>n.evaluate(r)-l.evaluate(r)],[[ci],(r,[n])=>-n.evaluate(r)]]},"/":[ci,[ci,ci],(r,[n,l])=>n.evaluate(r)/l.evaluate(r)],"%":[ci,[ci,ci],(r,[n,l])=>n.evaluate(r)%l.evaluate(r)],ln2:[ci,[],()=>Math.LN2],pi:[ci,[],()=>Math.PI],e:[ci,[],()=>Math.E],"^":[ci,[ci,ci],(r,[n,l])=>Math.pow(n.evaluate(r),l.evaluate(r))],sqrt:[ci,[ci],(r,[n])=>Math.sqrt(n.evaluate(r))],log10:[ci,[ci],(r,[n])=>Math.log(n.evaluate(r))/Math.LN10],ln:[ci,[ci],(r,[n])=>Math.log(n.evaluate(r))],log2:[ci,[ci],(r,[n])=>Math.log(n.evaluate(r))/Math.LN2],sin:[ci,[ci],(r,[n])=>Math.sin(n.evaluate(r))],cos:[ci,[ci],(r,[n])=>Math.cos(n.evaluate(r))],tan:[ci,[ci],(r,[n])=>Math.tan(n.evaluate(r))],asin:[ci,[ci],(r,[n])=>Math.asin(n.evaluate(r))],acos:[ci,[ci],(r,[n])=>Math.acos(n.evaluate(r))],atan:[ci,[ci],(r,[n])=>Math.atan(n.evaluate(r))],min:[ci,p0(ci),(r,n)=>Math.min(...n.map(l=>l.evaluate(r)))],max:[ci,p0(ci),(r,n)=>Math.max(...n.map(l=>l.evaluate(r)))],abs:[ci,[ci],(r,[n])=>Math.abs(n.evaluate(r))],round:[ci,[ci],(r,[n])=>{let l=n.evaluate(r);return l<0?-Math.round(-l):Math.round(l)}],floor:[ci,[ci],(r,[n])=>Math.floor(n.evaluate(r))],ceil:[ci,[ci],(r,[n])=>Math.ceil(n.evaluate(r))],"filter-==":[dr,[hr,Yn],(r,[n,l])=>r.properties()[n.value]===l.value],"filter-id-==":[dr,[Yn],(r,[n])=>r.id()===n.value],"filter-type-==":[dr,[hr],(r,[n])=>r.geometryType()===n.value],"filter-<":[dr,[hr,Yn],(r,[n,l])=>{let d=r.properties()[n.value],p=l.value;return typeof d==typeof p&&d<p}],"filter-id-<":[dr,[Yn],(r,[n])=>{let l=r.id(),d=n.value;return typeof l==typeof d&&l<d}],"filter->":[dr,[hr,Yn],(r,[n,l])=>{let d=r.properties()[n.value],p=l.value;return typeof d==typeof p&&d>p}],"filter-id->":[dr,[Yn],(r,[n])=>{let l=r.id(),d=n.value;return typeof l==typeof d&&l>d}],"filter-<=":[dr,[hr,Yn],(r,[n,l])=>{let d=r.properties()[n.value],p=l.value;return typeof d==typeof p&&d<=p}],"filter-id-<=":[dr,[Yn],(r,[n])=>{let l=r.id(),d=n.value;return typeof l==typeof d&&l<=d}],"filter->=":[dr,[hr,Yn],(r,[n,l])=>{let d=r.properties()[n.value],p=l.value;return typeof d==typeof p&&d>=p}],"filter-id->=":[dr,[Yn],(r,[n])=>{let l=r.id(),d=n.value;return typeof l==typeof d&&l>=d}],"filter-has":[dr,[Yn],(r,[n])=>n.value in r.properties()],"filter-has-id":[dr,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[dr,[Ho(hr)],(r,[n])=>n.value.indexOf(r.geometryType())>=0],"filter-id-in":[dr,[Ho(Yn)],(r,[n])=>n.value.indexOf(r.id())>=0],"filter-in-small":[dr,[hr,Ho(Yn)],(r,[n,l])=>l.value.indexOf(r.properties()[n.value])>=0],"filter-in-large":[dr,[hr,Ho(Yn)],(r,[n,l])=>function(d,p,m,y){for(;m<=y;){let w=m+y>>1;if(p[w]===d)return!0;p[w]>d?y=w-1:m=w+1}return!1}(r.properties()[n.value],l.value,0,l.value.length-1)],all:{type:dr,overloads:[[[dr,dr],(r,[n,l])=>n.evaluate(r)&&l.evaluate(r)],[p0(dr),(r,n)=>{for(let l of n)if(!l.evaluate(r))return!1;return!0}]]},any:{type:dr,overloads:[[[dr,dr],(r,[n,l])=>n.evaluate(r)||l.evaluate(r)],[p0(dr),(r,n)=>{for(let l of n)if(l.evaluate(r))return!0;return!1}]]},"!":[dr,[dr],(r,[n])=>!n.evaluate(r)],"is-supported-script":[dr,[hr],(r,[n])=>{let l=r.globals&&r.globals.isSupportedScript;return!l||l(n.evaluate(r))}],upcase:[hr,[hr],(r,[n])=>n.evaluate(r).toUpperCase()],downcase:[hr,[hr],(r,[n])=>n.evaluate(r).toLowerCase()],concat:[hr,p0(Yn),(r,n)=>n.map(l=>Ta(l.evaluate(r))).join("")],"resolved-locale":[hr,[ap],(r,[n])=>n.evaluate(r).resolvedLocale()],random:[ci,[ci,ci,Yn],(r,n)=>{let[l,d,p]=n.map(y=>y.evaluate(r));if(l>d||l===d)return l;let m;if(typeof p=="string")m=function(y){let w=0;if(y.length===0)return w;for(let T=0;T<y.length;T++)w=(w<<5)-w+y.charCodeAt(T),w|=0;return w}(p);else{if(typeof p!="number")throw new Ps(`Invalid seed input: ${p}`);m=p}return l+U_(m)()*(d-l)}]});var ph=dm;function mm(r){return{result:"success",value:r}}function f0(r){return{result:"error",value:r}}function G_(r,n){return!!r&&!!r.parameters&&r.parameters.indexOf(n)>-1}function Tp(r){return r["property-type"]==="data-driven"}function gm(r){return G_(r.expression,"measure-light")}function H_(r){return G_(r.expression,"zoom")}function _m(r){return!!r.expression&&r.expression.interpolated}function Mp(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function j_(r){return r}function ym(r,n){let l=n.type==="color",d=r.stops&&typeof r.stops[0][0]=="object",p=d||!(d||r.property!==void 0),m=r.type||(_m(n)?"exponential":"interval");if(l&&((r=r0({},r)).stops&&(r.stops=r.stops.map(E=>[E[0],qr.parse(E[1])])),r.default=qr.parse(r.default?r.default:n.default)),r.colorSpace&&r.colorSpace!=="rgb"&&!em[r.colorSpace])throw new Error(`Unknown color space: ${r.colorSpace}`);let y,w,T;if(m==="exponential")y=W_;else if(m==="interval")y=zy;else if(m==="categorical"){y=Ny,w=Object.create(null);for(let E of r.stops)w[E[0]]=E[1];T=typeof r.stops[0][0]}else{if(m!=="identity")throw new Error(`Unknown function type "${m}"`);y=q_}if(d){let E={},I=[];for(let B=0;B<r.stops.length;B++){let V=r.stops[B],W=V[0].zoom;E[W]===void 0&&(E[W]={zoom:W,type:r.type,property:r.property,default:r.default,stops:[]},I.push(W)),E[W].stops.push([V[0].value,V[1]])}let R=[];for(let B of I)R.push([E[B].zoom,ym(E[B],n)]);let F={name:"linear"};return{kind:"composite",interpolationType:F,interpolationFactor:ra.interpolationFactor.bind(void 0,F),zoomStops:R.map(B=>B[0]),evaluate:({zoom:B},V)=>W_({stops:R,base:r.base},n,B).evaluate(B,V)}}if(p){let E=m==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:ra.interpolationFactor.bind(void 0,E),zoomStops:r.stops.map(I=>I[0]),evaluate:({zoom:I})=>y(r,n,I,w,T)}}return{kind:"source",evaluate(E,I){let R=I&&I.properties?I.properties[r.property]:void 0;return R===void 0?Ud(r.default,n.default):y(r,n,R,w,T)}}}function Ud(r,n,l){return r!==void 0?r:n!==void 0?n:l!==void 0?l:void 0}function Ny(r,n,l,d,p){return Ud(typeof l===p?d[l]:void 0,r.default,n.default)}function zy(r,n,l){if(eh(l)!=="number")return Ud(r.default,n.default);let d=r.stops.length;if(d===1||l<=r.stops[0][0])return r.stops[0][1];if(l>=r.stops[d-1][0])return r.stops[d-1][1];let p=u0(r.stops.map(m=>m[0]),l);return r.stops[p][1]}function W_(r,n,l){let d=r.base!==void 0?r.base:1;if(eh(l)!=="number")return Ud(r.default,n.default);let p=r.stops.length;if(p===1||l<=r.stops[0][0])return r.stops[0][1];if(l>=r.stops[p-1][0])return r.stops[p-1][1];let m=u0(r.stops.map(I=>I[0]),l),y=function(I,R,F,B){let V=B-F,W=I-F;return V===0?0:R===1?W/V:(Math.pow(R,W)-1)/(Math.pow(R,V)-1)}(l,d,r.stops[m][0],r.stops[m+1][0]),w=r.stops[m][1],T=r.stops[m+1][1],E=wa[n.type]||j_;if(r.colorSpace&&r.colorSpace!=="rgb"){let I=em[r.colorSpace];E=(R,F)=>I.reverse(I.interpolate(I.forward(R),I.forward(F),y))}return typeof w.evaluate=="function"?{evaluate(...I){let R=w.evaluate.apply(void 0,I),F=T.evaluate.apply(void 0,I);if(R!==void 0&&F!==void 0)return E(R,F,y)}}:E(w,T,y)}function q_(r,n,l){return n.type==="color"?l=qr.parse(l):n.type==="formatted"?l=ro.fromString(l.toString()):n.type==="resolvedImage"?l=Di.fromString(l.toString()):eh(l)===n.type||n.type==="enum"&&n.values[l]||(l=void 0),Ud(l,r.default,n.default)}class Ep{constructor(n,l,d,p){this.expression=n,this._warningHistory={},this._evaluator=new T_(d,p),this._defaultValue=l?function(m){return m.type==="color"&&(Mp(m.default)||Array.isArray(m.default))?new qr(0,0,0,0):m.type==="color"?qr.parse(m.default)||null:m.default===void 0?null:m.default}(l):null,this._enumValues=l&&l.type==="enum"?l.values:null}evaluateWithoutErrorHandling(n,l,d,p,m,y,w,T){return this._evaluator.globals=n,this._evaluator.feature=l,this._evaluator.featureState=d,this._evaluator.canonical=p||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=y,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=T||null,this.expression.evaluate(this._evaluator)}evaluate(n,l,d,p,m,y,w,T){this._evaluator.globals=n,this._evaluator.feature=l||null,this._evaluator.featureState=d||null,this._evaluator.canonical=p||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=y||null,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=T||null;try{let E=this.expression.evaluate(this._evaluator);if(E==null||typeof E=="number"&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new Ps(`Expected value to be one of ${Object.keys(this._enumValues).map(I=>JSON.stringify(I)).join(", ")}, but found ${JSON.stringify(E)} instead.`);return E}catch(E){return this._warningHistory[E.message]||(this._warningHistory[E.message]=!0,typeof console<"u"&&console.warn(E.message)),this._defaultValue}}}function Vd(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in ph}function Ap(r,n,l,d){let p=new R_(ph,[],n?function(y){let w={color:Sa,string:hr,number:ci,enum:hr,boolean:dr,formatted:J0,resolvedImage:Ed};return y.type==="array"?Ho(w[y.value]||Yn,y.length):w[y.type]}(n):void 0,void 0,void 0,l,d),m=p.parse(r,void 0,void 0,void 0,n&&n.type==="string"?{typeAnnotation:"coerce"}:void 0);return m?mm(new Ep(m,n,l,d)):f0(p.errors)}class vm{constructor(n,l,d){this.kind=n,this._styleExpression=l,this.isLightConstant=d,this.isStateDependent=n!=="constant"&&!Fd(l.expression),this.isConfigDependent=!Od(l.expression)}evaluateWithoutErrorHandling(n,l,d,p,m,y){return this._styleExpression.evaluateWithoutErrorHandling(n,l,d,p,m,y)}evaluate(n,l,d,p,m,y){return this._styleExpression.evaluate(n,l,d,p,m,y)}}class Gd{constructor(n,l,d,p,m){this.kind=n,this.zoomStops=d,this._styleExpression=l,this.isStateDependent=n!=="camera"&&!Fd(l.expression),this.isLightConstant=m,this.isConfigDependent=!Od(l.expression),this.interpolationType=p}evaluateWithoutErrorHandling(n,l,d,p,m,y){return this._styleExpression.evaluateWithoutErrorHandling(n,l,d,p,m,y)}evaluate(n,l,d,p,m,y){return this._styleExpression.evaluate(n,l,d,p,m,y)}interpolationFactor(n,l,d){return this.interpolationType?ra.interpolationFactor(this.interpolationType,n,l,d):0}}function Cp(r,n,l,d){if((r=Ap(r,n,l,d)).result==="error")return r;let p=r.value.expression,m=sh(p);if(!m&&!Tp(n))return f0([new Go("","data expressions not supported")]);let y=so(p,["zoom","pitch","distance-from-center"]);if(!y&&!H_(n))return f0([new Go("","zoom expressions not supported")]);let w=so(p,["measure-light"]);if(!w&&!gm(n))return f0([new Go("","measure-light expression not supported")]);let T=n.expression&&n.expression.relaxZoomRestriction,E=jd(p);return E||y||T?E instanceof Go?f0([E]):E instanceof ra&&!_m(n)?f0([new Go("",'"interpolate" expressions cannot be used with this property')]):mm(E?new Gd(m?"camera":"composite",r.value,E.labels,E instanceof ra?E.interpolation:void 0,w):new vm(m?"constant":"source",r.value,w)):f0([new Go("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Hd{constructor(n,l){this._parameters=n,this._specification=l,r0(this,ym(this._parameters,this._specification))}static deserialize(n){return new Hd(n._parameters,n._specification)}static serialize(n){return{_parameters:n._parameters,_specification:n._specification}}}function jd(r){let n=null;if(r instanceof im)n=jd(r.result);else if(r instanceof tm){for(let l of r.args)if(n=jd(l),n)break}else(r instanceof Nd||r instanceof ra)&&r.input instanceof jn&&r.input.name==="zoom"&&(n=r);return n instanceof Go||r.eachChild(l=>{let d=jd(l);d instanceof Go?n=d:n&&d&&n!==d&&(n=new Go("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),n}var By=Xa,qa=3;function Xa(r,n,l){var d=this.cells=[];if(r instanceof ArrayBuffer){this.arrayBuffer=r;var p=new Int32Array(this.arrayBuffer);r=p[0],this.d=(n=p[1])+2*(l=p[2]);for(var m=0;m<this.d*this.d;m++){var y=p[qa+m],w=p[qa+m+1];d.push(y===w?null:p.subarray(y,w))}var T=p[qa+d.length+1];this.keys=p.subarray(p[qa+d.length],T),this.bboxes=p.subarray(T),this.insert=this._insertReadonly}else{this.d=n+2*l;for(var E=0;E<this.d*this.d;E++)d.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=r,this.padding=l,this.scale=n/r,this.uid=0;var I=l/n*r;this.min=-I,this.max=r+I}Xa.prototype.insert=function(r,n,l,d,p){this._forEachCell(n,l,d,p,this._insertCell,this.uid++),this.keys.push(r),this.bboxes.push(n),this.bboxes.push(l),this.bboxes.push(d),this.bboxes.push(p)},Xa.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Xa.prototype._insertCell=function(r,n,l,d,p,m){this.cells[p].push(m)},Xa.prototype.query=function(r,n,l,d,p){var m=this.min,y=this.max;if(r<=m&&n<=m&&y<=l&&y<=d&&!p)return Array.prototype.slice.call(this.keys);var w=[];return this._forEachCell(r,n,l,d,this._queryCell,w,{},p),w},Xa.prototype._queryCell=function(r,n,l,d,p,m,y,w){var T=this.cells[p];if(T!==null)for(var E=this.keys,I=this.bboxes,R=0;R<T.length;R++){var F=T[R];if(y[F]===void 0){var B=4*F;(w?w(I[B+0],I[B+1],I[B+2],I[B+3]):r<=I[B+2]&&n<=I[B+3]&&l>=I[B+0]&&d>=I[B+1])?(y[F]=!0,m.push(E[F])):y[F]=!1}}},Xa.prototype._forEachCell=function(r,n,l,d,p,m,y,w){for(var T=this._convertToCellCoord(r),E=this._convertToCellCoord(n),I=this._convertToCellCoord(l),R=this._convertToCellCoord(d),F=T;F<=I;F++)for(var B=E;B<=R;B++){var V=this.d*B+F;if((!w||w(this._convertFromCellCoord(F),this._convertFromCellCoord(B),this._convertFromCellCoord(F+1),this._convertFromCellCoord(B+1)))&&p.call(this,r,n,l,d,V,m,y,w))return}},Xa.prototype._convertFromCellCoord=function(r){return(r-this.padding)/this.scale},Xa.prototype._convertToCellCoord=function(r){return Math.max(0,Math.min(this.d-1,Math.floor(r*this.scale)+this.padding))},Xa.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var r=this.cells,n=qa+this.cells.length+1+1,l=0,d=0;d<this.cells.length;d++)l+=this.cells[d].length;var p=new Int32Array(n+l+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;for(var m=n,y=0;y<r.length;y++){var w=r[y];p[qa+y]=m,p.set(w,m),m+=w.length}return p[qa+r.length]=m,p.set(this.keys,m),p[qa+r.length+1]=m+=this.keys.length,p.set(this.bboxes,m),m+=this.bboxes.length,p.buffer};var Ol=G(By);let Wd={};function hi(r,n,l={}){Object.defineProperty(r,"_classRegistryKey",{value:n,writeable:!1}),Wd[n]={klass:r,omit:l.omit||[]}}hi(Object,"Object"),Ol.serialize=function(r,n){let l=r.toArrayBuffer();return n&&n.add(l),{buffer:l}},Ol.deserialize=function(r){return new Ol(r.buffer)},Object.defineProperty(Ol,"name",{value:"Grid"}),hi(Ol,"Grid"),hi(qr,"Color"),hi(Error,"Error"),hi(ro,"Formatted"),hi(K0,"FormattedSection"),hi(mr,"AJAXError"),hi(Di,"ResolvedImage"),hi(Hd,"StylePropertyFunction"),hi(Ep,"StyleExpression",{omit:["_evaluator"]}),hi(Gd,"ZoomDependentExpression"),hi(vm,"ZoomConstantExpression"),hi(jn,"CompoundExpression",{omit:["_evaluate"]});for(let r in ph)Wd[ph[r]._classRegistryKey]||hi(ph[r],`Expression${r}`);function X_(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function Ip(r){return self.ImageBitmap&&r instanceof ImageBitmap}function Ec(r,n){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp)return r;if(X_(r)||Ip(r))return n&&n.add(r),r;if(ArrayBuffer.isView(r)){let l=r;return n&&n.add(l.buffer),l}if(r instanceof ImageData)return n&&n.add(r.data.buffer),r;if(Array.isArray(r)){let l=[];for(let d of r)l.push(Ec(d,n));return l}if(r instanceof Map){let l={$name:"Map"};for(let[d,p]of r.entries())l[d]=Ec(p);return l}if(typeof r=="object"){let l=r.constructor,d=l._classRegistryKey;if(!d)throw new Error(`can't serialize object of unregistered class ${d}`);let p=l.serialize?l.serialize(r,n):{};if(!l.serialize){for(let m in r)r.hasOwnProperty(m)&&(Wd[d].omit.indexOf(m)>=0||(p[m]=Ec(r[m],n)));r instanceof Error&&(p.message=r.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return d!=="Object"&&(p.$name=d),p}throw new Error("can't serialize object of type "+typeof r)}function m0(r){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||X_(r)||Ip(r)||ArrayBuffer.isView(r)||r instanceof ImageData)return r;if(Array.isArray(r))return r.map(m0);if(typeof r=="object"){let n=r.$name||"Object";if(n==="Map"){let p=new Map;for(let m of Object.keys(r))m!=="$name"&&p.set(m,m0(r[m]));return p}let{klass:l}=Wd[n];if(!l)throw new Error(`can't deserialize unregistered class ${n}`);if(l.deserialize)return l.deserialize(r);let d=Object.create(l.prototype);for(let p of Object.keys(r))p!=="$name"&&(d[p]=m0(r[p]));return d}throw new Error("can't deserialize object of type "+typeof r)}let _i={"Latin-1 Supplement":r=>r>=128&&r<=255,Arabic:r=>r>=1536&&r<=1791,"Arabic Supplement":r=>r>=1872&&r<=1919,"Arabic Extended-A":r=>r>=2208&&r<=2303,"Hangul Jamo":r=>r>=4352&&r<=4607,"Unified Canadian Aboriginal Syllabics":r=>r>=5120&&r<=5759,Khmer:r=>r>=6016&&r<=6143,"Unified Canadian Aboriginal Syllabics Extended":r=>r>=6320&&r<=6399,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"CJK Radicals Supplement":r=>r>=11904&&r<=12031,"Kangxi Radicals":r=>r>=12032&&r<=12255,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Hiragana:r=>r>=12352&&r<=12447,Katakana:r=>r>=12448&&r<=12543,Bopomofo:r=>r>=12544&&r<=12591,"Hangul Compatibility Jamo":r=>r>=12592&&r<=12687,Kanbun:r=>r>=12688&&r<=12703,"Bopomofo Extended":r=>r>=12704&&r<=12735,"CJK Strokes":r=>r>=12736&&r<=12783,"Katakana Phonetic Extensions":r=>r>=12784&&r<=12799,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"CJK Unified Ideographs Extension A":r=>r>=13312&&r<=19903,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"CJK Unified Ideographs":r=>r>=19968&&r<=40959,"Yi Syllables":r=>r>=40960&&r<=42127,"Yi Radicals":r=>r>=42128&&r<=42191,"Hangul Jamo Extended-A":r=>r>=43360&&r<=43391,"Hangul Syllables":r=>r>=44032&&r<=55215,"Hangul Jamo Extended-B":r=>r>=55216&&r<=55295,"Private Use Area":r=>r>=57344&&r<=63743,"CJK Compatibility Ideographs":r=>r>=63744&&r<=64255,"Arabic Presentation Forms-A":r=>r>=64336&&r<=65023,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Arabic Presentation Forms-B":r=>r>=65136&&r<=65279,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519,"CJK Unified Ideographs Extension B":r=>r>=131072&&r<=173791};function Ac(r){for(let n of r)if(xm(n.charCodeAt(0)))return!0;return!1}function Uy(r){for(let n of r)if(!Vy(n.charCodeAt(0)))return!1;return!0}function Vy(r){return!(_i.Arabic(r)||_i["Arabic Supplement"](r)||_i["Arabic Extended-A"](r)||_i["Arabic Presentation Forms-A"](r)||_i["Arabic Presentation Forms-B"](r))}function xm(r){return!(r!==746&&r!==747&&(r<4352||!(_i["Bopomofo Extended"](r)||_i.Bopomofo(r)||_i["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||_i["CJK Compatibility Ideographs"](r)||_i["CJK Compatibility"](r)||_i["CJK Radicals Supplement"](r)||_i["CJK Strokes"](r)||!(!_i["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||_i["CJK Unified Ideographs Extension A"](r)||_i["CJK Unified Ideographs"](r)||_i["Enclosed CJK Letters and Months"](r)||_i["Hangul Compatibility Jamo"](r)||_i["Hangul Jamo Extended-A"](r)||_i["Hangul Jamo Extended-B"](r)||_i["Hangul Jamo"](r)||_i["Hangul Syllables"](r)||_i.Hiragana(r)||_i["Ideographic Description Characters"](r)||_i.Kanbun(r)||_i["Kangxi Radicals"](r)||_i["Katakana Phonetic Extensions"](r)||_i.Katakana(r)&&r!==12540||!(!_i["Halfwidth and Fullwidth Forms"](r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!_i["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||_i["Unified Canadian Aboriginal Syllabics"](r)||_i["Unified Canadian Aboriginal Syllabics Extended"](r)||_i["Vertical Forms"](r)||_i["Yijing Hexagram Symbols"](r)||_i["Yi Syllables"](r)||_i["Yi Radicals"](r))))}function Z_(r){return!(xm(r)||function(n){return!!(_i["Latin-1 Supplement"](n)&&(n===167||n===169||n===174||n===177||n===188||n===189||n===190||n===215||n===247)||_i["General Punctuation"](n)&&(n===8214||n===8224||n===8225||n===8240||n===8241||n===8251||n===8252||n===8258||n===8263||n===8264||n===8265||n===8273)||_i["Letterlike Symbols"](n)||_i["Number Forms"](n)||_i["Miscellaneous Technical"](n)&&(n>=8960&&n<=8967||n>=8972&&n<=8991||n>=8996&&n<=9e3||n===9003||n>=9085&&n<=9114||n>=9150&&n<=9165||n===9167||n>=9169&&n<=9179||n>=9186&&n<=9215)||_i["Control Pictures"](n)&&n!==9251||_i["Optical Character Recognition"](n)||_i["Enclosed Alphanumerics"](n)||_i["Geometric Shapes"](n)||_i["Miscellaneous Symbols"](n)&&!(n>=9754&&n<=9759)||_i["Miscellaneous Symbols and Arrows"](n)&&(n>=11026&&n<=11055||n>=11088&&n<=11097||n>=11192&&n<=11243)||_i["CJK Symbols and Punctuation"](n)||_i.Katakana(n)||_i["Private Use Area"](n)||_i["CJK Compatibility Forms"](n)||_i["Small Form Variants"](n)||_i["Halfwidth and Fullwidth Forms"](n)||n===8734||n===8756||n===8757||n>=9984&&n<=10087||n>=10102&&n<=10131||n===65532||n===65533)}(r))}function $_(r){return r>=1424&&r<=2303||_i["Arabic Presentation Forms-A"](r)||_i["Arabic Presentation Forms-B"](r)}function Y_(r,n){return!(!n&&$_(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||_i.Khmer(r))}function bm(r){for(let n of r)if($_(n.charCodeAt(0)))return!0;return!1}let wm="deferred",Sm="loading",Tm="loaded",Mm=null,jo="unavailable",Cc=null,J_=function(r){r&&typeof r=="string"&&r.indexOf("NetworkError")>-1&&(jo="error"),Mm&&Mm(r)};function Em(){Am.fire(new Ls("pluginStateChange",{pluginStatus:jo,pluginURL:Cc}))}let Am=new So,Ic=function(){return jo},Cm=function(){if(jo!==wm||!Cc)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");jo=Sm,Em(),Cc&&lt({url:Cc},r=>{r?J_(r):(jo=Tm,Em())})},sa={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>jo===Tm||sa.applyArabicShaping!=null,isLoading:()=>jo===Sm,setState(r){jo=r.pluginStatus,Cc=r.pluginURL},isParsed:()=>sa.applyArabicShaping!=null&&sa.processBidirectionalText!=null&&sa.processStyledBidirectionalText!=null,getPluginURL:()=>Cc};class Yr{constructor(n,l){this.zoom=n,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.transition=l.transition,this.pitch=l.pitch,this.brightness=l.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(n){return function(l,d){for(let p of l)if(!Y_(p.charCodeAt(0),d))return!1;return!0}(n,sa.isLoaded())}}class Pp{constructor(n,l,d,p){this.property=n,this.value=l,this.expression=function(m,y,w,T){if(Mp(m))return new Hd(m,y);if(Vd(m)||Array.isArray(m)&&m.length>0){let E=Cp(m,y,w,T);if(E.result==="error")throw new Error(E.value.map(I=>`${I.key}: ${I.message}`).join(", "));return E.value}{let E=m;return typeof m=="string"&&y.type==="color"&&(E=qr.parse(m)),{kind:"constant",isConfigDependent:!1,evaluate:()=>E}}}(l===void 0?n.specification.default:l,n.specification,d,p)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(n,l,d){return this.property.possiblyEvaluate(this,n,l,d)}}class Im{constructor(n,l,d){this.property=n,this.value=new Pp(n,void 0,l,d)}transitioned(n,l){return new Pm(this.property,this.value,l,Tt({},n.transition,this.transition),n.now)}untransitioned(){return new Pm(this.property,this.value,null,{},0)}}class Nl{constructor(n,l,d){this._properties=n,this._values=Object.create(n.defaultTransitionablePropertyValues),this._scope=l,this._options=d,this.isConfigDependent=!1}getValue(n){return Ri(this._values[n].value.value)}setValue(n,l){this._values.hasOwnProperty(n)||(this._values[n]=new Im(this._values[n].property,this._scope,this._options)),this._values[n].value=new Pp(this._values[n].property,l===null?void 0:Ri(l),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[n].value.expression.isConfigDependent}setTransitionOrValue(n,l){l&&(this._options=l);let d=this._properties.properties;if(n)for(let p in n){let m=n[p];if(vi(p,"-transition")){let y=p.slice(0,-11);d[y]&&this.setTransition(y,m)}else d[p]&&this.setValue(p,m)}}getTransition(n){return Ri(this._values[n].transition)}setTransition(n,l){this._values.hasOwnProperty(n)||(this._values[n]=new Im(this._values[n].property)),this._values[n].transition=Ri(l)||void 0}serialize(){let n={};for(let l of Object.keys(this._values)){let d=this.getValue(l);d!==void 0&&(n[l]=d);let p=this.getTransition(l);p!==void 0&&(n[`${l}-transition`]=p)}return n}transitioned(n,l){let d=new g0(this._properties);for(let p of Object.keys(this._values))d._values[p]=this._values[p].transitioned(n,l._values[p]);return d}untransitioned(){let n=new g0(this._properties);for(let l of Object.keys(this._values))n._values[l]=this._values[l].untransitioned();return n}}class Pm{constructor(n,l,d,p,m){let y=p.delay||0,w=p.duration||0;m=m||0,this.property=n,this.value=l,this.begin=m+y,this.end=this.begin+w,n.specification.transition&&(p.delay||p.duration)&&(this.prior=d)}possiblyEvaluate(n,l,d){let p=n.now||0,m=this.value.possiblyEvaluate(n,l,d),y=this.prior;if(y){if(p>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(p<this.begin)return y.possiblyEvaluate(n,l,d);{let w=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(n,l,d),m,Ne(w))}}return m}}class g0{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitioningPropertyValues)}possiblyEvaluate(n,l,d){let p=new qd(this._properties);for(let m of Object.keys(this._values))p._values[m]=this._values[m].possiblyEvaluate(n,l,d);return p}hasTransition(){for(let n of Object.keys(this._values))if(this._values[n].prior)return!0;return!1}}class Gy{constructor(n,l,d){this._properties=n,this._values=Object.create(n.defaultPropertyValues),this._scope=l,this._options=d,this.isConfigDependent=!1}getValue(n){return Ri(this._values[n].value)}setValue(n,l){this._values[n]=new Pp(this._values[n].property,l===null?void 0:Ri(l),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[n].expression.isConfigDependent}serialize(){let n={};for(let l of Object.keys(this._values)){let d=this.getValue(l);d!==void 0&&(n[l]=d)}return n}possiblyEvaluate(n,l,d){let p=new qd(this._properties);for(let m of Object.keys(this._values))p._values[m]=this._values[m].possiblyEvaluate(n,l,d);return p}}class fh{constructor(n,l,d){this.property=n,this.value=l,this.parameters=d}isConstant(){return this.value.kind==="constant"}constantOr(n){return this.value.kind==="constant"?this.value.value:n}evaluate(n,l,d,p){return this.property.evaluate(this.value,this.parameters,n,l,d,p)}}class qd{constructor(n){this._properties=n,this._values=Object.create(n.defaultPossiblyEvaluatedValues)}get(n){return this._values[n]}}class qt{constructor(n){this.specification=n}possiblyEvaluate(n,l){return n.expression.evaluate(l)}interpolate(n,l,d){let p=wa[this.specification.type];return p?p(n,l,d):n}}class Ai{constructor(n,l){this.specification=n,this.overrides=l}possiblyEvaluate(n,l,d,p){return new fh(this,n.expression.kind==="constant"||n.expression.kind==="camera"?{kind:"constant",value:n.expression.evaluate(l,null,{},d,p)}:n.expression,l)}interpolate(n,l,d){if(n.value.kind!=="constant"||l.value.kind!=="constant")return n;if(n.value.value===void 0||l.value.value===void 0)return new fh(this,{kind:"constant",value:void 0},n.parameters);let p=wa[this.specification.type];return p?new fh(this,{kind:"constant",value:p(n.value.value,l.value.value,d)},n.parameters):n}evaluate(n,l,d,p,m,y){return n.kind==="constant"?n.value:n.evaluate(l,d,p,m,y)}}class _0{constructor(n){this.specification=n}possiblyEvaluate(n,l,d,p){return!!n.expression.evaluate(l,null,{},d,p)}interpolate(){return!1}}class Jr{constructor(n){this.properties=n,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];let l=new Yr(0,{});for(let d in n){let p=n[d];p.specification.overridable&&this.overridableProperties.push(d);let m=this.defaultPropertyValues[d]=new Pp(p,void 0),y=this.defaultTransitionablePropertyValues[d]=new Im(p);this.defaultTransitioningPropertyValues[d]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[d]=m.possiblyEvaluate(l)}}}function Xd(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function Zd(r){if(Array.isArray(r))return r.map(Zd);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){let n={};for(let l in r)n[l]=Zd(r[l]);return n}return Xd(r)}hi(Ai,"DataDrivenProperty"),hi(qt,"DataConstantProperty"),hi(_0,"ColorRampProperty");var $e=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Rm(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(let n of r.slice(1))if(!Rm(n)&&typeof n!="boolean")return!1;return!0;default:return!0}}function oa(r,n="fill"){if(r==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Rm(r)||(r=$d(r));let l=r,d=!0;try{d=function(E){if(!mh(E))return E;let I=Zd(E);return km(I),I=K_(I),I}(l)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(l,null,2)}
        `)}let p=$e[`filter_${n}`],m=Ap(d,p),y=null;if(m.result==="error")throw new Error(m.value.map(E=>`${E.key}: ${E.message}`).join(", "));y=(E,I,R)=>m.value.evaluate(E,I,{},R);let w=null,T=null;if(d!==l){let E=Ap(l,p);if(E.result==="error")throw new Error(E.value.map(I=>`${I.key}: ${I.message}`).join(", "));w=(I,R,F,B,V)=>E.value.evaluate(I,R,{},F,void 0,void 0,B,V),T=!sh(E.value.expression)}return{filter:y,dynamicFilter:w||void 0,needGeometry:Q_(d),needFeature:!!T}}function K_(r){if(!Array.isArray(r))return r;let n=function(l){if(Hy.has(l[0])){for(let d=1;d<l.length;d++)if(mh(l[d]))return!0}return l}(r);return n===!0?n:n.map(l=>K_(l))}function km(r){let n=!1,l=[];if(r[0]==="case"){for(let d=1;d<r.length-1;d+=2)n=n||mh(r[d]),l.push(r[d+1]);l.push(r[r.length-1])}else if(r[0]==="match"){n=n||mh(r[1]);for(let d=2;d<r.length-1;d+=2)l.push(r[d+1]);l.push(r[r.length-1])}else if(r[0]==="step"){n=n||mh(r[1]);for(let d=1;d<r.length-1;d+=2)l.push(r[d+1])}n&&(r.length=0,r.push("any",...l));for(let d=1;d<r.length;d++)km(r[d])}function mh(r){if(!Array.isArray(r))return!1;if((n=r[0])==="pitch"||n==="distance-from-center")return!0;var n;for(let l=1;l<r.length;l++)if(mh(r[l]))return!0;return!1}let Hy=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function jy(r,n){return r<n?-1:r>n?1:0}function Q_(r){if(!Array.isArray(r))return!1;if(r[0]==="within"||r[0]==="distance")return!0;for(let n=1;n<r.length;n++)if(Q_(r[n]))return!0;return!1}function $d(r){if(!r)return!0;let n=r[0];return r.length<=1?n!=="any":n==="=="?Yd(r[1],r[2],"=="):n==="!="?Jd(Yd(r[1],r[2],"==")):n==="<"||n===">"||n==="<="||n===">="?Yd(r[1],r[2],n):n==="any"?(l=r.slice(1),["any"].concat(l.map($d))):n==="all"?["all"].concat(r.slice(1).map($d)):n==="none"?["all"].concat(r.slice(1).map($d).map(Jd)):n==="in"?Dm(r[1],r.slice(2)):n==="!in"?Jd(Dm(r[1],r.slice(2))):n==="has"?e4(r[1]):n!=="!has"||Jd(e4(r[1]));var l}function Yd(r,n,l){switch(r){case"$type":return[`filter-type-${l}`,n];case"$id":return[`filter-id-${l}`,n];default:return[`filter-${l}`,r,n]}}function Dm(r,n){if(n.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",n]];case"$id":return["filter-id-in",["literal",n]];default:return n.length>200&&!n.some(l=>typeof l!=typeof n[0])?["filter-in-large",r,["literal",n.sort(jy)]]:["filter-in-small",r,["literal",n]]}}function e4(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function Jd(r){return["!",r]}let Rp="";function Lm(r,n){return n?`${r}${Rp}${n}`:r}let Kd="-transition";class Wo extends So{constructor(n,l,d,p){if(super(),this.id=n.id,this.fqid=Lm(this.id,d),this.type=n.type,this.scope=d,this.options=p,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,n.type!=="custom"&&(this.metadata=n.metadata,this.minzoom=n.minzoom,this.maxzoom=n.maxzoom,n.type!=="background"&&n.type!=="sky"&&n.type!=="slot"&&(this.source=n.source,this.sourceLayer=n["source-layer"],this.filter=n.filter),n.slot&&(this.slot=n.slot),l.layout&&(this._unevaluatedLayout=new Gy(l.layout,this.scope,p),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),l.paint)){this._transitionablePaint=new Nl(l.paint,this.scope,p);for(let m in n.paint)this.setPaintProperty(m,n.paint[m]);for(let m in n.layout)this.setLayoutProperty(m,n.layout[m]);this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new qd(l.paint)}}getLayoutProperty(n){return n==="visibility"?this.visibility:this._unevaluatedLayout.getValue(n)}setLayoutProperty(n,l){if(this.type==="custom"&&n==="visibility")return void(this.visibility=l);let d=this._unevaluatedLayout;d._properties.properties[n]&&(d.setValue(n,l),this.isConfigDependent=this.isConfigDependent||d.isConfigDependent,n==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(n){return vi(n,Kd)?this._transitionablePaint.getTransition(n.slice(0,-11)):this._transitionablePaint.getValue(n)}setPaintProperty(n,l){let d=this._transitionablePaint,p=d._properties.properties;if(vi(n,Kd)){let R=n.slice(0,-11);return p[R]&&d.setTransition(R,l||void 0),!1}if(!p[n])return!1;let m=d._values[n],y=m.value.isDataDriven(),w=m.value;d.setValue(n,l),this.isConfigDependent=this.isConfigDependent||d.isConfigDependent,this._handleSpecialPaintPropertyUpdate(n);let T=d._values[n].value,E=T.isDataDriven(),I=vi(n,"pattern")||n==="line-dasharray";return E||y||I||this._handleOverridablePaintPropertyUpdate(n,w,T)}_handleSpecialPaintPropertyUpdate(n){}getProgramIds(){return null}getDefaultProgramParams(n,l){return null}_handleOverridablePaintPropertyUpdate(n,l,d){return!1}isHidden(n){return!!(this.minzoom&&n<this.minzoom)||!!(this.maxzoom&&n>=this.maxzoom)||this.visibility==="none"}updateTransitions(n){this._transitioningPaint=this._transitionablePaint.transitioned(n,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(n,l){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(n,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(n,void 0,l)}serialize(){return Fi({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(n,l)=>!(n===void 0||l==="layout"&&!Object.keys(n).length||l==="paint"&&!Object.keys(n).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(let n in this.paint._values){let l=this.paint.get(n);if(l instanceof fh&&Tp(l.property.specification)&&(l.value.kind==="source"||l.value.kind==="composite")&&l.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=oa(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(n){this._stats&&(n.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}}let Wy={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class kp{constructor(n,l){this._structArray=n,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Gr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(n,l){return n._trim(),l&&(n.isTransferred=!0,l.add(n.arrayBuffer)),{length:n.length,arrayBuffer:n.arrayBuffer}}static deserialize(n){let l=Object.create(this.prototype);return l.arrayBuffer=n.arrayBuffer,l.length=n.length,l.capacity=n.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(n){this.reserve(n),this.length=n}reserve(n){if(n>this.capacity){this.capacity=Math.max(n,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...n){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...n){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function gr(r,n=1){let l=0,d=0;return{members:r.map(p=>{let m=Wy[p.type].BYTES_PER_ELEMENT,y=l=Qd(l,Math.max(n,m)),w=p.components||1;return d=Math.max(d,m),l+=m*w,{name:p.name,type:p.type,components:w,offset:y}}),size:Qd(l,Math.max(d,n)),alignment:n}}function Qd(r,n){return Math.ceil(r/n)*n}class Za extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,l){let d=this.length;return this.resize(d+1),this.emplace(d,n,l)}emplace(n,l,d){let p=2*n;return this.int16[p+0]=l,this.int16[p+1]=d,n}}Za.prototype.bytesPerElement=4,hi(Za,"StructArrayLayout2i4");class Lo extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,l,d){let p=this.length;return this.resize(p+1),this.emplace(p,n,l,d)}emplace(n,l,d,p){let m=3*n;return this.int16[m+0]=l,this.int16[m+1]=d,this.int16[m+2]=p,n}}Lo.prototype.bytesPerElement=6,hi(Lo,"StructArrayLayout3i6");class zl extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,l,d,p){let m=this.length;return this.resize(m+1),this.emplace(m,n,l,d,p)}emplace(n,l,d,p,m){let y=4*n;return this.int16[y+0]=l,this.int16[y+1]=d,this.int16[y+2]=p,this.int16[y+3]=m,n}}zl.prototype.bytesPerElement=8,hi(zl,"StructArrayLayout4i8");class Fm extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,l,d,p,m){let y=this.length;return this.resize(y+1),this.emplace(y,n,l,d,p,m)}emplace(n,l,d,p,m,y){let w=5*n;return this.int16[w+0]=l,this.int16[w+1]=d,this.int16[w+2]=p,this.int16[w+3]=m,this.int16[w+4]=y,n}}Fm.prototype.bytesPerElement=10,hi(Fm,"StructArrayLayout5i10");class Om extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,l,d,p,m,y,w){let T=this.length;return this.resize(T+1),this.emplace(T,n,l,d,p,m,y,w)}emplace(n,l,d,p,m,y,w,T){let E=6*n,I=12*n,R=3*n;return this.int16[E+0]=l,this.int16[E+1]=d,this.uint8[I+4]=p,this.uint8[I+5]=m,this.uint8[I+6]=y,this.uint8[I+7]=w,this.float32[R+2]=T,n}}Om.prototype.bytesPerElement=12,hi(Om,"StructArrayLayout2i4ub1f12");class Pc extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,l,d,p){let m=this.length;return this.resize(m+1),this.emplace(m,n,l,d,p)}emplace(n,l,d,p,m){let y=4*n;return this.float32[y+0]=l,this.float32[y+1]=d,this.float32[y+2]=p,this.float32[y+3]=m,n}}Pc.prototype.bytesPerElement=16,hi(Pc,"StructArrayLayout4f16");class Rc extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,l,d,p,m){let y=this.length;return this.resize(y+1),this.emplace(y,n,l,d,p,m)}emplace(n,l,d,p,m,y){let w=6*n,T=3*n;return this.uint16[w+0]=l,this.uint16[w+1]=d,this.uint16[w+2]=p,this.uint16[w+3]=m,this.float32[T+2]=y,n}}Rc.prototype.bytesPerElement=12,hi(Rc,"StructArrayLayout4ui1f12");class gh extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,l,d,p){let m=this.length;return this.resize(m+1),this.emplace(m,n,l,d,p)}emplace(n,l,d,p,m){let y=4*n;return this.uint16[y+0]=l,this.uint16[y+1]=d,this.uint16[y+2]=p,this.uint16[y+3]=m,n}}gh.prototype.bytesPerElement=8,hi(gh,"StructArrayLayout4ui8");class Dp extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,l,d,p,m,y){let w=this.length;return this.resize(w+1),this.emplace(w,n,l,d,p,m,y)}emplace(n,l,d,p,m,y,w){let T=6*n;return this.int16[T+0]=l,this.int16[T+1]=d,this.int16[T+2]=p,this.int16[T+3]=m,this.int16[T+4]=y,this.int16[T+5]=w,n}}Dp.prototype.bytesPerElement=12,hi(Dp,"StructArrayLayout6i12");class eu extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,l,d,p,m,y,w,T,E,I,R,F){let B=this.length;return this.resize(B+1),this.emplace(B,n,l,d,p,m,y,w,T,E,I,R,F)}emplace(n,l,d,p,m,y,w,T,E,I,R,F,B){let V=12*n;return this.int16[V+0]=l,this.int16[V+1]=d,this.int16[V+2]=p,this.int16[V+3]=m,this.uint16[V+4]=y,this.uint16[V+5]=w,this.uint16[V+6]=T,this.uint16[V+7]=E,this.int16[V+8]=I,this.int16[V+9]=R,this.int16[V+10]=F,this.int16[V+11]=B,n}}eu.prototype.bytesPerElement=24,hi(eu,"StructArrayLayout4i4ui4i24");class Nm extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,l,d,p,m,y){let w=this.length;return this.resize(w+1),this.emplace(w,n,l,d,p,m,y)}emplace(n,l,d,p,m,y,w){let T=10*n,E=5*n;return this.int16[T+0]=l,this.int16[T+1]=d,this.int16[T+2]=p,this.float32[E+2]=m,this.float32[E+3]=y,this.float32[E+4]=w,n}}Nm.prototype.bytesPerElement=20,hi(Nm,"StructArrayLayout3i3f20");class zm extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n){let l=this.length;return this.resize(l+1),this.emplace(l,n)}emplace(n,l){return this.uint32[1*n+0]=l,n}}zm.prototype.bytesPerElement=4,hi(zm,"StructArrayLayout1ul4");class yl extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,l){let d=this.length;return this.resize(d+1),this.emplace(d,n,l)}emplace(n,l,d){let p=2*n;return this.uint16[p+0]=l,this.uint16[p+1]=d,n}}yl.prototype.bytesPerElement=4,hi(yl,"StructArrayLayout2ui4");class Bm extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,l,d,p,m,y,w,T,E,I,R,F,B){let V=this.length;return this.resize(V+1),this.emplace(V,n,l,d,p,m,y,w,T,E,I,R,F,B)}emplace(n,l,d,p,m,y,w,T,E,I,R,F,B,V){let W=20*n,$=10*n;return this.int16[W+0]=l,this.int16[W+1]=d,this.int16[W+2]=p,this.int16[W+3]=m,this.int16[W+4]=y,this.float32[$+3]=w,this.float32[$+4]=T,this.float32[$+5]=E,this.float32[$+6]=I,this.int16[W+14]=R,this.uint32[$+8]=F,this.uint16[W+18]=B,this.uint16[W+19]=V,n}}Bm.prototype.bytesPerElement=40,hi(Bm,"StructArrayLayout5i4f1i1ul2ui40");class tu extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,l,d,p,m,y,w){let T=this.length;return this.resize(T+1),this.emplace(T,n,l,d,p,m,y,w)}emplace(n,l,d,p,m,y,w,T){let E=8*n;return this.int16[E+0]=l,this.int16[E+1]=d,this.int16[E+2]=p,this.int16[E+4]=m,this.int16[E+5]=y,this.int16[E+6]=w,this.int16[E+7]=T,n}}tu.prototype.bytesPerElement=16,hi(tu,"StructArrayLayout3i2i2i16");class Lp extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,l,d,p,m){let y=this.length;return this.resize(y+1),this.emplace(y,n,l,d,p,m)}emplace(n,l,d,p,m,y){let w=4*n,T=8*n;return this.float32[w+0]=l,this.float32[w+1]=d,this.float32[w+2]=p,this.int16[T+6]=m,this.int16[T+7]=y,n}}Lp.prototype.bytesPerElement=16,hi(Lp,"StructArrayLayout2f1f2i16");class Um extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,l,d,p){let m=this.length;return this.resize(m+1),this.emplace(m,n,l,d,p)}emplace(n,l,d,p,m){let y=12*n,w=3*n;return this.uint8[y+0]=l,this.uint8[y+1]=d,this.float32[w+1]=p,this.float32[w+2]=m,n}}Um.prototype.bytesPerElement=12,hi(Um,"StructArrayLayout2ub2f12");class Us extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,l,d){let p=this.length;return this.resize(p+1),this.emplace(p,n,l,d)}emplace(n,l,d,p){let m=3*n;return this.uint16[m+0]=l,this.uint16[m+1]=d,this.uint16[m+2]=p,n}}Us.prototype.bytesPerElement=6,hi(Us,"StructArrayLayout3ui6");class _h extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n,l,d,p,m,y,w,T,E,I,R,F,B,V,W,$,J,le,pe,ue,Me){let xe=this.length;return this.resize(xe+1),this.emplace(xe,n,l,d,p,m,y,w,T,E,I,R,F,B,V,W,$,J,le,pe,ue,Me)}emplace(n,l,d,p,m,y,w,T,E,I,R,F,B,V,W,$,J,le,pe,ue,Me,xe){let ke=30*n,Be=15*n,We=60*n;return this.int16[ke+0]=l,this.int16[ke+1]=d,this.int16[ke+2]=p,this.float32[Be+2]=m,this.float32[Be+3]=y,this.uint16[ke+8]=w,this.uint16[ke+9]=T,this.uint32[Be+5]=E,this.uint32[Be+6]=I,this.uint32[Be+7]=R,this.uint16[ke+16]=F,this.uint16[ke+17]=B,this.uint16[ke+18]=V,this.float32[Be+10]=W,this.float32[Be+11]=$,this.uint8[We+48]=J,this.uint8[We+49]=le,this.uint8[We+50]=pe,this.uint32[Be+13]=ue,this.int16[ke+28]=Me,this.uint8[We+58]=xe,n}}_h.prototype.bytesPerElement=60,hi(_h,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Fp extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n,l,d,p,m,y,w,T,E,I,R,F,B,V,W,$,J,le,pe,ue,Me,xe,ke,Be,We,Ke,qe,dt,Mt,rt,vt,it){let yt=this.length;return this.resize(yt+1),this.emplace(yt,n,l,d,p,m,y,w,T,E,I,R,F,B,V,W,$,J,le,pe,ue,Me,xe,ke,Be,We,Ke,qe,dt,Mt,rt,vt,it)}emplace(n,l,d,p,m,y,w,T,E,I,R,F,B,V,W,$,J,le,pe,ue,Me,xe,ke,Be,We,Ke,qe,dt,Mt,rt,vt,it,yt){let Xt=20*n,At=40*n,fi=80*n;return this.float32[Xt+0]=l,this.float32[Xt+1]=d,this.int16[At+4]=p,this.int16[At+5]=m,this.int16[At+6]=y,this.int16[At+7]=w,this.int16[At+8]=T,this.int16[At+9]=E,this.int16[At+10]=I,this.int16[At+11]=R,this.int16[At+12]=F,this.uint16[At+13]=B,this.uint16[At+14]=V,this.uint16[At+15]=W,this.uint16[At+16]=$,this.uint16[At+17]=J,this.uint16[At+18]=le,this.uint16[At+19]=pe,this.uint16[At+20]=ue,this.uint16[At+21]=Me,this.uint16[At+22]=xe,this.uint16[At+23]=ke,this.uint16[At+24]=Be,this.uint16[At+25]=We,this.uint16[At+26]=Ke,this.uint16[At+27]=qe,this.uint32[Xt+14]=dt,this.float32[Xt+15]=Mt,this.float32[Xt+16]=rt,this.float32[Xt+17]=vt,this.float32[Xt+18]=it,this.uint8[fi+76]=yt,n}}Fp.prototype.bytesPerElement=80,hi(Fp,"StructArrayLayout2f9i15ui1ul4f1ub80");class iu extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n){let l=this.length;return this.resize(l+1),this.emplace(l,n)}emplace(n,l){return this.float32[1*n+0]=l,n}}iu.prototype.bytesPerElement=4,hi(iu,"StructArrayLayout1f4");class kc extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,l,d,p,m){let y=this.length;return this.resize(y+1),this.emplace(y,n,l,d,p,m)}emplace(n,l,d,p,m,y){let w=5*n;return this.float32[w+0]=l,this.float32[w+1]=d,this.float32[w+2]=p,this.float32[w+3]=m,this.float32[w+4]=y,n}}kc.prototype.bytesPerElement=20,hi(kc,"StructArrayLayout5f20");class Vm extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,l,d,p,m,y,w){let T=this.length;return this.resize(T+1),this.emplace(T,n,l,d,p,m,y,w)}emplace(n,l,d,p,m,y,w,T){let E=7*n;return this.float32[E+0]=l,this.float32[E+1]=d,this.float32[E+2]=p,this.float32[E+3]=m,this.float32[E+4]=y,this.float32[E+5]=w,this.float32[E+6]=T,n}}Vm.prototype.bytesPerElement=28,hi(Vm,"StructArrayLayout7f28");class nu extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,l,d,p){let m=this.length;return this.resize(m+1),this.emplace(m,n,l,d,p)}emplace(n,l,d,p,m){let y=6*n;return this.uint32[3*n+0]=l,this.uint16[y+2]=d,this.uint16[y+3]=p,this.uint16[y+4]=m,n}}nu.prototype.bytesPerElement=12,hi(nu,"StructArrayLayout1ul3ui12");class Gm extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n){let l=this.length;return this.resize(l+1),this.emplace(l,n)}emplace(n,l){return this.uint16[1*n+0]=l,n}}Gm.prototype.bytesPerElement=2,hi(Gm,"StructArrayLayout1ui2");class y0 extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,l,d){let p=this.length;return this.resize(p+1),this.emplace(p,n,l,d)}emplace(n,l,d,p){let m=3*n;return this.float32[m+0]=l,this.float32[m+1]=d,this.float32[m+2]=p,n}}y0.prototype.bytesPerElement=12,hi(y0,"StructArrayLayout3f12");class ru extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,l){let d=this.length;return this.resize(d+1),this.emplace(d,n,l)}emplace(n,l,d){let p=2*n;return this.float32[p+0]=l,this.float32[p+1]=d,n}}ru.prototype.bytesPerElement=8,hi(ru,"StructArrayLayout2f8");class Hm extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,l,d,p,m,y,w,T,E,I,R,F,B,V,W,$){let J=this.length;return this.resize(J+1),this.emplace(J,n,l,d,p,m,y,w,T,E,I,R,F,B,V,W,$)}emplace(n,l,d,p,m,y,w,T,E,I,R,F,B,V,W,$,J){let le=16*n;return this.float32[le+0]=l,this.float32[le+1]=d,this.float32[le+2]=p,this.float32[le+3]=m,this.float32[le+4]=y,this.float32[le+5]=w,this.float32[le+6]=T,this.float32[le+7]=E,this.float32[le+8]=I,this.float32[le+9]=R,this.float32[le+10]=F,this.float32[le+11]=B,this.float32[le+12]=V,this.float32[le+13]=W,this.float32[le+14]=$,this.float32[le+15]=J,n}}Hm.prototype.bytesPerElement=64,hi(Hm,"StructArrayLayout16f64");class su extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,l,d,p,m,y,w){let T=this.length;return this.resize(T+1),this.emplace(T,n,l,d,p,m,y,w)}emplace(n,l,d,p,m,y,w,T){let E=10*n,I=5*n;return this.uint16[E+0]=l,this.uint16[E+1]=d,this.uint16[E+2]=p,this.uint16[E+3]=m,this.float32[I+2]=y,this.float32[I+3]=w,this.float32[I+4]=T,n}}su.prototype.bytesPerElement=20,hi(su,"StructArrayLayout4ui3f20");class jm extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(n){let l=this.length;return this.resize(l+1),this.emplace(l,n)}emplace(n,l){return this.uint8[1*n+0]=l,n}}jm.prototype.bytesPerElement=1,hi(jm,"StructArrayLayout1ub1");class t4 extends kp{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}t4.prototype.size=40;class i4 extends Bm{get(n){return new t4(this,n)}}hi(i4,"CollisionBoxArray");class n4 extends kp{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(n){this._structArray.uint8[this._pos1+49]=n}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(n){this._structArray.uint8[this._pos1+50]=n}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(n){this._structArray.uint32[this._pos4+13]=n}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(n){this._structArray.uint8[this._pos1+58]=n}}n4.prototype.size=60;class r4 extends _h{get(n){return new n4(this,n)}}hi(r4,"PlacedSymbolArray");class s4 extends kp{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(n){this._structArray.uint32[this._pos4+14]=n}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(n){this._structArray.float32[this._pos4+18]=n}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}s4.prototype.size=80;class o4 extends Fp{get(n){return new s4(this,n)}}hi(o4,"SymbolInstanceArray");class a4 extends iu{getoffsetX(n){return this.float32[1*n+0]}}hi(a4,"GlyphOffsetArray");class ou extends Za{getx(n){return this.int16[2*n+0]}gety(n){return this.int16[2*n+1]}}hi(ou,"SymbolLineVertexArray");class l4 extends kp{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}l4.prototype.size=12;class c4 extends nu{get(n){return new l4(this,n)}}hi(c4,"FeatureIndexArray");class au extends yl{geta_centroid_pos0(n){return this.uint16[2*n+0]}geta_centroid_pos1(n){return this.uint16[2*n+1]}}hi(au,"FillExtrusionCentroidArray");let qy=gr([{name:"a_pos",components:2,type:"Int16"}],4),h4=gr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class ls{constructor(n=[]){this.segments=n}_prepareSegment(n,l,d,p){let m=this.segments[this.segments.length-1];return n>ls.MAX_VERTEX_ARRAY_LENGTH&&Ui(`Max vertices per segment is ${ls.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${n}`),(!m||m.vertexLength+n>ls.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==p)&&(m={vertexOffset:l,primitiveOffset:d,vertexLength:0,primitiveLength:0},p!==void 0&&(m.sortKey=p),this.segments.push(m)),m}prepareSegment(n,l,d,p){return this._prepareSegment(n,l.length,d.length,p)}get(){return this.segments}destroy(){for(let n of this.segments)for(let l in n.vaos)n.vaos[l].destroy()}static simpleSegment(n,l,d,p){return new ls([{vertexOffset:n,primitiveOffset:l,vertexLength:d,primitiveLength:p,vaos:{},sortKey:0}])}}function Wm(r,n){return 256*(r=Xe(Math.floor(r),0,255))+Xe(Math.floor(n),0,255)}ls.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,hi(ls,"SegmentVector");let d4=gr([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),u4=gr([{name:"a_dash",components:4,type:"Uint16"}]);var lu={exports:{}},Op={exports:{}};(function(r){r.exports=function(n,l){var d,p,m,y,w,T,E,I;for(p=n.length-(d=3&n.length),m=l,w=3432918353,T=461845907,I=0;I<p;)E=255&n.charCodeAt(I)|(255&n.charCodeAt(++I))<<8|(255&n.charCodeAt(++I))<<16|(255&n.charCodeAt(++I))<<24,++I,m=27492+(65535&(y=5*(65535&(m=(m^=E=(65535&(E=(E=(65535&E)*w+(((E>>>16)*w&65535)<<16)&4294967295)<<15|E>>>17))*T+(((E>>>16)*T&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(E=0,d){case 3:E^=(255&n.charCodeAt(I+2))<<16;case 2:E^=(255&n.charCodeAt(I+1))<<8;case 1:m^=E=(65535&(E=(E=(65535&(E^=255&n.charCodeAt(I)))*w+(((E>>>16)*w&65535)<<16)&4294967295)<<15|E>>>17))*T+(((E>>>16)*T&65535)<<16)&4294967295}return m^=n.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0}})(Op);var qm=Op.exports,p4={exports:{}};(function(r){r.exports=function(n,l){for(var d,p=n.length,m=l^p,y=0;p>=4;)d=1540483477*(65535&(d=255&n.charCodeAt(y)|(255&n.charCodeAt(++y))<<8|(255&n.charCodeAt(++y))<<16|(255&n.charCodeAt(++y))<<24))+((1540483477*(d>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(d=1540483477*(65535&(d^=d>>>24))+((1540483477*(d>>>16)&65535)<<16)),p-=4,++y;switch(p){case 3:m^=(255&n.charCodeAt(y+2))<<16;case 2:m^=(255&n.charCodeAt(y+1))<<8;case 1:m=1540483477*(65535&(m^=255&n.charCodeAt(y)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0}})(p4);var f4=qm,m4=p4.exports;lu.exports=f4,lu.exports.murmur3=f4,lu.exports.murmur2=m4;var Xm=G(lu.exports);class cu{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(n,l,d,p){this.ids.push(g4(n)),this.positions.push(l,d,p)}eachPosition(n,l){let d=g4(n),p=0,m=this.ids.length-1;for(;p<m;){let y=p+m>>1;this.ids[y]>=d?m=y:p=y+1}for(;this.ids[p]===d;)l(this.positions[3*p],this.positions[3*p+1],this.positions[3*p+2]),p++}static serialize(n,l){let d=new Float64Array(n.ids),p=new Uint32Array(n.positions);return Zm(d,p,0,d.length-1),l&&(l.add(d.buffer),l.add(p.buffer)),{ids:d,positions:p}}static deserialize(n){let l=new cu,d;l.ids=n.ids,l.positions=n.positions;for(let p of l.ids)p!==d&&l.uniqueIds.push(p),d=p;return l.indexed=!0,l}}function g4(r){let n=+r;return!isNaN(n)&&Number.MIN_SAFE_INTEGER<=n&&n<=Number.MAX_SAFE_INTEGER?n:Xm(String(r))}function Zm(r,n,l,d){for(;l<d;){let p=r[l+d>>1],m=l-1,y=d+1;for(;;){do m++;while(r[m]<p);do y--;while(r[y]>p);if(m>=y)break;Np(r,m,y),Np(n,3*m,3*y),Np(n,3*m+1,3*y+1),Np(n,3*m+2,3*y+2)}y-l<d-y?(Zm(r,n,l,y),l=y+1):(Zm(r,n,y+1,d),d=y)}}function Np(r,n,l){let d=r[n];r[n]=r[l],r[l]=d}hi(cu,"FeaturePositionMap");class Bl{constructor(n){this.gl=n.gl,this.initialized=!1}fetchUniformLocation(n,l){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(n,l),this.initialized=!0),!!this.location}}class zp extends Bl{constructor(n){super(n),this.current=0}set(n,l,d){this.fetchUniformLocation(n,l)&&this.current!==d&&(this.current=d,this.gl.uniform1i(this.location,d))}}class To extends Bl{constructor(n){super(n),this.current=0}set(n,l,d){this.fetchUniformLocation(n,l)&&this.current!==d&&(this.current=d,this.gl.uniform1f(this.location,d))}}class Dc extends Bl{constructor(n){super(n),this.current=[0,0]}set(n,l,d){this.fetchUniformLocation(n,l)&&(d[0]===this.current[0]&&d[1]===this.current[1]||(this.current=d,this.gl.uniform2f(this.location,d[0],d[1])))}}class _4 extends Bl{constructor(n){super(n),this.current=[0,0,0]}set(n,l,d){this.fetchUniformLocation(n,l)&&(d[0]===this.current[0]&&d[1]===this.current[1]&&d[2]===this.current[2]||(this.current=d,this.gl.uniform3f(this.location,d[0],d[1],d[2])))}}class g extends Bl{constructor(n){super(n),this.current=[0,0,0,0]}set(n,l,d){this.fetchUniformLocation(n,l)&&(d[0]===this.current[0]&&d[1]===this.current[1]&&d[2]===this.current[2]&&d[3]===this.current[3]||(this.current=d,this.gl.uniform4f(this.location,d[0],d[1],d[2],d[3])))}}class c extends Bl{constructor(n){super(n),this.current=qr.transparent}set(n,l,d){this.fetchUniformLocation(n,l)&&(d.r===this.current.r&&d.g===this.current.g&&d.b===this.current.b&&d.a===this.current.a||(this.current=d,this.gl.uniform4f(this.location,d.r,d.g,d.b,d.a)))}}let u=new Float32Array(16);class _ extends Bl{constructor(n){super(n),this.current=u}set(n,l,d){if(this.fetchUniformLocation(n,l)){if(d[12]!==this.current[12]||d[0]!==this.current[0])return this.current=d,void this.gl.uniformMatrix4fv(this.location,!1,d);for(let p=1;p<16;p++)if(d[p]!==this.current[p]){this.current=d,this.gl.uniformMatrix4fv(this.location,!1,d);break}}}}let b=new Float32Array(9),S=new Float32Array(4);class A extends Bl{constructor(n){super(n),this.current=S}set(n,l,d){if(this.fetchUniformLocation(n,l)){for(let p=0;p<4;p++)if(d[p]!==this.current[p]){this.current=d,this.gl.uniformMatrix2fv(this.location,!1,d);break}}}}function P(r){return[Wm(255*r.r,255*r.g),Wm(255*r.b,255*r.a)]}class k{constructor(n,l,d){this.value=n,this.uniformNames=l.map(p=>`u_${p}`),this.type=d}setUniform(n,l,d,p,m){l.set(n,m,p.constantOr(this.value))}getBinding(n,l){return this.type==="color"?new c(n):new To(n)}}class O{constructor(n,l){this.uniformNames=l.map(d=>`u_${d}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(n){this.pixelRatio=n.pixelRatio||1,this.pattern=n.tl.concat(n.br)}setUniform(n,l,d,p,m){let y=m==="u_pattern"||m==="u_dash"?this.pattern:m==="u_pixel_ratio"?this.pixelRatio:null;y&&l.set(n,m,y)}getBinding(n,l){return l==="u_pattern"||l==="u_dash"?new g(n):new To(n)}}class z{constructor(n,l,d,p){this.expression=n,this.type=d,this.maxValue=0,this.paintVertexAttributes=l.map(m=>({name:`a_${m}`,type:"Float32",components:d==="color"?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(n,l,d,p,m,y,w){let T=this.paintVertexArray.length,E=this.expression.evaluate(new Yr(0,{brightness:y}),l,{},m,p,w);this.paintVertexArray.resize(n),this._setPaintValue(T,n,E)}updatePaintArray(n,l,d,p,m,y,w){let T=this.expression.evaluate({zoom:0,brightness:w},d,p,void 0,m);this._setPaintValue(n,l,T)}_setPaintValue(n,l,d){if(this.type==="color"){let p=P(d);for(let m=n;m<l;m++)this.paintVertexArray.emplace(m,p[0],p[1])}else{for(let p=n;p<l;p++)this.paintVertexArray.emplace(p,d);this.maxValue=Math.max(this.maxValue,Math.abs(d))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class U{constructor(n,l,d,p,m,y){this.expression=n,this.uniformNames=l.map(w=>`u_${w}_t`),this.type=d,this.useIntegerZoom=p,this.zoom=m,this.maxValue=0,this.paintVertexAttributes=l.map(w=>({name:`a_${w}`,type:"Float32",components:d==="color"?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(n,l,d,p,m,y,w){let T=this.expression.evaluate(new Yr(this.zoom,{brightness:y}),l,{},m,p,w),E=this.expression.evaluate(new Yr(this.zoom+1,{brightness:y}),l,{},m,p,w),I=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValue(I,n,T,E)}updatePaintArray(n,l,d,p,m,y,w){let T=this.expression.evaluate({zoom:this.zoom,brightness:w},d,p,void 0,m),E=this.expression.evaluate({zoom:this.zoom+1,brightness:w},d,p,void 0,m);this._setPaintValue(n,l,T,E)}_setPaintValue(n,l,d,p){if(this.type==="color"){let m=P(d),y=P(p);for(let w=n;w<l;w++)this.paintVertexArray.emplace(w,m[0],m[1],y[0],y[1])}else{for(let m=n;m<l;m++)this.paintVertexArray.emplace(m,d,p);this.maxValue=Math.max(this.maxValue,Math.abs(d),Math.abs(p))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(n,l,d,p,m){let y=this.useIntegerZoom?Math.floor(d.zoom):d.zoom,w=Xe(this.expression.interpolationFactor(y,this.zoom,this.zoom+1),0,1);l.set(n,m,w)}getBinding(n,l){return new To(n)}}class q{constructor(n,l,d,p,m){this.expression=n,this.layerId=m,this.paintVertexAttributes=(d==="array"?u4:d4).members;for(let y=0;y<l.length;++y);this.paintVertexArray=new p}populatePaintArray(n,l,d){let p=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValues(p,n,l.patterns&&l.patterns[this.layerId],d)}updatePaintArray(n,l,d,p,m,y,w){this._setPaintValues(n,l,d.patterns&&d.patterns[this.layerId],y)}_setPaintValues(n,l,d,p){if(!p||!d)return;let m=p[d];if(!m)return;let{tl:y,br:w,pixelRatio:T}=m;for(let E=n;E<l;E++)this.paintVertexArray.emplace(E,y[0],y[1],w[0],w[1],T)}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class X{constructor(n,l,d=()=>!0){this.binders={},this._buffers=[];let p=[];for(let m in n.paint._values){let y=n.paint.get(m);if(!d(m)||!(y instanceof fh&&Tp(y.property.specification)))continue;let w=re(m,n.type),T=y.value,E=y.property.specification.type,I=!!y.property.useIntegerZoom,R=m==="line-dasharray"||m.endsWith("pattern"),F=m==="line-dasharray"&&n.layout.get("line-cap").value.kind!=="constant";if(T.kind!=="constant"||F)if(T.kind==="source"||F||R){let B=ge(m,E,"source");this.binders[m]=R?new q(T,w,E,B,n.id):new z(T,w,E,B),p.push(`/a_${m}`)}else{let B=ge(m,E,"composite");this.binders[m]=new U(T,w,E,I,l,B),p.push(`/z_${m}`)}else this.binders[m]=R?new O(T.value,w):new k(T.value,w,E),p.push(`/u_${m}`)}this.cacheKey=p.sort().join("")}getMaxValue(n){let l=this.binders[n];return l instanceof z||l instanceof U?l.maxValue:0}populatePaintArrays(n,l,d,p,m,y,w){for(let T in this.binders){let E=this.binders[T];(E instanceof z||E instanceof U||E instanceof q)&&E.populatePaintArray(n,l,d,p,m,y,w)}}setConstantPatternPositions(n){for(let l in this.binders){let d=this.binders[l];d instanceof O&&d.setConstantPatternPositions(n)}}updatePaintArrays(n,l,d,p,m,y,w,T){let E=!1,I=Object.keys(n),R=I.length!==0,F=R?I:l.uniqueIds;for(let B in this.binders){let V=this.binders[B];if((V instanceof z||V instanceof U||V instanceof q)&&(V.expression.isStateDependent===!0||V.expression.isLightConstant===!1)){let W=m.paint.get(B);V.expression=W.value;for(let $ of F){let J=n[$.toString()];l.eachPosition($,(le,pe,ue)=>{let Me=p.feature(le);V.updatePaintArray(pe,ue,Me,J,y,w,T)})}if(!R)for(let $ of d.uniqueIds){let J=n[$.toString()];d.eachPosition($,(le,pe,ue)=>{let Me=p.feature(le);V.updatePaintArray(pe,ue,Me,J,y,w,T)})}E=!0}}return E}defines(){let n=[];for(let l in this.binders){let d=this.binders[l];(d instanceof k||d instanceof O)&&n.push(...d.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return n}getBinderAttributes(){let n=[];for(let l in this.binders){let d=this.binders[l];if(d instanceof z||d instanceof U||d instanceof q)for(let p=0;p<d.paintVertexAttributes.length;p++)n.push(d.paintVertexAttributes[p].name)}return n}getBinderUniforms(){let n=[];for(let l in this.binders){let d=this.binders[l];if(d instanceof k||d instanceof O||d instanceof U)for(let p of d.uniformNames)n.push(p)}return n}getPaintVertexBuffers(){return this._buffers}getUniforms(n){let l=[];for(let d in this.binders){let p=this.binders[d];if(p instanceof k||p instanceof O||p instanceof U)for(let m of p.uniformNames)l.push({name:m,property:d,binding:p.getBinding(n,m)})}return l}setUniforms(n,l,d,p,m){for(let{name:y,property:w,binding:T}of d)this.binders[w].setUniform(n,T,m,p.get(w),y)}updatePaintBuffers(){this._buffers=[];for(let n in this.binders){let l=this.binders[n];(l instanceof z||l instanceof U||l instanceof q)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(n){for(let l in this.binders){let d=this.binders[l];(d instanceof z||d instanceof U||d instanceof q)&&d.upload(n)}this.updatePaintBuffers()}destroy(){for(let n in this.binders){let l=this.binders[n];(l instanceof z||l instanceof U||l instanceof q)&&l.destroy()}}}class Q{constructor(n,l,d=()=>!0){this.programConfigurations={};for(let p of n)this.programConfigurations[p.id]=new X(p,l,d);this.needsUpload=!1,this._featureMap=new cu,this._featureMapWithoutIds=new cu,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(n,l,d,p,m,y,w,T){for(let E in this.programConfigurations)this.programConfigurations[E].populatePaintArrays(n,l,p,m,y,w,T);l.id!==void 0?this._featureMap.add(l.id,d,this._bufferOffset,n):(this._featureMapWithoutIds.add(this._idlessCounter,d,this._bufferOffset,n),this._idlessCounter+=1),this._bufferOffset=n,this.needsUpload=!0}updatePaintArrays(n,l,d,p,m,y){for(let w of d)this.needsUpload=this.programConfigurations[w.id].updatePaintArrays(n,this._featureMap,this._featureMapWithoutIds,l,w,p,m,y||0)||this.needsUpload}get(n){return this.programConfigurations[n]}upload(n){if(this.needsUpload){for(let l in this.programConfigurations)this.programConfigurations[l].upload(n);this.needsUpload=!1}}destroy(){for(let n in this.programConfigurations)this.programConfigurations[n].destroy()}}let K={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function re(r,n){return K[r]||[r.replace(`${n}-`,"").replace(/-/g,"_")]}let Y={"line-pattern":{source:Rc,composite:Rc},"fill-pattern":{source:Rc,composite:Rc},"fill-extrusion-pattern":{source:Rc,composite:Rc},"line-dasharray":{source:gh,composite:gh}},ae={color:{source:ru,composite:Pc},number:{source:iu,composite:ru}};function ge(r,n,l){let d=Y[r];return d&&d[l]||ae[n][l]}hi(k,"ConstantBinder"),hi(O,"PatternConstantBinder"),hi(z,"SourceExpressionBinder"),hi(q,"PatternCompositeBinder"),hi(U,"CompositeExpressionBinder"),hi(X,"ProgramConfiguration",{omit:["_buffers"]}),hi(Q,"ProgramConfigurationSet");let ce=ii/Math.PI/2,_e=5,oe=6,ve=16383,Ae=64,Re=[Ae,32,16],Oe=-ce,Je=ce;function Ue(r,n,l,d=ce){return l=De(l),[r*Math.sin(l)*d,-n*d,r*Math.cos(l)*d]}function ot(r,n,l){return Ue(Math.cos(De(r)),Math.sin(De(r)),n,l)}let nt=63710088e-1,Rt=2*Math.PI*nt;class je{constructor(n,l){if(isNaN(n)||isNaN(l))throw new Error(`Invalid LngLat object: (${n}, ${l})`);if(this.lng=+n,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new je(Ot(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(n){let l=Math.PI/180,d=this.lat*l,p=n.lat*l,m=Math.sin(d)*Math.sin(p)+Math.cos(d)*Math.cos(p)*Math.cos((n.lng-this.lng)*l);return nt*Math.acos(Math.min(m,1))}toBounds(n=0){let l=360*n/40075017,d=l/Math.cos(Math.PI/180*this.lat);return new tt({lng:this.lng-d,lat:this.lat-l},{lng:this.lng+d,lat:this.lat+l})}toEcef(n){return ot(this.lat,this.lng,ce+n*ce/nt)}static convert(n){if(n instanceof je)return n;if(Array.isArray(n)&&(n.length===2||n.length===3))return new je(Number(n[0]),Number(n[1]));if(!Array.isArray(n)&&typeof n=="object"&&n!==null)return new je(Number("lng"in n?n.lng:n.lon),Number(n.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class tt{constructor(n,l){n&&(l?this.setSouthWest(n).setNorthEast(l):n.length===4?this.setSouthWest([n[0],n[1]]).setNorthEast([n[2],n[3]]):this.setSouthWest(n[0]).setNorthEast(n[1]))}setNorthEast(n){return this._ne=n instanceof je?new je(n.lng,n.lat):je.convert(n),this}setSouthWest(n){return this._sw=n instanceof je?new je(n.lng,n.lat):je.convert(n),this}extend(n){let l=this._sw,d=this._ne,p,m;if(n instanceof je)p=n,m=n;else{if(!(n instanceof tt))return Array.isArray(n)?n.length===4||n.every(Array.isArray)?this.extend(tt.convert(n)):this.extend(je.convert(n)):typeof n=="object"&&n!==null&&n.hasOwnProperty("lat")&&(n.hasOwnProperty("lon")||n.hasOwnProperty("lng"))?this.extend(je.convert(n)):this;if(p=n._sw,m=n._ne,!p||!m)return this}return l||d?(l.lng=Math.min(p.lng,l.lng),l.lat=Math.min(p.lat,l.lat),d.lng=Math.max(m.lng,d.lng),d.lat=Math.max(m.lat,d.lat)):(this._sw=new je(p.lng,p.lat),this._ne=new je(m.lng,m.lat)),this}getCenter(){return new je((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new je(this.getWest(),this.getNorth())}getSouthEast(){return new je(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(n){let{lng:l,lat:d}=je.convert(n),p=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=d&&d<=this._ne.lat&&p}static convert(n){return!n||n instanceof tt?n:new tt(n)}}var Fe={};(function(r,n){(function(l){function d(m,y,w){var T=p(256*m,256*(y=Math.pow(2,w)-y-1),w),E=p(256*(m+1),256*(y+1),w);return T[0]+","+T[1]+","+E[0]+","+E[1]}function p(m,y,w){var T=2*Math.PI*6378137/256/Math.pow(2,w);return[m*T-2*Math.PI*6378137/2,y*T-2*Math.PI*6378137/2]}l.getURL=function(m,y,w,T,E,I){return I=I||{},m+"?"+["bbox="+d(w,T,E),"format="+(I.format||"image/png"),"service="+(I.service||"WMS"),"version="+(I.version||"1.1.1"),"request="+(I.request||"GetMap"),"srs="+(I.srs||"EPSG:3857"),"width="+(I.width||256),"height="+(I.height||256),"layers="+y].join("&")},l.getTileBBox=d,l.getMercCoords=p,Object.defineProperty(l,"__esModule",{value:!0})})(n)})(0,Fe);var Ze=Fe;class Dt{constructor(n,l,d){this.z=n,this.x=l,this.y=d,this.key=ti(0,n,n,l,d)}equals(n){return this.z===n.z&&this.x===n.x&&this.y===n.y}url(n,l){let d=Ze.getTileBBox(this.x,this.y,this.z),p=function(m,y,w){let T,E="";for(let I=m;I>0;I--)T=1<<I-1,E+=(y&T?1:0)+(w&T?2:0);return E}(this.z,this.x,this.y);return n[(this.x+this.y)%n.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(l==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",p).replace("{bbox-epsg-3857}",d)}toString(){return`${this.z}/${this.x}/${this.y}`}}class jt{constructor(n,l){this.wrap=n,this.canonical=l,this.key=ti(n,l.z,l.z,l.x,l.y)}}class Ut{constructor(n,l,d,p,m){this.overscaledZ=n,this.wrap=l,this.canonical=new Dt(d,+p,+m),this.key=l===0&&n===d?this.canonical.key:ti(l,n,d,p,m)}equals(n){return this.overscaledZ===n.overscaledZ&&this.wrap===n.wrap&&this.canonical.equals(n.canonical)}scaledTo(n){let l=this.canonical.z-n;return n>this.canonical.z?new Ut(n,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ut(n,this.wrap,n,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(n,l=!0){if(this.overscaledZ===n&&l)return this.key;if(n>this.canonical.z)return ti(this.wrap*+l,n,this.canonical.z,this.canonical.x,this.canonical.y);{let d=this.canonical.z-n;return ti(this.wrap*+l,n,n,this.canonical.x>>d,this.canonical.y>>d)}}isChildOf(n){if(n.wrap!==this.wrap)return!1;let l=this.canonical.z-n.canonical.z;return n.overscaledZ===0||n.overscaledZ<this.overscaledZ&&n.canonical.z<this.canonical.z&&n.canonical.x===this.canonical.x>>l&&n.canonical.y===this.canonical.y>>l}children(n){if(this.overscaledZ>=n)return[new Ut(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let l=this.canonical.z+1,d=2*this.canonical.x,p=2*this.canonical.y;return[new Ut(l,this.wrap,l,d,p),new Ut(l,this.wrap,l,d+1,p),new Ut(l,this.wrap,l,d,p+1),new Ut(l,this.wrap,l,d+1,p+1)]}isLessThan(n){return this.wrap<n.wrap||!(this.wrap>n.wrap)&&(this.overscaledZ<n.overscaledZ||!(this.overscaledZ>n.overscaledZ)&&(this.canonical.x<n.canonical.x||!(this.canonical.x>n.canonical.x)&&this.canonical.y<n.canonical.y))}wrapped(){return new Ut(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(n){return new Ut(this.overscaledZ,n,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new jt(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function ti(r,n,l,d,p){let m=1<<Math.min(l,22),y=m*(p%m)+d%m;return r&&l<22&&(y+=m*m*((r<0?-2*r-1:2*r)%(1<<2*(22-l)))),16*(32*y+l)+(n-l)}let mi=[r=>{let n=r.canonical.x-1,l=r.wrap;return n<0&&(n=(1<<r.canonical.z)-1,l--),new Ut(r.overscaledZ,l,r.canonical.z,n,r.canonical.y)},r=>{let n=r.canonical.x+1,l=r.wrap;return n===1<<r.canonical.z&&(n=0,l++),new Ut(r.overscaledZ,l,r.canonical.z,n,r.canonical.y)},r=>new Ut(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,(r.canonical.y===0?1<<r.canonical.z:r.canonical.y)-1),r=>new Ut(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y===(1<<r.canonical.z)-1?0:r.canonical.y+1)];hi(Dt,"CanonicalTileID"),hi(Ut,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});let Ei=0,xi=25.5;function Si(r){return Rt*Math.cos(r*Math.PI/180)}function gn(r){return(180+r)/360}function Zi(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function hn(r,n){return r/Si(n)}function an(r){return 360*r-180}function Wn(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function Dr(r,n){return r*Si(Wn(n))}let An=85.051129;function Kr(r){return Math.cos(De(Xe(r,-An,An)))}function Cn(r,n){let l=Xe(n,Ei,xi),d=Math.pow(2,l);return Kr(r)*Rt/(512*d)}function er(r){return 1/Math.cos(r*Math.PI/180)}function In(r,n=0){let l=Math.exp(Math.PI*(1-(r.y+n/ii)/(1<<r.z)*2));return 80150034*l/(l*l+1)/ii/(1<<r.z)}class Kn{constructor(n,l,d=0){this.x=+n,this.y=+l,this.z=+d}static fromLngLat(n,l=0){let d=je.convert(n);return new Kn(gn(d.lng),Zi(d.lat),hn(l,d.lat))}toLngLat(){return new je(an(this.x),Wn(this.y))}toAltitude(){return Dr(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Rt*er(Wn(this.y))}}function Nr(r,n,l,d,p,m,y,w,T){let E=(n+d)/2,I=(l+p)/2,R=new de(E,I);w(R),function(F,B,V,W,$,J){let le=V-$,pe=W-J;return Math.abs((W-B)*le-(V-F)*pe)/Math.hypot(le,pe)}(R.x,R.y,m.x,m.y,y.x,y.y)>=T?(Nr(r,n,l,E,I,m,R,w,T),Nr(r,E,I,d,p,R,y,w,T)):r.push(y)}function ar(r,n,l){let d=r[0],p=d.x,m=d.y;n(d);let y=[d];for(let w=1;w<r.length;w++){let T=r[w],{x:E,y:I}=T;n(T),Nr(y,p,m,E,I,d,T,n,l),p=E,m=I,d=T}return y}function Vs(r,n,l,d){if(d(n,l)){let p=n.add(l)._mult(.5);Vs(r,n,p,d),Vs(r,p,l,d)}else r.push(l)}function oo(r,n){let l=r[0],d=[l];for(let p=1;p<r.length;p++){let m=r[p];Vs(d,l,m,n),l=m}return d}let qo=Math.pow(2,14)-1,vl=-qo-1;function Xo(r,n){let l=Math.round(r.x*n),d=Math.round(r.y*n);return r.x=Xe(l,vl,qo),r.y=Xe(d,vl,qo),(l<r.x||l>r.x+1||d<r.y||d>r.y+1)&&Ui("Geometry exceeds allowed extent, reduce your vector tile buffer size"),r}function Gs(r,n,l){let d=r.loadGeometry(),p=r.extent,m=ii/p;if(n&&l&&l.projection.isReprojectedInTileSpace){let y=1<<n.z,{scale:w,x:T,y:E,projection:I}=l,R=F=>{let B=an((n.x+F.x/p)/y),V=Wn((n.y+F.y/p)/y),W=I.project(B,V);F.x=(W.x*w-T)*p,F.y=(W.y*w-E)*p};for(let F=0;F<d.length;F++)if(r.type!==1)d[F]=ar(d[F],R,1);else{let B=[];for(let V of d[F])V.x<0||V.x>=p||V.y<0||V.y>=p||(R(V),B.push(V));d[F]=B}}for(let y of d)for(let w of y)Xo(w,m);return d}function Rs(r,n){return{type:r.type,id:r.id,properties:r.properties,geometry:n?Gs(r):[]}}function Mo(r,n,l,d,p){r.emplaceBack(2*n+(d+1)/2,2*l+(p+1)/2)}function Fo(r,n,l){r.emplaceBack(n.x,n.y,n.z,l[0]*16384,l[1]*16384,l[2]*16384)}class Zo{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(l=>l.fqid),this.index=n.index,this.hasPattern=!1,this.projection=n.projection,this.layoutVertexArray=new Za,this.indexArray=new Us,this.segments=new ls,this.programConfigurations=new Q(n.layers,n.zoom),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(n,l,d,p){let m=this.layers[0],y=[],w=null;m.type==="circle"&&(w=m.layout.get("circle-sort-key"));for(let{feature:E,id:I,index:R,sourceLayerIndex:F}of n){let B=this.layers[0]._featureFilter.needGeometry,V=Rs(E,B);if(!this.layers[0]._featureFilter.filter(new Yr(this.zoom),V,d))continue;let W=w?w.evaluate(V,{},d):void 0,$={id:I,properties:E.properties,type:E.type,sourceLayerIndex:F,index:R,geometry:B?V.geometry:Gs(E,d,p),patterns:{},sortKey:W};y.push($)}w&&y.sort((E,I)=>E.sortKey-I.sortKey);let T=null;p.projection.name==="globe"&&(this.globeExtVertexArray=new Dp,T=p.projection);for(let E of y){let{geometry:I,index:R,sourceLayerIndex:F}=E,B=n[R].feature;this.addFeature(E,I,R,l.availableImages,d,T,l.brightness),l.featureIndex.insert(B,I,R,F,this.index)}}update(n,l,d,p,m){let y=Object.keys(n).length!==0;y&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(n,l,y?this.stateDependentLayers:this.layers,d,p,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,qy.members),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=n.createVertexBuffer(this.globeExtVertexArray,h4.members))),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(n,l,d,p,m,y,w){for(let T of l)for(let E of T){let I=E.x,R=E.y;if(I<0||I>=ii||R<0||R>=ii)continue;if(y){let V=y.projectTilePoint(I,R,m),W=y.upVector(m,I,R),$=this.globeExtVertexArray;Fo($,V,W),Fo($,V,W),Fo($,V,W),Fo($,V,W)}let F=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,n.sortKey),B=F.vertexLength;Mo(this.layoutVertexArray,I,R,-1,-1),Mo(this.layoutVertexArray,I,R,1,-1),Mo(this.layoutVertexArray,I,R,1,1),Mo(this.layoutVertexArray,I,R,-1,1),this.indexArray.emplaceBack(B,B+1,B+2),this.indexArray.emplaceBack(B,B+2,B+3),F.vertexLength+=4,F.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,d,{},p,m,w)}}function xl(r,n){for(let l=0;l<r.length;l++)if(Ul(n,r[l]))return!0;for(let l=0;l<n.length;l++)if(Ul(r,n[l]))return!0;return!!du(r,n)}function Lc(r,n,l){return!!Ul(r,n)||!!uu(n,r,l)}function v0(r,n){if(r.length===1)return Bp(n,r[0]);for(let l=0;l<n.length;l++){let d=n[l];for(let p=0;p<d.length;p++)if(Ul(r,d[p]))return!0}for(let l=0;l<r.length;l++)if(Bp(n,r[l]))return!0;for(let l=0;l<n.length;l++)if(du(r,n[l]))return!0;return!1}function hu(r,n,l){if(r.length>1){if(du(r,n))return!0;for(let d=0;d<n.length;d++)if(uu(n[d],r,l))return!0}for(let d=0;d<r.length;d++)if(uu(r[d],n,l))return!0;return!1}function du(r,n){if(r.length===0||n.length===0)return!1;for(let l=0;l<r.length-1;l++){let d=r[l],p=r[l+1];for(let m=0;m<n.length-1;m++)if($m(d,p,n[m],n[m+1]))return!0}return!1}function $m(r,n,l,d){return st(r,l,d)!==st(n,l,d)&&st(r,n,l)!==st(r,n,d)}function uu(r,n,l){let d=l*l;if(n.length===1)return r.distSqr(n[0])<d;for(let p=1;p<n.length;p++)if(yh(r,n[p-1],n[p])<d)return!0;return!1}function yh(r,n,l){let d=n.distSqr(l);if(d===0)return r.distSqr(n);let p=((r.x-n.x)*(l.x-n.x)+(r.y-n.y)*(l.y-n.y))/d;return r.distSqr(p<0?n:p>1?l:l.sub(n)._mult(p)._add(n))}function Bp(r,n){let l,d,p,m=!1;for(let y=0;y<r.length;y++){l=r[y];for(let w=0,T=l.length-1;w<l.length;T=w++)d=l[w],p=l[T],d.y>n.y!=p.y>n.y&&n.x<(p.x-d.x)*(n.y-d.y)/(p.y-d.y)+d.x&&(m=!m)}return m}function Ul(r,n){let l=!1;for(let d=0,p=r.length-1;d<r.length;p=d++){let m=r[d],y=r[p];m.y>n.y!=y.y>n.y&&n.x<(y.x-m.x)*(n.y-m.y)/(y.y-m.y)+m.x&&(l=!l)}return l}function X9(r,n,l,d,p){for(let y of r)if(n<=y.x&&l<=y.y&&d>=y.x&&p>=y.y)return!0;let m=[new de(n,l),new de(n,p),new de(d,p),new de(d,l)];if(r.length>2){for(let y of m)if(Ul(r,y))return!0}for(let y=0;y<r.length-1;y++)if(hL(r[y],r[y+1],m))return!0;return!1}function hL(r,n,l){let d=l[0],p=l[2];if(r.x<d.x&&n.x<d.x||r.x>p.x&&n.x>p.x||r.y<d.y&&n.y<d.y||r.y>p.y&&n.y>p.y)return!1;let m=st(r,n,l[0]);return m!==st(r,n,l[1])||m!==st(r,n,l[2])||m!==st(r,n,l[3])}function Up(r,n,l,d,p,m){let y=n.y-r.y,w=r.x-n.x;if(m=m||0){let T=y*y+w*w;if(T===0)return!0;let E=Math.sqrt(T);y/=E,w/=E}return!((l.x-r.x)*y+(l.y-r.y)*w-m<0||(d.x-r.x)*y+(d.y-r.y)*w-m<0||(p.x-r.x)*y+(p.y-r.y)*w-m<0)}function Xy(r,n,l,d,p,m,y){return!(Up(r,n,d,p,m,y)||Up(n,l,d,p,m,y)||Up(l,r,d,p,m,y)||Up(d,p,r,n,l,y)||Up(p,m,r,n,l,y)||Up(m,d,r,n,l,y))}function Vp(r,n,l){let d=n.paint.get(r).value;return d.kind==="constant"?d.value:l.programConfigurations.get(n.id).getMaxValue(r)}function y4(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function Z9(r,n,l,d,p){if(!n[0]&&!n[1])return r;let m=de.convert(n)._mult(p);l==="viewport"&&m._rotate(-d);let y=[];for(let w=0;w<r.length;w++)y.push(r[w].sub(m));return y}function $9(r,n,l,d){let p=de.convert(r)._mult(d);return n==="viewport"&&p._rotate(-l),p}hi(Zo,"CircleBucket",{omit:["layers"]});let dL=new Jr({"circle-sort-key":new Ai($e.layout_circle["circle-sort-key"]),visibility:new qt($e.layout_circle.visibility)});var uL={paint:new Jr({"circle-radius":new Ai($e.paint_circle["circle-radius"]),"circle-color":new Ai($e.paint_circle["circle-color"]),"circle-blur":new Ai($e.paint_circle["circle-blur"]),"circle-opacity":new Ai($e.paint_circle["circle-opacity"]),"circle-translate":new qt($e.paint_circle["circle-translate"]),"circle-translate-anchor":new qt($e.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new qt($e.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new qt($e.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ai($e.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ai($e.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ai($e.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new qt($e.paint_circle["circle-emissive-strength"])}),layout:dL},qs={},Xs={};Object.defineProperty(Xs,"__esModule",{value:!0}),Xs.setMatrixArrayType=function(r){Xs.ARRAY_TYPE=J9=r},Xs.toRadian=function(r){return r*fL},Xs.equals=function(r,n){return Math.abs(r-n)<=Y9*Math.max(1,Math.abs(r),Math.abs(n))},Xs.RANDOM=Xs.ARRAY_TYPE=Xs.EPSILON=void 0;var Y9=1e-6;Xs.EPSILON=Y9;var J9=typeof Float32Array<"u"?Float32Array:Array;Xs.ARRAY_TYPE=J9;var pL=Math.random;Xs.RANDOM=pL;var fL=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var r=0,n=arguments.length;n--;)r+=arguments[n]*arguments[n];return Math.sqrt(r)});var Qr={};function Zy(r){return Zy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Zy(r)}Object.defineProperty(Qr,"__esModule",{value:!0}),Qr.create=function(){var r=new vh.ARRAY_TYPE(4);return vh.ARRAY_TYPE!=Float32Array&&(r[1]=0,r[2]=0),r[0]=1,r[3]=1,r},Qr.clone=function(r){var n=new vh.ARRAY_TYPE(4);return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n},Qr.copy=function(r,n){return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r},Qr.identity=function(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=1,r},Qr.fromValues=function(r,n,l,d){var p=new vh.ARRAY_TYPE(4);return p[0]=r,p[1]=n,p[2]=l,p[3]=d,p},Qr.set=function(r,n,l,d,p){return r[0]=n,r[1]=l,r[2]=d,r[3]=p,r},Qr.transpose=function(r,n){if(r===n){var l=n[1];r[1]=n[2],r[2]=l}else r[0]=n[0],r[1]=n[2],r[2]=n[1],r[3]=n[3];return r},Qr.invert=function(r,n){var l=n[0],d=n[1],p=n[2],m=n[3],y=l*m-p*d;return y?(r[0]=m*(y=1/y),r[1]=-d*y,r[2]=-p*y,r[3]=l*y,r):null},Qr.adjoint=function(r,n){var l=n[0];return r[0]=n[3],r[1]=-n[1],r[2]=-n[2],r[3]=l,r},Qr.determinant=function(r){return r[0]*r[3]-r[2]*r[1]},Qr.multiply=Q9,Qr.rotate=function(r,n,l){var d=n[0],p=n[1],m=n[2],y=n[3],w=Math.sin(l),T=Math.cos(l);return r[0]=d*T+m*w,r[1]=p*T+y*w,r[2]=d*-w+m*T,r[3]=p*-w+y*T,r},Qr.scale=function(r,n,l){var d=n[1],p=n[2],m=n[3],y=l[0],w=l[1];return r[0]=n[0]*y,r[1]=d*y,r[2]=p*w,r[3]=m*w,r},Qr.fromRotation=function(r,n){var l=Math.sin(n),d=Math.cos(n);return r[0]=d,r[1]=l,r[2]=-l,r[3]=d,r},Qr.fromScaling=function(r,n){return r[0]=n[0],r[1]=0,r[2]=0,r[3]=n[1],r},Qr.str=function(r){return"mat2("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+")"},Qr.frob=function(r){return Math.hypot(r[0],r[1],r[2],r[3])},Qr.LDU=function(r,n,l,d){return r[2]=d[2]/d[0],l[0]=d[0],l[1]=d[1],l[3]=d[3]-r[2]*l[1],[r,n,l]},Qr.add=function(r,n,l){return r[0]=n[0]+l[0],r[1]=n[1]+l[1],r[2]=n[2]+l[2],r[3]=n[3]+l[3],r},Qr.subtract=ew,Qr.exactEquals=function(r,n){return r[0]===n[0]&&r[1]===n[1]&&r[2]===n[2]&&r[3]===n[3]},Qr.equals=function(r,n){var l=r[0],d=r[1],p=r[2],m=r[3],y=n[0],w=n[1],T=n[2],E=n[3];return Math.abs(l-y)<=vh.EPSILON*Math.max(1,Math.abs(l),Math.abs(y))&&Math.abs(d-w)<=vh.EPSILON*Math.max(1,Math.abs(d),Math.abs(w))&&Math.abs(p-T)<=vh.EPSILON*Math.max(1,Math.abs(p),Math.abs(T))&&Math.abs(m-E)<=vh.EPSILON*Math.max(1,Math.abs(m),Math.abs(E))},Qr.multiplyScalar=function(r,n,l){return r[0]=n[0]*l,r[1]=n[1]*l,r[2]=n[2]*l,r[3]=n[3]*l,r},Qr.multiplyScalarAndAdd=function(r,n,l,d){return r[0]=n[0]+l[0]*d,r[1]=n[1]+l[1]*d,r[2]=n[2]+l[2]*d,r[3]=n[3]+l[3]*d,r},Qr.sub=Qr.mul=void 0;var vh=function(r,n){if(r&&r.__esModule)return r;if(r===null||Zy(r)!=="object"&&typeof r!="function")return{default:r};var l=K9(void 0);if(l&&l.has(r))return l.get(r);var d={},p=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in r)if(m!=="default"&&Object.prototype.hasOwnProperty.call(r,m)){var y=p?Object.getOwnPropertyDescriptor(r,m):null;y&&(y.get||y.set)?Object.defineProperty(d,m,y):d[m]=r[m]}return d.default=r,l&&l.set(r,d),d}(Xs);function K9(r){if(typeof WeakMap!="function")return null;var n=new WeakMap,l=new WeakMap;return(K9=function(d){return d?l:n})(r)}function Q9(r,n,l){var d=n[0],p=n[1],m=n[2],y=n[3],w=l[0],T=l[1],E=l[2],I=l[3];return r[0]=d*w+m*T,r[1]=p*w+y*T,r[2]=d*E+m*I,r[3]=p*E+y*I,r}function ew(r,n,l){return r[0]=n[0]-l[0],r[1]=n[1]-l[1],r[2]=n[2]-l[2],r[3]=n[3]-l[3],r}Qr.mul=Q9,Qr.sub=ew;var ss={};function $y(r){return $y=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},$y(r)}Object.defineProperty(ss,"__esModule",{value:!0}),ss.create=function(){var r=new Fc.ARRAY_TYPE(6);return Fc.ARRAY_TYPE!=Float32Array&&(r[1]=0,r[2]=0,r[4]=0,r[5]=0),r[0]=1,r[3]=1,r},ss.clone=function(r){var n=new Fc.ARRAY_TYPE(6);return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n},ss.copy=function(r,n){return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r[4]=n[4],r[5]=n[5],r},ss.identity=function(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=1,r[4]=0,r[5]=0,r},ss.fromValues=function(r,n,l,d,p,m){var y=new Fc.ARRAY_TYPE(6);return y[0]=r,y[1]=n,y[2]=l,y[3]=d,y[4]=p,y[5]=m,y},ss.set=function(r,n,l,d,p,m,y){return r[0]=n,r[1]=l,r[2]=d,r[3]=p,r[4]=m,r[5]=y,r},ss.invert=function(r,n){var l=n[0],d=n[1],p=n[2],m=n[3],y=n[4],w=n[5],T=l*m-d*p;return T?(r[0]=m*(T=1/T),r[1]=-d*T,r[2]=-p*T,r[3]=l*T,r[4]=(p*w-m*y)*T,r[5]=(d*y-l*w)*T,r):null},ss.determinant=function(r){return r[0]*r[3]-r[1]*r[2]},ss.multiply=iw,ss.rotate=function(r,n,l){var d=n[0],p=n[1],m=n[2],y=n[3],w=n[4],T=n[5],E=Math.sin(l),I=Math.cos(l);return r[0]=d*I+m*E,r[1]=p*I+y*E,r[2]=d*-E+m*I,r[3]=p*-E+y*I,r[4]=w,r[5]=T,r},ss.scale=function(r,n,l){var d=n[1],p=n[2],m=n[3],y=n[4],w=n[5],T=l[0],E=l[1];return r[0]=n[0]*T,r[1]=d*T,r[2]=p*E,r[3]=m*E,r[4]=y,r[5]=w,r},ss.translate=function(r,n,l){var d=n[0],p=n[1],m=n[2],y=n[3],w=n[4],T=n[5],E=l[0],I=l[1];return r[0]=d,r[1]=p,r[2]=m,r[3]=y,r[4]=d*E+m*I+w,r[5]=p*E+y*I+T,r},ss.fromRotation=function(r,n){var l=Math.sin(n),d=Math.cos(n);return r[0]=d,r[1]=l,r[2]=-l,r[3]=d,r[4]=0,r[5]=0,r},ss.fromScaling=function(r,n){return r[0]=n[0],r[1]=0,r[2]=0,r[3]=n[1],r[4]=0,r[5]=0,r},ss.fromTranslation=function(r,n){return r[0]=1,r[1]=0,r[2]=0,r[3]=1,r[4]=n[0],r[5]=n[1],r},ss.str=function(r){return"mat2d("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+", "+r[4]+", "+r[5]+")"},ss.frob=function(r){return Math.hypot(r[0],r[1],r[2],r[3],r[4],r[5],1)},ss.add=function(r,n,l){return r[0]=n[0]+l[0],r[1]=n[1]+l[1],r[2]=n[2]+l[2],r[3]=n[3]+l[3],r[4]=n[4]+l[4],r[5]=n[5]+l[5],r},ss.subtract=nw,ss.multiplyScalar=function(r,n,l){return r[0]=n[0]*l,r[1]=n[1]*l,r[2]=n[2]*l,r[3]=n[3]*l,r[4]=n[4]*l,r[5]=n[5]*l,r},ss.multiplyScalarAndAdd=function(r,n,l,d){return r[0]=n[0]+l[0]*d,r[1]=n[1]+l[1]*d,r[2]=n[2]+l[2]*d,r[3]=n[3]+l[3]*d,r[4]=n[4]+l[4]*d,r[5]=n[5]+l[5]*d,r},ss.exactEquals=function(r,n){return r[0]===n[0]&&r[1]===n[1]&&r[2]===n[2]&&r[3]===n[3]&&r[4]===n[4]&&r[5]===n[5]},ss.equals=function(r,n){var l=r[0],d=r[1],p=r[2],m=r[3],y=r[4],w=r[5],T=n[0],E=n[1],I=n[2],R=n[3],F=n[4],B=n[5];return Math.abs(l-T)<=Fc.EPSILON*Math.max(1,Math.abs(l),Math.abs(T))&&Math.abs(d-E)<=Fc.EPSILON*Math.max(1,Math.abs(d),Math.abs(E))&&Math.abs(p-I)<=Fc.EPSILON*Math.max(1,Math.abs(p),Math.abs(I))&&Math.abs(m-R)<=Fc.EPSILON*Math.max(1,Math.abs(m),Math.abs(R))&&Math.abs(y-F)<=Fc.EPSILON*Math.max(1,Math.abs(y),Math.abs(F))&&Math.abs(w-B)<=Fc.EPSILON*Math.max(1,Math.abs(w),Math.abs(B))},ss.sub=ss.mul=void 0;var Fc=function(r,n){if(r&&r.__esModule)return r;if(r===null||$y(r)!=="object"&&typeof r!="function")return{default:r};var l=tw(void 0);if(l&&l.has(r))return l.get(r);var d={},p=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in r)if(m!=="default"&&Object.prototype.hasOwnProperty.call(r,m)){var y=p?Object.getOwnPropertyDescriptor(r,m):null;y&&(y.get||y.set)?Object.defineProperty(d,m,y):d[m]=r[m]}return d.default=r,l&&l.set(r,d),d}(Xs);function tw(r){if(typeof WeakMap!="function")return null;var n=new WeakMap,l=new WeakMap;return(tw=function(d){return d?l:n})(r)}function iw(r,n,l){var d=n[0],p=n[1],m=n[2],y=n[3],w=n[4],T=n[5],E=l[0],I=l[1],R=l[2],F=l[3],B=l[4],V=l[5];return r[0]=d*E+m*I,r[1]=p*E+y*I,r[2]=d*R+m*F,r[3]=p*R+y*F,r[4]=d*B+m*V+w,r[5]=p*B+y*V+T,r}function nw(r,n,l){return r[0]=n[0]-l[0],r[1]=n[1]-l[1],r[2]=n[2]-l[2],r[3]=n[3]-l[3],r[4]=n[4]-l[4],r[5]=n[5]-l[5],r}ss.mul=iw,ss.sub=nw;var Ar={};function Yy(r){return Yy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Yy(r)}Object.defineProperty(Ar,"__esModule",{value:!0}),Ar.create=function(){var r=new $a.ARRAY_TYPE(9);return $a.ARRAY_TYPE!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r},Ar.fromMat4=function(r,n){return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[4],r[4]=n[5],r[5]=n[6],r[6]=n[8],r[7]=n[9],r[8]=n[10],r},Ar.clone=function(r){var n=new $a.ARRAY_TYPE(9);return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],n},Ar.copy=function(r,n){return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r[4]=n[4],r[5]=n[5],r[6]=n[6],r[7]=n[7],r[8]=n[8],r},Ar.fromValues=function(r,n,l,d,p,m,y,w,T){var E=new $a.ARRAY_TYPE(9);return E[0]=r,E[1]=n,E[2]=l,E[3]=d,E[4]=p,E[5]=m,E[6]=y,E[7]=w,E[8]=T,E},Ar.set=function(r,n,l,d,p,m,y,w,T,E){return r[0]=n,r[1]=l,r[2]=d,r[3]=p,r[4]=m,r[5]=y,r[6]=w,r[7]=T,r[8]=E,r},Ar.identity=function(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=1,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r},Ar.transpose=function(r,n){if(r===n){var l=n[1],d=n[2],p=n[5];r[1]=n[3],r[2]=n[6],r[3]=l,r[5]=n[7],r[6]=d,r[7]=p}else r[0]=n[0],r[1]=n[3],r[2]=n[6],r[3]=n[1],r[4]=n[4],r[5]=n[7],r[6]=n[2],r[7]=n[5],r[8]=n[8];return r},Ar.invert=function(r,n){var l=n[0],d=n[1],p=n[2],m=n[3],y=n[4],w=n[5],T=n[6],E=n[7],I=n[8],R=I*y-w*E,F=-I*m+w*T,B=E*m-y*T,V=l*R+d*F+p*B;return V?(r[0]=R*(V=1/V),r[1]=(-I*d+p*E)*V,r[2]=(w*d-p*y)*V,r[3]=F*V,r[4]=(I*l-p*T)*V,r[5]=(-w*l+p*m)*V,r[6]=B*V,r[7]=(-E*l+d*T)*V,r[8]=(y*l-d*m)*V,r):null},Ar.adjoint=function(r,n){var l=n[0],d=n[1],p=n[2],m=n[3],y=n[4],w=n[5],T=n[6],E=n[7],I=n[8];return r[0]=y*I-w*E,r[1]=p*E-d*I,r[2]=d*w-p*y,r[3]=w*T-m*I,r[4]=l*I-p*T,r[5]=p*m-l*w,r[6]=m*E-y*T,r[7]=d*T-l*E,r[8]=l*y-d*m,r},Ar.determinant=function(r){var n=r[3],l=r[4],d=r[5],p=r[6],m=r[7],y=r[8];return r[0]*(y*l-d*m)+r[1]*(-y*n+d*p)+r[2]*(m*n-l*p)},Ar.multiply=sw,Ar.translate=function(r,n,l){var d=n[0],p=n[1],m=n[2],y=n[3],w=n[4],T=n[5],E=n[6],I=n[7],R=n[8],F=l[0],B=l[1];return r[0]=d,r[1]=p,r[2]=m,r[3]=y,r[4]=w,r[5]=T,r[6]=F*d+B*y+E,r[7]=F*p+B*w+I,r[8]=F*m+B*T+R,r},Ar.rotate=function(r,n,l){var d=n[0],p=n[1],m=n[2],y=n[3],w=n[4],T=n[5],E=n[6],I=n[7],R=n[8],F=Math.sin(l),B=Math.cos(l);return r[0]=B*d+F*y,r[1]=B*p+F*w,r[2]=B*m+F*T,r[3]=B*y-F*d,r[4]=B*w-F*p,r[5]=B*T-F*m,r[6]=E,r[7]=I,r[8]=R,r},Ar.scale=function(r,n,l){var d=l[0],p=l[1];return r[0]=d*n[0],r[1]=d*n[1],r[2]=d*n[2],r[3]=p*n[3],r[4]=p*n[4],r[5]=p*n[5],r[6]=n[6],r[7]=n[7],r[8]=n[8],r},Ar.fromTranslation=function(r,n){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=1,r[5]=0,r[6]=n[0],r[7]=n[1],r[8]=1,r},Ar.fromRotation=function(r,n){var l=Math.sin(n),d=Math.cos(n);return r[0]=d,r[1]=l,r[2]=0,r[3]=-l,r[4]=d,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r},Ar.fromScaling=function(r,n){return r[0]=n[0],r[1]=0,r[2]=0,r[3]=0,r[4]=n[1],r[5]=0,r[6]=0,r[7]=0,r[8]=1,r},Ar.fromMat2d=function(r,n){return r[0]=n[0],r[1]=n[1],r[2]=0,r[3]=n[2],r[4]=n[3],r[5]=0,r[6]=n[4],r[7]=n[5],r[8]=1,r},Ar.fromQuat=function(r,n){var l=n[0],d=n[1],p=n[2],m=n[3],y=l+l,w=d+d,T=p+p,E=l*y,I=d*y,R=d*w,F=p*y,B=p*w,V=p*T,W=m*y,$=m*w,J=m*T;return r[0]=1-R-V,r[3]=I-J,r[6]=F+$,r[1]=I+J,r[4]=1-E-V,r[7]=B-W,r[2]=F-$,r[5]=B+W,r[8]=1-E-R,r},Ar.normalFromMat4=function(r,n){var l=n[0],d=n[1],p=n[2],m=n[3],y=n[4],w=n[5],T=n[6],E=n[7],I=n[8],R=n[9],F=n[10],B=n[11],V=n[12],W=n[13],$=n[14],J=n[15],le=l*w-d*y,pe=l*T-p*y,ue=l*E-m*y,Me=d*T-p*w,xe=d*E-m*w,ke=p*E-m*T,Be=I*W-R*V,We=I*$-F*V,Ke=I*J-B*V,qe=R*$-F*W,dt=R*J-B*W,Mt=F*J-B*$,rt=le*Mt-pe*dt+ue*qe+Me*Ke-xe*We+ke*Be;return rt?(r[0]=(w*Mt-T*dt+E*qe)*(rt=1/rt),r[1]=(T*Ke-y*Mt-E*We)*rt,r[2]=(y*dt-w*Ke+E*Be)*rt,r[3]=(p*dt-d*Mt-m*qe)*rt,r[4]=(l*Mt-p*Ke+m*We)*rt,r[5]=(d*Ke-l*dt-m*Be)*rt,r[6]=(W*ke-$*xe+J*Me)*rt,r[7]=($*ue-V*ke-J*pe)*rt,r[8]=(V*xe-W*ue+J*le)*rt,r):null},Ar.projection=function(r,n,l){return r[0]=2/n,r[1]=0,r[2]=0,r[3]=0,r[4]=-2/l,r[5]=0,r[6]=-1,r[7]=1,r[8]=1,r},Ar.str=function(r){return"mat3("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+", "+r[4]+", "+r[5]+", "+r[6]+", "+r[7]+", "+r[8]+")"},Ar.frob=function(r){return Math.hypot(r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8])},Ar.add=function(r,n,l){return r[0]=n[0]+l[0],r[1]=n[1]+l[1],r[2]=n[2]+l[2],r[3]=n[3]+l[3],r[4]=n[4]+l[4],r[5]=n[5]+l[5],r[6]=n[6]+l[6],r[7]=n[7]+l[7],r[8]=n[8]+l[8],r},Ar.subtract=ow,Ar.multiplyScalar=function(r,n,l){return r[0]=n[0]*l,r[1]=n[1]*l,r[2]=n[2]*l,r[3]=n[3]*l,r[4]=n[4]*l,r[5]=n[5]*l,r[6]=n[6]*l,r[7]=n[7]*l,r[8]=n[8]*l,r},Ar.multiplyScalarAndAdd=function(r,n,l,d){return r[0]=n[0]+l[0]*d,r[1]=n[1]+l[1]*d,r[2]=n[2]+l[2]*d,r[3]=n[3]+l[3]*d,r[4]=n[4]+l[4]*d,r[5]=n[5]+l[5]*d,r[6]=n[6]+l[6]*d,r[7]=n[7]+l[7]*d,r[8]=n[8]+l[8]*d,r},Ar.exactEquals=function(r,n){return r[0]===n[0]&&r[1]===n[1]&&r[2]===n[2]&&r[3]===n[3]&&r[4]===n[4]&&r[5]===n[5]&&r[6]===n[6]&&r[7]===n[7]&&r[8]===n[8]},Ar.equals=function(r,n){var l=r[0],d=r[1],p=r[2],m=r[3],y=r[4],w=r[5],T=r[6],E=r[7],I=r[8],R=n[0],F=n[1],B=n[2],V=n[3],W=n[4],$=n[5],J=n[6],le=n[7],pe=n[8];return Math.abs(l-R)<=$a.EPSILON*Math.max(1,Math.abs(l),Math.abs(R))&&Math.abs(d-F)<=$a.EPSILON*Math.max(1,Math.abs(d),Math.abs(F))&&Math.abs(p-B)<=$a.EPSILON*Math.max(1,Math.abs(p),Math.abs(B))&&Math.abs(m-V)<=$a.EPSILON*Math.max(1,Math.abs(m),Math.abs(V))&&Math.abs(y-W)<=$a.EPSILON*Math.max(1,Math.abs(y),Math.abs(W))&&Math.abs(w-$)<=$a.EPSILON*Math.max(1,Math.abs(w),Math.abs($))&&Math.abs(T-J)<=$a.EPSILON*Math.max(1,Math.abs(T),Math.abs(J))&&Math.abs(E-le)<=$a.EPSILON*Math.max(1,Math.abs(E),Math.abs(le))&&Math.abs(I-pe)<=$a.EPSILON*Math.max(1,Math.abs(I),Math.abs(pe))},Ar.sub=Ar.mul=void 0;var $a=function(r,n){if(r&&r.__esModule)return r;if(r===null||Yy(r)!=="object"&&typeof r!="function")return{default:r};var l=rw(void 0);if(l&&l.has(r))return l.get(r);var d={},p=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in r)if(m!=="default"&&Object.prototype.hasOwnProperty.call(r,m)){var y=p?Object.getOwnPropertyDescriptor(r,m):null;y&&(y.get||y.set)?Object.defineProperty(d,m,y):d[m]=r[m]}return d.default=r,l&&l.set(r,d),d}(Xs);function rw(r){if(typeof WeakMap!="function")return null;var n=new WeakMap,l=new WeakMap;return(rw=function(d){return d?l:n})(r)}function sw(r,n,l){var d=n[0],p=n[1],m=n[2],y=n[3],w=n[4],T=n[5],E=n[6],I=n[7],R=n[8],F=l[0],B=l[1],V=l[2],W=l[3],$=l[4],J=l[5],le=l[6],pe=l[7],ue=l[8];return r[0]=F*d+B*y+V*E,r[1]=F*p+B*w+V*I,r[2]=F*m+B*T+V*R,r[3]=W*d+$*y+J*E,r[4]=W*p+$*w+J*I,r[5]=W*m+$*T+J*R,r[6]=le*d+pe*y+ue*E,r[7]=le*p+pe*w+ue*I,r[8]=le*m+pe*T+ue*R,r}function ow(r,n,l){return r[0]=n[0]-l[0],r[1]=n[1]-l[1],r[2]=n[2]-l[2],r[3]=n[3]-l[3],r[4]=n[4]-l[4],r[5]=n[5]-l[5],r[6]=n[6]-l[6],r[7]=n[7]-l[7],r[8]=n[8]-l[8],r}Ar.mul=sw,Ar.sub=ow;var vn={};function Jy(r){return Jy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Jy(r)}Object.defineProperty(vn,"__esModule",{value:!0}),vn.create=function(){var r=new _s.ARRAY_TYPE(16);return _s.ARRAY_TYPE!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r},vn.clone=function(r){var n=new _s.ARRAY_TYPE(16);return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],n[9]=r[9],n[10]=r[10],n[11]=r[11],n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15],n},vn.copy=function(r,n){return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r[4]=n[4],r[5]=n[5],r[6]=n[6],r[7]=n[7],r[8]=n[8],r[9]=n[9],r[10]=n[10],r[11]=n[11],r[12]=n[12],r[13]=n[13],r[14]=n[14],r[15]=n[15],r},vn.fromValues=function(r,n,l,d,p,m,y,w,T,E,I,R,F,B,V,W){var $=new _s.ARRAY_TYPE(16);return $[0]=r,$[1]=n,$[2]=l,$[3]=d,$[4]=p,$[5]=m,$[6]=y,$[7]=w,$[8]=T,$[9]=E,$[10]=I,$[11]=R,$[12]=F,$[13]=B,$[14]=V,$[15]=W,$},vn.set=function(r,n,l,d,p,m,y,w,T,E,I,R,F,B,V,W,$){return r[0]=n,r[1]=l,r[2]=d,r[3]=p,r[4]=m,r[5]=y,r[6]=w,r[7]=T,r[8]=E,r[9]=I,r[10]=R,r[11]=F,r[12]=B,r[13]=V,r[14]=W,r[15]=$,r},vn.identity=lw,vn.transpose=function(r,n){if(r===n){var l=n[1],d=n[2],p=n[3],m=n[6],y=n[7],w=n[11];r[1]=n[4],r[2]=n[8],r[3]=n[12],r[4]=l,r[6]=n[9],r[7]=n[13],r[8]=d,r[9]=m,r[11]=n[14],r[12]=p,r[13]=y,r[14]=w}else r[0]=n[0],r[1]=n[4],r[2]=n[8],r[3]=n[12],r[4]=n[1],r[5]=n[5],r[6]=n[9],r[7]=n[13],r[8]=n[2],r[9]=n[6],r[10]=n[10],r[11]=n[14],r[12]=n[3],r[13]=n[7],r[14]=n[11],r[15]=n[15];return r},vn.invert=function(r,n){var l=n[0],d=n[1],p=n[2],m=n[3],y=n[4],w=n[5],T=n[6],E=n[7],I=n[8],R=n[9],F=n[10],B=n[11],V=n[12],W=n[13],$=n[14],J=n[15],le=l*w-d*y,pe=l*T-p*y,ue=l*E-m*y,Me=d*T-p*w,xe=d*E-m*w,ke=p*E-m*T,Be=I*W-R*V,We=I*$-F*V,Ke=I*J-B*V,qe=R*$-F*W,dt=R*J-B*W,Mt=F*J-B*$,rt=le*Mt-pe*dt+ue*qe+Me*Ke-xe*We+ke*Be;return rt?(r[0]=(w*Mt-T*dt+E*qe)*(rt=1/rt),r[1]=(p*dt-d*Mt-m*qe)*rt,r[2]=(W*ke-$*xe+J*Me)*rt,r[3]=(F*xe-R*ke-B*Me)*rt,r[4]=(T*Ke-y*Mt-E*We)*rt,r[5]=(l*Mt-p*Ke+m*We)*rt,r[6]=($*ue-V*ke-J*pe)*rt,r[7]=(I*ke-F*ue+B*pe)*rt,r[8]=(y*dt-w*Ke+E*Be)*rt,r[9]=(d*Ke-l*dt-m*Be)*rt,r[10]=(V*xe-W*ue+J*le)*rt,r[11]=(R*ue-I*xe-B*le)*rt,r[12]=(w*We-y*qe-T*Be)*rt,r[13]=(l*qe-d*We+p*Be)*rt,r[14]=(W*pe-V*Me-$*le)*rt,r[15]=(I*Me-R*pe+F*le)*rt,r):null},vn.adjoint=function(r,n){var l=n[0],d=n[1],p=n[2],m=n[3],y=n[4],w=n[5],T=n[6],E=n[7],I=n[8],R=n[9],F=n[10],B=n[11],V=n[12],W=n[13],$=n[14],J=n[15];return r[0]=w*(F*J-B*$)-R*(T*J-E*$)+W*(T*B-E*F),r[1]=-(d*(F*J-B*$)-R*(p*J-m*$)+W*(p*B-m*F)),r[2]=d*(T*J-E*$)-w*(p*J-m*$)+W*(p*E-m*T),r[3]=-(d*(T*B-E*F)-w*(p*B-m*F)+R*(p*E-m*T)),r[4]=-(y*(F*J-B*$)-I*(T*J-E*$)+V*(T*B-E*F)),r[5]=l*(F*J-B*$)-I*(p*J-m*$)+V*(p*B-m*F),r[6]=-(l*(T*J-E*$)-y*(p*J-m*$)+V*(p*E-m*T)),r[7]=l*(T*B-E*F)-y*(p*B-m*F)+I*(p*E-m*T),r[8]=y*(R*J-B*W)-I*(w*J-E*W)+V*(w*B-E*R),r[9]=-(l*(R*J-B*W)-I*(d*J-m*W)+V*(d*B-m*R)),r[10]=l*(w*J-E*W)-y*(d*J-m*W)+V*(d*E-m*w),r[11]=-(l*(w*B-E*R)-y*(d*B-m*R)+I*(d*E-m*w)),r[12]=-(y*(R*$-F*W)-I*(w*$-T*W)+V*(w*F-T*R)),r[13]=l*(R*$-F*W)-I*(d*$-p*W)+V*(d*F-p*R),r[14]=-(l*(w*$-T*W)-y*(d*$-p*W)+V*(d*T-p*w)),r[15]=l*(w*F-T*R)-y*(d*F-p*R)+I*(d*T-p*w),r},vn.determinant=function(r){var n=r[0],l=r[1],d=r[2],p=r[3],m=r[4],y=r[5],w=r[6],T=r[7],E=r[8],I=r[9],R=r[10],F=r[11],B=r[12],V=r[13],W=r[14],$=r[15];return(n*y-l*m)*(R*$-F*W)-(n*w-d*m)*(I*$-F*V)+(n*T-p*m)*(I*W-R*V)+(l*w-d*y)*(E*$-F*B)-(l*T-p*y)*(E*W-R*B)+(d*T-p*w)*(E*V-I*B)},vn.multiply=cw,vn.translate=function(r,n,l){var d,p,m,y,w,T,E,I,R,F,B,V,W=l[0],$=l[1],J=l[2];return n===r?(r[12]=n[0]*W+n[4]*$+n[8]*J+n[12],r[13]=n[1]*W+n[5]*$+n[9]*J+n[13],r[14]=n[2]*W+n[6]*$+n[10]*J+n[14],r[15]=n[3]*W+n[7]*$+n[11]*J+n[15]):(p=n[1],m=n[2],y=n[3],w=n[4],T=n[5],E=n[6],I=n[7],R=n[8],F=n[9],B=n[10],V=n[11],r[0]=d=n[0],r[1]=p,r[2]=m,r[3]=y,r[4]=w,r[5]=T,r[6]=E,r[7]=I,r[8]=R,r[9]=F,r[10]=B,r[11]=V,r[12]=d*W+w*$+R*J+n[12],r[13]=p*W+T*$+F*J+n[13],r[14]=m*W+E*$+B*J+n[14],r[15]=y*W+I*$+V*J+n[15]),r},vn.scale=function(r,n,l){var d=l[0],p=l[1],m=l[2];return r[0]=n[0]*d,r[1]=n[1]*d,r[2]=n[2]*d,r[3]=n[3]*d,r[4]=n[4]*p,r[5]=n[5]*p,r[6]=n[6]*p,r[7]=n[7]*p,r[8]=n[8]*m,r[9]=n[9]*m,r[10]=n[10]*m,r[11]=n[11]*m,r[12]=n[12],r[13]=n[13],r[14]=n[14],r[15]=n[15],r},vn.rotate=function(r,n,l,d){var p,m,y,w,T,E,I,R,F,B,V,W,$,J,le,pe,ue,Me,xe,ke,Be,We,Ke,qe,dt=d[0],Mt=d[1],rt=d[2],vt=Math.hypot(dt,Mt,rt);return vt<_s.EPSILON?null:(dt*=vt=1/vt,Mt*=vt,rt*=vt,p=Math.sin(l),m=Math.cos(l),T=n[1],E=n[2],I=n[3],F=n[5],B=n[6],V=n[7],$=n[9],J=n[10],le=n[11],pe=dt*dt*(y=1-m)+m,xe=dt*Mt*y-rt*p,ke=Mt*Mt*y+m,Be=rt*Mt*y+dt*p,We=dt*rt*y+Mt*p,Ke=Mt*rt*y-dt*p,qe=rt*rt*y+m,r[0]=(w=n[0])*pe+(R=n[4])*(ue=Mt*dt*y+rt*p)+(W=n[8])*(Me=rt*dt*y-Mt*p),r[1]=T*pe+F*ue+$*Me,r[2]=E*pe+B*ue+J*Me,r[3]=I*pe+V*ue+le*Me,r[4]=w*xe+R*ke+W*Be,r[5]=T*xe+F*ke+$*Be,r[6]=E*xe+B*ke+J*Be,r[7]=I*xe+V*ke+le*Be,r[8]=w*We+R*Ke+W*qe,r[9]=T*We+F*Ke+$*qe,r[10]=E*We+B*Ke+J*qe,r[11]=I*We+V*Ke+le*qe,n!==r&&(r[12]=n[12],r[13]=n[13],r[14]=n[14],r[15]=n[15]),r)},vn.rotateX=function(r,n,l){var d=Math.sin(l),p=Math.cos(l),m=n[4],y=n[5],w=n[6],T=n[7],E=n[8],I=n[9],R=n[10],F=n[11];return n!==r&&(r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r[12]=n[12],r[13]=n[13],r[14]=n[14],r[15]=n[15]),r[4]=m*p+E*d,r[5]=y*p+I*d,r[6]=w*p+R*d,r[7]=T*p+F*d,r[8]=E*p-m*d,r[9]=I*p-y*d,r[10]=R*p-w*d,r[11]=F*p-T*d,r},vn.rotateY=function(r,n,l){var d=Math.sin(l),p=Math.cos(l),m=n[0],y=n[1],w=n[2],T=n[3],E=n[8],I=n[9],R=n[10],F=n[11];return n!==r&&(r[4]=n[4],r[5]=n[5],r[6]=n[6],r[7]=n[7],r[12]=n[12],r[13]=n[13],r[14]=n[14],r[15]=n[15]),r[0]=m*p-E*d,r[1]=y*p-I*d,r[2]=w*p-R*d,r[3]=T*p-F*d,r[8]=m*d+E*p,r[9]=y*d+I*p,r[10]=w*d+R*p,r[11]=T*d+F*p,r},vn.rotateZ=function(r,n,l){var d=Math.sin(l),p=Math.cos(l),m=n[0],y=n[1],w=n[2],T=n[3],E=n[4],I=n[5],R=n[6],F=n[7];return n!==r&&(r[8]=n[8],r[9]=n[9],r[10]=n[10],r[11]=n[11],r[12]=n[12],r[13]=n[13],r[14]=n[14],r[15]=n[15]),r[0]=m*p+E*d,r[1]=y*p+I*d,r[2]=w*p+R*d,r[3]=T*p+F*d,r[4]=E*p-m*d,r[5]=I*p-y*d,r[6]=R*p-w*d,r[7]=F*p-T*d,r},vn.fromTranslation=function(r,n){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=n[0],r[13]=n[1],r[14]=n[2],r[15]=1,r},vn.fromScaling=function(r,n){return r[0]=n[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=n[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=n[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},vn.fromRotation=function(r,n,l){var d,p,m,y=l[0],w=l[1],T=l[2],E=Math.hypot(y,w,T);return E<_s.EPSILON?null:(y*=E=1/E,w*=E,T*=E,d=Math.sin(n),p=Math.cos(n),r[0]=y*y*(m=1-p)+p,r[1]=w*y*m+T*d,r[2]=T*y*m-w*d,r[3]=0,r[4]=y*w*m-T*d,r[5]=w*w*m+p,r[6]=T*w*m+y*d,r[7]=0,r[8]=y*T*m+w*d,r[9]=w*T*m-y*d,r[10]=T*T*m+p,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r)},vn.fromXRotation=function(r,n){var l=Math.sin(n),d=Math.cos(n);return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=d,r[6]=l,r[7]=0,r[8]=0,r[9]=-l,r[10]=d,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},vn.fromYRotation=function(r,n){var l=Math.sin(n),d=Math.cos(n);return r[0]=d,r[1]=0,r[2]=-l,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=l,r[9]=0,r[10]=d,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},vn.fromZRotation=function(r,n){var l=Math.sin(n),d=Math.cos(n);return r[0]=d,r[1]=l,r[2]=0,r[3]=0,r[4]=-l,r[5]=d,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},vn.fromRotationTranslation=hw,vn.fromQuat2=function(r,n){var l=new _s.ARRAY_TYPE(3),d=-n[0],p=-n[1],m=-n[2],y=n[3],w=n[4],T=n[5],E=n[6],I=n[7],R=d*d+p*p+m*m+y*y;return R>0?(l[0]=2*(w*y+I*d+T*m-E*p)/R,l[1]=2*(T*y+I*p+E*d-w*m)/R,l[2]=2*(E*y+I*m+w*p-T*d)/R):(l[0]=2*(w*y+I*d+T*m-E*p),l[1]=2*(T*y+I*p+E*d-w*m),l[2]=2*(E*y+I*m+w*p-T*d)),hw(r,n,l),r},vn.getTranslation=function(r,n){return r[0]=n[12],r[1]=n[13],r[2]=n[14],r},vn.getScaling=dw,vn.getRotation=function(r,n){var l=new _s.ARRAY_TYPE(3);dw(l,n);var d=1/l[0],p=1/l[1],m=1/l[2],y=n[0]*d,w=n[1]*p,T=n[2]*m,E=n[4]*d,I=n[5]*p,R=n[6]*m,F=n[8]*d,B=n[9]*p,V=n[10]*m,W=y+I+V,$=0;return W>0?($=2*Math.sqrt(W+1),r[3]=.25*$,r[0]=(R-B)/$,r[1]=(F-T)/$,r[2]=(w-E)/$):y>I&&y>V?($=2*Math.sqrt(1+y-I-V),r[3]=(R-B)/$,r[0]=.25*$,r[1]=(w+E)/$,r[2]=(F+T)/$):I>V?($=2*Math.sqrt(1+I-y-V),r[3]=(F-T)/$,r[0]=(w+E)/$,r[1]=.25*$,r[2]=(R+B)/$):($=2*Math.sqrt(1+V-y-I),r[3]=(w-E)/$,r[0]=(F+T)/$,r[1]=(R+B)/$,r[2]=.25*$),r},vn.fromRotationTranslationScale=function(r,n,l,d){var p=n[0],m=n[1],y=n[2],w=n[3],T=p+p,E=m+m,I=y+y,R=p*T,F=p*E,B=p*I,V=m*E,W=m*I,$=y*I,J=w*T,le=w*E,pe=w*I,ue=d[0],Me=d[1],xe=d[2];return r[0]=(1-(V+$))*ue,r[1]=(F+pe)*ue,r[2]=(B-le)*ue,r[3]=0,r[4]=(F-pe)*Me,r[5]=(1-(R+$))*Me,r[6]=(W+J)*Me,r[7]=0,r[8]=(B+le)*xe,r[9]=(W-J)*xe,r[10]=(1-(R+V))*xe,r[11]=0,r[12]=l[0],r[13]=l[1],r[14]=l[2],r[15]=1,r},vn.fromRotationTranslationScaleOrigin=function(r,n,l,d,p){var m=n[0],y=n[1],w=n[2],T=n[3],E=m+m,I=y+y,R=w+w,F=m*E,B=m*I,V=m*R,W=y*I,$=y*R,J=w*R,le=T*E,pe=T*I,ue=T*R,Me=d[0],xe=d[1],ke=d[2],Be=p[0],We=p[1],Ke=p[2],qe=(1-(W+J))*Me,dt=(B+ue)*Me,Mt=(V-pe)*Me,rt=(B-ue)*xe,vt=(1-(F+J))*xe,it=($+le)*xe,yt=(V+pe)*ke,Xt=($-le)*ke,At=(1-(F+W))*ke;return r[0]=qe,r[1]=dt,r[2]=Mt,r[3]=0,r[4]=rt,r[5]=vt,r[6]=it,r[7]=0,r[8]=yt,r[9]=Xt,r[10]=At,r[11]=0,r[12]=l[0]+Be-(qe*Be+rt*We+yt*Ke),r[13]=l[1]+We-(dt*Be+vt*We+Xt*Ke),r[14]=l[2]+Ke-(Mt*Be+it*We+At*Ke),r[15]=1,r},vn.fromQuat=function(r,n){var l=n[0],d=n[1],p=n[2],m=n[3],y=l+l,w=d+d,T=p+p,E=l*y,I=d*y,R=d*w,F=p*y,B=p*w,V=p*T,W=m*y,$=m*w,J=m*T;return r[0]=1-R-V,r[1]=I+J,r[2]=F-$,r[3]=0,r[4]=I-J,r[5]=1-E-V,r[6]=B+W,r[7]=0,r[8]=F+$,r[9]=B-W,r[10]=1-E-R,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},vn.frustum=function(r,n,l,d,p,m,y){var w=1/(l-n),T=1/(p-d),E=1/(m-y);return r[0]=2*m*w,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=2*m*T,r[6]=0,r[7]=0,r[8]=(l+n)*w,r[9]=(p+d)*T,r[10]=(y+m)*E,r[11]=-1,r[12]=0,r[13]=0,r[14]=y*m*2*E,r[15]=0,r},vn.perspectiveNO=uw,vn.perspectiveZO=function(r,n,l,d,p){var m,y=1/Math.tan(n/2);return r[0]=y/l,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=y,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,p!=null&&p!==1/0?(r[10]=p*(m=1/(d-p)),r[14]=p*d*m):(r[10]=-1,r[14]=-d),r},vn.perspectiveFromFieldOfView=function(r,n,l,d){var p=Math.tan(n.upDegrees*Math.PI/180),m=Math.tan(n.downDegrees*Math.PI/180),y=Math.tan(n.leftDegrees*Math.PI/180),w=Math.tan(n.rightDegrees*Math.PI/180),T=2/(y+w),E=2/(p+m);return r[0]=T,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=E,r[6]=0,r[7]=0,r[8]=-(y-w)*T*.5,r[9]=(p-m)*E*.5,r[10]=d/(l-d),r[11]=-1,r[12]=0,r[13]=0,r[14]=d*l/(l-d),r[15]=0,r},vn.orthoNO=pw,vn.orthoZO=function(r,n,l,d,p,m,y){var w=1/(n-l),T=1/(d-p),E=1/(m-y);return r[0]=-2*w,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*T,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=E,r[11]=0,r[12]=(n+l)*w,r[13]=(p+d)*T,r[14]=m*E,r[15]=1,r},vn.lookAt=function(r,n,l,d){var p,m,y,w,T,E,I,R,F,B,V=n[0],W=n[1],$=n[2],J=d[0],le=d[1],pe=d[2],ue=l[0],Me=l[1],xe=l[2];return Math.abs(V-ue)<_s.EPSILON&&Math.abs(W-Me)<_s.EPSILON&&Math.abs($-xe)<_s.EPSILON?lw(r):(I=V-ue,R=W-Me,F=$-xe,p=le*(F*=B=1/Math.hypot(I,R,F))-pe*(R*=B),m=pe*(I*=B)-J*F,y=J*R-le*I,(B=Math.hypot(p,m,y))?(p*=B=1/B,m*=B,y*=B):(p=0,m=0,y=0),w=R*y-F*m,T=F*p-I*y,E=I*m-R*p,(B=Math.hypot(w,T,E))?(w*=B=1/B,T*=B,E*=B):(w=0,T=0,E=0),r[0]=p,r[1]=w,r[2]=I,r[3]=0,r[4]=m,r[5]=T,r[6]=R,r[7]=0,r[8]=y,r[9]=E,r[10]=F,r[11]=0,r[12]=-(p*V+m*W+y*$),r[13]=-(w*V+T*W+E*$),r[14]=-(I*V+R*W+F*$),r[15]=1,r)},vn.targetTo=function(r,n,l,d){var p=n[0],m=n[1],y=n[2],w=d[0],T=d[1],E=d[2],I=p-l[0],R=m-l[1],F=y-l[2],B=I*I+R*R+F*F;B>0&&(I*=B=1/Math.sqrt(B),R*=B,F*=B);var V=T*F-E*R,W=E*I-w*F,$=w*R-T*I;return(B=V*V+W*W+$*$)>0&&(V*=B=1/Math.sqrt(B),W*=B,$*=B),r[0]=V,r[1]=W,r[2]=$,r[3]=0,r[4]=R*$-F*W,r[5]=F*V-I*$,r[6]=I*W-R*V,r[7]=0,r[8]=I,r[9]=R,r[10]=F,r[11]=0,r[12]=p,r[13]=m,r[14]=y,r[15]=1,r},vn.str=function(r){return"mat4("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+", "+r[4]+", "+r[5]+", "+r[6]+", "+r[7]+", "+r[8]+", "+r[9]+", "+r[10]+", "+r[11]+", "+r[12]+", "+r[13]+", "+r[14]+", "+r[15]+")"},vn.frob=function(r){return Math.hypot(r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8],r[9],r[10],r[11],r[12],r[13],r[14],r[15])},vn.add=function(r,n,l){return r[0]=n[0]+l[0],r[1]=n[1]+l[1],r[2]=n[2]+l[2],r[3]=n[3]+l[3],r[4]=n[4]+l[4],r[5]=n[5]+l[5],r[6]=n[6]+l[6],r[7]=n[7]+l[7],r[8]=n[8]+l[8],r[9]=n[9]+l[9],r[10]=n[10]+l[10],r[11]=n[11]+l[11],r[12]=n[12]+l[12],r[13]=n[13]+l[13],r[14]=n[14]+l[14],r[15]=n[15]+l[15],r},vn.subtract=fw,vn.multiplyScalar=function(r,n,l){return r[0]=n[0]*l,r[1]=n[1]*l,r[2]=n[2]*l,r[3]=n[3]*l,r[4]=n[4]*l,r[5]=n[5]*l,r[6]=n[6]*l,r[7]=n[7]*l,r[8]=n[8]*l,r[9]=n[9]*l,r[10]=n[10]*l,r[11]=n[11]*l,r[12]=n[12]*l,r[13]=n[13]*l,r[14]=n[14]*l,r[15]=n[15]*l,r},vn.multiplyScalarAndAdd=function(r,n,l,d){return r[0]=n[0]+l[0]*d,r[1]=n[1]+l[1]*d,r[2]=n[2]+l[2]*d,r[3]=n[3]+l[3]*d,r[4]=n[4]+l[4]*d,r[5]=n[5]+l[5]*d,r[6]=n[6]+l[6]*d,r[7]=n[7]+l[7]*d,r[8]=n[8]+l[8]*d,r[9]=n[9]+l[9]*d,r[10]=n[10]+l[10]*d,r[11]=n[11]+l[11]*d,r[12]=n[12]+l[12]*d,r[13]=n[13]+l[13]*d,r[14]=n[14]+l[14]*d,r[15]=n[15]+l[15]*d,r},vn.exactEquals=function(r,n){return r[0]===n[0]&&r[1]===n[1]&&r[2]===n[2]&&r[3]===n[3]&&r[4]===n[4]&&r[5]===n[5]&&r[6]===n[6]&&r[7]===n[7]&&r[8]===n[8]&&r[9]===n[9]&&r[10]===n[10]&&r[11]===n[11]&&r[12]===n[12]&&r[13]===n[13]&&r[14]===n[14]&&r[15]===n[15]},vn.equals=function(r,n){var l=r[0],d=r[1],p=r[2],m=r[3],y=r[4],w=r[5],T=r[6],E=r[7],I=r[8],R=r[9],F=r[10],B=r[11],V=r[12],W=r[13],$=r[14],J=r[15],le=n[0],pe=n[1],ue=n[2],Me=n[3],xe=n[4],ke=n[5],Be=n[6],We=n[7],Ke=n[8],qe=n[9],dt=n[10],Mt=n[11],rt=n[12],vt=n[13],it=n[14],yt=n[15];return Math.abs(l-le)<=_s.EPSILON*Math.max(1,Math.abs(l),Math.abs(le))&&Math.abs(d-pe)<=_s.EPSILON*Math.max(1,Math.abs(d),Math.abs(pe))&&Math.abs(p-ue)<=_s.EPSILON*Math.max(1,Math.abs(p),Math.abs(ue))&&Math.abs(m-Me)<=_s.EPSILON*Math.max(1,Math.abs(m),Math.abs(Me))&&Math.abs(y-xe)<=_s.EPSILON*Math.max(1,Math.abs(y),Math.abs(xe))&&Math.abs(w-ke)<=_s.EPSILON*Math.max(1,Math.abs(w),Math.abs(ke))&&Math.abs(T-Be)<=_s.EPSILON*Math.max(1,Math.abs(T),Math.abs(Be))&&Math.abs(E-We)<=_s.EPSILON*Math.max(1,Math.abs(E),Math.abs(We))&&Math.abs(I-Ke)<=_s.EPSILON*Math.max(1,Math.abs(I),Math.abs(Ke))&&Math.abs(R-qe)<=_s.EPSILON*Math.max(1,Math.abs(R),Math.abs(qe))&&Math.abs(F-dt)<=_s.EPSILON*Math.max(1,Math.abs(F),Math.abs(dt))&&Math.abs(B-Mt)<=_s.EPSILON*Math.max(1,Math.abs(B),Math.abs(Mt))&&Math.abs(V-rt)<=_s.EPSILON*Math.max(1,Math.abs(V),Math.abs(rt))&&Math.abs(W-vt)<=_s.EPSILON*Math.max(1,Math.abs(W),Math.abs(vt))&&Math.abs($-it)<=_s.EPSILON*Math.max(1,Math.abs($),Math.abs(it))&&Math.abs(J-yt)<=_s.EPSILON*Math.max(1,Math.abs(J),Math.abs(yt))},vn.sub=vn.mul=vn.ortho=vn.perspective=void 0;var _s=function(r,n){if(r&&r.__esModule)return r;if(r===null||Jy(r)!=="object"&&typeof r!="function")return{default:r};var l=aw(void 0);if(l&&l.has(r))return l.get(r);var d={},p=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in r)if(m!=="default"&&Object.prototype.hasOwnProperty.call(r,m)){var y=p?Object.getOwnPropertyDescriptor(r,m):null;y&&(y.get||y.set)?Object.defineProperty(d,m,y):d[m]=r[m]}return d.default=r,l&&l.set(r,d),d}(Xs);function aw(r){if(typeof WeakMap!="function")return null;var n=new WeakMap,l=new WeakMap;return(aw=function(d){return d?l:n})(r)}function lw(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function cw(r,n,l){var d=n[0],p=n[1],m=n[2],y=n[3],w=n[4],T=n[5],E=n[6],I=n[7],R=n[8],F=n[9],B=n[10],V=n[11],W=n[12],$=n[13],J=n[14],le=n[15],pe=l[0],ue=l[1],Me=l[2],xe=l[3];return r[0]=pe*d+ue*w+Me*R+xe*W,r[1]=pe*p+ue*T+Me*F+xe*$,r[2]=pe*m+ue*E+Me*B+xe*J,r[3]=pe*y+ue*I+Me*V+xe*le,r[4]=(pe=l[4])*d+(ue=l[5])*w+(Me=l[6])*R+(xe=l[7])*W,r[5]=pe*p+ue*T+Me*F+xe*$,r[6]=pe*m+ue*E+Me*B+xe*J,r[7]=pe*y+ue*I+Me*V+xe*le,r[8]=(pe=l[8])*d+(ue=l[9])*w+(Me=l[10])*R+(xe=l[11])*W,r[9]=pe*p+ue*T+Me*F+xe*$,r[10]=pe*m+ue*E+Me*B+xe*J,r[11]=pe*y+ue*I+Me*V+xe*le,r[12]=(pe=l[12])*d+(ue=l[13])*w+(Me=l[14])*R+(xe=l[15])*W,r[13]=pe*p+ue*T+Me*F+xe*$,r[14]=pe*m+ue*E+Me*B+xe*J,r[15]=pe*y+ue*I+Me*V+xe*le,r}function hw(r,n,l){var d=n[0],p=n[1],m=n[2],y=n[3],w=d+d,T=p+p,E=m+m,I=d*w,R=d*T,F=d*E,B=p*T,V=p*E,W=m*E,$=y*w,J=y*T,le=y*E;return r[0]=1-(B+W),r[1]=R+le,r[2]=F-J,r[3]=0,r[4]=R-le,r[5]=1-(I+W),r[6]=V+$,r[7]=0,r[8]=F+J,r[9]=V-$,r[10]=1-(I+B),r[11]=0,r[12]=l[0],r[13]=l[1],r[14]=l[2],r[15]=1,r}function dw(r,n){var l=n[4],d=n[5],p=n[6],m=n[8],y=n[9],w=n[10];return r[0]=Math.hypot(n[0],n[1],n[2]),r[1]=Math.hypot(l,d,p),r[2]=Math.hypot(m,y,w),r}function uw(r,n,l,d,p){var m,y=1/Math.tan(n/2);return r[0]=y/l,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=y,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,p!=null&&p!==1/0?(r[10]=(p+d)*(m=1/(d-p)),r[14]=2*p*d*m):(r[10]=-1,r[14]=-2*d),r}function pw(r,n,l,d,p,m,y){var w=1/(n-l),T=1/(d-p),E=1/(m-y);return r[0]=-2*w,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*T,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*E,r[11]=0,r[12]=(n+l)*w,r[13]=(p+d)*T,r[14]=(y+m)*E,r[15]=1,r}function fw(r,n,l){return r[0]=n[0]-l[0],r[1]=n[1]-l[1],r[2]=n[2]-l[2],r[3]=n[3]-l[3],r[4]=n[4]-l[4],r[5]=n[5]-l[5],r[6]=n[6]-l[6],r[7]=n[7]-l[7],r[8]=n[8]-l[8],r[9]=n[9]-l[9],r[10]=n[10]-l[10],r[11]=n[11]-l[11],r[12]=n[12]-l[12],r[13]=n[13]-l[13],r[14]=n[14]-l[14],r[15]=n[15]-l[15],r}vn.perspective=uw,vn.ortho=pw,vn.mul=cw,vn.sub=fw;var un={},_n={};function Ky(r){return Ky=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Ky(r)}Object.defineProperty(_n,"__esModule",{value:!0}),_n.create=gw,_n.clone=function(r){var n=new x0.ARRAY_TYPE(3);return n[0]=r[0],n[1]=r[1],n[2]=r[2],n},_n.length=_w,_n.fromValues=function(r,n,l){var d=new x0.ARRAY_TYPE(3);return d[0]=r,d[1]=n,d[2]=l,d},_n.copy=function(r,n){return r[0]=n[0],r[1]=n[1],r[2]=n[2],r},_n.set=function(r,n,l,d){return r[0]=n,r[1]=l,r[2]=d,r},_n.add=function(r,n,l){return r[0]=n[0]+l[0],r[1]=n[1]+l[1],r[2]=n[2]+l[2],r},_n.subtract=yw,_n.multiply=vw,_n.divide=xw,_n.ceil=function(r,n){return r[0]=Math.ceil(n[0]),r[1]=Math.ceil(n[1]),r[2]=Math.ceil(n[2]),r},_n.floor=function(r,n){return r[0]=Math.floor(n[0]),r[1]=Math.floor(n[1]),r[2]=Math.floor(n[2]),r},_n.min=function(r,n,l){return r[0]=Math.min(n[0],l[0]),r[1]=Math.min(n[1],l[1]),r[2]=Math.min(n[2],l[2]),r},_n.max=function(r,n,l){return r[0]=Math.max(n[0],l[0]),r[1]=Math.max(n[1],l[1]),r[2]=Math.max(n[2],l[2]),r},_n.round=function(r,n){return r[0]=Math.round(n[0]),r[1]=Math.round(n[1]),r[2]=Math.round(n[2]),r},_n.scale=function(r,n,l){return r[0]=n[0]*l,r[1]=n[1]*l,r[2]=n[2]*l,r},_n.scaleAndAdd=function(r,n,l,d){return r[0]=n[0]+l[0]*d,r[1]=n[1]+l[1]*d,r[2]=n[2]+l[2]*d,r},_n.distance=bw,_n.squaredDistance=ww,_n.squaredLength=Sw,_n.negate=function(r,n){return r[0]=-n[0],r[1]=-n[1],r[2]=-n[2],r},_n.inverse=function(r,n){return r[0]=1/n[0],r[1]=1/n[1],r[2]=1/n[2],r},_n.normalize=function(r,n){var l=n[0],d=n[1],p=n[2],m=l*l+d*d+p*p;return m>0&&(m=1/Math.sqrt(m)),r[0]=n[0]*m,r[1]=n[1]*m,r[2]=n[2]*m,r},_n.dot=Tw,_n.cross=function(r,n,l){var d=n[0],p=n[1],m=n[2],y=l[0],w=l[1],T=l[2];return r[0]=p*T-m*w,r[1]=m*y-d*T,r[2]=d*w-p*y,r},_n.lerp=function(r,n,l,d){var p=n[0],m=n[1],y=n[2];return r[0]=p+d*(l[0]-p),r[1]=m+d*(l[1]-m),r[2]=y+d*(l[2]-y),r},_n.hermite=function(r,n,l,d,p,m){var y=m*m,w=y*(2*m-3)+1,T=y*(m-2)+m,E=y*(m-1),I=y*(3-2*m);return r[0]=n[0]*w+l[0]*T+d[0]*E+p[0]*I,r[1]=n[1]*w+l[1]*T+d[1]*E+p[1]*I,r[2]=n[2]*w+l[2]*T+d[2]*E+p[2]*I,r},_n.bezier=function(r,n,l,d,p,m){var y=1-m,w=y*y,T=m*m,E=w*y,I=3*m*w,R=3*T*y,F=T*m;return r[0]=n[0]*E+l[0]*I+d[0]*R+p[0]*F,r[1]=n[1]*E+l[1]*I+d[1]*R+p[1]*F,r[2]=n[2]*E+l[2]*I+d[2]*R+p[2]*F,r},_n.random=function(r,n){n=n||1;var l=2*x0.RANDOM()*Math.PI,d=2*x0.RANDOM()-1,p=Math.sqrt(1-d*d)*n;return r[0]=Math.cos(l)*p,r[1]=Math.sin(l)*p,r[2]=d*n,r},_n.transformMat4=function(r,n,l){var d=n[0],p=n[1],m=n[2],y=l[3]*d+l[7]*p+l[11]*m+l[15];return r[0]=(l[0]*d+l[4]*p+l[8]*m+l[12])/(y=y||1),r[1]=(l[1]*d+l[5]*p+l[9]*m+l[13])/y,r[2]=(l[2]*d+l[6]*p+l[10]*m+l[14])/y,r},_n.transformMat3=function(r,n,l){var d=n[0],p=n[1],m=n[2];return r[0]=d*l[0]+p*l[3]+m*l[6],r[1]=d*l[1]+p*l[4]+m*l[7],r[2]=d*l[2]+p*l[5]+m*l[8],r},_n.transformQuat=function(r,n,l){var d=l[0],p=l[1],m=l[2],y=n[0],w=n[1],T=n[2],E=p*T-m*w,I=m*y-d*T,R=d*w-p*y,F=p*R-m*I,B=m*E-d*R,V=d*I-p*E,W=2*l[3];return I*=W,R*=W,B*=2,V*=2,r[0]=y+(E*=W)+(F*=2),r[1]=w+I+B,r[2]=T+R+V,r},_n.rotateX=function(r,n,l,d){var p=[],m=[];return p[0]=n[0]-l[0],p[1]=n[1]-l[1],p[2]=n[2]-l[2],m[0]=p[0],m[1]=p[1]*Math.cos(d)-p[2]*Math.sin(d),m[2]=p[1]*Math.sin(d)+p[2]*Math.cos(d),r[0]=m[0]+l[0],r[1]=m[1]+l[1],r[2]=m[2]+l[2],r},_n.rotateY=function(r,n,l,d){var p=[],m=[];return p[0]=n[0]-l[0],p[1]=n[1]-l[1],p[2]=n[2]-l[2],m[0]=p[2]*Math.sin(d)+p[0]*Math.cos(d),m[1]=p[1],m[2]=p[2]*Math.cos(d)-p[0]*Math.sin(d),r[0]=m[0]+l[0],r[1]=m[1]+l[1],r[2]=m[2]+l[2],r},_n.rotateZ=function(r,n,l,d){var p=[],m=[];return p[0]=n[0]-l[0],p[1]=n[1]-l[1],p[2]=n[2]-l[2],m[0]=p[0]*Math.cos(d)-p[1]*Math.sin(d),m[1]=p[0]*Math.sin(d)+p[1]*Math.cos(d),m[2]=p[2],r[0]=m[0]+l[0],r[1]=m[1]+l[1],r[2]=m[2]+l[2],r},_n.angle=function(r,n){var l=r[0],d=r[1],p=r[2],m=n[0],y=n[1],w=n[2],T=Math.sqrt(l*l+d*d+p*p)*Math.sqrt(m*m+y*y+w*w),E=T&&Tw(r,n)/T;return Math.acos(Math.min(Math.max(E,-1),1))},_n.zero=function(r){return r[0]=0,r[1]=0,r[2]=0,r},_n.str=function(r){return"vec3("+r[0]+", "+r[1]+", "+r[2]+")"},_n.exactEquals=function(r,n){return r[0]===n[0]&&r[1]===n[1]&&r[2]===n[2]},_n.equals=function(r,n){var l=r[0],d=r[1],p=r[2],m=n[0],y=n[1],w=n[2];return Math.abs(l-m)<=x0.EPSILON*Math.max(1,Math.abs(l),Math.abs(m))&&Math.abs(d-y)<=x0.EPSILON*Math.max(1,Math.abs(d),Math.abs(y))&&Math.abs(p-w)<=x0.EPSILON*Math.max(1,Math.abs(p),Math.abs(w))},_n.forEach=_n.sqrLen=_n.len=_n.sqrDist=_n.dist=_n.div=_n.mul=_n.sub=void 0;var x0=function(r,n){if(r&&r.__esModule)return r;if(r===null||Ky(r)!=="object"&&typeof r!="function")return{default:r};var l=mw(void 0);if(l&&l.has(r))return l.get(r);var d={},p=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in r)if(m!=="default"&&Object.prototype.hasOwnProperty.call(r,m)){var y=p?Object.getOwnPropertyDescriptor(r,m):null;y&&(y.get||y.set)?Object.defineProperty(d,m,y):d[m]=r[m]}return d.default=r,l&&l.set(r,d),d}(Xs);function mw(r){if(typeof WeakMap!="function")return null;var n=new WeakMap,l=new WeakMap;return(mw=function(d){return d?l:n})(r)}function gw(){var r=new x0.ARRAY_TYPE(3);return x0.ARRAY_TYPE!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function _w(r){return Math.hypot(r[0],r[1],r[2])}function yw(r,n,l){return r[0]=n[0]-l[0],r[1]=n[1]-l[1],r[2]=n[2]-l[2],r}function vw(r,n,l){return r[0]=n[0]*l[0],r[1]=n[1]*l[1],r[2]=n[2]*l[2],r}function xw(r,n,l){return r[0]=n[0]/l[0],r[1]=n[1]/l[1],r[2]=n[2]/l[2],r}function bw(r,n){return Math.hypot(n[0]-r[0],n[1]-r[1],n[2]-r[2])}function ww(r,n){var l=n[0]-r[0],d=n[1]-r[1],p=n[2]-r[2];return l*l+d*d+p*p}function Sw(r){var n=r[0],l=r[1],d=r[2];return n*n+l*l+d*d}function Tw(r,n){return r[0]*n[0]+r[1]*n[1]+r[2]*n[2]}_n.sub=yw,_n.mul=vw,_n.div=xw,_n.dist=bw,_n.sqrDist=ww,_n.len=_w,_n.sqrLen=Sw;var b0,mL=(b0=gw(),function(r,n,l,d,p,m){var y,w;for(n||(n=3),l||(l=0),w=d?Math.min(d*n+l,r.length):r.length,y=l;y<w;y+=n)b0[0]=r[y],b0[1]=r[y+1],b0[2]=r[y+2],p(b0,b0,m),r[y]=b0[0],r[y+1]=b0[1],r[y+2]=b0[2];return r});_n.forEach=mL;var On={};function Qy(r){return Qy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Qy(r)}Object.defineProperty(On,"__esModule",{value:!0}),On.create=Ew,On.clone=function(r){var n=new bl.ARRAY_TYPE(4);return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n},On.fromValues=function(r,n,l,d){var p=new bl.ARRAY_TYPE(4);return p[0]=r,p[1]=n,p[2]=l,p[3]=d,p},On.copy=function(r,n){return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r},On.set=function(r,n,l,d,p){return r[0]=n,r[1]=l,r[2]=d,r[3]=p,r},On.add=function(r,n,l){return r[0]=n[0]+l[0],r[1]=n[1]+l[1],r[2]=n[2]+l[2],r[3]=n[3]+l[3],r},On.subtract=Aw,On.multiply=Cw,On.divide=Iw,On.ceil=function(r,n){return r[0]=Math.ceil(n[0]),r[1]=Math.ceil(n[1]),r[2]=Math.ceil(n[2]),r[3]=Math.ceil(n[3]),r},On.floor=function(r,n){return r[0]=Math.floor(n[0]),r[1]=Math.floor(n[1]),r[2]=Math.floor(n[2]),r[3]=Math.floor(n[3]),r},On.min=function(r,n,l){return r[0]=Math.min(n[0],l[0]),r[1]=Math.min(n[1],l[1]),r[2]=Math.min(n[2],l[2]),r[3]=Math.min(n[3],l[3]),r},On.max=function(r,n,l){return r[0]=Math.max(n[0],l[0]),r[1]=Math.max(n[1],l[1]),r[2]=Math.max(n[2],l[2]),r[3]=Math.max(n[3],l[3]),r},On.round=function(r,n){return r[0]=Math.round(n[0]),r[1]=Math.round(n[1]),r[2]=Math.round(n[2]),r[3]=Math.round(n[3]),r},On.scale=function(r,n,l){return r[0]=n[0]*l,r[1]=n[1]*l,r[2]=n[2]*l,r[3]=n[3]*l,r},On.scaleAndAdd=function(r,n,l,d){return r[0]=n[0]+l[0]*d,r[1]=n[1]+l[1]*d,r[2]=n[2]+l[2]*d,r[3]=n[3]+l[3]*d,r},On.distance=Pw,On.squaredDistance=Rw,On.length=kw,On.squaredLength=Dw,On.negate=function(r,n){return r[0]=-n[0],r[1]=-n[1],r[2]=-n[2],r[3]=-n[3],r},On.inverse=function(r,n){return r[0]=1/n[0],r[1]=1/n[1],r[2]=1/n[2],r[3]=1/n[3],r},On.normalize=function(r,n){var l=n[0],d=n[1],p=n[2],m=n[3],y=l*l+d*d+p*p+m*m;return y>0&&(y=1/Math.sqrt(y)),r[0]=l*y,r[1]=d*y,r[2]=p*y,r[3]=m*y,r},On.dot=function(r,n){return r[0]*n[0]+r[1]*n[1]+r[2]*n[2]+r[3]*n[3]},On.cross=function(r,n,l,d){var p=l[0]*d[1]-l[1]*d[0],m=l[0]*d[2]-l[2]*d[0],y=l[0]*d[3]-l[3]*d[0],w=l[1]*d[2]-l[2]*d[1],T=l[1]*d[3]-l[3]*d[1],E=l[2]*d[3]-l[3]*d[2],I=n[0],R=n[1],F=n[2],B=n[3];return r[0]=R*E-F*T+B*w,r[1]=-I*E+F*y-B*m,r[2]=I*T-R*y+B*p,r[3]=-I*w+R*m-F*p,r},On.lerp=function(r,n,l,d){var p=n[0],m=n[1],y=n[2],w=n[3];return r[0]=p+d*(l[0]-p),r[1]=m+d*(l[1]-m),r[2]=y+d*(l[2]-y),r[3]=w+d*(l[3]-w),r},On.random=function(r,n){var l,d,p,m,y,w;n=n||1;do y=(l=2*bl.RANDOM()-1)*l+(d=2*bl.RANDOM()-1)*d;while(y>=1);do w=(p=2*bl.RANDOM()-1)*p+(m=2*bl.RANDOM()-1)*m;while(w>=1);var T=Math.sqrt((1-y)/w);return r[0]=n*l,r[1]=n*d,r[2]=n*p*T,r[3]=n*m*T,r},On.transformMat4=function(r,n,l){var d=n[0],p=n[1],m=n[2],y=n[3];return r[0]=l[0]*d+l[4]*p+l[8]*m+l[12]*y,r[1]=l[1]*d+l[5]*p+l[9]*m+l[13]*y,r[2]=l[2]*d+l[6]*p+l[10]*m+l[14]*y,r[3]=l[3]*d+l[7]*p+l[11]*m+l[15]*y,r},On.transformQuat=function(r,n,l){var d=n[0],p=n[1],m=n[2],y=l[0],w=l[1],T=l[2],E=l[3],I=E*d+w*m-T*p,R=E*p+T*d-y*m,F=E*m+y*p-w*d,B=-y*d-w*p-T*m;return r[0]=I*E+B*-y+R*-T-F*-w,r[1]=R*E+B*-w+F*-y-I*-T,r[2]=F*E+B*-T+I*-w-R*-y,r[3]=n[3],r},On.zero=function(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=0,r},On.str=function(r){return"vec4("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+")"},On.exactEquals=function(r,n){return r[0]===n[0]&&r[1]===n[1]&&r[2]===n[2]&&r[3]===n[3]},On.equals=function(r,n){var l=r[0],d=r[1],p=r[2],m=r[3],y=n[0],w=n[1],T=n[2],E=n[3];return Math.abs(l-y)<=bl.EPSILON*Math.max(1,Math.abs(l),Math.abs(y))&&Math.abs(d-w)<=bl.EPSILON*Math.max(1,Math.abs(d),Math.abs(w))&&Math.abs(p-T)<=bl.EPSILON*Math.max(1,Math.abs(p),Math.abs(T))&&Math.abs(m-E)<=bl.EPSILON*Math.max(1,Math.abs(m),Math.abs(E))},On.forEach=On.sqrLen=On.len=On.sqrDist=On.dist=On.div=On.mul=On.sub=void 0;var bl=function(r,n){if(r&&r.__esModule)return r;if(r===null||Qy(r)!=="object"&&typeof r!="function")return{default:r};var l=Mw(void 0);if(l&&l.has(r))return l.get(r);var d={},p=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in r)if(m!=="default"&&Object.prototype.hasOwnProperty.call(r,m)){var y=p?Object.getOwnPropertyDescriptor(r,m):null;y&&(y.get||y.set)?Object.defineProperty(d,m,y):d[m]=r[m]}return d.default=r,l&&l.set(r,d),d}(Xs);function Mw(r){if(typeof WeakMap!="function")return null;var n=new WeakMap,l=new WeakMap;return(Mw=function(d){return d?l:n})(r)}function Ew(){var r=new bl.ARRAY_TYPE(4);return bl.ARRAY_TYPE!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function Aw(r,n,l){return r[0]=n[0]-l[0],r[1]=n[1]-l[1],r[2]=n[2]-l[2],r[3]=n[3]-l[3],r}function Cw(r,n,l){return r[0]=n[0]*l[0],r[1]=n[1]*l[1],r[2]=n[2]*l[2],r[3]=n[3]*l[3],r}function Iw(r,n,l){return r[0]=n[0]/l[0],r[1]=n[1]/l[1],r[2]=n[2]/l[2],r[3]=n[3]/l[3],r}function Pw(r,n){return Math.hypot(n[0]-r[0],n[1]-r[1],n[2]-r[2],n[3]-r[3])}function Rw(r,n){var l=n[0]-r[0],d=n[1]-r[1],p=n[2]-r[2],m=n[3]-r[3];return l*l+d*d+p*p+m*m}function kw(r){return Math.hypot(r[0],r[1],r[2],r[3])}function Dw(r){var n=r[0],l=r[1],d=r[2],p=r[3];return n*n+l*l+d*d+p*p}On.sub=Aw,On.mul=Cw,On.div=Iw,On.dist=Pw,On.sqrDist=Rw,On.len=kw,On.sqrLen=Dw;var gL=function(){var r=Ew();return function(n,l,d,p,m,y){var w,T;for(l||(l=4),d||(d=0),T=p?Math.min(p*l+d,n.length):n.length,w=d;w<T;w+=l)r[0]=n[w],r[1]=n[w+1],r[2]=n[w+2],r[3]=n[w+3],m(r,r,y),n[w]=r[0],n[w+1]=r[1],n[w+2]=r[2],n[w+3]=r[3];return n}}();function ev(r){return ev=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},ev(r)}On.forEach=gL,Object.defineProperty(un,"__esModule",{value:!0}),un.create=tv,un.identity=function(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r},un.setAxisAngle=Fw,un.getAxisAngle=function(r,n){var l=2*Math.acos(n[3]),d=Math.sin(l/2);return d>pu.EPSILON?(r[0]=n[0]/d,r[1]=n[1]/d,r[2]=n[2]/d):(r[0]=1,r[1]=0,r[2]=0),l},un.getAngle=function(r,n){var l=Vw(r,n);return Math.acos(2*l*l-1)},un.multiply=Ow,un.rotateX=function(r,n,l){l*=.5;var d=n[0],p=n[1],m=n[2],y=n[3],w=Math.sin(l),T=Math.cos(l);return r[0]=d*T+y*w,r[1]=p*T+m*w,r[2]=m*T-p*w,r[3]=y*T-d*w,r},un.rotateY=function(r,n,l){l*=.5;var d=n[0],p=n[1],m=n[2],y=n[3],w=Math.sin(l),T=Math.cos(l);return r[0]=d*T-m*w,r[1]=p*T+y*w,r[2]=m*T+d*w,r[3]=y*T-p*w,r},un.rotateZ=function(r,n,l){l*=.5;var d=n[0],p=n[1],m=n[2],y=n[3],w=Math.sin(l),T=Math.cos(l);return r[0]=d*T+p*w,r[1]=p*T-d*w,r[2]=m*T+y*w,r[3]=y*T-m*w,r},un.calculateW=function(r,n){var l=n[0],d=n[1],p=n[2];return r[0]=l,r[1]=d,r[2]=p,r[3]=Math.sqrt(Math.abs(1-l*l-d*d-p*p)),r},un.exp=Nw,un.ln=zw,un.pow=function(r,n,l){return zw(r,n),Uw(r,r,l),Nw(r,r),r},un.slerp=x4,un.random=function(r){var n=pu.RANDOM(),l=pu.RANDOM(),d=pu.RANDOM(),p=Math.sqrt(1-n),m=Math.sqrt(n);return r[0]=p*Math.sin(2*Math.PI*l),r[1]=p*Math.cos(2*Math.PI*l),r[2]=m*Math.sin(2*Math.PI*d),r[3]=m*Math.cos(2*Math.PI*d),r},un.invert=function(r,n){var l=n[0],d=n[1],p=n[2],m=n[3],y=l*l+d*d+p*p+m*m,w=y?1/y:0;return r[0]=-l*w,r[1]=-d*w,r[2]=-p*w,r[3]=m*w,r},un.conjugate=function(r,n){return r[0]=-n[0],r[1]=-n[1],r[2]=-n[2],r[3]=n[3],r},un.fromMat3=Bw,un.fromEuler=function(r,n,l,d){var p=.5*Math.PI/180;n*=p,l*=p,d*=p;var m=Math.sin(n),y=Math.cos(n),w=Math.sin(l),T=Math.cos(l),E=Math.sin(d),I=Math.cos(d);return r[0]=m*T*I-y*w*E,r[1]=y*w*I+m*T*E,r[2]=y*T*E-m*w*I,r[3]=y*T*I+m*w*E,r},un.str=function(r){return"quat("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+")"},un.setAxes=un.sqlerp=un.rotationTo=un.equals=un.exactEquals=un.normalize=un.sqrLen=un.squaredLength=un.len=un.length=un.lerp=un.dot=un.scale=un.mul=un.add=un.set=un.copy=un.fromValues=un.clone=void 0;var pu=v4(Xs),_L=v4(Ar),w0=v4(_n),Ya=v4(On);function Lw(r){if(typeof WeakMap!="function")return null;var n=new WeakMap,l=new WeakMap;return(Lw=function(d){return d?l:n})(r)}function v4(r,n){if(!n&&r&&r.__esModule)return r;if(r===null||ev(r)!=="object"&&typeof r!="function")return{default:r};var l=Lw(n);if(l&&l.has(r))return l.get(r);var d={},p=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in r)if(m!=="default"&&Object.prototype.hasOwnProperty.call(r,m)){var y=p?Object.getOwnPropertyDescriptor(r,m):null;y&&(y.get||y.set)?Object.defineProperty(d,m,y):d[m]=r[m]}return d.default=r,l&&l.set(r,d),d}function tv(){var r=new pu.ARRAY_TYPE(4);return pu.ARRAY_TYPE!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function Fw(r,n,l){l*=.5;var d=Math.sin(l);return r[0]=d*n[0],r[1]=d*n[1],r[2]=d*n[2],r[3]=Math.cos(l),r}function Ow(r,n,l){var d=n[0],p=n[1],m=n[2],y=n[3],w=l[0],T=l[1],E=l[2],I=l[3];return r[0]=d*I+y*w+p*E-m*T,r[1]=p*I+y*T+m*w-d*E,r[2]=m*I+y*E+d*T-p*w,r[3]=y*I-d*w-p*T-m*E,r}function Nw(r,n){var l=n[0],d=n[1],p=n[2],m=n[3],y=Math.sqrt(l*l+d*d+p*p),w=Math.exp(m),T=y>0?w*Math.sin(y)/y:0;return r[0]=l*T,r[1]=d*T,r[2]=p*T,r[3]=w*Math.cos(y),r}function zw(r,n){var l=n[0],d=n[1],p=n[2],m=n[3],y=Math.sqrt(l*l+d*d+p*p),w=y>0?Math.atan2(y,m)/y:0;return r[0]=l*w,r[1]=d*w,r[2]=p*w,r[3]=.5*Math.log(l*l+d*d+p*p+m*m),r}function x4(r,n,l,d){var p,m,y,w,T,E=n[0],I=n[1],R=n[2],F=n[3],B=l[0],V=l[1],W=l[2],$=l[3];return(m=E*B+I*V+R*W+F*$)<0&&(m=-m,B=-B,V=-V,W=-W,$=-$),1-m>pu.EPSILON?(p=Math.acos(m),y=Math.sin(p),w=Math.sin((1-d)*p)/y,T=Math.sin(d*p)/y):(w=1-d,T=d),r[0]=w*E+T*B,r[1]=w*I+T*V,r[2]=w*R+T*W,r[3]=w*F+T*$,r}function Bw(r,n){var l,d=n[0]+n[4]+n[8];if(d>0)l=Math.sqrt(d+1),r[3]=.5*l,r[0]=(n[5]-n[7])*(l=.5/l),r[1]=(n[6]-n[2])*l,r[2]=(n[1]-n[3])*l;else{var p=0;n[4]>n[0]&&(p=1),n[8]>n[3*p+p]&&(p=2);var m=(p+1)%3,y=(p+2)%3;l=Math.sqrt(n[3*p+p]-n[3*m+m]-n[3*y+y]+1),r[p]=.5*l,r[3]=(n[3*m+y]-n[3*y+m])*(l=.5/l),r[m]=(n[3*m+p]+n[3*p+m])*l,r[y]=(n[3*y+p]+n[3*p+y])*l}return r}un.clone=Ya.clone,un.fromValues=Ya.fromValues,un.copy=Ya.copy,un.set=Ya.set,un.add=Ya.add,un.mul=Ow;var Uw=Ya.scale;un.scale=Uw;var Vw=Ya.dot;un.dot=Vw,un.lerp=Ya.lerp;var Gw=Ya.length;un.length=Gw,un.len=Gw;var Hw=Ya.squaredLength;un.squaredLength=Hw,un.sqrLen=Hw;var iv=Ya.normalize;un.normalize=iv,un.exactEquals=Ya.exactEquals,un.equals=Ya.equals;var Vl,jw,Ww,yL=(Vl=w0.create(),jw=w0.fromValues(1,0,0),Ww=w0.fromValues(0,1,0),function(r,n,l){var d=w0.dot(n,l);return d<-.999999?(w0.cross(Vl,jw,n),w0.len(Vl)<1e-6&&w0.cross(Vl,Ww,n),w0.normalize(Vl,Vl),Fw(r,Vl,Math.PI),r):d>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(w0.cross(Vl,n,l),r[0]=Vl[0],r[1]=Vl[1],r[2]=Vl[2],r[3]=1+d,iv(r,r))});un.rotationTo=yL;var nv,rv,vL=(nv=tv(),rv=tv(),function(r,n,l,d,p,m){return x4(nv,n,p,m),x4(rv,l,d,m),x4(r,nv,rv,2*m*(1-m)),r});un.sqlerp=vL;var Gl,xL=(Gl=_L.create(),function(r,n,l,d){return Gl[0]=l[0],Gl[3]=l[1],Gl[6]=l[2],Gl[1]=d[0],Gl[4]=d[1],Gl[7]=d[2],Gl[2]=-n[0],Gl[5]=-n[1],Gl[8]=-n[2],iv(r,Bw(r,Gl))});un.setAxes=xL;var qn={};function sv(r){return sv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},sv(r)}Object.defineProperty(qn,"__esModule",{value:!0}),qn.create=function(){var r=new aa.ARRAY_TYPE(8);return aa.ARRAY_TYPE!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[4]=0,r[5]=0,r[6]=0,r[7]=0),r[3]=1,r},qn.clone=function(r){var n=new aa.ARRAY_TYPE(8);return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n},qn.fromValues=function(r,n,l,d,p,m,y,w){var T=new aa.ARRAY_TYPE(8);return T[0]=r,T[1]=n,T[2]=l,T[3]=d,T[4]=p,T[5]=m,T[6]=y,T[7]=w,T},qn.fromRotationTranslationValues=function(r,n,l,d,p,m,y){var w=new aa.ARRAY_TYPE(8);w[0]=r,w[1]=n,w[2]=l,w[3]=d;var T=.5*p,E=.5*m,I=.5*y;return w[4]=T*d+E*l-I*n,w[5]=E*d+I*r-T*l,w[6]=I*d+T*n-E*r,w[7]=-T*r-E*n-I*l,w},qn.fromRotationTranslation=Zw,qn.fromTranslation=function(r,n){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r[4]=.5*n[0],r[5]=.5*n[1],r[6]=.5*n[2],r[7]=0,r},qn.fromRotation=function(r,n){return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r[4]=0,r[5]=0,r[6]=0,r[7]=0,r},qn.fromMat4=function(r,n){var l=S0.create();qw.getRotation(l,n);var d=new aa.ARRAY_TYPE(3);return qw.getTranslation(d,n),Zw(r,l,d),r},qn.copy=$w,qn.identity=function(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r[4]=0,r[5]=0,r[6]=0,r[7]=0,r},qn.set=function(r,n,l,d,p,m,y,w,T){return r[0]=n,r[1]=l,r[2]=d,r[3]=p,r[4]=m,r[5]=y,r[6]=w,r[7]=T,r},qn.getDual=function(r,n){return r[0]=n[4],r[1]=n[5],r[2]=n[6],r[3]=n[7],r},qn.setDual=function(r,n){return r[4]=n[0],r[5]=n[1],r[6]=n[2],r[7]=n[3],r},qn.getTranslation=function(r,n){var l=n[4],d=n[5],p=n[6],m=n[7],y=-n[0],w=-n[1],T=-n[2],E=n[3];return r[0]=2*(l*E+m*y+d*T-p*w),r[1]=2*(d*E+m*w+p*y-l*T),r[2]=2*(p*E+m*T+l*w-d*y),r},qn.translate=function(r,n,l){var d=n[0],p=n[1],m=n[2],y=n[3],w=.5*l[0],T=.5*l[1],E=.5*l[2],I=n[4],R=n[5],F=n[6],B=n[7];return r[0]=d,r[1]=p,r[2]=m,r[3]=y,r[4]=y*w+p*E-m*T+I,r[5]=y*T+m*w-d*E+R,r[6]=y*E+d*T-p*w+F,r[7]=-d*w-p*T-m*E+B,r},qn.rotateX=function(r,n,l){var d=-n[0],p=-n[1],m=-n[2],y=n[3],w=n[4],T=n[5],E=n[6],I=n[7],R=w*y+I*d+T*m-E*p,F=T*y+I*p+E*d-w*m,B=E*y+I*m+w*p-T*d,V=I*y-w*d-T*p-E*m;return S0.rotateX(r,n,l),r[4]=R*(y=r[3])+V*(d=r[0])+F*(m=r[2])-B*(p=r[1]),r[5]=F*y+V*p+B*d-R*m,r[6]=B*y+V*m+R*p-F*d,r[7]=V*y-R*d-F*p-B*m,r},qn.rotateY=function(r,n,l){var d=-n[0],p=-n[1],m=-n[2],y=n[3],w=n[4],T=n[5],E=n[6],I=n[7],R=w*y+I*d+T*m-E*p,F=T*y+I*p+E*d-w*m,B=E*y+I*m+w*p-T*d,V=I*y-w*d-T*p-E*m;return S0.rotateY(r,n,l),r[4]=R*(y=r[3])+V*(d=r[0])+F*(m=r[2])-B*(p=r[1]),r[5]=F*y+V*p+B*d-R*m,r[6]=B*y+V*m+R*p-F*d,r[7]=V*y-R*d-F*p-B*m,r},qn.rotateZ=function(r,n,l){var d=-n[0],p=-n[1],m=-n[2],y=n[3],w=n[4],T=n[5],E=n[6],I=n[7],R=w*y+I*d+T*m-E*p,F=T*y+I*p+E*d-w*m,B=E*y+I*m+w*p-T*d,V=I*y-w*d-T*p-E*m;return S0.rotateZ(r,n,l),r[4]=R*(y=r[3])+V*(d=r[0])+F*(m=r[2])-B*(p=r[1]),r[5]=F*y+V*p+B*d-R*m,r[6]=B*y+V*m+R*p-F*d,r[7]=V*y-R*d-F*p-B*m,r},qn.rotateByQuatAppend=function(r,n,l){var d=l[0],p=l[1],m=l[2],y=l[3],w=n[0],T=n[1],E=n[2],I=n[3];return r[0]=w*y+I*d+T*m-E*p,r[1]=T*y+I*p+E*d-w*m,r[2]=E*y+I*m+w*p-T*d,r[3]=I*y-w*d-T*p-E*m,r[4]=(w=n[4])*y+(I=n[7])*d+(T=n[5])*m-(E=n[6])*p,r[5]=T*y+I*p+E*d-w*m,r[6]=E*y+I*m+w*p-T*d,r[7]=I*y-w*d-T*p-E*m,r},qn.rotateByQuatPrepend=function(r,n,l){var d=n[0],p=n[1],m=n[2],y=n[3],w=l[0],T=l[1],E=l[2],I=l[3];return r[0]=d*I+y*w+p*E-m*T,r[1]=p*I+y*T+m*w-d*E,r[2]=m*I+y*E+d*T-p*w,r[3]=y*I-d*w-p*T-m*E,r[4]=d*(I=l[7])+y*(w=l[4])+p*(E=l[6])-m*(T=l[5]),r[5]=p*I+y*T+m*w-d*E,r[6]=m*I+y*E+d*T-p*w,r[7]=y*I-d*w-p*T-m*E,r},qn.rotateAroundAxis=function(r,n,l,d){if(Math.abs(d)<aa.EPSILON)return $w(r,n);var p=Math.hypot(l[0],l[1],l[2]);d*=.5;var m=Math.sin(d),y=m*l[0]/p,w=m*l[1]/p,T=m*l[2]/p,E=Math.cos(d),I=n[0],R=n[1],F=n[2],B=n[3];r[0]=I*E+B*y+R*T-F*w,r[1]=R*E+B*w+F*y-I*T,r[2]=F*E+B*T+I*w-R*y,r[3]=B*E-I*y-R*w-F*T;var V=n[4],W=n[5],$=n[6],J=n[7];return r[4]=V*E+J*y+W*T-$*w,r[5]=W*E+J*w+$*y-V*T,r[6]=$*E+J*T+V*w-W*y,r[7]=J*E-V*y-W*w-$*T,r},qn.add=function(r,n,l){return r[0]=n[0]+l[0],r[1]=n[1]+l[1],r[2]=n[2]+l[2],r[3]=n[3]+l[3],r[4]=n[4]+l[4],r[5]=n[5]+l[5],r[6]=n[6]+l[6],r[7]=n[7]+l[7],r},qn.multiply=Yw,qn.scale=function(r,n,l){return r[0]=n[0]*l,r[1]=n[1]*l,r[2]=n[2]*l,r[3]=n[3]*l,r[4]=n[4]*l,r[5]=n[5]*l,r[6]=n[6]*l,r[7]=n[7]*l,r},qn.lerp=function(r,n,l,d){var p=1-d;return Jw(n,l)<0&&(d=-d),r[0]=n[0]*p+l[0]*d,r[1]=n[1]*p+l[1]*d,r[2]=n[2]*p+l[2]*d,r[3]=n[3]*p+l[3]*d,r[4]=n[4]*p+l[4]*d,r[5]=n[5]*p+l[5]*d,r[6]=n[6]*p+l[6]*d,r[7]=n[7]*p+l[7]*d,r},qn.invert=function(r,n){var l=b4(n);return r[0]=-n[0]/l,r[1]=-n[1]/l,r[2]=-n[2]/l,r[3]=n[3]/l,r[4]=-n[4]/l,r[5]=-n[5]/l,r[6]=-n[6]/l,r[7]=n[7]/l,r},qn.conjugate=function(r,n){return r[0]=-n[0],r[1]=-n[1],r[2]=-n[2],r[3]=n[3],r[4]=-n[4],r[5]=-n[5],r[6]=-n[6],r[7]=n[7],r},qn.normalize=function(r,n){var l=b4(n);if(l>0){l=Math.sqrt(l);var d=n[0]/l,p=n[1]/l,m=n[2]/l,y=n[3]/l,w=n[4],T=n[5],E=n[6],I=n[7],R=d*w+p*T+m*E+y*I;r[0]=d,r[1]=p,r[2]=m,r[3]=y,r[4]=(w-d*R)/l,r[5]=(T-p*R)/l,r[6]=(E-m*R)/l,r[7]=(I-y*R)/l}return r},qn.str=function(r){return"quat2("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+", "+r[4]+", "+r[5]+", "+r[6]+", "+r[7]+")"},qn.exactEquals=function(r,n){return r[0]===n[0]&&r[1]===n[1]&&r[2]===n[2]&&r[3]===n[3]&&r[4]===n[4]&&r[5]===n[5]&&r[6]===n[6]&&r[7]===n[7]},qn.equals=function(r,n){var l=r[0],d=r[1],p=r[2],m=r[3],y=r[4],w=r[5],T=r[6],E=r[7],I=n[0],R=n[1],F=n[2],B=n[3],V=n[4],W=n[5],$=n[6],J=n[7];return Math.abs(l-I)<=aa.EPSILON*Math.max(1,Math.abs(l),Math.abs(I))&&Math.abs(d-R)<=aa.EPSILON*Math.max(1,Math.abs(d),Math.abs(R))&&Math.abs(p-F)<=aa.EPSILON*Math.max(1,Math.abs(p),Math.abs(F))&&Math.abs(m-B)<=aa.EPSILON*Math.max(1,Math.abs(m),Math.abs(B))&&Math.abs(y-V)<=aa.EPSILON*Math.max(1,Math.abs(y),Math.abs(V))&&Math.abs(w-W)<=aa.EPSILON*Math.max(1,Math.abs(w),Math.abs(W))&&Math.abs(T-$)<=aa.EPSILON*Math.max(1,Math.abs(T),Math.abs($))&&Math.abs(E-J)<=aa.EPSILON*Math.max(1,Math.abs(E),Math.abs(J))},qn.sqrLen=qn.squaredLength=qn.len=qn.length=qn.dot=qn.mul=qn.setReal=qn.getReal=void 0;var aa=ov(Xs),S0=ov(un),qw=ov(vn);function Xw(r){if(typeof WeakMap!="function")return null;var n=new WeakMap,l=new WeakMap;return(Xw=function(d){return d?l:n})(r)}function ov(r,n){if(!n&&r&&r.__esModule)return r;if(r===null||sv(r)!=="object"&&typeof r!="function")return{default:r};var l=Xw(n);if(l&&l.has(r))return l.get(r);var d={},p=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in r)if(m!=="default"&&Object.prototype.hasOwnProperty.call(r,m)){var y=p?Object.getOwnPropertyDescriptor(r,m):null;y&&(y.get||y.set)?Object.defineProperty(d,m,y):d[m]=r[m]}return d.default=r,l&&l.set(r,d),d}function Zw(r,n,l){var d=.5*l[0],p=.5*l[1],m=.5*l[2],y=n[0],w=n[1],T=n[2],E=n[3];return r[0]=y,r[1]=w,r[2]=T,r[3]=E,r[4]=d*E+p*T-m*w,r[5]=p*E+m*y-d*T,r[6]=m*E+d*w-p*y,r[7]=-d*y-p*w-m*T,r}function $w(r,n){return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r[4]=n[4],r[5]=n[5],r[6]=n[6],r[7]=n[7],r}function Yw(r,n,l){var d=n[0],p=n[1],m=n[2],y=n[3],w=l[4],T=l[5],E=l[6],I=l[7],R=n[4],F=n[5],B=n[6],V=n[7],W=l[0],$=l[1],J=l[2],le=l[3];return r[0]=d*le+y*W+p*J-m*$,r[1]=p*le+y*$+m*W-d*J,r[2]=m*le+y*J+d*$-p*W,r[3]=y*le-d*W-p*$-m*J,r[4]=d*I+y*w+p*E-m*T+R*le+V*W+F*J-B*$,r[5]=p*I+y*T+m*w-d*E+F*le+V*$+B*W-R*J,r[6]=m*I+y*E+d*T-p*w+B*le+V*J+R*$-F*W,r[7]=y*I-d*w-p*T-m*E+V*le-R*W-F*$-B*J,r}qn.getReal=S0.copy,qn.setReal=S0.copy,qn.mul=Yw;var Jw=S0.dot;qn.dot=Jw;var Kw=S0.length;qn.length=Kw,qn.len=Kw;var b4=S0.squaredLength;qn.squaredLength=b4,qn.sqrLen=b4;var En={};function av(r){return av=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},av(r)}Object.defineProperty(En,"__esModule",{value:!0}),En.create=eS,En.clone=function(r){var n=new fu.ARRAY_TYPE(2);return n[0]=r[0],n[1]=r[1],n},En.fromValues=function(r,n){var l=new fu.ARRAY_TYPE(2);return l[0]=r,l[1]=n,l},En.copy=function(r,n){return r[0]=n[0],r[1]=n[1],r},En.set=function(r,n,l){return r[0]=n,r[1]=l,r},En.add=function(r,n,l){return r[0]=n[0]+l[0],r[1]=n[1]+l[1],r},En.subtract=tS,En.multiply=iS,En.divide=nS,En.ceil=function(r,n){return r[0]=Math.ceil(n[0]),r[1]=Math.ceil(n[1]),r},En.floor=function(r,n){return r[0]=Math.floor(n[0]),r[1]=Math.floor(n[1]),r},En.min=function(r,n,l){return r[0]=Math.min(n[0],l[0]),r[1]=Math.min(n[1],l[1]),r},En.max=function(r,n,l){return r[0]=Math.max(n[0],l[0]),r[1]=Math.max(n[1],l[1]),r},En.round=function(r,n){return r[0]=Math.round(n[0]),r[1]=Math.round(n[1]),r},En.scale=function(r,n,l){return r[0]=n[0]*l,r[1]=n[1]*l,r},En.scaleAndAdd=function(r,n,l,d){return r[0]=n[0]+l[0]*d,r[1]=n[1]+l[1]*d,r},En.distance=rS,En.squaredDistance=sS,En.length=oS,En.squaredLength=aS,En.negate=function(r,n){return r[0]=-n[0],r[1]=-n[1],r},En.inverse=function(r,n){return r[0]=1/n[0],r[1]=1/n[1],r},En.normalize=function(r,n){var l=n[0],d=n[1],p=l*l+d*d;return p>0&&(p=1/Math.sqrt(p)),r[0]=n[0]*p,r[1]=n[1]*p,r},En.dot=function(r,n){return r[0]*n[0]+r[1]*n[1]},En.cross=function(r,n,l){var d=n[0]*l[1]-n[1]*l[0];return r[0]=r[1]=0,r[2]=d,r},En.lerp=function(r,n,l,d){var p=n[0],m=n[1];return r[0]=p+d*(l[0]-p),r[1]=m+d*(l[1]-m),r},En.random=function(r,n){n=n||1;var l=2*fu.RANDOM()*Math.PI;return r[0]=Math.cos(l)*n,r[1]=Math.sin(l)*n,r},En.transformMat2=function(r,n,l){var d=n[0],p=n[1];return r[0]=l[0]*d+l[2]*p,r[1]=l[1]*d+l[3]*p,r},En.transformMat2d=function(r,n,l){var d=n[0],p=n[1];return r[0]=l[0]*d+l[2]*p+l[4],r[1]=l[1]*d+l[3]*p+l[5],r},En.transformMat3=function(r,n,l){var d=n[0],p=n[1];return r[0]=l[0]*d+l[3]*p+l[6],r[1]=l[1]*d+l[4]*p+l[7],r},En.transformMat4=function(r,n,l){var d=n[0],p=n[1];return r[0]=l[0]*d+l[4]*p+l[12],r[1]=l[1]*d+l[5]*p+l[13],r},En.rotate=function(r,n,l,d){var p=n[0]-l[0],m=n[1]-l[1],y=Math.sin(d),w=Math.cos(d);return r[0]=p*w-m*y+l[0],r[1]=p*y+m*w+l[1],r},En.angle=function(r,n){var l=r[0],d=r[1],p=n[0],m=n[1],y=Math.sqrt(l*l+d*d)*Math.sqrt(p*p+m*m);return Math.acos(Math.min(Math.max(y&&(l*p+d*m)/y,-1),1))},En.zero=function(r){return r[0]=0,r[1]=0,r},En.str=function(r){return"vec2("+r[0]+", "+r[1]+")"},En.exactEquals=function(r,n){return r[0]===n[0]&&r[1]===n[1]},En.equals=function(r,n){var l=r[0],d=r[1],p=n[0],m=n[1];return Math.abs(l-p)<=fu.EPSILON*Math.max(1,Math.abs(l),Math.abs(p))&&Math.abs(d-m)<=fu.EPSILON*Math.max(1,Math.abs(d),Math.abs(m))},En.forEach=En.sqrLen=En.sqrDist=En.dist=En.div=En.mul=En.sub=En.len=void 0;var fu=function(r,n){if(r&&r.__esModule)return r;if(r===null||av(r)!=="object"&&typeof r!="function")return{default:r};var l=Qw(void 0);if(l&&l.has(r))return l.get(r);var d={},p=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in r)if(m!=="default"&&Object.prototype.hasOwnProperty.call(r,m)){var y=p?Object.getOwnPropertyDescriptor(r,m):null;y&&(y.get||y.set)?Object.defineProperty(d,m,y):d[m]=r[m]}return d.default=r,l&&l.set(r,d),d}(Xs);function Qw(r){if(typeof WeakMap!="function")return null;var n=new WeakMap,l=new WeakMap;return(Qw=function(d){return d?l:n})(r)}function eS(){var r=new fu.ARRAY_TYPE(2);return fu.ARRAY_TYPE!=Float32Array&&(r[0]=0,r[1]=0),r}function tS(r,n,l){return r[0]=n[0]-l[0],r[1]=n[1]-l[1],r}function iS(r,n,l){return r[0]=n[0]*l[0],r[1]=n[1]*l[1],r}function nS(r,n,l){return r[0]=n[0]/l[0],r[1]=n[1]/l[1],r}function rS(r,n){return Math.hypot(n[0]-r[0],n[1]-r[1])}function sS(r,n){var l=n[0]-r[0],d=n[1]-r[1];return l*l+d*d}function oS(r){return Math.hypot(r[0],r[1])}function aS(r){var n=r[0],l=r[1];return n*n+l*l}En.len=oS,En.sub=tS,En.mul=iS,En.div=nS,En.dist=rS,En.sqrDist=sS,En.sqrLen=aS;var bL=function(){var r=eS();return function(n,l,d,p,m,y){var w,T;for(l||(l=2),d||(d=0),T=p?Math.min(p*l+d,n.length):n.length,w=d;w<T;w+=l)r[0]=n[w],r[1]=n[w+1],m(r,r,y),n[w]=r[0],n[w+1]=r[1];return n}}();function lv(r){return lv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},lv(r)}En.forEach=bL,Object.defineProperty(qs,"__esModule",{value:!0}),i.a7=qs.vec4=i.N=qs.vec3=qs.vec2=qs.quat2=i.bi=qs.quat=i.a6=qs.mat4=i.co=qs.mat3=qs.mat2d=i.b4=qs.mat2=qs.glMatrix=void 0;var wL=Oc(Xs);qs.glMatrix=wL;var SL=Oc(Qr);i.b4=qs.mat2=SL;var TL=Oc(ss);qs.mat2d=TL;var ML=Oc(Ar);i.co=qs.mat3=ML;var EL=Oc(vn);i.a6=qs.mat4=EL;var AL=Oc(un);i.bi=qs.quat=AL;var CL=Oc(qn);qs.quat2=CL;var IL=Oc(En);qs.vec2=IL;var PL=Oc(_n);i.N=qs.vec3=PL;var RL=Oc(On);function lS(r){if(typeof WeakMap!="function")return null;var n=new WeakMap,l=new WeakMap;return(lS=function(d){return d?l:n})(r)}function Oc(r,n){if(!n&&r&&r.__esModule)return r;if(r===null||lv(r)!=="object"&&typeof r!="function")return{default:r};var l=lS(n);if(l&&l.has(r))return l.get(r);var d={},p=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in r)if(m!=="default"&&Object.prototype.hasOwnProperty.call(r,m)){var y=p?Object.getOwnPropertyDescriptor(r,m):null;y&&(y.get||y.set)?Object.defineProperty(d,m,y):d[m]=r[m]}return d.default=r,l&&l.set(r,d),d}i.a7=qs.vec4=RL;class cv{constructor(n,l){this.pos=n,this.dir=l}intersectsPlane(n,l,d){let p=i.N.dot(l,this.dir);if(Math.abs(p)<1e-6)return!1;let m=((n[0]-this.pos[0])*l[0]+(n[1]-this.pos[1])*l[1]+(n[2]-this.pos[2])*l[2])/p;return d[0]=this.pos[0]+this.dir[0]*m,d[1]=this.pos[1]+this.dir[1]*m,d[2]=this.pos[2]+this.dir[2]*m,!0}closestPointOnSphere(n,l,d){if(i.N.equals(this.pos,n)||l===0)return d[0]=d[1]=d[2]=0,!1;let[p,m,y]=this.dir,w=this.pos[0]-n[0],T=this.pos[1]-n[1],E=this.pos[2]-n[2],I=p*p+m*m+y*y,R=2*(w*p+T*m+E*y),F=R*R-4*I*(w*w+T*T+E*E-l*l);if(F<0){let B=Math.max(-R/2,0),V=w+p*B,W=T+m*B,$=E+y*B,J=Math.hypot(V,W,$);return d[0]=V*l/J,d[1]=W*l/J,d[2]=$*l/J,!1}{let B=(-R-Math.sqrt(F))/(2*I);if(B<0){let V=Math.hypot(w,T,E);return d[0]=w*l/V,d[1]=T*l/V,d[2]=E*l/V,!1}return d[0]=w+p*B,d[1]=T+m*B,d[2]=E+y*B,!0}}}class hv{constructor(n,l,d,p,m){this.TL=n,this.TR=l,this.BR=d,this.BL=p,this.horizon=m}static fromInvProjectionMatrix(n,l,d){let p=[-1,1,1],m=[1,1,1],y=[1,-1,1],w=[-1,-1,1],T=i.N.transformMat4(p,p,n),E=i.N.transformMat4(m,m,n),I=i.N.transformMat4(y,y,n),R=i.N.transformMat4(w,w,n);return new hv(T,E,I,R,l/d)}}function Ym(r,n,l){let d=1/0,p=-1/0,m=[];for(let y of r){i.N.sub(m,y,n);let w=i.N.dot(m,l);d=Math.min(d,w),p=Math.max(p,w)}return[d,p]}function cS(r,n){let l=!0;for(let d=0;d<r.planes.length;d++){let p=r.planes[d],m=0;for(let y=0;y<n.length;y++)m+=i.N.dot(p,n[y])+p[3]>=0;if(m===0)return 0;m!==n.length&&(l=!1)}return l?2:1}function hS(r,n){for(let l of r.projections){let d=Ym(n,r.points[0],l.axis);if(l.projection[1]<d[0]||l.projection[0]>d[1])return 0}return 1}function dS(r,n){let l=0,d=[0,0,0,0];for(let p=0;p<r.length;p++)d[0]=r[p][0],d[1]=r[p][1],d[2]=r[p][2],d[3]=1,i.a7.dot(d,n)>=0&&l++;return l}class dv{constructor(n,l){this.points=n||new Array(8).fill([0,0,0]),this.planes=l||new Array(6).fill([0,0,0,0]),this.bounds=os.fromPoints(this.points),this.projections=[],this.frustumEdges=[i.N.sub([],this.points[2],this.points[3]),i.N.sub([],this.points[0],this.points[3]),i.N.sub([],this.points[4],this.points[0]),i.N.sub([],this.points[5],this.points[1]),i.N.sub([],this.points[6],this.points[2]),i.N.sub([],this.points[7],this.points[3])];for(let d of this.frustumEdges){let p=[0,-d[2],d[1]],m=[d[2],0,-d[0]];this.projections.push({axis:p,projection:Ym(this.points,this.points[0],p)}),this.projections.push({axis:m,projection:Ym(this.points,this.points[0],m)})}}static fromInvProjectionMatrix(n,l,d,p){let m=Math.pow(2,d),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(E=>{let I=i.a7.transformMat4([],E,n),R=1/I[3]/l*m;return i.a7.mul(I,I,[R,R,p?1/I[3]:R,R])}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(E=>{let I=i.N.sub([],y[E[0]],y[E[1]]),R=i.N.sub([],y[E[2]],y[E[1]]),F=i.N.normalize([],i.N.cross([],I,R)),B=-i.N.dot(F,y[E[1]]);return F.concat(B)}),T=[];for(let E=0;E<y.length;E++)T.push([y[E][0],y[E][1],y[E][2]]);return new dv(T,w)}intersectsPrecise(n,l,d){for(let p=0;p<l.length;p++)if(!dS(n,l[p]))return 0;for(let p=0;p<this.planes.length;p++)if(!dS(n,this.planes[p]))return 0;for(let p of d)for(let m of this.frustumEdges){let y=i.N.cross([],p,m),w=i.N.length(y);if(w===0)continue;i.N.scale(y,y,1/w);let T=Ym(this.points,this.points[0],y),E=Ym(n,this.points[0],y);if(T[0]>E[1]||E[0]>T[1])return 0}return 1}}class os{static fromPoints(n){let l=[1/0,1/0,1/0],d=[-1/0,-1/0,-1/0];for(let p of n)i.N.min(l,l,p),i.N.max(d,d,p);return new os(l,d)}static fromTileIdAndHeight(n,l,d){let p=1<<n.canonical.z,m=n.canonical.x,y=n.canonical.y;return new os([m/p,y/p,l],[(m+1)/p,(y+1)/p,d])}static applyTransform(n,l){let d=n.getCorners();for(let p=0;p<d.length;++p)i.N.transformMat4(d[p],d[p],l);return os.fromPoints(d)}static projectAabbCorners(n,l){let d=n.getCorners();for(let p=0;p<d.length;++p)i.N.transformMat4(d[p],d[p],l);return d}constructor(n,l){this.min=n,this.max=l,this.center=i.N.scale([],i.N.add([],this.min,this.max),.5)}quadrant(n){let l=[n%2==0,n<2],d=i.N.clone(this.min),p=i.N.clone(this.max);for(let m=0;m<l.length;m++)d[m]=l[m]?this.min[m]:this.center[m],p[m]=l[m]?this.center[m]:this.max[m];return p[2]=this.max[2],new os(d,p)}distanceX(n){return Math.max(Math.min(this.max[0],n[0]),this.min[0])-n[0]}distanceY(n){return Math.max(Math.min(this.max[1],n[1]),this.min[1])-n[1]}distanceZ(n){return Math.max(Math.min(this.max[2],n[2]),this.min[2])-n[2]}getCorners(){let n=this.min,l=this.max;return[[n[0],n[1],n[2]],[l[0],n[1],n[2]],[l[0],l[1],n[2]],[n[0],l[1],n[2]],[n[0],n[1],l[2]],[l[0],n[1],l[2]],[l[0],l[1],l[2]],[n[0],l[1],l[2]]]}intersects(n){return this.intersectsAabb(n.bounds)?cS(n,this.getCorners()):0}intersectsFlat(n){return this.intersectsAabb(n.bounds)?cS(n,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(n,l){return l||this.intersects(n)?hS(n,this.getCorners()):0}intersectsPreciseFlat(n,l){return l||this.intersectsFlat(n)?hS(n,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(n){for(let l=0;l<3;++l)if(this.min[l]>n.max[l]||n.min[l]>this.max[l])return!1;return!0}intersectsAabbXY(n){return!(this.min[0]>n.max[0]||n.min[0]>this.max[0]||this.min[1]>n.max[1]||n.min[1]>this.max[1])}encapsulate(n){for(let l=0;l<3;l++)this.min[l]=Math.min(this.min[l],n.min[l]),this.max[l]=Math.max(this.max[l],n.max[l])}encapsulatePoint(n){for(let l=0;l<3;l++)this.min[l]=Math.min(this.min[l],n[l]),this.max[l]=Math.max(this.max[l],n[l])}closestPoint(n){return[Math.max(Math.min(this.max[0],n[0]),this.min[0]),Math.max(Math.min(this.max[1],n[1]),this.min[1]),Math.max(Math.min(this.max[2],n[2]),this.min[2])]}}hi(os,"Aabb");let kL=gr([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:w4}=kL,DL=gr([{name:"a_pos_3",components:3,type:"Int16"}]);var uS=gr([{name:"a_pos",type:"Int16",components:2}]);function S4(r){return r*ce/nt}let LL=[new os([Oe,Oe,Oe],[Je,Je,Je]),new os([Oe,Oe,Oe],[0,0,Je]),new os([0,Oe,Oe],[Je,0,Je]),new os([Oe,0,Oe],[0,Je,Je]),new os([0,0,Oe],[Je,Je,Je])];function pS(r,n,l,d=!0){let p=i.N.scale([],r._camera.position,r.worldSize),m=[n,l,1,1];i.a7.transformMat4(m,m,r.pixelMatrixInverse),i.a7.scale(m,m,1/m[3]);let y=i.N.sub([],m,p),w=i.N.normalize([],y),T=r.globeMatrix,E=[T[12],T[13],T[14]],I=i.N.sub([],E,p),R=i.N.length(I),F=i.N.normalize([],I),B=r.worldSize/(2*Math.PI),V=i.N.dot(F,w),W=Math.asin(B/R);if(W<Math.acos(V)){if(!d)return null;let qe=[],dt=[];i.N.scale(qe,w,R/V),i.N.normalize(dt,i.N.sub(dt,qe,I)),i.N.normalize(w,i.N.add(w,I,i.N.scale(w,dt,Math.tan(W)*R)))}let $=[];new cv(p,w).closestPointOnSphere(E,B,$);let J=i.N.normalize([],he(T,0)),le=i.N.normalize([],he(T,1)),pe=i.N.normalize([],he(T,2)),ue=i.N.dot(J,$),Me=i.N.dot(le,$),xe=i.N.dot(pe,$),ke=se(Math.asin(-Me/B)),Be=se(Math.atan2(ue,xe));Be=r.center.lng+function(qe,dt){let Mt=(dt-qe+180)%360-180;return Mt<-180?Mt+360:Mt}(r.center.lng,Be);let We=gn(Be),Ke=Xe(Zi(ke),0,1);return new Kn(We,Ke)}class FL{constructor(n,l,d){this.a=i.N.sub([],n,d),this.b=i.N.sub([],l,d),this.center=d;let p=i.N.normalize([],this.a),m=i.N.normalize([],this.b);this.angle=Math.acos(i.N.dot(p,m))}}function uv(r,n){if(r.angle===0)return null;let l;return l=r.a[n]===0?1/r.angle*.5*Math.PI:1/r.angle*Math.atan(r.b[n]/r.a[n]/Math.sin(r.angle)-1/Math.tan(r.angle)),l<0||l>1?null:function(d,p,m,y){let w=Math.sin(m);return d*(Math.sin((1-y)*m)/w)+p*(Math.sin(y*m)/w)}(r.a[n],r.b[n],r.angle,Xe(l,0,1))+r.center[n]}function Nc(r){if(r.z<=1)return LL[r.z+2*r.y+r.x];let n=pv(T4(r));return os.fromPoints(n)}function T0(r,n,l){return i.N.scale(r,r,1-l),i.N.scaleAndAdd(r,r,n,l)}function fS(r,n,l){for(let d of r)i.N.transformMat4(d,d,n),i.N.scale(d,d,l)}function mS(r,n,l,d){let p=n/r.worldSize,m=r.globeMatrix;if(l.z<=1){let We=Nc(l).getCorners();return fS(We,m,p),os.fromPoints(We)}let y=T4(l,d),w=pv(y,ce+S4(r._tileCoverLift));fS(w,m,p);let T=Number.MAX_VALUE,E=[-T,-T,-T],I=[T,T,T];if(y.contains(r.center)){for(let qe of w)i.N.min(I,I,qe),i.N.max(E,E,qe);E[2]=0;let We=r.point,Ke=[We.x*p,We.y*p,0];return i.N.min(I,I,Ke),i.N.max(E,E,Ke),new os(I,E)}if(r._tileCoverLift>0){for(let We of w)i.N.min(I,I,We),i.N.max(E,E,We);return new os(I,E)}let R=[m[12]*p,m[13]*p,m[14]*p],F=y.getCenter(),B=Xe(r.center.lat,-An,An),V=Xe(F.lat,-An,An),W=gn(r.center.lng),$=Zi(B),J=W-gn(F.lng),le=$-Zi(V);J>.5?J-=1:J<-.5&&(J+=1);let pe=0;if(Math.abs(J)>Math.abs(le))pe=J>=0?1:3;else{pe=le>=0?0:2;let We=[m[4]*p,m[5]*p,m[6]*p],Ke=-Math.sin(De(le>=0?y.getSouth():y.getNorth()))*ce;i.N.scaleAndAdd(R,R,We,Ke)}let ue=w[pe],Me=w[(pe+1)%4],xe=new FL(ue,Me,R),ke=[uv(xe,0)||ue[0],uv(xe,1)||ue[1],uv(xe,2)||ue[2]],Be=xh(r.zoom);if(Be>0){let We=function({x:qe,y:dt,z:Mt},rt,vt,it,yt){let Xt=1/(1<<Mt),At=qe*Xt,fi=At+Xt,oi=dt*Xt,Lt=oi+Xt,Ni=0,wi=(At+fi)/2-it;return wi>.5?Ni=-1:wi<-.5&&(Ni=1),At=((At+Ni)*rt-(it*=rt))*vt+it,fi=((fi+Ni)*rt-it)*vt+it,oi=(oi*rt-(yt*=rt))*vt+yt,Lt=(Lt*rt-yt)*vt+yt,[[At,Lt,0],[fi,Lt,0],[fi,oi,0],[At,oi,0]]}(l,n,r._pixelsPerMercatorPixel,W,$);for(let qe=0;qe<w.length;qe++)T0(w[qe],We[qe],Be);let Ke=i.N.add([],We[pe],We[(pe+1)%4]);i.N.scale(Ke,Ke,.5),T0(ke,Ke,Be)}for(let We of w)i.N.min(I,I,We),i.N.max(E,E,We);return I[2]=Math.min(ue[2],Me[2]),i.N.min(I,I,ke),i.N.max(E,E,ke),new os(I,E)}function T4({x:r,y:n,z:l},d=!1){let p=1/(1<<l),m=new je(an(r*p),n===(1<<l)-1&&d?-90:Wn((n+1)*p)),y=new je(an((r+1)*p),n===0&&d?90:Wn(n*p));return new tt(m,y)}function pv(r,n=ce){let l=De(r.getNorth()),d=De(r.getSouth()),p=Math.cos(l),m=Math.cos(d),y=Math.sin(l),w=Math.sin(d),T=r.getWest(),E=r.getEast();return[Ue(m,w,T,n),Ue(m,w,E,n),Ue(p,y,E,n),Ue(p,y,T,n)]}function Jm(r,n,l,d){let p=1<<l.z,m=(r/ii+l.x)/p;return ot(Wn((n/ii+l.y)/p),an(m),d)}function M4({min:r,max:n}){return ve/Math.max(n[0]-r[0],n[1]-r[1],n[2]-r[2])}let gS=new Float64Array(16);function E4(r){let n=M4(r),l=i.a6.fromScaling(gS,[n,n,n]);return i.a6.translate(l,l,i.N.negate([],r.min))}function fv(r){let n=i.a6.fromTranslation(gS,r.min),l=1/M4(r);return i.a6.scale(n,n,[l,l,l])}function mv(r){let n=ii/(2*Math.PI);return r/(2*Math.PI)/n}function _S(r,n){return ii/(512*Math.pow(2,r))*M4(Nc(n))}function yS(r,n,l,d,p){let m=mv(l),y=[r,n,-l/(2*Math.PI)],w=i.a6.identity(new Float64Array(16));return i.a6.translate(w,w,y),i.a6.scale(w,w,[m,m,m]),i.a6.rotateX(w,w,De(-p)),i.a6.rotateY(w,w,De(-d)),w}function xh(r){return ht(_e,oe,r)}function vS(r,n){let l=ot(n.lat,n.lng),d=function(m){let y=ot(m._center.lat,m._center.lng),w=i.N.fromValues(0,1,0),T=i.N.cross([],w,y),E=i.a6.fromRotation([],-m.angle,y);T=i.N.transformMat4(T,T,E),i.a6.fromRotation(E,-m._pitch,T);let I=i.N.normalize([],y);return i.N.scale(I,I,S4(m.cameraToCenterDistance/m.pixelsPerMeter)),i.N.transformMat4(I,I,E),i.N.add([],y,I)}(r),p=i.N.subtract([],d,l);return i.N.angle(p,l)}function gv(r,n){return vS(r,n)>Math.PI/2*1.01}let xS=De(85),OL=Math.cos(xS),NL=Math.sin(xS),zL=i.a6.create(),bS=r=>{let n=[];return r.paint.get("circle-pitch-alignment")==="map"&&n.push("PITCH_WITH_MAP"),r.paint.get("circle-pitch-scale")==="map"&&n.push("SCALE_WITH_MAP"),n};function wS(r,n,l,d,p,m,y,w,T){if(m&&r.queryGeometry.isAboveHorizon)return!1;m&&(T*=r.pixelToTileUnitsFactor);let E=r.tileID.canonical,I=l.projection.upVectorScale(E,l.center.lat,l.worldSize).metersToTile;for(let R of n)for(let F of R){let B=F.add(w),V=p&&l.elevation?l.elevation.exaggeration()*p.getElevationAt(B.x,B.y,!0):0,W=l.projection.projectTilePoint(B.x,B.y,E);if(V>0){let pe=l.projection.upVector(E,B.x,B.y);W.x+=pe[0]*I*V,W.y+=pe[1]*I*V,W.z+=pe[2]*I*V}let $=m?B:BL(W.x,W.y,W.z,d),J=m?r.tilespaceRays.map(pe=>VL(pe,V)):r.queryGeometry.screenGeometry,le=i.a7.transformMat4([],[W.x,W.y,W.z,1],d);if(!y&&m?T*=le[3]/l.cameraToCenterDistance:y&&!m&&(T*=l.cameraToCenterDistance/le[3]),m){let pe=Wn((F.y/ii+E.y)/(1<<E.z));T/=l.projection.pixelsPerMeter(pe,1)/hn(1,pe)}if(Lc(J,$,T))return!0}return!1}function BL(r,n,l,d){let p=i.a7.transformMat4([],[r,n,l,1],d);return new de(p[0]/p[3],p[1]/p[3])}let SS=i.N.fromValues(0,0,0),UL=i.N.fromValues(0,0,1);function VL(r,n){let l=i.N.create();return SS[2]=n,r.intersectsPlane(SS,UL,l),new de(l[0],l[1])}class TS extends Zo{}function MS(r,{width:n,height:l},d,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==n*l*d)throw new RangeError("mismatched image size")}else p=new Uint8Array(n*l*d);return r.width=n,r.height=l,r.data=p,r}function ES(r,n,l){let{width:d,height:p}=n;d===r.width&&p===r.height||(_v(r,n,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,d),height:Math.min(r.height,p)},l),r.width=d,r.height=p,r.data=n.data)}function _v(r,n,l,d,p,m,y){if(p.width===0||p.height===0)return n;if(p.width>r.width||p.height>r.height||l.x>r.width-p.width||l.y>r.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>n.width||p.height>n.height||d.x>n.width-p.width||d.y>n.height-p.height)throw new RangeError("out of range destination coordinates for image copy");let w=r.data,T=n.data,E=m===4&&y;for(let I=0;I<p.height;I++){let R=((l.y+I)*r.width+l.x)*m,F=((d.y+I)*n.width+d.x)*m;if(E)for(let B=0;B<p.width;B++){let V=R+B*m+3,W=F+B*m;T[W+0]=255,T[W+1]=255,T[W+2]=255,T[W+3]=w[V]}else for(let B=0;B<p.width*m;B++)T[F+B]=w[R+B]}return n}hi(TS,"HeatmapBucket",{omit:["layers"]});class bh{constructor(n,l){MS(this,n,1,l)}resize(n){ES(this,new bh(n),1)}clone(){return new bh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,l,d,p,m){_v(n,l,d,p,m,1)}}class Ja{constructor(n,l){MS(this,n,4,l)}resize(n){ES(this,new Ja(n),4)}replace(n,l){l?this.data.set(n):this.data=n instanceof Uint8ClampedArray?new Uint8Array(n.buffer):n}clone(){return new Ja({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,l,d,p,m,y){_v(n,l,d,p,m,4,y)}}class AS{constructor(n,l){this.width=n.width,this.height=n.height,this.data=l instanceof Uint8Array?new Float32Array(l.buffer):l}}hi(bh,"AlphaImage"),hi(Ja,"RGBAImage");let GL=new Jr({visibility:new qt($e.layout_heatmap.visibility)});var HL={paint:new Jr({"heatmap-radius":new Ai($e.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ai($e.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new qt($e.paint_heatmap["heatmap-intensity"]),"heatmap-color":new _0($e.paint_heatmap["heatmap-color"]),"heatmap-opacity":new qt($e.paint_heatmap["heatmap-opacity"])}),layout:GL};function Km(r){let n={},l=r.resolution||256,d=r.clips?r.clips.length:1,p=r.image||new Ja({width:l,height:d}),m=(y,w,T)=>{n[r.evaluationKey]=T;let E=r.expression.evaluate(n);E&&(p.data[y+w+0]=Math.floor(255*E.r/E.a),p.data[y+w+1]=Math.floor(255*E.g/E.a),p.data[y+w+2]=Math.floor(255*E.b/E.a),p.data[y+w+3]=Math.floor(255*E.a))};if(r.clips)for(let y=0,w=0;y<d;++y,w+=4*l)for(let T=0,E=0;T<l;T++,E+=4){let I=T/(l-1),{start:R,end:F}=r.clips[y];m(w,E,R*(1-I)+F*I)}else for(let y=0,w=0;y<l;y++,w+=4)m(0,w,y/(l-1));return p}let jL=new Jr({visibility:new qt($e.layout_hillshade.visibility)});var WL={paint:new Jr({"hillshade-illumination-direction":new qt($e.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new qt($e.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new qt($e.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new qt($e.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new qt($e.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new qt($e.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new qt($e.paint_hillshade["hillshade-emissive-strength"])}),layout:jL};let qL=gr([{name:"a_pos",components:2,type:"Int16"}],4),{members:XL}=qL;var yv={exports:{}};function A4(r,n,l){l=l||2;var d,p,m,y,w,T,E,I=n&&n.length,R=I?n[0]*l:r.length,F=CS(r,0,R,l,!0),B=[];if(!F||F.next===F.prev)return B;if(I&&(F=function(W,$,J,le){var pe,ue,Me,xe=[];for(pe=0,ue=$.length;pe<ue;pe++)(Me=CS(W,$[pe]*le,pe<ue-1?$[pe+1]*le:W.length,le,!1))===Me.next&&(Me.steiner=!0),xe.push(tF(Me));for(xe.sort(KL),pe=0;pe<xe.length;pe++)J=QL(xe[pe],J);return J}(r,n,F,l)),r.length>80*l){d=m=r[0],p=y=r[1];for(var V=l;V<R;V+=l)(w=r[V])<d&&(d=w),(T=r[V+1])<p&&(p=T),w>m&&(m=w),T>y&&(y=T);E=(E=Math.max(m-d,y-p))!==0?32767/E:0}return Qm(F,B,l,d,p,E,0),B}function CS(r,n,l,d,p){var m,y;if(p===bv(r,n,l,d)>0)for(m=n;m<l;m+=d)y=RS(m,r[m],r[m+1],y);else for(m=l-d;m>=n;m-=d)y=RS(m,r[m],r[m+1],y);return y&&C4(y,y.next)&&(t2(y),y=y.next),y}function mu(r,n){if(!r)return r;n||(n=r);var l,d=r;do if(l=!1,d.steiner||!C4(d,d.next)&&Fs(d.prev,d,d.next)!==0)d=d.next;else{if(t2(d),(d=n=d.prev)===d.next)break;l=!0}while(l||d!==n);return n}function Qm(r,n,l,d,p,m,y){if(r){!y&&m&&function(I,R,F,B){var V=I;do V.z===0&&(V.z=vv(V.x,V.y,R,F,B)),V.prevZ=V.prev,V.nextZ=V.next,V=V.next;while(V!==I);V.prevZ.nextZ=null,V.prevZ=null,function(W){var $,J,le,pe,ue,Me,xe,ke,Be=1;do{for(J=W,W=null,ue=null,Me=0;J;){for(Me++,le=J,xe=0,$=0;$<Be&&(xe++,le=le.nextZ);$++);for(ke=Be;xe>0||ke>0&&le;)xe!==0&&(ke===0||!le||J.z<=le.z)?(pe=J,J=J.nextZ,xe--):(pe=le,le=le.nextZ,ke--),ue?ue.nextZ=pe:W=pe,pe.prevZ=ue,ue=pe;J=le}ue.nextZ=null,Be*=2}while(Me>1)}(V)}(r,d,p,m);for(var w,T,E=r;r.prev!==r.next;)if(w=r.prev,T=r.next,m?$L(r,d,p,m):ZL(r))n.push(w.i/l|0),n.push(r.i/l|0),n.push(T.i/l|0),t2(r),r=T.next,E=T.next;else if((r=T)===E){y?y===1?Qm(r=YL(mu(r),n,l),n,l,d,p,m,2):y===2&&JL(r,n,l,d,p,m):Qm(mu(r),n,l,d,p,m,1);break}}}function ZL(r){var n=r.prev,l=r,d=r.next;if(Fs(n,l,d)>=0)return!1;for(var p=n.x,m=l.x,y=d.x,w=n.y,T=l.y,E=d.y,I=p<m?p<y?p:y:m<y?m:y,R=w<T?w<E?w:E:T<E?T:E,F=p>m?p>y?p:y:m>y?m:y,B=w>T?w>E?w:E:T>E?T:E,V=d.next;V!==n;){if(V.x>=I&&V.x<=F&&V.y>=R&&V.y<=B&&Gp(p,w,m,T,y,E,V.x,V.y)&&Fs(V.prev,V,V.next)>=0)return!1;V=V.next}return!0}function $L(r,n,l,d){var p=r.prev,m=r,y=r.next;if(Fs(p,m,y)>=0)return!1;for(var w=p.x,T=m.x,E=y.x,I=p.y,R=m.y,F=y.y,B=w<T?w<E?w:E:T<E?T:E,V=I<R?I<F?I:F:R<F?R:F,W=w>T?w>E?w:E:T>E?T:E,$=I>R?I>F?I:F:R>F?R:F,J=vv(B,V,n,l,d),le=vv(W,$,n,l,d),pe=r.prevZ,ue=r.nextZ;pe&&pe.z>=J&&ue&&ue.z<=le;){if(pe.x>=B&&pe.x<=W&&pe.y>=V&&pe.y<=$&&pe!==p&&pe!==y&&Gp(w,I,T,R,E,F,pe.x,pe.y)&&Fs(pe.prev,pe,pe.next)>=0||(pe=pe.prevZ,ue.x>=B&&ue.x<=W&&ue.y>=V&&ue.y<=$&&ue!==p&&ue!==y&&Gp(w,I,T,R,E,F,ue.x,ue.y)&&Fs(ue.prev,ue,ue.next)>=0))return!1;ue=ue.nextZ}for(;pe&&pe.z>=J;){if(pe.x>=B&&pe.x<=W&&pe.y>=V&&pe.y<=$&&pe!==p&&pe!==y&&Gp(w,I,T,R,E,F,pe.x,pe.y)&&Fs(pe.prev,pe,pe.next)>=0)return!1;pe=pe.prevZ}for(;ue&&ue.z<=le;){if(ue.x>=B&&ue.x<=W&&ue.y>=V&&ue.y<=$&&ue!==p&&ue!==y&&Gp(w,I,T,R,E,F,ue.x,ue.y)&&Fs(ue.prev,ue,ue.next)>=0)return!1;ue=ue.nextZ}return!0}function YL(r,n,l){var d=r;do{var p=d.prev,m=d.next.next;!C4(p,m)&&IS(p,d,d.next,m)&&e2(p,m)&&e2(m,p)&&(n.push(p.i/l|0),n.push(d.i/l|0),n.push(m.i/l|0),t2(d),t2(d.next),d=r=m),d=d.next}while(d!==r);return mu(d)}function JL(r,n,l,d,p,m){var y=r;do{for(var w=y.next.next;w!==y.prev;){if(y.i!==w.i&&iF(y,w)){var T=PS(y,w);return y=mu(y,y.next),T=mu(T,T.next),Qm(y,n,l,d,p,m,0),void Qm(T,n,l,d,p,m,0)}w=w.next}y=y.next}while(y!==r)}function KL(r,n){return r.x-n.x}function QL(r,n){var l=function(p,m){var y,w=m,T=p.x,E=p.y,I=-1/0;do{if(E<=w.y&&E>=w.next.y&&w.next.y!==w.y){var R=w.x+(E-w.y)*(w.next.x-w.x)/(w.next.y-w.y);if(R<=T&&R>I&&(I=R,y=w.x<w.next.x?w:w.next,R===T))return y}w=w.next}while(w!==m);if(!y)return null;var F,B=y,V=y.x,W=y.y,$=1/0;w=y;do T>=w.x&&w.x>=V&&T!==w.x&&Gp(E<W?T:I,E,V,W,E<W?I:T,E,w.x,w.y)&&(F=Math.abs(E-w.y)/(T-w.x),e2(w,p)&&(F<$||F===$&&(w.x>y.x||w.x===y.x&&eF(y,w)))&&(y=w,$=F)),w=w.next;while(w!==B);return y}(r,n);if(!l)return n;var d=PS(l,r);return mu(d,d.next),mu(l,l.next)}function eF(r,n){return Fs(r.prev,r,n.prev)<0&&Fs(n.next,r,r.next)<0}function vv(r,n,l,d,p){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-l)*p|0)|r<<8))|r<<4))|r<<2))|r<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-d)*p|0)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function tF(r){var n=r,l=r;do(n.x<l.x||n.x===l.x&&n.y<l.y)&&(l=n),n=n.next;while(n!==r);return l}function Gp(r,n,l,d,p,m,y,w){return(p-y)*(n-w)>=(r-y)*(m-w)&&(r-y)*(d-w)>=(l-y)*(n-w)&&(l-y)*(m-w)>=(p-y)*(d-w)}function iF(r,n){return r.next.i!==n.i&&r.prev.i!==n.i&&!function(l,d){var p=l;do{if(p.i!==l.i&&p.next.i!==l.i&&p.i!==d.i&&p.next.i!==d.i&&IS(p,p.next,l,d))return!0;p=p.next}while(p!==l);return!1}(r,n)&&(e2(r,n)&&e2(n,r)&&function(l,d){var p=l,m=!1,y=(l.x+d.x)/2,w=(l.y+d.y)/2;do p.y>w!=p.next.y>w&&p.next.y!==p.y&&y<(p.next.x-p.x)*(w-p.y)/(p.next.y-p.y)+p.x&&(m=!m),p=p.next;while(p!==l);return m}(r,n)&&(Fs(r.prev,r,n.prev)||Fs(r,n.prev,n))||C4(r,n)&&Fs(r.prev,r,r.next)>0&&Fs(n.prev,n,n.next)>0)}function Fs(r,n,l){return(n.y-r.y)*(l.x-n.x)-(n.x-r.x)*(l.y-n.y)}function C4(r,n){return r.x===n.x&&r.y===n.y}function IS(r,n,l,d){var p=P4(Fs(r,n,l)),m=P4(Fs(r,n,d)),y=P4(Fs(l,d,r)),w=P4(Fs(l,d,n));return p!==m&&y!==w||!(p!==0||!I4(r,l,n))||!(m!==0||!I4(r,d,n))||!(y!==0||!I4(l,r,d))||!(w!==0||!I4(l,n,d))}function I4(r,n,l){return n.x<=Math.max(r.x,l.x)&&n.x>=Math.min(r.x,l.x)&&n.y<=Math.max(r.y,l.y)&&n.y>=Math.min(r.y,l.y)}function P4(r){return r>0?1:r<0?-1:0}function e2(r,n){return Fs(r.prev,r,r.next)<0?Fs(r,n,r.next)>=0&&Fs(r,r.prev,n)>=0:Fs(r,n,r.prev)<0||Fs(r,r.next,n)<0}function PS(r,n){var l=new xv(r.i,r.x,r.y),d=new xv(n.i,n.x,n.y),p=r.next,m=n.prev;return r.next=n,n.prev=r,l.next=p,p.prev=l,d.next=l,l.prev=d,m.next=d,d.prev=m,d}function RS(r,n,l,d){var p=new xv(r,n,l);return d?(p.next=d.next,p.prev=d,d.next.prev=p,d.next=p):(p.prev=p,p.next=p),p}function t2(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function xv(r,n,l){this.i=r,this.x=n,this.y=l,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function bv(r,n,l,d){for(var p=0,m=n,y=l-d;m<l;m+=d)p+=(r[y]-r[m])*(r[m+1]+r[y+1]),y=m;return p}yv.exports=A4,yv.exports.default=A4,A4.deviation=function(r,n,l,d){var p=n&&n.length,m=Math.abs(bv(r,0,p?n[0]*l:r.length,l));if(p)for(var y=0,w=n.length;y<w;y++)m-=Math.abs(bv(r,n[y]*l,y<w-1?n[y+1]*l:r.length,l));var T=0;for(y=0;y<d.length;y+=3){var E=d[y]*l,I=d[y+1]*l,R=d[y+2]*l;T+=Math.abs((r[E]-r[R])*(r[I+1]-r[E+1])-(r[E]-r[I])*(r[R+1]-r[E+1]))}return m===0&&T===0?0:Math.abs((T-m)/m)},A4.flatten=function(r){for(var n=r[0][0].length,l={vertices:[],holes:[],dimensions:n},d=0,p=0;p<r.length;p++){for(var m=0;m<r[p].length;m++)for(var y=0;y<n;y++)l.vertices.push(r[p][m][y]);p>0&&l.holes.push(d+=r[p-1].length)}return l};var R4=G(yv.exports);function wv(r,n){let l=r.length;if(l<=1)return[r];let d=[],p,m;for(let y=0;y<l;y++){let w=$r(r[y]);w!==0&&(r[y].area=Math.abs(w),m===void 0&&(m=w<0),m===w<0?(p&&d.push(p),p=[r[y]]):p.push(r[y]))}if(p&&d.push(p),n>1)for(let y=0;y<d.length;y++)d[y].length<=n||(Ty(d[y],n,1,d[y].length-1,nF),d[y]=d[y].slice(0,n));return d}function nF(r,n){return n.area-r.area}function Sv(r,n,l){let d=l.patternDependencies,p=!1;for(let m of n){let y=m.paint.get(`${r}-pattern`);y.isConstant()||(p=!0);let w=y.constantOr(null);w&&(p=!0,d[w]=!0)}return p}function Tv(r,n,l,d,p){let m=p.patternDependencies;for(let y of n){let w=y.paint.get(`${r}-pattern`).value;if(w.kind!=="constant"){let T=w.evaluate({zoom:d},l,{},p.availableImages);T=T&&T.name?T.name:T,m[T]=!0,l.patterns[y.id]=T}}return l}class Mv{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(l=>l.fqid),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Za,this.indexArray=new Us,this.indexArray2=new yl,this.programConfigurations=new Q(n.layers,n.zoom),this.segments=new ls,this.segments2=new ls,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.projection=n.projection}populate(n,l,d,p){this.hasPattern=Sv("fill",this.layers,l);let m=this.layers[0].layout.get("fill-sort-key"),y=[];for(let{feature:w,id:T,index:E,sourceLayerIndex:I}of n){let R=this.layers[0]._featureFilter.needGeometry,F=Rs(w,R);if(!this.layers[0]._featureFilter.filter(new Yr(this.zoom),F,d))continue;let B=m?m.evaluate(F,{},d,l.availableImages):void 0,V={id:T,properties:w.properties,type:w.type,sourceLayerIndex:I,index:E,geometry:R?F.geometry:Gs(w,d,p),patterns:{},sortKey:B};y.push(V)}m&&y.sort((w,T)=>w.sortKey-T.sortKey);for(let w of y){let{geometry:T,index:E,sourceLayerIndex:I}=w;if(this.hasPattern){let R=Tv("fill",this.layers,w,this.zoom,l);this.patternFeatures.push(R)}else this.addFeature(w,T,E,d,{},l.availableImages,l.brightness);l.featureIndex.insert(n[E].feature,T,E,I,this.index)}}update(n,l,d,p,m){let y=Object.keys(n).length!==0;y&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(n,l,y?this.stateDependentLayers:this.layers,d,p,m)}addFeatures(n,l,d,p,m,y){for(let w of this.patternFeatures)this.addFeature(w,w.geometry,w.index,l,d,p,y)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,XL),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.indexBuffer2=n.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(n,l,d,p,m,y=[],w){for(let T of wv(l,500)){let E=0;for(let W of T)E+=W.length;let I=this.segments.prepareSegment(E,this.layoutVertexArray,this.indexArray),R=I.vertexLength,F=[],B=[];for(let W of T){if(W.length===0)continue;W!==T[0]&&B.push(F.length/2);let $=this.segments2.prepareSegment(W.length,this.layoutVertexArray,this.indexArray2),J=$.vertexLength;this.layoutVertexArray.emplaceBack(W[0].x,W[0].y),this.indexArray2.emplaceBack(J+W.length-1,J),F.push(W[0].x),F.push(W[0].y);for(let le=1;le<W.length;le++)this.layoutVertexArray.emplaceBack(W[le].x,W[le].y),this.indexArray2.emplaceBack(J+le-1,J+le),F.push(W[le].x),F.push(W[le].y);$.vertexLength+=W.length,$.primitiveLength+=W.length}let V=R4(F,B);for(let W=0;W<V.length;W+=3)this.indexArray.emplaceBack(R+V[W],R+V[W+1],R+V[W+2]);I.vertexLength+=E,I.primitiveLength+=V.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,d,m,y,p,w)}}hi(Mv,"FillBucket",{omit:["layers","patternFeatures"]});let rF=new Jr({"fill-sort-key":new Ai($e.layout_fill["fill-sort-key"]),visibility:new qt($e.layout_fill.visibility)});var sF={paint:new Jr({"fill-antialias":new qt($e.paint_fill["fill-antialias"]),"fill-opacity":new Ai($e.paint_fill["fill-opacity"]),"fill-color":new Ai($e.paint_fill["fill-color"]),"fill-outline-color":new Ai($e.paint_fill["fill-outline-color"]),"fill-translate":new qt($e.paint_fill["fill-translate"]),"fill-translate-anchor":new qt($e.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ai($e.paint_fill["fill-pattern"]),"fill-emissive-strength":new qt($e.paint_fill["fill-emissive-strength"])}),layout:rF};let oF=gr([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),aF=gr([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),lF=gr([{name:"a_centroid_pos",components:2,type:"Uint16"}]),cF=gr([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),hF=gr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:dF}=oF;var k4={},uF=fe,kS=Hp;function Hp(r,n,l,d,p){this.properties={},this.extent=l,this.type=0,this._pbf=r,this._geometry=-1,this._keys=d,this._values=p,r.readFields(pF,this,n)}function pF(r,n,l){r==1?n.id=l.readVarint():r==2?function(d,p){for(var m=d.readVarint()+d.pos;d.pos<m;){var y=p._keys[d.readVarint()],w=p._values[d.readVarint()];p.properties[y]=w}}(l,n):r==3?n.type=l.readVarint():r==4&&(n._geometry=l.pos)}function fF(r){for(var n,l,d=0,p=0,m=r.length,y=m-1;p<m;y=p++)d+=((l=r[y]).x-(n=r[p]).x)*(n.y+l.y);return d}Hp.types=["Unknown","Point","LineString","Polygon"],Hp.prototype.loadGeometry=function(){var r=this._pbf;r.pos=this._geometry;for(var n,l=r.readVarint()+r.pos,d=1,p=0,m=0,y=0,w=[];r.pos<l;){if(p<=0){var T=r.readVarint();d=7&T,p=T>>3}if(p--,d===1||d===2)m+=r.readSVarint(),y+=r.readSVarint(),d===1&&(n&&w.push(n),n=[]),n.push(new uF(m,y));else{if(d!==7)throw new Error("unknown command "+d);n&&n.push(n[0].clone())}}return n&&w.push(n),w},Hp.prototype.bbox=function(){var r=this._pbf;r.pos=this._geometry;for(var n=r.readVarint()+r.pos,l=1,d=0,p=0,m=0,y=1/0,w=-1/0,T=1/0,E=-1/0;r.pos<n;){if(d<=0){var I=r.readVarint();l=7&I,d=I>>3}if(d--,l===1||l===2)(p+=r.readSVarint())<y&&(y=p),p>w&&(w=p),(m+=r.readSVarint())<T&&(T=m),m>E&&(E=m);else if(l!==7)throw new Error("unknown command "+l)}return[y,T,w,E]},Hp.prototype.toGeoJSON=function(r,n,l){var d,p,m=this.extent*Math.pow(2,l),y=this.extent*r,w=this.extent*n,T=this.loadGeometry(),E=Hp.types[this.type];function I(B){for(var V=0;V<B.length;V++){var W=B[V];B[V]=[360*(W.x+y)/m-180,360/Math.PI*Math.atan(Math.exp((180-360*(W.y+w)/m)*Math.PI/180))-90]}}switch(this.type){case 1:var R=[];for(d=0;d<T.length;d++)R[d]=T[d][0];I(T=R);break;case 2:for(d=0;d<T.length;d++)I(T[d]);break;case 3:for(T=function(B){var V=B.length;if(V<=1)return[B];for(var W,$,J=[],le=0;le<V;le++){var pe=fF(B[le]);pe!==0&&($===void 0&&($=pe<0),$===pe<0?(W&&J.push(W),W=[B[le]]):W.push(B[le]))}return W&&J.push(W),J}(T),d=0;d<T.length;d++)for(p=0;p<T[d].length;p++)I(T[d][p])}T.length===1?T=T[0]:E="Multi"+E;var F={type:"Feature",geometry:{type:E,coordinates:T},properties:this.properties};return"id"in this&&(F.id=this.id),F};var mF=kS,DS=LS;function LS(r,n){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(gF,this,n),this.length=this._features.length}function gF(r,n,l){r===15?n.version=l.readVarint():r===1?n.name=l.readString():r===5?n.extent=l.readVarint():r===2?n._features.push(l.pos):r===3?n._keys.push(l.readString()):r===4&&n._values.push(function(d){for(var p=null,m=d.readVarint()+d.pos;d.pos<m;){var y=d.readVarint()>>3;p=y===1?d.readString():y===2?d.readFloat():y===3?d.readDouble():y===4?d.readVarint64():y===5?d.readVarint():y===6?d.readSVarint():y===7?d.readBoolean():null}return p}(l))}LS.prototype.feature=function(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];var n=this._pbf.readVarint()+this._pbf.pos;return new mF(this._pbf,n,this.extent,this._keys,this._values)};var _F=DS;function yF(r,n,l){if(r===3){var d=new _F(l,l.readVarint()+l.pos);d.length&&(n[d.name]=d)}}var Ev=k4.VectorTile=function(r,n){this.layers=r.readFields(yF,{},n)},D4=k4.VectorTileFeature=kS;function L4(r,n,l,d){let p=[],m=d===0?(y,w,T,E,I,R)=>{y.push(new de(R,T+(R-w)/(E-w)*(I-T)))}:(y,w,T,E,I,R)=>{y.push(new de(w+(R-T)/(I-T)*(E-w),R))};for(let y of r){let w=[];for(let T of y){if(T.length<=2)continue;let E=[];for(let F=0;F<T.length-1;F++){let B=T[F].x,V=T[F].y,W=T[F+1].x,$=T[F+1].y,J=d===0?B:V,le=d===0?W:$;J<n?le>n&&m(E,B,V,W,$,n):J>l?le<l&&m(E,B,V,W,$,l):E.push(T[F]),le<n&&J>=n&&m(E,B,V,W,$,n),le>l&&J<=l&&m(E,B,V,W,$,l)}let I=T[T.length-1],R=d===0?I.x:I.y;R>=n&&R<=l&&E.push(I),E.length&&(I=E[E.length-1],E[0].x===I.x&&E[0].y===I.y||E.push(E[0]),w.push(E))}w.length&&p.push(w)}return p}function F4(r,n){return r.x-n.x||r.y-n.y}function FS(r,n){return F4(r.min,n.min)===0&&F4(r.max,n.max)===0}function OS(r,n){return!(r.min.x>n.max.x||r.max.x<n.min.x||r.min.y>n.max.y||r.max.y<n.min.y)}function NS(r,n,l){let d=1/ii,p=1/(1<<l.canonical.z),m=(n.x*d+l.canonical.x)*p+l.wrap,y=(n.y*d+l.canonical.y)*p;return{min:new de((r.x*d+l.canonical.x)*p+l.wrap,(r.y*d+l.canonical.y)*p),max:new de(m,y)}}function vF(r,n,l){let d=1<<l.canonical.z,p=((n.x-l.wrap)*d-l.canonical.x)*ii,m=(n.y*d-l.canonical.y)*ii;return{min:new de(((r.x-l.wrap)*d-l.canonical.x)*ii,(r.y*d-l.canonical.y)*ii),max:new de(p,m)}}function zS(r,n,l,d,p,m,y){let w=r.indices,T=r.vertices,E=[];for(let I=d;I<d+p;I+=3){let R=n[l[I+0]+m],F=n[l[I+1]+m],B=n[l[I+2]+m],V=Math.min(R.x,F.x,B.x),W=Math.max(R.x,F.x,B.x),$=Math.min(R.y,F.y,B.y),J=Math.max(R.y,F.y,B.y);E.length=0,r.grid.query(new de(V,$),new de(W,J),E);for(let le=0;le<E.length;le++){let pe=E[le];if(Xy(T[w[3*pe+0]],T[w[3*pe+1]],T[w[3*pe+2]],R,F,B,y))return!0}}return!1}function BS(r,n,l,d){if(!r||!l)return!1;let p=r.vertices;if(!n.canonical.equals(d.canonical)||n.wrap!==d.wrap){if(l.vertices.length<r.vertices.length)return BS(l,d,r,n);let m=n.canonical,y=d.canonical,w=Math.pow(2,y.z-m.z);p=r.vertices.map(T=>new de(T.x*m.x*ii*w-y.x*ii,T.y*m.y*ii*w-y.y*ii))}return zS(l,p,r.indices,0,r.indices.length,0,0)}k4.VectorTileLayer=DS;class US{constructor(n){this.size=n,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(n,l){let d=this.toIdx(n,l);return{min:this.minimums[d],max:this.maximums[d]}}isLeaf(n,l){return this.leaves[this.toIdx(n,l)]}toIdx(n,l){return l*this.size+n}}function VS(r,n,l,d){let p=0,m=Number.MAX_VALUE;for(let y=0;y<3;y++)if(Math.abs(d[y])<1e-15){if(l[y]<r[y]||l[y]>n[y])return null}else{let w=1/d[y],T=(r[y]-l[y])*w,E=(n[y]-l[y])*w;if(T>E){let I=T;T=E,E=I}if(T>p&&(p=T),E<m&&(m=E),p>m)return null}return p}function GS(r,n,l,d,p,m,y,w,T,E,I){let R=d-r,F=p-n,B=m-l,V=y-r,W=w-n,$=T-l,J=I[1]*$-I[2]*W,le=I[2]*V-I[0]*$,pe=I[0]*W-I[1]*V,ue=R*J+F*le+B*pe;if(Math.abs(ue)<1e-15)return null;let Me=1/ue,xe=E[0]-r,ke=E[1]-n,Be=E[2]-l,We=(xe*J+ke*le+Be*pe)*Me;if(We<0||We>1)return null;let Ke=ke*B-Be*F,qe=Be*R-xe*B,dt=xe*F-ke*R,Mt=(I[0]*Ke+I[1]*qe+I[2]*dt)*Me;return Mt<0||We+Mt>1?null:(V*Ke+W*qe+$*dt)*Me}function HS(r,n,l){return(r-n)/(l-n)}function jS(r,n,l,d,p,m,y,w,T){let E=1<<l,I=m-d,R=y-p,F=(r+1)/E*I+d,B=(n+0)/E*R+p,V=(n+1)/E*R+p;w[0]=(r+0)/E*I+d,w[1]=B,T[0]=F,T[1]=V}class WS{constructor(n){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=n,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;let l=function(m){let y=Math.ceil(Math.log2(m.dim/8)),w=[],T=Math.ceil(Math.pow(2,y)),E=1/T,I=(B,V,W,$,J)=>{let le=$?1:0,pe=(B+1)*W-le,ue=V*W,Me=(V+1)*W-le;J[0]=B*W,J[1]=ue,J[2]=pe,J[3]=Me},R=new US(T),F=[];for(let B=0;B<T*T;B++){I(B%T,Math.floor(B/T),E,!1,F);let V=wh(F[0],F[1],m),W=wh(F[2],F[1],m),$=wh(F[2],F[3],m),J=wh(F[0],F[3],m);R.minimums.push(Math.min(V,W,$,J)),R.maximums.push(Math.max(V,W,$,J)),R.leaves.push(1)}for(w.push(R),T/=2;T>=1;T/=2){let B=w[w.length-1];R=new US(T);for(let V=0;V<T*T;V++){I(V%T,Math.floor(V/T),2,!0,F);let W=B.getElevation(F[0],F[1]),$=B.getElevation(F[2],F[1]),J=B.getElevation(F[2],F[3]),le=B.getElevation(F[0],F[3]),pe=B.isLeaf(F[0],F[1]),ue=B.isLeaf(F[2],F[1]),Me=B.isLeaf(F[2],F[3]),xe=B.isLeaf(F[0],F[3]),ke=Math.min(W.min,$.min,J.min,le.min),Be=Math.max(W.max,$.max,J.max,le.max),We=pe&&ue&&Me&&xe;R.maximums.push(Be),R.minimums.push(ke),R.leaves.push(Be-ke<=5&&We?1:0)}w.push(R)}return w}(this.dem),d=l.length-1,p=l[d];this._addNode(p.minimums[0],p.maximums[0],p.leaves[0]),this._construct(l,0,0,d,0)}raycastRoot(n,l,d,p,m,y,w=1){return VS([n,l,-100],[d,p,this.maximums[0]*w],m,y)}raycast(n,l,d,p,m,y,w=1){if(!this.nodeCount)return null;let T=this.raycastRoot(n,l,d,p,m,y,w);if(T==null)return null;let E=[],I=[],R=[],F=[],B=[{idx:0,t:T,nodex:0,nodey:0,depth:0}];for(;B.length>0;){let{idx:V,t:W,nodex:$,nodey:J,depth:le}=B.pop();if(this.leaves[V]){jS($,J,le,n,l,d,p,R,F);let ue=1<<le,Me=($+0)/ue,xe=($+1)/ue,ke=(J+0)/ue,Be=(J+1)/ue,We=wh(Me,ke,this.dem)*w,Ke=wh(xe,ke,this.dem)*w,qe=wh(xe,Be,this.dem)*w,dt=wh(Me,Be,this.dem)*w,Mt=GS(R[0],R[1],We,F[0],R[1],Ke,F[0],F[1],qe,m,y),rt=GS(F[0],F[1],qe,R[0],F[1],dt,R[0],R[1],We,m,y),vt=Math.min(Mt!==null?Mt:Number.MAX_VALUE,rt!==null?rt:Number.MAX_VALUE);if(vt!==Number.MAX_VALUE)return vt;{let it=i.N.scaleAndAdd([],m,y,W);if(qS(We,Ke,dt,qe,HS(it[0],R[0],F[0]),HS(it[1],R[1],F[1]))>=it[2])return W}continue}let pe=0;for(let ue=0;ue<this._siblingOffset.length;ue++){jS(($<<1)+this._siblingOffset[ue][0],(J<<1)+this._siblingOffset[ue][1],le+1,n,l,d,p,R,F),R[2]=-100,F[2]=this.maximums[this.childOffsets[V]+ue]*w;let Me=VS(R,F,m,y);if(Me!=null){let xe=Me;E[ue]=xe;let ke=!1;for(let Be=0;Be<pe&&!ke;Be++)xe>=E[I[Be]]&&(I.splice(Be,0,ue),ke=!0);ke||(I[pe]=ue),pe++}}for(let ue=0;ue<pe;ue++){let Me=I[ue];B.push({idx:this.childOffsets[V]+Me,t:E[Me],nodex:($<<1)+this._siblingOffset[Me][0],nodey:(J<<1)+this._siblingOffset[Me][1],depth:le+1})}}return null}_addNode(n,l,d){return this.minimums.push(n),this.maximums.push(l),this.leaves.push(d),this.childOffsets.push(0),this.nodeCount++}_construct(n,l,d,p,m){if(n[p].isLeaf(l,d)===1)return;this.childOffsets[m]||(this.childOffsets[m]=this.nodeCount);let y=p-1,w=n[y],T=0,E=0;for(let I=0;I<this._siblingOffset.length;I++){let R=2*l+this._siblingOffset[I][0],F=2*d+this._siblingOffset[I][1],B=w.getElevation(R,F),V=w.isLeaf(R,F),W=this._addNode(B.min,B.max,V);V&&(T|=1<<I),E||(E=W)}for(let I=0;I<this._siblingOffset.length;I++)T&1<<I||this._construct(n,2*l+this._siblingOffset[I][0],2*d+this._siblingOffset[I][1],y,E+I)}}function qS(r,n,l,d,p,m){return Tn(Tn(r,l,m),Tn(n,d,m),p)}function wh(r,n,l){let d=l.dim,p=Xe(r*d-.5,0,d-1),m=Xe(n*d-.5,0,d-1),y=Math.floor(p),w=Math.floor(m),T=Math.min(y+1,d-1),E=Math.min(w+1,d-1);return qS(l.get(y,w),l.get(T,w),l.get(y,E),l.get(T,E),p-y,m-w)}let xF={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function bF(r,n,l){return(256*r*256+256*n+l)/10-1e4}function wF(r,n,l){return 256*r+n+l/256-32768}class O4{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(n,l,d,p=!1){if(this.uid=n,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(d&&d!=="mapbox"&&d!=="terrarium")return Ui(`"${d}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=l.height;let m=this.dim=l.height-2,y=new Uint32Array(l.data.buffer);if(this.pixels=new Uint8Array(l.data.buffer),this.floatView=new Float32Array(l.data.buffer),this.borderReady=p,this._modifiedForSources={},!p){for(let T=0;T<m;T++)y[this._idx(-1,T)]=y[this._idx(0,T)],y[this._idx(m,T)]=y[this._idx(m-1,T)],y[this._idx(T,-1)]=y[this._idx(T,0)],y[this._idx(T,m)]=y[this._idx(T,m-1)];y[this._idx(-1,-1)]=y[this._idx(0,0)],y[this._idx(m,-1)]=y[this._idx(m-1,0)],y[this._idx(-1,m)]=y[this._idx(0,m-1)],y[this._idx(m,m)]=y[this._idx(m-1,m-1)]}let w=d==="terrarium"?wF:bF;for(let T=0;T<y.length;++T){let E=4*T;this.floatView[T]=w(this.pixels[E],this.pixels[E+1],this.pixels[E+2])}this._timestamp=at.now()}_buildQuadTree(){this._tree=new WS(this)}get(n,l,d=!1){d&&(n=Xe(n,-1,this.dim),l=Xe(l,-1,this.dim));let p=this._idx(n,l);return this.floatView[p]}set(n,l,d){let p=this._idx(n,l),m=this.floatView[p];return this.floatView[p]=d,d-m}static getUnpackVector(n){return xF[n]}_idx(n,l){if(n<-1||n>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(n+1)}static pack(n,l){let d=[0,0,0,0],p=O4.getUnpackVector(l),m=Math.floor((n+p[3])/p[2]);return d[2]=m%256,m=Math.floor(m/256),d[1]=m%256,m=Math.floor(m/256),d[0]=m,d}getPixels(){return new AS({width:this.stride,height:this.stride},this.pixels)}backfillBorder(n,l,d){if(this.dim!==n.dim)throw new Error("dem dimension mismatch");let p=l*this.dim,m=l*this.dim+this.dim,y=d*this.dim,w=d*this.dim+this.dim;switch(l){case-1:p=m-1;break;case 1:m=p+1}switch(d){case-1:y=w-1;break;case 1:w=y+1}let T=-l*this.dim,E=-d*this.dim;for(let I=y;I<w;I++)for(let R=p;R<m;R++){let F=4*this._idx(R,I),B=4*this._idx(R+T,I+E);this.pixels[F+0]=n.pixels[B+0],this.pixels[F+1]=n.pixels[B+1],this.pixels[F+2]=n.pixels[B+2],this.pixels[F+3]=n.pixels[B+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}hi(O4,"DEMData"),hi(WS,"DemMinMaxQuadTree",{omit:["dem"]});class jp{constructor(n,l,d){this._demTile=n,this._dem=this._demTile.dem,this._scale=l,this._offset=d}static create(n,l,d){let p=d||n.findDEMTileFor(l);if(!p||!p.dem)return;let m=p.dem,y=p.tileID,w=1<<l.canonical.z-y.canonical.z;return new jp(p,m.dim/ii/w,[(l.canonical.x/w-y.canonical.x)*m.dim,(l.canonical.y/w-y.canonical.y)*m.dim])}tileCoordToPixel(n,l){let d=l*this._scale+this._offset[1],p=Math.floor(n*this._scale+this._offset[0]),m=Math.floor(d);return new de(p,m)}getElevationAt(n,l,d,p){let m=n*this._scale+this._offset[0],y=l*this._scale+this._offset[1],w=Math.floor(m),T=Math.floor(y),E=this._dem;return p=!!p,d?Tn(Tn(E.get(w,T,p),E.get(w,T+1,p),y-T),Tn(E.get(w+1,T,p),E.get(w+1,T+1,p),y-T),m-w):E.get(w,T,p)}getElevationAtPixel(n,l,d){return this._dem.get(n,l,!!d)}getMeterToDEM(n){return(1<<this._demTile.tileID.canonical.z)*hn(1,n)*this._dem.stride}}let SF=D4.types,TF=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],MF=["fill-extrusion-flood-light-ground-radius"],EF=Math.pow(2,13),AF=Math.pow(2,15)-1,XS=new de(0,1),Sh=2147483648;function i2(r,n,l,d,p,m,y,w){r.emplaceBack((n<<1)+y,(l<<1)+m,(Math.floor(d*EF)<<1)+p,Math.round(w))}function N4(r,n,l,d,p,m){r.emplaceBack(n.x,n.y,(l.x<<1)+d,(l.y<<1)+p,m)}function n2(r,n,l){r.emplaceBack(n.x,n.y,n.z,l[0]*16384,l[1]*16384,l[2]*16384)}class ZS{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class $S{constructor(){this.centroidXY=new de(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new de(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new de(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new de(this.max.x-this.min.x,this.max.y-this.min.y)}}class YS{constructor(){this.acc=new de(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(n,l){n.min.x===Number.MAX_VALUE&&(n.min.x=n.max.x=l.x,n.min.y=n.max.y=l.y)}appendEdge(n,l,d){this.accCount++,this.acc._add(l);let p=!!this.borders;l.x<n.min.x?(n.min.x=l.x,p=!0):l.x>n.max.x&&(n.max.x=l.x,p=!0),l.y<n.min.y?(n.min.y=l.y,p=!0):l.y>n.max.y&&(n.max.y=l.y,p=!0),((l.x===0||l.x===ii)&&l.x===d.x)!=((l.y===0||l.y===ii)&&l.y===d.y)&&this.processBorderOverlap(l,d),p&&this.checkBorderIntersection(l,d)}checkBorderIntersection(n,l){l.x<0!=n.x<0&&this.addBorderIntersection(0,Tn(l.y,n.y,(0-l.x)/(n.x-l.x))),l.x>ii!=n.x>ii&&this.addBorderIntersection(1,Tn(l.y,n.y,(ii-l.x)/(n.x-l.x))),l.y<0!=n.y<0&&this.addBorderIntersection(2,Tn(l.x,n.x,(0-l.y)/(n.y-l.y))),l.y>ii!=n.y>ii&&this.addBorderIntersection(3,Tn(l.x,n.x,(ii-l.y)/(n.y-l.y)))}addBorderIntersection(n,l){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);let d=this.borders[n];l<d[0]&&(d[0]=l),l>d[1]&&(d[1]=l)}processBorderOverlap(n,l){if(n.x===l.x){if(n.y===l.y)return;let d=n.x===0?0:1;this.addBorderIntersection(d,l.y),this.addBorderIntersection(d,n.y)}else{let d=n.y===0?2:3;this.addBorderIntersection(d,l.x),this.addBorderIntersection(d,n.x)}}centroid(){return this.accCount===0?new de(0,0):new de(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((n,l)=>n+ +(l[0]!==Number.MAX_VALUE),0):0}}function JS(r,n){let l=r.add(n)._unit(),d=Xe(r.x*l.x+r.y*l.y,-1,1);var p,m,y;return p=Math.acos(d),Math.min(4,Math.max(-4,Math.tan(p)))/4*AF*((m=r).x*(y=n).y-m.y*y.x<0?-1:1)}let CF=[r=>r.x<0,r=>r.x>ii,r=>r.y<0,r=>r.y>ii];function IF(r,n,l,d){let p=[4];if(d===0)return p;l._mult(d);let m=r.sub(l),y=n.sub(l),w=[r,n,m,y];for(let T=0;T<4;T++)for(let E of w)if(CF[T](E)){p.push(T);break}return p}class KS{constructor(n){this.vertexArray=new Fm,this.indexArray=new Us,this.programConfigurations=new Q(n.layers,n.zoom,l=>MF.includes(l)),this._segments=new ls,this.hiddenByLandmarkVertexArray=new jm,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new ls}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(n,l,d,p=!1){let m=n.length;if(m>2){let y=Math.max(0,this._segments.get().length-1),w=this._segments._prepareSegment(4*m,this.vertexArray.length,2*this._segmentToGroundQuads[y].length),T;y!==this._segments.get().length-1&&(y++,this._segmentToGroundQuads[y]=[],this._segmentToRegionTriCounts[y]=[0,0,0,0,0]);{let E=n[0],I=n[1];T=JS(E.sub(n[m-1])._perp()._unit(),I.sub(E)._perp()._unit())}for(let E=0;E<m;E++){let I=E===m-1?0:E+1,R=n[E],F=n[I],B=n[I===m-1?0:I+1],V=F.sub(R)._perp()._unit(),W=JS(V,B.sub(F)._perp()._unit()),$=T,J=W;if(Av(R,F,l)||p&&tT(R,l)&&tT(F,l)){T=W;continue}let le=w.vertexLength;N4(this.vertexArray,R,F,1,1,$),N4(this.vertexArray,R,F,1,0,$),N4(this.vertexArray,R,F,0,1,J),N4(this.vertexArray,R,F,0,0,J),w.vertexLength+=4;let pe=IF(R,F,V,d);for(let ue of pe)this._segmentToGroundQuads[y].push({id:le,region:ue}),this._segmentToRegionTriCounts[y][ue]+=2,w.primitiveLength+=2;T=W}}}prepareBorderSegments(){if(!this.hasData())return;let n=this._segments.get(),l=n.length;for(let d=0;d<l;d++)this._segmentToGroundQuads[d].sort((p,m)=>p.region-m.region);for(let d=0;d<l;d++){let p=this._segmentToGroundQuads[d],m=n[d],y=this._segmentToRegionTriCounts[d];y.reduce((T,E)=>T+E,0);let w=0;for(let T=0;T<=4;T++){let E=y[T];if(E!==0){let I=this.regionSegments[T];I||(I=this.regionSegments[T]=new ls);let R={vertexOffset:m.vertexOffset,primitiveOffset:m.primitiveOffset+w,vertexLength:m.vertexLength,primitiveLength:E};I.get().push(R)}w+=E}for(let T=0;T<p.length;T++){let E=p[T].id;this.indexArray.emplaceBack(E,E+1,E+3),this.indexArray.emplaceBack(E,E+3,E+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(n,l,d,p,m,y){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,n,l,d,p,m,y)}upload(n){this.hasData()&&(this.vertexBuffer=n.createVertexBuffer(this.vertexArray,aF.members),this.indexBuffer=n.createIndexBuffer(this.indexArray))}uploadPaintProperties(n){this.hasData()&&this.programConfigurations.upload(n)}update(n,l,d,p,m,y){this.hasData()&&this.programConfigurations.updatePaintArrays(n,l,d,p,m,y)}updateHiddenByLandmark(n){if(!this.hasData())return;let l=n.groundVertexCount+n.groundVertexArrayOffset;if(n.groundVertexCount===0)return;let d=n.flags&Sh?1:0;for(let p=n.groundVertexArrayOffset;p<l;++p)this.hiddenByLandmarkVertexArray.emplace(p,d);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(n){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=n.createVertexBuffer(this.hiddenByLandmarkVertexArray,cF.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let n=0;n<=4;n++){let l=this.regionSegments[n];l&&l.destroy()}}}}class z4{constructor(n){this.zoom=n.zoom,this.canonical=n.canonical,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(l=>l.fqid),this.index=n.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=n.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Us,this.footprintVertices=new Za,this.footprintSegments=[],this.layoutVertexArray=new zl,this.centroidVertexArray=new au,this.indexArray=new Us,this.programConfigurations=new Q(n.layers,n.zoom,l=>TF.includes(l)),this.segments=new ls,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.groundEffect=new KS(n),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}populate(n,l,d,p){this.features=[],this.hasPattern=Sv("fill-extrusion",this.layers,l),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=In(d),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(let{feature:m,id:y,index:w,sourceLayerIndex:T}of n){let E=this.layers[0]._featureFilter.needGeometry,I=Rs(m,E);if(!this.layers[0]._featureFilter.filter(new Yr(this.zoom),I,d))continue;let R={id:y,sourceLayerIndex:T,index:w,geometry:E?I.geometry:Gs(m,d,p),properties:m.properties,type:m.type,patterns:{}},F=this.layoutVertexArray.length;this.hasPattern?this.features.push(Tv("fill-extrusion",this.layers,R,this.zoom,l)):this.addFeature(R,R.geometry,w,d,{},l.availableImages,p,l.brightness),l.featureIndex.insert(m,R.geometry,w,T,this.index,F)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(n,l,d,p,m,y){for(let w of this.features){let{geometry:T}=w;this.addFeature(w,T,w.index,l,d,p,m,y)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(n,l,d,p,m){let y=Object.keys(n).length!==0;if(y&&!this.stateDependentLayers.length)return;let w=y?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(n,l,w,d,p,m),this.groundEffect.update(n,l,w,d,p,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,dF),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=n.createVertexBuffer(this.layoutVertexExtArray,hF.members,!0)),this.groundEffect.upload(n)),this.groundEffect.uploadPaintProperties(n),this.programConfigurations.upload(n),this.uploaded=!0}uploadCentroid(n){this.groundEffect.uploadHiddenByLandmark(n),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=n.createVertexBuffer(this.centroidVertexArray,lF.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(n,l,d,p,m,y,w,T){let E=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(n,{})/this.tileToMeter,I=[new de(0,0),new de(ii,ii)],R=w.projection,F=R.name==="globe",B=SF[n.type]==="Polygon",V=new YS;V.centroidDataIndex=this.centroidData.length;let W=new $S,$=this.layers[0].paint.get("fill-extrusion-base").evaluate(n,{},p)<=0,J=this.layers[0].paint.get("fill-extrusion-height").evaluate(n,{},p);W.height=J,W.vertexArrayOffset=this.layoutVertexArray.length,W.groundVertexArrayOffset=this.groundEffect.vertexArray.length,F&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Dp);let le=wv(l,500);for(let Be=le.length-1;Be>=0;Be--){let We=le[Be];(We.length===0||(pe=We[0]).every(Ke=>Ke.x<=0)||pe.every(Ke=>Ke.x>=ii)||pe.every(Ke=>Ke.y<=0)||pe.every(Ke=>Ke.y>=ii))&&le.splice(Be,1)}var pe;let ue;if(F)ue=sT(le,I,p);else{ue=[];for(let Be of le)ue.push({polygon:Be,bounds:I})}let Me=B?this.edgeRadius:0,xe=Me>0&&this.zoom<17,ke=(Be,We)=>{if(Be.length===0)return!1;let Ke=Be[Be.length-1];return We.x===Ke.x&&We.y===Ke.y};for(let{polygon:Be,bounds:We}of ue){let Ke=0,qe=0;for(let vt of Be)B&&!vt[0].equals(vt[vt.length-1])&&vt.push(vt[0]),qe+=B?vt.length-1:vt.length;let dt=this.segments.prepareSegment((B?5:4)*qe,this.layoutVertexArray,this.indexArray);W.footprintSegIdx<0&&(W.footprintSegIdx=this.footprintSegments.length),W.polygonSegIdx<0&&(W.polygonSegIdx=this.polygonSegments.length);let Mt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},rt=new ZS;if(rt.vertexOffset=this.footprintVertices.length,rt.indexOffset=3*this.footprintIndices.length,rt.ringIndices=[],B){let vt=[],it=[];Ke=dt.vertexLength;for(let Xt=0;Xt<Be.length;Xt++){let At=Be[Xt];At.length&&Xt!==0&&it.push(vt.length/2);let fi=[],oi,Lt;oi=At[1].sub(At[0])._perp()._unit(),rt.ringIndices.push(At.length-1);for(let Ni=1;Ni<At.length;Ni++){let wi=At[Ni],pi=At[Ni===At.length-1?1:Ni+1],Ft=wi.clone();if(Me){Lt=pi.sub(wi)._perp()._unit();let Ci=oi.add(Lt)._unit(),xn=Me*Math.min(4,1/(oi.x*Ci.x+oi.y*Ci.y));Ft.x+=xn*Ci.x,Ft.y+=xn*Ci.y,Ft.x=Math.round(Ft.x),Ft.y=Math.round(Ft.y),oi=Lt}!$||Me!==0&&!xe||ke(fi,Ft)||fi.push(Ft),i2(this.layoutVertexArray,Ft.x,Ft.y,0,0,1,1,0),dt.vertexLength++,this.footprintVertices.emplaceBack(wi.x,wi.y),vt.push(wi.x,wi.y),F&&n2(this.layoutVertexExtArray,R.projectTilePoint(Ft.x,Ft.y,p),R.upVector(p,Ft.x,Ft.y))}$&&(Me===0||xe)&&(fi.length!==0&&ke(fi,fi[0])&&fi.pop(),this.groundEffect.addData(fi,We,E))}let yt=R4(vt,it);for(let Xt=0;Xt<yt.length;Xt+=3)this.footprintIndices.emplaceBack(rt.vertexOffset+yt[Xt+0],rt.vertexOffset+yt[Xt+1],rt.vertexOffset+yt[Xt+2]),this.indexArray.emplaceBack(Ke+yt[Xt],Ke+yt[Xt+2],Ke+yt[Xt+1]),dt.primitiveLength++;rt.indexCount+=yt.length,rt.vertexCount+=this.footprintVertices.length-rt.vertexOffset}for(let vt=0;vt<Be.length;vt++){let it=Be[vt];V.startRing(W,it[0]);let yt=it.length>4&&iT(it[it.length-2],it[0],it[1]),Xt=Me?PF(it[it.length-2],it[0],it[1],Me):0,At=[],fi,oi,Lt;oi=it[1].sub(it[0])._perp()._unit();let Ni=!0;for(let wi=1,pi=0;wi<it.length;wi++){let Ft=it[wi-1],Ci=it[wi],xn=it[wi===it.length-1?1:wi+1];if(V.appendEdge(W,Ci,Ft),Av(Ci,Ft,We)){Me&&(oi=xn.sub(Ci)._perp()._unit(),Ni=!Ni);continue}let Hi=Ci.sub(Ft)._perp(),bn=Hi.x/(Math.abs(Hi.x)+Math.abs(Hi.y)),nn=Hi.y>0?1:0,Vn=Ft.dist(Ci);if(pi+Vn>32768&&(pi=0),Me){Lt=xn.sub(Ci)._perp()._unit();let rr=eT(Ft,Ci,xn,QS(oi,Lt),Me);isNaN(rr)&&(rr=0);let ur=Ci.sub(Ft)._unit();Ft=Ft.add(ur.mult(Xt))._round(),Ci=Ci.add(ur.mult(-rr))._round(),Xt=rr,oi=Lt,$&&this.zoom>=17&&(ke(At,Ft)||At.push(Ft),ke(At,Ci)||At.push(Ci))}let dn=dt.vertexLength,Cr=it.length>4&&iT(Ft,Ci,xn),tr=nT(pi,yt,Ni);if(i2(this.layoutVertexArray,Ft.x,Ft.y,bn,nn,0,0,tr),i2(this.layoutVertexArray,Ft.x,Ft.y,bn,nn,0,1,tr),pi+=Vn,tr=nT(pi,Cr,!Ni),yt=Cr,i2(this.layoutVertexArray,Ci.x,Ci.y,bn,nn,0,0,tr),i2(this.layoutVertexArray,Ci.x,Ci.y,bn,nn,0,1,tr),dt.vertexLength+=4,this.indexArray.emplaceBack(dn+0,dn+1,dn+2),this.indexArray.emplaceBack(dn+1,dn+3,dn+2),dt.primitiveLength+=2,Me){let rr=Ke+(wi===1?it.length-2:wi-2),ur=wi===1?Ke:rr+1;if(this.indexArray.emplaceBack(dn+1,rr,dn+3),this.indexArray.emplaceBack(rr,ur,dn+3),dt.primitiveLength+=2,fi===void 0&&(fi=dn),!Av(xn,it[wi],We)){let ir=wi===it.length-1?fi:dt.vertexLength;this.indexArray.emplaceBack(dn+2,dn+3,ir),this.indexArray.emplaceBack(dn+3,ir+1,ir),this.indexArray.emplaceBack(dn+3,ur,ir+1),dt.primitiveLength+=3}Ni=!Ni}if(F){let rr=this.layoutVertexExtArray,ur=R.projectTilePoint(Ft.x,Ft.y,p),ir=R.projectTilePoint(Ci.x,Ci.y,p),Zr=R.upVector(p,Ft.x,Ft.y),wr=R.upVector(p,Ci.x,Ci.y);n2(rr,ur,Zr),n2(rr,ur,Zr),n2(rr,ir,wr),n2(rr,ir,wr)}}B&&(Ke+=it.length-1),$&&Me&&this.zoom>=17&&(At.length!==0&&ke(At,At[0])&&At.pop(),this.groundEffect.addData(At,We,E,Me>0))}this.footprintSegments.push(rt),Mt.triangleCount=this.indexArray.length-Mt.triangleArrayOffset,this.polygonSegments.push(Mt),++W.footprintSegLen,++W.polygonSegLen}if(W.vertexCount=this.layoutVertexArray.length-W.vertexArrayOffset,W.groundVertexCount=this.groundEffect.vertexArray.length-W.groundVertexArrayOffset,W.vertexCount!==0){if(W.centroidXY=V.borders?XS:this.encodeCentroid(V,W),this.centroidData.push(W),V.borders){this.featuresOnBorder.push(V);let Be=this.featuresOnBorder.length-1;for(let We=0;We<V.borders.length;We++)V.borders[We][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[We].push(Be)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,d,m,y,p,T),this.groundEffect.addPaintPropertiesData(n,d,m,y,p,T),this.maxHeight=Math.max(this.maxHeight,J)}}sortBorders(){for(let n=0;n<this.borderFeatureIndices.length;n++)this.borderFeatureIndices[n].sort((l,d)=>this.featuresOnBorder[l].borders[n][0]-this.featuresOnBorder[d].borders[n][0])}splitToSubtiles(){let n=[];for(let w=0;w<this.centroidData.length;w++){let T=this.centroidData[w],E=+(T.min.y+T.max.y>ii),I=2*E+(+(T.min.x+T.max.x>ii)^E);for(let R=0;R<T.polygonSegLen;R++){let F=T.polygonSegIdx+R;n.push({centroidIdx:w,subtile:I,polygonSegmentIdx:F,triangleSegmentIdx:this.polygonSegments[F].triangleSegIdx})}}let l=new Us;n.sort((w,T)=>w.triangleSegmentIdx===T.triangleSegmentIdx?w.subtile-T.subtile:w.triangleSegmentIdx-T.triangleSegmentIdx);let d=0,p=0,m=0;for(let w of n){if(w.triangleSegmentIdx!==d)break;m++}let y=n.length;for(;p!==n.length;){d=n[p].triangleSegmentIdx;let w=0,T=p,E=p;for(let I=T;I<m&&n[I].subtile===w;I++)E++;for(;T!==m;){let I=n[T];w=I.subtile;let R=this.centroidData[I.centroidIdx].min.clone(),F=this.centroidData[I.centroidIdx].max.clone(),B={vertexOffset:this.segments.segments[d].vertexOffset,primitiveOffset:l.length,vertexLength:this.segments.segments[d].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let V=T;V<E;V++){let W=n[V],$=this.polygonSegments[W.polygonSegmentIdx],J=this.centroidData[W.centroidIdx].min,le=this.centroidData[W.centroidIdx].max,pe=this.indexArray.uint16;for(let ue=$.triangleArrayOffset;ue<$.triangleArrayOffset+$.triangleCount;ue++)l.emplaceBack(pe[3*ue],pe[3*ue+1],pe[3*ue+2]);B.primitiveLength+=$.triangleCount,R.x=Math.min(R.x,J.x),R.y=Math.min(R.y,J.y),F.x=Math.max(F.x,le.x),F.y=Math.max(F.y,le.y)}B.primitiveLength>0&&this.triangleSubSegments.push({segment:B,min:R,max:F}),T=E;for(let V=T;V<m&&n[V].subtile===n[T].subtile;V++)E++}p=m;for(let I=p;I<y&&n[I].triangleSegmentIdx===n[p].triangleSegmentIdx;I++)m++}l._trim(),this.indexArray=l}getVisibleSegments(n,l,d){let p=0,m=0,y=1<<n.canonical.z;if(l){let W=l.getMinMaxForTile(n);W&&(p=W.min,m=W.max)}m+=this.maxHeight;let w=n.toUnwrapped(),T,E=[w.canonical.x/y+w.wrap,w.canonical.y/y],I=[(w.canonical.x+1)/y+w.wrap,(w.canonical.y+1)/y],R=new ls,F=(W,$,J)=>[W[0]*(1-J[0])+$[0]*J[0],W[1]*(1-J[1])+$[1]*J[1]],B=[],V=[];for(let W of this.triangleSubSegments){B[0]=W.min.x/ii,B[1]=W.min.y/ii,V[0]=W.max.x/ii,V[1]=W.max.y/ii;let $=F(E,I,B),J=F(E,I,V);if(new os([$[0],$[1],p],[J[0],J[1],m]).intersectsPrecise(d)===0){T&&(R.segments.push(T),T=void 0);continue}let le=W.segment;T&&T.vertexOffset!==le.vertexOffset&&(R.segments.push(T),T=void 0),T?(T.vertexLength+=le.vertexLength,T.primitiveLength+=le.primitiveLength):T={vertexOffset:le.vertexOffset,primitiveLength:le.primitiveLength,vertexLength:le.vertexLength,primitiveOffset:le.primitiveOffset,sortKey:void 0,vaos:{}}}return T&&R.segments.push(T),R}encodeCentroid(n,l){let d=n.centroid(),p=l.span(),m=Math.min(7,Math.round(p.x*this.tileToMeter/10)),y=Math.min(7,Math.round(p.y*this.tileToMeter/10));return new de(Xe(d.x,1,ii-1)<<3|m,Xe(d.y,1,ii-1)<<3|y)}encodeBorderCentroid(n){if(!n.borders)return new de(0,0);let l=n.borders,d=Number.MAX_VALUE;if(l[0][0]!==d||l[1][0]!==d){let p=l[0][0]!==d?0:1;return new de(6|(l[0][0]!==d?0:65528),(l[p][0]+l[p][1])/2<<3|6)}{let p=l[2][0]!==d?2:3;return new de((l[p][0]+l[p][1])/2<<3|6,6|(l[2][0]!==d?0:65528))}}showCentroid(n){let l=this.centroidData[n.centroidDataIndex];l.flags&=Sh,l.centroidXY.x=0,l.centroidXY.y=0,this.writeCentroidToBuffer(l)}writeCentroidToBuffer(n){this.groundEffect.updateHiddenByLandmark(n);let l=n.vertexArrayOffset,d=n.vertexCount+n.vertexArrayOffset,p=n.flags&Sh?XS:n.centroidXY,m=this.centroidVertexArray.geta_centroid_pos0(l);if(this.centroidVertexArray.geta_centroid_pos1(l)!==p.y||m!==p.x){for(let y=l;y<d;++y)this.centroidVertexArray.emplace(y,p.x,p.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(let n of this.centroidData)this.writeCentroidToBuffer(n)}updateReplacement(n,l){if(l.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=l.updateTime;let d=l.getReplacementRegionsForTile(n.toUnwrapped());if(function(m,y){if(m.length!==y.length)return!1;for(let w=0;w<m.length;w++)if(m[w].sourceId!==y[w].sourceId||!FS(m[w],y[w]))return!1;return!0}(this.activeReplacements,d))return;if(this.activeReplacements=d,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(let m of this.centroidData)m.flags&=2147483647;let p=[];for(let m of this.activeReplacements){let y=Math.pow(2,m.footprintTileId.canonical.z-n.canonical.z);for(let w of this.centroidData)if(!(w.flags&Sh||m.min.x>w.max.x||w.min.x>m.max.x||m.min.y>w.max.y||w.min.y>m.max.y))for(let T=0;T<w.footprintSegLen;T++){let E=this.footprintSegments[w.footprintSegIdx+T];if(p.length=0,RF(this.footprintVertices,E.vertexOffset,E.vertexCount,m.footprintTileId.canonical,n.canonical,p),zS(m.footprint,p,this.footprintIndices.uint16,E.indexOffset,E.indexCount,-E.vertexOffset,-y)){w.flags|=Sh;break}}}for(let m of this.centroidData)this.writeCentroidToBuffer(m);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(n,l,d){let p=!1;for(let m=0;m<d.footprintSegLen;m++){let y=this.footprintSegments[d.footprintSegIdx+m],w=0;for(let T of y.ringIndices){for(let E=w,I=T+w-1;E<T+w;I=E++){let R=this.footprintVertices.int16[2*(E+y.vertexOffset)+0],F=this.footprintVertices.int16[2*(E+y.vertexOffset)+1],B=this.footprintVertices.int16[2*(I+y.vertexOffset)+1];F>l!=B>l&&n<(this.footprintVertices.int16[2*(I+y.vertexOffset)+0]-R)*(l-F)/(B-F)+R&&(p=!p)}w=T}}return p}getHeightAtTileCoord(n,l){let d=Number.NEGATIVE_INFINITY,p=!0,m=4*(n+ii)*ii+(l+ii);if(this.partLookup.hasOwnProperty(m)){let y=this.partLookup[m];return y?{height:y.height,hidden:!!(y.flags&Sh)}:void 0}for(let y of this.centroidData)n>y.max.x||y.min.x>n||l>y.max.y||y.min.y>l||this.footprintContainsPoint(n,l,y)&&y&&y.height>d&&(d=y.height,this.partLookup[m]=y,p=!!(y.flags&Sh));if(d!==Number.NEGATIVE_INFINITY)return{height:d,hidden:p};this.partLookup[m]=void 0}}function QS(r,n){let l=r.add(n)._unit();return r.x*l.x+r.y*l.y}function PF(r,n,l,d){let p=n.sub(r)._perp()._unit(),m=l.sub(n)._perp()._unit();return eT(r,n,l,QS(p,m),d)}function eT(r,n,l,d,p){let m=Math.sqrt(1-d*d);return Math.min(r.dist(n)/3,n.dist(l)/3,p*m/d)}function Av(r,n,l){return r.x<l[0].x&&n.x<l[0].x||r.x>l[1].x&&n.x>l[1].x||r.y<l[0].y&&n.y<l[0].y||r.y>l[1].y&&n.y>l[1].y}function tT(r,n){return r.x<n[0].x||r.x>n[1].x||r.y<n[0].y||r.y>n[1].y}function iT(r,n,l){if(r.x<0||r.x>=ii||n.x<0||n.x>=ii||l.x<0||l.x>=ii)return!1;let d=l.sub(n),p=d.perp(),m=r.sub(n);return(d.x*m.x+d.y*m.y)/Math.sqrt((d.x*d.x+d.y*d.y)*(m.x*m.x+m.y*m.y))>-.866&&p.x*m.x+p.y*m.y<0}function nT(r,n,l){let d=n?2|r:-3&r;return l?1|d:-2&d}function rT(){let r=Math.PI/32,n=Math.tan(r),l=nt;return l*Math.sqrt(1+2*n*n)-l}function sT(r,n,l){let d=1<<l.z,p=an(l.x/d),m=an((l.x+1)/d),y=Wn(l.y/d),w=Wn((l.y+1)/d);return function(T,E,I,R,F=0,B){let V=[];if(!T.length||!I||!R)return V;let W=(xe,ke)=>{for(let Be of xe)V.push({polygon:Be,bounds:ke})},$=Math.ceil(Math.log2(I)),J=Math.ceil(Math.log2(R)),le=$-J,pe=[];for(let xe=0;xe<Math.abs(le);xe++)pe.push(le>0?0:1);for(let xe=0;xe<Math.min($,J);xe++)pe.push(0),pe.push(1);let ue=T;if(ue=L4(ue,E[0].y-F,E[1].y+F,1),ue=L4(ue,E[0].x-F,E[1].x+F,0),!ue.length)return V;let Me=[];for(pe.length?Me.push({polygons:ue,bounds:E,depth:0}):W(ue,E);Me.length;){let xe=Me.pop(),ke=xe.depth,Be=pe[ke],We=xe.bounds[0],Ke=xe.bounds[1],qe=Be===0?We.x:We.y,dt=Be===0?Ke.x:Ke.y,Mt=B?B(Be,qe,dt):.5*(qe+dt),rt=L4(xe.polygons,qe-F,Mt+F,Be),vt=L4(xe.polygons,Mt-F,dt+F,Be);if(rt.length){let it=[We,new de(Be===0?Mt:Ke.x,Be===1?Mt:Ke.y)];pe.length>ke+1?Me.push({polygons:rt,bounds:it,depth:ke+1}):W(rt,it)}if(vt.length){let it=[new de(Be===0?Mt:We.x,Be===1?Mt:We.y),Ke];pe.length>ke+1?Me.push({polygons:vt,bounds:it,depth:ke+1}):W(vt,it)}}return V}(r,n,Math.ceil((m-p)/11.25),Math.ceil((y-w)/11.25),1,(T,E,I)=>{if(T===0)return .5*(E+I);{let R=Wn((l.y+E/ii)/d);return(Zi(.5*(Wn((l.y+I/ii)/d)+R))*d-l.y)*ii}})}function RF(r,n,l,d,p,m){let y=Math.pow(2,d.z-p.z);for(let w=0;w<l;w++){let T=r.int16[2*(w+n)+0],E=r.int16[2*(w+n)+1];T=(T+p.x*ii)*y-d.x*ii,E=(E+p.y*ii)*y-d.y*ii,m.push(new de(T,E))}}hi(z4,"FillExtrusionBucket",{omit:["layers","features"]}),hi($S,"PartData"),hi(ZS,"FootprintSegment"),hi(YS,"BorderCentroidData"),hi(KS,"GroundEffect");let kF=new Jr({visibility:new qt($e["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new qt($e["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var DF={paint:new Jr({"fill-extrusion-opacity":new qt($e["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ai($e["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new qt($e["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new qt($e["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ai($e["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ai($e["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ai($e["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new qt($e["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new qt($e["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new qt($e["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new qt($e["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new qt($e["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new qt($e["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new qt($e["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new qt($e["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Ai($e["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Ai($e["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new qt($e["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new qt($e["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new qt($e["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new qt($e["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new qt($e["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:kF};class Wp extends de{constructor(n,l,d){super(n,l),this.z=d}}function r2(r,n){return r.x*n.x+r.y*n.y}function oT(r,n){if(r.length===1){let l=0,d=n[l++],p;for(;!p||d.equals(p);)if(p=n[l++],!p)return 1/0;for(;l<n.length;l++){let m=n[l],y=r[0],w=p.sub(d),T=m.sub(d),E=y.sub(d),I=r2(w,w),R=r2(w,T),F=r2(T,T),B=r2(E,w),V=r2(E,T),W=I*F-R*R,$=(F*B-R*V)/W,J=(I*V-R*B)/W,le=d.z*(1-$-J)+p.z*$+m.z*J;if(isFinite(le))return le}return 1/0}{let l=1/0;for(let d of n)l=Math.min(l,d.z);return l}}function aT(r,n,l,d,p,m,y,w){let T=y*p.getElevationAt(r,n,!0,!0),E=m[0]!==0,I=E?m[1]===0?y*(m[0]/7-450):y*function(R,F,B){let V=Math.floor(F[0]/8),W=Math.floor(F[1]/8),$=10*(F[0]-8*V),J=10*(F[1]-8*W),le=R.getElevationAt(V,W,!0,!0),pe=R.getMeterToDEM(B),ue=Math.floor(.5*($*pe-1)),Me=Math.floor(.5*(J*pe-1)),xe=R.tileCoordToPixel(V,W),ke=2*ue+1,Be=2*Me+1,We=function(vt,it,yt,Xt,At){return[vt.getElevationAtPixel(it,yt,!0),vt.getElevationAtPixel(it+At,yt,!0),vt.getElevationAtPixel(it,yt+At,!0),vt.getElevationAtPixel(it+Xt,yt+At,!0)]}(R,xe.x-ue,xe.y-Me,ke,Be),Ke=Math.abs(We[0]-We[1]),qe=Math.abs(We[2]-We[3]),dt=Math.abs(We[0]-We[2])+Math.abs(We[1]-We[3]),Mt=Math.min(.25,.5*pe*(Ke+qe)/ke),rt=Math.min(.25,.5*pe*dt/Be);return le+Math.max(Mt*$,rt*J)}(p,m,w):T;return{base:T+(l===0)?-1:l,top:E?Math.max(I+d,T+l+2):T+d}}let LF=gr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:FF}=LF,OF=gr([{name:"a_packed",components:4,type:"Float32"}]),{members:NF}=OF;class lT{constructor(n,l){this.width=n,this.height=l,this.nextRow=0,this.image=new bh({width:n,height:l}),this.positions={},this.uploaded=!1}getDash(n,l){let d=this.getKey(n,l);return this.positions[d]}trim(){let n=this.width,l=this.height=Wi(this.nextRow);this.image.resize({width:n,height:l})}getKey(n,l){return n.join(",")+l}getDashRanges(n,l,d){let p=[],m=n.length%2==1?-n[n.length-1]*d:0,y=n[0]*d,w=!0;p.push({left:m,right:y,isDash:w,zeroLength:n[0]===0});let T=n[0];for(let E=1;E<n.length;E++){w=!w;let I=n[E];m=T*d,T+=I,y=T*d,p.push({left:m,right:y,isDash:w,zeroLength:I===0})}return p}addRoundDash(n,l,d){let p=l/2;for(let m=-d;m<=d;m++){let y=this.width*(this.nextRow+d+m),w=0,T=n[w];for(let E=0;E<this.width;E++){E/T.right>1&&(T=n[++w]);let I=Math.abs(E-T.left),R=Math.abs(E-T.right),F=Math.min(I,R),B,V=m/d*(p+1);if(T.isDash){let W=p-Math.abs(V);B=Math.sqrt(F*F+W*W)}else B=p-Math.sqrt(F*F+V*V);this.image.data[y+E]=Math.max(0,Math.min(255,B+128))}}}addRegularDash(n,l){for(let T=n.length-1;T>=0;--T){let E=n[T],I=n[T+1];E.zeroLength?n.splice(T,1):I&&I.isDash===E.isDash&&(I.left=E.left,n.splice(T,1))}let d=n[0],p=n[n.length-1];d.isDash===p.isDash&&(d.left=p.left-this.width,p.right=d.right+this.width);let m=this.width*this.nextRow,y=0,w=n[y];for(let T=0;T<this.width;T++){T/w.right>1&&(w=n[++y]);let E=Math.abs(T-w.left),I=Math.abs(T-w.right),R=Math.min(E,I);this.image.data[m+T]=Math.max(0,Math.min(255,(w.isDash?R:-R)+l+128))}}addDash(n,l){let d=this.getKey(n,l);if(this.positions[d])return this.positions[d];let p=l==="round",m=p?7:0,y=2*m+1;if(this.nextRow+y>this.height)return Ui("LineAtlas out of space"),null;n.length===0&&n.push(1);let w=0;for(let I=0;I<n.length;I++)n[I]<0&&(Ui("Negative value is found in line dasharray, replacing values with 0"),n[I]=0),w+=n[I];if(w!==0){let I=this.width/w,R=this.getDashRanges(n,this.width,I);p?this.addRoundDash(R,I,m):this.addRegularDash(R,l==="square"?.5*I:0)}let T=this.nextRow+m;this.nextRow+=y;let E={tl:[T,m],br:[w,0]};return this.positions[d]=E,E}}hi(lT,"LineAtlas");let zF=D4.types,BF=Math.cos(Math.PI/180*37.5);class Cv{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(l=>l.fqid),this.index=n.index,this.projection=n.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new Om,this.layoutVertexArray2=new Pc,this.indexArray=new Us,this.programConfigurations=new Q(n.layers,n.zoom),this.segments=new ls,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(n,l,d,p){this.hasPattern=Sv("line",this.layers,l);let m=this.layers[0].layout.get("line-sort-key"),y=[];for(let{feature:I,id:R,index:F,sourceLayerIndex:B}of n){let V=this.layers[0]._featureFilter.needGeometry,W=Rs(I,V);if(!this.layers[0]._featureFilter.filter(new Yr(this.zoom),W,d))continue;let $=m?m.evaluate(W,{},d):void 0,J={id:R,properties:I.properties,type:I.type,sourceLayerIndex:B,index:F,geometry:V?W.geometry:Gs(I,d,p),patterns:{},sortKey:$};y.push(J)}m&&y.sort((I,R)=>I.sortKey-R.sortKey);let{lineAtlas:w,featureIndex:T}=l,E=this.addConstantDashes(w);for(let I of y){let{geometry:R,index:F,sourceLayerIndex:B}=I;if(E&&this.addFeatureDashes(I,w),this.hasPattern){let V=Tv("line",this.layers,I,this.zoom,l);this.patternFeatures.push(V)}else this.addFeature(I,R,F,d,w.positions,l.availableImages,l.brightness);T.insert(n[F].feature,R,F,B,this.index)}}addConstantDashes(n){let l=!1;for(let d of this.layers){let p=d.paint.get("line-dasharray").value,m=d.layout.get("line-cap").value;if(p.kind!=="constant"||m.kind!=="constant")l=!0;else{let y=m.value,w=p.value;if(!w)continue;n.addDash(w,y)}}return l}addFeatureDashes(n,l){let d=this.zoom;for(let p of this.layers){let m=p.paint.get("line-dasharray").value,y=p.layout.get("line-cap").value;if(m.kind==="constant"&&y.kind==="constant")continue;let w,T;if(m.kind==="constant"){if(w=m.value,!w)continue}else w=m.evaluate({zoom:d},n);T=y.kind==="constant"?y.value:y.evaluate({zoom:d},n),l.addDash(w,T),n.patterns[p.id]=l.getKey(w,T)}}update(n,l,d,p,m){let y=Object.keys(n).length!==0;y&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(n,l,y?this.stateDependentLayers:this.layers,d,p,m)}addFeatures(n,l,d,p,m,y){for(let w of this.patternFeatures)this.addFeature(w,w.geometry,w.index,l,d,p,y)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=n.createVertexBuffer(this.layoutVertexArray2,NF)),this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,FF),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(n){if(n.properties&&n.properties.hasOwnProperty("mapbox_clip_start")&&n.properties.hasOwnProperty("mapbox_clip_end"))return{start:+n.properties.mapbox_clip_start,end:+n.properties.mapbox_clip_end}}addFeature(n,l,d,p,m,y,w){let T=this.layers[0].layout,E=T.get("line-join").evaluate(n,{}),I=T.get("line-cap").evaluate(n,{}),R=T.get("line-miter-limit"),F=T.get("line-round-limit");this.lineClips=this.lineFeatureClips(n);for(let B of l)this.addLine(B,n,E,I,R,F);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,d,m,y,p,w)}addLine(n,l,d,p,m,y){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let J=0;J<n.length-1;J++)this.totalDistance+=n[J].dist(n[J+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let w=zF[l.type]==="Polygon",T=n.length;for(;T>=2&&n[T-1].equals(n[T-2]);)T--;let E=0;for(;E<T-1&&n[E].equals(n[E+1]);)E++;if(T<(w?3:2))return;d==="bevel"&&(m=1.05);let I=this.overscaling<=16?15*ii/(512*this.overscaling):0,R=this.segments.prepareSegment(10*T,this.layoutVertexArray,this.indexArray),F,B,V,W,$;this.e1=this.e2=-1,w&&(F=n[T-2],$=n[E].sub(F)._unit()._perp());for(let J=E;J<T;J++){if(V=J===T-1?w?n[E+1]:void 0:n[J+1],V&&n[J].equals(V))continue;$&&(W=$),F&&(B=F),F=n[J],$=V?V.sub(F)._unit()._perp():W,W=W||$;let le=W.add($);le.x===0&&le.y===0||le._unit();let pe=W.x*$.x+W.y*$.y,ue=le.x*$.x+le.y*$.y,Me=ue!==0?1/ue:1/0,xe=2*Math.sqrt(2-2*ue),ke=ue<BF&&B&&V,Be=W.x*$.y-W.y*$.x>0;if(ke&&J>E){let qe=F.dist(B);if(qe>2*I){let dt=F.sub(F.sub(B)._mult(I/qe)._round());this.updateDistance(B,dt),this.addCurrentVertex(dt,W,0,0,R),B=dt}}let We=B&&V,Ke=We?d:w?"butt":p;if(We&&Ke==="round"&&(Me<y?Ke="miter":Me<=2&&(Ke="fakeround")),Ke==="miter"&&Me>m&&(Ke="bevel"),Ke==="bevel"&&(Me>2&&(Ke="flipbevel"),Me<m&&(Ke="miter")),B&&this.updateDistance(B,F),Ke==="miter")le._mult(Me),this.addCurrentVertex(F,le,0,0,R);else if(Ke==="flipbevel"){if(Me>100)le=$.mult(-1);else{let qe=Me*W.add($).mag()/W.sub($).mag();le._perp()._mult(qe*(Be?-1:1))}this.addCurrentVertex(F,le,0,0,R),this.addCurrentVertex(F,le.mult(-1),0,0,R)}else if(Ke==="bevel"||Ke==="fakeround"){let qe=-Math.sqrt(Me*Me-1),dt=Be?qe:0,Mt=Be?0:qe;if(B&&this.addCurrentVertex(F,W,dt,Mt,R),Ke==="fakeround"){let rt=Math.round(180*xe/Math.PI/20);for(let vt=1;vt<rt;vt++){let it=vt/rt;if(it!==.5){let Xt=it-.5;it+=it*Xt*(it-1)*((1.0904+pe*(pe*(3.55645-1.43519*pe)-3.2452))*Xt*Xt+(.848013+pe*(.215638*pe-1.06021)))}let yt=$.sub(W)._mult(it)._add(W)._unit()._mult(Be?-1:1);this.addHalfVertex(F,yt.x,yt.y,!1,Be,0,R)}}V&&this.addCurrentVertex(F,$,-dt,-Mt,R)}else if(Ke==="butt")this.addCurrentVertex(F,le,0,0,R);else if(Ke==="square"){let qe=B?1:-1;B||this.addCurrentVertex(F,le,qe,qe,R),this.addCurrentVertex(F,le,0,0,R),B&&this.addCurrentVertex(F,le,qe,qe,R)}else Ke==="round"&&(B&&(this.addCurrentVertex(F,W,0,0,R),this.addCurrentVertex(F,W,1,1,R,!0)),V&&(this.addCurrentVertex(F,$,-1,-1,R,!0),this.addCurrentVertex(F,$,0,0,R)));if(ke&&J<T-1){let qe=F.dist(V);if(qe>2*I){let dt=F.add(V.sub(F)._mult(I/qe)._round());this.updateDistance(F,dt),this.addCurrentVertex(dt,$,0,0,R),F=dt}}}}addCurrentVertex(n,l,d,p,m,y=!1){let w=l.y*p-l.x,T=-l.y-l.x*p;this.addHalfVertex(n,l.x+l.y*d,l.y-l.x*d,y,!1,d,m),this.addHalfVertex(n,w,T,y,!0,-p,m)}addHalfVertex({x:n,y:l},d,p,m,y,w,T){this.layoutVertexArray.emplaceBack((n<<1)+(m?1:0),(l<<1)+(y?1:0),Math.round(63*d)+128,Math.round(63*p)+128,1+(w===0?0:w<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);let E=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,E),T.primitiveLength++),y?this.e2=E:this.e1=E}updateScaledDistance(){if(this.lineClips){let n=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=n*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(n,l){this.distance+=n.dist(l),this.updateScaledDistance()}}hi(Cv,"LineBucket",{omit:["layers","patternFeatures"]});let UF=new Jr({"line-cap":new Ai($e.layout_line["line-cap"]),"line-join":new Ai($e.layout_line["line-join"]),"line-miter-limit":new qt($e.layout_line["line-miter-limit"]),"line-round-limit":new qt($e.layout_line["line-round-limit"]),"line-sort-key":new Ai($e.layout_line["line-sort-key"]),visibility:new qt($e.layout_line.visibility)});var cT={paint:new Jr({"line-opacity":new Ai($e.paint_line["line-opacity"]),"line-color":new Ai($e.paint_line["line-color"]),"line-translate":new qt($e.paint_line["line-translate"]),"line-translate-anchor":new qt($e.paint_line["line-translate-anchor"]),"line-width":new Ai($e.paint_line["line-width"]),"line-gap-width":new Ai($e.paint_line["line-gap-width"]),"line-offset":new Ai($e.paint_line["line-offset"]),"line-blur":new Ai($e.paint_line["line-blur"]),"line-dasharray":new Ai($e.paint_line["line-dasharray"]),"line-pattern":new Ai($e.paint_line["line-pattern"]),"line-gradient":new _0($e.paint_line["line-gradient"]),"line-trim-offset":new qt($e.paint_line["line-trim-offset"]),"line-emissive-strength":new qt($e.paint_line["line-emissive-strength"]),"line-border-width":new Ai($e.paint_line["line-border-width"]),"line-border-color":new Ai($e.paint_line["line-border-color"])}),layout:UF};function hT(r,n,l){return n*(ii/(r.tileSize*Math.pow(2,l-r.tileID.overscaledZ)))}function dT(r,n){return 1/hT(r,1,n.tileZoom)}function uT(r,n,l,d){return r.translatePosMatrix(d||n.tileID.projMatrix,n,l.paint.get("line-translate"),l.paint.get("line-translate-anchor"))}let pT=r=>{let n=[];fT(r)&&n.push("RENDER_LINE_DASH"),r.paint.get("line-gradient")&&n.push("RENDER_LINE_GRADIENT");let l=r.paint.get("line-trim-offset");return l[0]===0&&l[1]===0||n.push("RENDER_LINE_TRIM_OFFSET"),r.paint.get("line-border-width").constantOr(1)!==0&&n.push("RENDER_LINE_BORDER"),n};function fT(r){let n=r.paint.get("line-dasharray").value;return n.value||n.kind!=="constant"}let mT=new class extends Ai{possiblyEvaluate(r,n){return n=new Yr(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,transition:n.transition}),super.possiblyEvaluate(r,n)}evaluate(r,n,l,d){return n=Tt({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(r,n,l,d)}}(cT.paint.properties["line-width"].specification);function gT(r,n){return n>0?n+2*r:r}mT.useIntegerZoom=!0;let VF=gr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),GF=gr([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),HF=gr([{name:"a_projected_pos",components:4,type:"Float32"}],4);gr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let jF=gr([{name:"a_z_offset",components:1,type:"Float32"}],4),WF=gr([{name:"a_texb",components:2,type:"Uint16"}]),qF=gr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),XF=gr([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);gr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let _T=gr([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),ZF=gr([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);gr([{name:"triangle",components:3,type:"Uint16"}]),gr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),gr([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),gr([{type:"Float32",name:"offsetX"}]),gr([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var mo=24;let Hl=128;function Iv(r,n){let{expression:l}=n;if(l.kind==="constant")return{kind:"constant",layoutSize:l.evaluate(new Yr(r+1))};if(l.kind==="source")return{kind:"source"};{let{zoomStops:d,interpolationType:p}=l,m=0;for(;m<d.length&&d[m]<=r;)m++;m=Math.max(0,m-1);let y=m;for(;y<d.length&&d[y]<r+1;)y++;y=Math.min(d.length-1,y);let w=d[m],T=d[y];return l.kind==="composite"?{kind:"composite",minZoom:w,maxZoom:T,interpolationType:p}:{kind:"camera",minZoom:w,maxZoom:T,minSize:l.evaluate(new Yr(w)),maxSize:l.evaluate(new Yr(T)),interpolationType:p}}}function B4(r,{uSize:n,uSizeT:l},{lowerSize:d,upperSize:p}){return r.kind==="source"?d/Hl:r.kind==="composite"?Tn(d/Hl,p/Hl,l):n}function qp(r,n){let l=0,d=0;if(r.kind==="constant")d=r.layoutSize;else if(r.kind!=="source"){let{interpolationType:p,minZoom:m,maxZoom:y}=r,w=p?Xe(ra.interpolationFactor(p,n,m,y),0,1):0;r.kind==="camera"?d=Tn(r.minSize,r.maxSize,w):l=w}return{uSizeT:l,uSize:d}}var $F=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Hl,evaluateSizeForFeature:B4,evaluateSizeForZoom:qp,getSizeData:Iv});function YF(r,n,l){return r.sections.forEach(d=>{d.text=function(p,m,y){let w=m.layout.get("text-transform").evaluate(y,{});return w==="uppercase"?p=p.toLocaleUpperCase():w==="lowercase"&&(p=p.toLocaleLowerCase()),sa.applyArabicShaping&&(p=sa.applyArabicShaping(p)),p}(d.text,n,l)}),r}let s2={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42","\u2190":"\u2191","\u2192":"\u2193"};function JF(r){return r==="\uFE36"||r==="\uFE48"||r==="\uFE38"||r==="\uFE44"||r==="\uFE42"||r==="\uFE3E"||r==="\uFE3C"||r==="\uFE3A"||r==="\uFE18"||r==="\uFE40"||r==="\uFE10"||r==="\uFE13"||r==="\uFE14"||r==="\uFF40"||r==="\uFFE3"||r==="\uFE11"||r==="\uFE12"}function KF(r){return r==="\uFE35"||r==="\uFE47"||r==="\uFE37"||r==="\uFE43"||r==="\uFE41"||r==="\uFE3D"||r==="\uFE3B"||r==="\uFE39"||r==="\uFE17"||r==="\uFE3F"}var QF={read:function(r,n,l,d,p){var m,y,w=8*p-d-1,T=(1<<w)-1,E=T>>1,I=-7,R=l?p-1:0,F=l?-1:1,B=r[n+R];for(R+=F,m=B&(1<<-I)-1,B>>=-I,I+=w;I>0;m=256*m+r[n+R],R+=F,I-=8);for(y=m&(1<<-I)-1,m>>=-I,I+=d;I>0;y=256*y+r[n+R],R+=F,I-=8);if(m===0)m=1-E;else{if(m===T)return y?NaN:1/0*(B?-1:1);y+=Math.pow(2,d),m-=E}return(B?-1:1)*y*Math.pow(2,m-d)},write:function(r,n,l,d,p,m){var y,w,T,E=8*m-p-1,I=(1<<E)-1,R=I>>1,F=p===23?Math.pow(2,-24)-Math.pow(2,-77):0,B=d?0:m-1,V=d?1:-1,W=n<0||n===0&&1/n<0?1:0;for(n=Math.abs(n),isNaN(n)||n===1/0?(w=isNaN(n)?1:0,y=I):(y=Math.floor(Math.log(n)/Math.LN2),n*(T=Math.pow(2,-y))<1&&(y--,T*=2),(n+=y+R>=1?F/T:F*Math.pow(2,1-R))*T>=2&&(y++,T/=2),y+R>=I?(w=0,y=I):y+R>=1?(w=(n*T-1)*Math.pow(2,p),y+=R):(w=n*Math.pow(2,R-1)*Math.pow(2,p),y=0));p>=8;r[l+B]=255&w,B+=V,w/=256,p-=8);for(y=y<<p|w,E+=p;E>0;r[l+B]=255&y,B+=V,y/=256,E-=8);r[l+B-V]|=128*W}},yT=Xr,U4=QF;function Xr(r){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(r)?r:new Uint8Array(r||0),this.pos=0,this.type=0,this.length=this.buf.length}Xr.Varint=0,Xr.Fixed64=1,Xr.Bytes=2,Xr.Fixed32=5;var Pv=4294967296,vT=1/Pv,xT=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function M0(r){return r.type===Xr.Bytes?r.readVarint()+r.pos:r.pos+1}function Xp(r,n,l){return l?4294967296*n+(r>>>0):4294967296*(n>>>0)+(r>>>0)}function bT(r,n,l){var d=n<=16383?1:n<=2097151?2:n<=268435455?3:Math.floor(Math.log(n)/(7*Math.LN2));l.realloc(d);for(var p=l.pos-1;p>=r;p--)l.buf[p+d]=l.buf[p]}function eO(r,n){for(var l=0;l<r.length;l++)n.writeVarint(r[l])}function tO(r,n){for(var l=0;l<r.length;l++)n.writeSVarint(r[l])}function iO(r,n){for(var l=0;l<r.length;l++)n.writeFloat(r[l])}function nO(r,n){for(var l=0;l<r.length;l++)n.writeDouble(r[l])}function rO(r,n){for(var l=0;l<r.length;l++)n.writeBoolean(r[l])}function sO(r,n){for(var l=0;l<r.length;l++)n.writeFixed32(r[l])}function oO(r,n){for(var l=0;l<r.length;l++)n.writeSFixed32(r[l])}function aO(r,n){for(var l=0;l<r.length;l++)n.writeFixed64(r[l])}function lO(r,n){for(var l=0;l<r.length;l++)n.writeSFixed64(r[l])}function V4(r,n){return(r[n]|r[n+1]<<8|r[n+2]<<16)+16777216*r[n+3]}function Zp(r,n,l){r[l]=n,r[l+1]=n>>>8,r[l+2]=n>>>16,r[l+3]=n>>>24}function wT(r,n){return(r[n]|r[n+1]<<8|r[n+2]<<16)+(r[n+3]<<24)}Xr.prototype={destroy:function(){this.buf=null},readFields:function(r,n,l){for(l=l||this.length;this.pos<l;){var d=this.readVarint(),p=d>>3,m=this.pos;this.type=7&d,r(p,n,this),this.pos===m&&this.skip(d)}return n},readMessage:function(r,n){return this.readFields(r,n,this.readVarint()+this.pos)},readFixed32:function(){var r=V4(this.buf,this.pos);return this.pos+=4,r},readSFixed32:function(){var r=wT(this.buf,this.pos);return this.pos+=4,r},readFixed64:function(){var r=V4(this.buf,this.pos)+V4(this.buf,this.pos+4)*Pv;return this.pos+=8,r},readSFixed64:function(){var r=V4(this.buf,this.pos)+wT(this.buf,this.pos+4)*Pv;return this.pos+=8,r},readFloat:function(){var r=U4.read(this.buf,this.pos,!0,23,4);return this.pos+=4,r},readDouble:function(){var r=U4.read(this.buf,this.pos,!0,52,8);return this.pos+=8,r},readVarint:function(r){var n,l,d=this.buf;return n=127&(l=d[this.pos++]),l<128?n:(n|=(127&(l=d[this.pos++]))<<7,l<128?n:(n|=(127&(l=d[this.pos++]))<<14,l<128?n:(n|=(127&(l=d[this.pos++]))<<21,l<128?n:function(p,m,y){var w,T,E=y.buf;if(w=(112&(T=E[y.pos++]))>>4,T<128||(w|=(127&(T=E[y.pos++]))<<3,T<128)||(w|=(127&(T=E[y.pos++]))<<10,T<128)||(w|=(127&(T=E[y.pos++]))<<17,T<128)||(w|=(127&(T=E[y.pos++]))<<24,T<128)||(w|=(1&(T=E[y.pos++]))<<31,T<128))return Xp(p,w,m);throw new Error("Expected varint not more than 10 bytes")}(n|=(15&(l=d[this.pos]))<<28,r,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var r=this.readVarint();return r%2==1?(r+1)/-2:r/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var r=this.readVarint()+this.pos,n=this.pos;return this.pos=r,r-n>=12&&xT?function(l,d,p){return xT.decode(l.subarray(d,p))}(this.buf,n,r):function(l,d,p){for(var m="",y=d;y<p;){var w,T,E,I=l[y],R=null,F=I>239?4:I>223?3:I>191?2:1;if(y+F>p)break;F===1?I<128&&(R=I):F===2?(192&(w=l[y+1]))==128&&(R=(31&I)<<6|63&w)<=127&&(R=null):F===3?(T=l[y+2],(192&(w=l[y+1]))==128&&(192&T)==128&&((R=(15&I)<<12|(63&w)<<6|63&T)<=2047||R>=55296&&R<=57343)&&(R=null)):F===4&&(T=l[y+2],E=l[y+3],(192&(w=l[y+1]))==128&&(192&T)==128&&(192&E)==128&&((R=(15&I)<<18|(63&w)<<12|(63&T)<<6|63&E)<=65535||R>=1114112)&&(R=null)),R===null?(R=65533,F=1):R>65535&&(R-=65536,m+=String.fromCharCode(R>>>10&1023|55296),R=56320|1023&R),m+=String.fromCharCode(R),y+=F}return m}(this.buf,n,r)},readBytes:function(){var r=this.readVarint()+this.pos,n=this.buf.subarray(this.pos,r);return this.pos=r,n},readPackedVarint:function(r,n){if(this.type!==Xr.Bytes)return r.push(this.readVarint(n));var l=M0(this);for(r=r||[];this.pos<l;)r.push(this.readVarint(n));return r},readPackedSVarint:function(r){if(this.type!==Xr.Bytes)return r.push(this.readSVarint());var n=M0(this);for(r=r||[];this.pos<n;)r.push(this.readSVarint());return r},readPackedBoolean:function(r){if(this.type!==Xr.Bytes)return r.push(this.readBoolean());var n=M0(this);for(r=r||[];this.pos<n;)r.push(this.readBoolean());return r},readPackedFloat:function(r){if(this.type!==Xr.Bytes)return r.push(this.readFloat());var n=M0(this);for(r=r||[];this.pos<n;)r.push(this.readFloat());return r},readPackedDouble:function(r){if(this.type!==Xr.Bytes)return r.push(this.readDouble());var n=M0(this);for(r=r||[];this.pos<n;)r.push(this.readDouble());return r},readPackedFixed32:function(r){if(this.type!==Xr.Bytes)return r.push(this.readFixed32());var n=M0(this);for(r=r||[];this.pos<n;)r.push(this.readFixed32());return r},readPackedSFixed32:function(r){if(this.type!==Xr.Bytes)return r.push(this.readSFixed32());var n=M0(this);for(r=r||[];this.pos<n;)r.push(this.readSFixed32());return r},readPackedFixed64:function(r){if(this.type!==Xr.Bytes)return r.push(this.readFixed64());var n=M0(this);for(r=r||[];this.pos<n;)r.push(this.readFixed64());return r},readPackedSFixed64:function(r){if(this.type!==Xr.Bytes)return r.push(this.readSFixed64());var n=M0(this);for(r=r||[];this.pos<n;)r.push(this.readSFixed64());return r},skip:function(r){var n=7&r;if(n===Xr.Varint)for(;this.buf[this.pos++]>127;);else if(n===Xr.Bytes)this.pos=this.readVarint()+this.pos;else if(n===Xr.Fixed32)this.pos+=4;else{if(n!==Xr.Fixed64)throw new Error("Unimplemented type: "+n);this.pos+=8}},writeTag:function(r,n){this.writeVarint(r<<3|n)},realloc:function(r){for(var n=this.length||16;n<this.pos+r;)n*=2;if(n!==this.length){var l=new Uint8Array(n);l.set(this.buf),this.buf=l,this.length=n}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(r){this.realloc(4),Zp(this.buf,r,this.pos),this.pos+=4},writeSFixed32:function(r){this.realloc(4),Zp(this.buf,r,this.pos),this.pos+=4},writeFixed64:function(r){this.realloc(8),Zp(this.buf,-1&r,this.pos),Zp(this.buf,Math.floor(r*vT),this.pos+4),this.pos+=8},writeSFixed64:function(r){this.realloc(8),Zp(this.buf,-1&r,this.pos),Zp(this.buf,Math.floor(r*vT),this.pos+4),this.pos+=8},writeVarint:function(r){(r=+r||0)>268435455||r<0?function(n,l){var d,p;if(n>=0?(d=n%4294967296|0,p=n/4294967296|0):(p=~(-n/4294967296),4294967295^(d=~(-n%4294967296))?d=d+1|0:(d=0,p=p+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),function(m,y,w){w.buf[w.pos++]=127&m|128,m>>>=7,w.buf[w.pos++]=127&m|128,m>>>=7,w.buf[w.pos++]=127&m|128,m>>>=7,w.buf[w.pos++]=127&m|128,w.buf[w.pos]=127&(m>>>=7)}(d,0,l),function(m,y){var w=(7&m)<<4;y.buf[y.pos++]|=w|((m>>>=3)?128:0),m&&(y.buf[y.pos++]=127&m|((m>>>=7)?128:0),m&&(y.buf[y.pos++]=127&m|((m>>>=7)?128:0),m&&(y.buf[y.pos++]=127&m|((m>>>=7)?128:0),m&&(y.buf[y.pos++]=127&m|((m>>>=7)?128:0),m&&(y.buf[y.pos++]=127&m)))))}(p,l)}(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))},writeSVarint:function(r){this.writeVarint(r<0?2*-r-1:2*r)},writeBoolean:function(r){this.writeVarint(!!r)},writeString:function(r){r=String(r),this.realloc(4*r.length),this.pos++;var n=this.pos;this.pos=function(d,p,m){for(var y,w,T=0;T<p.length;T++){if((y=p.charCodeAt(T))>55295&&y<57344){if(!w){y>56319||T+1===p.length?(d[m++]=239,d[m++]=191,d[m++]=189):w=y;continue}if(y<56320){d[m++]=239,d[m++]=191,d[m++]=189,w=y;continue}y=w-55296<<10|y-56320|65536,w=null}else w&&(d[m++]=239,d[m++]=191,d[m++]=189,w=null);y<128?d[m++]=y:(y<2048?d[m++]=y>>6|192:(y<65536?d[m++]=y>>12|224:(d[m++]=y>>18|240,d[m++]=y>>12&63|128),d[m++]=y>>6&63|128),d[m++]=63&y|128)}return m}(this.buf,r,this.pos);var l=this.pos-n;l>=128&&bT(n,l,this),this.pos=n-1,this.writeVarint(l),this.pos+=l},writeFloat:function(r){this.realloc(4),U4.write(this.buf,r,this.pos,!0,23,4),this.pos+=4},writeDouble:function(r){this.realloc(8),U4.write(this.buf,r,this.pos,!0,52,8),this.pos+=8},writeBytes:function(r){var n=r.length;this.writeVarint(n),this.realloc(n);for(var l=0;l<n;l++)this.buf[this.pos++]=r[l]},writeRawMessage:function(r,n){this.pos++;var l=this.pos;r(n,this);var d=this.pos-l;d>=128&&bT(l,d,this),this.pos=l-1,this.writeVarint(d),this.pos+=d},writeMessage:function(r,n,l){this.writeTag(r,Xr.Bytes),this.writeRawMessage(n,l)},writePackedVarint:function(r,n){n.length&&this.writeMessage(r,eO,n)},writePackedSVarint:function(r,n){n.length&&this.writeMessage(r,tO,n)},writePackedBoolean:function(r,n){n.length&&this.writeMessage(r,rO,n)},writePackedFloat:function(r,n){n.length&&this.writeMessage(r,iO,n)},writePackedDouble:function(r,n){n.length&&this.writeMessage(r,nO,n)},writePackedFixed32:function(r,n){n.length&&this.writeMessage(r,sO,n)},writePackedSFixed32:function(r,n){n.length&&this.writeMessage(r,oO,n)},writePackedFixed64:function(r,n){n.length&&this.writeMessage(r,aO,n)},writePackedSFixed64:function(r,n){n.length&&this.writeMessage(r,lO,n)},writeBytesField:function(r,n){this.writeTag(r,Xr.Bytes),this.writeBytes(n)},writeFixed32Field:function(r,n){this.writeTag(r,Xr.Fixed32),this.writeFixed32(n)},writeSFixed32Field:function(r,n){this.writeTag(r,Xr.Fixed32),this.writeSFixed32(n)},writeFixed64Field:function(r,n){this.writeTag(r,Xr.Fixed64),this.writeFixed64(n)},writeSFixed64Field:function(r,n){this.writeTag(r,Xr.Fixed64),this.writeSFixed64(n)},writeVarintField:function(r,n){this.writeTag(r,Xr.Varint),this.writeVarint(n)},writeSVarintField:function(r,n){this.writeTag(r,Xr.Varint),this.writeSVarint(n)},writeStringField:function(r,n){this.writeTag(r,Xr.Bytes),this.writeString(n)},writeFloatField:function(r,n){this.writeTag(r,Xr.Fixed32),this.writeFloat(n)},writeDoubleField:function(r,n){this.writeTag(r,Xr.Fixed64),this.writeDouble(n)},writeBooleanField:function(r,n){this.writeVarintField(r,!!n)}};var $p=G(yT);let Rv=3;function cO(r,n,l){n.glyphs=[],r===1&&l.readMessage(hO,n)}function hO(r,n,l){if(r===3){let{id:d,bitmap:p,width:m,height:y,left:w,top:T,advance:E}=l.readMessage(dO,{});n.glyphs.push({id:d,bitmap:new bh({width:m+2*Rv,height:y+2*Rv},p),metrics:{width:m,height:y,left:w,top:T,advance:E}})}else r===4?n.ascender=l.readSVarint():r===5&&(n.descender=l.readSVarint())}function dO(r,n,l){r===1?n.id=l.readVarint():r===2?n.bitmap=l.readBytes():r===3?n.width=l.readVarint():r===4?n.height=l.readVarint():r===5?n.left=l.readSVarint():r===6?n.top=l.readSVarint():r===7&&(n.advance=l.readVarint())}let ST=Rv,Ka={horizontal:1,vertical:2,horizontalOnly:3};class o2{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(n,l){let d=new o2;return d.scale=n||1,d.fontStack=l,d}static forImage(n){let l=new o2;return l.imageName=n,l}}class Yp{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(n,l){let d=new Yp;for(let p=0;p<n.sections.length;p++){let m=n.sections[p];m.image?d.addImageSection(m):d.addTextSection(m,l)}return d}length(){return this.text.length}getSection(n){return this.sections[this.sectionIndex[n]]}getSections(){return this.sections}getSectionIndex(n){return this.sectionIndex[n]}getCodePoint(n){return this.text.codePointAt(n)}verticalizePunctuation(n){this.text=function(l,d){let p="";for(let m=0;m<l.length;m++){let y=l.charCodeAt(m+1)||null,w=l.charCodeAt(m-1)||null;p+=!d&&(y&&Z_(y)&&!s2[l[m+1]]||w&&Z_(w)&&!s2[l[m-1]])||!s2[l[m]]?l[m]:s2[l[m]]}return p}(this.text,n)}trim(){let n=0;for(let d=0;d<this.text.length&&G4[this.text.charCodeAt(d)];d++)n++;let l=this.text.length;for(let d=this.text.length-1;d>=0&&d>=n&&G4[this.text.charCodeAt(d)];d--)l--;this.text=this.text.substring(n,l),this.sectionIndex=this.sectionIndex.slice(n,l)}substring(n,l){let d=new Yp;return d.text=this.text.substring(n,l),d.sectionIndex=this.sectionIndex.slice(n,l),d.sections=this.sections,d}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((n,l)=>Math.max(n,this.sections[l].scale),0)}addTextSection(n,l){this.text+=n.text,this.sections.push(o2.forText(n.scale,n.fontStack||l));let d=this.sections.length-1;for(let p=0;p<n.text.length;++p)this.sectionIndex.push(d)}addImageSection(n){let l=n.image?n.image.namePrimary:"";if(l.length===0)return void Ui("Can't add FormattedSection with an empty image.");let d=this.getNextImageSectionCharCode();d?(this.text+=String.fromCodePoint(d),this.sections.push(o2.forImage(l)),this.sectionIndex.push(this.sections.length-1)):Ui("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function kv(r,n,l,d,p,m,y,w,T,E,I,R,F,B,V){let W=Yp.fromFeature(r,p);R===Ka.vertical&&W.verticalizePunctuation(F);let $=[],J=function(xe,ke,Be,We,Ke,qe){if(!xe)return[];let dt=[],Mt=function(yt,Xt,At,fi,oi,Lt){let Ni=0;for(let wi=0;wi<yt.length();wi++){let pi=yt.getSection(wi);Ni+=TT(yt.getCodePoint(wi),pi,fi,oi,Xt,Lt)}return Ni/Math.max(1,Math.ceil(Ni/At))}(xe,ke,Be,We,Ke,qe),rt=xe.text.indexOf("\u200B")>=0,vt=0;for(let yt=0;yt<xe.length();yt++){let Xt=xe.getSection(yt),At=xe.getCodePoint(yt);if(G4[At]||(vt+=TT(At,Xt,We,Ke,ke,qe)),yt<xe.length()-1){let fi=!((it=At)<11904||!(_i["Bopomofo Extended"](it)||_i.Bopomofo(it)||_i["CJK Compatibility Forms"](it)||_i["CJK Compatibility Ideographs"](it)||_i["CJK Compatibility"](it)||_i["CJK Radicals Supplement"](it)||_i["CJK Strokes"](it)||_i["CJK Symbols and Punctuation"](it)||_i["CJK Unified Ideographs Extension A"](it)||_i["CJK Unified Ideographs"](it)||_i["Enclosed CJK Letters and Months"](it)||_i["Halfwidth and Fullwidth Forms"](it)||_i.Hiragana(it)||_i["Ideographic Description Characters"](it)||_i["Kangxi Radicals"](it)||_i["Katakana Phonetic Extensions"](it)||_i.Katakana(it)||_i["Vertical Forms"](it)||_i["Yi Radicals"](it)||_i["Yi Syllables"](it)));(uO[At]||fi||Xt.imageName)&&dt.push(ET(yt+1,vt,Mt,dt,pO(At,xe.getCodePoint(yt+1),fi&&rt),!1))}}var it;return AT(ET(xe.length(),vt,Mt,dt,0,!0))}(W,E,m,n,d,B),{processBidirectionalText:le,processStyledBidirectionalText:pe}=sa;if(le&&W.sections.length===1){let xe=le(W.toString(),J);for(let ke of xe){let Be=new Yp;Be.text=ke,Be.sections=W.sections;for(let We=0;We<ke.length;We++)Be.sectionIndex.push(0);$.push(Be)}}else if(pe){let xe=pe(W.text,W.sectionIndex,J);for(let ke of xe){let Be=new Yp;Be.text=ke[0],Be.sectionIndex=ke[1],Be.sections=W.sections,$.push(Be)}}else $=function(xe,ke){let Be=[],We=xe.text,Ke=0;for(let qe of ke)Be.push(xe.substring(Ke,qe)),Ke=qe;return Ke<We.length&&Be.push(xe.substring(Ke,We.length)),Be}(W,J);let ue=[],Me={positionedLines:ue,text:W.toString(),top:I[1],bottom:I[1],left:I[0],right:I[0],writingMode:R,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(xe,ke,Be,We,Ke,qe,dt,Mt,rt,vt,it,yt){let Xt=0,At=0,fi=0,oi=Mt==="right"?1:Mt==="left"?0:.5,Lt=!1;for(let xn of Ke){let Hi=xn.getSections();for(let bn of Hi){if(bn.imageName)continue;let nn=ke[bn.fontStack];if(nn&&(Lt=nn.ascender!==void 0&&nn.descender!==void 0,!Lt))break}if(!Lt)break}let Ni=0;for(let xn of Ke){xn.trim();let Hi=xn.getMaxScale(),bn=(Hi-1)*mo,nn={positionedGlyphs:[],lineOffset:0};xe.positionedLines[Ni]=nn;let Vn=nn.positionedGlyphs,dn=0;if(!xn.length()){At+=qe,++Ni;continue}let Cr=0,tr=0;for(let ur=0;ur<xn.length();ur++){let ir=xn.getSection(ur),Zr=xn.getSectionIndex(ur),wr=xn.getCodePoint(ur),cs=ir.scale,Os=null,ao=null,Hr=null,es=mo,Zs=0,$s=!(rt===Ka.horizontal||!it&&!xm(wr)||it&&(G4[wr]||(wi=wr,_i.Arabic(wi)||_i["Arabic Supplement"](wi)||_i["Arabic Extended-A"](wi)||_i["Arabic Presentation Forms-A"](wi)||_i["Arabic Presentation Forms-B"](wi))));if(ir.imageName){let Ys=We[ir.imageName];if(!Ys)continue;Hr=ir.imageName,xe.iconsInText=xe.iconsInText||!0,ao=Ys.paddedRect;let zr=Ys.displaySize;cs=cs*mo/yt,Os={width:zr[0],height:zr[1],left:0,top:-ST,advance:$s?zr[1]:zr[0],localGlyph:!1},Zs=Lt?-Os.height*cs:Hi*mo-17-zr[1]*cs,es=Os.advance;let Ca=($s?zr[0]:zr[1])*cs-mo*Hi;Ca>0&&Ca>dn&&(dn=Ca)}else{let Ys=Be[ir.fontStack];if(!Ys)continue;Ys[wr]&&(ao=Ys[wr]);let zr=ke[ir.fontStack];if(!zr)continue;let Ca=zr.glyphs[wr];if(!Ca)continue;if(Os=Ca.metrics,es=wr!==8203?mo:0,Lt){let Ph=zr.ascender!==void 0?Math.abs(zr.ascender):0,$o=zr.descender!==void 0?Math.abs(zr.descender):0,Oo=(Ph+$o)*cs;Cr<Oo&&(Cr=Oo,tr=(Ph-$o)/2*cs),Zs=-Ph*cs}else Zs=(Hi-cs)*mo-17}$s?(xe.verticalizable=!0,Vn.push({glyph:wr,imageName:Hr,x:Xt,y:At+Zs,vertical:$s,scale:cs,localGlyph:Os.localGlyph,fontStack:ir.fontStack,sectionIndex:Zr,metrics:Os,rect:ao}),Xt+=es*cs+vt):(Vn.push({glyph:wr,imageName:Hr,x:Xt,y:At+Zs,vertical:$s,scale:cs,localGlyph:Os.localGlyph,fontStack:ir.fontStack,sectionIndex:Zr,metrics:Os,rect:ao}),Xt+=Os.advance*cs+vt)}Vn.length!==0&&(fi=Math.max(Xt-vt,fi),Lt?CT(Vn,oi,dn,tr,qe*Hi/2):CT(Vn,oi,dn,0,qe/2)),Xt=0;let rr=qe*Hi+dn;nn.lineOffset=Math.max(dn,bn),At+=rr,++Ni}var wi;let pi=At,{horizontalAlign:Ft,verticalAlign:Ci}=Dv(dt);(function(xn,Hi,bn,nn,Vn,dn){let Cr=(Hi-bn)*Vn,tr=-dn*nn;for(let rr of xn)for(let ur of rr.positionedGlyphs)ur.x+=Cr,ur.y+=tr})(xe.positionedLines,oi,Ft,Ci,fi,pi),xe.top+=-Ci*pi,xe.bottom=xe.top+pi,xe.left+=-Ft*fi,xe.right=xe.left+fi,xe.hasBaseline=Lt}(Me,n,l,d,$,y,w,T,R,E,F,V),!function(xe){for(let ke of xe)if(ke.positionedGlyphs.length!==0)return!1;return!0}(ue)&&Me}let G4={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},uO={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function TT(r,n,l,d,p,m){if(n.imageName){let y=d[n.imageName];return y?y.displaySize[0]*n.scale*mo/m+p:0}{let y=l[n.fontStack],w=y&&y.glyphs[r];return w?w.metrics.advance*n.scale+p:0}}function MT(r,n,l,d){let p=Math.pow(r-n,2);return d?r<n?p/2:2*p:p+Math.abs(l)*l}function pO(r,n,l){let d=0;return r===10&&(d-=1e4),l&&(d+=150),r!==40&&r!==65288||(d+=50),n!==41&&n!==65289||(d+=50),d}function ET(r,n,l,d,p,m){let y=null,w=MT(n,l,p,m);for(let T of d){let E=MT(n-T.x,l,p,m)+T.badness;E<=w&&(y=T,w=E)}return{index:r,x:n,priorBreak:y,badness:w}}function AT(r){return r?AT(r.priorBreak).concat(r.index):[]}function Dv(r){let n=.5,l=.5;switch(r){case"right":case"top-right":case"bottom-right":n=1;break;case"left":case"top-left":case"bottom-left":n=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:n,verticalAlign:l}}function CT(r,n,l,d,p){if(!(n||l||d||p))return;let m=r.length-1,y=r[m],w=(y.x+y.metrics.advance*y.scale)*n;for(let T=0;T<=m;T++)r[T].x-=w,r[T].y+=l+d+p}function fO(r,n,l,d){let{horizontalAlign:p,verticalAlign:m}=Dv(d),y=l[0]-r.displaySize[0]*p,w=l[1]-r.displaySize[1]*m;return{imagePrimary:r,imageSecondary:n,top:w,bottom:w+r.displaySize[1],left:y,right:y+r.displaySize[0]}}function IT(r,n,l,d,p,m){let y=r.imagePrimary,w;if(y.content){let $=y.content,J=y.pixelRatio||1;w=[$[0]/J,$[1]/J,y.displaySize[0]-$[2]/J,y.displaySize[1]-$[3]/J]}let T=n.left*m,E=n.right*m,I,R,F,B;l==="width"||l==="both"?(B=p[0]+T-d[3],R=p[0]+E+d[1]):(B=p[0]+(T+E-y.displaySize[0])/2,R=B+y.displaySize[0]);let V=n.top*m,W=n.bottom*m;return l==="height"||l==="both"?(I=p[1]+V-d[0],F=p[1]+W+d[2]):(I=p[1]+(V+W-y.displaySize[1])/2,F=I+y.displaySize[1]),{imagePrimary:y,imageSecondary:void 0,top:I,right:R,bottom:F,left:B,collisionPadding:w}}class E0 extends de{constructor(n,l,d,p,m){super(n,l),this.angle=p,this.z=d,m!==void 0&&(this.segment=m)}clone(){return new E0(this.x,this.y,this.z,this.angle,this.segment)}}function PT(r,n,l,d,p){if(n.segment===void 0)return!0;let m=n,y=n.segment+1,w=0;for(;w>-l/2;){if(y--,y<0)return!1;w-=r[y].dist(m),m=r[y]}w+=r[y].dist(r[y+1]),y++;let T=[],E=0;for(;w<l/2;){let I=r[y],R=r[y+1];if(!R)return!1;let F=r[y-1].angleTo(I)-I.angleTo(R);for(F=Math.abs((F+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:w,angleDelta:F}),E+=F;w-T[0].distance>d;)E-=T.shift().angleDelta;if(E>p)return!1;y++,w+=I.dist(R)}return!0}function RT(r){let n=0;for(let l=0;l<r.length-1;l++)n+=r[l].dist(r[l+1]);return n}function kT(r,n,l){return r?.6*n*l:0}function DT(r,n){return Math.max(r?r.right-r.left:0,n?n.right-n.left:0)}function mO(r,n,l,d,p,m){let y=kT(l,p,m),w=DT(l,d)*m,T=0,E=RT(r)/2;for(let I=0;I<r.length-1;I++){let R=r[I],F=r[I+1],B=R.dist(F);if(T+B>E){let V=(E-T)/B,W=Tn(R.x,F.x,V),$=Tn(R.y,F.y,V),J=new E0(W,$,0,F.angleTo(R),I);return!y||PT(r,J,w,y,n)?J:void 0}T+=B}}function gO(r,n,l,d,p,m,y,w,T){let E=kT(d,m,y),I=DT(d,p),R=I*y,F=r[0].x===0||r[0].x===T||r[0].y===0||r[0].y===T;return n-R<n/4&&(n=R+n/4),LT(r,F?n/2*w%n:(I/2+2*m)*y*w%n,n,E,l,R,F,!1,T)}function LT(r,n,l,d,p,m,y,w,T){let E=m/2,I=RT(r),R=0,F=n-l,B=[];for(let V=0;V<r.length-1;V++){let W=r[V],$=r[V+1],J=W.dist($),le=$.angleTo(W);for(;F+l<R+J;){F+=l;let pe=(F-R)/J,ue=Tn(W.x,$.x,pe),Me=Tn(W.y,$.y,pe);if(ue>=0&&ue<T&&Me>=0&&Me<T&&F-E>=0&&F+E<=I){let xe=new E0(ue,Me,0,le,V);d&&!PT(r,xe,m,d,p)||B.push(xe)}}R+=J}return w||B.length||y||(B=LT(r,R/2,l,d,p,m,y,!0,T)),B}function FT(r,n,l,d,p){let m=[];for(let y=0;y<r.length;y++){let w=r[y],T;for(let E=0;E<w.length-1;E++){let I=w[E],R=w[E+1];I.x<n&&R.x<n||(I.x<n?I=new de(n,I.y+(n-I.x)/(R.x-I.x)*(R.y-I.y))._round():R.x<n&&(R=new de(n,I.y+(n-I.x)/(R.x-I.x)*(R.y-I.y))._round()),I.y<l&&R.y<l||(I.y<l?I=new de(I.x+(l-I.y)/(R.y-I.y)*(R.x-I.x),l)._round():R.y<l&&(R=new de(I.x+(l-I.y)/(R.y-I.y)*(R.x-I.x),l)._round()),I.x>=d&&R.x>=d||(I.x>=d?I=new de(d,I.y+(d-I.x)/(R.x-I.x)*(R.y-I.y))._round():R.x>=d&&(R=new de(d,I.y+(d-I.x)/(R.x-I.x)*(R.y-I.y))._round()),I.y>=p&&R.y>=p||(I.y>=p?I=new de(I.x+(p-I.y)/(R.y-I.y)*(R.x-I.x),p)._round():R.y>=p&&(R=new de(I.x+(p-I.y)/(R.y-I.y)*(R.x-I.x),p)._round()),T&&I.equals(T[T.length-1])||(T=[I],m.push(T)),T.push(R)))))}}return m}function OT(r){let n=0,l=0;for(let y of r)n+=y.w*y.h,l=Math.max(l,y.w);r.sort((y,w)=>w.h-y.h);let d=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),l),h:1/0}],p=0,m=0;for(let y of r)for(let w=d.length-1;w>=0;w--){let T=d[w];if(!(y.w>T.w||y.h>T.h)){if(y.x=T.x,y.y=T.y,m=Math.max(m,y.y+y.h),p=Math.max(p,y.x+y.w),y.w===T.w&&y.h===T.h){let E=d.pop();w<d.length&&(d[w]=E)}else y.h===T.h?(T.x+=y.w,T.w-=y.w):y.w===T.w?(T.y+=y.h,T.h-=y.h):(d.push({x:T.x+y.w,y:T.y,w:T.w-y.w,h:y.h}),T.y+=y.h,T.h-=y.h);break}}return{w:p,h:m,fill:n/(p*m)||0}}hi(E0,"Anchor");let Aa=1;class Lv{constructor(n,{pixelRatio:l,version:d,stretchX:p,stretchY:m,content:y}){this.paddedRect=n,this.pixelRatio=l,this.stretchX=p,this.stretchY=m,this.content=y,this.version=d}get tl(){return[this.paddedRect.x+Aa,this.paddedRect.y+Aa]}get br(){return[this.paddedRect.x+this.paddedRect.w-Aa,this.paddedRect.y+this.paddedRect.h-Aa]}get displaySize(){return[(this.paddedRect.w-2*Aa)/this.pixelRatio,(this.paddedRect.h-2*Aa)/this.pixelRatio]}}class NT{constructor(n,l){let d={},p={};this.haveRenderCallbacks=[];let m=[];this.addImages(n,d,m),this.addImages(l,p,m);let{w:y,h:w}=OT(m),T=new Ja({width:y||1,height:w||1});for(let E in n){let I=n[E],R=d[E].paddedRect;Ja.copy(I.data,T,{x:0,y:0},{x:R.x+Aa,y:R.y+Aa},I.data,I.sdf)}for(let E in l){let I=l[E],R=p[E].paddedRect,F=R.x+Aa,B=R.y+Aa,V=I.data.width,W=I.data.height;Ja.copy(I.data,T,{x:0,y:0},{x:F,y:B},I.data),Ja.copy(I.data,T,{x:0,y:W-1},{x:F,y:B-1},{width:V,height:1}),Ja.copy(I.data,T,{x:0,y:0},{x:F,y:B+W},{width:V,height:1}),Ja.copy(I.data,T,{x:V-1,y:0},{x:F-1,y:B},{width:1,height:W}),Ja.copy(I.data,T,{x:0,y:0},{x:F+V,y:B},{width:1,height:W})}this.image=T,this.iconPositions=d,this.patternPositions=p}addImages(n,l,d){for(let p in n){let m=n[p],y={x:0,y:0,w:m.data.width+2*Aa,h:m.data.height+2*Aa};d.push(y),l[p]=new Lv(y,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(p)}}patchUpdatedImages(n,l,d){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(p=>n.hasImage(p,d)),n.dispatchRenderCallbacks(this.haveRenderCallbacks,d);for(let p in n.getUpdatedImages(d))this.patchUpdatedImage(this.iconPositions[p],n.getImage(p,d),l),this.patchUpdatedImage(this.patternPositions[p],n.getImage(p,d),l)}patchUpdatedImage(n,l,d){if(!n||!l||n.version===l.version)return;n.version=l.version;let[p,m]=n.tl,y=!!Object.keys(this.patternPositions).length;d.update(l.data,{useMipmap:y},{x:p,y:m})}}hi(Lv,"ImagePosition"),hi(NT,"ImageAtlas");let a2=1e20;function zT(r,n,l,d,p,m,y,w,T){for(let E=n;E<n+d;E++)BT(r,l*m+E,m,p,y,w,T);for(let E=l;E<l+p;E++)BT(r,E*m+n,1,d,y,w,T)}function BT(r,n,l,d,p,m,y){m[0]=0,y[0]=-a2,y[1]=a2,p[0]=r[n];for(let w=1,T=0,E=0;w<d;w++){p[w]=r[n+w*l];let I=w*w;do{let R=m[T];E=(p[w]-p[R]+I-R*R)/(w-R)/2}while(E<=y[T]&&--T>-1);T++,m[T]=w,y[T]=E,y[T+1]=a2}for(let w=0,T=0;w<d;w++){for(;y[T+1]<w;)T++;let E=m[T],I=w-E;r[n+w*l]=p[E]+I*I}}let jl=2,Fv={none:0,ideographs:1,all:2};class Jp{constructor(n,l,d){this.requestManager=n,this.localGlyphMode=l,this.localFontFamily=d,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(n,l){this.urls[l]=n}getGlyphs(n,l,d){let p=[],m=this.urls[l]||x.GLYPHS_URL;for(let y in n)for(let w of n[y])p.push({stack:y,id:w});bt(p,({stack:y,id:w},T)=>{let E=this.entries[y];E||(E=this.entries[y]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let I=E.glyphs[w];if(I!==void 0)return void T(null,{stack:y,id:w,glyph:I});if(I=this._tinySDF(E,y,w),I)return E.glyphs[w]=I,void T(null,{stack:y,id:w,glyph:I});let R=Math.floor(w/256);if(256*R>65535)return void T(new Error("glyphs > 65535 not supported"));if(E.ranges[R])return void T(null,{stack:y,id:w,glyph:I});let F=E.requests[R];F||(F=E.requests[R]=[],Jp.loadGlyphRange(y,R,m,this.requestManager,(B,V)=>{if(V){E.ascender=V.ascender,E.descender=V.descender;for(let W in V.glyphs)this._doesCharSupportLocalGlyph(+W)||(E.glyphs[+W]=V.glyphs[+W]);E.ranges[R]=!0}for(let W of F)W(B,V);delete E.requests[R]})),F.push((B,V)=>{B?T(B):V&&T(null,{stack:y,id:w,glyph:V.glyphs[w]||null})})},(y,w)=>{if(y)d(y);else if(w){let T={};for(let{stack:E,id:I,glyph:R}of w)T[E]===void 0&&(T[E]={}),T[E].glyphs===void 0&&(T[E].glyphs={}),T[E].glyphs[I]=R&&{id:R.id,bitmap:R.bitmap.clone(),metrics:R.metrics},T[E].ascender=this.entries[E].ascender,T[E].descender=this.entries[E].descender;d(null,T)}})}_doesCharSupportLocalGlyph(n){return this.localGlyphMode!==Fv.none&&(this.localGlyphMode===Fv.all?!!this.localFontFamily:!!this.localFontFamily&&(_i["CJK Unified Ideographs"](n)||_i["Hangul Syllables"](n)||_i.Hiragana(n)||_i.Katakana(n)||_i["CJK Symbols and Punctuation"](n)||_i["CJK Unified Ideographs Extension A"](n)||_i["CJK Unified Ideographs Extension B"](n)))}_tinySDF(n,l,d){let p=this.localFontFamily;if(!p||!this._doesCharSupportLocalGlyph(d))return;let m=n.tinySDF;if(!m){let W="400";/bold/i.test(l)?W="900":/medium/i.test(l)?W="500":/light/i.test(l)&&(W="200"),m=n.tinySDF=new Jp.TinySDF({fontFamily:p,fontWeight:W,fontSize:24*jl,buffer:3*jl,radius:8*jl}),m.fontWeight=W}if(this.localGlyphs[m.fontWeight][d])return this.localGlyphs[m.fontWeight][d];let y=String.fromCodePoint(d),{data:w,width:T,height:E,glyphWidth:I,glyphHeight:R,glyphLeft:F,glyphTop:B,glyphAdvance:V}=m.draw(y);return this.localGlyphs[m.fontWeight][d]={id:d,bitmap:new bh({width:T,height:E},w),metrics:{width:I/jl,height:R/jl,left:F/jl,top:B/jl-27,advance:V/jl,localGlyph:!0}}}}Jp.loadGlyphRange=function(r,n,l,d,p){let m=256*n,y=m+255,w=d.transformRequest(d.normalizeGlyphsURL(l).replace("{fontstack}",r).replace("{range}",`${m}-${y}`),fr.Glyphs);lt(w,(T,E)=>{if(T)p(T);else if(E){let I={},R=function(F){return new $p(F).readFields(cO,{})}(E);for(let F of R.glyphs)I[F.id]=F;p(null,{glyphs:I,ascender:R.ascender,descender:R.descender})}})},Jp.TinySDF=class{constructor({fontSize:r=24,buffer:n=3,radius:l=8,cutoff:d=.25,fontFamily:p="sans-serif",fontWeight:m="normal",fontStyle:y="normal"}={}){this.buffer=n,this.cutoff=d,this.radius=l;let w=this.size=r+4*n,T=this._createCanvas(w),E=this.ctx=T.getContext("2d",{willReadFrequently:!0});E.font=`${y} ${m} ${r}px ${p}`,E.textBaseline="alphabetic",E.textAlign="left",E.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(r){let n=document.createElement("canvas");return n.width=n.height=r,n}draw(r){let{width:n,actualBoundingBoxAscent:l,actualBoundingBoxDescent:d,actualBoundingBoxLeft:p,actualBoundingBoxRight:m}=this.ctx.measureText(r),y=Math.ceil(l),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(m-p))),T=Math.min(this.size-this.buffer,y+Math.ceil(d)),E=w+2*this.buffer,I=T+2*this.buffer,R=Math.max(E*I,0),F=new Uint8ClampedArray(R),B={data:F,width:E,height:I,glyphWidth:w,glyphHeight:T,glyphTop:y,glyphLeft:0,glyphAdvance:n};if(w===0||T===0)return B;let{ctx:V,buffer:W,gridInner:$,gridOuter:J}=this;V.clearRect(W,W,w,T),V.fillText(r,W,W+y);let le=V.getImageData(W,W,w,T);J.fill(a2,0,R),$.fill(0,0,R);for(let pe=0;pe<T;pe++)for(let ue=0;ue<w;ue++){let Me=le.data[4*(pe*w+ue)+3]/255;if(Me===0)continue;let xe=(pe+W)*E+ue+W;if(Me===1)J[xe]=0,$[xe]=a2;else{let ke=.5-Me;J[xe]=ke>0?ke*ke:0,$[xe]=ke<0?ke*ke:0}}zT(J,0,0,E,I,E,this.f,this.v,this.z),zT($,W,W,w,T,E,this.f,this.v,this.z);for(let pe=0;pe<R;pe++){let ue=Math.sqrt(J[pe])-Math.sqrt($[pe]);F[pe]=Math.round(255-255*(ue/this.radius+this.cutoff))}return B}};let Th=Aa;function UT(r,n,l,d){let p=[],m=r.imagePrimary,y=m.pixelRatio,w=m.paddedRect.w-2*Th,T=m.paddedRect.h-2*Th,E=r.right-r.left,I=r.bottom-r.top,R=m.stretchX||[[0,w]],F=m.stretchY||[[0,T]],B=(qe,dt)=>qe+dt[1]-dt[0],V=R.reduce(B,0),W=F.reduce(B,0),$=w-V,J=T-W,le=0,pe=V,ue=0,Me=W,xe=0,ke=$,Be=0,We=J;if(m.content&&d){let qe=m.content;le=H4(R,0,qe[0]),ue=H4(F,0,qe[1]),pe=H4(R,qe[0],qe[2]),Me=H4(F,qe[1],qe[3]),xe=qe[0]-le,Be=qe[1]-ue,ke=qe[2]-qe[0]-pe,We=qe[3]-qe[1]-Me}let Ke=(qe,dt,Mt,rt)=>{let vt=j4(qe.stretch-le,pe,E,r.left),it=W4(qe.fixed-xe,ke,qe.stretch,V),yt=j4(dt.stretch-ue,Me,I,r.top),Xt=W4(dt.fixed-Be,We,dt.stretch,W),At=j4(Mt.stretch-le,pe,E,r.left),fi=W4(Mt.fixed-xe,ke,Mt.stretch,V),oi=j4(rt.stretch-ue,Me,I,r.top),Lt=W4(rt.fixed-Be,We,rt.stretch,W),Ni=new de(vt,yt),wi=new de(At,yt),pi=new de(At,oi),Ft=new de(vt,oi),Ci=new de(it/y,Xt/y),xn=new de(fi/y,Lt/y),Hi=n*Math.PI/180;if(Hi){let tr=Math.sin(Hi),rr=Math.cos(Hi),ur=[rr,-tr,tr,rr];Ni._matMult(ur),wi._matMult(ur),Ft._matMult(ur),pi._matMult(ur)}let bn=qe.stretch+qe.fixed,nn=Mt.stretch+Mt.fixed,Vn=dt.stretch+dt.fixed,dn=rt.stretch+rt.fixed,Cr=r.imageSecondary;return{tl:Ni,tr:wi,bl:Ft,br:pi,texPrimary:{x:m.paddedRect.x+Th+bn,y:m.paddedRect.y+Th+Vn,w:nn-bn,h:dn-Vn},texSecondary:Cr?{x:Cr.paddedRect.x+Th+bn,y:Cr.paddedRect.y+Th+Vn,w:nn-bn,h:dn-Vn}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ci,pixelOffsetBR:xn,minFontScaleX:ke/y/E,minFontScaleY:We/y/I,isSDF:l}};if(d&&(m.stretchX||m.stretchY)){let qe=VT(R,$,V),dt=VT(F,J,W);for(let Mt=0;Mt<qe.length-1;Mt++){let rt=qe[Mt],vt=qe[Mt+1];for(let it=0;it<dt.length-1;it++)p.push(Ke(rt,dt[it],vt,dt[it+1]))}}else p.push(Ke({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:T+1}));return p}function H4(r,n,l){let d=0;for(let p of r)d+=Math.max(n,Math.min(l,p[1]))-Math.max(n,Math.min(l,p[0]));return d}function VT(r,n,l){let d=[{fixed:-Th,stretch:0}];for(let[p,m]of r){let y=d[d.length-1];d.push({fixed:p-y.stretch,stretch:y.stretch}),d.push({fixed:p-y.stretch,stretch:y.stretch+(m-p)})}return d.push({fixed:n+Th,stretch:l}),d}function j4(r,n,l,d){return r/n*l+d}function W4(r,n,l,d){return r-n*l/d}function _O(r,n,l,d){let p=n+r.positionedLines[d].lineOffset;return d===0?l+p/2:l+(p+(n+r.positionedLines[d-1].lineOffset))/2}function yO(r,n=1,l=!1){let d=1/0,p=1/0,m=-1/0,y=-1/0,w=r[0];for(let B=0;B<w.length;B++){let V=w[B];(!B||V.x<d)&&(d=V.x),(!B||V.y<p)&&(p=V.y),(!B||V.x>m)&&(m=V.x),(!B||V.y>y)&&(y=V.y)}let T=Math.min(m-d,y-p),E=T/2,I=new Ea([],vO);if(T===0)return new de(d,p);for(let B=d;B<m;B+=T)for(let V=p;V<y;V+=T)I.push(new Kp(B+E,V+E,E,r));let R=function(B){let V=0,W=0,$=0,J=B[0];for(let le=0,pe=J.length,ue=pe-1;le<pe;ue=le++){let Me=J[le],xe=J[ue],ke=Me.x*xe.y-xe.x*Me.y;W+=(Me.x+xe.x)*ke,$+=(Me.y+xe.y)*ke,V+=3*ke}return new Kp(W/V,$/V,0,B)}(r),F=I.length;for(;I.length;){let B=I.pop();(B.d>R.d||!R.d)&&(R=B,l&&console.log("found best %d after %d probes",Math.round(1e4*B.d)/1e4,F)),B.max-R.d<=n||(E=B.h/2,I.push(new Kp(B.p.x-E,B.p.y-E,E,r)),I.push(new Kp(B.p.x+E,B.p.y-E,E,r)),I.push(new Kp(B.p.x-E,B.p.y+E,E,r)),I.push(new Kp(B.p.x+E,B.p.y+E,E,r)),F+=4)}return l&&(console.log(`num probes: ${F}`),console.log(`best distance: ${R.d}`)),R.p}function vO(r,n){return n.max-r.max}class Kp{constructor(n,l,d,p){this.p=new de(n,l),this.h=d,this.d=function(m,y){let w=!1,T=1/0;for(let E=0;E<y.length;E++){let I=y[E];for(let R=0,F=I.length,B=F-1;R<F;B=R++){let V=I[R],W=I[B];V.y>m.y!=W.y>m.y&&m.x<(W.x-V.x)*(m.y-V.y)/(W.y-V.y)+V.x&&(w=!w),T=Math.min(T,yh(m,V,W))}}return(w?1:-1)*Math.sqrt(T)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}}let Ov=Number.POSITIVE_INFINITY,xO=Math.sqrt(2);function GT(r,[n,l]){let d=0,p=0;if(l===Ov){n<0&&(n=0);let m=n/xO;switch(r){case"top-right":case"top-left":p=m-7;break;case"bottom-right":case"bottom-left":p=7-m;break;case"bottom":p=7-n;break;case"top":p=n-7}switch(r){case"top-right":case"bottom-right":d=-m;break;case"top-left":case"bottom-left":d=m;break;case"left":d=n;break;case"right":d=-n}}else{switch(n=Math.abs(n),l=Math.abs(l),r){case"top-right":case"top-left":case"top":p=l-7;break;case"bottom-right":case"bottom-left":case"bottom":p=7-l}switch(r){case"top-right":case"bottom-right":case"right":d=-n;break;case"top-left":case"bottom-left":case"left":d=n}}return[d,p]}function Nv(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function bO(r,n,l,d,p,m,y,w,T,E,I,R,F,B,V){let W=m.textMaxSize.evaluate(n,{},R);W===void 0&&(W=y);let $=r.layers[0].layout,J=$.get("icon-offset").evaluate(n,{},R),le=jT(l.horizontal)||l.vertical,pe=F.name==="globe",ue=mo,Me=y/ue,xe=r.tilePixelRatio*W/ue,ke=(vt=r.overscaling,r.zoom>18&&vt>2&&(vt>>=1),Math.max(ii/(512*vt),1)*$.get("symbol-spacing")),Be=$.get("text-padding")*r.tilePixelRatio,We=$.get("icon-padding")*r.tilePixelRatio,Ke=De($.get("text-max-angle")),qe=$.get("text-rotation-alignment")==="map"&&$.get("symbol-placement")!=="point",dt=$.get("icon-rotation-alignment")==="map"&&$.get("symbol-placement")!=="point",Mt=$.get("symbol-placement"),rt=ke/2;var vt;let it=$.get("icon-text-fit").evaluate(n,{},R),yt=$.get("icon-text-fit-padding").evaluate(n,{},R),Xt=it!=="none",At;r.hasAnyIconTextFit===!1&&Xt&&(r.hasAnyIconTextFit=!0),d&&Xt&&(r.allowVerticalPlacement&&l.vertical&&(At=IT(d,l.vertical,it,yt,J,Me)),le&&(d=IT(d,le,it,yt,J,Me)));let fi=(oi,Lt,Ni)=>{if(Lt.x<0||Lt.x>=ii||Lt.y<0||Lt.y>=ii)return;let wi=null;if(pe){let{x:pi,y:Ft,z:Ci}=F.projectTilePoint(Lt.x,Lt.y,Ni);wi={anchor:new E0(pi,Ft,Ci,0,void 0),up:F.upVector(Ni,Lt.x,Lt.y)}}(function(pi,Ft,Ci,xn,Hi,bn,nn,Vn,dn,Cr,tr,rr,ur,ir,Zr,wr,cs,Os,ao,Hr,es,Zs,$s,Ys,zr,Ca,Ph){let $o=pi.addToLineVertexArray(Ft,xn),Oo,el,S2,u5,jM,WM,qM,XM=0,ZM=0,$M=0,YM=0,lx=-1,cx=-1,zc={},JM=Xm(""),vu=Ci?Ci.anchor:Ft,hx=dn.layout.get("icon-text-fit").evaluate(es,{},zr)!=="none",dx=0,ux=0;if(dn._unevaluatedLayout.getValue("text-radial-offset")===void 0?[dx,ux]=dn.layout.get("text-offset").evaluate(es,{},zr).map(Ia=>Ia*mo):(dx=dn.layout.get("text-radial-offset").evaluate(es,{},zr)*mo,ux=Ov),pi.allowVerticalPlacement&&Hi.vertical){let Ia=Hi.vertical;if(Zr)WM=zv(Ia),Vn&&(qM=zv(Vn));else{let Pa=dn.layout.get("text-rotate").evaluate(es,{},zr)+90;S2=q4(Cr,vu,Ft,tr,rr,ur,Ia,ir,Pa,wr),Vn&&(u5=q4(Cr,vu,Ft,tr,rr,ur,Vn,Os,Pa))}}if(bn){let Ia=dn.layout.get("icon-rotate").evaluate(es,{},zr),Pa=UT(bn,Ia,$s,hx),s1=Vn?UT(Vn,Ia,$s,hx):void 0;el=q4(Cr,vu,Ft,tr,rr,ur,bn,Os,Ia),XM=4*Pa.length;let KM=pi.iconSizeData,xu=null;KM.kind==="source"?(xu=[Hl*dn.layout.get("icon-size").evaluate(es,{},zr)],xu[0]>Mh&&Ui(`${pi.layerIds[0]}: Value for "icon-size" is >= ${l2}. Reduce your "icon-size".`)):KM.kind==="composite"&&(xu=[Hl*Zs.compositeIconSizes[0].evaluate(es,{},zr),Hl*Zs.compositeIconSizes[1].evaluate(es,{},zr)],(xu[0]>Mh||xu[1]>Mh)&&Ui(`${pi.layerIds[0]}: Value for "icon-size" is >= ${l2}. Reduce your "icon-size".`)),pi.addSymbols(pi.icon,Pa,xu,Hr,ao,es,!1,Ci,Ft,$o.lineStartIndex,$o.lineLength,-1,Ys,zr,Ca,Ph),lx=pi.icon.placedSymbolArray.length-1,s1&&(ZM=4*s1.length,pi.addSymbols(pi.icon,s1,xu,Hr,ao,es,Ka.vertical,Ci,Ft,$o.lineStartIndex,$o.lineLength,-1,Ys,zr,Ca,Ph),cx=pi.icon.placedSymbolArray.length-1)}for(let Ia in Hi.horizontal){let Pa=Hi.horizontal[Ia];Oo||(JM=Xm(Pa.text),Zr?jM=zv(Pa):Oo=q4(Cr,vu,Ft,tr,rr,ur,Pa,ir,dn.layout.get("text-rotate").evaluate(es,{},zr),wr));let s1=Pa.positionedLines.length===1;if($M+=HT(pi,Ci,Ft,Pa,nn,dn,Zr,es,wr,$o,Hi.vertical?Ka.horizontal:Ka.horizontalOnly,s1?Object.keys(Hi.horizontal):[Ia],zc,lx,Zs,Ys,zr,Ca),s1)break}Hi.vertical&&(YM+=HT(pi,Ci,Ft,Hi.vertical,nn,dn,Zr,es,wr,$o,Ka.vertical,["vertical"],zc,cx,Zs,Ys,zr,Ca));let Rh=-1,px=(Ia,Pa)=>Ia?Math.max(Ia,Pa):Pa;Rh=px(jM,Rh),Rh=px(WM,Rh),Rh=px(qM,Rh);let BN=Rh>-1?1:0;pi.glyphOffsetArray.length>=65535&&Ui("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),es.sortKey!==void 0&&pi.addToSortKeyRanges(pi.symbolInstances.length,es.sortKey),pi.symbolInstances.emplaceBack(Ft.x,Ft.y,vu.x,vu.y,vu.z,zc.right>=0?zc.right:-1,zc.center>=0?zc.center:-1,zc.left>=0?zc.left:-1,zc.vertical>=0?zc.vertical:-1,lx,cx,JM,Oo!==void 0?Oo:pi.collisionBoxArray.length,Oo!==void 0?Oo+1:pi.collisionBoxArray.length,S2!==void 0?S2:pi.collisionBoxArray.length,S2!==void 0?S2+1:pi.collisionBoxArray.length,el!==void 0?el:pi.collisionBoxArray.length,el!==void 0?el+1:pi.collisionBoxArray.length,u5||pi.collisionBoxArray.length,u5?u5+1:pi.collisionBoxArray.length,tr,$M,YM,XM,ZM,BN,0,dx,ux,Rh,0,hx?1:0)})(r,Lt,wi,oi,l,d,p,At,r.layers[0],r.collisionBoxArray,n.index,n.sourceLayerIndex,r.index,Be,qe,T,0,We,dt,J,n,m,E,I,R,B,V)};if(Mt==="line")for(let oi of FT(n.geometry,0,0,ii,ii)){let Lt=gO(oi,ke,Ke,l.vertical||le,d,ue,xe,r.overscaling,ii);for(let Ni of Lt)le&&wO(r,le.text,rt,Ni)||fi(oi,Ni,R)}else if(Mt==="line-center"){for(let oi of n.geometry)if(oi.length>1){let Lt=mO(oi,Ke,l.vertical||le,d,ue,xe);Lt&&fi(oi,Lt,R)}}else if(n.type==="Polygon")for(let oi of wv(n.geometry,0)){let Lt=yO(oi,16);fi(oi[0],new E0(Lt.x,Lt.y,0,0,void 0),R)}else if(n.type==="LineString")for(let oi of n.geometry)fi(oi,new E0(oi[0].x,oi[0].y,0,0,void 0),R);else if(n.type==="Point")for(let oi of n.geometry)for(let Lt of oi)fi([Lt],new E0(Lt.x,Lt.y,0,0,void 0),R)}let l2=255,Mh=l2*Hl;function HT(r,n,l,d,p,m,y,w,T,E,I,R,F,B,V,W,$,J){let le=function(Me,xe,ke,Be,We,Ke,qe,dt){let Mt=[];if(xe.positionedLines.length===0)return Mt;let rt=Be.layout.get("text-rotate").evaluate(Ke,{})*Math.PI/180,vt=function(fi){let oi=fi[0],Lt=fi[1],Ni=oi*Lt;return Ni>0?[oi,-Lt]:Ni<0?[-oi,Lt]:oi===0?[Lt,oi]:[Lt,-oi]}(ke),it=Math.abs(xe.top-xe.bottom);for(let fi of xe.positionedLines)it-=fi.lineOffset;let yt=xe.positionedLines.length,Xt=it/yt,At=xe.top-ke[1];for(let fi=0;fi<yt;++fi){let oi=xe.positionedLines[fi];At=_O(xe,Xt,At,fi);for(let Lt of oi.positionedGlyphs){if(!Lt.rect)continue;let Ni=Lt.rect||{},wi=ST+1,pi=!0,Ft=1,Ci=0;if(Lt.imageName){let Hr=qe[Lt.imageName];if(!Hr)continue;if(Hr.sdf){Ui("SDF images are not supported in formatted text and will be ignored.");continue}pi=!1,Ft=Hr.pixelRatio,wi=Aa/Ft}let xn=(We||dt)&&Lt.vertical,Hi=Lt.metrics.advance*Lt.scale/2,bn=Lt.metrics,nn=Lt.rect;if(nn===null)continue;dt&&xe.verticalizable&&(Ci=Lt.imageName?Hi-Lt.metrics.width*Lt.scale/2:0);let Vn=We?[Lt.x+Hi,Lt.y]:[0,0],dn=[0,0],Cr=[0,0],tr=!1;We||(xn?(Cr=[Lt.x+Hi+vt[0],Lt.y+vt[1]-Ci],tr=!0):dn=[Lt.x+Hi+ke[0],Lt.y+ke[1]-Ci]);let rr=nn.w*Lt.scale/(Ft*(Lt.localGlyph?jl:1)),ur=nn.h*Lt.scale/(Ft*(Lt.localGlyph?jl:1)),ir,Zr,wr,cs;if(xn){let Hr=Lt.y-At,es=new de(-Hi,Hi-Hr),Zs=-Math.PI/2,$s=new de(...Cr);ir=new de(-Hi+dn[0],dn[1]),ir._rotateAround(Zs,es)._add($s),ir.x+=-Hr+Hi,ir.y-=(bn.left-wi)*Lt.scale;let Ys=Lt.imageName?bn.advance*Lt.scale:mo*Lt.scale,zr=String.fromCodePoint(Lt.glyph);JF(zr)?ir.x+=(1-wi)*Lt.scale:KF(zr)?ir.x+=Ys-bn.height*Lt.scale+(-wi-1)*Lt.scale:ir.x+=Lt.imageName||bn.width+2*wi===nn.w&&bn.height+2*wi===nn.h?(Ys-ur)/2:(Ys-(bn.height+2*wi)*Lt.scale)/2,Zr=new de(ir.x,ir.y-rr),wr=new de(ir.x+ur,ir.y),cs=new de(ir.x+ur,ir.y-rr)}else{let Hr=(bn.left-wi)*Lt.scale-Hi+dn[0],es=(-bn.top-wi)*Lt.scale+dn[1],Zs=Hr+rr,$s=es+ur;ir=new de(Hr,es),Zr=new de(Zs,es),wr=new de(Hr,$s),cs=new de(Zs,$s)}if(rt){let Hr;Hr=We?new de(0,0):tr?new de(vt[0],vt[1]):new de(ke[0],ke[1]),ir._rotateAround(rt,Hr),Zr._rotateAround(rt,Hr),wr._rotateAround(rt,Hr),cs._rotateAround(rt,Hr)}let Os=new de(0,0),ao=new de(0,0);Mt.push({tl:ir,tr:Zr,bl:wr,br:cs,texPrimary:Ni,texSecondary:void 0,writingMode:xe.writingMode,glyphOffset:Vn,sectionIndex:Lt.sectionIndex,isSDF:pi,pixelOffsetTL:Os,pixelOffsetBR:ao,minFontScaleX:0,minFontScaleY:0})}}return Mt}(0,d,T,m,y,w,p,r.allowVerticalPlacement),pe=r.textSizeData,ue=null;pe.kind==="source"?(ue=[Hl*m.layout.get("text-size").evaluate(w,{},$)],ue[0]>Mh&&Ui(`${r.layerIds[0]}: Value for "text-size" is >= ${l2}. Reduce your "text-size".`)):pe.kind==="composite"&&(ue=[Hl*V.compositeTextSizes[0].evaluate(w,{},$),Hl*V.compositeTextSizes[1].evaluate(w,{},$)],(ue[0]>Mh||ue[1]>Mh)&&Ui(`${r.layerIds[0]}: Value for "text-size" is >= ${l2}. Reduce your "text-size".`)),r.addSymbols(r.text,le,ue,T,y,w,I,n,l,E.lineStartIndex,E.lineLength,B,W,$,J,!1);for(let Me of R)F[Me]=r.text.placedSymbolArray.length-1;return 4*le.length}function jT(r){for(let n in r)return r[n];return null}function q4(r,n,l,d,p,m,y,w,T,E){let I=y.top,R=y.bottom,F=y.left,B=y.right,V=y.collisionPadding;if(V&&(F-=V[0],I-=V[1],B+=V[2],R+=V[3]),T){let W=new de(F,I),$=new de(B,I),J=new de(F,R),le=new de(B,R),pe=De(T),ue=new de(0,0);E&&(ue=new de(E[0],E[1])),W._rotateAround(pe,ue),$._rotateAround(pe,ue),J._rotateAround(pe,ue),le._rotateAround(pe,ue),F=Math.min(W.x,$.x,J.x,le.x),B=Math.max(W.x,$.x,J.x,le.x),I=Math.min(W.y,$.y,J.y,le.y),R=Math.max(W.y,$.y,J.y,le.y)}return r.emplaceBack(n.x,n.y,n.z,l.x,l.y,F,I,B,R,w,d,p,m),r.length-1}function zv(r){r.collisionPadding&&(r.top-=r.collisionPadding[1],r.bottom+=r.collisionPadding[3]);let n=r.bottom-r.top;return n>0?Math.max(10,n):null}function wO(r,n,l,d){let p=r.compareText;if(n in p){let m=p[n];for(let y=m.length-1;y>=0;y--)if(d.dist(m[y])<l)return!0}else p[n]=[];return p[n].push(d),!1}function WT(r,n){let l=r.fovAboveCenter,d=r.elevation?r.elevation.getMinElevationBelowMSL()*n:0,p=(r._camera.position[2]*r.worldSize-d)/Math.cos(r._pitch),m=Math.sin(l)*p/Math.sin(Math.max(Math.PI/2-r._pitch-l,.01)),y=Math.sin(r._pitch)*m+p;return Math.min(1.01*y,p*(1/r._horizonShift))}function c2(r,n){if(!n.isReprojectedInTileSpace)return{scale:1<<r.z,x:r.x,y:r.y,x2:r.x+1,y2:r.y+1,projection:n};let l=Math.pow(2,-r.z),d=r.x*l,p=(r.x+1)*l,m=r.y*l,y=(r.y+1)*l,w=an(d),T=an(p),E=Wn(m),I=Wn(y),R=n.project(w,E),F=n.project(T,E),B=n.project(T,I),V=n.project(w,I),W=Math.min(R.x,F.x,B.x,V.x),$=Math.min(R.y,F.y,B.y,V.y),J=Math.max(R.x,F.x,B.x,V.x),le=Math.max(R.y,F.y,B.y,V.y),pe=l/16;function ue(xe,ke,Be,We,Ke,qe){let dt=(Be+Ke)/2,Mt=(We+qe)/2,rt=n.project(an(dt),Wn(Mt)),vt=Math.max(0,W-rt.x,$-rt.y,rt.x-J,rt.y-le);W=Math.min(W,rt.x),J=Math.max(J,rt.x),$=Math.min($,rt.y),le=Math.max(le,rt.y),vt>pe&&(ue(xe,rt,Be,We,dt,Mt),ue(rt,ke,dt,Mt,Ke,qe))}ue(R,F,d,m,p,m),ue(F,B,p,m,p,y),ue(B,V,p,y,d,y),ue(V,R,d,y,d,m),W-=pe,$-=pe,J+=pe,le+=pe;let Me=1/Math.max(J-W,le-$);return{scale:Me,x:W*Me,y:$*Me,x2:J*Me,y2:le*Me,projection:n}}function qT(r,{x:n,y:l},d=0){return new de(((n-d)*r.scale-r.x)*ii,(l*r.scale-r.y)*ii)}let SO=i.a6.identity(new Float32Array(16));class Eh{constructor(n){this.spec=n,this.name=n.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(n,l){return{x:0,y:0,z:0}}unproject(n,l){return new je(0,0)}projectTilePoint(n,l,d){return{x:n,y:l,z:0}}locationPoint(n,l,d=!0){return n._coordinatePoint(n.locationCoordinate(l),d)}pixelsPerMeter(n,l){return hn(1,n)*l}pixelSpaceConversion(n,l,d){return 1}farthestPixelDistance(n){return WT(n,n.pixelsPerMeter)}pointCoordinate(n,l,d,p){let m=n.horizonLineFromTop(!1),y=new de(l,Math.max(m,d));return n.rayIntersectionCoordinate(n.pointRayIntersection(y,p))}pointCoordinate3D(n,l,d){let p=new de(l,d);if(n.elevation)return n.elevation.pointCoordinate(p);{let m=this.pointCoordinate(n,p.x,p.y,0);return[m.x,m.y,m.z]}}isPointAboveHorizon(n,l){if(n.elevation)return!this.pointCoordinate3D(n,l.x,l.y);let d=n.horizonLineFromTop();return l.y<d}createInversionMatrix(n,l){return SO}createTileMatrix(n,l,d){let p,m,y,w=d.canonical,T=i.a6.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){let E=c2(w,this);p=1,m=E.x+d.wrap*E.scale,y=E.y,i.a6.scale(T,T,[p/E.scale,p/E.scale,n.pixelsPerMeter/l])}else p=l/n.zoomScale(w.z),m=(w.x+Math.pow(2,w.z)*d.wrap)*p,y=w.y*p;return i.a6.translate(T,T,[m,y,0]),i.a6.scale(T,T,[p/ii,p/ii,1]),T}upVector(n,l,d){return[0,0,1]}upVectorScale(n,l,d){return{metersToTile:1}}}class TO extends Eh{constructor(n){super(n),this.range=[4,7],this.center=n.center||[-96,37.5];let[l,d]=this.parallels=n.parallels||[29.5,45.5],p=Math.sin(De(l));this.n=(p+Math.sin(De(d)))/2,this.c=1+p*(2*this.n-p),this.r0=Math.sqrt(this.c)/this.n}project(n,l){let{n:d,c:p,r0:m}=this,y=De(n-this.center[0]),w=De(l),T=Math.sqrt(p-2*d*Math.sin(w))/d;return{x:T*Math.sin(y*d),y:T*Math.cos(y*d)-m,z:0}}unproject(n,l){let{n:d,c:p,r0:m}=this,y=m+l,w=Math.atan2(n,Math.abs(y))*Math.sign(y);y*d<0&&(w-=Math.PI*Math.sign(n)*Math.sign(y));let T=De(this.center[0])*d;w=Ot(w,-Math.PI-T,Math.PI-T);let E=Xe(se(w/d)+this.center[0],-180,180),I=Math.asin(Xe((p-(n*n+y*y)*d*d)/(2*d),-1,1)),R=Xe(se(I),-An,An);return new je(E,R)}}let h2=1.340264,d2=-.081106,u2=893e-6,p2=.003796,X4=Math.sqrt(3)/2;class MO extends Eh{project(n,l){l=l/180*Math.PI,n=n/180*Math.PI;let d=Math.asin(X4*Math.sin(l)),p=d*d,m=p*p*p;return{x:.5*(n*Math.cos(d)/(X4*(h2+3*d2*p+m*(7*u2+9*p2*p)))/Math.PI+.5),y:1-.5*(d*(h2+d2*p+m*(u2+p2*p))/Math.PI+1),z:0}}unproject(n,l){n=(2*n-.5)*Math.PI;let d=l=(2*(1-l)-1)*Math.PI,p=d*d,m=p*p*p;for(let I,R,F,B=0;B<12&&(R=d*(h2+d2*p+m*(u2+p2*p))-l,F=h2+3*d2*p+m*(7*u2+9*p2*p),I=R/F,d=Xe(d-I,-Math.PI/3,Math.PI/3),p=d*d,m=p*p*p,!(Math.abs(I)<1e-12));++B);let y=X4*n*(h2+3*d2*p+m*(7*u2+9*p2*p))/Math.cos(d),w=Math.asin(Math.sin(d)/X4),T=Xe(180*y/Math.PI,-180,180),E=Xe(180*w/Math.PI,-An,An);return new je(T,E)}}class EO extends Eh{constructor(n){super(n),this.wrap=!0,this.supportsWorldCopies=!0}project(n,l){return{x:.5+n/360,y:.5-l/360,z:0}}unproject(n,l){let d=360*(n-.5),p=Xe(360*(.5-l),-An,An);return new je(d,p)}}let Qp=Math.PI/2;function Z4(r){return Math.tan((Qp+r)/2)}class AO extends Eh{constructor(n){super(n),this.center=n.center||[0,30];let[l,d]=this.parallels=n.parallels||[30,30],p=De(l),m=De(d);this.southernCenter=p+m<0,this.southernCenter&&(p=-p,m=-m);let y=Math.cos(p),w=Z4(p);this.n=p===m?Math.sin(p):Math.log(y/Math.cos(m))/Math.log(Z4(m)/w),this.f=y*Math.pow(Z4(p),this.n)/this.n}project(n,l){l=De(l),this.southernCenter&&(l=-l),n=De(n-this.center[0]);let d=1e-6,{n:p,f:m}=this;m>0?l<-Qp+d&&(l=-Qp+d):l>Qp-d&&(l=Qp-d);let y=m/Math.pow(Z4(l),p),w=y*Math.sin(p*n),T=m-y*Math.cos(p*n);return w=.5*(w/Math.PI+.5),T=.5*(T/Math.PI+.5),{x:w,y:this.southernCenter?T:1-T,z:0}}unproject(n,l){n=(2*n-.5)*Math.PI,this.southernCenter&&(l=1-l),l=(2*(1-l)-.5)*Math.PI;let{n:d,f:p}=this,m=p-l,y=Math.sign(m),w=Math.sign(d)*Math.sqrt(n*n+m*m),T=Math.atan2(n,Math.abs(m))*y;m*d<0&&(T-=Math.PI*Math.sign(n)*y);let E=Xe(se(T/d)+this.center[0],-180,180),I=Xe(se(2*Math.atan(Math.pow(p/w,1/d))-Qp),-An,An);return new je(E,this.southernCenter?-I:I)}}class XT extends Eh{constructor(n){super(n),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(n,l){return{x:gn(n),y:Zi(l),z:0}}unproject(n,l){let d=an(n),p=Wn(l);return new je(d,p)}}let ZT=De(An);class CO extends Eh{project(n,l){let d=(l=De(l))*l,p=d*d;return{x:.5*((n=De(n))*(.8707-.131979*d+p*(p*(.003971*d-.001529*p)-.013791))/Math.PI+.5),y:1-.5*(l*(1.007226+d*(.015085+p*(.028874*d-.044475-.005916*p)))/Math.PI+1),z:0}}unproject(n,l){n=(2*n-.5)*Math.PI;let d=l=(2*(1-l)-1)*Math.PI,p=25,m=0,y=d*d;do{y=d*d;let E=y*y;m=(d*(1.007226+y*(.015085+E*(.028874*y-.044475-.005916*E)))-l)/(1.007226+y*(.045255+E*(.259866*y-.311325-.005916*11*E))),d=Xe(d-m,-ZT,ZT)}while(Math.abs(m)>1e-6&&--p>0);y=d*d;let w=Xe(se(n/(.8707+y*(y*(y*y*y*(.003971-.001529*y)-.013791)-.131979))),-180,180),T=se(d);return new je(w,T)}}let $T=De(An);class IO extends Eh{project(n,l){l=De(l),n=De(n);let d=Math.cos(l),p=2/Math.PI,m=Math.acos(d*Math.cos(n/2)),y=Math.sin(m)/m,w=.5*(n*p+2*d*Math.sin(n/2)/y)||0,T=.5*(l+Math.sin(l)/y)||0;return{x:.5*(w/Math.PI+.5),y:1-.5*(T/Math.PI+1),z:0}}unproject(n,l){let d=n=(2*n-.5)*Math.PI,p=l=(2*(1-l)-1)*Math.PI,m=25,y=1e-6,w=0,T=0;do{let E=Math.cos(p),I=Math.sin(p),R=2*I*E,F=I*I,B=E*E,V=Math.cos(d/2),W=Math.sin(d/2),$=2*V*W,J=W*W,le=1-B*V*V,pe=le?1/le:0,ue=le?Math.acos(E*V)*Math.sqrt(1/le):0,Me=.5*(2*ue*E*W+2*d/Math.PI)-n,xe=.5*(ue*I+p)-l,ke=.5*pe*(B*J+ue*E*V*F)+1/Math.PI,Be=pe*($*R/4-ue*I*W),We=.125*pe*(R*W-ue*I*B*$),Ke=.5*pe*(F*V+ue*J*E)+.5,qe=Be*We-Ke*ke;w=(xe*Be-Me*Ke)/qe,T=(Me*We-xe*ke)/qe,d=Xe(d-w,-Math.PI,Math.PI),p=Xe(p-T,-$T,$T)}while((Math.abs(w)>y||Math.abs(T)>y)&&--m>0);return new je(se(d),se(p))}}class YT extends Eh{constructor(n){super(n),this.center=n.center||[0,0],this.parallels=n.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(De(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(n,l){let{scale:d,cosPhi:p}=this;return{x:De(n)*p*d+.5,y:-Math.sin(De(l))/p*d+.5,z:0}}unproject(n,l){let{scale:d,cosPhi:p}=this,m=-(l-.5)/d,y=Xe(se((n-.5)/d)/p,-180,180),w=Math.asin(Xe(m*p,-1,1)),T=Xe(se(w),-An,An);return new je(y,T)}}class PO extends XT{constructor(n){super(n),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(n,l,d){let p=Jm(n,l,d),m=E4(Nc(d));return i.N.transformMat4(p,p,m),{x:p[0],y:p[1],z:p[2]}}locationPoint(n,l){let d=ot(l.lat,l.lng),p=i.N.normalize([],d),m=n.elevation?n.elevation.getAtPointOrZero(n.locationCoordinate(l),n._centerAltitude):n._centerAltitude,y=hn(1,0)*ii*m;i.N.scaleAndAdd(d,d,p,y);let w=i.a6.identity(new Float64Array(16));return i.a6.multiply(w,n.pixelMatrix,n.globeMatrix),i.N.transformMat4(d,d,w),new de(d[0],d[1])}pixelsPerMeter(n,l){return hn(1,0)*l}pixelSpaceConversion(n,l,d){let p=hn(1,n)*l,m=Tn(hn(1,45)*l,p,d);return this.pixelsPerMeter(n,l)/m}createTileMatrix(n,l,d){let p=fv(Nc(d.canonical));return i.a6.multiply(new Float64Array(16),n.globeMatrix,p)}createInversionMatrix(n,l){let{center:d}=n,p=E4(Nc(l));return i.a6.rotateY(p,p,De(d.lng)),i.a6.rotateX(p,p,De(d.lat)),i.a6.scale(p,p,[n._pixelsPerMercatorPixel,n._pixelsPerMercatorPixel,1]),Float32Array.from(p)}pointCoordinate(n,l,d,p){return pS(n,l,d,!0)||new Kn(0,0)}pointCoordinate3D(n,l,d){let p=this.pointCoordinate(n,l,d,0);return[p.x,p.y,p.z]}isPointAboveHorizon(n,l){return!pS(n,l.x,l.y,!1)}farthestPixelDistance(n){let l=function(p,m){let y=p.cameraToCenterDistance,w=p._centerAltitude*m,T=p._camera,E=p._camera.forward(),I=i.N.add([],i.N.scale([],E,-y),[0,0,w]),R=p.worldSize/(2*Math.PI),F=[0,0,-R],B=p.width/p.height,V=Math.tan(p.fovAboveCenter),W=i.N.scale([],T.up(),V),$=i.N.scale([],T.right(),V*B),J=i.N.normalize([],i.N.add([],i.N.add([],E,W),$)),le=[],pe;if(new cv(I,J).closestPointOnSphere(F,R,le)){let ue=i.N.add([],le,F),Me=i.N.sub([],ue,I);pe=Math.cos(p.fovAboveCenter)*i.N.length(Me)}else{let ue=i.N.sub([],I,F),Me=i.N.sub([],F,I);i.N.normalize(Me,Me);let xe=i.N.length(ue)-R;pe=Math.sqrt(xe*(xe+2*R));let ke=Math.acos(pe/(R+xe))-Math.acos(i.N.dot(E,Me));pe*=Math.cos(ke)}return 1.01*pe}(n,this.pixelsPerMeter(n.center.lat,n.worldSize)),d=xh(n.zoom);if(d>0){let p=WT(n,hn(1,n.center.lat)*n.worldSize),m=n.worldSize/(2*Math.PI),y=Math.max(n.width,n.height)/n.worldSize*Math.PI;return Tn(l,p+m*(1-Math.cos(y)),Math.pow(d,10))}return l}upVector(n,l,d){return Jm(l,d,n,1)}upVectorScale(n){return{metersToTile:S4(M4(Nc(n)))}}}function JT(r){let n=r.parallels,l=!!n&&Math.abs(n[0]+n[1])<.01;switch(r.name){case"mercator":return new XT(r);case"equirectangular":return new EO(r);case"naturalEarth":return new CO(r);case"equalEarth":return new MO(r);case"winkelTripel":return new IO(r);case"albers":return l?new YT(r):new TO(r);case"lambertConformalConic":return l?new YT(r):new AO(r);case"globe":return new PO(r)}throw new Error(`Invalid projection name: ${r.name}`)}let RO=D4.types,kO=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function $4(r,n,l,d,p,m,y,w,T,E,I,R,F){let B=w?Math.min(Mh,Math.round(w[0])):0,V=w?Math.min(Mh,Math.round(w[1])):0;r.emplaceBack(n,l,Math.round(32*d),Math.round(32*p),m,y,(B<<1)+(T?1:0),V,16*E,16*I,256*R,256*F)}function Y4(r,n,l){r.emplaceBack(n,l)}function J4(r,n,l,d,p,m,y){r.emplaceBack(n,l,d,p,m,y)}function K4(r,n,l,d,p){r.emplaceBack(n,l,d,p),r.emplaceBack(n,l,d,p),r.emplaceBack(n,l,d,p),r.emplaceBack(n,l,d,p)}function DO(r){for(let n of r.sections)if(bm(n.text))return!0;return!1}class Bv{constructor(n){this.layoutVertexArray=new eu,this.indexArray=new Us,this.programConfigurations=n,this.segments=new ls,this.dynamicLayoutVertexArray=new Pc,this.opacityVertexArray=new zm,this.placedSymbolArray=new r4,this.iconTransitioningVertexArray=new yl,this.globeExtVertexArray=new Nm,this.zOffsetVertexArray=new iu}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(n,l,d,p,m){this.isEmpty()||(d&&(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,VF.members),this.indexBuffer=n.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=n.createVertexBuffer(this.dynamicLayoutVertexArray,HF.members,!0),this.opacityVertexBuffer=n.createVertexBuffer(this.opacityVertexArray,kO,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=n.createVertexBuffer(this.iconTransitioningVertexArray,WF.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=n.createVertexBuffer(this.globeExtVertexArray,GF.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||m)&&(this.zOffsetVertexBuffer=n.createVertexBuffer(this.zOffsetVertexArray,jF.members,!0)),this.opacityVertexBuffer.itemSize=1),(d||p)&&this.programConfigurations.upload(n))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}hi(Bv,"SymbolBuffers");class Uv{constructor(n,l,d){this.layoutVertexArray=new n,this.layoutAttributes=l,this.indexArray=new d,this.segments=new ls,this.collisionVertexArray=new Um,this.collisionVertexArrayExt=new Pc}upload(n){this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=n.createVertexBuffer(this.collisionVertexArray,qF.members,!0),this.collisionVertexBufferExt=n.createVertexBuffer(this.collisionVertexArrayExt,XF.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}hi(Uv,"CollisionBuffers");class Q4{constructor(n){this.collisionBoxArray=n.collisionBoxArray,this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(y=>y.fqid),this.index=n.index,this.pixelRatio=n.pixelRatio,this.sourceLayerIndex=n.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=i.a6.identity([]),this.placementViewportMatrix=i.a6.identity([]);let l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Iv(this.zoom,l["text-size"]),this.iconSizeData=Iv(this.zoom,l["icon-size"]);let d=this.layers[0].layout,p=d.get("symbol-sort-key"),m=d.get("symbol-z-order");this.canOverlap=d.get("text-allow-overlap")||d.get("icon-allow-overlap")||d.get("text-ignore-placement")||d.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&p.constantOr(1)!==void 0,this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=d.get("text-writing-mode").map(y=>Ka[y]),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=n.sourceID,this.projection=n.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=d.get("symbol-z-elevate")}createArrays(){this.text=new Bv(new Q(this.layers,this.zoom,n=>/^text/.test(n))),this.icon=new Bv(new Q(this.layers,this.zoom,n=>/^icon/.test(n))),this.glyphOffsetArray=new a4,this.lineVertexArray=new ou,this.symbolInstances=new o4}calculateGlyphDependencies(n,l,d,p,m){for(let y=0;y<n.length;y++){let w=n.codePointAt(y);if(w===void 0)break;if(l[w]=!0,p&&m&&w<=65535){let T=s2[n.charAt(y)];T&&(l[T.charCodeAt(0)]=!0)}}}populate(n,l,d,p){let m=this.layers[0],y=m.layout,w=this.projection.name==="globe",T=y.get("text-font"),E=y.get("text-field"),I=y.get("icon-image"),R=(E.value.kind!=="constant"||E.value.value instanceof ro&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&(T.value.kind!=="constant"||T.value.value.length>0),F=I.value.kind!=="constant"||!!I.value.value||Object.keys(I.parameters).length>0,B=y.get("symbol-sort-key");if(this.features=[],!R&&!F)return;let V=l.iconDependencies,W=l.glyphDependencies,$=l.availableImages,J=new Yr(this.zoom);for(let{feature:le,id:pe,index:ue,sourceLayerIndex:Me}of n){let xe=m._featureFilter.needGeometry,ke=Rs(le,xe);if(!m._featureFilter.filter(J,ke,d))continue;if(xe||(ke.geometry=Gs(le,d,p)),w&&le.type!==1&&d.z<=5){let qe=ke.geometry,dt=.98078528056,Mt=(rt,vt)=>{let it=Jm(rt.x,rt.y,d,1),yt=Jm(vt.x,vt.y,d,1);return i.N.dot(it,yt)<dt};for(let rt=0;rt<qe.length;rt++)qe[rt]=oo(qe[rt],Mt)}let Be,We;if(R){let qe=m.getValueAndResolveTokens("text-field",ke,d,$),dt=ro.factory(qe);DO(dt)&&(this.hasRTLText=!0),(!this.hasRTLText||Ic()==="unavailable"||this.hasRTLText&&sa.isParsed())&&(Be=YF(dt,m,ke))}if(F){let qe=m.getValueAndResolveTokens("icon-image",ke,d,$);We=qe instanceof Di?qe:Di.fromString(qe)}if(!Be&&!We)continue;let Ke=this.sortFeaturesByKey?B.evaluate(ke,{},d):void 0;if(this.features.push({id:pe,text:Be,icon:We,index:ue,sourceLayerIndex:Me,geometry:ke.geometry,properties:le.properties,type:RO[le.type],sortKey:Ke}),We&&(V[We.namePrimary]=!0,We.nameSecondary&&(V[We.nameSecondary]=!0)),Be){let qe=T.evaluate(ke,{},d).join(","),dt=y.get("text-rotation-alignment")==="map"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ka.vertical)>=0;for(let Mt of Be.sections)if(Mt.image)V[Mt.image.namePrimary]=!0;else{let rt=Ac(Be.toString()),vt=Mt.fontStack||qe,it=W[vt]=W[vt]||{};this.calculateGlyphDependencies(Mt.text,it,dt,this.allowVerticalPlacement,rt)}}}y.get("symbol-placement")==="line"&&(this.features=function(le){let pe={},ue={},Me=[],xe=0;function ke(qe){Me.push(le[qe]),xe++}function Be(qe,dt,Mt){let rt=ue[qe];return delete ue[qe],ue[dt]=rt,Me[rt].geometry[0].pop(),Me[rt].geometry[0]=Me[rt].geometry[0].concat(Mt[0]),rt}function We(qe,dt,Mt){let rt=pe[dt];return delete pe[dt],pe[qe]=rt,Me[rt].geometry[0].shift(),Me[rt].geometry[0]=Mt[0].concat(Me[rt].geometry[0]),rt}function Ke(qe,dt,Mt){let rt=Mt?dt[0][dt[0].length-1]:dt[0][0];return`${qe}:${rt.x}:${rt.y}`}for(let qe=0;qe<le.length;qe++){let dt=le[qe],Mt=dt.geometry,rt=dt.text?dt.text.toString():null;if(!rt){ke(qe);continue}let vt=Ke(rt,Mt),it=Ke(rt,Mt,!0);if(vt in ue&&it in pe&&ue[vt]!==pe[it]){let yt=We(vt,it,Mt),Xt=Be(vt,it,Me[yt].geometry);delete pe[vt],delete ue[it],ue[Ke(rt,Me[Xt].geometry,!0)]=Xt,Me[yt].geometry=null}else vt in ue?Be(vt,it,Mt):it in pe?We(vt,it,Mt):(ke(qe),pe[vt]=xe-1,ue[it]=xe-1)}return Me.filter(qe=>qe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((le,pe)=>le.sortKey-pe.sortKey)}update(n,l,d,p,m){let y=Object.keys(n).length!==0;if(y&&!this.stateDependentLayers.length)return;let w=y?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(n,l,w,d,p,m),this.icon.programConfigurations.updatePaintArrays(n,l,w,d,p,m)}updateZOffset(){let n=(m,y,w)=>{d+=y,d>m.length&&m.resize(d);for(let T=-y;T<0;T++)m.emplace(T+d,w)},l=(m,y,w)=>{p+=y,p>m.length&&m.resize(p);for(let T=-y;T<0;T++)m.emplace(T+p,w)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let d=0,p=0;for(let m=0;m<this.symbolInstances.length;m++){let y=this.symbolInstances.get(m),{numHorizontalGlyphVertices:w,numVerticalGlyphVertices:T,numIconVertices:E}=y,I=y.zOffset,R=E>0;if((w>0||T>0)&&(n(this.text.zOffsetVertexArray,w,I),n(this.text.zOffsetVertexArray,T,I)),R){let{placedIconSymbolIndex:F,verticalPlacedIconSymbolIndex:B}=y;F>=0&&l(this.icon.zOffsetVertexArray,E,I),B>=0&&l(this.icon.zOffsetVertexArray,y.numVerticalIconVertices,I)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(n){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(n),this.iconCollisionBox.upload(n)),this.text.upload(n,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(n,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=JT(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(n,l){let d=this.lineVertexArray.length;if(n.segment!==void 0)for(let{x:p,y:m}of l)this.lineVertexArray.emplaceBack(p,m);return{lineStartIndex:d,lineLength:this.lineVertexArray.length-d}}addSymbols(n,l,d,p,m,y,w,T,E,I,R,F,B,V,W,$){let J=n.indexArray,le=n.layoutVertexArray,pe=n.globeExtVertexArray,ue=n.segments.prepareSegment(4*l.length,le,J,this.canOverlap?y.sortKey:void 0),Me=this.glyphOffsetArray.length,xe=ue.vertexLength,ke=this.allowVerticalPlacement&&w===Ka.vertical?Math.PI/2:0,Be=y.text&&y.text.sections;for(let Ke=0;Ke<l.length;Ke++){let{tl:qe,tr:dt,bl:Mt,br:rt,texPrimary:vt,texSecondary:it,pixelOffsetTL:yt,pixelOffsetBR:Xt,minFontScaleX:At,minFontScaleY:fi,glyphOffset:oi,isSDF:Lt,sectionIndex:Ni}=l[Ke],wi=ue.vertexLength,pi=oi[1];if($4(le,E.x,E.y,qe.x,pi+qe.y,vt.x,vt.y,d,Lt,yt.x,yt.y,At,fi),$4(le,E.x,E.y,dt.x,pi+dt.y,vt.x+vt.w,vt.y,d,Lt,Xt.x,yt.y,At,fi),$4(le,E.x,E.y,Mt.x,pi+Mt.y,vt.x,vt.y+vt.h,d,Lt,yt.x,Xt.y,At,fi),$4(le,E.x,E.y,rt.x,pi+rt.y,vt.x+vt.w,vt.y+vt.h,d,Lt,Xt.x,Xt.y,At,fi),T){let{x:Ft,y:Ci,z:xn}=T.anchor,[Hi,bn,nn]=T.up;J4(pe,Ft,Ci,xn,Hi,bn,nn),J4(pe,Ft,Ci,xn,Hi,bn,nn),J4(pe,Ft,Ci,xn,Hi,bn,nn),J4(pe,Ft,Ci,xn,Hi,bn,nn),K4(n.dynamicLayoutVertexArray,Ft,Ci,xn,ke)}else K4(n.dynamicLayoutVertexArray,E.x,E.y,E.z,ke);if($){let Ft=it||vt;Y4(n.iconTransitioningVertexArray,Ft.x,Ft.y),Y4(n.iconTransitioningVertexArray,Ft.x+Ft.w,Ft.y),Y4(n.iconTransitioningVertexArray,Ft.x,Ft.y+Ft.h),Y4(n.iconTransitioningVertexArray,Ft.x+Ft.w,Ft.y+Ft.h)}J.emplaceBack(wi,wi+1,wi+2),J.emplaceBack(wi+1,wi+2,wi+3),ue.vertexLength+=4,ue.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(oi[0]),Ke!==l.length-1&&Ni===l[Ke+1].sectionIndex||n.programConfigurations.populatePaintArrays(le.length,y,y.index,{},B,V,W,Be&&Be[Ni])}let We=T?T.anchor:E;n.placedSymbolArray.emplaceBack(We.x,We.y,We.z,E.x,E.y,Me,this.glyphOffsetArray.length-Me,xe,I,R,E.segment,d?d[0]:0,d?d[1]:0,p[0],p[1],w,0,!1,0,F,0)}_commitLayoutVertex(n,l,d,p,m,y,w){n.emplaceBack(l,d,p,m,y,Math.round(w.x),Math.round(w.y))}_addCollisionDebugVertices(n,l,d,p,m,y,w){let T=d.segments.prepareSegment(4,d.layoutVertexArray,d.indexArray),E=T.vertexLength,I=w.tileAnchorX,R=w.tileAnchorY;for(let B=0;B<4;B++)d.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(d.collisionVertexArrayExt,l,n.padding,w.zOffset),this._commitLayoutVertex(d.layoutVertexArray,p,m,y,I,R,new de(n.x1,n.y1)),this._commitLayoutVertex(d.layoutVertexArray,p,m,y,I,R,new de(n.x2,n.y1)),this._commitLayoutVertex(d.layoutVertexArray,p,m,y,I,R,new de(n.x2,n.y2)),this._commitLayoutVertex(d.layoutVertexArray,p,m,y,I,R,new de(n.x1,n.y2)),T.vertexLength+=4;let F=d.indexArray;F.emplaceBack(E,E+1),F.emplaceBack(E+1,E+2),F.emplaceBack(E+2,E+3),F.emplaceBack(E+3,E),T.primitiveLength+=4}_addTextDebugCollisionBoxes(n,l,d,p,m,y){for(let w=p;w<m;w++){let T=d.get(w),E=this.getSymbolInstanceTextSize(n,y,l,w);this._addCollisionDebugVertices(T,E,this.textCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,y)}}_addIconDebugCollisionBoxes(n,l,d,p,m,y){for(let w=p;w<m;w++){let T=d.get(w),E=this.getSymbolInstanceIconSize(n,l,y.placedIconSymbolIndex);this._addCollisionDebugVertices(T,E,this.iconCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,y)}}generateCollisionDebugBuffers(n,l){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Uv(tu,_T.members,yl),this.iconCollisionBox=new Uv(tu,_T.members,yl);let d=qp(this.iconSizeData,n),p=qp(this.textSizeData,n);for(let m=0;m<this.symbolInstances.length;m++){let y=this.symbolInstances.get(m);this._addTextDebugCollisionBoxes(p,n,l,y.textBoxStartIndex,y.textBoxEndIndex,y),this._addTextDebugCollisionBoxes(p,n,l,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._addIconDebugCollisionBoxes(d,n,l,y.iconBoxStartIndex,y.iconBoxEndIndex,y),this._addIconDebugCollisionBoxes(d,n,l,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y)}}getSymbolInstanceTextSize(n,l,d,p){let m=this.text.placedSymbolArray.get(l.rightJustifiedTextSymbolIndex>=0?l.rightJustifiedTextSymbolIndex:l.centerJustifiedTextSymbolIndex>=0?l.centerJustifiedTextSymbolIndex:l.leftJustifiedTextSymbolIndex>=0?l.leftJustifiedTextSymbolIndex:l.verticalPlacedTextSymbolIndex>=0?l.verticalPlacedTextSymbolIndex:p),y=B4(this.textSizeData,n,m)/mo;return this.tilePixelRatio*y}getSymbolInstanceIconSize(n,l,d){let p=this.icon.placedSymbolArray.get(d),m=B4(this.iconSizeData,n,p);return this.tilePixelRatio*m}_commitDebugCollisionVertexUpdate(n,l,d,p){n.emplaceBack(l,-d,-d,p),n.emplaceBack(l,d,-d,p),n.emplaceBack(l,d,d,p),n.emplaceBack(l,-d,d,p)}_updateTextDebugCollisionBoxes(n,l,d,p,m,y){for(let w=p;w<m;w++){let T=d.get(w),E=this.getSymbolInstanceTextSize(n,y,l,w);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,E,T.padding,y.zOffset)}}_updateIconDebugCollisionBoxes(n,l,d,p,m,y){for(let w=p;w<m;w++){let T=d.get(w),E=this.getSymbolInstanceIconSize(n,l,y.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,E,T.padding,y.zOffset)}}updateCollisionDebugBuffers(n,l){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();let d=qp(this.iconSizeData,n),p=qp(this.textSizeData,n);for(let m=0;m<this.symbolInstances.length;m++){let y=this.symbolInstances.get(m);this._updateTextDebugCollisionBoxes(p,n,l,y.textBoxStartIndex,y.textBoxEndIndex,y),this._updateTextDebugCollisionBoxes(p,n,l,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._updateIconDebugCollisionBoxes(d,n,l,y.iconBoxStartIndex,y.iconBoxEndIndex,y),this._updateIconDebugCollisionBoxes(d,n,l,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(n,l,d,p,m,y,w,T,E){let I={};if(l<d){let{x1:R,y1:F,x2:B,y2:V,padding:W,projectedAnchorX:$,projectedAnchorY:J,projectedAnchorZ:le,tileAnchorX:pe,tileAnchorY:ue,featureIndex:Me}=n.get(l);I.textBox={x1:R,y1:F,x2:B,y2:V,padding:W,projectedAnchorX:$,projectedAnchorY:J,projectedAnchorZ:le,tileAnchorX:pe,tileAnchorY:ue},I.textFeatureIndex=Me}if(p<m){let{x1:R,y1:F,x2:B,y2:V,padding:W,projectedAnchorX:$,projectedAnchorY:J,projectedAnchorZ:le,tileAnchorX:pe,tileAnchorY:ue,featureIndex:Me}=n.get(p);I.verticalTextBox={x1:R,y1:F,x2:B,y2:V,padding:W,projectedAnchorX:$,projectedAnchorY:J,projectedAnchorZ:le,tileAnchorX:pe,tileAnchorY:ue},I.verticalTextFeatureIndex=Me}if(y<w){let{x1:R,y1:F,x2:B,y2:V,padding:W,projectedAnchorX:$,projectedAnchorY:J,projectedAnchorZ:le,tileAnchorX:pe,tileAnchorY:ue,featureIndex:Me}=n.get(y);I.iconBox={x1:R,y1:F,x2:B,y2:V,padding:W,projectedAnchorX:$,projectedAnchorY:J,projectedAnchorZ:le,tileAnchorX:pe,tileAnchorY:ue},I.iconFeatureIndex=Me}if(T<E){let{x1:R,y1:F,x2:B,y2:V,padding:W,projectedAnchorX:$,projectedAnchorY:J,projectedAnchorZ:le,tileAnchorX:pe,tileAnchorY:ue,featureIndex:Me}=n.get(T);I.verticalIconBox={x1:R,y1:F,x2:B,y2:V,padding:W,projectedAnchorX:$,projectedAnchorY:J,projectedAnchorZ:le,tileAnchorX:pe,tileAnchorY:ue},I.verticalIconFeatureIndex=Me}return I}deserializeCollisionBoxes(n){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){let d=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(n,d.textBoxStartIndex,d.textBoxEndIndex,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d.iconBoxStartIndex,d.iconBoxEndIndex,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(n,l){let d=n.placedSymbolArray.get(l),p=d.vertexStartIndex+4*d.numGlyphs;for(let m=d.vertexStartIndex;m<p;m+=4)n.indexArray.emplaceBack(m,m+1,m+2),n.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(n){if(this.sortedAngle===n&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let l=Math.sin(n),d=Math.cos(n),p=[],m=[],y=[];for(let w=0;w<this.symbolInstances.length;++w){y.push(w);let T=this.symbolInstances.get(w);p.push(0|Math.round(l*T.tileAnchorX+d*T.tileAnchorY)),m.push(T.featureIndex)}return y.sort((w,T)=>p[w]-p[T]||m[T]-m[w]),y}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let n=0;n<this.symbolInstances.length;++n)this.symbolInstanceIndexesSortedZOffset.push(n)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((n,l)=>this.symbolInstances.get(l).zOffset-this.symbolInstances.get(n).zOffset)}addToSortKeyRanges(n,l){let d=this.sortKeyRanges[this.sortKeyRanges.length-1];d&&d.sortKey===l?d.symbolInstanceEnd=n+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:n,symbolInstanceEnd:n+1})}sortFeatures(n){if(this.sortFeaturesByY&&this.sortedAngle!==n&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(n),this.sortedAngle=n,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let l of this.symbolInstanceIndexes){let d=this.symbolInstances.get(l);this.featureSortOrder.push(d.featureIndex);let{rightJustifiedTextSymbolIndex:p,centerJustifiedTextSymbolIndex:m,leftJustifiedTextSymbolIndex:y,verticalPlacedTextSymbolIndex:w,placedIconSymbolIndex:T,verticalPlacedIconSymbolIndex:E}=d;p>=0&&this.addIndicesForPlacedSymbol(this.text,p),m>=0&&m!==p&&this.addIndicesForPlacedSymbol(this.text,m),y>=0&&y!==m&&y!==p&&this.addIndicesForPlacedSymbol(this.text,y),w>=0&&this.addIndicesForPlacedSymbol(this.text,w),T>=0&&this.addIndicesForPlacedSymbol(this.icon,T),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}hi(Q4,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Q4.addDynamicAttributes=K4;let LO=new Jr({"symbol-placement":new qt($e.layout_symbol["symbol-placement"]),"symbol-spacing":new qt($e.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new qt($e.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ai($e.layout_symbol["symbol-sort-key"]),"symbol-z-order":new qt($e.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new qt($e.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new qt($e.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new qt($e.layout_symbol["icon-ignore-placement"]),"icon-optional":new qt($e.layout_symbol["icon-optional"]),"icon-rotation-alignment":new qt($e.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ai($e.layout_symbol["icon-size"]),"icon-text-fit":new Ai($e.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ai($e.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ai($e.layout_symbol["icon-image"]),"icon-rotate":new Ai($e.layout_symbol["icon-rotate"]),"icon-padding":new qt($e.layout_symbol["icon-padding"]),"icon-keep-upright":new qt($e.layout_symbol["icon-keep-upright"]),"icon-offset":new Ai($e.layout_symbol["icon-offset"]),"icon-anchor":new Ai($e.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new qt($e.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new qt($e.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new qt($e.layout_symbol["text-rotation-alignment"]),"text-field":new Ai($e.layout_symbol["text-field"]),"text-font":new Ai($e.layout_symbol["text-font"]),"text-size":new Ai($e.layout_symbol["text-size"]),"text-max-width":new Ai($e.layout_symbol["text-max-width"]),"text-line-height":new Ai($e.layout_symbol["text-line-height"]),"text-letter-spacing":new Ai($e.layout_symbol["text-letter-spacing"]),"text-justify":new Ai($e.layout_symbol["text-justify"]),"text-radial-offset":new Ai($e.layout_symbol["text-radial-offset"]),"text-variable-anchor":new qt($e.layout_symbol["text-variable-anchor"]),"text-anchor":new Ai($e.layout_symbol["text-anchor"]),"text-max-angle":new qt($e.layout_symbol["text-max-angle"]),"text-writing-mode":new qt($e.layout_symbol["text-writing-mode"]),"text-rotate":new Ai($e.layout_symbol["text-rotate"]),"text-padding":new qt($e.layout_symbol["text-padding"]),"text-keep-upright":new qt($e.layout_symbol["text-keep-upright"]),"text-transform":new Ai($e.layout_symbol["text-transform"]),"text-offset":new Ai($e.layout_symbol["text-offset"]),"text-allow-overlap":new qt($e.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new qt($e.layout_symbol["text-ignore-placement"]),"text-optional":new qt($e.layout_symbol["text-optional"]),visibility:new qt($e.layout_symbol.visibility)});var Vv={paint:new Jr({"icon-opacity":new Ai($e.paint_symbol["icon-opacity"]),"icon-emissive-strength":new Ai($e.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Ai($e.paint_symbol["text-emissive-strength"]),"icon-color":new Ai($e.paint_symbol["icon-color"]),"icon-halo-color":new Ai($e.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ai($e.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ai($e.paint_symbol["icon-halo-blur"]),"icon-translate":new qt($e.paint_symbol["icon-translate"]),"icon-translate-anchor":new qt($e.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Ai($e.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Ai($e.paint_symbol["text-opacity"]),"text-color":new Ai($e.paint_symbol["text-color"],{runtimeType:Sa,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new Ai($e.paint_symbol["text-halo-color"]),"text-halo-width":new Ai($e.paint_symbol["text-halo-width"]),"text-halo-blur":new Ai($e.paint_symbol["text-halo-blur"]),"text-translate":new qt($e.paint_symbol["text-translate"]),"text-translate-anchor":new qt($e.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new qt($e.paint_symbol["icon-color-saturation"])}),layout:LO};class KT{constructor(n){this.type=n.property.overrides?n.property.overrides.runtimeType:$0,this.defaultValue=n}evaluate(n){if(n.formattedSection){let l=this.defaultValue.property.overrides;if(l&&l.hasOverride(n.formattedSection))return l.getOverride(n.formattedSection)}return n.feature&&n.featureState?this.defaultValue.evaluate(n.feature,n.featureState):this.defaultValue.property.specification.default}eachChild(n){this.defaultValue.isConstant()||n(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}hi(KT,"FormatSectionOverride",{omit:["defaultValue"]});class e5 extends Wo{constructor(n,l,d){super(n,Vv,l,d)}recalculate(n,l){super.recalculate(n,l),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));let d=this.layout.get("text-writing-mode");if(d){let p=[];for(let m of d)p.indexOf(m)<0&&p.push(m);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(n,l,d,p){let m=this.layout.get(n).evaluate(l,{},d,p),y=this._unevaluatedLayout._values[n];return y.isDataDriven()||Vd(y.value)||!m?m:function(w,T){return T.replace(/{([^{}]+)}/g,(E,I)=>I in w?String(w[I]):"")}(l.properties,m)}createBucket(n){return new Q4(n)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(let n of Vv.paint.overridableProperties){if(!e5.hasPaintOverride(this.layout,n))continue;let l=this.paint.get(n),d=new KT(l),p=new Ep(d,l.property.specification,this.scope,this.options),m=null;m=l.value.kind==="constant"||l.value.kind==="source"?new vm("source",p):new Gd("composite",p,l.value.zoomStops,l.value._interpolationType),this.paint._values[n]=new fh(l.property,m,l.parameters)}}_handleOverridablePaintPropertyUpdate(n,l,d){return!(!this.layout||l.isDataDriven()||d.isDataDriven())&&e5.hasPaintOverride(this.layout,n)}static hasPaintOverride(n,l){let d=n.get("text-field"),p=Vv.paint.properties[l],m=!1,y=w=>{for(let T of w)if(p.overrides&&p.overrides.hasOverride(T))return void(m=!0)};if(d.value.kind==="constant"&&d.value.value instanceof ro)y(d.value.value.sections);else if(d.value.kind==="source"){let w=E=>{m||(E instanceof kl&&Is(E.value)===J0?y(E.value.sections):E instanceof Q0?y(E.sections):E.eachChild(w))},T=d.value;T._styleExpression&&w(T._styleExpression.expression)}return m}getProgramIds(){let n=this.paint.get("icon-opacity").constantOr(1)!==0,l=this.paint.get("text-opacity").constantOr(1)!==0,d=[];return n&&d.push("symbolIcon"),l&&d.push("symbolSDF"),d}getDefaultProgramParams(n,l){return{config:new X(this,l),overrideFog:!1}}}let FO=new Jr({visibility:new qt($e.layout_background.visibility)});var OO={paint:new Jr({"background-color":new qt($e.paint_background["background-color"]),"background-pattern":new qt($e.paint_background["background-pattern"]),"background-opacity":new qt($e.paint_background["background-opacity"]),"background-emissive-strength":new qt($e.paint_background["background-emissive-strength"])}),layout:FO};let NO=new Jr({visibility:new qt($e.layout_raster.visibility)});var zO={paint:new Jr({"raster-opacity":new qt($e.paint_raster["raster-opacity"]),"raster-color":new _0($e.paint_raster["raster-color"]),"raster-color-mix":new qt($e.paint_raster["raster-color-mix"]),"raster-color-range":new qt($e.paint_raster["raster-color-range"]),"raster-hue-rotate":new qt($e.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new qt($e.paint_raster["raster-brightness-min"]),"raster-brightness-max":new qt($e.paint_raster["raster-brightness-max"]),"raster-saturation":new qt($e.paint_raster["raster-saturation"]),"raster-contrast":new qt($e.paint_raster["raster-contrast"]),"raster-resampling":new qt($e.paint_raster["raster-resampling"]),"raster-fade-duration":new qt($e.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new qt($e.paint_raster["raster-emissive-strength"]),"raster-array-band":new qt($e.paint_raster["raster-array-band"]),"raster-elevation":new qt($e.paint_raster["raster-elevation"])}),layout:NO},Gv=gr([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Hv{constructor(n,l,d,p){this.context=n,this.format=d,this.texture=n.gl.createTexture(),this.update(l,p)}update(n,l,d){let{width:p,height:m}=n,{context:y}=this,{gl:w}=y;if(w.bindTexture(w.TEXTURE_2D,this.texture),y.pixelStoreUnpackFlipY.set(!1),y.pixelStoreUnpack.set(1),y.pixelStoreUnpackPremultiplyAlpha.set(this.format===w.RGBA&&(!l||l.premultiply!==!1)),d||this.size&&this.size[0]===p&&this.size[1]===m){let{x:T,y:E}=d||{x:0,y:0};if(n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageData||ImageBitmap&&n instanceof ImageBitmap)w.texSubImage2D(w.TEXTURE_2D,0,T,E,w.RGBA,w.UNSIGNED_BYTE,n);else{let I=this.format,R=w.UNSIGNED_BYTE;this.format===w.R32F&&(I=w.RED,R=w.FLOAT),w.texSubImage2D(w.TEXTURE_2D,0,T,E,p,m,I,R,n.data)}}else if(this.size=[p,m],n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageData||ImageBitmap&&n instanceof ImageBitmap){let T=this.format;this.format===w.R8&&(T=w.RED),w.texImage2D(w.TEXTURE_2D,0,this.format,T,w.UNSIGNED_BYTE,n)}else{let T=this.format,E=this.format,I=w.UNSIGNED_BYTE;this.format===w.DEPTH_COMPONENT&&(T=w.DEPTH_COMPONENT16,I=w.UNSIGNED_SHORT),this.format===w.R8&&(E=w.RED),this.format===w.R32F&&(I=w.FLOAT,E=w.RED),w.texImage2D(w.TEXTURE_2D,0,T,p,m,0,E,I,n.data)}this.useMipmap=!!(l&&l.useMipmap),this.useMipmap&&w.generateMipmap(w.TEXTURE_2D)}bind(n,l,d=!1){let{context:p}=this,{gl:m}=p;m.bindTexture(m.TEXTURE_2D,this.texture),n!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,n),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,this.useMipmap&&!d?n===m.NEAREST?m.NEAREST_MIPMAP_NEAREST:m.LINEAR_MIPMAP_LINEAR:n),this.minFilter=n),l!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,l),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,l),this.wrapS=l)}bindExtraParam(n,l,d,p){let{context:m}=this,{gl:y}=m;y.bindTexture(y.TEXTURE_2D,this.texture),l!==this.magFilter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,l),this.magFilter=l),n!==this.minFilter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,this.useMipmap?n===y.NEAREST?y.NEAREST_MIPMAP_NEAREST:y.LINEAR_MIPMAP_LINEAR:n),this.minFilter=n),d!==this.wrapS&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,d),this.wrapS=d),p!==this.wrapT&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,p),this.wrapT=p)}destroy(){let{gl:n}=this.context;n.deleteTexture(this.texture),this.texture=null}}class t5{constructor(n,l){this.context=n,this.texture=l}bind(n,l){let{context:d}=this,{gl:p}=d;p.bindTexture(p.TEXTURE_2D,this.texture),n!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,n),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,n),this.minFilter=n),l!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,l),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,l),this.wrapS=l)}}function i5(r,n,l,d,p,m,y,w){let T=[r,n,1,l,d,1,p,m,1],E=[y,w,1],I=i.co.adjoint([],T),[R,F,B]=i.N.transformMat3(E,E,I);return i.co.multiply(T,T,[R,0,0,0,F,0,0,0,B])}function QT(r,n,l,d,p,m,y,w){let T=function(E,I,R,F,B,V,W,$){let J=i5(0,0,1,0,1,1,0,1),le=i5(E,I,R,F,B,V,W,$),pe=i.co.adjoint([],J);return i.co.multiply(le,le,pe)}(r,n,l,d,p,m,y,w);return[T[2]/T[8]/ii,T[5]/T[8]/ii]}function n5(r){return[r[0],Math.min(Math.max(r[1],-An),An)]}class eM extends So{constructor(n,l,d,p){super(),this.id=n,this.dispatcher=d,this.coordinates=l.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(p),this.options=l,this._dirty=!1}load(n,l){if(this._loaded=l||!1,this.fire(new Ls("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return n&&(this.coordinates=n),this._loaded=!0,void this._finishLoading();this._imageRequest=Kt(this.map._requestManager.transformRequest(this.url,fr.Image),(d,p)=>{this._imageRequest=null,this._loaded=!0,d?this.fire(new Cs(d)):p&&(this.image=p instanceof HTMLImageElement?at.getImageData(p):p,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,n&&(this.coordinates=n),this._finishLoading())})}loaded(){return this._loaded}updateImage(n){return n.url?(this._imageRequest&&n.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=n.url,this.load(n.coordinates,this._loaded),this):this}setTexture(n){if(!(n.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new t5(this.map.painter.context,n.handle),this.width=n.dimensions[0],this.height=n.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Ls("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof t5||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(n){if(this.coordinates=n,this._boundsArray=void 0,this._unsupportedCoords=!1,!n.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let l=n[0][1],d=n[0][1];for(let m of n)m[1]>d&&(d=m[1]),m[1]<l&&(l=m[1]);let p=(d+l)/2;if(p>An?this.onNorthPole=!0:p<-An&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){let m=n.map(Kn.fromLngLat);this.tileID=function(y){let w=1/0,T=1/0,E=-1/0,I=-1/0;for(let W of y)w=Math.min(w,W.x),T=Math.min(T,W.y),E=Math.max(E,W.x),I=Math.max(I,W.y);let R=Math.max(E-w,I-T),F=Math.max(0,Math.floor(-Math.log(R)/Math.LN2)),B=Math.pow(2,F),V=Math.floor((w+E)/2*B);return V>1&&(V-=1),new Dt(F,V,Math.floor((T+I)/2*B))}(m),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Ls("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(n){for(let J in this.tiles){let le=this.tiles[J];le.state!=="loaded"&&(le.state="loaded",le.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;let l=c2(new Dt(0,0,0),this.map.transform.projection),d=[l.projection.project(this.coordinates[0][0],this.coordinates[0][1]),l.projection.project(this.coordinates[1][0],this.coordinates[1][1]),l.projection.project(this.coordinates[2][0],this.coordinates[2][1]),l.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(J){let le=J[1].x-J[0].x,pe=J[1].y-J[0].y,ue=J[2].x-J[1].x,Me=J[2].y-J[1].y,xe=J[3].x-J[2].x,ke=J[3].y-J[2].y,Be=J[0].x-J[3].x,We=J[0].y-J[3].y,Ke=le*Me-ue*pe,qe=ue*ke-xe*Me,dt=xe*We-Be*ke,Mt=Be*pe-le*We;return Ke>0&&qe>0&&dt>0&&Mt>0||Ke<0&&qe<0&&dt<0&&Mt<0}(d))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);let p=c2(this.tileID,this.map.transform.projection),[m,y,w,T]=this.coordinates.map(J=>{let le=p.projection.project(J[0],J[1]);return qT(p,le)._round()});this.perspectiveTransform=QT(m.x,m.y,y.x,y.y,w.x,w.y,T.x,T.y);let E=this._boundsArray=new zl;E.emplaceBack(m.x,m.y,0,0),E.emplaceBack(y.x,y.y,ii,0),E.emplaceBack(T.x,T.y,0,ii),E.emplaceBack(w.x,w.y,ii,ii),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=n.createVertexBuffer(E,Gv.members),this.boundsSegments=ls.simpleSegment(0,0,4,2);let I=[],R=[n5((F=this.coordinates)[0]),n5(F[1]),n5(F[2]),n5(F[3])];var F;let[B,V,W,$]=function(J){let le=J[0][0],pe=le,ue=J[0][1],Me=ue;for(let xe=1;xe<J.length;xe++)J[xe][0]<le?le=J[xe][0]:J[xe][0]>pe&&(pe=J[xe][0]),J[xe][1]<ue?ue=J[xe][1]:J[xe][1]>Me&&(Me=J[xe][1]);return[le,ue,pe-le,Me-ue]}(R);{let J=new zl,[le,pe,ue,Me]=function(yt){let Xt=yt[0].x,At=Xt,fi=yt[0].y,oi=fi;for(let Lt=1;Lt<yt.length;Lt++)yt[Lt].x<Xt?Xt=yt[Lt].x:yt[Lt].x>At&&(At=yt[Lt].x),yt[Lt].y<fi?fi=yt[Lt].y:yt[Lt].y>oi&&(oi=yt[Lt].y);return[Xt,fi,At-Xt,oi-fi]}(d),xe=yt=>[(yt.x-le)/ue,(yt.y-pe)/Me],[ke,Be,We,Ke]=d.map(xe),qe=function(yt,Xt,At,fi,oi,Lt,Ni,wi){let pi=i5(0,0,1,0,1,1,0,1),Ft=i5(yt,Xt,At,fi,oi,Lt,Ni,wi),Ci=i.co.adjoint([],Ft);return i.co.multiply(pi,pi,Ci)}(ke[0],ke[1],Be[0],Be[1],We[0],We[1],Ke[0],Ke[1]);this.elevatedGlobePerspectiveTransform=QT(ke[0],ke[1],Be[0],Be[1],We[0],We[1],Ke[0],Ke[1]);let dt=(yt,Xt)=>{I.push(yt.lng);let At=Math.round((yt.lng-B)/W*ii),fi=Math.round((yt.lat-V)/$*ii),oi=xe(Xt),Lt=i.N.transformMat3([],[oi[0],oi[1],1],qe),Ni=Math.round(Lt[0]/Lt[2]*ii),wi=Math.round(Lt[1]/Lt[2]*ii);J.emplaceBack(At,fi,Ni,wi)},Mt=d[3].x-d[0].x,rt=d[3].y-d[0].y,vt=d[2].x-d[1].x,it=d[2].y-d[1].y;for(let yt=0;yt<65;yt++){let Xt=yt/64,At=[d[0].x+Xt*Mt,d[0].y+Xt*rt],fi=[d[1].x+Xt*vt,d[1].y+Xt*it],oi=fi[0]-At[0],Lt=fi[1]-At[1];for(let Ni=0;Ni<65;Ni++){let wi=Ni/64,pi={x:At[0]+oi*wi,y:At[1]+Lt*wi,z:0};dt(l.projection.unproject(pi.x,pi.y),pi)}}this.elevatedGlobeVertexBuffer=n.createVertexBuffer(J,Gv.members)}{this.maxLongitudeTriangleSize=0;let J=[],le=new Us,pe=(ue,Me,xe)=>{le.emplaceBack(ue,Me,xe);let ke=I[ue],Be=I[Me],We=I[xe],Ke=Math.min(Math.min(ke,Be),We),qe=Math.max(Math.max(ke,Be),We)-Ke;qe>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=qe),J.push(Ke+qe/2)};for(let ue=0;ue<64;ue++)for(let Me=0;Me<64;Me++){let xe=65*ue+Me,ke=xe+1,Be=xe+65,We=Be+1;pe(xe,Be,ke),pe(ke,Be,We)}[J,le]=function(ue,Me){let xe=Array.from({length:ue.length},(We,Ke)=>Ke);xe.sort((We,Ke)=>ue[We]-ue[Ke]);let ke=[],Be=new Us;for(let We=0;We<xe.length;We++){let Ke=xe[We];ke.push(ue[Ke]);let qe=3*Ke,dt=qe+1;Be.emplaceBack(Me.uint16[qe],Me.uint16[dt],Me.uint16[dt+1])}return[ke,Be]}(J,le),this.elevatedGlobeTrianglesCenterLongitudes=J,this.elevatedGlobeIndexBuffer=n.createIndexBuffer(le)}this.elevatedGlobeSegments=ls.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,W/ii,0,$/ii,0,0,V,B,0])}prepare(){let n=Object.keys(this.tiles).length!==0;if(this.tileID&&!n)return;let l=this.map.painter.context,d=l.gl;!this._dirty||this.texture instanceof t5||(this.texture?this.texture.update(this.image):(this.texture=new Hv(l,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this._dirty=!1),n&&this._prepareData(l)}loadTile(n,l){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={},l(null)):(n.state="errored",l(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(n){let l=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!l)return null;let d=this.elevatedGlobeTrianglesCenterLongitudes,p=((I,R)=>I+360*Math.round((R-I)/360))(n+180,d[0]),m=new ls,y=(I,R)=>{m.segments.push({vertexOffset:0,primitiveOffset:I,vertexLength:l.segments[0].vertexLength,primitiveLength:R,sortKey:void 0,vaos:{}})},w=.51*this.maxLongitudeTriangleSize;if(Math.abs(d[0]-p)<=w){let I=He(d,0,d.length,p+w);return I===d.length||y(I,Se(d,I+1,d.length,p+360-w)-I),m}p<d[0]&&(p+=360);let T=Se(d,0,d.length,p-w);if(T===d.length)return y(0,d.length),m;y(0,T-0);let E=He(d,T+1,d.length,p+w);return E!==d.length&&y(E,d.length-E),m}}let BO=(Math.pow(256,2)-1)/16907520;class tM extends Wo{constructor(n,l,d){super(n,zO,l,d),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isLayerDraped(n){return!(n&&n._source instanceof eM&&(n._source.onNorthPole||n._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(n){n!=="raster-color"&&n!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(n){if(!this.hasColorMap()||!this._curRampRange)return;let l=this._transitionablePaint._values["raster-color"].value.expression,[d,p]=n||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(d)&&isNaN(p)||d===this._curRampRange[0]&&p===this._curRampRange[1]||(this.colorRamp=Km({expression:l,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:d,end:p}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[d,p])}}let UO=new Jr({visibility:new qt($e["layout_raster-particle"].visibility)});var VO={paint:new Jr({"raster-particle-array-band":new qt($e["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new qt($e["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new _0($e["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new qt($e["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new qt($e["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new qt($e["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new qt($e["paint_raster-particle"]["raster-particle-reset-rate-factor"])}),layout:UO};class iM extends Wo{constructor(n,l,d){super(n,VO,l,d),this._updateColorRamp(),this.onRemove=p=>{this.colorRampTexture&&this.colorRampTexture.destroy(),this.transformFeedbackObject&&p.painter.context.gl.deleteTransformFeedback(this.transformFeedbackObject),this.tileFramebuffer&&this.tileFramebuffer.destroy()},this.lastInvalidatedAt=at.now()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isLayerDraped(n){return!1}_handleSpecialPaintPropertyUpdate(n){n!=="raster-particle-color"&&n!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),n==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;let n=this._transitionablePaint._values["raster-particle-color"].value.expression,l=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Km({expression:n,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:l}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=at.now()}}class GO extends Wo{constructor(n,l){super(n,{},l),this.implementation=n,n.slot&&(this.slot=n.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(n){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(n){this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)}onRemove(n){this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)}}let HO=new Jr({visibility:new qt($e.layout_sky.visibility)});var jO={paint:new Jr({"sky-type":new qt($e.paint_sky["sky-type"]),"sky-atmosphere-sun":new qt($e.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new qt($e.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new qt($e.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new qt($e.paint_sky["sky-gradient-radius"]),"sky-gradient":new _0($e.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new qt($e.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new qt($e.paint_sky["sky-atmosphere-color"]),"sky-opacity":new qt($e.paint_sky["sky-opacity"])}),layout:HO};function jv(r,n,l){let d=[0,0,1],p=i.bi.identity([]);return i.bi.rotateY(p,p,l?-De(r)+Math.PI:De(r)),i.bi.rotateX(p,p,-De(n)),i.N.transformQuat(d,d,p),i.N.normalize(d,d)}var WO={paint:new Jr({})};function nM(r,n){let l=r5(r.projection,r.zoom,r.width,r.height),d=function(m,y,w,T,E){let I=new je(w.lng-180*Ah,w.lat),R=new je(w.lng+180*Ah,w.lat),F=m.project(I.lng,I.lat),B=m.project(R.lng,R.lat),V=-Math.atan2(B.y-F.y,B.x-F.x),W=Kn.fromLngLat(w);W.y=Xe(W.y,-1+Ah,1-Ah);let $=W.toLngLat(),J=m.project($.lng,$.lat),le=Kn.fromLngLat($);le.x+=Ah;let pe=le.toLngLat(),ue=m.project(pe.lng,pe.lat),Me=oM(ue.x-J.x,ue.y-J.y,V),xe=Kn.fromLngLat($);xe.y+=Ah;let ke=xe.toLngLat(),Be=m.project(ke.lng,ke.lat),We=oM(Be.x-J.x,Be.y-J.y,V),Ke=Math.abs(Me.x)/Math.abs(We.y),qe=i.a6.identity([]);i.a6.rotateZ(qe,qe,-V*(1-(E?0:T)));let dt=i.a6.identity([]);return i.a6.scale(dt,dt,[1,1-(1-Ke)*T,1]),dt[4]=-We.x/We.y*T,i.a6.rotateZ(dt,dt,V),i.a6.multiply(dt,qe,dt),dt}(r.projection,0,r.center,l,n),p=rM(r);return i.a6.scale(d,d,[p,p,1]),d}function rM(r){let n=r.projection,l=r5(r.projection,r.zoom,r.width,r.height),d=sM(n,r.center),p=sM(n,je.convert(n.center));return Math.pow(2,d*l+(1-l)*p)}function r5(r,n,l,d,p=1/0){let m=r.range;if(!m)return 0;let y=Math.min(p,Math.max(l,d)),w=Math.log(y/1024)/Math.LN2;return ht(m[0]+w,m[1]+w,n)}let Ah=1/4e4;function sM(r,n){let l=Xe(n.lat,-An,An),d=new je(n.lng-180*Ah,l),p=new je(n.lng+180*Ah,l),m=r.project(d.lng,l),y=r.project(p.lng,l),w=Kn.fromLngLat(d),T=Kn.fromLngLat(p),E=y.x-m.x,I=y.y-m.y,R=T.x-w.x,F=T.y-w.y,B=Math.sqrt((R*R+F*F)/(E*E+I*I));return Math.log(B)/Math.LN2}function oM(r,n,l){let d=Math.cos(l),p=Math.sin(l);return{x:r*d-n*p,y:r*p+n*d}}function aM(r,n,l){i.a6.identity(r),i.a6.rotateZ(r,r,De(n[2])),i.a6.rotateX(r,r,De(n[0])),i.a6.rotateY(r,r,De(n[1])),i.a6.scale(r,r,l),i.a6.multiply(r,r,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function s5(r,n,l,d,p,m,y,w){let T=[l[0]-n[0],l[1]-n[1],0],E=[d[0]-n[0],d[1]-n[1],0];if(i.N.length(T)<1e-12||i.N.length(E)<1e-12)return i.bi.identity(r);let I=i.N.cross([],T,E);i.N.normalize(I,I),i.N.subtract(E,d,n),T[2]=(m-p)*w,E[2]=(y-p)*w;let R=T;return i.N.cross(R,T,E),i.N.normalize(R,R),i.bi.rotationTo(r,I,R)}function Wv(r,n,l=!1){let d=xh(n.zoom),p=function(m,y,w){let T=y.worldSize,E=[m[12],m[13],m[14]],I=Wn(E[1]/T),R=an(E[0]/T),F=i.a6.identity([]),B=hn(1,I)*T,V=hn(1,0)*T*Cn(I,y.zoom),W=1/mv(T),$=V*W;if(w){let ue=r5(y.projection,y.zoom,y.width,y.height,1024);$=W*y.projection.pixelSpaceConversion(y.center.lat,T,ue)}let J=ot(I,R);i.N.add(J,J,i.N.scale([],i.N.normalize([],J),B*$*E[2]));let le=function(ue){let Me=[ue[0],ue[1],ue[2]],xe=[0,1,0],ke=i.N.cross([],xe,Me);return i.N.cross(xe,Me,ke),i.N.squaredLength(xe)===0&&(xe=[0,1,0],i.N.cross(ke,Me,xe)),i.N.normalize(ke,ke),i.N.normalize(xe,xe),i.N.normalize(Me,Me),[ke[0],ke[1],ke[2],0,xe[0],xe[1],xe[2],0,Me[0],Me[1],Me[2],0,ue[0],ue[1],ue[2],1]}(J);i.a6.scale(F,F,[$,$,$*B]),i.a6.translate(F,F,[-E[0],-E[1],-E[2]]);let pe=i.a6.multiply([],y.globeMatrix,le);return i.a6.multiply(pe,pe,F),i.a6.multiply(pe,pe,m),pe}(r,n,l);if(d>0){let m=function(y,w){let T=w.worldSize,E=hn(1,0)*T*Cn(w.center.lat,w.zoom)/mv(T),I=hn(1,w.center.lat)*T,R=i.a6.identity([]);return i.a6.rotateY(R,R,De(w.center.lng)),i.a6.rotateX(R,R,De(w.center.lat)),i.a6.translate(R,R,[0,0,ce]),i.a6.scale(R,R,[E,E,E*I]),i.a6.translate(R,R,[w.point.x-.5*T,w.point.y-.5*T,0]),i.a6.multiply(R,R,y),i.a6.multiply(R,w.globeMatrix,R)}(r,n);return function(y,w,T){let E=(V,W,$)=>{let J=i.N.length(V),le=i.N.length(W),pe=T0(V,W,$);return i.N.scale(pe,pe,1/i.N.length(pe)*Tn(J,le,$))},I=E([y[0],y[1],y[2]],[w[0],w[1],w[2]],T),R=E([y[4],y[5],y[6]],[w[4],w[5],w[6]],T),F=E([y[8],y[9],y[10]],[w[8],w[9],w[10]],T),B=T0([y[12],y[13],y[14]],[w[12],w[13],w[14]],T);return[I[0],I[1],I[2],0,R[0],R[1],R[2],0,F[0],F[1],F[2],0,B[0],B[1],B[2],1]}(p,m,d)}return p}function lM(r,n,l,d){let p=os.projectAabbCorners(d,l),m=Number.MAX_VALUE,y=-1;for(let E=0;E<p.length;++E){let I=p[E];I[0]=(.5*I[0]+.5)*n.width,I[1]=(.5-.5*I[1])*n.height,I[2]<m&&(y=E,m=I[2])}let w=E=>new de(p[E][0],p[E][1]),T;switch(y){case 0:case 6:T=[w(1),w(5),w(4),w(7),w(3),w(2),w(1)];break;case 1:case 7:T=[w(0),w(4),w(5),w(6),w(2),w(3),w(0)];break;case 3:case 5:T=[w(1),w(0),w(4),w(7),w(6),w(2),w(1)];break;default:T=[w(1),w(5),w(6),w(7),w(3),w(0),w(1)]}if(xl(r,T))return m}let qO=gr([{name:"a_pos_3f",components:3,type:"Float32"}]),XO=gr([{name:"a_color_3f",components:3,type:"Float32"}]),ZO=gr([{name:"a_color_4f",components:4,type:"Float32"}]),$O=gr([{name:"a_uv_2f",components:2,type:"Float32"}]),YO=gr([{name:"a_normal_3f",components:3,type:"Float32"}]),JO=gr([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),KO=gr([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class cM{constructor(n,l){this.feature=n,this.instancedDataOffset=l,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class hM{constructor(){this.instancedDataArray=new Hm,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class qv{constructor(n){this.zoom=n.zoom,this.canonical=n.canonical,this.layers=n.layers,this.layerIds=this.layers.map(l=>l.fqid),this.projection=n.projection,this.index=n.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0}}populate(n,l,d,p){this.tileToMeter=In(d);let m=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(let{feature:y,id:w,index:T,sourceLayerIndex:E}of n){let I=Rs(y,m);if(!this.layers[0]._featureFilter.filter(new Yr(this.zoom),I,d))continue;let R={id:w,sourceLayerIndex:E,index:T,geometry:m?I.geometry:Gs(y,d,p),properties:y.properties,type:y.type,patterns:{}},F=this.addFeature(R,R.geometry,I);F&&l.featureIndex.insert(y,R.geometry,T,E,this.index,this.instancesPerModel[F].instancedDataArray.length,ii/32)}this.lookup=null}update(n,l,d,p){for(let m in this.instancesPerModel){let y=this.instancesPerModel[m];for(let w in n)y.idToFeaturesIndex.hasOwnProperty(w)&&this.evaluate(y.features[y.idToFeaturesIndex[w]],n[w],y,!0)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let n=!1;for(let l in this.instancesPerModel){let d=this.instancesPerModel[l];for(let p of d.features){let m=this.layers[0],y=p.feature,w=this.canonical,T=m.paint.get("model-rotation").evaluate(y,{},w),E=m.paint.get("model-scale").evaluate(y,{},w),I=m.paint.get("model-translation").evaluate(y,{},w);i.N.exactEquals(p.rotation,T)&&i.N.exactEquals(p.scale,E)&&i.N.exactEquals(p.translation,I)||(this.evaluate(p,p.featureStates,d,!0),n=!0)}}return n}isEmpty(){for(let n in this.instancesPerModel)if(this.instancesPerModel[n].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(n){if(!this.uploaded)for(let l in this.instancesPerModel){let d=this.instancesPerModel[l];d.instancedDataArray.length<0||d.instancedDataArray.length===0||(d.instancedDataBuffer?d.instancedDataBuffer.updateData(d.instancedDataArray):d.instancedDataBuffer=n.createVertexBuffer(d.instancedDataArray,JO.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(let n in this.instancesPerModel){let l=this.instancesPerModel[n];l.instancedDataArray.length!==0&&l.instancedDataBuffer&&l.instancedDataBuffer.destroy()}}addFeature(n,l,d){let p=this.layers[0],m=p.layout.get("model-id").evaluate(d,{},this.canonical);if(!m)return Ui(`modelId is not evaluated for layer ${p.id} and it is not going to get rendered.`),m;this.instancesPerModel[m]||(this.instancesPerModel[m]=new hM);let y=this.instancesPerModel[m],w=y.instancedDataArray,T=new cM(d,w.length);for(let E of l)for(let I of E){if(I.x<0||I.x>=ii||I.y<0||I.y>=ii)continue;let R=(this.lookupDim-1)/ii,F=this.lookupDim*(I.y*R|0)+I.x*R|0;if(this.lookup){if(this.lookup[F]!==0)continue;this.lookup[F]=1}this.instanceCount++;let B=w.length;w.resize(B+1),y.instancesEvaluatedElevation.push(0),w.float32[16*B]=I.x,w.float32[16*B+1]=I.y}return T.instancedDataCount=y.instancedDataArray.length-T.instancedDataOffset,T.instancedDataCount>0&&(n.id&&(y.idToFeaturesIndex[n.id]=y.features.length),y.features.push(T),this.evaluate(T,{},y,!1)),m}evaluate(n,l,d,p){let m=this.layers[0],y=n.feature,w=this.canonical,T=n.rotation=m.paint.get("model-rotation").evaluate(y,l,w),E=n.scale=m.paint.get("model-scale").evaluate(y,l,w),I=n.translation=m.paint.get("model-translation").evaluate(y,l,w),R=m.paint.get("model-color").evaluate(y,l,w);R.a=m.paint.get("model-color-mix-intensity").evaluate(y,l,w);let F=[];this.maxVerticalOffset<I[2]&&(this.maxVerticalOffset=I[2]),this.maxScale=Math.max(Math.max(this.maxScale,E[0]),Math.max(E[1],E[2])),aM(F,T,E);let B=Math.round(100*R.a)+R.b/1.05;for(let V=0;V<n.instancedDataCount;++V){let W=n.instancedDataOffset+V,$=16*W,J=d.instancedDataArray.float32,le=0;p&&(le=J[$+6]-d.instancesEvaluatedElevation[W]);let pe=0|J[$+1];J[$]=(0|J[$])+R.r/1.05,J[$+1]=pe+R.g/1.05,J[$+2]=B,J[$+3]=1/(w.z>10?this.tileToMeter:In(w,pe)),J[$+4]=I[0],J[$+5]=I[1],J[$+6]=I[2]+le,J[$+7]=F[0],J[$+8]=F[1],J[$+9]=F[2],J[$+10]=F[4],J[$+11]=F[5],J[$+12]=F[6],J[$+13]=F[8],J[$+14]=F[9],J[$+15]=F[10],d.instancesEvaluatedElevation[W]=I[2]}}}hi(qv,"ModelBucket",{omit:["layers"]}),hi(hM,"PerModelAttributes"),hi(cM,"ModelFeature");let QO=new Jr({visibility:new qt($e.layout_model.visibility),"model-id":new Ai($e.layout_model["model-id"])});var eN={paint:new Jr({"model-opacity":new qt($e.paint_model["model-opacity"]),"model-rotation":new Ai($e.paint_model["model-rotation"]),"model-scale":new Ai($e.paint_model["model-scale"]),"model-translation":new Ai($e.paint_model["model-translation"]),"model-color":new Ai($e.paint_model["model-color"]),"model-color-mix-intensity":new Ai($e.paint_model["model-color-mix-intensity"]),"model-type":new qt($e.paint_model["model-type"]),"model-cast-shadows":new qt($e.paint_model["model-cast-shadows"]),"model-receive-shadows":new qt($e.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new qt($e.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Ai($e.paint_model["model-emissive-strength"]),"model-roughness":new Ai($e.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Ai($e.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new qt($e.paint_model["model-cutoff-fade-range"])}),layout:QO};let gu=64,e1={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function dM(r,n,l,d,p,m,y,w,T,E=!1){let I=l.zoom,R=l.project(d),F=Cn(d.lat,I),B=1/F;i.a6.identity(r),i.a6.translate(r,r,[R.x+y[0]*B,R.y+y[1]*B,y[2]]);let V=1,W=1,$=l.worldSize;if(E){if(l.projection.name==="mercator"){let ue=0;l.elevation&&(ue=l.elevation.getAtPointOrZero(new Kn(R.x/$,R.y/$),0));let Me=i.a7.transformMat4([],[R.x,R.y,ue,1],l.projMatrix)[3]/l.cameraToCenterDistance;V=Me,W=Me*Cn(l.center.lat,I)}else if(l.projection.name==="globe"){let ue=Wv(r,l),Me=i.a6.multiply([],l.projMatrix,ue),xe=[0,0,0,1];i.a7.transformMat4(xe,xe,Me);let ke=xe[3]/l.cameraToCenterDistance,Be=xh(I),We=l.projection.pixelsPerMeter(d.lat,$)*Cn(d.lat,I),Ke=l.projection.pixelsPerMeter(l.center.lat,$)*Cn(l.center.lat,I);V=ke/Tn(We,Kr(l.center.lat),Be),W=ke*F/We,V*=Ke,W*=Ke}}else V=B;i.a6.scale(r,r,[V,V,W]);let J=[...r],le=n.orientation,pe=[];if(aM(pe,[le[0]+p[0],le[1]+p[1],le[2]+p[2]],m),i.a6.multiply(r,J,pe),w&&l.elevation){let ue=0,Me=[];if(T&&l.elevation){ue=function(Be,We,Ke,qe,dt){let Mt=We.elevation;if(!Mt)return 0;let rt=os.projectAabbCorners(Ke,qe),vt=hn(1,dt.lat)*We.worldSize,it=function(Ci,xn){let Hi=[0,0,1],bn=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(let nn of bn){let Vn=Ci[nn.corners[0]],dn=Ci[nn.corners[1]],Cr=Ci[nn.corners[2]],tr=[dn[0]-Vn[0],dn[1]-Vn[1],xn*(dn[2]-Vn[2])],rr=i.N.cross(tr,tr,[Cr[0]-Vn[0],Cr[1]-Vn[1],xn*(Cr[2]-Vn[2])]);i.N.normalize(rr,rr),nn.dotProductWithUp=i.N.dot(rr,Hi)}return bn.sort((nn,Vn)=>nn.dotProductWithUp-Vn.dotProductWithUp),bn[0].corners}(rt,vt),yt=rt[it[0]],Xt=rt[it[1]],At=rt[it[2]],fi=rt[it[3]],oi=Mt.getAtPointOrZero(new Kn(yt[0]/We.worldSize,yt[1]/We.worldSize),0),Lt=Mt.getAtPointOrZero(new Kn(Xt[0]/We.worldSize,Xt[1]/We.worldSize),0),Ni=Mt.getAtPointOrZero(new Kn(At[0]/We.worldSize,At[1]/We.worldSize),0),wi=Mt.getAtPointOrZero(new Kn(fi[0]/We.worldSize,fi[1]/We.worldSize),0),pi=(oi+wi)/2,Ft=(Lt+Ni)/2;return pi>Ft?Lt<Ni?s5(Be,Xt,fi,yt,Lt,wi,oi,vt):s5(Be,At,yt,fi,Ni,oi,wi,vt):oi<wi?s5(Be,yt,Xt,At,oi,Lt,Ni,vt):s5(Be,fi,At,Xt,wi,Ni,Lt,vt),Math.max(pi,Ft)}(Me,l,n.aabb,r,d);let xe=i.a6.fromQuat([],Me),ke=i.a6.multiply([],xe,pe);i.a6.multiply(r,J,ke)}else ue=l.elevation.getAtPointOrZero(new Kn(R.x/$,R.y/$),0);ue!==0&&(r[14]+=ue)}}function f2(r,n,l=!1){r.uploaded||(r.gfxTexture=new Hv(n,r.image,l?n.gl.R8:n.gl.RGBA,{useMipmap:r.sampler.minFilter>=n.gl.NEAREST_MIPMAP_NEAREST}),r.uploaded=!0,r.image=null)}function tN(r,n,l){r.indexBuffer=n.createIndexBuffer(r.indexArray,!1,!0),r.vertexBuffer=n.createVertexBuffer(r.vertexArray,qO.members,!1,!0),r.normalArray&&(r.normalBuffer=n.createVertexBuffer(r.normalArray,YO.members,!1,!0)),r.texcoordArray&&(r.texcoordBuffer=n.createVertexBuffer(r.texcoordArray,$O.members,!1,!0)),r.colorArray&&(r.colorBuffer=n.createVertexBuffer(r.colorArray,(r.colorArray.bytesPerElement===12?XO:ZO).members,!1,!0)),r.featureArray&&(r.pbrBuffer=n.createVertexBuffer(r.featureArray,KO.members,!0)),r.segments=ls.simpleSegment(0,0,r.vertexArray.length,r.indexArray.length);let d=r.material;d.pbrMetallicRoughness.baseColorTexture&&f2(d.pbrMetallicRoughness.baseColorTexture,n),d.pbrMetallicRoughness.metallicRoughnessTexture&&f2(d.pbrMetallicRoughness.metallicRoughnessTexture,n),d.normalTexture&&f2(d.normalTexture,n),d.occlusionTexture&&f2(d.occlusionTexture,n,l),d.emissionTexture&&f2(d.emissionTexture,n)}function Xv(r,n,l){if(r.meshes)for(let d of r.meshes)tN(d,n,l);if(r.children)for(let d of r.children)Xv(d,n,l)}function o5(r){if(r.meshes)for(let n of r.meshes)n.indexArray.destroy(),n.vertexArray.destroy(),n.colorArray&&n.colorArray.destroy(),n.normalArray&&n.normalArray.destroy(),n.texcoordArray&&n.texcoordArray.destroy(),n.featureArray&&n.featureArray.destroy();if(r.children)for(let n of r.children)o5(n)}function Zv(r){if(r.meshes)for(let l of r.meshes)l.vertexBuffer&&(l.vertexBuffer.destroy(),l.indexBuffer.destroy(),l.normalBuffer&&l.normalBuffer.destroy(),l.texcoordBuffer&&l.texcoordBuffer.destroy(),l.colorBuffer&&l.colorBuffer.destroy(),l.pbrBuffer&&l.pbrBuffer.destroy(),l.segments.destroy(),l.material&&((n=l.material).pbrMetallicRoughness.baseColorTexture&&n.pbrMetallicRoughness.baseColorTexture.gfxTexture&&n.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),n.pbrMetallicRoughness.metallicRoughnessTexture&&n.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&n.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),n.normalTexture&&n.normalTexture.gfxTexture&&n.normalTexture.gfxTexture.destroy(),n.emissionTexture&&n.emissionTexture.gfxTexture&&n.emissionTexture.gfxTexture.destroy(),n.occlusionTexture&&n.occlusionTexture.gfxTexture&&n.occlusionTexture.gfxTexture.destroy()));var n;if(r.children)for(let l of r.children)Zv(l)}class iN{constructor(n){this._callback=n,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class nN{constructor(){this.tasks={},this.taskQueue=[],ei(["process"],this),this.invoker=new iN(this.process),this.nextId=0}add(n,l){let d=this.nextId++,p=function({type:m,isSymbolTile:y,zoom:w}){return w=w||0,m==="message"?0:m!=="maybePrepare"||y?m!=="parseTile"||y?m==="parseTile"&&y?300-w:m==="maybePrepare"&&y?400-w:500:200-w:100-w}(l);if(p===0){yn();try{n()}finally{}return null}return this.tasks[d]={fn:n,metadata:l,priority:p,id:d},this.taskQueue.push(d),this.invoker.trigger(),{cancel:()=>{delete this.tasks[d]}}}process(){yn();try{if(this.taskQueue=this.taskQueue.filter(d=>!!this.tasks[d]),!this.taskQueue.length)return;let n=this.pick();if(n===null)return;let l=this.tasks[n];if(delete this.tasks[n],this.taskQueue.length&&this.invoker.trigger(),!l)return;l.fn()}finally{}}pick(){let n=null,l=1/0;for(let p=0;p<this.taskQueue.length;p++){let m=this.tasks[this.taskQueue[p]];m.priority<l&&(l=m.priority,n=p)}if(n===null)return null;let d=this.taskQueue[n];return this.taskQueue.splice(n,1),d}remove(){this.invoker.remove()}}class uM{constructor(n,l,d){this.target=n,this.parent=l,this.mapId=d,this.callbacks={},this.cancelCallbacks={},ei(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new nN}send(n,l,d,p,m=!1,y){let w=Math.round(1e18*Math.random()).toString(36).substring(0,10);d&&(d.metadata=y,this.callbacks[w]=d);let T=new Set;return this.target.postMessage({id:w,type:n,hasCallback:!!d,targetMapId:p,mustQueue:m,sourceMapId:this.mapId,data:Ec(l,T)},T),{cancel:()=>{d&&delete this.callbacks[w],this.target.postMessage({id:w,type:"<cancel>",targetMapId:p,sourceMapId:this.mapId})}}}receive(n){let l=n.data,d=l.id;if(d&&(!l.targetMapId||this.mapId===l.targetMapId))if(l.type==="<cancel>"){let p=this.cancelCallbacks[d];delete this.cancelCallbacks[d],p&&p.cancel()}else if(l.mustQueue||yn()){let p=this.callbacks[d],m=this.scheduler.add(()=>this.processTask(d,l),p&&p.metadata||{type:"message"});m&&(this.cancelCallbacks[d]=m)}else this.processTask(d,l)}processTask(n,l){if(delete this.cancelCallbacks[n],l.type==="<response>"){let d=this.callbacks[n];delete this.callbacks[n],d&&(l.error?d(m0(l.error)):d(null,m0(l.data)))}else{let d=new Set,p=l.hasCallback?(y,w)=>{this.target.postMessage({id:n,type:"<response>",sourceMapId:this.mapId,error:y?Ec(y):null,data:Ec(w,d)},d)}:y=>{},m=m0(l.data);if(this.parent[l.type])this.parent[l.type](l.sourceMapId,m,p);else if(this.parent.getWorkerSource){let y=l.type.split(".");this.parent.getWorkerSource(l.sourceMapId,y[0],m.source,m.scope)[y[1]](m,p)}else p(new Error(`Could not find function ${l.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}let $v=(()=>{class r{constructor(l,d){this.workerPool=l,this.actors=[],this.currentActor=0,this.id=Bt();let p=this.workerPool.acquire(this.id);for(let m=0;m<p.length;m++){let y=new r.Actor(p[m],d,this.id);y.name=`Worker ${m}`,this.actors.push(y)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(l,d,p){bt(this.actors,(m,y)=>{m.send(l,d,y)},p=p||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(l=>{l.remove()}),this.actors=[],this.workerPool.release(this.id)}}return r.Actor=uM,r})();var m2={workerUrl:"",workerClass:null,workerParams:void 0};function rN(){return m2.workerClass!=null?new m2.workerClass:new self.Worker(m2.workerUrl,m2.workerParams)}let Yv="mapboxgl_preloaded_worker_pool";class g2{constructor(){this.active={}}acquire(n){if(!this.workers)for(this.workers=[];this.workers.length<g2.workerCount;)this.workers.push(new rN);return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],this.workers&&this.numActive()===0&&(this.workers.forEach(l=>{l.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Yv]}numActive(){return Object.keys(this.active).length}}let _2;function a5(){return _2||(_2=new g2),_2}g2.workerCount=2;let l5,Jv,Wl,t1,Kv,i1=null;function pM(){return yn()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:Jv||x.DRACO_URL}function fM(){if(yn()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(t1)return t1;let r=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return t1=WebAssembly.validate(r)?x.MESHOPT_SIMD_URL:x.MESHOPT_URL,t1}let c5={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},sN={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},y2={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function mM(r,n,l){let d=l.json.bufferViews.length,p=l.buffers.length;n.bufferView=d,l.json.bufferViews[d]={buffer:p,byteLength:r.byteLength},l.buffers[p]=r}let Qv="KHR_draco_mesh_compression";function oN(r,n){let l=r.extensions&&r.extensions[Qv];if(!l)return;let d=new Wl.Decoder,p=vM(n,l.bufferView),m=new Wl.Mesh;if(!d.DecodeArrayToMesh(p,p.byteLength,m))throw new Error("Failed to decode Draco mesh");let y=n.json.accessors[r.indices],w=c5[y.componentType],T=y.count*w.BYTES_PER_ELEMENT,E=Wl._malloc(T);w===Uint16Array?d.GetTrianglesUInt16Array(m,T,E):d.GetTrianglesUInt32Array(m,T,E),mM(Wl.memory.buffer.slice(E,E+T),y,n),Wl._free(E);for(let I of Object.keys(l.attributes)){let R=d.GetAttributeByUniqueId(m,l.attributes[I]),F=n.json.accessors[r.attributes[I]],B=sN[F.componentType],V=F.count*y2[F.type]*c5[F.componentType].BYTES_PER_ELEMENT,W=Wl._malloc(V);d.GetAttributeDataArrayForAllPoints(m,R,Wl[B],V,W),mM(Wl.memory.buffer.slice(W,W+V),F,n),Wl._free(W)}d.destroy(),m.destroy(),delete r.extensions[Qv]}let h5="EXT_meshopt_compression";function aN(r,n){if(!r.extensions||!r.extensions[h5])return;let l=r.extensions[h5],d=new Uint8Array(n.buffers[l.buffer],l.byteOffset||0,l.byteLength||0),p=new Uint8Array(l.count*l.byteStride);Kv.decodeGltfBuffer(p,l.count,l.byteStride,d,l.mode,l.filter),r.buffer=n.buffers.length,r.byteOffset=0,n.buffers[r.buffer]=p.buffer,delete r.extensions[h5]}let gM=1179937895,_M=new TextDecoder("utf8");function yM(r,n){return new URL(r,n).href}function lN(r,n,l,d){return fetch(yM(r.uri,d)).then(p=>p.arrayBuffer()).then(p=>{n.buffers[l]=p})}function vM(r,n){let l=r.json.bufferViews[n];return new Uint8Array(r.buffers[l.buffer],l.byteOffset||0,l.byteLength)}function cN(r,n,l,d){if(r.uri){let p=yM(r.uri,d);return fetch(p).then(m=>m.blob()).then(m=>createImageBitmap(m)).then(m=>{n.images[l]=m})}if(r.bufferView!==void 0){let p=vM(n,r.bufferView),m=new Blob([p],{type:r.mimeType});return createImageBitmap(m).then(y=>{n.images[l]=y})}}function xM(r,n=0,l){let d={json:null,images:[],buffers:[]};if(new Uint32Array(r,n,1)[0]===gM){let I=new Uint32Array(r,n),R=2,F=(I[R++]>>2)-3,B=I[R++]>>2;if(R++,d.json=JSON.parse(_M.decode(I.subarray(R,R+B))),R+=B,R<F){let V=I[R++];R++;let W=n+(R<<2);d.buffers[0]=r.slice(W,W+V)}}else d.json=JSON.parse(_M.decode(new Uint8Array(r,n)));let{buffers:p,images:m,meshes:y,extensionsUsed:w,bufferViews:T}=d.json,E=Promise.resolve();if(p){let I=[];for(let R=0;R<p.length;R++){let F=p[R];F.uri?I.push(lN(F,d,R,l)):d.buffers[R]||(d.buffers[R]=null)}E=Promise.all(I)}return E.then(()=>{let I=[],R=w&&w.includes(Qv),F=w&&w.includes(h5);if(R&&I.push(function(){if(!Wl)return l5||(l5=function(B){let V,W=null;function $(){V=new Uint8Array(W.buffer)}function J(){throw new Error("Unexpected Draco error.")}let le={a:{a:J,d:function(pe,ue,Me){return V.copyWithin(pe,ue,ue+Me)},c:function(pe){let ue=V.length,Me=Math.max(pe>>>0,Math.ceil(1.2*ue)),xe=Math.ceil((Me-ue)/65536);try{return W.grow(xe),$(),!0}catch{return!1}},b:J}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(B,le):B.then(pe=>pe.arrayBuffer()).then(pe=>WebAssembly.instantiate(pe,le))).then(pe=>{let{Rb:ue,Qb:Me,P:xe,T:ke,X:Be,Ja:We,La:Ke,Qa:qe,Va:dt,Wa:Mt,eb:rt,jb:vt,f:it,e:yt,yb:Xt,zb:At,Ab:fi,Bb:oi,Db:Lt,Gb:Ni}=pe.instance.exports;W=yt;let wi=(()=>{let pi=0,Ft=0,Ci=0,xn=0;return Hi=>{Ci&&(ue(xn),ue(pi),Ft+=Ci,Ci=pi=0),pi||(Ft+=128,pi=Me(Ft));let bn=Hi.length+7&-8,nn=pi;bn>=Ft&&(Ci=bn,nn=xn=Me(bn));for(let Vn=0;Vn<Hi.length;Vn++)V[nn+Vn]=Hi[Vn];return nn}})();return $(),it(),{memory:yt,_free:ue,_malloc:Me,Mesh:class{constructor(){this.ptr=xe()}destroy(){ke(this.ptr)}},Decoder:class{constructor(){this.ptr=We()}destroy(){vt(this.ptr)}DecodeArrayToMesh(pi,Ft,Ci){let xn=wi(pi),Hi=Ke(this.ptr,xn,Ft,Ci.ptr);return!!Be(Hi)}GetAttributeByUniqueId(pi,Ft){return{ptr:qe(this.ptr,pi.ptr,Ft)}}GetTrianglesUInt16Array(pi,Ft,Ci){dt(this.ptr,pi.ptr,Ft,Ci)}GetTrianglesUInt32Array(pi,Ft,Ci){Mt(this.ptr,pi.ptr,Ft,Ci)}GetAttributeDataArrayForAllPoints(pi,Ft,Ci,xn,Hi){rt(this.ptr,pi.ptr,Ft.ptr,Ci,xn,Hi)}},DT_INT8:Xt(),DT_UINT8:At(),DT_INT16:fi(),DT_UINT16:oi(),DT_UINT32:Lt(),DT_FLOAT32:Ni()}})}(fetch(pM())),l5.then(B=>{Wl=B,l5=void 0}))}()),F&&I.push(function(){if(Kv)return;let B=function(V){let W,$=WebAssembly.instantiateStreaming(V,{}).then(pe=>{W=pe.instance,W.exports.__wasm_call_ctors()}),J={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},le={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:$,supported:!0,decodeGltfBuffer(pe,ue,Me,xe,ke,Be){(function(We,Ke,qe,dt,Mt,rt,vt){let it=We.exports.sbrk,yt=dt+3&-4,Xt=it(yt*Mt),At=it(rt.length),fi=new Uint8Array(We.exports.memory.buffer);fi.set(rt,At);let oi=Ke(Xt,dt,Mt,At,rt.length);if(oi===0&&vt&&vt(Xt,yt,Mt),qe.set(fi.subarray(Xt,Xt+dt*Mt)),it(Xt-it(0)),oi!==0)throw new Error(`Malformed buffer data: ${oi}`)})(W,W.exports[le[ke]],pe,ue,Me,xe,W.exports[J[Be]])}}}(fetch(fM()));return B.ready.then(()=>{Kv=B})}()),m)for(let B=0;B<m.length;B++)I.push(cN(m[B],d,B,l));return(I.length?Promise.all(I):Promise.resolve()).then(()=>{if(R&&y)for(let{primitives:B}of y)for(let V of B)oN(V,d);if(F&&y&&T)for(let B of T)aN(B,d);return d})})}class bM{constructor(n,l,d){if(this.triangleCount=l.length/3,this.min=new de(0,0),this.max=new de(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||n.length===0||d===0)return;let p=n.map(I=>I.x),m=n.map(I=>I.y);this.min=new de(Math.min(...p),Math.min(...m)),this.max=new de(Math.max(...p),Math.max(...m));let y=this.max.sub(this.min);y.x=Math.max(y.x,1),y.y=Math.max(y.y,1);let w=Math.max(y.x,y.y)/d;this.cellsX=Math.max(1,Math.ceil(y.x/w)),this.cellsY=Math.max(1,Math.ceil(y.y/w)),this.xScale=1/w,this.yScale=1/w;let T=[];for(let I=0;I<this.triangleCount;I++){let R=n[l[3*I+0]].sub(this.min),F=n[l[3*I+1]].sub(this.min),B=n[l[3*I+2]].sub(this.min),V=Ch(Math.floor(Math.min(R.x,F.x,B.x)),this.xScale,this.cellsX),W=Ch(Math.floor(Math.max(R.x,F.x,B.x)),this.xScale,this.cellsX),$=Ch(Math.floor(Math.min(R.y,F.y,B.y)),this.yScale,this.cellsY),J=Ch(Math.floor(Math.max(R.y,F.y,B.y)),this.yScale,this.cellsY),le=new de(0,0),pe=new de(0,0),ue=new de(0,0),Me=new de(0,0);for(let xe=$;xe<=J;++xe){le.y=pe.y=xe*w,ue.y=Me.y=(xe+1)*w;for(let ke=V;ke<=W;++ke)le.x=ue.x=ke*w,pe.x=Me.x=(ke+1)*w,(Xy(R,F,B,le,pe,Me)||Xy(R,F,B,le,Me,ue))&&T.push({cellIdx:xe*this.cellsX+ke,triIdx:I})}}if(T.length===0)return;T.sort((I,R)=>I.cellIdx-R.cellIdx||I.triIdx-R.triIdx);let E=0;for(;E<T.length;){let I=T[E].cellIdx,R={start:this.payload.length,len:0};for(;E<T.length&&T[E].cellIdx===I;)++R.len,this.payload.push(T[E++].triIdx);this.cells[I]=R}}query(n,l,d){if(this.triangleCount===0||this.cells.length===0||n.x>this.max.x||this.min.x>l.x||n.y>this.max.y||this.min.y>l.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let T=0;T<this.lookup.length;T++)this.lookup[T]=0;let p=Ch(n.x-this.min.x,this.xScale,this.cellsX),m=Ch(l.x-this.min.x,this.xScale,this.cellsX),y=Ch(n.y-this.min.y,this.yScale,this.cellsY),w=Ch(l.y-this.min.y,this.yScale,this.cellsY);for(let T=y;T<=w;T++)for(let E=p;E<=m;E++){let I=this.cells[T*this.cellsX+E];if(I)for(let R=0;R<I.len;R++){let F=this.payload[I.start+R],B=Math.floor(F/8),V=1<<F%8;if(!(this.lookup[B]&V)&&(this.lookup[B]|=V,d.push(F),d.length===this.triangleCount))return}}}}function Ch(r,n,l){return Math.max(0,Math.min(l-1,Math.floor(r*n)))}function _u(r,n){let l=r.json.bufferViews[n.bufferView],d=c5[n.componentType];return new d(r.buffers[l.buffer],(n.byteOffset||0)+(l.byteOffset||0),n.count*(l.byteStride&&l.byteStride!==y2[n.type]*d.BYTES_PER_ELEMENT?l.byteStride/d.BYTES_PER_ELEMENT:y2[n.type]))}function ex(r,n,l,d){let p=c5[n.componentType],m=function(I){switch(I){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(p),y=r.json.bufferViews[n.bufferView],w=y.byteStride?y.byteStride/p.BYTES_PER_ELEMENT:y2[n.type],T=l.float32,E=T.length/l.capacity;for(let I=0,R=0;I<n.count*w;I+=w,R+=E)for(let F=0;F<E;F++)T[R+F]=d[I+F]*m;l._trim()}function hN(r,n,l){let d=r.indices,p=r.attributes,m={};m.indexArray=new Us;let y=n.json.accessors[d],w=y.count/3;m.indexArray.reserve(w);let T=_u(n,y);for(let F=0;F<w;F++)m.indexArray.emplaceBack(T[3*F],T[3*F+1],T[3*F+2]);m.indexArray._trim(),m.vertexArray=new y0;let E=n.json.accessors[p.POSITION];m.vertexArray.reserve(E.count);let I=_u(n,E);for(let F=0;F<E.count;F++)m.vertexArray.emplaceBack(I[3*F],I[3*F+1],I[3*F+2]);if(m.vertexArray._trim(),m.aabb=new os(E.min,E.max),m.centroid=function(F,B){let V=[0,0,0],W=F.length;if(W>0){for(let $=0;$<W;$++){let J=3*F[$];V[0]+=B[J],V[1]+=B[J+1],V[2]+=B[J+2]}V[0]/=W,V[1]/=W,V[2]/=W}return V}(T,I),p.COLOR_0!==void 0){let F=n.json.accessors[p.COLOR_0],B=y2[F.type],V=_u(n,F);m.colorArray=B===3?new y0:new Pc,m.colorArray.resize(F.count),ex(n,F,m.colorArray,V)}if(p.NORMAL!==void 0){m.normalArray=new y0;let F=n.json.accessors[p.NORMAL];m.normalArray.resize(F.count);let B=_u(n,F);ex(n,F,m.normalArray,B)}if(p.TEXCOORD_0!==void 0&&l.length>0){m.texcoordArray=new ru;let F=n.json.accessors[p.TEXCOORD_0];m.texcoordArray.resize(F.count);let B=_u(n,F);ex(n,F,m.texcoordArray,B)}if(p._FEATURE_ID_RGBA4444!==void 0){let F=n.json.accessors[p._FEATURE_ID_RGBA4444];n.json.extensionsUsed&&n.json.extensionsUsed.includes("EXT_meshopt_compression")&&(m.featureData=_u(n,F))}p._FEATURE_RGBA4444!==void 0&&(m.featureData=new Uint32Array(_u(n,n.json.accessors[p._FEATURE_RGBA4444]).buffer));let R=r.material;return m.material=function(F,B){let{emissiveFactor:V=[0,0,0],alphaMode:W="OPAQUE",alphaCutoff:$=.5,normalTexture:J,occlusionTexture:le,emissiveTexture:pe,doubleSided:ue}=F,{baseColorFactor:Me=[1,1,1,1],metallicFactor:xe=1,roughnessFactor:ke=1,baseColorTexture:Be,metallicRoughnessTexture:We}=F.pbrMetallicRoughness||{},Ke=le?B[le.index]:void 0;if(le&&le.extensions&&le.extensions.KHR_texture_transform&&Ke){let qe=le.extensions.KHR_texture_transform;Ke.offsetScale=[qe.offset[0],qe.offset[1],qe.scale[0],qe.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new qr(...Me),metallicFactor:xe,roughnessFactor:ke,baseColorTexture:Be?B[Be.index]:void 0,metallicRoughnessTexture:We?B[We.index]:void 0},doubleSided:ue,emissiveFactor:V,alphaMode:W,alphaCutoff:$,normalTexture:J?B[J.index]:void 0,occlusionTexture:Ke,emissionTexture:pe?B[pe.index]:void 0,defined:F.defined===void 0}}(R!==void 0?n.json.materials[R]:{defined:!1},l),m}function wM(r,n,l){let{matrix:d,rotation:p,translation:m,scale:y,mesh:w,extras:T,children:E}=r,I={};if(I.matrix=d||i.a6.fromRotationTranslationScale([],p||[0,0,0,1],m||[0,0,0],y||[1,1,1]),w!==void 0){I.meshes=l[w];let R=I.anchor=[0,0];for(let F of I.meshes){let{min:B,max:V}=F.aabb;R[0]+=B[0]+V[0],R[1]+=B[1]+V[1]}R[0]=Math.floor(R[0]/I.meshes.length/2),R[1]=Math.floor(R[1]/I.meshes.length/2)}if(T&&(T.id&&(I.id=T.id),T.lights&&(I.lights=function(R){if(!R.length)return[];let F=function(J){let le=atob(J),pe=new Uint8Array(le.length);for(let ue=0;ue<le.length;ue++)pe[ue]=le.codePointAt(ue);return pe}(R),B=[],V=F.length/24,W=new Uint16Array(F.buffer),$=new Float32Array(F.buffer);for(let J=0;J<V;J++){let le=W[2*J*6]/30,pe=W[2*J*6+1]/30,ue=W[2*J*6+10]/100,Me=$[6*J+1],xe=$[6*J+2],ke=$[6*J+3],Be=$[6*J+4],We=ke-Me,Ke=Be-xe,qe=Math.hypot(We,Ke);B.push({pos:[Me+.5*We,xe+.5*Ke,pe],normal:[Ke/qe,-We/qe,0],width:qe,height:le,depth:ue,points:[Me,xe,ke,Be]})}return B}(T.lights))),E){let R=[];for(let F of E)R.push(wM(n.json.nodes[F],n,l));I.children=R}return I}function dN(r){if(r.vertices.length===0||r.indices.length===0)return null;let[n,l]=[r.vertices[0].clone(),r.vertices[0].clone()];for(let y=1;y<r.vertices.length;++y){let w=r.vertices[y];n.x=Math.min(n.x,w.x),n.y=Math.min(n.y,w.y),l.x=Math.max(l.x,w.x),l.y=Math.max(l.y,w.y)}let d=Math.ceil(Math.max(l.x-n.x,l.y-n.y)/256),p=Math.max(8,d),m=new bM(r.vertices,r.indices,p);return{vertices:r.vertices,indices:r.indices,grid:m,min:n,max:l}}function uN(r){if(!r.extras||!r.extras.ground)return null;let n=r.extras.ground;if(!n||!Array.isArray(n)||n.length===0)return null;let l=n[0];if(!l||!Array.isArray(l)||l.length===0)return null;let d=[];for(let y of l){if(!Array.isArray(y)||y.length!==2)continue;let w=y[0],T=y[1];typeof w=="number"&&typeof T=="number"&&d.push(new de(w,T))}if(d.length<3)return null;d.length>1&&d[d.length-1].equals(d[0])&&d.pop();let p=0;for(let y=0;y<d.length;y++){let w=d[y],T=d[(y+1)%d.length],E=d[(y+2)%d.length];p+=(w.x-T.x)*(E.y-T.y)-(E.x-T.x)*(w.y-T.y)}p>0&&d.reverse();let m=R4(d.flatMap(y=>[y.x,y.y]),[]);return m.length===0?null:{vertices:d,indices:m}}function pN(r){let n=[],l=[],d=0;for(let p of r){d=n.length;let m=p.vertexArray.float32,y=p.indexArray.uint16;for(let w=0;w<p.vertexArray.length;w++)n.push(new de(m[3*w+0],m[3*w+1]));for(let w=0;w<3*p.indexArray.length;w++)l.push(y[w]+d)}if(l.length%3!=0)return null;for(let p=0;p<l.length;p+=3){let m=n[l[p+0]],y=n[l[p+1]],w=n[l[p+2]];(m.x-y.x)*(w.y-y.y)-(w.x-y.x)*(m.y-y.y)>0&&([l[p+1],l[p+2]]=[l[p+2],l[p+1]])}return{vertices:n,indices:l}}function SM(r){let n=function(T,E){let I=[],R=WebGL2RenderingContext;if(T.json.textures)for(let F of T.json.textures){let B={magFilter:R.LINEAR,minFilter:R.NEAREST,wrapS:R.REPEAT,wrapT:R.REPEAT};F.sampler!==void 0&&Object.assign(B,T.json.samplers[F.sampler]),I.push({image:E[F.source],sampler:B,uploaded:!1})}return I}(r,r.images),l=function(T,E){let I=[];for(let R of T.json.meshes){let F=[];for(let B of R.primitives)F.push(hN(B,T,E));I.push(F)}return I}(r,n),{scenes:d,scene:p,nodes:m}=r.json,y=d?d[p||0].nodes:m,w=[];for(let T of y)w.push(wM(m[T],r,l));return function(T,E,I){let R={},F=new Set;for(let B=0;B<T.length;B++){let V=I[E[B]];if(!V.extras)continue;let W=V.extras["mapbox:footprint:version"],$=V.extras["mapbox:footprint:id"];(W||$)&&F.add(B),W==="1.0.0"&&$&&(R[$]=B)}for(let B=0;B<T.length;B++){if(F.has(B))continue;let V=T[B],W=I[E[B]];if(!W.extras)continue;let $=null;V.id in R&&($=pN(T[R[V.id]].meshes)),$||($=uN(W)),$&&(V.footprint=dN($))}if(F.size>0){let B=Array.from(F.values()).sort((V,W)=>V-W);for(let V=B.length-1;V>=0;V--)T.splice(B[V],1)}}(w,y,r.json.nodes),w}function fN(r){r.heightmap=new Float32Array(4096),r.heightmap.fill(-1);let n=r.vertexArray.float32,l=r.aabb.min[0]-1,d=r.aabb.min[1]-1,p=gu/(r.aabb.max[0]-l+2),m=gu/(r.aabb.max[1]-d+2);for(let y=0;y<n.length;y+=3){let w=n[y+2],T=(n[y+0]-l)*p|0,E=(n[y+1]-d)*m|0;w>r.heightmap[E*gu+T]&&(r.heightmap[E*gu+T]=w)}}function mN(r,n){let l={};l.indexArray=new Us,l.indexArray.reserve(4*r.length),l.vertexArray=new y0,l.vertexArray.reserve(10*r.length),l.colorArray=new Pc,l.vertexArray.reserve(10*r.length);let d=0;for(let y of r){let w=Math.min(10,Math.max(4,1.3*y.height))*n,T=[-y.normal[1],y.normal[0],0],E=Math.min(.29,.1*y.width/y.depth),I=y.width-2*y.depth*n*(E+.01),R=i.N.scaleAndAdd([],y.pos,T,I/2),F=i.N.scaleAndAdd([],y.pos,T,-I/2),B=[R[0],R[1],R[2]+y.height],V=[F[0],F[1],F[2]+y.height],W=i.N.scaleAndAdd([],y.normal,T,E);i.N.scale(W,W,w);let $=i.N.scaleAndAdd([],y.normal,T,-E);i.N.scale($,$,w),i.N.add(W,R,W),i.N.add($,F,$),R[2]+=.1,F[2]+=.1,l.vertexArray.emplaceBack(W[0],W[1],W[2]),l.vertexArray.emplaceBack($[0],$[1],$[2]),l.vertexArray.emplaceBack(R[0],R[1],R[2]),l.vertexArray.emplaceBack(F[0],F[1],F[2]),l.vertexArray.emplaceBack(B[0],B[1],B[2]),l.vertexArray.emplaceBack(V[0],V[1],V[2]),l.vertexArray.emplaceBack(R[0],R[1],R[2]),l.vertexArray.emplaceBack(F[0],F[1],F[2]),l.vertexArray.emplaceBack(W[0],W[1],W[2]),l.vertexArray.emplaceBack($[0],$[1],$[2]);let J=I/w/2;l.colorArray.emplaceBack(-J-E,-1,J,.8),l.colorArray.emplaceBack(J+E,-1,J,.8),l.colorArray.emplaceBack(-J,0,J,1.3),l.colorArray.emplaceBack(J,0,J,1.3),l.colorArray.emplaceBack(J+E,-.8,J,.7),l.colorArray.emplaceBack(J+E,-.8,J,.7),l.colorArray.emplaceBack(0,0,J,1.3),l.colorArray.emplaceBack(0,0,J,1.3),l.colorArray.emplaceBack(J+E,-1.2,J,.8),l.colorArray.emplaceBack(J+E,-1.2,J,.8),l.indexArray.emplaceBack(6+d,4+d,8+d),l.indexArray.emplaceBack(7+d,9+d,5+d),l.indexArray.emplaceBack(0+d,1+d,2+d),l.indexArray.emplaceBack(1+d,3+d,2+d),d+=10}let p={defined:!0,emissiveFactor:[0,0,0]},m={};return m.baseColorFactor=qr.white,p.pbrMetallicRoughness=m,l.material=p,l.aabb=new os([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),l}hi(bM,"TriangleGridIndex");class TM{constructor(n){this._stringToNumber={},this._numberToString=[];for(let l=0;l<n.length;l++){let d=n[l];this._stringToNumber[d]=l,this._numberToString[l]=d}}encode(n){return this._stringToNumber[n]}decode(n){return this._numberToString[n]}}let gN=["tile","layer","source","sourceLayer","state"];class MM{constructor(n,l,d,p,m){this.type="Feature",this._vectorTileFeature=n,this._z=l,this._x=d,this._y=p,this.properties=n.properties,this.id=m}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(n){this._geometry=n}toJSON(){let n={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(n.id=this.id);for(let l of gN)this[l]!==void 0&&(n[l]=this[l]);return n}}class EM{constructor(n,l){this.tileID=n,this.x=n.canonical.x,this.y=n.canonical.y,this.z=n.canonical.z,this.grid=new Ol(ii,16,0),this.featureIndexArray=new c4,this.promoteId=l,this.is3DTile=!1}insert(n,l,d,p,m,y=0,w=0){let T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(d,p,m,y);let E=this.grid;for(let I=0;I<l.length;I++){let R=l[I],F=[1/0,1/0,-1/0,-1/0];for(let B=0;B<R.length;B++){let V=R[B];F[0]=Math.min(F[0],V.x),F[1]=Math.min(F[1],V.y),F[2]=Math.max(F[2],V.x),F[3]=Math.max(F[3],V.y)}w!==0&&(F[0]-=w,F[1]-=w,F[2]+=w,F[3]+=w),F[0]<ii&&F[1]<ii&&F[2]>=0&&F[3]>=0&&E.insert(T,F[0],F[1],F[2],F[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Ev(new $p(this.rawTileData)).layers,this.sourceLayerCoder=new TM(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(let n in this.vtLayers)this.vtFeatures[n]=[]}return this.vtLayers}query(n,l,d,p){this.loadVTLayers();let m=n.params||{},y=oa(m.filter),w=n.tileResult,T=n.transform,E=w.bufferedTilespaceBounds,I=this.grid.query(E.min.x,E.min.y,E.max.x,E.max.y,(V,W,$,J)=>X9(w.bufferedTilespaceGeometry,V,W,$,J));I.sort(_N);let R=null;T.elevation&&I.length>0&&(R=jp.create(T.elevation,this.tileID));let F={},B;for(let V=0;V<I.length;V++){let W=I[V];if(W===B)continue;B=W;let $=this.featureIndexArray.get(W),J=null;if(this.is3DTile){let le=this.bucketLayerIDs[0][0],pe=l[le];if(pe.type!=="model")continue;let{queryFeature:ue,intersectionZ:Me}=pe.queryIntersectsMatchingFeature(w,$.featureIndex,y,T);ue&&this.appendToResult(F,le,$.featureIndex,ue,Me)}else this.loadMatchingFeature(F,$,y,m.layers,m.availableImages,l,d,p,(le,pe,ue,Me=0)=>(J||(J=Gs(le,this.tileID.canonical,n.tileTransform)),pe.queryIntersectsFeature(w,le,ue,J,this.z,n.transform,n.pixelPosMatrix,R,Me)))}return F}loadMatchingFeature(n,l,d,p,m,y,w,T,E){let{featureIndex:I,bucketIndex:R,sourceLayerIndex:F,layoutVertexArrayOffset:B}=l,V=this.bucketLayerIDs[R];if(p&&!function(le,pe){for(let ue=0;ue<le.length;ue++)if(pe.indexOf(le[ue])>=0)return!0;return!1}(p,V))return;let W=this.sourceLayerCoder.decode(F),$=this.vtLayers[W].feature(I);if(d.needGeometry){let le=Rs($,!0);if(!d.filter(new Yr(this.tileID.overscaledZ),le,this.tileID.canonical))return}else if(!d.filter(new Yr(this.tileID.overscaledZ),$))return;let J=this.getId($,W);for(let le=0;le<V.length;le++){let pe=V[le];if(p&&p.indexOf(pe)<0)continue;let ue=y[pe];if(!ue)continue;let Me={};J!==void 0&&T&&(Me=T.getState(ue.sourceLayer||"_geojsonTileLayer",J));let xe=!E||E($,ue,Me,B);if(!xe)continue;let ke=new MM($,this.z,this.x,this.y,J),Be=Tt({},w[pe]);Be.paint=AM(Be.paint,ue.paint,$,Me,m),Be.layout=AM(Be.layout,ue.layout,$,Me,m),ke.layer=Be,this.appendToResult(n,pe,I,ke,xe)}}appendToResult(n,l,d,p,m){let y=n[l];y===void 0&&(y=n[l]=[]),y.push({featureIndex:d,feature:p,intersectionZ:m})}lookupSymbolFeatures(n,l,d,p,m,y,w,T){let E={};this.loadVTLayers();let I=oa(m);for(let R of n)this.loadMatchingFeature(E,{bucketIndex:d,sourceLayerIndex:p,featureIndex:R,layoutVertexArrayOffset:0},I,y,w,T,l);return E}loadFeature(n){let{featureIndex:l,sourceLayerIndex:d}=n;this.loadVTLayers();let p=this.sourceLayerCoder.decode(d),m=this.vtFeatures[p];if(m[l])return m[l];let y=this.vtLayers[p].feature(l);return m[l]=y,y}hasLayer(n){for(let l of this.bucketLayerIDs)for(let d of l)if(n===d)return!0;return!1}getId(n,l){let d=n.id;if(this.promoteId){let p=typeof this.promoteId=="string"?this.promoteId:this.promoteId[l];p!=null&&(d=n.properties[p]),typeof d=="boolean"&&(d=Number(d))}return d}}function AM(r,n,l,d,p){return Pi(r,(m,y)=>{let w=n instanceof qd?n.get(y):null;return w&&w.evaluate?w.evaluate(l,d,p):w})}function _N(r,n){return n-r}hi(EM,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});let tx=new Float32Array(262144),yu=new Uint8Array(262144);function CM(r){let n=0;if(r.meshes)for(let l of r.meshes)n=Math.max(n,l.aabb.max[2]);if(r.children)for(let l of r.children)n=Math.max(n,CM(l));return n}function IM(r,n,l){if(r.meshes)for(let d of r.meshes)d.aabb.min[0]!==1/0&&l.insert(n,d.aabb.min[0],d.aabb.min[1],d.aabb.max[0],d.aabb.max[1]);if(r.children)for(let d of r.children)IM(d,n,l)}let PM=["","wall","door","roof","window","lamp","logo"];class RM{constructor(n){this.node=n,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:n.id,geometry:[],properties:{height:CM(n)}}}getLocalBounds(){if(!this.node.meshes)return new os([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let n=0,l=new os([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(let d of this.node.meshes)this.node.lightMeshIndex!==n&&l.encapsulate(d.aabb),n++;this.aabb=l}return this.aabb}}class d5{constructor(n,l,d,p,m,y){this.id=l,this.modelTraits|=e1.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,d&&(this.modelTraits|=e1.HasMapboxMeshFeatures),p&&(this.modelTraits|=e1.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=m,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(let w of n)this.nodesInfo.push(new RM(w)),IM(w,y.featureIndexArray.length,y.grid),y.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,y.bucketLayerIDs.length-1,0)}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(n){if(!this.needsUpload)return;let l=this.getNodesInfo();for(let d of l){let p=d.node;this.uploaded?this.updatePbrBuffer(p):Xv(p,n,!0)}for(let d of l)o5(d.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(n){let l=!1;if(!n.meshes)return l;for(let d of n.meshes)d.pbrBuffer&&(d.pbrBuffer.updateData(d.featureArray),l=!0);return l}needsReEvaluation(n,l,d){let p=n.transform.projectionOptions,m=n.style.getBrightness(),y=this.brightness!==m;return!!(!this.uploaded||this.dirty||p.name!==this.projection.name||v2(d.paint.get("model-color").value,y)||v2(d.paint.get("model-color-mix-intensity").value,y)||v2(d.paint.get("model-roughness").value,y)||v2(d.paint.get("model-emissive-strength").value,y)||v2(d.paint.get("model-height-based-emissive-strength-multiplier").value,y))&&(this.projection=p,this.brightness=m,!0)}evaluateScale(n,l){if(n.transform.zoom===this.zoom)return;this.zoom=n.transform.zoom;let d=this.getNodesInfo(),p=this.id.canonical;for(let m of d){let y=m.feature;m.evaluatedScale=l.paint.get("model-scale").evaluate(y,{},p)}}evaluate(n){let l=this.getNodesInfo();for(let d of l){if(!d.node.meshes)continue;let p=d.feature,m=d.node.meshes&&d.node.meshes[0].featureData,y=d.evaluatedColor[2],w=d.evaluatedRMEA[2],T=this.id.canonical;if(d.hasTranslucentParts=!1,m){for(let E=0;E<PM.length;E++){let I=PM[E];I.length&&(p.properties.part=I);let R=n.paint.get("model-color").evaluate(p,{},T),F=n.paint.get("model-color-mix-intensity").evaluate(p,{},T);d.evaluatedColor[E]=[R.r,R.g,R.b,F],d.evaluatedRMEA[E][0]=n.paint.get("model-roughness").evaluate(p,{},T),d.evaluatedRMEA[E][2]=n.paint.get("model-emissive-strength").evaluate(p,{},T),d.evaluatedRMEA[E][3]=R.a,d.emissionHeightBasedParams[E]=n.paint.get("model-height-based-emissive-strength-multiplier").evaluate(p,{},T),!d.hasTranslucentParts&&R.a<1&&(d.hasTranslucentParts=!0)}delete p.properties.part,vN(d,y!==d.evaluatedColor[2]||w!==d.evaluatedRMEA[2],this.modelTraits)}else d.evaluatedRMEA[0][2]=n.paint.get("model-emissive-strength").evaluate(p,{},T);d.evaluatedScale=n.paint.get("model-scale").evaluate(p,{},T),this.updatePbrBuffer(d.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(n,l,d,p){let m=n.findDEMTileFor(d);if(m&&(m.tileID.canonical!==this.terrainTile||l!==this.terrainExaggeration)){if(m.dem&&m.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=m.tileID.overscaledZ;let y=jp.create(n,d,m);if(!y)return;this.modelTraits&e1.HasMapboxMeshFeatures&&this.updateDEM(n,y,d,p);for(let w of this.getNodesInfo()){let T=w.node;if(!T.footprint||!T.footprint.vertices||!T.footprint.vertices.length)continue;let E=T.footprint.vertices,I=y.getElevationAt(E[0].x,E[0].y,!0,!0);for(let R=1;R<E.length;R++)I=Math.min(I,y.getElevationAt(E[R].x,E[R].y,!0,!0));T.elevation=I}}this.terrainTile=m.tileID.canonical,this.terrainExaggeration=l}}updateDEM(n,l,d,p){let m=l._dem._modifiedForSources[p];if(m===void 0&&(l._dem._modifiedForSources[p]=[],m=l._dem._modifiedForSources[p]),m.includes(d.canonical))return;let y=l._dem.dim;m.push(d.canonical);let w=!1;for(let T of this.getNodesInfo()){let E=T.node;if(!E.footprint||!E.footprint.grid)continue;let I=E.footprint.grid,R=l.tileCoordToPixel(I.min.x,I.min.y),F=l.tileCoordToPixel(I.max.x,I.max.y),B=Math.min(Math.min(y-F.y,R.x),Math.min(R.y,y-F.x));if(B<0)continue;let V=Xe(B,2,5),W=Math.max(0,R.x-V),$=Math.max(0,R.y-V),J=Math.min(F.x+V,y-1),le=Math.min(F.y+V,y-1);for(let xe=$;xe<=le;++xe)for(let ke=W;ke<=J;++ke)yu[xe*y+ke]=255;let pe=0,ue=0;for(let xe=0;xe<I.cellsY;++xe)for(let ke=0;ke<I.cellsX;++ke){if(!I.cells[xe*I.cellsX+ke])continue;let Be=l.tileCoordToPixel(I.min.x+ke/I.xScale,I.min.y+xe/I.yScale),We=l.tileCoordToPixel(I.min.x+(ke+1)/I.xScale,I.min.y+(xe+1)/I.yScale);for(let Ke=Be.y;Ke<=Math.min(We.y+1,y-1);++Ke)for(let qe=Be.x;qe<=Math.min(We.x+1,y-1);++qe)yu[Ke*y+qe]===255&&(yu[Ke*y+qe]=0,pe+=l.getElevationAtPixel(qe,Ke),ue++)}let Me=pe/ue;W=Math.max(1,R.x-V),$=Math.max(1,R.y-V),J=Math.min(F.x+V,y-2),le=Math.min(F.y+V,y-2),w=!0;for(let xe=$;xe<=le;++xe)for(let ke=W;ke<=J;++ke)yu[xe*y+ke]===0&&(tx[xe*y+ke]=l._dem.set(ke,xe,Me));for(let xe=1;xe<V;++xe){W=Math.max(1,R.x-xe),$=Math.max(1,R.y-xe),J=Math.min(F.x+xe,y-2),le=Math.min(F.y+xe,y-2);for(let ke=$;ke<=le;++ke)for(let Be=W;Be<=J;++Be){let We=ke*y+Be;if(yu[We]===255){let Ke=0,qe=0,dt=-1,Mt=-1;for(let rt=-1;rt<=1;++rt)for(let vt=-1;vt<=1;++vt){let it=(ke+rt)*y+Be+vt;if(yu[it]>=xe)continue;let yt=tx[it],Xt=Math.abs(yt);Xt>qe&&(Ke=yt,qe=Xt,dt=vt,Mt=rt)}if(qe>.1){let rt=1-(xe+.5*Math.abs(dt*Mt))/V,vt=l._dem.get(Be,ke)+Ke*rt,it=l._dem.get(Be+dt,ke+Mt),yt=l._dem.get(Be-dt,ke-Mt,!0);(vt-it)*(vt-yt)>0&&(vt=(it+yt)/2),tx[We]=l._dem.set(Be,ke,vt),yu[We]=xe}}}}}w&&(l._demTile.needsDEMTextureUpload=!0,l._dem._timestamp=at.now())}getNodesInfo(){return this.nodesInfo}destroy(){let n=this.getNodesInfo();for(let l of n)o5(l.node),Zv(l.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(n,l){if(l.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=l.updateTime;let d=l.getReplacementRegionsForTile(n.toUnwrapped()),p=this.getNodesInfo();for(let m=0;m<this.nodesInfo.length;m++){let y=p[m].node;p[m].hiddenByReplacement=!!y.footprint&&!d.find(w=>w.footprint===y.footprint)}}getHeightAtTileCoord(n,l){let d=this.getNodesInfo(),p=[];for(let m=0;m<this.nodesInfo.length;m++){let y=d[m],w=y.node.meshes[0];if(n<w.aabb.min[0]||l<w.aabb.min[1]||n>w.aabb.max[0]||l>w.aabb.max[1])continue;let T=(n-w.aabb.min[0])/(w.aabb.max[0]-w.aabb.min[0])*gu|0,E=Math.min(63,(l-w.aabb.min[1])/(w.aabb.max[1]-w.aabb.min[1])*gu|0)*gu+Math.min(63,T);if(!(w.heightmap[E]<0&&y.node.footprint))return y.hiddenByReplacement?void 0:{height:w.heightmap[E],maxHeight:y.feature.properties.height,hidden:!1,verticalScale:y.evaluatedScale[2]};if(y.node.footprint.grid.query(new de(n,l),new de(n,l),p),p.length>0)return{height:void 0,maxHeight:y.feature.properties.height,hidden:y.hiddenByReplacement,verticalScale:y.evaluatedScale[2]}}}}function v2(r,n){return!r.isLightConstant&&n}function yN(r,n,l,d,p,m,y,w){let T=(61440&n|(61440&n)>>4)>>8,E=(3840&n|(3840&n)>>4)>>4,I=240&n|(240&n)>>4;l[3]>0&&(T=Tn(T,255*l[0],l[3]),E=Tn(E,255*l[1],l[3]),I=Tn(I,255*l[2],l[3]));let R=T<<8|E,F=I<<8|Math.floor(255*d[3]),B=function(xe){let ke=Xe(xe,0,2);return Math.min(Math.round(.5*ke*255),255)}(d[2])<<8|15*d[0]<<4|15*d[1],V=Xe(p[0],0,1),W=Xe(p[1],0,1),$=Xe(p[2],0,1),J=Xe(p[3],0,1),le,pe,ue,Me;if(V!==W&&y!==m&&W!==V){let xe=y-m;pe=1/(xe*(W-V)),ue=-(m+xe*V)/(xe*(W-V));let ke=Xe(p[4],-1,1);Me=Math.pow(10,ke),le=255*$<<8|255*J}else le=65535,pe=0,ue=1,Me=1;if(r.emplaceBack(R,F,B,le,pe,ue,Me),w){let xe=w.length;w.clear();for(let ke=0;ke<xe;ke++)w.emplaceBack(R,F,B,le,pe,ue,Me)}}function vN(r,n,l){let d=r.node,p=0,m=l&e1.HasMeshoptCompression;for(let y of d.meshes){if(d.lights&&d.lightMeshIndex===p||!y.featureData)continue;y.featureArray=new su,y.featureArray.reserve(y.featureData.length);let w=n;for(let T of y.featureData){let E=m?65535&T:T>>16&65535,I=m?T>>16&65535:65535&T,R=(15&I)<8?15&I:0,F=r.evaluatedRMEA[R],B=r.evaluatedColor[R],V=r.emissionHeightBasedParams[R],W;if(w&&R===2&&d.lights&&(W=new su,W.resize(10*d.lights.length)),yN(y.featureArray,E,B,F,V,y.aabb.min[2],y.aabb.max[2],W),W&&w){w=!1;let $=d.meshes[d.lightMeshIndex];$.featureArray=W,$.featureArray._trim()}}y.featureArray._trim(),p++}}function kM(r,n,l,d){let p=1<<r.z;n.lat=Wn((d/ii+r.y)/p),n.lng=an((l/ii+r.x)/p)}hi(d5,"Tiled3dModelBucket",{omit:["layers"]}),hi(RM,"Tiled3dModelFeature");let xN={circle:class extends Wo{constructor(r,n,l){super(r,uL,n,l)}createBucket(r){return new Zo(r)}queryRadius(r){let n=r;return Vp("circle-radius",this,n)+Vp("circle-stroke-width",this,n)+y4(this.paint.get("circle-translate"))}queryIntersectsFeature(r,n,l,d,p,m,y,w){let T=$9(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),m.angle,r.pixelToTileUnitsFactor),E=this.paint.get("circle-radius").evaluate(n,l)+this.paint.get("circle-stroke-width").evaluate(n,l);return wS(r,d,m,y,w,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",T,E)}getProgramIds(){return["circle"]}getDefaultProgramParams(r,n){let l=bS(this);return{config:new X(this,n),defines:l,overrideFog:!1}}},heatmap:class extends Wo{createBucket(r){return new TS(r)}constructor(r,n,l){super(r,HL,n,l),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){r==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Km({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(r){return Vp("heatmap-radius",this,r)}queryIntersectsFeature(r,n,l,d,p,m,y,w){let T=this.paint.get("heatmap-radius").evaluate(n,l);return wS(r,d,m,y,w,!0,!0,new de(0,0),T)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(r,n){return r==="heatmap"?{config:new X(this,n),overrideFog:!1}:{}}},hillshade:class extends Wo{constructor(r,n,l){super(r,WL,n,l)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(r,n){return{overrideFog:!1}}},fill:class extends Wo{constructor(r,n,l){super(r,sF,n,l)}getProgramIds(){let r=this.paint.get("fill-pattern"),n=r&&r.constantOr(1),l=[n?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&l.push(n&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),l}getDefaultProgramParams(r,n){return{config:new X(this,n),overrideFog:!1}}recalculate(r,n){super.recalculate(r,n);let l=this.paint._values["fill-outline-color"];l.value.kind==="constant"&&l.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(r){return new Mv(r)}queryRadius(){return y4(this.paint.get("fill-translate"))}queryIntersectsFeature(r,n,l,d,p,m){return!r.queryGeometry.isAboveHorizon&&v0(Z9(r.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),m.angle,r.pixelToTileUnitsFactor),d)}isTileClipped(){return!0}},"fill-extrusion":class extends Wo{constructor(r,n,l){super(r,DF,n,l),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(r){return new z4(r)}queryRadius(){return y4(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(r,n,l,d,p,m,y,w,T){let E=$9(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),m.angle,r.pixelToTileUnitsFactor),I=this.paint.get("fill-extrusion-height").evaluate(n,l),R=this.paint.get("fill-extrusion-base").evaluate(n,l),F=[0,0],B=w&&m.elevation,V=m.elevation?m.elevation.exaggeration():1,W=r.tile.getBucket(this);if(B&&W instanceof z4){let ue=W.centroidVertexArray,Me=T+1;Me<ue.length&&(F[0]=ue.geta_centroid_pos0(Me),F[1]=ue.geta_centroid_pos1(Me))}if(F[0]===0&&F[1]===1)return!1;m.projection.name==="globe"&&(d=sT([d],[new de(0,0),new de(ii,ii)],r.tileID.canonical).map(ue=>ue.polygon).flat());let $=B?w:null,[J,le]=function(ue,Me,xe,ke,Be,We,Ke,qe,dt,Mt,rt){return ue.projection.name==="globe"?function(vt,it,yt,Xt,At,fi,oi,Lt,Ni,wi,pi){let Ft=[],Ci=[],xn=vt.projection.upVectorScale(pi,vt.center.lat,vt.worldSize).metersToTile,Hi=[0,0,0,1],bn=[0,0,0,1],nn=(dn,Cr,tr,rr)=>{dn[0]=Cr,dn[1]=tr,dn[2]=rr,dn[3]=1},Vn=rT();yt>0&&(yt+=Vn),Xt+=Vn;for(let dn of it){let Cr=[],tr=[];for(let rr of dn){let ur=rr.x+At.x,ir=rr.y+At.y,Zr=vt.projection.projectTilePoint(ur,ir,pi),wr=vt.projection.upVector(pi,rr.x,rr.y),cs=yt,Os=Xt;if(oi){let ao=aT(ur,ir,yt,Xt,oi,Lt,Ni,wi);cs+=ao.base,Os+=ao.top}yt!==0?nn(Hi,Zr.x+wr[0]*xn*cs,Zr.y+wr[1]*xn*cs,Zr.z+wr[2]*xn*cs):nn(Hi,Zr.x,Zr.y,Zr.z),nn(bn,Zr.x+wr[0]*xn*Os,Zr.y+wr[1]*xn*Os,Zr.z+wr[2]*xn*Os),i.N.transformMat4(Hi,Hi,fi),i.N.transformMat4(bn,bn,fi),Cr.push(new Wp(Hi[0],Hi[1],Hi[2])),tr.push(new Wp(bn[0],bn[1],bn[2]))}Ft.push(Cr),Ci.push(tr)}return[Ft,Ci]}(ue,Me,xe,ke,Be,We,Ke,qe,dt,Mt,rt):Ke?function(vt,it,yt,Xt,At,fi,oi,Lt,Ni){let wi=[],pi=[],Ft=[0,0,0,1];for(let Ci of vt){let xn=[],Hi=[];for(let bn of Ci){let nn=bn.x+Xt.x,Vn=bn.y+Xt.y,dn=aT(nn,Vn,it,yt,fi,oi,Lt,Ni);Ft[0]=nn,Ft[1]=Vn,Ft[2]=dn.base,Ft[3]=1,i.a7.transformMat4(Ft,Ft,At),Ft[3]=Math.max(Ft[3],1e-5);let Cr=new Wp(Ft[0]/Ft[3],Ft[1]/Ft[3],Ft[2]/Ft[3]);Ft[0]=nn,Ft[1]=Vn,Ft[2]=dn.top,Ft[3]=1,i.a7.transformMat4(Ft,Ft,At),Ft[3]=Math.max(Ft[3],1e-5);let tr=new Wp(Ft[0]/Ft[3],Ft[1]/Ft[3],Ft[2]/Ft[3]);xn.push(Cr),Hi.push(tr)}wi.push(xn),pi.push(Hi)}return[wi,pi]}(Me,xe,ke,Be,We,Ke,qe,dt,Mt):function(vt,it,yt,Xt,At){let fi=[],oi=[],Lt=At[8]*it,Ni=At[9]*it,wi=At[10]*it,pi=At[11]*it,Ft=At[8]*yt,Ci=At[9]*yt,xn=At[10]*yt,Hi=At[11]*yt;for(let bn of vt){let nn=[],Vn=[];for(let dn of bn){let Cr=dn.x+Xt.x,tr=dn.y+Xt.y,rr=At[0]*Cr+At[4]*tr+At[12],ur=At[1]*Cr+At[5]*tr+At[13],ir=At[2]*Cr+At[6]*tr+At[14],Zr=At[3]*Cr+At[7]*tr+At[15],wr=rr+Lt,cs=ur+Ni,Os=ir+wi,ao=Math.max(Zr+pi,1e-5),Hr=rr+Ft,es=ur+Ci,Zs=ir+xn,$s=Math.max(Zr+Hi,1e-5);nn.push(new Wp(wr/ao,cs/ao,Os/ao)),Vn.push(new Wp(Hr/$s,es/$s,Zs/$s))}fi.push(nn),oi.push(Vn)}return[fi,oi]}(Me,xe,ke,Be,We)}(m,d,R,I,E,y,$,F,V,m.center.lat,r.tileID.canonical),pe=r.queryGeometry;return function(ue,Me,xe){let ke=1/0;v0(xe,Me)&&(ke=oT(xe,Me[0]));for(let Be=0;Be<Me.length;Be++){let We=Me[Be],Ke=ue[Be];for(let qe=0;qe<We.length-1;qe++){let dt=We[qe],Mt=[dt,We[qe+1],Ke[qe+1],Ke[qe],dt];xl(xe,Mt)&&(ke=Math.min(ke,oT(xe,Mt)))}}return ke!==1/0&&ke}(J,le,pe.isPointQuery()?pe.screenBounds:pe.screenGeometry)}},line:class extends Wo{constructor(r,n,l){super(r,cT,n,l),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(r){if(r==="line-gradient"){let n=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=n._styleExpression&&n._styleExpression.expression instanceof Nd,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(r,n){super.recalculate(r,n),this.paint._values["line-floorwidth"]=mT.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)}createBucket(r){return new Cv(r)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(r,n){let l=pT(this);return{config:new X(this,n),defines:l,overrideFog:!1}}queryRadius(r){let n=r,l=gT(Vp("line-width",this,n),Vp("line-gap-width",this,n)),d=Vp("line-offset",this,n);return l/2+Math.abs(d)+y4(this.paint.get("line-translate"))}queryIntersectsFeature(r,n,l,d,p,m){if(r.queryGeometry.isAboveHorizon)return!1;let y=Z9(r.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),m.angle,r.pixelToTileUnitsFactor),w=r.pixelToTileUnitsFactor/2*gT(this.paint.get("line-width").evaluate(n,l),this.paint.get("line-gap-width").evaluate(n,l)),T=this.paint.get("line-offset").evaluate(n,l);return T&&(d=function(E,I){let R=[],F=new de(0,0);for(let B=0;B<E.length;B++){let V=E[B],W=[];for(let $=0;$<V.length;$++){let J=V[$],le=V[$+1],pe=$===0?F:J.sub(V[$-1])._unit()._perp(),ue=$===V.length-1?F:le.sub(J)._unit()._perp(),Me=pe._add(ue)._unit();Me._mult(1/(Me.x*ue.x+Me.y*ue.y)),W.push(Me._mult(I)._add(J))}R.push(W)}return R}(d,T*r.pixelToTileUnitsFactor)),function(E,I,R){for(let F=0;F<I.length;F++){let B=I[F];if(E.length>=3){for(let V=0;V<B.length;V++)if(Ul(E,B[V]))return!0}if(hu(E,B,R))return!0}return!1}(y,d,w)}isTileClipped(){return!0}},symbol:e5,background:class extends Wo{constructor(r,n,l){super(r,OO,n,l)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(r,n){return{overrideFog:!1}}},raster:tM,"raster-particle":iM,sky:class extends Wo{constructor(r,n,l){super(r,jO,n,l),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){r==="sky-gradient"?this._updateColorRamp():r!=="sky-atmosphere-sun"&&r!=="sky-atmosphere-halo-color"&&r!=="sky-atmosphere-color"&&r!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Km({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(r){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){let n=r.style.light.properties.get("position");return this._lightPosition.azimuthal!==n.azimuthal||this._lightPosition.polar!==n.polar}return!1}getCenter(r,n){if(this.paint.get("sky-type")==="atmosphere"){let d=this.paint.get("sky-atmosphere-sun"),p=!d,m=r.style.light,y=m.properties.get("position");return p&&m.properties.get("anchor")==="viewport"&&Ui("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),p?jv(y.azimuthal,90-y.polar,n):jv(d[0],90-d[1],n)}let l=this.paint.get("sky-gradient-center");return jv(l[0],90-l[1],n)}isSky(){return!0}markSkyboxValid(r){this._skyboxInvalidated=!1,this._lightPosition=r.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){let r=this.paint.get("sky-type");return r==="atmosphere"?["skyboxCapture","skybox"]:r==="gradient"?["skyboxGradient"]:null}},slot:class extends Wo{constructor(r,n,l){super(r,WO,n)}},model:class extends Wo{constructor(r,n,l){super(r,eN,n,l),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(r){return new qv(r)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(r){return r instanceof d5?ii-1:0}queryIntersectsFeature(r,n,l,d,p,m){if(!this.modelManager)return!1;let y=this.modelManager,w=r.tile.getBucket(this);if(!(w&&w instanceof qv))return!1;let T=w;for(let E in T.instancesPerModel){let I=T.instancesPerModel[E];if(I.idToFeaturesIndex.hasOwnProperty(n.id)){let R=I.features[I.idToFeaturesIndex[n.id]],F=y.getModel(E,this.scope);if(!F)return!1;let B=i.a6.create(),V=new je(0,0),W=T.canonical,$=Number.MAX_VALUE;for(let J=0;J<R.instancedDataCount;++J){let le=16*(R.instancedDataOffset+J),pe=I.instancedDataArray.float32,ue=[pe[le+4],pe[le+5],pe[le+6]];kM(W,V,pe[le],0|pe[le+1]),dM(B,F,m,V,R.rotation,R.scale,ue,!1,!1,!1),m.projection.name==="globe"&&(B=Wv(B,m));let Me=i.a6.multiply([],m.projMatrix,B),xe=r.queryGeometry,ke=lM(xe.isPointQuery()?xe.screenBounds:xe.screenGeometry,m,Me,F.aabb);ke!=null&&($=Math.min(ke,$))}return $!==Number.MAX_VALUE&&$}}return!1}_handleOverridablePaintPropertyUpdate(r,n,l){return!(!this.layout||n.isDataDriven()||l.isDataDriven()||r!=="model-color"&&r!=="model-color-mix-intensity"&&r!=="model-rotation"&&r!=="model-scale"&&r!=="model-translation"&&r!=="model-emissive-strength")}_isPropertyZoomDependent(r){let n=this._transitionablePaint._values[r];return n!=null&&n.value!=null&&n.value.expression!=null&&n.value.expression instanceof Gd}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(r,n,l,d){let p=r.tile,m=p.getBucket(this),y=null,w=Number.MAX_VALUE;if(!(m&&m instanceof d5))return{queryFeature:y,intersectionZ:w};let T=m.getNodesInfo()[n];if(T.hiddenByReplacement||!T.node.meshes||!l.filter(new Yr(p.tileID.overscaledZ),T.feature,p.tileID.canonical))return{queryFeature:y,intersectionZ:w};let E=T.node,I=d.calculatePosMatrix(p.tileID.toUnwrapped(),d.worldSize),R=T.evaluatedScale,F=0;d.elevation&&E.elevation&&(F=E.elevation*d.elevation.exaggeration()),i.a6.translate(I,I,[(E.anchor?E.anchor[0]:0)*(R[0]-1),(E.anchor?E.anchor[1]:0)*(R[1]-1),F]),i.a6.scale(I,I,R),i.a6.multiply(I,I,E.matrix);let B=r.queryGeometry,V=B.isPointQuery()?B.screenBounds:B.screenGeometry,W=function(J){let le=i.a6.multiply([],I,J.matrix),pe=i.a6.multiply(le,d.expandedFarZProjMatrix,le);for(let ue=0;ue<J.meshes.length;++ue){let Me=J.meshes[ue];if(ue===J.lightMeshIndex)continue;let xe=lM(V,d,pe,Me.aabb);xe!=null&&(w=Math.min(xe,w))}if(J.children)for(let ue of J.children)W(ue)};if(W(E),w===Number.MAX_VALUE)return{queryFeature:y,intersectionZ:w};let $=new je(0,0);return kM(p.tileID.canonical,$,T.node.anchor[0],T.node.anchor[1]),y={type:"Feature",geometry:{type:"Point",coordinates:[$.lng,$.lat]},properties:T.feature.properties,id:T.feature.id,state:{},layer:this.serialize()},{queryFeature:y,intersectionZ:w}}}},pn={read:function(r,n){return r.readFields(pn._readField,{header_length:0,x:0,y:0,z:0,layers:[]},n)},_readField:function(r,n,l){r===1?n.header_length=l.readFixed32():r===2?n.x=l.readVarint():r===3?n.y=l.readVarint():r===4?n.z=l.readVarint():r===5&&n.layers.push(pn.Layer.read(l,l.readVarint()+l.pos))},PixelFormat:{PIXEL_FORMAT_UNKNOWN:{value:0,options:{}},PIXEL_FORMAT_UINT32:{value:1,options:{}},PIXEL_FORMAT_UINT16:{value:2,options:{}},PIXEL_FORMAT_UINT8:{value:3,options:{}}},Filter:{}};pn.Filter.read=function(r,n){return r.readFields(pn.Filter._readField,{delta_filter:null,filter:null,zigzag_filter:null,bitshuffle_filter:null,byteshuffle_filter:null},n)},pn.Filter._readField=function(r,n,l){r===1?(n.delta_filter=pn.Filter.Delta.read(l,l.readVarint()+l.pos),n.filter="delta_filter"):r===2?(n.zigzag_filter=pn.Filter.Zigzag.read(l,l.readVarint()+l.pos),n.filter="zigzag_filter"):r===3?(n.bitshuffle_filter=pn.Filter.BitShuffle.read(l,l.readVarint()+l.pos),n.filter="bitshuffle_filter"):r===4&&(n.byteshuffle_filter=pn.Filter.ByteShuffle.read(l,l.readVarint()+l.pos),n.filter="byteshuffle_filter")},pn.Filter.Delta={},pn.Filter.Delta.read=function(r,n){return r.readFields(pn.Filter.Delta._readField,{block_size:0},n)},pn.Filter.Delta._readField=function(r,n,l){r===1&&(n.block_size=l.readVarint())},pn.Filter.Zigzag={},pn.Filter.Zigzag.read=function(r,n){return r.readFields(pn.Filter.Zigzag._readField,{},n)},pn.Filter.Zigzag._readField=function(r,n,l){},pn.Filter.BitShuffle={},pn.Filter.BitShuffle.read=function(r,n){return r.readFields(pn.Filter.BitShuffle._readField,{},n)},pn.Filter.BitShuffle._readField=function(r,n,l){},pn.Filter.ByteShuffle={},pn.Filter.ByteShuffle.read=function(r,n){return r.readFields(pn.Filter.ByteShuffle._readField,{},n)},pn.Filter.ByteShuffle._readField=function(r,n,l){},pn.Codec={},pn.Codec.read=function(r,n){return r.readFields(pn.Codec._readField,{gzip_data:null,codec:null,jpeg_image:null,webp_image:null,png_image:null},n)},pn.Codec._readField=function(r,n,l){r===1?(n.gzip_data=pn.Codec.GzipData.read(l,l.readVarint()+l.pos),n.codec="gzip_data"):r===2?(n.jpeg_image=pn.Codec.JpegImage.read(l,l.readVarint()+l.pos),n.codec="jpeg_image"):r===3?(n.webp_image=pn.Codec.WebpImage.read(l,l.readVarint()+l.pos),n.codec="webp_image"):r===4&&(n.png_image=pn.Codec.PngImage.read(l,l.readVarint()+l.pos),n.codec="png_image")},pn.Codec.GzipData={},pn.Codec.GzipData.read=function(r,n){return r.readFields(pn.Codec.GzipData._readField,{},n)},pn.Codec.GzipData._readField=function(r,n,l){},pn.Codec.JpegImage={},pn.Codec.JpegImage.read=function(r,n){return r.readFields(pn.Codec.JpegImage._readField,{},n)},pn.Codec.JpegImage._readField=function(r,n,l){},pn.Codec.WebpImage={},pn.Codec.WebpImage.read=function(r,n){return r.readFields(pn.Codec.WebpImage._readField,{},n)},pn.Codec.WebpImage._readField=function(r,n,l){},pn.Codec.PngImage={},pn.Codec.PngImage.read=function(r,n){return r.readFields(pn.Codec.PngImage._readField,{},n)},pn.Codec.PngImage._readField=function(r,n,l){},pn.DataIndexEntry={},pn.DataIndexEntry.read=function(r,n){return r.readFields(pn.DataIndexEntry._readField,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},n)},pn.DataIndexEntry._readField=function(r,n,l){r===1?n.first_byte=l.readFixed64():r===2?n.last_byte=l.readFixed64():r===3?n.filters.push(pn.Filter.read(l,l.readVarint()+l.pos)):r===4?n.codec=pn.Codec.read(l,l.readVarint()+l.pos):r===5?n.offset=l.readFloat():r===6?n.scale=l.readFloat():r===7&&n.bands.push(l.readString())},pn.Layer={},pn.Layer.read=function(r,n){return r.readFields(pn.Layer._readField,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},n)},pn.Layer._readField=function(r,n,l){r===1?n.version=l.readVarint():r===2?n.name=l.readString():r===3?n.units=l.readString():r===4?n.tilesize=l.readVarint():r===5?n.buffer=l.readVarint():r===6?n.pixel_format=l.readVarint():r===7&&n.data_index.push(pn.DataIndexEntry.read(l,l.readVarint()+l.pos))};let ql={read:function(r,n){return r.readFields(ql._readField,{uint32_values:null,values:null,fixed32_values:null},n)},_readField:function(r,n,l){r===2?(n.uint32_values=ql.Uint32Values.read(l,l.readVarint()+l.pos),n.values="uint32_values"):r===3&&(n.fixed32_values=ql.Fixed32Values.read(l,l.readVarint()+l.pos),n.values="fixed32_values")},Uint32Values:{}};ql.Uint32Values.read=function(r,n){return r.readFields(ql.Uint32Values._readField,{values:[]},n)},ql.Uint32Values._readField=function(r,n,l){r===1&&(n.readValuesInto=function(d){if(d.type!==2)throw new Error(`Unsupported pbf type "${d.type}"`);let p=function(y){return y.type===2?y.readVarint()+y.pos:y.pos+1}(d),m=d.pos;return d.pos=p,function(y){d.pos=m;let w=0;for(;d.pos<p;){let T=d.readVarint();y[w++]=T}return y}}(l))},ql.Fixed32Values={},ql.Fixed32Values.read=function(r,n){return r.readFields(ql.Fixed32Values._readField,{values:[]},n)},ql.Fixed32Values._readField=function(r,n,l){throw new Error("Not implemented")};class bN{constructor(n=0,l=0,d=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=n,this.resetTtl=d,this.size=0,this.ttl=l}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(n){if(this.has(n)){let l=this.items[n];delete this.items[n],this.size--,l.prev!==null&&(l.prev.next=l.next),l.next!==null&&(l.next.prev=l.prev),this.first===l&&(this.first=l.next),this.last===l&&(this.last=l.prev)}return this}entries(n=this.keys()){return n.map(l=>[l,this.get(l)])}evict(n=!1){if(n||this.size>0){let l=this.first;delete this.items[l.key],--this.size==0?(this.first=null,this.last=null):(this.first=l.next,this.first.prev=null)}return this}expiresAt(n){let l;return this.has(n)&&(l=this.items[n].expiry),l}get(n){let l;if(this.has(n)){let d=this.items[n];this.ttl>0&&d.expiry<=Date.now()?this.delete(n):(l=d.value,this.set(n,l,!0))}return l}has(n){return n in this.items}keys(){let n=[],l=this.first;for(;l!==null;)n.push(l.key),l=l.next;return n}set(n,l,d=!1,p=this.resetTtl){let m;if(d||this.has(n)){if(m=this.items[n],m.value=l,d===!1&&p&&(m.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.last!==m){let y=this.last,w=m.next,T=m.prev;this.first===m&&(this.first=m.next),m.next=null,m.prev=this.last,y.next=m,T!==null&&(T.next=w),w!==null&&(w.prev=T)}}else this.max>0&&this.size===this.max&&this.evict(!0),m=this.items[n]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:n,prev:this.last,next:null,value:l},++this.size==1?this.first=m:this.last.next=m;return this.last=m,this}values(n=this.keys()){return n.map(l=>this.get(l))}}function wN(r,n){if(n.length!==4)throw new Error(`Expected data of dimension 4 but got ${n.length}.`);let l=n[3];for(let d=2;d>=1;d--){let p=d===1?1:0,m=d===2?1:0;for(let y=0;y<n[0];y++){let w=n[1]*y;for(let T=p;T<n[1];T++){let E=n[2]*(T+w);for(let I=m;I<n[2];I++){let R=n[3]*(I+E);for(let F=0;F<n[3];F++){let B=R+F;r[B]+=r[B-l]}}}}l*=n[d]}return r}function SN(r){for(let n=0,l=r.length;n<l;n++)r[n]=r[n]>>>1^-(1&r[n]);return r}function TN(r,n){switch(n){case"uint32":return r;case"uint16":for(let l=0;l<r.length;l+=2){let d=r[l],p=r[l+1];r[l]=(240&d)>>4|(61440&d)>>8|(240&p)<<4|61440&p,r[l+1]=15&d|(3840&d)>>4|(15&p)<<8|(3840&p)<<4}return r;case"uint8":for(let l=0;l<r.length;l+=4){let d=r[l],p=r[l+1],m=r[l+2],y=r[l+3];r[l+0]=(192&d)>>6|(192&p)>>4|(192&m)>>2|192&y,r[l+1]=(48&d)>>4|(48&p)>>2|48&m|(48&y)<<2,r[l+2]=(12&d)>>2|12&p|(12&m)<<2|(12&y)<<4,r[l+3]=3&d|(3&p)<<2|(3&m)<<4|(3&y)<<6}return r;default:throw new Error(`Invalid pixel format, "${n}"`)}}class Ih extends Error{constructor(n){super(n),this.name="MRTError"}}var Qa=Uint8Array,n1=Uint16Array,MN=Int32Array,DM=new Qa([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),LM=new Qa([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),EN=new Qa([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),FM=function(r,n){for(var l=new n1(31),d=0;d<31;++d)l[d]=n+=1<<r[d-1];var p=new MN(l[30]);for(d=1;d<30;++d)for(var m=l[d];m<l[d+1];++m)p[m]=m-l[d]<<5|d;return{b:l,r:p}},OM=FM(DM,2),NM=OM.b,AN=OM.r;NM[28]=258,AN[258]=28;for(var CN=FM(LM,0).b,ix=new n1(32768),Ts=0;Ts<32768;++Ts){var r1=(43690&Ts)>>1|(21845&Ts)<<1;ix[Ts]=((65280&(r1=(61680&(r1=(52428&r1)>>2|(13107&r1)<<2))>>4|(3855&r1)<<4))>>8|(255&r1)<<8)>>1}var x2=function(r,n,l){for(var d=r.length,p=0,m=new n1(n);p<d;++p)r[p]&&++m[r[p]-1];var y,w=new n1(n);for(p=1;p<n;++p)w[p]=w[p-1]+m[p-1]<<1;if(l){y=new n1(1<<n);var T=15-n;for(p=0;p<d;++p)if(r[p])for(var E=p<<4|r[p],I=n-r[p],R=w[r[p]-1]++<<I,F=R|(1<<I)-1;R<=F;++R)y[ix[R]>>T]=E}else for(y=new n1(d),p=0;p<d;++p)r[p]&&(y[p]=ix[w[r[p]-1]++]>>15-r[p]);return y},b2=new Qa(288);for(Ts=0;Ts<144;++Ts)b2[Ts]=8;for(Ts=144;Ts<256;++Ts)b2[Ts]=9;for(Ts=256;Ts<280;++Ts)b2[Ts]=7;for(Ts=280;Ts<288;++Ts)b2[Ts]=8;var zM=new Qa(32);for(Ts=0;Ts<32;++Ts)zM[Ts]=5;var IN=x2(b2,9,1),PN=x2(zM,5,1),nx=function(r){for(var n=r[0],l=1;l<r.length;++l)r[l]>n&&(n=r[l]);return n},Xl=function(r,n,l){var d=n/8|0;return(r[d]|r[d+1]<<8)>>(7&n)&l},rx=function(r,n){var l=n/8|0;return(r[l]|r[l+1]<<8|r[l+2]<<16)>>(7&n)},RN=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Zl=function(r,n,l){var d=new Error(n||RN[r]);if(d.code=r,Error.captureStackTrace&&Error.captureStackTrace(d,Zl),!l)throw d;return d},kN=new Qa(0),DN=typeof TextDecoder<"u"&&new TextDecoder;try{DN.decode(kN,{stream:!0})}catch{}let LN={gzip_data:"gzip"},FN={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},ON={uint32:1,uint16:2,uint8:4},NN={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};class BM{constructor(n=1){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=n}getLayer(n){return this.layers[n]}getHeaderLength(n){let l=new Uint8Array(n),d=new DataView(n);if(l[0]!==13)throw new Ih("File is not a valid MRT.");return d.getUint32(1,!0)}parseHeader(n){let l=new Uint8Array(n),d=this.getHeaderLength(n);if(l.length<d)throw new Ih(`Expected header with length >= ${d} but got buffer of length ${l.length}`);let p=new $p(l.subarray(0,d)),m=pn.read(p);if(!isNaN(this.x)&&(this.x!==m.x||this.y!==m.y||this.z!==m.z))throw new Ih(`Invalid attempt to parse header ${m.z}/${m.x}/${m.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=m.x,this.y=m.y,this.z=m.z;for(let y of m.layers)this.layers[y.name]=new zN(y,{cacheSize:this._cacheSize});return this}createDecodingTask(n){let l=[],d=this.getLayer(n.layerName);for(let p=0;p<d.dataIndex.length;p++){let m=d.dataIndex[p],y=m.first_byte-n.firstByte,w=m.last_byte+1-n.firstByte;if(p<n.firstBlock||p>n.lastBlock||d._blocksInProgress.has(p))continue;let T={layerName:d.name,firstByte:y,lastByte:w,pixelFormat:d.pixelFormat,blockIndex:p,blockShape:[m.bands.length].concat(d.bandShape),buffer:d.buffer,codec:m.codec.codec,filters:m.filters.map(E=>E.filter)};d._blocksInProgress.add(p),l.push(T)}return new UM(l,()=>{l.forEach(p=>d._blocksInProgress.delete(p.blockIndex))},(p,m)=>{if(l.forEach(y=>d._blocksInProgress.delete(y.blockIndex)),p)throw p;m.forEach(y=>{this.getLayer(y.layerName).processDecodedData(y)})})}}class zN{constructor({version:n,name:l,units:d,tilesize:p,pixel_format:m,buffer:y,data_index:w},T){if(this.version=n,this.version!==1)throw new Ih(`Cannot parse raster layer encoded with MRT version ${n}`);this.name=l,this.units=d,this.tileSize=p,this.buffer=y,this.pixelFormat=FN[m],this.dataIndex=w,this.bandShape=[p+2*y,p+2*y,ON[this.pixelFormat]],this._decodedBlocks=function(E=1e3,I=0,R=!1){if(isNaN(E)||E<0)throw new TypeError("Invalid max value");if(isNaN(I)||I<0)throw new TypeError("Invalid ttl value");if(typeof R!="boolean")throw new TypeError("Invalid resetTtl value");return new bN(E,I,R)}(T?T.cacheSize:5),this._blocksInProgress=new Set}processDecodedData(n){let l=n.blockIndex.toString();this._decodedBlocks.get(l)||this._decodedBlocks.set(l,n.data)}getBlockForBand(n){let l=0;switch(typeof n){case"string":for(let[d,p]of this.dataIndex.entries()){for(let[m,y]of p.bands.entries())if(y===n)return{bandIndex:l+m,blockIndex:d,blockBandIndex:m};l+=p.bands.length}break;case"number":for(let[d,p]of this.dataIndex.entries()){if(n>=l&&n<l+p.bands.length)return{bandIndex:n,blockIndex:d,blockBandIndex:n-l};l+=p.bands.length}break;default:throw new Ih(`Invalid band \`${JSON.stringify(n)}\`. Expected string or integer.`)}throw new Ih(`Band not found: ${JSON.stringify(n)}`)}getDataRange(n){let l=1/0,d=-1/0,p=1/0,m=-1/0;for(let y of n){let{blockIndex:w}=this.getBlockForBand(y);if(w<0)throw new Ih(`Invalid band: ${JSON.stringify(y)}`);let T=this.dataIndex[w];p=Math.min(p,w),m=Math.max(m,w),l=Math.min(l,T.first_byte),d=Math.max(d,T.last_byte)}return{layerName:this.name,firstByte:l,lastByte:d,firstBlock:p,lastBlock:m}}hasBand(n){let{blockIndex:l}=this.getBlockForBand(n);return l>=0}hasDataForBand(n){let{blockIndex:l}=this.getBlockForBand(n);return l>=0&&!!this._decodedBlocks.get(l.toString())}getBandView(n){let{blockIndex:l,blockBandIndex:d}=this.getBlockForBand(n),p=this._decodedBlocks.get(l.toString());if(!p)throw new Ih(`Data for band ${JSON.stringify(n)} of layer "${this.name}" not decoded.`);let m=this.dataIndex[l],y=this.bandShape.reduce((E,I)=>E*I,1),w=d*y,T=p.subarray(w,w+y);return{data:T,bytes:new Uint8Array(T.buffer).subarray(T.byteOffset,T.byteOffset+T.byteLength),tileSize:this.tileSize,buffer:this.buffer,offset:m.offset,scale:m.scale}}}class UM{constructor(n,l,d){this.tasks=n,this._onCancel=l,this._onComplete=d,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(n,l){this._finalized||(this._onComplete(n,l),this._finalized=!0)}}BM.performDecoding=function(r,n){return Promise.all(n.tasks.map(l=>{let{layerName:d,firstByte:p,lastByte:m,pixelFormat:y,blockShape:w,blockIndex:T,filters:E,codec:I}=l,R=new Uint8Array(r).subarray(p,m+1),F=new Uint32Array(w[0]*w[1]*w[2]),B;if(I!=="gzip_data")throw new Error(`Unhandled codec: ${I}`);return B=function(V,W){if(!globalThis.DecompressionStream&&W==="gzip_data")return Promise.resolve(((pe=function(xe){xe[0]==31&&xe[1]==139&&xe[2]==8||Zl(6,"invalid gzip data");var ke=xe[3],Be=10;4&ke&&(Be+=2+(xe[10]|xe[11]<<8));for(var We=(ke>>3&1)+(ke>>4&1);We>0;We-=!xe[Be++]);return Be+(2&ke)}(le=V))+8>le.length&&Zl(6,"invalid gzip data"),function(xe,ke,Be,We){var Ke=xe.length;if(!Ke||ke.f&&!ke.l)return Be||new Qa(0);var qe=!Be,dt=qe||ke.i!=2,Mt=ke.i;qe&&(Be=new Qa(3*Ke));var rt=function($o){var Oo=Be.length;if($o>Oo){var el=new Qa(Math.max(2*Oo,$o));el.set(Be),Be=el}},vt=ke.f||0,it=ke.p||0,yt=ke.b||0,Xt=ke.l,At=ke.d,fi=ke.m,oi=ke.n,Lt=8*Ke;do{if(!Xt){vt=Xl(xe,it,1);var Ni=Xl(xe,it+1,3);if(it+=3,!Ni){var wi=xe[(tr=4+((it+7)/8|0))-4]|xe[tr-3]<<8,pi=tr+wi;if(pi>Ke){Mt&&Zl(0);break}dt&&rt(yt+wi),Be.set(xe.subarray(tr,pi),yt),ke.b=yt+=wi,ke.p=it=8*pi,ke.f=vt;continue}if(Ni==1)Xt=IN,At=PN,fi=9,oi=5;else if(Ni==2){var Ft=Xl(xe,it,31)+257,Ci=Xl(xe,it+10,15)+4,xn=Ft+Xl(xe,it+5,31)+1;it+=14;for(var Hi=new Qa(xn),bn=new Qa(19),nn=0;nn<Ci;++nn)bn[EN[nn]]=Xl(xe,it+3*nn,7);it+=3*Ci;var Vn=nx(bn),dn=(1<<Vn)-1,Cr=x2(bn,Vn,1);for(nn=0;nn<xn;){var tr,rr=Cr[Xl(xe,it,dn)];if(it+=15&rr,(tr=rr>>4)<16)Hi[nn++]=tr;else{var ur=0,ir=0;for(tr==16?(ir=3+Xl(xe,it,3),it+=2,ur=Hi[nn-1]):tr==17?(ir=3+Xl(xe,it,7),it+=3):tr==18&&(ir=11+Xl(xe,it,127),it+=7);ir--;)Hi[nn++]=ur}}var Zr=Hi.subarray(0,Ft),wr=Hi.subarray(Ft);fi=nx(Zr),oi=nx(wr),Xt=x2(Zr,fi,1),At=x2(wr,oi,1)}else Zl(1);if(it>Lt){Mt&&Zl(0);break}}dt&&rt(yt+131072);for(var cs=(1<<fi)-1,Os=(1<<oi)-1,ao=it;;ao=it){var Hr=(ur=Xt[rx(xe,it)&cs])>>4;if((it+=15&ur)>Lt){Mt&&Zl(0);break}if(ur||Zl(2),Hr<256)Be[yt++]=Hr;else{if(Hr==256){ao=it,Xt=null;break}var es=Hr-254;Hr>264&&(es=Xl(xe,it,(1<<(Ys=DM[nn=Hr-257]))-1)+NM[nn],it+=Ys);var Zs=At[rx(xe,it)&Os],$s=Zs>>4;if(Zs||Zl(3),it+=15&Zs,wr=CN[$s],$s>3){var Ys=LM[$s];wr+=rx(xe,it)&(1<<Ys)-1,it+=Ys}if(it>Lt){Mt&&Zl(0);break}dt&&rt(yt+131072);var zr=yt+es;if(yt<wr){var Ca=0-wr,Ph=Math.min(wr,zr);for(Ca+yt<0&&Zl(3);yt<Ph;++yt)Be[yt]=We[Ca+yt]}for(;yt<zr;++yt)Be[yt]=Be[yt-wr]}}ke.l=Xt,ke.p=ao,ke.b=yt,ke.f=vt,Xt&&(vt=1,ke.m=fi,ke.d=At,ke.n=oi)}while(!vt);return yt!=Be.length&&qe?function($o,Oo,el){return(Oo==null||Oo<0)&&(Oo=0),(el==null||el>$o.length)&&(el=$o.length),new Qa($o.subarray(Oo,el))}(Be,0,yt):Be.subarray(0,yt)}(le.subarray(pe,-8),{i:2},new Qa((($=le)[(J=$.length)-4]|$[J-3]<<8|$[J-2]<<16|$[J-1]<<24)>>>0),void 0)));var $,J,le,pe;let ue=LN[W];if(!ue)throw new Error(`Unhandled codec: ${W}`);let Me=new globalThis.DecompressionStream(ue);return new Response(new Blob([V]).stream().pipeThrough(Me)).arrayBuffer().then(xe=>new Uint8Array(xe))}(R,I).then(V=>{let W=ql.read(new $p(V));if(W.values==="uint32_values")return W.uint32_values.readValuesInto(F),new NN[y](F.buffer);throw new Error(`Unhandled numeric data "${W.values}"`)}),B.then(V=>{for(let W=E.length-1;W>=0;W--)switch(E[W]){case"delta_filter":wN(V,w);break;case"zigzag_filter":SN(V);break;case"bitshuffle_filter":TN(V,y);break;default:throw new Error(`Unhandled filter "${E[W]}"`)}return{layerName:d,blockIndex:T,data:V}}).catch(V=>{throw V})}))},hi(UM,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});let VM=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class sx{static from(n){if(!(n instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[l,d]=new Uint8Array(n,0,2);if(l!==219)throw new Error("Data does not appear to be in a KDBush format.");let p=d>>4;if(p!==1)throw new Error(`Got v${p} data when expected v1.`);let m=VM[15&d];if(!m)throw new Error("Unrecognized array type.");let[y]=new Uint16Array(n,2,1),[w]=new Uint32Array(n,4,1);return new sx(w,y,m,n)}constructor(n,l=64,d=Float64Array,p){if(isNaN(n)||n<0)throw new Error(`Unpexpected numItems value: ${n}.`);this.numItems=+n,this.nodeSize=Math.min(Math.max(+l,2),65535),this.ArrayType=d,this.IndexArrayType=n<65536?Uint16Array:Uint32Array;let m=VM.indexOf(this.ArrayType),y=2*n*this.ArrayType.BYTES_PER_ELEMENT,w=n*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-w%8)%8;if(m<0)throw new Error(`Unexpected typed array class: ${d}.`);p&&p instanceof ArrayBuffer?(this.data=p,this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+w+T,2*n),this._pos=2*n,this._finished=!0):(this.data=new ArrayBuffer(8+y+w+T),this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+w+T,2*n),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+m]),new Uint16Array(this.data,2,1)[0]=l,new Uint32Array(this.data,4,1)[0]=n)}add(n,l){let d=this._pos>>1;return this.ids[d]=d,this.coords[this._pos++]=n,this.coords[this._pos++]=l,d}finish(){let n=this._pos>>1;if(n!==this.numItems)throw new Error(`Added ${n} items when expected ${this.numItems}.`);return ox(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(n,l,d,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:m,coords:y,nodeSize:w}=this,T=[0,m.length-1,0],E=[];for(;T.length;){let I=T.pop()||0,R=T.pop()||0,F=T.pop()||0;if(R-F<=w){for(let $=F;$<=R;$++){let J=y[2*$],le=y[2*$+1];J>=n&&J<=d&&le>=l&&le<=p&&E.push(m[$])}continue}let B=F+R>>1,V=y[2*B],W=y[2*B+1];V>=n&&V<=d&&W>=l&&W<=p&&E.push(m[B]),(I===0?n<=V:l<=W)&&(T.push(F),T.push(B-1),T.push(1-I)),(I===0?d>=V:p>=W)&&(T.push(B+1),T.push(R),T.push(1-I))}return E}within(n,l,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:p,coords:m,nodeSize:y}=this,w=[0,p.length-1,0],T=[],E=d*d;for(;w.length;){let I=w.pop()||0,R=w.pop()||0,F=w.pop()||0;if(R-F<=y){for(let $=F;$<=R;$++)HM(m[2*$],m[2*$+1],n,l)<=E&&T.push(p[$]);continue}let B=F+R>>1,V=m[2*B],W=m[2*B+1];HM(V,W,n,l)<=E&&T.push(p[B]),(I===0?n-d<=V:l-d<=W)&&(w.push(F),w.push(B-1),w.push(1-I)),(I===0?n+d>=V:l+d>=W)&&(w.push(B+1),w.push(R),w.push(1-I))}return T}}function ox(r,n,l,d,p,m){if(p-d<=l)return;let y=d+p>>1;GM(r,n,y,d,p,m),ox(r,n,l,d,y-1,1-m),ox(r,n,l,y+1,p,1-m)}function GM(r,n,l,d,p,m){for(;p>d;){if(p-d>600){let E=p-d+1,I=l-d+1,R=Math.log(E),F=.5*Math.exp(2*R/3),B=.5*Math.sqrt(R*F*(E-F)/E)*(I-E/2<0?-1:1);GM(r,n,l,Math.max(d,Math.floor(l-I*F/E+B)),Math.min(p,Math.floor(l+(E-I)*F/E+B)),m)}let y=n[2*l+m],w=d,T=p;for(w2(r,n,d,l),n[2*p+m]>y&&w2(r,n,d,p);w<T;){for(w2(r,n,w,T),w++,T--;n[2*w+m]<y;)w++;for(;n[2*T+m]>y;)T--}n[2*d+m]===y?w2(r,n,d,T):(T++,w2(r,n,T,p)),T<=l&&(d=T+1),l<=T&&(p=T-1)}}function w2(r,n,l,d){ax(r,l,d),ax(n,2*l,2*d),ax(n,2*l+1,2*d+1)}function ax(r,n,l){let d=r[n];r[n]=r[l],r[l]=d}function HM(r,n,l,d){let p=r-l,m=n-d;return p*p+m*m}i.$=qT,i.A=Mp,i.B=gm,i.C=jn,i.D=$e,i.E=So,i.F=Jr,i.G=qt,i.H=class{constructor(r){this.specification=r}possiblyEvaluate(r,n){return Ki(r.expression.evaluate(n))}interpolate(r,n,l){return{x:Tn(r.x,n.x,l),y:Tn(r.y,n.y,l),z:Tn(r.z,n.z,l),azimuthal:Tn(r.azimuthal,n.azimuthal,l),polar:Tn(r.polar,n.polar,l)}}},i.I=Lv,i.J=Nl,i.K=Yr,i.L=Kn,i.M=class{constructor(r,n,l,d){this.id=r,this.position=n!=null?new je(n[0],n[1]):new je(0,0),this.orientation=l??[0,0,0],this.nodes=d,this.uploaded=!1,this.aabb=new os([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(r,n){if(i.a6.multiply(r.matrix,n,r.matrix),r.meshes)for(let l of r.meshes){let d=os.applyTransform(l.aabb,r.matrix);this.aabb.encapsulate(d)}if(r.children)for(let l of r.children)this._applyTransformations(l,r.matrix)}computeBoundsAndApplyParent(){let r=i.a6.identity([]);for(let n of this.nodes)this._applyTransformations(n,r)}computeModelMatrix(r,n,l,d,p,m,y=!1){dM(this.matrix,this,r.transform,this.position,n,l,d,p,m,y)}upload(r){if(!this.uploaded){for(let n of this.nodes)Xv(n,r);for(let n of this.nodes)o5(n);this.uploaded=!0}}destroy(){for(let r of this.nodes)Zv(r)}},i.O=ht,i.P=de,i.Q=qd,i.R=fr,i.S=xh,i.T=Hv,i.U=Tn,i.V=ii,i.W=Ws,i.X=class{constructor(r){this.specification=r}possiblyEvaluate(r,n){return function([l,d]){let p=Ki([1,l,d]);return{x:p.x,y:p.y,z:p.z}}(r.expression.evaluate(n))}interpolate(r,n,l){return{x:Tn(r.x,n.x,l),y:Tn(r.y,n.y,l),z:Tn(r.z,n.z,l)}}},i.Y=function(r,n,l=0,d=!0){let p=new de(l,l),m=r.sub(p),y=n.add(p),w=[m,new de(y.x,m.y),y,new de(m.x,y.y)];return d&&w.push(m.clone()),w},i.Z=Gd,i._=function(r,n){let l=[];for(let d=0;d<r.length;d++){let p=Ot(d-1,-1,r.length-1),m=Ot(d+1,-1,r.length-1),y=r[d],w=r[m],T=r[p].sub(y).unit(),E=w.sub(y).unit(),I=E.angleWithSep(T.x,T.y),R=T.add(E).unit().mult(-1*n/Math.sin(I/2));l.push(y.add(R))}return l},i.a=Cs,i.a$=function(r){let n=[];for(let l in r)n.push(r[l]);return n},i.a0=X9,i.a1=function(r,n,l=0){return i.N.fromValues(((n.x-l)*r.scale-r.x)*ii,(n.y*r.scale-r.y)*ii,Dr(n.z,n.y))},i.a2=cv,i.a3=hT,i.a4=function(r){let n=1/0,l=1/0,d=-1/0,p=-1/0;for(let m of r)n=Math.min(n,m.x),l=Math.min(l,m.y),d=Math.max(d,m.x),p=Math.max(p,m.y);return{min:new de(n,l),max:new de(d,p)}},i.a5=gn,i.a8=Ul,i.a9=ar,i.aA=U_,i.aB=ls,i.aC=Bt,i.aD=i4,i.aE=Q4,i.aF=function(){sa.isLoading()||sa.isLoaded()||Ic()!=="deferred"||Cm()},i.aG=oa,i.aH=Rs,i.aI=MM,i.aJ=Qi,i.aK=Cv,i.aL=Mv,i.aM=Gs,i.aN=Za,i.aO=Gm,i.aP=uS,i.aQ=R4,i.aR=Gv,i.aS=function(r,n){let l=xh(n.zoom);if(l===0)return Nc(r);let d=T4(r),p=pv(d),m=gn(d.getWest())*n.worldSize,y=gn(d.getEast())*n.worldSize,w=Zi(d.getNorth())*n.worldSize,T=Zi(d.getSouth())*n.worldSize,E=[m,w,0],I=[y,w,0],R=[m,T,0],F=[y,T,0],B=i.a6.invert([],n.globeMatrix);return i.N.transformMat4(E,E,B),i.N.transformMat4(I,I,B),i.N.transformMat4(R,R,B),i.N.transformMat4(F,F,B),p[0]=T0(p[0],R,l),p[1]=T0(p[1],F,l),p[2]=T0(p[2],I,l),p[3]=T0(p[3],E,l),os.fromPoints(p)},i.aT=E4,i.aU=Jm,i.aV=T0,i.aW=Lo,i.aX=DL,i.aY=ei,i.aZ=BM,i.a_=lt,i.aa=Xe,i.ab=ce,i.ac=function(r,n){let l={};for(let d=0;d<n.length;d++){let p=n[d];p in r&&(l[p]=r[p])}return l},i.ad=tt,i.ae=Zi,i.af=class{constructor(r){this.entries={},this.scheduler=r}request(r,n,l,d){let p=this.entries[r]=this.entries[r]||{callbacks:[]};if(p.result){let[m,y]=p.result;return this.scheduler?this.scheduler.add(()=>{d(m,y)},n):d(m,y),()=>{}}return p.callbacks.push(d),p.cancel||(p.cancel=l((m,y)=>{p.result=[m,y];for(let w of p.callbacks)this.scheduler?this.scheduler.add(()=>{w(m,y)},n):w(m,y);setTimeout(()=>delete this.entries[r],3e3)})),()=>{p.result||(p.callbacks=p.callbacks.filter(m=>m!==d),p.callbacks.length||(p.cancel(),delete this.entries[r]))}}},i.ag=Lm,i.ah=function(r,n,l){let d=JSON.stringify(r.request);return r.data&&(this.deduped.entries[d]={result:[null,r.data]}),this.deduped.request(d,{type:"parseTile",isSymbolTile:r.isSymbolTile,zoom:r.tileZoom},p=>{let m=lt(r.request,(y,w,T,E)=>{y?p(y):w&&p(null,{vectorTile:l?void 0:new Ev(new $p(w)),rawData:w,cacheControl:T,expires:E})});return()=>{m.cancel(),p()}},n)},i.ai=function(r){yi++,yi>pt&&(r.getActor().send("enforceCacheSizeLimit",Ve),yi=0)},i.aj=gt,i.ak=Ye,i.al=function(r){return r<=1?1:Math.pow(2,Math.floor(Math.log(r)/Math.LN2))},i.am=Ut,i.an=tM,i.ao=iM,i.ap=eM,i.aq=function(r,n){let l=document.createElement("video");l.muted=!0,l.onloadstart=function(){n(null,l)};for(let d=0;d<r.length;d++){let p=document.createElement("source");kt(r[d])||(l.crossOrigin="Anonymous"),p.src=r[d],l.appendChild(p)}return{cancel:()=>{}}},i.ar=t5,i.as=c2,i.at=an,i.au=Wn,i.av=zl,i.aw=Us,i.ax=qr,i.ay=gr,i.az=y0,i.b=Ls,i.b$=J_,i.b0=function(r,n){let l=[];for(let d in r)d in n||l.push(d);return l},i.b1=bt,i.b2=["type","source","source-layer","minzoom","maxzoom","filter","layout"],i.b3=function(r,n){let{x:l,y:d}=r.point,p=yS(l,d,r.worldSize/r._pixelsPerMercatorPixel,0,0);return i.a6.multiply(p,p,fv(Nc(n)))},i.b5=qp,i.b6=Ka,i.b7=B4,i.b8=function(r,n,l,d,p){let m=5*n+2;r.float32[m+0]=l,r.float32[m+1]=d,r.float32[m+2]=p},i.b9=K4,i.bA=r5,i.bB=nM,i.bC=function(r){let n=nM(r,!0);return i.b4.invert([],[n[0],n[1],n[4],n[5]])},i.bD=hv,i.bE=function(r){let{x:n,y:l}=r.point,{lng:d,lat:p}=r._center;return yS(n,l,r.worldSize,d,p)},i.bF=se,i.bG=_e,i.bH=function(r){let n=Math.round((r+45+360)%360/90)%4;return Ce[n]},i.bI=45,i.bJ=Si,i.bK=_,i.bL=Dc,i.bM=_4,i.bN=To,i.bO=zp,i.bP=g,i.bQ=function(r,n,l){let d=Math.sqrt(r*r+n*n+l*l),p=d>0?Math.acos(l/d)*Le:0,m=r!==0||n!==0?Math.atan2(-n,-r)*Le+90:0;return m<0&&(m+=360),[d,m,p]},i.bR=In,i.bS=os,i.bT=Ki,i.bU=function(r){return[Math.pow(r[0],1/2.2),Math.pow(r[1],1/2.2),Math.pow(r[2],1/2.2)]},i.bV=function(r){return r({pluginStatus:jo,pluginURL:Cc}),Am.on("pluginStateChange",r),r},i.bW=$v,i.bX=a5,i.bY=Jp,i.bZ=Fv,i.b_=Mr,i.ba=FT,i.bb=xl,i.bc=mo,i.bd=GT,i.be=Nv,i.bf=Dv,i.bg=sx,i.bh=Ot,i.bj=De,i.bk=he,i.bl=hn,i.bm=function(r,n,l){r[4*n+0]=l[0],r[4*n+1]=l[1],r[4*n+2]=l[2],r[4*n+3]=l[3]},i.bn=je,i.bo=JT,i.bp=jt,i.bq=dv,i.br=rM,i.bs=Dt,i.bt=mS,i.bu=function(r,n,l,d,p,m,y,w,T){if(T.name==="globe")return mS(r,n,new Dt(l,d,p),!1);let E=c2({z:l,x:d,y:p},T);return new os([(m+E.x/E.scale)*n,n*(E.y/E.scale),y],[(m+E.x2/E.scale)*n,n*(E.y2/E.scale),w])},i.bv=function(r,n,l){let d=0;for(let p=0;p<2;++p){let m=l?l[p]:0;r[p]>m&&(d+=(r[p]-m)*(r[p]-m)),n[p]<m&&(d+=(m-n[p])*(m-n[p]))}return d},i.bw=An,i.bx=oe,i.by=function(r){let n=i.a6.identity(new Float64Array(16));i.a6.multiply(n,r.pixelMatrix,r.globeMatrix);let l=[0,Oe,0],d=[0,Je,0];return i.N.transformMat4(l,l,n),i.N.transformMat4(d,d,n),[l[0]>0&&l[0]<=r.width&&l[1]>0&&l[1]<=r.height&&!gv(r,new je(r.center.lat,90)),d[0]>0&&d[0]<=r.width&&d[1]>0&&d[1]<=r.height&&!gv(r,new je(r.center.lat,-90))]},i.bz=function(r,n){let{scale:l}=r.tileTransform,d=l*ii/(r.tileSize*Math.pow(2,n.zoom-r.tileID.overscaledZ+r.tileID.canonical.z));return i.b4.scale(new Float32Array(4),n.inverseAdjustmentMatrix,[d,d])},i.c=SM,i.c$=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},i.c0=C,i.c1=Ri,i.c2=function(r,n,l){return r.type==="custom"?new GO(r,n):new xN[r.type](r,n,l)},i.c3=function(r){let n=r.indexOf(Rp);return n>=0?r.slice(0,n):r},i.c4=function(r){return r.indexOf(Rp)>=0},i.c5=function(r){let n=r.indexOf(Rp);return n>=0?r.slice(n+1):""},i.c6=function(r){let n=[],l=r.id;return l===void 0&&n.push({message:`layers.${l}: missing required property "id"`}),r.render===void 0&&n.push({message:`layers.${l}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&n.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),n},i.c7=Fi,i.c8=Am,i.c9=et,i.cA=pT,i.cB=(r,n,l,d,p,m)=>{let y=r.transform;return{u_matrix:uT(r,n,l,d),u_texsize:n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:y.calculatePixelsToTileUnitsMatrix(n),u_device_pixel_ratio:p,u_image:0,u_tile_units_to_pixels:dT(n,y),u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:m}},i.cC=(r,n,l,d,p,m,y)=>{let w=r.transform,T=w.calculatePixelsToTileUnitsMatrix(n);return{u_matrix:uT(r,n,l,d),u_pixels_to_tile_units:T,u_device_pixel_ratio:m,u_units_to_pixels:[1/w.pixelsToGLUnits[0],1/w.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:p,u_texsize:fT(l)&&n.lineAtlasTexture?n.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:dT(n,r.transform),u_alpha_discard_threshold:0,u_trim_offset:y,u_emissive_strength:l.paint.get("line-emissive-strength")}},i.cD=Wi,i.cE=Km,i.cF=rT,i.cG=mi,i.cH=z4,i.cI=Sh,i.cJ=450,i.cK=7,i.cL=BO,i.cM=256,i.cN=fv,i.cO=kc,i.cP=Vm,i.cQ=function(r,n,l,d,p){return Xe((r-n)/(l-n)*(p-d)+d,d,p)},i.cR=Cn,i.cS=Wv,i.cT=[1,1,1],i.cU=jp,i.cV=e1,i.cW=yl,i.cX=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(r){let n=NS(new de(0,0),new de(ii,ii),r),l=[];for(let d of this._activeRegions){if(d.hiddenByOverlap||!OS(n,d))continue;let p=vF(d.min,d.max,r);l.push({min:p.min,max:p.max,sourceId:this._sourceIds[d.priority],footprint:d.footprint,footprintTileId:d.tileId})}return l}setSources(r){this._setSources(r.map(n=>({getSourceId:()=>n.cache.id,getFootprints:()=>{let l=[];for(let d of n.cache.getVisibleCoordinates()){let p=n.cache.getTile(d).buckets[n.layer];if(p)for(let m of p.getNodesInfo()){let y=m.node;y.footprint&&l.push({footprint:y.footprint,id:d.toUnwrapped()})}}return l}})))}_addSource(r){let n=r.getFootprints();if(n.length!==0){for(let l of n){if(!l.footprint)continue;let d=NS(l.footprint.min,l.footprint.max,l.id);this._activeRegions.push({min:d.min,max:d.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:l.id,footprint:l.footprint})}this._sourceIds.push(r.getSourceId())}}_computeReplacement(){this._activeRegions.sort((n,l)=>n.priority-l.priority||F4(n.min,l.min)||F4(n.max,l.max));let r=this._activeRegions.length!==this._prevRegions.length;if(!r){let n=0,l=0;for(;!r&&n!==this._activeRegions.length;){let d=this._activeRegions[n],p=this._prevRegions[l];r=d.priority!==p.priority||!FS(d,p),++n,++l}}if(r){++this._updateTime;let n=l=>{let d=this._activeRegions;if(l>=d.length)return l;let p=d[l].priority;for(;l<d.length&&d[l].priority===p;)++l;return l};if(this._sourceIds.length>1){let l=0,d=n(l);for(;l!==d;){let p=l,m=l;for(;p!==d;){let y=this._activeRegions[p];y.hiddenByOverlap=!1;for(let w=0;w<m;w++){let T=this._activeRegions[w];if(!T.hiddenByOverlap&&OS(y,T)&&(y.hiddenByOverlap=BS(y.footprint,y.tileId,T.footprint,T.tileId),y.hiddenByOverlap))break}++p}l=d,d=n(l)}}}}_setSources(r){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let n=r.length-1;n>=0;n--)this._addSource(r[n]);this._computeReplacement()}},i.cY=class{constructor(r){this._createGrid(r),this._createPoles(r)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(let r of this._poleSegments)r.destroy();for(let r of this._gridSegments)r.withSkirts.destroy(),r.withoutSkirts.destroy()}_fillGridMeshWithLods(r,n){let l=new Za,d=new Us,p=[],m=r+1+2,y=n[0]+1,w=n[0]+1+(1+n.length),T=(E,I,R)=>{let F=E===m-1?E-2:E===0?E:E-1;return F+=R?24575:0,[F,I]};for(let E=0;E<m;++E)l.emplaceBack(...T(E,0,!0));for(let E=0;E<y;++E)for(let I=0;I<m;++I)l.emplaceBack(...T(I,E,(I===0||I===m-1)&&!0));for(let E=0;E<n.length;++E){let I=n[E];for(let R=0;R<m;++R)l.emplaceBack(...T(R,I,!0))}for(let E=0;E<n.length;++E){let I=d.length,R=n[E]+1+2,F=new Us;for(let W=0;W<R-1;W++){let $=W===R-2,J=$?m*(w-n.length+E-W):m;for(let le=0;le<m-1;le++){let pe=W*m+le;W===0||$||le===0||le===m-2?(F.emplaceBack(pe+1,pe,pe+J),F.emplaceBack(pe+J,pe+J+1,pe+1)):(d.emplaceBack(pe+1,pe,pe+J),d.emplaceBack(pe+J,pe+J+1,pe+1))}}let B=ls.simpleSegment(0,I,l.length,d.length-I);for(let W=0;W<F.uint16.length;W+=3)d.emplaceBack(F.uint16[W],F.uint16[W+1],F.uint16[W+2]);let V=ls.simpleSegment(0,I,l.length,d.length-I);p.push({withoutSkirts:B,withSkirts:V})}return{vertices:l,indices:d,segments:p}}_createGrid(r){let n=this._fillGridMeshWithLods(Ae,Re);this._gridSegments=n.segments,this._gridBuffer=r.createVertexBuffer(n.vertices,uS.members),this._gridIndexBuffer=r.createIndexBuffer(n.indices,!0)}_createPoles(r){let n=new Us;for(let y=0;y<=Ae;y++)n.emplaceBack(0,y+1,y+2);this._poleIndexBuffer=r.createIndexBuffer(n,!0);let l=new kc,d=new kc,p=new kc,m=new kc;this._poleSegments=[];for(let y=0,w=0;y<_e;y++){let T=360/(1<<y);l.emplaceBack(0,-ce,0,.5,0),d.emplaceBack(0,-ce,0,.5,1),p.emplaceBack(0,-ce,0,.5,.5),m.emplaceBack(0,-ce,0,.5,.5);for(let E=0;E<=Ae;E++){let I=E/Ae,R=0,F=Tn(0,T,I),[B,V,W]=Ue(OL,NL,F,ce);l.emplaceBack(B,V,W,I,R),d.emplaceBack(B,V,W,I,1-R);let $=De(F);I=.5+.5*Math.sin($),R=.5+.5*Math.cos($),p.emplaceBack(B,V,W,I,R),m.emplaceBack(B,V,W,I,1-R)}this._poleSegments.push(ls.simpleSegment(w,0,66,64)),w+=66}this._poleNorthVertexBuffer=r.createVertexBuffer(l,w4,!1),this._poleSouthVertexBuffer=r.createVertexBuffer(d,w4,!1),this._texturedPoleNorthVertexBuffer=r.createVertexBuffer(p,w4,!1),this._texturedPoleSouthVertexBuffer=r.createVertexBuffer(m,w4,!1)}getGridBuffers(r,n){return[this._gridBuffer,this._gridIndexBuffer,n?this._gridSegments[r].withSkirts:this._gridSegments[r].withoutSkirts]}getPoleBuffers(r,n){return[n?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,n?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[r]]}},i.cZ=function(r){return Dn.has(r)},i.c_=zt,i.ca=c,i.cb=class extends Bl{constructor(r){super(r),this.current=b}set(r,n,l){if(this.fetchUniformLocation(r,n)){for(let d=0;d<9;d++)if(l[d]!==this.current[d]){this.current=l,this.gl.uniformMatrix3fv(this.location,!1,l);break}}}},i.cc=Ne,i.cd=function(r,n,l){let d=xh(l.zoom),p=r.style.map._antialias,m=n.options.extStandardDerivativesForceOff||r.terrain&&r.terrain.exaggeration()>0;return d===0&&!p&&!m},i.ce=function(r){let n=r.pixelsPerMeter,l=n/hn(1,r.center.lat),d=i.a6.identity(new Float64Array(16));return i.a6.translate(d,d,[r.point.x,r.point.y,0]),i.a6.scale(d,d,[l,l,n]),Float32Array.from(d)},i.cf=T4,i.cg=function(r){let n=An-5;r=Xe(r,-n,n)/n*90;let l=Math.pow(Math.abs(Math.sin(De(r))),3);return Math.round(l*(Re.length-1))},i.ch=function(r,n,l,d){let p=n.getNorth(),m=n.getSouth(),y=n.getWest(),w=n.getEast(),T=1<<r.z,E=w-y,I=p-m,R=E/Ae,F=-I/Re[l],B=[0,R,0,F,0,0,p,y,0];if(r.z>0){let V=180/d;i.co.multiply(B,B,[V/E+1,0,0,0,V/I+1,0,-.5*V/R,.5*V/F,1])}return B[2]=T,B[5]=r.x,B[8]=r.y,B},i.ci=Nc,i.cj=function(r,n,l){let d=i.a6.identity(new Float64Array(16)),p=(n/(1<<r)-.5)*Math.PI*2;return i.a6.rotateY(d,l.globeMatrix,p),Float32Array.from(d)},i.ck=class{isDataAvailableAtPoint(r){let n=this._source();if(this.isUsingMockSource()||!n||r.y<0||r.y>1)return!1;let l=n.getSource().maxzoom,d=1<<l,p=Math.floor(r.x),m=Math.floor((r.x-p)*d),y=Math.floor(r.y*d),w=this.findDEMTileFor(new Ut(l,p,l,m,y));return!(!w||!w.dem)}getAtPointOrZero(r,n=0){return this.getAtPoint(r,n)||0}getAtPoint(r,n,l=!0){if(this.isUsingMockSource())return null;n==null&&(n=null);let d=this._source();if(!d||r.y<0||r.y>1)return n;let p=d.getSource().maxzoom,m=1<<p,y=Math.floor(r.x),w=r.x-y,T=new Ut(p,y,p,Math.floor(w*m),Math.floor(r.y*m)),E=this.findDEMTileFor(T);if(!E||!E.dem)return n;let I=E.dem,R=1<<E.tileID.canonical.z,F=(w*R-E.tileID.canonical.x)*I.dim,B=(r.y*R-E.tileID.canonical.y)*I.dim,V=Math.floor(F),W=Math.floor(B);return(l?this.exaggeration():1)*Tn(Tn(I.get(V,W),I.get(V,W+1),B-W),Tn(I.get(V+1,W),I.get(V+1,W+1),B-W),F-V)}getAtTileOffset(r,n,l){let d=1<<r.canonical.z;return this.getAtPointOrZero(new Kn(r.wrap+(r.canonical.x+n/ii)/d,(r.canonical.y+l/ii)/d))}getAtTileOffsetFunc(r,n,l,d){return p=>{let m=this.getAtTileOffset(r,p.x,p.y),y=d.upVector(r.canonical,p.x,p.y),w=d.upVectorScale(r.canonical,n,l).metersToTile;return i.N.scale(y,y,m*w),y}}getForTilePoints(r,n,l,d){if(this.isUsingMockSource())return!1;let p=jp.create(this,r,d);return!!p&&(n.forEach(m=>{m[2]=this.exaggeration()*p.getElevationAt(m[0],m[1],l)}),!0)}getMinMaxForTile(r){if(this.isUsingMockSource())return null;let n=this.findDEMTileFor(r);if(!n||!n.dem)return null;let l=n.dem.tree,d=n.tileID,p=1<<r.canonical.z-d.canonical.z,m=r.canonical.x/p-d.canonical.x,y=r.canonical.y/p-d.canonical.y,w=0;for(let T=0;T<r.canonical.z-d.canonical.z&&!l.leaves[w];T++){m*=2,y*=2;let E=2*Math.floor(y)+Math.floor(m);w=l.childOffsets[w]+E,m%=1,y%=1}return{min:this.exaggeration()*l.minimums[w],max:this.exaggeration()*l.maximums[w]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(r,n,l){throw new Error("Pure virtual method called.")}pointCoordinate(r){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(r){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){let r=this.visibleDemTiles;if(r.length===0)return null;let n=!1,l=Number.MAX_VALUE,d=Number.MIN_VALUE;for(let p of r){let m=this.getMinMaxForTile(p.tileID);m&&(l=Math.min(l,m.min),d=Math.max(d,m.max),n=!0)}return n?{min:l,max:d}:null}},i.cl=S4,i.cm=AS,i.cn=function(r,n){return[Math.pow(r[0],2.2)*n,Math.pow(r[1],2.2)*n,Math.pow(r[2],2.2)*n]},i.cp=_S,i.cq=256,i.cr=function(r,n){let l=[0,0,0],d=E4(Nc(n.canonical));return i.N.transformMat4(l,l,d),i.N.transformMat4(l,l,r),l},i.cs=r=>({u_camera_to_center_distance:new To(r),u_extrude_scale:new A(r),u_device_pixel_ratio:new To(r),u_matrix:new _(r),u_inv_rot_matrix:new _(r),u_merc_center:new Dc(r),u_tile_id:new _4(r),u_zoom_transition:new To(r),u_up_dir:new _4(r),u_emissive_strength:new To(r)}),i.ct=r=>({u_matrix:new _(r),u_pixels_to_tile_units:new A(r),u_device_pixel_ratio:new To(r),u_units_to_pixels:new Dc(r),u_dash_image:new zp(r),u_gradient_image:new zp(r),u_image_height:new To(r),u_texsize:new Dc(r),u_tile_units_to_pixels:new To(r),u_alpha_discard_threshold:new To(r),u_trim_offset:new Dc(r),u_emissive_strength:new To(r)}),i.cu=r=>({u_matrix:new _(r),u_texsize:new Dc(r),u_pixels_to_tile_units:new A(r),u_device_pixel_ratio:new To(r),u_image:new zp(r),u_units_to_pixels:new Dc(r),u_tile_units_to_pixels:new To(r),u_alpha_discard_threshold:new To(r),u_trim_offset:new Dc(r)}),i.cv=Lp,i.cw=ZF,i.cx=$F,i.cy=bS,i.cz=(r,n,l,d,p,m)=>{let y=r.transform,w=y.projection.name==="globe",T;if(m.paint.get("circle-pitch-alignment")==="map")if(w){let I=_S(y.zoom,n.canonical)*y._pixelsPerMercatorPixel;T=Float32Array.from([I,0,0,I])}else T=y.calculatePixelsToTileUnitsMatrix(l);else T=new Float32Array([y.pixelsToGLUnits[0],0,0,y.pixelsToGLUnits[1]]);let E={u_camera_to_center_distance:r.transform.getCameraToCenterDistance(y.projection),u_matrix:r.translatePosMatrix(n.projMatrix,l,m.paint.get("circle-translate"),m.paint.get("circle-translate-anchor")),u_device_pixel_ratio:at.devicePixelRatio,u_extrude_scale:T,u_inv_rot_matrix:zL,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:m.paint.get("circle-emissive-strength")};if(w){E.u_inv_rot_matrix=d,E.u_merc_center=p,E.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],E.u_zoom_transition=xh(y.zoom);let I=p[0]*ii,R=p[1]*ii;E.u_up_dir=y.projection.upVector(new Dt(0,0,0),I,R)}return E},i.d=Kt,i.d0=Ge,i.d1=er,i.d2=ot,i.d3=function([r,n,l]){let d=Math.hypot(r,n,l),p=Math.atan2(r,l),m=.5*Math.PI-Math.acos(-n/d);return new je(se(p),se(m))},i.d4=nt,i.d5=x,i.d6=gv,i.d7=vS,i.d8=function(r){let n=[0,0,0],l=i.a6.identity(new Float64Array(16));return i.a6.multiply(l,r.pixelMatrix,r.globeMatrix),i.N.transformMat4(n,n,l),new de(n[0],n[1])},i.d9=function(r){let n=r.navigator?r.navigator.userAgent:null;return!!function(l){if(ze==null){let d=l.navigator?l.navigator.userAgent:null;ze=!!l.safari||!(!d||!(/\b(iPad|iPhone|iPod)\b/.test(d)||d.match("Safari")&&!d.match("Chrome")))}return ze}(r)&&n&&(n.match("Version/15.4")||n.match("Version/15.5")||n.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},i.dA=jl,i.dB=TM,i.dC=EM,i.dD=lT,i.dE=Pi,i.dF=NT,i.dG=function(r,n,l,d,p,m,y,w,T,E,I){r.createArrays(),r.tilePixelRatio=ii/(512*r.overscaling),r.compareText={},r.iconsNeedLinear=!1;let R=r.layers[0].layout,F=r.layers[0]._unevaluatedLayout._values,B={};if(r.textSizeData.kind==="composite"){let{minZoom:J,maxZoom:le}=r.textSizeData;B.compositeTextSizes=[F["text-size"].possiblyEvaluate(new Yr(J),w),F["text-size"].possiblyEvaluate(new Yr(le),w)]}if(r.iconSizeData.kind==="composite"){let{minZoom:J,maxZoom:le}=r.iconSizeData;B.compositeIconSizes=[F["icon-size"].possiblyEvaluate(new Yr(J),w),F["icon-size"].possiblyEvaluate(new Yr(le),w)]}B.layoutTextSize=F["text-size"].possiblyEvaluate(new Yr(T+1),w),B.layoutIconSize=F["icon-size"].possiblyEvaluate(new Yr(T+1),w),B.textMaxSize=F["text-size"].possiblyEvaluate(new Yr(18),w);let V=R.get("text-rotation-alignment")==="map"&&R.get("symbol-placement")!=="point",W=R.get("text-size"),$=!1;for(let J of r.features)if(J.icon&&J.icon.nameSecondary){$=!0;break}for(let J of r.features){let le=R.get("text-font").evaluate(J,{},w).join(","),pe=W.evaluate(J,{},w),ue=B.layoutTextSize.evaluate(J,{},w),Me=(B.layoutIconSize.evaluate(J,{},w),{horizontal:{},vertical:void 0}),xe=J.text,ke,Be=[0,0];if(xe){let qe=xe.toString(),dt=R.get("text-letter-spacing").evaluate(J,{},w)*mo,Mt=R.get("text-line-height").evaluate(J,{},w)*mo,rt=Uy(qe)?dt:0,vt=R.get("text-anchor").evaluate(J,{},w),it=R.get("text-variable-anchor");if(!it){let oi=R.get("text-radial-offset").evaluate(J,{},w);Be=oi?GT(vt,[oi*mo,Ov]):R.get("text-offset").evaluate(J,{},w).map(Lt=>Lt*mo)}let yt=V?"center":R.get("text-justify").evaluate(J,{},w),Xt=R.get("symbol-placement")==="point",At=Xt?R.get("text-max-width").evaluate(J,{},w)*mo:1/0,fi=oi=>{r.allowVerticalPlacement&&Ac(qe)&&(Me.vertical=kv(xe,n,l,p,le,At,Mt,vt,oi,rt,Be,Ka.vertical,!0,ue,pe))};if(!V&&it){let oi=yt==="auto"?it.map(Ni=>Nv(Ni)):[yt],Lt=!1;for(let Ni=0;Ni<oi.length;Ni++){let wi=oi[Ni];if(!Me.horizontal[wi])if(Lt)Me.horizontal[wi]=Me.horizontal[0];else{let pi=kv(xe,n,l,p,le,At,Mt,"center",wi,rt,Be,Ka.horizontal,!1,ue,pe);pi&&(Me.horizontal[wi]=pi,Lt=pi.positionedLines.length===1)}}fi("left")}else{if(yt==="auto"&&(yt=Nv(vt)),Xt||R.get("text-writing-mode").indexOf("horizontal")>=0||!Ac(qe)){let oi=kv(xe,n,l,p,le,At,Mt,vt,yt,rt,Be,Ka.horizontal,!1,ue,pe);oi&&(Me.horizontal[yt]=oi)}fi(Xt?"left":yt)}}let We=!1;if(J.icon&&J.icon.namePrimary){let qe=d[J.icon.namePrimary];qe&&(ke=fO(p[J.icon.namePrimary],J.icon.nameSecondary?p[J.icon.nameSecondary]:void 0,R.get("icon-offset").evaluate(J,{},w),R.get("icon-anchor").evaluate(J,{},w)),We=qe.sdf,r.sdfIcons===void 0?r.sdfIcons=qe.sdf:r.sdfIcons!==qe.sdf&&Ui("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(qe.pixelRatio!==r.pixelRatio||R.get("icon-rotate").constantOr(1)!==0)&&(r.iconsNeedLinear=!0))}let Ke=jT(Me.horizontal)||Me.vertical;r.iconsInText||(r.iconsInText=!!Ke&&Ke.iconsInText),(Ke||ke)&&bO(r,J,Me,ke,d,B,ue,0,Be,We,y,w,E,I,$)}m&&r.generateCollisionDebugBuffers(T,r.collisionBoxArray)},i.dH=Ev,i.dI=$p,i.dJ=O4,i.dK=G,i.dL=D4,i.dM=k4,i.dN=fe,i.dO=yT,i.dP=function(r){let n=0;if(new Uint32Array(r,0,1)[0]!==gM){let l=new Uint32Array(r,0,7),[,,d,p,m,y]=l;n=l.byteLength+p+m+y+m,(d!==r.byteLength||n>=r.byteLength)&&Ui("Invalid b3dm header information.")}return xM(r,n)},i.dQ=function(r,n){let l=SM(r);for(let d of l){for(let p of d.meshes)fN(p);d.lights&&(d.lightMeshIndex=d.meshes.length,d.meshes.push(mN(d.lights,n)))}return l},i.dR=d5,i.dS=uM,i.dT=sa,i.dU=function(r){Mi(),ut&&ut.then(n=>{n.keys().then(l=>{for(let d=0;d<l.length-r;d++)n.delete(l[d])})})},i.da=class{constructor(r,n,l){this._transformRequestFn=r,this._customAccessToken=n,this._silenceAuthErrors=!!l,this._createSkuToken()}_createSkuToken(){let r=function(){let n="";for(let l=0;l<10;l++)n+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Gt,n].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=r.token,this._skuTokenExpiresAt=r.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(r,n){return this._transformRequestFn&&this._transformRequestFn(r,n)||{url:r}}normalizeStyleURL(r,n){if(!C(r))return r;let l=Gi(r);return l.params.push(`sdk=js-${f}`),l.path=`/styles/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||n)}normalizeGlyphsURL(r,n){if(!C(r))return r;let l=Gi(r);return l.path=`/fonts/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||n)}normalizeModelURL(r,n){if(!C(r))return r;let l=Gi(r);return l.path=`/models/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||n)}normalizeSourceURL(r,n,l,d){if(!C(r))return r;let p=Gi(r);return p.path=`/v4/${p.authority}.json`,p.params.push("secure"),l&&p.params.push(`language=${l}`),d&&p.params.push(`worldview=${d}`),this._makeAPIURL(p,this._customAccessToken||n)}normalizeSpriteURL(r,n,l,d){let p=Gi(r);return C(r)?(p.path=`/styles/v1${p.path}/sprite${n}${l}`,this._makeAPIURL(p,this._customAccessToken||d)):(p.path+=`${n}${l}`,kn(p))}normalizeTileURL(r,n,l){if(this._isSkuTokenExpired()&&this._createSkuToken(),r&&!C(r))return r;let d=Gi(r);d.path=d.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${n||l&&d.authority!=="raster"&&l===512?"@2x":""}${Vi.supported?".webp":"$1"}`),d.authority==="raster"?d.path=`/${x.RASTER_URL_PREFIX}${d.path}`:d.authority==="rasterarrays"?d.path=`/${x.RASTERARRAYS_URL_PREFIX}${d.path}`:(d.path=d.path.replace(/^.+\/v4\//,"/"),d.path=`/${x.TILE_URL_VERSION}${d.path}`);let p=this._customAccessToken||function(m){for(let y of m){let w=y.match(/^access_token=(.*)$/);if(w)return w[1]}return null}(d.params)||x.ACCESS_TOKEN;return x.REQUIRE_ACCESS_TOKEN&&p&&this._skuToken&&d.params.push(`sku=${this._skuToken}`),this._makeAPIURL(d,p)}canonicalizeTileURL(r,n){let l=Gi(r);if(!l.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!l.path.match(/\.[\w]+$/))return r;let d="mapbox://";l.path.match(/^\/raster\/v1\//)?d+=`raster/${l.path.replace(`/${x.RASTER_URL_PREFIX}/`,"")}`:l.path.match(/^\/rasterarrays\/v1\//)?d+=`rasterarrays/${l.path.replace(`/${x.RASTERARRAYS_URL_PREFIX}/`,"")}`:d+=`tiles/${l.path.replace(`/${x.TILE_URL_VERSION}/`,"")}`;let p=l.params;return n&&(p=p.filter(m=>!m.match(/^access_token=/))),p.length&&(d+=`?${p.join("&")}`),d}canonicalizeTileset(r,n){let l=!!n&&C(n),d=[];for(let p of r.tiles||[])M(p)?d.push(this.canonicalizeTileURL(p,l)):d.push(p);return d}_makeAPIURL(r,n){let l="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",d=Gi(x.API_URL);if(r.protocol=d.protocol,r.authority=d.authority,r.protocol==="http"){let p=r.params.indexOf("secure");p>=0&&r.params.splice(p,1)}if(d.path!=="/"&&(r.path=`${d.path}${r.path}`),!x.REQUIRE_ACCESS_TOKEN)return kn(r);if(n=n||x.ACCESS_TOKEN,!this._silenceAuthErrors){if(!n)throw new Error(`An API access token is required to use Mapbox GL. ${l}`);if(n[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${l}`)}return r.params=r.params.filter(p=>p.indexOf("access_token")===-1),r.params.push(`access_token=${n||""}`),kn(r)}},i.db=function(r,n){n?Dn.add(r):Dn.delete(r)},i.dc=Vi,i.dd=cn,i.de=Qn,i.df=ri,i.dg=Qt,i.dh=function(r){Dn.delete(r)},i.di=Ji,i.dj=ft,i.dk=f,i.dl=function(r,n){Ve=r,pt=n},i.dm=function(r,n,l=!1){if(jo===wm||jo===Sm||jo===Tm)throw new Error("setRTLTextPlugin cannot be called multiple times.");Cc=at.resolveURL(r),jo=wm,Mm=n,Em(),l||Cm()},i.dn=Ic,i.dp=function(){a5().acquire(Yv)},i.dq=function(){let r=_2;r&&(r.isPreloaded()&&r.numActive()===1?(r.release(Yv),_2=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},i.dr=g2,i.ds=function(r){let n=Vt();if(!n)return;let l=n.delete(ye);r&&l.catch(r).then(()=>r())},i.dt=m2,i.du=pM,i.dv=function(r){Jv=at.resolveURL(r),i1||(i1=new $v(a5(),new So)),i1.broadcast("setDracoUrl",Jv)},i.dw=fM,i.dx=function(r){t1=at.resolveURL(r),i1||(i1=new $v(a5(),new So)),i1.broadcast("setMeshoptUrl",t1)},i.dy=hi,i.dz=bh,i.e=Tt,i.f=at,i.g=function(r,n){return et(Tt(r,{type:"json"}),n)},i.h=Ja,i.i=eh,i.j=r0,i.k=Tp,i.l=function(r){return fetch(r).then(n=>n.arrayBuffer()).then(n=>xM(n,0,r))},i.m=H_,i.n=Vd,i.o=Zd,i.p=OT,i.q=Cp,i.r=Ap,i.s=_m,i.t=Fd,i.u=Xd,i.v=so,i.w=Ui,i.x=sh,i.z=Rm}),s(["./shared"],function(i){"use strict";function f(ze){let te=ze?ze.url.toString():void 0;return te?performance.getEntriesByName(te):[]}function v(ze){if(typeof ze=="number"||typeof ze=="boolean"||typeof ze=="string"||ze==null)return JSON.stringify(ze);if(Array.isArray(ze)){let he="[";for(let Se of ze)he+=`${v(Se)},`;return`${he}]`}let te="{";for(let he of Object.keys(ze).sort())te+=`${he}:${v(ze[he])},`;return`${te}}`}function x(ze){let te="";for(let he of i.b2)te+=`/${v(ze[he])}`;return te}class M{constructor(te){this.keyCache={},this._layers={},this._layerConfigs={},te&&this.replace(te)}replace(te,he){this._layerConfigs={},this._layers={},this.update(te,[],he)}update(te,he,Se){this._options=Se;for(let Ye of te)this._layerConfigs[Ye.id]=Ye,(this._layers[Ye.id]=i.c2(Ye,this.scope,this._options)).compileFilter(),this.keyCache[Ye.id]&&delete this.keyCache[Ye.id];for(let Ye of he)delete this.keyCache[Ye],delete this._layerConfigs[Ye],delete this._layers[Ye];this.familiesBySource={};let He=function(Ye,at){let ye={};for(let pt=0;pt<Ye.length;pt++){let ut=at&&at[Ye[pt].id]||x(Ye[pt]);at&&(at[Ye[pt].id]=ut);let St=ye[ut];St||(St=ye[ut]=[]),St.push(Ye[pt])}let Ve=[];for(let pt in ye)Ve.push(ye[pt]);return Ve}(i.a$(this._layerConfigs),this.keyCache);for(let Ye of He){let at=Ye.map(Vt=>this._layers[Vt.id]),ye=at[0];if(ye.visibility==="none")continue;let Ve=ye.source||"",pt=this.familiesBySource[Ve];pt||(pt=this.familiesBySource[Ve]={});let ut=ye.sourceLayer||"_geojsonTileLayer",St=pt[ut];St||(St=pt[ut]=[]),St.push(at)}}}let C=1*i.dA;class D{constructor(te){let he={},Se=[];for(let ye in te){let Ve=te[ye],pt=he[ye]={};for(let ut in Ve.glyphs){let St=Ve.glyphs[+ut];if(!St||St.bitmap.width===0||St.bitmap.height===0)continue;let Vt=St.metrics.localGlyph?C:1,Mi={x:0,y:0,w:St.bitmap.width+2*Vt,h:St.bitmap.height+2*Vt};Se.push(Mi),pt[ut]=Mi}}let{w:He,h:Ye}=i.p(Se),at=new i.dz({width:He||1,height:Ye||1});for(let ye in te){let Ve=te[ye];for(let pt in Ve.glyphs){let ut=Ve.glyphs[+pt];if(!ut||ut.bitmap.width===0||ut.bitmap.height===0)continue;let St=he[ye][pt],Vt=ut.metrics.localGlyph?C:1;i.dz.copy(ut.bitmap,at,{x:0,y:0},{x:St.x+Vt,y:St.y+Vt},ut.bitmap)}}this.image=at,this.positions=he}}i.dy(D,"GlyphAtlas");class L{constructor(te){this.tileID=new i.am(te.tileID.overscaledZ,te.tileID.wrap,te.tileID.canonical.z,te.tileID.canonical.x,te.tileID.canonical.y),this.tileZoom=te.tileZoom,this.uid=te.uid,this.zoom=te.zoom,this.canonical=te.tileID.canonical,this.pixelRatio=te.pixelRatio,this.tileSize=te.tileSize,this.source=te.source,this.scope=te.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=te.showCollisionBoxes,this.collectResourceTiming=!!te.collectResourceTiming,this.promoteId=te.promoteId,this.isSymbolTile=te.isSymbolTile,this.tileTransform=i.as(te.tileID.canonical,te.projection),this.projection=te.projection,this.brightness=te.brightness,this.extraShadowCaster=!!te.extraShadowCaster}parse(te,he,Se,He,Ye){this.status="parsing",this.data=te,this.collisionBoxArray=new i.aD;let at=new i.dB(Object.keys(te.layers).sort()),ye=new i.dC(this.tileID,this.promoteId);ye.bucketLayerIDs=[];let Ve={},pt=new i.dD(256,256),ut={featureIndex:ye,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:pt,availableImages:Se,brightness:this.brightness},St=he.familiesBySource[this.source];for(let Pe in St){let Zt=te.layers[Pe];if(!Zt)continue;let ni=!1,gi=!1,qi=!1;for(let mr of St[Pe])mr[0].type==="symbol"?ni=!0:gi=!0,mr[0].is3D()&&mr[0].type!=="model"&&(qi=!0);if(this.extraShadowCaster&&!qi||this.isSymbolTile===!0&&!ni||this.isSymbolTile===!1&&!gi)continue;Zt.version===1&&i.w(`Vector tile source "${this.source}" layer "${Pe}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let $n=at.encode(Pe),fr=[];for(let mr=0;mr<Zt.length;mr++){let Mr=Zt.feature(mr),et=ye.getId(Mr,Pe);fr.push({feature:Mr,id:et,index:mr,sourceLayerIndex:$n})}for(let mr of St[Pe]){let Mr=mr[0];(!this.extraShadowCaster||Mr.is3D()&&Mr.type!=="model")&&(this.isSymbolTile!==void 0&&Mr.type==="symbol"!==this.isSymbolTile||Mr.minzoom&&this.zoom<Math.floor(Mr.minzoom)||Mr.maxzoom&&this.zoom>=Mr.maxzoom||Mr.visibility!=="none"&&(N(mr,this.zoom,ut.brightness,Se),(Ve[Mr.id]=Mr.createBucket({index:ye.bucketLayerIDs.length,layers:mr,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:$n,sourceID:this.source,projection:this.projection.spec})).populate(fr,ut,this.tileID.canonical,this.tileTransform),ye.bucketLayerIDs.push(mr.map(et=>et.id))))}}let Vt,Mi,en,Oi;pt.trim();let yi={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Vi=()=>{if(Vt)return this.status="done",Ye(Vt);if(this.extraShadowCaster)this.status="done",Ye(null,{buckets:i.a$(Ve).filter(Pe=>!Pe.isEmpty()),featureIndex:ye,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:ut.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Mi&&en&&Oi){let Pe=new D(Mi),Zt=new i.dF(en,Oi);for(let ni in Ve){let gi=Ve[ni];gi instanceof i.aE?(N(gi.layers,this.zoom,ut.brightness,Se),i.dG(gi,Mi,Pe.positions,en,Zt.iconPositions,this.showCollisionBoxes,Se,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):gi.hasPattern&&(gi instanceof i.aK||gi instanceof i.aL||gi instanceof i.cH)&&(N(gi.layers,this.zoom,ut.brightness,Se),gi.addFeatures(ut,this.tileID.canonical,Zt.patternPositions,Se,this.tileTransform,this.brightness))}this.status="done",Ye(null,{buckets:i.a$(Ve).filter(ni=>!ni.isEmpty()),featureIndex:ye,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Pe.image,lineAtlas:pt,imageAtlas:Zt,brightness:ut.brightness})}};if(!this.extraShadowCaster){let Pe=i.dE(ut.glyphDependencies,gi=>Object.keys(gi).map(Number));Object.keys(Pe).length?He.send("getGlyphs",{uid:this.uid,stacks:Pe,scope:this.scope},(gi,qi)=>{Vt||(Vt=gi,Mi=qi,Vi())},void 0,!1,yi):Mi={};let Zt=Object.keys(ut.iconDependencies);Zt.length?He.send("getImages",{icons:Zt,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(gi,qi)=>{Vt||(Vt=gi,en=qi,Vi())},void 0,!1,yi):en={};let ni=Object.keys(ut.patternDependencies);ni.length?He.send("getImages",{icons:ni,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(gi,qi)=>{Vt||(Vt=gi,Oi=qi,Vi())},void 0,!1,yi):Oi={}}Vi()}}function N(ze,te,he,Se){let He=new i.K(te,{brightness:he});for(let Ye of ze)Ye.recalculate(He,Se)}class j extends i.E{constructor(te,he,Se,He,Ye,at){super(),this.actor=te,this.layerIndex=he,this.availableImages=Se,this.loadVectorData=Ye||i.ah,this.loading={},this.loaded={},this.deduped=new i.af(te.scheduler),this.isSpriteLoaded=He,this.scheduler=te.scheduler,this.brightness=at}loadTile(te,he){let Se=te.uid,He=te&&te.request,Ye=He&&He.collectResourceTiming,at=this.loading[Se]=new L(te);at.abort=this.loadVectorData(te,(ye,Ve)=>{let pt=!this.loading[Se];if(delete this.loading[Se],pt||ye||!Ve)return at.status="done",pt||(this.loaded[Se]=at),he(ye);let ut=Ve.rawData,St={};Ve.expires&&(St.expires=Ve.expires),Ve.cacheControl&&(St.cacheControl=Ve.cacheControl),at.vectorTile=Ve.vectorTile||new i.dH(new i.dI(ut));let Vt=()=>{at.parse(at.vectorTile,this.layerIndex,this.availableImages,this.actor,(Mi,en)=>{if(Mi||!en)return he(Mi);let Oi={};if(Ye){let yi=f(He);yi.length>0&&(Oi.resourceTiming=JSON.parse(JSON.stringify(yi)))}he(null,i.e({rawTileData:ut.slice(0)},en,St,Oi))})};this.isSpriteLoaded?Vt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Vt,{type:"parseTile",isSymbolTile:te.isSymbolTile,zoom:te.tileZoom}):Vt()}),this.loaded=this.loaded||{},this.loaded[Se]=at})}reloadTile(te,he){let Se=this.loaded,He=te.uid,Ye=this;if(Se&&Se[He]){let at=Se[He];at.showCollisionBoxes=te.showCollisionBoxes,at.projection=te.projection,at.brightness=te.brightness,at.tileTransform=i.as(te.tileID.canonical,te.projection),at.extraShadowCaster=te.extraShadowCaster;let ye=(Ve,pt)=>{let ut=at.reloadCallback;ut&&(delete at.reloadCallback,at.parse(at.vectorTile,Ye.layerIndex,this.availableImages,Ye.actor,ut)),he(Ve,pt)};at.status==="parsing"?at.reloadCallback=ye:at.status==="done"&&(at.vectorTile?at.parse(at.vectorTile,this.layerIndex,this.availableImages,this.actor,ye):ye())}else he(null,void 0)}abortTile(te,he){let Se=te.uid,He=this.loading[Se];He&&(He.abort&&He.abort(),delete this.loading[Se]),he()}removeTile(te,he){let Se=this.loaded,He=te.uid;Se&&Se[He]&&delete Se[He],he()}}class Z{loadTile(te,he){let{uid:Se,encoding:He,rawImageData:Ye,padding:at}=te,ye=ImageBitmap&&Ye instanceof ImageBitmap?this.getImageData(Ye,at):Ye;he(null,new i.dJ(Se,ye,He,at<1))}getImageData(te,he){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(te.width,te.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=te.width,this.offscreenCanvas.height=te.height,this.offscreenCanvasContext.drawImage(te,0,0,te.width,te.height);let Se=this.offscreenCanvasContext.getImageData(-he,-he,te.width+2*he,te.height+2*he);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Se}}class G{decodeRasterArray({task:te,buffer:he},Se){i.aZ.performDecoding(he,te).then(He=>{Se(null,He)},He=>{Se(He)})}}function H(ze,te){if(ze.length!==0){me(ze[0],te);for(var he=1;he<ze.length;he++)me(ze[he],!te)}}function me(ze,te){for(var he=0,Se=0,He=0,Ye=ze.length,at=Ye-1;He<Ye;at=He++){var ye=(ze[He][0]-ze[at][0])*(ze[at][1]+ze[He][1]),Ve=he+ye;Se+=Math.abs(he)>=Math.abs(ye)?he-Ve+ye:ye-Ve+he,he=Ve}he+Se>=0!=!!te&&ze.reverse()}var ne=i.dK(function ze(te,he){var Se,He=te&&te.type;if(He==="FeatureCollection")for(Se=0;Se<te.features.length;Se++)ze(te.features[Se],he);else if(He==="GeometryCollection")for(Se=0;Se<te.geometries.length;Se++)ze(te.geometries[Se],he);else if(He==="Feature")ze(te.geometry,he);else if(He==="Polygon")H(te.coordinates,he);else if(He==="MultiPolygon")for(Se=0;Se<te.coordinates.length;Se++)H(te.coordinates[Se],he);return te});let fe=i.dL.prototype.toGeoJSON,Ee=class{constructor(ze){this._feature=ze,this.extent=i.V,this.type=ze.type,this.properties=ze.tags,"id"in ze&&!isNaN(ze.id)&&(this.id=parseInt(ze.id,10))}loadGeometry(){if(this._feature.type===1){let ze=[];for(let te of this._feature.geometry)ze.push([new i.P(te[0],te[1])]);return ze}{let ze=[];for(let te of this._feature.geometry){let he=[];for(let Se of te)he.push(new i.P(Se[0],Se[1]));ze.push(he)}return ze}}toGeoJSON(ze,te,he){return fe.call(this,ze,te,he)}},de=class{constructor(ze){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=i.V,this.length=ze.length,this._features=ze}feature(ze){return new Ee(this._features[ze])}};var we={exports:{}},Le=i.dN,De=i.dM.VectorTileFeature,se=Ce;function Ce(ze,te){this.options=te||{},this.features=ze,this.length=ze.length}function Ne(ze,te){this.id=typeof ze.id=="number"?ze.id:void 0,this.type=ze.type,this.rawGeometry=ze.type===1?[ze.geometry]:ze.geometry,this.properties=ze.tags,this.extent=te||4096}Ce.prototype.feature=function(ze){return new Ne(this.features[ze],this.options.extent)},Ne.prototype.loadGeometry=function(){var ze=this.rawGeometry;this.geometry=[];for(var te=0;te<ze.length;te++){for(var he=ze[te],Se=[],He=0;He<he.length;He++)Se.push(new Le(he[He][0],he[He][1]));this.geometry.push(Se)}return this.geometry},Ne.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ze=this.geometry,te=1/0,he=-1/0,Se=1/0,He=-1/0,Ye=0;Ye<ze.length;Ye++)for(var at=ze[Ye],ye=0;ye<at.length;ye++){var Ve=at[ye];te=Math.min(te,Ve.x),he=Math.max(he,Ve.x),Se=Math.min(Se,Ve.y),He=Math.max(He,Ve.y)}return[te,Se,he,He]},Ne.prototype.toGeoJSON=De.prototype.toGeoJSON;var zt=i.dO,Ge=se;function Xe(ze){var te=new zt;return function(he,Se){for(var He in he.layers)Se.writeMessage(3,ht,he.layers[He])}(ze,te),te.finish()}function ht(ze,te){var he;te.writeVarintField(15,ze.version||1),te.writeStringField(1,ze.name||""),te.writeVarintField(5,ze.extent||4096);var Se={keys:[],values:[],keycache:{},valuecache:{}};for(he=0;he<ze.length;he++)Se.feature=ze.feature(he),te.writeMessage(2,Ot,Se);var He=Se.keys;for(he=0;he<He.length;he++)te.writeStringField(3,He[he]);var Ye=Se.values;for(he=0;he<Ye.length;he++)te.writeMessage(4,Yt,Ye[he])}function Ot(ze,te){var he=ze.feature;he.id!==void 0&&te.writeVarintField(1,he.id),te.writeMessage(2,bt,ze),te.writeVarintField(3,he.type),te.writeMessage(4,Bt,he)}function bt(ze,te){var he=ze.feature,Se=ze.keys,He=ze.values,Ye=ze.keycache,at=ze.valuecache;for(var ye in he.properties){var Ve=he.properties[ye],pt=Ye[ye];if(Ve!==null){pt===void 0&&(Se.push(ye),Ye[ye]=pt=Se.length-1),te.writeVarint(pt);var ut=typeof Ve;ut!=="string"&&ut!=="boolean"&&ut!=="number"&&(Ve=JSON.stringify(Ve));var St=ut+":"+Ve,Vt=at[St];Vt===void 0&&(He.push(Ve),at[St]=Vt=He.length-1),te.writeVarint(Vt)}}}function Tt(ze,te){return(te<<3)+(7&ze)}function Nt(ze){return ze<<1^ze>>31}function Bt(ze,te){for(var he=ze.loadGeometry(),Se=ze.type,He=0,Ye=0,at=he.length,ye=0;ye<at;ye++){var Ve=he[ye],pt=1;Se===1&&(pt=Ve.length),te.writeVarint(Tt(1,pt));for(var ut=Se===3?Ve.length-1:Ve.length,St=0;St<ut;St++){St===1&&Se!==1&&te.writeVarint(Tt(2,ut-1));var Vt=Ve[St].x-He,Mi=Ve[St].y-Ye;te.writeVarint(Nt(Vt)),te.writeVarint(Nt(Mi)),He+=Vt,Ye+=Mi}Se===3&&te.writeVarint(Tt(7,1))}}function Yt(ze,te){var he=typeof ze;he==="string"?te.writeStringField(1,ze):he==="boolean"?te.writeBooleanField(7,ze):he==="number"&&(ze%1!=0?te.writeDoubleField(3,ze):ze<0?te.writeSVarintField(6,ze):te.writeVarintField(5,ze))}we.exports=Xe,we.exports.fromVectorTileJs=Xe,we.exports.fromGeojsonVt=function(ze,te){te=te||{};var he={};for(var Se in ze)he[Se]=new Ge(ze[Se].features,te),he[Se].name=Se,he[Se].version=te.version,he[Se].extent=te.extent;return Xe({layers:he})},we.exports.GeoJSONWrapper=Ge;var Wi=i.dK(we.exports);let wt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ze=>ze},ei=Math.fround||(vi=new Float32Array(1),ze=>(vi[0]=+ze,vi[0]));var vi;let Pi=3,Fi=5,Ri=6;class br{constructor(te){this.options=Object.assign(Object.create(wt),te),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(te){let{log:he,minZoom:Se,maxZoom:He}=this.options;he&&console.time("total time");let Ye=`prepare ${te.length} points`;he&&console.time(Ye),this.points=te;let at=[];for(let Ve=0;Ve<te.length;Ve++){let pt=te[Ve];if(!pt.geometry)continue;let[ut,St]=pt.geometry.coordinates,Vt=ei($r(ut)),Mi=ei(Ki(St));at.push(Vt,Mi,1/0,Ve,-1,1),this.options.reduce&&at.push(0)}let ye=this.trees[He+1]=this._createTree(at);he&&console.timeEnd(Ye);for(let Ve=He;Ve>=Se;Ve--){let pt=+Date.now();ye=this.trees[Ve]=this._createTree(this._cluster(ye,Ve)),he&&console.log("z%d: %d clusters in %dms",Ve,ye.numItems,+Date.now()-pt)}return he&&console.timeEnd("total time"),this}getClusters(te,he){let Se=((te[0]+180)%360+360)%360-180,He=Math.max(-90,Math.min(90,te[1])),Ye=te[2]===180?180:((te[2]+180)%360+360)%360-180,at=Math.max(-90,Math.min(90,te[3]));if(te[2]-te[0]>=360)Se=-180,Ye=180;else if(Se>Ye){let St=this.getClusters([Se,He,180,at],he),Vt=this.getClusters([-180,He,Ye,at],he);return St.concat(Vt)}let ye=this.trees[this._limitZoom(he)],Ve=ye.range($r(Se),Ki(at),$r(Ye),Ki(He)),pt=ye.data,ut=[];for(let St of Ve){let Vt=this.stride*St;ut.push(pt[Vt+Fi]>1?Ui(pt,Vt,this.clusterProps):this.points[pt[Vt+Pi]])}return ut}getChildren(te){let he=this._getOriginId(te),Se=this._getOriginZoom(te),He="No cluster with the specified id.",Ye=this.trees[Se];if(!Ye)throw new Error(He);let at=Ye.data;if(he*this.stride>=at.length)throw new Error(He);let ye=this.options.radius/(this.options.extent*Math.pow(2,Se-1)),Ve=Ye.within(at[he*this.stride],at[he*this.stride+1],ye),pt=[];for(let ut of Ve){let St=ut*this.stride;at[St+4]===te&&pt.push(at[St+Fi]>1?Ui(at,St,this.clusterProps):this.points[at[St+Pi]])}if(pt.length===0)throw new Error(He);return pt}getLeaves(te,he,Se){let He=[];return this._appendLeaves(He,te,he=he||10,Se=Se||0,0),He}getTile(te,he,Se){let He=this.trees[this._limitZoom(te)],Ye=Math.pow(2,te),{extent:at,radius:ye}=this.options,Ve=ye/at,pt=(Se-Ve)/Ye,ut=(Se+1+Ve)/Ye,St={features:[]};return this._addTileFeatures(He.range((he-Ve)/Ye,pt,(he+1+Ve)/Ye,ut),He.data,he,Se,Ye,St),he===0&&this._addTileFeatures(He.range(1-Ve/Ye,pt,1,ut),He.data,Ye,Se,Ye,St),he===Ye-1&&this._addTileFeatures(He.range(0,pt,Ve/Ye,ut),He.data,-1,Se,Ye,St),St.features.length?St:null}getClusterExpansionZoom(te){let he=this._getOriginZoom(te)-1;for(;he<=this.options.maxZoom;){let Se=this.getChildren(te);if(he++,Se.length!==1)break;te=Se[0].properties.cluster_id}return he}_appendLeaves(te,he,Se,He,Ye){let at=this.getChildren(he);for(let ye of at){let Ve=ye.properties;if(Ve&&Ve.cluster?Ye+Ve.point_count<=He?Ye+=Ve.point_count:Ye=this._appendLeaves(te,Ve.cluster_id,Se,He,Ye):Ye<He?Ye++:te.push(ye),te.length===Se)break}return Ye}_createTree(te){let he=new i.bg(te.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Se=0;Se<te.length;Se+=this.stride)he.add(te[Se],te[Se+1]);return he.finish(),he.data=te,he}_addTileFeatures(te,he,Se,He,Ye,at){for(let ye of te){let Ve=ye*this.stride,pt=he[Ve+Fi]>1,ut,St,Vt;if(pt)ut=st(he,Ve,this.clusterProps),St=he[Ve],Vt=he[Ve+1];else{let Oi=this.points[he[Ve+Pi]];ut=Oi.properties;let[yi,Vi]=Oi.geometry.coordinates;St=$r(yi),Vt=Ki(Vi)}let Mi={type:1,geometry:[[Math.round(this.options.extent*(St*Ye-Se)),Math.round(this.options.extent*(Vt*Ye-He))]],tags:ut},en;en=pt||this.options.generateId?he[Ve+Pi]:this.points[he[Ve+Pi]].id,en!==void 0&&(Mi.id=en),at.features.push(Mi)}}_limitZoom(te){return Math.max(this.options.minZoom,Math.min(Math.floor(+te),this.options.maxZoom+1))}_cluster(te,he){let{radius:Se,extent:He,reduce:Ye,minPoints:at}=this.options,ye=Se/(He*Math.pow(2,he)),Ve=te.data,pt=[],ut=this.stride;for(let St=0;St<Ve.length;St+=ut){if(Ve[St+2]<=he)continue;Ve[St+2]=he;let Vt=Ve[St],Mi=Ve[St+1],en=te.within(Ve[St],Ve[St+1],ye),Oi=Ve[St+Fi],yi=Oi;for(let Vi of en){let Pe=Vi*ut;Ve[Pe+2]>he&&(yi+=Ve[Pe+Fi])}if(yi>Oi&&yi>=at){let Vi,Pe=Vt*Oi,Zt=Mi*Oi,ni=-1,gi=(St/ut<<5)+(he+1)+this.points.length;for(let qi of en){let $n=qi*ut;if(Ve[$n+2]<=he)continue;Ve[$n+2]=he;let fr=Ve[$n+Fi];Pe+=Ve[$n]*fr,Zt+=Ve[$n+1]*fr,Ve[$n+4]=gi,Ye&&(Vi||(Vi=this._map(Ve,St,!0),ni=this.clusterProps.length,this.clusterProps.push(Vi)),Ye(Vi,this._map(Ve,$n)))}Ve[St+4]=gi,pt.push(Pe/yi,Zt/yi,1/0,gi,-1,yi),Ye&&pt.push(ni)}else{for(let Vi=0;Vi<ut;Vi++)pt.push(Ve[St+Vi]);if(yi>1)for(let Vi of en){let Pe=Vi*ut;if(!(Ve[Pe+2]<=he)){Ve[Pe+2]=he;for(let Zt=0;Zt<ut;Zt++)pt.push(Ve[Pe+Zt])}}}}return pt}_getOriginId(te){return te-this.points.length>>5}_getOriginZoom(te){return(te-this.points.length)%32}_map(te,he,Se){if(te[he+Fi]>1){let at=this.clusterProps[te[he+Ri]];return Se?Object.assign({},at):at}let He=this.points[te[he+Pi]].properties,Ye=this.options.map(He);return Se&&Ye===He?Object.assign({},Ye):Ye}}function Ui(ze,te,he){return{type:"Feature",id:ze[te+Pi],properties:st(ze,te,he),geometry:{type:"Point",coordinates:[(Se=ze[te],360*(Se-.5)),yn(ze[te+1])]}};var Se}function st(ze,te,he){let Se=ze[te+Fi],He=Se>=1e4?`${Math.round(Se/1e3)}k`:Se>=1e3?Math.round(Se/100)/10+"k":Se,Ye=ze[te+Ri],at=Ye===-1?{}:Object.assign({},he[Ye]);return Object.assign(at,{cluster:!0,cluster_id:ze[te+Pi],point_count:Se,point_count_abbreviated:He})}function $r(ze){return ze/360+.5}function Ki(ze){let te=Math.sin(ze*Math.PI/180),he=.5-.25*Math.log((1+te)/(1-te))/Math.PI;return he<0?0:he>1?1:he}function yn(ze){let te=(180-360*ze)*Math.PI/180;return 360*Math.atan(Math.exp(te))/Math.PI-90}var Qi={exports:{}};Qi.exports=function(){function ze(et,lt,kt,Wt){for(var Ht,Jt=Wt,Kt=kt-lt>>1,Gt=kt-lt,ri=et[lt],$t=et[lt+1],Gi=et[kt],kn=et[kt+1],bi=lt+3;bi<kt;bi+=3){var Te=te(et[bi],et[bi+1],ri,$t,Gi,kn);if(Te>Jt)Ht=bi,Jt=Te;else if(Te===Jt){var Qe=Math.abs(bi-Kt);Qe<Gt&&(Ht=bi,Gt=Qe)}}Jt>Wt&&(Ht-lt>3&&ze(et,lt,Ht,Wt),et[Ht+2]=Jt,kt-Ht>3&&ze(et,Ht,kt,Wt))}function te(et,lt,kt,Wt,Ht,Jt){var Kt=Ht-kt,Gt=Jt-Wt;if(Kt!==0||Gt!==0){var ri=((et-kt)*Kt+(lt-Wt)*Gt)/(Kt*Kt+Gt*Gt);ri>1?(kt=Ht,Wt=Jt):ri>0&&(kt+=Kt*ri,Wt+=Gt*ri)}return(Kt=et-kt)*Kt+(Gt=lt-Wt)*Gt}function he(et,lt,kt,Wt){var Ht={id:et===void 0?null:et,type:lt,geometry:kt,tags:Wt,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Jt){var Kt=Jt.geometry,Gt=Jt.type;if(Gt==="Point"||Gt==="MultiPoint"||Gt==="LineString")Se(Jt,Kt);else if(Gt==="Polygon"||Gt==="MultiLineString")for(var ri=0;ri<Kt.length;ri++)Se(Jt,Kt[ri]);else if(Gt==="MultiPolygon")for(ri=0;ri<Kt.length;ri++)for(var $t=0;$t<Kt[ri].length;$t++)Se(Jt,Kt[ri][$t])}(Ht),Ht}function Se(et,lt){for(var kt=0;kt<lt.length;kt+=3)et.minX=Math.min(et.minX,lt[kt]),et.minY=Math.min(et.minY,lt[kt+1]),et.maxX=Math.max(et.maxX,lt[kt]),et.maxY=Math.max(et.maxY,lt[kt+1])}function He(et,lt,kt,Wt){if(lt.geometry){var Ht=lt.geometry.coordinates,Jt=lt.geometry.type,Kt=Math.pow(kt.tolerance/((1<<kt.maxZoom)*kt.extent),2),Gt=[],ri=lt.id;if(kt.promoteId?ri=lt.properties[kt.promoteId]:kt.generateId&&(ri=Wt||0),Jt==="Point")Ye(Ht,Gt);else if(Jt==="MultiPoint")for(var $t=0;$t<Ht.length;$t++)Ye(Ht[$t],Gt);else if(Jt==="LineString")at(Ht,Gt,Kt,!1);else if(Jt==="MultiLineString"){if(kt.lineMetrics){for($t=0;$t<Ht.length;$t++)at(Ht[$t],Gt=[],Kt,!1),et.push(he(ri,"LineString",Gt,lt.properties));return}ye(Ht,Gt,Kt,!1)}else if(Jt==="Polygon")ye(Ht,Gt,Kt,!0);else{if(Jt!=="MultiPolygon"){if(Jt==="GeometryCollection"){for($t=0;$t<lt.geometry.geometries.length;$t++)He(et,{id:ri,geometry:lt.geometry.geometries[$t],properties:lt.properties},kt,Wt);return}throw new Error("Input data is not a valid GeoJSON object.")}for($t=0;$t<Ht.length;$t++){var Gi=[];ye(Ht[$t],Gi,Kt,!0),Gt.push(Gi)}}et.push(he(ri,Jt,Gt,lt.properties))}}function Ye(et,lt){lt.push(Ve(et[0])),lt.push(pt(et[1])),lt.push(0)}function at(et,lt,kt,Wt){for(var Ht,Jt,Kt=0,Gt=0;Gt<et.length;Gt++){var ri=Ve(et[Gt][0]),$t=pt(et[Gt][1]);lt.push(ri),lt.push($t),lt.push(0),Gt>0&&(Kt+=Wt?(Ht*$t-ri*Jt)/2:Math.sqrt(Math.pow(ri-Ht,2)+Math.pow($t-Jt,2))),Ht=ri,Jt=$t}var Gi=lt.length-3;lt[2]=1,ze(lt,0,Gi,kt),lt[Gi+2]=1,lt.size=Math.abs(Kt),lt.start=0,lt.end=lt.size}function ye(et,lt,kt,Wt){for(var Ht=0;Ht<et.length;Ht++){var Jt=[];at(et[Ht],Jt,kt,Wt),lt.push(Jt)}}function Ve(et){return et/360+.5}function pt(et){var lt=Math.sin(et*Math.PI/180),kt=.5-.25*Math.log((1+lt)/(1-lt))/Math.PI;return kt<0?0:kt>1?1:kt}function ut(et,lt,kt,Wt,Ht,Jt,Kt,Gt){if(Wt/=lt,Jt>=(kt/=lt)&&Kt<Wt)return et;if(Kt<kt||Jt>=Wt)return null;for(var ri=[],$t=0;$t<et.length;$t++){var Gi=et[$t],kn=Gi.geometry,bi=Gi.type,Te=Ht===0?Gi.minX:Gi.minY,Qe=Ht===0?Gi.maxX:Gi.maxY;if(Te>=kt&&Qe<Wt)ri.push(Gi);else if(!(Qe<kt||Te>=Wt)){var ct=[];if(bi==="Point"||bi==="MultiPoint")St(kn,ct,kt,Wt,Ht);else if(bi==="LineString")Vt(kn,ct,kt,Wt,Ht,!1,Gt.lineMetrics);else if(bi==="MultiLineString")en(kn,ct,kt,Wt,Ht,!1);else if(bi==="Polygon")en(kn,ct,kt,Wt,Ht,!0);else if(bi==="MultiPolygon")for(var gt=0;gt<kn.length;gt++){var ft=[];en(kn[gt],ft,kt,Wt,Ht,!0),ft.length&&ct.push(ft)}if(ct.length){if(Gt.lineMetrics&&bi==="LineString"){for(gt=0;gt<ct.length;gt++)ri.push(he(Gi.id,bi,ct[gt],Gi.tags));continue}bi!=="LineString"&&bi!=="MultiLineString"||(ct.length===1?(bi="LineString",ct=ct[0]):bi="MultiLineString"),bi!=="Point"&&bi!=="MultiPoint"||(bi=ct.length===3?"Point":"MultiPoint"),ri.push(he(Gi.id,bi,ct,Gi.tags))}}}return ri.length?ri:null}function St(et,lt,kt,Wt,Ht){for(var Jt=0;Jt<et.length;Jt+=3){var Kt=et[Jt+Ht];Kt>=kt&&Kt<=Wt&&(lt.push(et[Jt]),lt.push(et[Jt+1]),lt.push(et[Jt+2]))}}function Vt(et,lt,kt,Wt,Ht,Jt,Kt){for(var Gt,ri,$t=Mi(et),Gi=Ht===0?yi:Vi,kn=et.start,bi=0;bi<et.length-3;bi+=3){var Te=et[bi],Qe=et[bi+1],ct=et[bi+2],gt=et[bi+3],ft=et[bi+4],Qt=Ht===0?Te:Qe,ji=Ht===0?gt:ft,cn=!1;Kt&&(Gt=Math.sqrt(Math.pow(Te-gt,2)+Math.pow(Qe-ft,2))),Qt<kt?ji>kt&&(ri=Gi($t,Te,Qe,gt,ft,kt),Kt&&($t.start=kn+Gt*ri)):Qt>Wt?ji<Wt&&(ri=Gi($t,Te,Qe,gt,ft,Wt),Kt&&($t.start=kn+Gt*ri)):Oi($t,Te,Qe,ct),ji<kt&&Qt>=kt&&(ri=Gi($t,Te,Qe,gt,ft,kt),cn=!0),ji>Wt&&Qt<=Wt&&(ri=Gi($t,Te,Qe,gt,ft,Wt),cn=!0),!Jt&&cn&&(Kt&&($t.end=kn+Gt*ri),lt.push($t),$t=Mi(et)),Kt&&(kn+=Gt)}var Ji=et.length-3;Te=et[Ji],Qe=et[Ji+1],ct=et[Ji+2],(Qt=Ht===0?Te:Qe)>=kt&&Qt<=Wt&&Oi($t,Te,Qe,ct),Ji=$t.length-3,Jt&&Ji>=3&&($t[Ji]!==$t[0]||$t[Ji+1]!==$t[1])&&Oi($t,$t[0],$t[1],$t[2]),$t.length&&lt.push($t)}function Mi(et){var lt=[];return lt.size=et.size,lt.start=et.start,lt.end=et.end,lt}function en(et,lt,kt,Wt,Ht,Jt){for(var Kt=0;Kt<et.length;Kt++)Vt(et[Kt],lt,kt,Wt,Ht,Jt,!1)}function Oi(et,lt,kt,Wt){et.push(lt),et.push(kt),et.push(Wt)}function yi(et,lt,kt,Wt,Ht,Jt){var Kt=(Jt-lt)/(Wt-lt);return et.push(Jt),et.push(kt+(Ht-kt)*Kt),et.push(1),Kt}function Vi(et,lt,kt,Wt,Ht,Jt){var Kt=(Jt-kt)/(Ht-kt);return et.push(lt+(Wt-lt)*Kt),et.push(Jt),et.push(1),Kt}function Pe(et,lt){for(var kt=[],Wt=0;Wt<et.length;Wt++){var Ht,Jt=et[Wt],Kt=Jt.type;if(Kt==="Point"||Kt==="MultiPoint"||Kt==="LineString")Ht=Zt(Jt.geometry,lt);else if(Kt==="MultiLineString"||Kt==="Polygon"){Ht=[];for(var Gt=0;Gt<Jt.geometry.length;Gt++)Ht.push(Zt(Jt.geometry[Gt],lt))}else if(Kt==="MultiPolygon")for(Ht=[],Gt=0;Gt<Jt.geometry.length;Gt++){for(var ri=[],$t=0;$t<Jt.geometry[Gt].length;$t++)ri.push(Zt(Jt.geometry[Gt][$t],lt));Ht.push(ri)}kt.push(he(Jt.id,Kt,Ht,Jt.tags))}return kt}function Zt(et,lt){var kt=[];kt.size=et.size,et.start!==void 0&&(kt.start=et.start,kt.end=et.end);for(var Wt=0;Wt<et.length;Wt+=3)kt.push(et[Wt]+lt,et[Wt+1],et[Wt+2]);return kt}function ni(et,lt){if(et.transformed)return et;var kt,Wt,Ht,Jt=1<<et.z,Kt=et.x,Gt=et.y;for(kt=0;kt<et.features.length;kt++){var ri=et.features[kt],$t=ri.geometry,Gi=ri.type;if(ri.geometry=[],Gi===1)for(Wt=0;Wt<$t.length;Wt+=2)ri.geometry.push(gi($t[Wt],$t[Wt+1],lt,Jt,Kt,Gt));else for(Wt=0;Wt<$t.length;Wt++){var kn=[];for(Ht=0;Ht<$t[Wt].length;Ht+=2)kn.push(gi($t[Wt][Ht],$t[Wt][Ht+1],lt,Jt,Kt,Gt));ri.geometry.push(kn)}}return et.transformed=!0,et}function gi(et,lt,kt,Wt,Ht,Jt){return[Math.round(kt*(et*Wt-Ht)),Math.round(kt*(lt*Wt-Jt))]}function qi(et,lt,kt,Wt,Ht){for(var Jt=lt===Ht.maxZoom?0:Ht.tolerance/((1<<lt)*Ht.extent),Kt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:kt,y:Wt,z:lt,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Gt=0;Gt<et.length;Gt++){Kt.numFeatures++,$n(Kt,et[Gt],Jt,Ht);var ri=et[Gt].minX,$t=et[Gt].minY,Gi=et[Gt].maxX,kn=et[Gt].maxY;ri<Kt.minX&&(Kt.minX=ri),$t<Kt.minY&&(Kt.minY=$t),Gi>Kt.maxX&&(Kt.maxX=Gi),kn>Kt.maxY&&(Kt.maxY=kn)}return Kt}function $n(et,lt,kt,Wt){var Ht=lt.geometry,Jt=lt.type,Kt=[];if(Jt==="Point"||Jt==="MultiPoint")for(var Gt=0;Gt<Ht.length;Gt+=3)Kt.push(Ht[Gt]),Kt.push(Ht[Gt+1]),et.numPoints++,et.numSimplified++;else if(Jt==="LineString")fr(Kt,Ht,et,kt,!1,!1);else if(Jt==="MultiLineString"||Jt==="Polygon")for(Gt=0;Gt<Ht.length;Gt++)fr(Kt,Ht[Gt],et,kt,Jt==="Polygon",Gt===0);else if(Jt==="MultiPolygon")for(var ri=0;ri<Ht.length;ri++){var $t=Ht[ri];for(Gt=0;Gt<$t.length;Gt++)fr(Kt,$t[Gt],et,kt,!0,Gt===0)}if(Kt.length){var Gi=lt.tags||null;if(Jt==="LineString"&&Wt.lineMetrics){for(var kn in Gi={},lt.tags)Gi[kn]=lt.tags[kn];Gi.mapbox_clip_start=Ht.start/Ht.size,Gi.mapbox_clip_end=Ht.end/Ht.size}var bi={geometry:Kt,type:Jt==="Polygon"||Jt==="MultiPolygon"?3:Jt==="LineString"||Jt==="MultiLineString"?2:1,tags:Gi};lt.id!==null&&(bi.id=lt.id),et.features.push(bi)}}function fr(et,lt,kt,Wt,Ht,Jt){var Kt=Wt*Wt;if(Wt>0&&lt.size<(Ht?Kt:Wt))kt.numPoints+=lt.length/3;else{for(var Gt=[],ri=0;ri<lt.length;ri+=3)(Wt===0||lt[ri+2]>Kt)&&(kt.numSimplified++,Gt.push(lt[ri]),Gt.push(lt[ri+1])),kt.numPoints++;Ht&&function($t,Gi){for(var kn=0,bi=0,Te=$t.length,Qe=Te-2;bi<Te;Qe=bi,bi+=2)kn+=($t[bi]-$t[Qe])*($t[bi+1]+$t[Qe+1]);if(kn>0===Gi)for(bi=0,Te=$t.length;bi<Te/2;bi+=2){var ct=$t[bi],gt=$t[bi+1];$t[bi]=$t[Te-2-bi],$t[bi+1]=$t[Te-1-bi],$t[Te-2-bi]=ct,$t[Te-1-bi]=gt}}(Gt,Jt),et.push(Gt)}}function mr(et,lt){var kt=(lt=this.options=function(Ht,Jt){for(var Kt in Jt)Ht[Kt]=Jt[Kt];return Ht}(Object.create(this.options),lt)).debug;if(kt&&console.time("preprocess data"),lt.maxZoom<0||lt.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(lt.promoteId&&lt.generateId)throw new Error("promoteId and generateId cannot be used together.");var Wt=function(Ht,Jt){var Kt=[];if(Ht.type==="FeatureCollection")for(var Gt=0;Gt<Ht.features.length;Gt++)He(Kt,Ht.features[Gt],Jt,Gt);else He(Kt,Ht.type==="Feature"?Ht:{geometry:Ht},Jt);return Kt}(et,lt);this.tiles={},this.tileCoords=[],kt&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",lt.indexMaxZoom,lt.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(Wt=function(Ht,Jt){var Kt=Jt.buffer/Jt.extent,Gt=Ht,ri=ut(Ht,1,-1-Kt,Kt,0,-1,2,Jt),$t=ut(Ht,1,1-Kt,2+Kt,0,-1,2,Jt);return(ri||$t)&&(Gt=ut(Ht,1,-Kt,1+Kt,0,-1,2,Jt)||[],ri&&(Gt=Pe(ri,1).concat(Gt)),$t&&(Gt=Gt.concat(Pe($t,-1)))),Gt}(Wt,lt)).length&&this.splitTile(Wt,0,0,0),kt&&(Wt.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Mr(et,lt,kt){return 32*((1<<et)*kt+lt)+et}return mr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},mr.prototype.splitTile=function(et,lt,kt,Wt,Ht,Jt,Kt){for(var Gt=[et,lt,kt,Wt],ri=this.options,$t=ri.debug;Gt.length;){Wt=Gt.pop(),kt=Gt.pop(),lt=Gt.pop(),et=Gt.pop();var Gi=1<<lt,kn=Mr(lt,kt,Wt),bi=this.tiles[kn];if(!bi&&($t>1&&console.time("creation"),bi=this.tiles[kn]=qi(et,lt,kt,Wt,ri),this.tileCoords.push({z:lt,x:kt,y:Wt}),$t)){$t>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",lt,kt,Wt,bi.numFeatures,bi.numPoints,bi.numSimplified),console.timeEnd("creation"));var Te="z"+lt;this.stats[Te]=(this.stats[Te]||0)+1,this.total++}if(bi.source=et,Ht){if(lt===ri.maxZoom||lt===Ht)continue;var Qe=1<<Ht-lt;if(kt!==Math.floor(Jt/Qe)||Wt!==Math.floor(Kt/Qe))continue}else if(lt===ri.indexMaxZoom||bi.numPoints<=ri.indexMaxPoints)continue;if(bi.source=null,et.length!==0){$t>1&&console.time("clipping");var ct,gt,ft,Qt,ji,cn,Ji=.5*ri.buffer/ri.extent,Qn=.5-Ji,Dn=.5+Ji,Hn=1+Ji;ct=gt=ft=Qt=null,ji=ut(et,Gi,kt-Ji,kt+Dn,0,bi.minX,bi.maxX,ri),cn=ut(et,Gi,kt+Qn,kt+Hn,0,bi.minX,bi.maxX,ri),et=null,ji&&(ct=ut(ji,Gi,Wt-Ji,Wt+Dn,1,bi.minY,bi.maxY,ri),gt=ut(ji,Gi,Wt+Qn,Wt+Hn,1,bi.minY,bi.maxY,ri),ji=null),cn&&(ft=ut(cn,Gi,Wt-Ji,Wt+Dn,1,bi.minY,bi.maxY,ri),Qt=ut(cn,Gi,Wt+Qn,Wt+Hn,1,bi.minY,bi.maxY,ri),cn=null),$t>1&&console.timeEnd("clipping"),Gt.push(ct||[],lt+1,2*kt,2*Wt),Gt.push(gt||[],lt+1,2*kt,2*Wt+1),Gt.push(ft||[],lt+1,2*kt+1,2*Wt),Gt.push(Qt||[],lt+1,2*kt+1,2*Wt+1)}}},mr.prototype.getTile=function(et,lt,kt){var Wt=this.options,Ht=Wt.extent,Jt=Wt.debug;if(et<0||et>24)return null;var Kt=1<<et,Gt=Mr(et,lt=(lt%Kt+Kt)%Kt,kt);if(this.tiles[Gt])return ni(this.tiles[Gt],Ht);Jt>1&&console.log("drilling down to z%d-%d-%d",et,lt,kt);for(var ri,$t=et,Gi=lt,kn=kt;!ri&&$t>0;)$t--,Gi=Math.floor(Gi/2),kn=Math.floor(kn/2),ri=this.tiles[Mr($t,Gi,kn)];return ri&&ri.source?(Jt>1&&console.log("found parent tile z%d-%d-%d",$t,Gi,kn),Jt>1&&console.time("drilling down"),this.splitTile(ri.source,$t,Gi,kn,et,lt,kt),Jt>1&&console.timeEnd("drilling down"),this.tiles[Gt]?ni(this.tiles[Gt],Ht):null):null},function(et,lt){return new mr(et,lt)}}();var Gn=i.dK(Qi.exports);function Fn(ze,te){let he=ze.tileID.canonical;if(!this._geoJSONIndex)return te(null,null);let Se=this._geoJSONIndex.getTile(he.z,he.x,he.y);if(!Se)return te(null,null);let He=new de(Se.features),Ye=Wi(He);Ye.byteOffset===0&&Ye.byteLength===Ye.buffer.byteLength||(Ye=new Uint8Array(Ye)),te(null,{vectorTile:He,rawData:Ye.buffer})}class Ie extends j{constructor(te,he,Se,He,Ye,at){super(te,he,Se,He,Fn,at),Ye&&(this.loadGeoJSON=Ye)}loadData(te,he){let Se=te&&te.request,He=Se&&Se.collectResourceTiming;this.loadGeoJSON(te,(Ye,at)=>{if(Ye||!at)return he(Ye);if(typeof at!="object")return he(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`));{ne(at,!0);try{if(te.filter){let Ve=i.r(te.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ve.result==="error")throw new Error(Ve.value.map(ut=>`${ut.key}: ${ut.message}`).join(", "));at={type:"FeatureCollection",features:at.features.filter(ut=>Ve.value.evaluate({zoom:0},ut))}}this._geoJSONIndex=te.cluster?new br(function({superclusterOptions:Ve,clusterProperties:pt}){if(!pt||!Ve)return Ve;let ut={},St={},Vt={accumulated:null,zoom:0},Mi={properties:null},en=Object.keys(pt);for(let Oi of en){let[yi,Vi]=pt[Oi],Pe=i.r(Vi),Zt=i.r(typeof yi=="string"?[yi,["accumulated"],["get",Oi]]:yi);ut[Oi]=Pe.value,St[Oi]=Zt.value}return Ve.map=Oi=>{Mi.properties=Oi;let yi={};for(let Vi of en)yi[Vi]=ut[Vi].evaluate(Vt,Mi);return yi},Ve.reduce=(Oi,yi)=>{Mi.properties=yi;for(let Vi of en)Vt.accumulated=Oi[Vi],Oi[Vi]=St[Vi].evaluate(Vt,Mi)},Ve}(te)).load(at.features):Gn(at,te.geojsonVtOptions)}catch(Ve){return he(Ve)}this.loaded={};let ye={};if(He){let Ve=f(Se);Ve&&(ye.resourceTiming={},ye.resourceTiming[te.source]=JSON.parse(JSON.stringify(Ve)))}he(null,ye)}})}reloadTile(te,he){let Se=this.loaded;return Se&&Se[te.uid]?super.reloadTile(te,he):this.loadTile(te,he)}loadGeoJSON(te,he){if(te.request)i.g(te.request,he);else{if(typeof te.data!="string")return he(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`));try{return he(null,JSON.parse(te.data))}catch{return he(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(te,he){try{he(null,this._geoJSONIndex.getClusterExpansionZoom(te.clusterId))}catch(Se){he(Se)}}getClusterChildren(te,he){try{he(null,this._geoJSONIndex.getChildren(te.clusterId))}catch(Se){he(Se)}}getClusterLeaves(te,he){try{he(null,this._geoJSONIndex.getLeaves(te.clusterId,te.limit,te.offset))}catch(Se){he(Se)}}}class be{constructor(te,he){this.tileID=new i.am(te.tileID.overscaledZ,te.tileID.wrap,te.tileID.canonical.z,te.tileID.canonical.x,te.tileID.canonical.y),this.tileZoom=te.tileZoom,this.uid=te.uid,this.zoom=te.zoom,this.canonical=te.tileID.canonical,this.pixelRatio=te.pixelRatio,this.tileSize=te.tileSize,this.source=te.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=te.projection,this.brightness=he}parse(te,he,Se,He){this.status="parsing";let Ye=new i.am(Se.tileID.overscaledZ,Se.tileID.wrap,Se.tileID.canonical.z,Se.tileID.canonical.x,Se.tileID.canonical.y),at={},ye=he.familiesBySource[Se.source],Ve=new i.dC(Ye,Se.promoteId);return Ve.bucketLayerIDs=[],Ve.is3DTile=!0,i.dP(te).then(pt=>{if(!pt)return He(new Error("Could not parse tile"));let ut=i.dQ(pt,1/i.bR(Se.tileID.canonical)),St=pt.json.extensionsUsed&&pt.json.extensionsUsed.includes("MAPBOX_mesh_features")||pt.json.asset.extras&&pt.json.asset.extras.MAPBOX_mesh_features,Vt=pt.json.extensionsUsed&&pt.json.extensionsUsed.includes("EXT_meshopt_compression"),Mi=new i.K(this.zoom,{brightness:this.brightness});for(let en in ye)for(let Oi of ye[en]){let yi=Oi[0];Ve.bucketLayerIDs.push(Oi.map(Pe=>Pe.id)),yi.recalculate(Mi,[]);let Vi=new i.dR(ut,Ye,St,Vt,this.brightness,Ve);St||(Vi.needsUpload=!0),at[yi.fqid]=Vi,Vi.evaluate(yi)}this.status="done",He(null,{buckets:at,featureIndex:Ve})}).catch(pt=>He(new Error(pt.message)))}}class _t{constructor(te,he,Se,He,Ye,at){this.actor=te,this.layerIndex=he,this.brightness=at,this.loading={},this.loaded={}}loadTile(te,he){let Se=te.uid,He=this.loading[Se]=new be(te,this.brightness);i.a_(te.request,(Ye,at)=>{let ye=!this.loading[Se];return delete this.loading[Se],ye||Ye?(He.status="done",ye||(this.loaded[Se]=He),he(Ye)):at&&at.byteLength!==0?void He.parse(at,this.layerIndex,te,(Ve,pt)=>{He.status="done",this.loaded=this.loaded||{},this.loaded[Se]=He,Ve||!pt?he(Ve):he(null,pt)}):(He.status="done",this.loaded[Se]=He,he())})}reloadTile(te,he){let Se=this.loaded,He=te.uid;if(Se&&Se[He]){let Ye=Se[He];Ye.projection=te.projection,Ye.brightness=te.brightness;let at=(ye,Ve)=>{Ye.reloadCallback&&(delete Ye.reloadCallback,this.loadTile(te,he)),he(ye,Ve)};Ye.status==="parsing"?Ye.reloadCallback=at:Ye.status==="done"&&this.loadTile(te,he)}}abortTile(te,he){let Se=te.uid;this.loading[Se]&&delete this.loading[Se],he()}removeTile(te,he){let Se=this.loaded,He=te.uid;Se&&Se[He]&&delete Se[He],he()}}class li{constructor(te){this.self=te,this.actor=new i.dS(te,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=i.bo({name:"mercator"}),this.workerSourceTypes={vector:j,geojson:Ie,"batched-model":_t},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(he,Se)=>{if(this.workerSourceTypes[he])throw new Error(`Worker source with name "${he}" already registered.`);this.workerSourceTypes[he]=Se},this.self.registerRTLTextPlugin=he=>{if(i.dT.isParsed())throw new Error("RTL text plugin already registered.");i.dT.applyArabicShaping=he.applyArabicShaping,i.dT.processBidirectionalText=he.processBidirectionalText,i.dT.processStyledBidirectionalText=he.processStyledBidirectionalText}}clearCaches(te,he,Se){delete this.layerIndexes[te],delete this.availableImages[te],delete this.workerSources[te],delete this.demWorkerSources[te],delete this.rasterArrayWorkerSource,Se()}checkIfReady(te,he,Se){Se()}setReferrer(te,he){this.referrer=he}spriteLoaded(te,{scope:he,isLoaded:Se}){if(this.isSpriteLoaded[te]||(this.isSpriteLoaded[te]={}),this.isSpriteLoaded[te][he]=Se,this.workerSources[te]&&this.workerSources[te][he])for(let He in this.workerSources[te][he]){let Ye=this.workerSources[te][he][He];for(let at in Ye)Ye[at]instanceof j&&(Ye[at].isSpriteLoaded=Se,Ye[at].fire(new i.b("isSpriteLoaded")))}}setImages(te,{scope:he,images:Se},He){if(this.availableImages[te]||(this.availableImages[te]={}),this.availableImages[te][he]=Se,this.workerSources[te]&&this.workerSources[te][he]){for(let Ye in this.workerSources[te][he]){let at=this.workerSources[te][he][Ye];for(let ye in at)at[ye].availableImages=Se}He()}else He()}setProjection(te,he){this.projections[te]=i.bo(he)}setBrightness(te,he,Se){this.brightness=he,Se()}setLayers(te,he,Se){this.getLayerIndex(te,he.scope).replace(he.layers,he.options),Se()}updateLayers(te,he,Se){this.getLayerIndex(te,he.scope).update(he.layers,he.removedIds,he.options),Se()}loadTile(te,he,Se){he.projection=this.projections[te]||this.defaultProjection,this.getWorkerSource(te,he.type,he.source,he.scope).loadTile(he,Se)}loadDEMTile(te,he,Se){this.getDEMWorkerSource(te,he.source,he.scope).loadTile(he,Se)}decodeRasterArray(te,he,Se){this.getRasterArrayWorkerSource().decodeRasterArray(he,Se)}reloadTile(te,he,Se){he.projection=this.projections[te]||this.defaultProjection,this.getWorkerSource(te,he.type,he.source,he.scope).reloadTile(he,Se)}abortTile(te,he,Se){this.getWorkerSource(te,he.type,he.source,he.scope).abortTile(he,Se)}removeTile(te,he,Se){this.getWorkerSource(te,he.type,he.source,he.scope).removeTile(he,Se)}removeSource(te,he,Se){if(!(this.workerSources[te]&&this.workerSources[te][he.scope]&&this.workerSources[te][he.scope][he.type]&&this.workerSources[te][he.scope][he.type][he.source]))return;let He=this.workerSources[te][he.scope][he.type][he.source];delete this.workerSources[te][he.scope][he.type][he.source],He.removeSource!==void 0?He.removeSource(he,Se):Se()}loadWorkerSource(te,he,Se){try{this.self.importScripts(he.url),Se()}catch(He){Se(He.toString())}}syncRTLPluginState(te,he,Se){try{i.dT.setState(he);let He=i.dT.getPluginURL();if(i.dT.isLoaded()&&!i.dT.isParsed()&&He!=null){this.self.importScripts(He);let Ye=i.dT.isParsed();Se(Ye?void 0:new Error(`RTL Text Plugin failed to import scripts from ${He}`),Ye)}}catch(He){Se(He.toString())}}setDracoUrl(te,he){this.dracoUrl=he}getAvailableImages(te,he){this.availableImages[te]||(this.availableImages[te]={});let Se=this.availableImages[te][he];return Se||(Se=[]),Se}getLayerIndex(te,he){this.layerIndexes[te]||(this.layerIndexes[te]={});let Se=this.layerIndexes[te][he];return Se||(Se=this.layerIndexes[te][he]=new M,Se.scope=he),Se}getWorkerSource(te,he,Se,He){if(this.workerSources[te]||(this.workerSources[te]={}),this.workerSources[te][He]||(this.workerSources[te][He]={}),this.workerSources[te][He][he]||(this.workerSources[te][He][he]={}),this.isSpriteLoaded[te]||(this.isSpriteLoaded[te]={}),!this.workerSources[te][He][he][Se]){let Ye={send:(at,ye,Ve,pt,ut,St)=>{this.actor.send(at,ye,Ve,te,ut,St)},scheduler:this.actor.scheduler};this.workerSources[te][He][he][Se]=new this.workerSourceTypes[he](Ye,this.getLayerIndex(te,He),this.getAvailableImages(te,He),this.isSpriteLoaded[te][He],void 0,this.brightness)}return this.workerSources[te][He][he][Se]}getDEMWorkerSource(te,he,Se){return this.demWorkerSources[te]||(this.demWorkerSources[te]={}),this.demWorkerSources[te][Se]||(this.demWorkerSources[te][Se]={}),this.demWorkerSources[te][Se][he]||(this.demWorkerSources[te][Se][he]=new Z),this.demWorkerSources[te][Se][he]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new G),this.rasterArrayWorkerSource}enforceCacheSizeLimit(te,he){i.dU(he)}getWorkerPerformanceMetrics(te,he,Se){Se(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new li(self)),li}),s(["./shared"],function(i){"use strict";function f(g,c){if(Array.isArray(g)){if(!Array.isArray(c)||g.length!==c.length)return!1;for(let u=0;u<g.length;u++)if(!f(g[u],c[u]))return!1;return!0}if(typeof g=="object"&&g!==null&&c!==null){if(typeof c!="object"||Object.keys(g).length!==Object.keys(c).length)return!1;for(let u in g)if(!f(g[u],c[u]))return!1;return!0}return g===c}var v=x;function x(g){return!function(c){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var _,b,S=new Blob([""],{type:"text/javascript"}),A=URL.createObjectURL(S);try{b=new Worker(A),_=!0}catch{_=!1}return b&&b.terminate(),URL.revokeObjectURL(A),_}()?function(){var _=document.createElement("canvas");_.width=_.height=1;var b=_.getContext("2d");if(!b)return!1;var S=b.getImageData(0,0,1,1);return S&&S.width===_.width}()?(M[u=c&&c.failIfMajorPerformanceCaveat]===void 0&&(M[u]=function(_){var b,S=function(A){var P=document.createElement("canvas"),k=Object.create(x.webGLContextAttributes);return k.failIfMajorPerformanceCaveat=A,P.getContext("webgl2",k)}(_);if(!S)return!1;try{b=S.createShader(S.VERTEX_SHADER)}catch{return!1}return!(!b||S.isContextLost())&&(S.shaderSource(b,"void main() {}"),S.compileShader(b),S.getShaderParameter(b,S.COMPILE_STATUS)===!0)}(u)),M[u]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var u}(g)}var M={};function C(g,c,u){let _=document.createElement(g);return c!=null&&(_.className=c),u&&u.appendChild(_),_}function D(g,c,u){let _=document.createElementNS("http://www.w3.org/2000/svg",g);for(let b of Object.keys(c))_.setAttributeNS(null,b,String(c[b]));return u&&u.appendChild(_),_}x.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};let L=typeof document<"u"?document.documentElement&&document.documentElement.style:null,N=L&&L.userSelect!==void 0?"userSelect":"WebkitUserSelect",j;function Z(){L&&N&&(j=L[N],L[N]="none")}function G(){L&&N&&(L[N]=j)}function H(g){g.preventDefault(),g.stopPropagation(),window.removeEventListener("click",H,!0)}function me(){window.addEventListener("click",H,!0),window.setTimeout(()=>{window.removeEventListener("click",H,!0)},0)}function ne(g,c){let u=g.getBoundingClientRect();return de(g,u,c)}function fe(g,c){let u=g.getBoundingClientRect(),_=[];for(let b=0;b<c.length;b++)_.push(de(g,u,c[b]));return _}function Ee(g){return window.InstallTrigger!==void 0&&g.button===2&&g.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:g.button}function de(g,c,u){let _=g.offsetWidth===c.width?1:g.offsetWidth/c.width;return new i.P((u.clientX-c.left)*_,(u.clientY-c.top)*_)}class we{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(c,u){this._updatedSourceCaches[c]=u,this.setDirty()}discardSourceCacheUpdate(c){delete this._updatedSourceCaches[c]}updateLayer(c){let u=c.scope;this._updatedLayers[u]=this._updatedLayers[u]||new Set,this._updatedLayers[u].add(c.id),this.setDirty()}removeLayer(c){let u=c.scope;this._removedLayers[u]=this._removedLayers[u]||{},this._updatedLayers[u]=this._updatedLayers[u]||new Set,this._removedLayers[u][c.id]=c,this._updatedLayers[u].delete(c.id),this._updatedPaintProps.delete(c.fqid),this.setDirty()}getRemovedLayer(c){return this._removedLayers[c.scope]?this._removedLayers[c.scope][c.id]:null}discardLayerRemoval(c){this._removedLayers[c.scope]&&delete this._removedLayers[c.scope][c.id]}getLayerUpdatesByScope(){let c={};for(let u in this._updatedLayers)c[u]=c[u]||{},c[u].updatedIds=Array.from(this._updatedLayers[u].values());for(let u in this._removedLayers)c[u]=c[u]||{},c[u].removedIds=Object.keys(this._removedLayers[u]);return c}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(c){this._updatedPaintProps.add(c.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(c){this._updatedImages.add(c),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}class Le extends i.E{constructor(c){super(),this.requestManager=c,this.models={"":{}},this.numModelsLoading={}}loadModel(c,u){return i.l(this.requestManager.transformRequest(u,i.R.Model).url).then(_=>{if(!_)return;let b=i.c(_),S=new i.M(c,void 0,void 0,b);return S.computeBoundsAndApplyParent(),S}).catch(_=>{this.fire(new i.a(new Error(`Could not load model ${c} from ${u}: ${_.message}`)))})}load(c,u){this.models[u]||(this.models[u]={});let _=Object.keys(c);this.numModelsLoading[u]=(this.numModelsLoading[u]||0)+_.length;let b=[];for(let S of _)b.push(this.loadModel(S,c[S]));Promise.allSettled(b).then(S=>{for(let A=0;A<S.length;A++){let{status:P,value:k}=S[A];P==="fulfilled"&&k&&(this.models[u][_[A]]=k)}this.numModelsLoading[u]-=_.length,this.fire(new i.b("data",{dataType:"style"}))}).catch(S=>{this.fire(new i.a(new Error(`Could not load models: ${S.message}`)))})}isLoaded(){for(let c in this.numModelsLoading)if(this.numModelsLoading[c]>0)return!1;return!0}hasModel(c,u){return!!this.getModel(c,u)}getModel(c,u){return this.models[u]||(this.models[u]={}),this.models[u][c]}addModel(c,u,_){this.models[_]||(this.models[_]={}),this.hasModel(c,_)&&this.removeModel(c,_),this.load({[c]:this.requestManager.normalizeModelURL(u)},_)}addModels(c,u){let _={};for(let b in c)_[b]=this.requestManager.normalizeModelURL(c[b]);this.load(_,u)}removeModel(c,u){this.models[u]||(this.models[u]={});let _=this.models[u][c];delete this.models[u][c],_.destroy()}listModels(c){return this.models[c]||(this.models[c]={}),Object.keys(this.models[c])}upload(c,u){this.models[u]||(this.models[u]={});for(let _ in this.models[u])this.models[u][_].upload(c.context)}}class De{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(c,u,_){let b=String(u);if(this.stateChanges[c]=this.stateChanges[c]||{},this.stateChanges[c][b]=this.stateChanges[c][b]||{},i.e(this.stateChanges[c][b],_),this.deletedStates[c]===null){this.deletedStates[c]={};for(let S in this.state[c])S!==b&&(this.deletedStates[c][S]=null)}else if(this.deletedStates[c]&&this.deletedStates[c][b]===null){this.deletedStates[c][b]={};for(let S in this.state[c][b])_[S]||(this.deletedStates[c][b][S]=null)}else for(let S in _)this.deletedStates[c]&&this.deletedStates[c][b]&&this.deletedStates[c][b][S]===null&&delete this.deletedStates[c][b][S]}removeFeatureState(c,u,_){if(this.deletedStates[c]===null)return;let b=String(u);if(this.deletedStates[c]=this.deletedStates[c]||{},_&&u!==void 0)this.deletedStates[c][b]!==null&&(this.deletedStates[c][b]=this.deletedStates[c][b]||{},this.deletedStates[c][b][_]=null);else if(u!==void 0)if(this.stateChanges[c]&&this.stateChanges[c][b])for(_ in this.deletedStates[c][b]={},this.stateChanges[c][b])this.deletedStates[c][b][_]=null;else this.deletedStates[c][b]=null;else this.deletedStates[c]=null}getState(c,u){let _=String(u),b=i.e({},(this.state[c]||{})[_],(this.stateChanges[c]||{})[_]);if(this.deletedStates[c]===null)return{};if(this.deletedStates[c]){let S=this.deletedStates[c][u];if(S===null)return{};for(let A in S)delete b[A]}return b}initializeTileState(c,u){c.setFeatureState(this.state,u)}coalesceChanges(c,u){let _={};for(let b in this.stateChanges){this.state[b]=this.state[b]||{};let S={};for(let A in this.stateChanges[b])this.state[b][A]||(this.state[b][A]={}),i.e(this.state[b][A],this.stateChanges[b][A]),S[A]=this.state[b][A];_[b]=S}for(let b in this.deletedStates){this.state[b]=this.state[b]||{};let S={};if(this.deletedStates[b]===null)for(let A in this.state[b])S[A]={},this.state[b][A]={};else for(let A in this.deletedStates[b]){if(this.deletedStates[b][A]===null)this.state[b][A]={};else if(this.state[b][A])for(let P of Object.keys(this.deletedStates[b][A]))delete this.state[b][A][P];S[A]=this.state[b][A]}_[b]=_[b]||{},i.e(_[b],S)}if(this.stateChanges={},this.deletedStates={},Object.keys(_).length!==0)for(let b in c)c[b].setFeatureState(_,u)}}function se(g){let{userImage:c}=g;return!!(c&&c.render&&c.render())&&(g.data.replace(new Uint8Array(c.data.buffer)),!0)}class Ce extends i.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(c){this.images[c]={},this.loaded[c]=!1,this.updatedImages[c]={},this.patterns[c]={},this.callbackDispatchedThisFrame[c]={},this.atlasImage[c]=new i.h({width:1,height:1})}isLoaded(){for(let c in this.loaded)if(!this.loaded[c])return!1;return!0}setLoaded(c,u){if(this.loaded[u]!==c&&(this.loaded[u]=c,c)){for(let{ids:_,callback:b}of this.requestors)this._notify(_,u,b);this.requestors=[]}}hasImage(c,u){return!!this.getImage(c,u)}getImage(c,u){return this.images[u][c]}addImage(c,u,_){this._validate(c,_)&&(this.images[u][c]=_)}_validate(c,u){let _=!0;return this._validateStretch(u.stretchX,u.data&&u.data.width)||(this.fire(new i.a(new Error(`Image "${c}" has invalid "stretchX" value`))),_=!1),this._validateStretch(u.stretchY,u.data&&u.data.height)||(this.fire(new i.a(new Error(`Image "${c}" has invalid "stretchY" value`))),_=!1),this._validateContent(u.content,u)||(this.fire(new i.a(new Error(`Image "${c}" has invalid "content" value`))),_=!1),_}_validateStretch(c,u){if(!c)return!0;let _=0;for(let b of c){if(b[0]<_||b[1]<b[0]||u<b[1])return!1;_=b[1]}return!0}_validateContent(c,u){return!(c&&(c.length!==4||c[0]<0||u.data.width<c[0]||c[1]<0||u.data.height<c[1]||c[2]<0||u.data.width<c[2]||c[3]<0||u.data.height<c[3]||c[2]<c[0]||c[3]<c[1]))}updateImage(c,u,_){_.version=this.images[u][c].version+1,this.images[u][c]=_,this.updatedImages[u][c]=!0}removeImage(c,u){let _=this.images[u][c];delete this.images[u][c],delete this.patterns[u][c],_.userImage&&_.userImage.onRemove&&_.userImage.onRemove()}listImages(c){return Object.keys(this.images[c])}getImages(c,u,_){let b=!0,S=!!this.loaded[u];if(!S)for(let A of c)this.images[u][A]||(b=!1);S||b?this._notify(c,u,_):this.requestors.push({ids:c,scope:u,callback:_})}getUpdatedImages(c){return this.updatedImages[c]}_notify(c,u,_){let b={};for(let S of c){this.images[u][S]||this.fire(new i.b("styleimagemissing",{id:S}));let A=this.images[u][S];A?b[S]={data:A.data.clone(),pixelRatio:A.pixelRatio,sdf:A.sdf,version:A.version,stretchX:A.stretchX,stretchY:A.stretchY,content:A.content,hasRenderCallback:!!(A.userImage&&A.userImage.render)}:i.w(`Image "${S}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}_(null,b)}getPixelSize(c){let{width:u,height:_}=this.atlasImage[c];return{width:u,height:_}}getPattern(c,u){let _=this.patterns[u][c],b=this.getImage(c,u);if(!b)return null;if(_&&_.position.version===b.version)return _.position;if(_)_.position.version=b.version;else{let S={w:b.data.width+2,h:b.data.height+2,x:0,y:0},A=new i.I(S,b);this.patterns[u][c]={bin:S,position:A}}return this._updatePatternAtlas(u),this.patterns[u][c].position}bind(c,u){let _=c.gl,b=this.atlasTexture[u];b?this.dirty&&(b.update(this.atlasImage[u]),this.dirty=!1):(b=new i.T(c,this.atlasImage[u],_.RGBA),this.atlasTexture[u]=b),b.bind(_.LINEAR,_.CLAMP_TO_EDGE)}_updatePatternAtlas(c){let u=[];for(let A in this.patterns[c])u.push(this.patterns[c][A].bin);let{w:_,h:b}=i.p(u),S=this.atlasImage[c];S.resize({width:_||1,height:b||1});for(let A in this.patterns[c]){let{bin:P}=this.patterns[c][A],k=P.x+1,O=P.y+1,z=this.images[c][A].data,U=z.width,q=z.height;i.h.copy(z,S,{x:0,y:0},{x:k,y:O},{width:U,height:q}),i.h.copy(z,S,{x:0,y:q-1},{x:k,y:O-1},{width:U,height:1}),i.h.copy(z,S,{x:0,y:0},{x:k,y:O+q},{width:U,height:1}),i.h.copy(z,S,{x:U-1,y:0},{x:k-1,y:O},{width:1,height:q}),i.h.copy(z,S,{x:0,y:0},{x:k+U,y:O},{width:1,height:q})}this.dirty=!0}beginFrame(){for(let c in this.images)this.callbackDispatchedThisFrame[c]={}}dispatchRenderCallbacks(c,u){for(let _ of c){if(this.callbackDispatchedThisFrame[u][_])continue;this.callbackDispatchedThisFrame[u][_]=!0;let b=this.images[u][_];se(b)&&this.updateImage(_,u,b)}}}class Ne{constructor(c,u,_,b){this.message=(c?`${c}: `:"")+_,b&&(this.identifier=b),u!=null&&u.__line__&&(this.line=u.__line__)}}class zt extends Ne{}function Ge(g){let c=g.key,u=g.value,_=g.valueSpec||{},b=g.objectElementValidators||{},S=g.style,A=g.styleSpec,P=[],k=i.i(u);if(k!=="object")return[new Ne(c,u,`object expected, ${k} found`)];for(let O in u){let z=O.split(".")[0],U;b[z]?U=b[z]:_[z]?U=Gn:b["*"]?U=b["*"]:_["*"]&&(U=Gn),U?P=P.concat(U({key:(c&&`${c}.`)+O,value:u[O],valueSpec:_[z]||_["*"],style:S,styleSpec:A,object:u,objectKey:O},u)):P.push(new zt(c,u[O],`unknown property "${O}"`))}for(let O in _)b[O]||_[O].required&&_[O].default===void 0&&u[O]===void 0&&P.push(new Ne(c,u,`missing required property "${O}"`));return P}function Xe(g){let c=g.value,u=g.valueSpec,_=g.style,b=g.styleSpec,S=g.key,A=g.arrayElementValidator||Gn;if(i.i(c)!=="array")return[new Ne(S,c,`array expected, ${i.i(c)} found`)];if(u.length&&c.length!==u.length)return[new Ne(S,c,`array length ${u.length} expected, length ${c.length} found`)];if(u["min-length"]&&c.length<u["min-length"])return[new Ne(S,c,`array length at least ${u["min-length"]} expected, length ${c.length} found`)];let P={type:u.value,values:u.values,minimum:u.minimum,maximum:u.maximum,function:void 0};b.$version<7&&(P.function=u.function),i.i(u.value)==="object"&&(P=u.value);let k=[];for(let O=0;O<c.length;O++)k=k.concat(A({array:c,arrayIndex:O,value:c[O],valueSpec:P,style:_,styleSpec:b,key:`${S}[${O}]`},!0));return k}function ht(g){let c=g.key,u=g.value,_=g.valueSpec,b=i.i(u);if(b==="number"&&u!=u&&(b="NaN"),b!=="number")return[new Ne(c,u,`number expected, ${b} found`)];if("minimum"in _){let S=_.minimum;if(i.i(_.minimum)==="array"&&(S=_.minimum[g.arrayIndex]),u<S)return[new Ne(c,u,`${u} is less than the minimum value ${S}`)]}if("maximum"in _){let S=_.maximum;if(i.i(_.maximum)==="array"&&(S=_.maximum[g.arrayIndex]),u>S)return[new Ne(c,u,`${u} is greater than the maximum value ${S}`)]}return[]}function Ot(g){let c=g.valueSpec,u=i.u(g.value.type),_,b,S,A={},P=u!=="categorical"&&g.value.property===void 0,k=!P,O=i.i(g.value.stops)==="array"&&i.i(g.value.stops[0])==="array"&&i.i(g.value.stops[0][0])==="object",z=Ge({key:g.key,value:g.value,valueSpec:g.styleSpec.function,style:g.style,styleSpec:g.styleSpec,objectElementValidators:{stops:function(X){if(u==="identity")return[new Ne(X.key,X.value,'identity function may not have a "stops" property')];let Q=[],K=X.value;return Q=Q.concat(Xe({key:X.key,value:K,valueSpec:X.valueSpec,style:X.style,styleSpec:X.styleSpec,arrayElementValidator:U})),i.i(K)==="array"&&K.length===0&&Q.push(new Ne(X.key,K,"array must have at least one stop")),Q},default:function(X){return Gn({key:X.key,value:X.value,valueSpec:c,style:X.style,styleSpec:X.styleSpec})}}});return u==="identity"&&P&&z.push(new Ne(g.key,g.value,'missing required property "property"')),u==="identity"||g.value.stops||z.push(new Ne(g.key,g.value,'missing required property "stops"')),u==="exponential"&&g.valueSpec.expression&&!i.s(g.valueSpec)&&z.push(new Ne(g.key,g.value,"exponential functions not supported")),g.styleSpec.$version>=8&&(k&&!i.k(g.valueSpec)?z.push(new Ne(g.key,g.value,"property functions not supported")):P&&!i.m(g.valueSpec)&&z.push(new Ne(g.key,g.value,"zoom functions not supported"))),u!=="categorical"&&!O||g.value.property!==void 0||z.push(new Ne(g.key,g.value,'"property" property is required')),z;function U(X){let Q=[],K=X.value,re=X.key;if(i.i(K)!=="array")return[new Ne(re,K,`array expected, ${i.i(K)} found`)];if(K.length!==2)return[new Ne(re,K,`array length 2 expected, length ${K.length} found`)];if(O){if(i.i(K[0])!=="object")return[new Ne(re,K,`object expected, ${i.i(K[0])} found`)];if(K[0].zoom===void 0)return[new Ne(re,K,"object stop key must have zoom")];if(K[0].value===void 0)return[new Ne(re,K,"object stop key must have value")];let Y=i.u(K[0].zoom);if(typeof Y!="number")return[new Ne(re,K[0].zoom,"stop zoom values must be numbers")];if(S&&S>Y)return[new Ne(re,K[0].zoom,"stop zoom values must appear in ascending order")];Y!==S&&(S=Y,b=void 0,A={}),Q=Q.concat(Ge({key:`${re}[0]`,value:K[0],valueSpec:{zoom:{}},style:X.style,styleSpec:X.styleSpec,objectElementValidators:{zoom:ht,value:q}}))}else Q=Q.concat(q({key:`${re}[0]`,value:K[0],valueSpec:{},style:X.style,styleSpec:X.styleSpec},K));return i.n(i.o(K[1]))?Q.concat([new Ne(`${re}[1]`,K[1],"expressions are not allowed in function stops.")]):Q.concat(Gn({key:`${re}[1]`,value:K[1],valueSpec:c,style:X.style,styleSpec:X.styleSpec}))}function q(X,Q){let K=i.i(X.value),re=i.u(X.value),Y=X.value!==null?X.value:Q;if(_){if(K!==_)return[new Ne(X.key,Y,`${K} stop domain type must match previous stop domain type ${_}`)]}else _=K;if(K!=="number"&&K!=="string"&&K!=="boolean"&&typeof re!="number"&&typeof re!="string"&&typeof re!="boolean")return[new Ne(X.key,Y,"stop domain value must be a number, string, or boolean")];if(K!=="number"&&u!=="categorical"){let ae=`number expected, ${K} found`;return i.k(c)&&u===void 0&&(ae+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ne(X.key,Y,ae)]}return u!=="categorical"||K!=="number"||typeof re=="number"&&isFinite(re)&&Math.floor(re)===re?u!=="categorical"&&K==="number"&&typeof re=="number"&&typeof b=="number"&&b!==void 0&&re<b?[new Ne(X.key,Y,"stop domain values must appear in ascending order")]:(b=re,u==="categorical"&&re in A?[new Ne(X.key,Y,"stop domain values must be unique")]:(A[re]=!0,[])):[new Ne(X.key,Y,`integer expected, found ${String(re)}`)]}}function bt(g){let c=(g.expressionContext==="property"?i.q:i.r)(i.o(g.value),g.valueSpec);if(c.result==="error")return c.value.map(_=>new Ne(`${g.key}${_.key}`,g.value,_.message));let u=c.value.expression||c.value._styleExpression.expression;if(g.expressionContext==="property"&&g.propertyKey==="text-font"&&!u.outputDefined())return[new Ne(g.key,g.value,`Invalid data expression for "${g.propertyKey}". Output values must be contained as literals within the expression.`)];if(g.expressionContext==="property"&&g.propertyType==="layout"&&!i.t(u))return[new Ne(g.key,g.value,'"feature-state" data expressions are not supported with layout properties.')];if(g.expressionContext==="filter")return Tt(u,g);if(g.expressionContext&&g.expressionContext.indexOf("cluster")===0){if(!i.v(u,["zoom","feature-state"]))return[new Ne(g.key,g.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(g.expressionContext==="cluster-initial"&&!i.x(u))return[new Ne(g.key,g.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Tt(g,c){let u=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(c.valueSpec&&c.valueSpec.expression)for(let b of c.valueSpec.expression.parameters)u.delete(b);if(u.size===0)return[];let _=[];return g instanceof i.C&&u.has(g.name)?[new Ne(c.key,c.value,`["${g.name}"] expression is not supported in a filter for a ${c.object.type} layer with id: ${c.object.id}`)]:(g.eachChild(b=>{_.push(...Tt(b,c))}),_)}function Nt(g){let c=g.key,u=g.value,_=g.valueSpec,b=[];return Array.isArray(_.values)?_.values.indexOf(i.u(u))===-1&&b.push(new Ne(c,u,`expected one of [${_.values.join(", ")}], ${JSON.stringify(u)} found`)):Object.keys(_.values).indexOf(i.u(u))===-1&&b.push(new Ne(c,u,`expected one of [${Object.keys(_.values).join(", ")}], ${JSON.stringify(u)} found`)),b}function Bt(g){return i.z(i.o(g.value))?bt(i.j({},g,{expressionContext:"filter",valueSpec:g.styleSpec[`filter_${g.layerType||"fill"}`]})):Yt(g)}function Yt(g){let c=g.value,u=g.key;if(i.i(c)!=="array")return[new Ne(u,c,`array expected, ${i.i(c)} found`)];let _=g.styleSpec,b,S=[];if(c.length<1)return[new Ne(u,c,"filter array must have at least 1 element")];switch(S=S.concat(Nt({key:`${u}[0]`,value:c[0],valueSpec:_.filter_operator,style:g.style,styleSpec:g.styleSpec})),i.u(c[0])){case"<":case"<=":case">":case">=":c.length>=2&&i.u(c[1])==="$type"&&S.push(new Ne(u,c,`"$type" cannot be use with operator "${c[0]}"`));case"==":case"!=":c.length!==3&&S.push(new Ne(u,c,`filter array for operator "${c[0]}" must have 3 elements`));case"in":case"!in":c.length>=2&&(b=i.i(c[1]),b!=="string"&&S.push(new Ne(`${u}[1]`,c[1],`string expected, ${b} found`)));for(let A=2;A<c.length;A++)b=i.i(c[A]),i.u(c[1])==="$type"?S=S.concat(Nt({key:`${u}[${A}]`,value:c[A],valueSpec:_.geometry_type,style:g.style,styleSpec:g.styleSpec})):b!=="string"&&b!=="number"&&b!=="boolean"&&S.push(new Ne(`${u}[${A}]`,c[A],`string, number, or boolean expected, ${b} found`));break;case"any":case"all":case"none":for(let A=1;A<c.length;A++)S=S.concat(Yt({key:`${u}[${A}]`,value:c[A],style:g.style,styleSpec:g.styleSpec}));break;case"has":case"!has":b=i.i(c[1]),c.length!==2?S.push(new Ne(u,c,`filter array for "${c[0]}" operator must have 2 elements`)):b!=="string"&&S.push(new Ne(`${u}[1]`,c[1],`string expected, ${b} found`))}return S}function Wi(g,c){let u=g.key,_=g.style,b=g.layer,S=g.styleSpec,A=g.value,P=g.objectKey,k=S[`${c}_${g.layerType}`];if(!k)return[];let O=P.match(/^(.*)-transition$/);if(c==="paint"&&O&&k[O[1]]&&k[O[1]].transition)return Gn({key:u,value:A,valueSpec:S.transition,style:_,styleSpec:S});let z=g.valueSpec||k[P];if(!z)return[new zt(u,A,`unknown property "${P}"`)];let U;if(i.i(A)==="string"&&i.k(z)&&!z.tokens&&(U=/^{([^}]+)}$/.exec(A))){let X=`\`{ "type": "identity", "property": ${U?JSON.stringify(U[1]):'"_"'} }\``;return[new Ne(u,A,`"${P}" does not support interpolation syntax
Use an identity property function instead: ${X}.`)]}let q=[];if(g.layerType==="symbol")P!=="text-field"||!_||_.glyphs||_.imports||q.push(new Ne(u,A,'use of "text-field" requires a style "glyphs" property')),P==="text-font"&&i.A(i.o(A))&&i.u(A.type)==="identity"&&q.push(new Ne(u,A,'"text-font" does not support identity functions'));else if(g.layerType==="model"&&c==="paint"&&b&&b.layout&&b.layout.hasOwnProperty("model-id")&&i.k(z)&&(i.B(z)||i.m(z))){let X=i.q(i.o(A),z),Q=X.value.expression||X.value._styleExpression.expression;Q&&!i.v(Q,["measure-light"])&&(P==="model-emissive-strength"&&i.x(Q)&&i.t(Q)||q.push(new Ne(u,A,`${P} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return q.concat(Gn({key:g.key,value:A,valueSpec:z,style:_,styleSpec:S,expressionContext:"property",propertyType:c,propertyKey:P}))}function wt(g){return Wi(g,"paint")}function ei(g){return Wi(g,"layout")}function vi(g){let c=[],u=g.value,_=g.key,b=g.style,S=g.styleSpec;u.type||u.ref||c.push(new Ne(_,u,'either "type" or "ref" is required'));let A=i.u(u.type),P=i.u(u.ref);if(u.id){let k=i.u(u.id);for(let O=0;O<g.arrayIndex;O++){let z=b.layers[O];i.u(z.id)===k&&c.push(new Ne(_,u.id,`duplicate layer id "${u.id}", previously used at line ${z.id.__line__}`))}}if("ref"in u){let k;["type","source","source-layer","filter","layout"].forEach(O=>{O in u&&c.push(new Ne(_,u[O],`"${O}" is prohibited for ref layers`))}),b.layers.forEach(O=>{i.u(O.id)===P&&(k=O)}),k?k.ref?c.push(new Ne(_,u.ref,"ref cannot reference another ref layer")):A=i.u(k.type):typeof P=="string"&&c.push(new Ne(_,u.ref,`ref layer "${P}" not found`))}else if(A!=="background"&&A!=="sky"&&A!=="slot")if(u.source){let k=b.sources&&b.sources[u.source],O=k&&i.u(k.type);k?O==="vector"&&A==="raster"?c.push(new Ne(_,u.source,`layer "${u.id}" requires a raster source`)):O==="raster"&&A!=="raster"?c.push(new Ne(_,u.source,`layer "${u.id}" requires a vector source`)):O!=="vector"||u["source-layer"]?O==="raster-dem"&&A!=="hillshade"?c.push(new Ne(_,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):O!=="raster-array"||["raster","raster-particle"].includes(A)?A!=="line"||!u.paint||!u.paint["line-gradient"]&&!u.paint["line-trim-offset"]||O==="geojson"&&k.lineMetrics?A==="raster-particle"&&O!=="raster-array"&&c.push(new Ne(_,u.source,`layer "${u.id}" requires a 'raster-array' source.`)):c.push(new Ne(_,u,`layer "${u.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):c.push(new Ne(_,u.source,"raster-array source can only be used with layer type 'raster'.")):c.push(new Ne(_,u,`layer "${u.id}" must specify a "source-layer"`)):c.push(new Ne(_,u.source,`source "${u.source}" not found`))}else c.push(new Ne(_,u,'missing required property "source"'));return c=c.concat(Ge({key:_,value:u,valueSpec:S.layer,style:g.style,styleSpec:g.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Gn({key:`${_}.type`,value:u.type,valueSpec:S.layer.type,style:g.style,styleSpec:g.styleSpec,object:u,objectKey:"type"}),filter:k=>Bt(i.j({layerType:A},k)),layout:k=>Ge({layer:u,key:k.key,value:k.value,valueSpec:{},style:k.style,styleSpec:k.styleSpec,objectElementValidators:{"*":O=>ei(i.j({layerType:A},O))}}),paint:k=>Ge({layer:u,key:k.key,value:k.value,valueSpec:{},style:k.style,styleSpec:k.styleSpec,objectElementValidators:{"*":O=>wt(i.j({layerType:A,layer:u},O))}})}})),c}function Pi(g){let c=g.value,u=g.key,_=i.i(c);return _!=="string"?[new Ne(u,c,`string expected, ${_} found`)]:[]}let Fi={promoteId:function({key:g,value:c}){if(i.i(c)==="string")return Pi({key:g,value:c});{let u=[];for(let _ in c)u.push(...Pi({key:`${g}.${_}`,value:c[_]}));return u}}};function Ri(g){let c=g.value,u=g.key,_=g.styleSpec,b=g.style;if(!c.type)return[new Ne(u,c,'"type" is required')];let S=i.u(c.type),A=[];switch(["vector","raster","raster-dem","raster-array"].includes(S)&&(c.url||c.tiles||A.push(new zt(u,c,'Either "url" or "tiles" is required.'))),S){case"vector":case"raster":case"raster-dem":case"raster-array":return A=A.concat(Ge({key:u,value:c,valueSpec:_[`source_${S.replace("-","_")}`],style:g.style,styleSpec:_,objectElementValidators:Fi})),A;case"geojson":if(A=Ge({key:u,value:c,valueSpec:_.source_geojson,style:b,styleSpec:_,objectElementValidators:Fi}),c.cluster)for(let P in c.clusterProperties){let[k,O]=c.clusterProperties[P],z=typeof k=="string"?[k,["accumulated"],["get",P]]:k;A.push(...bt({key:`${u}.${P}.map`,value:O,expressionContext:"cluster-map"})),A.push(...bt({key:`${u}.${P}.reduce`,value:z,expressionContext:"cluster-reduce"}))}return A;case"video":return Ge({key:u,value:c,valueSpec:_.source_video,style:b,styleSpec:_});case"image":return Ge({key:u,value:c,valueSpec:_.source_image,style:b,styleSpec:_});case"canvas":return[new Ne(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Nt({key:`${u}.type`,value:c.type,valueSpec:{values:br(_)},style:b,styleSpec:_})}}function br(g){return g.source.reduce((c,u)=>{let _=g[u];return _.type.type==="enum"&&(c=c.concat(Object.keys(_.type.values))),c},[])}function Ui(g){let c=g.value,u=[];if(!c)return u;let _=i.i(c);return _!=="string"?(u=u.concat([new Ne(g.key,c,`string expected, "${_}" found`)]),u):(function(b){let S=b.indexOf("://")===-1;try{return new URL(b,S?"http://example.com":void 0),!0}catch{return!1}}(c)||(u=u.concat([new Ne(g.key,c,`invalid url "${c}"`)])),u)}function st(g){let c=g.value,u=g.styleSpec,_=u.light,b=g.style,S=[],A=i.i(c);if(c===void 0)return S;if(A!=="object")return S=S.concat([new Ne("light",c,`object expected, ${A} found`)]),S;for(let P in c){let k=P.match(/^(.*)-transition$/);S=S.concat(k&&_[k[1]]&&_[k[1]].transition?Gn({key:P,value:c[P],valueSpec:u.transition,style:b,styleSpec:u}):_[P]?Gn({key:P,value:c[P],valueSpec:_[P],style:b,styleSpec:u}):[new Ne(P,c[P],`unknown property "${P}"`)])}return S}function $r(g){let c=g.value,u=[];if(!c)return u;let _=i.i(c);if(_!=="object")return u=u.concat([new Ne("light-3d",c,`object expected, ${_} found`)]),u;let b=g.styleSpec,S=b["light-3d"],A=g.key,P=g.style,k=g.style.lights;for(let U of["type","id"])if(!(U in c))return u=u.concat([new Ne("light-3d",c,`missing property ${U} on light`)]),u;if(c.type&&k)for(let U=0;U<g.arrayIndex;U++){let q=i.u(c.type),X=k[U];i.u(X.type)===q&&u.push(new Ne(A,c.id,`duplicate light type "${c.type}", previously defined at line ${X.id.__line__}`))}let O=`properties_light_${c.type}`;if(!(O in b))return u=u.concat([new Ne("light-3d",c,`Invalid light type ${c.type}`)]),u;let z=b[O];for(let U in c)if(U==="properties"){let q=c[U],X=i.i(q);if(X!=="object")return u=u.concat([new Ne("properties",q,`object expected, ${X} found`)]),u;for(let Q in q)u=u.concat(z[Q]?Gn({key:Q,value:q[Q],valueSpec:z[Q],style:P,styleSpec:b}):[new zt(g.key,q[Q],`unknown property "${Q}"`)])}else{let q=U.match(/^(.*)-transition$/);u=u.concat(q&&S[q[1]]&&S[q[1]].transition?Gn({key:U,value:c[U],valueSpec:b.transition,style:P,styleSpec:b}):S[U]?Gn({key:U,value:c[U],valueSpec:S[U],style:P,styleSpec:b}):[new zt(U,c[U],`unknown property "${U}"`)])}return u}function Ki(g){let c=g.value,u=g.key,_=g.style,b=g.styleSpec,S=b.terrain,A=[],P=i.i(c);if(c===void 0||P==="null")return A;if(P!=="object")return A=A.concat([new Ne("terrain",c,`object expected, ${P} found`)]),A;for(let k in c){let O=k.match(/^(.*)-transition$/);A=A.concat(O&&S[O[1]]&&S[O[1]].transition?Gn({key:k,value:c[k],valueSpec:b.transition,style:_,styleSpec:b}):S[k]?Gn({key:k,value:c[k],valueSpec:S[k],style:_,styleSpec:b}):[new zt(k,c[k],`unknown property "${k}"`)])}if(c.source){let k=_.sources&&_.sources[c.source],O=k&&i.u(k.type);k?O!=="raster-dem"&&A.push(new Ne(u,c.source,`terrain cannot be used with a source of type ${String(O)}, it only be used with a "raster-dem" source type`)):A.push(new Ne(u,c.source,`source "${c.source}" not found`))}else A.push(new Ne(u,c,'terrain is missing required property "source"'));return A}function yn(g){let c=g.value,u=g.style,_=g.styleSpec,b=_.fog,S=[],A=i.i(c);if(c===void 0)return S;if(A!=="object")return S=S.concat([new Ne("fog",c,`object expected, ${A} found`)]),S;for(let P in c){let k=P.match(/^(.*)-transition$/);S=S.concat(k&&b[k[1]]&&b[k[1]].transition?Gn({key:P,value:c[P],valueSpec:_.transition,style:u,styleSpec:_}):b[P]?Gn({key:P,value:c[P],valueSpec:b[P],style:u,styleSpec:_}):[new zt(P,c[P],`unknown property "${P}"`)])}return S}let Qi={"*":()=>[],array:Xe,boolean:function(g){let c=g.value,u=g.key,_=i.i(c);return _!=="boolean"?[new Ne(u,c,`boolean expected, ${_} found`)]:[]},number:ht,color:function(g){let c=g.key,u=g.value,_=i.i(u);return _!=="string"?[new Ne(c,u,`color expected, ${_} found`)]:i.y(u)===null?[new Ne(c,u,`color expected, "${u}" found`)]:[]},enum:Nt,filter:Bt,function:Ot,layer:vi,object:Ge,source:Ri,model:Ui,light:st,"light-3d":$r,terrain:Ki,fog:yn,string:Pi,formatted:function(g){return Pi(g).length===0?[]:bt(g)},resolvedImage:function(g){return Pi(g).length===0?[]:bt(g)},projection:function(g){let c=g.value,u=g.styleSpec,_=u.projection,b=g.style,S=[],A=i.i(c);if(A==="object")for(let P in c)S=S.concat(Gn({key:P,value:c[P],valueSpec:_[P],style:b,styleSpec:u}));else A!=="string"&&(S=S.concat([new Ne("projection",c,`object or string expected, ${A} found`)]));return S},import:function(g){let{value:c,styleSpec:u}=g,A=c,{data:_}=A,b=QM(A,["data"]);Object.defineProperty(b,"__line__",{value:c.__line__,enumerable:!1});let S=Ge(i.j({},g,{value:b,valueSpec:u.import}));return i.u(b.id)===""&&S.push(new Ne(`${g.key}.id`,b,"import id can't be an empty string")),_&&(S=S.concat(Ie(_,u,{key:`${g.key}.data`}))),S}};function Gn(g,c=!1){let u=g.value,_=g.valueSpec,b=g.styleSpec;if(_.expression&&i.A(i.u(u)))return Ot(g);if(_.expression&&i.n(i.o(u)))return bt(g);if(_.type&&Qi[_.type]){let S=Qi[_.type](g);return c===!0&&S.length>0&&i.i(g.value)==="array"?bt(g):S}return Ge(i.j({},g,{valueSpec:_.type?b[_.type]:_}))}function Fn(g){let c=g.value,u=g.key,_=Pi(g);return _.length||(c.indexOf("{fontstack}")===-1&&_.push(new Ne(u,c,'"glyphs" url must include a "{fontstack}" token')),c.indexOf("{range}")===-1&&_.push(new Ne(u,c,'"glyphs" url must include a "{range}" token'))),_}function Ie(g,c=i.D,u={}){return Gn({key:u.key||"",value:g,valueSpec:c.$root,styleSpec:c,style:g,objectElementValidators:{glyphs:Fn,"*":()=>[]}})}function be(g,c=i.D){return Ve(Ie(g,c))}let _t=g=>Ve(Ri(g)),li=g=>Ve(st(g)),ze=g=>Ve($r(g)),te=g=>Ve(Ki(g)),he=g=>Ve(yn(g)),Se=g=>Ve(vi(g)),He=g=>Ve(Bt(g)),Ye=g=>Ve(wt(g)),at=g=>Ve(ei(g)),ye=g=>Ve(Ui(g));function Ve(g){return g.slice().sort((c,u)=>c.line&&u.line?c.line-u.line:0)}function pt(g,c){let u=!1;if(c&&c.length)for(let _ of c)_ instanceof zt?i.w(_.message):(g.fire(new i.a(new Error(_.message))),u=!0);return u}let ut=new i.F({anchor:new i.G(i.D.light.anchor),position:new i.H(i.D.light.position),color:new i.G(i.D.light.color),intensity:new i.G(i.D.light.intensity)});class St extends i.E{constructor(c,u="flat"){super(),this._transitionable=new i.J(ut),this.setLight(c,u),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(c,u,_={}){this._validate(li,c,_)||(this._transitionable.setTransitionOrValue(c),this.id=u)}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,u,_){return(!_||_.validate!==!1)&&pt(this,c.call(be,i.e({value:u,style:{glyphs:!0,sprite:!0},styleSpec:i.D})))}}let Vt=new i.F({source:new i.G(i.D.terrain.source),exaggeration:new i.G(i.D.terrain.exaggeration)}),Mi=class extends i.E{constructor(g,c,u,_){super(),this.scope=u,this._transitionable=new i.J(Vt,u,_),this._transitionable.setTransitionOrValue(g,_),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=c}get(){return this._transitionable.serialize()}set(g,c){this._transitionable.setTransitionOrValue(g,c)}updateTransitions(g){this._transitioning=this._transitionable.transitioned(g,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(g){this.properties=this._transitioning.possiblyEvaluate(g)}getExaggeration(g){return this._transitioning.possiblyEvaluate(new i.K(g)).get("exaggeration")}isZoomDependent(){let g=this._transitionable._values.exaggeration;return g!=null&&g.value!=null&&g.value.expression!=null&&g.value.expression instanceof i.Z}},en=45,Oi=65,yi=.05;function Vi(g,c,u,_){let b=i.O(en,Oi,u),[S,A]=Pe(g,_),P=1-Math.min(1,Math.exp((c-S)/(A-S)*-6));return P*=P*P,P=Math.min(1,1.00747*P),P*b*g.alpha}function Pe(g,c){let u=.5/Math.tan(.5*c);return[g.range[0]+u,g.range[1]+u]}function Zt(g,c,u,_,b){let S=i.N.transformMat4([],[c,u,_],b.mercatorFogMatrix);return Vi(g,i.N.length(S),b.pitch,b._fov)}function ni(g,c,u,_,b,S,A){let P=[[u,_,0],[b,_,0],[b,S,0],[u,S,0]],k=Number.MAX_VALUE,O=-Number.MAX_VALUE;for(let z of P){let U=i.N.transformMat4([],z,c),q=i.N.length(U);k=Math.min(k,q),O=Math.max(O,q)}return[Vi(g,k,A.pitch,A._fov),Vi(g,O,A.pitch,A._fov)]}let gi=new i.F({range:new i.G(i.D.fog.range),color:new i.G(i.D.fog.color),"high-color":new i.G(i.D.fog["high-color"]),"space-color":new i.G(i.D.fog["space-color"]),"horizon-blend":new i.G(i.D.fog["horizon-blend"]),"star-intensity":new i.G(i.D.fog["star-intensity"]),"vertical-range":new i.G(i.D.fog["vertical-range"])});class qi extends i.E{constructor(c,u,_,b){super(),this._transitionable=new i.J(gi,_,new Map(b)),this.set(c,b),this._transitioning=this._transitionable.untransitioned(),this._transform=u,this.properties=new i.Q(gi)}get state(){let c=this._transform,u=c.projection.name==="globe",_=i.S(c.zoom),b=this.properties.get("range"),S=[.5,3];return{range:u?[i.U(S[0],b[0],_),i.U(S[1],b[1],_)]:b,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(c,u,_={}){if(this._validate(he,c,_))return;let b=i.e({},c);for(let S of Object.keys(i.D.fog))b[S]===void 0&&(b[S]=i.D.fog[S].default);this._options=b,this._transitionable.setTransitionOrValue(this._options,u)}getOpacity(c){if(!this._transform.projection.supportsFog)return 0;let u=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:i.O(en,Oi,c))*u.a}getOpacityAtLatLng(c,u){return this._transform.projection.supportsFog?function(_,b,S){let A=i.L.fromLngLat(b),P=S.elevation?S.elevation.getAtPointOrZero(A):0;return Zt(_,A.x,A.y,P,S)}(this.state,c,u):0}getOpacityForTile(c){if(!this._transform.projection.supportsFog)return[1,1];let u=this._transform.calculateFogTileMatrix(c.toUnwrapped());return ni(this.state,u,0,0,i.V,i.V,this._transform)}getOpacityForBounds(c,u,_,b,S){return this._transform.projection.supportsFog?ni(this.state,c,u,_,b,S,this._transform):[1,1]}getFovAdjustedRange(c){return this._transform.projection.supportsFog?Pe(this.state,c):[0,1]}isVisibleOnFrustum(c){if(!this._transform.projection.supportsFog)return!1;let u=[4,5,6,7];for(let _ of u){let b=c.points[_],S;if(b[2]>=0)S=b;else{let A=c.points[_-4];S=i.W(A,b,A[2]/(A[2]-b[2]))}if(Zt(this.state,S[0],S[1],0,this._transform)>=yi)return!0}return!1}updateConfig(c){this._transitionable.setTransitionOrValue(this._options,new Map(c))}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,u,_){return(!_||_.validate!==!1)&&pt(this,c.call(be,i.e({value:u,style:{glyphs:!0,sprite:!0},styleSpec:i.D})))}}class $n extends i.E{constructor(c,u,_,b){super(),this.scope=_,this._options=c,this.properties=new i.Q(u),this._transitionable=new i.J(u,_,new Map(b)),this._transitionable.setTransitionOrValue(c.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(c){this._transitionable.setTransitionOrValue(this._options.properties,new Map(c))}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(c,u){this._options=c,this._transitionable.setTransitionOrValue(c.properties,u)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}let fr=new i.F({color:new i.G(i.D.properties_light_ambient.color),intensity:new i.G(i.D.properties_light_ambient.intensity)}),mr=new i.F({direction:new i.X(i.D.properties_light_directional.direction),color:new i.G(i.D.properties_light_directional.color),intensity:new i.G(i.D.properties_light_directional.intensity),"cast-shadows":new i.G(i.D.properties_light_directional["cast-shadows"]),"shadow-intensity":new i.G(i.D.properties_light_directional["shadow-intensity"])});class Mr{constructor(c,u,_,b){this.screenBounds=c,this.cameraPoint=u,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=_,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,b)}static createFromScreenPoints(c,u){let _,b;if(c instanceof i.P||typeof c[0]=="number"){let S=i.P.convert(c);_=[S],b=u.isPointAboveHorizon(S)}else{let S=i.P.convert(c[0]),A=i.P.convert(c[1]);_=[S,A],b=i.Y(S,A).every(P=>u.isPointAboveHorizon(P))}return new Mr(_,u.getCameraPoint(),b,u)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(c){return i.Y(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],c)}bufferedCameraGeometry(c){let u=this.screenBounds[0],_=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],b=i.Y(u,_,0,!1);return this.cameraPoint.y>_.y&&(this.cameraPoint.x>u.x&&this.cameraPoint.x<_.x?b.splice(3,0,this.cameraPoint):this.cameraPoint.x>=_.x?b[2]=this.cameraPoint:this.cameraPoint.x<=u.x&&(b[3]=this.cameraPoint)),i._(b,c)}bufferedCameraGeometryGlobe(c){let u=this.screenBounds[0],_=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],b=i.Y(u,_,c),S=this.cameraPoint.clone();switch(3*((S.y>u.y)+(S.y>_.y))+((S.x>u.x)+(S.x>_.x))){case 0:b[0]=S,b[4]=S.clone();break;case 1:b.splice(1,0,S);break;case 2:b[1]=S;break;case 3:b.splice(4,0,S);break;case 5:b.splice(2,0,S);break;case 6:b[3]=S;break;case 7:b.splice(3,0,S);break;case 8:b[2]=S}return b}containsTile(c,u,_,b=0){let S=c.queryPadding/u._pixelsPerMercatorPixel+1,A=_?this._bufferedCameraMercator(S,u):this._bufferedScreenMercator(S,u),P=c.tileID.wrap+(A.unwrapped?b:0),k=A.polygon.map(re=>i.$(c.tileTransform,re,P));if(!i.a0(k,0,0,i.V,i.V))return;P=c.tileID.wrap+(this.screenGeometryMercator.unwrapped?b:0);let O=this.screenGeometryMercator.polygon.map(re=>i.a1(c.tileTransform,re,P)),z=O.map(re=>new i.P(re[0],re[1])),U=u.getFreeCameraOptions().position||new i.L(0,0,0),q=i.a1(c.tileTransform,U,P),X=O.map(re=>{let Y=i.N.sub(re,re,q);return i.N.normalize(Y,Y),new i.a2(q,Y)}),Q=i.a3(c,1,u.zoom)*u._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:z,tilespaceRays:X,bufferedTilespaceGeometry:k,bufferedTilespaceBounds:(K=i.a4(k),K.min.x=i.aa(K.min.x,0,i.V),K.min.y=i.aa(K.min.y,0,i.V),K.max.x=i.aa(K.max.x,0,i.V),K.max.y=i.aa(K.max.y,0,i.V),K),tile:c,tileID:c.tileID,pixelToTileUnitsFactor:Q};var K}_bufferedScreenMercator(c,u){let _=kt(c);if(this._screenRaycastCache[_])return this._screenRaycastCache[_];{let b;return b=u.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(c),u):{polygon:this.bufferedScreenGeometry(c).map(S=>u.pointCoordinate3D(S)),unwrapped:!0},this._screenRaycastCache[_]=b,b}}_bufferedCameraMercator(c,u){let _=kt(c);if(this._cameraRaycastCache[_])return this._cameraRaycastCache[_];{let b;return b=u.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(c),u):{polygon:this.bufferedCameraGeometry(c).map(S=>u.pointCoordinate3D(S)),unwrapped:!0},this._cameraRaycastCache[_]=b,b}}_projectAndResample(c,u){let _=function(S,A){let P=i.a6.multiply([],A.pixelMatrix,A.globeMatrix),k=[0,-i.ab,0,1],O=[0,i.ab,0,1],z=[0,0,0,1];i.a7.transformMat4(k,k,P),i.a7.transformMat4(O,O,P),i.a7.transformMat4(z,z,P);let U=new i.P(k[0]/k[3],k[1]/k[3]),q=new i.P(O[0]/O[3],O[1]/O[3]),X=i.a8(S,U)&&k[3]<z[3],Q=i.a8(S,q)&&O[3]<z[3];if(!X&&!Q)return null;let K=function(ve,Ae,Re){for(let Oe=1;Oe<ve.length;Oe++){let Je=lt(Ae.pointCoordinate3D(ve[Oe-1]).x),Ue=lt(Ae.pointCoordinate3D(ve[Oe]).x);if(Re<0){if(Je<Ue)return{idx:Oe,t:-Je/(Ue-1-Je)}}else if(Ue<Je)return{idx:Oe,t:(1-Je)/(Ue+1-Je)}}return null}(S,A,X?-1:1);if(!K)return null;let{idx:re,t:Y}=K,ae=re>1?et(S.slice(0,re),A):[],ge=re<S.length?et(S.slice(re),A):[];ae=ae.map(ve=>new i.P(lt(ve.x),ve.y)),ge=ge.map(ve=>new i.P(lt(ve.x),ve.y));let ce=[...ae];ce.length===0&&ce.push(ge[ge.length-1]);let _e=i.U(ce[ce.length-1].y,(ge.length===0?ae[0]:ge[0]).y,Y),oe;return oe=X?[new i.P(0,_e),new i.P(0,0),new i.P(1,0),new i.P(1,_e)]:[new i.P(1,_e),new i.P(1,1),new i.P(0,1),new i.P(0,_e)],ce.push(...oe),ge.length===0?ce.push(ae[0]):ce.push(...ge),{polygon:ce.map(ve=>new i.L(ve.x,ve.y)),unwrapped:!1}}(c,u);if(_)return _;let b=function(S,A){let P=!1,k=-1/0,O=0;for(let U=0;U<S.length-1;U++)S[U].x>k&&(k=S[U].x,O=U);for(let U=0;U<S.length-1;U++){let q=(O+U)%(S.length-1),X=S[q],Q=S[q+1];Math.abs(X.x-Q.x)>.5&&(X.x<Q.x?(X.x+=1,q===0&&(S[S.length-1].x+=1)):(Q.x+=1,q+1===S.length-1&&(S[0].x+=1)),P=!0)}let z=i.a5(A.center.lng);return P&&z<Math.abs(z-1)&&S.forEach(U=>{U.x-=1}),{polygon:S,unwrapped:P}}(et(c,u).map(S=>new i.P(lt(S.x),S.y)),u);return{polygon:b.polygon.map(S=>new i.L(S.x,S.y)),unwrapped:b.unwrapped}}}function et(g,c){return i.a9(g,u=>{let _=c.pointCoordinate3D(u);u.x=_.x,u.y=_.y},1/256)}function lt(g){return g<0?1+g%1:g%1}function kt(g){return 100*g|0}function Wt(g,c,u,_,b){let S=function(A,P){if(A)return b(A);if(P){g.url&&P.tiles&&g.tiles&&delete g.tiles;let k=i.ac(i.e(P,g),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);P.vector_layers&&(k.vectorLayers=P.vector_layers,k.vectorLayerIds=k.vectorLayers.map(O=>O.id)),P.raster_layers&&(k.rasterLayers=P.raster_layers,k.rasterLayerIds=k.rasterLayers.map(O=>O.id)),k.tiles=c.canonicalizeTileset(k,g.url),b(null,k)}};return g.url?i.g(c.transformRequest(c.normalizeSourceURL(g.url,null,u,_),i.R.Source),S):i.f.frame(()=>S(null,g))}class Ht{constructor(c,u,_){this.bounds=i.ad.convert(this.validateBounds(c)),this.minzoom=u||0,this.maxzoom=_||24}validateBounds(c){return Array.isArray(c)&&c.length===4?[Math.max(-180,c[0]),Math.max(-90,c[1]),Math.min(180,c[2]),Math.min(90,c[3])]:[-180,-90,180,90]}contains(c){let u=Math.pow(2,c.z),_=Math.floor(i.a5(this.bounds.getWest())*u),b=Math.floor(i.ae(this.bounds.getNorth())*u),S=Math.ceil(i.a5(this.bounds.getEast())*u),A=Math.ceil(i.ae(this.bounds.getSouth())*u);return c.x>=_&&c.x<S&&c.y>=b&&c.y<A}}class Jt extends i.E{constructor(c,u,_,b){if(super(),this.id=c,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,i.e(this,i.ac(u,["url","scheme","tileSize","promoteId"])),this._options=i.e({type:"vector"},u),this._collectResourceTiming=!!u.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(b),this._tileWorkers={},this._deduped=new i.af}load(c){this._loaded=!1,this.fire(new i.b("dataloading",{dataType:"source"}));let u=Array.isArray(this.map._language)?this.map._language.join():this.map._language,_=this.map._worldview;this._tileJSONRequest=Wt(this._options,this.map._requestManager,u,_,(b,S)=>{this._tileJSONRequest=null,this._loaded=!0,b?(u&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${u}`),_&&_.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${_}`),this.fire(new i.a(b))):S&&(i.e(this,S),S.bounds&&(this.tileBounds=new Ht(S.bounds,this.minzoom,this.maxzoom)),i.aj(S.tiles,this.map._requestManager._customAccessToken),this.fire(new i.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.b("data",{dataType:"source",sourceDataType:"content"}))),c&&c(b)})}loaded(){return this._loaded}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}onAdd(c){this.map=c,this.load()}reload(){this.cancelTileJSONRequest();let c=i.ag(this.id,this.scope);this.load(()=>this.map.style.clearSource(c))}setTiles(c){return this._options.tiles=c,this.reload(),this}setUrl(c){return this.url=c,this._options.url=c,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return i.e({},this._options)}loadTile(c,u){let _=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),b={request:this.map._requestManager.transformRequest(_,i.R.Tile),data:void 0,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:i.f.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:c.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:c.isExtraShadowCaster};if(b.request.collectResourceTiming=this._collectResourceTiming,c.actor&&c.state!=="expired")c.state==="loading"?c.reloadCallback=u:c.request=c.actor.send("reloadTile",b,S.bind(this));else if(c.actor=this._tileWorkers[_]=this._tileWorkers[_]||this.dispatcher.getActor(),this.dispatcher.ready)c.request=c.actor.send("loadTile",b,S.bind(this),void 0,!0);else{let A=i.ah.call({deduped:this._deduped},b,(P,k)=>{P||!k?S.call(this,P):(b.data={cacheControl:k.cacheControl,expires:k.expires,rawData:k.rawData.slice(0)},c.actor&&c.actor.send("loadTile",b,S.bind(this),void 0,!0))},!0);c.request={cancel:A}}function S(A,P){return delete c.request,c.aborted?u(null):A&&A.status!==404?u(A):(P&&P.resourceTiming&&(c.resourceTiming=P.resourceTiming),this.map._refreshExpiredTiles&&P&&c.setExpiryData(P),c.loadVectorData(P,this.map.painter),i.ai(this.dispatcher),u(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(c){c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id,scope:this.scope}),c.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Kt extends i.E{constructor(c,u,_,b){super(),this.id=c,this.dispatcher=_,this.setEventedParent(b),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=i.e({type:"raster"},u),i.e(this,i.ac(u,["url","scheme","tileSize"]))}load(c){this._loaded=!1,this.fire(new i.b("dataloading",{dataType:"source"})),this._tileJSONRequest=Wt(this._options,this.map._requestManager,null,null,(u,_)=>{this._tileJSONRequest=null,this._loaded=!0,u?this.fire(new i.a(u)):_&&(i.e(this,_),_.bounds&&(this.tileBounds=new Ht(_.bounds,this.minzoom,this.maxzoom)),i.aj(_.tiles),this.fire(new i.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.b("data",{dataType:"source",sourceDataType:"content"}))),c&&c(u)})}loaded(){return this._loaded}onAdd(c){this.map=c,this.load()}reload(){this.cancelTileJSONRequest();let c=i.ag(this.id,this.scope);this.load(()=>this.map.style.clearSource(c))}setTiles(c){return this._options.tiles=c,this.reload(),this}setUrl(c){return this.url=c,this._options.url=c,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return i.e({},this._options)}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}loadTile(c,u){let _=i.f.devicePixelRatio>=2,b=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),_,this.tileSize);c.request=i.d(this.map._requestManager.transformRequest(b,i.R.Tile),(S,A,P,k)=>(delete c.request,c.aborted?(c.state="unloaded",u(null)):S?(c.state="errored",u(S)):A?(this.map._refreshExpiredTiles&&c.setExpiryData({cacheControl:P,expires:k}),c.setTexture(A,this.map.painter),c.state="loaded",i.ai(this.dispatcher),void u(null)):u(null)))}abortTile(c,u){c.request&&(c.request.cancel(),delete c.request),u()}unloadTile(c,u){c.texture&&c.texture instanceof i.T?(c.destroy(!0),c.texture&&c.texture instanceof i.T&&this.map.painter.saveTileTexture(c.texture)):c.destroy(),u()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Gt extends Kt{constructor(c,u,_,b){super(c,u,_,b),this.type="raster-array",this.maxzoom=22,this._options=i.e({type:"raster-array"},u)}triggerRepaint(c){let u=this.map.painter._terrain,_=this.map.style.getSourceCache(this.id);u&&u.enabled&&_&&u._clearRenderCacheForTile(_.id,c.tileID),this.map.triggerRepaint()}loadTile(c,u){let _=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),b=this.map._requestManager.transformRequest(_,i.R.Tile);c.requestParams=b,c.actor||(c.actor=this.dispatcher.getActor()),c.request=c.fetchHeader(void 0,(S,A,P,k)=>{if(delete c.request,c.aborted)return c.state="unloaded",u(null);if(S)return S.code===20?void 0:(c.state="errored",u(S));this.map._refreshExpiredTiles&&c.setExpiryData({cacheControl:P,expires:k}),c.state="empty",u(null)})}unloadTile(c){let u=c.texture;u&&u instanceof i.T?(c.destroy(!0),this.map.painter.saveTileTexture(u)):(c.destroy(),c.flushQueues(),c._isHeaderLoaded=!1,delete c._mrt,delete c.textureDescriptor),c.fbo&&(c.fbo.destroy(),delete c.fbo),delete c.request,delete c.requestParams,delete c.neighboringTiles,c.state="unloaded"}prepareTile(c,u,_){c._isHeaderLoaded&&(c.state!=="empty"&&(c.state="reloading"),c.fetchBand(u,_,(b,S)=>{if(b)return c.state="errored",this.fire(new i.a(b)),void this.triggerRepaint(c);S&&(c.setTexture(S,this.map.painter),c.state="loaded",this.triggerRepaint(c))}))}getInitialBand(c){if(!this.rasterLayers)return 0;let u=this.rasterLayers.find(({id:S})=>S===c),_=u&&u.fields,b=_&&_.bands&&_.bands;return b?b[0]:0}getTextureDescriptor(c,u,_){if(!c)return;let b=u.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!b)return;let S=null;u instanceof i.an?S=u.paint.get("raster-array-band"):u instanceof i.ao&&(S=u.paint.get("raster-particle-array-band"));let A=S||this.getInitialBand(b);if(A!=null)if(c.textureDescriptor){if(!c.updateNeeded(b,A)||_)return Object.assign({},c.textureDescriptor,{texture:c.texture})}else this.prepareTile(c,b,A)}}let ri=32,$t=33,Gi=new Uint16Array(8184);for(let g=0;g<2046;g++){let c=g+2,u=0,_=0,b=0,S=0,A=0,P=0;for(1&c?b=S=A=ri:u=_=P=ri;(c>>=1)>1;){let O=u+b>>1,z=_+S>>1;1&c?(b=u,S=_,u=A,_=P):(u=b,_=S,b=A,S=P),A=O,P=z}let k=4*g;Gi[k+0]=u,Gi[k+1]=_,Gi[k+2]=b,Gi[k+3]=S}let kn=new Uint16Array(2178),bi=new Uint8Array(1089),Te=new Uint16Array(1089);function Qe(g){return g===0?-.03125:g===32?.03125:0}let ct=(()=>{class g{constructor(u,_,b,S){this.id=g.uniqueIdxCounter,g.uniqueIdxCounter++,this.context=u;let A=u.gl;this.buffer=A.createBuffer(),this.dynamicDraw=!!b,this.context.unbindVAO(),u.bindElementBuffer.set(this.buffer),A.bufferData(A.ELEMENT_ARRAY_BUFFER,_.arrayBuffer,this.dynamicDraw?A.DYNAMIC_DRAW:A.STATIC_DRAW),this.dynamicDraw||S||_.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(u){this.id=g.uniqueIdxCounter,g.uniqueIdxCounter++;let _=this.context.gl;this.context.unbindVAO(),this.bind(),_.bufferSubData(_.ELEMENT_ARRAY_BUFFER,0,u.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return g.uniqueIdxCounter=0,g})(),gt={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ft{constructor(c,u,_,b,S,A){this.length=u.length,this.attributes=_,this.itemSize=u.bytesPerElement,this.dynamicDraw=b,this.instanceCount=A,this.context=c;let P=c.gl;this.buffer=P.createBuffer(),c.bindVertexBuffer.set(this.buffer),P.bufferData(P.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?P.DYNAMIC_DRAW:P.STATIC_DRAW),this.dynamicDraw||S||u.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(c){let u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,c.arrayBuffer)}enableAttributes(c,u){for(let _=0;_<this.attributes.length;_++){let b=u.attributes[this.attributes[_].name];b!==void 0&&c.enableVertexAttribArray(b)}}setVertexAttribPointers(c,u,_){for(let b=0;b<this.attributes.length;b++){let S=this.attributes[b],A=u.attributes[S.name];A!==void 0&&c.vertexAttribPointer(A,S.components,c[gt[S.type]],!1,this.itemSize,S.offset+this.itemSize*(_||0))}}setVertexAttribDivisor(c,u,_){for(let b=0;b<this.attributes.length;b++){let S=u.attributes[this.attributes[b].name];S!==void 0&&this.instanceCount&&this.instanceCount>0&&c.vertexAttribDivisor(S,_)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Qt{constructor(c){this.gl=c.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(c){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ji extends Qt{getDefault(){return i.ax.transparent}set(c){let u=this.current;(c.r!==u.r||c.g!==u.g||c.b!==u.b||c.a!==u.a||this.dirty)&&(this.gl.clearColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class cn extends Qt{getDefault(){return 1}set(c){(c!==this.current||this.dirty)&&(this.gl.clearDepth(c),this.current=c,this.dirty=!1)}}class Ji extends Qt{getDefault(){return 0}set(c){(c!==this.current||this.dirty)&&(this.gl.clearStencil(c),this.current=c,this.dirty=!1)}}class Qn extends Qt{getDefault(){return[!0,!0,!0,!0]}set(c){let u=this.current;(c[0]!==u[0]||c[1]!==u[1]||c[2]!==u[2]||c[3]!==u[3]||this.dirty)&&(this.gl.colorMask(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class Dn extends Qt{getDefault(){return!0}set(c){(c!==this.current||this.dirty)&&(this.gl.depthMask(c),this.current=c,this.dirty=!1)}}class Hn extends Qt{getDefault(){return 255}set(c){(c!==this.current||this.dirty)&&(this.gl.stencilMask(c),this.current=c,this.dirty=!1)}}class gs extends Qt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(c){let u=this.current;(c.func!==u.func||c.ref!==u.ref||c.mask!==u.mask||this.dirty)&&(this.gl.stencilFunc(c.func,c.ref,c.mask),this.current=c,this.dirty=!1)}}class Ls extends Qt{getDefault(){let c=this.gl;return[c.KEEP,c.KEEP,c.KEEP]}set(c){let u=this.current;(c[0]!==u[0]||c[1]!==u[1]||c[2]!==u[2]||this.dirty)&&(this.gl.stencilOp(c[0],c[1],c[2]),this.current=c,this.dirty=!1)}}class Cs extends Qt{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;let u=this.gl;c?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST),this.current=c,this.dirty=!1}}class So extends Qt{getDefault(){return[0,1]}set(c){let u=this.current;(c[0]!==u[0]||c[1]!==u[1]||this.dirty)&&(this.gl.depthRange(c[0],c[1]),this.current=c,this.dirty=!1)}}class as extends Qt{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;let u=this.gl;c?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),this.current=c,this.dirty=!1}}class or extends Qt{getDefault(){return this.gl.LESS}set(c){(c!==this.current||this.dirty)&&(this.gl.depthFunc(c),this.current=c,this.dirty=!1)}}class n0 extends Qt{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;let u=this.gl;c?u.enable(u.BLEND):u.disable(u.BLEND),this.current=c,this.dirty=!1}}class rs extends Qt{getDefault(){let c=this.gl;return[c.ONE,c.ZERO,c.ONE,c.ZERO]}set(c){let u=this.current;(c[0]!==u[0]||c[1]!==u[1]||c[2]!==u[2]||c[3]!==u[3]||this.dirty)&&(this.gl.blendFuncSeparate(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class Ga extends Qt{getDefault(){return i.ax.transparent}set(c){let u=this.current;(c.r!==u.r||c.g!==u.g||c.b!==u.b||c.a!==u.a||this.dirty)&&(this.gl.blendColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class fo extends Qt{getDefault(){return this.gl.FUNC_ADD}set(c){(c!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(c,c),this.current=c,this.dirty=!1)}}class qr extends Qt{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;let u=this.gl;c?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE),this.current=c,this.dirty=!1}}class Tn extends Qt{getDefault(){return this.gl.BACK}set(c){(c!==this.current||this.dirty)&&(this.gl.cullFace(c),this.current=c,this.dirty=!1)}}class Ws extends Qt{getDefault(){return this.gl.CCW}set(c){(c!==this.current||this.dirty)&&(this.gl.frontFace(c),this.current=c,this.dirty=!1)}}let wa=class extends Qt{getDefault(){return null}set(g){(g!==this.current||this.dirty)&&(this.gl.useProgram(g),this.current=g,this.dirty=!1)}};class r0 extends Qt{getDefault(){return this.gl.TEXTURE0}set(c){(c!==this.current||this.dirty)&&(this.gl.activeTexture(c),this.current=c,this.dirty=!1)}}class Vo extends Qt{getDefault(){let c=this.gl;return[0,0,c.drawingBufferWidth,c.drawingBufferHeight]}set(c){let u=this.current;(c[0]!==u[0]||c[1]!==u[1]||c[2]!==u[2]||c[3]!==u[3]||this.dirty)&&(this.gl.viewport(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class Go extends Qt{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;let u=this.gl;u.bindFramebuffer(u.FRAMEBUFFER,c),this.current=c,this.dirty=!1}}class Md extends Qt{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;let u=this.gl;u.bindRenderbuffer(u.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class op extends Qt{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;let u=this.gl;u.bindTexture(u.TEXTURE_2D,c),this.current=c,this.dirty=!1}}class $0 extends Qt{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;let u=this.gl;u.bindBuffer(u.ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class ci extends Qt{getDefault(){return null}set(c){let u=this.gl;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class hr extends Qt{getDefault(){return null}set(c){this.gl&&(c!==this.current||this.dirty)&&(this.gl.bindVertexArray(c),this.current=c,this.dirty=!1)}}class dr extends Qt{getDefault(){return 4}set(c){if(c===this.current&&!this.dirty)return;let u=this.gl;u.pixelStorei(u.UNPACK_ALIGNMENT,c),this.current=c,this.dirty=!1}}class Sa extends Qt{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;let u=this.gl;u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),this.current=c,this.dirty=!1}}class Y0 extends Qt{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;let u=this.gl;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,c),this.current=c,this.dirty=!1}}class Yn extends Qt{constructor(c,u){super(c),this.context=c,this.parent=u}getDefault(){return null}}class ap extends Yn{setDirty(){this.dirty=!0}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}}class J0 extends Yn{attachment(){return this.gl.DEPTH_ATTACHMENT}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,this.attachment(),u.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class Ed extends Yn{attachment(){return this.gl.DEPTH_ATTACHMENT}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,this.attachment(),u.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}}class Ho extends J0{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class bs{constructor(c,u,_,b,S){this.context=c,this.width=u,this.height=_;let A=this.framebuffer=c.gl.createFramebuffer();b&&(this.colorAttachment=new ap(c,A)),S&&(this.depthAttachmentType=S,this.depthAttachment=S==="renderbuffer"?new J0(c,A):new Ed(c,A))}destroy(){let c=this.context.gl;if(this.colorAttachment){let u=this.colorAttachment.get();u&&c.deleteTexture(u)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){let u=this.depthAttachment.get();u&&c.deleteRenderbuffer(u)}else{let u=this.depthAttachment.get();u&&c.deleteTexture(u)}c.deleteFramebuffer(this.framebuffer)}}class ki{constructor(c,u,_){this.func=c,this.mask=u,this.range=_}}ki.ReadOnly=!1,ki.ReadWrite=!0,ki.disabled=new ki(519,ki.ReadOnly,[0,1]);let s0=7680;class tn{constructor(c,u,_,b,S,A){this.test=c,this.ref=u,this.mask=_,this.fail=b,this.depthFail=S,this.pass=A}}tn.disabled=new tn({func:519,mask:0},0,0,s0,s0,s0);let gc=771;class Mn{constructor(c,u,_,b){this.blendFunction=c,this.blendColor=u,this.mask=_,this.blendEquation=b}}Mn.Replace=[1,0,1,0],Mn.disabled=new Mn(Mn.Replace,i.ax.transparent,[!1,!1,!1,!1]),Mn.unblended=new Mn(Mn.Replace,i.ax.transparent,[!0,!0,!0,!0]),Mn.alphaBlended=new Mn([1,gc,1,gc],i.ax.transparent,[!0,!0,!0,!0]),Mn.multiply=new Mn([774,0,774,0],i.ax.transparent,[!0,!0,!0,!0]);let K0=1029,ro=2305;class Di{constructor(c,u,_){this.enable=c,this.mode=u,this.frontFace=_}}Di.disabled=new Di(!1,K0,ro),Di.backCCW=new Di(!0,K0,ro),Di.backCW=new Di(!0,K0,2304),Di.frontCW=new Di(!0,1028,2304),Di.frontCCW=new Di(!0,1028,ro);class S_{constructor(c,u){this.gl=c,this.clearColor=new ji(this),this.clearDepth=new cn(this),this.clearStencil=new Ji(this),this.colorMask=new Qn(this),this.depthMask=new Dn(this),this.stencilMask=new Hn(this),this.stencilFunc=new gs(this),this.stencilOp=new Ls(this),this.stencilTest=new Cs(this),this.depthRange=new So(this),this.depthTest=new as(this),this.depthFunc=new or(this),this.blend=new n0(this),this.blendFunc=new rs(this),this.blendColor=new Ga(this),this.blendEquation=new fo(this),this.cullFace=new qr(this),this.cullFaceSide=new Tn(this),this.frontFace=new Ws(this),this.program=new wa(this),this.activeTexture=new r0(this),this.viewport=new Vo(this),this.bindFramebuffer=new Go(this),this.bindRenderbuffer=new Md(this),this.bindTexture=new op(this),this.bindVertexBuffer=new $0(this),this.bindElementBuffer=new ci(this),this.bindVertexArrayOES=new hr(this),this.pixelStoreUnpack=new dr(this),this.pixelStoreUnpackPremultiplyAlpha=new Sa(this),this.pixelStoreUnpackFlipY=new Y0(this),this.options=u?Ti({},u):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||c.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=c.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=c.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=c.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=c.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=c.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=c.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=c.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=c.getParameter(c.MAX_TEXTURE_SIZE),this.maxPointSize=c.getParameter(c.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(c,u,_){return new ct(this,c,u,_)}createVertexBuffer(c,u,_,b,S){return new ft(this,c,u,_,b,S)}createRenderbuffer(c,u,_){let b=this.gl,S=b.createRenderbuffer();return this.bindRenderbuffer.set(S),b.renderbufferStorage(b.RENDERBUFFER,c,u,_),this.bindRenderbuffer.set(null),S}createFramebuffer(c,u,_,b){return new bs(this,c,u,_,b)}clear({color:c,depth:u,stencil:_,colorMask:b}){let S=this.gl,A=0;c&&(A|=S.COLOR_BUFFER_BIT,this.clearColor.set(c),this.colorMask.set(b||[!0,!0,!0,!0])),u!==void 0&&(A|=S.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),_!==void 0&&(A|=S.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),S.clear(A)}setCullFace(c){c.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(c.mode),this.frontFace.set(c.frontFace))}setDepthMode(c){c.func!==this.gl.ALWAYS||c.mask?(this.depthTest.set(!0),this.depthFunc.set(c.func),this.depthMask.set(c.mask),this.depthRange.set(c.range)):this.depthTest.set(!1)}setStencilMode(c){c.test.func!==this.gl.ALWAYS||c.mask?(this.stencilTest.set(!0),this.stencilMask.set(c.mask),this.stencilOp.set([c.fail,c.depthFail,c.pass]),this.stencilFunc.set({func:c.test.func,ref:c.ref,mask:c.test.mask})):this.stencilTest.set(!1)}setColorMode(c){f(c.blendFunction,Mn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(c.blendFunction),this.blendColor.set(c.blendColor),c.blendEquation?this.blendEquation.set(c.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(c.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}var o0=i.ay([{name:"a_pos",type:"Float32",components:3}]);class Is{constructor(c,u,_,b){let S={width:_[0],height:_[1],data:null},A=c.gl;this.targetColorTexture=new i.T(c,S,A.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new i.T(c,S,A.RGBA,{useMipmap:!1}),this.context=c,this.setNumParticles(u,b),this.lastInvalidatedAt=0}setNumParticles(c,u){if(this.numParticles===u)return;(this.particleVertices0||this.particleVertices1||this.particleSegment)&&(this.particleVertices0.destroy(),this.particleVertices1.destroy(),this.particleSegment.destroy());let _=new i.az;_.reserve(Math.round(u));let b=i.aA(c.key);for(let S=0;S<u;S++)_.emplaceBack(b(),b(),b());this.particleVertices0=this.context.createVertexBuffer(_,o0.members,!0),this.particleVertices1=this.context.createVertexBuffer(_,o0.members,!0),this.particleSegment=i.aB.simpleSegment(0,0,this.particleVertices0.length,0),this.numParticles=u}update(c){return!(this.lastInvalidatedAt<c&&(this.lastInvalidatedAt=i.f.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleVertices0.destroy(),this.particleVertices1.destroy(),this.particleSegment.destroy()}}let Ta={type:2,extent:i.V,loadGeometry:()=>[[new i.P(0,0),new i.P(i.V+1,0),new i.P(i.V+1,i.V+1),new i.P(0,i.V+1),new i.P(0,0)]]};class _c{constructor(c,u,_,b,S){this.tileID=c,this.uid=i.aC(),this.uses=0,this.tileSize=u,this.tileZoom=_,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=S,b&&b.style&&(this._lastUpdatedBrightness=b.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",b&&b.transform&&(this.projection=b.transform.projection)}registerFadeDuration(c){let u=c+this.timeAdded;u<i.f.now()||this.fadeEndTime&&u<this.fadeEndTime||(this.fadeEndTime=u)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=i.as(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(c,u,_){if(this.unloadVectorData(),this.state="loaded",c){c.featureIndex&&(this.latestFeatureIndex=c.featureIndex,c.rawTileData?(this.latestRawTileData=c.rawTileData,this.latestFeatureIndex.rawTileData=c.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=c.collisionBoxArray,this.buckets=function(b,S){let A={};if(!S)return A;for(let P of b){let k=P.layerIds.map(O=>S.getLayer(O)).filter(Boolean);if(k.length!==0){P.layers=k,P.stateDependentLayerIds&&(P.stateDependentLayers=P.stateDependentLayerIds.map(O=>k.filter(z=>z.id===O)[0]));for(let O of k)A[O.fqid]=P}}return A}(c.buckets,u.style),this.hasSymbolBuckets=!1;for(let b in this.buckets){let S=this.buckets[b];if(S instanceof i.aE){if(this.hasSymbolBuckets=!0,!_)break;S.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let b in this.buckets){let S=this.buckets[b];if(S instanceof i.aE&&S.hasRTLText){this.hasRTLText=!0,i.aF();break}}this.queryPadding=0;for(let b in this.buckets){let S=this.buckets[b],A=u.style.getOwnLayer(b);if(!A)continue;let P=A.queryRadius(S);this.queryPadding=Math.max(this.queryPadding,P)}c.imageAtlas&&(this.imageAtlas=c.imageAtlas),c.glyphAtlasImage&&(this.glyphAtlasImage=c.glyphAtlasImage),c.lineAtlas&&(this.lineAtlas=c.lineAtlas),this._lastUpdatedBrightness=c.brightness}else this.collisionBoxArray=new i.aD}unloadVectorData(){if(this.hasData()){for(let c in this.buckets)this.buckets[c].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(c){return this.buckets[c.fqid]}upload(c){for(let b in this.buckets){let S=this.buckets[b];S.uploadPending()&&S.upload(c)}let u=c.gl,_=this.imageAtlas;if(_&&!_.uploaded){let b=!!Object.keys(_.patternPositions).length;this.imageAtlasTexture=new i.T(c,_.image,u.RGBA,{useMipmap:b}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new i.T(c,this.glyphAtlasImage,u.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new i.T(c,this.lineAtlas.image,u.R8),this.lineAtlas.uploaded=!0)}prepare(c,u,_){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(c,this.imageAtlasTexture,_),!u||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;let b=u.style.getBrightness();(this._lastUpdatedBrightness||b)&&(this._lastUpdatedBrightness&&b&&Math.abs(this._lastUpdatedBrightness-b)<.001||(this._lastUpdatedBrightness=b,this.updateBuckets(void 0,u)))}queryRenderedFeatures(c,u,_,b,S,A,P,k){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:b,pixelPosMatrix:P,transform:A,params:S,tileTransform:this.tileTransform},c,u,_):{}}querySourceFeatures(c,u){let _=this.latestFeatureIndex;if(!_||!_.rawTileData)return;let b=_.loadVTLayers(),S=u?u.sourceLayer:"",A=b._geojsonTileLayer||b[S];if(!A)return;let P=i.aG(u&&u.filter),{z:k,x:O,y:z}=this.tileID.canonical,U={z:k,x:O,y:z};for(let q=0;q<A.length;q++){let X=A.feature(q);if(P.needGeometry){let re=i.aH(X,!0);if(!P.filter(new i.K(this.tileID.overscaledZ),re,this.tileID.canonical))continue}else if(!P.filter(new i.K(this.tileID.overscaledZ),X))continue;let Q=_.getId(X,S),K=new i.aI(X,k,O,z,Q);K.tile=U,c.push(K)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}bucketsLoaded(){for(let c in this.buckets)if(this.buckets[c].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(c){let u=this.expirationTime;if(c.cacheControl){let _=i.aJ(c.cacheControl);_["max-age"]&&(this.expirationTime=Date.now()+1e3*_["max-age"])}else c.expires&&(this.expirationTime=new Date(c.expires).getTime());if(this.expirationTime){let _=Date.now(),b=!1;if(this.expirationTime>_)b=!1;else if(u)if(this.expirationTime<u)b=!0;else{let S=this.expirationTime-u;S?this.expirationTime=_+Math.max(S,3e4):b=!0}else b=!0;b?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(c,u){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(c).length!==0&&u&&this.updateBuckets(c,u)}updateBuckets(c,u){if(!this.latestFeatureIndex)return;let _=this.latestFeatureIndex.loadVTLayers(),b=u.style.listImages(),S=u.style.getBrightness();for(let A in this.buckets){if(!u.style.hasLayer(A))continue;let P=this.buckets[A],k=P.layers[0].sourceLayer||"_geojsonTileLayer",O=_[k],z={};if(c&&(z=c[k],!O||!z||Object.keys(z).length===0))continue;if(P.update(z,O,b,this.imageAtlas&&this.imageAtlas.patternPositions||{},S),P instanceof i.aK||P instanceof i.aL){let q=u.style.getOwnSourceCache(P.layers[0].source);u._terrain&&u._terrain.enabled&&q&&P.programConfigurations.needsUpload&&u._terrain._clearRenderCacheForTile(q.id,this.tileID)}let U=u&&u.style&&u.style.getOwnLayer(A);U&&(this.queryPadding=Math.max(this.queryPadding,U.queryRadius(P)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<i.f.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(c){this.symbolFadeHoldUntil=i.f.now()+c}setTexture(c,u){let _=u.context,b=_.gl;this.texture=this.texture||u.getTileTexture(c.width),this.texture&&this.texture instanceof i.T?this.texture.update(c,{useMipmap:!0}):(this.texture=new i.T(_,c,b.RGBA,{useMipmap:!0}),this.texture.bind(b.LINEAR,b.CLAMP_TO_EDGE))}setDependencies(c,u){let _={};for(let b of u)_[b]=!0;this.dependencies[c]=_}hasDependency(c,u){for(let _ of c){let b=this.dependencies[_];if(b){for(let S of u)if(b[S])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(c,u){if(!u||u.name==="mercator"||this._tileDebugBuffer)return;let _=i.aM(Ta,this.tileID.canonical,this.tileTransform)[0],b=new i.aN,S=new i.aO;for(let A=0;A<_.length;A++){let{x:P,y:k}=_[A];b.emplaceBack(P,k),S.emplaceBack(A)}S.emplaceBack(0),this._tileDebugIndexBuffer=c.createIndexBuffer(S),this._tileDebugBuffer=c.createVertexBuffer(b,i.aP.members),this._tileDebugSegments=i.aB.simpleSegment(0,0,b.length,S.length)}_makeTileBoundsBuffers(c,u){if(this._tileBoundsBuffer||!u||u.name==="mercator")return;let _=i.aM(Ta,this.tileID.canonical,this.tileTransform)[0],b,S;if(this.isRaster){let A=function(P,k){let O=i.as(P,k),z=Math.pow(2,P.z);for(let re=0;re<$t;re++)for(let Y=0;Y<$t;Y++){let ae=i.at((P.x+(Y+Qe(Y))/ri)/z),ge=i.au((P.y+(re+Qe(re))/ri)/z),ce=k.project(ae,ge),_e=re*$t+Y;kn[2*_e+0]=Math.round((ce.x*O.scale-O.x)*i.V),kn[2*_e+1]=Math.round((ce.y*O.scale-O.y)*i.V)}bi.fill(0),Te.fill(0);for(let re=2045;re>=0;re--){let Y=4*re,ae=Gi[Y+0],ge=Gi[Y+1],ce=Gi[Y+2],_e=Gi[Y+3],oe=ae+ce>>1,ve=ge+_e>>1,Ae=oe+ve-ge,Re=ve+ae-oe,Oe=ge*$t+ae,Je=_e*$t+ce,Ue=ve*$t+oe,ot=Math.hypot((kn[2*Oe+0]+kn[2*Je+0])/2-kn[2*Ue+0],(kn[2*Oe+1]+kn[2*Je+1])/2-kn[2*Ue+1])>=16;bi[Ue]=bi[Ue]||(ot?1:0),re<1022&&(bi[Ue]=bi[Ue]||bi[(ge+Re>>1)*$t+(ae+Ae>>1)]||bi[(_e+Re>>1)*$t+(ce+Ae>>1)])}let U=new i.av,q=new i.aw,X=0;function Q(re,Y){let ae=Y*$t+re;return Te[ae]===0&&(U.emplaceBack(kn[2*ae+0],kn[2*ae+1],re*i.V/ri,Y*i.V/ri),Te[ae]=++X),Te[ae]-1}function K(re,Y,ae,ge,ce,_e){let oe=re+ae>>1,ve=Y+ge>>1;if(Math.abs(re-ce)+Math.abs(Y-_e)>1&&bi[ve*$t+oe])K(ce,_e,re,Y,oe,ve),K(ae,ge,ce,_e,oe,ve);else{let Ae=Q(re,Y),Re=Q(ae,ge),Oe=Q(ce,_e);q.emplaceBack(Ae,Re,Oe)}}return K(0,0,ri,ri,ri,0),K(ri,ri,0,0,0,ri),{vertices:U,indices:q}}(this.tileID.canonical,u);b=A.vertices,S=A.indices}else{b=new i.av,S=new i.aw;for(let{x:P,y:k}of _)b.emplaceBack(P,k,0,0);let A=i.aQ(b.int16,void 0,4);for(let P=0;P<A.length;P+=3)S.emplaceBack(A[P],A[P+1],A[P+2])}this._tileBoundsBuffer=c.createVertexBuffer(b,i.aR.members),this._tileBoundsIndexBuffer=c.createIndexBuffer(S),this._tileBoundsSegments=i.aB.simpleSegment(0,0,b.length,S.length)}_makeGlobeTileDebugBuffers(c,u){let _=u.projection;if(!_||_.name!=="globe"||u.freezeTileCoverage)return;let b=this.tileID.canonical,S=i.aS(b,u),A=i.aT(S),P=i.S(u.zoom),k;P>0&&(k=i.a6.invert(new Float64Array(16),u.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(c,b,u,A,k,P),this._makeGlobeTileDebugTextBuffer(c,b,u,A,k,P)}_globePoint(c,u,_,b,S,A,P){let k=i.aU(c,u,_);if(A){let O=1<<_.z,z=i.a5(b.center.lng),U=i.ae(b.center.lat),q=(_.x+.5)/O-z,X=0;q>.5?X=-1:q<-.5&&(X=1);let Q=(c/i.V+_.x)/O+X,K=(u/i.V+_.y)/O;Q=(Q-z)*b._pixelsPerMercatorPixel+z,K=(K-U)*b._pixelsPerMercatorPixel+U;let re=[Q*b.worldSize,K*b.worldSize,0];i.N.transformMat4(re,re,A),k=i.aV(k,re,P)}return i.N.transformMat4(k,k,S)}_makeGlobeTileDebugBorderBuffer(c,u,_,b,S,A){let P=new i.aN,k=new i.aO,O=new i.aW,z=(q,X,Q,K,re)=>{let Y=(Q-q)/(re-1),ae=(K-X)/(re-1),ge=P.length;for(let ce=0;ce<re;ce++){let _e=q+ce*Y,oe=X+ce*ae;P.emplaceBack(_e,oe);let ve=this._globePoint(_e,oe,u,_,b,S,A);O.emplaceBack(ve[0],ve[1],ve[2]),k.emplaceBack(ge+ce)}},U=i.V;z(0,0,U,0,16),z(U,0,U,U,16),z(U,U,0,U,16),z(0,U,0,0,16),this._tileDebugIndexBuffer=c.createIndexBuffer(k),this._tileDebugBuffer=c.createVertexBuffer(P,i.aP.members),this._globeTileDebugBorderBuffer=c.createVertexBuffer(O,i.aX.members),this._tileDebugSegments=i.aB.simpleSegment(0,0,P.length,k.length)}_makeGlobeTileDebugTextBuffer(c,u,_,b,S,A){let P=i.V/4,k=new i.aN,O=new i.aw,z=new i.aW,U=25;O.reserve(32),k.reserve(U),z.reserve(U);let q=(X,Q)=>U*X+Q;for(let X=0;X<U;X++){let Q=X*P;for(let K=0;K<U;K++){let re=K*P;k.emplaceBack(re,Q);let Y=this._globePoint(re,Q,u,_,b,S,A);z.emplaceBack(Y[0],Y[1],Y[2])}}for(let X=0;X<4;X++)for(let Q=0;Q<4;Q++){let K=q(X,Q),re=q(X,Q+1),Y=q(X+1,Q),ae=q(X+1,Q+1);O.emplaceBack(K,re,Y),O.emplaceBack(Y,re,ae)}this._tileDebugTextIndexBuffer=c.createIndexBuffer(O),this._tileDebugTextBuffer=c.createVertexBuffer(k,i.aP.members),this._globeTileDebugTextBuffer=c.createVertexBuffer(z,i.aX.members),this._tileDebugTextSegments=i.aB.simpleSegment(0,0,U,32)}destroy(c=!1){for(let u in this.buckets)this.buckets[u].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!c&&this.texture&&this.texture instanceof i.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}let kl={vector:Jt,raster:Kt,"raster-dem":class extends Kt{constructor(g,c,u,_){super(g,c,u,_),this.type="raster-dem",this.maxzoom=22,this._options=i.e({type:"raster-dem"},c),this.encoding=c.encoding||"mapbox"}loadTile(g,c){let u=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function _(b,S){b&&(g.state="errored",c(b)),S&&(g.dem=S,g.dem.onDeserialize(),g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0,g.state="loaded",c(null))}g.request=i.d(this.map._requestManager.transformRequest(u,i.R.Tile),(function(b,S,A,P){if(delete g.request,g.aborted)g.state="unloaded",c(null);else if(b)g.state="errored",c(b);else if(S){this.map._refreshExpiredTiles&&g.setExpiryData({cacheControl:A,expires:P});let k=ImageBitmap&&S instanceof ImageBitmap&&i.ak(),O=1-(S.width-i.al(S.width))/2;O<1||g.neighboringTiles||(g.neighboringTiles=this._getNeighboringTiles(g.tileID));let z=k?S:i.f.getImageData(S,O),U={uid:g.uid,coord:g.tileID,source:this.id,scope:this.scope,rawImageData:z,encoding:this.encoding,padding:O};g.actor&&g.state!=="expired"||(g.actor=this.dispatcher.getActor(),g.actor.send("loadDEMTile",U,_.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(g){let c=g.canonical,u=Math.pow(2,c.z),_=(c.x-1+u)%u,b=c.x===0?g.wrap-1:g.wrap,S=(c.x+1+u)%u,A=c.x+1===u?g.wrap+1:g.wrap,P={};return P[new i.am(g.overscaledZ,b,c.z,_,c.y).key]={backfilled:!1},P[new i.am(g.overscaledZ,A,c.z,S,c.y).key]={backfilled:!1},c.y>0&&(P[new i.am(g.overscaledZ,b,c.z,_,c.y-1).key]={backfilled:!1},P[new i.am(g.overscaledZ,g.wrap,c.z,c.x,c.y-1).key]={backfilled:!1},P[new i.am(g.overscaledZ,A,c.z,S,c.y-1).key]={backfilled:!1}),c.y+1<u&&(P[new i.am(g.overscaledZ,b,c.z,_,c.y+1).key]={backfilled:!1},P[new i.am(g.overscaledZ,g.wrap,c.z,c.x,c.y+1).key]={backfilled:!1},P[new i.am(g.overscaledZ,A,c.z,S,c.y+1).key]={backfilled:!1}),P}},"raster-array":Gt,geojson:class extends i.E{constructor(g,c,u,_){super(),this.id=g,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=u.getActor(),this.setEventedParent(_),this._data=c.data,this._options=i.e({},c),this._collectResourceTiming=c.collectResourceTiming,c.maxzoom!==void 0&&(this.maxzoom=c.maxzoom),c.type&&(this.type=c.type),c.attribution&&(this.attribution=c.attribution),this.promoteId=c.promoteId;let b=i.V/this.tileSize;this.workerOptions=i.e({source:this.id,scope:this.scope,cluster:c.cluster||!1,geojsonVtOptions:{buffer:(c.buffer!==void 0?c.buffer:128)*b,tolerance:(c.tolerance!==void 0?c.tolerance:.375)*b,extent:i.V,maxZoom:this.maxzoom,lineMetrics:c.lineMetrics||!1,generateId:c.generateId||!1},superclusterOptions:{maxZoom:c.clusterMaxZoom!==void 0?c.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,c.clusterMinPoints||2),extent:i.V,radius:(c.clusterRadius!==void 0?c.clusterRadius:50)*b,log:!1,generateId:c.generateId||!1},clusterProperties:c.clusterProperties,filter:c.filter},c.workerOptions)}onAdd(g){this.map=g,this.setData(this._data)}setData(g){return this._data=g,this._updateWorkerData(),this}getClusterExpansionZoom(g,c){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:g,source:this.id,scope:this.scope},c),this}getClusterChildren(g,c){return this.actor.send("geojson.getClusterChildren",{clusterId:g,source:this.id,scope:this.scope},c),this}getClusterLeaves(g,c,u,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:g,limit:c,offset:u},_),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new i.b("dataloading",{dataType:"source"})),this._loaded=!1;let g=i.e({},this.workerOptions);g.scope=this.scope;let c=this._data;typeof c=="string"?(g.request=this.map._requestManager.transformRequest(i.f.resolveURL(c),i.R.Source),g.request.collectResourceTiming=this._collectResourceTiming):g.data=JSON.stringify(c),this._pendingLoad=this.actor.send(`${this.type}.loadData`,g,(u,_)=>{if(this._loaded=!0,this._pendingLoad=null,u)this.fire(new i.a(u));else{let b={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&_&&_.resourceTiming&&_.resourceTiming[this.id]&&(b.resourceTiming=_.resourceTiming[this.id]),this.fire(new i.b("data",b)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(g,c){let u=g.actor?"reloadTile":"loadTile";g.actor=this.actor;let _={type:this.type,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:i.f.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};g.request=this.actor.send(u,_,(b,S)=>(delete g.request,g.destroy(),g.aborted?c(null):b?c(b):(g.loadVectorData(S,this.map.painter,u==="reloadTile"),c(null))),void 0,u==="loadTile")}abortTile(g){g.request&&(g.request.cancel(),delete g.request),g.aborted=!0}unloadTile(g){this.actor.send("removeTile",{uid:g.uid,type:this.type,source:this.id,scope:this.scope}),g.destroy()}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return i.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends i.ap{constructor(g,c,u,_){super(g,c,u,_),this.roundZoom=!0,this.type="video",this.options=c}load(){this._loaded=!1;let g=this.options;this.urls=[];for(let c of g.urls)this.urls.push(this.map._requestManager.transformRequest(c,i.R.Source).url);i.aq(this.urls,(c,u)=>{this._loaded=!0,c?this.fire(new i.a(c)):u&&(this.video=u,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(g){if(this.video){let c=this.video.seekable;g<c.start(0)||g>c.end(0)?this.fire(new i.a(new Ne(`sources.${this.id}`,null,`Playback for this video can be set only between the ${c.start(0)} and ${c.end(0)}-second mark.`))):this.video.currentTime=g}}getVideo(){return this.video}onAdd(g){this.map||(this.map=g,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let g=this.map.painter.context,c=g.gl;this.texture?this.video.paused||(this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),c.texSubImage2D(c.TEXTURE_2D,0,0,0,c.RGBA,c.UNSIGNED_BYTE,this.video)):(this.texture=new i.T(g,this.video,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(g)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:i.ap,model:class extends i.E{constructor(g,c,u,_){super(),this.id=g,this.type="model",this.models=[],this._loaded=!1,this._options=c}load(){let g=[];for(let c in this._options.models){let u=this._options.models[c],_=i.l(this.map._requestManager.transformRequest(u.uri,i.R.Model).url).then(b=>{if(!b)return;let S=i.c(b),A=new i.M(c,u.position,u.orientation,S);A.computeBoundsAndApplyParent(),this.models.push(A)}).catch(b=>{this.fire(new i.a(new Error(`Could not load model ${c} from ${u.uri}: ${b.message}`)))});g.push(_)}return Promise.allSettled(g).then(()=>{this._loaded=!0,this.fire(new i.b("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(c=>{this.fire(new i.a(new Error(`Could not load models: ${c.message}`)))})}onAdd(g){this.map=g,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(g,c){}serialize(){return{type:"model"}}},"batched-model":class extends i.E{constructor(g,c,u,_){super(),this.type="batched-model",this.id=g,this.tileSize=512,this._options=c,this.tiles=this._options.tiles,this.maxzoom=c.maxzoom||19,this.minzoom=c.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=u,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(_)}onAdd(g){this.map=g,this.load()}load(g){this._loaded=!1,this.fire(new i.b("dataloading",{dataType:"source"}));let c=Array.isArray(this.map._language)?this.map._language.join():this.map._language,u=this.map._worldview;this._tileJSONRequest=Wt(this._options,this.map._requestManager,c,u,(_,b)=>{this._tileJSONRequest=null,this._loaded=!0,_?(c&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${c}`),u&&u.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${u}`),this.fire(new i.a(_))):b&&(i.e(this,b),b.bounds&&(this.tileBounds=new Ht(b.bounds,this.minzoom,this.maxzoom)),i.aj(b.tiles,this.map._requestManager._customAccessToken),this.fire(new i.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.b("data",{dataType:"source",sourceDataType:"content"}))),g&&g(_)})}hasTransition(){return!1}hasTile(g){return!this.tileBounds||this.tileBounds.contains(g.canonical)}loaded(){return this._loaded}loadTile(g,c){let u=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme)),_={request:this.map._requestManager.transformRequest(u,i.R.Tile),data:void 0,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,tileSize:this.tileSize*g.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:g.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(g.actor&&g.state!=="expired")if(g.state==="loading")g.reloadCallback=c;else{if(g.buckets){let S=Object.values(g.buckets);for(let A of S)A.dirty=!0;return void(g.state="loaded")}g.request=g.actor.send("reloadTile",_,b.bind(this))}else g.actor=this.dispatcher.getActor(),g.request=g.actor.send("loadTile",_,b.bind(this),void 0,!0);function b(S,A){return g.aborted?c(null):S&&S.status!==404?c(S):(A&&(A.resourceTiming&&(g.resourceTiming=A.resourceTiming),this.map._refreshExpiredTiles&&g.setExpiryData(A),g.buckets=Ti(Ti({},g.buckets),A.buckets),A.featureIndex&&(g.latestFeatureIndex=A.featureIndex)),g.state="loaded",void c(null))}}serialize(){return i.e({},this._options)}},canvas:class extends i.ap{constructor(g,c,u,_){super(g,c,u,_),c.coordinates?Array.isArray(c.coordinates)&&c.coordinates.length===4&&!c.coordinates.some(b=>!Array.isArray(b)||b.length!==2||b.some(S=>typeof S!="number"))||this.fire(new i.a(new Ne(`sources.${g}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new i.a(new Ne(`sources.${g}`,null,'missing required property "coordinates"'))),c.animate&&typeof c.animate!="boolean"&&this.fire(new i.a(new Ne(`sources.${g}`,null,'optional "animate" property must be a boolean value'))),c.canvas?typeof c.canvas=="string"||c.canvas instanceof HTMLCanvasElement||this.fire(new i.a(new Ne(`sources.${g}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new i.a(new Ne(`sources.${g}`,null,'missing required property "canvas"'))),this.options=c,this.animate=c.animate===void 0||c.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new i.a(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(g){this.map=g,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let g=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,g=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,g=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let c=this.map.painter.context;this.texture?!g&&!this._playing||this.texture instanceof i.ar||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new i.T(c,this.canvas,c.gl.RGBA,{premultiply:!0}),this._prepareData(c)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let g of[this.canvas.width,this.canvas.height])if(isNaN(g)||g<=0)return!0;return!1}},custom:class extends i.E{constructor(g,c,u,_){super(),this.id=g,this.type="custom",this._dataType="raster",this._dispatcher=u,this._implementation=c,this.setEventedParent(_),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new i.a(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new i.a(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Ht(this._implementation.bounds,this.minzoom,this.maxzoom)),c.update=this._update.bind(this),c.clearTiles=this._clearTiles.bind(this),c.coveringTiles=this._coveringTiles.bind(this),i.e(this,i.ac(c,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return i.ac(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new i.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.b("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(g){this._map=g,this._loaded=!1,this.fire(new i.b("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(g),this.load()}onRemove(g){this._implementation.onRemove&&this._implementation.onRemove(g)}hasTile(g){if(this._implementation.hasTile){let{x:c,y:u,z:_}=g.canonical;return this._implementation.hasTile({x:c,y:u,z:_})}return!this.tileBounds||this.tileBounds.contains(g.canonical)}loadTile(g,c){let{x:u,y:_,z:b}=g.tileID.canonical,S=new AbortController;g.request=Promise.resolve(this._implementation.loadTile({x:u,y:_,z:b},{signal:S.signal})).then((function(A){return delete g.request,g.aborted?(g.state="unloaded",c(null)):A===void 0?(g.state="errored",c(null)):A===null?(this.loadTileData(g,{width:this.tileSize,height:this.tileSize,data:null}),g.state="loaded",c(null)):function(P){return P instanceof ImageData||P instanceof HTMLCanvasElement||P instanceof ImageBitmap||P instanceof HTMLImageElement}(A)?(this.loadTileData(g,A),g.state="loaded",void c(null)):(g.state="errored",c(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(A=>{A.code!==20&&(g.state="errored",c(A))}),g.request.cancel=()=>S.abort()}loadTileData(g,c){g.setTexture(c,this._map.painter)}unloadTile(g,c){if(g.texture&&g.texture instanceof i.T?(g.destroy(!0),g.texture&&g.texture instanceof i.T&&this._map.painter.saveTileTexture(g.texture)):g.destroy(),this._implementation.unloadTile){let{x:u,y:_,z:b}=g.tileID.canonical;this._implementation.unloadTile({x:u,y:_,z:b})}c()}abortTile(g,c){g.request&&g.request.cancel&&(g.request.cancel(),delete g.request),c()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(g=>({x:g.canonical.x,y:g.canonical.y,z:g.canonical.z}))}_clearTiles(){let g=i.ag(this.id,this.scope);this._map.style.clearSource(g)}_update(){this.fire(new i.b("data",{dataType:"source",sourceDataType:"content"}))}}},Ps=function(g,c,u,_){let b=new kl[c.type](g,c,u,_);if(b.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${b.id}`);return i.aY(["load","abort","unload","serialize","prepare"],b),b};function Cf(g,c){let u=i.a6.identity([]);return i.a6.scale(u,u,[.5*g.width,.5*-g.height,1]),i.a6.translate(u,u,[1,-1,0]),i.a6.multiply(u,u,g.calculateProjMatrix(c.toUnwrapped())),Float32Array.from(u)}function If(g,c,u,_,b,S,A,P=!1){let k=g.tilesIn(_,A,P);k.sort(Q0);let O=[];for(let U of k)O.push({wrappedTileID:U.tile.tileID.wrapped().key,queryResults:U.tile.queryRenderedFeatures(c,u,g._state,U,b,S,Cf(g.transform,U.tile.tileID),P)});let z=function(U){let q={},X={};for(let Q of U){let K=Q.queryResults,re=Q.wrappedTileID,Y=X[re]=X[re]||{};for(let ae in K){let ge=K[ae],ce=Y[ae]=Y[ae]||{},_e=q[ae]=q[ae]||[];for(let oe of ge)ce[oe.featureIndex]||(ce[oe.featureIndex]=!0,_e.push(oe))}}return q}(O);for(let U in z)z[U].forEach(q=>{let X=q.feature,Q=X.layer;Q&&Q.type!=="background"&&Q.type!=="sky"&&Q.type!=="slot"&&(X.source=Q.source,Q["source-layer"]&&(X.sourceLayer=Q["source-layer"]),X.state=X.id!==void 0?g.getFeatureState(Q["source-layer"],X.id):{})});return z}function Dl(g,c){let u=g.getRenderableIds().map(S=>g.getTileByID(S)),_=[],b={};for(let S=0;S<u.length;S++){let A=u[S],P=A.tileID.canonical.key;b[P]||(b[P]=!0,A.querySourceFeatures(_,c))}return _}function Q0(g,c){let u=g.tileID,_=c.tileID;return u.overscaledZ-_.overscaledZ||u.canonical.y-_.canonical.y||u.wrap-_.wrap||u.canonical.x-_.canonical.x}class a0 extends _c{constructor(c,u,_,b,S){super(c,u,_,b,S),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(c,u){let _=u.context,b=_.gl;this.texture=this.texture||u.getTileTexture(c.width),this.texture&&this.texture instanceof i.T?this.texture.update(c,{useMipmap:!1,premultiply:!1}):this.texture=new i.T(_,c,b.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(c=16384,u){let _=this._mrt=new i.aZ(30),b=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(c-1)}});return this.entireBuffer=null,this.request=i.a_(b,(S,A,P,k)=>{if(S)u(S);else try{let O=_.getHeaderLength(A);if(O>c)return void(this.request=this.fetchHeader(O,u));_.parseHeader(A),this._isHeaderLoaded=!0;let z=0;for(let U of Object.values(_.layers))z=Math.max(z,U.dataIndex[U.dataIndex.length-1].last_byte);A.byteLength>=z&&(this.entireBuffer=A),u(null,this.entireBuffer||A,P,k)}catch(O){u(O)}}),this.request}fetchBand(c,u,_){let b=this._mrt;if(!this._isHeaderLoaded||!b)return void _(new Error("Tile header is not ready"));let S=this.actor;if(!S)return void _(new Error("Can't fetch tile band without an actor"));let A,P=(U,q)=>{A.complete(U,q),U?_(U):(this.updateTextureDescriptor(c,u),_(null,this.textureDescriptor&&this.textureDescriptor.img))},k=(U,q)=>{if(U)return _(U);let X=S.send("decodeRasterArray",{buffer:q,task:A},P,void 0,!0);this._workQueue.push(()=>{X&&X.cancel(),A.cancel()})},O=b.getLayer(c);if(!O)return void _(new Error(`Unknown sourceLayer "${c}"`));if(O.hasDataForBand(u))return this.updateTextureDescriptor(c,u),void _(null,this.textureDescriptor?this.textureDescriptor.img:null);let z=O.getDataRange([u]);if(A=b.createDecodingTask(z),!A||A.tasks.length)if(this.flushQueues(),this.entireBuffer)k(null,this.entireBuffer.slice(z.firstByte,z.lastByte+1));else{let U=Object.assign({},this.requestParams,{headers:{Range:`bytes=${z.firstByte}-${z.lastByte}`}}),q=i.a_(U,k);this._fetchQueue.push(()=>{q.cancel(),A.cancel()})}else _(null)}updateNeeded(c,u){return(!this.textureDescriptor||this.textureDescriptor.band!==u||this.textureDescriptor.layer!==c)&&this.state!=="errored"}updateTextureDescriptor(c,u){if(!this._mrt)return;let _=this._mrt.getLayer(c);if(!_||!_.hasBand(u)||!_.hasDataForBand(u))return;let{bytes:b,tileSize:S,buffer:A,offset:P,scale:k}=_.getBandView(u),O=S+2*A,z={data:b,width:O,height:O},U=this.texture;U&&U instanceof i.T&&U.update(z,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:c,band:u,img:z,buffer:A,offset:P,tileSize:S,format:_.pixelFormat,mix:[k,256*k,65536*k,16777216*k]}}}class eh{constructor(c,u){this.max=c,this.onRemove=u,this.reset()}reset(){for(let c in this.data)for(let u of this.data[c])u.timeout&&clearTimeout(u.timeout),this.onRemove(u.value);return this.data={},this.order=[],this}add(c,u,_){let b=c.wrapped().key;this.data[b]===void 0&&(this.data[b]=[]);let S={value:u,timeout:void 0};if(_!==void 0&&(S.timeout=setTimeout(()=>{this.remove(c,S)},_)),this.data[b].push(S),this.order.push(b),this.order.length>this.max){let A=this._getAndRemoveByKey(this.order[0]);A&&this.onRemove(A)}return this}has(c){return c.wrapped().key in this.data}getAndRemove(c){return this.has(c)?this._getAndRemoveByKey(c.wrapped().key):null}_getAndRemoveByKey(c){let u=this.data[c].shift();return u.timeout&&clearTimeout(u.timeout),this.data[c].length===0&&delete this.data[c],this.order.splice(this.order.indexOf(c),1),u.value}getByKey(c){let u=this.data[c];return u?u[0].value:null}get(c){return this.has(c)?this.data[c.wrapped().key][0].value:null}remove(c,u){if(!this.has(c))return this;let _=c.wrapped().key,b=u===void 0?0:this.data[_].indexOf(u),S=this.data[_][b];return this.data[_].splice(b,1),S.timeout&&clearTimeout(S.timeout),this.data[_].length===0&&delete this.data[_],this.onRemove(S.value),this.order.splice(this.order.indexOf(_),1),this}setMaxSize(c){for(this.max=c;this.order.length>this.max;){let u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this}filter(c){let u=[];for(let _ in this.data)for(let b of this.data[_])c(b.value)||u.push(b);for(let _ of u)this.remove(_.value.tileID,_)}}class Ha extends i.E{constructor(c,u,_){super(),this.id=c,this._onlySymbols=_,u.on("data",b=>{b.dataType==="source"&&b.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&b.dataType==="source"&&b.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),u.on("error",()=>{this._sourceErrored=!0}),this._source=u,this._tiles={},this._cache=new eh(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=u.minTileCacheSize,this._maxTileCacheSize=u.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new De,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(c){this.map=c,this._minTileCacheSize=this._minTileCacheSize===void 0&&c?c._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&c?c._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(let c in this._tiles){let u=this._tiles[c];if(u.state!=="errored"&&(u.state!=="loaded"||!u.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let c=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,c&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(c,u){return c.isSymbolTile=this._onlySymbols,c.isExtraShadowCaster=this._shadowCasterTiles[c.tileID.key],this._source.loadTile(c,u)}_unloadTile(c){if(this._source.unloadTile)return this._source.unloadTile(c,()=>{})}_abortTile(c){if(this._source.abortTile)return this._source.abortTile(c,()=>{})}serialize(){return this._source.serialize()}prepare(c){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let u in this._tiles){let _=this._tiles[u];_.upload(c),_.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return i.a$(this._tiles).map(c=>c.tileID).sort(lp).map(c=>c.key)}getRenderableIds(c,u){let _=[];for(let b in this._tiles)this._isIdRenderable(+b,c,u)&&_.push(this._tiles[b]);return c?_.sort((b,S)=>{let A=b.tileID,P=S.tileID,k=new i.P(A.canonical.x,A.canonical.y)._rotate(this.transform.angle),O=new i.P(P.canonical.x,P.canonical.y)._rotate(this.transform.angle);return A.overscaledZ-P.overscaledZ||O.y-k.y||O.x-k.x}).map(b=>b.tileID.key):_.map(b=>b.tileID).sort(lp).map(b=>b.key)}hasRenderableParent(c){let u=this.findLoadedParent(c,0);return!!u&&this._isIdRenderable(u.tileID.key)}_isIdRenderable(c,u,_){return this._tiles[c]&&this._tiles[c].hasData()&&!this._coveredTiles[c]&&(u||!this._tiles[c].holdingForFade())&&(_||!this._shadowCasterTiles[c])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let c in this._tiles)this._tiles[c].state!=="errored"&&this._reloadTile(+c,"reloading")}}_reloadTile(c,u){let _=this._tiles[c];_&&(_.state!=="loading"&&(_.state=u),this._loadTile(_,this._tileLoaded.bind(this,_,c,u)))}_tileLoaded(c,u,_,b){if(b)if(c.state="errored",b.status!==404)this._source.fire(new i.a(b,{tile:c}));else{if(!(c.tileID.key in this._loadedParentTiles))return void this._source.fire(new i.b("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){let S=this.map.painter.terrain;this.update(this.transform,S.getScaledDemTileSize(),!0),S.resetTileLookupCache(this.id)}else this.update(this.transform)}else c.timeAdded=i.f.now(),_==="expired"&&(c.refreshedUponExpiration=!0),this._setTileReloadTimer(u,c),this._source.type==="raster-dem"&&c.dem&&this._backfillDEM(c),this._state.initializeTileState(c,this.map?this.map.painter:null),this._source.fire(new i.b("data",{dataType:"source",tile:c,coord:c.tileID,sourceCacheId:this.id}))}_backfillDEM(c){let u=this.getRenderableIds();for(let b=0;b<u.length;b++){let S=u[b];if(c.neighboringTiles&&c.neighboringTiles[S]){let A=this.getTileByID(S);_(c,A),_(A,c)}}function _(b,S){if(!b.dem||b.dem.borderReady)return;b.needsHillshadePrepare=!0,b.needsDEMTextureUpload=!0;let A=S.tileID.canonical.x-b.tileID.canonical.x,P=S.tileID.canonical.y-b.tileID.canonical.y,k=Math.pow(2,b.tileID.canonical.z),O=S.tileID.key;A===0&&P===0||Math.abs(P)>1||(Math.abs(A)>1&&(Math.abs(A+k)===1?A+=k:Math.abs(A-k)===1&&(A-=k)),S.dem&&b.dem&&(b.dem.backfillBorder(S.dem,A,P),b.neighboringTiles&&b.neighboringTiles[O]&&(b.neighboringTiles[O].backfilled=!0)))}}getTile(c){return this.getTileByID(c.key)}getTileByID(c){return this._tiles[c]}_retainLoadedChildren(c,u,_,b){for(let S in this._tiles){let A=this._tiles[S];if(b[S]||!A.hasData()||A.tileID.overscaledZ<=u||A.tileID.overscaledZ>_)continue;let P=A.tileID;for(;A&&A.tileID.overscaledZ>u+1;){let O=A.tileID.scaledTo(A.tileID.overscaledZ-1);A=this._tiles[O.key],A&&A.hasData()&&(P=O)}let k=P;for(;k.overscaledZ>u;)if(k=k.scaledTo(k.overscaledZ-1),c[k.key]){b[P.key]=P;break}}}findLoadedParent(c,u){if(c.key in this._loadedParentTiles){let _=this._loadedParentTiles[c.key];return _&&_.tileID.overscaledZ>=u?_:null}for(let _=c.overscaledZ-1;_>=u;_--){let b=c.scaledTo(_),S=this._getLoadedTile(b);if(S)return S}}_getLoadedTile(c){let u=this._tiles[c.key];return u&&u.hasData()?u:this._cache.getByKey(this._source.reparseOverscaled?c.wrapped().key:c.canonical.key)}updateCacheSize(c,u){u=u||this._source.tileSize;let _=Math.ceil(c.width/u)+1,b=Math.ceil(c.height/u)+1,S=Math.floor(_*b*5),A=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,S):S,P=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,A):A;this._cache.setMaxSize(P)}handleWrapJump(c){let u=Math.round((c-(this._prevLng===void 0?c:this._prevLng))/360);if(this._prevLng=c,u){let _={};for(let b in this._tiles){let S=this._tiles[b];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+u),_[S.tileID.key]=S}this._tiles=_;for(let b in this._timers)clearTimeout(this._timers[b]),delete this._timers[b];for(let b in this._tiles)this._setTileReloadTimer(+b,this._tiles[b])}}update(c,u,_,b){if(this.transform=c,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!_)return;let S;if(this.updateCacheSize(c,u),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain)if(this._source.tileID)S=c.getVisibleUnwrappedCoordinates(this._source.tileID).map(k=>new i.am(k.canonical.z,k.wrap,k.canonical.z,k.canonical.x,k.canonical.y));else if(this.tileCoverLift!==0){let k=c.clone();k.tileCoverLift=this.tileCoverLift,S=k.coveringTiles({tileSize:u||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!_,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.minzoom<=1&&c.projection.name==="globe"&&(S.push(new i.am(1,0,1,0,0)),S.push(new i.am(1,0,1,1,0)),S.push(new i.am(1,0,1,0,1)),S.push(new i.am(1,0,1,1,1)))}else S=c.coveringTiles({tileSize:u||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!_,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(S=S.filter(k=>this._source.hasTile(k)));else S=[];if(S.length>0&&this.castsShadows&&b&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Ll(this._source.type)){let k=c.coveringZoomLevel({tileSize:u||this._source.tileSize,roundZoom:this._source.roundZoom&&!_}),O=Math.min(k,this._source.maxzoom),z=c.extendTileCoverForShadows(S,b,O);for(let U of z)this._shadowCasterTiles[U.key]=!0,S.push(U)}let A=this._updateRetainedTiles(S);if(Ll(this._source.type)&&S.length!==0){let k={},O={},z=Object.keys(A);for(let q of z){let X=A[q],Q=this._tiles[q];if(!Q||Q.fadeEndTime&&Q.fadeEndTime<=i.f.now())continue;let K=this.findLoadedParent(X,Math.max(X.overscaledZ-Ha.maxOverzooming,this._source.minzoom));K&&(this._addTile(K.tileID),k[K.tileID.key]=K.tileID),O[q]=X}let U=S[S.length-1].overscaledZ;for(let q in this._tiles){let X=this._tiles[q];if(A[q]||!X.hasData())continue;let Q=X.tileID;for(;Q.overscaledZ>U;){Q=Q.scaledTo(Q.overscaledZ-1);let K=this._tiles[Q.key];if(K&&K.hasData()&&O[Q.key]){A[q]=X.tileID;break}}}for(let q in k)A[q]||(this._coveredTiles[q]=!0,A[q]=k[q])}for(let k in A)this._tiles[k].clearFadeHold();let P=i.b0(this._tiles,A);for(let k of P){let O=this._tiles[k];O.hasSymbolBuckets&&!O.holdingForFade()?O.setHoldDuration(this.map._fadeDuration):O.hasSymbolBuckets&&!O.symbolFadeFinished()||this._removeTile(+k)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(let c in this._tiles)this._tiles[c].holdingForFade()&&this._removeTile(+c)}_updateRetainedTiles(c){let u={};if(c.length===0)return u;let _={},b=c.reduce((O,z)=>Math.min(O,z.overscaledZ),1/0),S=c[0].overscaledZ,A=Math.max(S-Ha.maxOverzooming,this._source.minzoom),P=Math.max(S+Ha.maxUnderzooming,this._source.minzoom),k={};for(let O of c){let z=this._addTile(O);u[O.key]=O,z.hasData()||b<this._source.maxzoom&&(k[O.key]=O)}this._retainLoadedChildren(k,b,P,u);for(let O of c){let z=this._tiles[O.key];if(z.hasData())continue;if(O.canonical.z>=this._source.maxzoom){let q=O.children(this._source.maxzoom)[0],X=this.getTile(q);if(X&&X.hasData()){u[q.key]=q;continue}}else{let q=O.children(this._source.maxzoom);if(u[q[0].key]&&u[q[1].key]&&u[q[2].key]&&u[q[3].key])continue}let U=z.wasRequested();for(let q=O.overscaledZ-1;q>=A;--q){let X=O.scaledTo(q);if(_[X.key]||(_[X.key]=!0,z=this.getTile(X),!z&&U&&(z=this._addTile(X)),z&&(u[X.key]=X,U=z.wasRequested(),z.hasData())))break}}return u}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let c in this._tiles){let u=[],_,b=this._tiles[c].tileID;for(;b.overscaledZ>0;){if(b.key in this._loadedParentTiles){_=this._loadedParentTiles[b.key];break}u.push(b.key);let S=b.scaledTo(b.overscaledZ-1);if(_=this._getLoadedTile(S),_)break;b=S}for(let S of u)this._loadedParentTiles[S]=_}}_addTile(c){let u=this._tiles[c.key];if(u)return u.isExtraShadowCaster!==!0||this._shadowCasterTiles[c.key]||this._reloadTile(c.key,"reloading"),u;u=this._cache.getAndRemove(c),u&&(this._setTileReloadTimer(c.key,u),u.tileID=c,this._state.initializeTileState(u,this.map?this.map.painter:null),this._cacheTimers[c.key]&&(clearTimeout(this._cacheTimers[c.key]),delete this._cacheTimers[c.key],this._setTileReloadTimer(c.key,u)));let _=!!u;if(!_){let b=this.map?this.map.painter:null,S=this._source.tileSize*c.overscaleFactor();u=this._source.type==="raster-array"?new a0(c,S,this.transform.tileZoom,b,this._isRaster):new _c(c,S,this.transform.tileZoom,b,this._isRaster),this._loadTile(u,this._tileLoaded.bind(this,u,c.key,u.state))}return u?(u.uses++,this._tiles[c.key]=u,_||this._source.fire(new i.b("dataloading",{tile:u,coord:u.tileID,dataType:"source"})),u):null}_setTileReloadTimer(c,u){c in this._timers&&(clearTimeout(this._timers[c]),delete this._timers[c]);let _=u.getExpiryTimeout();_&&(this._timers[c]=setTimeout(()=>{this._reloadTile(c,"expired"),delete this._timers[c]},_))}_removeTile(c){let u=this._tiles[c];u&&(u.uses--,delete this._tiles[c],this._timers[c]&&(clearTimeout(this._timers[c]),delete this._timers[c]),u.uses>0||(u.hasData()&&u.state!=="reloading"||u.state==="empty"?this._cache.add(u.tileID,u,u.getExpiryTimeout()):(u.aborted=!0,this._abortTile(u),this._unloadTile(u))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let c in this._tiles)this._removeTile(+c);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(c,u,_){let b=[],S=this.transform;if(!S)return b;let A=S.projection.name==="globe",P=i.a5(S.center.lng);for(let k in this._tiles){let O=this._tiles[k];if(_&&O.clearQueryDebugViz(),O.holdingForFade())continue;let z;if(A){let U=O.tileID.canonical;if(U.z===0){let q=[Math.abs(i.aa(P,...Ad(U,-1))-P),Math.abs(i.aa(P,...Ad(U,1))-P)];z=[0,2*q.indexOf(Math.min(...q))-1]}else{let q=[Math.abs(i.aa(P,...Ad(U,-1))-P),Math.abs(i.aa(P,...Ad(U,0))-P),Math.abs(i.aa(P,...Ad(U,1))-P)];z=[q.indexOf(Math.min(...q))-1]}}else z=[0];for(let U of z){let q=c.containsTile(O,S,u,U);q&&b.push(q)}}return b}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(c){return this._getRenderableCoordinates(c)}_getRenderableCoordinates(c,u){let _=this.getRenderableIds(c,u).map(S=>this._tiles[S].tileID),b=this.transform.projection.name==="globe";for(let S of _)S.projMatrix=this.transform.calculateProjMatrix(S.toUnwrapped()),S.expandedProjMatrix=b?this.transform.calculateProjMatrix(S.toUnwrapped(),!1,!0):S.projMatrix;return _}sortCoordinatesByDistance(c){let u=c.slice(),_=this.transform._camera.position,b=this.transform._camera.forward(),S={};for(let A of u){let P=1/(1<<A.canonical.z);S[A.key]=((A.canonical.x+.5)*P+A.wrap-_[0])*b[0]+((A.canonical.y+.5)*P-_[1])*b[1]-_[2]*b[2]}return u.sort((A,P)=>S[A.key]-S[P.key]),u}hasTransition(){if(this._source.hasTransition())return!0;if(Ll(this._source.type))for(let c in this._tiles){let u=this._tiles[c];if(u.fadeEndTime!==void 0&&u.fadeEndTime>=i.f.now())return!0}return!1}setFeatureState(c,u,_){this._state.updateState(c=c||"_geojsonTileLayer",u,_)}removeFeatureState(c,u,_){this._state.removeFeatureState(c=c||"_geojsonTileLayer",u,_)}getFeatureState(c,u){return this._state.getState(c=c||"_geojsonTileLayer",u)}setDependencies(c,u,_){let b=this._tiles[c];b&&b.setDependencies(u,_)}reloadTilesForDependencies(c,u){for(let _ in this._tiles)this._tiles[_].hasDependency(c,u)&&this._reloadTile(+_,"reloading");this._cache.filter(_=>!_.hasDependency(c,u))}_preloadTiles(c,u){if(!this._sourceLoaded){let k=()=>{this._sourceLoaded&&(this._source.off("data",k),this._preloadTiles(c,u))};return void this._source.on("data",k)}let _=new Map,b=Array.isArray(c)?c:[c],S=this.map.painter.terrain,A=this.usedForTerrain&&S?S.getScaledDemTileSize():this._source.tileSize;for(let k of b){let O=k.coveringTiles({tileSize:A,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(let z of O)_.set(z.key,z);this.usedForTerrain&&k.updateElevation(!1)}let P=Array.from(_.values());i.b1(P,(k,O)=>{let z=new _c(k,this._source.tileSize*k.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(z,U=>{this._source.type==="raster-dem"&&z.dem&&this._backfillDEM(z),O(U,z)})},u)}}function lp(g,c){let u=Math.abs(2*g.wrap)-+(g.wrap<0),_=Math.abs(2*c.wrap)-+(c.wrap<0);return g.overscaledZ-c.overscaledZ||_-u||c.canonical.y-g.canonical.y||c.canonical.x-g.canonical.x}function Ll(g){return g==="raster"||g==="image"||g==="video"||g==="custom"}function Ad(g,c){let u=1<<g.z;return[g.x/u+c,(g.x+1)/u+c]}Ha.maxOverzooming=10,Ha.maxUnderzooming=3;class T_{constructor(c){this.style=c,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];let c=!1,u=!1;for(let _ in this.style._mergedLayers){let b=this.style._mergedLayers[_];if(b.type==="fill-extrusion")this.layers.push({layer:b,visible:c,visibilityChanged:u});else if(b.type==="model"){let S=this.style.getLayerSource(b);S&&S.type==="batched-model"&&this.layers.push({layer:b,visible:c,visibilityChanged:u})}}}onNewFrame(c){this.layersGotHidden=!1;for(let u of this.layers){let _=u.layer,b=!1;_.type==="fill-extrusion"?b=!_.isHidden(c)&&_.paint.get("fill-extrusion-opacity")>0:_.type==="model"&&(b=!_.isHidden(c)&&_.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!b&&u.visible,u.visible=b}}updateZOffset(c,u){this.currentBuildingBuckets=[];for(let b of this.layers){let S=b.layer,A=this.style.getLayerSourceCache(S),P=1;S.type==="fill-extrusion"&&(P=b.visible?S.paint.get("fill-extrusion-vertical-scale"):0);let k=A?A.getTile(u):null;if(!k&&A&&u.canonical.z>A.getSource().minzoom){let O=u.scaledTo(Math.min(A.getSource().maxzoom,u.overscaledZ-1));for(;O.overscaledZ>=A.getSource().minzoom&&(k=A.getTile(O),!k&&O.overscaledZ!==0);)O=O.scaledTo(O.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:k?k.getBucket(S):null,tileID:k?k.tileID:u,verticalScale:P})}c.hasAnyZOffset=!1;let _=!1;for(let b=0;b<c.symbolInstances.length;b++){let S=c.symbolInstances.get(b),A=S.zOffset,P=this._getHeightAtTileOffset(u,S.tileAnchorX,S.tileAnchorY);S.zOffset=P!==Number.NEGATIVE_INFINITY?P:A,_||A===S.zOffset||(_=!0),c.hasAnyZOffset||S.zOffset===0||(c.hasAnyZOffset=!0)}_&&(c.zOffsetBuffersNeedUpload=!0,c.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(c,u,_,b){let S=u,A=_;if(c.canonical.z!==b.canonical.z){let P=b.canonical,k=1/(1<<c.canonical.z-P.z);S=(u+c.canonical.x*i.V)*k-P.x*i.V|0,A=(_+c.canonical.y*i.V)*k-P.y*i.V|0}return{tileX:S,tileY:A}}_getHeightAtTileOffset(c,u,_){let b,S;for(let A=0;A<this.layers.length;++A){if(this.layers[A].layer.type!=="fill-extrusion")continue;let{bucket:P,tileID:k,verticalScale:O}=this.currentBuildingBuckets[A];if(!P)continue;let{tileX:z,tileY:U}=this._mapCoordToOverlappingTile(c,u,_,k),q=P.getHeightAtTileCoord(z,U);q&&q.height!==void 0&&(q.hidden?b=q.height:S=Math.max(q.height*O,S||0))}if(S!==void 0)return S;for(let A=0;A<this.layers.length;++A){let P=this.layers[A];if(P.layer.type!=="model"||!P.visible)continue;let{bucket:k,tileID:O}=this.currentBuildingBuckets[A];if(!k)continue;let{tileX:z,tileY:U}=this._mapCoordToOverlappingTile(c,u,_,O),q=k.getHeightAtTileCoord(z,U);if(q&&!q.hidden)return q.height===void 0&&b!==void 0?Math.min(q.maxHeight,b)*q.verticalScale:(q.height||0)*q.verticalScale}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function l0(g,c){let u={};for(let _ in g)_!=="ref"&&(u[_]=g[_]);return i.b2.forEach(_=>{_ in c&&(u[_]=c[_])}),u}function M_(g){g=g.slice();let c=Object.create(null);for(let u=0;u<g.length;u++)c[g[u].id]=g[u];for(let u=0;u<g.length;u++)"ref"in g[u]&&(g[u]=l0(g[u],c[g[u].ref]));return g}let jn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function Cd(g,c,u){u.push({command:jn.addSource,args:[g,c[g]]})}function Pf(g,c,u){c.push({command:jn.removeSource,args:[g]}),u[g]=!0}function Ty(g,c,u,_){Pf(g,u,_),Cd(g,c,u)}function My(g,c,u){let _;for(_ in g[u])if(g[u].hasOwnProperty(_)&&_!=="data"&&!f(g[u][_],c[u][_]))return!1;for(_ in c[u])if(c[u].hasOwnProperty(_)&&_!=="data"&&!f(g[u][_],c[u][_]))return!1;return!0}function yc(g,c,u,_,b,S){let A;for(A in c=c||{},g=g||{})g.hasOwnProperty(A)&&(f(g[A],c[A])||u.push({command:S,args:[_,A,c[A],b]}));for(A in c)c.hasOwnProperty(A)&&!g.hasOwnProperty(A)&&(f(g[A],c[A])||u.push({command:S,args:[_,A,c[A],b]}))}function vc(g){return g.id}function cp(g,c){return g[c.id]=c,g}class th{constructor(c,u){this.reset(c,u)}reset(c,u){this.points=c||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(c){if(this.points.length===1)return this.points[0];c=i.aa(c,0,1);let u=1,_=this._distances[u],b=c*this.paddedLength+this.padding;for(;_<b&&u<this._distances.length;)_=this._distances[++u];let S=u-1,A=this._distances[S],P=_-A,k=P>0?(b-A)/P:0;return this.points[S].mult(1-k).add(this.points[u].mult(k))}}class Rf{constructor(c,u,_){let b=this.boxCells=[],S=this.circleCells=[];this.xCellCount=Math.ceil(c/_),this.yCellCount=Math.ceil(u/_);for(let A=0;A<this.xCellCount*this.yCellCount;A++)b.push([]),S.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=c,this.height=u,this.xScale=this.xCellCount/c,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(c,u,_,b,S){this._forEachCell(u,_,b,S,this._insertBoxCell,this.boxUid++),this.boxKeys.push(c),this.bboxes.push(u),this.bboxes.push(_),this.bboxes.push(b),this.bboxes.push(S)}insertCircle(c,u,_,b){this._forEachCell(u-b,_-b,u+b,_+b,this._insertCircleCell,this.circleUid++),this.circleKeys.push(c),this.circles.push(u),this.circles.push(_),this.circles.push(b)}_insertBoxCell(c,u,_,b,S,A){this.boxCells[S].push(A)}_insertCircleCell(c,u,_,b,S,A){this.circleCells[S].push(A)}_query(c,u,_,b,S,A){if(_<0||c>this.width||b<0||u>this.height)return!S&&[];let P=[];if(c<=0&&u<=0&&this.width<=_&&this.height<=b){if(S)return!0;for(let k=0;k<this.boxKeys.length;k++)P.push({key:this.boxKeys[k],x1:this.bboxes[4*k],y1:this.bboxes[4*k+1],x2:this.bboxes[4*k+2],y2:this.bboxes[4*k+3]});for(let k=0;k<this.circleKeys.length;k++){let O=this.circles[3*k],z=this.circles[3*k+1],U=this.circles[3*k+2];P.push({key:this.circleKeys[k],x1:O-U,y1:z-U,x2:O+U,y2:z+U})}return A?P.filter(A):P}return this._forEachCell(c,u,_,b,this._queryCell,P,{hitTest:S,seenUids:{box:{},circle:{}}},A),S?P.length>0:P}_queryCircle(c,u,_,b,S){let A=c-_,P=c+_,k=u-_,O=u+_;if(P<0||A>this.width||O<0||k>this.height)return!b&&[];let z=[];return this._forEachCell(A,k,P,O,this._queryCellCircle,z,{hitTest:b,circle:{x:c,y:u,radius:_},seenUids:{box:{},circle:{}}},S),b?z.length>0:z}query(c,u,_,b,S){return this._query(c,u,_,b,!1,S)}hitTest(c,u,_,b,S){return this._query(c,u,_,b,!0,S)}hitTestCircle(c,u,_,b){return this._queryCircle(c,u,_,!0,b)}_queryCell(c,u,_,b,S,A,P,k){let O=P.seenUids,z=this.boxCells[S];if(z!==null){let q=this.bboxes;for(let X of z)if(!O.box[X]){O.box[X]=!0;let Q=4*X;if(c<=q[Q+2]&&u<=q[Q+3]&&_>=q[Q+0]&&b>=q[Q+1]&&(!k||k(this.boxKeys[X]))){if(P.hitTest)return A.push(!0),!0;A.push({key:this.boxKeys[X],x1:q[Q],y1:q[Q+1],x2:q[Q+2],y2:q[Q+3]})}}}let U=this.circleCells[S];if(U!==null){let q=this.circles;for(let X of U)if(!O.circle[X]){O.circle[X]=!0;let Q=3*X;if(this._circleAndRectCollide(q[Q],q[Q+1],q[Q+2],c,u,_,b)&&(!k||k(this.circleKeys[X]))){if(P.hitTest)return A.push(!0),!0;{let K=q[Q],re=q[Q+1],Y=q[Q+2];A.push({key:this.circleKeys[X],x1:K-Y,y1:re-Y,x2:K+Y,y2:re+Y})}}}}}_queryCellCircle(c,u,_,b,S,A,P,k){let O=P.circle,z=P.seenUids,U=this.boxCells[S];if(U!==null){let X=this.bboxes;for(let Q of U)if(!z.box[Q]){z.box[Q]=!0;let K=4*Q;if(this._circleAndRectCollide(O.x,O.y,O.radius,X[K+0],X[K+1],X[K+2],X[K+3])&&(!k||k(this.boxKeys[Q])))return A.push(!0),!0}}let q=this.circleCells[S];if(q!==null){let X=this.circles;for(let Q of q)if(!z.circle[Q]){z.circle[Q]=!0;let K=3*Q;if(this._circlesCollide(X[K],X[K+1],X[K+2],O.x,O.y,O.radius)&&(!k||k(this.circleKeys[Q])))return A.push(!0),!0}}}_forEachCell(c,u,_,b,S,A,P,k){let O=this._convertToXCellCoord(c),z=this._convertToYCellCoord(u),U=this._convertToXCellCoord(_),q=this._convertToYCellCoord(b);for(let X=O;X<=U;X++)for(let Q=z;Q<=q;Q++)if(S.call(this,c,u,_,b,this.xCellCount*Q+X,A,P,k))return}_convertToXCellCoord(c){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(c*this.xScale)))}_convertToYCellCoord(c){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(c*this.yScale)))}_circlesCollide(c,u,_,b,S,A){let P=b-c,k=S-u,O=_+A;return O*O>P*P+k*k}_circleAndRectCollide(c,u,_,b,S,A,P){let k=(A-b)/2,O=Math.abs(c-(b+k));if(O>k+_)return!1;let z=(P-S)/2,U=Math.abs(u-(S+z));if(U>z+_)return!1;if(O<=k||U<=z)return!0;let q=O-k,X=U-z;return q*q+X*X<=_*_}}let Fl={unknown:0,flipRequired:1,flipNotRequired:2},xc=Math.tan(85*Math.PI/180);function Id(g,c,u,_,b,S,A){let P=i.a6.create();if(u)if(S.name==="globe"){let k=i.b3(b,c);i.a6.multiply(P,P,k)}else{let k=i.b4.invert([],A);P[0]=k[0],P[1]=k[1],P[4]=k[2],P[5]=k[3],_||i.a6.rotateZ(P,P,b.angle)}else i.a6.multiply(P,b.labelPlaneMatrix,g);return P}function kf(g,c,u,_,b,S,A){let P=Id(g,c,u,_,b,S,A);return S.name==="globe"&&u||(P[2]=P[6]=P[10]=P[14]=0),P}function Df(g,c,u,_,b,S,A){if(u){if(S.name==="globe"){let P=Id(g,c,u,_,b,S,A);return i.a6.invert(P,P),i.a6.multiply(P,g,P),P}{let P=i.a6.clone(g),k=i.a6.identity([]);return k[0]=A[0],k[1]=A[1],k[4]=A[2],k[5]=A[3],i.a6.multiply(P,P,k),_||i.a6.rotateZ(P,P,-b.angle),P}}return b.glCoordMatrix}function Ma(g,c,u,_){let b=[g,c,u,1];u?i.a7.transformMat4(b,b,_):Bf(b,b,_);let S=b[3];return b[0]/=S,b[1]/=S,b[2]/=S,b}function E_(g,c){return Math.min(.5+g/c*.5,1.5)}function Lf(g,c){let u=g[0]/g[3],_=g[1]/g[3];return u>=-c[0]&&u<=c[0]&&_>=-c[1]&&_<=c[1]}function Ff(g,c,u,_,b,S,A,P,k,O){let z=u.transform,U=_?g.textSizeData:g.iconSizeData,q=i.b5(U,u.transform.zoom),X=z.projection.name==="globe",Q=[256/u.width*2+1,256/u.height*2+1],K=_?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;K.clear();let re=null;X&&(re=_?g.text.globeExtVertexArray:g.icon.globeExtVertexArray);let Y=g.lineVertexArray,ae=_?g.text.placedSymbolArray:g.icon.placedSymbolArray,ge=u.transform.width/u.transform.height,ce,_e=!1;for(let oe=0;oe<ae.length;oe++){let ve=ae.get(oe),{numGlyphs:Ae,writingMode:Re}=ve;if(Re!==i.b6.vertical||_e||ce===i.b6.horizontal||(_e=!0),ce=Re,(ve.hidden||Re===i.b6.vertical)&&!_e){bc(Ae,K);continue}_e=!1;let Oe=new i.P(ve.tileAnchorX,ve.tileAnchorY),{x:Je,y:Ue,z:ot}=z.projection.projectTilePoint(Oe.x,Oe.y,O.canonical);if(k){let[ti,mi,Ei]=k(Oe);Je+=ti,Ue+=mi,ot+=Ei}let nt=[Je,Ue,ot,1];if(i.a7.transformMat4(nt,nt,c),!Lf(nt,Q)){bc(Ae,K);continue}let Rt=nt[3],je=E_(u.transform.getCameraToCenterDistance(z.projection),Rt),tt=i.b7(U,q,ve),Fe=A?tt/je:tt*je,Ze=Ma(Je,Ue,ot,b);if(Ze[3]<=0){bc(Ae,K);continue}let Dt={},jt=A?null:k,Ut=zf(ve,Fe,!1,P,c,b,S,g.glyphOffsetArray,Y,K,re,Ze,Oe,Dt,ge,jt,z.projection,O,A);_e=Ut.useVertical,jt&&Ut.needsFlipping&&(Dt={}),(Ut.notEnoughRoom||_e||Ut.needsFlipping&&zf(ve,Fe,!0,P,c,b,S,g.glyphOffsetArray,Y,K,re,Ze,Oe,Dt,ge,jt,z.projection,O,A).notEnoughRoom)&&bc(Ae,K)}_?(g.text.dynamicLayoutVertexBuffer.updateData(K),re&&g.text.globeExtVertexBuffer&&g.text.globeExtVertexBuffer.updateData(re)):(g.icon.dynamicLayoutVertexBuffer.updateData(K),re&&g.icon.globeExtVertexBuffer&&g.icon.globeExtVertexBuffer.updateData(re))}function Of(g,c,u,_,b,S,A,P,k,O,z,U,q,X,Q,K){let{lineStartIndex:re,glyphStartIndex:Y,segment:ae}=P,ge=Y+P.numGlyphs,ce=re+P.lineLength,_e=c.getoffsetX(Y),oe=c.getoffsetX(ge-1),ve=Pd(g*_e,u,_,b,S,A,ae,re,ce,k,O,z,U,q,!0,X,Q,K);if(!ve)return null;let Ae=Pd(g*oe,u,_,b,S,A,ae,re,ce,k,O,z,U,q,!0,X,Q,K);return Ae?{first:ve,last:Ae}:null}function Nf(g,c,u,_){return g===i.b6.horizontal&&Math.abs(_)>Math.abs(u)?{useVertical:!0}:g===i.b6.vertical?_>0?{needsFlipping:!0}:null:c!==Fl.unknown&&function(b,S){return b===0||Math.abs(S/b)>xc}(u,_)?c===Fl.flipRequired?{needsFlipping:!0}:null:u<0?{needsFlipping:!0}:null}function zf(g,c,u,_,b,S,A,P,k,O,z,U,q,X,Q,K,re,Y,ae){let ge=c/24,ce=g.lineOffsetX*ge,_e=g.lineOffsetY*ge,{lineStartIndex:oe,glyphStartIndex:ve,numGlyphs:Ae,segment:Re,writingMode:Oe,flipState:Je}=g,Ue=oe+g.lineLength,ot=nt=>{if(z){let[Fe,Ze,Dt]=nt.up,jt=O.length;i.b8(z,jt+0,Fe,Ze,Dt),i.b8(z,jt+1,Fe,Ze,Dt),i.b8(z,jt+2,Fe,Ze,Dt),i.b8(z,jt+3,Fe,Ze,Dt)}let[Rt,je,tt]=nt.point;i.b9(O,Rt,je,tt,nt.angle)};if(Ae>1){let nt=Of(ge,P,ce,_e,u,U,q,g,k,S,X,K,!1,re,Y,ae);if(!nt)return{notEnoughRoom:!0};if(_&&!u){let[Rt,je,tt]=nt.first.point,[Fe,Ze,Dt]=nt.last.point;[Rt,je]=Ma(Rt,je,tt,A),[Fe,Ze]=Ma(Fe,Ze,Dt,A);let jt=Nf(Oe,Je,(Fe-Rt)*Q,Ze-je);if(g.flipState=jt&&jt.needsFlipping?Fl.flipRequired:Fl.flipNotRequired,jt)return jt}ot(nt.first);for(let Rt=ve+1;Rt<ve+Ae-1;Rt++){let je=Pd(ge*P.getoffsetX(Rt),ce,_e,u,U,q,Re,oe,Ue,k,S,X,K,!1,!1,re,Y,ae);if(!je)return O.length-=4*(Rt-ve),{notEnoughRoom:!0};ot(je)}ot(nt.last)}else{if(_&&!u){let Rt=Ma(q.x,q.y,0,b),je=oe+Re+1,tt=new i.P(k.getx(je),k.gety(je)),Fe=Ma(tt.x,tt.y,0,b),Ze=Fe[3]>0?Fe:hp(q,tt,Rt,1,b,void 0,re,Y.canonical),Dt=Nf(Oe,Je,(Ze[0]-Rt[0])*Q,Ze[1]-Rt[1]);if(g.flipState=Dt&&Dt.needsFlipping?Fl.flipRequired:Fl.flipNotRequired,Dt)return Dt}let nt=Pd(ge*P.getoffsetX(ve),ce,_e,u,U,q,Re,oe,Ue,k,S,X,K,!1,!1,re,Y,ae);if(!nt)return{notEnoughRoom:!0};ot(nt)}return{}}function ih(g,c,u,_,b){let{x:S,y:A,z:P}=_.projectTilePoint(g.x,g.y,c);if(!b)return Ma(S,A,P,u);let[k,O,z]=b(g);return Ma(S+k,A+O,P+z,u)}function hp(g,c,u,_,b,S,A,P){let k=ih(g.sub(c)._unit()._add(g),P,b,A,S);return i.N.sub(k,u,k),i.N.normalize(k,k),i.N.scaleAndAdd(k,u,k,_)}function Pd(g,c,u,_,b,S,A,P,k,O,z,U,q,X,Q,K,re,Y){let ae=_?g-c:g+c,ge=ae>0?1:-1,ce=0;_&&(ge*=-1,ce=Math.PI),ge<0&&(ce+=Math.PI);let _e=P+A+(ge>0?0:1)|0,oe=b,ve=b,Ae=0,Re=0,Oe=Math.abs(ae),Je=[],Ue=[],ot=S,nt=ot,Rt=()=>hp(nt,ot,ve,Oe-Ae+1,z,q,K,re.canonical);for(;Ae+Re<=Oe;){if(_e+=ge,_e<P||_e>=k)return null;if(ve=oe,nt=ot,Je.push(ve),X&&Ue.push(nt),ot=new i.P(O.getx(_e),O.gety(_e)),oe=U[_e],!oe){let mi=ih(ot,re.canonical,z,K,q);oe=mi[3]>0?U[_e]=mi:Rt()}Ae+=Re,Re=i.N.distance(ve,oe)}Q&&q&&(U[_e]&&(oe=Rt(),Re=i.N.distance(ve,oe)),U[_e]=oe);let je=(Oe-Ae)/Re,tt=ot.sub(nt)._mult(je)._add(nt),Fe=i.N.sub([],oe,ve),Ze=i.N.scaleAndAdd([],ve,Fe,je),Dt=[0,0,1],jt=Fe[0],Ut=Fe[1];if(Y&&(Dt=K.upVector(re.canonical,tt.x,tt.y),Dt[0]!==0||Dt[1]!==0||Dt[2]!==1)){let mi=[Dt[2],0,-Dt[0]],Ei=i.N.cross([],Dt,mi);i.N.normalize(mi,mi),i.N.normalize(Ei,Ei),jt=i.N.dot(Fe,mi),Ut=i.N.dot(Fe,Ei)}if(u){let mi=i.N.cross([],Dt,Fe);i.N.normalize(mi,mi),i.N.scaleAndAdd(Ze,Ze,mi,u*ge)}let ti=ce+Math.atan2(Ut,jt);return Je.push(Ze),X&&Ue.push(tt),{point:Ze,angle:ti,path:Je,tilePath:Ue,up:Dt}}function bc(g,c){let u=c.length,_=u+4*g;c.resize(_),c.float32.fill(-1/0,4*u,4*_)}function Bf(g,c,u){let _=c[0],b=c[1];return g[0]=u[0]*_+u[4]*b+u[12],g[1]=u[1]*_+u[5]*b+u[13],g[3]=u[3]*_+u[7]*b+u[15],g}let Ea=100;class ii{constructor(c,u,_=new Rf(c.width+200,c.height+200,25),b=new Rf(c.width+200,c.height+200,25)){this.transform=c,this.grid=_,this.ignoredGrid=b,this.pitchfactor=Math.cos(c._pitch)*c.cameraToCenterDistance,this.screenRightBoundary=c.width+Ea,this.screenBottomBoundary=c.height+Ea,this.gridRightBoundary=c.width+200,this.gridBottomBoundary=c.height+200,this.fogState=u}placeCollisionBox(c,u,_,b,S,A,P,k){let O=_.projectedAnchorX,z=_.projectedAnchorY,U=_.projectedAnchorZ,q=_.elevation,X=_.tileID,Q=c.getProjection();if(q&&X){let[oe,ve,Ae]=Q.upVector(X.canonical,_.tileAnchorX,_.tileAnchorY),Re=Q.upVectorScale(X.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;O+=oe*q*Re,z+=ve*q*Re,U+=Ae*q*Re}let K=this.projectAndGetPerspectiveRatio(P,O,z,U,_.tileID,Q.name==="globe"||!!q||this.transform.pitch>0,Q),re=A*K.perspectiveRatio,Y=(_.x1*u+b.x-_.padding)*re+K.point.x,ae=(_.y1*u+b.y-_.padding)*re+K.point.y,ge=(_.x2*u+b.x+_.padding)*re+K.point.x,ce=(_.y2*u+b.y+_.padding)*re+K.point.y,_e=K.perspectiveRatio<=.55||K.occluded;return!this.isInsideGrid(Y,ae,ge,ce)||!S&&this.grid.hitTest(Y,ae,ge,ce,k)||_e?{box:[],offscreen:!1,occluded:K.occluded}:{box:[Y,ae,ge,ce],offscreen:this.isOffscreen(Y,ae,ge,ce),occluded:!1}}placeCollisionCircles(c,u,_,b,S,A,P,k,O,z,U,q,X,Q,K){let re=[],Y=this.transform.elevation,ae=c.getProjection(),ge=Y?Y.getAtTileOffsetFunc(K,this.transform.center.lat,this.transform.worldSize,ae):null,ce=new i.P(_.tileAnchorX,_.tileAnchorY),{x:_e,y:oe,z:ve}=ae.projectTilePoint(ce.x,ce.y,K.canonical);if(ge){let[tt,Fe,Ze]=ge(ce);_e+=tt,oe+=Fe,ve+=Ze}let Ae=ae.name==="globe",Re=this.projectAndGetPerspectiveRatio(P,_e,oe,ve,K,Ae||!!Y||this.transform.pitch>0,ae),{perspectiveRatio:Oe}=Re,Je=(U?A/Oe:A*Oe)/i.bc,Ue=Ma(_e,oe,ve,k),ot=Re.signedDistanceFromCamera>0?Of(Je,S,_.lineOffsetX*Je,_.lineOffsetY*Je,!1,Ue,ce,_,b,k,{},Y&&!U?ge:null,U&&!!Y,ae,K,U):null,nt=!1,Rt=!1,je=!0;if(ot&&!Re.occluded){let tt=.5*X*Oe+Q,Fe=new i.P(-100,-100),Ze=new i.P(this.screenRightBoundary,this.screenBottomBoundary),Dt=new th,{first:jt,last:Ut}=ot,ti=jt.path.length,mi=[];for(let Si=ti-1;Si>=1;Si--)mi.push(jt.path[Si]);for(let Si=1;Si<Ut.path.length;Si++)mi.push(Ut.path[Si]);let Ei=2.5*tt;O&&(mi=mi.map(([Si,gn,Zi],hn)=>(ge&&!Ae&&(Zi=ge(hn<ti-1?jt.tilePath[ti-1-hn]:Ut.tilePath[hn-ti+2])[2]),Ma(Si,gn,Zi,O))),mi.some(Si=>Si[3]<=0)&&(mi=[]));let xi=[];if(mi.length>0){let Si=1/0,gn=-1/0,Zi=1/0,hn=-1/0;for(let an of mi)Si=Math.min(Si,an[0]),Zi=Math.min(Zi,an[1]),gn=Math.max(gn,an[0]),hn=Math.max(hn,an[1]);gn>=Fe.x&&Si<=Ze.x&&hn>=Fe.y&&Zi<=Ze.y&&(xi=[mi.map(an=>new i.P(an[0],an[1]))],(Si<Fe.x||gn>Ze.x||Zi<Fe.y||hn>Ze.y)&&(xi=i.ba(xi,Fe.x,Fe.y,Ze.x,Ze.y)))}for(let Si of xi){Dt.reset(Si,.25*tt);let gn=0;gn=Dt.length<=.5*tt?1:Math.ceil(Dt.paddedLength/Ei)+1;for(let Zi=0;Zi<gn;Zi++){let hn=Zi/Math.max(gn-1,1),an=Dt.lerp(hn),Wn=an.x+Ea,Dr=an.y+Ea;re.push(Wn,Dr,tt,0);let An=Wn-tt,Kr=Dr-tt,Cn=Wn+tt,er=Dr+tt;if(je=je&&this.isOffscreen(An,Kr,Cn,er),Rt=Rt||this.isInsideGrid(An,Kr,Cn,er),!u&&this.grid.hitTestCircle(Wn,Dr,tt,q)&&(nt=!0,!z))return{circles:[],offscreen:!1,collisionDetected:nt,occluded:!1}}}}return{circles:!z&&nt||!Rt?[]:re,offscreen:je,collisionDetected:nt,occluded:Re.occluded}}queryRenderedSymbols(c){if(c.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let u=[],_=1/0,b=1/0,S=-1/0,A=-1/0;for(let z of c){let U=new i.P(z.x+Ea,z.y+Ea);_=Math.min(_,U.x),b=Math.min(b,U.y),S=Math.max(S,U.x),A=Math.max(A,U.y),u.push(U)}let P=this.grid.query(_,b,S,A).concat(this.ignoredGrid.query(_,b,S,A)),k={},O={};for(let z of P){let U=z.key;if(k[U.bucketInstanceId]===void 0&&(k[U.bucketInstanceId]={}),k[U.bucketInstanceId][U.featureIndex])continue;let q=[new i.P(z.x1,z.y1),new i.P(z.x2,z.y1),new i.P(z.x2,z.y2),new i.P(z.x1,z.y2)];i.bb(u,q)&&(k[U.bucketInstanceId][U.featureIndex]=!0,O[U.bucketInstanceId]===void 0&&(O[U.bucketInstanceId]=[]),O[U.bucketInstanceId].push(U.featureIndex))}return O}insertCollisionBox(c,u,_,b,S){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:b,collisionGroupID:S},c[0],c[1],c[2],c[3])}insertCollisionCircles(c,u,_,b,S){let A=u?this.ignoredGrid:this.grid,P={bucketInstanceId:_,featureIndex:b,collisionGroupID:S};for(let k=0;k<c.length;k+=4)A.insertCircle(P,c[k],c[k+1],c[k+2])}projectAndGetPerspectiveRatio(c,u,_,b,S,A,P){let k=[u,_,b,1],O=!1;b||this.transform.pitch>0?(i.a7.transformMat4(k,k,c),this.fogState&&S&&P.name!=="globe"&&(O=function(q,X,Q,K,re,Y){let ae=Y.calculateFogTileMatrix(re),ge=[X,Q,K];return i.N.transformMat4(ge,ge,ae),Vi(q,i.N.length(ge),Y.pitch,Y._fov)}(this.fogState,u,_,b,S.toUnwrapped(),this.transform)>.9)):Bf(k,k,c);let z=k[3];return{point:new i.P((k[0]/z+1)/2*this.transform.width+Ea,(-k[1]/z+1)/2*this.transform.height+Ea),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(P)/z*.5,1.5),signedDistanceFromCamera:z,occluded:A&&k[2]>z||O}}isOffscreen(c,u,_,b){return _<Ea||c>=this.screenRightBoundary||b<Ea||u>this.screenBottomBoundary}isInsideGrid(c,u,_,b){return _>=0&&c<this.gridRightBoundary&&b>=0&&u<this.gridBottomBoundary}getViewportMatrix(){let c=i.a6.identity([]);return i.a6.translate(c,c,[-100,-100,0]),c}}function dp(g,c,u){let _=c.createTileMatrix(g,g.worldSize,u.toUnwrapped());return i.a6.multiply(new Float32Array(16),g.projMatrix,_)}function Uf(g,c,u){if(c.projection.name===u.projection.name)return g.projMatrix;let _=u.clone();return _.setProjection(c.projection),dp(_,c.getProjection(),g)}function Rd(g,c,u){return c.name===u.projection.name?g.projMatrix:dp(u,c,g)}class Vf{constructor(c,u,_,b){this.opacity=c?Math.max(0,Math.min(1,c.opacity+(c.placed?u:-u))):b&&_?1:0,this.placed=_}isHidden(){return this.opacity===0&&!this.placed}}class wc{constructor(c,u,_,b,S,A=!1){this.text=new Vf(c?c.text:null,u,_,S),this.icon=new Vf(c?c.icon:null,u,b,S),this.clipped=A}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ja{constructor(c,u,_,b=!1){this.text=c,this.icon=u,this.skipFade=_,this.clipped=b}}class Gf{constructor(){this.invProjMatrix=i.a6.create(),this.viewportMatrix=i.a6.create(),this.circles=[]}}class c0{constructor(c,u,_,b,S){this.bucketInstanceId=c,this.featureIndex=u,this.sourceLayerIndex=_,this.bucketIndex=b,this.tileID=S}}class up{constructor(c){this.crossSourceCollisions=c,this.maxGroupID=0,this.collisionGroups={}}get(c){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[c]){let u=++this.maxGroupID;this.collisionGroups[c]={ID:u,predicate:_=>_.collisionGroupID===u}}return this.collisionGroups[c]}}function h0(g,c,u,_,b){let{horizontalAlign:S,verticalAlign:A}=i.bf(g),P=-(S-.5)*c,k=-(A-.5)*u,O=i.bd(g,_);return new i.P(P+O[0]*b,k+O[1]*b)}function Hf(g,c,u,_,b){let S=new i.P(g,c);return u&&S._rotate(_?b:-b),S}class Ey{constructor(c,u,_,b,S,A){this.transform=c.clone(),this.projection=c.projection.name,this.collisionIndex=new ii(this.transform,S),this.buildingIndex=A,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new up(_),this.collisionCircleArrays={},this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(c,u,_,b){let S=_.getBucket(u),A=_.latestFeatureIndex;if(!S||!A||u.fqid!==S.layerIds[0])return;let P=S.layers[0].layout,k=_.collisionBoxArray,O=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),z=_.tileSize/i.V,U=_.tileID.toUnwrapped();this.transform.setProjection(S.projection);let q=(X=_.tileID,Q=S.getProjection(),K=this.transform,Q.name===this.projection?K.calculateProjMatrix(X.toUnwrapped()):dp(K,Q,X));var X,Q,K;let re=P.get("text-pitch-alignment")==="map",Y=P.get("text-rotation-alignment")==="map";u.compileFilter();let ae=u.dynamicFilter(),ge=u.dynamicFilterNeedsFeature(),ce=this.transform.calculatePixelsToTileUnitsMatrix(_),_e=kf(q,_.tileID.canonical,re,Y,this.transform,S.getProjection(),ce),oe=null;if(re){let Re=Df(q,_.tileID.canonical,re,Y,this.transform,S.getProjection(),ce);oe=i.a6.multiply([],this.transform.labelPlaneMatrix,Re)}let ve=null;ae&&_.latestFeatureIndex&&(ve={unwrappedTileID:U,dynamicFilter:ae,dynamicFilterNeedsFeature:ge,featureIndex:_.latestFeatureIndex}),this.retainedQueryData[S.bucketInstanceId]=new c0(S.bucketInstanceId,A,S.sourceLayerIndex,S.index,_.tileID);let Ae={bucket:S,layout:P,posMatrix:q,textLabelPlaneMatrix:_e,labelToScreenMatrix:oe,clippingData:ve,scale:O,textPixelRatio:z,holdingForFade:_.holdingForFade(),collisionBoxArray:k,partiallyEvaluatedTextSize:i.b5(S.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:i.b5(S.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(S.sourceID)};if(b)for(let Re of S.sortKeyRanges){let{sortKey:Oe,symbolInstanceStart:Je,symbolInstanceEnd:Ue}=Re;c.push({sortKey:Oe,symbolInstanceStart:Je,symbolInstanceEnd:Ue,parameters:Ae})}else c.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:Ae})}attemptAnchorPlacement(c,u,_,b,S,A,P,k,O,z,U,q,X,Q,K,re,Y,ae){let{textOffset0:ge,textOffset1:ce,crossTileID:_e}=q,oe=[ge,ce],ve=h0(c,_,b,oe,S),Ae=this.collisionIndex.placeCollisionBox(Q,S,u,Hf(ve.x,ve.y,A,P,this.transform.angle),U,k,O,z.predicate);if(re){let Re=Q.getSymbolInstanceIconSize(ae,this.transform.zoom,q.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(Q,Re,re,Hf(ve.x,ve.y,A,P,this.transform.angle),U,k,O,z.predicate).box.length===0)return}if(Ae.box.length>0){let Re;return this.prevPlacement&&this.prevPlacement.variableOffsets[_e]&&this.prevPlacement.placements[_e]&&this.prevPlacement.placements[_e].text&&(Re=this.prevPlacement.variableOffsets[_e].anchor),this.variableOffsets[_e]={textOffset:oe,width:_,height:b,anchor:c,textScale:S,prevAnchor:Re},this.markUsedJustification(Q,c,q,K),Q.allowVerticalPlacement&&(this.markUsedOrientation(Q,K,q),this.placedOrientations[_e]=K),{shift:ve,placedGlyphBoxes:Ae}}}placeLayerBucketPart(c,u,_,b){let{bucket:S,layout:A,posMatrix:P,textLabelPlaneMatrix:k,labelToScreenMatrix:O,clippingData:z,textPixelRatio:U,holdingForFade:q,collisionBoxArray:X,partiallyEvaluatedTextSize:Q,partiallyEvaluatedIconSize:K,collisionGroup:re}=c.parameters,Y=A.get("text-optional"),ae=A.get("icon-optional"),ge=A.get("text-allow-overlap"),ce=A.get("icon-allow-overlap"),_e=A.get("text-rotation-alignment")==="map",oe=A.get("text-pitch-alignment")==="map",ve=A.get("symbol-z-order")==="viewport-y",Ae=A.get("symbol-z-elevate");this.transform.setProjection(S.projection);let Re=ge&&(ce||!S.hasIconData()||ae),Oe=ce&&(ge||!S.hasTextData()||Y);!S.collisionArrays&&X&&S.deserializeCollisionBoxes(X),_&&b&&S.updateCollisionDebugBuffers(this.transform.zoom,X);let Je=(Ue,ot,nt)=>{let{crossTileID:Rt,numVerticalGlyphVertices:je}=Ue;if(z){let Cn={zoom:this.transform.zoom,pitch:this.transform.pitch},er=null;if(z.dynamicFilterNeedsFeature){let In=this.retainedQueryData[S.bucketInstanceId];er=z.featureIndex.loadFeature({featureIndex:Ue.featureIndex,bucketIndex:In.bucketIndex,sourceLayerIndex:In.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,z.dynamicFilter)(Cn,er,this.retainedQueryData[S.bucketInstanceId].tileID.canonical,new i.P(Ue.tileAnchorX,Ue.tileAnchorY),this.transform.calculateDistanceTileData(z.unwrappedTileID)))return this.placements[Rt]=new ja(!1,!1,!1,!0),void u.add(Rt)}if(u.has(Rt))return;if(q)return void(this.placements[Rt]=new ja(!1,!1,!1));let tt=!1,Fe=!1,Ze=!0,Dt=!1,jt=!1,Ut=null,ti={box:null,offscreen:null,occluded:null},mi={box:null,offscreen:null,occluded:null},Ei=null,xi=null,Si=null,gn=0,Zi=0,hn=0;nt.textFeatureIndex?gn=nt.textFeatureIndex:Ue.useRuntimeCollisionCircles&&(gn=Ue.featureIndex),nt.verticalTextFeatureIndex&&(Zi=nt.verticalTextFeatureIndex);let an=Cn=>{Cn.tileID=this.retainedQueryData[S.bucketInstanceId].tileID;let er=this.transform.elevation;Cn.elevation=Ue.zOffset+(er?er.getAtTileOffset(Cn.tileID,Cn.tileAnchorX,Cn.tileAnchorY):0)},Wn=nt.textBox;if(Wn){an(Wn);let Cn=In=>{let Kn=i.b6.horizontal;if(S.allowVerticalPlacement&&!In&&this.prevPlacement){let Nr=this.prevPlacement.placedOrientations[Rt];Nr&&(this.placedOrientations[Rt]=Nr,Kn=Nr,this.markUsedOrientation(S,Kn,Ue))}return Kn},er=(In,Kn)=>{if(S.allowVerticalPlacement&&je>0&&nt.verticalTextBox){for(let Nr of S.writingModes)if(Nr===i.b6.vertical?(ti=Kn(),mi=ti):ti=In(),ti&&ti.box&&ti.box.length)break}else ti=In()};if(A.get("text-variable-anchor")){let In=A.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Rt]){let ar=this.prevPlacement.variableOffsets[Rt];In.indexOf(ar.anchor)>0&&(In=In.filter(Vs=>Vs!==ar.anchor),In.unshift(ar.anchor))}let Kn=(ar,Vs,oo)=>{let qo=S.getSymbolInstanceTextSize(Q,Ue,this.transform.zoom,ot),vl=(ar.x2-ar.x1)*qo+2*ar.padding,Xo=(ar.y2-ar.y1)*qo+2*ar.padding,Gs=Ue.hasIconTextFit&&!ce?Vs:null;Gs&&an(Gs);let Rs={box:[],offscreen:!1,occluded:!1},Mo=ge?2*In.length:In.length;for(let Fo=0;Fo<Mo;++Fo){let Zo=this.attemptAnchorPlacement(In[Fo%In.length],ar,vl,Xo,qo,_e,oe,U,P,re,Fo>=In.length,Ue,ot,S,oo,Gs,Q,K);if(Zo&&(Rs=Zo.placedGlyphBoxes,Rs&&Rs.box&&Rs.box.length)){tt=!0,Ut=Zo.shift;break}}return Rs};er(()=>Kn(Wn,nt.iconBox,i.b6.horizontal),()=>{let ar=nt.verticalTextBox;return ar&&an(ar),S.allowVerticalPlacement&&!(ti&&ti.box&&ti.box.length)&&je>0&&ar?Kn(ar,nt.verticalIconBox,i.b6.vertical):{box:null,offscreen:null,occluded:null}}),ti&&(tt=ti.box,Ze=ti.offscreen,Dt=ti.occluded);let Nr=Cn(!(!ti||!ti.box));if(!tt&&this.prevPlacement){let ar=this.prevPlacement.variableOffsets[Rt];ar&&(this.variableOffsets[Rt]=ar,this.markUsedJustification(S,ar.anchor,Ue,Nr))}}else{let In=(Kn,Nr)=>{let ar=S.getSymbolInstanceTextSize(Q,Ue,this.transform.zoom,ot),Vs=this.collisionIndex.placeCollisionBox(S,ar,Kn,new i.P(0,0),ge,U,P,re.predicate);return Vs&&Vs.box&&Vs.box.length&&(this.markUsedOrientation(S,Nr,Ue),this.placedOrientations[Rt]=Nr),Vs};er(()=>In(Wn,i.b6.horizontal),()=>{let Kn=nt.verticalTextBox;return S.allowVerticalPlacement&&je>0&&Kn?(an(Kn),In(Kn,i.b6.vertical)):{box:null,offscreen:null,occluded:null}}),Cn(!!(ti&&ti.box&&ti.box.length))}}if(Ei=ti,tt=Ei&&Ei.box&&Ei.box.length>0,Ze=Ei&&Ei.offscreen,Dt=Ei&&Ei.occluded,Ue.useRuntimeCollisionCircles){let Cn=S.text.placedSymbolArray.get(Ue.centerJustifiedTextSymbolIndex>=0?Ue.centerJustifiedTextSymbolIndex:Ue.verticalPlacedTextSymbolIndex),er=i.b7(S.textSizeData,Q,Cn),In=A.get("text-padding");xi=this.collisionIndex.placeCollisionCircles(S,ge,Cn,S.lineVertexArray,S.glyphOffsetArray,er,P,k,O,_,oe,re.predicate,Ue.collisionCircleDiameter*er/i.bc,In,this.retainedQueryData[S.bucketInstanceId].tileID),tt=ge||xi.circles.length>0&&!xi.collisionDetected,Ze=Ze&&xi.offscreen,Dt=xi.occluded}if(nt.iconFeatureIndex&&(hn=nt.iconFeatureIndex),nt.iconBox){let Cn=er=>{an(er);let In=Ue.hasIconTextFit&&Ut?Hf(Ut.x,Ut.y,_e,oe,this.transform.angle):new i.P(0,0),Kn=S.getSymbolInstanceIconSize(K,this.transform.zoom,Ue.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(S,Kn,er,In,ce,U,P,re.predicate)};mi&&mi.box&&mi.box.length&&nt.verticalIconBox?(Si=Cn(nt.verticalIconBox),Fe=Si.box.length>0):(Si=Cn(nt.iconBox),Fe=Si.box.length>0),Ze=Ze&&Si.offscreen,jt=Si.occluded}let Dr=Y||Ue.numHorizontalGlyphVertices===0&&je===0,An=ae||Ue.numIconVertices===0;if(Dr||An?An?Dr||(Fe=Fe&&tt):tt=Fe&&tt:Fe=tt=Fe&&tt,tt&&Ei&&Ei.box&&this.collisionIndex.insertCollisionBox(Ei.box,A.get("text-ignore-placement"),S.bucketInstanceId,mi&&mi.box&&Zi?Zi:gn,re.ID),Fe&&Si&&this.collisionIndex.insertCollisionBox(Si.box,A.get("icon-ignore-placement"),S.bucketInstanceId,hn,re.ID),xi&&(tt&&this.collisionIndex.insertCollisionCircles(xi.circles,A.get("text-ignore-placement"),S.bucketInstanceId,gn,re.ID),_)){let Cn=S.bucketInstanceId,er=this.collisionCircleArrays[Cn];er===void 0&&(er=this.collisionCircleArrays[Cn]=new Gf);for(let In=0;In<xi.circles.length;In+=4)er.circles.push(xi.circles[In+0]),er.circles.push(xi.circles[In+1]),er.circles.push(xi.circles[In+2]),er.circles.push(xi.collisionDetected?1:0)}let Kr=S.projection.name!=="globe";Re=Re&&(Kr||!Dt),Oe=Oe&&(Kr||!jt),this.placements[Rt]=new ja(tt||Re,Fe||Oe,Ze||S.justReloaded),u.add(Rt)};if(Ae&&this.buildingIndex&&(this.buildingIndex.updateZOffset(S,this.retainedQueryData[S.bucketInstanceId].tileID),S.updateZOffset()),ve){let Ue=S.getSortedSymbolIndexes(this.transform.angle);for(let ot=Ue.length-1;ot>=0;--ot){let nt=Ue[ot];Je(S.symbolInstances.get(nt),nt,S.collisionArrays[nt])}S.hasAnyZOffset&&i.w(`${S.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(S.hasAnyZOffset){let Ue=S.getSortedIndexesByZOffset();for(let ot=0;ot<Ue.length;++ot){let nt=Ue[ot];Je(S.symbolInstances.get(nt),nt,S.collisionArrays[nt])}}else for(let Ue=c.symbolInstanceStart;Ue<c.symbolInstanceEnd;Ue++)Je(S.symbolInstances.get(Ue),Ue,S.collisionArrays[Ue]);if(_&&S.bucketInstanceId in this.collisionCircleArrays){let Ue=this.collisionCircleArrays[S.bucketInstanceId];i.a6.invert(Ue.invProjMatrix,P),Ue.viewportMatrix=this.collisionIndex.getViewportMatrix()}S.justReloaded=!1}markUsedJustification(c,u,_,b){let{leftJustifiedTextSymbolIndex:S,centerJustifiedTextSymbolIndex:A,rightJustifiedTextSymbolIndex:P,verticalPlacedTextSymbolIndex:k,crossTileID:O}=_,z=i.be(u),U=b===i.b6.vertical?k:z==="left"?S:z==="center"?A:z==="right"?P:-1;S>=0&&(c.text.placedSymbolArray.get(S).crossTileID=U>=0&&S!==U?0:O),A>=0&&(c.text.placedSymbolArray.get(A).crossTileID=U>=0&&A!==U?0:O),P>=0&&(c.text.placedSymbolArray.get(P).crossTileID=U>=0&&P!==U?0:O),k>=0&&(c.text.placedSymbolArray.get(k).crossTileID=U>=0&&k!==U?0:O)}markUsedOrientation(c,u,_){let b=u===i.b6.horizontal||u===i.b6.horizontalOnly?u:0,S=u===i.b6.vertical?u:0,{leftJustifiedTextSymbolIndex:A,centerJustifiedTextSymbolIndex:P,rightJustifiedTextSymbolIndex:k,verticalPlacedTextSymbolIndex:O}=_,z=c.text.placedSymbolArray;A>=0&&(z.get(A).placedOrientation=b),P>=0&&(z.get(P).placedOrientation=b),k>=0&&(z.get(k).placedOrientation=b),O>=0&&(z.get(O).placedOrientation=S)}commit(c){this.commitTime=c,this.zoomAtLastRecencyCheck=this.transform.zoom;let u=this.prevPlacement,_=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;let b=u?u.symbolFadeChange(c):1,S=u?u.opacities:{},A=u?u.variableOffsets:{},P=u?u.placedOrientations:{};for(let k in this.placements){let O=this.placements[k],z=S[k];z?(this.opacities[k]=new wc(z,b,O.text,O.icon,null,O.clipped),_=_||O.text!==z.text.placed||O.icon!==z.icon.placed):(this.opacities[k]=new wc(null,b,O.text,O.icon,O.skipFade,O.clipped),_=_||O.text||O.icon)}for(let k in S){let O=S[k];if(!this.opacities[k]){let z=new wc(O,b,!1,!1);z.isHidden()||(this.opacities[k]=z,_=_||O.text.placed||O.icon.placed)}}for(let k in A)this.variableOffsets[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.variableOffsets[k]=A[k]);for(let k in P)this.placedOrientations[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.placedOrientations[k]=P[k]);_?this.lastPlacementChangeTime=c:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:c)}updateLayerOpacities(c,u){let _=new Set;for(let b of u){let S=b.getBucket(c);S&&b.latestFeatureIndex&&c.fqid===S.layerIds[0]&&(this.updateBucketOpacities(S,_,b.collisionBoxArray),S.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(S,b.tileID),S.updateZOffset()))}}updateBucketOpacities(c,u,_){c.hasTextData()&&c.text.opacityVertexArray.clear(),c.hasIconData()&&c.icon.opacityVertexArray.clear(),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexArray.clear(),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexArray.clear();let b=c.layers[0].layout,S=!!c.layers[0].dynamicFilter(),A=new wc(null,0,!1,!1,!0),P=b.get("text-allow-overlap"),k=b.get("icon-allow-overlap"),O=b.get("text-variable-anchor"),z=b.get("text-rotation-alignment")==="map",U=b.get("text-pitch-alignment")==="map",q=new wc(null,0,P&&(k||!c.hasIconData()||b.get("icon-optional")),k&&(P||!c.hasTextData()||b.get("text-optional")),!0);!c.collisionArrays&&_&&(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData())&&c.deserializeCollisionBoxes(_);let X=(K,re,Y)=>{for(let ae=0;ae<re/4;ae++)K.opacityVertexArray.emplaceBack(Y)},Q=0;for(let K=0;K<c.symbolInstances.length;K++){let re=c.symbolInstances.get(K),{numHorizontalGlyphVertices:Y,numVerticalGlyphVertices:ae,crossTileID:ge,numIconVertices:ce}=re,_e=u.has(ge),oe=this.opacities[ge];_e?oe=A:oe||(oe=q,this.opacities[ge]=oe),u.add(ge);let ve=Y>0||ae>0,Ae=ce>0,Re=this.placedOrientations[ge],Oe=Re===i.b6.vertical,Je=Re===i.b6.horizontal||Re===i.b6.horizontalOnly;if(!ve&&!Ae||oe.isHidden()||Q++,ve){let Ue=I_(oe.text);X(c.text,Y,Oe?kd:Ue),X(c.text,ae,Je?kd:Ue);let ot=oe.text.isHidden(),{leftJustifiedTextSymbolIndex:nt,centerJustifiedTextSymbolIndex:Rt,rightJustifiedTextSymbolIndex:je,verticalPlacedTextSymbolIndex:tt}=re,Fe=c.text.placedSymbolArray,Ze=ot||Oe?1:0;nt>=0&&(Fe.get(nt).hidden=Ze),Rt>=0&&(Fe.get(Rt).hidden=Ze),je>=0&&(Fe.get(je).hidden=Ze),tt>=0&&(Fe.get(tt).hidden=ot||Je?1:0);let Dt=this.variableOffsets[ge];Dt&&this.markUsedJustification(c,Dt.anchor,re,Re);let jt=this.placedOrientations[ge];jt&&(this.markUsedJustification(c,"left",re,jt),this.markUsedOrientation(c,jt,re))}if(Ae){let Ue=I_(oe.icon),{placedIconSymbolIndex:ot,verticalPlacedIconSymbolIndex:nt}=re,Rt=c.icon.placedSymbolArray,je=oe.icon.isHidden()?1:0;ot>=0&&(X(c.icon,ce,Oe?kd:Ue),Rt.get(ot).hidden=je),nt>=0&&(X(c.icon,re.numVerticalIconVertices,Je?kd:Ue),Rt.get(nt).hidden=je)}if(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData()){let Ue=c.collisionArrays[K];if(Ue){let ot=new i.P(0,0),nt=!0;if(Ue.textBox||Ue.verticalTextBox){if(O){let je=this.variableOffsets[ge];je?(ot=h0(je.anchor,je.width,je.height,je.textOffset,je.textScale),z&&ot._rotate(U?this.transform.angle:-this.transform.angle)):nt=!1}S&&(nt=!oe.clipped),Ue.textBox&&nh(c.textCollisionBox.collisionVertexArray,oe.text.placed,!nt||Oe,ot.x,ot.y),Ue.verticalTextBox&&nh(c.textCollisionBox.collisionVertexArray,oe.text.placed,!nt||Je,ot.x,ot.y)}let Rt=nt&&!!(!Je&&Ue.verticalIconBox);Ue.iconBox&&nh(c.iconCollisionBox.collisionVertexArray,oe.icon.placed,Rt,re.hasIconTextFit?ot.x:0,re.hasIconTextFit?ot.y:0),Ue.verticalIconBox&&nh(c.iconCollisionBox.collisionVertexArray,oe.icon.placed,!Rt,re.hasIconTextFit?ot.x:0,re.hasIconTextFit?ot.y:0)}}}if(c.fullyClipped=Q===0,c.sortFeatures(this.transform.angle),this.retainedQueryData[c.bucketInstanceId]&&(this.retainedQueryData[c.bucketInstanceId].featureSortOrder=c.featureSortOrder),c.hasTextData()&&c.text.opacityVertexBuffer&&c.text.opacityVertexBuffer.updateData(c.text.opacityVertexArray),c.hasIconData()&&c.icon.opacityVertexBuffer&&c.icon.opacityVertexBuffer.updateData(c.icon.opacityVertexArray),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexBuffer&&c.iconCollisionBox.collisionVertexBuffer.updateData(c.iconCollisionBox.collisionVertexArray),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexBuffer&&c.textCollisionBox.collisionVertexBuffer.updateData(c.textCollisionBox.collisionVertexArray),c.bucketInstanceId in this.collisionCircleArrays){let K=this.collisionCircleArrays[c.bucketInstanceId];c.placementInvProjMatrix=K.invProjMatrix,c.placementViewportMatrix=K.viewportMatrix,c.collisionCircleArray=K.circles,delete this.collisionCircleArrays[c.bucketInstanceId]}}symbolFadeChange(c){return this.fadeDuration===0?1:(c-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(c){return Math.max(0,(this.transform.zoom-c)/1.5)}hasTransitions(c){return this.stale||c-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(c,u){let _=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*_>c}setStale(){this.stale=!0}}function nh(g,c,u,_,b){g.emplaceBack(c?1:0,u?1:0,_||0,b||0),g.emplaceBack(c?1:0,u?1:0,_||0,b||0),g.emplaceBack(c?1:0,u?1:0,_||0,b||0),g.emplaceBack(c?1:0,u?1:0,_||0,b||0)}let Ay=Math.pow(2,25),A_=Math.pow(2,24),C_=Math.pow(2,17),jf=Math.pow(2,16),Cy=Math.pow(2,9),Iy=Math.pow(2,8),Py=Math.pow(2,1);function I_(g){if(g.opacity===0&&!g.placed)return 0;if(g.opacity===1&&g.placed)return 4294967295;let c=g.placed?1:0,u=Math.floor(127*g.opacity);return u*Ay+c*A_+u*C_+c*jf+u*Cy+c*Iy+u*Py+c}let kd=0;class Ry{constructor(c){this._sortAcrossTiles=c.layout.get("symbol-z-order")!=="viewport-y"&&c.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(c,u,_,b,S){let A=this._bucketParts;for(;this._currentTileIndex<c.length;)if(u.getBucketParts(A,b,c[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,S())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,A.sort((P,k)=>P.sortKey-k.sortKey));this._currentPartIndex<A.length;){let P=A[this._currentPartIndex];if(u.placeLayerBucketPart(P,this._seenCrossTileIDs,_,P.symbolInstanceStart===0),this._currentPartIndex++,S())return!0}return!1}}class pp{constructor(c,u,_,b,S,A,P,k,O){this.placement=new Ey(c,S,A,P,k,O),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(c,u,_,b){let S=i.f.now(),A=()=>{let P=i.f.now()-S;return!this._forceFullPlacement&&P>2};for(;this._currentPlacementIndex>=0;){let P=u[c[this._currentPlacementIndex]],k=this.placement.collisionIndex.transform.zoom;if(P.type==="symbol"&&(!P.minzoom||P.minzoom<=k)&&(!P.maxzoom||P.maxzoom>k)){let O=P,z=O.layout.get("symbol-z-elevate"),U=this._inProgressLayer=this._inProgressLayer||new Ry(O),q=i.ag(P.source,P.scope);if(U.continuePlacement(z?b[q]:_[q],this.placement,this._showCollisionBoxes,P,A))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(c){return this.placement.commit(c),this.placement}}let Wf=512/i.V/2;class P_{constructor(c,u,_){this.tileID=c,this.bucketInstanceId=_,this.index=new i.bg(u.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];let b=c.canonical.x*i.V,S=c.canonical.y*i.V;for(let A=0;A<u.length;A++){let{key:P,crossTileID:k,tileAnchorX:O,tileAnchorY:z}=u.get(A),U=Math.floor((b+O)*Wf),q=Math.floor((S+z)*Wf);this.index.add(U,q),this.keys.push(P),this.crossTileIDs.push(k)}this.index.finish()}findMatches(c,u,_){let b=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z),S=Wf/Math.pow(2,u.canonical.z-this.tileID.canonical.z),A=u.canonical.x*i.V,P=u.canonical.y*i.V;for(let k=0;k<c.length;k++){let O=c.get(k);if(O.crossTileID)continue;let{key:z,tileAnchorX:U,tileAnchorY:q}=O,X=Math.floor((A+U)*S),Q=Math.floor((P+q)*S),K=this.index.range(X-b,Q-b,X+b,Q+b);for(let re of K){let Y=this.crossTileIDs[re];if(this.keys[re]===z&&!_.has(Y)){_.add(Y),O.crossTileID=Y;break}}}}}class qf{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class fp{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(c){let u=Math.round((c-this.lng)/360);if(u!==0)for(let _ in this.indexes){let b=this.indexes[_],S={};for(let A in b){let P=b[A];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+u),S[P.tileID.key]=P}this.indexes[_]=S}this.lng=c}addBucket(c,u,_){if(this.indexes[c.overscaledZ]&&this.indexes[c.overscaledZ][c.key]){if(this.indexes[c.overscaledZ][c.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(c.overscaledZ,this.indexes[c.overscaledZ][c.key])}for(let S=0;S<u.symbolInstances.length;S++)u.symbolInstances.get(S).crossTileID=0;this.usedCrossTileIDs[c.overscaledZ]||(this.usedCrossTileIDs[c.overscaledZ]=new Set);let b=this.usedCrossTileIDs[c.overscaledZ];for(let S in this.indexes){let A=this.indexes[S];if(Number(S)>c.overscaledZ)for(let P in A){let k=A[P];k.tileID.isChildOf(c)&&k.findMatches(u.symbolInstances,c,b)}else{let P=A[c.scaledTo(Number(S)).key];P&&P.findMatches(u.symbolInstances,c,b)}}for(let S=0;S<u.symbolInstances.length;S++){let A=u.symbolInstances.get(S);A.crossTileID||(A.crossTileID=_.generate(),b.add(A.crossTileID))}return this.indexes[c.overscaledZ]===void 0&&(this.indexes[c.overscaledZ]={}),this.indexes[c.overscaledZ][c.key]=new P_(c,u.symbolInstances,u.bucketInstanceId),!0}removeBucketCrossTileIDs(c,u){for(let _ of u.crossTileIDs)this.usedCrossTileIDs[c].delete(_)}removeStaleBuckets(c){let u=!1;for(let _ in this.indexes){let b=this.indexes[_];for(let S in b)c[b[S].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,b[S]),delete b[S],u=!0)}return u}}class Xf{constructor(){this.layerIndexes={},this.crossTileIDs=new qf,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(c,u,_,b){let S=this.layerIndexes[c.fqid];S===void 0&&(S=this.layerIndexes[c.fqid]=new fp);let A=!1,P={};b.name!=="globe"&&S.handleWrapJump(_);for(let k of u){let O=k.getBucket(c);O&&c.fqid===O.layerIds[0]&&(O.bucketInstanceId||(O.bucketInstanceId=++this.maxBucketInstanceId),S.addBucket(k.tileID,O,this.crossTileIDs)&&(A=!0),P[O.bucketInstanceId]=!0)}return S.removeStaleBuckets(P)&&(A=!0),A}pruneUnusedLayers(c){let u={};c.forEach(_=>{u[_]=!0});for(let _ in this.layerIndexes)u[_]||delete this.layerIndexes[_]}}class d0{constructor(c=0,u=0,_=0,b=0){if(isNaN(c)||c<0||isNaN(u)||u<0||isNaN(_)||_<0||isNaN(b)||b<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=c,this.bottom=u,this.left=_,this.right=b}interpolate(c,u,_){return u.top!=null&&c.top!=null&&(this.top=i.U(c.top,u.top,_)),u.bottom!=null&&c.bottom!=null&&(this.bottom=i.U(c.bottom,u.bottom,_)),u.left!=null&&c.left!=null&&(this.left=i.U(c.left,u.left,_)),u.right!=null&&c.right!=null&&(this.right=i.U(c.right,u.right,_)),this}getCenter(c,u){let _=i.aa((this.left+c-this.right)/2,0,c),b=i.aa((this.top+u-this.bottom)/2,0,u);return new i.P(_,b)}equals(c){return this.top===c.top&&this.bottom===c.bottom&&this.left===c.left&&this.right===c.right}clone(){return new d0(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function mp(g,c){let u=i.bk(g,3);i.a6.fromQuat(g,c),i.bm(g,3,u)}function Dd(g,c){let u=i.bi.identity([]);return i.bi.rotateZ(u,u,-c),i.bi.rotateX(u,u,-g),u}function Zf(g,c){let u=[g[0],g[1],0],_=[c[0],c[1],0];if(i.N.length(u)>=1e-15){let A=i.N.normalize([],u);i.N.scale(_,A,i.N.dot(_,A)),c[0]=_[0],c[1]=_[1]}let b=i.N.cross([],c,g);if(i.N.len(b)<1e-15)return null;let S=Math.atan2(-b[1],b[0]);return Dd(Math.atan2(Math.sqrt(g[0]*g[0]+g[1]*g[1]),-g[2]),S)}class Ld{constructor(c,u){this.position=c,this.orientation=u}get position(){return this._position}set position(c){if(c){let u=c instanceof i.L?c:new i.L(c[0],c[1],c[2]);this._renderWorldCopies&&(u.x=i.bh(u.x,0,1)),this._position=u}else this._position=null}lookAtPoint(c,u){if(this.orientation=null,!this.position)return;let _=this.position,b=this._elevation?this._elevation.getAtPointOrZero(i.L.fromLngLat(c)):0,S=i.L.fromLngLat(c,b),A=[S.x-_.x,S.y-_.y,S.z-_.z];u||(u=[0,0,1]),u[2]=Math.abs(u[2]),this.orientation=Zf(A,u)}setPitchBearing(c,u){this.orientation=Dd(i.bj(c),i.bj(-u))}}class rh{constructor(c,u){this._transform=i.a6.identity([]),this.orientation=u,this.position=c}get mercatorPosition(){let c=this.position;return new i.L(c[0],c[1],c[2])}get position(){let c=i.bk(this._transform,3);return[c[0],c[1],c[2]]}set position(c){var u;c&&i.bm(this._transform,3,[(u=c)[0],u[1],u[2],1])}get orientation(){return this._orientation}set orientation(c){this._orientation=c||i.bi.identity([]),c&&mp(this._transform,this._orientation)}getPitchBearing(){let c=this.forward(),u=this.right();return{bearing:Math.atan2(-u[1],u[0]),pitch:Math.atan2(Math.sqrt(c[0]*c[0]+c[1]*c[1]),-c[2])}}setPitchBearing(c,u){this._orientation=Dd(c,u),mp(this._transform,this._orientation)}forward(){let c=i.bk(this._transform,2);return[-c[0],-c[1],-c[2]]}up(){let c=i.bk(this._transform,1);return[-c[0],-c[1],-c[2]]}right(){let c=i.bk(this._transform,0);return[c[0],c[1],c[2]]}getCameraToWorld(c,u){let _=new Float64Array(16);return i.a6.invert(_,this.getWorldToCamera(c,u)),_}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(c,u,_){let b=this.position;i.N.scale(b,b,-c);let S=new Float64Array(16);return i.a6.fromScaling(S,[_,_,_]),i.a6.translate(S,S,b),S[10]*=u,S}getWorldToCamera(c,u){let _=new Float64Array(16),b=new Float64Array(4),S=this.position;return i.bi.conjugate(b,this._orientation),i.N.scale(S,S,-c),i.a6.fromQuat(_,b),i.a6.translate(_,_,S),_[1]*=-1,_[5]*=-1,_[9]*=-1,_[13]*=-1,_[8]*=u,_[9]*=u,_[10]*=u,_[11]*=u,_}getCameraToClipPerspective(c,u,_,b){let S=new Float64Array(16);return i.a6.perspective(S,c,u,_,b),S}getCameraToClipOrthographic(c,u,_,b,S,A){let P=new Float64Array(16);return i.a6.ortho(P,c,u,_,b,S,A),P}getDistanceToElevation(c,u=!1){let _=c===0?0:i.bl(c,u?i.au(this.position[1]):this.position[1]),b=this.forward();return(_-this.position[2])/b[2]}clone(){return new rh([...this.position],[...this.orientation])}}let sh=(g,c,u)=>(1-u)*g+u*c,Fd=g=>g*g*g*g*g;class Od{constructor(c,u,_,b,S,A,P){this.tileSize=512,this._renderWorldCopies=S===void 0||S,this._minZoom=c||0,this._maxZoom=u||22,this._minPitch=_??0,this._maxPitch=b??60,this.setProjection(A),this.setMaxBounds(P),this.width=0,this.height=0,this._center=new i.bn(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new d0,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new rh,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){let c=new Od(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return c._elevation=this._elevation,c._centerAltitude=this._centerAltitude,c._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,c.tileSize=this.tileSize,c.mercatorFromTransition=this.mercatorFromTransition,c.width=this.width,c.height=this.height,c.cameraElevationReference=this.cameraElevationReference,c._center=this._center,c._setZoom(this.zoom),c._seaLevelZoom=this._seaLevelZoom,c.angle=this.angle,c._fov=this._fov,c._pitch=this._pitch,c._nearZ=this._nearZ,c._farZ=this._farZ,c._averageElevation=this._averageElevation,c._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,c._unmodified=this._unmodified,c._edgeInsets=this._edgeInsets.clone(),c._camera=this._camera.clone(),c._calcMatrices(),c.freezeTileCoverage=this.freezeTileCoverage,c.frustumCorners=this.frustumCorners,c}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(c){this._elevation!==c&&(this._elevation=c,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(c,u=!1){let _=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||_)&&this._updateCameraOnTerrain(),(c||_)&&this._constrainCamera(u),this._calcMatrices()}getProjection(){return i.ac(this.projection,["name","center","parallels"])}setProjection(c){this.projectionOptions=c||{name:"mercator"};let u=this.projection?this.getProjection():void 0;this.projection=i.bo(this.projectionOptions);let _=!f(u,this.getProjection());return _&&this._calcMatrices(),this.mercatorFromTransition=!1,_}setOrthographicProjectionAtLowPitch(c){return this._orthographicProjectionAtLowPitch!==c&&(this._orthographicProjectionAtLowPitch=c,this._calcMatrices(),!0)}setMercatorFromTransition(){let c=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=i.bo({name:"mercator"});let u=c!==this.projection.name;return u&&this._calcMatrices(),u}get minZoom(){return this._minZoom}set minZoom(c){this._minZoom!==c&&(this._minZoom=c,this.zoom=Math.max(this.zoom,c))}get maxZoom(){return this._maxZoom}set maxZoom(c){this._maxZoom!==c&&(this._maxZoom=c,this.zoom=Math.min(this.zoom,c))}get minPitch(){return this._minPitch}set minPitch(c){this._minPitch!==c&&(this._minPitch=c,this.pitch=Math.max(this.pitch,c))}get maxPitch(){return this._maxPitch}set maxPitch(c){this._maxPitch!==c&&(this._maxPitch=c,this.pitch=Math.min(this.pitch,c))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(c){c===void 0?c=!0:c===null&&(c=!1),this._renderWorldCopies=c}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){let c=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(c))}get cameraWorldSize(){let c=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(c))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return i.bl(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new i.P(this.width,this.height)}get bearing(){return i.bh(this.rotation,-180,180)}set bearing(c){this.rotation=c}get rotation(){return-this.angle/Math.PI*180}set rotation(c){let u=-c*Math.PI/180;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=i.b4.create(),i.b4.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(c){let u=i.aa(c,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){let c=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/c)}set fov(c){c=Math.max(.01,Math.min(60,c)),this._fov!==c&&(this._unmodified=!1,this._fov=i.bj(c),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(c){this._averageElevation=c,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(c){let u=Math.min(Math.max(c,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._setZoom(u),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(c){this._zoom=c,this.scale=this.zoomScale(c),this.tileZoom=Math.floor(c),this.zoomFraction=c-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(c){this._tileCoverLift!==c&&(this._tileCoverLift=c)}_updateCameraOnTerrain(){let c=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,u=this.elevation&&c===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||c===Number.NEGATIVE_INFINITY&&(!u||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);let _=this._elevation;u||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&_.exaggeration()&&this._centerAltitudeValidForExaggeration!==_.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*_.exaggeration(),this._centerAltitudeValidForExaggeration=_.exaggeration()):(this._centerAltitude=c||0,this._centerAltitudeValidForExaggeration=_.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;let c=this._elevation,u=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],_=this.horizonLineFromTop(),b=0,S=0;for(let A=0;A<u.length;A++){let P=new i.P(u[A][0]*this.width,_+u[A][1]*(this.height-_)),k=c.pointCoordinate(P);if(!k)continue;let O=1/Math.hypot(k[0]-this._camera.position[0],k[1]-this._camera.position[1]);b+=k[3]*O,S+=O}return S===0?NaN:b/S}get center(){return this._center}set center(c){c.lat===this._center.lat&&c.lng===this._center.lng||(this._unmodified=!1,this._center=c,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;let c=this._seaLevelZoom,u=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),_=this.pixelsPerMeter/this.worldSize*u,b=this._mercatorZfromZoom(c),S=this._mercatorZfromZoom(this._maxZoom),A=Math.max(b-_,S);this._setZoom(this._zoomFromMercatorZ(A))}get padding(){return this._edgeInsets.toJSON()}set padding(c){this._edgeInsets.equals(c)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,c,1),this._calcMatrices())}computeZoomRelativeTo(c){let u=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,c.toAltitude())),_;_=c.z<this._camera.position[2]?[u.x,u.y,u.z]:[c.x,c.y,c.z];let b=i.N.length(i.N.sub([],this._camera.position,_));return i.aa(this._zoomFromMercatorZ(b),this._minZoom,this._maxZoom)}setFreeCameraOptions(c){if(!this.height||!c.position&&!c.orientation)return;this._updateCameraState();let u=!1;if(c.orientation&&!i.bi.exactEquals(c.orientation,this._camera.orientation)&&(u=this._setCameraOrientation(c.orientation)),c.position){let _=[c.position.x,c.position.y,c.position.z];i.N.exactEquals(_,this._camera.position)||(this._setCameraPosition(_),u=!0)}u&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();let c=this._camera.position,u=new Ld;return u.position=new i.L(c[0],c[1],c[2]),u.orientation=this._camera.orientation,u._elevation=this.elevation,u._renderWorldCopies=this.renderWorldCopies,u}_setCameraOrientation(c){if(!i.bi.length(c))return!1;i.bi.normalize(c,c);let u=i.N.transformQuat([],[0,0,-1],c),_=i.N.transformQuat([],[0,-1,0],c);if(_[2]<0)return!1;let b=Zf(u,_);return!!b&&(this._camera.orientation=b,!0)}_setCameraPosition(c){let u=this.zoomScale(this.minZoom)*this.tileSize,_=this.zoomScale(this.maxZoom)*this.tileSize,b=this.cameraToCenterDistance;c[2]=i.aa(c[2],b/_,b/u),this._camera.position=c}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(c){return this._edgeInsets.equals(c)}interpolatePadding(c,u,_){this._unmodified=!1,this._edgeInsets.interpolate(c,u,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(c){let u=(c.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/c.tileSize));return Math.max(0,u)}getVisibleUnwrappedCoordinates(c){let u=[new i.bp(0,c)];if(this.renderWorldCopies){let _=this.pointCoordinate(new i.P(0,0)),b=this.pointCoordinate(new i.P(this.width,0)),S=this.pointCoordinate(new i.P(this.width,this.height)),A=this.pointCoordinate(new i.P(0,this.height)),P=Math.floor(Math.min(_.x,b.x,S.x,A.x)),k=Math.floor(Math.max(_.x,b.x,S.x,A.x)),O=1;for(let z=P-O;z<=k+O;z++)z!==0&&u.push(new i.bp(z,c))}return u}isLODDisabled(c){return(!c||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(c,u,_){let b=[];if(u[0]===0&&u[1]===0)return b;for(let A of c){let P=A.canonical,k=A.overscaledZ,O=A.wrap,z=1<<P.z,U=P.x+1<z,q=P.x>0,X=P.y+1<z,Q=P.y>0,K=A.wrap-(q?0:1),re=A.wrap+(U?0:1),Y=q?P.x-1:z-1,ae=U?P.x+1:0;u[0]<0?(b.push(new i.am(k,re,P.z,ae,P.y)),u[1]<0&&X&&(b.push(new i.am(k,O,P.z,P.x,P.y+1)),b.push(new i.am(k,re,P.z,ae,P.y+1))),u[1]>0&&Q&&(b.push(new i.am(k,O,P.z,P.x,P.y-1)),b.push(new i.am(k,re,P.z,ae,P.y-1)))):u[0]>0?(b.push(new i.am(k,K,P.z,Y,P.y)),u[1]<0&&X&&(b.push(new i.am(k,O,P.z,P.x,P.y+1)),b.push(new i.am(k,K,P.z,Y,P.y+1))),u[1]>0&&Q&&(b.push(new i.am(k,O,P.z,P.x,P.y-1)),b.push(new i.am(k,K,P.z,Y,P.y-1)))):u[1]<0&&X?b.push(new i.am(k,O,P.z,P.x,P.y+1)):Q&&b.push(new i.am(k,O,P.z,P.x,P.y-1))}if(b.length>1){b.sort((k,O)=>k.overscaledZ-O.overscaledZ||k.wrap-O.wrap||k.canonical.z-O.canonical.z||k.canonical.x-O.canonical.x||k.canonical.y-O.canonical.y);let A=0,P=0;for(;P<b.length;)b[P].equals(b[A])?++P:b[++A]=b[P++];b.length=A+1}let S=[];for(let A of b)b.some(P=>A.isChildOf(P))||S.push(A);return b=S.filter(A=>!c.some(P=>!!(A.overscaledZ<_&&P.isChildOf(A))||A.equals(P)||A.isChildOf(P))),b}coveringTiles(c){let u=this.coveringZoomLevel(c),_=u,b=this.elevation&&this.elevation.exaggeration(),S=b&&!c.isTerrainDEM,A=this.projection.name==="mercator";if(c.minzoom!==void 0&&u<c.minzoom)return[];c.maxzoom!==void 0&&u>c.maxzoom&&(u=c.maxzoom);let P=this.locationCoordinate(this.center),k=this.center.lat,O=1<<u,z=[O*P.x,O*P.y,0],U=this.projection.name==="globe",q=!U,X=i.bq.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u,q),Q=U?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),K=O*i.bl(1,this.center.lat),re=this._camera.position[2]/i.bl(1,this.center.lat),Y=[O*Q.x,O*Q.y,re*(q?1:K)],ae=U||b,ge=this.cameraToCenterDistance/c.tileSize*(c.roundZoom?1:.502),ce=this.isLODDisabled(!0)?u:0,_e;if(this._elevation&&c.isTerrainDEM)_e=1e4*this._elevation.exaggeration();else if(this._elevation){let Fe=this._elevation.getMinMaxForVisibleTiles();_e=Fe?Fe.max:this._centerAltitude}else _e=this._centerAltitude;let oe=c.isTerrainDEM?-_e:this._elevation?this._elevation.getMinElevationBelowMSL():0,ve=this.projection.isReprojectedInTileSpace?i.br(this):1,Ae=Fe=>{let Dt=new i.L(Fe.x+25e-6,Fe.y,Fe.z),jt=new i.L(Fe.x,Fe.y+25e-6,Fe.z),Ut=Fe.toLngLat(),ti=Dt.toLngLat(),mi=jt.toLngLat(),Ei=this.locationCoordinate(Ut),xi=this.locationCoordinate(ti),Si=this.locationCoordinate(mi),gn=Math.hypot(xi.x-Ei.x,xi.y-Ei.y),Zi=Math.hypot(Si.x-Ei.x,Si.y-Ei.y);return Math.sqrt(gn*Zi)*ve/25e-6},Re=Fe=>{let Ze=_e,Dt=oe;return{aabb:i.bu(this,O,0,0,0,Fe,Dt,Ze,this.projection),zoom:0,x:0,y:0,minZ:Dt,maxZ:Ze,wrap:Fe,fullyVisible:!1}},Oe=[],Je=[],Ue=u,ot=c.reparseOverscaled?_:u,nt=Fe=>Fe*Fe,Rt=nt((re-this._centerAltitude)*K),je=Fe=>{if(!this._elevation||!Fe.tileID||!A)return;let Ze=this._elevation.getMinMaxForTile(Fe.tileID),Dt=Fe.aabb;Ze?(Dt.min[2]=Ze.min,Dt.max[2]=Ze.max,Dt.center[2]=(Dt.min[2]+Dt.max[2])/2):(Fe.shouldSplit=tt(Fe),Fe.shouldSplit||(Dt.min[2]=Dt.max[2]=Dt.center[2]=this._centerAltitude))},tt=Fe=>{if(Fe.zoom<ce)return!0;if(Fe.zoom===Ue)return!1;if(Fe.shouldSplit!=null)return Fe.shouldSplit;let Ze=Fe.aabb.distanceX(Y),Dt=Fe.aabb.distanceY(Y),jt=Rt,Ut=1;if(U){jt=nt(Fe.aabb.distanceZ(Y));let Ei=Math.pow(2,Fe.zoom),xi=i.au((Fe.y+1)/Ei),Si=i.au(Fe.y/Ei),gn=Math.min(Math.max(k,xi),Si),Zi=i.bJ(gn)/i.bJ(k);if(Ut=gn===k?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Zi/this._mercatorScaleRatio),this.zoom<=i.bG&&Fe.zoom===Ue-1&&Zi>=.9)return!0}else if(S&&(jt=nt(Fe.aabb.distanceZ(Y)*K)),this.projection.isReprojectedInTileSpace&&_<=5){let Ei=Math.pow(2,Fe.zoom),xi=Ae(new i.L((Fe.x+.5)/Ei,(Fe.y+.5)/Ei));Ut=xi>.85?1:xi}let ti=Ze*Ze+Dt*Dt+jt,mi=nt((1<<Ue-Fe.zoom)*ge*Ut*((Ei,xi)=>{if(xi*nt(.707)<Ei)return 1;let Si=Math.sqrt(xi/Ei);return Si/(1.4144271570014144+(Math.pow(1.1,Si-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(jt,Rt),ti));return ti<mi};if(this.renderWorldCopies)for(let Fe=1;Fe<=3;Fe++)Oe.push(Re(-Fe)),Oe.push(Re(Fe));for(Oe.push(Re(0));Oe.length>0;){let Fe=Oe.pop(),Ze=Fe.x,Dt=Fe.y,jt=Fe.fullyVisible,Ut=()=>this.projection.name==="globe"&&(Fe.y===0||Fe.y===(1<<Fe.zoom)-1);if(!jt){let ti=ae?Fe.aabb.intersects(X):Fe.aabb.intersectsFlat(X);if(ti===0&&Ut()){let mi=new i.bs(Fe.zoom,Ze,Dt);ti=i.bt(this,O,mi,!0).intersects(X)}if(ti===0)continue;jt=ti===2}if(Fe.zoom!==Ue&&tt(Fe))for(let ti=0;ti<4;ti++){let mi=(Ze<<1)+ti%2,Ei=(Dt<<1)+(ti>>1),xi={aabb:A?Fe.aabb.quadrant(ti):i.bu(this,O,Fe.zoom+1,mi,Ei,Fe.wrap,Fe.minZ,Fe.maxZ,this.projection),zoom:Fe.zoom+1,x:mi,y:Ei,wrap:Fe.wrap,fullyVisible:jt,tileID:void 0,shouldSplit:void 0,minZ:Fe.minZ,maxZ:Fe.maxZ};S&&!U&&(xi.tileID=new i.am(Fe.zoom+1===Ue?ot:Fe.zoom+1,Fe.wrap,Fe.zoom+1,mi,Ei),je(xi)),Oe.push(xi)}else{let ti=Fe.zoom===Ue?ot:Fe.zoom;if(c.minzoom&&c.minzoom>ti)continue;if(!jt){let Si=ae?Fe.aabb.intersectsPrecise(X):Fe.aabb.intersectsPreciseFlat(X);if(Si===0&&Ut()){let gn=new i.bs(Fe.zoom,Ze,Dt);Si=i.bt(this,O,gn,!0).intersectsPrecise(X)}if(Si===0)continue}let mi=z[0]-(.5+Ze+(Fe.wrap<<Fe.zoom))*(1<<u-Fe.zoom),Ei=z[1]-.5-Dt,xi=Fe.tileID?Fe.tileID:new i.am(ti,Fe.wrap,Fe.zoom,Ze,Dt);Je.push({tileID:xi,distanceSq:mi*mi+Ei*Ei})}}if(this.fogCullDistSq){let Fe=this.fogCullDistSq,Ze=this.horizonLineFromTop();Je=Je.filter(Dt=>{let jt=[0,0,0,1],Ut=[i.V,i.V,0,1],ti=this.calculateFogTileMatrix(Dt.tileID.toUnwrapped());i.a7.transformMat4(jt,jt,ti),i.a7.transformMat4(Ut,Ut,ti);let mi=i.a7.min([],jt,Ut),Ei=i.a7.max([],jt,Ut),xi=i.bv(mi,Ei);if(xi===0)return!0;let Si=!1,gn=this._elevation;if(gn&&xi>Fe&&Ze!==0){let Zi=this.calculateProjMatrix(Dt.tileID.toUnwrapped()),hn;c.isTerrainDEM||(hn=gn.getMinMaxForTile(Dt.tileID)),hn||(hn={min:oe,max:_e});let an=i.bH(this.rotation),Wn=[an[0]*i.V,an[1]*i.V,hn.max];i.N.transformMat4(Wn,Wn,Zi),Si=(1-Wn[1])*this.height*.5<Ze}return xi<Fe||Si})}return Je.sort((Fe,Ze)=>Fe.distanceSq-Ze.distanceSq).map(Fe=>Fe.tileID)}resize(c,u){this.width=c,this.height=u,this.pixelsToGLUnits=[2/c,-2/u],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(c){return Math.pow(2,c)}scaleZoom(c){return Math.log(c)/Math.LN2}project(c){let u=i.aa(c.lat,-i.bw,i.bw),_=this.projection.project(c.lng,u);return new i.P(_.x*this.worldSize,_.y*this.worldSize)}unproject(c){return this.projection.unproject(c.x/this.worldSize,c.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/i.bl(1,this.center.lat)/this.worldSize}setLocationAtPoint(c,u){let _,b,S=this.centerPoint;if(this.projection.name==="globe"){let P=this.worldSize;_=(u.x-S.x)/P,b=(u.y-S.y)/P}else{let P=this.pointCoordinate(u),k=this.pointCoordinate(S);_=P.x-k.x,b=P.y-k.y}let A=this.locationCoordinate(c);this.setLocation(new i.L(A.x-_,A.y-b))}setLocation(c){this.center=this.coordinateLocation(c),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(c){return this.projection.locationPoint(this,c)}locationPoint3D(c){return this.projection.locationPoint(this,c,!0)}pointLocation(c){return this.coordinateLocation(this.pointCoordinate(c))}pointLocation3D(c){return this.coordinateLocation(this.pointCoordinate3D(c))}locationCoordinate(c,u){let _=u?i.bl(u,c.lat):void 0,b=this.projection.project(c.lng,c.lat);return new i.L(b.x,b.y,_)}coordinateLocation(c){return this.projection.unproject(c.x,c.y)}pointRayIntersection(c,u){let _=u??this._centerAltitude,b=[c.x,c.y,0,1],S=[c.x,c.y,1,1];i.a7.transformMat4(b,b,this.pixelMatrixInverse),i.a7.transformMat4(S,S,this.pixelMatrixInverse);let A=S[3];i.a7.scale(b,b,1/b[3]),i.a7.scale(S,S,1/A);let P=b[2],k=S[2];return{p0:b,p1:S,t:P===k?0:(_-P)/(k-P)}}screenPointToMercatorRay(c){let u=[c.x,c.y,0,1],_=[c.x,c.y,1,1];return i.a7.transformMat4(u,u,this.pixelMatrixInverse),i.a7.transformMat4(_,_,this.pixelMatrixInverse),i.a7.scale(u,u,1/u[3]),i.a7.scale(_,_,1/_[3]),u[2]=i.bl(u[2],this._center.lat)*this.worldSize,_[2]=i.bl(_[2],this._center.lat)*this.worldSize,i.a7.scale(u,u,1/this.worldSize),i.a7.scale(_,_,1/this.worldSize),new i.a2([u[0],u[1],u[2]],i.N.normalize([],i.N.sub([],_,u)))}rayIntersectionCoordinate(c){let{p0:u,p1:_,t:b}=c,S=i.bl(u[2],this._center.lat),A=i.bl(_[2],this._center.lat);return new i.L(i.U(u[0],_[0],b)/this.worldSize,i.U(u[1],_[1],b)/this.worldSize,i.U(S,A,b))}pointCoordinate(c,u=this._centerAltitude){return this.projection.pointCoordinate(this,c.x,c.y,u)}pointCoordinate3D(c){if(!this.elevation)return this.pointCoordinate(c);let u=this.projection.pointCoordinate3D(this,c.x,c.y);if(u)return new i.L(u[0],u[1],u[2]);let _=0,b=this.horizonLineFromTop();if(c.y>b)return this.pointCoordinate(c);let S=.02*b,A=c.clone();for(let P=0;P<10&&b-_>S;P++){A.y=i.U(_,b,.66);let k=this.projection.pointCoordinate3D(this,A.x,A.y);k?(b=A.y,u=k):_=A.y}return u?new i.L(u[0],u[1],u[2]):this.pointCoordinate(c)}isPointAboveHorizon(c){return this.projection.isPointAboveHorizon(this,c)}isPointOnSurface(c){if(c.y<0||c.y>this.height||c.x<0||c.x>this.width)return!1;if(this.elevation||this.zoom>=i.bx)return!this.isPointAboveHorizon(c);let u=this.pointCoordinate(c);return u.y>=0&&u.y<=1}_coordinatePoint(c,u){let _=u&&this.elevation?this.elevation.getAtPointOrZero(c,this._centerAltitude):this._centerAltitude,b=[c.x*this.worldSize,c.y*this.worldSize,_+c.toAltitude(),1];return i.a7.transformMat4(b,b,this.pixelMatrix),b[3]>0?new i.P(b[0]/b[3],b[1]/b[3]):new i.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){let{top:c,left:u}=this._edgeInsets,_=this.height-this._edgeInsets.bottom,b=this.width-this._edgeInsets.right,S=this.pointLocation3D(new i.P(u,c)),A=this.pointLocation3D(new i.P(b,c)),P=this.pointLocation3D(new i.P(b,_)),k=this.pointLocation3D(new i.P(u,_)),O=Math.min(S.lng,A.lng,P.lng,k.lng),z=Math.max(S.lng,A.lng,P.lng,k.lng),U=Math.min(S.lat,A.lat,P.lat,k.lat),q=Math.max(S.lat,A.lat,P.lat,k.lat),X=Math.pow(2,-this.zoom)/16*270,Q=this.projection.name==="globe"?1:4,K=(re,Y,ae,ge,ce)=>{let _e=(re+ae)/2,oe=(Y+ge)/2,ve=new i.P(_e,oe),{lng:Ae,lat:Re}=this.pointLocation3D(ve),Oe=Math.max(0,O-Ae,U-Re,Ae-z,Re-q);O=Math.min(O,Ae),z=Math.max(z,Ae),U=Math.min(U,Re),q=Math.max(q,Re),(ce<Q||Oe>X)&&(K(re,Y,_e,oe,ce+1),K(_e,oe,ae,ge,ce+1))};if(K(u,c,b,c,1),K(b,c,b,_,1),K(b,_,u,_,1),K(u,_,u,c,1),this.projection.name==="globe"){let[re,Y]=i.by(this);re?(q=90,z=180,O=-180):Y&&(U=-90,z=180,O=-180)}return new i.ad(new i.bn(O,U),new i.bn(z,q))}_getBoundsRectangular(c,u){let{top:_,left:b}=this._edgeInsets,S=this.height-this._edgeInsets.bottom,A=this.width-this._edgeInsets.right,P=new i.P(b,_),k=new i.P(A,_),O=new i.P(A,S),z=new i.P(b,S),U=this.pointCoordinate(P,c),q=this.pointCoordinate(k,c),X=this.pointCoordinate(O,u),Q=this.pointCoordinate(z,u),K=(re,Y)=>(Y.y-re.y)/(Y.x-re.x);return U.y>1&&q.y>=0?U=new i.L((1-Q.y)/K(Q,U)+Q.x,1):U.y<0&&q.y<=1&&(U=new i.L(-Q.y/K(Q,U)+Q.x,0)),q.y>1&&U.y>=0?q=new i.L((1-X.y)/K(X,q)+X.x,1):q.y<0&&U.y<=1&&(q=new i.L(-X.y/K(X,q)+X.x,0)),new i.ad().extend(this.coordinateLocation(U)).extend(this.coordinateLocation(q)).extend(this.coordinateLocation(Q)).extend(this.coordinateLocation(X))}_getBoundsRectangularTerrain(){let c=this.elevation;if(!c.visibleDemTiles.length||c.isUsingMockSource())return this._getBoundsRectangular(0,0);let u=c.visibleDemTiles.reduce((_,b)=>{if(b.dem){let S=b.dem.tree;_.min=Math.min(_.min,S.minimums[0]),_.max=Math.max(_.max,S.maximums[0])}return _},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(u.min*c.exaggeration(),u.max*c.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(c=!0){let u=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,_=this.height/2-u*(1-this._horizonShift);return c?Math.max(0,_):_}getMaxBounds(){return this.maxBounds}setMaxBounds(c){this.maxBounds=c,this.minLat=-i.bw,this.maxLat=i.bw,this.minLng=-180,this.maxLng=180,c&&(this.minLat=c.getSouth(),this.maxLat=c.getNorth(),this.minLng=c.getWest(),this.maxLng=c.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=i.a5(this.minLng)*this.tileSize,this.worldMaxX=i.a5(this.maxLng)*this.tileSize,this.worldMinY=i.ae(this.maxLat)*this.tileSize,this.worldMaxY=i.ae(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(c,u){return this.projection.createTileMatrix(this,u,c)}calculateDistanceTileData(c){let u=c.key,_=this._distanceTileDataCache;if(_[u])return _[u];let b=c.canonical,S=1/this.height,A=this.cameraWorldSize,P=A/this.zoomScale(b.z),k=(b.x+Math.pow(2,b.z)*c.wrap)*P,O=b.y*P,z=this.point;z.x*=A/this.worldSize,z.y*=A/this.worldSize;let U=this.angle,q=Math.sin(-U),X=-Math.cos(-U);return _[u]={bearing:[q,X],center:[(z.x-k)*S,(z.y-O)*S],scale:P/i.V*S},_[u]}calculateFogTileMatrix(c){let u=c.key,_=this._fogTileMatrixCache;if(_[u])return _[u];let b=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,c);return i.a6.multiply(b,this.worldToFogMatrix,b),_[u]=new Float32Array(b),_[u]}calculateProjMatrix(c,u=!1,_=!1){let b=c.key,S;if(S=_?this._expandedProjMatrixCache:u?this._alignedProjMatrixCache:this._projMatrixCache,S[b])return S[b];let A=this.calculatePosMatrix(c,this.worldSize),P;return P=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:_?this.expandedFarZProjMatrix:u?this.alignedProjMatrix:this.projMatrix,i.a6.multiply(A,P,A),S[b]=new Float32Array(A),S[b]}calculatePixelsToTileUnitsMatrix(c){let u=c.tileID.key,_=this._pixelsToTileUnitsCache;if(_[u])return _[u];let b=i.bz(c,this);return _[u]=b,_[u]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){let c=1/this.worldSize,u=i.a6.fromScaling([],[c,c,c]);return i.a6.multiply(u,u,this.globeMatrix),u}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;let c=this._elevation;this._updateCameraState();let u=i.bl(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(u),b=this._camera.forward(),S=i.bl(1,this._center.lat);_[2]/=S,b[2]/=S,i.N.normalize(b,b);let A=c.raycast(_,b,c.exaggeration());if(A){let P=i.N.scaleAndAdd([],_,b,A),k=new i.L(P[0],P[1],i.bl(P[2],i.au(P[1]))),O=(k.z+i.N.length([k.x-_[0],k.y-_[1],k.z-_[2]*S]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(O),this._centerAltitude=k.toAltitude(),this._center=this.coordinateLocation(k),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(c=!1){if(!this._elevation)return;let u=this._elevation,_=i.bl(1,this._center.lat)*this.worldSize,b=this._computeCameraPosition(_),S=u.getAtPointOrZero(new i.L(...b)),A=this.pixelsPerMeter/this.worldSize*S,P=this._minimumHeightOverTerrain(),k=b[2]-A;if(k<=P)if(k<0||c){let O=this.locationCoordinate(this._center,this._centerAltitude),z=[b[0],b[1],O.z-b[2]],U=i.N.length(z);z[2]-=(P-k)/this._pixelsPerMercatorPixel;let q=i.N.length(z);if(q===0)return;i.N.scale(z,z,U/q*this._pixelsPerMercatorPixel),this._camera.position=[b[0],b[1],O.z*this._pixelsPerMercatorPixel-z[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let c=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||c){let q=this.center;return q.lat=i.aa(q.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!c)&&(q.lng=i.aa(q.lng,this.minLng,this.maxLng)),this.center=q,void(this._constraining=!1)}let u=this._unmodified,{x:_,y:b}=this.point,S=0,A=_,P=b,k=this.width/2,O=this.height/2,z=this.worldMinY*this.scale,U=this.worldMaxY*this.scale;if(b-O<z&&(P=z+O),b+O>U&&(P=U-O),U-z<this.height&&(S=Math.max(S,this.height/(U-z)),P=(U+z)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){let q=this.worldMinX*this.scale,X=this.worldMaxX*this.scale,Q=this.worldSize/2-(q+X)/2;A=(_+Q+this.worldSize)%this.worldSize-Q,A-k<q&&(A=q+k),A+k>X&&(A=X-k),X-q<this.width&&(S=Math.max(S,this.width/(X-q)),A=(X+q)/2)}A===_&&P===b||(this.center=this.unproject(new i.P(A,P))),S&&(this.zoom+=this.scaleZoom(S)),this._constrainCamera(),this._unmodified=u,this._constraining=!1}_minZoomForBounds(){let c=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(c=Math.max(c,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),c}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;let c=this.centerOffset,u=this.projection.name==="globe",_=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=i.bl(1,this.center.lat)/i.bl(1,i.bI));let b=i.bA(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,b),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;let S=this.projection.zAxisUnit==="meters"?_:1,A=this._camera.getWorldToCamera(this.worldSize,S),P,k=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(k[8]=2*-c.x/this.width,k[9]=2*c.y/this.height,this.isOrthographic){let Re=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Oe=Re*this.aspect,Je=-Oe,Ue=-Re;Oe-=c.x,Je-=c.x,Re+=c.y,Ue+=c.y,P=this._camera.getCameraToClipOrthographic(Je,Oe,Ue,Re,this._nearZ,this._farZ),((ot,nt,Rt,je)=>{for(let tt=0;tt<16;tt++)ot[tt]=sh(nt[tt],Rt[tt],je)})(P,P,k,Fd(this.pitch>=15?1:this.pitch/15))}else P=k;let O=i.a6.mul([],k,A),z=i.a6.mul([],P,A);if(this.projection.isReprojectedInTileSpace){let Re=this.locationCoordinate(this.center),Oe=i.a6.identity([]);i.a6.translate(Oe,Oe,[Re.x*this.worldSize,Re.y*this.worldSize,0]),i.a6.multiply(Oe,Oe,i.bB(this)),i.a6.translate(Oe,Oe,[-Re.x*this.worldSize,-Re.y*this.worldSize,0]),i.a6.multiply(z,z,Oe),i.a6.multiply(O,O,Oe),this.inverseAdjustmentMatrix=i.bC(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=i.a6.scale([],z,[this.worldSize,this.worldSize,this.worldSize/S,1]),this.projMatrix=z,this.invProjMatrix=i.a6.invert(new Float64Array(16),this.projMatrix),u){let Re=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Re[8]=2*-c.x/this.width,Re[9]=2*c.y/this.height,this.expandedFarZProjMatrix=i.a6.mul([],Re,A)}else this.expandedFarZProjMatrix=this.projMatrix;let U=i.a6.invert([],P);this.frustumCorners=i.bD.fromInvProjectionMatrix(U,this.horizonLineFromTop(),this.height),this.cameraFrustum=i.bq.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!u);let q=new Float32Array(16);i.a6.identity(q),i.a6.scale(q,q,[1,-1,1]),i.a6.rotateX(q,q,this._pitch),i.a6.rotateZ(q,q,this.angle);let X=i.a6.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=i.a6.clone(X);let Q=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;X[8]=2*-c.x/this.width,X[9]=2*(c.y+Q)/this.height,this.skyboxMatrix=i.a6.multiply(q,X,q);let K=this.point,re=K.x,Y=K.y,ae=this.width%2/2,ge=this.height%2/2,ce=Math.cos(this.angle),_e=Math.sin(this.angle),oe=re-Math.round(re)+ce*ae+_e*ge,ve=Y-Math.round(Y)+ce*ge+_e*ae,Ae=new Float64Array(z);if(i.a6.translate(Ae,Ae,[oe>.5?oe-1:oe,ve>.5?ve-1:ve,0]),this.alignedProjMatrix=Ae,z=i.a6.create(),i.a6.scale(z,z,[this.width/2,-this.height/2,1]),i.a6.translate(z,z,[1,-1,0]),this.labelPlaneMatrix=z,z=i.a6.create(),i.a6.scale(z,z,[1,-1,1]),i.a6.translate(z,z,[-1,-1,0]),i.a6.scale(z,z,[2/this.width,2/this.height,1]),this.glCoordMatrix=z,this.pixelMatrix=i.a6.multiply(new Float64Array(16),this.labelPlaneMatrix,O),this._calcFogMatrices(),this._distanceTileDataCache={},z=i.a6.invert(new Float64Array(16),this.pixelMatrix),!z)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=z,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=i.bE(this);let Re=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=i.N.transformMat4(Re,Re,A),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=z;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};let c=this.cameraWorldSizeForFog,u=this.cameraPixelsPerMeter,_=this._camera.position,b=1/this.height/this._pixelsPerMercatorPixel,S=[c,c,u];i.N.scale(S,S,b),i.N.scale(_,_,-1),i.N.multiply(_,_,S);let A=i.a6.create();i.a6.translate(A,A,_),i.a6.scale(A,A,S),this.mercatorFogMatrix=A,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(c,u,b)}_computeCameraPosition(c){let u=(c=c||this.pixelsPerMeter)/this.pixelsPerMeter,_=this._camera.forward(),b=this.point,S=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*u-c/this.worldSize*this._centerAltitude;return[b.x/this.worldSize-_[0]*S,b.y/this.worldSize-_[1]*S,c/this.worldSize*this._centerAltitude-_[2]*S]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(c){let u=this._maxCameraBoundsDistance()*Math.cos(this._pitch),_=this._camera.position[2],b=c[2],S=1;this.projection.wrap&&(this.center=this.center.wrap()),b>0&&(S=Math.min((u-_)/b,1)),this._camera.position=i.N.scaleAndAdd([],this._camera.position,c,S),this._updateStateFromCamera()}_updateStateFromCamera(){let c=this._camera.position,u=this._camera.forward(),{pitch:_,bearing:b}=this._camera.getPitchBearing(),S=i.bl(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,A=this._mercatorZfromZoom(this._maxZoom)*Math.cos(i.bj(this._maxPitch)),P=Math.max((c[2]-S)/Math.cos(_),A),k=this._zoomFromMercatorZ(P);i.N.scaleAndAdd(c,c,u,P),this._pitch=i.aa(_,i.bj(this.minPitch),i.bj(this.maxPitch)),this.angle=i.bh(b,-Math.PI,Math.PI),this._setZoom(i.aa(k,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new i.L(c[0],c[1],c[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(c){return Math.pow(2,c)*this.tileSize}_mercatorZfromZoom(c){return this.cameraToCenterDistance/this._worldSizeFromZoom(c)}_minimumHeightOverTerrain(){let c=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(c)}_zoomFromMercatorZ(c){return this.scaleZoom(this.cameraToCenterDistance/(c*this.tileSize))}zoomFromMercatorZAdjusted(c){let u=0,_=i.bx,b=0,S=1/0;for(;_-u>1e-6&&_>u;){let A=u+.5*(_-u),P=this.tileSize*Math.pow(2,A),k=this.getCameraToCenterDistance(this.projection,A,P),O=this.scaleZoom(k/(c*this.tileSize)),z=Math.abs(A-O);z<S&&(S=z,b=A),A<O?u=A:_=A}return b}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(i.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(c,u){let _=Math.min(c.x,u.x),b=Math.max(c.x,u.x),S=Math.min(c.y,u.y),A=Math.max(c.y,u.y);if(S<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;let P=[new i.P(_,S),new i.P(b,A),new i.P(_,A),new i.P(b,S)],k=this.renderWorldCopies?-3:0,O=this.renderWorldCopies?4:1;for(let z of P){let U=this.pointRayIntersection(z);if(U.t<0)return!0;let q=this.rayIntersectionCoordinate(U);if(q.x<k||q.y<0||q.x>O||q.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+i.bF(this.fovAboveCenter)>88||this.anyCornerOffEdge(new i.P(0,0),new i.P(this.width,this.height))}zoomDeltaToMovement(c,u){let _=i.N.length(i.N.sub([],this._camera.position,c)),b=this._zoomFromMercatorZ(_)+u;return _-this._mercatorZfromZoom(b)}getCameraPoint(){if(this.projection.name==="globe"){let c=function([u,_,b],S){let A=[u,_,b,1];i.a7.transformMat4(A,A,S);let P=A[3]=Math.max(A[3],1e-6);return A[0]/=P,A[1]/=P,A[2]/=P,A}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new i.P(c[0],c[1])}{let c=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new i.P(0,c))}}getCameraToCenterDistance(c,u=this.zoom,_=this.worldSize){let b=i.bA(c,u,this.width,this.height,1024),S=c.pixelSpaceConversion(this.center.lat,_,b),A=.5/Math.tan(.5*this._fov)*this.height*S;return this.isOrthographic&&(A=sh(1,A,Fd(this.pitch>=15?1:this.pitch/15))),A}getWorldToCameraMatrix(){let c=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&i.a6.multiply(c,c,this.globeMatrix),c}getFrustum(c){return i.bq.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,this.projection.zAxisUnit==="meters")}}let so={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,ShadowMap0:10},Sc=(g,c)=>{if(c>0&&g.terrain&&i.w("Cutoff is currently disabled on terrain"),c<=0||g.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};let u=g.transform,_=Math.max(Math.abs(u._zoom-(g.minCutoffZoom-1)),1),b=u.isLODDisabled(!1)?i.O(60,45,u.pitch):i.O(30,15,u.pitch),S=u._farZ-u._nearZ,A=c*u.height,P=((1-(k=b))*u.cameraToCenterDistance+k*(u._farZ+A))*_;var k;return{shouldRenderCutoff:b<1,uniformValues:{u_cutoff_params:[u._nearZ,u._farZ,(P-u._nearZ)/S,(P-A-u._nearZ)/S]}}},Do={cascadeCount:2,shadowMapResolution:2048};class $f{constructor(c,u){this.aabb=c,this.lastCascade=u}}class R_{add(c,u){let _=this.receivers[c.key];_!==void 0?(_.aabb.min[0]=Math.min(_.aabb.min[0],u.min[0]),_.aabb.min[1]=Math.min(_.aabb.min[1],u.min[1]),_.aabb.min[2]=Math.min(_.aabb.min[2],u.min[2]),_.aabb.max[0]=Math.max(_.aabb.max[0],u.max[0]),_.aabb.max[1]=Math.max(_.aabb.max[1],u.max[1]),_.aabb.max[2]=Math.max(_.aabb.max[2],u.max[2])):this.receivers[c.key]=new $f(u,null)}clear(){this.receivers={}}get(c){return this.receivers[c.key]}computeRequiredCascades(c,u,_){let b=i.bS.fromPoints(c.points),S=0;for(let A in this.receivers){let P=this.receivers[A];if(!P||!b.intersectsAabb(P.aabb))continue;P.aabb.min=b.closestPoint(P.aabb.min),P.aabb.max=b.closestPoint(P.aabb.max);let k=P.aabb.getCorners();for(let O=0;O<_.length;O++){let z=!0;for(let U of k){let q=[U[0]*u,U[1]*u,U[2]];if(i.N.transformMat4(q,q,_[O].matrix),q[0]<-1||q[0]>1||q[1]<-1||q[1]>1){z=!1;break}}if(P.lastCascade=O,S=Math.max(S,O),z)break}}return S+1}}class Yf{constructor(c){this.painter=c,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new R_,this._depthMode=new ki(c.context.gl.LEQUAL,ki.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this.useNormalOffset=!1,c.tp.registerParameter(Do,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),c.tp.registerParameter(Do,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32})}destroy(){for(let c of this._cascades)c.texture.destroy(),c.framebuffer.destroy();this._cascades=[]}updateShadowParameters(c,u){let _=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!u||!u.properties)return;let b=u.properties.get("shadow-intensity");if(!u.shadowsEnabled()||b<=0||(this._shadowLayerCount=_.style.order.reduce((Q,K)=>{let re=_.style._mergedLayers[K];return Q+(re.hasShadowPass()&&!re.isHidden(c.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this._enabled))return;let S=_.context,A=Do.shadowMapResolution,P=Do.shadowMapResolution;if(this._cascades.length===0||Do.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let Q=0;Q<Do.cascadeCount;++Q){let K=_._shadowMapDebug,re=S.gl,Y=S.createFramebuffer(A,P,K,"texture"),ae=new i.T(S,{width:A,height:P,data:null},re.DEPTH_COMPONENT);if(Y.depthAttachment.set(ae.texture),K){let ge=new i.T(S,{width:A,height:P,data:null},re.RGBA);Y.colorAttachment.set(ge.texture)}this._cascades.push({framebuffer:Y,texture:ae,matrix:[],far:0,boundingSphereRadius:0,frustum:new i.bq,scale:0})}}this.shadowDirection=gp(u);let k=0;if(c.elevation){let Q=c.elevation,K=[1e4,-1e4];Q.visibleDemTiles.filter(re=>re.dem).forEach(re=>{let Y=re.dem.tree;K[0]=Math.min(K[0],Y.minimums[0]),K[1]=Math.max(K[1],Y.maximums[0])}),K[0]!==1e4&&(k=(K[1]-K[0])*Q.exaggeration())}let O=1.5*c.cameraToCenterDistance,z=3*O,U=new Float64Array(16);for(let Q=0;Q<this._cascades.length;++Q){let K=this._cascades[Q],re=c.height/50,Y=1;Do.cascadeCount===1?Y=z:Q===0?Y=O:(re=O,Y=z);let[ae,ge]=k_(c,this.shadowDirection,re,Y,Do.shadowMapResolution,k);K.scale=c.scale,K.matrix=ae,K.boundingSphereRadius=ge,i.a6.invert(U,K.matrix),K.frustum=i.bq.fromInvProjectionMatrix(U,1,0,!0),K.far=Y}let q=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[q].far,this._cascades[q].far],this._uniformValues.u_shadow_intensity=b,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Do.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Do.shadowMapResolution,this._uniformValues.u_shadowmap_0=so.ShadowMap0,this._uniformValues.u_shadowmap_1=so.ShadowMap0+1,this._groundShadowTiles=_.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});let X=_.transform.elevation;for(let Q of this._groundShadowTiles){let K={min:0,max:0};if(X){let re=X.getMinMaxForTile(Q);re&&(K=re)}this.addShadowReceiver(Q.toUnwrapped(),K.min,K.max)}}get enabled(){return this._enabled}set enabled(c){this._enabled=c}drawShadowPass(c,u){if(!this._enabled)return;let _=this.painter,b=_.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(_.transform.getFrustum(0),_.transform.worldSize,this._cascades),b.viewport.set([0,0,Do.shadowMapResolution,Do.shadowMapResolution]);for(let S=0;S<this._numCascadesToRender;++S){_.currentShadowCascade=S,b.bindFramebuffer.set(this._cascades[S].framebuffer.framebuffer),b.clear({color:i.ax.white,depth:1});for(let A of c.order){let P=c._mergedLayers[A];if(!P.hasShadowPass()||P.isHidden(_.transform.zoom))continue;let k=c.getLayerSourceCache(P),O=k?u[k.id]:void 0;(P.type==="model"||O&&O.length)&&_.renderLayer(_,k,P,O)}}_.currentShadowCascade=0}drawGroundShadows(){if(!this._enabled)return;let c=this.painter,u=c.style,_=c.context,b=u.directionalLight,S=u.ambientLight;if(!b||!S)return;let A=[],P=Sc(c,c.longestCutoffRange);P.shouldRenderCutoff&&A.push("RENDER_CUTOFF");let k=Nd(b,S),O=new ki(_.gl.LEQUAL,ki.ReadOnly,c.depthRangeFor3D);for(let z of this._groundShadowTiles){let U=z.toUnwrapped(),q=c.isTileAffectedByFog(z),X=c.getOrCreateProgram("groundShadow",{defines:A,overrideFog:q});this.setupShadows(U,X),c.uploadCommonUniforms(_,X,U,null,P);let Q={u_matrix:c.transform.calculateProjMatrix(U),u_ground_shadow_factor:k};X.draw(c,_.gl.TRIANGLES,O,tn.disabled,Mn.multiply,Di.disabled,Q,"ground_shadow",c.tileExtentBuffer,c.quadTriangleIndexBuffer,c.tileExtentSegments,{},c.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Mn.unblended:Mn.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(c){let u=this.painter.transform,_=u.calculatePosMatrix(c,u.worldSize);return i.a6.multiply(_,this._cascades[this.painter.currentShadowCascade].matrix,_),Float32Array.from(_)}calculateShadowPassMatrixFromMatrix(c){return i.a6.multiply(c,this._cascades[this.painter.currentShadowCascade].matrix,c),Float32Array.from(c)}setupShadows(c,u,_,b=0){if(!this._enabled)return;let S=this.painter.transform,A=this.painter.context,P=A.gl,k=this._uniformValues,O=new Float64Array(16),z=S.calculatePosMatrix(c,S.worldSize);for(let U=0;U<this._cascades.length;U++)i.a6.multiply(O,this._cascades[U].matrix,z),k[U===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(O),A.activeTexture.set(P.TEXTURE0+so.ShadowMap0+U),this._cascades[U].texture.bind(P.NEAREST,P.CLAMP_TO_EDGE);if(this.useNormalOffset=!!_,this.useNormalOffset){let U=i.bR(c.canonical),q=2/S.tileSize*i.V/Do.shadowMapResolution,X=q*this._cascades[0].boundingSphereRadius,Q=q*this._cascades[this._cascades.length-1].boundingSphereRadius,K=(_==="vector-tile"?1:3)/Math.pow(2,b-c.canonical.z-(1-S.zoom+Math.floor(S.zoom)));k.u_shadow_normal_offset=[U,X*K,Q*K],k.u_shadow_bias=[6e-5,.0012,.012]}else k.u_shadow_bias=[36e-5,.0012,.012];u.setShadowUniformValues(A,k)}setupShadowsFromMatrix(c,u,_=!1){if(!this._enabled)return;let b=this.painter.context,S=b.gl,A=this._uniformValues,P=new Float64Array(16);for(let k=0;k<Do.cascadeCount;k++)i.a6.multiply(P,this._cascades[k].matrix,c),A[k===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(P),b.activeTexture.set(S.TEXTURE0+so.ShadowMap0+k),this._cascades[k].texture.bind(S.NEAREST,S.CLAMP_TO_EDGE);this.useNormalOffset=_,_?(A.u_shadow_normal_offset=[1,5,5],A.u_shadow_bias=[6e-5,.0012,.012]):A.u_shadow_bias=[36e-5,.0012,.012],u.setShadowUniformValues(b,A)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(c,u,_,b){if(b[2]>=0)return{};let S=function(k,O,z){let U=z/(1<<k.canonical.z);return new i.bS([k.canonical.x*U+k.wrap*z,k.canonical.y*U+k.wrap*z,0],[(k.canonical.x+1)*U+k.wrap*z,(k.canonical.y+1)*U+k.wrap*z,O])}(c,u,_).getCorners(),A=u/-b[2];b[0]<0?(i.N.add(S[0],S[0],[b[0]*A,0,0]),i.N.add(S[3],S[3],[b[0]*A,0,0])):b[0]>0&&(i.N.add(S[1],S[1],[b[0]*A,0,0]),i.N.add(S[2],S[2],[b[0]*A,0,0])),b[1]<0?(i.N.add(S[0],S[0],[0,b[1]*A,0]),i.N.add(S[1],S[1],[0,b[1]*A,0])):b[1]>0&&(i.N.add(S[2],S[2],[0,b[1]*A,0]),i.N.add(S[3],S[3],[0,b[1]*A,0]));let P={};return P.vertices=S,P.planes=[u0(S[1],S[0],S[4]),u0(S[2],S[1],S[5]),u0(S[3],S[2],S[6]),u0(S[0],S[3],S[7])],P}addShadowReceiver(c,u,_){this._receivers.add(c,i.bS.fromTileIdAndHeight(c,u,_))}getMaxCascadeForTile(c){let u=this._receivers.get(c);return u&&u.lastCascade?u.lastCascade:0}}function u0(g,c,u){let _=i.N.sub([],u,c),b=i.N.sub([],g,c),S=i.N.cross([],_,b),A=i.N.length(S);return A===0?[0,0,1,0]:(i.N.scale(S,S,1/A),[S[0],S[1],S[2],-i.N.dot(S,c)])}function gp(g){let c=g.properties.get("direction"),u=i.bQ(c.x,c.y,c.z);u[2]=i.aa(u[2],0,75);let _=i.bT([u[0],u[1],u[2]]);return i.N.fromValues(_.x,_.y,_.z)}function Nd(g,c){let u=g.properties.get("color"),_=g.properties.get("intensity"),b=g.properties.get("direction"),S=[b.x,b.y,b.z],A=c.properties.get("color"),P=c.properties.get("intensity"),k=Math.max(i.N.dot([0,0,1],S),0),O=[0,0,0];i.N.scale(O,A.toArray01Linear().slice(0,3),P);let z=[0,0,0];return i.N.scale(z,u.toArray01Linear().slice(0,3),k*_),i.bU([O[0]>0?O[0]/(O[0]+z[0]):0,O[1]>0?O[1]/(O[1]+z[1]):0,O[2]>0?O[2]/(O[2]+z[2]):0])}function k_(g,c,u,_,b,S){let A=g.zoom,P=g.scale,k=g.worldSize,O=1/k,z=g.aspect,U=Math.sqrt(1+z*z)*Math.tan(.5*g.fovX),q=U*U,X=_-u,Q=_+u,K,re;q>X/Q?(K=_,re=_*U):(K=.5*Q*(1+q),re=.5*Math.sqrt(X*X+2*(_*_+u*u)*q+Q*Q*q*q));let Y=g.projection.pixelsPerMeter(g.center.lat,k),ae=g._camera.getCameraToWorldMercator(),ge=[0,0,-K*O];i.N.transformMat4(ge,ge,ae);let ce=re*O,_e=g._edgeInsets;if(!(_e.left===0&&_e.top===0&&_e.right===0&&_e.bottom===0||_e.left===_e.right&&_e.top===_e.bottom)){let jt=g._camera.getWorldToCamera(g.worldSize,g.projection.zAxisUnit==="meters"?Y:1),Ut=g._camera.getCameraToClipPerspective(g._fov,g.width/g.height,u,_);Ut[8]=2*-g.centerOffset.x/g.width,Ut[9]=2*g.centerOffset.y/g.height;let ti=new Float64Array(16);i.a6.mul(ti,Ut,jt);let mi=new Float64Array(16);i.a6.invert(mi,ti);let Ei=i.bq.fromInvProjectionMatrix(mi,k,A,!0);for(let xi of Ei.points){let Si=((oe=xi)[0]/=P,oe[1]/=P,oe[2]=i.bl(oe[2],g._center.lat),oe);ce=Math.max(ce,i.N.len(i.N.subtract([],ge,Si)))}}var oe;ce*=b/(b-1);let ve=Math.acos(c[2]),Ae=Math.atan2(-c[0],-c[1]),Re=new rh;Re.position=ge,Re.setPitchBearing(ve,Ae);let Oe=Re.getWorldToCamera(k,Y),Je=ce*k,Ue=Math.min(g._mercatorZfromZoom(17)*k*-2,-2*Je),ot=Re.getCameraToClipOrthographic(-Je,Je,-Je,Je,Ue,(Je+S*Y)/c[2]),nt=new Float64Array(16);i.a6.multiply(nt,ot,Oe);let Rt=i.N.fromValues(Math.floor(1e6*ge[0])/1e6*k,Math.floor(1e6*ge[1])/1e6*k,0),je=.5*b,tt=[0,0,0];i.N.transformMat4(tt,Rt,nt),i.N.scale(tt,tt,je);let Fe=[Math.floor(tt[0]),Math.floor(tt[1]),Math.floor(tt[2])],Ze=[0,0,0];i.N.sub(Ze,tt,Fe),i.N.scale(Ze,Ze,-1/je);let Dt=new Float64Array(16);return i.a6.identity(Dt),i.a6.translate(Dt,Dt,Ze),i.a6.multiply(nt,Dt,nt),[nt,Je]}let Tc=(g,c)=>pt(g,c&&c.filter(u=>u.identifier!=="source.canvas")),D_=i.ac(jn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),oh=i.ac(jn,["setCenter","setZoom","setBearing","setPitch"]),Jf={version:8,layers:[],sources:{}},L_={duration:300,delay:0},ky=new Set(["fill","line","background","hillshade","raster"]);class Wa extends i.E{constructor(c,u={}){super(),this.map=c,this.scope=u.scope||"",this.fragments=[],this.importDepth=u.importDepth||0,this.importsCache=u.importsCache||new Map,this.resolvedImports=u.resolvedImports||new Set,this.transition=i.e({},L_),this._buildingIndex=new T_(this),this.crossTileSymbolIndex=new Xf,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=u.styleChanges||new we,this.dispatcher=u.dispatcher?u.dispatcher:new i.bW(i.bX(),this),u.imageManager?this.imageManager=u.imageManager:(this.imageManager=new Ce,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=u.glyphManager?u.glyphManager:new i.bY(c._requestManager,u.localFontFamily?i.bZ.all:u.localIdeographFontFamily?i.bZ.ideographs:i.bZ.none,u.localFontFamily||u.localIdeographFontFamily),u.modelManager?this.modelManager=u.modelManager:(this.modelManager=new Le(c._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=u.configOptions?u.configOptions:new Map,this._configDependentLayers=u.configDependentLayers?u.configDependentLayers:new Set,this._config=u.config,this.dispatcher.broadcast("setReferrer",i.b_());let _=this;this._rtlTextPluginCallback=Wa.registerForPluginStateChange(b=>{_.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:b.pluginStatus,pluginURL:b.pluginURL},(S,A)=>{if(i.b$(S),A&&A.every(P=>P))for(let P in _._sourceCaches){let k=_._sourceCaches[P],O=k.getSource().type;O!=="vector"&&O!=="geojson"||k.reload()}})}),this.on("data",b=>{if(b.dataType!=="source"||b.sourceDataType!=="metadata")return;let S=this.getOwnSource(b.sourceId);if(S&&S.vectorLayerIds)for(let A in this._layers){let P=this._layers[A];P.source===S.id&&this._validateLayer(P)}})}loadURL(c,u={}){this.fire(new i.b("dataloading",{dataType:"style"}));let _=typeof u.validate=="boolean"?u.validate:!i.c0(c);c=this.map._requestManager.normalizeStyleURL(c,u.accessToken),this.resolvedImports.add(c);let b=this.importsCache.get(c);if(b)return this._load(b,_);let S=this.map._requestManager.transformRequest(c,i.R.Style);this._request=i.g(S,(A,P)=>{if(this._request=null,A)this.fire(new i.a(A));else if(P)return this.importsCache.set(c,P),this._load(P,_)})}loadJSON(c,u={}){this.fire(new i.b("dataloading",{dataType:"style"})),this._request=i.f.frame(()=>{this._request=null,this._load(c,u.validate!==!1)})}loadEmpty(){this.fire(new i.b("dataloading",{dataType:"style"})),this._load(Jf,!1)}_loadImports(c,u,_){if(this.importDepth>=4)return i.w("Style doesn't support nesting deeper than 5"),Promise.resolve();let b=[];for(let S of c){let A=this._createFragmentStyle(S),P=new Promise(z=>{A.once("style.import.load",z),A.once("error",z)}).then(()=>this.mergeAll());if(b.push(P),this.resolvedImports.has(S.url)){A.loadEmpty();continue}let k=S.data||this.importsCache.get(S.url);k?A.loadJSON(k,{validate:u}):S.url?A.loadURL(S.url,{validate:u}):A.loadEmpty();let O={style:A,id:S.id,config:S.config};if(_){let z=this.fragments.findIndex(({id:U})=>U===_);this.fragments=this.fragments.slice(0,z).concat(O).concat(this.fragments.slice(z))}else this.fragments.push(O)}return Promise.allSettled(b)}_createFragmentStyle(c){let u=this.scope?i.ag(c.id,this.scope):c.id,_=new Wa(this.map,{scope:u,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:c.config,configOptions:this.options,configDependentLayers:this._configDependentLayers});return _.setEventedParent(this.map,{style:_}),_}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});let c=this.isRootStyle();this._shouldPrecompile=c,this.fire(new i.b(c?"style.load":"style.import.load"))}_load(c,u){let _=c.schema;if(this.isRootStyle()&&(c.fragment||_&&c.fragment!==!1)){let A=i.e({},Jf,{imports:[{id:"basemap",data:c,url:""}]});return void this._load(A,u)}if(this.setConfig(this._config,_),u&&Tc(this,be(c)))return;this._loaded=!0,this.stylesheet=i.c1(c);for(let A in c.sources)this.addSource(A,c.sources[A],{validate:!1,isInitialLoad:!0});c.sprite?this._loadSprite(c.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(c.glyphs,this.scope);let b=M_(this.stylesheet.layers);if(this._order=b.map(A=>A.id),this.stylesheet.light&&i.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){let A=this.stylesheet.lights[0];this.light=new St(A.properties,A.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new St(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(let A of b){let P=i.c2(A,this.scope,this.options);P.isConfigDependent&&this._configDependentLayers.add(P.fqid),P.setEventedParent(this,{layer:{id:P.id}}),this._layers[P.id]=P,this._serializedLayers[P.id]=P.serialize();let k=this.getOwnLayerSourceCache(P),O=!!this.directionalLight&&this.directionalLight.shadowsEnabled();k&&P.canCastShadows()&&O&&(k.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);let S=this.stylesheet.terrain;S&&(this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=i.f.hasCanvasFingerprintNoise()),this.disableElevatedTerrain?i.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."):this.terrainSetForDrapingOnly()||this._createTerrain(S,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new i.b("data",{dataType:"style"})),c.imports?this._loadImports(c.imports,u).then(()=>this._reloadImports()):this._reloadImports()}isRootStyle(){return this.importDepth===0}mergeAll(){let c,u,_,b,S,A,P,k;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(O=>{if(O.stylesheet){if(O.light!=null&&(c=O.light),O.stylesheet.lights)for(let z of O.stylesheet.lights)z.type==="ambient"&&O.ambientLight!=null&&(u=O.ambientLight),z.type==="directional"&&O.directionalLight!=null&&(_=O.directionalLight);b=this._prioritizeTerrain(b,O.terrain,O.stylesheet.terrain),O.stylesheet.fog&&O.fog!=null&&(S=O.fog),O.stylesheet.camera!=null&&(k=O.stylesheet.camera),O.stylesheet.projection!=null&&(A=O.stylesheet.projection),O.stylesheet.transition!=null&&(P=O.stylesheet.transition)}}),this.light=c,this.ambientLight=u,this.directionalLight=_,this.fog=S,b===null?delete this.terrain:this.terrain=b,this.camera=k||{"camera-projection":"perspective"},this.projection=A||{name:"mercator"},this.transition=i.e({},L_,P),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(c){let u=_=>{for(let b of _.fragments)u(b.style);c(_)};u(this)}_prioritizeTerrain(c,u,_){let b=c&&c.drapeRenderMode===0;return _===null?u&&u.drapeRenderMode===0?u:b?c:null:u!=null&&(!c||b||u&&u.drapeRenderMode===1)?u:c}mergeTerrain(){let c;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(u=>{c=this._prioritizeTerrain(c,u.terrain,u.stylesheet.terrain)}),c===null?delete this.terrain:this.terrain=c}mergeProjection(){let c;this.forEachFragmentStyle(u=>{u.stylesheet.projection!=null&&(c=u.stylesheet.projection)}),this.projection=c||{name:"mercator"}}mergeSources(){let c={},u={},_={};this.forEachFragmentStyle(b=>{for(let S in b._sourceCaches){let A=i.ag(S,b.scope);c[A]=b._sourceCaches[S]}for(let S in b._otherSourceCaches){let A=i.ag(S,b.scope);u[A]=b._otherSourceCaches[S]}for(let S in b._symbolSourceCaches){let A=i.ag(S,b.scope);_[A]=b._symbolSourceCaches[S]}}),this._mergedSourceCaches=c,this._mergedOtherSourceCaches=u,this._mergedSymbolSourceCaches=_}mergeLayers(){let c={},u=[],_={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(S=>{for(let A of S._order){let P=S._layers[A];if(P.type==="slot"){let k=i.c3(A);if(c[k])continue;c[k]=[]}P.slot&&c[P.slot]?c[P.slot].push(P):u.push(P)}}),this._mergedOrder=[];let b=(S=[])=>{for(let A of S)if(A.type==="slot"){let P=i.c3(A.id);c[P]&&b(c[P])}else{let P=i.ag(A.id,A.scope);this._mergedOrder.push(P),_[P]=A,A.is3D()&&(this._has3DLayers=!0),A.type==="circle"&&(this._hasCircleLayers=!0),A.type==="symbol"&&(this._hasSymbolLayers=!0)}};b(u),this._mergedLayers=_,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(c){return this.stylesheet.camera=i.e({},this.stylesheet.camera,c),this.camera=this.stylesheet.camera,this}setProjection(c){c?this.stylesheet.projection=c:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(c){this._spriteRequest=function(u,_,b){let S,A,P,k=i.f.devicePixelRatio>1?"@2x":"",O=i.g(_.transformRequest(_.normalizeSpriteURL(u,k,".json"),i.R.SpriteJSON),(q,X)=>{O=null,P||(P=q,S=X,U())}),z=i.d(_.transformRequest(_.normalizeSpriteURL(u,k,".png"),i.R.SpriteImage),(q,X)=>{z=null,P||(P=q,A=X,U())});function U(){if(P)b(P);else if(S&&A){let q=i.f.getImageData(A),X={};for(let Q in S){let{width:K,height:re,x:Y,y:ae,sdf:ge,pixelRatio:ce,stretchX:_e,stretchY:oe,content:ve}=S[Q],Ae=new i.h({width:K,height:re});i.h.copy(q,Ae,{x:Y,y:ae},{x:0,y:0},{width:K,height:re}),X[Q]={data:Ae,pixelRatio:ce,sdf:ge,stretchX:_e,stretchY:oe,content:ve}}b(null,X)}}return{cancel(){O&&(O.cancel(),O=null),z&&(z.cancel(),z=null)}}}(c,this.map._requestManager,(u,_)=>{if(this._spriteRequest=null,u)this.fire(new i.a(u));else if(_)for(let b in _)this.imageManager.addImage(b,this.scope,_[b]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.b("data",{dataType:"style"}))})}_validateLayer(c){let u=this.getOwnSource(c.source);if(!u)return;let _=c.sourceLayer;_&&(u.type==="geojson"||u.vectorLayerIds&&u.vectorLayerIds.indexOf(_)===-1)&&this.fire(new i.a(new Error(`Source layer "${_}" does not exist on source "${u.id}" as specified by style layer "${c.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(let c in this._sourceCaches)if(!this._sourceCaches[c].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded())return!1;for(let{style:c}of this.fragments)if(!c.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((c,u)=>{let _=this.fragments[u];return _&&_.style&&(c.data=_.style.serialize()),c})}_serializeSources(){let c={};for(let u in this._sourceCaches){let _=this._sourceCaches[u].getSource();c[_.id]||(c[_.id]=_.serialize())}return c}_serializeLayers(c){let u=[];for(let _ of c){let b=this._layers[_];b&&b.type!=="custom"&&u.push(b.serialize())}return u}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(let c in this._sourceCaches)if(this._sourceCaches[c].hasTransition())return!0;for(let c in this._layers)if(this._layers[c].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(c){return!!this.terrain&&(typeof c.isLayerDraped=="function"?c.isLayerDraped(this.getLayerSourceCache(c)):ky.has(c.type))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(c){let u=this.getOwnLayer(c);if(u)return u;this.fire(new i.a(new Error(`The layer '${c}' does not exist in the map's style.`)))}_checkSource(c){let u=this.getOwnSource(c);if(u)return u;this.fire(new i.a(new Error(`The source '${c}' does not exist in the map's style.`)))}update(c){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(c),this.directionalLight&&this.directionalLight.recalculate(c);let u=this.calculateLightsBrightness();c.brightness=u||0,u!==this._brightness&&(this._brightness=u,this.dispatcher.broadcast("setBrightness",u));let _=this._changes.isDirty();if(this._changes.isDirty()){let S=this._changes.getLayerUpdatesByScope();for(let A in S){let{updatedIds:P,removedIds:k}=S[A];(P||k)&&this._updateWorkerLayers(A,P,k)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(c),this.light&&this.light.updateTransitions(c),this.ambientLight&&this.ambientLight.updateTransitions(c),this.directionalLight&&this.directionalLight.updateTransitions(c),this.fog&&this.fog.updateTransitions(c),this._changes.reset()}let b={};for(let S in this._mergedSourceCaches){let A=this._mergedSourceCaches[S];b[S]=A.used,A.used=!1,A.tileCoverLift=0}for(let S of this._mergedOrder){let A=this._mergedLayers[S];if(A.recalculate(c,this._availableImages),!A.isHidden(c.zoom)){let P=this.getLayerSourceCache(A);P&&(P.used=!0,P.tileCoverLift=Math.max(P.tileCoverLift,A.tileCoverLift()))}if(!this._precompileDone&&this._shouldPrecompile)for(let P=A.minzoom||0;P<(A.maxzoom||25.5);P++){let k=this.map.painter;if(k){let O=A.getProgramIds();if(!O)continue;for(let z of O){let U=A.getDefaultProgramParams(z,c.zoom);U&&(k.style=this,this.fog&&(k._fogVisible=!0,U.overrideFog=!0,k.getOrCreateProgram(z,U)),k._fogVisible=!1,U.overrideFog=!1,k.getOrCreateProgram(z,U),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(U.overrideRtt=!0,k.getOrCreateProgram(z,U)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(let S in b){let A=this._mergedSourceCaches[S];b[S]!==A.used&&A.getSource().fire(new i.b("data",{sourceDataType:"visibility",dataType:"source",sourceId:A.getSource().id}))}this.light&&this.light.recalculate(c),this.terrain&&this.terrain.recalculate(c),this.fog&&this.fog.recalculate(c),this.z=c.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),_&&this.fire(new i.b("data",{dataType:"style"}))}_updateTilesForChangedImages(){let c=this._changes.getUpdatedImages();if(c.length){for(let u in this._sourceCaches)this._sourceCaches[u].reloadTilesForDependencies(["icons","patterns"],c);this._changes.resetUpdatedImages()}}_updateWorkerLayers(c,u,_){let b=this.getFragmentStyle(c);b&&this.dispatcher.broadcast("updateLayers",{layers:u?b._serializeLayers(u):[],scope:c,removedIds:_||[],options:b.options})}setState(c){if(this._checkLoaded(),Tc(this,be(c)))return!1;(c=i.c1(c)).layers=M_(c.layers);let u=function(b,S){if(!b)return[{command:jn.setStyle,args:[S]}];let A=[];try{if(!f(b.version,S.version))return[{command:jn.setStyle,args:[S]}];f(b.center,S.center)||A.push({command:jn.setCenter,args:[S.center]}),f(b.zoom,S.zoom)||A.push({command:jn.setZoom,args:[S.zoom]}),f(b.bearing,S.bearing)||A.push({command:jn.setBearing,args:[S.bearing]}),f(b.pitch,S.pitch)||A.push({command:jn.setPitch,args:[S.pitch]}),f(b.sprite,S.sprite)||A.push({command:jn.setSprite,args:[S.sprite]}),f(b.glyphs,S.glyphs)||A.push({command:jn.setGlyphs,args:[S.glyphs]}),f(b.imports,S.imports)||function(U=[],q=[],X){q=q||[];let Q=(U=U||[]).map(vc),K=q.map(vc),re=U.reduce(cp,{}),Y=q.reduce(cp,{}),ae=Q.slice(),ge,ce,_e,oe;for(ge=0,ce=0;ge<Q.length;ge++)_e=Q[ge],Y.hasOwnProperty(_e)?ce++:(X.push({command:jn.removeImport,args:[_e]}),ae.splice(ae.indexOf(_e,ce),1));for(ge=0,ce=0;ge<K.length;ge++)_e=K[K.length-1-ge],ae[ae.length-1-ge]!==_e&&(re.hasOwnProperty(_e)?(X.push({command:jn.removeImport,args:[_e]}),ae.splice(ae.lastIndexOf(_e,ae.length-ce),1)):ce++,oe=ae[ae.length-ge],X.push({command:jn.addImport,args:[Y[_e],oe]}),ae.splice(ae.length-ge,0,_e));for(let ve of q){let Ae=re[ve.id];Ae&&!f(Ae,ve)&&X.push({command:jn.updateImport,args:[ve.id,ve]})}}(b.imports,S.imports,A),f(b.transition,S.transition)||A.push({command:jn.setTransition,args:[S.transition]}),f(b.light,S.light)||A.push({command:jn.setLight,args:[S.light]}),f(b.fog,S.fog)||A.push({command:jn.setFog,args:[S.fog]}),f(b.projection,S.projection)||A.push({command:jn.setProjection,args:[S.projection]}),f(b.lights,S.lights)||A.push({command:jn.setLights,args:[S.lights]}),f(b.camera,S.camera)||A.push({command:jn.setCamera,args:[S.camera]});let P={},k=[];(function(U,q,X,Q){let K;for(K in q=q||{},U=U||{})U.hasOwnProperty(K)&&(q.hasOwnProperty(K)||Pf(K,X,Q));for(K in q){if(!q.hasOwnProperty(K))continue;let re=q[K];U.hasOwnProperty(K)?f(U[K],re)||(U[K].type==="geojson"&&re.type==="geojson"&&My(U,q,K)?X.push({command:jn.setGeoJSONSourceData,args:[K,re.data]}):Ty(K,q,X,Q)):Cd(K,q,X)}})(b.sources,S.sources,k,P);let O=[];b.layers&&b.layers.forEach(U=>{U.source&&P[U.source]?A.push({command:jn.removeLayer,args:[U.id]}):O.push(U)});let z=b.terrain;z&&P[z.source]&&(A.push({command:jn.setTerrain,args:[void 0]}),z=void 0),A=A.concat(k),f(z,S.terrain)||A.push({command:jn.setTerrain,args:[S.terrain]}),function(U,q,X){q=q||[];let Q=(U=U||[]).map(vc),K=q.map(vc),re=U.reduce(cp,{}),Y=q.reduce(cp,{}),ae=Q.slice(),ge=Object.create(null),ce,_e,oe,ve,Ae,Re,Oe;for(ce=0,_e=0;ce<Q.length;ce++)oe=Q[ce],Y.hasOwnProperty(oe)?_e++:(X.push({command:jn.removeLayer,args:[oe]}),ae.splice(ae.indexOf(oe,_e),1));for(ce=0,_e=0;ce<K.length;ce++)oe=K[K.length-1-ce],ae[ae.length-1-ce]!==oe&&(re.hasOwnProperty(oe)?(X.push({command:jn.removeLayer,args:[oe]}),ae.splice(ae.lastIndexOf(oe,ae.length-_e),1)):_e++,Re=ae[ae.length-ce],X.push({command:jn.addLayer,args:[Y[oe],Re]}),ae.splice(ae.length-ce,0,oe),ge[oe]=!0);for(ce=0;ce<K.length;ce++)if(oe=K[ce],ve=re[oe],Ae=Y[oe],!ge[oe]&&!f(ve,Ae))if(f(ve.source,Ae.source)&&f(ve["source-layer"],Ae["source-layer"])&&f(ve.type,Ae.type)){for(Oe in yc(ve.layout,Ae.layout,X,oe,null,jn.setLayoutProperty),yc(ve.paint,Ae.paint,X,oe,null,jn.setPaintProperty),f(ve.slot,Ae.slot)||X.push({command:jn.setSlot,args:[oe,Ae.slot]}),f(ve.filter,Ae.filter)||X.push({command:jn.setFilter,args:[oe,Ae.filter]}),f(ve.minzoom,Ae.minzoom)&&f(ve.maxzoom,Ae.maxzoom)||X.push({command:jn.setLayerZoomRange,args:[oe,Ae.minzoom,Ae.maxzoom]}),ve)ve.hasOwnProperty(Oe)&&Oe!=="layout"&&Oe!=="paint"&&Oe!=="filter"&&Oe!=="metadata"&&Oe!=="minzoom"&&Oe!=="maxzoom"&&Oe!=="slot"&&(Oe.indexOf("paint.")===0?yc(ve[Oe],Ae[Oe],X,oe,Oe.slice(6),jn.setPaintProperty):f(ve[Oe],Ae[Oe])||X.push({command:jn.setLayerProperty,args:[oe,Oe,Ae[Oe]]}));for(Oe in Ae)Ae.hasOwnProperty(Oe)&&!ve.hasOwnProperty(Oe)&&Oe!=="layout"&&Oe!=="paint"&&Oe!=="filter"&&Oe!=="metadata"&&Oe!=="minzoom"&&Oe!=="maxzoom"&&Oe!=="slot"&&(Oe.indexOf("paint.")===0?yc(ve[Oe],Ae[Oe],X,oe,Oe.slice(6),jn.setPaintProperty):f(ve[Oe],Ae[Oe])||X.push({command:jn.setLayerProperty,args:[oe,Oe,Ae[Oe]]}))}else X.push({command:jn.removeLayer,args:[oe]}),Re=ae[ae.lastIndexOf(oe)+1],X.push({command:jn.addLayer,args:[Ae,Re]})}(O,S.layers,A)}catch(P){console.warn("Unable to compute style diff:",P),A=[{command:jn.setStyle,args:[S]}]}return A}(this.serialize(),c).filter(b=>!(b.command in oh));if(u.length===0)return!1;let _=u.filter(b=>!(b.command in D_));if(_.length>0)throw new Error(`Unimplemented: ${_.map(b=>b.command).join(", ")}.`);return u.forEach(b=>{this[b.command].apply(this,b.args)}),this.stylesheet=c,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(c,u){return this.getImage(c)?this.fire(new i.a(new Error("An image with this name already exists."))):(this.imageManager.addImage(c,this.scope,u),this._afterImageUpdated(c),this)}updateImage(c,u){this.imageManager.updateImage(c,this.scope,u)}getImage(c){return this.imageManager.getImage(c,this.scope)}removeImage(c){return this.getImage(c)?(this.imageManager.removeImage(c,this.scope),this._afterImageUpdated(c),this):this.fire(new i.a(new Error("No image with this name exists.")))}_afterImageUpdated(c){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(c),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new i.b("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(c,u,_={}){return this._checkLoaded(),this._validate(ye,`models.${c}`,u,null,_)||(this.modelManager.addModel(c,u,this.scope),this._changes.setDirty()),this}hasModel(c){return this.modelManager.hasModel(c,this.scope)}removeModel(c){return this.hasModel(c)?(this.modelManager.removeModel(c,this.scope),this):this.fire(new i.a(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(c,u,_={}){if(this._checkLoaded(),this.getOwnSource(c)!==void 0)throw new Error(`There is already a source with ID "${c}".`);if(!u.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(u).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(u.type)>=0&&this._validate(_t,`sources.${c}`,u,null,_))return;this.map&&this.map._collectResourceTiming&&(u.collectResourceTiming=!0);let b=Ps(c,u,this.dispatcher,this);b.scope=this.scope,b.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(b.id),source:b.serialize(),sourceId:b.id}));let S=A=>{let P=(A?"symbol:":"other:")+b.id,k=i.ag(P,this.scope),O=this._sourceCaches[P]=new Ha(k,b,A);(A?this._symbolSourceCaches:this._otherSourceCaches)[b.id]=O,O.onAdd(this.map)};S(!1),u.type!=="vector"&&u.type!=="geojson"||S(!0),b.onAdd&&b.onAdd(this.map),_.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(c){this._checkLoaded();let u=this.getOwnSource(c);if(!u)throw new Error("There is no source with this ID");for(let b in this._layers)if(this._layers[b].source===c)return this.fire(new i.a(new Error(`Source "${c}" cannot be removed while layer "${b}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===c)return this.fire(new i.a(new Error(`Source "${c}" cannot be removed while terrain is using it.`)));let _=this.getOwnSourceCaches(c);for(let b of _){let S=i.c3(b.id);delete this._sourceCaches[S],this._changes.discardSourceCacheUpdate(b.id),b.fire(new i.b("data",{sourceDataType:"metadata",dataType:"source",sourceId:b.getSource().id})),b.setEventedParent(null),b.clearTiles()}return delete this._otherSourceCaches[c],delete this._symbolSourceCaches[c],this.mergeSources(),u.setEventedParent(null),u.onRemove&&u.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(c,u){this._checkLoaded(),this.getOwnSource(c).setData(u),this._changes.setDirty()}getOwnSource(c){let u=this.getOwnSourceCache(c);return u&&u.getSource()}getOwnSources(){let c=[];for(let u in this._otherSourceCaches){let _=this.getOwnSourceCache(u);_&&c.push(_.getSource())}return c}areTilesLoaded(){let c=this._mergedSourceCaches;for(let u in c){let _=c[u]._tiles;for(let b in _){let S=_[b];if(S.state!=="loaded"&&S.state!=="errored")return!1}}return!0}setLights(c){if(this._checkLoaded(),!c)return delete this.ambientLight,void delete this.directionalLight;let u=this._getTransitionParameters();for(let b of c){if(this._validate(ze,"lights",b))return;switch(b.type){case"ambient":if(this.ambientLight){let S=this.ambientLight;S.set(b),S.updateTransitions(u)}else this.ambientLight=new $n(b,fr,this.scope,this.options);break;case"directional":if(this.directionalLight){let S=this.directionalLight;S.set(b),S.updateTransitions(u)}else this.directionalLight=new $n(b,mr,this.scope,this.options)}}let _=new i.K(this.z||0,u);this.ambientLight&&this.ambientLight.recalculate(_),this.directionalLight&&this.directionalLight.recalculate(_),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){let c=this.directionalLight,u=this.ambientLight;if(!c||!u)return;let _=U=>.2126*(U[0]<=.03928?U[0]/12.92:Math.pow((U[0]+.055)/1.055,2.4))+.7152*(U[1]<=.03928?U[1]/12.92:Math.pow((U[1]+.055)/1.055,2.4))+.0722*(U[2]<=.03928?U[2]/12.92:Math.pow((U[2]+.055)/1.055,2.4)),b=c.properties.get("color").toArray01(),S=c.properties.get("intensity"),A=c.properties.get("direction"),P=1-i.bQ(A.x,A.y,A.z)[2]/90,k=_(b)*S*P,O=u.properties.get("color").toArray01(),z=u.properties.get("intensity");return(k+_(O)*z)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;let c=[];return this.directionalLight&&c.push(this.directionalLight.get()),this.ambientLight&&c.push(this.ambientLight.get()),c}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(c){if(!c)return this;if(i.c4(c)){let u=i.c5(c),_=this.fragments.find(({id:S})=>S===u);if(!_)throw new Error(`Style import not found: ${c}`);let b=i.c3(c);return _.style.getFragmentStyle(b)}{let u=this.fragments.find(({id:_})=>_===c);if(!u)throw new Error(`Style import not found: ${c}`);return u.style}}getConfigProperty(c,u){let _=this.getFragmentStyle(c);if(!_)return null;let b=i.ag(u,_.scope),S=_.options.get(b),A=S?S.value||S.default:null;return A?A.serialize():null}setConfigProperty(c,u,_){let b=i.r(_);if(b.result!=="success")return void Tc(this,b.value);let S=b.value.expression,A=this.getFragmentStyle(c);if(!A)return;let P=i.ag(u,A.scope),k=A.options.get(P);k&&(this.options.set(P,Ns(Ti({},k),{value:S})),this.updateConfigDependencies())}setConfig(c,u){if(this._config=c,c||u)if(u)for(let _ in u){let b,S,A=i.r(u[_].default);if(A.result==="success"&&(b=A.value.expression),c&&c[_]!==void 0){let q=i.r(c[_]);q.result==="success"&&(S=q.value.expression)}let{minValue:P,maxValue:k,stepValue:O,type:z,values:U}=u[_];if(b){let q=i.ag(_,this.scope);this.options.set(q,{default:b,value:S,minValue:P,maxValue:k,stepValue:O,type:z,values:U})}else this.fire(new i.a(new Error(`No schema defined for config option "${_}".`)))}else this.fire(new i.a(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(let c of this._configDependentLayers){let u=this.getLayer(c);u&&(u.possiblyEvaluateVisibility(),this._updateLayer(u))}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this._changes.setDirty()}addLayer(c,u,_={}){this._checkLoaded();let b=c.id;if(this._layers[b])return void this.fire(new i.a(new Error(`Layer with id "${b}" already exists on this map`)));let S;if(c.type==="custom"){if(Tc(this,i.c6(c)))return;S=i.c2(c,this.scope,this.options)}else{if(typeof c.source=="object"&&(this.addSource(b,c.source),c=i.c1(c),c=i.e(c,{source:b})),this._validate(Se,`layers.${b}`,c,{arrayIndex:-1},_))return;S=i.c2(c,this.scope,this.options),this._validateLayer(S),S.setEventedParent(this,{layer:{id:b}}),this._serializedLayers[S.id]=S.serialize()}S.isConfigDependent&&this._configDependentLayers.add(S.fqid);let A=this._order.length;if(u){let z=this._order.indexOf(u);if(z===-1)return void this.fire(new i.a(new Error(`Layer with id "${u}" does not exist on this map.`)));S.slot===this._layers[u].slot?A=z:i.w(`Layer with id "${u}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(A,0,b),this._layerOrderChanged=!0,this._layers[b]=S;let P=this.getOwnLayerSourceCache(S),k=!!this.directionalLight&&this.directionalLight.shadowsEnabled();P&&S.canCastShadows()&&k&&(P.castsShadows=!0);let O=this._changes.getRemovedLayer(S);if(O&&S.source&&P&&S.type!=="custom"){this._changes.discardLayerRemoval(S);let z=i.ag(S.source,S.scope);O.type!==S.type?this._changes.updateSourceCache(z,"clear"):(this._changes.updateSourceCache(z,"reload"),P.pause())}this._updateLayer(S),S.onAdd&&S.onAdd(this.map),S.scope=this.scope,this.mergeLayers()}moveLayer(c,u){this._checkLoaded();let _=this._checkLayer(c);if(!_||c===u)return;let b=this._order.indexOf(c);this._order.splice(b,1);let S=this._order.length;if(u){let A=this._order.indexOf(u);if(A===-1)return void this.fire(new i.a(new Error(`Layer with id "${u}" does not exist on this map.`)));_.slot===this._layers[u].slot?S=A:i.w(`Layer with id "${u}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(S,0,c),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(c){this._checkLoaded();let u=this._checkLayer(c);if(!u)return;u.setEventedParent(null);let _=this._order.indexOf(c);this._order.splice(_,1),delete this._layers[c],delete this._serializedLayers[c],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(u.fqid),this._changes.removeLayer(u);let b=this.getOwnLayerSourceCache(u);if(b&&b.castsShadows){let S=!1;for(let A in this._layers)if(this._layers[A].source===u.source&&this._layers[A].canCastShadows()){S=!0;break}b.castsShadows=S}u.onRemove&&u.onRemove(this.map),this.mergeLayers()}getOwnLayer(c){return this._layers[c]}hasLayer(c){return c in this._mergedLayers}hasLayerType(c){for(let u in this._layers)if(this._layers[u].type===c)return!0;return!1}setLayerZoomRange(c,u,_){this._checkLoaded();let b=this._checkLayer(c);b&&(b.minzoom===u&&b.maxzoom===_||(u!=null&&(b.minzoom=u),_!=null&&(b.maxzoom=_),this._updateLayer(b)))}setSlot(c,u){this._checkLoaded();let _=this._checkLayer(c);_&&_.slot!==u&&(_.slot=u,this._updateLayer(_))}setFilter(c,u,_={}){this._checkLoaded();let b=this._checkLayer(c);if(b&&!f(b.filter,u))return u==null?(b.filter=void 0,void this._updateLayer(b)):void(this._validate(He,`layers.${b.id}.filter`,u,{layerType:b.type},_)||(b.filter=i.c1(u),this._updateLayer(b)))}getFilter(c){let u=this._checkLayer(c);if(u)return i.c1(u.filter)}setLayoutProperty(c,u,_,b={}){this._checkLoaded();let S=this._checkLayer(c);if(S&&!f(S.getLayoutProperty(u),_)){if(_!=null&&(!b||b.validate!==!1)&&Tc(S,at.call(be,{key:`layers.${c}.layout.${u}`,layerType:S.type,objectKey:u,value:_,styleSpec:i.D,style:{glyphs:!0,sprite:!0}})))return;S.setLayoutProperty(u,_),S.isConfigDependent&&this._configDependentLayers.add(S.fqid),this._updateLayer(S)}}getLayoutProperty(c,u){let _=this._checkLayer(c);if(_)return _.getLayoutProperty(u)}setPaintProperty(c,u,_,b={}){this._checkLoaded();let S=this._checkLayer(c);if(!S||f(S.getPaintProperty(u),_)||_!=null&&(!b||b.validate!==!1)&&Tc(S,Ye.call(be,{key:`layers.${c}.paint.${u}`,layerType:S.type,objectKey:u,value:_,styleSpec:i.D})))return;let A=S.setPaintProperty(u,_);S.isConfigDependent&&this._configDependentLayers.add(S.fqid),A&&this._updateLayer(S),this._changes.updatePaintProperties(S)}getPaintProperty(c,u){let _=this._checkLayer(c);if(_)return _.getPaintProperty(u)}setFeatureState(c,u){this._checkLoaded();let _=c.source,b=c.sourceLayer,S=this._checkSource(_);if(!S)return;let A=S.type;if(A==="geojson"&&b)return void this.fire(new i.a(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(A==="vector"&&!b)return void this.fire(new i.a(new Error("The sourceLayer parameter must be provided for vector source types.")));c.id===void 0&&this.fire(new i.a(new Error("The feature id parameter must be provided.")));let P=this.getOwnSourceCaches(_);for(let k of P)k.setFeatureState(b,c.id,u)}removeFeatureState(c,u){this._checkLoaded();let _=c.source,b=this._checkSource(_);if(!b)return;let S=b.type,A=S==="vector"?c.sourceLayer:void 0;if(S==="vector"&&!A)return void this.fire(new i.a(new Error("The sourceLayer parameter must be provided for vector source types.")));if(u&&typeof c.id!="string"&&typeof c.id!="number")return void this.fire(new i.a(new Error("A feature id is required to remove its specific state property.")));let P=this.getOwnSourceCaches(_);for(let k of P)k.removeFeatureState(A,c.id,u)}getFeatureState(c){this._checkLoaded();let u=c.source,_=c.sourceLayer,b=this._checkSource(u);if(b){if(b.type!=="vector"||_)return c.id===void 0&&this.fire(new i.a(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(u)[0].getFeatureState(_,c.id);this.fire(new i.a(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(c){return this.stylesheet.transition=i.e({},this.stylesheet.transition,c),this.transition=this.stylesheet.transition,this}getTransition(){return i.e({},this.stylesheet.transition)}serialize(){this._checkLoaded();let c=this.getTerrain(),u=c&&this.terrain&&this.terrain.scope===this.scope?c:this.stylesheet.terrain;return i.c7({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:u,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},_=>_!==void 0)}_updateLayer(c){this._changes.updateLayer(c);let u=this.getLayerSourceCache(c),_=i.ag(c.source,c.scope),b=this._changes.getUpdatedSourceCaches();c.source&&!b[_]&&u&&u.getSource().type!=="raster"&&(this._changes.updateSourceCache(_,"reload"),u.pause()),c.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(c){let u=P=>this._mergedLayers[P].type==="fill-extrusion"||this._mergedLayers[P].type==="model",_=this.order,b={},S=[];for(let P=_.length-1;P>=0;P--){let k=_[P];if(u(k)){b[k]=P;for(let O of c){let z=O[k];if(z)for(let U of z)S.push(U)}}}S.sort((P,k)=>k.intersectionZ-P.intersectionZ);let A=[];for(let P=_.length-1;P>=0;P--){let k=_[P];if(u(k))for(let O=S.length-1;O>=0;O--){let z=S[O].feature;if(b[z.layer.id]<P)break;A.push(z),S.pop()}else for(let O of c){let z=O[k];if(z)for(let U of z)A.push(U.feature)}}return A}queryRenderedFeatures(c,u,_){u&&u.filter&&this._validate(He,"queryRenderedFeatures.filter",u.filter,null,u),u.scope=this.scope,u.availableImages=this._availableImages,u.serializedLayers=this._serializedLayers;let b={};if(u&&u.layers){if(!Array.isArray(u.layers))return this.fire(new i.a(new Error("parameters.layers must be an Array."))),[];for(let O of u.layers){let z=this._mergedLayers[O];if(!z)return this.fire(new i.a(new Error(`The layer '${O}' does not exist in the map's style and cannot be queried for features.`))),[];b[z.source]=!0}}let S=[],A=u.serializedLayers||{},P=u&&u.layers?u.layers.some(O=>{let z=this.getLayer(O);return z&&z.is3D()}):this.has3DLayers(),k=Mr.createFromScreenPoints(c,_);for(let O in this._mergedSourceCaches){let z=this._mergedSourceCaches[O].getSource();if(!z||z.scope!==u.scope)continue;let U=this._mergedSourceCaches[O].getSource().id;u.layers&&!b[U]||S.push(If(this._mergedSourceCaches[O],this._mergedLayers,A,k,u,_,P,!!this.map._showQueryGeometry))}return this.placement&&S.push(function(O,z,U,q,X,Q,K){let re={},Y=Q.queryRenderedSymbols(q),ae=[];for(let ge of Object.keys(Y).map(Number))ae.push(K[ge]);ae.sort(Q0);for(let ge of ae){let ce=ge.featureIndex.lookupSymbolFeatures(Y[ge.bucketInstanceId],z,ge.bucketIndex,ge.sourceLayerIndex,X.filter,X.layers,X.availableImages,O);for(let _e in ce){let oe=re[_e]=re[_e]||[],ve=ce[_e];ve.sort((Ae,Re)=>{let Oe=ge.featureSortOrder;if(Oe){let Je=Oe.indexOf(Ae.featureIndex);return Oe.indexOf(Re.featureIndex)-Je}return Re.featureIndex-Ae.featureIndex});for(let Ae of ve)oe.push(Ae)}}for(let ge in re)re[ge].forEach(ce=>{let _e=ce.feature,oe=U(O[ge]);if(!oe)return;let ve=oe.getFeatureState(_e.layer["source-layer"],_e.id);_e.source=_e.layer.source,_e.layer["source-layer"]&&(_e.sourceLayer=_e.layer["source-layer"]),_e.state=ve});return re}(this._mergedLayers,A,this.getLayerSourceCache.bind(this),k.screenGeometry,u,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(S)}querySourceFeatures(c,u){u&&u.filter&&this._validate(He,"querySourceFeatures.filter",u.filter,null,u);let _=this.getOwnSourceCaches(c),b=[];for(let S of _)b=b.concat(Dl(S,u));return b}addSourceType(c,u,_){return Wa.getSourceType(c)?_(new Error(`A source type called "${c}" already exists.`)):(Wa.setSourceType(c,u),u.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:c,url:u.workerSourceURL},_):_(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(c,u,_={}){this._checkLoaded();let b=this.light.getLight(),S=!1;for(let P in c)if(!f(c[P],b[P])){S=!0;break}if(!S)return;let A=this._getTransitionParameters();this.light.setLight(c,u,_),this.light.updateTransitions(A)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(c,u=1){if(this._checkLoaded(),!c)return this.terrainSetForDrapingOnly()&&u!==0||delete this.terrain,c===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let _=c,b=c.source==null;if(u===1){if(typeof _.source=="object"){let P="terrain-dem-src";this.addSource(P,_.source),_=i.c1(_),_=i.e(_,{source:P})}let S=i.e({},_),A={};if(this.terrain&&b){S.source=this.terrain.get().source;let P=this.terrain?this.getFragmentStyle(this.terrain.scope):null;P&&(A.style=P.serialize())}if(this._validate(te,"terrain",S,A))return}if(!this.terrain||this.terrain.scope!==this.scope&&!b||this.terrain&&u!==this.terrain.drapeRenderMode){if(!_)return;this._createTerrain(_,u),this.fire(new i.b("data",{dataType:"style"}))}else{let S=this.terrain,A=S.get();for(let P of Object.keys(i.D.terrain))!_.hasOwnProperty(P)&&i.D.terrain[P].default&&(_[P]=i.D.terrain[P].default);for(let P in c)if(!f(c[P],A[P])){S.set(c,this.options),this.stylesheet.terrain=c;let k=this._getTransitionParameters({duration:0});S.updateTransitions(k),this.fire(new i.b("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(c){let u=this.fog=new qi(c,this.map.transform,this.scope,this.options);this.stylesheet.fog=u.get();let _=this._getTransitionParameters({duration:0});u.updateTransitions(_)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(let c of this.map._markers)c._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(c){if(this._checkLoaded(),!c)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){let u=this.fog;if(!f(u.get(),c)){u.set(c,this.options),this.stylesheet.fog=u.get();let _=this._getTransitionParameters({duration:0});u.updateTransitions(_)}}else this._createFog(c);this._markersNeedUpdate=!0}_getTransitionParameters(c){return{now:i.f.now(),transition:i.e(this.transition,c)}}updateDrapeFirstLayers(){if(!this.terrain)return;let c=[],u=[];for(let _ in this._mergedLayers)this.isLayerDraped(this._mergedLayers[_])?c.push(_):u.push(_);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...c),this._drapedFirstOrder.push(...u)}_createTerrain(c,u){let _=this.terrain=new Mi(c,u,this.scope,this.options);u===1&&(this.stylesheet.terrain=c),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();let b=this._getTransitionParameters({duration:0});_.updateTransitions(b)}_force3DLayerUpdate(){for(let c in this._layers){let u=this._layers[c];u.type==="fill-extrusion"&&this._updateLayer(u)}}_forceSymbolLayerUpdate(){for(let c in this._layers){let u=this._layers[c];u.type==="symbol"&&this._updateLayer(u)}}_validate(c,u,_,b,S={}){if(S&&S.validate===!1)return!1;let A=i.e({},this.serialize());return Tc(this,c.call(be,i.e({key:u,style:A,value:_,styleSpec:i.D},b)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),i.c8.off("pluginStateChange",this._rtlTextPluginCallback);for(let c in this._mergedLayers)this._mergedLayers[c].setEventedParent(null);for(let c in this._mergedSourceCaches)this._mergedSourceCaches[c].clearTiles(),this._mergedSourceCaches[c].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(c){let u=this.getSourceCaches(c);for(let _ of u)_.clearTiles()}clearSources(){for(let c in this._mergedSourceCaches)this._mergedSourceCaches[c].clearTiles()}reloadSource(c){let u=this.getSourceCaches(c);for(let _ of u)_.resume(),_.reload()}reloadSources(){for(let c of this.getSources())c.reload&&c.reload()}updateSources(c){let u;this.directionalLight&&(u=gp(this.directionalLight));for(let _ in this._mergedSourceCaches)this._mergedSourceCaches[_].update(c,void 0,void 0,u)}_generateCollisionBoxes(){for(let c in this._sourceCaches){let u=this._sourceCaches[c];u.resume(),u.reload()}}_updatePlacement(c,u,_,b,S=!1){let A=!1,P=!1,k={},O={};for(let z of this._mergedOrder){let U=this._mergedLayers[z];if(U.type!=="symbol")continue;let q=i.ag(U.source,U.scope),X=k[q];if(!X){let K=this.getLayerSourceCache(U);if(!K)continue;let re=K.getRenderableIds(!0).map(Y=>K.getTileByID(Y));O[q]=re.slice(),X=k[q]=re.sort((Y,ae)=>ae.tileID.overscaledZ-Y.tileID.overscaledZ||(Y.tileID.isLessThan(ae.tileID)?-1:1))}let Q=this.crossTileSymbolIndex.addLayer(U,X,c.center.lng,c.projection);A=A||Q}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),S=S||this._layerOrderChanged||_===0,this._layerOrderChanged&&this.fire(new i.b("neworder")),(S||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(i.f.now(),c.zoom))&&(this.pauseablePlacement=new pp(c,this._mergedOrder,S,u,_,b,this.placement,this.fog&&c.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,k,O),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(i.f.now()),P=!0),A&&this.pauseablePlacement.placement.setStale()),P||A){this._buildingIndex.onNewFrame(c.zoom);for(let z of this._mergedOrder){let U=this._mergedLayers[z];U.type==="symbol"&&this.placement.updateLayerOpacities(U,k[i.ag(U.source,U.scope)])}}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(i.f.now())}_releaseSymbolFadeTiles(){for(let c in this._sourceCaches)this._sourceCaches[c].releaseSymbolFadeTiles()}addImport(c,u){this._checkLoaded();let _=this.stylesheet.imports=this.stylesheet.imports||[];if(_.findIndex(({id:S})=>S===c.id)!==-1)return this.fire(new i.a(new Error(`Import with id '${c.id}' already exists in the map's style.`)));if(!u)return _.push(c),this._loadImports([c],!0),this;let b=_.findIndex(({id:S})=>S===u);return b===-1?this.fire(new i.a(new Error(`Import with id "${u}" does not exist on this map.`))):(this.stylesheet.imports=_.slice(0,b).concat(c).concat(_.slice(b)),this._loadImports([c],!0,u),this)}updateImport(c,u){this._checkLoaded();let _=this.stylesheet.imports||[],b=this.getImportIndex(c);return b===-1?this:typeof u=="string"?(this.setImportUrl(c,u),this):(u.url&&u.url!==_[b].url&&this.setImportUrl(c,u.url),f(u.config,_[b].config)||this.setImportConfig(c,u.config),f(u.data,_[b].data)||this.setImportData(c,u.data),this)}moveImport(c,u){this._checkLoaded();let _=this.stylesheet.imports||[],b=this.getImportIndex(c);if(b===-1)return this;let S=this.getImportIndex(u);if(S===-1)return this;let A=_[b],P=this.fragments[b];return _=_.filter(({id:k})=>k!==c),this.fragments=this.fragments.filter(({id:k})=>k!==c),this.stylesheet.imports=_.slice(0,S).concat(A).concat(_.slice(S)),this.fragments=this.fragments.slice(0,S).concat(P).concat(this.fragments.slice(S)),this.mergeLayers(),this}setImportUrl(c,u){this._checkLoaded();let _=this.stylesheet.imports||[],b=this.getImportIndex(c);if(b===-1)return this;_[b].url=u;let S=this.fragments[b];return S.style=this._createFragmentStyle(_[b]),S.style.on("style.import.load",()=>this.mergeAll()),S.style.loadURL(u),this}setImportData(c,u){this._checkLoaded();let _=this.getImportIndex(c),b=this.stylesheet.imports||[];return _===-1?this:u?(this.fragments[_].style.setState(u),this._reloadImports(),this):(delete b[_].data,this.setImportUrl(c,b[_].url))}setImportConfig(c,u){this._checkLoaded();let _=this.getImportIndex(c),b=this.stylesheet.imports||[];if(_===-1)return this;u?b[_].config=u:delete b[_].config;let S=this.fragments[_],A=S.style.stylesheet&&S.style.stylesheet.schema;return S.config=u,S.style.setConfig(u,A),this.updateConfigDependencies(),this}removeImport(c){this._checkLoaded();let u=this.stylesheet.imports||[],_=this.getImportIndex(c);return _===-1||(u.splice(_,1),this.fragments[_].style._remove(),this.fragments.splice(_,1),this._reloadImports()),this}getImportIndex(c){let u=(this.stylesheet.imports||[]).findIndex(_=>_.id===c);return u===-1&&this.fire(new i.a(new Error(`Import '${c}' does not exist in the map's style and cannot be updated.`))),u}getLayer(c){return this._mergedLayers[c]}getSources(){let c=[];for(let u in this._mergedOtherSourceCaches){let _=this._mergedOtherSourceCaches[u];_&&c.push(_.getSource())}return c}getSource(c,u){let _=this.getSourceCache(c,u);return _&&_.getSource()}getLayerSource(c){let u=this.getLayerSourceCache(c);return u&&u.getSource()}getSourceCache(c,u){let _=i.ag(c,u);return this._mergedOtherSourceCaches[_]}getLayerSourceCache(c){let u=i.ag(c.source,c.scope);return c.type==="symbol"?this._mergedSymbolSourceCaches[u]:this._mergedOtherSourceCaches[u]}getSourceCaches(c){let u=[];return this._mergedOtherSourceCaches[c]&&u.push(this._mergedOtherSourceCaches[c]),this._mergedSymbolSourceCaches[c]&&u.push(this._mergedSymbolSourceCaches[c]),u}updateSourceCaches(){let c=this._changes.getUpdatedSourceCaches();for(let u in c){let _=c[u];_==="reload"?this.reloadSource(u):_==="clear"&&this.clearSource(u)}}updateLayers(c){let u=this._changes.getUpdatedPaintProperties();for(let _ of u){let b=this.getLayer(_);b&&b.updateTransitions(c)}}getImages(c,u,_){this.imageManager.getImages(u.icons,u.scope,_),this._updateTilesForChangedImages();let b=S=>{S&&S.setDependencies(u.tileID.key,u.type,u.icons)};b(this._otherSourceCaches[u.source]),b(this._symbolSourceCaches[u.source])}getGlyphs(c,u,_){this.glyphManager.getGlyphs(u.stacks,u.scope,_)}getResource(c,u,_){return i.c9(u,_)}getOwnSourceCache(c){return this._otherSourceCaches[c]}getOwnLayerSourceCache(c){return c.type==="symbol"?this._symbolSourceCaches[c.source]:this._otherSourceCaches[c.source]}getOwnSourceCaches(c){let u=[];return this._otherSourceCaches[c]&&u.push(this._otherSourceCaches[c]),this._symbolSourceCaches[c]&&u.push(this._symbolSourceCaches[c]),u}_isSourceCacheLoaded(c){let u=this.getOwnSourceCaches(c);return u.length===0?(this.fire(new i.a(new Error(`There is no source with ID '${c}'`))),!1):u.every(_=>_.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(c=>{c.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Wa.getSourceType=function(g){return kl[g]},Wa.setSourceType=function(g,c){kl[g]=c},Wa.registerForPluginStateChange=i.bV;var _p=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,yp=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}`,vp=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,xp="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Kf=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,Qf=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,F_=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,ah=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,lh=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform vec2 u_velocity_res;uniform float u_max_speed;const vec2 INVALID_VELOCITY=vec2(-1);uniform vec2 u_texture_offset;uniform float u_data_offset;uniform vec4 u_data_scale;vec2 lookup_velocity(vec2 uv) {uv=u_texture_offset.x+u_texture_offset.y*uv;vec2 fxy;ivec4 c=_raTexLinearCoord(uv,u_velocity_res,fxy);vec4 tl=texelFetch(u_velocity,c.yz,0);vec4 tr=texelFetch(u_velocity,c.xz,0);vec4 bl=texelFetch(u_velocity,c.yw,0);vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NODATA) {return INVALID_VELOCITY;}if (tr==NODATA) {return INVALID_VELOCITY;}if (bl==NODATA) {return INVALID_VELOCITY;}if (br==NODATA) {return INVALID_VELOCITY;}vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);
#ifdef DATA_FORMAT_UINT32
vec2 velocity=vec2(u_data_offset+dot(t,u_data_scale),0);return velocity;
#else
vec2 velocity=vec2(u_data_offset+dot(t.rg,u_data_scale.yx),-(u_data_offset+dot(t.ba,u_data_scale.yx)));
#endif
return velocity/max(u_max_speed,length(velocity));}
#endif`,em=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,zd=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;let ch=[];Mc(_p,ch),Mc(vp,ch),Mc(yp,ch);let ra={"_prelude_fog.vertex.glsl":Qf,"_prelude_terrain.vertex.glsl":Kf,"_prelude_shadow.vertex.glsl":em,"_prelude_fog.fragment.glsl":F_,"_prelude_shadow.fragment.glsl":zd,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":ah,"_prelude_raster_particle.glsl":lh},hh={};Jn("",Kf),Jn(F_,Qf),Jn(zd,em),Jn(ah,""),Jn(lh,"");let tm=Jn(yp,vp),bp=_p;var im={background:Jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Jn("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Jn(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Jn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Jn("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Jn("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Jn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
uniform float u_emissive_strength;in float v_height;void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=max(0.01,cutoff_opacity(u_cutoff_params,ground.z));if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff < 0.01 && centroid_pos.x !=0.0));gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Jn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Jn(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Jn(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Jn(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float pattern_x=v_linesofar/pattern_size.x*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;vec2 uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
vec2 uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Jn("precision highp float;uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`precision highp float;
#include "_prelude_raster_array.glsl"
#include "_prelude_raster_particle.glsl"
in vec3 a_pos;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {vec2 pos=a_pos.xy+u_tile_offset;vec2 tex_coords=fract(pos);gl_PointSize=1.0;vec2 velocity=lookup_velocity(tex_coords);if (velocity==INVALID_VELOCITY) {v_particle_speed=0.0;gl_Position=vec4(2.0,2.0,2.0,1.0);} else {v_particle_speed=length(velocity);gl_Position=vec4(2.0*pos-vec2(1.0),0.0,1.0);}}`),rasterParticleTexture:Jn("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {v_tex_pos=0.5*a_pos+vec2(0.5);gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Jn("void main() {}",`#include "_prelude_raster_array.glsl"
#include "_prelude_raster_particle.glsl"
in vec3 a_pos;uniform float u_speed_factor;uniform float u_lifetime_delta;uniform float u_rand_seed;out vec3 v_new_particle;const vec3 rand_constants=vec3(12.9898,78.233,4375.85453);float rand(const vec2 co) {float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {float lifetime=a_pos.z;vec2 pos=a_pos.xy;vec2 uv=clamp(pos,vec2(0.0),vec2(1.0));vec2 velocity=lookup_velocity(uv);float next_lifetime=lifetime-u_lifetime_delta;float t=step(0.0,next_lifetime);
#ifdef DATA_FORMAT_UINT32
vec2 dp=vec2(0);
#else
vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;
#endif
vec2 seed=pos*u_rand_seed;vec2 next_pos=pos+dp;vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));v_new_particle=vec3(
vec2(mix(random_pos,next_pos,t)),mix(1.0,next_lifetime,t)
);}`),symbolIcon:Jn(`#include "_prelude_lighting.glsl"
uniform sampler2D u_texture;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
in float v_fade_opacity;in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
uniform mediump float u_icon_saturation;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
lowp float alpha=opacity*v_fade_opacity;vec4 out_color;
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b)*alpha;
#else
out_color=texture(u_texture,v_tex_a)*alpha;
#endif
#ifdef SATURATION
vec3 luma=vec3(dot(out_color.rgb,vec3(0.2126,0.7152,0.0722)));out_color.rgb=mix(luma,out_color.rgb,u_icon_saturation);
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
v_tex_a=a_tex/u_texsize;
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
v_fade_opacity=out_fade_opacity;}`),symbolSDF:Jn(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}`),symbolTextAndIcon:Jn(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}`),terrainRaster:Jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Jn("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Jn(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,xp),skyboxGradient:Jn(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,xp),skyboxCapture:Jn(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Jn(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
return vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=local_pos;
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1);v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Jn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Jn(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`)};function Mc(g,c){let u=g.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let _ of u)if(_=_.trim(),_[0]==="#"&&_.includes("if")&&!_.includes("endif")){_=_.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();let b=_.split(" ");for(let S of b)c.includes(S)||c.push(S)}}function Jn(g,c){let u=/#include\s+"([^"]+)"/g,_=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,b=c.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);b&&(b=b.map(O=>{let z=O.split(" ");return z[z.length-1]}),b=[...new Set(b)]);let S={},A=[],P=[];if(g=g.replace(u,(O,z)=>(P.push(z),"")),(c=c.replace(u,(O,z)=>(A.push(z),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let k=[...ch];Mc(g,k),Mc(c,k);for(let O of[...A,...P])ra[O]||console.error(`Undefined include: ${O}`),hh[O]||(hh[O]=[],Mc(ra[O],hh[O])),k=[...k,...hh[O]];return{fragmentSource:g=g.replace(_,(O,z,U,q,X)=>(S[X]=!0,z==="define"?`
#ifndef HAS_UNIFORM_u_${X}
in ${U} ${q} ${X};
#else
uniform ${U} ${q} u_${X};
#endif
`:z==="initialize"?`
#ifdef HAS_UNIFORM_u_${X}
    ${U} ${q} ${X} = u_${X};
#endif
`:z==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${X}
    in ${U} ${q} ${X};
#endif
`:z==="initialize-attribute"?"":void 0)),vertexSource:c=c.replace(_,(O,z,U,q,X)=>{let Q=q==="float"?"vec2":q,K=X.match(/color/)?"color":Q;return z==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${X}
in ${U} ${q} a_${X};
#endif
`:S[X]?z==="define"?`
#ifndef HAS_UNIFORM_u_${X}
uniform lowp float u_${X}_t;
in ${U} ${Q} a_${X};
out ${U} ${q} ${X};
#else
uniform ${U} ${q} u_${X};
#endif
`:z==="initialize"?K==="vec4"?`
#ifndef HAS_UNIFORM_u_${X}
    ${X} = a_${X};
#else
    ${U} ${q} ${X} = u_${X};
#endif
`:`
#ifndef HAS_UNIFORM_u_${X}
    ${X} = unpack_mix_${K}(a_${X}, u_${X}_t);
#else
    ${U} ${q} ${X} = u_${X};
#endif
`:z==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${X}
    in ${U} ${q} a_${X};
    out ${U} ${q} ${X};
#endif
`:z==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${X}
    ${X} = a_${X};
#endif
`:void 0:z==="define"?`
#ifndef HAS_UNIFORM_u_${X}
uniform lowp float u_${X}_t;
in ${U} ${Q} a_${X};
#else
uniform ${U} ${q} u_${X};
#endif
`:z==="define-instanced"?K==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${X}0;
in vec4 a_${X}1;
in vec4 a_${X}2;
in vec4 a_${X}3;
#else
uniform ${U} ${q} u_${X};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${U} ${Q} a_${X};
#else
uniform ${U} ${q} u_${X};
#endif
`:z==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${X}
    ${U} ${q} ${X} = a_${X};
#endif
`:K==="vec4"?`
#ifndef HAS_UNIFORM_u_${X}
    ${U} ${q} ${X} = a_${X};
#else
    ${U} ${q} ${X} = u_${X};
#endif
`:`
#ifndef HAS_UNIFORM_u_${X}
    ${U} ${q} ${X} = unpack_mix_${K}(a_${X}, u_${X}_t);
#else
    ${U} ${q} ${X} = u_${X};
#endif
`}),staticAttributes:b,usedDefines:k,vertexIncludes:A,fragmentIncludes:P}}class nm{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(c,u,_,b,S,A,P,k){this.context=c;let O=this.boundPaintVertexBuffers.length!==b.length;for(let U=0;!O&&U<b.length;U++)this.boundPaintVertexBuffers[U]!==b[U]&&(O=!0);let z=this.boundDynamicVertexBuffers.length!==P.length;for(let U=0;!z&&U<P.length;U++)this.boundDynamicVertexBuffers[U]!==P[U]&&(z=!0);if(!this.vao||this.boundProgram!==u||this.boundLayoutVertexBuffer!==_||O||z||this.boundIndexBuffer!==S||this.boundVertexOffset!==A)this.freshBind(u,_,b,S,A,P,k);else{c.bindVertexArrayOES.set(this.vao);for(let U of P)U&&(U.bind(),k&&U.instanceCount&&U.setVertexAttribDivisor(c.gl,u,k));S&&S.dynamicDraw&&S.bind()}}freshBind(c,u,_,b,S,A,P){let k=c.numAttributes,O=this.context,z=O.gl;this.vao&&this.destroy(),this.vao=O.gl.createVertexArray(),O.bindVertexArrayOES.set(this.vao),this.boundProgram=c,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=b,this.boundVertexOffset=S,this.boundDynamicVertexBuffers=A,u.enableAttributes(z,c),u.bind(),u.setVertexAttribPointers(z,c,S);for(let U of _)U.enableAttributes(z,c),U.bind(),U.setVertexAttribPointers(z,c,S);for(let U of A)U&&(U.enableAttributes(z,c),U.bind(),U.setVertexAttribPointers(z,c,S),P&&U.instanceCount&&U.setVertexAttribDivisor(z,c,P));b&&b.bind(),O.currentNumAttributes=k}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Dy(g,c){let u=Math.pow(2,c.canonical.z),_=c.canonical.y;return[new i.L(0,_/u).toLngLat().lat,new i.L(0,(_+1)/u).toLngLat().lat]}function wp(g,c,u,_,b,S,A){let P=g.context,k=P.gl,O=u.hillshadeFBO;if(!O)return;g.prepareDrawTile();let z=g.isTileAffectedByFog(c),U=g.getOrCreateProgram("hillshade",{overrideFog:z});P.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,O.colorAttachment.get());let q=((re,Y,ae,ge)=>{let ce=ae.paint.get("hillshade-shadow-color"),_e=ae.paint.get("hillshade-highlight-color"),oe=ae.paint.get("hillshade-accent-color"),ve=ae.paint.get("hillshade-emissive-strength"),Ae=i.bj(ae.paint.get("hillshade-illumination-direction"));if(ae.paint.get("hillshade-illumination-anchor")==="viewport")Ae-=re.transform.angle;else if(re.style&&re.style.enable3dLights()&&re.style.directionalLight){let Oe=re.style.directionalLight.properties.get("direction"),Je=i.bQ(Oe.x,Oe.y,Oe.z);Ae=i.bj(Je[1])}let Re=!re.options.moving;return{u_matrix:ge||re.transform.calculateProjMatrix(Y.tileID.toUnwrapped(),Re),u_image:0,u_latrange:Dy(0,Y.tileID),u_light:[ae.paint.get("hillshade-exaggeration"),Ae],u_shadow:ce,u_highlight:_e,u_emissive_strength:ve,u_accent:oe}})(g,u,_,g.terrain?c.projMatrix:null);g.uploadCommonUniforms(P,U,c.toUnwrapped());let{tileBoundsBuffer:X,tileBoundsIndexBuffer:Q,tileBoundsSegments:K}=g.getTileBoundsBuffers(u);U.draw(g,k.TRIANGLES,b,S,A,Di.disabled,q,_.id,X,Q,K)}function O_(g,c,u){if(!c.needsDEMTextureUpload)return;let _=g.context,b=_.gl;_.pixelStoreUnpackPremultiplyAlpha.set(!1),c.demTexture=c.demTexture||g.getTileTexture(u.stride);let S=u.getPixels();c.demTexture?c.demTexture.update(S,{premultiply:!1}):c.demTexture=new i.T(_,S,b.R32F,{premultiply:!1}),c.needsDEMTextureUpload=!1}function rm(g,c,u){let _=g.context,b=_.gl;if(!c.dem)return;let S=c.dem;if(_.activeTexture.set(b.TEXTURE1),O_(g,c,S),!c.demTexture)return;c.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE);let A=S.dim;_.activeTexture.set(b.TEXTURE0);let P=c.hillshadeFBO;if(!P){let q=new i.T(_,{width:A,height:A,data:null},b.RGBA);q.bind(b.LINEAR,b.CLAMP_TO_EDGE),P=c.hillshadeFBO=_.createFramebuffer(A,A,!0,"renderbuffer"),P.colorAttachment.set(q.texture)}_.bindFramebuffer.set(P.framebuffer),_.viewport.set([0,0,A,A]);let{tileBoundsBuffer:k,tileBoundsIndexBuffer:O,tileBoundsSegments:z}=g.getMercatorTileBoundsBuffers(),U=[];g.linearFloatFilteringSupported()&&U.push("TERRAIN_DEM_FLOAT_FORMAT"),g.getOrCreateProgram("hillshadePrepare",{defines:U}).draw(g,b.TRIANGLES,ki.disabled,tn.disabled,Mn.unblended,Di.disabled,((q,X)=>{let Q=X.stride,K=i.a6.create();return i.a6.ortho(K,0,i.V,-i.V,0,0,1),i.a6.translate(K,K,[0,-i.V,0]),{u_matrix:K,u_image:1,u_dimension:[Q,Q],u_zoom:q.overscaledZ}})(c.tileID,S),u.id,k,O,z),c.needsHillshadePrepare=!1}let N_=g=>({u_matrix:new i.bK(g),u_image0:new i.bO(g),u_skirt_height:new i.bN(g),u_ground_shadow_factor:new i.bM(g)}),Sp=(g,c,u)=>({u_matrix:g,u_image0:0,u_skirt_height:c,u_ground_shadow_factor:u}),z_=(g,c,u,_,b,S,A,P,k,O,z,U,q,X,Q,K)=>({u_proj_matrix:Float32Array.from(g),u_globe_matrix:c,u_normalize_matrix:Float32Array.from(_),u_merc_matrix:u,u_zoom_transition:b,u_merc_center:S,u_image0:0,u_frustum_tl:A,u_frustum_tr:P,u_frustum_br:k,u_frustum_bl:O,u_globe_pos:z,u_globe_radius:U,u_viewport:q,u_grid_matrix:K?Float32Array.from(K):new Float32Array(9),u_skirt_height:X,u_far_z_cutoff:Q});function Bd(g,c){return g!=null&&c!=null&&!(!g.hasData()||!c.hasData())&&g.demTexture!=null&&c.demTexture!=null&&g.tileID.key!==c.tileID.key}let dh=new class{constructor(){this.operations={}}newMorphing(g,c,u,_,b){if(g in this.operations){let S=this.operations[g];S.to.tileID.key!==u.tileID.key&&(S.queued=u)}else this.operations[g]={startTime:_,phase:0,duration:b,from:c,to:u,queued:null}}getMorphValuesForProxy(g){if(!(g in this.operations))return null;let c=this.operations[g];return{from:c.from,to:c.to,phase:c.phase}}update(g){for(let c in this.operations){let u=this.operations[c];for(u.phase=(g-u.startTime)/u.duration;u.phase>=1||!this._validOp(u);)if(!this._nextOp(u,g)){delete this.operations[c];break}}}_nextOp(g,c){return!!g.queued&&(g.from=g.to,g.to=g.queued,g.queued=null,g.phase=0,g.startTime=c,!0)}_validOp(g){return g.from.hasData()&&g.to.hasData()}},sm={0:null,1:"TERRAIN_VERTEX_MORPHING"};function om(g,c,u){if(c===0)return 0;let _=c<1&&u===514?.25/c:1;return 6*Math.pow(1.5,22-g)*Math.max(c,1)*_}function uh(g,c){let u=1<<g.z;return!c&&(g.x===0||g.x===u-1)||g.y===0||g.y===u-1}let am=g=>({u_matrix:g});function lm(g,c,u,_,b){if(b>0){let S=i.f.now(),A=(S-g.timeAdded)/b,P=c?(S-c.timeAdded)/b:-1,k=u.getSource(),O=_.coveringZoomLevel({tileSize:k.tileSize,roundZoom:k.roundZoom}),z=!c||Math.abs(c.tileID.overscaledZ-O)>Math.abs(g.tileID.overscaledZ-O),U=z&&g.refreshedUponExpiration?1:i.aa(z?A:1-P,0,1);return g.refreshedUponExpiration&&A>=1&&(g.refreshedUponExpiration=!1),c?{opacity:1,mix:1-U}:{opacity:U,mix:0}}return{opacity:1,mix:0}}class Ly extends Ha{constructor(c){let u={type:"raster-dem",maxzoom:c.transform.maxZoom},_=new i.bW(i.bX(),null),b=Ps("mock-dem",u,_,c.style);super("mock-dem",b,!1),b.setEventedParent(this),this._sourceLoaded=!0}_loadTile(c,u){c.state="loaded",u(null)}}class Fy extends Ha{constructor(c){let u=Ps("proxy",{type:"geojson",maxzoom:c.transform.maxZoom},new i.bW(i.bX(),null),c.style);super("proxy",u,!1),u.setEventedParent(this),this.map=this.getSource().map=c,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(c,u,_){if(c.freezeTileCoverage)return;this.transform=c;let b=c.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((S,A)=>{if(S[A.key]="",!this._tiles[A.key]){let P=new _c(A,this._source.tileSize*A.overscaleFactor(),c.tileZoom);P.state="loaded",this._tiles[A.key]=P}return S},{});for(let S in this._tiles)S in b||(this.freeFBO(S),this._tiles[S].unloadVectorData(),delete this._tiles[S])}freeFBO(c){let u=this.proxyCachedFBO[c];if(u!==void 0){let _=Object.values(u);this.renderCachePool.push(..._),delete this.proxyCachedFBO[c]}}deallocRenderCache(){this.renderCache.forEach(c=>c.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class B_ extends i.am{constructor(c,u,_){super(c.overscaledZ,c.wrap,c.canonical.z,c.canonical.x,c.canonical.y),this.proxyTileKey=u,this.projMatrix=_}}class Oy extends i.ck{constructor(c,u){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},c.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),c.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),c.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=c,this.terrainTileForTile={},this.prevTerrainTileForTile={};let[_,b,S]=function(k){let O=new i.aN,z=new i.aw,U=131;O.reserve(17161),z.reserve(33800);let q=i.V/128,X=i.V+q/2,Q=X+q;for(let re=-q;re<Q;re+=q)for(let Y=-q;Y<Q;Y+=q){let ae=Y<0||Y>X||re<0||re>X?24575:0,ge=i.aa(Math.round(Y),0,i.V),ce=i.aa(Math.round(re),0,i.V);O.emplaceBack(ge+ae,ce)}let K=(re,Y)=>{let ae=Y*U+re;z.emplaceBack(ae+1,ae,ae+U),z.emplaceBack(ae+U,ae+U+1,ae+1)};for(let re=1;re<129;re++)for(let Y=1;Y<129;Y++)K(Y,re);return[0,129].forEach(re=>{for(let Y=0;Y<130;Y++)K(Y,re),K(re,Y)}),[O,z,32768]}(),A=c.context;this.gridBuffer=A.createVertexBuffer(_,i.aP.members),this.gridIndexBuffer=A.createIndexBuffer(b),this.gridSegments=i.aB.simpleSegment(0,0,_.length,b.length),this.gridNoSkirtSegments=i.aB.simpleSegment(0,0,_.length,S),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Fy(u.map),this.orthoMatrix=i.a6.create(),i.a6.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,i.V,0,i.V,0,1);let P=A.gl;this._overlapStencilMode=new tn({func:P.GEQUAL,mask:255},0,255,P.KEEP,P.KEEP,P.REPLACE),this._previousZoom=c.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=u,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Ly(u.map),this._pendingGroundEffectLayers=[]}set style(c){c.on("data",this._onStyleDataEvent.bind(this)),this._style=c,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(c,u,_){if(c&&c.terrain){this._style!==c&&(this.style=c,this._evaluationZoom=void 0);let b=c.terrain.properties,S=c.terrain.drapeRenderMode===0,A=c.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=i.f.now();let P=c.terrain&&c.terrain.scope,k=b.get("source"),O=S?this._mockSourceCache:c.getSourceCache(k,P);if(!O)return void i.w(`Couldn't find terrain source "${k}".`);if(this.sourceCache=O,this._exaggeration=A?this.calculateExaggeration(u):b.get("exaggeration"),!u.projection.requiresDraping&&A&&this._exaggeration===0)return void this._disable();this.enabled=!0;let z=()=>{this.sourceCache.used&&i.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);let U=this.getScaledDemTileSize();this.sourceCache.update(u,U,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,z(),this._initializing=!0),z(),u.updateElevation(!0,_),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(u),this._emptyDEMTextureDirty=!0,this._previousZoom=u.zoom}else this._disable()}calculateExaggeration(c){let u=this._previousCameraAltitude,_=c.getFreeCameraOptions().position.z/c.pixelsPerMeter*c.worldSize;this._previousCameraAltitude=_;let b=u!=null?_-u:Number.MAX_VALUE;if(Math.abs(b)<2)return this._exaggeration;let S=c.zoom,A=this._style.terrain;if(!this._previousUpdateTimestamp)return A.getExaggeration(S);let P=S-this._previousZoom,k=this._previousUpdateTimestamp,O=S;this._evaluationZoom!=null&&(O=this._evaluationZoom,Math.abs(S-O)>.5&&(P=.5*(S-O+P)),P*b<0&&(O+=P)),this._evaluationZoom=O;let z=A.getExaggeration(O),U=z===A.getExaggeration(Math.max(0,O-.1));if(U&&Math.abs(z-this._exaggeration)<.01)return z;let q=Math.min(.1,.00375*(this._updateTimestamp-k));return(U||z<.1||Math.abs(P)<1e-4)&&(q=Math.min(.2,4*q)),i.U(this._exaggeration,z,q)}resetTileLookupCache(c){this._findCoveringTileCache[c]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(c){c.coord&&c.dataType==="source"?this._clearRenderCacheForTile(c.sourceCacheId,c.coord):c.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(let c in this._style._mergedSourceCaches)this._style._mergedSourceCaches[c].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(c=>c.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){let c=2*this.proxySourceCache.getSource().tileSize;return[c,c]}set useVertexMorphing(c){this._useVertexMorphing=c}updateTileBinding(c){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;let u=this.proxySourceCache,_=this.painter.transform;this._initializing&&(this._initializing=_._centerAltitude===0&&this.getAtPointOrZero(i.L.fromLngLat(_.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);let b=this.proxyCoords=u.getIds().map(k=>{let O=u.getTileByID(k).tileID;return O.projMatrix=_.calculateProjMatrix(O.toUnwrapped()),O});(function(k,O){let z=O.transform.pointCoordinate(O.transform.getCameraPoint()),U=new i.P(z.x,z.y);k.sort((q,X)=>{if(X.overscaledZ-q.overscaledZ)return X.overscaledZ-q.overscaledZ;let Q=new i.P(q.canonical.x+(1<<q.canonical.z)*q.wrap,q.canonical.y),K=new i.P(X.canonical.x+(1<<X.canonical.z)*X.wrap,X.canonical.y),re=U.mult(1<<q.canonical.z);return re.x-=.5,re.y-=.5,re.distSqr(Q)-re.distSqr(K)})})(b,this.painter);let S=this.proxyToSource||{};this.proxyToSource={},b.forEach(k=>{this.proxyToSource[k.key]={}}),this.terrainTileForTile={};let A=this._style._mergedSourceCaches;for(let k in A){let O=A[k];if(!O.used||(O!==this.sourceCache&&this.resetTileLookupCache(O.id),this._setupProxiedCoordsForOrtho(O,c[k],S),O.usedForTerrain))continue;let z=c[k];O.getSource().reparseOverscaled&&this._assignTerrainTiles(z)}this.proxiedCoords[u.id]=b.map(k=>new B_(k,k.key,this.orthoMatrix)),this._assignTerrainTiles(b),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(S),this.renderingToTexture=!1;let P={};this._visibleDemTiles=[];for(let k of this.proxyCoords){let O=this.terrainTileForTile[k.key];if(!O)continue;let z=O.tileID.key;z in P||(this._visibleDemTiles.push(O),P[z]=z)}}_assignTerrainTiles(c){this._initializing||c.forEach(u=>{if(this.terrainTileForTile[u.key])return;let _=this._findTileCoveringTileID(u,this.sourceCache);_&&(this.terrainTileForTile[u.key]=_)})}_prepareDEMTextures(){let c=this.painter.context,u=c.gl;for(let _ in this.terrainTileForTile){let b=this.terrainTileForTile[_],S=b.dem;!S||b.demTexture&&!b.needsDEMTextureUpload||(c.activeTexture.set(u.TEXTURE1),O_(this.painter,b,S))}}_prepareDemTileUniforms(c,u,_,b){if(!u||u.demTexture==null)return!1;let S=c.tileID.canonical,A=Math.pow(2,u.tileID.canonical.z-S.z),P=b||"";return _[`u_dem_tl${P}`]=[S.x*A%1,S.y*A%1],_[`u_dem_scale${P}`]=A,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){let c=this.painter.context,u=c.gl;if(!this._emptyDepthBufferTexture){let _=new i.h({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new i.T(c,_,u.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let c=0,u=this._visibleDemTiles.reduce((_,b)=>{if(!b.dem)return _;let S=b.dem.tree.minimums[0];return S>0&&c++,_+S},0);return c?u/c:0}_updateEmptyDEMTexture(){let c=this.painter.context,u=c.gl;c.activeTexture.set(u.TEXTURE2);let _=this._getLoadedAreaMinimum(),[b,S]=(()=>{let P=new i.cm({width:1,height:1},new Float32Array([_]));return[u.R32F,P]})();this._emptyDEMTextureDirty=!1;let A=this._emptyDEMTexture;return A?A.update(S,{premultiply:!1}):A=this._emptyDEMTexture=new i.T(c,S,b,{premultiply:!1}),A}setupElevationDraw(c,u,_){let b=this.painter.context,S=b.gl,A={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};A.u_exaggeration=this.exaggeration();let P=null,k=null,O=1;if(_&&_.morphing&&this._useVertexMorphing){let q=_.morphing.srcDemTile,X=_.morphing.dstDemTile;O=_.morphing.phase,q&&X&&(this._prepareDemTileUniforms(c,q,A,"_prev")&&(k=q),this._prepareDemTileUniforms(c,X,A)&&(P=X))}let z=q=>q&&q.demTexture&&this.painter.linearFloatFilteringSupported()?S.LINEAR:S.NEAREST,U=q=>{A.u_dem_size=q.size[0]===1?1:q.size[0]-2};if(k&&P)b.activeTexture.set(S.TEXTURE2),P.demTexture.bind(z(P),S.CLAMP_TO_EDGE),b.activeTexture.set(S.TEXTURE4),k.demTexture.bind(z(k),S.CLAMP_TO_EDGE),P.demTexture&&U(P.demTexture),A.u_dem_lerp=O;else{P=this.terrainTileForTile[c.tileID.key],b.activeTexture.set(S.TEXTURE2);let q=this._prepareDemTileUniforms(c,P,A)?P.demTexture:this.emptyDEMTexture;q.bind(z(P),S.CLAMP_TO_EDGE),U(q)}if(b.activeTexture.set(S.TEXTURE3),_&&_.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE),this._depthFBO&&(A.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE),A.u_depth_size_inv=[1,1]),_&&_.useMeterToDem&&P){let q=(1<<P.tileID.canonical.z)*i.bl(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;A.u_meter_to_dem=q}if(_&&_.labelPlaneMatrixInv&&(A.u_label_plane_matrix_inv=_.labelPlaneMatrixInv),u.setTerrainUniformValues(b,A),this.painter.transform.projection.name==="globe"){let q=this.globeUniformValues(this.painter.transform,c.tileID.canonical,_&&_.useDenormalizedUpVectorScale);u.setGlobeUniformValues(b,q)}}globeUniformValues(c,u,_){let b=c.projection;return{u_tile_tl_up:b.upVector(u,0,0),u_tile_tr_up:b.upVector(u,i.V,0),u_tile_br_up:b.upVector(u,i.V,i.V),u_tile_bl_up:b.upVector(u,0,i.V),u_tile_up_scale:_?i.cl(1):b.upVectorScale(u,c.center.lat,c.worldSize).metersToTile}}renderToBackBuffer(c){let u=this.painter,_=this.painter.context;c.length!==0&&(_.bindFramebuffer.set(null),_.viewport.set([0,0,u.width,u.height]),u.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(b,S,A,P,k){if(b.transform.projection.name==="globe")(function(O,z,U,q,X){let Q=O.context,K=Q.gl,re,Y,ae=O.transform,ge=i.cd(O,Q,ae),ce=(ot,nt)=>{if(Y===nt)return;let Rt=[sm[nt],"PROJECTION_GLOBE_VIEW"];ge&&Rt.push("CUSTOM_ANTIALIASING");let je=O.isTileAffectedByFog(ot);re=O.getOrCreateProgram("globeRaster",{defines:Rt,overrideFog:je}),Y=nt},_e=O.colorModeForRenderPass(),oe=new ki(K.LEQUAL,ki.ReadWrite,O.depthRangeFor3D);dh.update(X);let ve=i.ce(ae),Ae=[i.a5(ae.center.lng),i.ae(ae.center.lat)],Re=O.globeSharedBuffers,Oe=[ae.width*i.f.devicePixelRatio,ae.height*i.f.devicePixelRatio],Je=Float32Array.from(ae.globeMatrix),Ue={useDenormalizedUpVectorScale:!0};{let ot=O.transform,nt=om(ot.zoom,z.exaggeration(),z.sourceCache._source.tileSize);Y=-1;let Rt=K.TRIANGLES;for(let je of q){let tt=U.getTile(je),Fe=tn.disabled,Ze=z.prevTerrainTileForTile[je.key],Dt=z.terrainTileForTile[je.key];Bd(Ze,Dt)&&dh.newMorphing(je.key,Ze,Dt,X,250),Q.activeTexture.set(K.TEXTURE0),tt.texture&&tt.texture.bind(K.LINEAR,K.CLAMP_TO_EDGE);let jt=dh.getMorphValuesForProxy(je.key),Ut=jt?1:0;jt&&i.j(Ue,{morphing:{srcDemTile:jt.from,dstDemTile:jt.to,phase:i.cc(jt.phase)}});let ti=i.cf(je.canonical),mi=i.cg(ti.getCenter().lat),Ei=i.ch(je.canonical,ti,mi,ot.worldSize/ot._pixelsPerMercatorPixel),xi=i.aT(i.ci(je.canonical)),Si=z_(ot.expandedFarZProjMatrix,Je,ve,xi,i.S(ot.zoom),Ae,ot.frustumCorners.TL,ot.frustumCorners.TR,ot.frustumCorners.BR,ot.frustumCorners.BL,ot.globeCenterInViewSpace,ot.globeRadius,Oe,nt,ot._farZ,Ei);if(ce(je,Ut),re&&(z.setupElevationDraw(tt,re,Ue),O.uploadCommonUniforms(Q,re,je.toUnwrapped()),Re)){let[gn,Zi,hn]=Re.getGridBuffers(mi,nt!==0);re.draw(O,Rt,oe,Fe,_e,Di.backCCW,Si,"globe_raster",gn,Zi,hn)}}}if(Re&&(O.renderDefaultNorthPole||O.renderDefaultSouthPole)){let ot=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ge&&ot.push("CUSTOM_ANTIALIASING"),re=O.getOrCreateProgram("globeRaster",{defines:ot});for(let nt of q){let{x:Rt,y:je,z:tt}=nt.canonical,Fe=je===0,Ze=je===(1<<tt)-1,[Dt,jt,Ut,ti]=Re.getPoleBuffers(tt,!1);if(ti&&(Fe||Ze)){let mi=U.getTile(nt);Q.activeTexture.set(K.TEXTURE0),mi.texture&&mi.texture.bind(K.LINEAR,K.CLAMP_TO_EDGE);let Ei=i.cj(tt,Rt,ae),xi=i.aT(i.ci(nt.canonical)),Si=(gn,Zi)=>gn.draw(O,K.TRIANGLES,oe,tn.disabled,_e,Di.disabled,z_(ae.expandedFarZProjMatrix,Ei,Ei,xi,0,Ae,ae.frustumCorners.TL,ae.frustumCorners.TR,ae.frustumCorners.BR,ae.frustumCorners.BL,ae.globeCenterInViewSpace,ae.globeRadius,Oe,0,ae._farZ),"globe_pole_raster",Zi,Ut,ti);z.setupElevationDraw(mi,re,Ue),O.uploadCommonUniforms(Q,re,nt.toUnwrapped()),Fe&&O.renderDefaultNorthPole&&Si(re,Dt),Ze&&O.renderDefaultSouthPole&&(Ei=i.a6.scale(i.a6.create(),Ei,[1,-1,1]),Si(re,jt))}}}})(b,S,A,P,k);else{let O=b.context,z=O.gl,U,q,X=b.shadowRenderer,Q=Sc(b,b.longestCutoffRange),K=_e=>{if(q===_e)return;let oe=[];oe.push(sm[_e]),Q.shouldRenderCutoff&&oe.push("RENDER_CUTOFF"),U=b.getOrCreateProgram("terrainRaster",{defines:oe}),q=_e},re=b.colorModeForRenderPass(),Y=new ki(z.LEQUAL,ki.ReadWrite,b.depthRangeFor3D);dh.update(k);let ae=b.transform,ge=om(ae.zoom,S.exaggeration(),S.sourceCache._source.tileSize),ce=[0,0,0];if(X){let _e=b.style.directionalLight,oe=b.style.ambientLight;_e&&oe&&(ce=Nd(_e,oe))}{q=-1;let _e=z.TRIANGLES,[oe,ve]=[S.gridIndexBuffer,S.gridSegments];for(let Ae of P){let Re=A.getTile(Ae),Oe=tn.disabled,Je=S.prevTerrainTileForTile[Ae.key],Ue=S.terrainTileForTile[Ae.key];Bd(Je,Ue)&&dh.newMorphing(Ae.key,Je,Ue,k,250),O.activeTexture.set(z.TEXTURE0),Re.texture&&Re.texture.bind(z.LINEAR,z.CLAMP_TO_EDGE);let ot=dh.getMorphValuesForProxy(Ae.key),nt=ot?1:0,Rt;ot&&(Rt={morphing:{srcDemTile:ot.from,dstDemTile:ot.to,phase:i.cc(ot.phase)}});let je=Sp(Ae.projMatrix,uh(Ae.canonical,ae.renderWorldCopies)?ge/10:ge,ce);if(K(nt),!U)continue;S.setupElevationDraw(Re,U,Rt);let tt=Ae.toUnwrapped();X&&X.setupShadows(tt,U),b.uploadCommonUniforms(O,U,tt,null,Q),U.draw(b,_e,Y,Oe,re,Di.backCCW,je,"terrain_raster",S.gridBuffer,oe,ve)}}}}(u,this,this.proxySourceCache,c,this._updateTimestamp),this.renderingToTexture=!0,u.gpuTimingDeferredRenderEnd(),c.splice(0,c.length))}renderBatch(c){if(this._drapedRenderBatches.length===0)return c+1;this.renderingToTexture=!0;let u=this.painter,_=this.painter.context,b=this.proxySourceCache,S=this.proxiedCoords[b.id],A=this._drapedRenderBatches.shift(),P=u.style.order,k=[],O=0;for(let z of S){let U=b.getTileByID(z.proxyTileKey),q=b.proxyCachedFBO[z.key]?b.proxyCachedFBO[z.key][c]:void 0,X=q!==void 0?b.renderCache[q]:this.pool[O++],Q=q!==void 0;if(U.texture=X.tex,Q&&!X.dirty){k.push(U.tileID);continue}let K;_.bindFramebuffer.set(X.fb.framebuffer),this.renderedToTile=!1,X.dirty&&(_.clear({color:i.ax.transparent,stencil:0}),X.dirty=!1);for(let re=A.start;re<=A.end;++re){let Y=u.style._mergedLayers[P[re]];if(Y.isHidden(u.transform.zoom))continue;let ae=u.style.getLayerSourceCache(Y),ge=ae?this.proxyToSource[z.key][ae.id]:[z];if(!ge)continue;let ce=ge;_.viewport.set([0,0,X.fb.width,X.fb.height]),K!==(ae?ae.id:null)&&(this._setupStencil(X,ge,Y,ae),K=ae?ae.id:null),u.renderLayer(u,ae,Y,ce)}if(this._drapedRenderBatches.length===0)for(let re of this._pendingGroundEffectLayers){let Y=u.style._mergedLayers[P[re]];if(Y.isHidden(u.transform.zoom))continue;let ae=u.style.getLayerSourceCache(Y),ge=ae?this.proxyToSource[z.key][ae.id]:[z];if(!ge)continue;let ce=ge;_.viewport.set([0,0,X.fb.width,X.fb.height]),K!==(ae?ae.id:null)&&(this._setupStencil(X,ge,Y,ae),K=ae?ae.id:null),u.renderLayer(u,ae,Y,ce)}this.renderedToTile?(X.dirty=!0,k.push(U.tileID)):Q||--O,O===5&&(O=0,this.renderToBackBuffer(k))}return this.renderToBackBuffer(k),this.renderingToTexture=!1,_.bindFramebuffer.set(null),_.viewport.set([0,0,u.width,u.height]),A.end+1}postRender(){}isLayerOrderingCorrect(c){let u=c.order.length,_=-1,b=u;for(let S=0;S<u;++S)this._style.isLayerDraped(c._mergedLayers[c.order[S]])?_=Math.max(_,S):b=Math.min(b,S);return b>_}getMinElevationBelowMSL(){let c=0;return this._visibleDemTiles.filter(u=>u.dem).forEach(u=>{c=Math.min(c,u.dem.tree.minimums[0])}),c===0?c:(c-30)*this._exaggeration}raycast(c,u,_){if(!this._visibleDemTiles)return null;let b=this._visibleDemTiles.filter(S=>S.dem).map(S=>{let A=S.tileID,P=1<<A.overscaledZ,{x:k,y:O}=A.canonical,z=k/P,U=(k+1)/P,q=O/P,X=(O+1)/P;return{minx:z,miny:q,maxx:U,maxy:X,t:S.dem.tree.raycastRoot(z,q,U,X,c,u,_),tile:S}});b.sort((S,A)=>(S.t!==null?S.t:Number.MAX_VALUE)-(A.t!==null?A.t:Number.MAX_VALUE));for(let S of b){if(S.t==null)return null;let A=S.tile.dem.tree.raycast(S.minx,S.miny,S.maxx,S.maxy,c,u,_);if(A!=null)return A}return null}_createFBO(){let c=this.painter.context,u=c.gl,_=this.drapeBufferSize;c.activeTexture.set(u.TEXTURE0);let b=new i.T(c,{width:_[0],height:_[1],data:null},u.RGBA);b.bind(u.LINEAR,u.CLAMP_TO_EDGE);let S=c.createFramebuffer(_[0],_[1],!0,null);return S.colorAttachment.set(b.texture),S.depthAttachment=new Ho(c,S.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=c.createRenderbuffer(c.gl.DEPTH_STENCIL,_[0],_[1]),this._stencilRef=0,S.depthAttachment.set(this._sharedDepthStencil),c.clear({stencil:0})):S.depthAttachment.set(this._sharedDepthStencil),c.extTextureFilterAnisotropic&&u.texParameterf(u.TEXTURE_2D,c.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,c.extTextureFilterAnisotropicMax),{fb:S,tex:b,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(let c in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[c].hasTransition())return!0;return this._style.order.some(c=>{let u=this._style._mergedLayers[c],_=u.isHidden(this.painter.transform.zoom);return u.type==="custom"?!_&&u.shouldRedrape():!_&&u.hasTransition()})}_clearLineLayersFromRenderCache(){let c=!1;for(let _ of this._style.getSources())if(_ instanceof Jt){c=!0;break}if(!c)return;let u={};for(let _=0;_<this._style.order.length;++_){let b=this._style._mergedLayers[this._style.order[_]],S=this._style.getLayerSourceCache(b);if(S&&!u[S.id]&&!b.isHidden(this.painter.transform.zoom)&&b.type==="line"&&b.widthExpression()instanceof i.Z){u[S.id]=!0;for(let A of this.proxyCoords){let P=this.proxyToSource[A.key][S.id];if(P)for(let k of P)this._clearRenderCacheForTile(S.id,k)}}}}_clearRasterLayersFromRenderCache(){let c=!1;for(let _ in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[_]._source instanceof Kt){c=!0;break}if(!c)return;let u={};for(let _=0;_<this._style.order.length;++_){let b=this._style._mergedLayers[this._style.order[_]],S=this._style.getLayerSourceCache(b);if(!S||u[S.id]||b.isHidden(this.painter.transform.zoom)||b.type!=="raster")continue;let A=b.paint.get("raster-fade-duration");for(let P of this.proxyCoords){let k=this.proxyToSource[P.key][S.id];if(k)for(let O of k){let z=lm(S.getTile(O),S.findLoadedParent(O,0),S,this.painter.transform,A);(z.opacity!==1||z.mix!==0)&&this._clearRenderCacheForTile(S.id,O)}}}}_setupDrapedRenderBatches(){let c=this._style.order,u=c.length;if(u===0)return;let _=[];this._pendingGroundEffectLayers=[];let b,S=0,A=this._style._mergedLayers[c[S]];for(;!this._style.isLayerDraped(A)&&A.isHidden(this.painter.transform.zoom)&&++S<u;)A=this._style._mergedLayers[c[S]];for(;S<u;++S){let P=this._style._mergedLayers[c[S]];P.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(P)?b===void 0&&(b=S):(P.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(S),b!==void 0&&(_.push({start:b,end:S-1}),b=void 0)))}if(b!==void 0&&_.push({start:b,end:S-1}),_.length!==0){let P=_[_.length-1];this._pendingGroundEffectLayers.every(k=>k>P.end)||i.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=_}_setupRenderCache(c){let u=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,u.renderCache.length>u.renderCachePool.length){let A=Object.values(u.proxyCachedFBO);u.proxyCachedFBO={};for(let P=0;P<A.length;++P){let k=Object.values(A[P]);u.renderCachePool.push(...k)}}return}this._clearRasterLayersFromRenderCache();let _=this.proxyCoords,b=this._tilesDirty;for(let A=_.length-1;A>=0;A--){let P=_[A];if(u.getTileByID(P.key),u.proxyCachedFBO[P.key]!==void 0){let k=c[P.key],O=this.proxyToSource[P.key],z=0;for(let U in O){let q=O[U],X=k[U];if(!X||X.length!==q.length||q.some((Q,K)=>Q!==X[K]||b[U]&&b[U].hasOwnProperty(Q.key))){z=-1;break}++z}for(let U in u.proxyCachedFBO[P.key])u.renderCache[u.proxyCachedFBO[P.key][U]].dirty=z<0||z!==Object.values(k).length}}let S=[...this._drapedRenderBatches];S.sort((A,P)=>P.end-P.start-(A.end-A.start));for(let A of S)for(let P of _){if(u.proxyCachedFBO[P.key])continue;let k=u.renderCachePool.pop();k===void 0&&u.renderCache.length<50&&(k=u.renderCache.length,u.renderCache.push(this._createFBO())),k!==void 0&&(u.proxyCachedFBO[P.key]={},u.proxyCachedFBO[P.key][A.start]=k,u.renderCache[k].dirty=!0)}this._tilesDirty={}}_setupStencil(c,u,_,b){if(!b||!this._sourceTilesOverlap[b.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));let S=this.painter.context,A=S.gl;if(u.length<=1)return void(this._overlapStencilType=!1);let P;if(_.isTileClipped())P=u.length,this._overlapStencilMode.test={func:A.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(u[0].overscaledZ>u[u.length-1].overscaledZ))return void(this._overlapStencilType=!1);P=1,this._overlapStencilMode.test={func:A.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+P>255&&(S.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=P,this._overlapStencilMode.ref=this._stencilRef,_.isTileClipped()&&this._renderTileClippingMasks(u,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(c){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[c.key]),this._overlapStencilMode):tn.disabled}_renderTileClippingMasks(c,u){let _=this.painter,b=this.painter.context,S=b.gl;_._tileClippingMaskIDs={},b.setColorMode(Mn.disabled),b.setDepthMode(ki.disabled);let A=_.getOrCreateProgram("clippingMask");for(let P of c){let k=_._tileClippingMaskIDs[P.key]=--u;A.draw(_,S.TRIANGLES,ki.disabled,new tn({func:S.ALWAYS,mask:0},k,255,S.KEEP,S.KEEP,S.REPLACE),Mn.disabled,Di.disabled,am(P.projMatrix),"$clipping",_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}}pointCoordinate(c){let u=this.painter.transform;if(c.x<0||c.x>u.width||c.y<0||c.y>u.height)return null;let _=[c.x,c.y,1,1];i.a7.transformMat4(_,_,u.pixelMatrixInverse),i.a7.scale(_,_,1/_[3]),_[0]/=u.worldSize,_[1]/=u.worldSize;let b=u._camera.position,S=i.bl(1,u.center.lat),A=[b[0],b[1],b[2]/S,0],P=i.N.subtract([],_.slice(0,3),A);i.N.normalize(P,P);let k=this.raycast(A,P,this._exaggeration);return k!==null&&k?(i.N.scaleAndAdd(A,A,P,k),A[3]=A[2],A[2]*=S,A):null}drawDepth(){let c=this.painter,u=c.context,_=this.proxySourceCache,b=Math.ceil(c.width),S=Math.ceil(c.height);if(!this._depthFBO||this._depthFBO.width===b&&this._depthFBO.height===S||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){let A=u.gl,P=u.createFramebuffer(b,S,!0,"renderbuffer");u.activeTexture.set(A.TEXTURE0);let k=new i.T(u,{width:b,height:S,data:null},A.RGBA);k.bind(A.NEAREST,A.CLAMP_TO_EDGE),P.colorAttachment.set(k.texture);let O=u.createRenderbuffer(u.gl.DEPTH_COMPONENT16,b,S);P.depthAttachment.set(O),this._depthFBO=P,this._depthTexture=k}u.bindFramebuffer.set(this._depthFBO.framebuffer),u.viewport.set([0,0,b,S]),function(A,P,k,O){if(A.transform.projection.name==="globe")return;let z=A.context,U=z.gl;z.clear({depth:1});let q=A.getOrCreateProgram("terrainDepth"),X=new ki(U.LESS,ki.ReadWrite,A.depthRangeFor3D);for(let Q of O){let K=k.getTile(Q),re=Sp(Q.projMatrix,0,[0,0,0]);P.setupElevationDraw(K,q),q.draw(A,U.TRIANGLES,X,tn.disabled,Mn.unblended,Di.backCCW,re,"terrain_depth",P.gridBuffer,P.gridIndexBuffer,P.gridNoSkirtSegments)}}(c,this,_,this.proxyCoords)}_setupProxiedCoordsForOrtho(c,u,_){if(c.getSource()instanceof i.ap)return this._setupProxiedCoordsForImageSource(c,u,_);this._findCoveringTileCache[c.id]=this._findCoveringTileCache[c.id]||{};let b=this.proxiedCoords[c.id]=[],S=this.proxyCoords;for(let k=0;k<S.length;k++){let O=S[k],z=this._findTileCoveringTileID(O,c);if(z){let U=this._createProxiedId(O,z,_[O.key]&&_[O.key][c.id]);b.push(U),this.proxyToSource[O.key][c.id]=[U]}}let A=!1,P=new Set;for(let k=0;k<u.length;k++){let O=c.getTile(u[k]);if(!O||!O.hasData())continue;let z=this._findTileCoveringTileID(O.tileID,this.proxySourceCache);if(z&&z.tileID.canonical.z!==O.tileID.canonical.z){let U=this.proxyToSource[z.tileID.key][c.id],q=this._createProxiedId(z.tileID,O,_[z.tileID.key]&&_[z.tileID.key][c.id]);U?U.splice(U.length-1,0,q):this.proxyToSource[z.tileID.key][c.id]=[q];let X=this.proxyToSource[z.tileID.key][c.id];P.has(X)||P.add(X),b.push(q),A=!0}}if(this._sourceTilesOverlap[c.id]=A,A&&this._debugParams.sortTilesHiZFirst)for(let k of P)k.sort((O,z)=>z.overscaledZ-O.overscaledZ)}_setupProxiedCoordsForImageSource(c,u,_){if(!c.getSource().loaded())return;let b=this.proxiedCoords[c.id]=[],S=this.proxyCoords,A=c.getSource(),P=A.tileID;if(!P)return;let k=new i.P(P.x,P.y)._div(1<<P.z),O=A.coordinates.map(i.L.fromLngLat).reduce((U,q)=>(U.min.x=Math.min(U.min.x,q.x-k.x),U.min.y=Math.min(U.min.y,q.y-k.y),U.max.x=Math.max(U.max.x,q.x-k.x),U.max.y=Math.max(U.max.y,q.y-k.y),U),{min:new i.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new i.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),z=(U,q)=>{let X=U.wrap+U.canonical.x/(1<<U.canonical.z),Q=U.canonical.y/(1<<U.canonical.z),K=i.V/(1<<U.canonical.z),re=q.wrap+q.canonical.x/(1<<q.canonical.z),Y=q.canonical.y/(1<<q.canonical.z);return X+K<re+O.min.x||X>re+O.max.x||Q+K<Y+O.min.y||Q>Y+O.max.y};for(let U=0;U<S.length;U++){let q=S[U];for(let X=0;X<u.length;X++){let Q=c.getTile(u[X]);if(!Q||!Q.hasData()||z(q,Q.tileID))continue;let K=this._createProxiedId(q,Q,_[q.key]&&_[q.key][c.id]),re=this.proxyToSource[q.key][c.id];re?re.push(K):this.proxyToSource[q.key][c.id]=[K],b.push(K)}}}_createProxiedId(c,u,_){let b=this.orthoMatrix;if(_){let S=_.find(A=>A.key===u.tileID.key);if(S)return S}if(u.tileID.key!==c.key){let S=c.canonical.z-u.tileID.canonical.z,A,P,k;b=i.a6.create();let O=u.tileID.wrap-c.wrap<<c.overscaledZ;S>0?(A=i.V>>S,P=A*((u.tileID.canonical.x<<S)-c.canonical.x+O),k=A*((u.tileID.canonical.y<<S)-c.canonical.y)):(A=i.V<<-S,P=i.V*(u.tileID.canonical.x-(c.canonical.x+O<<-S)),k=i.V*(u.tileID.canonical.y-(c.canonical.y<<-S))),i.a6.ortho(b,0,A,0,A,0,1),i.a6.translate(b,b,[P,k,0])}return new B_(u.tileID,c.key,b)}_findTileCoveringTileID(c,u){let _=u.getTile(c);if(_&&_.hasData())return _;let b=this._findCoveringTileCache[u.id],S=b[c.key];if(_=S?u.getTileByID(S):null,_&&_.hasData()||S===null)return _;let A=_?_.tileID:c,P=A.overscaledZ,k=u.getSource().minzoom,O=[];if(!S){let U=u.getSource().maxzoom;if(c.canonical.z>=U){let q=c.canonical.z-U;u.getSource().reparseOverscaled?(P=Math.max(c.canonical.z+2,u.transform.tileZoom),A=new i.am(P,c.wrap,U,c.canonical.x>>q,c.canonical.y>>q)):q!==0&&(P=U,A=new i.am(P,c.wrap,U,c.canonical.x>>q,c.canonical.y>>q))}A.key!==c.key&&(O.push(A.key),_=u.getTile(A))}let z=U=>{O.forEach(q=>{b[q]=U}),O.length=0};for(P-=1;P>=k&&(!_||!_.hasData());P--){_&&z(_.tileID.key);let U=A.calculateScaledKey(P);if(_=u.getTileByID(U),_&&_.hasData())break;let q=b[U];if(q===null)break;q===void 0?O.push(U):_=u.getTileByID(q)}return z(_?_.tileID.key:null),_&&_.hasData()?_:null}findDEMTileFor(c){return this.enabled?this._findTileCoveringTileID(c,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(c,u){let _=this._tilesDirty[c];_||(_=this._tilesDirty[c]={}),_[u.key]=!0}}function cm(g,c,u){let _=function(P,k,O){let z=i.N.dot(k,P),U=i.N.dot(O,[.2126,.7152,.0722]),q=(Q,K,re)=>(1-re)*Q+re*K,X=q(1-.3*Math.min(U,1),1,Math.min(z+1,1));return q(.92,1,Math.asin(i.aa(k[2],-1,1))/Math.PI+.5)*X}(g,[0,0,1],c),b=[0,0,0];i.N.scale(b,u.slice(0,3),_);let S=[0,0,0];i.N.scale(S,c.slice(0,3),g[2]);let A=[0,0,0];return i.N.add(A,b,S),i.bU(A)}let hm=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],U_=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class dm{static cacheKey(c,u,_,b){let S=`${u}${b?b.cacheKey:""}`;for(let A of _)c.usedDefines.includes(A)&&(S+=`/${A}`);return S}constructor(c,u,_,b,S,A,P){let k=c.gl;this.program=k.createProgram(),this.configuration=b,this.name=u,this.fixedDefines=[...A];let O=b?b.getBinderAttributes():[],z=(_.staticAttributes||[]).concat(O),U=b?b.defines():[];U=U.concat(A.map(Y=>`#define ${Y}`));let q=`#version 300 es
`,X=q+U.concat("precision mediump float;",bp,tm.fragmentSource).join(`
`);for(let Y of _.fragmentIncludes)X+=`
${ra[Y]}`;X+=`
${_.fragmentSource}`;let Q=q+U.concat("precision highp float;",bp,tm.vertexSource).join(`
`);for(let Y of _.vertexIncludes)Q+=`
${ra[Y]}`;Q+=`
${_.vertexSource}`;let K=k.createShader(k.FRAGMENT_SHADER);if(k.isContextLost())return void(this.failedToCreate=!0);k.shaderSource(K,X),k.compileShader(K),k.attachShader(this.program,K);let re=k.createShader(k.VERTEX_SHADER);if(k.isContextLost())this.failedToCreate=!0;else{k.shaderSource(re,Q),k.compileShader(re),k.attachShader(this.program,re),this.attributes={},this.numAttributes=z.length;for(let Y=0;Y<this.numAttributes;Y++)if(z[Y]){let ae=z[Y].startsWith("a_")?z[Y]:`a_${z[Y]}`;k.bindAttribLocation(this.program,Y,ae),this.attributes[ae]=Y}P&&P.shaderVaryings.length>0&&k.transformFeedbackVaryings(this.program,P.shaderVaryings,P.bufferMode),k.linkProgram(this.program),k.deleteShader(re),k.deleteShader(K),this.fixedUniforms=S(c),this.binderUniforms=b?b.getUniforms(c):[],A.includes("TERRAIN")&&(this.terrainUniforms=(Y=>({u_dem:new i.bO(Y),u_dem_prev:new i.bO(Y),u_dem_tl:new i.bL(Y),u_dem_scale:new i.bN(Y),u_dem_tl_prev:new i.bL(Y),u_dem_scale_prev:new i.bN(Y),u_dem_size:new i.bN(Y),u_dem_lerp:new i.bN(Y),u_exaggeration:new i.bN(Y),u_depth:new i.bO(Y),u_depth_size_inv:new i.bL(Y),u_meter_to_dem:new i.bN(Y),u_label_plane_matrix_inv:new i.bK(Y)}))(c)),A.includes("GLOBE")&&(this.globeUniforms=(Y=>({u_tile_tl_up:new i.bM(Y),u_tile_tr_up:new i.bM(Y),u_tile_br_up:new i.bM(Y),u_tile_bl_up:new i.bM(Y),u_tile_up_scale:new i.bN(Y)}))(c)),A.includes("FOG")&&(this.fogUniforms=(Y=>({u_fog_matrix:new i.bK(Y),u_fog_range:new i.bL(Y),u_fog_color:new i.bP(Y),u_fog_horizon_blend:new i.bN(Y),u_fog_vertical_limit:new i.bL(Y),u_fog_temporal_offset:new i.bN(Y),u_frustum_tl:new i.bM(Y),u_frustum_tr:new i.bM(Y),u_frustum_br:new i.bM(Y),u_frustum_bl:new i.bM(Y),u_globe_pos:new i.bM(Y),u_globe_radius:new i.bN(Y),u_globe_transition:new i.bN(Y),u_is_globe:new i.bO(Y),u_viewport:new i.bL(Y)}))(c)),A.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(Y=>({u_cutoff_params:new i.bP(Y)}))(c)),A.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(Y=>({u_lighting_ambient_color:new i.bM(Y),u_lighting_directional_dir:new i.bM(Y),u_lighting_directional_color:new i.bM(Y),u_ground_radiance:new i.bM(Y)}))(c)),A.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(Y=>({u_light_matrix_0:new i.bK(Y),u_light_matrix_1:new i.bK(Y),u_fade_range:new i.bL(Y),u_shadow_normal_offset:new i.bM(Y),u_shadow_intensity:new i.bN(Y),u_shadow_texel_size:new i.bN(Y),u_shadow_map_resolution:new i.bN(Y),u_shadow_direction:new i.bM(Y),u_shadow_bias:new i.bM(Y),u_shadowmap_0:new i.bO(Y),u_shadowmap_1:new i.bO(Y)}))(c))}}setTerrainUniformValues(c,u){if(!this.terrainUniforms)return;let _=this.terrainUniforms;if(!this.failedToCreate){c.program.set(this.program);for(let b in u)_[b]&&_[b].set(this.program,b,u[b])}}setGlobeUniformValues(c,u){if(!this.globeUniforms)return;let _=this.globeUniforms;if(!this.failedToCreate){c.program.set(this.program);for(let b in u)_[b]&&_[b].set(this.program,b,u[b])}}setFogUniformValues(c,u){if(!this.fogUniforms)return;let _=this.fogUniforms;if(!this.failedToCreate){c.program.set(this.program);for(let b in u)_[b].set(this.program,b,u[b])}}setCutoffUniformValues(c,u){if(!this.cutoffUniforms)return;let _=this.cutoffUniforms;if(!this.failedToCreate){c.program.set(this.program);for(let b in u)_[b].set(this.program,b,u[b])}}setLightsUniformValues(c,u){if(!this.lightsUniforms)return;let _=this.lightsUniforms;if(!this.failedToCreate){c.program.set(this.program);for(let b in u)_[b].set(this.program,b,u[b])}}setShadowUniformValues(c,u){if(this.failedToCreate||!this.shadowUniforms)return;let _=this.shadowUniforms;c.program.set(this.program);for(let b in u)_[b].set(this.program,b,u[b])}_drawDebugWireframe(c,u,_,b,S,A,P,k,O,z){let U=c.options.wireframe;if(U.terrain===!1&&U.layers2D===!1&&U.layers3D===!1)return;let q=c.context;if(!(!(!U.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!U.layers2D||c._terrain&&c._terrain.renderingToTexture||!hm.includes(this.name))||!(!U.layers3D||!U_.includes(this.name))))return;let X=q.gl,Q=c.wireframeDebugCache.getLinesFromTrianglesBuffer(c.frameCounter,S,q);if(!Q)return;let K=[...this.fixedDefines];K.push("DEBUG_WIREFRAME");let re=c.getOrCreateProgram(this.name,{config:this.configuration,defines:K});q.program.set(re.program);let Y=(ce,_e,oe)=>{if(_e[ce]&&oe[ce])for(let ve in _e[ce])oe[ce][ve]&&oe[ce][ve].set(oe.program,ve,_e[ce][ve].current)};O&&O.setUniforms(re.program,q,re.binderUniforms,P,{zoom:k}),Y("fixedUniforms",this,re),Y("terrainUniforms",this,re),Y("globeUniforms",this,re),Y("fogUniforms",this,re),Y("lightsUniforms",this,re),Y("shadowUniforms",this,re),Q.bind(),q.setColorMode(new Mn([X.ONE,X.ONE_MINUS_SRC_ALPHA,X.ZERO,X.ONE],i.ax.transparent,[!0,!0,!0,!1])),q.setDepthMode(new ki(u.func===X.LESS?X.LEQUAL:u.func,ki.ReadOnly,u.range)),q.setStencilMode(tn.disabled);let ae=3*A.primitiveLength*2,ge=3*A.primitiveOffset*2*2;z&&z>1?X.drawElementsInstanced(X.LINES,ae,X.UNSIGNED_SHORT,ge,z):X.drawElements(X.LINES,ae,X.UNSIGNED_SHORT,ge),S.bind(),q.program.set(this.program),q.setDepthMode(u),q.setStencilMode(_),q.setColorMode(b)}draw(c,u,_,b,S,A,P,k,O,z,U,q,X,Q,K,re,Y){let ae=c.context,ge=ae.gl;if(this.failedToCreate)return;ae.program.set(this.program),ae.setDepthMode(_),ae.setStencilMode(b),ae.setColorMode(S),ae.setCullFace(A);for(let ve of Object.keys(this.fixedUniforms))this.fixedUniforms[ve].set(this.program,ve,P[ve]);Q&&Q.setUniforms(this.program,ae,this.binderUniforms,q,{zoom:X});let ce={[ge.POINTS]:1,[ge.LINES]:2,[ge.TRIANGLES]:3,[ge.LINE_STRIP]:1}[u],_e=Y&&Y.length>0;if(_e){for(let ve of Y)ge.bindBufferBase(ge.TRANSFORM_FEEDBACK_BUFFER,ve.targetIndex,ve.buffer.buffer);ge.beginTransformFeedback(u)}let oe=re&&re>0?1:void 0;for(let ve of U.get()){let Ae=ve.vaos||(ve.vaos={});(Ae[k]||(Ae[k]=new nm)).bind(ae,this,O,Q?Q.getPaintVertexBuffers():[],z,ve.vertexOffset,K||[],oe),re&&re>1?ge.drawElementsInstanced(u,ve.primitiveLength*ce,ge.UNSIGNED_SHORT,ve.primitiveOffset*ce*2,re):z?ge.drawElements(u,ve.primitiveLength*ce,ge.UNSIGNED_SHORT,ve.primitiveOffset*ce*2):ge.drawArrays(u,ve.vertexOffset,ve.vertexLength),u===ge.TRIANGLES&&z&&this._drawDebugWireframe(c,_,b,S,z,ve,q,X,Q,re)}_e&&ge.endTransformFeedback()}}function um(g,c){let u=Math.pow(2,c.tileID.overscaledZ),_=c.tileSize*Math.pow(2,g.transform.tileZoom)/u,b=_*(c.tileID.canonical.x+c.tileID.wrap*u),S=_*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture?c.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/i.a3(c,1,g.transform.tileZoom),u_pixel_coord_upper:[b>>16,S>>16],u_pixel_coord_lower:[65535&b,65535&S]}}let V_=i.a6.create(),pm=(g,c,u,_,b,S,A,P,k,O,z,U,q,X,Q,K)=>{let re=c.style.light,Y=re.properties.get("position"),ae=[Y.x,Y.y,Y.z],ge=i.co.create();re.properties.get("anchor")==="viewport"&&(i.co.fromRotation(ge,-c.transform.angle),i.N.transformMat3(ae,ae,ge));let ce=re.properties.get("color"),_e=c.transform,oe={u_matrix:g,u_lightpos:ae,u_lightintensity:re.properties.get("intensity"),u_lightcolor:[ce.r,ce.g,ce.b],u_vertical_gradient:+u,u_opacity:_,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:V_,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:b,u_edge_radius:S,u_flood_light_color:U,u_vertical_scale:q,u_flood_light_intensity:X,u_ground_shadow_factor:Q,u_emissive_strength:K};return _e.projection.name==="globe"&&(oe.u_tile_id=[A.canonical.x,A.canonical.y,1<<A.canonical.z],oe.u_zoom_transition=k,oe.u_inv_rot_matrix=z,oe.u_merc_center=O,oe.u_up_dir=_e.projection.upVector(new i.bs(0,0,0),O[0]*i.V,O[1]*i.V),oe.u_height_lift=P),oe},fm=(g,c,u)=>({u_matrix:g,u_edge_radius:c,u_vertical_scale:u}),p0=(g,c,u,_,b,S,A,P,k,O,z,U,q,X)=>{let Q=pm(g,c,u,_,b,S,A,k,O,z,U,q,X,1,[0,0,0],0),K={u_height_factor:-Math.pow(2,A.overscaledZ)/P.tileSize/8};return i.e(Q,um(c,P),K)},ph=(g,c)=>({u_matrix:g,u_emissive_strength:c}),mm=(g,c,u,_)=>i.e(ph(g,c),um(u,_)),f0=(g,c,u)=>({u_matrix:g,u_world:u,u_emissive_strength:c}),G_=(g,c,u,_,b)=>i.e(mm(g,c,u,_),{u_world:b}),Tp=(g,c,u,_)=>{let b=i.V/u.tileSize;return{u_matrix:g,u_camera_to_center_distance:c.getCameraToCenterDistance(_),u_extrude_scale:[c.pixelsToGLUnits[0]/b,c.pixelsToGLUnits[1]/b]}},gm=(g,c,u=1)=>({u_matrix:g,u_color:c,u_overlay:0,u_overlay_scale:u}),H_=i.a6.create(),_m=(g,c,u,_,b,S,A)=>{let P=g.transform,k=P.projection.name==="globe",O=k?i.cp(P.zoom,c.canonical)*P._pixelsPerMercatorPixel:i.a3(u,1,S),z={u_matrix:c.projMatrix,u_extrude_scale:O,u_intensity:A,u_inv_rot_matrix:H_,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(k){z.u_inv_rot_matrix=_,z.u_merc_center=b,z.u_tile_id=[c.canonical.x,c.canonical.y,1<<c.canonical.z],z.u_zoom_transition=i.S(P.zoom);let U=b[0]*i.V,q=b[1]*i.V;z.u_up_dir=P.projection.upVector(new i.bs(0,0,0),U,q)}return z};function Mp(g,[c,u,_,b],[S,A]){if(S===A)return[0,0,0,0];let P=255*(g-1)/(g*(A-S));return[c*P,u*P,_*P,b*P]}function j_(g,c,[u,_]){return u===_?0:.5/g+(c-u)*(g-1)/(g*(_-u))}let ym=(g,c,u,_,b,S,A,P,k,O,z,U,q,X,Q,K,re,Y,ae,ge,ce)=>{return{u_matrix:g,u_normalize_matrix:c,u_globe_matrix:u,u_merc_matrix:_,u_grid_matrix:b,u_tl_parent:S,u_scale_parent:O,u_fade_t:z.mix,u_opacity:z.opacity*U.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:U.paint.get("raster-brightness-min"),u_brightness_high:U.paint.get("raster-brightness-max"),u_saturation_factor:(oe=U.paint.get("raster-saturation"),oe>0?1-1/(1.001-oe):-oe),u_contrast_factor:(_e=U.paint.get("raster-contrast"),_e>0?1/(1-_e):1+_e),u_spin_weights:Ud(U.paint.get("raster-hue-rotate")),u_perspective_transform:q,u_raster_elevation:X,u_zoom_transition:A,u_merc_center:P,u_cutoff_params:k,u_colorization_mix:Mp(i.cq,K,Y),u_colorization_offset:j_(i.cq,re,Y),u_color_ramp:Q,u_texture_offset:[ge/(ae+2*ge),ae/(ae+2*ge)],u_texture_res:[ae+2*ge,ae+2*ge],u_emissive_strength:ce};var _e,oe};function Ud(g){g*=Math.PI/180;let c=Math.sin(g),u=Math.cos(g);return[(2*u+1)/3,(-Math.sqrt(3)*c-u+1)/3,(Math.sqrt(3)*c-u+1)/3]}let Ny=(g,c,u,_,b,S,A,P,k,O,z,U)=>({u_matrix:g,u_normalize_matrix:c,u_globe_matrix:u,u_merc_matrix:_,u_grid_matrix:b,u_tl_parent:S,u_scale_parent:O,u_fade_t:z.mix,u_opacity:z.opacity,u_image0:0,u_image1:1,u_raster_elevation:U,u_zoom_transition:A,u_merc_center:P,u_cutoff_params:k}),zy=(g,c,u,_,b,S,A,P)=>({u_tile_offset:g,u_velocity:c,u_color_ramp:_,u_velocity_res:u,u_max_speed:b,u_texture_offset:S,u_data_scale:A,u_data_offset:P}),W_=(g,c,u,_,b,S,A,P)=>({u_velocity:g,u_velocity_res:c,u_max_speed:u,u_speed_factor:_,u_lifetime_delta:b,u_rand_seed:Math.random(),u_texture_offset:S,u_data_scale:A,u_data_offset:P}),q_=i.a6.create(),Ep=(g,c,u,_,b,S,A,P,k,O,z,U,q,X,Q,K,re,Y)=>{let ae=b.transform,ge={u_is_size_zoom_constant:+(g==="constant"||g==="source"),u_is_size_feature_constant:+(g==="constant"||g==="camera"),u_size_t:c?c.uSizeT:0,u_size:c?c.uSize:0,u_camera_to_center_distance:ae.getCameraToCenterDistance(K),u_rotate_symbol:+u,u_aspect_ratio:ae.width/ae.height,u_fade_change:b.options.fadeDuration?b.symbolFadeChange:1,u_matrix:S,u_label_plane_matrix:A,u_coord_matrix:P,u_is_text:+k,u_pitch_with_map:+_,u_texsize:O,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:q_,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:q_,u_up_vector:[0,-1,0],u_icon_transition:Y||0,u_icon_saturation:re};return K.name==="globe"&&(ge.u_tile_id=[z.canonical.x,z.canonical.y,1<<z.canonical.z],ge.u_zoom_transition=U,ge.u_inv_rot_matrix=X,ge.u_merc_center=q,ge.u_camera_forward=ae._camera.forward(),ge.u_ecef_origin=i.cr(ae.globeMatrix,z.toUnwrapped()),ge.u_tile_matrix=Float32Array.from(ae.globeMatrix),ge.u_up_vector=Q),ge},Vd=(g,c,u,_,b,S,A,P,k,O,z,U,q,X,Q,K,re)=>i.e(Ep(g,c,u,_,b,S,A,P,k,O,U,q,X,Q,K,re,1),{u_gamma_scale:_?b.transform.getCameraToCenterDistance(re)*Math.cos(b.terrain?0:b.transform._pitch):1,u_device_pixel_ratio:i.f.devicePixelRatio,u_is_halo:+z,undefined:void 0}),Ap=(g,c,u,_,b,S,A,P,k,O,z,U,q,X,Q,K)=>i.e(Vd(g,c,u,_,b,S,A,P,!0,k,!0,z,U,q,X,Q,K),{u_texsize_icon:O,u_texture_icon:1}),vm=(g,c,u,_)=>({u_matrix:g,u_emissive_strength:c,u_opacity:u,u_color:_}),Gd=(g,c,u,_,b,S,A)=>i.e(function(P,k,O,z){let U=O.imageManager.getPattern(P.toString(),k),{width:q,height:X}=O.imageManager.getPixelSize(k),Q=Math.pow(2,z.tileID.overscaledZ),K=z.tileSize*Math.pow(2,O.transform.tileZoom)/Q,re=K*(z.tileID.canonical.x+z.tileID.wrap*Q),Y=K*z.tileID.canonical.y;return{u_image:0,u_pattern_tl:U.tl,u_pattern_br:U.br,u_texsize:[q,X],u_pattern_size:U.displaySize,u_tile_units_to_pixels:1/i.a3(z,1,O.transform.tileZoom),u_pixel_coord_upper:[re>>16,Y>>16],u_pixel_coord_lower:[65535&re,65535&Y]}}(b,S,_,A),{u_matrix:g,u_emissive_strength:c,u_opacity:u}),Cp=(g,c,u,_,b,S,A,P,k,O,z,U,q=[0,0,0],X)=>{let Q=_.style.light,K=Q.properties.get("position"),re=[-K.x,-K.y,K.z],Y=i.co.create();Q.properties.get("anchor")==="viewport"&&(i.co.fromRotation(Y,-_.transform.angle),i.N.transformMat3(re,re,Y));let ae=O.alphaMode==="MASK",ge=Q.properties.get("color"),ce=U.paint.get("model-ambient-occlusion-intensity"),_e=U.paint.get("model-color").constantOr(i.ax.white),oe=U.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:g,u_lighting_matrix:c,u_normal_matrix:u,u_lightpos:re,u_lightintensity:Q.properties.get("intensity"),u_lightcolor:[ge.r,ge.g,ge.b],u_camera_pos:q,u_opacity:b,u_baseTextureIsAlpha:0,u_alphaMask:+ae,u_alphaCutoff:O.alphaCutoff,u_baseColorFactor:[S.r,S.g,S.b,S.a],u_emissiveFactor:[A[0],A[1],A[2],1],u_metallicFactor:P,u_roughnessFactor:k,u_baseColorTexture:so.BaseColor,u_metallicRoughnessTexture:so.MetallicRoughness,u_normalTexture:so.Normal,u_occlusionTexture:so.Occlusion,u_emissionTexture:so.Emission,u_color_mix:[_e.r,_e.g,_e.b,oe],u_aoIntensity:ce,u_emissive_strength:z,u_occlusionTextureTransform:X||[0,0,0,0]}},Hd=new Float32Array(16),jd=(g,c=Hd,u=Hd)=>({u_matrix:g,u_instance:c,u_node_matrix:u}),By={fillExtrusion:g=>({u_matrix:new i.bK(g),u_lightpos:new i.bM(g),u_lightintensity:new i.bN(g),u_lightcolor:new i.bM(g),u_vertical_gradient:new i.bN(g),u_opacity:new i.bN(g),u_edge_radius:new i.bN(g),u_ao:new i.bL(g),u_tile_id:new i.bM(g),u_zoom_transition:new i.bN(g),u_inv_rot_matrix:new i.bK(g),u_merc_center:new i.bL(g),u_up_dir:new i.bM(g),u_height_lift:new i.bN(g),u_flood_light_color:new i.bM(g),u_vertical_scale:new i.bN(g),u_flood_light_intensity:new i.bN(g),u_ground_shadow_factor:new i.bM(g),u_emissive_strength:new i.bN(g)}),fillExtrusionDepth:g=>({u_matrix:new i.bK(g),u_edge_radius:new i.bN(g),u_vertical_scale:new i.bN(g)}),fillExtrusionPattern:g=>({u_matrix:new i.bK(g),u_lightpos:new i.bM(g),u_lightintensity:new i.bN(g),u_lightcolor:new i.bM(g),u_vertical_gradient:new i.bN(g),u_height_factor:new i.bN(g),u_edge_radius:new i.bN(g),u_ao:new i.bL(g),u_tile_id:new i.bM(g),u_zoom_transition:new i.bN(g),u_inv_rot_matrix:new i.bK(g),u_merc_center:new i.bL(g),u_up_dir:new i.bM(g),u_height_lift:new i.bN(g),u_image:new i.bO(g),u_texsize:new i.bL(g),u_pixel_coord_upper:new i.bL(g),u_pixel_coord_lower:new i.bL(g),u_tile_units_to_pixels:new i.bN(g),u_opacity:new i.bN(g)}),fillExtrusionGroundEffect:g=>({u_matrix:new i.bK(g),u_opacity:new i.bN(g),u_ao_pass:new i.bN(g),u_meter_to_tile:new i.bN(g),u_ao:new i.bL(g),u_flood_light_intensity:new i.bN(g),u_flood_light_color:new i.bM(g),u_attenuation:new i.bN(g),u_edge_radius:new i.bN(g),u_fb:new i.bO(g),u_fb_size:new i.bN(g)}),fill:g=>({u_matrix:new i.bK(g),u_emissive_strength:new i.bN(g)}),fillPattern:g=>({u_matrix:new i.bK(g),u_emissive_strength:new i.bN(g),u_image:new i.bO(g),u_texsize:new i.bL(g),u_pixel_coord_upper:new i.bL(g),u_pixel_coord_lower:new i.bL(g),u_tile_units_to_pixels:new i.bN(g)}),fillOutline:g=>({u_matrix:new i.bK(g),u_emissive_strength:new i.bN(g),u_world:new i.bL(g)}),fillOutlinePattern:g=>({u_matrix:new i.bK(g),u_emissive_strength:new i.bN(g),u_world:new i.bL(g),u_image:new i.bO(g),u_texsize:new i.bL(g),u_pixel_coord_upper:new i.bL(g),u_pixel_coord_lower:new i.bL(g),u_tile_units_to_pixels:new i.bN(g)}),circle:i.cs,collisionBox:g=>({u_matrix:new i.bK(g),u_camera_to_center_distance:new i.bN(g),u_extrude_scale:new i.bL(g)}),collisionCircle:g=>({u_matrix:new i.bK(g),u_inv_matrix:new i.bK(g),u_camera_to_center_distance:new i.bN(g),u_viewport_size:new i.bL(g)}),debug:g=>({u_color:new i.ca(g),u_matrix:new i.bK(g),u_overlay:new i.bO(g),u_overlay_scale:new i.bN(g)}),clippingMask:g=>({u_matrix:new i.bK(g)}),heatmap:g=>({u_extrude_scale:new i.bN(g),u_intensity:new i.bN(g),u_matrix:new i.bK(g),u_inv_rot_matrix:new i.bK(g),u_merc_center:new i.bL(g),u_tile_id:new i.bM(g),u_zoom_transition:new i.bN(g),u_up_dir:new i.bM(g)}),heatmapTexture:g=>({u_image:new i.bO(g),u_color_ramp:new i.bO(g),u_opacity:new i.bN(g)}),hillshade:g=>({u_matrix:new i.bK(g),u_image:new i.bO(g),u_latrange:new i.bL(g),u_light:new i.bL(g),u_shadow:new i.ca(g),u_highlight:new i.ca(g),u_emissive_strength:new i.bN(g),u_accent:new i.ca(g)}),hillshadePrepare:g=>({u_matrix:new i.bK(g),u_image:new i.bO(g),u_dimension:new i.bL(g),u_zoom:new i.bN(g)}),line:i.ct,linePattern:i.cu,raster:g=>({u_matrix:new i.bK(g),u_normalize_matrix:new i.bK(g),u_globe_matrix:new i.bK(g),u_merc_matrix:new i.bK(g),u_grid_matrix:new i.cb(g),u_tl_parent:new i.bL(g),u_scale_parent:new i.bN(g),u_fade_t:new i.bN(g),u_opacity:new i.bN(g),u_image0:new i.bO(g),u_image1:new i.bO(g),u_brightness_low:new i.bN(g),u_brightness_high:new i.bN(g),u_saturation_factor:new i.bN(g),u_contrast_factor:new i.bN(g),u_spin_weights:new i.bM(g),u_perspective_transform:new i.bL(g),u_raster_elevation:new i.bN(g),u_zoom_transition:new i.bN(g),u_merc_center:new i.bL(g),u_cutoff_params:new i.bP(g),u_colorization_mix:new i.bP(g),u_colorization_offset:new i.bN(g),u_color_ramp:new i.bO(g),u_texture_offset:new i.bL(g),u_texture_res:new i.bL(g),u_emissive_strength:new i.bN(g)}),rasterParticle:g=>({u_matrix:new i.bK(g),u_normalize_matrix:new i.bK(g),u_globe_matrix:new i.bK(g),u_merc_matrix:new i.bK(g),u_grid_matrix:new i.cb(g),u_tl_parent:new i.bL(g),u_scale_parent:new i.bN(g),u_fade_t:new i.bN(g),u_opacity:new i.bN(g),u_image0:new i.bO(g),u_image1:new i.bO(g),u_raster_elevation:new i.bN(g),u_zoom_transition:new i.bN(g),u_merc_center:new i.bL(g),u_cutoff_params:new i.bP(g)}),rasterParticleTexture:g=>({u_texture:new i.bO(g),u_opacity:new i.bN(g)}),rasterParticleDraw:g=>({u_tile_offset:new i.bL(g),u_velocity:new i.bO(g),u_color_ramp:new i.bO(g),u_velocity_res:new i.bL(g),u_max_speed:new i.bN(g),u_texture_offset:new i.bL(g),u_data_scale:new i.bP(g),u_data_offset:new i.bN(g)}),rasterParticleUpdate:g=>({u_velocity:new i.bO(g),u_velocity_res:new i.bL(g),u_max_speed:new i.bN(g),u_speed_factor:new i.bN(g),u_lifetime_delta:new i.bN(g),u_rand_seed:new i.bN(g),u_texture_offset:new i.bL(g),u_data_scale:new i.bP(g),u_data_offset:new i.bN(g)}),symbolIcon:g=>({u_is_size_zoom_constant:new i.bO(g),u_is_size_feature_constant:new i.bO(g),u_size_t:new i.bN(g),u_size:new i.bN(g),u_camera_to_center_distance:new i.bN(g),u_rotate_symbol:new i.bO(g),u_aspect_ratio:new i.bN(g),u_fade_change:new i.bN(g),u_matrix:new i.bK(g),u_label_plane_matrix:new i.bK(g),u_coord_matrix:new i.bK(g),u_is_text:new i.bO(g),u_pitch_with_map:new i.bO(g),u_texsize:new i.bL(g),u_tile_id:new i.bM(g),u_zoom_transition:new i.bN(g),u_inv_rot_matrix:new i.bK(g),u_merc_center:new i.bL(g),u_camera_forward:new i.bM(g),u_tile_matrix:new i.bK(g),u_up_vector:new i.bM(g),u_ecef_origin:new i.bM(g),u_texture:new i.bO(g),u_icon_transition:new i.bN(g),u_icon_saturation:new i.bN(g)}),symbolSDF:g=>({u_is_size_zoom_constant:new i.bO(g),u_is_size_feature_constant:new i.bO(g),u_size_t:new i.bN(g),u_size:new i.bN(g),u_camera_to_center_distance:new i.bN(g),u_rotate_symbol:new i.bO(g),u_aspect_ratio:new i.bN(g),u_fade_change:new i.bN(g),u_matrix:new i.bK(g),u_label_plane_matrix:new i.bK(g),u_coord_matrix:new i.bK(g),u_is_text:new i.bO(g),u_pitch_with_map:new i.bO(g),u_texsize:new i.bL(g),u_texture:new i.bO(g),u_gamma_scale:new i.bN(g),u_device_pixel_ratio:new i.bN(g),u_tile_id:new i.bM(g),u_zoom_transition:new i.bN(g),u_inv_rot_matrix:new i.bK(g),u_merc_center:new i.bL(g),u_camera_forward:new i.bM(g),u_tile_matrix:new i.bK(g),u_up_vector:new i.bM(g),u_ecef_origin:new i.bM(g),u_is_halo:new i.bO(g)}),symbolTextAndIcon:g=>({u_is_size_zoom_constant:new i.bO(g),u_is_size_feature_constant:new i.bO(g),u_size_t:new i.bN(g),u_size:new i.bN(g),u_camera_to_center_distance:new i.bN(g),u_rotate_symbol:new i.bO(g),u_aspect_ratio:new i.bN(g),u_fade_change:new i.bN(g),u_matrix:new i.bK(g),u_label_plane_matrix:new i.bK(g),u_coord_matrix:new i.bK(g),u_is_text:new i.bO(g),u_pitch_with_map:new i.bO(g),u_texsize:new i.bL(g),u_texsize_icon:new i.bL(g),u_texture:new i.bO(g),u_texture_icon:new i.bO(g),u_gamma_scale:new i.bN(g),u_device_pixel_ratio:new i.bN(g),u_is_halo:new i.bO(g)}),background:g=>({u_matrix:new i.bK(g),u_emissive_strength:new i.bN(g),u_opacity:new i.bN(g),u_color:new i.ca(g)}),backgroundPattern:g=>({u_matrix:new i.bK(g),u_emissive_strength:new i.bN(g),u_opacity:new i.bN(g),u_image:new i.bO(g),u_pattern_tl:new i.bL(g),u_pattern_br:new i.bL(g),u_texsize:new i.bL(g),u_pattern_size:new i.bL(g),u_pixel_coord_upper:new i.bL(g),u_pixel_coord_lower:new i.bL(g),u_tile_units_to_pixels:new i.bN(g)}),terrainRaster:N_,terrainDepth:N_,skybox:g=>({u_matrix:new i.bK(g),u_sun_direction:new i.bM(g),u_cubemap:new i.bO(g),u_opacity:new i.bN(g),u_temporal_offset:new i.bN(g)}),skyboxGradient:g=>({u_matrix:new i.bK(g),u_color_ramp:new i.bO(g),u_center_direction:new i.bM(g),u_radius:new i.bN(g),u_opacity:new i.bN(g),u_temporal_offset:new i.bN(g)}),skyboxCapture:g=>({u_matrix_3f:new i.cb(g),u_sun_direction:new i.bM(g),u_sun_intensity:new i.bN(g),u_color_tint_r:new i.bP(g),u_color_tint_m:new i.bP(g),u_luminance:new i.bN(g)}),globeRaster:g=>({u_proj_matrix:new i.bK(g),u_globe_matrix:new i.bK(g),u_normalize_matrix:new i.bK(g),u_merc_matrix:new i.bK(g),u_zoom_transition:new i.bN(g),u_merc_center:new i.bL(g),u_image0:new i.bO(g),u_grid_matrix:new i.cb(g),u_skirt_height:new i.bN(g),u_far_z_cutoff:new i.bN(g),u_frustum_tl:new i.bM(g),u_frustum_tr:new i.bM(g),u_frustum_br:new i.bM(g),u_frustum_bl:new i.bM(g),u_globe_pos:new i.bM(g),u_globe_radius:new i.bN(g),u_viewport:new i.bL(g)}),globeAtmosphere:g=>({u_frustum_tl:new i.bM(g),u_frustum_tr:new i.bM(g),u_frustum_br:new i.bM(g),u_frustum_bl:new i.bM(g),u_horizon:new i.bN(g),u_transition:new i.bN(g),u_fadeout_range:new i.bN(g),u_color:new i.bP(g),u_high_color:new i.bP(g),u_space_color:new i.bP(g),u_temporal_offset:new i.bN(g),u_horizon_angle:new i.bN(g)}),model:g=>({u_matrix:new i.bK(g),u_lighting_matrix:new i.bK(g),u_normal_matrix:new i.bK(g),u_lightpos:new i.bM(g),u_lightintensity:new i.bN(g),u_lightcolor:new i.bM(g),u_camera_pos:new i.bM(g),u_opacity:new i.bN(g),u_baseColorFactor:new i.bP(g),u_emissiveFactor:new i.bP(g),u_metallicFactor:new i.bN(g),u_roughnessFactor:new i.bN(g),u_baseTextureIsAlpha:new i.bO(g),u_alphaMask:new i.bO(g),u_alphaCutoff:new i.bN(g),u_baseColorTexture:new i.bO(g),u_metallicRoughnessTexture:new i.bO(g),u_normalTexture:new i.bO(g),u_occlusionTexture:new i.bO(g),u_emissionTexture:new i.bO(g),u_color_mix:new i.bP(g),u_aoIntensity:new i.bN(g),u_emissive_strength:new i.bN(g),u_occlusionTextureTransform:new i.bP(g)}),modelDepth:g=>({u_matrix:new i.bK(g),u_instance:new i.bK(g),u_node_matrix:new i.bK(g)}),groundShadow:g=>({u_matrix:new i.bK(g),u_ground_shadow_factor:new i.bM(g)}),stars:g=>({u_matrix:new i.bK(g),u_up:new i.bM(g),u_right:new i.bM(g),u_intensity_multiplier:new i.bN(g)})},qa;function Xa(g,c,u,_,b,S,A){let P=g.context,k=P.gl,O=g.transform,z=g.getOrCreateProgram("collisionBox"),U=[],q=0,X=0;for(let ce=0;ce<_.length;ce++){let _e=_[ce],oe=c.getTile(_e),ve=oe.getBucket(u);if(!ve)continue;let Ae=Uf(_e,ve,O),Re=Ae;b[0]===0&&b[1]===0||(Re=g.translatePosMatrix(Ae,oe,b,S));let Oe=A?ve.textCollisionBox:ve.iconCollisionBox,Je=ve.collisionCircleArray;if(Je.length>0){let Ue=i.a6.create(),ot=Re;i.a6.mul(Ue,ve.placementInvProjMatrix,O.glCoordMatrix),i.a6.mul(Ue,Ue,ve.placementViewportMatrix),U.push({circleArray:Je,circleOffset:X,transform:ot,invTransform:Ue,projection:ve.getProjection()}),q+=Je.length/4,X=q}Oe&&(g.terrain&&g.terrain.setupElevationDraw(oe,z),z.draw(g,k.LINES,ki.disabled,tn.disabled,g.colorModeForRenderPass(),Di.disabled,Tp(Re,O,oe,ve.getProjection()),u.id,Oe.layoutVertexBuffer,Oe.indexBuffer,Oe.segments,null,O.zoom,null,[Oe.collisionVertexBuffer,Oe.collisionVertexBufferExt]))}if(!A||!U.length)return;let Q=g.getOrCreateProgram("collisionCircle"),K=new i.cv;K.resize(4*q),K._trim();let re=0;for(let ce of U)for(let _e=0;_e<ce.circleArray.length/4;_e++){let oe=4*_e,ve=ce.circleArray[oe+0],Ae=ce.circleArray[oe+1],Re=ce.circleArray[oe+2],Oe=ce.circleArray[oe+3];K.emplace(re++,ve,Ae,Re,Oe,0),K.emplace(re++,ve,Ae,Re,Oe,1),K.emplace(re++,ve,Ae,Re,Oe,2),K.emplace(re++,ve,Ae,Re,Oe,3)}(!qa||qa.length<2*q)&&(qa=function(ce){let _e=2*ce,oe=new i.aw;oe.resize(_e),oe._trim();for(let ve=0;ve<_e;ve++){let Ae=6*ve;oe.uint16[Ae+0]=4*ve+0,oe.uint16[Ae+1]=4*ve+1,oe.uint16[Ae+2]=4*ve+2,oe.uint16[Ae+3]=4*ve+2,oe.uint16[Ae+4]=4*ve+3,oe.uint16[Ae+5]=4*ve+0}return oe}(q));let Y=P.createIndexBuffer(qa,!0),ae=P.createVertexBuffer(K,i.cw.members,!0);for(let ce of U){let _e={u_matrix:ce.transform,u_inv_matrix:ce.invTransform,u_camera_to_center_distance:(ge=O).getCameraToCenterDistance(ce.projection),u_viewport_size:[ge.width,ge.height]};Q.draw(g,k.TRIANGLES,ki.disabled,tn.disabled,g.colorModeForRenderPass(),Di.disabled,_e,u.id,ae,Y,i.aB.simpleSegment(0,2*ce.circleOffset,ce.circleArray.length,ce.circleArray.length/2),null,O.zoom)}var ge;ae.destroy(),Y.destroy()}let Ol=i.a6.create();function Wd(g){let c=g._camera.getWorldToCamera(g.worldSize,1),u=i.a6.multiply([],c,g.globeMatrix);i.a6.invert(u,u);let _=[0,0,0],b=[0,1,0,0];return i.a7.transformMat4(b,b,u),_[0]=b[0],_[1]=b[1],_[2]=b[2],i.N.normalize(_,_),_}function hi({width:g,height:c,anchor:u,textOffset:_,textScale:b},S){let{horizontalAlign:A,verticalAlign:P}=i.bf(u),k=-(A-.5)*g,O=-(P-.5)*c,z=i.bd(u,_);return new i.P((k/b+z[0])*S,(O/b+z[1])*S)}function X_(g,c,u,_,b,S,A,P,k,O,z){let U=g.text.placedSymbolArray,q=g.text.dynamicLayoutVertexArray,X=g.icon.dynamicLayoutVertexArray,Q={},K=g.getProjection(),re=Rd(P,K,S),Y=S.elevation,ae=K.upVectorScale(P.canonical,S.center.lat,S.worldSize).metersToTile;q.clear();for(let ge=0;ge<U.length;ge++){let ce=U.get(ge),{tileAnchorX:_e,tileAnchorY:oe,numGlyphs:ve}=ce,Ae=ce.hidden||!ce.crossTileID||g.allowVerticalPlacement&&!ce.placedOrientation?null:_[ce.crossTileID];if(Ae){let Re=0,Oe=0,Je=0;if(Y){let Dt=Y?Y.getAtTileOffset(P,_e,oe):0,[jt,Ut,ti]=K.upVector(P.canonical,_e,oe);Re=Dt*jt*ae,Oe=Dt*Ut*ae,Je=Dt*ti*ae}let[Ue,ot,nt,Rt]=Ma(ce.projectedAnchorX+Re,ce.projectedAnchorY+Oe,ce.projectedAnchorZ+Je,u?re:A),je=E_(S.getCameraToCenterDistance(K),Rt),tt=b.evaluateSizeForFeature(g.textSizeData,O,ce)*je/i.bc;u&&(tt*=g.tilePixelRatio/k);let Fe=hi(Ae,tt);u?({x:Ue,y:ot,z:nt}=K.projectTilePoint(_e+Fe.x,oe+Fe.y,P.canonical),[Ue,ot,nt]=Ma(Ue+Re,ot+Oe,nt+Je,A)):(c&&Fe._rotate(-S.angle),Ue+=Fe.x,ot+=Fe.y,nt=0);let Ze=g.allowVerticalPlacement&&ce.placedOrientation===i.b6.vertical?Math.PI/2:0;for(let Dt=0;Dt<ve;Dt++)i.b9(q,Ue,ot,nt,Ze);z&&ce.associatedIconIndex>=0&&(Q[ce.associatedIconIndex]={x:Ue,y:ot,z:nt,angle:Ze})}else bc(ve,q)}if(z){X.clear();let ge=g.icon.placedSymbolArray;for(let ce=0;ce<ge.length;ce++){let _e=ge.get(ce),{numGlyphs:oe}=_e,ve=Q[ce];if(_e.hidden||!ve)bc(oe,X);else{let{x:Ae,y:Re,z:Oe,angle:Je}=ve;for(let Ue=0;Ue<oe;Ue++)i.b9(X,Ae,Re,Oe,Je)}}g.icon.dynamicLayoutVertexBuffer.updateData(X)}g.text.dynamicLayoutVertexBuffer.updateData(q)}function Ip(g,c,u,_,b,S,A={}){let P=u.paint.get("icon-translate"),k=u.paint.get("text-translate"),O=u.paint.get("icon-translate-anchor"),z=u.paint.get("text-translate-anchor"),U=u.layout.get("icon-rotation-alignment"),q=u.layout.get("text-rotation-alignment"),X=u.layout.get("icon-pitch-alignment"),Q=u.layout.get("text-pitch-alignment"),K=u.layout.get("icon-keep-upright"),re=u.layout.get("text-keep-upright"),Y=u.paint.get("icon-color-saturation"),ae=g.context,ge=ae.gl,ce=g.transform,_e=U==="map",oe=q==="map",ve=X==="map",Ae=Q==="map",Re=u.layout.get("symbol-sort-key").constantOr(1)!==void 0,Oe=!1,Je=g.depthModeForSublayer(0,ki.ReadOnly),Ue=[i.a5(ce.center.lng),i.ae(ce.center.lat)],ot=u.layout.get("text-variable-anchor"),nt=ce.projection.name==="globe",Rt=[],je=[0,-1,0];for(let tt of _){let Fe=c.getTile(tt),Ze=Fe.getBucket(u);if(!Ze||Ze.projection.name==="mercator"&&nt||Ze.fullyClipped)continue;let Dt=Ze.projection.name==="globe",jt=Dt?i.S(ce.zoom):0,Ut=Rd(tt,Ze.getProjection(),ce),ti=ce.calculatePixelsToTileUnitsMatrix(Fe),mi=ot&&Ze.hasTextData(),Ei=Ze.hasIconTextFit()&&mi&&Ze.hasIconData(),xi=Ze.getProjection().createInversionMatrix(ce,tt.canonical),Si=()=>{let Kr=_e&&u.layout.get("symbol-placement")!=="point",Cn=[],er=Kr||Ei,In=u.paint.get("icon-image-cross-fade").constantOr(0);g.terrainRenderModeElevated()&&ve&&Cn.push("PITCH_WITH_MAP_TERRAIN"),Dt&&(Cn.push("PROJECTION_GLOBE_VIEW"),er&&Cn.push("PROJECTED_POS_ON_VIEWPORT")),In>0&&Cn.push("ICON_TRANSITION"),Ze.icon.zOffsetVertexBuffer&&Cn.push("Z_OFFSET"),Y<1&&Cn.push("SATURATION");let Kn=Ze.icon.programConfigurations.get(u.id),Nr=g.getOrCreateProgram(Ze.sdfIcons?"symbolSDF":"symbolIcon",{config:Kn,defines:Cn}),ar,Vs=Fe.imageAtlasTexture?Fe.imageAtlasTexture.size:[0,0],oo=Ze.iconSizeData,qo=i.b5(oo,ce.zoom),vl=ve||ce.pitch!==0,Xo=Id(Ut,Fe.tileID.canonical,ve,_e,ce,Ze.getProjection(),ti),Gs=Df(Ut,Fe.tileID.canonical,ve,_e,ce,Ze.getProjection(),ti),Rs=g.translatePosMatrix(Gs,Fe,P,O,!0),Mo=g.translatePosMatrix(Ut,Fe,P,O),Fo=er?Ol:Xo,Zo=_e&&!ve&&!Kr,xl=je;!nt&&!ce.mercatorFromTransition||_e||(xl=Wd(ce));let Lc=Dt?xl:je;ar=Ze.sdfIcons&&!Ze.iconsInText?Vd(oo.kind,qo,Zo,ve,g,Mo,Fo,Rs,!1,Vs,!0,tt,jt,Ue,xi,Lc,Ze.getProjection()):Ep(oo.kind,qo,Zo,ve,g,Mo,Fo,Rs,!1,Vs,tt,jt,Ue,xi,Lc,Ze.getProjection(),Y,In);let v0=Fe.imageAtlasTexture?Fe.imageAtlasTexture:null,hu=u.layout.get("icon-size").constantOr(0)!==1||Ze.iconsNeedLinear,du=Ze.sdfIcons||g.options.rotating||g.options.zooming||hu||vl?ge.LINEAR:ge.NEAREST,$m=Ze.sdfIcons&&u.paint.get("icon-halo-width").constantOr(1)!==0,uu=g.terrain&&ve&&Kr?i.a6.invert(i.a6.create(),Xo):Ol;if(Kr&&Ze.icon){let yh=ce.elevation,Bp=yh?yh.getAtTileOffsetFunc(tt,ce.center.lat,ce.worldSize,Ze.getProjection()):null,Ul=kf(Ut,Fe.tileID.canonical,ve,_e,ce,Ze.getProjection(),ti);Ff(Ze,Ut,g,!1,Ul,Gs,ve,K,Bp,tt)}return{program:Nr,buffers:Ze.icon,uniformValues:ar,atlasTexture:v0,atlasTextureIcon:null,atlasInterpolation:du,atlasInterpolationIcon:null,isSDF:Ze.sdfIcons,hasHalo:$m,tile:Fe,labelPlaneMatrixInv:uu}},gn=()=>{let Kr=oe&&u.layout.get("symbol-placement")!=="point",Cn=[],er=Kr||ot||Ei;g.terrainRenderModeElevated()&&Ae&&Cn.push("PITCH_WITH_MAP_TERRAIN"),Dt&&(Cn.push("PROJECTION_GLOBE_VIEW"),er&&Cn.push("PROJECTED_POS_ON_VIEWPORT")),Ze.text.zOffsetVertexBuffer&&Cn.push("Z_OFFSET");let In=Ze.text.programConfigurations.get(u.id),Kn=g.getOrCreateProgram(Ze.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:In,defines:Cn}),Nr,ar=[0,0],Vs=null,oo=Ze.textSizeData;Ze.iconsInText&&(ar=Fe.imageAtlasTexture?Fe.imageAtlasTexture.size:[0,0],Vs=Fe.imageAtlasTexture?Fe.imageAtlasTexture:null,Nr=Ae||ce.pitch!==0||g.options.rotating||g.options.zooming||oo.kind==="composite"||oo.kind==="camera"?ge.LINEAR:ge.NEAREST);let qo=Fe.glyphAtlasTexture?Fe.glyphAtlasTexture.size:[0,0],vl=i.b5(oo,ce.zoom),Xo=Id(Ut,Fe.tileID.canonical,Ae,oe,ce,Ze.getProjection(),ti),Gs=Df(Ut,Fe.tileID.canonical,Ae,oe,ce,Ze.getProjection(),ti),Rs=g.translatePosMatrix(Gs,Fe,k,z,!0),Mo=g.translatePosMatrix(Ut,Fe,k,z),Fo=er?Ol:Xo,Zo=oe&&!Ae&&!Kr,xl=je;!nt&&!ce.mercatorFromTransition||oe||(xl=Wd(ce));let Lc=Dt?xl:je,v0;v0=Ze.iconsInText?Ap(oo.kind,vl,Zo,Ae,g,Mo,Fo,Rs,qo,ar,tt,jt,Ue,xi,Lc,Ze.getProjection()):Vd(oo.kind,vl,Zo,Ae,g,Mo,Fo,Rs,!0,qo,!0,tt,jt,Ue,xi,Lc,Ze.getProjection());let hu=Fe.glyphAtlasTexture?Fe.glyphAtlasTexture:null,du=ge.LINEAR,$m=u.paint.get("text-halo-width").constantOr(1)!==0,uu=g.terrain&&Ae&&Kr?i.a6.invert(i.a6.create(),Xo):Ol;if(Kr&&Ze.text){let yh=ce.elevation,Bp=yh?yh.getAtTileOffsetFunc(tt,ce.center.lat,ce.worldSize,Ze.getProjection()):null,Ul=kf(Ut,Fe.tileID.canonical,Ae,oe,ce,Ze.getProjection(),ti);Ff(Ze,Ut,g,!0,Ul,Gs,Ae,re,Bp,tt)}return{program:Kn,buffers:Ze.text,uniformValues:v0,atlasTexture:hu,atlasTextureIcon:Vs,atlasInterpolation:du,atlasInterpolationIcon:Nr,isSDF:!0,hasHalo:$m,tile:Fe,labelPlaneMatrixInv:uu}},Zi=Ze.icon.segments.get().length,hn=Ze.text.segments.get().length,an=Zi&&!A.onlyText?Si():null,Wn=hn&&!A.onlyIcons?gn():null,Dr=u.paint.get("icon-opacity").constantOr(1),An=u.paint.get("text-opacity").constantOr(1);if(Re&&Ze.canOverlap){Oe=!0;let Kr=Dr&&!A.onlyText?Ze.icon.segments.get():[],Cn=An&&!A.onlyIcons?Ze.text.segments.get():[];for(let er of Kr)Rt.push({segments:new i.aB([er]),sortKey:er.sortKey,state:an});for(let er of Cn)Rt.push({segments:new i.aB([er]),sortKey:er.sortKey,state:Wn})}else A.onlyText||Rt.push({segments:Dr?Ze.icon.segments:new i.aB([]),sortKey:0,state:an}),A.onlyIcons||Rt.push({segments:An?Ze.text.segments:new i.aB([]),sortKey:0,state:Wn})}Oe&&Rt.sort((tt,Fe)=>tt.sortKey-Fe.sortKey);for(let tt of Rt){let Fe=tt.state;if(Fe)if(g.terrain&&g.terrain.setupElevationDraw(Fe.tile,Fe.program,{useDepthForOcclusion:ce.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Fe.labelPlaneMatrixInv}),ae.activeTexture.set(ge.TEXTURE0),Fe.atlasTexture&&Fe.atlasTexture.bind(Fe.atlasInterpolation,ge.CLAMP_TO_EDGE,!0),Fe.atlasTextureIcon&&(ae.activeTexture.set(ge.TEXTURE1),Fe.atlasTextureIcon&&Fe.atlasTextureIcon.bind(Fe.atlasInterpolationIcon,ge.CLAMP_TO_EDGE,!0)),g.uploadCommonLightUniforms(g.context,Fe.program),Fe.hasHalo){let Ze=Fe.uniformValues;Ze.u_is_halo=1,Ec(Fe.buffers,tt.segments,u,g,Fe.program,Je,b,S,Ze,2),Ze.u_is_halo=0}else{if(Fe.isSDF){let Ze=Fe.uniformValues;Fe.hasHalo&&(Ze.u_is_halo=1,Ec(Fe.buffers,tt.segments,u,g,Fe.program,Je,b,S,Ze,1)),Ze.u_is_halo=0}Ec(Fe.buffers,tt.segments,u,g,Fe.program,Je,b,S,Fe.uniformValues,1)}}}function Ec(g,c,u,_,b,S,A,P,k,O){let z=[g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer,g.iconTransitioningVertexBuffer,g.globeExtVertexBuffer,g.zOffsetVertexBuffer];b.draw(_,_.context.gl.TRIANGLES,S,A,P,Di.disabled,k,u.id,g.layoutVertexBuffer,g.indexBuffer,c,u.paint,_.transform.zoom,g.programConfigurations.get(u.id),z,O)}function m0(g,c,u,_,b,S,A){let P=g.context.gl,k=u.paint.get("fill-pattern"),O=k&&k.constantOr(1),z,U,q,X,Q;A?(U=O&&!u.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",z=P.LINES):(U=O?"fillPattern":"fill",z=P.TRIANGLES);for(let K of _){let re=c.getTile(K);if(O&&!re.patternsLoaded())continue;let Y=re.getBucket(u);if(!Y)continue;g.prepareDrawTile();let ae=Y.programConfigurations.get(u.id),ge=g.isTileAffectedByFog(K),ce=g.getOrCreateProgram(U,{config:ae,overrideFog:ge});O&&(g.context.activeTexture.set(P.TEXTURE0),re.imageAtlasTexture&&re.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),ae.updatePaintBuffers());let _e=k.constantOr(null);if(_e&&re.imageAtlas){let Ae=re.imageAtlas.patternPositions[_e.toString()];Ae&&ae.setConstantPatternPositions(Ae)}let oe=g.translatePosMatrix(K.projMatrix,re,u.paint.get("fill-translate"),u.paint.get("fill-translate-anchor")),ve=u.paint.get("fill-emissive-strength");if(A){X=Y.indexBuffer2,Q=Y.segments2;let Ae=g.terrain&&g.terrain.renderingToTexture?g.terrain.drapeBufferSize:[P.drawingBufferWidth,P.drawingBufferHeight];q=U==="fillOutlinePattern"&&O?G_(oe,ve,g,re,Ae):f0(oe,ve,Ae)}else X=Y.indexBuffer,Q=Y.segments,q=O?mm(oe,ve,g,re):ph(oe,ve);g.uploadCommonUniforms(g.context,ce,K.toUnwrapped()),ce.draw(g,z,b,g.stencilModeForClipping(K),S,Di.disabled,q,u.id,Y.layoutVertexBuffer,X,Q,u.paint,g.transform.zoom,ae,void 0)}}function _i(g,c,u,_,b,S,A,P){u.resetLayerRenderingStats(g);let k=g.context,O=k.gl,z=g.transform,U=u.paint.get("fill-extrusion-pattern"),q=U.constantOr(1),X=u.paint.get("fill-extrusion-opacity"),Q=g.style.enable3dLights(),K=u.paint.get(Q&&!q?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),re=[u.paint.get("fill-extrusion-ambient-occlusion-intensity"),K],Y=u.layout.get("fill-extrusion-edge-radius"),ae=Y>0&&!u.paint.get("fill-extrusion-rounded-roof"),ge=ae?0:Y,ce=z.projection.name==="globe"?i.cF():0,_e=z.projection.name==="globe",oe=_e?i.S(z.zoom):0,ve=[i.a5(z.center.lng),i.ae(z.center.lat)],Ae=u.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),Re=u.paint.get("fill-extrusion-flood-light-intensity"),Oe=u.paint.get("fill-extrusion-vertical-scale"),Je=Sc(g,u.paint.get("fill-extrusion-cutoff-fade-range")),Ue=u.paint.get("fill-extrusion-emissive-strength"),ot=[],nt;_e&&ot.push("PROJECTION_GLOBE_VIEW"),re[0]>0&&ot.push("FAUX_AO"),ae&&ot.push("ZERO_ROOF_RADIUS"),P&&ot.push("HAS_CENTROID"),Re>0&&ot.push("FLOOD_LIGHT"),Je.shouldRenderCutoff&&ot.push("RENDER_CUTOFF");let Rt=g.renderPass==="shadow",je=g.shadowRenderer,tt=Rt&&!!je;g.shadowRenderer&&(g.shadowRenderer.useNormalOffset=!0);let Fe=[0,0,0];if(je){let jt=g.style.directionalLight,Ut=g.style.ambientLight;jt&&Ut&&(Fe=Nd(jt,Ut)),nt=ot.concat(["SHADOWS_SINGLE_CASCADE"])}let Ze=tt?"fillExtrusionDepth":q?"fillExtrusionPattern":"fillExtrusion",Dt=u.getLayerRenderingStats();for(let jt of _){let Ut=c.getTile(jt),ti=Ut.getBucket(u);if(!ti||ti.projection.name!==z.projection.name)continue;let mi=!1;je&&(mi=je.getMaxCascadeForTile(jt.toUnwrapped())===0);let Ei=g.isTileAffectedByFog(jt),xi=ti.programConfigurations.get(u.id),Si=g.getOrCreateProgram(Ze,{config:xi,defines:mi?nt:ot,overrideFog:Ei});if(g.terrain&&g.terrain.setupElevationDraw(Ut,Si,{useMeterToDem:!0}),!ti.centroidVertexBuffer){let Dr=Si.attributes.a_centroid_pos;Dr!==void 0&&O.vertexAttrib2f(Dr,0,0)}!Rt&&je&&je.setupShadows(Ut.tileID.toUnwrapped(),Si,"vector-tile",Ut.tileID.overscaledZ),q&&(g.context.activeTexture.set(O.TEXTURE0),Ut.imageAtlasTexture&&Ut.imageAtlasTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),xi.updatePaintBuffers());let gn=U.constantOr(null);if(gn&&Ut.imageAtlas){let Dr=Ut.imageAtlas.patternPositions[gn.toString()];Dr&&xi.setConstantPatternPositions(Dr)}let Zi=u.paint.get("fill-extrusion-vertical-gradient"),hn;if(Rt&&je){if($_(Ut.tileID,ti,g))continue;let Dr=je.calculateShadowPassMatrixFromTile(Ut.tileID.toUnwrapped());hn=fm(Dr,ge,Oe)}else{let Dr=g.translatePosMatrix(jt.expandedProjMatrix,Ut,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),An=z.projection.createInversionMatrix(z,jt.canonical);hn=q?p0(Dr,g,Zi,X,re,ge,jt,Ut,ce,oe,ve,An,Ae,Oe):pm(Dr,g,Zi,X,re,ge,jt,ce,oe,ve,An,Ae,Oe,Re,Fe,Ue)}g.uploadCommonUniforms(k,Si,jt.toUnwrapped(),null,Je);let an=ti.segments;if(z.projection.name==="mercator"&&!Rt&&(an=ti.getVisibleSegments(Ut.tileID,g.terrain,g.transform.getFrustum(0)),!an.get().length))continue;if(Dt)if(Rt)for(let Dr of an.get())Dt.numRenderedVerticesInShadowPass+=Dr.primitiveLength;else for(let Dr of an.get())Dt.numRenderedVerticesInTransparentPass+=Dr.primitiveLength;let Wn=[];(g.terrain||P)&&Wn.push(ti.centroidVertexBuffer),_e&&Wn.push(ti.layoutVertexExtBuffer),Si.draw(g,k.gl.TRIANGLES,b,S,A,Di.backCCW,hn,u.id,ti.layoutVertexBuffer,ti.indexBuffer,an,u.paint,g.transform.zoom,xi,Wn)}g.shadowRenderer&&(g.shadowRenderer.useNormalOffset=!1)}function Ac(g,c,u,_,b,S,A,P,k,O,z,U,q,X,Q,K,re,Y,ae){let ge=g.context,ce=ge.gl,_e=g.transform,oe=g.transform.zoom,ve=[],Ae=Sc(g,u.paint.get("fill-extrusion-cutoff-fade-range"));O==="clear"?(ve.push("CLEAR_SUBPASS"),ae&&(ve.push("CLEAR_FROM_TEXTURE"),ge.activeTexture.set(ce.TEXTURE0),ae.bind(ce.LINEAR,ce.CLAMP_TO_EDGE))):O==="sdf"&&ve.push("SDF_SUBPASS"),re&&ve.push("HAS_CENTROID"),Ae.shouldRenderCutoff&&ve.push("RENDER_CUTOFF");let Re=u.layout.get("fill-extrusion-edge-radius"),Oe=(Je,Ue,ot,nt,Rt)=>{let je=Ue.programConfigurations.get(u.id),tt=g.isTileAffectedByFog(Je),Fe=g.getOrCreateProgram("fillExtrusionGroundEffect",{config:je,defines:ve,overrideFog:tt}),Ze=((jt,Ut,ti,mi,Ei,xi,Si,gn,Zi,hn,an)=>({u_matrix:Ut,u_opacity:ti,u_ao_pass:mi?1:0,u_meter_to_tile:Ei,u_ao:xi,u_flood_light_intensity:Si,u_flood_light_color:gn,u_attenuation:Zi,u_edge_radius:hn,u_fb:0,u_fb_size:an}))(0,nt,z,k,Rt,[U,q*Rt],X,Q,K,oe>=17?0:Re*Rt,ae?ae.size[0]:0),Dt=[];re&&Dt.push(Ue.hiddenByLandmarkVertexBuffer),g.uploadCommonUniforms(ge,Fe,Je.toUnwrapped(),null,Ae),Fe.draw(g,ge.gl.TRIANGLES,b,S,A,P,Ze,u.id,Ue.vertexBuffer,Ue.indexBuffer,ot,u.paint,oe,je,Dt)};for(let Je of _){let Ue=c.getTile(Je),ot=Ue.getBucket(u);if(!ot||ot.projection.name!==_e.projection.name||!ot.groundEffect||ot.groundEffect&&!ot.groundEffect.hasData())continue;let nt=ot.groundEffect,Rt=1/ot.tileToMeter;{let je=g.translatePosMatrix(Je.projMatrix,Ue,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),tt=nt.getDefaultSegment();Oe(Je,nt,tt,je,Rt)}if(Y)for(let je=0;je<4;je++){let tt=i.cG[je](Je),Fe=c.getTile(tt);if(!Fe)continue;let Ze=Fe.getBucket(u);if(!Ze||Ze.projection.name!==_e.projection.name||!Ze.groundEffect||Ze.groundEffect&&!Ze.groundEffect.hasData())continue;let Dt=Ze.groundEffect,jt,Ut;je===0?(jt=[-i.V,0,0],Ut=1):je===1?(jt=[i.V,0,0],Ut=0):je===2?(jt=[0,-i.V,0],Ut=3):(jt=[0,i.V,0],Ut=2);let ti=Dt.regionSegments[Ut];if(!ti)continue;let mi=new Float32Array(16);i.a6.translate(mi,Je.projMatrix,jt),Oe(Je,Dt,ti,g.translatePosMatrix(mi,Ue,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),Rt)}}}function Uy(g,c,u,_,b,S,A){_.centroidVertexArray.length===0&&_.createCentroidsBuffer();let P=S?S.findDEMTileFor(u):null;if(!(P&&P.dem||A))return;let k=Y=>new i.P(Math.ceil((Y+i.cJ)*i.cK),0),O=Y=>{let ae=c.getSource().minzoom,ge=_e=>{let oe=c.getTileByID(_e);if(oe&&oe.hasData())return oe.getBucket(b)},ce=[0,-1,1];for(let _e of ce){if(Y.overscaledZ+_e<ae)continue;let oe=ge(Y.calculateScaledKey(Y.overscaledZ+_e));if(oe)return oe}},z=[0,0,0],U=(Y,ae)=>(z[0]=Math.min(Y.min.y,ae.min.y),z[1]=Math.max(Y.max.y,ae.max.y),z[2]=i.V-ae.min.x>Y.max.x?ae.min.x-i.V:Y.max.x,z),q=(Y,ae)=>(z[0]=Math.min(Y.min.x,ae.min.x),z[1]=Math.max(Y.max.x,ae.max.x),z[2]=i.V-ae.min.y>Y.max.y?ae.min.y-i.V:Y.max.y,z),X=[(Y,ae)=>U(Y,ae),(Y,ae)=>U(ae,Y),(Y,ae)=>q(Y,ae),(Y,ae)=>q(ae,Y)],Q=(Y,ae,ge,ce,_e,oe,ve)=>{if(!S)return 0;let Ae=[[oe?ge:Y,oe?Y:ge,0],[oe?ge:ae,oe?ae:ge,0]],Re=ve<0?i.V+ve:ve,Oe=[oe?Re:(Y+ae)/2,oe?(Y+ae)/2:Re,0];return ge===0&&ve<0||ge!==0&&ve>0?S.getForTilePoints(_e,[Oe],!0,ce):Ae.push(Oe),S.getForTilePoints(u,Ae,!0,P),Math.max(Ae[0][2],Ae[1][2],Oe[2])/S.exaggeration()};for(let Y=0;Y<4;Y++){let ae=_.borderFeatureIndices[Y];if(ae.length===0)continue;let ge=i.cG[Y](u),ce=O(ge);if(!(ce&&ce instanceof i.cH)||_.borderDoneWithNeighborZ[Y]===ce.canonical.z)continue;ce.centroidVertexArray.length===0&&ce.createCentroidsBuffer();let _e=S?S.findDEMTileFor(ge):null;if(!(_e&&_e.dem||A))continue;let oe=(Y<2?1:5)-Y,ve=ce.borderDoneWithNeighborZ[oe]!==_.canonical.z,Ae=ce.borderFeatureIndices[oe],Re=0;if(_.canonical.z!==ce.canonical.z){for(let Oe of ae)_.showCentroid(_.featuresOnBorder[Oe]);if(ve)for(let Oe of Ae)ce.showCentroid(ce.featuresOnBorder[Oe]);_.borderDoneWithNeighborZ[Y]=ce.canonical.z,ce.borderDoneWithNeighborZ[oe]=_.canonical.z}for(let Oe of ae){let Je=_.featuresOnBorder[Oe],Ue=_.centroidData[Je.centroidDataIndex],ot=Je.borders[Y],nt;for(;Re<Ae.length;){nt=ce.featuresOnBorder[Ae[Re]];let Rt=nt.borders[oe];if(Rt[1]>ot[0]+3||Rt[0]>ot[0]-3)break;ce.showCentroid(nt),Re++}if(nt&&Re<Ae.length){let Rt=Re,je=0;for(;!(nt.borders[oe][0]>ot[1]-3)&&(je++,++Re!==Ae.length);)nt=ce.featuresOnBorder[Ae[Re]];if(nt=ce.featuresOnBorder[Ae[Rt]],je>1){let Ze=nt.borders[oe];Math.abs(ot[0]-Ze[0])<3&&Math.abs(ot[1]-Ze[1])<3&&(je=1,Re=Rt+1)}else if(je===0){_.showCentroid(Je);continue}let tt=ce.centroidData[nt.centroidDataIndex];A&&je===1&&(((K=Ue).flags|(re=tt).flags)&i.cI?(K.flags|=i.cI,re.flags|=i.cI):(K.flags&=~i.cI,re.flags&=~i.cI));let Fe=Je.intersectsCount()>1||nt.intersectsCount()>1;if(je>1)Re=Rt,Ue.centroidXY=tt.centroidXY=new i.P(0,0);else if(_e&&_e.dem&&!Fe){let Ze=X[Y](Ue,tt),Dt=Y%2?i.V-1:0,jt=Q(Ze[0],Math.min(i.V-1,Ze[1]),Dt,_e,ge,Y<2,Ze[2]);Ue.centroidXY=tt.centroidXY=k(jt)}else Fe?Ue.centroidXY=tt.centroidXY=new i.P(0,0):(Ue.centroidXY=_.encodeBorderCentroid(Je),tt.centroidXY=ce.encodeBorderCentroid(nt));_.writeCentroidToBuffer(Ue),ce.writeCentroidToBuffer(tt)}else _.showCentroid(Je)}_.borderDoneWithNeighborZ[Y]=ce.canonical.z,ce.borderDoneWithNeighborZ[oe]=_.canonical.z}var K,re;(_.needsCentroidUpdate||!_.centroidVertexBuffer&&_.centroidVertexArray.length!==0)&&_.uploadCentroid(g)}let Vy=[1,0,0],xm=[0,1,0],Z_=[0,0,1];function $_(g,c,u){let _=u.transform,b=u.shadowRenderer;if(!b)return!0;let S=g.toUnwrapped(),A=_.tileSize*b._cascades[u.currentShadowCascade].scale,P=c.maxHeight;if(_.elevation){let K=_.elevation.getMinMaxForTile(g);K&&(P+=K.max)}let k=[...b.shadowDirection];k[2]=-k[2];let O=b.computeSimplifiedTileShadowVolume(S,P,A,k);if(!O)return!1;let z=[Vy,xm,Z_,k,[k[0],0,k[2]],[0,k[1],k[2]]],U=_.projection.name==="globe",q=_.scaleZoom(A),X=i.bq.fromInvProjectionMatrix(_.invProjMatrix,_.worldSize,q,!U),Q=b.getCurrentCascadeFrustum();return X.intersectsPrecise(O.vertices,O.planes,z)===0||Q.intersectsPrecise(O.vertices,O.planes,z)===0}function Y_(g){return[g[0]*i.cL,g[1]*i.cL,g[2]*i.cL,0]}function bm(g,c,u,_,b,S,A,P,k){let O=_.getSource(),z=u.globeSharedBuffers;if(!z)return;let U,q,X;if(c&&(U=_.getTile(c)),O instanceof i.ap?(q=O.texture,X=i.cj(0,0,u.transform)):U&&c&&(q=U.texture,X=i.cj(c.canonical.z,c.canonical.x,u.transform)),!q||!X)return;g||(X=i.a6.scale(i.a6.create(),X,[1,-1,1]));let Q=u.context,K=Q.gl,re=b.paint.get("raster-resampling")==="nearest"?K.NEAREST:K.LINEAR,Y=u.colorModeForDrapableLayerRenderPass(S),ae=A.defines;ae.push("GLOBE_POLES");let ge=new ki(K.LEQUAL,ki.ReadWrite,u.depthRangeFor3D),ce=Float32Array.from(u.transform.expandedFarZProjMatrix),_e=Float32Array.from(i.aT(i.ci(new i.bs(0,0,0))));u.terrain&&u.terrain.prepareDrawTile(),Q.activeTexture.set(K.TEXTURE0),q.bind(re,K.CLAMP_TO_EDGE),Q.activeTexture.set(K.TEXTURE1),q.bind(re,K.CLAMP_TO_EDGE),q.useMipmap&&Q.extTextureFilterAnisotropic&&u.transform.pitch>20&&K.texParameterf(K.TEXTURE_2D,Q.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Q.extTextureFilterAnisotropicMax);let[oe,ve,Ae,Re]=c?z.getPoleBuffers(c.canonical.z,!1):z.getPoleBuffers(0,!0),Oe=b.paint.get("raster-elevation"),Je;g?(Je=oe,u.renderDefaultNorthPole=Oe!==0):(Je=ve,u.renderDefaultSouthPole=Oe!==0);let Ue=Y_(A.mix),ot=((Rt,je,tt,Fe,Ze,Dt,jt,Ut,ti,mi,Ei,xi,Si)=>ym(Rt,je,tt,new Float32Array(16),new Float32Array(9),[0,0],Fe,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Dt,[0,0],Ut,2,mi,Ei,xi,1,0,Si))(ce,_e,X,i.S(u.transform.zoom),0,b,0,Oe,0,Ue,A.offset,A.range,S),nt=u.getOrCreateProgram("raster",{defines:ae});u.uploadCommonUniforms(Q,nt,null),nt.draw(u,K.TRIANGLES,ge,k,Y,P,ot,b.id,Je,Ae,Re)}function wm(g){let c=g._nearZ,u=g.projection.farthestPixelDistance(g),_=u-c,b=.2*g.height,S=c+b;return[c,u,(S-b-c)/_,(S-c)/_]}function Sm(g,c,u,_){if(g)return c instanceof Gt&&g instanceof a0?c.getTextureDescriptor(g,u,!0):{texture:g.texture,mix:Y_(_.mix),offset:_.offset,buffer:0,tileSize:1}}function Tm(g,c,u){if(!g)return null;let _=c.getTextureDescriptor(g,u,!0);if(!_)return null;let{texture:b,mix:S,offset:A,tileSize:P,buffer:k,format:O}=_;if(!b||!O)return null;let z=!1;return O==="uint32"&&(z=!0,S[3]=0,S=Mp(i.cM,S,[0,u.paint.get("raster-particle-max-speed")]),A=j_(i.cM,A,[0,u.paint.get("raster-particle-max-speed")])),{texture:b,textureOffset:[k/(P+2*k),P/(P+2*k)],tileSize:P,scalarData:z,scale:S,offset:A,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[O]]}}function Mm(g){let c=g._nearZ,u=g.projection.farthestPixelDistance(g),_=u-c,b=.2*g.height,S=c+b;return[c,u,(S-b-c)/_,(S-c)/_]}let jo=new i.ax(1,0,0,1),Cc=new i.ax(0,1,0,1),J_=new i.ax(0,0,1,1),Em=new i.ax(1,0,1,1),Am=new i.ax(0,1,1,1);function Ic(g,c,u,_,b,S,A){let P=g.context,k=g.transform,O=P.gl,z=k.projection.name==="globe",U=z?["PROJECTION_GLOBE_VIEW"]:[],q=i.a6.clone(u.projMatrix);if(z&&i.S(k.zoom)>0){let Ue=i.aS(u.canonical,k),ot=i.cN(Ue);q=i.a6.multiply(new Float32Array(16),k.globeMatrix,ot),i.a6.multiply(q,k.projMatrix,q)}let X=i.a6.create();X[12]+=2*b/(i.f.devicePixelRatio*k.width),X[13]+=2*S/(i.f.devicePixelRatio*k.height),i.a6.multiply(q,X,q);let Q=g.getOrCreateProgram("debug",{defines:U}),K=c.getTileByID(u.key);g.terrain&&g.terrain.setupElevationDraw(K,Q);let re=ki.disabled,Y=tn.disabled,ae=g.colorModeForRenderPass(),ge="$debug";P.activeTexture.set(O.TEXTURE0),g.emptyTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),z?K._makeGlobeTileDebugBuffers(g.context,k):K._makeDebugTileBoundsBuffers(g.context,k.projection);let ce=K._tileDebugBuffer||g.debugBuffer,_e=K._tileDebugIndexBuffer||g.debugIndexBuffer,oe=K._tileDebugSegments||g.debugSegments;if(Q.draw(g,O.LINE_STRIP,re,Y,ae,Di.disabled,gm(q,_),ge,ce,_e,oe,null,null,null,[K._globeTileDebugBorderBuffer]),A){let Ue=K.latestRawTileData,ot=Math.floor((Ue&&Ue.byteLength||0)/1024),nt=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(nt+=` => ${u.overscaledZ}`),nt+=` ${K.state}`,nt+=` ${ot}kb`,function(Rt,je){Rt.initDebugOverlayCanvas();let tt=Rt.debugOverlayCanvas,Fe=Rt.context.gl,Ze=Rt.debugOverlayCanvas.getContext("2d");Ze.clearRect(0,0,tt.width,tt.height),Ze.shadowColor="white",Ze.shadowBlur=2,Ze.lineWidth=1.5,Ze.strokeStyle="white",Ze.textBaseline="top",Ze.font="bold 36px Open Sans, sans-serif",Ze.fillText(je,5,5),Ze.strokeText(je,5,5),Rt.debugOverlayTexture.update(tt),Rt.debugOverlayTexture.bind(Fe.LINEAR,Fe.CLAMP_TO_EDGE)}(g,nt)}let ve=c.getTile(u).tileSize,Ae=512/Math.min(ve,512)*(u.overscaledZ/k.zoom)*.5,Re=K._tileDebugTextBuffer||g.debugBuffer,Oe=K._tileDebugTextIndexBuffer||g.quadTriangleIndexBuffer,Je=K._tileDebugTextSegments||g.debugSegments;Q.draw(g,O.TRIANGLES,re,Y,Mn.alphaBlended,Di.disabled,gm(q,i.ax.transparent,Ae),ge,Re,Oe,Je,null,null,null,[K._globeTileDebugTextBuffer])}function Cm(g,c,u,_){Yr(g,0,c+u/2,g.transform.width,u,_)}function sa(g,c,u,_){Yr(g,c-u/2,0,u,g.transform.height,_)}function Yr(g,c,u,_,b,S){let A=g.context,P=A.gl;P.enable(P.SCISSOR_TEST),P.scissor(c*i.f.devicePixelRatio,u*i.f.devicePixelRatio,_*i.f.devicePixelRatio,b*i.f.devicePixelRatio),A.clear({color:S}),P.disable(P.SCISSOR_TEST)}let Pp=i.ay([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Im}=Pp;function Nl(g,c,u,_){g.emplaceBack(c,u,_)}class Pm{constructor(c){this.vertexArray=new i.az,this.indices=new i.aw,Nl(this.vertexArray,-1,-1,1),Nl(this.vertexArray,1,-1,1),Nl(this.vertexArray,-1,1,1),Nl(this.vertexArray,1,1,1),Nl(this.vertexArray,-1,-1,-1),Nl(this.vertexArray,1,-1,-1),Nl(this.vertexArray,-1,1,-1),Nl(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=c.createVertexBuffer(this.vertexArray,Im),this.indexBuffer=c.createIndexBuffer(this.indices),this.segment=i.aB.simpleSegment(0,0,36,12)}}function g0(g,c,u,_,b,S){let A=g.context.gl,P=c.paint.get("sky-atmosphere-color"),k=c.paint.get("sky-atmosphere-halo-color"),O=c.paint.get("sky-atmosphere-sun-intensity"),z=((U,q,X,Q,K)=>({u_matrix_3f:U,u_sun_direction:q,u_sun_intensity:X,u_color_tint_r:[Q.r,Q.g,Q.b,Q.a],u_color_tint_m:[K.r,K.g,K.b,K.a],u_luminance:5e-5}))(i.co.fromMat4(i.co.create(),_),b,O,P,k);A.framebufferTexture2D(A.FRAMEBUFFER,A.COLOR_ATTACHMENT0,A.TEXTURE_CUBE_MAP_POSITIVE_X+S,c.skyboxTexture,0),u.draw(g,A.TRIANGLES,ki.disabled,tn.disabled,Mn.unblended,Di.frontCW,z,"skyboxCapture",c.skyboxGeometry.vertexBuffer,c.skyboxGeometry.indexBuffer,c.skyboxGeometry.segment)}let Gy=i.ay([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class fh{constructor(c){let u=new i.cO;u.emplaceBack(-1,1,1,0,0),u.emplaceBack(1,1,1,1,0),u.emplaceBack(1,-1,1,1,1),u.emplaceBack(-1,-1,1,0,1);let _=new i.aw;_.emplaceBack(0,1,2),_.emplaceBack(2,3,0),this.vertexBuffer=c.createVertexBuffer(u,Gy.members),this.indexBuffer=c.createIndexBuffer(_),this.segments=i.aB.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}let qd=i.ay([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class qt{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Ai{constructor(c){this.colorModeAlphaBlendedWriteRGB=new Mn([1,gc,1,gc],i.ax.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Mn([1,0,1,0],i.ax.transparent,[!1,!1,!1,!0]),this.params=new qt,this.updateNeeded=!0,c.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),c.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),c.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),c.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(c){let u=c.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new fh(u);let _=this.params.sizeRange,b=this.params.intensityRange,S=function(z){let U=i.aA(30),q=[];for(let X=0;X<z;++X){let Q=2*Math.PI*U(),K=Math.acos(1-2*U())-.5*Math.PI;q.push(i.N.fromValues(Math.cos(K)*Math.cos(Q),Math.cos(K)*Math.sin(Q),Math.sin(K)))}return q}(this.params.starsCount),A=i.aA(300),P=new i.cP,k=new i.aw,O=0;for(let z=0;z<S.length;++z){let U=i.N.scale([],S[z],200),q=Math.max(0,1+.01*_*(1*A()-.5)),X=Math.max(0,1+.01*b*(1*A()-.5));P.emplaceBack(U[0],U[1],U[2],-1,-1,q,X),P.emplaceBack(U[0],U[1],U[2],1,-1,q,X),P.emplaceBack(U[0],U[1],U[2],1,1,q,X),P.emplaceBack(U[0],U[1],U[2],-1,1,q,X),k.emplaceBack(O+0,O+1,O+2),k.emplaceBack(O+0,O+2,O+3),O+=4}this.starsVx=u.createVertexBuffer(P,qd.members),this.starsIdx=u.createIndexBuffer(k),this.starsSegments=i.aB.simpleSegment(0,0,P.length,k.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(c,u){let _=c.context,b=_.gl,S=c.transform,A=new ki(b.LEQUAL,ki.ReadOnly,[0,1]),P=i.S(S.zoom),k=u.properties.get("color").toArray01(),O=u.properties.get("high-color").toArray01(),z=u.properties.get("space-color").toArray01PremultipliedAlpha(),U=5e-4,q=i.cQ(u.properties.get("horizon-blend"),0,1,U,.25),X=i.cd(c,_,S)&&q===U?S.worldSize/(2*Math.PI*1.025)-1:S.globeRadius,Q=c.frameCounter/1e3%1,K=i.N.length(S.globeCenterInViewSpace),re=Math.sqrt(Math.pow(K,2)-Math.pow(X,2)),Y=Math.acos(re/K),ae=ge=>{let ce=S.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];ge&&ce.push("ALPHA_PASS");let _e=c.getOrCreateProgram("globeAtmosphere",{defines:ce}),oe=((Ae,Re,Oe,Je,Ue,ot,nt,Rt,je,tt,Fe,Ze)=>({u_frustum_tl:Ae,u_frustum_tr:Re,u_frustum_br:Oe,u_frustum_bl:Je,u_horizon:Ue,u_transition:ot,u_fadeout_range:nt,u_color:Rt,u_high_color:je,u_space_color:tt,u_temporal_offset:Fe,u_horizon_angle:Ze}))(S.frustumCorners.TL,S.frustumCorners.TR,S.frustumCorners.BR,S.frustumCorners.BL,S.frustumCorners.horizon,P,q,k,O,z,Q,Y);c.uploadCommonUniforms(_,_e);let ve=this.atmosphereBuffer;ve&&_e.draw(c,b.TRIANGLES,A,tn.disabled,ge?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Di.backCW,oe,ge?"atmosphere_glow_alpha":"atmosphere_glow",ve.vertexBuffer,ve.indexBuffer,ve.segments)};ae(!1),ae(!0)}drawStars(c,u){let _=i.aa(u.properties.get("star-intensity"),0,1);if(_===0)return;let b=c.context,S=b.gl,A=c.transform,P=c.getOrCreateProgram("stars"),k=i.bi.identity([]);i.bi.rotateX(k,k,-A._pitch),i.bi.rotateZ(k,k,-A.angle),i.bi.rotateX(k,k,i.bj(A._center.lat)),i.bi.rotateY(k,k,-i.bj(A._center.lng));let O=i.a6.fromQuat(new Float32Array(16),k),z=i.a6.multiply([],A.starsProjMatrix,O),U=i.co.fromMat4([],O),q=i.co.invert([],U),X=[0,1,0];i.N.transformMat3(X,X,q),i.N.scale(X,X,this.params.sizeMultiplier);let Q=[1,0,0];i.N.transformMat3(Q,Q,q),i.N.scale(Q,Q,this.params.sizeMultiplier);let K=(re=X,Y=Q,ae=_,{u_matrix:Float32Array.from(z),u_up:re,u_right:Y,u_intensity_multiplier:ae});var re,Y,ae;c.uploadCommonUniforms(b,P),this.starsVx&&this.starsIdx&&P.draw(c,S.TRIANGLES,ki.disabled,tn.disabled,this.colorModeAlphaBlendedWriteRGB,Di.disabled,K,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function _0(g,c){let u=[...g],_=c.cameraWorldSizeForFog/c.worldSize,b=i.a6.identity([]);return i.a6.scale(b,b,[_,_,1]),i.a6.multiply(u,b,u),i.a6.multiply(u,c.worldToFogMatrix,u),u}function Jr(g,c,u,_){let b=u.material,S=_.context,{baseColorTexture:A,metallicRoughnessTexture:P}=b.pbrMetallicRoughness,{normalTexture:k,occlusionTexture:O,emissionTexture:z}=b;function U(q,X,Q){if(q&&(g.push(X),S.activeTexture.set(S.gl.TEXTURE0+Q),q.gfxTexture)){let{minFilter:K,magFilter:re,wrapS:Y,wrapT:ae}=q.sampler;q.gfxTexture.bindExtraParam(K,re,Y,ae)}}U(A,"HAS_TEXTURE_u_baseColorTexture",so.BaseColor),U(P,"HAS_TEXTURE_u_metallicRoughnessTexture",so.MetallicRoughness),U(k,"HAS_TEXTURE_u_normalTexture",so.Normal),U(O,"HAS_TEXTURE_u_occlusionTexture",so.Occlusion),U(z,"HAS_TEXTURE_u_emissionTexture",so.Emission),u.texcoordBuffer&&(g.push("HAS_ATTRIBUTE_a_uv_2f"),c.push(u.texcoordBuffer)),u.colorBuffer&&(g.push(u.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),c.push(u.colorBuffer)),u.normalBuffer&&(g.push("HAS_ATTRIBUTE_a_normal_3f"),c.push(u.normalBuffer)),u.pbrBuffer&&(g.push("HAS_ATTRIBUTE_a_pbr"),g.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),c.push(u.pbrBuffer)),b.alphaMode!=="OPAQUE"&&b.alphaMode!=="MASK"||g.push("UNPREMULT_TEXTURE_IN_SHADER"),b.defined||g.push("DIFFUSE_SHADED"),g.push("USE_STANDARD_DERIVATIVES")}function Xd(g,c,u,_,b,S){let A=u.paint.get("model-opacity"),P=c.context,k=new ki(c.context.gl.LEQUAL,ki.ReadWrite,c.depthRangeFor3D),O=c.transform,z=g.mesh,U=z.material,q=U.pbrMetallicRoughness,X=c.style.fog,Q;Q=c.transform.projection.zAxisUnit==="pixels"?[...g.nodeModelMatrix]:i.a6.multiply([],_.zScaleMatrix,g.nodeModelMatrix),i.a6.multiply(Q,_.negCameraPosMatrix,Q);let K=i.a6.invert([],Q);i.a6.transpose(K,K);let re=u.paint.get("model-emissive-strength").constantOr(0),Y=Cp(new Float32Array(g.worldViewProjection),new Float32Array(Q),new Float32Array(K),c,A,q.baseColorFactor,U.emissiveFactor,q.metallicFactor,q.roughnessFactor,U,re,u),ae={defines:[]},ge=[];Jr(ae.defines,ge,z,c);let ce=c.shadowRenderer;ce&&(ce.useNormalOffset=!1);let _e=null;if(X){let Ae=_0(g.nodeModelMatrix,c.transform);if(_e=new Float32Array(Ae),O.projection.name!=="globe"){let Re=z.aabb.min,Oe=z.aabb.max,[Je,Ue]=X.getOpacityForBounds(Ae,Re[0],Re[1],Oe[0],Oe[1]);ae.overrideFog=Je>=yi||Ue>=yi}}let oe=Sc(c,u.paint.get("model-cutoff-fade-range"));oe.shouldRenderCutoff&&ae.defines.push("RENDER_CUTOFF");let ve=c.getOrCreateProgram("model",ae);c.uploadCommonUniforms(P,ve,null,_e,oe),c.renderPass!=="shadow"&&ce&&ce.setupShadowsFromMatrix(g.nodeModelMatrix,ve),ve.draw(c,P.gl.TRIANGLES,k,b,S,z.material.doubleSided?Di.disabled:Di.backCCW,Y,u.id,z.vertexBuffer,z.indexBuffer,z.segments,u.paint,c.transform.zoom,void 0,ge)}function Zd(g,c,u,_,b,S,A){let P;P=g.projection.name==="globe"?i.cS(u,g):[...u],i.a6.multiply(P,P,c.matrix);let k=i.a6.multiply([],_,P);if(c.meshes)for(let O of c.meshes){if(O.material.alphaMode!=="BLEND"){A.push({mesh:O,depth:0,modelIndex:b,worldViewProjection:k,nodeModelMatrix:P});continue}let z=i.N.transformMat4([],O.centroid,k);z[2]>0&&S.push({mesh:O,depth:z[2],modelIndex:b,worldViewProjection:k,nodeModelMatrix:P})}if(c.children)for(let O of c.children)Zd(g,O,u,_,b,S,A)}function $e(g,c,u,_){let b=u.shadowRenderer;if(!b)return;let S=b.getShadowPassDepthMode(),A=b.getShadowPassColorMode(),P=b.calculateShadowPassMatrixFromMatrix(c),k=jd(P);u.getOrCreateProgram("modelDepth",{defines:u._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(u,u.context.gl.TRIANGLES,S,tn.disabled,A,Di.backCCW,k,_.id,g.vertexBuffer,g.indexBuffer,g.segments,_.paint,u.transform.zoom,void 0,void 0)}function Rm(g,c,u){let _=c.updateZoomBasedPaintProperties(),b=function(S,A,P){let k,O,z,U=S.terrain?S.terrain.exaggeration():0;if(S.terrain&&U>0){let q=S.terrain,X=q.findDEMTileFor(P);X&&X.dem?k=i.cU.create(q,P,X):U=0}if(U===0&&(A.terrainElevationMin=0,A.terrainElevationMax=0),U===A.validForExaggeration&&(U===0||k&&k._demTile&&k._demTile.tileID===A.validForDEMTile.id&&k._dem._timestamp===A.validForDEMTile.timestamp))return!1;for(let q in A.instancesPerModel){let X=A.instancesPerModel[q];for(let Q=0;Q<X.instancedDataArray.length;++Q){let K=(k?U*k.getElevationAt(0|X.instancedDataArray.float32[16*Q],0|X.instancedDataArray.float32[16*Q+1],!0,!0):0)+X.instancesEvaluatedElevation[Q];X.instancedDataArray.float32[16*Q+6]=K,O=O?Math.min(A.terrainElevationMin,K):K,z=z?Math.max(A.terrainElevationMax,K):K}}return A.terrainElevationMin=O||0,A.terrainElevationMax=z||0,A.validForExaggeration=U,A.validForDEMTile=k&&k._demTile?{id:k._demTile.tileID,timestamp:k._dem._timestamp}:{id:void 0,timestamp:0},!0}(g,c,u);(_||b)&&(c.uploaded=!1,c.upload(g.context))}let oa={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new i.bS([0,0,0],[i.V,i.V,0])};function K_(g,c){let u=1<<g.canonical.z,_=c.getFreeCameraOptions().position,b=c.elevation,S=g.canonical.x/u,A=(g.canonical.x+1)/u,P=g.canonical.y/u,k=(g.canonical.y+1)/u,O=c._centerAltitude;if(b){let X=b.getMinMaxForTile(g);X&&X.max>O&&(O=X.max)}let z=i.aa(_.x,S,A)-_.x,U=i.aa(_.y,P,k)-_.y,q=i.bl(O,c.center.lat)-_.z;return c._zoomFromMercatorZ(Math.sqrt(z*z+U*U+q*q))}function km(g,c,u,_,b,S,A){let P=g.context,k=g.renderPass==="shadow",O=g.shadowRenderer,z=k&&O?O.getShadowPassDepthMode():new ki(P.gl.LEQUAL,ki.ReadWrite,g.depthRangeFor3D),U=g.isTileAffectedByFog(S);if(u.meshes)for(let q of u.meshes){let X=["MODEL_POSITION_ON_GPU"],Q=[],K,re,Y;_.instancedDataArray.length>20&&X.push("INSTANCED_ARRAYS");let ae=Sc(g,c.paint.get("model-cutoff-fade-range"));if(ae.shouldRenderCutoff&&X.push("RENDER_CUTOFF"),k&&O)K=g.getOrCreateProgram("modelDepth",{defines:X}),re=jd(A.shadowTileMatrix,A.shadowTileMatrix,Float32Array.from(u.matrix)),Y=O.getShadowPassColorMode();else{Jr(X,Q,q,g),K=g.getOrCreateProgram("model",{defines:X,overrideFog:U});let ce=q.material,_e=ce.pbrMetallicRoughness,oe=c.paint.get("model-opacity"),ve=c.paint.get("model-emissive-strength").constantOr(0);re=Cp(S.expandedProjMatrix,Float32Array.from(u.matrix),new Float32Array(16),g,oe,_e.baseColorFactor,ce.emissiveFactor,_e.metallicFactor,_e.roughnessFactor,ce,ve,c,b),O&&(A.shadowUniformsInitialized?K.setShadowUniformValues(P,O.getShadowUniformValues()):(O.setupShadows(S.toUnwrapped(),K,"model-tile",S.overscaledZ),A.shadowUniformsInitialized=!0)),Y=ae.shouldRenderCutoff||oe<1||ce.alphaMode!=="OPAQUE"?Mn.alphaBlended:Mn.unblended}g.uploadCommonUniforms(P,K,S.toUnwrapped(),null,ae);let ge=q.material.doubleSided?Di.disabled:Di.backCCW;if(_.instancedDataArray.length>20)Q.push(_.instancedDataBuffer),K.draw(g,P.gl.TRIANGLES,z,tn.disabled,Y,ge,re,c.id,q.vertexBuffer,q.indexBuffer,q.segments,c.paint,g.transform.zoom,void 0,Q,_.instancedDataArray.length);else{let ce=k?"u_instance":"u_normal_matrix";for(let _e=0;_e<_.instancedDataArray.length;++_e)re[ce]=new Float32Array(_.instancedDataArray.arrayBuffer,64*_e,16),K.draw(g,P.gl.TRIANGLES,z,tn.disabled,Y,ge,re,c.id,q.vertexBuffer,q.indexBuffer,q.segments,c.paint,g.transform.zoom,void 0,Q)}}if(u.children)for(let q of u.children)km(g,c,q,_,b,S,A)}let mh=[1,-1,1];function Hy(g,c,u,_){if(!u.modelManager)return!0;let b=u.modelManager;if(!u.shadowRenderer)return!0;let S=u.shadowRenderer,A=c.aabb,P=!0,k=g.maxHeight;if(k===0){let z=0;for(let U in g.instancesPerModel){let q=b.getModel(U,_);q?z=Math.max(z,Math.max(Math.max(q.aabb.max[0],q.aabb.max[1]),q.aabb.max[2])):P=!1}k=g.maxScale*z*1.41+g.maxVerticalOffset,P&&(g.maxHeight=k)}A.max[2]=k,A.min[2]+=g.terrainElevationMin,A.max[2]+=g.terrainElevationMax,i.N.transformMat4(A.min,A.min,c.tileMatrix),i.N.transformMat4(A.max,A.max,c.tileMatrix);let O=A.intersects(S.getCurrentCascadeFrustum());return u.currentShadowCascade===0&&(g.isInsideFirstShadowMapFrustum=O===2),O===0}class jy{}class Q_{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(c,u,_){{let U=this._storage.get(u.id);if(U)return U.lastUsedFrameIdx=c,U.buf}let b=_.gl,S=b.getBufferParameter(b.ELEMENT_ARRAY_BUFFER,b.BUFFER_SIZE),A=new ArrayBuffer(S),P=new Int16Array(A);b.getBufferSubData(b.ELEMENT_ARRAY_BUFFER,0,new Int16Array(A));let k=new i.cW;for(let U=0;U<S/2;U+=3){let q=P[U],X=P[U+1],Q=P[U+2];k.emplaceBack(q,X),k.emplaceBack(X,Q),k.emplaceBack(Q,q)}let O=_.bindVertexArrayOES.current,z=new jy;return z.buf=new ct(_,k),z.lastUsedFrameIdx=c,this._storage.set(u.id,z),_.bindVertexArrayOES.set(O),z.buf}update(c){for(let[u,_]of this._storage)c-_.lastUsedFrameIdx>30&&(_.buf.destroy(),this._storage.delete(u))}destroy(){for(let[c,u]of this._storage)u.buf.destroy(),this._storage.delete(c)}}class $d{registerParameter(c,u,_,b,S){}registerButton(c,u,_){}}let Yd={symbol:function(g,c,u,_,b){if(g.renderPass!=="translucent")return;let S=tn.disabled,A=g.colorModeForRenderPass();u.layout.get("text-variable-anchor")&&function(O,z,U,q,X,Q,K){let re=z.transform,Y=X==="map",ae=Q==="map";for(let ge of O){let ce=q.getTile(ge),_e=ce.getBucket(U);if(!_e||!_e.text||!_e.text.segments.get().length)continue;let oe=i.b5(_e.textSizeData,re.zoom),ve=Rd(ge,_e.getProjection(),re),Ae=re.calculatePixelsToTileUnitsMatrix(ce),Re=Id(ve,ce.tileID.canonical,ae,Y,re,_e.getProjection(),Ae),Oe=_e.hasIconTextFit()&&_e.hasIconData();if(oe){let Je=Math.pow(2,re.zoom-ce.tileID.overscaledZ);X_(_e,Y,ae,K,i.cx,re,Re,ge,Je,oe,Oe)}}}(_,g,u,c,u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),b);let P=u.paint.get("icon-opacity").constantOr(1)!==0,k=u.paint.get("text-opacity").constantOr(1)!==0;u.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(P||k)?Ip(g,c,u,_,S,A):(P&&Ip(g,c,u,_,S,A,{onlyIcons:!0}),k&&Ip(g,c,u,_,S,A,{onlyText:!0})),c.map.showCollisionBoxes&&(Xa(g,c,u,_,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),!0),Xa(g,c,u,_,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),!1))},circle:function(g,c,u,_){if(g.renderPass!=="translucent")return;let b=u.paint.get("circle-opacity"),S=u.paint.get("circle-stroke-width"),A=u.paint.get("circle-stroke-opacity"),P=u.layout.get("circle-sort-key").constantOr(1)!==void 0,k=u.paint.get("circle-emissive-strength");if(b.constantOr(1)===0&&(S.constantOr(1)===0||A.constantOr(1)===0))return;let O=g.context,z=O.gl,U=g.transform,q=g.depthModeForSublayer(0,ki.ReadOnly),X=tn.disabled,Q=g.colorModeForDrapableLayerRenderPass(k),K=U.projection.name==="globe",re=[i.a5(U.center.lng),i.ae(U.center.lat)],Y=[];for(let ge=0;ge<_.length;ge++){let ce=_[ge],_e=c.getTile(ce),oe=_e.getBucket(u);if(!oe||oe.projection.name!==U.projection.name)continue;let ve=oe.programConfigurations.get(u.id),Ae=i.cy(u),Re=g.isTileAffectedByFog(ce);K&&Ae.push("PROJECTION_GLOBE_VIEW");let Oe=g.getOrCreateProgram("circle",{config:ve,defines:Ae,overrideFog:Re}),Je=oe.layoutVertexBuffer,Ue=oe.globeExtVertexBuffer,ot=oe.indexBuffer,nt=U.projection.createInversionMatrix(U,ce.canonical),Rt={programConfiguration:ve,program:Oe,layoutVertexBuffer:Je,globeExtVertexBuffer:Ue,indexBuffer:ot,uniformValues:i.cz(g,ce,_e,nt,re,u),tile:_e};if(P){let je=oe.segments.get();for(let tt of je)Y.push({segments:new i.aB([tt]),sortKey:tt.sortKey,state:Rt})}else Y.push({segments:oe.segments,sortKey:0,state:Rt})}P&&Y.sort((ge,ce)=>ge.sortKey-ce.sortKey);let ae={useDepthForOcclusion:U.depthOcclusionForSymbolsAndCircles};for(let ge of Y){let{programConfiguration:ce,program:_e,layoutVertexBuffer:oe,globeExtVertexBuffer:ve,indexBuffer:Ae,uniformValues:Re,tile:Oe}=ge.state,Je=ge.segments;g.terrain&&g.terrain.setupElevationDraw(Oe,_e,ae),g.uploadCommonUniforms(O,_e,Oe.tileID.toUnwrapped()),_e.draw(g,z.TRIANGLES,q,X,Q,Di.disabled,Re,u.id,oe,Ae,Je,u.paint,U.zoom,ce,[ve])}},heatmap:function(g,c,u,_){if(u.paint.get("heatmap-opacity")!==0)if(g.renderPass==="offscreen"){let b=g.context,S=b.gl,A=tn.disabled,P=new Mn([S.ONE,S.ONE,S.ONE,S.ONE],i.ax.transparent,[!0,!0,!0,!0]);(function(X,Q,K,re){let Y=X.gl,ae=Q.width*re,ge=Q.height*re;X.activeTexture.set(Y.TEXTURE1),X.viewport.set([0,0,ae,ge]);let ce=K.heatmapFbo;if(!ce||ce&&(ce.width!==ae||ce.height!==ge)){ce&&ce.destroy();let _e=Y.createTexture();Y.bindTexture(Y.TEXTURE_2D,_e),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_WRAP_S,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_WRAP_T,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_MIN_FILTER,Y.LINEAR),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_MAG_FILTER,Y.LINEAR),ce=K.heatmapFbo=X.createFramebuffer(ae,ge,!0,null),function(oe,ve,Ae,Re,Oe,Je){let Ue=oe.gl;Ue.texImage2D(Ue.TEXTURE_2D,0,oe.extRenderToTextureHalfFloat?Ue.RGBA16F:Ue.RGBA,Oe,Je,0,Ue.RGBA,oe.extRenderToTextureHalfFloat?Ue.HALF_FLOAT:Ue.UNSIGNED_BYTE,null),Re.colorAttachment.set(Ae)}(X,0,_e,ce,ae,ge)}else Y.bindTexture(Y.TEXTURE_2D,ce.colorAttachment.get()),X.bindFramebuffer.set(ce.framebuffer)})(b,g,u,g.transform.projection.name==="globe"?.5:.25),b.clear({color:i.ax.transparent});let k=g.transform,O=k.projection.name==="globe",z=O?["PROJECTION_GLOBE_VIEW"]:[],U=O?Di.frontCCW:Di.disabled,q=[i.a5(k.center.lng),i.ae(k.center.lat)];for(let X=0;X<_.length;X++){let Q=_[X];if(c.hasRenderableParent(Q))continue;let K=c.getTile(Q),re=K.getBucket(u);if(!re||re.projection.name!==k.projection.name)continue;let Y=g.isTileAffectedByFog(Q),ae=re.programConfigurations.get(u.id),ge=g.getOrCreateProgram("heatmap",{config:ae,defines:z,overrideFog:Y}),{zoom:ce}=g.transform;g.terrain&&g.terrain.setupElevationDraw(K,ge),g.uploadCommonUniforms(b,ge,Q.toUnwrapped());let _e=k.projection.createInversionMatrix(k,Q.canonical);ge.draw(g,S.TRIANGLES,ki.disabled,A,P,U,_m(g,Q,K,_e,q,ce,u.paint.get("heatmap-intensity")),u.id,re.layoutVertexBuffer,re.indexBuffer,re.segments,u.paint,g.transform.zoom,ae,O?[re.globeExtVertexBuffer]:null)}b.viewport.set([0,0,g.width,g.height])}else g.renderPass==="translucent"&&(g.context.setColorMode(g.colorModeForRenderPass()),function(b,S){let A=b.context,P=A.gl,k=S.heatmapFbo;if(!k)return;A.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,k.colorAttachment.get()),A.activeTexture.set(P.TEXTURE1);let O=S.colorRampTexture;O||(O=S.colorRampTexture=new i.T(A,S.colorRamp,P.RGBA)),O.bind(P.LINEAR,P.CLAMP_TO_EDGE),b.getOrCreateProgram("heatmapTexture").draw(b,P.TRIANGLES,ki.disabled,tn.disabled,b.colorModeForRenderPass(),Di.disabled,((z,U,q,X)=>({u_image:0,u_color_ramp:1,u_opacity:U.paint.get("heatmap-opacity")}))(0,S),S.id,b.viewportBuffer,b.quadTriangleIndexBuffer,b.viewportSegments,S.paint,b.transform.zoom)}(g,u))},line:function(g,c,u,_){if(g.renderPass!=="translucent")return;let b=u.paint.get("line-opacity"),S=u.paint.get("line-width");if(b.constantOr(1)===0||S.constantOr(1)===0)return;let A=u.paint.get("line-emissive-strength"),P=g.depthModeForSublayer(0,ki.ReadOnly),k=g.colorModeForDrapableLayerRenderPass(A),O=g.terrain&&g.terrain.renderingToTexture?1:i.f.devicePixelRatio,z=u.paint.get("line-dasharray"),U=z.constantOr(1),q=u.layout.get("line-cap"),X=u.paint.get("line-pattern"),Q=X.constantOr(1),K=u.paint.get("line-pattern").constantOr(1),re=u.paint.get("line-opacity").constantOr(1)!==1,Y=!K&&re,ae=u.paint.get("line-gradient"),ge=Q?"linePattern":"line",ce=g.context,_e=ce.gl,oe=i.cA(u);g.terrain&&g.terrain.clipOrMaskOverlapStencilType()&&(Y=!1);for(let ve of _){let Ae=c.getTile(ve);if(Q&&!Ae.patternsLoaded())continue;let Re=Ae.getBucket(u);if(!Re)continue;g.prepareDrawTile();let Oe=Re.programConfigurations.get(u.id),Je=g.isTileAffectedByFog(ve),Ue=g.getOrCreateProgram(ge,{config:Oe,defines:oe,overrideFog:Je}),ot=X.constantOr(null);if(ot&&Ae.imageAtlas){let jt=Ae.imageAtlas.patternPositions[ot.toString()];jt&&Oe.setConstantPatternPositions(jt)}let nt=z.constantOr(null),Rt=q.constantOr(null);if(!Q&&nt&&Rt&&Ae.lineAtlas){let jt=Ae.lineAtlas.getDash(nt,Rt);jt&&Oe.setConstantPatternPositions(jt)}let[je,tt]=u.paint.get("line-trim-offset");(Rt==="round"||Rt==="square")&&je!==tt&&(je===0&&(je-=1),tt===1&&(tt+=1));let Fe=g.terrain?ve.projMatrix:null,Ze=Q?i.cB(g,Ae,u,Fe,O,[je,tt]):i.cC(g,Ae,u,Fe,Re.lineClipsArray.length,O,[je,tt]);if(ae){let jt=Re.gradients[u.id],Ut=jt.texture;if(u.gradientVersion!==jt.version){let ti=256;if(u.stepInterpolant){let mi=c.getSource().maxzoom,Ei=ve.canonical.z===mi?Math.ceil(1<<g.transform.maxZoom-ve.canonical.z):1;ti=i.aa(i.cD(Re.maxLineLength/i.V*1024*Ei),256,ce.maxTextureSize)}jt.gradient=i.cE({expression:u.gradientExpression(),evaluationKey:"lineProgress",resolution:ti,image:jt.gradient||void 0,clips:Re.lineClipsArray}),jt.texture?jt.texture.update(jt.gradient):jt.texture=new i.T(ce,jt.gradient,_e.RGBA),jt.version=u.gradientVersion,Ut=jt.texture}ce.activeTexture.set(_e.TEXTURE1),Ut.bind(u.stepInterpolant?_e.NEAREST:_e.LINEAR,_e.CLAMP_TO_EDGE)}U&&(ce.activeTexture.set(_e.TEXTURE0),Ae.lineAtlasTexture&&Ae.lineAtlasTexture.bind(_e.LINEAR,_e.REPEAT),Oe.updatePaintBuffers()),Q&&(ce.activeTexture.set(_e.TEXTURE0),Ae.imageAtlasTexture&&Ae.imageAtlasTexture.bind(_e.LINEAR,_e.CLAMP_TO_EDGE),Oe.updatePaintBuffers()),g.uploadCommonUniforms(ce,Ue,ve.toUnwrapped());let Dt=jt=>{Ue.draw(g,_e.TRIANGLES,P,jt,k,Di.disabled,Ze,u.id,Re.layoutVertexBuffer,Re.indexBuffer,Re.segments,u.paint,g.transform.zoom,Oe,[Re.layoutVertexBuffer2])};if(Y){let jt=g.stencilModeForClipping(ve).ref;jt===0&&g.terrain&&ce.clear({stencil:0});let Ut={func:_e.EQUAL,mask:255};Ze.u_alpha_discard_threshold=.8,Dt(new tn(Ut,jt,255,_e.KEEP,_e.KEEP,_e.INVERT)),Ze.u_alpha_discard_threshold=0,Dt(new tn(Ut,jt,255,_e.KEEP,_e.KEEP,_e.KEEP))}else Dt(g.stencilModeForClipping(ve))}Y&&(g.resetStencilClippingMasks(),g.terrain&&ce.clear({stencil:0}))},fill:function(g,c,u,_){let b=u.paint.get("fill-color"),S=u.paint.get("fill-opacity");if(S.constantOr(1)===0)return;let A=u.paint.get("fill-emissive-strength"),P=g.colorModeForDrapableLayerRenderPass(A),k=u.paint.get("fill-pattern"),O=g.opaquePassEnabledForLayer()&&!k.constantOr(1)&&b.constantOr(i.ax.transparent).a===1&&S.constantOr(0)===1?"opaque":"translucent";if(g.renderPass===O){let z=g.depthModeForSublayer(1,g.renderPass==="opaque"?ki.ReadWrite:ki.ReadOnly);m0(g,c,u,_,z,P,!1)}if(g.renderPass==="translucent"&&u.paint.get("fill-antialias")){let z=g.depthModeForSublayer(u.getPaintProperty("fill-outline-color")?2:0,ki.ReadOnly);m0(g,c,u,_,z,P,!0)}},"fill-extrusion":function(g,c,u,_){let b=u.paint.get("fill-extrusion-opacity"),S=g.context,A=S.gl,P=g.terrain,k=P&&P.renderingToTexture;if(b===0)return;let O=g.conflationActive&&g.layerUsedInConflation(u,c.getSource());if(O&&function(z,U,q,X){for(let Q of X){let K=U.getTile(Q).getBucket(q);K&&(K.updateReplacement(Q,z.replacementSource),K.uploadCentroid(z.context))}}(g,c,u,_),P||O)for(let z of _){let U=c.getTile(z).getBucket(u);U&&Uy(g.context,c,z,U,u,P,O)}if(g.renderPass==="shadow"&&g.shadowRenderer){let z=g.shadowRenderer;if(P&&b<.65&&u._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof i.Z)return;let U=z.getShadowPassDepthMode(),q=z.getShadowPassColorMode();_i(g,c,u,_,U,tn.disabled,q,O)}else if(g.renderPass==="translucent"){let z=!u.paint.get("fill-extrusion-pattern").constantOr(1),U=u.paint.get("fill-extrusion-color").constantOr(i.ax.white);if(!k&&U.a!==0){let q=new ki(g.context.gl.LEQUAL,ki.ReadWrite,g.depthRangeFor3D);b===1&&z?_i(g,c,u,_,q,tn.disabled,Mn.unblended,O):(_i(g,c,u,_,q,tn.disabled,Mn.disabled,O),_i(g,c,u,_,q,g.stencilModeFor3D(),g.colorModeForRenderPass(),O),g.resetStencilClippingMasks())}if(g.style.enable3dLights()&&z&&(!P&&g.transform.projection.name!=="globe"||k)){let q=u.paint.get("fill-extrusion-opacity"),X=u.paint.get("fill-extrusion-ambient-occlusion-intensity"),Q=u.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),K=u.paint.get("fill-extrusion-flood-light-intensity"),re=u.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),Y=X>0&&Q>0,ae=K>0,ge=(_e,oe,ve)=>(1-ve)*_e+ve*oe,ce=_e=>{let oe=g.depthModeForSublayer(1,ki.ReadOnly,A.LEQUAL,!0),ve=u.paint.get(_e?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ae=ge(.1,3,ve),Re=g._showOverdrawInspector;if(!Re){let Oe=new tn({func:A.ALWAYS,mask:255},255,255,A.KEEP,A.KEEP,A.REPLACE),Je=new Mn([A.ONE,A.ONE,A.ONE,A.ONE],i.ax.transparent,[!1,!1,!1,!0],A.MIN);Ac(g,c,u,_,oe,Oe,Je,Di.disabled,_e,"sdf",q,X,Q,K,re,Ae,O,!1)}{let Oe=Re?tn.disabled:new tn({func:A.EQUAL,mask:255},255,255,A.KEEP,A.DECR,A.DECR),Je=Re?g.colorModeForRenderPass():new Mn([A.ONE_MINUS_DST_ALPHA,A.DST_ALPHA,A.ONE,A.ONE],i.ax.transparent,[!0,!0,!0,!0]);Ac(g,c,u,_,oe,Oe,Je,Di.disabled,_e,"color",q,X,Q,K,re,Ae,O,!1)}};if(k){let _e=(oe,ve,Ae)=>{let Re=g.depthModeForSublayer(1,ki.ReadOnly,A.LEQUAL,!1),Oe=u.paint.get(oe?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Je=ge(.1,3,Oe);{let Ue=new Mn([A.ONE,A.ONE,A.ONE,A.ONE],i.ax.transparent,[!1,!1,!1,!0]);Ac(g,c,u,_,Re,tn.disabled,Ue,Di.disabled,oe,"clear",q,X,Q,K,re,Je,O,ve)}{let Ue=new tn({func:A.ALWAYS,mask:255},255,255,A.KEEP,A.KEEP,A.REPLACE),ot=new Mn([A.ONE,A.ONE,A.ONE,A.ONE],i.ax.transparent,[!1,!1,!1,!0],A.MIN);Ac(g,c,u,_,Re,Ue,ot,Di.disabled,oe,"sdf",q,X,Q,K,re,Je,O,ve)}{let Ue=oe?A.ZERO:A.ONE_MINUS_DST_ALPHA,ot=new tn({func:A.EQUAL,mask:255},255,255,A.KEEP,A.DECR,A.DECR),nt=new Mn([Ue,A.DST_ALPHA,A.ONE_MINUS_DST_ALPHA,A.ZERO],i.ax.transparent,[!0,!0,!0,!0]);Ac(g,c,u,_,Re,ot,nt,Di.disabled,oe,"color",q,X,Q,K,re,Je,O,ve)}{let Ue=new Mn([A.ONE,A.ONE,A.ONE,oe?A.ZERO:A.ONE],i.ax.transparent,[!1,!1,!1,!0],oe?A.FUNC_ADD:A.MAX);Ac(g,c,u,_,Re,tn.disabled,Ue,Di.disabled,oe,"clear",q,X,Q,K,re,Je,O,ve,Ae)}};if(Y||ae){let oe;if(g.prepareDrawTile(),P){let ve=P.drapeBufferSize[0],Ae=P.drapeBufferSize[1];oe=P.framebufferCopyTexture,oe&&(!oe||oe.size[0]===ve&&oe.size[1]===Ae)||(oe&&oe.destroy(),oe=P.framebufferCopyTexture=new i.T(S,new i.h({width:ve,height:Ae}),A.RGBA)),oe.bind(A.LINEAR,A.CLAMP_TO_EDGE),A.copyTexImage2D(A.TEXTURE_2D,0,A.RGBA,0,0,ve,Ae,0)}Y&&_e(!0,!1,oe),ae&&_e(!1,!0,oe)}}else Y&&ce(!0),ae&&ce(!1)}}},hillshade:function(g,c,u,_){if(g.renderPass!=="offscreen"&&g.renderPass!=="translucent"||g.style.disableElevatedTerrain)return;let b=g.context,S=g.terrain&&g.terrain.renderingToTexture,[A,P]=g.renderPass!=="translucent"||S?[{},_]:g.stencilConfigForOverlap(_);for(let k of P){let O=c.getTile(k);if(O.needsHillshadePrepare&&g.renderPass==="offscreen")rm(g,O,u);else if(g.renderPass==="translucent"){let z=g.depthModeForSublayer(0,ki.ReadOnly),U=u.paint.get("hillshade-emissive-strength"),q=g.colorModeForDrapableLayerRenderPass(U),X=S&&g.terrain?g.terrain.stencilModeForRTTOverlap(k):A[k.overscaledZ];wp(g,k,O,u,z,X,q)}}b.viewport.set([0,0,g.width,g.height]),g.resetStencilClippingMasks()},raster:function(g,c,u,_,b,S){if(g.renderPass!=="translucent"||u.paint.get("raster-opacity")===0)return;let A=g.transform.projection.name==="globe",P=u.paint.get("raster-elevation")!==0,k=P&&A;if(g.renderElevatedRasterBackface&&!k)return;let O=g.context,z=O.gl,U=c.getSource(),q=function(oe,ve,Ae,Re){let Oe=ve.paint.get("raster-color"),Je=oe.type==="raster-array",Ue=[],ot=ve.paint.get("raster-resampling"),nt=ve.paint.get("raster-color-mix"),Rt=ve.paint.get("raster-color-range"),je=[nt[0],nt[1],nt[2],0],tt=nt[3],Fe=ot==="nearest"?Re.NEAREST:Re.LINEAR;if(Je&&(Ue.push("RASTER_ARRAY"),Oe||Ue.push("RASTER_COLOR"),ot==="linear"&&Ue.push("RASTER_ARRAY_LINEAR"),Fe=Re.NEAREST,!Rt&&oe.rasterLayers)){let Ze=oe.rasterLayers.find(({id:Dt})=>Dt===ve.sourceLayer);Ze&&Ze.fields&&Ze.fields.range&&(Rt=Ze.fields.range)}if(Rt=Rt||[0,1],Oe){Ue.push("RASTER_COLOR"),Ae.activeTexture.set(Re.TEXTURE2),ve.updateColorRamp(Rt);let Ze=ve.colorRampTexture;Ze||(Ze=ve.colorRampTexture=new i.T(Ae,ve.colorRamp,Re.RGBA)),Ze.bind(Re.LINEAR,Re.CLAMP_TO_EDGE)}return{mix:je,range:Rt,offset:tt,defines:Ue,resampling:Fe}}(U,u,O,z);if(U instanceof i.ap&&!_.length&&!A)return;let X=u.paint.get("raster-emissive-strength"),Q=g.colorModeForDrapableLayerRenderPass(X),K=g.terrain&&g.terrain.renderingToTexture,re=!g.options.moving,Y=u.paint.get("raster-resampling")==="nearest"?z.NEAREST:z.LINEAR;if(U instanceof i.ap&&!_.length&&(U.onNorthPole||U.onSouthPole)){let oe=P?g.stencilModeFor3D():tn.disabled;return void bm(!!U.onNorthPole,null,g,c,u,X,q,Di.disabled,oe)}if(!_.length)return;let[ae,ge]=U instanceof i.ap||K?[{},_]:g.stencilConfigForOverlap(_),ce=ge[ge.length-1].overscaledZ;k&&q.defines.push("PROJECTION_GLOBE_VIEW"),P&&q.defines.push("RENDER_CUTOFF");let _e=(oe,ve,Ae)=>{for(let Re of oe){let Oe=Re.toUnwrapped(),Je=c.getTile(Re);if(K&&(!Je||!Je.hasData()))continue;O.activeTexture.set(z.TEXTURE0);let Ue=Sm(Je,U,u,q);if(!Ue||!Ue.texture)continue;let{texture:ot,mix:nt,offset:Rt,tileSize:je,buffer:tt}=Ue,Fe,Ze;K?(Fe=ki.disabled,Ze=Re.projMatrix):P?(Fe=new ki(z.LEQUAL,ki.ReadWrite,g.depthRangeFor3D),Ze=A?Float32Array.from(g.transform.expandedFarZProjMatrix):g.transform.calculateProjMatrix(Oe,re)):(Fe=g.depthModeForSublayer(Re.overscaledZ-ce,u.paint.get("raster-opacity")===1?ki.ReadWrite:ki.ReadOnly,z.LESS),Ze=g.transform.calculateProjMatrix(Oe,re));let Dt=g.terrain&&K?g.terrain.stencilModeForRTTOverlap(Re):ae[Re.overscaledZ],jt=S?0:u.paint.get("raster-fade-duration");Je.registerFadeDuration(jt);let Ut=c.findLoadedParent(Re,0),ti=lm(Je,Ut,c,g.transform,jt),mi,Ei;g.terrain&&g.terrain.prepareDrawTile(),O.activeTexture.set(z.TEXTURE0),ot.bind(Y,z.CLAMP_TO_EDGE),O.activeTexture.set(z.TEXTURE1),Ut?(Ut.texture&&Ut.texture.bind(Y,z.CLAMP_TO_EDGE),mi=Math.pow(2,Ut.tileID.overscaledZ-Je.tileID.overscaledZ),Ei=[Je.tileID.canonical.x*mi%1,Je.tileID.canonical.y*mi%1]):ot.bind(Y,z.CLAMP_TO_EDGE),ot.useMipmap&&O.extTextureFilterAnisotropic&&g.transform.pitch>20&&z.texParameterf(z.TEXTURE_2D,O.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,O.extTextureFilterAnisotropicMax);let xi=g.transform,Si,gn=P?wm(xi):[0,0,0,0],Zi,hn,an,Wn,Dr,An=0;if(k&&U instanceof i.ap&&U.coordinates.length>3)Zi=Float32Array.from(i.aT(i.ci(new i.bs(0,0,0)))),hn=Float32Array.from(xi.globeMatrix),an=Float32Array.from(i.ce(xi)),Wn=[i.a5(xi.center.lng),i.ae(xi.center.lat)],Si=U.elevatedGlobePerspectiveTransform,Dr=U.elevatedGlobeGridMatrix||new Float32Array(9);else if(k){let In=i.cf(Re.canonical);An=i.cg(In.getCenter().lat),Zi=Float32Array.from(i.aT(i.ci(Re.canonical))),hn=Float32Array.from(xi.globeMatrix),an=Float32Array.from(i.ce(xi)),Wn=[i.a5(xi.center.lng),i.ae(xi.center.lat)],Si=[0,0],Dr=Float32Array.from(i.ch(Re.canonical,In,An,xi.worldSize/xi._pixelsPerMercatorPixel))}else Si=U instanceof i.ap?U.perspectiveTransform:[0,0],Zi=new Float32Array(16),hn=new Float32Array(9),an=new Float32Array(16),Wn=[0,0],Dr=new Float32Array(9);let Kr=ym(Ze,Zi,hn,an,Dr,Ei||[0,0],i.S(g.transform.zoom),Wn,gn,mi||1,ti,u,Si,P?u.paint.get("raster-elevation"):0,2,nt,Rt,q.range,je,tt,X),Cn=g.isTileAffectedByFog(Re),er=g.getOrCreateProgram("raster",{defines:q.defines,overrideFog:Cn});if(g.uploadCommonUniforms(O,er,Oe),U instanceof i.ap){let In=U.elevatedGlobeVertexBuffer,Kn=U.elevatedGlobeIndexBuffer;if(K||!A)U.boundsBuffer&&U.boundsSegments&&er.draw(g,z.TRIANGLES,Fe,tn.disabled,Q,Di.disabled,Kr,u.id,U.boundsBuffer,g.quadTriangleIndexBuffer,U.boundsSegments);else if(In&&Kn){let Nr=xi.zoom<=i.bG?U.elevatedGlobeSegments:U.getSegmentsForLongitude(xi.center.lng);Nr&&er.draw(g,z.TRIANGLES,Fe,tn.disabled,Q,ve,Kr,u.id,In,Kn,Nr)}}else if(k){Fe=new ki(z.LEQUAL,ki.ReadOnly,g.depthRangeFor3D);let In=g.globeSharedBuffers;if(In){let[Kn,Nr,ar]=In.getGridBuffers(An,!1);er.draw(g,z.TRIANGLES,Fe,Ae||Dt,g.colorModeForRenderPass(),ve,Kr,u.id,Kn,Nr,ar)}}else{let{tileBoundsBuffer:In,tileBoundsIndexBuffer:Kn,tileBoundsSegments:Nr}=g.getTileBoundsBuffers(Je);er.draw(g,z.TRIANGLES,Fe,Dt,Q,Di.disabled,Kr,u.id,In,Kn,Nr)}}if(!(U instanceof i.ap)&&k)for(let Re of oe){let Oe=Re.canonical.y===(1<<Re.canonical.z)-1;Re.canonical.y===0&&bm(!0,Re,g,c,u,X,q,ve,Ae||tn.disabled),Oe&&bm(!1,Re,g,c,u,X,q,ve===Di.frontCW?Di.backCW:Di.frontCW,Ae||tn.disabled)}};k?_e(ge,g.renderElevatedRasterBackface?Di.backCW:Di.frontCW,g.stencilModeFor3D()):_e(ge,Di.disabled,void 0),g.resetStencilClippingMasks()},"raster-particle":function(g,c,u,_,b,S){g.renderPass==="offscreen"&&function(A,P,k,O){if(!O.length)return;let z=A.context,U=z.gl,q=P.getSource();if(!(q instanceof Gt))return;let X=[];for(let re of O){let Y=P.getTile(re);if(!(Y instanceof a0))continue;let ae=Tm(Y,q,k);if(!ae)continue;let ge=[ae.tileSize,ae.tileSize],ce=k.tileFramebuffer;ce||(ce=k.tileFramebuffer=z.createFramebuffer(ge[0],ge[1],!0,null));let _e=Y.rasterParticleState,oe=k.paint.get("raster-particle-count");_e||(_e=Y.rasterParticleState=new Is(z,re,ge,oe));let ve=_e.update(k.lastInvalidatedAt);_e.numParticles!==oe&&_e.setNumParticles(re,oe);let Ae=_e.targetColorTexture;_e.targetColorTexture=_e.backgroundColorTexture,_e.backgroundColorTexture=Ae;let Re=_e.particleVertices0;_e.particleVertices0=_e.particleVertices1,_e.particleVertices1=Re,X.push([re,ae,_e,ve])}if(X.length===0)return;let Q=i.f.now(),K=k.previousDrawTimestamp?.001*(Q-k.previousDrawTimestamp):.0167;if(k.previousDrawTimestamp=Q,k.hasColorMap()){z.activeTexture.set(U.TEXTURE0+2);let re=k.colorRampTexture;re||(re=k.colorRampTexture=new i.T(z,k.colorRamp,U.RGBA)),re.bind(U.LINEAR,U.CLAMP_TO_EDGE)}z.bindFramebuffer.set(k.tileFramebuffer.framebuffer),z.activeTexture.set(U.TEXTURE0),function(re,Y,ae){let ge=re.context,ce=ge.gl,_e=Y.tileFramebuffer;ge.activeTexture.set(ce.TEXTURE0);let oe={u_texture:0,u_opacity:1.05*(Ae=Y.paint.get("raster-particle-fade-opacity-factor"))/(Ae+.05)},ve=re.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Ae;for(let Re of ae){let[,,Oe,Je]=Re;_e.colorAttachment.set(Oe.targetColorTexture.texture),ge.viewport.set([0,0,_e.width,_e.height]),ge.clear({color:i.ax.transparent}),Je&&(Oe.backgroundColorTexture.bind(ce.NEAREST,ce.CLAMP_TO_EDGE),ve.draw(re,ce.TRIANGLES,ki.disabled,tn.disabled,Mn.alphaBlended,Di.disabled,oe,Y.id,re.viewportBuffer,re.quadTriangleIndexBuffer,re.viewportSegments))}}(A,k,X),function(re,Y,ae,ge){let ce=re.context.gl,_e=ae.tileFramebuffer,oe=re.transform.projection.name==="globe",ve=ae.paint.get("raster-particle-max-speed");for(let Ae of ge){let[Re,Oe,Je]=Ae;Oe.texture.bind(ce.LINEAR,ce.CLAMP_TO_EDGE),_e.colorAttachment.set(Je.targetColorTexture.texture);let Ue=re.getOrCreateProgram("rasterParticleDraw",{defines:Oe.defines,overrideFog:!1}),ot=Oe.scalarData?[]:[0,1,2,3].map(je=>i.cG[je](Re));ot.push(Re);let nt=Re.canonical.x,Rt=Re.canonical.y;for(let je of ot){let tt=Y.getTile(oe?je.wrapped():je);if(!tt)continue;let Fe=tt.rasterParticleState;if(!Fe)continue;let Ze=zy([je.canonical.x+(1<<je.canonical.z)*(je.wrap-Re.wrap)-nt,je.canonical.y-Rt],0,Oe.texture.size,2,ve,Oe.textureOffset,Oe.scale,Oe.offset);Ue.draw(re,ce.POINTS,ki.disabled,tn.disabled,Mn.alphaBlended,Di.disabled,Ze,ae.id,Fe.particleVertices0,void 0,Fe.particleSegment)}}}(A,P,k,X),function(re,Y,ae,ge){let ce=re.context.gl,_e=Y.transformFeedbackObject;_e||(_e=Y.transformFeedbackObject=ce.createTransformFeedback()),ce.bindTransformFeedback(ce.TRANSFORM_FEEDBACK,Y.transformFeedbackObject);let oe=Y.paint.get("raster-particle-max-speed"),ve=ge*Y.paint.get("raster-particle-speed-factor")*.3,Ae=(Re=Y.paint.get("raster-particle-reset-rate-factor"),Math.pow(Re,6));var Re;for(let Oe of ae){let[,Je,Ue]=Oe;Je.texture.bind(ce.LINEAR,ce.CLAMP_TO_EDGE);let ot=W_(0,Je.texture.size,oe,ve,Ae,Je.textureOffset,Je.scale,Je.offset);re.getOrCreateProgram("rasterParticleUpdate",{defines:Je.defines,transformFeedback:{bufferMode:ce.SEPARATE_ATTRIBS,shaderVaryings:["v_new_particle"]}}).draw(re,ce.POINTS,ki.disabled,tn.disabled,Mn.disabled,Di.disabled,ot,Y.id,Ue.particleVertices0,void 0,Ue.particleSegment,{},void 0,void 0,void 0,void 0,[{buffer:Ue.particleVertices1,targetIndex:0}])}ce.bindTransformFeedback(ce.TRANSFORM_FEEDBACK,null)}(A,k,X,K)}(g,c,u,_),g.renderPass==="translucent"&&(function(A,P,k,O,z){let U=A.context,q=U.gl,X=!A.options.moving,Q=A.transform.projection.name==="globe";if(!O.length)return;let[K,re]=A.stencilConfigForOverlap(O),Y=[];Q&&Y.push("PROJECTION_GLOBE_VIEW");for(let ae of re){let ge=ae.toUnwrapped(),ce=P.getTile(ae);if(!ce.rasterParticleState)continue;let _e=ce.rasterParticleState,oe=100;ce.registerFadeDuration(oe);let ve=P.findLoadedParent(ae,0),Ae=lm(ce,ve,P,A.transform,oe),Re,Oe;A.terrain&&A.terrain.prepareDrawTile(),U.activeTexture.set(q.TEXTURE0),_e.targetColorTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE),U.activeTexture.set(q.TEXTURE1),ve&&ve.rasterParticleState?(ve.rasterParticleState.targetColorTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE),Re=Math.pow(2,ve.tileID.overscaledZ-ce.tileID.overscaledZ),Oe=[ce.tileID.canonical.x*Re%1,ce.tileID.canonical.y*Re%1]):_e.targetColorTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE);let Je=Q?Float32Array.from(A.transform.expandedFarZProjMatrix):A.transform.calculateProjMatrix(ge,X),Ue=A.transform,ot=Mm(Ue),nt=i.cf(ae.canonical),Rt=i.cg(nt.getCenter().lat),je,tt,Fe,Ze,Dt;Q?(je=Float32Array.from(i.aT(i.ci(ae.canonical))),tt=Float32Array.from(Ue.globeMatrix),Fe=Float32Array.from(i.ce(Ue)),Ze=[i.a5(Ue.center.lng),i.ae(Ue.center.lat)],Dt=Float32Array.from(i.ch(ae.canonical,nt,Rt,Ue.worldSize/Ue._pixelsPerMercatorPixel))):(je=new Float32Array(16),tt=new Float32Array(9),Fe=new Float32Array(16),Ze=[0,0],Dt=new Float32Array(9));let jt=Ny(Je,je,tt,Fe,Dt,Oe||[0,0],i.S(A.transform.zoom),Ze,ot,Re||1,Ae,250),Ut=A.isTileAffectedByFog(ae),ti=A.getOrCreateProgram("rasterParticle",{defines:Y,overrideFog:Ut});if(A.uploadCommonUniforms(U,ti,ge),Q){let mi=new ki(q.LEQUAL,ki.ReadWrite,A.depthRangeFor3D),Ei=0,xi=A.globeSharedBuffers;if(xi){let[Si,gn,Zi]=xi.getGridBuffers(Rt,Ei!==0);ti.draw(A,q.TRIANGLES,mi,tn.disabled,Mn.alphaBlended,Di.backCCW,jt,k.id,Si,gn,Zi)}}else{let mi=A.depthModeForSublayer(0,ki.ReadOnly),Ei=K[ae.overscaledZ],{tileBoundsBuffer:xi,tileBoundsIndexBuffer:Si,tileBoundsSegments:gn}=A.getTileBoundsBuffers(ce);ti.draw(A,q.TRIANGLES,mi,Ei,Mn.alphaBlended,Di.disabled,jt,k.id,xi,Si,gn)}}A.resetStencilClippingMasks()}(g,c,u,_),g.style.map.triggerRepaint())},background:function(g,c,u,_){let b=u.paint.get("background-color"),S=u.paint.get("background-opacity"),A=u.paint.get("background-emissive-strength");if(S===0)return;let P=g.context,k=P.gl,O=g.transform,z=O.tileSize,U=u.paint.get("background-pattern");if(g.isPatternMissing(U,u.scope))return;let q=!U&&b.a===1&&S===1&&g.opaquePassEnabledForLayer()?"opaque":"translucent";if(g.renderPass!==q)return;let X=tn.disabled,Q=g.depthModeForSublayer(0,q==="opaque"?ki.ReadWrite:ki.ReadOnly),K=g.colorModeForDrapableLayerRenderPass(A),re=U?"backgroundPattern":"background",Y,ae=_;ae||(Y=g.getBackgroundTiles(),ae=Object.values(Y).map(ge=>ge.tileID)),U&&(P.activeTexture.set(k.TEXTURE0),g.imageManager.bind(g.context,u.scope));for(let ge of ae){let ce=g.isTileAffectedByFog(ge),_e=g.getOrCreateProgram(re,{overrideFog:ce}),oe=ge.toUnwrapped(),ve=_?ge.projMatrix:g.transform.calculateProjMatrix(oe);g.prepareDrawTile();let Ae=c?c.getTile(ge):Y?Y[ge.key]:new _c(ge,z,O.zoom,g),Re=U?Gd(ve,A,S,g,U,u.scope,{tileID:ge,tileSize:z}):vm(ve,A,S,b);g.uploadCommonUniforms(P,_e,oe);let{tileBoundsBuffer:Oe,tileBoundsIndexBuffer:Je,tileBoundsSegments:Ue}=g.getTileBoundsBuffers(Ae);_e.draw(g,k.TRIANGLES,Q,X,K,Di.disabled,Re,u.id,Oe,Je,Ue)}},sky:function(g,c,u){let _=g._atmosphere?i.S(g.transform.zoom):1,b=u.paint.get("sky-opacity")*_;if(b===0)return;let S=g.context,A=u.paint.get("sky-type"),P=new ki(S.gl.LEQUAL,ki.ReadOnly,[0,1]),k=g.frameCounter/1e3%1;A==="atmosphere"?g.renderPass==="offscreen"?u.needsSkyboxCapture(g)&&(function(O,z,U,q){let X=O.context,Q=X.gl,K=z.skyboxFbo;if(!K){K=z.skyboxFbo=X.createFramebuffer(32,32,!0,null),z.skyboxGeometry=new Pm(X),z.skyboxTexture=X.gl.createTexture(),Q.bindTexture(Q.TEXTURE_CUBE_MAP,z.skyboxTexture),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_WRAP_S,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_WRAP_T,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_MIN_FILTER,Q.LINEAR),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_MAG_FILTER,Q.LINEAR);for(let ge=0;ge<6;++ge)Q.texImage2D(Q.TEXTURE_CUBE_MAP_POSITIVE_X+ge,0,Q.RGBA,32,32,0,Q.RGBA,Q.UNSIGNED_BYTE,null)}X.bindFramebuffer.set(K.framebuffer),X.viewport.set([0,0,32,32]);let re=z.getCenter(O,!0),Y=O.getOrCreateProgram("skyboxCapture"),ae=new Float64Array(16);i.a6.identity(ae),i.a6.rotateY(ae,ae,.5*-Math.PI),g0(O,z,Y,ae,re,0),i.a6.identity(ae),i.a6.rotateY(ae,ae,.5*Math.PI),g0(O,z,Y,ae,re,1),i.a6.identity(ae),i.a6.rotateX(ae,ae,.5*-Math.PI),g0(O,z,Y,ae,re,2),i.a6.identity(ae),i.a6.rotateX(ae,ae,.5*Math.PI),g0(O,z,Y,ae,re,3),i.a6.identity(ae),g0(O,z,Y,ae,re,4),i.a6.identity(ae),i.a6.rotateY(ae,ae,Math.PI),g0(O,z,Y,ae,re,5),X.viewport.set([0,0,O.width,O.height])}(g,u),u.markSkyboxValid(g)):g.renderPass==="sky"&&function(O,z,U,q,X){let Q=O.context,K=Q.gl,re=O.transform,Y=O.getOrCreateProgram("skybox");Q.activeTexture.set(K.TEXTURE0),K.bindTexture(K.TEXTURE_CUBE_MAP,z.skyboxTexture);let ae=((ge,ce,_e,oe,ve)=>({u_matrix:ge,u_sun_direction:ce,u_cubemap:0,u_opacity:oe,u_temporal_offset:ve}))(re.skyboxMatrix,z.getCenter(O,!1),0,q,X);O.uploadCommonUniforms(Q,Y),Y.draw(O,K.TRIANGLES,U,tn.disabled,O.colorModeForRenderPass(),Di.backCW,ae,"skybox",z.skyboxGeometry.vertexBuffer,z.skyboxGeometry.indexBuffer,z.skyboxGeometry.segment)}(g,u,P,b,k):A==="gradient"&&g.renderPass==="sky"&&function(O,z,U,q,X){let Q=O.context,K=Q.gl,re=O.transform,Y=O.getOrCreateProgram("skyboxGradient");z.skyboxGeometry||(z.skyboxGeometry=new Pm(Q)),Q.activeTexture.set(K.TEXTURE0);let ae=z.colorRampTexture;ae||(ae=z.colorRampTexture=new i.T(Q,z.colorRamp,K.RGBA)),ae.bind(K.LINEAR,K.CLAMP_TO_EDGE);let ge=((ce,_e,oe,ve,Ae)=>({u_matrix:ce,u_color_ramp:0,u_center_direction:_e,u_radius:i.bj(oe),u_opacity:ve,u_temporal_offset:Ae}))(re.skyboxMatrix,z.getCenter(O,!1),z.paint.get("sky-gradient-radius"),q,X);O.uploadCommonUniforms(Q,Y),Y.draw(O,K.TRIANGLES,U,tn.disabled,O.colorModeForRenderPass(),Di.backCW,ge,"skyboxGradient",z.skyboxGeometry.vertexBuffer,z.skyboxGeometry.indexBuffer,z.skyboxGeometry.segment)}(g,u,P,b,k)},debug:function(g,c,u,_,b,S){for(let A=0;A<u.length;A++)if(b){let O=new i.ax(_.r*.8,_.g*.8,_.b*.8,1);Ic(g,c,u[A],_,-1,-1,S),Ic(g,c,u[A],_,-1,1,S),Ic(g,c,u[A],_,1,1,S),Ic(g,c,u[A],_,1,-1,S),Ic(g,c,u[A],O,0,0,S)}else Ic(g,c,u[A],_,0,0,S)},custom:function(g,c,u,_){let b=g.context,S=u.implementation;if(!g.transform.projection.unsupportedLayers||!g.transform.projection.unsupportedLayers.includes("custom")||g.terrain&&(g.terrain.renderingToTexture||g.renderPass==="offscreen")&&u.isLayerDraped(c)){if(g.renderPass==="offscreen"){let A=S.prerender;if(A){if(g.setCustomLayerDefaults(),b.setColorMode(g.colorModeForRenderPass()),g.transform.projection.name==="globe"){let P=g.transform.pointMerc;A.call(S,b.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),i.S(g.transform.zoom),[P.x,P.y],g.transform.pixelsPerMeterRatio)}else A.call(S,b.gl,g.transform.customLayerMatrix());b.setDirty(),g.setBaseState()}}else if(g.renderPass==="translucent"){if(g.terrain&&g.terrain.renderingToTexture){let P=S.renderToTile;if(P){let k=_[0].canonical,O=new i.L(k.x+_[0].wrap*(1<<k.z),k.y,k.z);b.setDepthMode(ki.disabled),b.setStencilMode(tn.disabled),b.setColorMode(g.colorModeForRenderPass()),g.setCustomLayerDefaults(),P.call(S,b.gl,O),b.setDirty(),g.setBaseState()}return}g.setCustomLayerDefaults(),b.setColorMode(g.colorModeForRenderPass()),b.setStencilMode(tn.disabled);let A=S.renderingMode==="3d"?new ki(g.context.gl.LEQUAL,ki.ReadWrite,g.depthRangeFor3D):g.depthModeForSublayer(0,ki.ReadOnly);if(b.setDepthMode(A),g.transform.projection.name==="globe"){let P=g.transform.pointMerc;S.render(b.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),i.S(g.transform.zoom),[P.x,P.y],g.transform.pixelsPerMeterRatio)}else S.render(b.gl,g.transform.customLayerMatrix());b.setDirty(),g.setBaseState(),b.bindFramebuffer.set(null)}}else i.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(g,c,u,_){if(g.renderPass==="opaque")return;let b=u.paint.get("model-opacity");if(b===0)return;let S=u.paint.get("model-cast-shadows");if(g.renderPass==="shadow"&&(!S||g.terrain&&b<.65&&u._transitionablePaint._values["model-opacity"].value.expression instanceof i.Z))return;let A=g.shadowRenderer,P=u.paint.get("model-receive-shadows");A&&(A.useNormalOffset=!0,P||(A.enabled=!1));let k=()=>{A&&(A.useNormalOffset=!0,P||(A.enabled=!0))},O=c.getSource();if(g.renderPass==="light-beam"&&O.type!=="batched-model")return;if(O.type==="vector"||O.type==="geojson")return function(Y,ae,ge,ce){let _e=Y.transform;if(_e.projection.name!=="mercator")return void i.w(`Drawing 3D models for ${_e.projection.name} projection is not yet implemented`);let oe=_e.getFreeCameraOptions().position;if(!Y.modelManager)return;let ve=Y.modelManager;ge.modelManager=ve;let Ae=Y.shadowRenderer;if(!ge._unevaluatedLayout._values.hasOwnProperty("model-id"))return;let Re=ge._unevaluatedLayout._values["model-id"],Oe=Ti({},ge.layout.get("model-id").parameters);for(let Je of ce){let Ue=ae.getTile(Je).getBucket(ge);if(!Ue||Ue.projection.name!==_e.projection.name)continue;let ot=K_(Je,_e);Oe.zoom=ot;let nt=Re.possiblyEvaluate(Oe);if(Rm(Y,Ue,Je),oa.shadowUniformsInitialized=!1,oa.useSingleShadowCascade=!!Ae&&Ae.getMaxCascadeForTile(Je.toUnwrapped())===0,Y.renderPass==="shadow"&&Ae){if(Y.currentShadowCascade===1&&Ue.isInsideFirstShadowMapFrustum)continue;let tt=_e.calculatePosMatrix(Je.toUnwrapped(),_e.worldSize);if(oa.tileMatrix.set(tt),oa.shadowTileMatrix=Float32Array.from(Ae.calculateShadowPassMatrixFromMatrix(tt)),oa.aabb.min.fill(0),oa.aabb.max[0]=oa.aabb.max[1]=i.V,oa.aabb.max[2]=0,Hy(Ue,oa,Y,ge.scope))continue}let Rt=1<<Je.canonical.z,je=[((oe.x-Je.wrap)*Rt-Je.canonical.x)*i.V,(oe.y*Rt-Je.canonical.y)*i.V,oe.z*Rt*i.V];for(let tt in Ue.instancesPerModel){let Fe=Ue.instancesPerModel[tt];Fe.features.length>0&&(tt=nt.evaluate(Fe.features[0].feature,{}));let Ze=ve.getModel(tt,ge.scope);if(Ze&&Ze.uploaded)for(let Dt of Ze.nodes)km(Y,ge,Dt,Fe,je,Je,oa)}}}(g,c,u,_),void k();if(!O.loaded())return;if(O.type==="batched-model")return function(Y,ae,ge,ce){ge.resetLayerRenderingStats(Y);let _e=Y.context,oe=Y.transform,ve=Y.style.fog,Ae=Y.shadowRenderer;if(oe.projection.name!=="mercator")return void i.w(`Drawing 3D landmark models for ${oe.projection.name} projection is not yet implemented`);let Re=Y.transform.getFreeCameraOptions().position,Oe=i.N.scale([],[Re.x,Re.y,Re.z],Y.transform.worldSize);i.N.negate(Oe,Oe);let Je=i.a6.identity([]),Ue=i.cR(oe.center.lat,oe.zoom),ot=i.a6.fromScaling([],[1,1,1/Ue]);i.a6.translate(Je,Je,Oe);let nt=ge.paint.get("model-opacity"),Rt=new ki(_e.gl.LEQUAL,ki.ReadWrite,Y.depthRangeFor3D),je=new ki(_e.gl.LEQUAL,ki.ReadOnly,Y.depthRangeFor3D),tt=new i.bS([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Fe=Y.renderPass==="shadow",Ze=Fe&&Ae?Ae.getCurrentCascadeFrustum():oe.getFrustum(oe.scaleZoom(oe.worldSize)),Dt=ge.getLayerRenderingStats(),jt=function(Ut,ti){for(let mi of ce){let Ei=ae.getTile(mi).getBucket(ge);if(!Ei||!Ei.uploaded)continue;let xi=!1;Ae&&(xi=Ae.getMaxCascadeForTile(mi.toUnwrapped())===0);let Si=oe.calculatePosMatrix(mi.toUnwrapped(),oe.worldSize),gn=Ei.modelTraits;for(let Zi of Ei.getNodesInfo()){if(Zi.hiddenByReplacement||!Zi.node.meshes)continue;let hn=Zi.evaluatedScale,an=Zi.node,Wn=0;if(Y.terrain&&an.elevation&&(Wn=an.elevation*Y.terrain.exaggeration()),hn[0]<=1&&hn[1]<=1&&hn[2]<=1&&(()=>{let Nr=Zi.getLocalBounds();return tt.min=[...Nr.min],tt.max=[...Nr.max],tt.min[2]+=Wn,tt.max[2]+=Wn,i.N.transformMat4(tt.min,tt.min,Si),i.N.transformMat4(tt.max,tt.max,Si),tt})().intersects(Ze)===0)continue;let Dr=Y.renderPass==="light-beam",An=[...Si];i.a6.translate(An,An,[(an.anchor?an.anchor[0]:0)*(hn[0]-1),(an.anchor?an.anchor[1]:0)*(hn[1]-1),Wn]),i.N.exactEquals(hn,i.cT)||i.a6.scale(An,An,hn),i.a6.multiply(An,An,an.matrix);let Kr=i.a6.multiply([],ot,An);i.a6.multiply(Kr,Je,Kr);let Cn=i.a6.invert([],Kr);i.a6.transpose(Cn,Cn),i.a6.scale(Cn,Cn,mh);let er=i.a6.multiply([],oe.expandedFarZProjMatrix,An),In=gn&i.cV.HasMapboxMeshFeatures,Kn=In?0:Zi.evaluatedRMEA[0][2];for(let Nr=0;Nr<an.meshes.length;++Nr){let ar=an.meshes[Nr],Vs=Nr===an.lightMeshIndex;if(Vs){if(!Dr&&!Y.terrain&&Y.shadowRenderer){Y.currentLayer<Y.firstLightBeamLayer&&(Y.firstLightBeamLayer=Y.currentLayer);continue}}else if(Dr)continue;let oo={defines:[]},qo=[];if(Jr(oo.defines,qo,ar,Y),In||oo.defines.push("DIFFUSE_SHADED"),xi&&oo.defines.push("SHADOWS_SINGLE_CASCADE"),Dt&&(Fe?Dt.numRenderedVerticesInShadowPass+=ar.vertexArray.length:Dt.numRenderedVerticesInTransparentPass+=ar.vertexArray.length),Fe){$e(ar,An,Y,ge);continue}let vl=null;if(ve){let Zo=_0(An,Y.transform);if(vl=new Float32Array(Zo),oe.projection.name!=="globe"){let xl=ar.aabb.min,Lc=ar.aabb.max,[v0,hu]=ve.getOpacityForBounds(Zo,xl[0],xl[1],Lc[0],Lc[1]);oo.overrideFog=v0>=yi||hu>=yi}}let Xo=ar.material,Gs;Xo.occlusionTexture&&Xo.occlusionTexture.offsetScale&&(Gs=Xo.occlusionTexture.offsetScale,oo.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!Fe&&Ae&&(Ae.useNormalOffset=!!ar.normalBuffer);let Rs=Y.getOrCreateProgram("model",oo);!Fe&&Ae&&Ae.setupShadowsFromMatrix(An,Rs,Ae.useNormalOffset),Y.uploadCommonUniforms(_e,Rs,mi.toUnwrapped(),vl);let Mo=Xo.pbrMetallicRoughness;Mo.metallicFactor=.9,Mo.roughnessFactor=.5;let Fo=Cp(new Float32Array(er),new Float32Array(Kr),new Float32Array(Cn),Y,nt,Mo.baseColorFactor,Xo.emissiveFactor,Mo.metallicFactor,Mo.roughnessFactor,Xo,Kn,ge,[0,0,0],Gs);Rs.draw(Y,_e.gl.TRIANGLES,ti&&!Vs?Rt:je,tn.disabled,Ut?Vs||nt<1||Zi.hasTranslucentParts?Mn.alphaBlended:Mn.unblended:Mn.disabled,Di.backCCW,Fo,ge.id,ar.vertexBuffer,ar.indexBuffer,ar.segments,ge.paint,Y.transform.zoom,void 0,qo)}}}};(function(Ut,ti,mi,Ei){let xi=Ut.terrain?Ut.terrain.exaggeration():0,Si=Ut.transform.zoom;for(let gn of Ei){let Zi=ti.getTile(gn).getBucket(mi);Zi&&(Ut.conflationActive&&Zi.updateReplacement(gn,Ut.replacementSource),Zi.evaluateScale(Ut,mi),Ut.terrain&&xi>0&&Zi.elevationUpdate(Ut.terrain,xi,gn,mi.source),Zi.needsReEvaluation(Ut,Si,mi)&&Zi.evaluate(mi))}})(Y,ae,ge,ce),nt===1?jt(!0,!0):(jt(!1,!0),jt(!0,!1))}(g,c,u,_),void k();let z=O.getModels(),U=[],q=g.transform.getFreeCameraOptions().position,X=i.N.scale([],[q.x,q.y,q.z],g.transform.worldSize);i.N.negate(X,X);let Q=[],K=[],re=0;for(let Y of z){let ae=u.paint.get("model-rotation").constantOr(null),ge=u.paint.get("model-scale").constantOr(null),ce=u.paint.get("model-translation").constantOr(null);Y.computeModelMatrix(g,ae,ge,ce,!0,!0,!1);let _e=i.a6.identity([]),oe=i.cR(Y.position.lat,g.transform.zoom),ve=i.a6.fromScaling([],[1,1,1/oe]);i.a6.translate(_e,_e,X),U.push({zScaleMatrix:ve,negCameraPosMatrix:_e});for(let Ae of Y.nodes)Zd(g.transform,Ae,Y.matrix,g.transform.expandedFarZProjMatrix,re,Q,K);re++}if(Q.sort((Y,ae)=>ae.depth-Y.depth),g.renderPass!=="shadow"){if(b===1)for(let Y of K)Xd(Y,g,u,U[Y.modelIndex],tn.disabled,g.colorModeForRenderPass());else{for(let Y of K)Xd(Y,g,u,U[Y.modelIndex],tn.disabled,Mn.disabled);for(let Y of K)Xd(Y,g,u,U[Y.modelIndex],g.stencilModeFor3D(),g.colorModeForRenderPass());g.resetStencilClippingMasks()}for(let Y of Q)Xd(Y,g,u,U[Y.modelIndex],tn.disabled,g.colorModeForRenderPass());k()}else{for(let Y of K)$e(Y.mesh,Y.nodeModelMatrix,g,u);for(let Y of Q)$e(Y.mesh,Y.nodeModelMatrix,g,u);k()}}},Dm={model:function(g,c,u){let _=g.scope,b=c.getSource();if(!b.loaded())return;if(b.type==="vector"||b.type==="geojson")return void(u.modelManager&&u.modelManager.upload(u,_));if(b.type==="batched-model")return;let S=b.getModels();for(let A of S)A.upload(u.context)},raster:function(g,c,u){let _=c.getSource();if(!(_ instanceof Gt&&_.loaded()))return;let b=g.sourceLayer||_.rasterLayerIds&&_.rasterLayerIds[0];if(!b)return;let S=g.paint.get("raster-array-band")||_.getInitialBand(b);if(S==null)return;let A=c.getIds().map(P=>c.getTileByID(P));for(let P of A)P.updateNeeded(b,S)&&_.prepareTile(P,b,S)},"raster-particle":function(g,c,u){let _=c.getSource();if(!(_ instanceof Gt&&_.loaded()))return;let b=g.sourceLayer||_.rasterLayerIds&&_.rasterLayerIds[0];if(!b)return;let S=g.paint.get("raster-particle-array-band")||_.getInitialBand(b);if(S==null)return;let A=c.getIds().map(P=>c.getTileByID(P));for(let P of A)P.updateNeeded(b,S)&&_.prepareTile(P,b,S)}};class e4{constructor(c,u,_,b){this.context=new S_(c,u),this.transform=_,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=b,this._debugParams={showTerrainProxyTiles:!1},b.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),this.setup(),this.numSublayers=Ha.maxUnderzooming+Ha.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new i.cX,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Yf(this),this._wireframeDebugCache=new Q_,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(c,u){let _=!!c&&!!c.terrain&&this.transform.projection.supportsTerrain;if(!(_||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Oy(this,c));let b=this._terrain;this.transform.elevation=_?b:null,b.update(c,this.transform,u),this.transform.elevation&&!b.enabled&&(this.transform.elevation=null)}_updateFog(c){let u=c.fog;if(!u||this.transform.projection.name==="globe"||u.getOpacity(this.transform.pitch)<1||u.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);let[_,b]=u.getFovAdjustedRange(this.transform._fov);if(_>b)return void(this.transform.fogCullDistSq=null);let S=_+.78*(b-_);this.transform.fogCullDistSq=S*S}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(c,u){if(this.width=c*i.f.devicePixelRatio,this.height=u*i.f.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let _ of this.style.order)this.style._mergedLayers[_].resize()}setup(){let c=this.context,u=new i.aN;u.emplaceBack(0,0),u.emplaceBack(i.V,0),u.emplaceBack(0,i.V),u.emplaceBack(i.V,i.V),this.tileExtentBuffer=c.createVertexBuffer(u,i.aP.members),this.tileExtentSegments=i.aB.simpleSegment(0,0,4,2);let _=new i.aN;_.emplaceBack(0,0),_.emplaceBack(i.V,0),_.emplaceBack(0,i.V),_.emplaceBack(i.V,i.V),this.debugBuffer=c.createVertexBuffer(_,i.aP.members),this.debugSegments=i.aB.simpleSegment(0,0,4,5);let b=new i.aN;b.emplaceBack(-1,-1),b.emplaceBack(1,-1),b.emplaceBack(-1,1),b.emplaceBack(1,1),this.viewportBuffer=c.createVertexBuffer(b,i.aP.members),this.viewportSegments=i.aB.simpleSegment(0,0,4,2);let S=new i.av;S.emplaceBack(0,0,0,0),S.emplaceBack(i.V,0,i.V,0),S.emplaceBack(0,i.V,0,i.V),S.emplaceBack(i.V,i.V,i.V,i.V),this.mercatorBoundsBuffer=c.createVertexBuffer(S,i.aR.members),this.mercatorBoundsSegments=i.aB.simpleSegment(0,0,4,2);let A=new i.aw;A.emplaceBack(0,1,2),A.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=c.createIndexBuffer(A);let P=new i.aO;for(let O of[0,1,3,2,0])P.emplaceBack(O);this.debugIndexBuffer=c.createIndexBuffer(P),this.emptyTexture=new i.T(c,new i.h({width:1,height:1},Uint8Array.of(0,0,0,0)),c.gl.RGBA),this.identityMat=i.a6.create();let k=this.context.gl;this.stencilClearMode=new tn({func:k.ALWAYS,mask:0},0,255,k.ZERO,k.ZERO,k.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(c){return c._makeTileBoundsBuffers(this.context,this.transform.projection),c._tileBoundsBuffer?{tileBoundsBuffer:c._tileBoundsBuffer,tileBoundsIndexBuffer:c._tileBoundsIndexBuffer,tileBoundsSegments:c._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){let c=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,c.TRIANGLES,ki.disabled,this.stencilClearMode,Mn.disabled,Di.disabled,am(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(c,u,_){if(!u||this.currentStencilSource===u.id||!c.isTileClipped()||!_||_.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let P=!1;for(let k of _)if(this._tileClippingMaskIDs[k.key]===void 0){P=!0;break}if(!P)return}this.currentStencilSource=u.id;let b=this.context,S=b.gl;this.nextStencilID+_.length>256&&this.clearStencil(),b.setColorMode(Mn.disabled),b.setDepthMode(ki.disabled);let A=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(let P of _){let k=u.getTile(P),O=this._tileClippingMaskIDs[P.key]=this.nextStencilID++,{tileBoundsBuffer:z,tileBoundsIndexBuffer:U,tileBoundsSegments:q}=this.getTileBoundsBuffers(k);A.draw(this,S.TRIANGLES,ki.disabled,new tn({func:S.ALWAYS,mask:0},O,255,S.KEEP,S.KEEP,S.REPLACE),Mn.disabled,Di.disabled,am(P.projMatrix),"$clipping",z,U,q)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let c=this.nextStencilID++,u=this.context.gl;return new tn({func:u.NOTEQUAL,mask:255},c,255,u.KEEP,u.KEEP,u.REPLACE)}stencilModeForClipping(c){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(c);let u=this.context.gl;return new tn({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[c.key],0,u.KEEP,u.KEEP,u.REPLACE)}stencilConfigForOverlap(c){let u=this.context.gl,_=c.sort((A,P)=>P.overscaledZ-A.overscaledZ),b=_[_.length-1].overscaledZ,S=_[0].overscaledZ-b+1;if(S>1){this.currentStencilSource=void 0,this.nextStencilID+S>256&&this.clearStencil();let A={};for(let P=0;P<S;P++)A[P+b]=new tn({func:u.GEQUAL,mask:255},P+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=S,[A,_]}return[{[b]:tn.disabled},_]}colorModeForRenderPass(){let c=this.context.gl;return this._showOverdrawInspector?new Mn([c.CONSTANT_COLOR,c.ONE,c.CONSTANT_COLOR,c.ONE],new i.ax(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Mn.unblended:Mn.alphaBlended}colorModeForDrapableLayerRenderPass(c){let u=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Mn([u.ONE,u.ONE_MINUS_SRC_ALPHA,u.CONSTANT_ALPHA,u.ONE_MINUS_SRC_ALPHA],new i.ax(0,0,0,c===void 0?0:c),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(c,u,_,b=!1){if(!this.opaquePassEnabledForLayer()&&!b)return ki.disabled;let S=1-((1+this.currentLayer)*this.numSublayers+c)*this.depthEpsilon;return new ki(_||this.context.gl.LEQUAL,u,[S,S])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(c,u){this._wireframeDebugCache.update(this.frameCounter),this.style=c,this.options=u;let _=this.style._mergedLayers,b=this.style.order,S=b.map(oe=>_[oe]),A=this.style._mergedSourceCaches;this.imageManager=c.imageManager,this.modelManager=c.modelManager,this.symbolFadeChange=c.placement.symbolFadeChange(i.f.now()),this.imageManager.beginFrame();let P=0,k=!1;for(let oe in A){let ve=A[oe];ve.used&&(ve.prepare(this.context),ve.getSource().usedInConflation&&++P)}for(let oe of S)oe.isHidden(this.transform.zoom)||this.prepareLayer(oe);let O={},z={},U={},q={},X={};for(let oe in A){let ve=A[oe];O[oe]=ve.getVisibleCoordinates(),z[oe]=O[oe].slice().reverse(),U[oe]=ve.getVisibleCoordinates(!0).reverse(),q[oe]=ve.getShadowCasterCoordinates(),X[oe]=ve.sortCoordinatesByDistance(O[oe])}let Q=oe=>{let ve=this.style.getLayerSourceCache(oe);return ve&&ve.used?ve.getSource():null};if(P){let oe=[];for(let ve of S)this.layerUsedInConflation(ve,Q(ve))&&oe.push(ve);if(oe&&oe.length>1){let ve=[];for(let Ae of oe){let Re=this.style.getLayerSourceCache(Ae);Re&&Re.used&&Re.getSource().usedInConflation&&ve.push({layer:Ae.fqid,cache:Re})}this.replacementSource.setSources(ve),k=!0}}k||this.replacementSource.clear(),this.conflationActive=k,this.minCutoffZoom=0,this.longestCutoffRange=0;for(let oe of S){let ve=oe.cutoffRange();if(this.longestCutoffRange=Math.max(ve,this.longestCutoffRange),ve>0){let Ae=Q(oe);Ae&&(this.minCutoffZoom=Math.max(Ae.minzoom,this.minCutoffZoom)),oe.minzoom&&(this.minCutoffZoom=Math.max(oe.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let oe=0;oe<S.length;oe++)if(S[oe].is3D()){this.opaquePassCutoff=oe;break}let K=this.style&&this.style.fog;K?(this._fogVisible=K.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=K.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(U),this.opaquePassCutoff=0);let re=this._shadowRenderer;if(re){re.updateShadowParameters(this.transform,this.style.directionalLight);for(let oe in A)for(let ve of O[oe]){let Ae={min:0,max:0};this.terrain&&(Ae=this.terrain.getMinMaxForTile(ve)||Ae),re.addShadowReceiver(ve.toUnwrapped(),Ae.min,Ae.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new i.cY(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Ai(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!i.cZ(this.context.gl))return;this.renderPass="offscreen";for(let oe of S){let ve=c.getLayerSourceCache(oe);if(!oe.hasOffscreenPass()||oe.isHidden(this.transform.zoom))continue;let Ae=ve?z[ve.id]:void 0;(oe.type==="custom"||oe.type==="raster"||oe.type==="raster-particle"||oe.isSky()||Ae&&Ae.length)&&this.renderLayer(this,ve,oe,Ae)}this.depthRangeFor3D=[0,1-(S.length+2)*this.numSublayers*this.depthEpsilon];let Y=this.terrain;Y&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&Y.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,q)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let ae=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),ge=(()=>{if(u.showOverdrawInspector)return i.ax.black;if(this.style.fog&&this.transform.projection.supportsFog&&!ae){let oe=this.style.fog.properties.get("color").toArray01();return new i.ax(...oe)}if(this.style.fog&&this.transform.projection.supportsFog&&ae){let oe=this.style.fog.properties.get("space-color").toArray01();return new i.ax(...oe)}return i.ax.transparent})();if(this.context.clear({color:ge,depth:1}),this.clearStencil(),this._showOverdrawInspector=u.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ae&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=b.length-1;this.currentLayer>=0;this.currentLayer--){let oe=S[this.currentLayer],ve=c.getLayerSourceCache(oe);if(oe.isSky())continue;let Ae=ve?(oe.is3D()?X:z)[ve.id]:void 0;this._renderTileClippingMasks(oe,ve,Ae),this.renderLayer(this,ve,oe,Ae)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ae&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||i.S(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<b.length;this.currentLayer++){let oe=S[this.currentLayer],ve=c.getLayerSourceCache(oe);oe.isSky()&&this.renderLayer(this,ve,oe,ve?z[ve.id]:void 0)}function ce(oe,ve){let Ae;return ve&&(Ae=(oe.type==="symbol"?U:oe.is3D()?X:z)[ve.id]),Ae}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<b.length;){let oe=S[this.currentLayer];if(oe.type==="raster"){let ve=c.getLayerSourceCache(oe);this.renderLayer(this,ve,oe,ce(oe,ve))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let _e=0;for(re&&(_e=re.getShadowCastingLayerCount());this.currentLayer<b.length;){let oe=S[this.currentLayer],ve=c.getLayerSourceCache(oe);if(oe.isSky())++this.currentLayer;else if(Y&&this.style.isLayerDraped(oe)){if(oe.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=Y.renderBatch(this.currentLayer)}else{if(this._renderTileClippingMasks(oe,ve,ve?O[ve.id]:void 0),this.renderLayer(this,ve,oe,ce(oe,ve)),!Y&&re&&_e>0&&oe.hasShadowPass()&&--_e==0&&(re.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){let Ae=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Ae;this.currentLayer++){let Re=S[this.currentLayer];if(!Re.hasLightBeamPass())continue;let Oe=c.getLayerSourceCache(Re);this.renderLayer(this,Oe,Re,Oe?z[Oe.id]:void 0)}this.currentLayer=Ae,this.renderPass="translucent"}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let oe=null;S.forEach(ve=>{let Ae=c.getLayerSourceCache(ve);Ae&&!ve.isHidden(this.transform.zoom)&&Ae.getVisibleCoordinates().length&&(!oe||oe.getSource().maxzoom<Ae.getSource().maxzoom)&&(oe=Ae)}),oe&&this.options.showTileBoundaries&&Yd.debug(this,oe,oe.getVisibleCoordinates(),i.ax.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Yd.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new i.ax(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(oe){let ve=oe.transform.padding;Cm(oe,oe.transform.height-(ve.top||0),3,jo),Cm(oe,ve.bottom||0,3,Cc),sa(oe,ve.left||0,3,J_),sa(oe,oe.transform.width-(ve.right||0),3,Em);let Ae=oe.transform.centerPoint;(function(Re,Oe,Je,Ue){Yr(Re,Oe-1,Je-10,2,20,Ue),Yr(Re,Oe-10,Je-1,20,2,Ue)})(oe,Ae.x,oe.transform.height-Ae.y,Am)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),k||(this.conflationActive=!1)}prepareLayer(c){this.gpuTimingStart(c);let{unsupportedLayers:u}=this.transform.projection,_=!u||!u.includes(c.type);if(Dm[c.type]&&(_||this.terrain&&c.type==="custom")){let b=this.style.getLayerSourceCache(c);Dm[c.type](c,b,this)}this.gpuTimingEnd()}renderLayer(c,u,_,b){_.isHidden(this.transform.zoom)||(_.type==="background"||_.type==="sky"||_.type==="custom"||_.type==="model"||_.type==="raster"||_.type==="raster-particle"||b&&b.length)&&(this.id=_.id,this.gpuTimingStart(_),(!c.transform.projection.unsupportedLayers||!c.transform.projection.unsupportedLayers.includes(_.type)||c.terrain&&_.type==="custom")&&Yd[_.type](c,u,_,b,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(c){if(!this.options.gpuTiming)return;let u=this.context.extTimerQuery,_=this.context.gl,b=this.gpuTimers[c.id];b||(b=this.gpuTimers[c.id]={calls:0,cpuTime:0,query:_.createQuery()}),b.calls++,_.beginQuery(u.TIME_ELAPSED_EXT,b.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){let c=this.context.extTimerQuery,u=this.context.gl,_=u.createQuery();this.deferredRenderGpuTimeQueries.push(_),u.beginQuery(c.TIME_ELAPSED_EXT,_)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){let c=this.gpuTimers;return this.gpuTimers={},c}collectDeferredRenderGpuQueries(){let c=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],c}queryGpuTimers(c){let u={};for(let _ in c){let b=c[_],S=this.context.extTimerQuery,A=S.getQueryParameter(b.query,this.context.gl.QUERY_RESULT)/1e6;S.deleteQueryEXT(b.query),u[_]=A}return u}queryGpuTimeDeferredRender(c){if(!this.options.gpuTimingDeferredRender)return 0;let u=this.context.extTimerQuery,_=this.context.gl,b=0;for(let S of c)b+=u.getQueryParameter(S,_.QUERY_RESULT)/1e6,u.deleteQueryEXT(S);return b}translatePosMatrix(c,u,_,b,S){if(!_[0]&&!_[1])return c;let A=S?b==="map"?this.transform.angle:0:b==="viewport"?-this.transform.angle:0;if(A){let O=Math.sin(A),z=Math.cos(A);_=[_[0]*z-_[1]*O,_[0]*O+_[1]*z]}let P=[S?_[0]:i.a3(u,_[0],this.transform.zoom),S?_[1]:i.a3(u,_[1],this.transform.zoom),0],k=new Float32Array(16);return i.a6.translate(k,c,P),k}saveTileTexture(c){let u=c.size[0],_=this._tileTextures[u];_?_.push(c):this._tileTextures[u]=[c]}getTileTexture(c){let u=this._tileTextures[c];return u&&u.length>0?u.pop():null}isPatternMissing(c,u){return c===null||c!==void 0&&!this.imageManager.getPattern(c.toString(),u)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(c,u,_){let b=_===void 0?this.terrain&&this.terrain.renderingToTexture:_,S=this.terrain&&this.terrain.exaggeration()===0,A=[];return this.style&&this.style.enable3dLights()&&(c==="globeRaster"||c==="terrainRaster"?(A.push("LIGHTING_3D_MODE"),A.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):b||A.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||A.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?A.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):A.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(A.push("TERRAIN"),this.linearFloatFilteringSupported()&&A.push("TERRAIN_DEM_FLOAT_FORMAT"),S&&A.push("ZERO_EXAGGERATION")),this.transform.projection.name==="globe"&&A.push("GLOBE"),!this._fogVisible||b||u!==void 0&&!u||A.push("FOG","FOG_DITHERING"),b&&A.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&A.push("OVERDRAW_INSPECTOR"),A}getOrCreateProgram(c,u){this.cache=this.cache||{};let _=u&&u.defines||[],b=u&&u.config,S=u&&u.transformFeedback,A=this.currentGlobalDefines(c,u&&u.overrideFog,u&&u.overrideRtt).concat(_),P=dm.cacheKey(im[c],c,A,b);return this.cache[P]||(this.cache[P]=new dm(this.context,c,im[c],b,By[c],A,S)),this.cache[P]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let c=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(c.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new i.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(c,u){if(this.style.enable3dLights()){let _=this.style.directionalLight,b=this.style.ambientLight;if(_&&b){let S=((A,P)=>{let k=A.properties.get("direction"),O=A.properties.get("color").toArray01(),z=A.properties.get("intensity"),U=P.properties.get("color").toArray01(),q=P.properties.get("intensity"),X=[k.x,k.y,k.z],Q=i.cn(U,q),K=i.cn(O,z);return{u_lighting_ambient_color:Q,u_lighting_directional_dir:X,u_lighting_directional_color:K,u_ground_radiance:cm(X,K,Q)}})(_,b);u.setLightsUniformValues(c,S)}}}uploadCommonUniforms(c,u,_,b,S){if(this.uploadCommonLightUniforms(c,u),this.terrain&&this.terrain.renderingToTexture)return;let A=this.style.fog;if(A){let P=A.getOpacity(this.transform.pitch),k=((O,z,U,q,X,Q,K,re,Y,ae,ge,ce)=>{let _e=O.transform,oe=z.properties.get("color").toArray01();oe[3]=q;let ve=O.frameCounter/1e3%1,[Ae,Re]=z.properties.get("vertical-range");return{u_fog_matrix:U?_e.calculateFogTileMatrix(U):ce||O.identityMat,u_fog_range:z.getFovAdjustedRange(_e._fov),u_fog_color:oe,u_fog_horizon_blend:z.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Ae,Re),Re],u_fog_temporal_offset:ve,u_frustum_tl:X,u_frustum_tr:Q,u_frustum_br:K,u_frustum_bl:re,u_globe_pos:Y,u_globe_radius:ae,u_viewport:ge,u_globe_transition:i.S(_e.zoom),u_is_globe:+(_e.projection.name==="globe")}})(this,A,_,P,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*i.f.devicePixelRatio,this.transform.height*i.f.devicePixelRatio],b);u.setFogUniformValues(c,k)}S&&u.setCutoffUniformValues(c,S.uniformValues)}setTileLoadedFlag(c){this.tileLoaded=c}saveCanvasCopy(){let c=this.canvasCopy();c&&(this.frameCopies.push(c),this.tileLoaded=!1)}canvasCopy(){let c=this.context.gl,u=c.createTexture();return c.bindTexture(c.TEXTURE_2D,u),c.copyTexImage2D(c.TEXTURE_2D,0,c.RGBA,0,0,c.drawingBufferWidth,c.drawingBufferHeight,0),u}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;let c=this.style&&this.style.fog;return!!c&&c.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){let c=this._backgroundTiles,u=this._backgroundTiles={},_=this.transform.coveringTiles({tileSize:512});for(let b of _)u[b.key]=c[b.key]||new _c(b,512,this.transform.tileZoom,this);return u}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(c,u){return!(!c.is3D()||c.minzoom&&c.minzoom>this.transform.zoom||c.sourceLayer!=="building"&&(!u||u.type!=="batched-model"))}isTileAffectedByFog(c){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let u=this._cachedTileFogOpacities[c.key];return u||(this._cachedTileFogOpacities[c.key]=u=this.style.fog.getOpacityForTile(c)),u[0]>=yi||u[1]>=yi}}function Jd(g,c){let u=!1,_=null,b=()=>{_=null,u&&(g(),_=setTimeout(b,c),u=!1)};return()=>(u=!0,_||b(),_)}class Rp{constructor(c){this._hashName=c&&encodeURIComponent(c),i.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Jd(this._updateHashUnthrottled.bind(this),300)}addTo(c){return this._map=c,window.addEventListener("hashchange",this._onHashChange,!1),c.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){let c=this._map;if(!c)return"";let u=Lm(c);if(this._hashName){let _=this._hashName,b=!1,S=location.hash.slice(1).split("&").map(A=>{let P=A.split("=")[0];return P===_?(b=!0,`${P}=${u}`):A}).filter(A=>A);return b||S.push(`${_}=${u}`),`#${S.join("&")}`}return`#${u}`}_getCurrentHash(){let c=location.hash.replace("#","");if(this._hashName){let u;return c.split("&").map(_=>_.split("=")).forEach(_=>{_[0]===this._hashName&&(u=_)}),(u&&u[1]||"").split("/")}return c.split("/")}_onHashChange(){let c=this._map;if(!c)return!1;let u=this._getCurrentHash();if(u.length>=3&&!u.some(_=>isNaN(_))){let _=c.dragRotate.isEnabled()&&c.touchZoomRotate.isEnabled()?+(u[3]||0):c.getBearing();return c.jumpTo({center:[+u[2],+u[1]],zoom:+u[0],bearing:_,pitch:+(u[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Lm(g,c){let u=g.getCenter(),_=Math.round(100*g.getZoom())/100,b=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),S=Math.pow(10,b),A=Math.round(u.lng*S)/S,P=Math.round(u.lat*S)/S,k=g.getBearing(),O=g.getPitch(),z=c?`/${A}/${P}/${_}`:`${_}/${P}/${A}`;return(k||O)&&(z+="/"+Math.round(10*k)/10),O&&(z+=`/${Math.round(O)}`),z}let Kd={linearity:.3,easing:i.c_(0,0,.3,1)},Wo=i.e({deceleration:2500,maxSpeed:1400},Kd),Wy=i.e({deceleration:20,maxSpeed:1400},Kd),kp=i.e({deceleration:1e3,maxSpeed:360},Kd),Gr=i.e({deceleration:1e3,maxSpeed:90},Kd);class gr{constructor(c){this._map=c,this.clear()}clear(){this._inertiaBuffer=[]}record(c){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:i.f.now(),settings:c})}_drainInertiaBuffer(){let c=this._inertiaBuffer,u=i.f.now();for(;c.length>0&&u-c[0].time>160;)c.shift()}_onMoveEnd(c){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;let u={zoom:0,bearing:0,pitch:0,pan:new i.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:S}of this._inertiaBuffer)u.zoom+=S.zoomDelta||0,u.bearing+=S.bearingDelta||0,u.pitch+=S.pitchDelta||0,S.panDelta&&u.pan._add(S.panDelta),S.around&&(u.around=S.around),S.pinchAround&&(u.pinchAround=S.pinchAround);let _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,b={};if(u.pan.mag()){let S=Za(u.pan.mag(),_,i.e({},Wo,c||{}));b.offset=u.pan.mult(S.amount/u.pan.mag()),b.center=this._map.transform.center,Qd(b,S)}if(u.zoom){let S=Za(u.zoom,_,Wy);b.zoom=this._map.transform.zoom+S.amount,Qd(b,S)}if(u.bearing){let S=Za(u.bearing,_,kp);b.bearing=this._map.transform.bearing+i.aa(S.amount,-179,179),Qd(b,S)}if(u.pitch){let S=Za(u.pitch,_,Gr);b.pitch=this._map.transform.pitch+S.amount,Qd(b,S)}if(b.zoom||b.bearing){let S=u.pinchAround===void 0?u.around:u.pinchAround;b.around=S?this._map.unproject(S):this._map.getCenter()}return this.clear(),b.noMoveStart=!0,b}}function Qd(g,c){(!g.duration||g.duration<c.duration)&&(g.duration=c.duration,g.easing=c.easing)}function Za(g,c,u){let{maxSpeed:_,linearity:b,deceleration:S}=u,A=i.aa(g*b/(c/1e3),-_,_),P=Math.abs(A)/(S*b);return{easing:u.easing,duration:1e3*P,amount:A*(P/2)}}class Lo extends i.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,u,_,b={}){let S=ne(u.getCanvasContainer(),_),A=u.unproject(S);super(c,i.e({point:S,lngLat:A,originalEvent:_},b)),this._defaultPrevented=!1,this.target=u}}class zl extends i.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,u,_){let b=c==="touchend"?_.changedTouches:_.touches,S=fe(u.getCanvasContainer(),b),A=S.map(k=>u.unproject(k)),P=S.reduce((k,O,z,U)=>k.add(O.div(U.length)),new i.P(0,0));super(c,{points:S,point:P,lngLats:A,lngLat:u.unproject(P),originalEvent:_}),this._defaultPrevented=!1}}class Fm extends i.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,u,_){super(c,{originalEvent:_}),this._defaultPrevented=!1}}class Om{constructor(c,u){this._map=c,this._clickTolerance=u.clickTolerance}reset(){this._mousedownPos=void 0}wheel(c){return this._firePreventable(new Fm(c.type,this._map,c))}mousedown(c,u){return this._mousedownPos=u,this._firePreventable(new Lo(c.type,this._map,c))}mouseup(c){this._map.fire(new Lo(c.type,this._map,c))}preclick(c){let u=i.e({},c);u.type="preclick",this._map.fire(new Lo(u.type,this._map,u))}click(c,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||(this.preclick(c),this._map.fire(new Lo(c.type,this._map,c)))}dblclick(c){return this._firePreventable(new Lo(c.type,this._map,c))}mouseover(c){this._map.fire(new Lo(c.type,this._map,c))}mouseout(c){this._map.fire(new Lo(c.type,this._map,c))}touchstart(c){return this._firePreventable(new zl(c.type,this._map,c))}touchmove(c){this._map.fire(new zl(c.type,this._map,c))}touchend(c){this._map.fire(new zl(c.type,this._map,c))}touchcancel(c){this._map.fire(new zl(c.type,this._map,c))}_firePreventable(c){if(this._map.fire(c),c.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Pc{constructor(c){this._map=c}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(c){this._map.fire(new Lo(c.type,this._map,c))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Lo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(c){this._delayContextMenu?this._contextMenuEvent=c:this._map.fire(new Lo(c.type,this._map,c)),this._map.listens("contextmenu")&&c.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Rc{constructor(c,u){this._map=c,this._el=c.getCanvasContainer(),this._container=c.getContainer(),this._clickTolerance=u.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(c,u){this.isEnabled()&&c.shiftKey&&c.button===0&&(Z(),this._startPos=this._lastPos=u,this._active=!0)}mousemoveWindow(c,u){if(!this._active)return;let _=u,b=this._startPos,S=this._lastPos;if(!b||!S||S.equals(_)||!this._box&&_.dist(b)<this._clickTolerance)return;this._lastPos=_,this._box||(this._box=C("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",c));let A=Math.min(b.x,_.x),P=Math.max(b.x,_.x),k=Math.min(b.y,_.y),O=Math.max(b.y,_.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${A}px,${k}px)`,this._box.style.width=P-A+"px",this._box.style.height=O-k+"px")})}mouseupWindow(c,u){if(!this._active)return;let _=this._startPos,b=u;if(_&&c.button===0){if(this.reset(),me(),_.x!==b.x||_.y!==b.y)return this._map.fire(new i.b("boxzoomend",{originalEvent:c})),{cameraAnimation:S=>S.fitScreenCoordinates(_,b,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",c)}}keydown(c){this._active&&c.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",c))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),G(),delete this._startPos,delete this._lastPos}_fireEvent(c,u){return this._map.fire(new i.b(c,{originalEvent:u}))}}function gh(g,c){let u={};for(let _=0;_<g.length;_++)u[g[_].identifier]=c[_];return u}class Dp{constructor(c){this.reset(),this.numTouches=c.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(c,u,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=c.timeStamp),_.length===this.numTouches&&(this.centroid=function(b){let S=new i.P(0,0);for(let A of b)S._add(A);return S.div(b.length)}(u),this.touches=gh(_,u)))}touchmove(c,u,_){if(this.aborted||!this.centroid)return;let b=gh(_,u);for(let S in this.touches){let A=b[S];(!A||A.dist(this.touches[S])>30)&&(this.aborted=!0)}}touchend(c,u,_){if((!this.centroid||c.timeStamp-this.startTime>500)&&(this.aborted=!0),_.length===0){let b=!this.aborted&&this.centroid;if(this.reset(),b)return b}}}class eu{constructor(c){this.singleTap=new Dp(c),this.numTaps=c.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(c,u,_){this.singleTap.touchstart(c,u,_)}touchmove(c,u,_){this.singleTap.touchmove(c,u,_)}touchend(c,u,_){let b=this.singleTap.touchend(c,u,_);if(b){let S=c.timeStamp-this.lastTime<500,A=!this.lastTap||this.lastTap.dist(b)<30;if(S&&A||this.reset(),this.count++,this.lastTime=c.timeStamp,this.lastTap=b,this.count===this.numTaps)return this.reset(),b}}}class Nm{constructor(){this._zoomIn=new eu({numTouches:1,numTaps:2}),this._zoomOut=new eu({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(c,u,_){this._zoomIn.touchstart(c,u,_),this._zoomOut.touchstart(c,u,_)}touchmove(c,u,_){this._zoomIn.touchmove(c,u,_),this._zoomOut.touchmove(c,u,_)}touchend(c,u,_){let b=this._zoomIn.touchend(c,u,_),S=this._zoomOut.touchend(c,u,_);return b?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:A=>A.easeTo({duration:300,zoom:A.getZoom()+1,around:A.unproject(b)},{originalEvent:c})}):S?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:A=>A.easeTo({duration:300,zoom:A.getZoom()-1,around:A.unproject(S)},{originalEvent:c})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}let zm={0:1,2:2};class yl{constructor(c){this.reset(),this._clickTolerance=c.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(c,u){return!1}_move(c,u){return{}}mousedown(c,u){if(this._lastPoint)return;let _=Ee(c);this._correctButton(c,_)&&(this._lastPoint=u,this._eventButton=_)}mousemoveWindow(c,u){let _=this._lastPoint;if(_){if(c.preventDefault(),this._eventButton!=null&&function(b,S){let A=zm[S];return b.buttons===void 0||(b.buttons&A)!==A}(c,this._eventButton))this.reset();else if(this._moved||!(u.dist(_)<this._clickTolerance))return this._moved=!0,this._lastPoint=u,this._move(_,u)}}mouseupWindow(c){this._lastPoint&&Ee(c)===this._eventButton&&(this._moved&&me(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Bm extends yl{mousedown(c,u){super.mousedown(c,u),this._lastPoint&&(this._active=!0)}_correctButton(c,u){return u===0&&!c.ctrlKey}_move(c,u){return{around:u,panDelta:u.sub(c)}}}class tu extends yl{_correctButton(c,u){return u===0&&c.ctrlKey||u===2}_move(c,u){let _=.8*(u.x-c.x);if(_)return this._active=!0,{bearingDelta:_}}contextmenu(c){c.preventDefault()}}class Lp extends yl{_correctButton(c,u){return u===0&&c.ctrlKey||u===2}_move(c,u){let _=-.5*(u.y-c.y);if(_)return this._active=!0,{pitchDelta:_}}contextmenu(c){c.preventDefault()}}class Um{constructor(c,u){this._map=c,this._el=c.getCanvasContainer(),this._minTouches=1,this._clickTolerance=u.clickTolerance||1,this.reset(),i.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new i.P(0,0)}touchstart(c,u,_){return this._calculateTransform(c,u,_)}touchmove(c,u,_){if(this._active&&!(_.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(_.length===1&&!i.c$())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return c.cancelable&&c.preventDefault(),this._calculateTransform(c,u,_)}}touchend(c,u,_){this._calculateTransform(c,u,_),this._active&&_.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(c,u,_){_.length>0&&(this._active=!0);let b=gh(_,u),S=new i.P(0,0),A=new i.P(0,0),P=0;for(let O in b){let z=b[O],U=this._touches[O];U&&(S._add(z),A._add(z.sub(U)),P++,b[O]=z)}if(this._touches=b,P<this._minTouches||!A.mag())return;let k=A.div(P);return this._sum._add(k),this._sum.mag()<this._clickTolerance?void 0:{around:S.div(P),panDelta:k}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=C("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Us{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(c){}_move(c,u,_){return{}}touchstart(c,u,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([u[0],u[1]]))}touchmove(c,u,_){let b=this._firstTwoTouches;if(!b)return;c.preventDefault();let[S,A]=b,P=_h(_,u,S),k=_h(_,u,A);if(!P||!k)return;let O=this._aroundCenter?null:P.add(k).div(2);return this._move([P,k],O,c)}touchend(c,u,_){if(!this._firstTwoTouches)return;let[b,S]=this._firstTwoTouches,A=_h(_,u,b),P=_h(_,u,S);A&&P||(this._active&&me(),this.reset())}touchcancel(){this.reset()}enable(c){this._enabled=!0,this._aroundCenter=!!c&&c.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function _h(g,c,u){for(let _=0;_<g.length;_++)if(g[_].identifier===u)return c[_]}function Fp(g,c){return Math.log(g/c)/Math.LN2}class iu extends Us{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(c){this._startDistance=this._distance=c[0].dist(c[1])}_move(c,u){let _=this._distance;if(this._distance=c[0].dist(c[1]),this._active||!(Math.abs(Fp(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Fp(this._distance,_),pinchAround:u}}}function kc(g,c){return 180*g.angleWith(c)/Math.PI}class Vm extends Us{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(c){this._startVector=this._vector=c[0].sub(c[1]),this._minDiameter=c[0].dist(c[1])}_move(c,u){let _=this._vector;if(this._vector=c[0].sub(c[1]),_&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:kc(this._vector,_),pinchAround:u}}_isBelowThreshold(c){this._minDiameter=Math.min(this._minDiameter,c.mag());let u=25/(Math.PI*this._minDiameter)*360,_=this._startVector;if(!_)return!1;let b=kc(c,_);return Math.abs(b)<u}}function nu(g){return Math.abs(g.y)>Math.abs(g.x)}class Gm extends Us{constructor(c){super(),this._map=c}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(c){this._lastPoints=c,nu(c[0].sub(c[1]))&&(this._valid=!1)}_move(c,u,_){let b=this._lastPoints;if(!b)return;let S=c[0].sub(b[0]),A=c[1].sub(b[1]);return this._map._cooperativeGestures&&!i.c$()&&_.touches.length<3||(this._valid=this.gestureBeginsVertically(S,A,_.timeStamp),!this._valid)?void 0:(this._lastPoints=c,this._active=!0,{pitchDelta:(S.y+A.y)/2*-.5})}gestureBeginsVertically(c,u,_){if(this._valid!==void 0)return this._valid;let b=c.mag()>=2,S=u.mag()>=2;if(!b&&!S)return;if(!b||!S)return this._firstMove==null&&(this._firstMove=_),_-this._firstMove<100&&void 0;let A=c.y>0==u.y>0;return nu(c)&&nu(u)&&A}}let y0={panStep:100,bearingStep:15,pitchStep:10};class ru{constructor(){let c=y0;this._panStep=c.panStep,this._bearingStep=c.bearingStep,this._pitchStep=c.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(c){if(c.altKey||c.ctrlKey||c.metaKey)return;let u=0,_=0,b=0,S=0,A=0;switch(c.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:c.shiftKey?_=-1:(c.preventDefault(),S=-1);break;case 39:c.shiftKey?_=1:(c.preventDefault(),S=1);break;case 38:c.shiftKey?b=1:(c.preventDefault(),A=-1);break;case 40:c.shiftKey?b=-1:(c.preventDefault(),A=1);break;default:return}return this._rotationDisabled&&(_=0,b=0),{cameraAnimation:P=>{let k=P.getZoom();P.easeTo({duration:300,easeId:"keyboardHandler",easing:Hm,zoom:u?Math.round(k)+u*(c.shiftKey?2:1):k,bearing:P.getBearing()+_*this._bearingStep,pitch:P.getPitch()+b*this._pitchStep,offset:[-S*this._panStep,-A*this._panStep],center:P.getCenter()},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Hm(g){return g*(2-g)}let su=4.000244140625,jm=1/450;class t4{constructor(c,u){this._map=c,this._el=c.getCanvasContainer(),this._handler=u,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=jm,i.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(c){this._defaultZoomRate=c}setWheelZoomRate(c){this._wheelZoomRate=c}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(c){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!c&&c.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(c){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(c.ctrlKey||c.metaKey||this.isZooming()||i.c$()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let u=c.deltaMode===WheelEvent.DOM_DELTA_LINE?40*c.deltaY:c.deltaY,_=i.f.now(),b=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,u!==0&&u%su==0?this._type="wheel":u!==0&&Math.abs(u)<4?this._type="trackpad":b>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,c)):this._type||(this._type=Math.abs(b*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),c.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=c,this._delta-=u,this._active||this._start(c)),c.preventDefault()}_onTimeout(c){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(c)}_start(c){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let u=ne(this._el,c);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:u,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let c=this._map.transform;this._type==="wheel"&&c.projection.wrap&&(c._center.lng>=180||c._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);let u=()=>c._terrainEnabled()&&this._aroundCoord?c.computeZoomRelativeTo(this._aroundCoord):c.zoom;if(this._delta!==0){let O=this._type==="wheel"&&Math.abs(this._delta)>su?this._wheelZoomRate:this._defaultZoomRate,z=2/(1+Math.exp(-Math.abs(this._delta*O)));this._delta<0&&z!==0&&(z=1/z);let U=u(),q=Math.pow(2,U),X=typeof this._targetZoom=="number"?c.zoomScale(this._targetZoom):q;this._targetZoom=Math.min(c.maxZoom,Math.max(c.minZoom,c.scaleZoom(X*z))),this._type==="wheel"&&(this._startZoom=U,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}let _=typeof this._targetZoom=="number"?this._targetZoom:u(),b=this._startZoom,S=this._easing,A,P=!1;if(this._type==="wheel"&&b&&S){let O=Math.min((i.f.now()-this._lastWheelEventTime)/200,1),z=S(O);A=i.U(b,_,z),O<1?this._frameId||(this._frameId=!0):P=!0}else A=_,P=!0;this._active=!0,P&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let k=A-u();return k*this._lastDelta<0&&(k=0),{noInertia:!0,needsRenderFrame:!P,zoomDelta:k,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(c){let u=i.d0;if(this._prevEase){let _=this._prevEase,b=(i.f.now()-_.start)/_.duration,S=_.easing(b+.01)-_.easing(b),A=.27/Math.sqrt(S*S+1e-4)*.01,P=Math.sqrt(.0729-A*A);u=i.c_(A,P,.25,1)}return this._prevEase={start:i.f.now(),duration:c,easing:u},u}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=C("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class i4{constructor(c,u){this._clickZoom=c,this._tapZoom=u}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class n4{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(c,u){return c.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:_.getZoom()+(c.shiftKey?-1:1),around:_.unproject(u)},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class r4{constructor(){this._tap=new eu({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(c,u,_){this._swipePoint||(this._tapTime&&c.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?_.length>0&&(this._swipePoint=u[0],this._swipeTouch=_[0].identifier):this._tap.touchstart(c,u,_))}touchmove(c,u,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;let b=u[0],S=b.y-this._swipePoint.y;return this._swipePoint=b,c.preventDefault(),this._active=!0,{zoomDelta:S/128}}}else this._tap.touchmove(c,u,_)}touchend(c,u,_){this._tapTime?this._swipePoint&&_.length===0&&this.reset():this._tap.touchend(c,u,_)&&(this._tapTime=c.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class s4{constructor(c,u,_){this._el=c,this._mousePan=u,this._touchPan=_}enable(c){this._inertiaOptions=c||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class o4{constructor(c,u,_){this._pitchWithRotate=c.pitchWithRotate,this._mouseRotate=u,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class a4{constructor(c,u,_,b){this._el=c,this._touchZoom=u,this._touchRotate=_,this._tapDragZoom=b,this._rotationDisabled=!1,this._enabled=!0}enable(c){this._touchZoom.enable(c),this._rotationDisabled||this._touchRotate.enable(c),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let ou=g=>g.zoom||g.drag||g.pitch||g.rotate;class l4 extends i.b{}class c4{constructor(){this.constants=[1,1,.01],this.radius=0}setup(c,u){let _=i.N.sub([],u,c);this.radius=i.N.length(_[2]<0?i.N.div([],_,this.constants):[_[0],_[1],0])}projectRay(c){i.N.div(c,c,this.constants),i.N.normalize(c,c),i.N.mul(c,c,this.constants);let u=i.N.scale([],c,this.radius);if(u[2]>0){let _=i.N.scale([],[0,0,1],i.N.dot(u,[0,0,1])),b=i.N.scale([],i.N.normalize([],[u[0],u[1],0]),this.radius),S=i.N.add([],u,i.N.scale([],i.N.sub([],i.N.add([],b,_),u),2));u[0]=S[0],u[1]=S[1]}return u}}function au(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta}class qy{constructor(c,u){this._map=c,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new gr(c),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new c4,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(u),i.aY(["handleEvent","handleWindowEvent"],this);let _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[window,"blur",void 0]];for(let[b,S,A]of this._listeners){let P=b===document?this.handleWindowEvent:this.handleEvent;b.addEventListener(S,P,A)}}destroy(){for(let[c,u,_]of this._listeners){let b=c===document?this.handleWindowEvent:this.handleEvent;c.removeEventListener(u,b,_)}}_addDefaultHandlers(c){let u=this._map,_=u.getCanvasContainer();this._add("mapEvent",new Om(u,c));let b=u.boxZoom=new Rc(u,c);this._add("boxZoom",b);let S=new Nm,A=new n4;u.doubleClickZoom=new i4(A,S),this._add("tapZoom",S),this._add("clickZoom",A);let P=new r4;this._add("tapDragZoom",P);let k=u.touchPitch=new Gm(u);this._add("touchPitch",k);let O=new tu(c),z=new Lp(c);u.dragRotate=new o4(c,O,z),this._add("mouseRotate",O,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]);let U=new Bm(c),q=new Um(u,c);u.dragPan=new s4(_,U,q),this._add("mousePan",U),this._add("touchPan",q,["touchZoom","touchRotate"]);let X=new Vm,Q=new iu;u.touchZoomRotate=new a4(_,Q,X,P),this._add("touchRotate",X,["touchPan","touchZoom"]),this._add("touchZoom",Q,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Pc(u));let K=u.scrollZoom=new t4(u,this);this._add("scrollZoom",K,["mousePan"]);let re=u.keyboard=new ru;this._add("keyboard",re);for(let Y of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])c.interactive&&c[Y]&&u[Y].enable(c[Y])}_add(c,u,_){this._handlers.push({handlerName:c,handler:u,allowed:_}),this._handlersById[c]=u}stop(c){if(!this._updatingCamera){for(let{handler:u}of this._handlers)u.reset();this._inertia.clear(),this._fireEvents({},{},c),this._changes=[],this._originalZoom=void 0}}isActive(){for(let{handler:c}of this._handlers)if(c.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ou(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(c,u,_){for(let b in c)if(b!==_&&(!u||u.indexOf(b)<0))return!0;return!1}handleWindowEvent(c){this.handleEvent(c,`${c.type}Window`)}_getMapTouches(c){let u=[];for(let _ of c)this._el.contains(_.target)&&u.push(_);return u}handleEvent(c,u){this._updatingCamera=!0;let _=c.type==="renderFrame",b=_?void 0:c,S={needsRenderFrame:!1},A={},P={},k=c.touches?this._getMapTouches(c.touches):void 0,O=k?fe(this._el,k):_?void 0:ne(this._el,c);for(let{handlerName:q,handler:X,allowed:Q}of this._handlers){if(!X.isEnabled())continue;let K;this._blockedByActive(P,Q,q)?X.reset():X[u||c.type]&&(K=X[u||c.type](c,O,k),this.mergeHandlerResult(S,A,K,q,b),K&&K.needsRenderFrame&&this._triggerRenderFrame()),(K||X.isActive())&&(P[q]=X)}let z={};for(let q in this._previousActiveHandlers)P[q]||(z[q]=b);this._previousActiveHandlers=P,(Object.keys(z).length||au(S))&&(this._changes.push([S,A,z]),this._triggerRenderFrame()),(Object.keys(P).length||au(S))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:U}=S;U&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],U(this._map))}mergeHandlerResult(c,u,_,b,S){if(!_)return;i.e(c,_);let A={handlerName:b,originalEvent:_.originalEvent||S};_.zoomDelta!==void 0&&(u.zoom=A),_.panDelta!==void 0&&(u.drag=A),_.pitchDelta!==void 0&&(u.pitch=A),_.bearingDelta!==void 0&&(u.rotate=A)}_applyChanges(){let c={},u={},_={};for(let[b,S,A]of this._changes)b.panDelta&&(c.panDelta=(c.panDelta||new i.P(0,0))._add(b.panDelta)),b.zoomDelta&&(c.zoomDelta=(c.zoomDelta||0)+b.zoomDelta),b.bearingDelta&&(c.bearingDelta=(c.bearingDelta||0)+b.bearingDelta),b.pitchDelta&&(c.pitchDelta=(c.pitchDelta||0)+b.pitchDelta),b.around!==void 0&&(c.around=b.around),b.aroundCoord!==void 0&&(c.aroundCoord=b.aroundCoord),b.pinchAround!==void 0&&(c.pinchAround=b.pinchAround),b.noInertia&&(c.noInertia=b.noInertia),i.e(u,S),i.e(_,A);this._updateMapTransform(c,u,_),this._changes=[]}_updateMapTransform(c,u,_){let b=this._map,S=b.transform,A=ae=>[ae.x,ae.y,ae.z];if((ae=>{let ge=this._eventsInProgress.drag;return ge&&!this._handlersById[ge.handlerName].isActive()})()&&!au(c)){let ae=S.zoom;S.cameraElevationReference="sea",this._originalZoom!=null&&S._orthographicProjectionAtLowPitch&&S.projection.name!=="globe"&&S.pitch===0?(S.cameraElevationReference="ground",S.zoom=this._originalZoom):(S.recenterOnTerrain(),S.cameraElevationReference="ground"),ae!==S.zoom&&this._map._update(!0)}if(S._isCameraConstrained&&b._stop(!0),!au(c))return void this._fireEvents(u,_,!0);let{panDelta:P,zoomDelta:k,bearingDelta:O,pitchDelta:z,around:U,aroundCoord:q,pinchAround:X}=c;S._isCameraConstrained&&(k>0&&(k=0),S._isCameraConstrained=!1),X!==void 0&&(U=X),(k||(ae=>u[ae]&&!this._eventsInProgress[ae])("drag"))&&U&&(this._dragOrigin=A(S.pointCoordinate3D(U)),this._originalZoom=S.zoom,this._trackingEllipsoid.setup(S._camera.position,this._dragOrigin)),S.cameraElevationReference="sea",b._stop(!0),U=U||b.transform.centerPoint,O&&(S.bearing+=O),z&&(S.pitch+=z),S._updateCameraState();let Q=[0,0,0];if(P)if(S.projection.name==="mercator"){let ae=this._trackingEllipsoid.projectRay(S.screenPointToMercatorRay(U).dir),ge=this._trackingEllipsoid.projectRay(S.screenPointToMercatorRay(U.sub(P)).dir);Q[0]=ge[0]-ae[0],Q[1]=ge[1]-ae[1]}else{let ae=S.pointCoordinate(U);if(S.projection.name==="globe"){P=P.rotate(-S.angle);let ge=S._pixelsPerMercatorPixel/S.worldSize;Q[0]=-P.x*i.d1(i.au(ae.y))*ge,Q[1]=-P.y*i.d1(S.center.lat)*ge}else{let ge=S.pointCoordinate(U.sub(P));ae&&ge&&(Q[0]=ge.x-ae.x,Q[1]=ge.y-ae.y)}}let K=S.zoom,re=[0,0,0];if(k){let ae=A(q||S.pointCoordinate3D(U)),ge={dir:i.N.normalize([],i.N.sub([],ae,S._camera.position))};if(ge.dir[2]<0){let ce=S.zoomDeltaToMovement(ae,k);i.N.scale(re,ge.dir,ce)}}let Y=i.N.add(Q,Q,re);S._translateCameraConstrained(Y),k&&Math.abs(S.zoom-K)>1e-4&&S.recenterOnTerrain(),S.cameraElevationReference="ground",this._map._update(),c.noInertia||this._inertia.record(c),this._fireEvents(u,_,!0)}_fireEvents(c,u,_){let b=ou(this._eventsInProgress),S=ou(c),A={};for(let z in c){let{originalEvent:U}=c[z];this._eventsInProgress[z]||(A[`${z}start`]=U),this._eventsInProgress[z]=c[z]}!b&&S&&this._fireEvent("movestart",S.originalEvent);for(let z in A)this._fireEvent(z,A[z]);S&&this._fireEvent("move",S.originalEvent);for(let z in c){let{originalEvent:U}=c[z];this._fireEvent(z,U)}let P={},k;for(let z in this._eventsInProgress){let{handlerName:U,originalEvent:q}=this._eventsInProgress[z];this._handlersById[U].isActive()||(delete this._eventsInProgress[z],k=u[U]||q,P[`${z}end`]=k)}for(let z in P)this._fireEvent(z,P[z]);let O=ou(this._eventsInProgress);if(_&&(b||S)&&!O){this._updatingCamera=!0;let z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),U=q=>q!==0&&-this._bearingSnap<q&&q<this._bearingSnap;z?(U(z.bearing||this._map.getBearing())&&(z.bearing=0),this._map.easeTo(z,{originalEvent:k})):(this._map.fire(new i.b("moveend",{originalEvent:k})),U(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(c,u){this._map.fire(new i.b(c,u?{originalEvent:u}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(c=>{this._frameId=void 0,this.handleEvent(new l4("renderFrame",{timeStamp:c})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}let h4="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class ls extends i.E{constructor(c,u){super(),this._moving=!1,this._zooming=!1,this.transform=c,this._bearingSnap=u.bearingSnap,this._respectPrefersReducedMotion=u.respectPrefersReducedMotion!==!1,i.aY(["_renderFrameCallback"],this)}getCenter(){return new i.bn(this.transform.center.lng,this.transform.center.lat)}setCenter(c,u){return this.jumpTo({center:c},u)}panBy(c,u,_){return c=i.P.convert(c).mult(-1),this.panTo(this.transform.center,i.e({offset:c},u),_)}panTo(c,u,_){return this.easeTo(i.e({center:c},u),_)}getZoom(){return this.transform.zoom}setZoom(c,u){return this.jumpTo({zoom:c},u),this}zoomTo(c,u,_){return this.easeTo(i.e({zoom:c},u),_)}zoomIn(c,u){return this.zoomTo(this.getZoom()+1,c,u),this}zoomOut(c,u){return this.zoomTo(this.getZoom()-1,c,u),this}getBearing(){return this.transform.bearing}setBearing(c,u){return this.jumpTo({bearing:c},u),this}getPadding(){return this.transform.padding}setPadding(c,u){return this.jumpTo({padding:c},u),this}rotateTo(c,u,_){return this.easeTo(i.e({bearing:c},u),_)}resetNorth(c,u){return this.rotateTo(0,i.e({duration:1e3},c),u),this}resetNorthPitch(c,u){return this.easeTo(i.e({bearing:0,pitch:0,duration:1e3},c),u),this}snapToNorth(c,u){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(c,u):this}getPitch(){return this.transform.pitch}setPitch(c,u){return this.jumpTo({pitch:c},u),this}cameraForBounds(c,u){c=i.ad.convert(c);let _=u&&u.bearing||0,b=u&&u.pitch||0,S=c.getNorthWest(),A=c.getSouthEast();return this._cameraForBounds(this.transform,S,A,_,b,u)}_extendCameraOptions(c){let u={top:0,bottom:0,right:0,left:0};if(typeof(c=i.e({padding:u,offset:[0,0],maxZoom:this.transform.maxZoom},c)).padding=="number"){let _=c.padding;c.padding={top:_,bottom:_,right:_,left:_}}return c.padding=i.e(u,c.padding),c}_minimumAABBFrustumDistance(c,u){let _=u.max[0]-u.min[0],b=u.max[1]-u.min[1];return _/b>c.aspect?_/(2*Math.tan(.5*c.fovX)*c.aspect):b/(2*Math.tan(.5*c.fovY)*c.aspect)}_cameraForBoundsOnGlobe(c,u,_,b,S,A){let P=c.clone(),k=this._extendCameraOptions(A);P.bearing=b,P.pitch=S;let O=i.bn.convert(u),z=i.bn.convert(_),U=.5*(O.lat+z.lat),q=.5*(O.lng+z.lng),X=i.d2(U,q),Q=i.N.normalize([],X),K=i.N.normalize([],i.N.cross([],Q,[0,1,0])),re=i.N.cross([],K,Q),Y=[K[0],K[1],K[2],0,re[0],re[1],re[2],0,Q[0],Q[1],Q[2],0,0,0,0,1],ae=[X,i.d2(O.lat,O.lng),i.d2(z.lat,O.lng),i.d2(z.lat,z.lng),i.d2(O.lat,z.lng),i.d2(U,O.lng),i.d2(U,z.lng),i.d2(O.lat,q),i.d2(z.lat,q)],ge=i.bS.fromPoints(ae.map(Ze=>[i.N.dot(K,Ze),i.N.dot(re,Ze),i.N.dot(Q,Ze)])),ce=i.N.transformMat4([],ge.center,Y);i.N.squaredLength(ce)===0&&i.N.set(ce,0,0,1),i.N.normalize(ce,ce),i.N.scale(ce,ce,i.ab),P.center=i.d3(ce);let _e=P.getWorldToCameraMatrix(),oe=i.a6.invert(new Float64Array(16),_e);ge=i.bS.applyTransform(ge,i.a6.multiply([],_e,Y)),i.N.transformMat4(ce,ce,_e);let ve=.5*(ge.max[2]-ge.min[2]),Ae=this._minimumAABBFrustumDistance(P,ge),Re=i.N.scale([],[0,0,1],ve),Oe=i.N.add(Re,ce,Re),Je=Ae+(P.pitch===0?0:i.N.distance(ce,Oe)),Ue=P.globeCenterInViewSpace,ot=i.N.sub([],ce,[Ue[0],Ue[1],Ue[2]]);i.N.normalize(ot,ot),i.N.scale(ot,ot,Je);let nt=i.N.add([],ce,ot);i.N.transformMat4(nt,nt,oe);let Rt=i.d4/i.ab,je=i.N.length(nt),tt=i.bl(Math.max(je*Rt-i.d4,Number.EPSILON),0),Fe=Math.min(P.zoomFromMercatorZAdjusted(tt),k.maxZoom);return Fe>.5*(i.bG+i.bx)?(P.setProjection({name:"mercator"}),P.zoom=Fe,this._cameraForBounds(P,u,_,b,S,A)):{center:P.center,zoom:Fe,bearing:b,pitch:S}}queryTerrainElevation(c,u){let _=this.transform.elevation;return _?(u=i.e({},{exaggerated:!0},u),_.getAtPoint(i.L.fromLngLat(c),null,u.exaggerated)):null}_cameraForBounds(c,u,_,b,S,A){if(c.projection.name==="globe")return this._cameraForBoundsOnGlobe(c,u,_,b,S,A);let P=c.clone(),k=this._extendCameraOptions(A),O=P.padding;P.bearing=b,P.pitch=S;let z=i.bn.convert(u),U=i.bn.convert(_),q=new i.bn(z.lng,U.lat),X=new i.bn(U.lng,z.lat),Q=P.project(z),K=P.project(U),re=this.queryTerrainElevation(z),Y=this.queryTerrainElevation(U),ae=this.queryTerrainElevation(q),ge=this.queryTerrainElevation(X),ce=[[Q.x,Q.y,Math.min(re||0,Y||0,ae||0,ge||0)],[K.x,K.y,Math.max(re||0,Y||0,ae||0,ge||0)]],_e=i.bS.fromPoints(ce),oe=P.getWorldToCameraMatrix(),ve=i.a6.invert(new Float64Array(16),oe);_e=i.bS.applyTransform(_e,oe);let Ae=i.N.sub([],_e.max,_e.min),Re=O.left||0,Oe=O.right||0,Je=O.bottom||0,Ue=O.top||0,{left:ot,right:nt,top:Rt,bottom:je}=k.padding,tt=.5*(Re+Oe),Fe=.5*(Ue+Je),Ze=Math.min(P.scaleZoom(P.scale*Math.min((P.width-(Re+Oe+ot+nt))/Ae[0],(P.height-(Je+Ue+je+Rt))/Ae[1])),k.maxZoom),Dt=P.scale/P.zoomScale(Ze);_e=new i.bS([_e.min[0]-(ot+tt)*Dt,_e.min[1]-(je+Fe)*Dt,_e.min[2]],[_e.max[0]+(nt+tt)*Dt,_e.max[1]+(Rt+Fe)*Dt,_e.max[2]]);let jt=.5*Ae[2],Ut=this._minimumAABBFrustumDistance(P,_e),ti=[0,0,1,0];i.a7.transformMat4(ti,ti,oe),i.a7.normalize(ti,ti);let mi=i.N.scale([],ti,Ut+jt),Ei=i.N.add([],_e.center,mi),xi=(typeof k.offset.x=="number"&&typeof k.offset.y=="number"?new i.P(k.offset.x,k.offset.y):i.P.convert(k.offset)).rotate(-i.bj(b));_e.center[0]-=xi.x*Dt,_e.center[1]+=xi.y*Dt,i.N.transformMat4(_e.center,_e.center,ve),i.N.transformMat4(Ei,Ei,ve);let Si=[_e.center[0],_e.center[1],Ei[2]*P.pixelsPerMeter];i.N.scale(Si,Si,1/P.worldSize);let gn=i.at(Si[0]),Zi=i.au(Si[1]),hn=Math.min(P._zoomFromMercatorZ(Si[2]),k.maxZoom),an=new i.bn(gn,Zi);return P.mercatorFromTransition&&hn<.5*(i.bG+i.bx)?(P.setProjection({name:"globe"}),P.zoom=hn,this._cameraForBounds(P,u,_,b,S,A)):{center:an,zoom:hn,bearing:b,pitch:S}}fitBounds(c,u,_){let b=this.cameraForBounds(c,u);return this._fitInternal(b,u,_)}fitScreenCoordinates(c,u,_,b,S){let A=i.P.convert(c),P=i.P.convert(u),k=new i.P(Math.min(A.x,P.x),Math.min(A.y,P.y)),O=new i.P(Math.max(A.x,P.x),Math.max(A.y,P.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(A,P))return this;let z=this.transform.pointLocation3D(k),U=this.transform.pointLocation3D(O),q=this.transform.pointLocation3D(new i.P(k.x,O.y)),X=this.transform.pointLocation3D(new i.P(O.x,k.y)),Q=[Math.min(z.lng,U.lng,q.lng,X.lng),Math.min(z.lat,U.lat,q.lat,X.lat)],K=[Math.max(z.lng,U.lng,q.lng,X.lng),Math.max(z.lat,U.lat,q.lat,X.lat)],re=b&&b.pitch?b.pitch:this.getPitch(),Y=this._cameraForBounds(this.transform,Q,K,_,re,b);return this._fitInternal(Y,b,S)}_fitInternal(c,u,_){return c?(delete(u=i.e(c,u)).padding,u.linear?this.easeTo(u,_):this.flyTo(u,_)):this}jumpTo(c,u){this.stop();let _=c.preloadOnly?this.transform.clone():this.transform,b=!1,S=!1,A=!1;return"zoom"in c&&_.zoom!==+c.zoom&&(b=!0,_.zoom=+c.zoom),c.center!==void 0&&(_.center=i.bn.convert(c.center)),"bearing"in c&&_.bearing!==+c.bearing&&(S=!0,_.bearing=+c.bearing),"pitch"in c&&_.pitch!==+c.pitch&&(A=!0,_.pitch=+c.pitch),c.padding==null||_.isPaddingEqual(c.padding)||(_.padding=c.padding),c.preloadOnly?(this._preloadTiles(_),this):(this.fire(new i.b("movestart",u)).fire(new i.b("move",u)),b&&this.fire(new i.b("zoomstart",u)).fire(new i.b("zoom",u)).fire(new i.b("zoomend",u)),S&&this.fire(new i.b("rotatestart",u)).fire(new i.b("rotate",u)).fire(new i.b("rotateend",u)),A&&this.fire(new i.b("pitchstart",u)).fire(new i.b("pitch",u)).fire(new i.b("pitchend",u)),this.fire(new i.b("moveend",u)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||i.w(h4),this.transform.getFreeCameraOptions()}setFreeCameraOptions(c,u){let _=this.transform;if(!_.projection.supportsFreeCamera)return i.w(h4),this;this.stop();let b=_.zoom,S=_.pitch,A=_.bearing;_.setFreeCameraOptions(c);let P=b!==_.zoom,k=S!==_.pitch,O=A!==_.bearing;return this.fire(new i.b("movestart",u)).fire(new i.b("move",u)),P&&this.fire(new i.b("zoomstart",u)).fire(new i.b("zoom",u)).fire(new i.b("zoomend",u)),O&&this.fire(new i.b("rotatestart",u)).fire(new i.b("rotate",u)).fire(new i.b("rotateend",u)),k&&this.fire(new i.b("pitchstart",u)).fire(new i.b("pitch",u)).fire(new i.b("pitchend",u)),this.fire(new i.b("moveend",u)),this}easeTo(c,u){this._stop(!1,c.easeId),((c=i.e({offset:[0,0],duration:500,easing:i.d0},c)).animate===!1||this._prefersReducedMotion(c))&&(c.duration=0);let _=this.transform,b=this.getZoom(),S=this.getBearing(),A=this.getPitch(),P=this.getPadding(),k="zoom"in c?+c.zoom:b,O="bearing"in c?this._normalizeBearing(c.bearing,S):S,z="pitch"in c?+c.pitch:A,U="padding"in c?c.padding:_.padding,q=i.P.convert(c.offset),X,Q,K;if(_.projection.name==="globe"){let Re=i.L.fromLngLat(_.center),Oe=q.rotate(-_.angle);Re.x+=Oe.x/_.worldSize,Re.y+=Oe.y/_.worldSize;let Je=Re.toLngLat(),Ue=i.bn.convert(c.center||Je);this._normalizeCenter(Ue),X=_.centerPoint.add(Oe),Q=new i.P(Re.x,Re.y).mult(_.worldSize),K=new i.P(i.a5(Ue.lng),i.ae(Ue.lat)).mult(_.worldSize).sub(Q)}else{X=_.centerPoint.add(q);let Re=_.pointLocation(X),Oe=i.bn.convert(c.center||Re);this._normalizeCenter(Oe),Q=_.project(Re),K=_.project(Oe).sub(Q)}let re=_.zoomScale(k-b),Y,ae;c.around&&(Y=i.bn.convert(c.around),ae=_.locationPoint(Y));let ge=this._zooming||k!==b,ce=this._rotating||S!==O,_e=this._pitching||z!==A,oe=!_.isPaddingEqual(U),ve=Re=>Oe=>{if(ge&&(Re.zoom=i.U(b,k,Oe)),ce&&(Re.bearing=i.U(S,O,Oe)),_e&&(Re.pitch=i.U(A,z,Oe)),oe&&(Re.interpolatePadding(P,U,Oe),X=Re.centerPoint.add(q)),Y)Re.setLocationAtPoint(Y,ae);else{let Je=Re.zoomScale(Re.zoom-b),Ue=k>b?Math.min(2,re):Math.max(.5,re),ot=Math.pow(Ue,1-Oe),nt=Re.unproject(Q.add(K.mult(Oe*ot)).mult(Je));Re.setLocationAtPoint(Re.renderWorldCopies?nt.wrap():nt,X)}return c.preloadOnly||this._fireMoveEvents(u),Re};if(c.preloadOnly){let Re=this._emulate(ve,c.duration,_);return this._preloadTiles(Re),this}let Ae={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ge,this._rotating=ce,this._pitching=_e,this._easeId=c.easeId,this._prepareEase(u,c.noMoveStart,Ae),this._ease(ve(_),Re=>{_.cameraElevationReference==="sea"&&_.recenterOnTerrain(),this._afterEase(u,Re)},c),this}_prepareEase(c,u,_={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),u||_.moving||this.fire(new i.b("movestart",c)),this._zooming&&!_.zooming&&this.fire(new i.b("zoomstart",c)),this._rotating&&!_.rotating&&this.fire(new i.b("rotatestart",c)),this._pitching&&!_.pitching&&this.fire(new i.b("pitchstart",c))}_fireMoveEvents(c){this.fire(new i.b("move",c)),this._zooming&&this.fire(new i.b("zoom",c)),this._rotating&&this.fire(new i.b("rotate",c)),this._pitching&&this.fire(new i.b("pitch",c))}_afterEase(c,u){if(this._easeId&&u&&this._easeId===u)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";let _=this._zooming,b=this._rotating,S=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,_&&this.fire(new i.b("zoomend",c)),b&&this.fire(new i.b("rotateend",c)),S&&this.fire(new i.b("pitchend",c)),this.fire(new i.b("moveend",c))}flyTo(c,u){if(this._prefersReducedMotion(c)){let je=i.ac(c,["center","zoom","bearing","pitch","around"]);return this.jumpTo(je,u)}this.stop(),c=i.e({offset:[0,0],speed:1.2,curve:1.42,easing:i.d0},c);let _=this.transform,b=this.getZoom(),S=this.getBearing(),A=this.getPitch(),P="zoom"in c?i.aa(+c.zoom,_.minZoom,_.maxZoom):b,k="bearing"in c?this._normalizeBearing(c.bearing,S):S,O="pitch"in c?+c.pitch:A,z=_.zoomScale(P-b),U=i.P.convert(c.offset),q=_.centerPoint.add(U),X=_.pointLocation(q),Q=c.center;if(Q&&c.padding){let je=this._cameraForBounds(this.transform,Q,Q,k,O,c);je&&(Q=je.center)}Q=i.bn.convert(Q||X),this._normalizeCenter(Q);let K=_.project(X),re=_.project(Q).sub(K),Y=c.curve,ae=Math.max(_.width,_.height),ge=ae/z,ce=re.mag();if("minZoom"in c){let je=i.aa(Math.min(c.minZoom,b,P),_.minZoom,_.maxZoom),tt=ae/_.zoomScale(je-b);Y=Math.sqrt(tt/ce*2)}let _e=Y*Y;function oe(je){let tt=(ge*ge-ae*ae+(je?-1:1)*_e*_e*ce*ce)/(2*(je?ge:ae)*_e*ce);return Math.log(Math.sqrt(tt*tt+1)-tt)}function ve(je){return(Math.exp(je)-Math.exp(-je))/2}function Ae(je){return(Math.exp(je)+Math.exp(-je))/2}let Re=oe(0),Oe=function(je){return Ae(Re)/Ae(Re+Y*je)},Je=function(je){return ae*((Ae(Re)*(ve(tt=Re+Y*je)/Ae(tt))-ve(Re))/_e)/ce;var tt},Ue=(oe(1)-Re)/Y;if(Math.abs(ce)<1e-6||!isFinite(Ue)){if(Math.abs(ae-ge)<1e-6)return this.easeTo(c,u);let je=ge<ae?-1:1;Ue=Math.abs(Math.log(ge/ae))/Y,Je=function(){return 0},Oe=function(tt){return Math.exp(je*Y*tt)}}c.duration="duration"in c?+c.duration:1e3*Ue/("screenSpeed"in c?+c.screenSpeed/Y:+c.speed),c.maxDuration&&c.duration>c.maxDuration&&(c.duration=0);let ot=S!==k,nt=O!==A,Rt=je=>tt=>{let Fe=tt*Ue,Ze=1/Oe(Fe);je.zoom=tt===1?P:b+je.scaleZoom(Ze),ot&&(je.bearing=i.U(S,k,tt)),nt&&(je.pitch=i.U(A,O,tt));let Dt=tt===1?Q:je.unproject(K.add(re.mult(Je(Fe))).mult(Ze));return je.setLocationAtPoint(je.renderWorldCopies?Dt.wrap():Dt,q),je._updateCameraOnTerrain(),c.preloadOnly||this._fireMoveEvents(u),je};if(c.preloadOnly){let je=this._emulate(Rt,c.duration,_);return this._preloadTiles(je),this}return this._zooming=!0,this._rotating=ot,this._pitching=nt,this._prepareEase(u,!1),this._ease(Rt(_),()=>this._afterEase(u),c),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(c,u){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){let _=this._onEaseEnd;this._onEaseEnd=void 0,_.call(this,u)}if(!c){let _=this.handlers;_&&_.stop(!1)}return this}_ease(c,u,_){_.animate===!1||_.duration===0?(c(1),u()):(this._easeStart=i.f.now(),this._easeOptions=_,this._onEaseFrame=c,this._onEaseEnd=u,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){let c=Math.min((i.f.now()-this._easeStart)/this._easeOptions.duration,1),u=this._onEaseFrame;u&&u(this._easeOptions.easing(c)),c<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(c,u){c=i.bh(c,-180,180);let _=Math.abs(c-u);return Math.abs(c-360-u)<_&&(c-=360),Math.abs(c+360-u)<_&&(c+=360),c}_normalizeCenter(c){let u=this.transform;if(u.maxBounds||u.projection.name!=="globe"&&!u.renderWorldCopies)return;let _=c.lng-u.center.lng;c.lng+=_>180?-360:_<-180?360:0}_prefersReducedMotion(c){return this._respectPrefersReducedMotion&&i.f.prefersReducedMotion&&!(c&&c.essential)}_emulate(c,u,_){let b=Math.ceil(15*u/1e3),S=[],A=c(_.clone());for(let P=0;P<=b;P++){let k=A(P/b);S.push(k.clone())}return S}}class Wm{constructor(c={}){this.options=c,i.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(c){let u=this.options&&this.options.compact;return this._map=c,this._container=C("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=C("button","mapboxgl-ctrl-attrib-button",this._container),C("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=C("div","mapboxgl-ctrl-attrib-inner",this._container),u&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),u===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(c,u){let _=this._map._getUIString(`AttributionControl.${u}`);c.removeAttribute("title"),c.firstElementChild&&c.firstElementChild.setAttribute("title",_)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let c=this._editLink;c||(c=this._editLink=this._container.querySelector(".mapbox-improve-map"));let u=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||i.d5.ACCESS_TOKEN}];if(c){let _=u.reduce((b,S,A)=>(S.value&&(b+=`${S.key}=${S.value}${A<u.length-1?"&":""}`),b),"?");c.href=`${i.d5.FEEDBACK_URL}/${_}#${Lm(this._map,!0)}`,c.rel="noopener nofollow",this._setElementTitle(c,"MapFeedback")}}_updateData(c){!c||c.sourceDataType!=="metadata"&&c.sourceDataType!=="visibility"&&c.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let c=[];if(this._map.style.stylesheet){let b=this._map.style.stylesheet;this.styleOwner=b.owner,this.styleId=b.id}let u=this._map.style._mergedSourceCaches;for(let b in u){let S=u[b];if(S.used){let A=S.getSource();A.attribution&&c.indexOf(A.attribution)<0&&c.push(A.attribution)}}c.sort((b,S)=>b.length-S.length),c=c.filter((b,S)=>{for(let A=S+1;A<c.length;A++)if(c[A].indexOf(b)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?c=[...this.options.customAttribution,...c]:c.unshift(this.options.customAttribution));let _=c.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,c.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class d4{constructor(){i.aY(["_updateLogo","_updateCompact"],this)}onAdd(c){this._map=c,this._container=C("div","mapboxgl-ctrl");let u=C("a","mapboxgl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://www.mapbox.com/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(c){c&&c.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;let c=this._map.style._sourceCaches;if(Object.entries(c).length===0)return!0;for(let u in c){let _=c[u].getSource();if(_.hasOwnProperty("mapbox_logo")&&!_.mapbox_logo)return!1}return!0}_updateCompact(){let c=this._container.children;if(c.length){let u=c[0];this._map.getCanvasContainer().offsetWidth<250?u.classList.add("mapboxgl-compact"):u.classList.remove("mapboxgl-compact")}}}class u4{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(c){let u=++this._id;return this._queue.push({callback:c,id:u,cancelled:!1}),u}remove(c){let u=this._currentlyRunning,_=u?this._queue.concat(u):this._queue;for(let b of _)if(b.id===c)return void(b.cancelled=!0)}run(c=0){let u=this._currentlyRunning=this._queue;this._queue=[];for(let _ of u)if(!_.cancelled&&(_.callback(c),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function lu(g,c,u){if(g=new i.bn(g.lng,g.lat),c){let _=new i.bn(g.lng-360,g.lat),b=new i.bn(g.lng+360,g.lat),S=360*Math.ceil(Math.abs(g.lng-u.center.lng)/360),A=u.locationPoint(g).distSqr(c),P=c.x<0||c.y<0||c.x>u.width||c.y>u.height;u.locationPoint(_).distSqr(c)<A&&(P||Math.abs(_.lng-u.center.lng)<S)?g=_:u.locationPoint(b).distSqr(c)<A&&(P||Math.abs(b.lng-u.center.lng)<S)&&(g=b)}for(;Math.abs(g.lng-u.center.lng)>180;){let _=u.locationPoint(g);if(_.x>=0&&_.y>=0&&_.x<=u.width&&_.y<=u.height)break;g.lng>u.center.lng?g.lng-=360:g.lng+=360}return g}let Op={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class qm extends i.E{constructor(c,u){if(super(),(c instanceof HTMLElement||u)&&(c=i.e({element:c},u)),i.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=c&&c.anchor||"center",this._color=c&&c.color||"#3FB1CE",this._scale=c&&c.scale||1,this._draggable=c&&c.draggable||!1,this._clickTolerance=c&&c.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=c&&c.rotation||0,this._rotationAlignment=c&&c.rotationAlignment||"auto",this._pitchAlignment=c&&c.pitchAlignment&&c.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=c&&c.occludedOpacity||.2,c&&c.element)this._element=c.element,this._offset=i.P.convert(c&&c.offset||[0,0]);else{this._defaultMarker=!0,this._element=C("div");let S=41,A=27,P=D("svg",{display:"block",height:S*this._scale+"px",width:A*this._scale+"px",viewBox:`0 0 ${A} ${S}`},this._element),k=D("radialGradient",{id:"shadowGradient"},D("defs",{},P));D("stop",{offset:"10%","stop-opacity":.4},k),D("stop",{offset:"100%","stop-opacity":.05},k),D("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},P),D("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},P),D("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},P),D("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},P),this._offset=i.P.convert(c&&c.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",S=>{S.preventDefault()}),this._element.addEventListener("mousedown",S=>{S.preventDefault()});let _=this._element.classList;for(let S in Op)_.remove(`mapboxgl-marker-anchor-${S}`);_.add(`mapboxgl-marker-anchor-${this._anchor}`);let b=c&&c.className?c.className.trim().split(/\s+/):[];_.add(...b),this._popup=null}addTo(c){return c===this._map||(this.remove(),this._map=c,c.getCanvasContainer().appendChild(this._element),c.on("move",this._updateMoving),c.on("moveend",this._update),c.on("remove",this._clearFadeTimer),c._addMarker(this),this.setDraggable(this._draggable),this._update(),c.on("click",this._onMapClick)),this}remove(){let c=this._map;return c&&(c.off("click",this._onMapClick),c.off("move",this._updateMoving),c.off("moveend",this._update),c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler),c.off("mouseup",this._onUp),c.off("touchend",this._onUp),c.off("mousemove",this._onMove),c.off("touchmove",this._onMove),c.off("remove",this._clearFadeTimer),c._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(c){return this._lngLat=i.bn.convert(c),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){let b=Math.sqrt(Math.pow(13.5,2)/2);c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[b,-1*(38.1-13.5+b)],"bottom-right":[-b,-1*(38.1-13.5+b)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=c,c._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(c){let u=c.code,_=c.charCode||c.keyCode;u!=="Space"&&u!=="Enter"&&_!==32&&_!==13||this.togglePopup()}_onMapClick(c){let u=c.originalEvent.target,_=this._element;this._popup&&(u===_||_.contains(u))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){let c=this._popup;return c?(c.isOpen()?(c.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(c.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){let c=this._map,u=this._pos;if(!c||!u)return!1;let _=c.unproject(u),b=c.getFreeCameraOptions();if(!b.position)return!1;let S=b.position.toLngLat();return S.distanceTo(_)<.9*S.distanceTo(this._lngLat)}_evaluateOpacity(){let c=this._map;if(!c)return;let u=this._pos;if(!u||u.x<0||u.x>c.transform.width||u.y<0||u.y>c.transform.height)return void this._clearFadeTimer();let _=c.unproject(u),b;c._showingGlobe()&&i.d6(c.transform,this._lngLat)?b=0:(b=1-c._queryFogOpacity(_),c.transform._terrainEnabled()&&c.getTerrain()&&this._behindTerrain()&&(b*=this._occludedOpacity)),this._element.style.opacity=`${b}`,this._element.style.pointerEvents=b>0?"auto":"none",this._popup&&this._popup._setOpacity(b),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){let c=this._pos;if(!c||!this._map)return;let u=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${c.x}px,${c.y}px)
            ${Op[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${u.x}px,${u.y}px)
        `}_calculateXYTransform(){let c=this._pos,u=this._map,_=this.getPitchAlignment();if(!u||!c||_!=="map")return"";if(!u._showingGlobe()){let k=u.getPitch();return k?`rotateX(${k}deg)`:""}let b=i.bF(i.d7(u.transform,this._lngLat)),S=c.sub(i.d8(u.transform)),A=Math.abs(S.x)+Math.abs(S.y);if(A===0)return"";let P=b/A;return`rotateX(${-S.y*P}deg) rotateY(${S.x*P}deg)`}_calculateZTransform(){let c=this._pos,u=this._map;if(!u||!c)return"";let _=0,b=this.getRotationAlignment();if(b==="map")if(u._showingGlobe()){let S=u.project(new i.bn(this._lngLat.lng,this._lngLat.lat+.001)),A=u.project(new i.bn(this._lngLat.lng,this._lngLat.lat-.001)).sub(S);_=i.bF(Math.atan2(A.y,A.x))-90}else _=-u.getBearing();else if(b==="horizon"){let S=i.O(4,6,u.getZoom()),A=i.d8(u.transform);A.y+=S*u.transform.height;let P=c.sub(A),k=i.bF(Math.atan2(P.y,P.x));_=(k>90?k-270:k+90)*(1-S)}return _+=this._rotation,_?`rotateZ(${_}deg)`:""}_update(c){cancelAnimationFrame(this._updateFrameId);let u=this._map;u&&(u.transform.renderWorldCopies&&(this._lngLat=lu(this._lngLat,this._pos,u.transform)),this._pos=u.project(this._lngLat),c===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),u._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(u._showingGlobe()||u.getTerrain()||u.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(c){return this._offset=i.P.convert(c),this._update(),this}addClassName(c){return this._element.classList.add(c),this}removeClassName(c){return this._element.classList.remove(c),this}toggleClassName(c){return this._element.classList.toggle(c)}_onMove(c){let u=this._map;if(!u)return;let _=this._pointerdownPos,b=this._positionDelta;if(_&&b){if(!this._isDragging){let S=this._clickTolerance||u._clickTolerance;if(c.point.dist(_)<S)return;this._isDragging=!0}this._pos=c.point.sub(b),this._lngLat=u.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new i.b("dragstart"))),this.fire(new i.b("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;let c=this._map;c&&(c.off("mousemove",this._onMove),c.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new i.b("dragend")),this._state="inactive"}_addDragHandler(c){let u=this._map,_=this._pos;u&&_&&this._element.contains(c.originalEvent.target)&&(c.preventDefault(),this._positionDelta=c.point.sub(_),this._pointerdownPos=c.point,this._state="pending",u.on("mousemove",this._onMove),u.on("touchmove",this._onMove),u.once("mouseup",this._onUp),u.once("touchend",this._onUp))}setDraggable(c){this._draggable=!!c;let u=this._map;return u&&(c?(u.on("mousedown",this._addDragHandler),u.on("touchstart",this._addDragHandler)):(u.off("mousedown",this._addDragHandler),u.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(c){return this._rotation=c||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(c){return this._rotationAlignment=c||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(c){return this._pitchAlignment=c||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(c){return this._occludedOpacity=c||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}let p4={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},f4=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function m4(g=new i.P(0,0),c="bottom"){if(typeof g=="number"){let u=Math.round(Math.sqrt(.5*Math.pow(g,2)));switch(c){case"top":return new i.P(0,g);case"top-left":return new i.P(u,u);case"top-right":return new i.P(-u,u);case"bottom":return new i.P(0,-g);case"bottom-left":return new i.P(u,-u);case"bottom-right":return new i.P(-u,-u);case"left":return new i.P(g,0);case"right":return new i.P(-g,0)}return new i.P(0,0)}return g instanceof i.P||Array.isArray(g)?i.P.convert(g):i.P.convert(g[c]||[0,0])}class Xm{constructor(c){this.jumpTo(c)}getValue(c){if(c<=this._startTime)return this._start;if(c>=this._endTime)return this._end;let u=i.cc((c-this._startTime)/(this._endTime-this._startTime));return this._start*(1-u)+this._end*u}isEasing(c){return c>=this._startTime&&c<=this._endTime}jumpTo(c){this._startTime=-1/0,this._endTime=-1/0,this._start=c,this._end=c}easeTo(c,u,_){this._start=this.getValue(u),this._end=c,this._startTime=u,this._endTime=u+_}}let cu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},g4={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1};class Zm{constructor(){this.showOverdrawInspector=!1,this.showTileBoundaries=!1,this.showParseStatus=!1,this.continuousRedraw=!1,this.showTileAABBs=!1,this.showPadding=!1,this.showTerrainWireframe=!1,this.showLayers2DWireframe=!1,this.showLayers3DWireframe=!1}}let Np={showCompass:!0,showZoom:!0,visualizePitch:!1};class Bl{constructor(c,u,_=!1){this._clickTolerance=10,this.element=u,this.mouseRotate=new tu({clickTolerance:c.dragRotate._mouseRotate._clickTolerance}),this.map=c,_&&(this.mousePitch=new Lp({clickTolerance:c.dragRotate._mousePitch._clickTolerance})),i.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),u.addEventListener("mousedown",this.mousedown),u.addEventListener("touchstart",this.touchstart,{passive:!1}),u.addEventListener("touchmove",this.touchmove),u.addEventListener("touchend",this.touchend),u.addEventListener("touchcancel",this.reset)}down(c,u){this.mouseRotate.mousedown(c,u),this.mousePitch&&this.mousePitch.mousedown(c,u),Z()}move(c,u){let _=this.map,b=this.mouseRotate.mousemoveWindow(c,u),S=b&&b.bearingDelta;if(S&&_.setBearing(_.getBearing()+S),this.mousePitch){let A=this.mousePitch.mousemoveWindow(c,u),P=A&&A.pitchDelta;P&&_.setPitch(_.getPitch()+P)}}off(){let c=this.element;c.removeEventListener("mousedown",this.mousedown),c.removeEventListener("touchstart",this.touchstart,{passive:!1}),c.removeEventListener("touchmove",this.touchmove),c.removeEventListener("touchend",this.touchend),c.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){G(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(c){this.down(i.e({},c,{ctrlKey:!0,preventDefault:()=>c.preventDefault()}),ne(this.element,c)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(c){this.move(c,ne(this.element,c))}mouseup(c){this.mouseRotate.mouseupWindow(c),this.mousePitch&&this.mousePitch.mouseupWindow(c),this.offTemp()}touchstart(c){c.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=fe(this.element,c.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>c.preventDefault()},this._startPos))}touchmove(c){c.targetTouches.length!==1?this.reset():(this._lastPos=fe(this.element,c.targetTouches)[0],this.move({preventDefault:()=>c.preventDefault()},this._lastPos))}touchend(c){c.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}let zp={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},To={maxWidth:100,unit:"metric"},Dc={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"};return{version:i.dk,supported:v,setRTLTextPlugin:i.dm,getRTLTextPluginStatus:i.dn,Map:class extends ls{constructor(g){let c=g;if((g=i.e({},g4,g)).minZoom!=null&&g.maxZoom!=null&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(g.minPitch!=null&&g.maxPitch!=null&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(g.minPitch!=null&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(g.maxPitch!=null&&g.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(g.antialias&&i.d9(window)&&(g.antialias=!1,i.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Od(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies),g),this._repaint=!1,this._interactive=g.interactive,this._minTileCacheSize=g.minTileCacheSize,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=g.crossSourceCollisions,this._collectResourceTiming=g.collectResourceTiming,this._language=this._parseLanguage(g.language),this._worldview=g.worldview,this._renderTaskQueue=new u4,this._domRenderTaskQueue=new u4,this._controls=[],this._markers=[],this._popups=[],this._mapId=i.aC(),this._locale=i.e({},cu,g.locale),this._clickTolerance=g.clickTolerance,this._cooperativeGestures=g.cooperativeGestures,this._performanceMetricsCollection=g.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Xm(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new i.da(g.transformRequest,g.accessToken,g.testMode),this._silenceAuthErrors=!!g.testMode,this._contextCreateOptions=g.contextCreateOptions?Ti({},g.contextCreateOptions):{},typeof g.container=="string"){let u=document.getElementById(g.container);if(!u)throw new Error(`Container '${g.container.toString()}' not found.`);this._container=u}else{if(!(g.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(this._container.childNodes.length>0&&i.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),g.maxBounds&&this.setMaxBounds(g.maxBounds),i.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._debugParams=new Zm,this._tp=g.devtools?new $d(this):new $d,this._tp.registerParameter(this._debugParams,["Debug"],"showOverdrawInspector",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"showTileBoundaries",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"showParseStatus",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"continuousRedraw",void 0,u=>{this.repaint=u}),this._tp.registerParameter(this._debugParams,["Debug"],"showTileAABBs",void 0,u=>{this.showTileAABBs=u}),this._tp.registerParameter(this._debugParams,["Debug"],"showPadding",void 0,u=>{this.showPadding=u}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showTerrainWireframe",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showLayers2DWireframe",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showLayers3DWireframe",void 0,()=>{this._update()}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new qy(this,g),this._localFontFamily=g.localFontFamily,this._localIdeographFontFamily=g.localIdeographFontFamily,(g.style||!g.testMode)&&this.setStyle(g.style||i.d5.DEFAULT_STYLE,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),g.projection&&this.setProjection(g.projection),g.hash&&(this._hash=new Rp(typeof g.hash=="string"&&g.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){c.center==null&&c.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch});let u=g.bounds;u&&(this.resize(),this.fitBounds(u,i.e({},g.fitBoundsOptions,{duration:0})))}this.resize(),g.attributionControl&&this.addControl(new Wm({customAttribution:g.customAttribution})),this._logoControl=new d4,this.addControl(this._logoControl,g.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",u=>{this._update(u.dataType==="style"),this.fire(new i.b(`${u.dataType}data`,u))}),this.on("dataloading",u=>{this.fire(new i.b(`${u.dataType}dataloading`,u))})}_getMapId(){return this._mapId}addControl(g,c){if(c===void 0&&(c=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new i.a(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let u=g.onAdd(this);this._controls.push(g);let _=this._controlPositions[c];return c.indexOf("bottom")!==-1?_.insertBefore(u,_.firstChild):_.appendChild(u),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new i.a(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let c=this._controls.indexOf(g);return c>-1&&this._controls.splice(c,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(g){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));let c=!this._moving;return c&&this.fire(new i.b("movestart",g)).fire(new i.b("move",g)),this.fire(new i.b("resize",g)),c&&this.fire(new i.b("moveend",g)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(g){return this.transform.setMaxBounds(i.ad.convert(g)),this._update()}setMinZoom(g){if((g=g??-2)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g?this.setZoom(g):this.fire(new i.b("zoomstart")).fire(new i.b("zoom")).fire(new i.b("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=g??22)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g?this.setZoom(g):this.fire(new i.b("zoomstart")).fire(new i.b("zoom")).fire(new i.b("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=g??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g?this.setPitch(g):this.fire(new i.b("pitchstart")).fire(new i.b("pitch")).fire(new i.b("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=g??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g?this.setPitch(g):this.fire(new i.b("pitchstart")).fire(new i.b("pitch")).fire(new i.b("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.renderWorldCopies=g,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(g){return g==="auto"?navigator.language:Array.isArray(g)?g.length===0?void 0:g.map(c=>c==="auto"?navigator.language:c):g}setLanguage(g){let c=this._parseLanguage(g);if(!this.style||c===this._language)return this;this._language=c,this.style.reloadSources();for(let u of this._controls)u._setLanguage&&u._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(g){return this.style&&g!==this._worldview?(this._worldview=g,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(g){return this._lazyInitEmptyStyle(),g?typeof g=="string"&&(g={name:g}):g=null,this._useExplicitProjection=!!g,this._prioritizeAndUpdateProjection(g,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;let g=this.transform,c=g.projection.name,u;c==="globe"&&g.zoom>=i.bx?(g.setMercatorFromTransition(),u=!0):c==="mercator"&&g.zoom<i.bx&&(g.setProjection({name:"globe"}),u=!0),u&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(g,c){return this._updateProjection(g||c||{name:"mercator"})}_updateProjection(g){let c;return c=g.name==="globe"&&this.transform.zoom>=i.bx?this.transform.setMercatorFromTransition():this.transform.setProjection(g),this.style.applyProjectionUpdate(),c&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(g){return this.transform.locationPoint3D(i.bn.convert(g))}unproject(g){return this.transform.pointLocation3D(i.P.convert(g))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(g,c,u){if(g==="mouseenter"||g==="mouseover"){let _=!1,b=A=>{let P=c.filter(O=>this.getLayer(O)),k=P.length?this.queryRenderedFeatures(A.point,{layers:P}):[];k.length?_||(_=!0,u.call(this,new Lo(g,this,A.originalEvent,{features:k}))):_=!1},S=()=>{_=!1};return{layers:new Set(c),listener:u,delegates:{mousemove:b,mouseout:S}}}if(g==="mouseleave"||g==="mouseout"){let _=!1,b=A=>{let P=c.filter(k=>this.getLayer(k));(P.length?this.queryRenderedFeatures(A.point,{layers:P}):[]).length?_=!0:_&&(_=!1,u.call(this,new Lo(g,this,A.originalEvent)))},S=A=>{_&&(_=!1,u.call(this,new Lo(g,this,A.originalEvent)))};return{layers:new Set(c),listener:u,delegates:{mousemove:b,mouseout:S}}}{let _=b=>{let S=c.filter(P=>this.getLayer(P)),A=S.length?this.queryRenderedFeatures(b.point,{layers:S}):[];A.length&&(b.features=A,u.call(this,b),delete b.features)};return{layers:new Set(c),listener:u,delegates:{[g]:_}}}}on(g,c,u){if(u===void 0)return super.on(g,c);if(Array.isArray(c)||(c=[c]),c){for(let b of c)if(!this._isValidId(b))return this}let _=this._createDelegatedListener(g,c,u);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(_);for(let b in _.delegates)this.on(b,_.delegates[b]);return this}once(g,c,u){if(u===void 0)return super.once(g,c);if(Array.isArray(c)||(c=[c]),c){for(let b of c)if(!this._isValidId(b))return this}let _=this._createDelegatedListener(g,c,u);for(let b in _.delegates)this.once(b,_.delegates[b]);return this}off(g,c,u){if(u===void 0)return super.off(g,c);c=new Set(Array.isArray(c)?c:[c]);for(let S of c)if(!this._isValidId(S))return this;let _=(S,A)=>{if(S.size!==A.size)return!1;for(let P of S)if(!A.has(P))return!1;return!0},b=this._delegatedListeners?this._delegatedListeners[g]:void 0;return b&&(S=>{for(let A=0;A<S.length;A++){let P=S[A];if(P.listener===u&&_(P.layers,c)){for(let k in P.delegates)this.off(k,P.delegates[k]);return S.splice(A,1),this}}})(b),this}queryRenderedFeatures(g,c){if(!this.style)return[];if(c!==void 0||g===void 0||g instanceof i.P||Array.isArray(g)||(c=g,g=void 0),g=g||[[0,0],[this.transform.width,this.transform.height]],(c=c||{}).layers&&Array.isArray(c.layers)){for(let u of c.layers)if(!this._isValidId(u))return[]}return this.style.queryRenderedFeatures(g,c,this.transform)}querySourceFeatures(g,c){return this._isValidId(g)?this.style.querySourceFeatures(g,c):[]}isPointOnSurface(g){let{name:c}=this.transform.projection;return c!=="globe"&&c!=="mercator"&&i.w(`${c} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(i.P.convert(g))}setStyle(g,c){return(c=i.e({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},c)).diff!==!1&&c.localIdeographFontFamily===this._localIdeographFontFamily&&c.localFontFamily===this._localFontFamily&&this.style&&g?(this._diffStyle(g,c),this):(this._localIdeographFontFamily=c.localIdeographFontFamily,this._localFontFamily=c.localFontFamily,this._updateStyle(g,c))}_getUIString(g){let c=this._locale[g];if(c==null)throw new Error(`Missing UI string '${g}'`);return c}_updateStyle(g,c){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),g&&(this.style=new Wa(this,c||{}),this.style.setEventedParent(this,{style:this.style}),typeof g=="string"?this.style.loadURL(g):this.style.loadJSON(g)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Wa(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(g,c){if(typeof g=="string"){let u=this._requestManager.normalizeStyleURL(g),_=this._requestManager.transformRequest(u,i.R.Style);i.g(_,(b,S)=>{b?this.fire(new i.a(b)):S&&this._updateDiff(S,c)})}else typeof g=="object"&&this._updateDiff(g,c)}_updateDiff(g,c){try{this.style.setState(g)&&this._update(!0)}catch(u){i.w(`Unable to perform style diff: ${u.message||u.error||u}.  Rebuilding the style from scratch.`),this._updateStyle(g,c)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(i.w("There is no style added to the map."),!1)}_isValidId(g){return g==null?(this.fire(new i.a(new Error("IDs can't be empty."))),!1):!i.c4(g)||(this.fire(new i.a(new Error(`IDs can't contain special symbols: "${g}".`))),!1)}addSource(g,c){return this._isValidId(g)?(this._lazyInitEmptyStyle(),this.style.addSource(g,c),this._update(!0)):this}isSourceLoaded(g){return!!this._isValidId(g)&&!!this.style&&this.style._isSourceCacheLoaded(g)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(g,c,u){this._lazyInitEmptyStyle(),this.style.addSourceType(g,c,u)}removeSource(g){return this._isValidId(g)?(this.style.removeSource(g),this._updateTerrain(),this._update(!0)):this}getSource(g){return this._isValidId(g)?this.style.getOwnSource(g):null}addImage(g,c,{pixelRatio:u=1,sdf:_=!1,stretchX:b,stretchY:S,content:A}={}){if(this._lazyInitEmptyStyle(),c instanceof HTMLImageElement||ImageBitmap&&c instanceof ImageBitmap){let{width:P,height:k,data:O}=i.f.getImageData(c);this.style.addImage(g,{data:new i.h({width:P,height:k},O),pixelRatio:u,stretchX:b,stretchY:S,content:A,sdf:_,version:0})}else if(c.width===void 0||c.height===void 0)this.fire(new i.a(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{let{width:P,height:k}=c,O=c;this.style.addImage(g,{data:new i.h({width:P,height:k},new Uint8Array(O.data)),pixelRatio:u,stretchX:b,stretchY:S,content:A,sdf:_,version:0,userImage:O}),O.onAdd&&O.onAdd(this,g)}}updateImage(g,c){this._lazyInitEmptyStyle();let u=this.style.getImage(g);if(!u)return void this.fire(new i.a(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let _=c instanceof HTMLImageElement||ImageBitmap&&c instanceof ImageBitmap?i.f.getImageData(c):c,{width:b,height:S}=_,A=_.data;if(b===void 0||S===void 0)return void this.fire(new i.a(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(b!==u.data.width||S!==u.data.height)return void this.fire(new i.a(new Error(`The width and height of the updated image (${b}, ${S})
                must be that same as the previous version of the image
                (${u.data.width}, ${u.data.height})`)));let P=!(c instanceof HTMLImageElement||ImageBitmap&&c instanceof ImageBitmap);u.data.replace(A,P),this.style.updateImage(g,u)}hasImage(g){return g?!!this.style&&!!this.style.getImage(g):(this.fire(new i.a(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(g)}loadImage(g,c){i.d(this._requestManager.transformRequest(g,i.R.Image),(u,_)=>{c(u,_ instanceof HTMLImageElement?i.f.getImageData(_):_)})}listImages(){return this.style.listImages()}addModel(g,c){this._lazyInitEmptyStyle(),this.style.addModel(g,c)}hasModel(g){return g?this.style.hasModel(g):(this.fire(new i.a(new Error("Missing required model id"))),!1)}removeModel(g){this.style.removeModel(g)}listModels(){return this.style.listModels()}addLayer(g,c){return this._isValidId(g.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(g,c),this._update(!0)):this}getSlot(g){let c=this.getLayer(g);return c&&c.slot||null}setSlot(g,c){return this.style.setSlot(g,c),this.style.mergeLayers(),this._update(!0)}addImport(g,c){return this.style.addImport(g,c),this}updateImport(g,c){return typeof c!="string"&&c.id!==g?(this.removeImport(g),this.addImport(c)):(this.style.updateImport(g,c),this._update(!0))}removeImport(g){return this.style.removeImport(g),this}moveImport(g,c){return this.style.moveImport(g,c),this._update(!0)}moveLayer(g,c){return this._isValidId(g)?(this.style.moveLayer(g,c),this._update(!0)):this}removeLayer(g){return this._isValidId(g)?(this.style.removeLayer(g),this._update(!0)):this}getLayer(g){return this._isValidId(g)?this.style.getOwnLayer(g):null}setLayerZoomRange(g,c,u){return this._isValidId(g)?(this.style.setLayerZoomRange(g,c,u),this._update(!0)):this}setFilter(g,c,u={}){return this._isValidId(g)?(this.style.setFilter(g,c,u),this._update(!0)):this}getFilter(g){return this._isValidId(g)?this.style.getFilter(g):null}setPaintProperty(g,c,u,_={}){return this._isValidId(g)?(this.style.setPaintProperty(g,c,u,_),this._update(!0)):this}getPaintProperty(g,c){return this._isValidId(g)?this.style.getPaintProperty(g,c):null}setLayoutProperty(g,c,u,_={}){return this._isValidId(g)?(this.style.setLayoutProperty(g,c,u,_),this._update(!0)):this}getLayoutProperty(g,c){return this._isValidId(g)?this.style.getLayoutProperty(g,c):null}getConfigProperty(g,c){return this.style.getConfigProperty(g,c)}setConfigProperty(g,c,u){return this.style.setConfigProperty(g,c,u),this._update(!0)}setLights(g){if(this._lazyInitEmptyStyle(),g&&g.length===1&&g[0].type==="flat"){let c=g[0];c.properties?this.style.setFlatLight(c.properties,c.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(g),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){let g=this.style.getLights()||[];return g.length===0&&g.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),g}setLight(g,c={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:g}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(g){return this._lazyInitEmptyStyle(),!g&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(g),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(g){return this._lazyInitEmptyStyle(),this.style.setFog(g),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(g){return this.style.setCamera(g),this._triggerCameraUpdate(g)}_triggerCameraUpdate(g){return this._update(this.transform.setOrthographicProjectionAtLowPitch(g["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(g){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(i.bn.convert(g),this.transform):0}setFeatureState(g,c){return this._isValidId(g.source)?(this.style.setFeatureState(g,c),this._update()):this}removeFeatureState(g,c){return this._isValidId(g.source)?(this.style.removeFeatureState(g,c),this._update()):this}getFeatureState(g){return this._isValidId(g.source)?this.style.getFeatureState(g):null}_updateContainerDimensions(){if(!this._container)return;let g=this._container.getBoundingClientRect().width||400,c=this._container.getBoundingClientRect().height||300,u,_,b,S=this._container;for(;S&&(!_||!b);){let A=window.getComputedStyle(S).transform;A&&A!=="none"&&(u=A.match(/matrix.*\((.+)\)/)[1].split(", "),u[0]&&u[0]!=="0"&&u[0]!=="1"&&(_=u[0]),u[3]&&u[3]!=="0"&&u[3]!=="1"&&(b=u[3])),S=S.parentElement}this._containerWidth=_?Math.abs(g/_):g,this._containerHeight=b?Math.abs(c/b):c}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&i.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){let g=this._container;g.classList.add("mapboxgl-map"),(this._missingCSSCanary=C("div","mapboxgl-canary",g)).style.visibility="hidden",this._detectMissingCSS();let c=this._canvasContainer=C("div","mapboxgl-canvas-container",g);this._canvas=C("canvas","mapboxgl-canvas",c),this._interactive&&(c.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);let u=this._controlContainer=C("div","mapboxgl-control-container",g),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(b=>{_[b]=C("div",`mapboxgl-ctrl-${b}`,u)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(g,c){let u=i.f.devicePixelRatio||1;this._canvas.width=u*Math.ceil(g),this._canvas.height=u*Math.ceil(c),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${c}px`}_addMarker(g){this._markers.push(g)}_removeMarker(g){let c=this._markers.indexOf(g);c!==-1&&this._markers.splice(c,1)}_addPopup(g){this._popups.push(g)}_removePopup(g){let c=this._popups.indexOf(g);c!==-1&&this._popups.splice(c,1)}_setupPainter(){let g=i.e({},v.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),c=this._canvas.getContext("webgl2",g);c?(i.db(c,!0),this.painter=new e4(c,this._contextCreateOptions,this.transform,this._tp),this.on("data",u=>{u.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),i.dc.testSupport(c)):this.fire(new i.a(new Error("Failed to initialize WebGL")))}_contextLost(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new i.b("webglcontextlost",{originalEvent:g}))}_contextRestored(g){this._setupPainter(),this.resize(),this._update(),this.fire(new i.b("webglcontextrestored",{originalEvent:g}))}_onMapScroll(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_requestDomTask(g){!this.loaded()||this.loaded()&&!this.isMoving()?g():this._domRenderTaskQueue.add(g)}_render(g){let c;this.fire(new i.b("renderstart"));let u=this.painter.context.extTimerQuery,_=i.f.now(),b=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(c=b.createQuery(),b.beginQuery(u.TIME_ELAPSED_EXT,c)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(g),this._domRenderTaskQueue.run(g),this._removed)return;this._updateProjectionTransition();let S=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;let k=this.transform.zoom,O=this.transform.pitch,z=i.f.now(),U=new i.K(k,{now:z,fadeDuration:S,pitch:O,transition:this.style.transition});this.style.update(U)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let A=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),A=this._updateAverageElevation(_),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):A=this._updateAverageElevation(_),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,S,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries||this._debugParams.showTileBoundaries,showParseStatus:this.showParseStatus||this._debugParams.showParseStatus,wireframe:{terrain:this.showTerrainWireframe||this._debugParams.showTerrainWireframe,layers2D:this.showLayers2DWireframe||this._debugParams.showLayers2DWireframe,layers3D:this.showLayers3DWireframe||this._debugParams.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector||this._debugParams.showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs||this._debugParams.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:S,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding||this._debugParams.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new i.b("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new i.b("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),c){let k=i.f.now()-_;b.endQuery(u.TIME_ELAPSED_EXT),setTimeout(()=>{let O=b.getQueryParameter(c,b.QUERY_RESULT)/1e6;b.deleteQuery(c),this.fire(new i.b("gpu-timing-frame",{cpuTime:k,gpuTime:O}))},50)}if(this.listens("gpu-timing-layer")){let k=this.painter.collectGpuTimers();setTimeout(()=>{let O=this.painter.queryGpuTimers(k);this.fire(new i.b("gpu-timing-layer",{layerTimes:O}))},50)}if(this.listens("gpu-timing-deferred-render")){let k=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{let O=this.painter.queryGpuTimeDeferredRender(k);this.fire(new i.b("gpu-timing-deferred-render",{gpuTime:O}))},50)}let P=this._sourcesDirty||this._styleDirty||this._placementDirty||A;if(P||this._repaint)this.triggerRepaint();else{let k=!this.isMoving()&&this.loaded();if(k&&(A=this._updateAverageElevation(_,!0)),A)this.triggerRepaint();else if(this._triggerFrame(!1),k&&(this.fire(new i.b("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){let O=this._calculateSpeedIndex();this.fire(new i.b("speedindexcompleted",{speedIndex:O})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||P||(this._fullyLoaded=!0,this._performanceMetricsCollection&&i.dd(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(g){for(let c of this._markers)g&&!this.getRenderWorldCopies()&&(c._lngLat=c._lngLat.wrap()),c._update();for(let c of this._popups)!g||this.getRenderWorldCopies()||c._trackPointer||(c._lngLat=c._lngLat.wrap()),c._update()}_updateAverageElevation(g,c=!1){let u=b=>(this.transform.averageElevation=b,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&u(0);let _=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(_||(c||g-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(g)){let b=this.transform.averageElevation,S=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(S)?S=0:this._averageElevationLastSampledAt=g;let A=Math.abs(b-S);if(A>1){if(this._isInitialLoad||_)return this._averageElevation.jumpTo(S),u(S);this._averageElevation.easeTo(S,g,300)}else if(A>1e-4)return this._averageElevation.jumpTo(S),u(S)}return!!this._averageElevation.isEasing(g)&&u(this._averageElevation.getValue(g))}_authenticate(){i.de(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,g=>{if(g&&(g.message===i.df||g.status===401)){let c=this.painter.context.gl;i.db(c,!1),this._logoControl instanceof d4&&this._logoControl._updateLogo(),c&&c.clear(c.DEPTH_BUFFER_BIT|c.COLOR_BUFFER_BIT|c.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new i.a(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),i.dg(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){let g=this._isDragging();this.painter.updateTerrain(this.style,g)}_calculateSpeedIndex(){let g=this.painter.canvasCopy(),c=this.painter.getCanvasCopiesAndTimestamps();c.timeStamps.push(performance.now());let u=this.painter.context.gl,_=u.createFramebuffer();function b(S){u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,S,0);let A=new Uint8Array(u.drawingBufferWidth*u.drawingBufferHeight*4);return u.readPixels(0,0,u.drawingBufferWidth,u.drawingBufferHeight,u.RGBA,u.UNSIGNED_BYTE,A),A}return u.bindFramebuffer(u.FRAMEBUFFER,_),this._canvasPixelComparison(b(g),c.canvasCopies.map(b),c.timeStamps)}_canvasPixelComparison(g,c,u){let _=u[1]-u[0],b=g.length/4;for(let S=0;S<c.length;S++){let A=c[S],P=0;for(let k=0;k<A.length;k+=4)A[k]===g[k]&&A[k+1]===g[k+1]&&A[k+2]===g[k+2]&&A[k+3]===g[k+3]&&(P+=1);_+=(u[S+2]-u[S+1])*(1-P/b)}return _}remove(){this._hash&&this._hash.remove();for(let c of this._controls)c.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);let g=this.painter.context.gl.getExtension("WEBGL_lose_context");g&&g.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),i.dh(this.painter.context.gl),i.di.remove(),i.dj.remove(),this._removed=!0,this.fire(new i.b("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(g){this._renderNextFrame=this._renderNextFrame||g,this.style&&!this._frame&&(this._frame=i.f.frame(c=>{let u=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,u&&this._render(c)}))}_preloadTiles(g){let c=this.style?Object.values(this.style._sourceCaches):[];return i.b1(c,(u,_)=>u._preloadTiles(g,_),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(g){this._trackResize&&this.resize({originalEvent:g})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(g){this._showParseStatus!==g&&(this._showParseStatus=g,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(g){this._showTerrainWireframe!==g&&(this._showTerrainWireframe=g,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(g){this._showLayers2DWireframe!==g&&(this._showLayers2DWireframe=g,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(g){this._showLayers3DWireframe!==g&&(this._showLayers3DWireframe=g,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(g){this._speedIndexTiming!==g&&(this._speedIndexTiming=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(g){this._showTileAABBs!==g&&(this._showTileAABBs=g,g&&this._update())}_setCacheLimits(g,c){i.dl(g,c)}get version(){return i.dk}},NavigationControl:class{constructor(g){this.options=i.e({},Np,g),this._container=C("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",c=>c.preventDefault()),this.options.showZoom&&(i.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",c=>{this._map&&this._map.zoomIn({},{originalEvent:c})}),C("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",c=>{this._map&&this._map.zoomOut({},{originalEvent:c})}),C("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(i.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",c=>{let u=this._map;u&&(this.options.visualizePitch?u.resetNorthPitch({},{originalEvent:c}):u.resetNorth({},{originalEvent:c}))}),this._compassIcon=C("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){let g=this._map;if(!g)return;let c=g.getZoom(),u=c===g.getMaxZoom(),_=c===g.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())}_rotateCompassArrow(){let g=this._map;if(!g)return;let c=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(g.transform.pitch*(Math.PI/180)),.5)}) rotateX(${g.transform.pitch}deg) rotateZ(${g.transform.angle*(180/Math.PI)}deg)`:`rotate(${g.transform.angle*(180/Math.PI)}deg)`;g._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=c)})}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),g.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&g.on("pitch",this._rotateCompassArrow),g.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Bl(g,this._compass,this.options.visualizePitch)),this._container}onRemove(){let g=this._map;g&&(this._container.remove(),this.options.showZoom&&g.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&g.off("pitch",this._rotateCompassArrow),g.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(g,c){let u=C("button",g,this._container);return u.type="button",u.addEventListener("click",c),u}_setButtonTitle(g,c){if(!this._map)return;let u=this._map._getUIString(`NavigationControl.${c}`);g.setAttribute("aria-label",u),g.firstElementChild&&g.firstElementChild.setAttribute("title",u)}},GeolocateControl:class extends i.E{constructor(g){super();let c=navigator.geolocation;this.options=i.e({geolocation:c},zp,g),i.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Jd(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(g){return this._map=g,this._container=C("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(g){let c=(u=!!this.options.geolocation)=>{this._supportsGeolocation=u,g(u)};this._supportsGeolocation!==void 0?g(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(u=>c(u.state!=="denied")).catch(()=>c()):c()}_isOutOfMapMaxBounds(g){let c=this._map.getMaxBounds(),u=g.coords;return!!c&&(u.longitude<c.getWest()||u.longitude>c.getEast()||u.latitude<c.getSouth()||u.latitude>c.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(g){if(this._map){if(this._isOutOfMapMaxBounds(g))return this._setErrorState(),this.fire(new i.b("outofmaxbounds",g)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=g,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(g),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(g),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.b("geolocate",g)),this._finish()}}_updateCamera(g){let c=new i.bn(g.coords.longitude,g.coords.latitude),u=g.coords.accuracy,_=this._map.getBearing(),b=i.e({bearing:_},this.options.fitBoundsOptions);this._map.fitBounds(c.toBounds(u),b,{geolocateSource:!0})}_updateMarker(g){if(g){let c=new i.bn(g.coords.longitude,g.coords.latitude);this._accuracyCircleMarker.setLngLat(c).addTo(this._map),this._userLocationDotMarker.setLngLat(c).addTo(this._map),this._accuracy=g.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){let g=this._map.transform,c=i.bl(1,g._center.lat)*g.worldSize,u=Math.ceil(2*this._accuracy*c);this._circleElement.style.width=`${u}px`,this._circleElement.style.height=`${u}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(g){if(this._map){if(this.options.trackUserLocation)if(g.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let c=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(g.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.b("error",g)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(g){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",c=>c.preventDefault()),this._geolocateButton=C("button","mapboxgl-ctrl-geolocate",this._container),C("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",g===!1){i.w("Geolocation support is not available so the GeolocateControl will be disabled.");let c=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c)}else{let c=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=C("div","mapboxgl-user-location"),this._dotElement.appendChild(C("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(C("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new qm({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=C("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new qm({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",c=>{c.geolocateSource||this._watchState!=="ACTIVE_LOCK"||c.originalEvent&&c.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new i.b("trackuserlocationend")))})}}_onDeviceOrientation(g){this._userLocationDotMarker&&(g.webkitCompassHeading?this._heading=g.webkitCompassHeading:g.absolute===!0&&(this._heading=-1*g.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return i.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new i.b("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new i.b("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new i.b("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let g;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(g={maximumAge:6e5,timeout:0},this._noTimeout=!0):(g=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,g),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){let g=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(c=>{c==="granted"&&g()}).catch(console.error):g()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Wm,ScaleControl:class{constructor(g){this.options=i.e({},To,g),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),i.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){let g=this.options.maxWidth||100,c=this._map,u=c._containerHeight/2,_=c._containerWidth/2-g/2,b=c.unproject([_,u]),S=c.unproject([_+g,u]),A=b.distanceTo(S);if(this.options.unit==="imperial"){let P=3.2808*A;P>5280?this._setScale(g,P/5280,"mile"):this._setScale(g,P,"foot")}else this.options.unit==="nautical"?this._setScale(g,A/1852,"nautical-mile"):A>=1e3?this._setScale(g,A/1e3,"kilometer"):this._setScale(g,A,"meter")}_setScale(g,c,u){this._map._requestDomTask(()=>{let _=function(S){let A=Math.pow(10,`${Math.floor(S)}`.length-1),P=S/A;return P=P>=10?10:P>=5?5:P>=3?3:P>=2?2:P>=1?1:function(k){let O=Math.pow(10,Math.ceil(-Math.log(k)/Math.LN10));return Math.round(k*O)/O}(P),A*P}(c),b=_/c;this._container.innerHTML=this._isNumberFormatSupported&&u!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:u}).format(_):`${_}&nbsp;${Dc[u]}`,this._container.style.width=g*b+"px"})}onAdd(g){return this._map=g,this._language=g.getLanguage(),this._container=C("div","mapboxgl-ctrl mapboxgl-ctrl-scale",g.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(g){this._language=g,this._update()}setUnit(g){this.options.unit=g,this._update()}},FullscreenControl:class{constructor(g){this._fullscreen=!1,g&&g.container&&(g.container instanceof HTMLElement?this._container=g.container:i.w("Full screen control 'container' must be a DOM element.")),i.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=C("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",i.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){let g=this._fullscreenButton=C("button","mapboxgl-ctrl-fullscreen",this._controlContainer);C("span","mapboxgl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){let g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",g)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends i.E{constructor(g){super(),this.options=i.e(Object.create(p4),g),i.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(g&&g.className?g.className.trim().split(/\s+/):[])}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&g.on("preclick",this._onClose),this.options.closeOnMove&&g.on("move",this._onClose),g.on("remove",this.remove),this._update(),g._addPopup(this),this._focusFirstElement(),this._trackPointer?(g.on("mousemove",this._onMouseEvent),g.on("mouseup",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")):g.on("move",this._update),this.fire(new i.b("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);let g=this._map;return g&&(g.off("move",this._update),g.off("move",this._onClose),g.off("preclick",this._onClose),g.off("click",this._onClose),g.off("remove",this.remove),g.off("mousemove",this._onMouseEvent),g.off("mouseup",this._onMouseEvent),g.off("drag",this._onMouseEvent),g._canvasContainer&&g._canvasContainer.classList.remove("mapboxgl-track-pointer"),g._removePopup(this),this._map=void 0),this.fire(new i.b("close")),this}getLngLat(){return this._lngLat}setLngLat(g){this._lngLat=i.bn.convert(g),this._pos=null,this._trackPointer=!1,this._update();let c=this._map;return c&&(c.on("move",this._update),c.off("mousemove",this._onMouseEvent),c._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();let g=this._map;return g&&(g.off("move",this._update),g.on("mousemove",this._onMouseEvent),g.on("drag",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(document.createTextNode(g))}setHTML(g){let c=document.createDocumentFragment(),u=document.createElement("body"),_;for(u.innerHTML=g;_=u.firstChild,_;)c.appendChild(_);return this.setDOMContent(c)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){let c=this._content;if(c)for(;c.hasChildNodes();)c.firstChild&&c.removeChild(c.firstChild);else c=this._content=C("div","mapboxgl-popup-content",this._container||void 0);if(c.appendChild(g),this.options.closeButton){let u=this._closeButton=C("button","mapboxgl-popup-close-button",c);u.type="button",u.setAttribute("aria-label","Close popup"),u.setAttribute("aria-hidden","true"),u.innerHTML="&#215;",u.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(g){return this._classList.add(g),this._updateClassList(),this}removeClassName(g){return this._classList.delete(g),this._updateClassList(),this}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){let c;return this._classList.delete(g)?c=!1:(this._classList.add(g),c=!0),this._updateClassList(),c}_onMouseEvent(g){this._update(g.point)}_getAnchor(g){if(this.options.anchor)return this.options.anchor;let c=this._map,u=this._container,_=this._pos;if(!c||!u||!_)return"bottom";let b=u.offsetWidth,S=u.offsetHeight,A=_.x<b/2,P=_.x>c.transform.width-b/2;if(_.y+g<S)return A?"top-left":P?"top-right":"top";if(_.y>c.transform.height-S){if(A)return"bottom-left";if(P)return"bottom-right"}return A?"left":P?"right":"bottom"}_updateClassList(){let g=this._container;if(!g)return;let c=[...this._classList];c.push("mapboxgl-popup"),this._anchor&&c.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&c.push("mapboxgl-popup-track-pointer"),g.className=c.join(" ")}_update(g){let c=this._map,u=this._content;if(!c||!this._lngLat&&!this._trackPointer||!u)return;let _=this._container;if(_||(_=this._container=C("div","mapboxgl-popup",c.getContainer()),this._tip=C("div","mapboxgl-popup-tip",_),_.appendChild(u)),this.options.maxWidth&&_.style.maxWidth!==this.options.maxWidth&&(_.style.maxWidth=this.options.maxWidth),c.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=lu(this._lngLat,this._pos,c.transform)),!this._trackPointer||g){let b=this._pos=this._trackPointer&&g?g:c.project(this._lngLat),S=m4(this.options.offset),A=this._anchor=this._getAnchor(S.y),P=m4(this.options.offset,A),k=b.add(P).round();c._requestDomTask(()=>{this._container&&A&&(this._container.style.transform=`${Op[A]} translate(${k.x}px,${k.y}px)`)})}if(!this._marker&&c._showingGlobe()){let b=i.d6(c.transform,this._lngLat)?0:1;this._setOpacity(b)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let g=this._container.querySelector(f4);g&&g.focus()}_onClose(){this.remove()}_setOpacity(g){this._container&&(this._container.style.opacity=`${g}`),this._content&&(this._content.style.pointerEvents=g?"auto":"none")}},Marker:qm,Style:Wa,LngLat:i.bn,LngLatBounds:i.ad,Point:i.P,MercatorCoordinate:i.L,FreeCameraOptions:Ld,Evented:i.E,config:i.d5,prewarm:i.dp,clearPrewarmedResources:i.dq,get accessToken(){return i.d5.ACCESS_TOKEN},set accessToken(g){i.d5.ACCESS_TOKEN=g},get baseApiUrl(){return i.d5.API_URL},set baseApiUrl(g){i.d5.API_URL=g},get workerCount(){return i.dr.workerCount},set workerCount(g){i.dr.workerCount=g},get maxParallelImageRequests(){return i.d5.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(g){i.d5.MAX_PARALLEL_IMAGE_REQUESTS=g},clearStorage(g){i.ds(g)},get workerUrl(){return i.dt.workerUrl},set workerUrl(g){i.dt.workerUrl=g},get workerClass(){return i.dt.workerClass},set workerClass(g){i.dt.workerClass=g},get workerParams(){return i.dt.workerParams},set workerParams(g){i.dt.workerParams=g},get dracoUrl(){return i.du()},set dracoUrl(g){i.dv(g)},get meshoptUrl(){return i.dw()},set meshoptUrl(g){i.dx(g)},setNow:i.f.setNow,restoreNow:i.f.restoreNow}});var a=t;return a})});var hb=o1((GI,T3)=>{"use strict";(function(o,e){"use strict";typeof define=="function"&&define.amd?define(e):typeof T3=="object"&&T3.exports?T3.exports=e():o.log=e()})(GI,function(){"use strict";var o=function(){},e="undefined",t=typeof window!==e&&typeof window.navigator!==e&&/Trident\/|MSIE /.test(window.navigator.userAgent),s=["trace","debug","info","warn","error"],a={},i=null;function f(j,Z){var G=j[Z];if(typeof G.bind=="function")return G.bind(j);try{return Function.prototype.bind.call(G,j)}catch{return function(){return Function.prototype.apply.apply(G,[j,arguments])}}}function v(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function x(j){return j==="debug"&&(j="log"),typeof console===e?!1:j==="trace"&&t?v:console[j]!==void 0?f(console,j):console.log!==void 0?f(console,"log"):o}function M(){for(var j=this.getLevel(),Z=0;Z<s.length;Z++){var G=s[Z];this[G]=Z<j?o:this.methodFactory(G,j,this.name)}if(this.log=this.debug,typeof console===e&&j<this.levels.SILENT)return"No console available for logging"}function C(j){return function(){typeof console!==e&&(M.call(this),this[j].apply(this,arguments))}}function D(j,Z,G){return x(j)||C.apply(this,arguments)}function L(j,Z){var G=this,H,me,ne,fe="loglevel";typeof j=="string"?fe+=":"+j:typeof j=="symbol"&&(fe=void 0);function Ee(se){var Ce=(s[se]||"silent").toUpperCase();if(!(typeof window===e||!fe)){try{window.localStorage[fe]=Ce;return}catch{}try{window.document.cookie=encodeURIComponent(fe)+"="+Ce+";"}catch{}}}function de(){var se;if(!(typeof window===e||!fe)){try{se=window.localStorage[fe]}catch{}if(typeof se===e)try{var Ce=window.document.cookie,Ne=encodeURIComponent(fe),zt=Ce.indexOf(Ne+"=");zt!==-1&&(se=/^([^;]+)/.exec(Ce.slice(zt+Ne.length+1))[1])}catch{}return G.levels[se]===void 0&&(se=void 0),se}}function we(){if(!(typeof window===e||!fe)){try{window.localStorage.removeItem(fe)}catch{}try{window.document.cookie=encodeURIComponent(fe)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function Le(se){var Ce=se;if(typeof Ce=="string"&&G.levels[Ce.toUpperCase()]!==void 0&&(Ce=G.levels[Ce.toUpperCase()]),typeof Ce=="number"&&Ce>=0&&Ce<=G.levels.SILENT)return Ce;throw new TypeError("log.setLevel() called with invalid level: "+se)}G.name=j,G.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},G.methodFactory=Z||D,G.getLevel=function(){return ne??me??H},G.setLevel=function(se,Ce){return ne=Le(se),Ce!==!1&&Ee(ne),M.call(G)},G.setDefaultLevel=function(se){me=Le(se),de()||G.setLevel(se,!1)},G.resetLevel=function(){ne=null,we(),M.call(G)},G.enableAll=function(se){G.setLevel(G.levels.TRACE,se)},G.disableAll=function(se){G.setLevel(G.levels.SILENT,se)},G.rebuild=function(){if(i!==G&&(H=Le(i.getLevel())),M.call(G),i===G)for(var se in a)a[se].rebuild()},H=Le(i?i.getLevel():"WARN");var De=de();De!=null&&(ne=Le(De)),M.call(G)}i=new L,i.getLogger=function(Z){if(typeof Z!="symbol"&&typeof Z!="string"||Z==="")throw new TypeError("You must supply a name when creating a logger.");var G=a[Z];return G||(G=a[Z]=new L(Z,i.methodFactory)),G};var N=typeof window!==e?window.log:void 0;return i.noConflict=function(){return typeof window!==e&&window.log===i&&(window.log=N),i},i.getLoggers=function(){return a},i.default=i,i})});var iy=o1(()=>{"use strict"});var iL=o1(H9=>{"use strict";Object.defineProperty(H9,"__esModule",{value:!0});function Jee(o){return o}H9.asTypedEventEmitter=Jee});var nL=o1(w_=>{"use strict";var Kee=w_&&w_.__spreadArrays||function(){for(var o=0,e=0,t=arguments.length;e<t;e++)o+=arguments[e].length;for(var s=Array(o),a=0,e=0;e<t;e++)for(var i=arguments[e],f=0,v=i.length;f<v;f++,a++)s[a]=i[f];return s};Object.defineProperty(w_,"__esModule",{value:!0});var Qee=function(){function o(){var e=this;this.events={},this.maxListeners=1/0,this.emit=function(t){for(var s=[],a=1;a<arguments.length;a++)s[a-1]=arguments[a];if(e.events[t]){for(var i=e.events[t].length,f=Array.from(e.events[t]),v=0,x=f;v<x.length;v++){var M=x[v];M.apply(void 0,s)}return!!i}return!1},this.on=function(t,s){return e.addListener(t,s),e},this.once=function(t,s){var a=function(){for(var i=[],f=0;f<arguments.length;f++)i[f]=arguments[f];s.apply(void 0,i),e.removeListener(t,a)};return e.addListener(t,a),e},this.addListener=function(t,s){return t in e.events?e.events[t].push(s):e.events[t]=[s],e.maxListeners!==1/0&&e.maxListeners<=e.events[t].length&&console.warn('Maximum event listeners for "'+t+'" event!'),e},this.removeListener=function(t,s){if(t in e.events){var a=e.events[t].indexOf(s);a!==-1&&e.events[t].splice(a,1)}return e},this.hasListeners=function(t){return e.events[t]&&!!e.events[t].length},this.prependListener=function(t,s){return t in e.events?e.events[t].unshift(s):e.events[t]=[s],e},this.prependOnceListener=function(t,s){var a=function(){for(var i=[],f=0;f<arguments.length;f++)i[f]=arguments[f];s.apply(void 0,i),e.removeListener(t,a)};return e.prependListener(t,a),e},this.off=function(t,s){return e.removeListener(t,s)},this.removeAllListeners=function(t){return delete e.events[t],e},this.setMaxListeners=function(t){return e.maxListeners=t,e},this.getMaxListeners=function(){return e.maxListeners},this.listeners=function(t){return Kee(e.events[t])},this.rawListeners=function(t){return e.events[t]},this.eventNames=function(){return Object.keys(e.events)},this.listenerCount=function(t){return e.events[t]&&e.events[t].length||0}}return o}();w_.EventEmitter=Qee});var j9=o1(by=>{"use strict";function rL(o){for(var e in o)by.hasOwnProperty(e)||(by[e]=o[e])}Object.defineProperty(by,"__esModule",{value:!0});rL(iL());rL(nL())});var xr="primary",ig=Symbol("RouteTitle"),kx=class{constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){let t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){let t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}};function v1(o){return new kx(o)}function VN(o,e,t){let s=t.path.split("/");if(s.length>o.length||t.pathMatch==="full"&&(e.hasChildren()||s.length<o.length))return null;let a={};for(let i=0;i<s.length;i++){let f=s[i],v=o[i];if(f.startsWith(":"))a[f.substring(1)]=v;else if(f!==v.path)return null}return{consumed:o.slice(0,s.length),posParams:a}}function GN(o,e){if(o.length!==e.length)return!1;for(let t=0;t<o.length;++t)if(!jc(o[t],e[t]))return!1;return!0}function jc(o,e){let t=o?Dx(o):void 0,s=e?Dx(e):void 0;if(!t||!s||t.length!=s.length)return!1;let a;for(let i=0;i<t.length;i++)if(a=t[i],!mA(o[a],e[a]))return!1;return!0}function Dx(o){return[...Object.keys(o),...Object.getOwnPropertySymbols(o)]}function mA(o,e){if(Array.isArray(o)&&Array.isArray(e)){if(o.length!==e.length)return!1;let t=[...o].sort(),s=[...e].sort();return t.every((a,i)=>s[i]===a)}else return o===e}function gA(o){return o.length>0?o[o.length-1]:null}function $h(o){return iE(o)?o:TE(o)?il(Promise.resolve(o)):Xn(o)}var HN={exact:yA,subset:vA},_A={exact:jN,subset:WN,ignored:()=>!0};function aA(o,e,t){return HN[t.paths](o.root,e.root,t.matrixParams)&&_A[t.queryParams](o.queryParams,e.queryParams)&&!(t.fragment==="exact"&&o.fragment!==e.fragment)}function jN(o,e){return jc(o,e)}function yA(o,e,t){if(!Au(o.segments,e.segments)||!G5(o.segments,e.segments,t)||o.numberOfChildren!==e.numberOfChildren)return!1;for(let s in e.children)if(!o.children[s]||!yA(o.children[s],e.children[s],t))return!1;return!0}function WN(o,e){return Object.keys(e).length<=Object.keys(o).length&&Object.keys(e).every(t=>mA(o[t],e[t]))}function vA(o,e,t){return xA(o,e,e.segments,t)}function xA(o,e,t,s){if(o.segments.length>t.length){let a=o.segments.slice(0,t.length);return!(!Au(a,t)||e.hasChildren()||!G5(a,t,s))}else if(o.segments.length===t.length){if(!Au(o.segments,t)||!G5(o.segments,t,s))return!1;for(let a in e.children)if(!o.children[a]||!vA(o.children[a],e.children[a],s))return!1;return!0}else{let a=t.slice(0,o.segments.length),i=t.slice(o.segments.length);return!Au(o.segments,a)||!G5(o.segments,a,s)||!o.children[xr]?!1:xA(o.children[xr],e,i,s)}}function G5(o,e,t){return e.every((s,a)=>_A[t](o[a].parameters,s.parameters))}var Wh=class{constructor(e=new is([],{}),t={},s=null){this.root=e,this.queryParams=t,this.fragment=s}get queryParamMap(){return this._queryParamMap??=v1(this.queryParams),this._queryParamMap}toString(){return ZN.serialize(this)}},is=class{constructor(e,t){this.segments=e,this.children=t,this.parent=null,Object.values(t).forEach(s=>s.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return H5(this)}},Eu=class{constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap??=v1(this.parameters),this._parameterMap}toString(){return wA(this)}};function qN(o,e){return Au(o,e)&&o.every((t,s)=>jc(t.parameters,e[s].parameters))}function Au(o,e){return o.length!==e.length?!1:o.every((t,s)=>t.path===e[s].path)}function XN(o,e){let t=[];return Object.entries(o.children).forEach(([s,a])=>{s===xr&&(t=t.concat(e(a,s)))}),Object.entries(o.children).forEach(([s,a])=>{s!==xr&&(t=t.concat(e(a,s)))}),t}var ng=(()=>{let e=class e{};e.\u0275fac=function(a){return new(a||e)},e.\u0275prov=jr({token:e,factory:()=>new X2,providedIn:"root"});let o=e;return o})(),X2=class{parse(e){let t=new Fx(e);return new Wh(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){let t=`/${V2(e.root,!0)}`,s=JN(e.queryParams),a=typeof e.fragment=="string"?`#${$N(e.fragment)}`:"";return`${t}${s}${a}`}},ZN=new X2;function H5(o){return o.segments.map(e=>wA(e)).join("/")}function V2(o,e){if(!o.hasChildren())return H5(o);if(e){let t=o.children[xr]?V2(o.children[xr],!1):"",s=[];return Object.entries(o.children).forEach(([a,i])=>{a!==xr&&s.push(`${a}:${V2(i,!1)}`)}),s.length>0?`${t}(${s.join("//")})`:t}else{let t=XN(o,(s,a)=>a===xr?[V2(o.children[xr],!1)]:[`${a}:${V2(s,!1)}`]);return Object.keys(o.children).length===1&&o.children[xr]!=null?`${H5(o)}/${t[0]}`:`${H5(o)}/(${t.join("//")})`}}function bA(o){return encodeURIComponent(o).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function U5(o){return bA(o).replace(/%3B/gi,";")}function $N(o){return encodeURI(o)}function Lx(o){return bA(o).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function j5(o){return decodeURIComponent(o)}function lA(o){return j5(o.replace(/\+/g,"%20"))}function wA(o){return`${Lx(o.path)}${YN(o.parameters)}`}function YN(o){return Object.entries(o).map(([e,t])=>`;${Lx(e)}=${Lx(t)}`).join("")}function JN(o){let e=Object.entries(o).map(([t,s])=>Array.isArray(s)?s.map(a=>`${U5(t)}=${U5(a)}`).join("&"):`${U5(t)}=${U5(s)}`).filter(t=>t);return e.length?`?${e.join("&")}`:""}var KN=/^[^\/()?;#]+/;function Cx(o){let e=o.match(KN);return e?e[0]:""}var QN=/^[^\/()?;=#]+/;function ez(o){let e=o.match(QN);return e?e[0]:""}var tz=/^[^=?&#]+/;function iz(o){let e=o.match(tz);return e?e[0]:""}var nz=/^[^&#]+/;function rz(o){let e=o.match(nz);return e?e[0]:""}var Fx=class{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new is([],{}):new is([],this.parseChildren())}parseQueryParams(){let e={};if(this.consumeOptional("?"))do this.parseQueryParam(e);while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let s={};return this.peekStartsWith("(")&&(s=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(s[xr]=new is(e,t)),s}parseSegment(){let e=Cx(this.remaining);if(e===""&&this.peekStartsWith(";"))throw new zo(4009,!1);return this.capture(e),new Eu(j5(e),this.parseMatrixParams())}parseMatrixParams(){let e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){let t=ez(this.remaining);if(!t)return;this.capture(t);let s="";if(this.consumeOptional("=")){let a=Cx(this.remaining);a&&(s=a,this.capture(s))}e[j5(t)]=j5(s)}parseQueryParam(e){let t=iz(this.remaining);if(!t)return;this.capture(t);let s="";if(this.consumeOptional("=")){let f=rz(this.remaining);f&&(s=f,this.capture(s))}let a=lA(t),i=lA(s);if(e.hasOwnProperty(a)){let f=e[a];Array.isArray(f)||(f=[f],e[a]=f),f.push(i)}else e[a]=i}parseParens(e){let t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let s=Cx(this.remaining),a=this.remaining[s.length];if(a!=="/"&&a!==")"&&a!==";")throw new zo(4010,!1);let i;s.indexOf(":")>-1?(i=s.slice(0,s.indexOf(":")),this.capture(i),this.capture(":")):e&&(i=xr);let f=this.parseChildren();t[i]=Object.keys(f).length===1?f[xr]:new is([],f),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return this.peekStartsWith(e)?(this.remaining=this.remaining.substring(e.length),!0):!1}capture(e){if(!this.consumeOptional(e))throw new zo(4011,!1)}};function SA(o){return o.segments.length>0?new is([],{[xr]:o}):o}function TA(o){let e={};for(let[s,a]of Object.entries(o.children)){let i=TA(a);if(s===xr&&i.segments.length===0&&i.hasChildren())for(let[f,v]of Object.entries(i.children))e[f]=v;else(i.segments.length>0||i.hasChildren())&&(e[s]=i)}let t=new is(o.segments,e);return sz(t)}function sz(o){if(o.numberOfChildren===1&&o.children[xr]){let e=o.children[xr];return new is(o.segments.concat(e.segments),e.children)}return o}function x1(o){return o instanceof Wh}function oz(o,e,t=null,s=null){let a=MA(o);return EA(a,e,t,s)}function MA(o){let e;function t(i){let f={};for(let x of i.children){let M=t(x);f[x.outlet]=M}let v=new is(i.url,f);return i===o&&(e=v),v}let s=t(o.root),a=SA(s);return e??a}function EA(o,e,t,s){let a=o;for(;a.parent;)a=a.parent;if(e.length===0)return Ix(a,a,a,t,s);let i=az(e);if(i.toRoot())return Ix(a,a,new is([],{}),t,s);let f=lz(i,a,o),v=f.processChildren?j2(f.segmentGroup,f.index,i.commands):CA(f.segmentGroup,f.index,i.commands);return Ix(a,f.segmentGroup,v,t,s)}function W5(o){return typeof o=="object"&&o!=null&&!o.outlets&&!o.segmentPath}function Z2(o){return typeof o=="object"&&o!=null&&o.outlets}function Ix(o,e,t,s,a){let i={};s&&Object.entries(s).forEach(([x,M])=>{i[x]=Array.isArray(M)?M.map(C=>`${C}`):`${M}`});let f;o===e?f=t:f=AA(o,e,t);let v=SA(TA(f));return new Wh(v,i,a)}function AA(o,e,t){let s={};return Object.entries(o.children).forEach(([a,i])=>{i===e?s[a]=t:s[a]=AA(i,e,t)}),new is(o.segments,s)}var q5=class{constructor(e,t,s){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=s,e&&s.length>0&&W5(s[0]))throw new zo(4003,!1);let a=s.find(Z2);if(a&&a!==gA(s))throw new zo(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function az(o){if(typeof o[0]=="string"&&o.length===1&&o[0]==="/")return new q5(!0,0,o);let e=0,t=!1,s=o.reduce((a,i,f)=>{if(typeof i=="object"&&i!=null){if(i.outlets){let v={};return Object.entries(i.outlets).forEach(([x,M])=>{v[x]=typeof M=="string"?M.split("/"):M}),[...a,{outlets:v}]}if(i.segmentPath)return[...a,i.segmentPath]}return typeof i!="string"?[...a,i]:f===0?(i.split("/").forEach((v,x)=>{x==0&&v==="."||(x==0&&v===""?t=!0:v===".."?e++:v!=""&&a.push(v))}),a):[...a,i]},[]);return new q5(t,e,s)}var _1=class{constructor(e,t,s){this.segmentGroup=e,this.processChildren=t,this.index=s}};function lz(o,e,t){if(o.isAbsolute)return new _1(e,!0,0);if(!t)return new _1(e,!1,NaN);if(t.parent===null)return new _1(t,!0,0);let s=W5(o.commands[0])?0:1,a=t.segments.length-1+s;return cz(t,a,o.numberOfDoubleDots)}function cz(o,e,t){let s=o,a=e,i=t;for(;i>a;){if(i-=a,s=s.parent,!s)throw new zo(4005,!1);a=s.segments.length}return new _1(s,!1,a-i)}function hz(o){return Z2(o[0])?o[0].outlets:{[xr]:o}}function CA(o,e,t){if(o??=new is([],{}),o.segments.length===0&&o.hasChildren())return j2(o,e,t);let s=dz(o,e,t),a=t.slice(s.commandIndex);if(s.match&&s.pathIndex<o.segments.length){let i=new is(o.segments.slice(0,s.pathIndex),{});return i.children[xr]=new is(o.segments.slice(s.pathIndex),o.children),j2(i,0,a)}else return s.match&&a.length===0?new is(o.segments,{}):s.match&&!o.hasChildren()?Ox(o,e,t):s.match?j2(o,0,a):Ox(o,e,t)}function j2(o,e,t){if(t.length===0)return new is(o.segments,{});{let s=hz(t),a={};if(Object.keys(s).some(i=>i!==xr)&&o.children[xr]&&o.numberOfChildren===1&&o.children[xr].segments.length===0){let i=j2(o.children[xr],e,t);return new is(o.segments,i.children)}return Object.entries(s).forEach(([i,f])=>{typeof f=="string"&&(f=[f]),f!==null&&(a[i]=CA(o.children[i],e,f))}),Object.entries(o.children).forEach(([i,f])=>{s[i]===void 0&&(a[i]=f)}),new is(o.segments,a)}}function dz(o,e,t){let s=0,a=e,i={match:!1,pathIndex:0,commandIndex:0};for(;a<o.segments.length;){if(s>=t.length)return i;let f=o.segments[a],v=t[s];if(Z2(v))break;let x=`${v}`,M=s<t.length-1?t[s+1]:null;if(a>0&&x===void 0)break;if(x&&M&&typeof M=="object"&&M.outlets===void 0){if(!hA(x,M,f))return i;s+=2}else{if(!hA(x,{},f))return i;s++}a++}return{match:!0,pathIndex:a,commandIndex:s}}function Ox(o,e,t){let s=o.segments.slice(0,e),a=0;for(;a<t.length;){let i=t[a];if(Z2(i)){let x=uz(i.outlets);return new is(s,x)}if(a===0&&W5(t[0])){let x=o.segments[e];s.push(new Eu(x.path,cA(t[0]))),a++;continue}let f=Z2(i)?i.outlets[xr]:`${i}`,v=a<t.length-1?t[a+1]:null;f&&v&&W5(v)?(s.push(new Eu(f,cA(v))),a+=2):(s.push(new Eu(f,{})),a++)}return new is(s,{})}function uz(o){let e={};return Object.entries(o).forEach(([t,s])=>{typeof s=="string"&&(s=[s]),s!==null&&(e[t]=Ox(new is([],{}),0,s))}),e}function cA(o){let e={};return Object.entries(o).forEach(([t,s])=>e[t]=`${s}`),e}function hA(o,e,t){return o==t.path&&jc(e,t.parameters)}var W2="imperative",Ao=function(o){return o[o.NavigationStart=0]="NavigationStart",o[o.NavigationEnd=1]="NavigationEnd",o[o.NavigationCancel=2]="NavigationCancel",o[o.NavigationError=3]="NavigationError",o[o.RoutesRecognized=4]="RoutesRecognized",o[o.ResolveStart=5]="ResolveStart",o[o.ResolveEnd=6]="ResolveEnd",o[o.GuardsCheckStart=7]="GuardsCheckStart",o[o.GuardsCheckEnd=8]="GuardsCheckEnd",o[o.RouteConfigLoadStart=9]="RouteConfigLoadStart",o[o.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",o[o.ChildActivationStart=11]="ChildActivationStart",o[o.ChildActivationEnd=12]="ChildActivationEnd",o[o.ActivationStart=13]="ActivationStart",o[o.ActivationEnd=14]="ActivationEnd",o[o.Scroll=15]="Scroll",o[o.NavigationSkipped=16]="NavigationSkipped",o}(Ao||{}),Tl=class{constructor(e,t){this.id=e,this.url=t}},b1=class extends Tl{constructor(e,t,s="imperative",a=null){super(e,t),this.type=Ao.NavigationStart,this.navigationTrigger=s,this.restoredState=a}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},Wc=class extends Tl{constructor(e,t,s){super(e,t),this.urlAfterRedirects=s,this.type=Ao.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},Sl=function(o){return o[o.Redirect=0]="Redirect",o[o.SupersededByNewNavigation=1]="SupersededByNewNavigation",o[o.NoDataFromResolver=2]="NoDataFromResolver",o[o.GuardRejected=3]="GuardRejected",o}(Sl||{}),X5=function(o){return o[o.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",o[o.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",o}(X5||{}),qh=class extends Tl{constructor(e,t,s,a){super(e,t),this.reason=s,this.code=a,this.type=Ao.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},Xh=class extends Tl{constructor(e,t,s,a){super(e,t),this.reason=s,this.code=a,this.type=Ao.NavigationSkipped}},$2=class extends Tl{constructor(e,t,s,a){super(e,t),this.error=s,this.target=a,this.type=Ao.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},Z5=class extends Tl{constructor(e,t,s,a){super(e,t),this.urlAfterRedirects=s,this.state=a,this.type=Ao.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Nx=class extends Tl{constructor(e,t,s,a){super(e,t),this.urlAfterRedirects=s,this.state=a,this.type=Ao.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},zx=class extends Tl{constructor(e,t,s,a,i){super(e,t),this.urlAfterRedirects=s,this.state=a,this.shouldActivate=i,this.type=Ao.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},Bx=class extends Tl{constructor(e,t,s,a){super(e,t),this.urlAfterRedirects=s,this.state=a,this.type=Ao.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Ux=class extends Tl{constructor(e,t,s,a){super(e,t),this.urlAfterRedirects=s,this.state=a,this.type=Ao.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Vx=class{constructor(e){this.route=e,this.type=Ao.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},Gx=class{constructor(e){this.route=e,this.type=Ao.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},Hx=class{constructor(e){this.snapshot=e,this.type=Ao.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},jx=class{constructor(e){this.snapshot=e,this.type=Ao.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Wx=class{constructor(e){this.snapshot=e,this.type=Ao.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},qx=class{constructor(e){this.snapshot=e,this.type=Ao.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},$5=class{constructor(e,t,s){this.routerEvent=e,this.position=t,this.anchor=s,this.type=Ao.Scroll}toString(){let e=this.position?`${this.position[0]}, ${this.position[1]}`:null;return`Scroll(anchor: '${this.anchor}', position: '${e}')`}},Y2=class{},J2=class{constructor(e){this.url=e}};var Xx=class{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new rg,this.attachRef=null}},rg=(()=>{let e=class e{constructor(){this.contexts=new Map}onChildOutletCreated(s,a){let i=this.getOrCreateContext(s);i.outlet=a,this.contexts.set(s,i)}onChildOutletDestroyed(s){let a=this.getContext(s);a&&(a.outlet=null,a.attachRef=null)}onOutletDeactivated(){let s=this.contexts;return this.contexts=new Map,s}onOutletReAttached(s){this.contexts=s}getOrCreateContext(s){let a=this.getContext(s);return a||(a=new Xx,this.contexts.set(s,a)),a}getContext(s){return this.contexts.get(s)||null}};e.\u0275fac=function(a){return new(a||e)},e.\u0275prov=jr({token:e,factory:e.\u0275fac,providedIn:"root"});let o=e;return o})(),Y5=class{constructor(e){this._root=e}get root(){return this._root.value}parent(e){let t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){let t=Zx(e,this._root);return t?t.children.map(s=>s.value):[]}firstChild(e){let t=Zx(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){let t=$x(e,this._root);return t.length<2?[]:t[t.length-2].children.map(a=>a.value).filter(a=>a!==e)}pathFromRoot(e){return $x(e,this._root).map(t=>t.value)}};function Zx(o,e){if(o===e.value)return e;for(let t of e.children){let s=Zx(o,t);if(s)return s}return null}function $x(o,e){if(o===e.value)return[e];for(let t of e.children){let s=$x(o,t);if(s.length)return s.unshift(e),s}return[]}var ol=class{constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}};function g1(o){let e={};return o&&o.children.forEach(t=>e[t.value.outlet]=t),e}var J5=class extends Y5{constructor(e,t){super(e),this.snapshot=t,s8(this,e)}toString(){return this.snapshot.toString()}};function IA(o){let e=pz(o),t=new tl([new Eu("",{})]),s=new tl({}),a=new tl({}),i=new tl({}),f=new tl(""),v=new Zh(t,s,i,f,a,xr,o,e.root);return v.snapshot=e.root,new J5(new ol(v,[]),e)}function pz(o){let e={},t={},s={},a="",i=new K2([],e,s,a,t,xr,o,null,{});return new K5("",new ol(i,[]))}var Zh=class{constructor(e,t,s,a,i,f,v,x){this.urlSubject=e,this.paramsSubject=t,this.queryParamsSubject=s,this.fragmentSubject=a,this.dataSubject=i,this.outlet=f,this.component=v,this._futureSnapshot=x,this.title=this.dataSubject?.pipe(ys(M=>M[ig]))??Xn(void 0),this.url=e,this.params=t,this.queryParams=s,this.fragment=a,this.data=i}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(ys(e=>v1(e))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(ys(e=>v1(e))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function r8(o,e,t="emptyOnly"){let s,{routeConfig:a}=o;return e!==null&&(t==="always"||a?.path===""||!e.component&&!e.routeConfig?.loadComponent)?s={params:Ti(Ti({},e.params),o.params),data:Ti(Ti({},e.data),o.data),resolve:Ti(Ti(Ti(Ti({},o.data),e.data),a?.data),o._resolvedData)}:s={params:Ti({},o.params),data:Ti({},o.data),resolve:Ti(Ti({},o.data),o._resolvedData??{})},a&&RA(a)&&(s.resolve[ig]=a.title),s}var K2=class{get title(){return this.data?.[ig]}constructor(e,t,s,a,i,f,v,x,M){this.url=e,this.params=t,this.queryParams=s,this.fragment=a,this.data=i,this.outlet=f,this.component=v,this.routeConfig=x,this._resolve=M}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=v1(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=v1(this.queryParams),this._queryParamMap}toString(){let e=this.url.map(s=>s.toString()).join("/"),t=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${e}', path:'${t}')`}},K5=class extends Y5{constructor(e,t){super(t),this.url=e,s8(this,t)}toString(){return PA(this._root)}};function s8(o,e){e.value._routerState=o,e.children.forEach(t=>s8(o,t))}function PA(o){let e=o.children.length>0?` { ${o.children.map(PA).join(", ")} } `:"";return`${o.value}${e}`}function Px(o){if(o.snapshot){let e=o.snapshot,t=o._futureSnapshot;o.snapshot=t,jc(e.queryParams,t.queryParams)||o.queryParamsSubject.next(t.queryParams),e.fragment!==t.fragment&&o.fragmentSubject.next(t.fragment),jc(e.params,t.params)||o.paramsSubject.next(t.params),GN(e.url,t.url)||o.urlSubject.next(t.url),jc(e.data,t.data)||o.dataSubject.next(t.data)}else o.snapshot=o._futureSnapshot,o.dataSubject.next(o._futureSnapshot.data)}function Yx(o,e){let t=jc(o.params,e.params)&&qN(o.url,e.url),s=!o.parent!=!e.parent;return t&&!s&&(!o.parent||Yx(o.parent,e.parent))}function RA(o){return typeof o.title=="string"||o.title===null}var fz=(()=>{let e=class e{constructor(){this.activated=null,this._activatedRoute=null,this.name=xr,this.activateEvents=new mn,this.deactivateEvents=new mn,this.attachEvents=new mn,this.detachEvents=new mn,this.parentContexts=ai(rg),this.location=ai(Jl),this.changeDetector=ai(ts),this.environmentInjector=ai(I2),this.inputBinder=ai(i3,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(s){if(s.name){let{firstChange:a,previousValue:i}=s.name;if(a)return;this.isTrackedInParentContexts(i)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(i)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(s){return this.parentContexts.getContext(s)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let s=this.parentContexts.getContext(this.name);s?.route&&(s.attachRef?this.attach(s.attachRef,s.route):this.activateWith(s.route,s.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new zo(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new zo(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new zo(4012,!1);this.location.detach();let s=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(s.instance),s}attach(s,a){this.activated=s,this._activatedRoute=a,this.location.insert(s.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(s.instance)}deactivate(){if(this.activated){let s=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(s)}}activateWith(s,a){if(this.isActivated)throw new zo(4013,!1);this._activatedRoute=s;let i=this.location,v=s.snapshot.component,x=this.parentContexts.getOrCreateContext(this.name).children,M=new Jx(s,x,i.injector);this.activated=i.createComponent(v,{index:i.length,injector:M,environmentInjector:a??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}};e.\u0275fac=function(a){return new(a||e)},e.\u0275dir=lr({type:e,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[Ms]});let o=e;return o})(),Jx=class{constructor(e,t,s){this.route=e,this.childContexts=t,this.parent=s}get(e,t){return e===Zh?this.route:e===rg?this.childContexts:this.parent.get(e,t)}},i3=new Sn(""),dA=(()=>{let e=class e{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(s){this.unsubscribeFromRouteData(s),this.subscribeToRouteData(s)}unsubscribeFromRouteData(s){this.outletDataSubscriptions.get(s)?.unsubscribe(),this.outletDataSubscriptions.delete(s)}subscribeToRouteData(s){let{activatedRoute:a}=s,i=p5([a.queryParams,a.params,a.data]).pipe(la(([f,v,x],M)=>(x=Ti(Ti(Ti({},f),v),x),M===0?Xn(x):Promise.resolve(x)))).subscribe(f=>{if(!s.isActivated||!s.activatedComponentRef||s.activatedRoute!==a||a.component===null){this.unsubscribeFromRouteData(s);return}let v=PE(a.component);if(!v){this.unsubscribeFromRouteData(s);return}for(let{templateName:x}of v.inputs)s.activatedComponentRef.setInput(x,f[x])});this.outletDataSubscriptions.set(s,i)}};e.\u0275fac=function(a){return new(a||e)},e.\u0275prov=jr({token:e,factory:e.\u0275fac});let o=e;return o})();function mz(o,e,t){let s=Q2(o,e._root,t?t._root:void 0);return new J5(s,e)}function Q2(o,e,t){if(t&&o.shouldReuseRoute(e.value,t.value.snapshot)){let s=t.value;s._futureSnapshot=e.value;let a=gz(o,e,t);return new ol(s,a)}else{if(o.shouldAttach(e.value)){let i=o.retrieve(e.value);if(i!==null){let f=i.route;return f.value._futureSnapshot=e.value,f.children=e.children.map(v=>Q2(o,v)),f}}let s=_z(e.value),a=e.children.map(i=>Q2(o,i));return new ol(s,a)}}function gz(o,e,t){return e.children.map(s=>{for(let a of t.children)if(o.shouldReuseRoute(s.value,a.value.snapshot))return Q2(o,s,a);return Q2(o,s)})}function _z(o){return new Zh(new tl(o.url),new tl(o.params),new tl(o.queryParams),new tl(o.fragment),new tl(o.data),o.outlet,o.component,o)}var kA="ngNavigationCancelingError";function DA(o,e){let{redirectTo:t,navigationBehaviorOptions:s}=x1(e)?{redirectTo:e,navigationBehaviorOptions:void 0}:e,a=LA(!1,Sl.Redirect);return a.url=t,a.navigationBehaviorOptions=s,a}function LA(o,e){let t=new Error(`NavigationCancelingError: ${o||""}`);return t[kA]=!0,t.cancellationCode=e,t}function yz(o){return FA(o)&&x1(o.url)}function FA(o){return!!o&&o[kA]}var vz=(()=>{let e=class e{};e.\u0275fac=function(a){return new(a||e)},e.\u0275cmp=$i({type:e,selectors:[["ng-component"]],standalone:!0,features:[Yi],decls:1,vars:0,template:function(a,i){a&1&&Ln(0,"router-outlet")},dependencies:[fz],encapsulation:2});let o=e;return o})();function xz(o,e){return o.providers&&!o._injector&&(o._injector=bx(o.providers,e,`Route: ${o.path}`)),o._injector??e}function o8(o){let e=o.children&&o.children.map(o8),t=e?Ns(Ti({},o),{children:e}):Ti({},o);return!t.component&&!t.loadComponent&&(e||t.loadChildren)&&t.outlet&&t.outlet!==xr&&(t.component=vz),t}function qc(o){return o.outlet||xr}function bz(o,e){let t=o.filter(s=>qc(s)===e);return t.push(...o.filter(s=>qc(s)!==e)),t}function sg(o){if(!o)return null;if(o.routeConfig?._injector)return o.routeConfig._injector;for(let e=o.parent;e;e=e.parent){let t=e.routeConfig;if(t?._loadedInjector)return t._loadedInjector;if(t?._injector)return t._injector}return null}var wz=(o,e,t,s)=>ys(a=>(new Kx(e,a.targetRouterState,a.currentRouterState,t,s).activate(o),a)),Kx=class{constructor(e,t,s,a,i){this.routeReuseStrategy=e,this.futureState=t,this.currState=s,this.forwardEvent=a,this.inputBindingEnabled=i}activate(e){let t=this.futureState._root,s=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,s,e),Px(this.futureState.root),this.activateChildRoutes(t,s,e)}deactivateChildRoutes(e,t,s){let a=g1(t);e.children.forEach(i=>{let f=i.value.outlet;this.deactivateRoutes(i,a[f],s),delete a[f]}),Object.values(a).forEach(i=>{this.deactivateRouteAndItsChildren(i,s)})}deactivateRoutes(e,t,s){let a=e.value,i=t?t.value:null;if(a===i)if(a.component){let f=s.getContext(a.outlet);f&&this.deactivateChildRoutes(e,t,f.children)}else this.deactivateChildRoutes(e,t,s);else i&&this.deactivateRouteAndItsChildren(t,s)}deactivateRouteAndItsChildren(e,t){e.value.component&&this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){let s=t.getContext(e.value.outlet),a=s&&e.value.component?s.children:t,i=g1(e);for(let f of Object.values(i))this.deactivateRouteAndItsChildren(f,a);if(s&&s.outlet){let f=s.outlet.detach(),v=s.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:f,route:e,contexts:v})}}deactivateRouteAndOutlet(e,t){let s=t.getContext(e.value.outlet),a=s&&e.value.component?s.children:t,i=g1(e);for(let f of Object.values(i))this.deactivateRouteAndItsChildren(f,a);s&&(s.outlet&&(s.outlet.deactivate(),s.children.onOutletDeactivated()),s.attachRef=null,s.route=null)}activateChildRoutes(e,t,s){let a=g1(t);e.children.forEach(i=>{this.activateRoutes(i,a[i.value.outlet],s),this.forwardEvent(new qx(i.value.snapshot))}),e.children.length&&this.forwardEvent(new jx(e.value.snapshot))}activateRoutes(e,t,s){let a=e.value,i=t?t.value:null;if(Px(a),a===i)if(a.component){let f=s.getOrCreateContext(a.outlet);this.activateChildRoutes(e,t,f.children)}else this.activateChildRoutes(e,t,s);else if(a.component){let f=s.getOrCreateContext(a.outlet);if(this.routeReuseStrategy.shouldAttach(a.snapshot)){let v=this.routeReuseStrategy.retrieve(a.snapshot);this.routeReuseStrategy.store(a.snapshot,null),f.children.onOutletReAttached(v.contexts),f.attachRef=v.componentRef,f.route=v.route.value,f.outlet&&f.outlet.attach(v.componentRef,v.route.value),Px(v.route.value),this.activateChildRoutes(e,null,f.children)}else{let v=sg(a.snapshot);f.attachRef=null,f.route=a,f.injector=v,f.outlet&&f.outlet.activateWith(a,f.injector),this.activateChildRoutes(e,null,f.children)}}else this.activateChildRoutes(e,null,s)}},Q5=class{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}},y1=class{constructor(e,t){this.component=e,this.route=t}};function Sz(o,e,t){let s=o._root,a=e?e._root:null;return G2(s,a,t,[s.value])}function Tz(o){let e=o.routeConfig?o.routeConfig.canActivateChild:null;return!e||e.length===0?null:{node:o,guards:e}}function S1(o,e){let t=Symbol(),s=e.get(o,t);return s===t?typeof o=="function"&&!dE(o)?o:e.get(o):s}function G2(o,e,t,s,a={canDeactivateChecks:[],canActivateChecks:[]}){let i=g1(e);return o.children.forEach(f=>{Mz(f,i[f.value.outlet],t,s.concat([f.value]),a),delete i[f.value.outlet]}),Object.entries(i).forEach(([f,v])=>q2(v,t.getContext(f),a)),a}function Mz(o,e,t,s,a={canDeactivateChecks:[],canActivateChecks:[]}){let i=o.value,f=e?e.value:null,v=t?t.getContext(o.value.outlet):null;if(f&&i.routeConfig===f.routeConfig){let x=Ez(f,i,i.routeConfig.runGuardsAndResolvers);x?a.canActivateChecks.push(new Q5(s)):(i.data=f.data,i._resolvedData=f._resolvedData),i.component?G2(o,e,v?v.children:null,s,a):G2(o,e,t,s,a),x&&v&&v.outlet&&v.outlet.isActivated&&a.canDeactivateChecks.push(new y1(v.outlet.component,f))}else f&&q2(e,v,a),a.canActivateChecks.push(new Q5(s)),i.component?G2(o,null,v?v.children:null,s,a):G2(o,null,t,s,a);return a}function Ez(o,e,t){if(typeof t=="function")return t(o,e);switch(t){case"pathParamsChange":return!Au(o.url,e.url);case"pathParamsOrQueryParamsChange":return!Au(o.url,e.url)||!jc(o.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Yx(o,e)||!jc(o.queryParams,e.queryParams);case"paramsChange":default:return!Yx(o,e)}}function q2(o,e,t){let s=g1(o),a=o.value;Object.entries(s).forEach(([i,f])=>{a.component?e?q2(f,e.children.getContext(i),t):q2(f,null,t):q2(f,e,t)}),a.component?e&&e.outlet&&e.outlet.isActivated?t.canDeactivateChecks.push(new y1(e.outlet.component,a)):t.canDeactivateChecks.push(new y1(null,a)):t.canDeactivateChecks.push(new y1(null,a))}function og(o){return typeof o=="function"}function Az(o){return typeof o=="boolean"}function Cz(o){return o&&og(o.canLoad)}function Iz(o){return o&&og(o.canActivate)}function Pz(o){return o&&og(o.canActivateChild)}function Rz(o){return o&&og(o.canDeactivate)}function kz(o){return o&&og(o.canMatch)}function OA(o){return o instanceof nE||o?.name==="EmptyError"}var V5=Symbol("INITIAL_VALUE");function w1(){return la(o=>p5(o.map(e=>e.pipe(No(1),Yo(V5)))).pipe(ys(e=>{for(let t of e)if(t!==!0){if(t===V5)return V5;if(t===!1||t instanceof Wh)return t}return!0}),go(e=>e!==V5),No(1)))}function Dz(o,e){return nl(t=>{let{targetSnapshot:s,currentSnapshot:a,guards:{canActivateChecks:i,canDeactivateChecks:f}}=t;return f.length===0&&i.length===0?Xn(Ns(Ti({},t),{guardsResult:!0})):Lz(f,s,a,o).pipe(nl(v=>v&&Az(v)?Fz(s,i,o,e):Xn(v)),ys(v=>Ns(Ti({},t),{guardsResult:v})))})}function Lz(o,e,t,s){return il(o).pipe(nl(a=>Uz(a.component,a.route,t,e,s)),kh(a=>a!==!0,!0))}function Fz(o,e,t,s){return il(e).pipe(l1(a=>rE(Nz(a.route.parent,s),Oz(a.route,s),Bz(o,a.path,t),zz(o,a.route,t))),kh(a=>a!==!0,!0))}function Oz(o,e){return o!==null&&e&&e(new Wx(o)),Xn(!0)}function Nz(o,e){return o!==null&&e&&e(new Hx(o)),Xn(!0)}function zz(o,e,t){let s=e.routeConfig?e.routeConfig.canActivate:null;if(!s||s.length===0)return Xn(!0);let a=s.map(i=>bu(()=>{let f=sg(e)??t,v=S1(i,f),x=Iz(v)?v.canActivate(e,o):Dh(f,()=>v(e,o));return $h(x).pipe(kh())}));return Xn(a).pipe(w1())}function Bz(o,e,t){let s=e[e.length-1],i=e.slice(0,e.length-1).reverse().map(f=>Tz(f)).filter(f=>f!==null).map(f=>bu(()=>{let v=f.guards.map(x=>{let M=sg(f.node)??t,C=S1(x,M),D=Pz(C)?C.canActivateChild(s,o):Dh(M,()=>C(s,o));return $h(D).pipe(kh())});return Xn(v).pipe(w1())}));return Xn(i).pipe(w1())}function Uz(o,e,t,s,a){let i=e&&e.routeConfig?e.routeConfig.canDeactivate:null;if(!i||i.length===0)return Xn(!0);let f=i.map(v=>{let x=sg(e)??a,M=S1(v,x),C=Rz(M)?M.canDeactivate(o,e,t,s):Dh(x,()=>M(o,e,t,s));return $h(C).pipe(kh())});return Xn(f).pipe(w1())}function Vz(o,e,t,s){let a=e.canLoad;if(a===void 0||a.length===0)return Xn(!0);let i=a.map(f=>{let v=S1(f,o),x=Cz(v)?v.canLoad(e,t):Dh(o,()=>v(e,t));return $h(x)});return Xn(i).pipe(w1(),NA(s))}function NA(o){return eE(_o(e=>{if(x1(e))throw DA(o,e)}),ys(e=>e===!0))}function Gz(o,e,t,s){let a=e.canMatch;if(!a||a.length===0)return Xn(!0);let i=a.map(f=>{let v=S1(f,o),x=kz(v)?v.canMatch(e,t):Dh(o,()=>v(e,t));return $h(x)});return Xn(i).pipe(w1(),NA(s))}var eg=class{constructor(e){this.segmentGroup=e||null}},e3=class extends Error{constructor(e){super(),this.urlTree=e}};function m1(o){return E2(new eg(o))}function Hz(o){return E2(new zo(4e3,!1))}function jz(o){return E2(LA(!1,Sl.GuardRejected))}var Qx=class{constructor(e,t){this.urlSerializer=e,this.urlTree=t}lineralizeSegments(e,t){let s=[],a=t.root;for(;;){if(s=s.concat(a.segments),a.numberOfChildren===0)return Xn(s);if(a.numberOfChildren>1||!a.children[xr])return Hz(e.redirectTo);a=a.children[xr]}}applyRedirectCommands(e,t,s){let a=this.applyRedirectCreateUrlTree(t,this.urlSerializer.parse(t),e,s);if(t.startsWith("/"))throw new e3(a);return a}applyRedirectCreateUrlTree(e,t,s,a){let i=this.createSegmentGroup(e,t.root,s,a);return new Wh(i,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){let s={};return Object.entries(e).forEach(([a,i])=>{if(typeof i=="string"&&i.startsWith(":")){let v=i.substring(1);s[a]=t[v]}else s[a]=i}),s}createSegmentGroup(e,t,s,a){let i=this.createSegments(e,t.segments,s,a),f={};return Object.entries(t.children).forEach(([v,x])=>{f[v]=this.createSegmentGroup(e,x,s,a)}),new is(i,f)}createSegments(e,t,s,a){return t.map(i=>i.path.startsWith(":")?this.findPosParam(e,i,a):this.findOrReturn(i,s))}findPosParam(e,t,s){let a=s[t.path.substring(1)];if(!a)throw new zo(4001,!1);return a}findOrReturn(e,t){let s=0;for(let a of t){if(a.path===e.path)return t.splice(s),a;s++}return e}},e8={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function Wz(o,e,t,s,a){let i=a8(o,e,t);return i.matched?(s=xz(e,s),Gz(s,e,t,a).pipe(ys(f=>f===!0?i:Ti({},e8)))):Xn(i)}function a8(o,e,t){if(e.path==="**")return qz(t);if(e.path==="")return e.pathMatch==="full"&&(o.hasChildren()||t.length>0)?Ti({},e8):{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};let a=(e.matcher||VN)(t,o,e);if(!a)return Ti({},e8);let i={};Object.entries(a.posParams??{}).forEach(([v,x])=>{i[v]=x.path});let f=a.consumed.length>0?Ti(Ti({},i),a.consumed[a.consumed.length-1].parameters):i;return{matched:!0,consumedSegments:a.consumed,remainingSegments:t.slice(a.consumed.length),parameters:f,positionalParamSegments:a.posParams??{}}}function qz(o){return{matched:!0,parameters:o.length>0?gA(o).parameters:{},consumedSegments:o,remainingSegments:[],positionalParamSegments:{}}}function uA(o,e,t,s){return t.length>0&&$z(o,t,s)?{segmentGroup:new is(e,Zz(s,new is(t,o.children))),slicedSegments:[]}:t.length===0&&Yz(o,t,s)?{segmentGroup:new is(o.segments,Xz(o,t,s,o.children)),slicedSegments:t}:{segmentGroup:new is(o.segments,o.children),slicedSegments:t}}function Xz(o,e,t,s){let a={};for(let i of t)if(n3(o,e,i)&&!s[qc(i)]){let f=new is([],{});a[qc(i)]=f}return Ti(Ti({},s),a)}function Zz(o,e){let t={};t[xr]=e;for(let s of o)if(s.path===""&&qc(s)!==xr){let a=new is([],{});t[qc(s)]=a}return t}function $z(o,e,t){return t.some(s=>n3(o,e,s)&&qc(s)!==xr)}function Yz(o,e,t){return t.some(s=>n3(o,e,s))}function n3(o,e,t){return(o.hasChildren()||e.length>0)&&t.pathMatch==="full"?!1:t.path===""}function Jz(o,e,t,s){return qc(o)!==s&&(s===xr||!n3(e,t,o))?!1:a8(e,o,t).matched}function Kz(o,e,t){return e.length===0&&!o.children[t]}var t8=class{};function Qz(o,e,t,s,a,i,f="emptyOnly"){return new i8(o,e,t,s,a,f,i).recognize()}var eB=31,i8=class{constructor(e,t,s,a,i,f,v){this.injector=e,this.configLoader=t,this.rootComponentType=s,this.config=a,this.urlTree=i,this.paramsInheritanceStrategy=f,this.urlSerializer=v,this.applyRedirects=new Qx(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(e){return new zo(4002,`'${e.segmentGroup}'`)}recognize(){let e=uA(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(e).pipe(ys(t=>{let s=new K2([],Object.freeze({}),Object.freeze(Ti({},this.urlTree.queryParams)),this.urlTree.fragment,{},xr,this.rootComponentType,null,{}),a=new ol(s,t),i=new K5("",a),f=oz(s,[],this.urlTree.queryParams,this.urlTree.fragment);return f.queryParams=this.urlTree.queryParams,i.url=this.urlSerializer.serialize(f),this.inheritParamsAndData(i._root,null),{state:i,tree:f}}))}match(e){return this.processSegmentGroup(this.injector,this.config,e,xr).pipe(a1(s=>{if(s instanceof e3)return this.urlTree=s.urlTree,this.match(s.urlTree.root);throw s instanceof eg?this.noMatchError(s):s}))}inheritParamsAndData(e,t){let s=e.value,a=r8(s,t,this.paramsInheritanceStrategy);s.params=Object.freeze(a.params),s.data=Object.freeze(a.data),e.children.forEach(i=>this.inheritParamsAndData(i,s))}processSegmentGroup(e,t,s,a){return s.segments.length===0&&s.hasChildren()?this.processChildren(e,t,s):this.processSegment(e,t,s,s.segments,a,!0).pipe(ys(i=>i instanceof ol?[i]:[]))}processChildren(e,t,s){let a=[];for(let i of Object.keys(s.children))i==="primary"?a.unshift(i):a.push(i);return il(a).pipe(l1(i=>{let f=s.children[i],v=bz(t,i);return this.processSegmentGroup(e,v,f,i)}),cE((i,f)=>(i.push(...f),i)),_x(null),lE(),nl(i=>{if(i===null)return m1(s);let f=zA(i);return tB(f),Xn(f)}))}processSegment(e,t,s,a,i,f){return il(t).pipe(l1(v=>this.processSegmentAgainstRoute(v._injector??e,t,v,s,a,i,f).pipe(a1(x=>{if(x instanceof eg)return Xn(null);throw x}))),kh(v=>!!v),a1(v=>{if(OA(v))return Kz(s,a,i)?Xn(new t8):m1(s);throw v}))}processSegmentAgainstRoute(e,t,s,a,i,f,v){return Jz(s,a,i,f)?s.redirectTo===void 0?this.matchSegmentAgainstRoute(e,a,s,i,f):this.allowRedirects&&v?this.expandSegmentAgainstRouteUsingRedirect(e,a,t,s,i,f):m1(a):m1(a)}expandSegmentAgainstRouteUsingRedirect(e,t,s,a,i,f){let{matched:v,consumedSegments:x,positionalParamSegments:M,remainingSegments:C}=a8(t,a,i);if(!v)return m1(t);a.redirectTo.startsWith("/")&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>eB&&(this.allowRedirects=!1));let D=this.applyRedirects.applyRedirectCommands(x,a.redirectTo,M);return this.applyRedirects.lineralizeSegments(a,D).pipe(nl(L=>this.processSegment(e,s,t,L.concat(C),f,!1)))}matchSegmentAgainstRoute(e,t,s,a,i){let f=Wz(t,s,a,e,this.urlSerializer);return s.path==="**"&&(t.children={}),f.pipe(la(v=>v.matched?(e=s._injector??e,this.getChildConfig(e,s,a).pipe(la(({routes:x})=>{let M=s._loadedInjector??e,{consumedSegments:C,remainingSegments:D,parameters:L}=v,N=new K2(C,L,Object.freeze(Ti({},this.urlTree.queryParams)),this.urlTree.fragment,nB(s),qc(s),s.component??s._loadedComponent??null,s,rB(s)),{segmentGroup:j,slicedSegments:Z}=uA(t,C,D,x);if(Z.length===0&&j.hasChildren())return this.processChildren(M,x,j).pipe(ys(H=>H===null?null:new ol(N,H)));if(x.length===0&&Z.length===0)return Xn(new ol(N,[]));let G=qc(s)===i;return this.processSegment(M,x,j,Z,G?xr:i,!0).pipe(ys(H=>new ol(N,H instanceof ol?[H]:[])))}))):m1(t)))}getChildConfig(e,t,s){return t.children?Xn({routes:t.children,injector:e}):t.loadChildren?t._loadedRoutes!==void 0?Xn({routes:t._loadedRoutes,injector:t._loadedInjector}):Vz(e,t,s,this.urlSerializer).pipe(nl(a=>a?this.configLoader.loadChildren(e,t).pipe(_o(i=>{t._loadedRoutes=i.routes,t._loadedInjector=i.injector})):jz(t))):Xn({routes:[],injector:e})}};function tB(o){o.sort((e,t)=>e.value.outlet===xr?-1:t.value.outlet===xr?1:e.value.outlet.localeCompare(t.value.outlet))}function iB(o){let e=o.value.routeConfig;return e&&e.path===""}function zA(o){let e=[],t=new Set;for(let s of o){if(!iB(s)){e.push(s);continue}let a=e.find(i=>s.value.routeConfig===i.value.routeConfig);a!==void 0?(a.children.push(...s.children),t.add(a)):e.push(s)}for(let s of t){let a=zA(s.children);e.push(new ol(s.value,a))}return e.filter(s=>!t.has(s))}function nB(o){return o.data||{}}function rB(o){return o.resolve||{}}function sB(o,e,t,s,a,i){return nl(f=>Qz(o,e,t,s,f.extractedUrl,a,i).pipe(ys(({state:v,tree:x})=>Ns(Ti({},f),{targetSnapshot:v,urlAfterRedirects:x}))))}function oB(o,e){return nl(t=>{let{targetSnapshot:s,guards:{canActivateChecks:a}}=t;if(!a.length)return Xn(t);let i=new Set(a.map(x=>x.route)),f=new Set;for(let x of i)if(!f.has(x))for(let M of BA(x))f.add(M);let v=0;return il(f).pipe(l1(x=>i.has(x)?aB(x,s,o,e):(x.data=r8(x,x.parent,o).resolve,Xn(void 0))),_o(()=>v++),yx(1),nl(x=>v===f.size?Xn(t):$l))})}function BA(o){let e=o.children.map(t=>BA(t)).flat();return[o,...e]}function aB(o,e,t,s){let a=o.routeConfig,i=o._resolve;return a?.title!==void 0&&!RA(a)&&(i[ig]=a.title),lB(i,o,e,s).pipe(ys(f=>(o._resolvedData=f,o.data=r8(o,o.parent,t).resolve,null)))}function lB(o,e,t,s){let a=Dx(o);if(a.length===0)return Xn({});let i={};return il(a).pipe(nl(f=>cB(o[f],e,t,s).pipe(kh(),_o(v=>{i[f]=v}))),yx(1),aE(i),a1(f=>OA(f)?$l:E2(f)))}function cB(o,e,t,s){let a=sg(e)??s,i=S1(o,a),f=i.resolve?i.resolve(e,t):Dh(a,()=>i(e,t));return $h(f)}function Rx(o){return la(e=>{let t=o(e);return t?il(t).pipe(ys(()=>e)):Xn(e)})}var UA=(()=>{let e=class e{buildTitle(s){let a,i=s.root;for(;i!==void 0;)a=this.getResolvedTitleForRoute(i)??a,i=i.children.find(f=>f.outlet===xr);return a}getResolvedTitleForRoute(s){return s.data[ig]}};e.\u0275fac=function(a){return new(a||e)},e.\u0275prov=jr({token:e,factory:()=>ai(hB),providedIn:"root"});let o=e;return o})(),hB=(()=>{let e=class e extends UA{constructor(s){super(),this.title=s}updateTitle(s){let a=this.buildTitle(s);a!==void 0&&this.title.setTitle(a)}};e.\u0275fac=function(a){return new(a||e)(Sr(NE))},e.\u0275prov=jr({token:e,factory:e.\u0275fac,providedIn:"root"});let o=e;return o})(),ag=new Sn("",{providedIn:"root",factory:()=>({})}),tg=new Sn(""),l8=(()=>{let e=class e{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=ai(M5)}loadComponent(s){if(this.componentLoaders.get(s))return this.componentLoaders.get(s);if(s._loadedComponent)return Xn(s._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(s);let a=$h(s.loadComponent()).pipe(ys(VA),_o(f=>{this.onLoadEndListener&&this.onLoadEndListener(s),s._loadedComponent=f}),g5(()=>{this.componentLoaders.delete(s)})),i=new mx(a,()=>new fn).pipe(fx());return this.componentLoaders.set(s,i),i}loadChildren(s,a){if(this.childrenLoaders.get(a))return this.childrenLoaders.get(a);if(a._loadedRoutes)return Xn({routes:a._loadedRoutes,injector:a._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(a);let f=dB(a,this.compiler,s,this.onLoadEndListener).pipe(g5(()=>{this.childrenLoaders.delete(a)})),v=new mx(f,()=>new fn).pipe(fx());return this.childrenLoaders.set(a,v),v}};e.\u0275fac=function(a){return new(a||e)},e.\u0275prov=jr({token:e,factory:e.\u0275fac,providedIn:"root"});let o=e;return o})();function dB(o,e,t,s){return $h(o.loadChildren()).pipe(ys(VA),nl(a=>a instanceof xE||Array.isArray(a)?Xn(a):il(e.compileModuleAsync(a))),ys(a=>{s&&s(o);let i,f,v=!1;return Array.isArray(a)?(f=a,v=!0):(i=a.create(t).injector,f=i.get(tg,[],{optional:!0,self:!0}).flat()),{routes:f.map(o8),injector:i}}))}function uB(o){return o&&typeof o=="object"&&"default"in o}function VA(o){return uB(o)?o.default:o}var c8=(()=>{let e=class e{};e.\u0275fac=function(a){return new(a||e)},e.\u0275prov=jr({token:e,factory:()=>ai(pB),providedIn:"root"});let o=e;return o})(),pB=(()=>{let e=class e{shouldProcessUrl(s){return!0}extract(s){return s}merge(s,a){return s}};e.\u0275fac=function(a){return new(a||e)},e.\u0275prov=jr({token:e,factory:e.\u0275fac,providedIn:"root"});let o=e;return o})(),GA=new Sn(""),HA=new Sn("");function fB(o,e,t){let s=o.get(HA),a=o.get(eo);return o.get(Ur).runOutsideAngular(()=>{if(!a.startViewTransition||s.skipNextTransition)return s.skipNextTransition=!1,Promise.resolve();let i,f=new Promise(M=>{i=M}),v=a.startViewTransition(()=>(i(),mB(o))),{onViewTransitionCreated:x}=s;return x&&Dh(o,()=>x({transition:v,from:e,to:t})),f})}function mB(o){return new Promise(e=>{vE(e,{injector:o})})}var h8=(()=>{let e=class e{get hasRequestedNavigation(){return this.navigationId!==0}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new fn,this.transitionAbortSubject=new fn,this.configLoader=ai(l8),this.environmentInjector=ai(I2),this.urlSerializer=ai(ng),this.rootContexts=ai(rg),this.location=ai(Su),this.inputBindingEnabled=ai(i3,{optional:!0})!==null,this.titleStrategy=ai(UA),this.options=ai(ag,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=ai(c8),this.createViewTransition=ai(GA,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>Xn(void 0),this.rootComponentType=null;let s=i=>this.events.next(new Vx(i)),a=i=>this.events.next(new Gx(i));this.configLoader.onLoadEndListener=a,this.configLoader.onLoadStartListener=s}complete(){this.transitions?.complete()}handleNavigationRequest(s){let a=++this.navigationId;this.transitions?.next(Ns(Ti(Ti({},this.transitions.value),s),{id:a}))}setupNavigations(s,a,i){return this.transitions=new tl({id:0,currentUrlTree:a,currentRawUrl:a,extractedUrl:this.urlHandlingStrategy.extract(a),urlAfterRedirects:this.urlHandlingStrategy.extract(a),rawUrl:a,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:W2,restoredState:null,currentSnapshot:i.snapshot,targetSnapshot:null,currentRouterState:i,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(go(f=>f.id!==0),ys(f=>Ns(Ti({},f),{extractedUrl:this.urlHandlingStrategy.extract(f.rawUrl)})),la(f=>{this.currentTransition=f;let v=!1,x=!1;return Xn(f).pipe(_o(M=>{this.currentNavigation={id:M.id,initialUrl:M.rawUrl,extractedUrl:M.extractedUrl,trigger:M.source,extras:M.extras,previousNavigation:this.lastSuccessfulNavigation?Ns(Ti({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),la(M=>{let C=!s.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),D=M.extras.onSameUrlNavigation??s.onSameUrlNavigation;if(!C&&D!=="reload"){let L="";return this.events.next(new Xh(M.id,this.urlSerializer.serialize(M.rawUrl),L,X5.IgnoredSameUrlNavigation)),M.resolve(null),$l}if(this.urlHandlingStrategy.shouldProcessUrl(M.rawUrl))return Xn(M).pipe(la(L=>{let N=this.transitions?.getValue();return this.events.next(new b1(L.id,this.urlSerializer.serialize(L.extractedUrl),L.source,L.restoredState)),N!==this.transitions?.getValue()?$l:Promise.resolve(L)}),sB(this.environmentInjector,this.configLoader,this.rootComponentType,s.config,this.urlSerializer,this.paramsInheritanceStrategy),_o(L=>{f.targetSnapshot=L.targetSnapshot,f.urlAfterRedirects=L.urlAfterRedirects,this.currentNavigation=Ns(Ti({},this.currentNavigation),{finalUrl:L.urlAfterRedirects});let N=new Z5(L.id,this.urlSerializer.serialize(L.extractedUrl),this.urlSerializer.serialize(L.urlAfterRedirects),L.targetSnapshot);this.events.next(N)}));if(C&&this.urlHandlingStrategy.shouldProcessUrl(M.currentRawUrl)){let{id:L,extractedUrl:N,source:j,restoredState:Z,extras:G}=M,H=new b1(L,this.urlSerializer.serialize(N),j,Z);this.events.next(H);let me=IA(this.rootComponentType).snapshot;return this.currentTransition=f=Ns(Ti({},M),{targetSnapshot:me,urlAfterRedirects:N,extras:Ns(Ti({},G),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=N,Xn(f)}else{let L="";return this.events.next(new Xh(M.id,this.urlSerializer.serialize(M.extractedUrl),L,X5.IgnoredByUrlHandlingStrategy)),M.resolve(null),$l}}),_o(M=>{let C=new Nx(M.id,this.urlSerializer.serialize(M.extractedUrl),this.urlSerializer.serialize(M.urlAfterRedirects),M.targetSnapshot);this.events.next(C)}),ys(M=>(this.currentTransition=f=Ns(Ti({},M),{guards:Sz(M.targetSnapshot,M.currentSnapshot,this.rootContexts)}),f)),Dz(this.environmentInjector,M=>this.events.next(M)),_o(M=>{if(f.guardsResult=M.guardsResult,x1(M.guardsResult))throw DA(this.urlSerializer,M.guardsResult);let C=new zx(M.id,this.urlSerializer.serialize(M.extractedUrl),this.urlSerializer.serialize(M.urlAfterRedirects),M.targetSnapshot,!!M.guardsResult);this.events.next(C)}),go(M=>M.guardsResult?!0:(this.cancelNavigationTransition(M,"",Sl.GuardRejected),!1)),Rx(M=>{if(M.guards.canActivateChecks.length)return Xn(M).pipe(_o(C=>{let D=new Bx(C.id,this.urlSerializer.serialize(C.extractedUrl),this.urlSerializer.serialize(C.urlAfterRedirects),C.targetSnapshot);this.events.next(D)}),la(C=>{let D=!1;return Xn(C).pipe(oB(this.paramsInheritanceStrategy,this.environmentInjector),_o({next:()=>D=!0,complete:()=>{D||this.cancelNavigationTransition(C,"",Sl.NoDataFromResolver)}}))}),_o(C=>{let D=new Ux(C.id,this.urlSerializer.serialize(C.extractedUrl),this.urlSerializer.serialize(C.urlAfterRedirects),C.targetSnapshot);this.events.next(D)}))}),Rx(M=>{let C=D=>{let L=[];D.routeConfig?.loadComponent&&!D.routeConfig._loadedComponent&&L.push(this.configLoader.loadComponent(D.routeConfig).pipe(_o(N=>{D.component=N}),ys(()=>{})));for(let N of D.children)L.push(...C(N));return L};return p5(C(M.targetSnapshot.root)).pipe(_x(null),No(1))}),Rx(()=>this.afterPreactivation()),la(()=>{let{currentSnapshot:M,targetSnapshot:C}=f,D=this.createViewTransition?.(this.environmentInjector,M.root,C.root);return D?il(D).pipe(ys(()=>f)):Xn(f)}),ys(M=>{let C=mz(s.routeReuseStrategy,M.targetSnapshot,M.currentRouterState);return this.currentTransition=f=Ns(Ti({},M),{targetRouterState:C}),this.currentNavigation.targetRouterState=C,f}),_o(()=>{this.events.next(new Y2)}),wz(this.rootContexts,s.routeReuseStrategy,M=>this.events.next(M),this.inputBindingEnabled),No(1),_o({next:M=>{v=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new Wc(M.id,this.urlSerializer.serialize(M.extractedUrl),this.urlSerializer.serialize(M.urlAfterRedirects))),this.titleStrategy?.updateTitle(M.targetRouterState.snapshot),M.resolve(!0)},complete:()=>{v=!0}}),Ra(this.transitionAbortSubject.pipe(_o(M=>{throw M}))),g5(()=>{!v&&!x&&this.cancelNavigationTransition(f,"",Sl.SupersededByNewNavigation),this.currentNavigation?.id===f.id&&(this.currentNavigation=null)}),a1(M=>{if(x=!0,FA(M))this.events.next(new qh(f.id,this.urlSerializer.serialize(f.extractedUrl),M.message,M.cancellationCode)),yz(M)?this.events.next(new J2(M.url)):f.resolve(!1);else{this.events.next(new $2(f.id,this.urlSerializer.serialize(f.extractedUrl),M,f.targetSnapshot??void 0));try{f.resolve(s.errorHandler(M))}catch(C){this.options.resolveNavigationPromiseOnError?f.resolve(!1):f.reject(C)}}return $l}))}))}cancelNavigationTransition(s,a,i){let f=new qh(s.id,this.urlSerializer.serialize(s.extractedUrl),a,i);this.events.next(f),s.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){return this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))).toString()!==this.currentTransition?.extractedUrl.toString()&&!this.currentTransition?.extras.skipLocationChange}};e.\u0275fac=function(a){return new(a||e)},e.\u0275prov=jr({token:e,factory:e.\u0275fac,providedIn:"root"});let o=e;return o})();function gB(o){return o!==W2}var _B=(()=>{let e=class e{};e.\u0275fac=function(a){return new(a||e)},e.\u0275prov=jr({token:e,factory:()=>ai(yB),providedIn:"root"});let o=e;return o})(),n8=class{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}},yB=(()=>{let e=class e extends n8{};e.\u0275fac=(()=>{let s;return function(i){return(s||(s=Bc(e)))(i||e)}})(),e.\u0275prov=jr({token:e,factory:e.\u0275fac,providedIn:"root"});let o=e;return o})(),jA=(()=>{let e=class e{};e.\u0275fac=function(a){return new(a||e)},e.\u0275prov=jr({token:e,factory:()=>ai(vB),providedIn:"root"});let o=e;return o})(),vB=(()=>{let e=class e extends jA{constructor(){super(...arguments),this.location=ai(Su),this.urlSerializer=ai(ng),this.options=ai(ag,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=ai(c8),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new Wh,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=IA(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(s){return this.location.subscribe(a=>{a.type==="popstate"&&s(a.url,a.state)})}handleRouterEvent(s,a){if(s instanceof b1)this.stateMemento=this.createStateMemento();else if(s instanceof Xh)this.rawUrlTree=a.initialUrl;else if(s instanceof Z5){if(this.urlUpdateStrategy==="eager"&&!a.extras.skipLocationChange){let i=this.urlHandlingStrategy.merge(a.finalUrl,a.initialUrl);this.setBrowserUrl(i,a)}}else s instanceof Y2?(this.currentUrlTree=a.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(a.finalUrl,a.initialUrl),this.routerState=a.targetRouterState,this.urlUpdateStrategy==="deferred"&&(a.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,a))):s instanceof qh&&(s.code===Sl.GuardRejected||s.code===Sl.NoDataFromResolver)?this.restoreHistory(a):s instanceof $2?this.restoreHistory(a,!0):s instanceof Wc&&(this.lastSuccessfulId=s.id,this.currentPageId=this.browserPageId)}setBrowserUrl(s,a){let i=this.urlSerializer.serialize(s);if(this.location.isCurrentPathEqualTo(i)||a.extras.replaceUrl){let f=this.browserPageId,v=Ti(Ti({},a.extras.state),this.generateNgRouterState(a.id,f));this.location.replaceState(i,"",v)}else{let f=Ti(Ti({},a.extras.state),this.generateNgRouterState(a.id,this.browserPageId+1));this.location.go(i,"",f)}}restoreHistory(s,a=!1){if(this.canceledNavigationResolution==="computed"){let i=this.browserPageId,f=this.currentPageId-i;f!==0?this.location.historyGo(f):this.currentUrlTree===s.finalUrl&&f===0&&(this.resetState(s),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(a&&this.resetState(s),this.resetUrlToCurrentUrlTree())}resetState(s){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,s.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(s,a){return this.canceledNavigationResolution==="computed"?{navigationId:s,\u0275routerPageId:a}:{navigationId:s}}};e.\u0275fac=(()=>{let s;return function(i){return(s||(s=Bc(e)))(i||e)}})(),e.\u0275prov=jr({token:e,factory:e.\u0275fac,providedIn:"root"});let o=e;return o})(),H2=function(o){return o[o.COMPLETE=0]="COMPLETE",o[o.FAILED=1]="FAILED",o[o.REDIRECTING=2]="REDIRECTING",o}(H2||{});function WA(o,e){o.events.pipe(go(t=>t instanceof Wc||t instanceof qh||t instanceof $2||t instanceof Xh),ys(t=>t instanceof Wc||t instanceof Xh?H2.COMPLETE:(t instanceof qh?t.code===Sl.Redirect||t.code===Sl.SupersededByNewNavigation:!1)?H2.REDIRECTING:H2.FAILED),go(t=>t!==H2.REDIRECTING),No(1)).subscribe(()=>{e()})}function xB(o){throw o}var bB={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},wB={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},I0=(()=>{let e=class e{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.isNgZoneEnabled=!1,this.console=ai(IE),this.stateManager=ai(jA),this.options=ai(ag,{optional:!0})||{},this.pendingTasks=ai(bE),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=ai(h8),this.urlSerializer=ai(ng),this.location=ai(Su),this.urlHandlingStrategy=ai(c8),this._events=new fn,this.errorHandler=this.options.errorHandler||xB,this.navigated=!1,this.routeReuseStrategy=ai(_B),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=ai(tg,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!ai(i3,{optional:!0}),this.eventsSubscription=new lo,this.isNgZoneEnabled=ai(Ur)instanceof Ur&&Ur.isInAngularZone(),this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:s=>{this.console.warn(s)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){let s=this.navigationTransitions.events.subscribe(a=>{try{let i=this.navigationTransitions.currentTransition,f=this.navigationTransitions.currentNavigation;if(i!==null&&f!==null){if(this.stateManager.handleRouterEvent(a,f),a instanceof qh&&a.code!==Sl.Redirect&&a.code!==Sl.SupersededByNewNavigation)this.navigated=!0;else if(a instanceof Wc)this.navigated=!0;else if(a instanceof J2){let v=this.urlHandlingStrategy.merge(a.url,i.currentRawUrl),x={info:i.extras.info,skipLocationChange:i.extras.skipLocationChange,replaceUrl:this.urlUpdateStrategy==="eager"||gB(i.source)};this.scheduleNavigation(v,W2,null,x,{resolve:i.resolve,reject:i.reject,promise:i.promise})}}TB(a)&&this._events.next(a)}catch(i){this.navigationTransitions.transitionAbortSubject.next(i)}});this.eventsSubscription.add(s)}resetRootComponentType(s){this.routerState.root.component=s,this.navigationTransitions.rootComponentType=s}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),W2,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((s,a)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(s,"popstate",a)},0)})}navigateToSyncWithBrowser(s,a,i){let f={replaceUrl:!0},v=i?.navigationId?i:null;if(i){let M=Ti({},i);delete M.navigationId,delete M.\u0275routerPageId,Object.keys(M).length!==0&&(f.state=M)}let x=this.parseUrl(s);this.scheduleNavigation(x,a,v,f)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(s){this.config=s.map(o8),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(s,a={}){let{relativeTo:i,queryParams:f,fragment:v,queryParamsHandling:x,preserveFragment:M}=a,C=M?this.currentUrlTree.fragment:v,D=null;switch(x){case"merge":D=Ti(Ti({},this.currentUrlTree.queryParams),f);break;case"preserve":D=this.currentUrlTree.queryParams;break;default:D=f||null}D!==null&&(D=this.removeEmptyProps(D));let L;try{let N=i?i.snapshot:this.routerState.snapshot.root;L=MA(N)}catch{(typeof s[0]!="string"||!s[0].startsWith("/"))&&(s=[]),L=this.currentUrlTree.root}return EA(L,s,D,C??null)}navigateByUrl(s,a={skipLocationChange:!1}){let i=x1(s)?s:this.parseUrl(s),f=this.urlHandlingStrategy.merge(i,this.rawUrlTree);return this.scheduleNavigation(f,W2,null,a)}navigate(s,a={skipLocationChange:!1}){return SB(s),this.navigateByUrl(this.createUrlTree(s,a),a)}serializeUrl(s){return this.urlSerializer.serialize(s)}parseUrl(s){try{return this.urlSerializer.parse(s)}catch{return this.urlSerializer.parse("/")}}isActive(s,a){let i;if(a===!0?i=Ti({},bB):a===!1?i=Ti({},wB):i=a,x1(s))return aA(this.currentUrlTree,s,i);let f=this.parseUrl(s);return aA(this.currentUrlTree,f,i)}removeEmptyProps(s){return Object.entries(s).reduce((a,[i,f])=>(f!=null&&(a[i]=f),a),{})}scheduleNavigation(s,a,i,f,v){if(this.disposed)return Promise.resolve(!1);let x,M,C;v?(x=v.resolve,M=v.reject,C=v.promise):C=new Promise((L,N)=>{x=L,M=N});let D=this.pendingTasks.add();return WA(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(D))}),this.navigationTransitions.handleNavigationRequest({source:a,restoredState:i,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:s,extras:f,resolve:x,reject:M,promise:C,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),C.catch(L=>Promise.reject(L))}};e.\u0275fac=function(a){return new(a||e)},e.\u0275prov=jr({token:e,factory:e.\u0275fac,providedIn:"root"});let o=e;return o})();function SB(o){for(let e=0;e<o.length;e++)if(o[e]==null)throw new zo(4008,!1)}function TB(o){return!(o instanceof Y2)&&!(o instanceof J2)}var qA=(()=>{let e=class e{constructor(s,a,i,f,v,x){this.router=s,this.route=a,this.tabIndexAttribute=i,this.renderer=f,this.el=v,this.locationStrategy=x,this.href=null,this.commands=null,this.onChanges=new fn,this.preserveFragment=!1,this.skipLocationChange=!1,this.replaceUrl=!1;let M=v.nativeElement.tagName?.toLowerCase();this.isAnchorElement=M==="a"||M==="area",this.isAnchorElement?this.subscription=s.events.subscribe(C=>{C instanceof Wc&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(s){this.tabIndexAttribute!=null||this.isAnchorElement||this.applyAttributeValue("tabindex",s)}ngOnChanges(s){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(s){s!=null?(this.commands=Array.isArray(s)?s:[s],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(s,a,i,f,v){let x=this.urlTree;if(x===null||this.isAnchorElement&&(s!==0||a||i||f||v||typeof this.target=="string"&&this.target!="_self"))return!0;let M={skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info};return this.router.navigateByUrl(x,M),!this.isAnchorElement}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){let s=this.urlTree;this.href=s!==null&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(s)):null;let a=this.href===null?null:gE(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",a)}applyAttributeValue(s,a){let i=this.renderer,f=this.el.nativeElement;a!==null?i.setAttribute(f,s,a):i.removeAttribute(f,s)}get urlTree(){return this.commands===null?null:this.router.createUrlTree(this.commands,{relativeTo:this.relativeTo!==void 0?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}};e.\u0275fac=function(a){return new(a||e)(Et(I0),Et(Zh),C2("tabindex"),Et(x5),Et(Ir),Et(O2))},e.\u0275dir=lr({type:e,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(a,i){a&1&&zi("click",function(v){return i.onClick(v.button,v.ctrlKey,v.shiftKey,v.altKey,v.metaKey)}),a&2&&vs("target",i.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[wn.HasDecoratorInputTransform,"preserveFragment","preserveFragment",Wr],skipLocationChange:[wn.HasDecoratorInputTransform,"skipLocationChange","skipLocationChange",Wr],replaceUrl:[wn.HasDecoratorInputTransform,"replaceUrl","replaceUrl",Wr],routerLink:"routerLink"},standalone:!0,features:[Es,Ms]});let o=e;return o})();var t3=class{};var MB=(()=>{let e=class e{constructor(s,a,i,f,v){this.router=s,this.injector=i,this.preloadingStrategy=f,this.loader=v}setUpPreloading(){this.subscription=this.router.events.pipe(go(s=>s instanceof Wc),l1(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(s,a){let i=[];for(let f of a){f.providers&&!f._injector&&(f._injector=bx(f.providers,s,`Route: ${f.path}`));let v=f._injector??s,x=f._loadedInjector??v;(f.loadChildren&&!f._loadedRoutes&&f.canLoad===void 0||f.loadComponent&&!f._loadedComponent)&&i.push(this.preloadConfig(v,f)),(f.children||f._loadedRoutes)&&i.push(this.processRoutes(x,f.children??f._loadedRoutes))}return il(i).pipe(gx())}preloadConfig(s,a){return this.preloadingStrategy.preload(a,()=>{let i;a.loadChildren&&a.canLoad===void 0?i=this.loader.loadChildren(s,a):i=Xn(null);let f=i.pipe(nl(v=>v===null?Xn(void 0):(a._loadedRoutes=v.routes,a._loadedInjector=v.injector,this.processRoutes(v.injector??s,v.routes))));if(a.loadComponent&&!a._loadedComponent){let v=this.loader.loadComponent(a);return il([f,v]).pipe(gx())}else return f})}};e.\u0275fac=function(a){return new(a||e)(Sr(I0),Sr(M5),Sr(I2),Sr(t3),Sr(l8))},e.\u0275prov=jr({token:e,factory:e.\u0275fac,providedIn:"root"});let o=e;return o})(),XA=new Sn(""),EB=(()=>{let e=class e{constructor(s,a,i,f,v={}){this.urlSerializer=s,this.transitions=a,this.viewportScroller=i,this.zone=f,this.options=v,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},v.scrollPositionRestoration||="disabled",v.anchorScrolling||="disabled"}init(){this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(s=>{s instanceof b1?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=s.navigationTrigger,this.restoredId=s.restoredState?s.restoredState.navigationId:0):s instanceof Wc?(this.lastId=s.id,this.scheduleScrollEvent(s,this.urlSerializer.parse(s.urlAfterRedirects).fragment)):s instanceof Xh&&s.code===X5.IgnoredSameUrlNavigation&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(s,this.urlSerializer.parse(s.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(s=>{s instanceof $5&&(s.position?this.options.scrollPositionRestoration==="top"?this.viewportScroller.scrollToPosition([0,0]):this.options.scrollPositionRestoration==="enabled"&&this.viewportScroller.scrollToPosition(s.position):s.anchor&&this.options.anchorScrolling==="enabled"?this.viewportScroller.scrollToAnchor(s.anchor):this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(s,a){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new $5(s,this.lastSource==="popstate"?this.store[this.restoredId]:null,a))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}};e.\u0275fac=function(a){b5()},e.\u0275prov=jr({token:e,factory:e.\u0275fac});let o=e;return o})();function ZA(o,...e){return y5([{provide:tg,multi:!0,useValue:o},[],{provide:Zh,useFactory:$A,deps:[I0]},{provide:Sx,multi:!0,useFactory:YA},e.map(t=>t.\u0275providers)])}function $A(o){return o.routerState.root}function lg(o,e){return{\u0275kind:o,\u0275providers:e}}function YA(){let o=ai(Jo);return e=>{let t=o.get(Tx);if(e!==t.components[0])return;let s=o.get(I0),a=o.get(JA);o.get(d8)===1&&s.initialNavigation(),o.get(KA,null,vx.Optional)?.setUpPreloading(),o.get(XA,null,vx.Optional)?.init(),s.resetRootComponentType(t.componentTypes[0]),a.closed||(a.next(),a.complete(),a.unsubscribe())}}var JA=new Sn("",{factory:()=>new fn}),d8=new Sn("",{providedIn:"root",factory:()=>1});function AB(){return lg(2,[{provide:d8,useValue:0},{provide:wx,multi:!0,deps:[Jo],useFactory:e=>{let t=e.get(RE,Promise.resolve());return()=>t.then(()=>new Promise(s=>{let a=e.get(I0),i=e.get(JA);WA(a,()=>{s(!0)}),e.get(h8).afterPreactivation=()=>(s(!0),i.closed?Xn(void 0):i),a.initialNavigation()}))}}])}function CB(){return lg(3,[{provide:wx,multi:!0,useFactory:()=>{let e=ai(I0);return()=>{e.setUpLocationChangeListener()}}},{provide:d8,useValue:2}])}var KA=new Sn("");function IB(o){return lg(0,[{provide:KA,useExisting:MB},{provide:t3,useExisting:o}])}function PB(){return lg(8,[dA,{provide:i3,useExisting:dA}])}function RB(o){let e=[{provide:GA,useValue:fB},{provide:HA,useValue:Ti({skipNextTransition:!!o?.skipInitialTransition},o)}];return lg(9,e)}var pA=new Sn("ROUTER_FORROOT_GUARD"),kB=[Su,{provide:ng,useClass:X2},I0,rg,{provide:Zh,useFactory:$A,deps:[I0]},l8,[]],QA=(()=>{let e=class e{constructor(s){}static forRoot(s,a){return{ngModule:e,providers:[kB,[],{provide:tg,multi:!0,useValue:s},{provide:pA,useFactory:OB,deps:[[I0,new uE,new pE]]},{provide:ag,useValue:a||{}},a?.useHash?LB():FB(),DB(),a?.preloadingStrategy?IB(a.preloadingStrategy).\u0275providers:[],a?.initialNavigation?NB(a):[],a?.bindToComponentInputs?PB().\u0275providers:[],a?.enableViewTransitions?RB().\u0275providers:[],zB()]}}static forChild(s){return{ngModule:e,providers:[{provide:tg,multi:!0,useValue:s}]}}};e.\u0275fac=function(a){return new(a||e)(Sr(pA,8))},e.\u0275mod=ds({type:e}),e.\u0275inj=hs({});let o=e;return o})();function DB(){return{provide:XA,useFactory:()=>{let o=ai(LE),e=ai(Ur),t=ai(ag),s=ai(h8),a=ai(ng);return t.scrollOffset&&o.setOffset(t.scrollOffset),new EB(a,s,o,e,t)}}}function LB(){return{provide:O2,useClass:DE}}function FB(){return{provide:O2,useClass:kE}}function OB(o){return"guarded"}function NB(o){return[o.initialNavigation==="disabled"?CB().\u0275providers:[],o.initialNavigation==="enabledBlocking"?AB().\u0275providers:[]]}var fA=new Sn("");function zB(){return[{provide:fA,useFactory:YA},{provide:Sx,multi:!0,useExisting:fA}]}var eC=[];var UB="@",VB=(()=>{let e=class e{constructor(s,a,i,f,v){this.doc=s,this.delegate=a,this.zone=i,this.animationType=f,this.moduleImpl=v,this._rendererFactoryPromise=null,this.scheduler=ai(_E,{optional:!0})}ngOnDestroy(){this._engine?.flush()}loadImpl(){return(this.moduleImpl??import("./chunk-5HQRUXUL.js")).catch(a=>{throw new zo(5300,!1)}).then(({\u0275createEngine:a,\u0275AnimationRendererFactory:i})=>{this._engine=a(this.animationType,this.doc,this.scheduler);let f=new i(this.delegate,this._engine,this.zone);return this.delegate=f,f})}createRenderer(s,a){let i=this.delegate.createRenderer(s,a);if(i.\u0275type===0)return i;typeof i.throwOnSyntheticProps=="boolean"&&(i.throwOnSyntheticProps=!1);let f=new u8(i);return a?.data?.animation&&!this._rendererFactoryPromise&&(this._rendererFactoryPromise=this.loadImpl()),this._rendererFactoryPromise?.then(v=>{let x=v.createRenderer(s,a);f.use(x)}).catch(v=>{f.use(i)}),f}begin(){this.delegate.begin?.()}end(){this.delegate.end?.()}whenRenderingDone(){return this.delegate.whenRenderingDone?.()??Promise.resolve()}};e.\u0275fac=function(a){b5()},e.\u0275prov=jr({token:e,factory:e.\u0275fac});let o=e;return o})(),u8=class{constructor(e){this.delegate=e,this.replay=[],this.\u0275type=1}use(e){if(this.delegate=e,this.replay!==null){for(let t of this.replay)t(e);this.replay=null}}get data(){return this.delegate.data}destroy(){this.replay=null,this.delegate.destroy()}createElement(e,t){return this.delegate.createElement(e,t)}createComment(e){return this.delegate.createComment(e)}createText(e){return this.delegate.createText(e)}get destroyNode(){return this.delegate.destroyNode}appendChild(e,t){this.delegate.appendChild(e,t)}insertBefore(e,t,s,a){this.delegate.insertBefore(e,t,s,a)}removeChild(e,t,s){this.delegate.removeChild(e,t,s)}selectRootElement(e,t){return this.delegate.selectRootElement(e,t)}parentNode(e){return this.delegate.parentNode(e)}nextSibling(e){return this.delegate.nextSibling(e)}setAttribute(e,t,s,a){this.delegate.setAttribute(e,t,s,a)}removeAttribute(e,t,s){this.delegate.removeAttribute(e,t,s)}addClass(e,t){this.delegate.addClass(e,t)}removeClass(e,t){this.delegate.removeClass(e,t)}setStyle(e,t,s,a){this.delegate.setStyle(e,t,s,a)}removeStyle(e,t,s){this.delegate.removeStyle(e,t,s)}setProperty(e,t,s){this.shouldReplay(t)&&this.replay.push(a=>a.setProperty(e,t,s)),this.delegate.setProperty(e,t,s)}setValue(e,t){this.delegate.setValue(e,t)}listen(e,t,s){return this.shouldReplay(t)&&this.replay.push(a=>a.listen(e,t,s)),this.delegate.listen(e,t,s)}shouldReplay(e){return this.replay!==null&&e.startsWith(UB)}};function tC(o="animations"){return y5([{provide:v5,useFactory:(e,t,s)=>new VB(e,t,s,o),deps:[eo,FE,Ur]},{provide:yo,useValue:o==="noop"?"NoopAnimations":"BrowserAnimations"}])}var iC={providers:[ZA(eC),tC()]};var GB=["*"];var HB=[[["","mat-card-avatar",""],["","matCardAvatar",""]],[["mat-card-title"],["mat-card-subtitle"],["","mat-card-title",""],["","mat-card-subtitle",""],["","matCardTitle",""],["","matCardSubtitle",""]],"*"],jB=["[mat-card-avatar], [matCardAvatar]",`mat-card-title, mat-card-subtitle,
      [mat-card-title], [mat-card-subtitle],
      [matCardTitle], [matCardSubtitle]`,"*"],WB=new Sn("MAT_CARD_CONFIG"),T1=(()=>{let e=class e{constructor(s){this.appearance=s?.appearance||"raised"}};e.\u0275fac=function(a){return new(a||e)(Et(WB,8))},e.\u0275cmp=$i({type:e,selectors:[["mat-card"]],hostAttrs:[1,"mat-mdc-card","mdc-card"],hostVars:4,hostBindings:function(a,i){a&2&&Fr("mat-mdc-card-outlined",i.appearance==="outlined")("mdc-card--outlined",i.appearance==="outlined")},inputs:{appearance:"appearance"},exportAs:["matCard"],standalone:!0,features:[Yi],ngContentSelectors:GB,decls:1,vars:0,template:function(a,i){a&1&&(ks(),Pr(0))},styles:['.mdc-card{display:flex;flex-direction:column;box-sizing:border-box}.mdc-card::after{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:1px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none;pointer-events:none}@media screen and (forced-colors: active){.mdc-card::after{border-color:CanvasText}}.mdc-card--outlined::after{border:none}.mdc-card__content{border-radius:inherit;height:100%}.mdc-card__media{position:relative;box-sizing:border-box;background-repeat:no-repeat;background-position:center;background-size:cover}.mdc-card__media::before{display:block;content:""}.mdc-card__media:first-child{border-top-left-radius:inherit;border-top-right-radius:inherit}.mdc-card__media:last-child{border-bottom-left-radius:inherit;border-bottom-right-radius:inherit}.mdc-card__media--square::before{margin-top:100%}.mdc-card__media--16-9::before{margin-top:56.25%}.mdc-card__media-content{position:absolute;top:0;right:0;bottom:0;left:0;box-sizing:border-box}.mdc-card__primary-action{display:flex;flex-direction:column;box-sizing:border-box;position:relative;outline:none;color:inherit;text-decoration:none;cursor:pointer;overflow:hidden}.mdc-card__primary-action:first-child{border-top-left-radius:inherit;border-top-right-radius:inherit}.mdc-card__primary-action:last-child{border-bottom-left-radius:inherit;border-bottom-right-radius:inherit}.mdc-card__actions{display:flex;flex-direction:row;align-items:center;box-sizing:border-box;min-height:52px;padding:8px}.mdc-card__actions--full-bleed{padding:0}.mdc-card__action-buttons,.mdc-card__action-icons{display:flex;flex-direction:row;align-items:center;box-sizing:border-box}.mdc-card__action-icons{color:rgba(0, 0, 0, 0.6);flex-grow:1;justify-content:flex-end}.mdc-card__action-buttons+.mdc-card__action-icons{margin-left:16px;margin-right:0}[dir=rtl] .mdc-card__action-buttons+.mdc-card__action-icons,.mdc-card__action-buttons+.mdc-card__action-icons[dir=rtl]{margin-left:0;margin-right:16px}.mdc-card__action{display:inline-flex;flex-direction:row;align-items:center;box-sizing:border-box;justify-content:center;cursor:pointer;user-select:none}.mdc-card__action:focus{outline:none}.mdc-card__action--button{margin-left:0;margin-right:8px;padding:0 8px}[dir=rtl] .mdc-card__action--button,.mdc-card__action--button[dir=rtl]{margin-left:8px;margin-right:0}.mdc-card__action--button:last-child{margin-left:0;margin-right:0}[dir=rtl] .mdc-card__action--button:last-child,.mdc-card__action--button:last-child[dir=rtl]{margin-left:0;margin-right:0}.mdc-card__actions--full-bleed .mdc-card__action--button{justify-content:space-between;width:100%;height:auto;max-height:none;margin:0;padding:8px 16px;text-align:left}[dir=rtl] .mdc-card__actions--full-bleed .mdc-card__action--button,.mdc-card__actions--full-bleed .mdc-card__action--button[dir=rtl]{text-align:right}.mdc-card__action--icon{margin:-6px 0;padding:12px}.mdc-card__action--icon:not(:disabled){color:rgba(0, 0, 0, 0.6)}.mat-mdc-card{border-radius:var(--mdc-elevated-card-container-shape);background-color:var(--mdc-elevated-card-container-color);border-width:0;border-style:solid;border-color:var(--mdc-elevated-card-container-color);box-shadow:var(--mdc-elevated-card-container-elevation)}.mat-mdc-card .mdc-card::after{border-radius:var(--mdc-elevated-card-container-shape)}.mat-mdc-card-outlined{border-width:var(--mdc-outlined-card-outline-width);border-style:solid;border-color:var(--mdc-outlined-card-outline-color);border-radius:var(--mdc-outlined-card-container-shape);background-color:var(--mdc-outlined-card-container-color);box-shadow:var(--mdc-outlined-card-container-elevation)}.mat-mdc-card-outlined .mdc-card::after{border-radius:var(--mdc-outlined-card-container-shape)}.mat-mdc-card-title{font-family:var(--mat-card-title-text-font);line-height:var(--mat-card-title-text-line-height);font-size:var(--mat-card-title-text-size);letter-spacing:var(--mat-card-title-text-tracking);font-weight:var(--mat-card-title-text-weight)}.mat-mdc-card-subtitle{color:var(--mat-card-subtitle-text-color);font-family:var(--mat-card-subtitle-text-font);line-height:var(--mat-card-subtitle-text-line-height);font-size:var(--mat-card-subtitle-text-size);letter-spacing:var(--mat-card-subtitle-text-tracking);font-weight:var(--mat-card-subtitle-text-weight)}.mat-mdc-card{position:relative}.mat-mdc-card-title,.mat-mdc-card-subtitle{display:block;margin:0}.mat-mdc-card-avatar~.mat-mdc-card-header-text .mat-mdc-card-title,.mat-mdc-card-avatar~.mat-mdc-card-header-text .mat-mdc-card-subtitle{padding:16px 16px 0}.mat-mdc-card-header{display:flex;padding:16px 16px 0}.mat-mdc-card-content{display:block;padding:0 16px}.mat-mdc-card-content:first-child{padding-top:16px}.mat-mdc-card-content:last-child{padding-bottom:16px}.mat-mdc-card-title-group{display:flex;justify-content:space-between;width:100%}.mat-mdc-card-avatar{height:40px;width:40px;border-radius:50%;flex-shrink:0;margin-bottom:16px;object-fit:cover}.mat-mdc-card-avatar~.mat-mdc-card-header-text .mat-mdc-card-subtitle,.mat-mdc-card-avatar~.mat-mdc-card-header-text .mat-mdc-card-title{line-height:normal}.mat-mdc-card-sm-image{width:80px;height:80px}.mat-mdc-card-md-image{width:112px;height:112px}.mat-mdc-card-lg-image{width:152px;height:152px}.mat-mdc-card-xl-image{width:240px;height:240px}.mat-mdc-card-subtitle~.mat-mdc-card-title,.mat-mdc-card-title~.mat-mdc-card-subtitle,.mat-mdc-card-header .mat-mdc-card-header-text .mat-mdc-card-title,.mat-mdc-card-header .mat-mdc-card-header-text .mat-mdc-card-subtitle,.mat-mdc-card-title-group .mat-mdc-card-title,.mat-mdc-card-title-group .mat-mdc-card-subtitle{padding-top:0}.mat-mdc-card-content>:last-child:not(.mat-mdc-card-footer){margin-bottom:0}.mat-mdc-card-actions-align-end{justify-content:flex-end}'],encapsulation:2,changeDetection:0});let o=e;return o})();var nC=(()=>{let e=class e{};e.\u0275fac=function(a){return new(a||e)},e.\u0275dir=lr({type:e,selectors:[["mat-card-content"]],hostAttrs:[1,"mat-mdc-card-content"],standalone:!0});let o=e;return o})();var rC=(()=>{let e=class e{};e.\u0275fac=function(a){return new(a||e)},e.\u0275cmp=$i({type:e,selectors:[["mat-card-header"]],hostAttrs:[1,"mat-mdc-card-header"],standalone:!0,features:[Yi],ngContentSelectors:jB,decls:4,vars:0,consts:[[1,"mat-mdc-card-header-text"]],template:function(a,i){a&1&&(ks(HB),Pr(0),xt(1,"div",0),Pr(2,1),It(),Pr(3,2))},encapsulation:2,changeDetection:0});let o=e;return o})();var M1=(()=>{let e=class e{};e.\u0275fac=function(a){return new(a||e)},e.\u0275mod=ds({type:e}),e.\u0275inj=hs({imports:[Ss,_r,Ss]});let o=e;return o})();function qB(o,e){if(o&1&&(xt(0,"span"),Bi(1),It()),o&2){let t=di();Ct(),Or(t.title)}}function XB(o,e){o&1&&(xt(0,"div",6),Bi(1,"\xA0"),It())}function ZB(o,e){if(o&1&&(xt(0,"mat-option",8),Bi(1),It()),o&2){let t=e.$implicit;si("value",t),Ct(),Or(t.name)}}function $B(o,e){if(o&1){let t=vr();xt(0,"mat-select",7),zi("ngModelChange",function(a){Pn(t);let i=di();return Rn(i.currentProject=a)})("selectionChange",function(){Pn(t);let a=di();return Rn(a.projectSelectionChanged.emit(a.currentProject))}),Js(1,ZB,2,2,"mat-option",8,P2),It()}if(o&2){let t=di();si("ngModel",t.currentProject),Ct(),Ks(t.projects)}}var sC=(()=>{let e=class e{constructor(){this.logo="./assets/logo.svg",this.title="",this.homePath="/home",this.projectSelectionChanged=new mn,this.showProjectSelect=!1}ngOnChanges(){this.currentProject!==void 0?this.showProjectSelect=!0:this.showProjectSelect=!1}};e.\u0275fac=function(a){return new(a||e)},e.\u0275cmp=$i({type:e,selectors:[["lib-ng-left-toolbar"]],inputs:{logo:"logo",title:"title",homePath:"homePath",projects:"projects",currentProject:"currentProject"},outputs:{projectSelectionChanged:"projectSelectionChanged"},standalone:!0,features:[Ms,Yi],decls:6,vars:5,consts:[[1,"card"],[1,"logo",3,"routerLink"],["alt","logo",3,"src"],[4,"ngIf"],["class","vl",4,"ngIf"],["name","space-select","id","space-select",3,"ngModel","ngModelChange","selectionChange",4,"ngIf"],[1,"vl"],["name","space-select","id","space-select",3,"ngModel","ngModelChange","selectionChange"],[3,"value"]],template:function(a,i){a&1&&(xt(0,"mat-card",0)(1,"div",1),Ln(2,"img",2),ln(3,qB,2,1,"span",3),It(),ln(4,XB,2,0,"div",4)(5,$B,3,1,"mat-select",5),It()),a&2&&(Ct(),si("routerLink",i.homePath),Ct(),si("src",i.logo,mE),Ct(),si("ngIf",i.title),Ct(),si("ngIf",(i.projects==null?null:i.projects.length)&&i.showProjectSelect),Ct(),si("ngIf",(i.projects==null?null:i.projects.length)&&i.showProjectSelect))},dependencies:[_r,Ds,QA,qA,M1,T1,Gh,Vh,zh,Oh,Lh,Fh],styles:[".card[_ngcontent-%COMP%]{padding:10px;height:100%;display:flex;flex-direction:row;justify-content:flex-start;align-items:center;gap:10px}.logo[_ngcontent-%COMP%]{height:100%;cursor:pointer;display:flex;flex-direction:row;align-items:center;gap:10px}.logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:100%}.vl[_ngcontent-%COMP%]{border-left-width:1px;border-left-style:solid;border-left-color:#eee;height:100%}mat-select[_ngcontent-%COMP%]{min-width:100px}  .mat-mdc-select-value{padding-right:10px}mat-card[_ngcontent-%COMP%]{z-index:10}"]});let o=e;return o})();var oC={transformMenu:Uc("transformMenu",[da("void",to({opacity:0,transform:"scale(0.8)"})),La("void => enter",Da("120ms cubic-bezier(0, 0, 0.2, 1)",to({opacity:1,transform:"scale(1)"}))),La("* => void",Da("100ms 25ms linear",to({opacity:0})))]),fadeInItems:Uc("fadeInItems",[da("showing",to({opacity:1})),La("void => *",[to({opacity:0}),Da("400ms 100ms cubic-bezier(0.55, 0, 0.55, 0.2)")])])},Sie=oC.fadeInItems,Tie=oC.transformMenu;var YB=new Sn("mat-menu-scroll-strategy",{providedIn:"root",factory:()=>{let o=ai(sl);return()=>o.scrollStrategies.reposition()}});function JB(o){return()=>o.scrollStrategies.reposition()}var KB={provide:YB,deps:[sl],useFactory:JB};var aC=(()=>{let e=class e{};e.\u0275fac=function(a){return new(a||e)},e.\u0275mod=ds({type:e}),e.\u0275inj=hs({providers:[KB],imports:[_r,u1,Ss,Uh,L5,Ss]});let o=e;return o})();var lC=(()=>{let e=class e{constructor(){this._vertical=!1,this._inset=!1}get vertical(){return this._vertical}set vertical(s){this._vertical=A0(s)}get inset(){return this._inset}set inset(s){this._inset=A0(s)}};e.\u0275fac=function(a){return new(a||e)},e.\u0275cmp=$i({type:e,selectors:[["mat-divider"]],hostAttrs:["role","separator",1,"mat-divider"],hostVars:7,hostBindings:function(a,i){a&2&&(vs("aria-orientation",i.vertical?"vertical":"horizontal"),Fr("mat-divider-vertical",i.vertical)("mat-divider-horizontal",!i.vertical)("mat-divider-inset",i.inset))},inputs:{vertical:"vertical",inset:"inset"},standalone:!0,features:[Yi],decls:0,vars:0,template:function(a,i){},styles:[".mat-divider{display:block;margin:0;border-top-style:solid;border-top-color:var(--mat-divider-color);border-top-width:var(--mat-divider-width)}.mat-divider.mat-divider-vertical{border-top:0;border-right-style:solid;border-right-color:var(--mat-divider-color);border-right-width:var(--mat-divider-width)}.mat-divider.mat-divider-inset{margin-left:80px}[dir=rtl] .mat-divider.mat-divider-inset{margin-left:auto;margin-right:80px}"],encapsulation:2,changeDetection:0});let o=e;return o})(),cC=(()=>{let e=class e{};e.\u0275fac=function(a){return new(a||e)},e.\u0275mod=ds({type:e}),e.\u0275inj=hs({imports:[Ss,Ss]});let o=e;return o})();var eU=["*"],tU='@media screen and (forced-colors: active),(-ms-high-contrast: active){.mdc-list-divider::after{content:"";display:block;border-bottom-width:1px;border-bottom-style:solid}}.mdc-list{margin:0;padding:8px 0;list-style-type:none}.mdc-list:focus{outline:none}.mdc-list-item__wrapper{display:block}.mdc-list-item{display:flex;position:relative;align-items:center;justify-content:flex-start;overflow:hidden;padding:0;align-items:stretch;cursor:pointer}.mdc-list-item:focus{outline:none}.mdc-list-item.mdc-list-item--with-one-line{height:48px}.mdc-list-item.mdc-list-item--with-two-lines{height:64px}.mdc-list-item.mdc-list-item--with-three-lines{height:88px}.mdc-list-item.mdc-list-item--with-one-line .mdc-list-item__start{align-self:center;margin-top:0}.mdc-list-item.mdc-list-item--with-two-lines .mdc-list-item__start{align-self:flex-start;margin-top:16px}.mdc-list-item.mdc-list-item--with-three-lines .mdc-list-item__start{align-self:flex-start;margin-top:16px}.mdc-list-item.mdc-list-item--with-one-line .mdc-list-item__end{align-self:center;margin-top:0}.mdc-list-item.mdc-list-item--with-two-lines .mdc-list-item__end{align-self:center;margin-top:0}.mdc-list-item.mdc-list-item--with-three-lines .mdc-list-item__end{align-self:flex-start;margin-top:16px}.mdc-list-item.mdc-list-item--disabled,.mdc-list-item.mdc-list-item--non-interactive{cursor:auto}.mdc-list-item:not(.mdc-list-item--selected):focus::before,.mdc-list-item.mdc-ripple-upgraded--background-focused::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:1px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}@media screen and (forced-colors: active){.mdc-list-item:not(.mdc-list-item--selected):focus::before,.mdc-list-item.mdc-ripple-upgraded--background-focused::before{border-color:CanvasText}}.mdc-list-item.mdc-list-item--selected::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:3px double rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}@media screen and (forced-colors: active){.mdc-list-item.mdc-list-item--selected::before{border-color:CanvasText}}.mdc-list-item.mdc-list-item--selected:focus::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:3px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}@media screen and (forced-colors: active){.mdc-list-item.mdc-list-item--selected:focus::before{border-color:CanvasText}}a.mdc-list-item{color:inherit;text-decoration:none}.mdc-list-item__start{fill:currentColor;flex-shrink:0;pointer-events:none}.mdc-list-item__end{flex-shrink:0;pointer-events:none}.mdc-list-item__content{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;align-self:center;flex:1;pointer-events:none}.mdc-list-item--with-two-lines .mdc-list-item__content,.mdc-list-item--with-three-lines .mdc-list-item__content{align-self:stretch}.mdc-list-item__content[for]{pointer-events:none}.mdc-list-item__primary-text{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.mdc-list-item--with-two-lines .mdc-list-item__primary-text,.mdc-list-item--with-three-lines .mdc-list-item__primary-text{display:block;margin-top:0;line-height:normal;margin-bottom:-20px}.mdc-list-item--with-two-lines .mdc-list-item__primary-text::before,.mdc-list-item--with-three-lines .mdc-list-item__primary-text::before{display:inline-block;width:0;height:28px;content:"";vertical-align:0}.mdc-list-item--with-two-lines .mdc-list-item__primary-text::after,.mdc-list-item--with-three-lines .mdc-list-item__primary-text::after{display:inline-block;width:0;height:20px;content:"";vertical-align:-20px}.mdc-list-item__secondary-text{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;display:block;margin-top:0;line-height:normal}.mdc-list-item__secondary-text::before{display:inline-block;width:0;height:20px;content:"";vertical-align:0}.mdc-list-item--with-three-lines .mdc-list-item__secondary-text{white-space:normal;line-height:20px}.mdc-list-item--with-overline .mdc-list-item__secondary-text{white-space:nowrap;line-height:auto}.mdc-list-item__overline-text{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.mdc-list-item--with-two-lines .mdc-list-item__overline-text{display:block;margin-top:0;line-height:normal;margin-bottom:-20px}.mdc-list-item--with-two-lines .mdc-list-item__overline-text::before{display:inline-block;width:0;height:24px;content:"";vertical-align:0}.mdc-list-item--with-two-lines .mdc-list-item__overline-text::after{display:inline-block;width:0;height:20px;content:"";vertical-align:-20px}.mdc-list-item--with-three-lines .mdc-list-item__overline-text{display:block;margin-top:0;line-height:normal;margin-bottom:-20px}.mdc-list-item--with-three-lines .mdc-list-item__overline-text::before{display:inline-block;width:0;height:28px;content:"";vertical-align:0}.mdc-list-item--with-three-lines .mdc-list-item__overline-text::after{display:inline-block;width:0;height:20px;content:"";vertical-align:-20px}.mdc-list-item--with-leading-avatar.mdc-list-item{padding-left:0;padding-right:auto}[dir=rtl] .mdc-list-item--with-leading-avatar.mdc-list-item,.mdc-list-item--with-leading-avatar.mdc-list-item[dir=rtl]{padding-left:auto;padding-right:0}.mdc-list-item--with-leading-avatar .mdc-list-item__start{margin-left:16px;margin-right:16px}[dir=rtl] .mdc-list-item--with-leading-avatar .mdc-list-item__start,.mdc-list-item--with-leading-avatar .mdc-list-item__start[dir=rtl]{margin-left:16px;margin-right:16px}.mdc-list-item--with-leading-avatar.mdc-list-item--with-two-lines .mdc-list-item__primary-text{display:block;margin-top:0;line-height:normal;margin-bottom:-20px}.mdc-list-item--with-leading-avatar.mdc-list-item--with-two-lines .mdc-list-item__primary-text::before{display:inline-block;width:0;height:32px;content:"";vertical-align:0}.mdc-list-item--with-leading-avatar.mdc-list-item--with-two-lines .mdc-list-item__primary-text::after{display:inline-block;width:0;height:20px;content:"";vertical-align:-20px}.mdc-list-item--with-leading-avatar.mdc-list-item--with-two-lines .mdc-list-item__overline-text{display:block;margin-top:0;line-height:normal;margin-bottom:-20px}.mdc-list-item--with-leading-avatar.mdc-list-item--with-two-lines .mdc-list-item__overline-text::before{display:inline-block;width:0;height:28px;content:"";vertical-align:0}.mdc-list-item--with-leading-avatar.mdc-list-item--with-two-lines .mdc-list-item__overline-text::after{display:inline-block;width:0;height:20px;content:"";vertical-align:-20px}.mdc-list-item--with-leading-avatar.mdc-list-item--with-two-lines.mdc-list-item--with-trailing-meta .mdc-list-item__end{display:block;margin-top:0;line-height:normal}.mdc-list-item--with-leading-avatar.mdc-list-item--with-two-lines.mdc-list-item--with-trailing-meta .mdc-list-item__end::before{display:inline-block;width:0;height:32px;content:"";vertical-align:0}.mdc-list-item--with-leading-avatar.mdc-list-item--with-one-line{height:56px}.mdc-list-item--with-leading-avatar.mdc-list-item--with-two-lines{height:72px}.mdc-list-item--with-leading-avatar .mdc-list-item__start{border-radius:50%}.mdc-list-item--with-leading-icon.mdc-list-item{padding-left:0;padding-right:auto}[dir=rtl] .mdc-list-item--with-leading-icon.mdc-list-item,.mdc-list-item--with-leading-icon.mdc-list-item[dir=rtl]{padding-left:auto;padding-right:0}.mdc-list-item--with-leading-icon .mdc-list-item__start{margin-left:16px;margin-right:32px}[dir=rtl] .mdc-list-item--with-leading-icon .mdc-list-item__start,.mdc-list-item--with-leading-icon .mdc-list-item__start[dir=rtl]{margin-left:32px;margin-right:16px}.mdc-list-item--with-leading-icon.mdc-list-item--with-two-lines .mdc-list-item__primary-text{display:block;margin-top:0;line-height:normal;margin-bottom:-20px}.mdc-list-item--with-leading-icon.mdc-list-item--with-two-lines .mdc-list-item__primary-text::before{display:inline-block;width:0;height:32px;content:"";vertical-align:0}.mdc-list-item--with-leading-icon.mdc-list-item--with-two-lines .mdc-list-item__primary-text::after{display:inline-block;width:0;height:20px;content:"";vertical-align:-20px}.mdc-list-item--with-leading-icon.mdc-list-item--with-two-lines .mdc-list-item__overline-text{display:block;margin-top:0;line-height:normal;margin-bottom:-20px}.mdc-list-item--with-leading-icon.mdc-list-item--with-two-lines .mdc-list-item__overline-text::before{display:inline-block;width:0;height:28px;content:"";vertical-align:0}.mdc-list-item--with-leading-icon.mdc-list-item--with-two-lines .mdc-list-item__overline-text::after{display:inline-block;width:0;height:20px;content:"";vertical-align:-20px}.mdc-list-item--with-leading-icon.mdc-list-item--with-two-lines.mdc-list-item--with-trailing-meta .mdc-list-item__end{display:block;margin-top:0;line-height:normal}.mdc-list-item--with-leading-icon.mdc-list-item--with-two-lines.mdc-list-item--with-trailing-meta .mdc-list-item__end::before{display:inline-block;width:0;height:32px;content:"";vertical-align:0}.mdc-list-item--with-leading-icon.mdc-list-item--with-one-line{height:56px}.mdc-list-item--with-leading-icon.mdc-list-item--with-two-lines{height:72px}.mdc-list-item--with-leading-thumbnail.mdc-list-item{padding-left:0;padding-right:auto}[dir=rtl] .mdc-list-item--with-leading-thumbnail.mdc-list-item,.mdc-list-item--with-leading-thumbnail.mdc-list-item[dir=rtl]{padding-left:auto;padding-right:0}.mdc-list-item--with-leading-thumbnail .mdc-list-item__start{margin-left:16px;margin-right:16px}[dir=rtl] .mdc-list-item--with-leading-thumbnail .mdc-list-item__start,.mdc-list-item--with-leading-thumbnail .mdc-list-item__start[dir=rtl]{margin-left:16px;margin-right:16px}.mdc-list-item--with-leading-thumbnail.mdc-list-item--with-two-lines .mdc-list-item__primary-text{display:block;margin-top:0;line-height:normal;margin-bottom:-20px}.mdc-list-item--with-leading-thumbnail.mdc-list-item--with-two-lines .mdc-list-item__primary-text::before{display:inline-block;width:0;height:32px;content:"";vertical-align:0}.mdc-list-item--with-leading-thumbnail.mdc-list-item--with-two-lines .mdc-list-item__primary-text::after{display:inline-block;width:0;height:20px;content:"";vertical-align:-20px}.mdc-list-item--with-leading-thumbnail.mdc-list-item--with-two-lines .mdc-list-item__overline-text{display:block;margin-top:0;line-height:normal;margin-bottom:-20px}.mdc-list-item--with-leading-thumbnail.mdc-list-item--with-two-lines .mdc-list-item__overline-text::before{display:inline-block;width:0;height:28px;content:"";vertical-align:0}.mdc-list-item--with-leading-thumbnail.mdc-list-item--with-two-lines .mdc-list-item__overline-text::after{display:inline-block;width:0;height:20px;content:"";vertical-align:-20px}.mdc-list-item--with-leading-thumbnail.mdc-list-item--with-two-lines.mdc-list-item--with-trailing-meta .mdc-list-item__end{display:block;margin-top:0;line-height:normal}.mdc-list-item--with-leading-thumbnail.mdc-list-item--with-two-lines.mdc-list-item--with-trailing-meta .mdc-list-item__end::before{display:inline-block;width:0;height:32px;content:"";vertical-align:0}.mdc-list-item--with-leading-thumbnail.mdc-list-item--with-one-line{height:56px}.mdc-list-item--with-leading-thumbnail.mdc-list-item--with-two-lines{height:72px}.mdc-list-item--with-leading-image.mdc-list-item{padding-left:0;padding-right:auto}[dir=rtl] .mdc-list-item--with-leading-image.mdc-list-item,.mdc-list-item--with-leading-image.mdc-list-item[dir=rtl]{padding-left:auto;padding-right:0}.mdc-list-item--with-leading-image .mdc-list-item__start{margin-left:16px;margin-right:16px}[dir=rtl] .mdc-list-item--with-leading-image .mdc-list-item__start,.mdc-list-item--with-leading-image .mdc-list-item__start[dir=rtl]{margin-left:16px;margin-right:16px}.mdc-list-item--with-leading-image.mdc-list-item--with-two-lines .mdc-list-item__primary-text{display:block;margin-top:0;line-height:normal;margin-bottom:-20px}.mdc-list-item--with-leading-image.mdc-list-item--with-two-lines .mdc-list-item__primary-text::before{display:inline-block;width:0;height:32px;content:"";vertical-align:0}.mdc-list-item--with-leading-image.mdc-list-item--with-two-lines .mdc-list-item__primary-text::after{display:inline-block;width:0;height:20px;content:"";vertical-align:-20px}.mdc-list-item--with-leading-image.mdc-list-item--with-two-lines .mdc-list-item__overline-text{display:block;margin-top:0;line-height:normal;margin-bottom:-20px}.mdc-list-item--with-leading-image.mdc-list-item--with-two-lines .mdc-list-item__overline-text::before{display:inline-block;width:0;height:28px;content:"";vertical-align:0}.mdc-list-item--with-leading-image.mdc-list-item--with-two-lines .mdc-list-item__overline-text::after{display:inline-block;width:0;height:20px;content:"";vertical-align:-20px}.mdc-list-item--with-leading-image.mdc-list-item--with-two-lines.mdc-list-item--with-trailing-meta .mdc-list-item__end{display:block;margin-top:0;line-height:normal}.mdc-list-item--with-leading-image.mdc-list-item--with-two-lines.mdc-list-item--with-trailing-meta .mdc-list-item__end::before{display:inline-block;width:0;height:32px;content:"";vertical-align:0}.mdc-list-item--with-leading-image.mdc-list-item--with-one-line{height:72px}.mdc-list-item--with-leading-image.mdc-list-item--with-two-lines{height:72px}.mdc-list-item--with-leading-video.mdc-list-item--with-two-lines .mdc-list-item__start{align-self:flex-start;margin-top:8px}.mdc-list-item--with-leading-video.mdc-list-item{padding-left:0;padding-right:auto}[dir=rtl] .mdc-list-item--with-leading-video.mdc-list-item,.mdc-list-item--with-leading-video.mdc-list-item[dir=rtl]{padding-left:auto;padding-right:0}.mdc-list-item--with-leading-video .mdc-list-item__start{margin-left:0;margin-right:16px}[dir=rtl] .mdc-list-item--with-leading-video .mdc-list-item__start,.mdc-list-item--with-leading-video .mdc-list-item__start[dir=rtl]{margin-left:16px;margin-right:0}.mdc-list-item--with-leading-video.mdc-list-item--with-two-lines .mdc-list-item__primary-text{display:block;margin-top:0;line-height:normal;margin-bottom:-20px}.mdc-list-item--with-leading-video.mdc-list-item--with-two-lines .mdc-list-item__primary-text::before{display:inline-block;width:0;height:32px;content:"";vertical-align:0}.mdc-list-item--with-leading-video.mdc-list-item--with-two-lines .mdc-list-item__primary-text::after{display:inline-block;width:0;height:20px;content:"";vertical-align:-20px}.mdc-list-item--with-leading-video.mdc-list-item--with-two-lines .mdc-list-item__overline-text{display:block;margin-top:0;line-height:normal;margin-bottom:-20px}.mdc-list-item--with-leading-video.mdc-list-item--with-two-lines .mdc-list-item__overline-text::before{display:inline-block;width:0;height:28px;content:"";vertical-align:0}.mdc-list-item--with-leading-video.mdc-list-item--with-two-lines .mdc-list-item__overline-text::after{display:inline-block;width:0;height:20px;content:"";vertical-align:-20px}.mdc-list-item--with-leading-video.mdc-list-item--with-two-lines.mdc-list-item--with-trailing-meta .mdc-list-item__end{display:block;margin-top:0;line-height:normal}.mdc-list-item--with-leading-video.mdc-list-item--with-two-lines.mdc-list-item--with-trailing-meta .mdc-list-item__end::before{display:inline-block;width:0;height:32px;content:"";vertical-align:0}.mdc-list-item--with-leading-video.mdc-list-item--with-one-line{height:72px}.mdc-list-item--with-leading-video.mdc-list-item--with-two-lines{height:72px}.mdc-list-item--with-leading-checkbox.mdc-list-item{padding-left:0;padding-right:auto}[dir=rtl] .mdc-list-item--with-leading-checkbox.mdc-list-item,.mdc-list-item--with-leading-checkbox.mdc-list-item[dir=rtl]{padding-left:auto;padding-right:0}.mdc-list-item--with-leading-checkbox .mdc-list-item__start{margin-left:8px;margin-right:24px}[dir=rtl] .mdc-list-item--with-leading-checkbox .mdc-list-item__start,.mdc-list-item--with-leading-checkbox .mdc-list-item__start[dir=rtl]{margin-left:24px;margin-right:8px}.mdc-list-item--with-leading-checkbox.mdc-list-item--with-two-lines .mdc-list-item__start{align-self:flex-start;margin-top:8px}.mdc-list-item--with-leading-checkbox.mdc-list-item--with-two-lines .mdc-list-item__primary-text{display:block;margin-top:0;line-height:normal;margin-bottom:-20px}.mdc-list-item--with-leading-checkbox.mdc-list-item--with-two-lines .mdc-list-item__primary-text::before{display:inline-block;width:0;height:32px;content:"";vertical-align:0}.mdc-list-item--with-leading-checkbox.mdc-list-item--with-two-lines .mdc-list-item__primary-text::after{display:inline-block;width:0;height:20px;content:"";vertical-align:-20px}.mdc-list-item--with-leading-checkbox.mdc-list-item--with-two-lines .mdc-list-item__overline-text{display:block;margin-top:0;line-height:normal;margin-bottom:-20px}.mdc-list-item--with-leading-checkbox.mdc-list-item--with-two-lines .mdc-list-item__overline-text::before{display:inline-block;width:0;height:28px;content:"";vertical-align:0}.mdc-list-item--with-leading-checkbox.mdc-list-item--with-two-lines .mdc-list-item__overline-text::after{display:inline-block;width:0;height:20px;content:"";vertical-align:-20px}.mdc-list-item--with-leading-checkbox.mdc-list-item--with-two-lines.mdc-list-item--with-trailing-meta .mdc-list-item__end{display:block;margin-top:0;line-height:normal}.mdc-list-item--with-leading-checkbox.mdc-list-item--with-two-lines.mdc-list-item--with-trailing-meta .mdc-list-item__end::before{display:inline-block;width:0;height:32px;content:"";vertical-align:0}.mdc-list-item--with-leading-checkbox.mdc-list-item--with-one-line{height:56px}.mdc-list-item--with-leading-checkbox.mdc-list-item--with-two-lines{height:72px}.mdc-list-item--with-leading-radio.mdc-list-item{padding-left:0;padding-right:auto}[dir=rtl] .mdc-list-item--with-leading-radio.mdc-list-item,.mdc-list-item--with-leading-radio.mdc-list-item[dir=rtl]{padding-left:auto;padding-right:0}.mdc-list-item--with-leading-radio .mdc-list-item__start{margin-left:8px;margin-right:24px}[dir=rtl] .mdc-list-item--with-leading-radio .mdc-list-item__start,.mdc-list-item--with-leading-radio .mdc-list-item__start[dir=rtl]{margin-left:24px;margin-right:8px}.mdc-list-item--with-leading-radio.mdc-list-item--with-two-lines .mdc-list-item__start{align-self:flex-start;margin-top:8px}.mdc-list-item--with-leading-radio.mdc-list-item--with-two-lines .mdc-list-item__primary-text{display:block;margin-top:0;line-height:normal;margin-bottom:-20px}.mdc-list-item--with-leading-radio.mdc-list-item--with-two-lines .mdc-list-item__primary-text::before{display:inline-block;width:0;height:32px;content:"";vertical-align:0}.mdc-list-item--with-leading-radio.mdc-list-item--with-two-lines .mdc-list-item__primary-text::after{display:inline-block;width:0;height:20px;content:"";vertical-align:-20px}.mdc-list-item--with-leading-radio.mdc-list-item--with-two-lines .mdc-list-item__overline-text{display:block;margin-top:0;line-height:normal;margin-bottom:-20px}.mdc-list-item--with-leading-radio.mdc-list-item--with-two-lines .mdc-list-item__overline-text::before{display:inline-block;width:0;height:28px;content:"";vertical-align:0}.mdc-list-item--with-leading-radio.mdc-list-item--with-two-lines .mdc-list-item__overline-text::after{display:inline-block;width:0;height:20px;content:"";vertical-align:-20px}.mdc-list-item--with-leading-radio.mdc-list-item--with-two-lines.mdc-list-item--with-trailing-meta .mdc-list-item__end{display:block;margin-top:0;line-height:normal}.mdc-list-item--with-leading-radio.mdc-list-item--with-two-lines.mdc-list-item--with-trailing-meta .mdc-list-item__end::before{display:inline-block;width:0;height:32px;content:"";vertical-align:0}.mdc-list-item--with-leading-radio.mdc-list-item--with-one-line{height:56px}.mdc-list-item--with-leading-radio.mdc-list-item--with-two-lines{height:72px}.mdc-list-item--with-leading-switch.mdc-list-item{padding-left:0;padding-right:auto}[dir=rtl] .mdc-list-item--with-leading-switch.mdc-list-item,.mdc-list-item--with-leading-switch.mdc-list-item[dir=rtl]{padding-left:auto;padding-right:0}.mdc-list-item--with-leading-switch .mdc-list-item__start{margin-left:16px;margin-right:16px}[dir=rtl] .mdc-list-item--with-leading-switch .mdc-list-item__start,.mdc-list-item--with-leading-switch .mdc-list-item__start[dir=rtl]{margin-left:16px;margin-right:16px}.mdc-list-item--with-leading-switch.mdc-list-item--with-two-lines .mdc-list-item__start{align-self:flex-start;margin-top:16px}.mdc-list-item--with-leading-switch.mdc-list-item--with-two-lines .mdc-list-item__primary-text{display:block;margin-top:0;line-height:normal;margin-bottom:-20px}.mdc-list-item--with-leading-switch.mdc-list-item--with-two-lines .mdc-list-item__primary-text::before{display:inline-block;width:0;height:32px;content:"";vertical-align:0}.mdc-list-item--with-leading-switch.mdc-list-item--with-two-lines .mdc-list-item__primary-text::after{display:inline-block;width:0;height:20px;content:"";vertical-align:-20px}.mdc-list-item--with-leading-switch.mdc-list-item--with-two-lines .mdc-list-item__overline-text{display:block;margin-top:0;line-height:normal;margin-bottom:-20px}.mdc-list-item--with-leading-switch.mdc-list-item--with-two-lines .mdc-list-item__overline-text::before{display:inline-block;width:0;height:28px;content:"";vertical-align:0}.mdc-list-item--with-leading-switch.mdc-list-item--with-two-lines .mdc-list-item__overline-text::after{display:inline-block;width:0;height:20px;content:"";vertical-align:-20px}.mdc-list-item--with-leading-switch.mdc-list-item--with-two-lines.mdc-list-item--with-trailing-meta .mdc-list-item__end{display:block;margin-top:0;line-height:normal}.mdc-list-item--with-leading-switch.mdc-list-item--with-two-lines.mdc-list-item--with-trailing-meta .mdc-list-item__end::before{display:inline-block;width:0;height:32px;content:"";vertical-align:0}.mdc-list-item--with-leading-switch.mdc-list-item--with-one-line{height:56px}.mdc-list-item--with-leading-switch.mdc-list-item--with-two-lines{height:72px}.mdc-list-item--with-trailing-icon.mdc-list-item{padding-left:auto;padding-right:0}[dir=rtl] .mdc-list-item--with-trailing-icon.mdc-list-item,.mdc-list-item--with-trailing-icon.mdc-list-item[dir=rtl]{padding-left:0;padding-right:auto}.mdc-list-item--with-trailing-icon .mdc-list-item__end{margin-left:16px;margin-right:16px}[dir=rtl] .mdc-list-item--with-trailing-icon .mdc-list-item__end,.mdc-list-item--with-trailing-icon .mdc-list-item__end[dir=rtl]{margin-left:16px;margin-right:16px}.mdc-list-item--with-trailing-meta.mdc-list-item--with-two-lines .mdc-list-item__end{align-self:flex-start;margin-top:0}.mdc-list-item--with-trailing-meta.mdc-list-item--with-three-lines .mdc-list-item__end{align-self:flex-start;margin-top:0}.mdc-list-item--with-trailing-meta.mdc-list-item{padding-left:auto;padding-right:0}[dir=rtl] .mdc-list-item--with-trailing-meta.mdc-list-item,.mdc-list-item--with-trailing-meta.mdc-list-item[dir=rtl]{padding-left:0;padding-right:auto}.mdc-list-item--with-trailing-meta .mdc-list-item__end{margin-left:28px;margin-right:16px}[dir=rtl] .mdc-list-item--with-trailing-meta .mdc-list-item__end,.mdc-list-item--with-trailing-meta .mdc-list-item__end[dir=rtl]{margin-left:16px;margin-right:28px}.mdc-list-item--with-trailing-meta.mdc-list-item--with-two-lines .mdc-list-item__end{display:block;margin-top:0;line-height:normal}.mdc-list-item--with-trailing-meta.mdc-list-item--with-two-lines .mdc-list-item__end::before{display:inline-block;width:0;height:28px;content:"";vertical-align:0}.mdc-list-item--with-trailing-meta.mdc-list-item--with-three-lines .mdc-list-item__end{display:block;margin-top:0;line-height:normal}.mdc-list-item--with-trailing-meta.mdc-list-item--with-three-lines .mdc-list-item__end::before{display:inline-block;width:0;height:28px;content:"";vertical-align:0}.mdc-list-item--with-trailing-meta .mdc-list-item__end{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:var(--mdc-typography-caption-font-family);font-size:var(--mdc-typography-caption-font-size);line-height:var(--mdc-typography-caption-line-height);font-weight:var(--mdc-typography-caption-font-weight);letter-spacing:var(--mdc-typography-caption-letter-spacing);text-decoration:var(--mdc-typography-caption-text-decoration);text-transform:var(--mdc-typography-caption-text-transform)}.mdc-list-item--with-trailing-checkbox.mdc-list-item{padding-left:auto;padding-right:0}[dir=rtl] .mdc-list-item--with-trailing-checkbox.mdc-list-item,.mdc-list-item--with-trailing-checkbox.mdc-list-item[dir=rtl]{padding-left:0;padding-right:auto}.mdc-list-item--with-trailing-checkbox .mdc-list-item__end{margin-left:24px;margin-right:8px}[dir=rtl] .mdc-list-item--with-trailing-checkbox .mdc-list-item__end,.mdc-list-item--with-trailing-checkbox .mdc-list-item__end[dir=rtl]{margin-left:8px;margin-right:24px}.mdc-list-item--with-trailing-checkbox.mdc-list-item--with-three-lines .mdc-list-item__end{align-self:flex-start;margin-top:8px}.mdc-list-item--with-trailing-radio.mdc-list-item{padding-left:auto;padding-right:0}[dir=rtl] .mdc-list-item--with-trailing-radio.mdc-list-item,.mdc-list-item--with-trailing-radio.mdc-list-item[dir=rtl]{padding-left:0;padding-right:auto}.mdc-list-item--with-trailing-radio .mdc-list-item__end{margin-left:24px;margin-right:8px}[dir=rtl] .mdc-list-item--with-trailing-radio .mdc-list-item__end,.mdc-list-item--with-trailing-radio .mdc-list-item__end[dir=rtl]{margin-left:8px;margin-right:24px}.mdc-list-item--with-trailing-radio.mdc-list-item--with-three-lines .mdc-list-item__end{align-self:flex-start;margin-top:8px}.mdc-list-item--with-trailing-switch.mdc-list-item{padding-left:auto;padding-right:0}[dir=rtl] .mdc-list-item--with-trailing-switch.mdc-list-item,.mdc-list-item--with-trailing-switch.mdc-list-item[dir=rtl]{padding-left:0;padding-right:auto}.mdc-list-item--with-trailing-switch .mdc-list-item__end{margin-left:16px;margin-right:16px}[dir=rtl] .mdc-list-item--with-trailing-switch .mdc-list-item__end,.mdc-list-item--with-trailing-switch .mdc-list-item__end[dir=rtl]{margin-left:16px;margin-right:16px}.mdc-list-item--with-trailing-switch.mdc-list-item--with-three-lines .mdc-list-item__end{align-self:flex-start;margin-top:16px}.mdc-list-item--with-overline.mdc-list-item--with-two-lines .mdc-list-item__primary-text{display:block;margin-top:0;line-height:normal}.mdc-list-item--with-overline.mdc-list-item--with-two-lines .mdc-list-item__primary-text::before{display:inline-block;width:0;height:20px;content:"";vertical-align:0}.mdc-list-item--with-overline.mdc-list-item--with-three-lines .mdc-list-item__primary-text{display:block;margin-top:0;line-height:normal}.mdc-list-item--with-overline.mdc-list-item--with-three-lines .mdc-list-item__primary-text::before{display:inline-block;width:0;height:20px;content:"";vertical-align:0}.mdc-list-item{padding-left:16px;padding-right:16px}[dir=rtl] .mdc-list-item,.mdc-list-item[dir=rtl]{padding-left:16px;padding-right:16px}.mdc-list-group .mdc-deprecated-list{padding:0}.mdc-list-group__subheader{margin:calc((3rem - 1.5rem)/2) 16px}.mdc-list-divider{padding:0;background-clip:content-box}.mdc-list-divider.mdc-list-divider--with-leading-inset,.mdc-list-divider--with-leading-text.mdc-list-divider--with-leading-inset,.mdc-list-divider--with-leading-icon.mdc-list-divider--with-leading-inset,.mdc-list-divider--with-leading-image.mdc-list-divider--with-leading-inset,.mdc-list-divider--with-leading-thumbnail.mdc-list-divider--with-leading-inset,.mdc-list-divider--with-leading-avatar.mdc-list-divider--with-leading-inset,.mdc-list-divider--with-leading-checkbox.mdc-list-divider--with-leading-inset,.mdc-list-divider--with-leading-switch.mdc-list-divider--with-leading-inset,.mdc-list-divider--with-leading-radio.mdc-list-divider--with-leading-inset{padding-left:16px;padding-right:auto}[dir=rtl] .mdc-list-divider.mdc-list-divider--with-leading-inset,[dir=rtl] .mdc-list-divider--with-leading-text.mdc-list-divider--with-leading-inset,[dir=rtl] .mdc-list-divider--with-leading-icon.mdc-list-divider--with-leading-inset,[dir=rtl] .mdc-list-divider--with-leading-image.mdc-list-divider--with-leading-inset,[dir=rtl] .mdc-list-divider--with-leading-thumbnail.mdc-list-divider--with-leading-inset,[dir=rtl] .mdc-list-divider--with-leading-avatar.mdc-list-divider--with-leading-inset,[dir=rtl] .mdc-list-divider--with-leading-checkbox.mdc-list-divider--with-leading-inset,[dir=rtl] .mdc-list-divider--with-leading-switch.mdc-list-divider--with-leading-inset,[dir=rtl] .mdc-list-divider--with-leading-radio.mdc-list-divider--with-leading-inset,.mdc-list-divider.mdc-list-divider--with-leading-inset[dir=rtl],.mdc-list-divider--with-leading-text.mdc-list-divider--with-leading-inset[dir=rtl],.mdc-list-divider--with-leading-icon.mdc-list-divider--with-leading-inset[dir=rtl],.mdc-list-divider--with-leading-image.mdc-list-divider--with-leading-inset[dir=rtl],.mdc-list-divider--with-leading-thumbnail.mdc-list-divider--with-leading-inset[dir=rtl],.mdc-list-divider--with-leading-avatar.mdc-list-divider--with-leading-inset[dir=rtl],.mdc-list-divider--with-leading-checkbox.mdc-list-divider--with-leading-inset[dir=rtl],.mdc-list-divider--with-leading-switch.mdc-list-divider--with-leading-inset[dir=rtl],.mdc-list-divider--with-leading-radio.mdc-list-divider--with-leading-inset[dir=rtl]{padding-left:auto;padding-right:16px}.mdc-list-divider.mdc-list-divider--with-trailing-inset,.mdc-list-divider--with-leading-text.mdc-list-divider--with-trailing-inset,.mdc-list-divider--with-leading-icon.mdc-list-divider--with-trailing-inset,.mdc-list-divider--with-leading-image.mdc-list-divider--with-trailing-inset,.mdc-list-divider--with-leading-thumbnail.mdc-list-divider--with-trailing-inset,.mdc-list-divider--with-leading-avatar.mdc-list-divider--with-trailing-inset,.mdc-list-divider--with-leading-checkbox.mdc-list-divider--with-trailing-inset,.mdc-list-divider--with-leading-switch.mdc-list-divider--with-trailing-inset,.mdc-list-divider--with-leading-radio.mdc-list-divider--with-trailing-inset{padding-left:auto;padding-right:16px}[dir=rtl] .mdc-list-divider.mdc-list-divider--with-trailing-inset,[dir=rtl] .mdc-list-divider--with-leading-text.mdc-list-divider--with-trailing-inset,[dir=rtl] .mdc-list-divider--with-leading-icon.mdc-list-divider--with-trailing-inset,[dir=rtl] .mdc-list-divider--with-leading-image.mdc-list-divider--with-trailing-inset,[dir=rtl] .mdc-list-divider--with-leading-thumbnail.mdc-list-divider--with-trailing-inset,[dir=rtl] .mdc-list-divider--with-leading-avatar.mdc-list-divider--with-trailing-inset,[dir=rtl] .mdc-list-divider--with-leading-checkbox.mdc-list-divider--with-trailing-inset,[dir=rtl] .mdc-list-divider--with-leading-switch.mdc-list-divider--with-trailing-inset,[dir=rtl] .mdc-list-divider--with-leading-radio.mdc-list-divider--with-trailing-inset,.mdc-list-divider.mdc-list-divider--with-trailing-inset[dir=rtl],.mdc-list-divider--with-leading-text.mdc-list-divider--with-trailing-inset[dir=rtl],.mdc-list-divider--with-leading-icon.mdc-list-divider--with-trailing-inset[dir=rtl],.mdc-list-divider--with-leading-image.mdc-list-divider--with-trailing-inset[dir=rtl],.mdc-list-divider--with-leading-thumbnail.mdc-list-divider--with-trailing-inset[dir=rtl],.mdc-list-divider--with-leading-avatar.mdc-list-divider--with-trailing-inset[dir=rtl],.mdc-list-divider--with-leading-checkbox.mdc-list-divider--with-trailing-inset[dir=rtl],.mdc-list-divider--with-leading-switch.mdc-list-divider--with-trailing-inset[dir=rtl],.mdc-list-divider--with-leading-radio.mdc-list-divider--with-trailing-inset[dir=rtl]{padding-left:16px;padding-right:auto}.mdc-list-divider--with-leading-video.mdc-list-divider--with-leading-inset{padding-left:0px;padding-right:auto}[dir=rtl] .mdc-list-divider--with-leading-video.mdc-list-divider--with-leading-inset,.mdc-list-divider--with-leading-video.mdc-list-divider--with-leading-inset[dir=rtl]{padding-left:auto;padding-right:0px}[dir=rtl] .mdc-list-divider,.mdc-list-divider[dir=rtl]{padding:0}.mdc-list-item{background-color:var(--mdc-list-list-item-container-color)}.mdc-list-item.mdc-list-item--selected{background-color:var(--mdc-list-list-item-selected-container-color)}.mdc-list-item--with-one-line{border-radius:var(--mdc-list-list-item-container-shape)}.mdc-list-item--with-one-line.mdc-list-item--with-leading-avatar,.mdc-list-item--with-one-line.mdc-list-item--with-leading-icon,.mdc-list-item--with-one-line.mdc-list-item--with-leading-thumbnail,.mdc-list-item--with-one-line.mdc-list-item--with-leading-checkbox,.mdc-list-item--with-one-line.mdc-list-item--with-leading-radio,.mdc-list-item--with-one-line.mdc-list-item--with-leading-switch{border-radius:var(--mdc-list-list-item-container-shape)}.mdc-list-item--with-one-line.mdc-list-item--with-leading-image,.mdc-list-item--with-one-line.mdc-list-item--with-leading-video{border-radius:var(--mdc-list-list-item-container-shape)}.mdc-list-item--with-two-lines{border-radius:var(--mdc-list-list-item-container-shape)}.mdc-list-item--with-two-lines.mdc-list-item--with-leading-avatar,.mdc-list-item--with-two-lines.mdc-list-item--with-leading-icon,.mdc-list-item--with-two-lines.mdc-list-item--with-leading-thumbnail,.mdc-list-item--with-two-lines.mdc-list-item--with-leading-checkbox,.mdc-list-item--with-two-lines.mdc-list-item--with-leading-radio,.mdc-list-item--with-two-lines.mdc-list-item--with-leading-switch,.mdc-list-item--with-two-lines.mdc-list-item--with-leading-image,.mdc-list-item--with-two-lines.mdc-list-item--with-leading-video{border-radius:var(--mdc-list-list-item-container-shape)}.mdc-list-item--with-three-lines{border-radius:var(--mdc-list-list-item-container-shape)}.mdc-list-item.mdc-list-item--with-one-line{height:var(--mdc-list-list-item-one-line-container-height)}.mdc-list-item.mdc-list-item--with-two-lines{height:var(--mdc-list-list-item-two-line-container-height)}.mdc-list-item.mdc-list-item--with-three-lines{height:var(--mdc-list-list-item-three-line-container-height)}.mdc-list-item__primary-text{color:var(--mdc-list-list-item-label-text-color)}.mdc-list-item__primary-text{font-family:var(--mdc-list-list-item-label-text-font);line-height:var(--mdc-list-list-item-label-text-line-height);font-size:var(--mdc-list-list-item-label-text-size);font-weight:var(--mdc-list-list-item-label-text-weight);letter-spacing:var(--mdc-list-list-item-label-text-tracking)}.mdc-list-item__secondary-text{color:var(--mdc-list-list-item-supporting-text-color)}.mdc-list-item__secondary-text{font-family:var(--mdc-list-list-item-supporting-text-font);line-height:var(--mdc-list-list-item-supporting-text-line-height);font-size:var(--mdc-list-list-item-supporting-text-size);font-weight:var(--mdc-list-list-item-supporting-text-weight);letter-spacing:var(--mdc-list-list-item-supporting-text-tracking)}.mdc-list-item--with-leading-icon .mdc-list-item__start{color:var(--mdc-list-list-item-leading-icon-color)}.mdc-list-item--with-leading-icon .mdc-list-item__start{width:var(--mdc-list-list-item-leading-icon-size);height:var(--mdc-list-list-item-leading-icon-size)}.mdc-list-item--with-leading-icon .mdc-list-item__start>i{font-size:var(--mdc-list-list-item-leading-icon-size)}.mdc-list-item--with-leading-icon .mdc-list-item__start .mdc-list-item__icon{font-size:var(--mdc-list-list-item-leading-icon-size);width:var(--mdc-list-list-item-leading-icon-size);height:var(--mdc-list-list-item-leading-icon-size)}.mdc-list-item--with-leading-icon .mdc-list-item__start .mdc-list-item__icon,.mdc-list-item--with-leading-icon .mdc-list-item__start .mdc-list-item__icon>.materialdesignWizIconSvgsSvgIcon{display:block}.mdc-list-item--with-leading-avatar .mdc-list-item__start{width:var(--mdc-list-list-item-leading-avatar-size);height:var(--mdc-list-list-item-leading-avatar-size)}.mdc-list-item.mdc-list-item--with-trailing-meta .mdc-list-item__end{color:var(--mdc-list-list-item-trailing-supporting-text-color)}.mdc-list-item--with-trailing-meta .mdc-list-item__end{font-family:var(--mdc-list-list-item-trailing-supporting-text-font);line-height:var(--mdc-list-list-item-trailing-supporting-text-line-height);font-size:var(--mdc-list-list-item-trailing-supporting-text-size);font-weight:var(--mdc-list-list-item-trailing-supporting-text-weight);letter-spacing:var(--mdc-list-list-item-trailing-supporting-text-tracking)}.mdc-list-item--with-trailing-icon .mdc-list-item__end{color:var(--mdc-list-list-item-trailing-icon-color)}.mdc-list-item--with-trailing-icon .mdc-list-item__end{width:var(--mdc-list-list-item-trailing-icon-size);height:var(--mdc-list-list-item-trailing-icon-size)}.mdc-list-item--with-trailing-icon .mdc-list-item__end>i{font-size:var(--mdc-list-list-item-trailing-icon-size)}.mdc-list-item--with-trailing-icon .mdc-list-item__end .mdc-list-item__icon{font-size:var(--mdc-list-list-item-trailing-icon-size);width:var(--mdc-list-list-item-trailing-icon-size);height:var(--mdc-list-list-item-trailing-icon-size)}.mdc-list-item--with-trailing-icon .mdc-list-item__end .mdc-list-item__icon,.mdc-list-item--with-trailing-icon .mdc-list-item__end .mdc-list-item__icon>.materialdesignWizIconSvgsSvgIcon{display:block}.mdc-list-item--selected.mdc-list-item--with-trailing-icon .mdc-list-item__end{color:var(--mdc-list-list-item-selected-trailing-icon-color)}.mdc-list-item--disabled .mdc-list-item__start,.mdc-list-item--disabled .mdc-list-item__content,.mdc-list-item--disabled .mdc-list-item__end{opacity:1}.mdc-list-item--disabled .mdc-list-item__primary-text,.mdc-list-item--disabled .mdc-list-item__secondary-text,.mdc-list-item--disabled .mdc-list-item__overline-text{opacity:var(--mdc-list-list-item-disabled-label-text-opacity)}.mdc-list-item--disabled.mdc-list-item--with-leading-icon .mdc-list-item__start{color:var(--mdc-list-list-item-disabled-leading-icon-color)}.mdc-list-item--disabled.mdc-list-item--with-leading-icon .mdc-list-item__start{opacity:var(--mdc-list-list-item-disabled-leading-icon-opacity)}.mdc-list-item--disabled.mdc-list-item--with-trailing-icon .mdc-list-item__end{color:var(--mdc-list-list-item-disabled-trailing-icon-color)}.mdc-list-item--disabled.mdc-list-item--with-trailing-icon .mdc-list-item__end{opacity:var(--mdc-list-list-item-disabled-trailing-icon-opacity)}.mdc-list-item:hover .mdc-list-item__primary-text{color:var(--mdc-list-list-item-hover-label-text-color)}.mdc-list-item--with-leading-icon:hover .mdc-list-item__start{color:var(--mdc-list-list-item-hover-leading-icon-color)}.mdc-list-item--with-trailing-icon:hover .mdc-list-item__end{color:var(--mdc-list-list-item-hover-trailing-icon-color)}.mdc-list-item:focus .mdc-list-item__primary-text{color:var(--mdc-list-list-item-focus-label-text-color)}.mdc-list-item.mdc-list-item--disabled .mdc-list-item__primary-text{color:var(--mdc-list-list-item-disabled-label-text-color)}.mdc-list-item:hover::before{background-color:var(--mdc-list-list-item-hover-state-layer-color);opacity:var(--mdc-list-list-item-hover-state-layer-opacity)}.mdc-list-item.mdc-list-item--disabled::before{background-color:var(--mdc-list-list-item-disabled-state-layer-color);opacity:var(--mdc-list-list-item-disabled-state-layer-opacity)}.mdc-list-item:focus::before{background-color:var(--mdc-list-list-item-focus-state-layer-color);opacity:var(--mdc-list-list-item-focus-state-layer-opacity)}.mdc-list-item--disabled .mdc-radio,.mdc-list-item--disabled .mdc-checkbox{opacity:var(--mdc-list-list-item-disabled-label-text-opacity)}.mdc-list-item--with-leading-avatar .mat-mdc-list-item-avatar{border-radius:var(--mdc-list-list-item-leading-avatar-shape);background-color:var(--mdc-list-list-item-leading-avatar-color)}.mat-mdc-list-item-icon{font-size:var(--mdc-list-list-item-leading-icon-size)}.cdk-high-contrast-active a.mdc-list-item--activated::after{content:"";position:absolute;top:50%;right:16px;transform:translateY(-50%);width:10px;height:0;border-bottom:solid 10px;border-radius:10px}.cdk-high-contrast-active a.mdc-list-item--activated [dir=rtl]::after{right:auto;left:16px}.mat-mdc-list-base{display:block}.mat-mdc-list-base .mdc-list-item__start,.mat-mdc-list-base .mdc-list-item__end,.mat-mdc-list-base .mdc-list-item__content{pointer-events:auto}.mat-mdc-list-item,.mat-mdc-list-option{width:100%;box-sizing:border-box;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-list-item:not(.mat-mdc-list-item-interactive),.mat-mdc-list-option:not(.mat-mdc-list-item-interactive){cursor:default}.mat-mdc-list-item .mat-divider-inset,.mat-mdc-list-option .mat-divider-inset{position:absolute;left:0;right:0;bottom:0}.mat-mdc-list-item .mat-mdc-list-item-avatar~.mat-divider-inset,.mat-mdc-list-option .mat-mdc-list-item-avatar~.mat-divider-inset{margin-left:72px}[dir=rtl] .mat-mdc-list-item .mat-mdc-list-item-avatar~.mat-divider-inset,[dir=rtl] .mat-mdc-list-option .mat-mdc-list-item-avatar~.mat-divider-inset{margin-right:72px}.mat-mdc-list-item-interactive::before{top:0;left:0;right:0;bottom:0;position:absolute;content:"";opacity:0;pointer-events:none}.mat-mdc-list-item>.mat-mdc-focus-indicator{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none}.mat-mdc-list-item:focus>.mat-mdc-focus-indicator::before{content:""}.mat-mdc-list-item.mdc-list-item--with-three-lines .mat-mdc-list-item-line.mdc-list-item__secondary-text{white-space:nowrap;line-height:normal}.mat-mdc-list-item.mdc-list-item--with-three-lines .mat-mdc-list-item-unscoped-content.mdc-list-item__secondary-text{display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2}mat-action-list button{background:none;color:inherit;border:none;font:inherit;outline:inherit;-webkit-tap-highlight-color:rgba(0,0,0,0);text-align:start}mat-action-list button::-moz-focus-inner{border:0}.mdc-list-item--with-leading-icon .mdc-list-item__start{margin-inline-start:var(--mat-list-list-item-leading-icon-start-space);margin-inline-end:var(--mat-list-list-item-leading-icon-end-space)}a.mdc-list-item.mdc-list-item--activated{background-color:var(--mat-list-active-indicator-color)}a.mdc-list-item.mdc-list-item--activated.mdc-list-item{border-radius:var(--mat-list-active-indicator-shape)}',iU=["unscopedContent"],nU=["text"],rU=[[["","matListItemAvatar",""],["","matListItemIcon",""]],[["","matListItemTitle",""]],[["","matListItemLine",""]],"*",[["","matListItemMeta",""]],[["mat-divider"]]],sU=["[matListItemAvatar],[matListItemIcon]","[matListItemTitle]","[matListItemLine]","*","[matListItemMeta]","mat-divider"];var oU=new Sn("ListOption"),aU=(()=>{let e=class e{constructor(s){this._elementRef=s}};e.\u0275fac=function(a){return new(a||e)(Et(Ir))},e.\u0275dir=lr({type:e,selectors:[["","matListItemTitle",""]],hostAttrs:[1,"mat-mdc-list-item-title","mdc-list-item__primary-text"],standalone:!0});let o=e;return o})(),lU=(()=>{let e=class e{constructor(s){this._elementRef=s}};e.\u0275fac=function(a){return new(a||e)(Et(Ir))},e.\u0275dir=lr({type:e,selectors:[["","matListItemLine",""]],hostAttrs:[1,"mat-mdc-list-item-line","mdc-list-item__secondary-text"],standalone:!0});let o=e;return o})(),cU=(()=>{let e=class e{};e.\u0275fac=function(a){return new(a||e)},e.\u0275dir=lr({type:e,selectors:[["","matListItemMeta",""]],hostAttrs:[1,"mat-mdc-list-item-meta","mdc-list-item__end"],standalone:!0});let o=e;return o})(),dC=(()=>{let e=class e{constructor(s){this._listOption=s}_isAlignedAtStart(){return!this._listOption||this._listOption?._getTogglePosition()==="after"}};e.\u0275fac=function(a){return new(a||e)(Et(oU,8))},e.\u0275dir=lr({type:e,hostVars:4,hostBindings:function(a,i){a&2&&Fr("mdc-list-item__start",i._isAlignedAtStart())("mdc-list-item__end",!i._isAlignedAtStart())},standalone:!0});let o=e;return o})(),hU=(()=>{let e=class e extends dC{};e.\u0275fac=(()=>{let s;return function(i){return(s||(s=Bc(e)))(i||e)}})(),e.\u0275dir=lr({type:e,selectors:[["","matListItemAvatar",""]],hostAttrs:[1,"mat-mdc-list-item-avatar"],standalone:!0,features:[co]});let o=e;return o})(),dU=(()=>{let e=class e extends dC{};e.\u0275fac=(()=>{let s;return function(i){return(s||(s=Bc(e)))(i||e)}})(),e.\u0275dir=lr({type:e,selectors:[["","matListItemIcon",""]],hostAttrs:[1,"mat-mdc-list-item-icon"],standalone:!0,features:[co]});let o=e;return o})(),uU=new Sn("MAT_LIST_CONFIG"),r3=(()=>{let e=class e{constructor(){this._isNonInteractive=!0,this._disableRipple=!1,this._disabled=!1,this._defaultOptions=ai(uU,{optional:!0})}get disableRipple(){return this._disableRipple}set disableRipple(s){this._disableRipple=A0(s)}get disabled(){return this._disabled}set disabled(s){this._disabled=A0(s)}};e.\u0275fac=function(a){return new(a||e)},e.\u0275dir=lr({type:e,hostVars:1,hostBindings:function(a,i){a&2&&vs("aria-disabled",i.disabled)},inputs:{disableRipple:"disableRipple",disabled:"disabled"},standalone:!0});let o=e;return o})(),pU=(()=>{let e=class e{set lines(s){this._explicitLines=Tu(s,null),this._updateItemLines(!1)}get disableRipple(){return this.disabled||this._disableRipple||this._noopAnimations||!!this._listBase?.disableRipple}set disableRipple(s){this._disableRipple=A0(s)}get disabled(){return this._disabled||!!this._listBase?.disabled}set disabled(s){this._disabled=A0(s)}get rippleDisabled(){return this.disableRipple||!!this.rippleConfig.disabled}constructor(s,a,i,f,v,x){this._elementRef=s,this._ngZone=a,this._listBase=i,this._platform=f,this._explicitLines=null,this._disableRipple=!1,this._disabled=!1,this._subscriptions=new lo,this._rippleRenderer=null,this._hasUnscopedTextContent=!1,this.rippleConfig=v||{},this._hostElement=this._elementRef.nativeElement,this._isButtonElement=this._hostElement.nodeName.toLowerCase()==="button",this._noopAnimations=x==="NoopAnimations",i&&!i._isNonInteractive&&this._initInteractiveListItem(),this._isButtonElement&&!this._hostElement.hasAttribute("type")&&this._hostElement.setAttribute("type","button")}ngAfterViewInit(){this._monitorProjectedLinesAndTitle(),this._updateItemLines(!0)}ngOnDestroy(){this._subscriptions.unsubscribe(),this._rippleRenderer!==null&&this._rippleRenderer._removeTriggerEvents()}_hasIconOrAvatar(){return!!(this._avatars.length||this._icons.length)}_initInteractiveListItem(){this._hostElement.classList.add("mat-mdc-list-item-interactive"),this._rippleRenderer=new ZE(this,this._ngZone,this._hostElement,this._platform),this._rippleRenderer.setupTriggerEvents(this._hostElement)}_monitorProjectedLinesAndTitle(){this._ngZone.runOutsideAngular(()=>{this._subscriptions.add(rl(this._lines.changes,this._titles.changes).subscribe(()=>this._updateItemLines(!1)))})}_updateItemLines(s){if(!this._lines||!this._titles||!this._unscopedContent)return;s&&this._checkDomForUnscopedTextContent();let a=this._explicitLines??this._inferLinesFromContent(),i=this._unscopedContent.nativeElement;if(this._hostElement.classList.toggle("mat-mdc-list-item-single-line",a<=1),this._hostElement.classList.toggle("mdc-list-item--with-one-line",a<=1),this._hostElement.classList.toggle("mdc-list-item--with-two-lines",a===2),this._hostElement.classList.toggle("mdc-list-item--with-three-lines",a===3),this._hasUnscopedTextContent){let f=this._titles.length===0&&a===1;i.classList.toggle("mdc-list-item__primary-text",f),i.classList.toggle("mdc-list-item__secondary-text",!f)}else i.classList.remove("mdc-list-item__primary-text"),i.classList.remove("mdc-list-item__secondary-text")}_inferLinesFromContent(){let s=this._titles.length+this._lines.length;return this._hasUnscopedTextContent&&(s+=1),s}_checkDomForUnscopedTextContent(){this._hasUnscopedTextContent=Array.from(this._unscopedContent.nativeElement.childNodes).filter(s=>s.nodeType!==s.COMMENT_NODE).some(s=>!!(s.textContent&&s.textContent.trim()))}};e.\u0275fac=function(a){return new(a||e)(Et(Ir),Et(Ur),Et(r3,8),Et(Qo),Et(d1,8),Et(yo,8))},e.\u0275dir=lr({type:e,contentQueries:function(a,i,f){if(a&1&&(zs(f,hU,4),zs(f,dU,4)),a&2){let v;Nn(v=zn())&&(i._avatars=v),Nn(v=zn())&&(i._icons=v)}},hostVars:4,hostBindings:function(a,i){a&2&&(vs("aria-disabled",i.disabled)("disabled",i._isButtonElement&&i.disabled||null),Fr("mdc-list-item--disabled",i.disabled))},inputs:{lines:"lines",disableRipple:"disableRipple",disabled:"disabled"},standalone:!0});let o=e;return o})();var uC=(()=>{let e=class e extends r3{};e.\u0275fac=(()=>{let s;return function(i){return(s||(s=Bc(e)))(i||e)}})(),e.\u0275cmp=$i({type:e,selectors:[["mat-list"]],hostAttrs:[1,"mat-mdc-list","mat-mdc-list-base","mdc-list"],exportAs:["matList"],standalone:!0,features:[Qs([{provide:r3,useExisting:e}]),co,Yi],ngContentSelectors:eU,decls:1,vars:0,template:function(a,i){a&1&&(ks(),Pr(0))},styles:[tU],encapsulation:2,changeDetection:0});let o=e;return o})(),pC=(()=>{let e=class e extends pU{get activated(){return this._activated}set activated(s){this._activated=A0(s)}constructor(s,a,i,f,v,x){super(s,a,i,f,v,x),this._activated=!1}_getAriaCurrent(){return this._hostElement.nodeName==="A"&&this._activated?"page":null}};e.\u0275fac=function(a){return new(a||e)(Et(Ir),Et(Ur),Et(r3,8),Et(Qo),Et(d1,8),Et(yo,8))},e.\u0275cmp=$i({type:e,selectors:[["mat-list-item"],["a","mat-list-item",""],["button","mat-list-item",""]],contentQueries:function(a,i,f){if(a&1&&(zs(f,lU,5),zs(f,aU,5),zs(f,cU,5)),a&2){let v;Nn(v=zn())&&(i._lines=v),Nn(v=zn())&&(i._titles=v),Nn(v=zn())&&(i._meta=v)}},viewQuery:function(a,i){if(a&1&&(Br(iU,5),Br(nU,5)),a&2){let f;Nn(f=zn())&&(i._unscopedContent=f.first),Nn(f=zn())&&(i._itemText=f.first)}},hostAttrs:[1,"mat-mdc-list-item","mdc-list-item"],hostVars:11,hostBindings:function(a,i){a&2&&(vs("aria-current",i._getAriaCurrent()),Fr("mdc-list-item--activated",i.activated)("mdc-list-item--with-leading-avatar",i._avatars.length!==0)("mdc-list-item--with-leading-icon",i._icons.length!==0)("mdc-list-item--with-trailing-meta",i._meta.length!==0)("_mat-animation-noopable",i._noopAnimations))},inputs:{activated:"activated"},exportAs:["matListItem"],standalone:!0,features:[co,Yi],ngContentSelectors:sU,decls:10,vars:0,consts:[[1,"mdc-list-item__content"],[1,"mat-mdc-list-item-unscoped-content",3,"cdkObserveContent"],["unscopedContent",""],[1,"mat-mdc-focus-indicator"]],template:function(a,i){a&1&&(ks(rU),Pr(0),xt(1,"span",0),Pr(2,1),Pr(3,2),xt(4,"span",1,2),zi("cdkObserveContent",function(){return i._updateItemLines(!0)}),Pr(6,3),It()(),Pr(7,4),Pr(8,5),Ln(9,"div",3))},dependencies:[I5],encapsulation:2,changeDetection:0});let o=e;return o})();var fC=(()=>{let e=class e{};e.\u0275fac=function(a){return new(a||e)},e.\u0275dir=lr({type:e,selectors:[["","mat-subheader",""],["","matSubheader",""]],hostAttrs:[1,"mat-mdc-subheader","mdc-list-group__subheader"],standalone:!0});let o=e;return o})();var s3=(()=>{let e=class e{};e.\u0275fac=function(a){return new(a||e)},e.\u0275mod=ds({type:e}),e.\u0275inj=hs({imports:[UE,_r,Ss,u1,$E,cC]});let o=e;return o})();var Xc=(()=>{let e=class e{constructor(s){this.darkMode=yE(!1),this.document=ai(eo),this.renderer=s.createRenderer(null,null),wl(()=>{this.darkMode()?this.renderer.addClass(this.document.body,"dark-theme"):this.renderer.removeClass(this.document.body,"dark-theme")}),this._getOSDarkModeSetting()}_getOSDarkModeSetting(){window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches&&this.darkMode.set(!0)}};e.\u0275fac=function(a){return new(a||e)(Sr(v5))},e.\u0275prov=jr({token:e,factory:e.\u0275fac,providedIn:"root"});let o=e;return o})();function gU(o,e){if(o&1){let t=vr();xt(0,"button",4),zi("click",function(){Pn(t);let a=di();return Rn(a.showContext=!a.showContext)}),Bi(1),It()}if(o&2){let t=di();Fr("superadmin",t.superAdmin),Ct(),xs(" ",t.letter," ")}}function _U(o,e){if(o&1&&(xt(0,"mat-option",9),Bi(1),It()),o&2){let t=e.$implicit;si("value",t),Ct(),Or(t)}}function yU(o,e){if(o&1){let t=vr();xt(0,"button",10),zi("click",function(){let i=Pn(t).$implicit,f=di(2);return Rn(f.handleMenuItemClick(i))}),xt(1,"mat-icon"),Bi(2),It(),Bi(3),It()}if(o&2){let t=e.$implicit;Ct(2),Or(t.icon),Ct(),xs(" ",t.label," ")}}function vU(o,e){if(o&1){let t=vr();xt(0,"button",11),zi("click",function(){Pn(t);let a=di(2);return Rn(a.signInOut("out"))}),xt(1,"mat-icon"),Bi(2,"logout"),It(),Bi(3),It()}if(o&2){let t=di(2);Ct(3),xs(" ",t.signOutLabel," ")}}function xU(o,e){if(o&1){let t=vr();xt(0,"button",11),zi("click",function(){Pn(t);let a=di(2);return Rn(a.signInOut("in"))}),xt(1,"mat-icon"),Bi(2,"login"),It(),Bi(3),It()}if(o&2){let t=di(2);Ct(3),xs(" ",t.signInLabel," ")}}function bU(o,e){if(o&1){let t=vr();xt(0,"button",11),zi("click",function(){Pn(t);let a=di(2);return Rn(a.clickedCreateFromAnonymous.emit())}),xt(1,"mat-icon"),Bi(2,"person_add"),It(),Bi(3),It()}if(o&2){let t=di(2);Ct(3),xs(" ",t.createUserLabel," ")}}function wU(o,e){if(o&1){let t=vr();xt(0,"mat-card",5)(1,"mat-form-field")(2,"mat-label"),Bi(3,"Language"),It(),xt(4,"mat-select",6),zi("ngModelChange",function(a){Pn(t);let i=di();return Rn(i.language=a)})("selectionChange",function(){Pn(t);let a=di();return Rn(a.changedLanguage.emit(a.language))}),Js(5,_U,2,2,"mat-option",9,P2),It()(),xt(7,"div",7),Js(8,yU,4,2,"button",12,P2),It(),ln(10,vU,4,1,"button",8)(11,xU,4,1,"button",8)(12,bU,4,1,"button",8),It()}if(o&2){let t=di();Ct(4),si("ngModel",t.language),Ct(),Ks(t.languageOptions),Ct(3),Ks(t.menuItems),Ct(2),si("ngIf",t.user&&!t.isAnonymous),Ct(),si("ngIf",!t.user||t.isAnonymous),Ct(),si("ngIf",t.isAnonymous)}}var mC=["*","*"],gC=(()=>{let e=class e{constructor(){this._themeService=ai(Xc),this.darkMode=this._themeService.darkMode,this.showProfileMenu=!0,this.language="en",this.languageOptions=["en","da","de"],this.signInLabel="Sign in",this.signOutLabel="Sign out",this.createUserLabel="Create user",this.user=null,this.superAdmin=!0,this.menuItems=[],this.changedLanguage=new mn,this.updatedUserPreferences=new mn,this.clickedSignIn=new mn,this.clickedSignOut=new mn,this.clickedCreateFromAnonymous=new mn,this.clickedSignInFromAnonymous=new mn,this.letter="",this.showContext=!1,this.isAnonymous=!1}ngOnChanges(){if(this.user){if(this.user.authData?.isAnonymous){this.isAnonymous=!0,this.letter="A";return}else this.isAnonymous=!1;this.letter=this.user.displayName[0].toUpperCase(),this.language=this.user.profileData.preferences.language}}toggleDarkMode(){this._themeService.darkMode.set(!this.darkMode())}setLanguage(s){this.showContext=!1,s.stopImmediatePropagation(),s.preventDefault(),this.changedLanguage.emit(this.language)}signInOut(s){if(this.showContext=!1,this.isAnonymous)return this.clickedSignInFromAnonymous.emit();s=="in"?this.clickedSignIn.emit():this.clickedSignOut.emit()}handleMenuItemClick(s){s.click(),this.showContext=!1}};e.\u0275fac=function(a){return new(a||e)},e.\u0275cmp=$i({type:e,selectors:[["lib-ng-right-toolbar"]],inputs:{showProfileMenu:"showProfileMenu",language:"language",languageOptions:"languageOptions",signInLabel:"signInLabel",signOutLabel:"signOutLabel",createUserLabel:"createUserLabel",user:"user",superAdmin:"superAdmin",menuItems:"menuItems"},outputs:{changedLanguage:"changedLanguage",updatedUserPreferences:"updatedUserPreferences",clickedSignIn:"clickedSignIn",clickedSignOut:"clickedSignOut",clickedCreateFromAnonymous:"clickedCreateFromAnonymous",clickedSignInFromAnonymous:"clickedSignInFromAnonymous"},standalone:!0,features:[Ms,Yi],ngContentSelectors:mC,decls:8,vars:5,consts:[[1,"card"],["mat-icon-button","","aria-label","Toggle dark mode",1,"btn",3,"click"],["mat-mini-fab","","aria-label","Profile","class","btn","color","primary",3,"superadmin","click",4,"ngIf"],["class","context",4,"ngIf"],["mat-mini-fab","","aria-label","Profile","color","primary",1,"btn",3,"click"],[1,"context"],["name","language","id","language-select",3,"ngModel","ngModelChange","selectionChange"],[1,"buttons"],["mat-stroked-button","",3,"click",4,"ngIf"],[3,"value"],["mat-button","",3,"click"],["mat-stroked-button","",3,"click"],["mat-button",""]],template:function(a,i){a&1&&(ks(mC),xt(0,"mat-card",0),Pr(1,0,["#icons",""]),xt(2,"button",1),zi("click",function(){return i.toggleDarkMode()}),xt(3,"mat-icon"),Bi(4),It()(),Pr(5,1,["#iconsAfter",""]),ln(6,gU,2,3,"button",2),It(),ln(7,wU,13,4,"mat-card",3)),a&2&&(Fr("unfolded",i.showContext),Ct(4),Or(i.darkMode()?"light_mode":"dark_mode"),Ct(2),si("ngIf",i.showProfileMenu),Ct(),si("ngIf",i.showContext))},dependencies:[_r,Ds,Oh,Lh,Fh,Gh,z5,N5,Vh,zh,aC,Eo,Na,M1,T1,ho,Vc,Hh,QE,s3],styles:[".card[_ngcontent-%COMP%]{padding:10px;height:100%;display:flex;flex-direction:row;justify-content:flex-end;align-items:center;gap:10px}.card.unfolded[_ngcontent-%COMP%]{border-bottom-left-radius:0;border-bottom-right-radius:0}.context[_ngcontent-%COMP%]{border-top-left-radius:0;border-top-right-radius:0;padding:10px}.btn[_ngcontent-%COMP%]{transform:scale(.7)}#language-select[_ngcontent-%COMP%]{width:100%}.superadmin[_ngcontent-%COMP%]{border:3px solid gold}.buttons[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px;margin-bottom:10px}mat-card[_ngcontent-%COMP%]{z-index:10}"]});let o=e;return o})();var SU=["*"],_C=(()=>{let e=class e{};e.\u0275fac=function(a){return new(a||e)},e.\u0275cmp=$i({type:e,selectors:[["lib-standard-page"]],standalone:!0,features:[Yi],ngContentSelectors:SU,decls:3,vars:0,consts:[[1,"container"],[1,"inner-container"]],template:function(a,i){a&1&&(ks(),xt(0,"div",0)(1,"div",1),Pr(2),It()())},dependencies:[_r],styles:[".container[_ngcontent-%COMP%]{position:absolute;display:flex;flex-direction:row;justify-content:center;inset:120px 20px 0;overflow-y:auto}.inner-container[_ngcontent-%COMP%]{width:60vw;display:flex;flex-direction:column;gap:20px}@media only screen and (max-width: 600px){.inner-container[_ngcontent-%COMP%]{width:calc(100% - 4px)}}"]});let o=e;return o})();function TU(o,e){}var Cu=class{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.ariaModal=!0,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.closeOnNavigation=!0,this.closeOnDestroy=!0,this.closeOnOverlayDetachments=!0}};var x8=(()=>{let e=class e extends F5{constructor(s,a,i,f,v,x,M,C){super(),this._elementRef=s,this._focusTrapFactory=a,this._config=f,this._interactivityChecker=v,this._ngZone=x,this._overlayRef=M,this._focusMonitor=C,this._platform=ai(Qo),this._focusTrap=null,this._elementFocusedBeforeDialogWasOpened=null,this._closeInteractionType=null,this._ariaLabelledByQueue=[],this._changeDetectorRef=ai(ts),this.attachDomPortal=D=>{this._portalOutlet.hasAttached();let L=this._portalOutlet.attachDomPortal(D);return this._contentAttached(),L},this._document=i,this._config.ariaLabelledBy&&this._ariaLabelledByQueue.push(this._config.ariaLabelledBy)}_addAriaLabelledBy(s){this._ariaLabelledByQueue.push(s),this._changeDetectorRef.markForCheck()}_removeAriaLabelledBy(s){let a=this._ariaLabelledByQueue.indexOf(s);a>-1&&(this._ariaLabelledByQueue.splice(a,1),this._changeDetectorRef.markForCheck())}_contentAttached(){this._initializeFocusTrap(),this._handleBackdropClicks(),this._captureInitialFocus()}_captureInitialFocus(){this._trapFocus()}ngOnDestroy(){this._restoreFocus()}attachComponentPortal(s){this._portalOutlet.hasAttached();let a=this._portalOutlet.attachComponentPortal(s);return this._contentAttached(),a}attachTemplatePortal(s){this._portalOutlet.hasAttached();let a=this._portalOutlet.attachTemplatePortal(s);return this._contentAttached(),a}_recaptureFocus(){this._containsFocus()||this._trapFocus()}_forceFocus(s,a){this._interactivityChecker.isFocusable(s)||(s.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{let i=()=>{s.removeEventListener("blur",i),s.removeEventListener("mousedown",i),s.removeAttribute("tabindex")};s.addEventListener("blur",i),s.addEventListener("mousedown",i)})),s.focus(a)}_focusByCssSelector(s,a){let i=this._elementRef.nativeElement.querySelector(s);i&&this._forceFocus(i,a)}_trapFocus(){let s=this._elementRef.nativeElement;switch(this._config.autoFocus){case!1:case"dialog":this._containsFocus()||s.focus();break;case!0:case"first-tabbable":this._focusTrap?.focusInitialElementWhenReady().then(a=>{a||this._focusDialogContainer()});break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this._config.autoFocus);break}}_restoreFocus(){let s=this._config.restoreFocus,a=null;if(typeof s=="string"?a=this._document.querySelector(s):typeof s=="boolean"?a=s?this._elementFocusedBeforeDialogWasOpened:null:s&&(a=s),this._config.restoreFocus&&a&&typeof a.focus=="function"){let i=C5(),f=this._elementRef.nativeElement;(!i||i===this._document.body||i===f||f.contains(i))&&(this._focusMonitor?(this._focusMonitor.focusVia(a,this._closeInteractionType),this._closeInteractionType=null):a.focus())}this._focusTrap&&this._focusTrap.destroy()}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){let s=this._elementRef.nativeElement,a=C5();return s===a||s.contains(a)}_initializeFocusTrap(){this._platform.isBrowser&&(this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._document&&(this._elementFocusedBeforeDialogWasOpened=C5()))}_handleBackdropClicks(){this._overlayRef.backdropClick().subscribe(()=>{this._config.disableClose&&this._recaptureFocus()})}};e.\u0275fac=function(a){return new(a||e)(Et(Ir),Et(k5),Et(eo,8),Et(Cu),Et(R5),Et(Ur),Et(f1),Et(h1))},e.\u0275cmp=$i({type:e,selectors:[["cdk-dialog-container"]],viewQuery:function(a,i){if(a&1&&Br(Oa,7),a&2){let f;Nn(f=zn())&&(i._portalOutlet=f.first)}},hostAttrs:["tabindex","-1",1,"cdk-dialog-container"],hostVars:6,hostBindings:function(a,i){a&2&&vs("id",i._config.id||null)("role",i._config.role)("aria-modal",i._config.ariaModal)("aria-labelledby",i._config.ariaLabel?null:i._ariaLabelledByQueue[0])("aria-label",i._config.ariaLabel)("aria-describedby",i._config.ariaDescribedBy||null)},standalone:!0,features:[co,Yi],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(a,i){a&1&&ln(0,TU,0,0,"ng-template",0)},dependencies:[Oa],styles:[".cdk-dialog-container{display:block;width:100%;height:100%;min-height:inherit;max-height:inherit}"],encapsulation:2});let o=e;return o})(),cg=class{constructor(e,t){this.overlayRef=e,this.config=t,this.closed=new fn,this.disableClose=t.disableClose,this.backdropClick=e.backdropClick(),this.keydownEvents=e.keydownEvents(),this.outsidePointerEvents=e.outsidePointerEvents(),this.id=t.id,this.keydownEvents.subscribe(s=>{s.keyCode===27&&!this.disableClose&&!Nh(s)&&(s.preventDefault(),this.close(void 0,{focusOrigin:"keyboard"}))}),this.backdropClick.subscribe(()=>{this.disableClose||this.close(void 0,{focusOrigin:"mouse"})}),this._detachSubscription=e.detachments().subscribe(()=>{t.closeOnOverlayDetachments!==!1&&this.close()})}close(e,t){if(this.containerInstance){let s=this.closed;this.containerInstance._closeInteractionType=t?.focusOrigin||"program",this._detachSubscription.unsubscribe(),this.overlayRef.dispose(),s.next(e),s.complete(),this.componentInstance=this.containerInstance=null}}updatePosition(){return this.overlayRef.updatePosition(),this}updateSize(e="",t=""){return this.overlayRef.updateSize({width:e,height:t}),this}addPanelClass(e){return this.overlayRef.addPanelClass(e),this}removePanelClass(e){return this.overlayRef.removePanelClass(e),this}},MU=new Sn("DialogScrollStrategy",{providedIn:"root",factory:()=>{let o=ai(sl);return()=>o.scrollStrategies.block()}}),EU=new Sn("DialogData"),AU=new Sn("DefaultDialogConfig");var CU=0,b8=(()=>{let e=class e{get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}constructor(s,a,i,f,v,x){this._overlay=s,this._injector=a,this._defaultOptions=i,this._parentDialog=f,this._overlayContainer=v,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new fn,this._afterOpenedAtThisLevel=new fn,this._ariaHiddenElements=new Map,this.afterAllClosed=bu(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(Yo(void 0))),this._scrollStrategy=x}open(s,a){let i=this._defaultOptions||new Cu;a=Ti(Ti({},i),a),a.id=a.id||`cdk-dialog-${CU++}`,a.id&&this.getDialogById(a.id);let f=this._getOverlayConfig(a),v=this._overlay.create(f),x=new cg(v,a),M=this._attachContainer(v,x,a);return x.containerInstance=M,this._attachDialogContent(s,x,M,a),this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(x),x.closed.subscribe(()=>this._removeOpenDialog(x,!0)),this.afterOpened.next(x),x}closeAll(){_8(this.openDialogs,s=>s.close())}getDialogById(s){return this.openDialogs.find(a=>a.id===s)}ngOnDestroy(){_8(this._openDialogsAtThisLevel,s=>{s.config.closeOnDestroy===!1&&this._removeOpenDialog(s,!1)}),_8(this._openDialogsAtThisLevel,s=>s.close()),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete(),this._openDialogsAtThisLevel=[]}_getOverlayConfig(s){let a=new B2({positionStrategy:s.positionStrategy||this._overlay.position().global().centerHorizontally().centerVertically(),scrollStrategy:s.scrollStrategy||this._scrollStrategy(),panelClass:s.panelClass,hasBackdrop:s.hasBackdrop,direction:s.direction,minWidth:s.minWidth,minHeight:s.minHeight,maxWidth:s.maxWidth,maxHeight:s.maxHeight,width:s.width,height:s.height,disposeOnNavigation:s.closeOnNavigation});return s.backdropClass&&(a.backdropClass=s.backdropClass),a}_attachContainer(s,a,i){let f=i.injector||i.viewContainerRef?.injector,v=[{provide:Cu,useValue:i},{provide:cg,useValue:a},{provide:f1,useValue:s}],x;i.container?typeof i.container=="function"?x=i.container:(x=i.container.type,v.push(...i.container.providers(i))):x=x8;let M=new p1(x,i.viewContainerRef,Jo.create({parent:f||this._injector,providers:v}),i.componentFactoryResolver);return s.attach(M).instance}_attachDialogContent(s,a,i,f){if(s instanceof ha){let v=this._createInjector(f,a,i,void 0),x={$implicit:f.data,dialogRef:a};f.templateContext&&(x=Ti(Ti({},x),typeof f.templateContext=="function"?f.templateContext():f.templateContext)),i.attachTemplatePortal(new Bh(s,null,x,v))}else{let v=this._createInjector(f,a,i,this._injector),x=i.attachComponentPortal(new p1(s,f.viewContainerRef,v,f.componentFactoryResolver));a.componentRef=x,a.componentInstance=x.instance}}_createInjector(s,a,i,f){let v=s.injector||s.viewContainerRef?.injector,x=[{provide:EU,useValue:s.data},{provide:cg,useValue:a}];return s.providers&&(typeof s.providers=="function"?x.push(...s.providers(a,s,i)):x.push(...s.providers)),s.direction&&(!v||!v.get(Kl,null,{optional:!0}))&&x.push({provide:Kl,useValue:{value:s.direction,change:Xn()}}),Jo.create({parent:v||f,providers:x})}_removeOpenDialog(s,a){let i=this.openDialogs.indexOf(s);i>-1&&(this.openDialogs.splice(i,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((f,v)=>{f?v.setAttribute("aria-hidden",f):v.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),a&&this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(){let s=this._overlayContainer.getContainerElement();if(s.parentElement){let a=s.parentElement.children;for(let i=a.length-1;i>-1;i--){let f=a[i];f!==s&&f.nodeName!=="SCRIPT"&&f.nodeName!=="STYLE"&&!f.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(f,f.getAttribute("aria-hidden")),f.setAttribute("aria-hidden","true"))}}}_getAfterAllClosed(){let s=this._parentDialog;return s?s._getAfterAllClosed():this._afterAllClosedAtThisLevel}};e.\u0275fac=function(a){return new(a||e)(Sr(sl),Sr(Jo),Sr(AU,8),Sr(e,12),Sr(O5),Sr(MU))},e.\u0275prov=jr({token:e,factory:e.\u0275fac,providedIn:"root"});let o=e;return o})();function _8(o,e){let t=o.length;for(;t--;)e(o[t])}var vC=(()=>{let e=class e{};e.\u0275fac=function(a){return new(a||e)},e.\u0275mod=ds({type:e}),e.\u0275inj=hs({providers:[b8],imports:[Uh,C0,XE,C0]});let o=e;return o})();function IU(o,e){}var hg=class{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.ariaModal=!0,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.delayFocusTrap=!0,this.closeOnNavigation=!0}},w8="mdc-dialog--open",xC="mdc-dialog--opening",bC="mdc-dialog--closing",PU=150,RU=75,kU=(()=>{let e=class e extends x8{constructor(s,a,i,f,v,x,M,C,D){super(s,a,i,f,v,x,M,D),this._animationMode=C,this._animationStateChanged=new mn,this._animationsEnabled=this._animationMode!=="NoopAnimations",this._actionSectionCount=0,this._hostElement=this._elementRef.nativeElement,this._enterAnimationDuration=this._animationsEnabled?SC(this._config.enterAnimationDuration)??PU:0,this._exitAnimationDuration=this._animationsEnabled?SC(this._config.exitAnimationDuration)??RU:0,this._animationTimer=null,this._finishDialogOpen=()=>{this._clearAnimationClasses(),this._openAnimationDone(this._enterAnimationDuration)},this._finishDialogClose=()=>{this._clearAnimationClasses(),this._animationStateChanged.emit({state:"closed",totalTime:this._exitAnimationDuration})}}_contentAttached(){super._contentAttached(),this._startOpenAnimation()}_startOpenAnimation(){this._animationStateChanged.emit({state:"opening",totalTime:this._enterAnimationDuration}),this._animationsEnabled?(this._hostElement.style.setProperty(wC,`${this._enterAnimationDuration}ms`),this._requestAnimationFrame(()=>this._hostElement.classList.add(xC,w8)),this._waitForAnimationToComplete(this._enterAnimationDuration,this._finishDialogOpen)):(this._hostElement.classList.add(w8),Promise.resolve().then(()=>this._finishDialogOpen()))}_startExitAnimation(){this._animationStateChanged.emit({state:"closing",totalTime:this._exitAnimationDuration}),this._hostElement.classList.remove(w8),this._animationsEnabled?(this._hostElement.style.setProperty(wC,`${this._exitAnimationDuration}ms`),this._requestAnimationFrame(()=>this._hostElement.classList.add(bC)),this._waitForAnimationToComplete(this._exitAnimationDuration,this._finishDialogClose)):Promise.resolve().then(()=>this._finishDialogClose())}_updateActionSectionCount(s){this._actionSectionCount+=s,this._changeDetectorRef.markForCheck()}_clearAnimationClasses(){this._hostElement.classList.remove(xC,bC)}_waitForAnimationToComplete(s,a){this._animationTimer!==null&&clearTimeout(this._animationTimer),this._animationTimer=setTimeout(a,s)}_requestAnimationFrame(s){this._ngZone.runOutsideAngular(()=>{typeof requestAnimationFrame=="function"?requestAnimationFrame(s):s()})}_captureInitialFocus(){this._config.delayFocusTrap||this._trapFocus()}_openAnimationDone(s){this._config.delayFocusTrap&&this._trapFocus(),this._animationStateChanged.next({state:"opened",totalTime:s})}ngOnDestroy(){super.ngOnDestroy(),this._animationTimer!==null&&clearTimeout(this._animationTimer)}attachComponentPortal(s){let a=super.attachComponentPortal(s);return a.location.nativeElement.classList.add("mat-mdc-dialog-component-host"),a}};e.\u0275fac=function(a){return new(a||e)(Et(Ir),Et(k5),Et(eo,8),Et(hg),Et(R5),Et(Ur),Et(f1),Et(yo,8),Et(h1))},e.\u0275cmp=$i({type:e,selectors:[["mat-dialog-container"]],hostAttrs:["tabindex","-1",1,"mat-mdc-dialog-container","mdc-dialog"],hostVars:10,hostBindings:function(a,i){a&2&&(wE("id",i._config.id),vs("aria-modal",i._config.ariaModal)("role",i._config.role)("aria-labelledby",i._config.ariaLabel?null:i._ariaLabelledByQueue[0])("aria-label",i._config.ariaLabel)("aria-describedby",i._config.ariaDescribedBy||null),Fr("_mat-animation-noopable",!i._animationsEnabled)("mat-mdc-dialog-container-with-actions",i._actionSectionCount>0))},standalone:!0,features:[co,Yi],decls:3,vars:0,consts:[[1,"mdc-dialog__container"],[1,"mat-mdc-dialog-surface","mdc-dialog__surface"],["cdkPortalOutlet",""]],template:function(a,i){a&1&&(xt(0,"div",0)(1,"div",1),ln(2,IU,0,0,"ng-template",2),It()())},dependencies:[Oa],styles:['.mdc-elevation-overlay{position:absolute;border-radius:inherit;pointer-events:none;opacity:var(--mdc-elevation-overlay-opacity, 0);transition:opacity 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-dialog,.mdc-dialog__scrim{position:fixed;top:0;left:0;align-items:center;justify-content:center;box-sizing:border-box;width:100%;height:100%}.mdc-dialog{display:none;z-index:var(--mdc-dialog-z-index, 7)}.mdc-dialog .mdc-dialog__content{padding:20px 24px 20px 24px}.mdc-dialog .mdc-dialog__surface{min-width:280px}@media(max-width: 592px){.mdc-dialog .mdc-dialog__surface{max-width:calc(100vw - 32px)}}@media(min-width: 592px){.mdc-dialog .mdc-dialog__surface{max-width:560px}}.mdc-dialog .mdc-dialog__surface{max-height:calc(100% - 32px)}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-width:none}@media(max-width: 960px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-height:560px;width:560px}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{right:-12px}}@media(max-width: 720px)and (max-width: 672px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{width:calc(100vw - 112px)}}@media(max-width: 720px)and (min-width: 672px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{width:560px}}@media(max-width: 720px)and (max-height: 720px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-height:calc(100vh - 160px)}}@media(max-width: 720px)and (min-height: 720px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-height:560px}}@media(max-width: 720px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{right:-12px}}@media(max-width: 720px)and (max-height: 400px),(max-width: 600px),(min-width: 720px)and (max-height: 400px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{height:100%;max-height:100vh;max-width:100vw;width:100vw;border-radius:0}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{order:-1;left:-12px}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__header{padding:0 16px 9px;justify-content:flex-start}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__title{margin-left:calc(16px - 2 * 12px)}}@media(min-width: 960px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{width:calc(100vw - 400px)}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{right:-12px}}.mdc-dialog.mdc-dialog__scrim--hidden .mdc-dialog__scrim{opacity:0}.mdc-dialog__scrim{opacity:0;z-index:-1}.mdc-dialog__container{display:flex;flex-direction:row;align-items:center;justify-content:space-around;box-sizing:border-box;height:100%;opacity:0;pointer-events:none}.mdc-dialog__surface{position:relative;display:flex;flex-direction:column;flex-grow:0;flex-shrink:0;box-sizing:border-box;max-width:100%;max-height:100%;pointer-events:auto;overflow-y:auto;outline:0;transform:scale(0.8)}.mdc-dialog__surface .mdc-elevation-overlay{width:100%;height:100%;top:0;left:0}[dir=rtl] .mdc-dialog__surface,.mdc-dialog__surface[dir=rtl]{text-align:right}@media screen and (forced-colors: active),(-ms-high-contrast: active){.mdc-dialog__surface{outline:2px solid windowText}}.mdc-dialog__surface::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:2px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}@media screen and (forced-colors: active){.mdc-dialog__surface::before{border-color:CanvasText}}@media screen and (-ms-high-contrast: active),screen and (-ms-high-contrast: none){.mdc-dialog__surface::before{content:none}}.mdc-dialog__title{display:block;margin-top:0;position:relative;flex-shrink:0;box-sizing:border-box;margin:0 0 1px;padding:0 24px 9px}.mdc-dialog__title::before{display:inline-block;width:0;height:40px;content:"";vertical-align:0}[dir=rtl] .mdc-dialog__title,.mdc-dialog__title[dir=rtl]{text-align:right}.mdc-dialog--scrollable .mdc-dialog__title{margin-bottom:1px;padding-bottom:15px}.mdc-dialog--fullscreen .mdc-dialog__header{align-items:baseline;border-bottom:1px solid rgba(0,0,0,0);display:inline-flex;justify-content:space-between;padding:0 24px 9px;z-index:1}@media screen and (forced-colors: active){.mdc-dialog--fullscreen .mdc-dialog__header{border-bottom-color:CanvasText}}.mdc-dialog--fullscreen .mdc-dialog__header .mdc-dialog__close{right:-12px}.mdc-dialog--fullscreen .mdc-dialog__title{margin-bottom:0;padding:0;border-bottom:0}.mdc-dialog--fullscreen.mdc-dialog--scrollable .mdc-dialog__title{border-bottom:0;margin-bottom:0}.mdc-dialog--fullscreen .mdc-dialog__close{top:5px}.mdc-dialog--fullscreen.mdc-dialog--scrollable .mdc-dialog__actions{border-top:1px solid rgba(0,0,0,0)}@media screen and (forced-colors: active){.mdc-dialog--fullscreen.mdc-dialog--scrollable .mdc-dialog__actions{border-top-color:CanvasText}}.mdc-dialog--fullscreen--titleless .mdc-dialog__close{margin-top:4px}.mdc-dialog--fullscreen--titleless.mdc-dialog--scrollable .mdc-dialog__close{margin-top:0}.mdc-dialog__content{flex-grow:1;box-sizing:border-box;margin:0;overflow:auto}.mdc-dialog__content>:first-child{margin-top:0}.mdc-dialog__content>:last-child{margin-bottom:0}.mdc-dialog__title+.mdc-dialog__content,.mdc-dialog__header+.mdc-dialog__content{padding-top:0}.mdc-dialog--scrollable .mdc-dialog__title+.mdc-dialog__content{padding-top:8px;padding-bottom:8px}.mdc-dialog__content .mdc-deprecated-list:first-child:last-child{padding:6px 0 0}.mdc-dialog--scrollable .mdc-dialog__content .mdc-deprecated-list:first-child:last-child{padding:0}.mdc-dialog__actions{display:flex;position:relative;flex-shrink:0;flex-wrap:wrap;align-items:center;justify-content:flex-end;box-sizing:border-box;min-height:52px;margin:0;padding:8px;border-top:1px solid rgba(0,0,0,0)}@media screen and (forced-colors: active){.mdc-dialog__actions{border-top-color:CanvasText}}.mdc-dialog--stacked .mdc-dialog__actions{flex-direction:column;align-items:flex-end}.mdc-dialog__button{margin-left:8px;margin-right:0;max-width:100%;text-align:right}[dir=rtl] .mdc-dialog__button,.mdc-dialog__button[dir=rtl]{margin-left:0;margin-right:8px}.mdc-dialog__button:first-child{margin-left:0;margin-right:0}[dir=rtl] .mdc-dialog__button:first-child,.mdc-dialog__button:first-child[dir=rtl]{margin-left:0;margin-right:0}[dir=rtl] .mdc-dialog__button,.mdc-dialog__button[dir=rtl]{text-align:left}.mdc-dialog--stacked .mdc-dialog__button:not(:first-child){margin-top:12px}.mdc-dialog--open,.mdc-dialog--opening,.mdc-dialog--closing{display:flex}.mdc-dialog--opening .mdc-dialog__scrim{transition:opacity 150ms linear}.mdc-dialog--opening .mdc-dialog__container{transition:opacity 75ms linear,transform 150ms 0ms cubic-bezier(0, 0, 0.2, 1)}.mdc-dialog--closing .mdc-dialog__scrim,.mdc-dialog--closing .mdc-dialog__container{transition:opacity 75ms linear}.mdc-dialog--closing .mdc-dialog__container{transform:none}.mdc-dialog--closing .mdc-dialog__surface{transform:none}.mdc-dialog--open .mdc-dialog__scrim{opacity:1}.mdc-dialog--open .mdc-dialog__container{opacity:1}.mdc-dialog--open .mdc-dialog__surface{transform:none}.mdc-dialog--open.mdc-dialog__surface-scrim--shown .mdc-dialog__surface-scrim{opacity:1}.mdc-dialog--open.mdc-dialog__surface-scrim--hiding .mdc-dialog__surface-scrim{transition:opacity 75ms linear}.mdc-dialog--open.mdc-dialog__surface-scrim--showing .mdc-dialog__surface-scrim{transition:opacity 150ms linear}.mdc-dialog__surface-scrim{display:none;opacity:0;position:absolute;width:100%;height:100%;z-index:1}.mdc-dialog__surface-scrim--shown .mdc-dialog__surface-scrim,.mdc-dialog__surface-scrim--showing .mdc-dialog__surface-scrim,.mdc-dialog__surface-scrim--hiding .mdc-dialog__surface-scrim{display:block}.mdc-dialog-scroll-lock{overflow:hidden}.mdc-dialog--no-content-padding .mdc-dialog__content{padding:0}.mdc-dialog--sheet .mdc-dialog__container .mdc-dialog__close{right:12px;top:9px;position:absolute;z-index:1}.mdc-dialog__scrim--removed{pointer-events:none}.mdc-dialog__scrim--removed .mdc-dialog__scrim,.mdc-dialog__scrim--removed .mdc-dialog__surface-scrim{display:none}.mat-mdc-dialog-content{max-height:65vh}.mat-mdc-dialog-container{position:static;display:block}.mat-mdc-dialog-container,.mat-mdc-dialog-container .mdc-dialog__container,.mat-mdc-dialog-container .mdc-dialog__surface{max-height:inherit;min-height:inherit;min-width:inherit;max-width:inherit}.mat-mdc-dialog-container .mdc-dialog__surface{width:100%;height:100%}.mat-mdc-dialog-component-host{display:contents}.mat-mdc-dialog-container{--mdc-dialog-container-elevation: var(--mdc-dialog-container-elevation-shadow);outline:0}.mat-mdc-dialog-container .mdc-dialog__surface{background-color:var(--mdc-dialog-container-color, white)}.mat-mdc-dialog-container .mdc-dialog__surface{box-shadow:var(--mdc-dialog-container-elevation, 0px 11px 15px -7px rgba(0, 0, 0, 0.2), 0px 24px 38px 3px rgba(0, 0, 0, 0.14), 0px 9px 46px 8px rgba(0, 0, 0, 0.12))}.mat-mdc-dialog-container .mdc-dialog__surface{border-radius:var(--mdc-dialog-container-shape, 4px)}.mat-mdc-dialog-container .mdc-dialog__title{font-family:var(--mdc-dialog-subhead-font, Roboto, sans-serif);line-height:var(--mdc-dialog-subhead-line-height, 1.5rem);font-size:var(--mdc-dialog-subhead-size, 1rem);font-weight:var(--mdc-dialog-subhead-weight, 400);letter-spacing:var(--mdc-dialog-subhead-tracking, 0.03125em)}.mat-mdc-dialog-container .mdc-dialog__title{color:var(--mdc-dialog-subhead-color, rgba(0, 0, 0, 0.87))}.mat-mdc-dialog-container .mdc-dialog__content{font-family:var(--mdc-dialog-supporting-text-font, Roboto, sans-serif);line-height:var(--mdc-dialog-supporting-text-line-height, 1.5rem);font-size:var(--mdc-dialog-supporting-text-size, 1rem);font-weight:var(--mdc-dialog-supporting-text-weight, 400);letter-spacing:var(--mdc-dialog-supporting-text-tracking, 0.03125em)}.mat-mdc-dialog-container .mdc-dialog__content{color:var(--mdc-dialog-supporting-text-color, rgba(0, 0, 0, 0.6))}.mat-mdc-dialog-container .mdc-dialog__container{transition:opacity linear var(--mat-dialog-transition-duration, 0ms)}.mat-mdc-dialog-container .mdc-dialog__surface{transition:transform var(--mat-dialog-transition-duration, 0ms) 0ms cubic-bezier(0, 0, 0.2, 1)}.mat-mdc-dialog-container._mat-animation-noopable .mdc-dialog__container,.mat-mdc-dialog-container._mat-animation-noopable .mdc-dialog__surface{transition:none}.cdk-overlay-pane.mat-mdc-dialog-panel{max-width:var(--mat-dialog-container-max-width, 80vw);min-width:var(--mat-dialog-container-min-width, 0)}@media(max-width: 599px){.cdk-overlay-pane.mat-mdc-dialog-panel{max-width:var(--mat-dialog-container-small-max-width, 80vw)}}.mat-mdc-dialog-title{padding:var(--mat-dialog-headline-padding, 0 24px 9px)}.mat-mdc-dialog-content{display:block}.mat-mdc-dialog-container .mat-mdc-dialog-content{padding:var(--mat-dialog-content-padding, 20px 24px)}.mat-mdc-dialog-container-with-actions .mat-mdc-dialog-content{padding:var(--mat-dialog-with-actions-content-padding, 20px 24px)}.mat-mdc-dialog-container .mat-mdc-dialog-title+.mat-mdc-dialog-content{padding-top:0}.mat-mdc-dialog-actions{padding:var(--mat-dialog-actions-padding, 8px);justify-content:var(--mat-dialog-actions-alignment, start)}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-start,.mat-mdc-dialog-actions[align=start]{justify-content:start}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-center,.mat-mdc-dialog-actions[align=center]{justify-content:center}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-end,.mat-mdc-dialog-actions[align=end]{justify-content:flex-end}.mat-mdc-dialog-actions .mat-button-base+.mat-button-base,.mat-mdc-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:8px}[dir=rtl] .mat-mdc-dialog-actions .mat-button-base+.mat-button-base,[dir=rtl] .mat-mdc-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:0;margin-right:8px}'],encapsulation:2});let o=e;return o})(),wC="--mat-dialog-transition-duration";function SC(o){return o==null?null:typeof o=="number"?o:o.endsWith("ms")?Tu(o.substring(0,o.length-2)):o.endsWith("s")?Tu(o.substring(0,o.length-1))*1e3:o==="0"?0:null}var o3=function(o){return o[o.OPEN=0]="OPEN",o[o.CLOSING=1]="CLOSING",o[o.CLOSED=2]="CLOSED",o}(o3||{}),S8=class{constructor(e,t,s){this._ref=e,this._containerInstance=s,this._afterOpened=new fn,this._beforeClosed=new fn,this._state=o3.OPEN,this.disableClose=t.disableClose,this.id=e.id,e.addPanelClass("mat-mdc-dialog-panel"),s._animationStateChanged.pipe(go(a=>a.state==="opened"),No(1)).subscribe(()=>{this._afterOpened.next(),this._afterOpened.complete()}),s._animationStateChanged.pipe(go(a=>a.state==="closed"),No(1)).subscribe(()=>{clearTimeout(this._closeFallbackTimeout),this._finishDialogClose()}),e.overlayRef.detachments().subscribe(()=>{this._beforeClosed.next(this._result),this._beforeClosed.complete(),this._finishDialogClose()}),rl(this.backdropClick(),this.keydownEvents().pipe(go(a=>a.keyCode===27&&!this.disableClose&&!Nh(a)))).subscribe(a=>{this.disableClose||(a.preventDefault(),DU(this,a.type==="keydown"?"keyboard":"mouse"))})}close(e){this._result=e,this._containerInstance._animationStateChanged.pipe(go(t=>t.state==="closing"),No(1)).subscribe(t=>{this._beforeClosed.next(e),this._beforeClosed.complete(),this._ref.overlayRef.detachBackdrop(),this._closeFallbackTimeout=setTimeout(()=>this._finishDialogClose(),t.totalTime+100)}),this._state=o3.CLOSING,this._containerInstance._startExitAnimation()}afterOpened(){return this._afterOpened}afterClosed(){return this._ref.closed}beforeClosed(){return this._beforeClosed}backdropClick(){return this._ref.backdropClick}keydownEvents(){return this._ref.keydownEvents}updatePosition(e){let t=this._ref.config.positionStrategy;return e&&(e.left||e.right)?e.left?t.left(e.left):t.right(e.right):t.centerHorizontally(),e&&(e.top||e.bottom)?e.top?t.top(e.top):t.bottom(e.bottom):t.centerVertically(),this._ref.updatePosition(),this}updateSize(e="",t=""){return this._ref.updateSize(e,t),this}addPanelClass(e){return this._ref.addPanelClass(e),this}removePanelClass(e){return this._ref.removePanelClass(e),this}getState(){return this._state}_finishDialogClose(){this._state=o3.CLOSED,this._ref.close(this._result,{focusOrigin:this._closeInteractionType}),this.componentInstance=null}};function DU(o,e,t){return o._closeInteractionType=e,o.close(t)}var T8=new Sn("MatMdcDialogData"),LU=new Sn("mat-mdc-dialog-default-options"),FU=new Sn("mat-mdc-dialog-scroll-strategy",{providedIn:"root",factory:()=>{let o=ai(sl);return()=>o.scrollStrategies.block()}});var OU=0,M8=(()=>{let e=class e{get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}_getAfterAllClosed(){let s=this._parentDialog;return s?s._getAfterAllClosed():this._afterAllClosedAtThisLevel}constructor(s,a,i,f,v,x,M,C){this._overlay=s,this._defaultOptions=f,this._scrollStrategy=v,this._parentDialog=x,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new fn,this._afterOpenedAtThisLevel=new fn,this.dialogConfigClass=hg,this.afterAllClosed=bu(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(Yo(void 0))),this._dialog=a.get(b8),this._dialogRefConstructor=S8,this._dialogContainerType=kU,this._dialogDataToken=T8}open(s,a){let i;a=Ti(Ti({},this._defaultOptions||new hg),a),a.id=a.id||`mat-mdc-dialog-${OU++}`,a.scrollStrategy=a.scrollStrategy||this._scrollStrategy();let f=this._dialog.open(s,Ns(Ti({},a),{positionStrategy:this._overlay.position().global().centerHorizontally().centerVertically(),disableClose:!0,closeOnDestroy:!1,closeOnOverlayDetachments:!1,container:{type:this._dialogContainerType,providers:()=>[{provide:this.dialogConfigClass,useValue:a},{provide:Cu,useValue:a}]},templateContext:()=>({dialogRef:i}),providers:(v,x,M)=>(i=new this._dialogRefConstructor(v,a,M),i.updatePosition(a?.position),[{provide:this._dialogContainerType,useValue:M},{provide:this._dialogDataToken,useValue:x.data},{provide:this._dialogRefConstructor,useValue:i}])}));return i.componentRef=f.componentRef,i.componentInstance=f.componentInstance,this.openDialogs.push(i),this.afterOpened.next(i),i.afterClosed().subscribe(()=>{let v=this.openDialogs.indexOf(i);v>-1&&(this.openDialogs.splice(v,1),this.openDialogs.length||this._getAfterAllClosed().next())}),i}closeAll(){this._closeDialogs(this.openDialogs)}getDialogById(s){return this.openDialogs.find(a=>a.id===s)}ngOnDestroy(){this._closeDialogs(this._openDialogsAtThisLevel),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete()}_closeDialogs(s){let a=s.length;for(;a--;)s[a].close()}};e.\u0275fac=function(a){return new(a||e)(Sr(sl),Sr(Jo),Sr(Su,8),Sr(LU,8),Sr(FU),Sr(e,12),Sr(O5),Sr(yo,8))},e.\u0275prov=jr({token:e,factory:e.\u0275fac,providedIn:"root"});let o=e;return o})();var TC=(()=>{let e=class e{};e.\u0275fac=function(a){return new(a||e)},e.\u0275dir=lr({type:e,selectors:[["","mat-dialog-content",""],["mat-dialog-content"],["","matDialogContent",""]],hostAttrs:[1,"mat-mdc-dialog-content","mdc-dialog__content"],standalone:!0});let o=e;return o})();var MC=(()=>{let e=class e{};e.\u0275fac=function(a){return new(a||e)},e.\u0275mod=ds({type:e}),e.\u0275inj=hs({providers:[M8],imports:[vC,Uh,C0,Ss,Ss]});let o=e;return o})();function C8(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var Pu=C8();function RC(o){Pu=o}var kC=/[&<>"']/,NU=new RegExp(kC.source,"g"),DC=/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,zU=new RegExp(DC.source,"g"),BU={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},EC=o=>BU[o];function al(o,e){if(e){if(kC.test(o))return o.replace(NU,EC)}else if(DC.test(o))return o.replace(zU,EC);return o}var UU=/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig;function VU(o){return o.replace(UU,(e,t)=>(t=t.toLowerCase(),t==="colon"?":":t.charAt(0)==="#"?t.charAt(1)==="x"?String.fromCharCode(parseInt(t.substring(2),16)):String.fromCharCode(+t.substring(1)):""))}var GU=/(^|[^\[])\^/g;function us(o,e){let t=typeof o=="string"?o:o.source;e=e||"";let s={replace:(a,i)=>{let f=typeof i=="string"?i:i.source;return f=f.replace(GU,"$1"),t=t.replace(a,f),s},getRegex:()=>new RegExp(t,e)};return s}function AC(o){try{o=encodeURI(o).replace(/%25/g,"%")}catch{return null}return o}var ug={exec:()=>null};function CC(o,e){let t=o.replace(/\|/g,(i,f,v)=>{let x=!1,M=f;for(;--M>=0&&v[M]==="\\";)x=!x;return x?"|":" |"}),s=t.split(/ \|/),a=0;if(s[0].trim()||s.shift(),s.length>0&&!s[s.length-1].trim()&&s.pop(),e)if(s.length>e)s.splice(e);else for(;s.length<e;)s.push("");for(;a<s.length;a++)s[a]=s[a].trim().replace(/\\\|/g,"|");return s}function a3(o,e,t){let s=o.length;if(s===0)return"";let a=0;for(;a<s;){let i=o.charAt(s-a-1);if(i===e&&!t)a++;else if(i!==e&&t)a++;else break}return o.slice(0,s-a)}function HU(o,e){if(o.indexOf(e[1])===-1)return-1;let t=0;for(let s=0;s<o.length;s++)if(o[s]==="\\")s++;else if(o[s]===e[0])t++;else if(o[s]===e[1]&&(t--,t<0))return s;return-1}function IC(o,e,t,s){let a=e.href,i=e.title?al(e.title):null,f=o[1].replace(/\\([\[\]])/g,"$1");if(o[0].charAt(0)!=="!"){s.state.inLink=!0;let v={type:"link",raw:t,href:a,title:i,text:f,tokens:s.inlineTokens(f)};return s.state.inLink=!1,v}return{type:"image",raw:t,href:a,title:i,text:al(f)}}function jU(o,e){let t=o.match(/^(\s+)(?:```)/);if(t===null)return e;let s=t[1];return e.split(`
`).map(a=>{let i=a.match(/^\s+/);if(i===null)return a;let[f]=i;return f.length>=s.length?a.slice(s.length):a}).join(`
`)}var I1=class{options;rules;lexer;constructor(e){this.options=e||Pu}space(e){let t=this.rules.block.newline.exec(e);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(e){let t=this.rules.block.code.exec(e);if(t){let s=t[0].replace(/^ {1,4}/gm,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?s:a3(s,`
`)}}}fences(e){let t=this.rules.block.fences.exec(e);if(t){let s=t[0],a=jU(s,t[3]||"");return{type:"code",raw:s,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):t[2],text:a}}}heading(e){let t=this.rules.block.heading.exec(e);if(t){let s=t[2].trim();if(/#$/.test(s)){let a=a3(s,"#");(this.options.pedantic||!a||/ $/.test(a))&&(s=a.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:s,tokens:this.lexer.inline(s)}}}hr(e){let t=this.rules.block.hr.exec(e);if(t)return{type:"hr",raw:t[0]}}blockquote(e){let t=this.rules.block.blockquote.exec(e);if(t){let s=a3(t[0].replace(/^ *>[ \t]?/gm,""),`
`),a=this.lexer.state.top;this.lexer.state.top=!0;let i=this.lexer.blockTokens(s);return this.lexer.state.top=a,{type:"blockquote",raw:t[0],tokens:i,text:s}}}list(e){let t=this.rules.block.list.exec(e);if(t){let s=t[1].trim(),a=s.length>1,i={type:"list",raw:"",ordered:a,start:a?+s.slice(0,-1):"",loose:!1,items:[]};s=a?`\\d{1,9}\\${s.slice(-1)}`:`\\${s}`,this.options.pedantic&&(s=a?s:"[*+-]");let f=new RegExp(`^( {0,3}${s})((?:[	 ][^\\n]*)?(?:\\n|$))`),v="",x="",M=!1;for(;e;){let C=!1;if(!(t=f.exec(e))||this.rules.block.hr.test(e))break;v=t[0],e=e.substring(v.length);let D=t[2].split(`
`,1)[0].replace(/^\t+/,H=>" ".repeat(3*H.length)),L=e.split(`
`,1)[0],N=0;this.options.pedantic?(N=2,x=D.trimStart()):(N=t[2].search(/[^ ]/),N=N>4?1:N,x=D.slice(N),N+=t[1].length);let j=!1;if(!D&&/^ *$/.test(L)&&(v+=L+`
`,e=e.substring(L.length+1),C=!0),!C){let H=new RegExp(`^ {0,${Math.min(3,N-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),me=new RegExp(`^ {0,${Math.min(3,N-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),ne=new RegExp(`^ {0,${Math.min(3,N-1)}}(?:\`\`\`|~~~)`),fe=new RegExp(`^ {0,${Math.min(3,N-1)}}#`);for(;e;){let Ee=e.split(`
`,1)[0];if(L=Ee,this.options.pedantic&&(L=L.replace(/^ {1,4}(?=( {4})*[^ ])/g,"  ")),ne.test(L)||fe.test(L)||H.test(L)||me.test(e))break;if(L.search(/[^ ]/)>=N||!L.trim())x+=`
`+L.slice(N);else{if(j||D.search(/[^ ]/)>=4||ne.test(D)||fe.test(D)||me.test(D))break;x+=`
`+L}!j&&!L.trim()&&(j=!0),v+=Ee+`
`,e=e.substring(Ee.length+1),D=L.slice(N)}}i.loose||(M?i.loose=!0:/\n *\n *$/.test(v)&&(M=!0));let Z=null,G;this.options.gfm&&(Z=/^\[[ xX]\] /.exec(x),Z&&(G=Z[0]!=="[ ] ",x=x.replace(/^\[[ xX]\] +/,""))),i.items.push({type:"list_item",raw:v,task:!!Z,checked:G,loose:!1,text:x,tokens:[]}),i.raw+=v}i.items[i.items.length-1].raw=v.trimEnd(),i.items[i.items.length-1].text=x.trimEnd(),i.raw=i.raw.trimEnd();for(let C=0;C<i.items.length;C++)if(this.lexer.state.top=!1,i.items[C].tokens=this.lexer.blockTokens(i.items[C].text,[]),!i.loose){let D=i.items[C].tokens.filter(N=>N.type==="space"),L=D.length>0&&D.some(N=>/\n.*\n/.test(N.raw));i.loose=L}if(i.loose)for(let C=0;C<i.items.length;C++)i.items[C].loose=!0;return i}}html(e){let t=this.rules.block.html.exec(e);if(t)return{type:"html",block:!0,raw:t[0],pre:t[1]==="pre"||t[1]==="script"||t[1]==="style",text:t[0]}}def(e){let t=this.rules.block.def.exec(e);if(t){let s=t[1].toLowerCase().replace(/\s+/g," "),a=t[2]?t[2].replace(/^<(.*)>$/,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",i=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):t[3];return{type:"def",tag:s,raw:t[0],href:a,title:i}}}table(e){let t=this.rules.block.table.exec(e);if(!t||!/[:|]/.test(t[2]))return;let s=CC(t[1]),a=t[2].replace(/^\||\| *$/g,"").split("|"),i=t[3]&&t[3].trim()?t[3].replace(/\n[ \t]*$/,"").split(`
`):[],f={type:"table",raw:t[0],header:[],align:[],rows:[]};if(s.length===a.length){for(let v of a)/^ *-+: *$/.test(v)?f.align.push("right"):/^ *:-+: *$/.test(v)?f.align.push("center"):/^ *:-+ *$/.test(v)?f.align.push("left"):f.align.push(null);for(let v of s)f.header.push({text:v,tokens:this.lexer.inline(v)});for(let v of i)f.rows.push(CC(v,f.header.length).map(x=>({text:x,tokens:this.lexer.inline(x)})));return f}}lheading(e){let t=this.rules.block.lheading.exec(e);if(t)return{type:"heading",raw:t[0],depth:t[2].charAt(0)==="="?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(e){let t=this.rules.block.paragraph.exec(e);if(t){let s=t[1].charAt(t[1].length-1)===`
`?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:s,tokens:this.lexer.inline(s)}}}text(e){let t=this.rules.block.text.exec(e);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(e){let t=this.rules.inline.escape.exec(e);if(t)return{type:"escape",raw:t[0],text:al(t[1])}}tag(e){let t=this.rules.inline.tag.exec(e);if(t)return!this.lexer.state.inLink&&/^<a /i.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\/a>/i.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(e){let t=this.rules.inline.link.exec(e);if(t){let s=t[2].trim();if(!this.options.pedantic&&/^</.test(s)){if(!/>$/.test(s))return;let f=a3(s.slice(0,-1),"\\");if((s.length-f.length)%2===0)return}else{let f=HU(t[2],"()");if(f>-1){let x=(t[0].indexOf("!")===0?5:4)+t[1].length+f;t[2]=t[2].substring(0,f),t[0]=t[0].substring(0,x).trim(),t[3]=""}}let a=t[2],i="";if(this.options.pedantic){let f=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(a);f&&(a=f[1],i=f[3])}else i=t[3]?t[3].slice(1,-1):"";return a=a.trim(),/^</.test(a)&&(this.options.pedantic&&!/>$/.test(s)?a=a.slice(1):a=a.slice(1,-1)),IC(t,{href:a&&a.replace(this.rules.inline.anyPunctuation,"$1"),title:i&&i.replace(this.rules.inline.anyPunctuation,"$1")},t[0],this.lexer)}}reflink(e,t){let s;if((s=this.rules.inline.reflink.exec(e))||(s=this.rules.inline.nolink.exec(e))){let a=(s[2]||s[1]).replace(/\s+/g," "),i=t[a.toLowerCase()];if(!i){let f=s[0].charAt(0);return{type:"text",raw:f,text:f}}return IC(s,i,s[0],this.lexer)}}emStrong(e,t,s=""){let a=this.rules.inline.emStrongLDelim.exec(e);if(!a||a[3]&&s.match(/[\p{L}\p{N}]/u))return;if(!(a[1]||a[2]||"")||!s||this.rules.inline.punctuation.exec(s)){let f=[...a[0]].length-1,v,x,M=f,C=0,D=a[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(D.lastIndex=0,t=t.slice(-1*e.length+f);(a=D.exec(t))!=null;){if(v=a[1]||a[2]||a[3]||a[4]||a[5]||a[6],!v)continue;if(x=[...v].length,a[3]||a[4]){M+=x;continue}else if((a[5]||a[6])&&f%3&&!((f+x)%3)){C+=x;continue}if(M-=x,M>0)continue;x=Math.min(x,x+M+C);let L=[...a[0]][0].length,N=e.slice(0,f+a.index+L+x);if(Math.min(f,x)%2){let Z=N.slice(1,-1);return{type:"em",raw:N,text:Z,tokens:this.lexer.inlineTokens(Z)}}let j=N.slice(2,-2);return{type:"strong",raw:N,text:j,tokens:this.lexer.inlineTokens(j)}}}}codespan(e){let t=this.rules.inline.code.exec(e);if(t){let s=t[2].replace(/\n/g," "),a=/[^ ]/.test(s),i=/^ /.test(s)&&/ $/.test(s);return a&&i&&(s=s.substring(1,s.length-1)),s=al(s,!0),{type:"codespan",raw:t[0],text:s}}}br(e){let t=this.rules.inline.br.exec(e);if(t)return{type:"br",raw:t[0]}}del(e){let t=this.rules.inline.del.exec(e);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(e){let t=this.rules.inline.autolink.exec(e);if(t){let s,a;return t[2]==="@"?(s=al(t[1]),a="mailto:"+s):(s=al(t[1]),a=s),{type:"link",raw:t[0],text:s,href:a,tokens:[{type:"text",raw:s,text:s}]}}}url(e){let t;if(t=this.rules.inline.url.exec(e)){let s,a;if(t[2]==="@")s=al(t[0]),a="mailto:"+s;else{let i;do i=t[0],t[0]=this.rules.inline._backpedal.exec(t[0])?.[0]??"";while(i!==t[0]);s=al(t[0]),t[1]==="www."?a="http://"+t[0]:a=t[0]}return{type:"link",raw:t[0],text:s,href:a,tokens:[{type:"text",raw:s,text:s}]}}}inlineText(e){let t=this.rules.inline.text.exec(e);if(t){let s;return this.lexer.state.inRawBlock?s=t[0]:s=al(t[0]),{type:"text",raw:t[0],text:s}}}},WU=/^(?: *(?:\n|$))+/,qU=/^( {4}[^\n]+(?:\n(?: *(?:\n|$))*)?)+/,XU=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,fg=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,ZU=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,LC=/(?:[*+-]|\d{1,9}[.)])/,FC=us(/^(?!bull |blockCode|fences|blockquote|heading|html)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html))+?)\n {0,3}(=+|-+) *(?:\n+|$)/).replace(/bull/g,LC).replace(/blockCode/g,/ {4}/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).getRegex(),I8=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,$U=/^[^\n]+/,P8=/(?!\s*\])(?:\\.|[^\[\]\\])+/,YU=us(/^ {0,3}\[(label)\]: *(?:\n *)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n *)?| *\n *)(title))? *(?:\n+|$)/).replace("label",P8).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),JU=us(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,LC).getRegex(),h3="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",R8=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,KU=us("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n *)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$))","i").replace("comment",R8).replace("tag",h3).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),OC=us(I8).replace("hr",fg).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",h3).getRegex(),QU=us(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",OC).getRegex(),k8={blockquote:QU,code:qU,def:YU,fences:XU,heading:ZU,hr:fg,html:KU,lheading:FC,list:JU,newline:WU,paragraph:OC,table:ug,text:$U},PC=us("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",fg).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",h3).getRegex(),eV=Ns(Ti({},k8),{table:PC,paragraph:us(I8).replace("hr",fg).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",PC).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",h3).getRegex()}),tV=Ns(Ti({},k8),{html:us(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",R8).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:ug,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:us(I8).replace("hr",fg).replace("heading",` *#{1,6} *[^
]`).replace("lheading",FC).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()}),NC=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,iV=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,zC=/^( {2,}|\\)\n(?!\s*$)/,nV=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,mg="\\p{P}\\p{S}",rV=us(/^((?![*_])[\spunctuation])/,"u").replace(/punctuation/g,mg).getRegex(),sV=/\[[^[\]]*?\]\([^\(\)]*?\)|`[^`]*?`|<[^<>]*?>/g,oV=us(/^(?:\*+(?:((?!\*)[punct])|[^\s*]))|^_+(?:((?!_)[punct])|([^\s_]))/,"u").replace(/punct/g,mg).getRegex(),aV=us("^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)[punct](\\*+)(?=[\\s]|$)|[^punct\\s](\\*+)(?!\\*)(?=[punct\\s]|$)|(?!\\*)[punct\\s](\\*+)(?=[^punct\\s])|[\\s](\\*+)(?!\\*)(?=[punct])|(?!\\*)[punct](\\*+)(?!\\*)(?=[punct])|[^punct\\s](\\*+)(?=[^punct\\s])","gu").replace(/punct/g,mg).getRegex(),lV=us("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)[punct](_+)(?=[\\s]|$)|[^punct\\s](_+)(?!_)(?=[punct\\s]|$)|(?!_)[punct\\s](_+)(?=[^punct\\s])|[\\s](_+)(?!_)(?=[punct])|(?!_)[punct](_+)(?!_)(?=[punct])","gu").replace(/punct/g,mg).getRegex(),cV=us(/\\([punct])/,"gu").replace(/punct/g,mg).getRegex(),hV=us(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),dV=us(R8).replace("(?:-->|$)","-->").getRegex(),uV=us("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",dV).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),c3=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,pV=us(/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/).replace("label",c3).replace("href",/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),BC=us(/^!?\[(label)\]\[(ref)\]/).replace("label",c3).replace("ref",P8).getRegex(),UC=us(/^!?\[(ref)\](?:\[\])?/).replace("ref",P8).getRegex(),fV=us("reflink|nolink(?!\\()","g").replace("reflink",BC).replace("nolink",UC).getRegex(),D8={_backpedal:ug,anyPunctuation:cV,autolink:hV,blockSkip:sV,br:zC,code:iV,del:ug,emStrongLDelim:oV,emStrongRDelimAst:aV,emStrongRDelimUnd:lV,escape:NC,link:pV,nolink:UC,punctuation:rV,reflink:BC,reflinkSearch:fV,tag:uV,text:nV,url:ug},mV=Ns(Ti({},D8),{link:us(/^!?\[(label)\]\((.*?)\)/).replace("label",c3).getRegex(),reflink:us(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",c3).getRegex()}),E8=Ns(Ti({},D8),{escape:us(NC).replace("])","~|])").getRegex(),url:us(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])([\s\S]*?[^\s~])\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/}),gV=Ns(Ti({},E8),{br:us(zC).replace("{2,}","*").getRegex(),text:us(E8.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()}),l3={normal:k8,gfm:eV,pedantic:tV},dg={normal:D8,gfm:E8,breaks:gV,pedantic:mV},P0=class o{tokens;options;state;tokenizer;inlineQueue;constructor(e){this.tokens=[],this.tokens.links=Object.create(null),this.options=e||Pu,this.options.tokenizer=this.options.tokenizer||new I1,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let t={block:l3.normal,inline:dg.normal};this.options.pedantic?(t.block=l3.pedantic,t.inline=dg.pedantic):this.options.gfm&&(t.block=l3.gfm,this.options.breaks?t.inline=dg.breaks:t.inline=dg.gfm),this.tokenizer.rules=t}static get rules(){return{block:l3,inline:dg}}static lex(e,t){return new o(t).lex(e)}static lexInline(e,t){return new o(t).inlineTokens(e)}lex(e){e=e.replace(/\r\n|\r/g,`
`),this.blockTokens(e,this.tokens);for(let t=0;t<this.inlineQueue.length;t++){let s=this.inlineQueue[t];this.inlineTokens(s.src,s.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,t=[]){this.options.pedantic?e=e.replace(/\t/g,"    ").replace(/^ +$/gm,""):e=e.replace(/^( *)(\t+)/gm,(v,x,M)=>x+"    ".repeat(M.length));let s,a,i,f;for(;e;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some(v=>(s=v.call({lexer:this},e,t))?(e=e.substring(s.raw.length),t.push(s),!0):!1))){if(s=this.tokenizer.space(e)){e=e.substring(s.raw.length),s.raw.length===1&&t.length>0?t[t.length-1].raw+=`
`:t.push(s);continue}if(s=this.tokenizer.code(e)){e=e.substring(s.raw.length),a=t[t.length-1],a&&(a.type==="paragraph"||a.type==="text")?(a.raw+=`
`+s.raw,a.text+=`
`+s.text,this.inlineQueue[this.inlineQueue.length-1].src=a.text):t.push(s);continue}if(s=this.tokenizer.fences(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.heading(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.hr(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.blockquote(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.list(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.html(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.def(e)){e=e.substring(s.raw.length),a=t[t.length-1],a&&(a.type==="paragraph"||a.type==="text")?(a.raw+=`
`+s.raw,a.text+=`
`+s.raw,this.inlineQueue[this.inlineQueue.length-1].src=a.text):this.tokens.links[s.tag]||(this.tokens.links[s.tag]={href:s.href,title:s.title});continue}if(s=this.tokenizer.table(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.lheading(e)){e=e.substring(s.raw.length),t.push(s);continue}if(i=e,this.options.extensions&&this.options.extensions.startBlock){let v=1/0,x=e.slice(1),M;this.options.extensions.startBlock.forEach(C=>{M=C.call({lexer:this},x),typeof M=="number"&&M>=0&&(v=Math.min(v,M))}),v<1/0&&v>=0&&(i=e.substring(0,v+1))}if(this.state.top&&(s=this.tokenizer.paragraph(i))){a=t[t.length-1],f&&a.type==="paragraph"?(a.raw+=`
`+s.raw,a.text+=`
`+s.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=a.text):t.push(s),f=i.length!==e.length,e=e.substring(s.raw.length);continue}if(s=this.tokenizer.text(e)){e=e.substring(s.raw.length),a=t[t.length-1],a&&a.type==="text"?(a.raw+=`
`+s.raw,a.text+=`
`+s.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=a.text):t.push(s);continue}if(e){let v="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(v);break}else throw new Error(v)}}return this.state.top=!0,t}inline(e,t=[]){return this.inlineQueue.push({src:e,tokens:t}),t}inlineTokens(e,t=[]){let s,a,i,f=e,v,x,M;if(this.tokens.links){let C=Object.keys(this.tokens.links);if(C.length>0)for(;(v=this.tokenizer.rules.inline.reflinkSearch.exec(f))!=null;)C.includes(v[0].slice(v[0].lastIndexOf("[")+1,-1))&&(f=f.slice(0,v.index)+"["+"a".repeat(v[0].length-2)+"]"+f.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(v=this.tokenizer.rules.inline.blockSkip.exec(f))!=null;)f=f.slice(0,v.index)+"["+"a".repeat(v[0].length-2)+"]"+f.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;(v=this.tokenizer.rules.inline.anyPunctuation.exec(f))!=null;)f=f.slice(0,v.index)+"++"+f.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;e;)if(x||(M=""),x=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some(C=>(s=C.call({lexer:this},e,t))?(e=e.substring(s.raw.length),t.push(s),!0):!1))){if(s=this.tokenizer.escape(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.tag(e)){e=e.substring(s.raw.length),a=t[t.length-1],a&&s.type==="text"&&a.type==="text"?(a.raw+=s.raw,a.text+=s.text):t.push(s);continue}if(s=this.tokenizer.link(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(s.raw.length),a=t[t.length-1],a&&s.type==="text"&&a.type==="text"?(a.raw+=s.raw,a.text+=s.text):t.push(s);continue}if(s=this.tokenizer.emStrong(e,f,M)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.codespan(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.br(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.del(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.autolink(e)){e=e.substring(s.raw.length),t.push(s);continue}if(!this.state.inLink&&(s=this.tokenizer.url(e))){e=e.substring(s.raw.length),t.push(s);continue}if(i=e,this.options.extensions&&this.options.extensions.startInline){let C=1/0,D=e.slice(1),L;this.options.extensions.startInline.forEach(N=>{L=N.call({lexer:this},D),typeof L=="number"&&L>=0&&(C=Math.min(C,L))}),C<1/0&&C>=0&&(i=e.substring(0,C+1))}if(s=this.tokenizer.inlineText(i)){e=e.substring(s.raw.length),s.raw.slice(-1)!=="_"&&(M=s.raw.slice(-1)),x=!0,a=t[t.length-1],a&&a.type==="text"?(a.raw+=s.raw,a.text+=s.text):t.push(s);continue}if(e){let C="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(C);break}else throw new Error(C)}}return t}},P1=class{options;constructor(e){this.options=e||Pu}code(e,t,s){let a=(t||"").match(/^\S*/)?.[0];return e=e.replace(/\n$/,"")+`
`,a?'<pre><code class="language-'+al(a)+'">'+(s?e:al(e,!0))+`</code></pre>
`:"<pre><code>"+(s?e:al(e,!0))+`</code></pre>
`}blockquote(e){return`<blockquote>
${e}</blockquote>
`}html(e,t){return e}heading(e,t,s){return`<h${t}>${e}</h${t}>
`}hr(){return`<hr>
`}list(e,t,s){let a=t?"ol":"ul",i=t&&s!==1?' start="'+s+'"':"";return"<"+a+i+`>
`+e+"</"+a+`>
`}listitem(e,t,s){return`<li>${e}</li>
`}checkbox(e){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph(e){return`<p>${e}</p>
`}table(e,t){return t&&(t=`<tbody>${t}</tbody>`),`<table>
<thead>
`+e+`</thead>
`+t+`</table>
`}tablerow(e){return`<tr>
${e}</tr>
`}tablecell(e,t){let s=t.header?"th":"td";return(t.align?`<${s} align="${t.align}">`:`<${s}>`)+e+`</${s}>
`}strong(e){return`<strong>${e}</strong>`}em(e){return`<em>${e}</em>`}codespan(e){return`<code>${e}</code>`}br(){return"<br>"}del(e){return`<del>${e}</del>`}link(e,t,s){let a=AC(e);if(a===null)return s;e=a;let i='<a href="'+e+'"';return t&&(i+=' title="'+t+'"'),i+=">"+s+"</a>",i}image(e,t,s){let a=AC(e);if(a===null)return s;e=a;let i=`<img src="${e}" alt="${s}"`;return t&&(i+=` title="${t}"`),i+=">",i}text(e){return e}},pg=class{strong(e){return e}em(e){return e}codespan(e){return e}del(e){return e}html(e){return e}text(e){return e}link(e,t,s){return""+s}image(e,t,s){return""+s}br(){return""}},R0=class o{options;renderer;textRenderer;constructor(e){this.options=e||Pu,this.options.renderer=this.options.renderer||new P1,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new pg}static parse(e,t){return new o(t).parse(e)}static parseInline(e,t){return new o(t).parseInline(e)}parse(e,t=!0){let s="";for(let a=0;a<e.length;a++){let i=e[a];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[i.type]){let f=i,v=this.options.extensions.renderers[f.type].call({parser:this},f);if(v!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(f.type)){s+=v||"";continue}}switch(i.type){case"space":continue;case"hr":{s+=this.renderer.hr();continue}case"heading":{let f=i;s+=this.renderer.heading(this.parseInline(f.tokens),f.depth,VU(this.parseInline(f.tokens,this.textRenderer)));continue}case"code":{let f=i;s+=this.renderer.code(f.text,f.lang,!!f.escaped);continue}case"table":{let f=i,v="",x="";for(let C=0;C<f.header.length;C++)x+=this.renderer.tablecell(this.parseInline(f.header[C].tokens),{header:!0,align:f.align[C]});v+=this.renderer.tablerow(x);let M="";for(let C=0;C<f.rows.length;C++){let D=f.rows[C];x="";for(let L=0;L<D.length;L++)x+=this.renderer.tablecell(this.parseInline(D[L].tokens),{header:!1,align:f.align[L]});M+=this.renderer.tablerow(x)}s+=this.renderer.table(v,M);continue}case"blockquote":{let f=i,v=this.parse(f.tokens);s+=this.renderer.blockquote(v);continue}case"list":{let f=i,v=f.ordered,x=f.start,M=f.loose,C="";for(let D=0;D<f.items.length;D++){let L=f.items[D],N=L.checked,j=L.task,Z="";if(L.task){let G=this.renderer.checkbox(!!N);M?L.tokens.length>0&&L.tokens[0].type==="paragraph"?(L.tokens[0].text=G+" "+L.tokens[0].text,L.tokens[0].tokens&&L.tokens[0].tokens.length>0&&L.tokens[0].tokens[0].type==="text"&&(L.tokens[0].tokens[0].text=G+" "+L.tokens[0].tokens[0].text)):L.tokens.unshift({type:"text",text:G+" "}):Z+=G+" "}Z+=this.parse(L.tokens,M),C+=this.renderer.listitem(Z,j,!!N)}s+=this.renderer.list(C,v,x);continue}case"html":{let f=i;s+=this.renderer.html(f.text,f.block);continue}case"paragraph":{let f=i;s+=this.renderer.paragraph(this.parseInline(f.tokens));continue}case"text":{let f=i,v=f.tokens?this.parseInline(f.tokens):f.text;for(;a+1<e.length&&e[a+1].type==="text";)f=e[++a],v+=`
`+(f.tokens?this.parseInline(f.tokens):f.text);s+=t?this.renderer.paragraph(v):v;continue}default:{let f='Token with "'+i.type+'" type was not found.';if(this.options.silent)return console.error(f),"";throw new Error(f)}}}return s}parseInline(e,t){t=t||this.renderer;let s="";for(let a=0;a<e.length;a++){let i=e[a];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[i.type]){let f=this.options.extensions.renderers[i.type].call({parser:this},i);if(f!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(i.type)){s+=f||"";continue}}switch(i.type){case"escape":{let f=i;s+=t.text(f.text);break}case"html":{let f=i;s+=t.html(f.text);break}case"link":{let f=i;s+=t.link(f.href,f.title,this.parseInline(f.tokens,t));break}case"image":{let f=i;s+=t.image(f.href,f.title,f.text);break}case"strong":{let f=i;s+=t.strong(this.parseInline(f.tokens,t));break}case"em":{let f=i;s+=t.em(this.parseInline(f.tokens,t));break}case"codespan":{let f=i;s+=t.codespan(f.text);break}case"br":{s+=t.br();break}case"del":{let f=i;s+=t.del(this.parseInline(f.tokens,t));break}case"text":{let f=i;s+=t.text(f.text);break}default:{let f='Token with "'+i.type+'" type was not found.';if(this.options.silent)return console.error(f),"";throw new Error(f)}}}return s}},C1=class{options;constructor(e){this.options=e||Pu}static passThroughHooks=new Set(["preprocess","postprocess","processAllTokens"]);preprocess(e){return e}postprocess(e){return e}processAllTokens(e){return e}},A8=class{defaults=C8();options=this.setOptions;parse=this.#e(P0.lex,R0.parse);parseInline=this.#e(P0.lexInline,R0.parseInline);Parser=R0;Renderer=P1;TextRenderer=pg;Lexer=P0;Tokenizer=I1;Hooks=C1;constructor(...e){this.use(...e)}walkTokens(e,t){let s=[];for(let a of e)switch(s=s.concat(t.call(this,a)),a.type){case"table":{let i=a;for(let f of i.header)s=s.concat(this.walkTokens(f.tokens,t));for(let f of i.rows)for(let v of f)s=s.concat(this.walkTokens(v.tokens,t));break}case"list":{let i=a;s=s.concat(this.walkTokens(i.items,t));break}default:{let i=a;this.defaults.extensions?.childTokens?.[i.type]?this.defaults.extensions.childTokens[i.type].forEach(f=>{let v=i[f].flat(1/0);s=s.concat(this.walkTokens(v,t))}):i.tokens&&(s=s.concat(this.walkTokens(i.tokens,t)))}}return s}use(...e){let t=this.defaults.extensions||{renderers:{},childTokens:{}};return e.forEach(s=>{let a=Ti({},s);if(a.async=this.defaults.async||a.async||!1,s.extensions&&(s.extensions.forEach(i=>{if(!i.name)throw new Error("extension name required");if("renderer"in i){let f=t.renderers[i.name];f?t.renderers[i.name]=function(...v){let x=i.renderer.apply(this,v);return x===!1&&(x=f.apply(this,v)),x}:t.renderers[i.name]=i.renderer}if("tokenizer"in i){if(!i.level||i.level!=="block"&&i.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let f=t[i.level];f?f.unshift(i.tokenizer):t[i.level]=[i.tokenizer],i.start&&(i.level==="block"?t.startBlock?t.startBlock.push(i.start):t.startBlock=[i.start]:i.level==="inline"&&(t.startInline?t.startInline.push(i.start):t.startInline=[i.start]))}"childTokens"in i&&i.childTokens&&(t.childTokens[i.name]=i.childTokens)}),a.extensions=t),s.renderer){let i=this.defaults.renderer||new P1(this.defaults);for(let f in s.renderer){if(!(f in i))throw new Error(`renderer '${f}' does not exist`);if(f==="options")continue;let v=f,x=s.renderer[v],M=i[v];i[v]=(...C)=>{let D=x.apply(i,C);return D===!1&&(D=M.apply(i,C)),D||""}}a.renderer=i}if(s.tokenizer){let i=this.defaults.tokenizer||new I1(this.defaults);for(let f in s.tokenizer){if(!(f in i))throw new Error(`tokenizer '${f}' does not exist`);if(["options","rules","lexer"].includes(f))continue;let v=f,x=s.tokenizer[v],M=i[v];i[v]=(...C)=>{let D=x.apply(i,C);return D===!1&&(D=M.apply(i,C)),D}}a.tokenizer=i}if(s.hooks){let i=this.defaults.hooks||new C1;for(let f in s.hooks){if(!(f in i))throw new Error(`hook '${f}' does not exist`);if(f==="options")continue;let v=f,x=s.hooks[v],M=i[v];C1.passThroughHooks.has(f)?i[v]=C=>{if(this.defaults.async)return Promise.resolve(x.call(i,C)).then(L=>M.call(i,L));let D=x.call(i,C);return M.call(i,D)}:i[v]=(...C)=>{let D=x.apply(i,C);return D===!1&&(D=M.apply(i,C)),D}}a.hooks=i}if(s.walkTokens){let i=this.defaults.walkTokens,f=s.walkTokens;a.walkTokens=function(v){let x=[];return x.push(f.call(this,v)),i&&(x=x.concat(i.call(this,v))),x}}this.defaults=Ti(Ti({},this.defaults),a)}),this}setOptions(e){return this.defaults=Ti(Ti({},this.defaults),e),this}lexer(e,t){return P0.lex(e,t??this.defaults)}parser(e,t){return R0.parse(e,t??this.defaults)}#e(e,t){return(s,a)=>{let i=Ti({},a),f=Ti(Ti({},this.defaults),i);this.defaults.async===!0&&i.async===!1&&(f.silent||console.warn("marked(): The async option was set to true by an extension. The async: false option sent to parse will be ignored."),f.async=!0);let v=this.#t(!!f.silent,!!f.async);if(typeof s>"u"||s===null)return v(new Error("marked(): input parameter is undefined or null"));if(typeof s!="string")return v(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(s)+", string expected"));if(f.hooks&&(f.hooks.options=f),f.async)return Promise.resolve(f.hooks?f.hooks.preprocess(s):s).then(x=>e(x,f)).then(x=>f.hooks?f.hooks.processAllTokens(x):x).then(x=>f.walkTokens?Promise.all(this.walkTokens(x,f.walkTokens)).then(()=>x):x).then(x=>t(x,f)).then(x=>f.hooks?f.hooks.postprocess(x):x).catch(v);try{f.hooks&&(s=f.hooks.preprocess(s));let x=e(s,f);f.hooks&&(x=f.hooks.processAllTokens(x)),f.walkTokens&&this.walkTokens(x,f.walkTokens);let M=t(x,f);return f.hooks&&(M=f.hooks.postprocess(M)),M}catch(x){return v(x)}}}#t(e,t){return s=>{if(s.message+=`
Please report this to https://github.com/markedjs/marked.`,e){let a="<p>An error occurred:</p><pre>"+al(s.message+"",!0)+"</pre>";return t?Promise.resolve(a):a}if(t)return Promise.reject(s);throw s}}},Iu=new A8;function ns(o,e){return Iu.parse(o,e)}ns.options=ns.setOptions=function(o){return Iu.setOptions(o),ns.defaults=Iu.defaults,RC(ns.defaults),ns};ns.getDefaults=C8;ns.defaults=Pu;ns.use=function(...o){return Iu.use(...o),ns.defaults=Iu.defaults,RC(ns.defaults),ns};ns.walkTokens=function(o,e){return Iu.walkTokens(o,e)};ns.parseInline=Iu.parseInline;ns.Parser=R0;ns.parser=R0.parse;ns.Renderer=P1;ns.TextRenderer=pg;ns.Lexer=P0;ns.lexer=P0.lex;ns.Tokenizer=I1;ns.Hooks=C1;ns.parse=ns;var sre=ns.options,ore=ns.setOptions,are=ns.use,lre=ns.walkTokens,cre=ns.parseInline;var hre=R0.parse,dre=P0.lex;function _V(o,e){if(o&1&&(xt(0,"h2",2),Bi(1),It()),o&2){let t=di();Ct(),Or(t.data.title)}}var VC=(()=>{let e=class e{constructor(s){this.data=s,this.htmlContent="",this._parseMarkdown()}_parseMarkdown(){return yr(this,null,function*(){this.htmlContent=yield ns.parse(this.data.content)})}};e.\u0275fac=function(a){return new(a||e)(Et(T8))},e.\u0275cmp=$i({type:e,selectors:[["lib-md-dialog"]],standalone:!0,features:[Yi],decls:2,vars:2,consts:[["class","title","mat-dialog-title","",4,"ngIf"],[1,"mat-typography",3,"innerHTML"],["mat-dialog-title","",1,"title"]],template:function(a,i){a&1&&(ln(0,_V,2,1,"h2",0),Ln(1,"mat-dialog-content",1)),a&2&&(si("ngIf",i.data.title),Ct(),si("innerHTML",i.htmlContent,fE))},dependencies:[_r,Ds,TC],styles:["[_nghost-%COMP%]     h2{margin-top:25px;font-size:1.6em;line-height:1.1em}[_nghost-%COMP%]     h3{margin-top:10px;font-size:1.2em;line-height:1em}[_nghost-%COMP%]     a{all:unset;text-decoration:underline dotted;cursor:pointer}.title[_ngcontent-%COMP%]{padding-top:25px;padding-left:25px}"]});let o=e;return o})();function yV(o,e){if(o&1&&(xt(0,"mat-option",8),Bi(1),It()),o&2){let t=e.$implicit;si("value",t),Ct(),Or(t)}}function vV(o,e){if(o&1){let t=vr();xt(0,"mat-select",7),zi("ngModelChange",function(a){Pn(t);let i=di(2);return Rn(i.seletcedLanguage=a)})("selectionChange",function(){Pn(t);let a=di(2);return Rn(a.changedLanguage.emit(a.seletcedLanguage))}),Js(1,yV,2,2,"mat-option",8,Ko),It()}if(o&2){let t=di(2);si("ngModel",t.seletcedLanguage),Ct(),Ks(t.languageOptions)}}function xV(o,e){if(o&1){let t=vr();xt(0,"div",null,3)(2,"div",4)(3,"button",5),zi("click",function(){Pn(t);let a=di();return Rn(a.showInfo())}),xt(4,"mat-icon"),Bi(5,"info_outline"),It()(),ln(6,vV,3,1,"mat-select",6),It()()}if(o&2){let t=di();Ct(6),si("ngIf",t.languageOptions.length)}}var bV=["*"],GC=(()=>{let e=class e{constructor(){this._themeService=ai(Xc),this.dialog=ai(M8),this.title="",this.info="",this.languageOptions=[],this.seletcedLanguage=this.languageOptions[0],this.changedLanguage=new mn,this.darkMode=this._themeService.darkMode,this.logoPath=Yl(()=>this.darkMode()?"./assets/logo_dark.svg":"./assets/logo.svg")}showInfo(){this.dialog.open(VC,{data:{content:this.info}})}};e.\u0275fac=function(a){return new(a||e)},e.\u0275cmp=$i({type:e,selectors:[["lib-ng-demo-layout"]],inputs:{title:"title",info:"info",languageOptions:"languageOptions",seletcedLanguage:"seletcedLanguage"},outputs:{changedLanguage:"changedLanguage"},standalone:!0,features:[Yi],ngContentSelectors:bV,decls:5,vars:4,consts:[[3,"logo","title"],[3,"showProfileMenu"],[4,"ngIf"],["iconsAfter",""],[1,"actions"],["mat-icon-button","","aria-label","Show info",1,"btn",3,"click"],["style","text-align: right; width: 85px; margin-left: -30px;",3,"ngModel","ngModelChange","selectionChange",4,"ngIf"],[2,"text-align","right","width","85px","margin-left","-30px",3,"ngModel","ngModelChange","selectionChange"],[3,"value"]],template:function(a,i){a&1&&(ks(),Ln(0,"lib-ng-left-toolbar",0),xt(1,"lib-ng-right-toolbar",1),ln(2,xV,7,1,"div",2),It(),xt(3,"lib-standard-page"),Pr(4),It()),a&2&&(si("logo",i.logoPath())("title",i.title),Ct(),si("showProfileMenu",!1),Ct(),si("ngIf",i.info))},dependencies:[_r,Ds,sC,gC,_C,Eo,Na,ho,Hh,MC,Gh,Vh,zh,Oh,Lh,Fh],styles:["lib-ng-left-toolbar[_ngcontent-%COMP%]{position:absolute;top:20px;left:20px;height:50px}lib-ng-right-toolbar[_ngcontent-%COMP%]{position:absolute;top:20px;right:20px;height:50px}.content[_ngcontent-%COMP%]{position:absolute;inset:0;display:flex;justify-content:center;align-items:center}.actions[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;gap:10px}"]});let o=e;return o})();var SV=0,L8=new Sn("CdkAccordion"),HC=(()=>{let e=class e{constructor(){this._stateChanges=new fn,this._openCloseAllActions=new fn,this.id=`cdk-accordion-${SV++}`,this.multi=!1}openAll(){this.multi&&this._openCloseAllActions.next(!0)}closeAll(){this._openCloseAllActions.next(!1)}ngOnChanges(s){this._stateChanges.next(s)}ngOnDestroy(){this._stateChanges.complete(),this._openCloseAllActions.complete()}};e.\u0275fac=function(a){return new(a||e)},e.\u0275dir=lr({type:e,selectors:[["cdk-accordion"],["","cdkAccordion",""]],inputs:{multi:[wn.HasDecoratorInputTransform,"multi","multi",Wr]},exportAs:["cdkAccordion"],standalone:!0,features:[Qs([{provide:L8,useExisting:e}]),Es,Ms]});let o=e;return o})(),TV=0,jC=(()=>{let e=class e{get expanded(){return this._expanded}set expanded(s){if(this._expanded!==s){if(this._expanded=s,this.expandedChange.emit(s),s){this.opened.emit();let a=this.accordion?this.accordion.id:this.id;this._expansionDispatcher.notify(this.id,a)}else this.closed.emit();this._changeDetectorRef.markForCheck()}}constructor(s,a,i){this.accordion=s,this._changeDetectorRef=a,this._expansionDispatcher=i,this._openCloseAllSubscription=lo.EMPTY,this.closed=new mn,this.opened=new mn,this.destroyed=new mn,this.expandedChange=new mn,this.id=`cdk-accordion-child-${TV++}`,this._expanded=!1,this.disabled=!1,this._removeUniqueSelectionListener=()=>{},this._removeUniqueSelectionListener=i.listen((f,v)=>{this.accordion&&!this.accordion.multi&&this.accordion.id===v&&this.id!==f&&(this.expanded=!1)}),this.accordion&&(this._openCloseAllSubscription=this._subscribeToOpenCloseAllActions())}ngOnDestroy(){this.opened.complete(),this.closed.complete(),this.destroyed.emit(),this.destroyed.complete(),this._removeUniqueSelectionListener(),this._openCloseAllSubscription.unsubscribe()}toggle(){this.disabled||(this.expanded=!this.expanded)}close(){this.disabled||(this.expanded=!1)}open(){this.disabled||(this.expanded=!0)}_subscribeToOpenCloseAllActions(){return this.accordion._openCloseAllActions.subscribe(s=>{this.disabled||(this.expanded=s)})}};e.\u0275fac=function(a){return new(a||e)(Et(L8,12),Et(ts),Et(D5))},e.\u0275dir=lr({type:e,selectors:[["cdk-accordion-item"],["","cdkAccordionItem",""]],inputs:{expanded:[wn.HasDecoratorInputTransform,"expanded","expanded",Wr],disabled:[wn.HasDecoratorInputTransform,"disabled","disabled",Wr]},outputs:{closed:"closed",opened:"opened",destroyed:"destroyed",expandedChange:"expandedChange"},exportAs:["cdkAccordionItem"],standalone:!0,features:[Qs([{provide:L8,useValue:void 0}]),Es]});let o=e;return o})(),WC=(()=>{let e=class e{};e.\u0275fac=function(a){return new(a||e)},e.\u0275mod=ds({type:e}),e.\u0275inj=hs({});let o=e;return o})();var MV=["body"];function EV(o,e){}var AV=[[["mat-expansion-panel-header"]],"*",[["mat-action-row"]]],CV=["mat-expansion-panel-header","*","mat-action-row"];function IV(o,e){if(o&1&&(xt(0,"span",2),_5(),xt(1,"svg",3),Ln(2,"path",4),It()()),o&2){let t=di();si("@indicatorRotate",t._getExpandedState())}}var PV=[[["mat-panel-title"]],[["mat-panel-description"]],"*"],RV=["mat-panel-title","mat-panel-description","*"],F8=new Sn("MAT_ACCORDION"),qC="225ms cubic-bezier(0.4,0.0,0.2,1)",XC={indicatorRotate:Uc("indicatorRotate",[da("collapsed, void",to({transform:"rotate(0deg)"})),da("expanded",to({transform:"rotate(180deg)"})),La("expanded <=> collapsed, void => collapsed",Da(qC))]),bodyExpansion:Uc("bodyExpansion",[da("collapsed, void",to({height:"0px",visibility:"hidden"})),da("expanded",to({height:"*",visibility:""})),La("expanded <=> collapsed, void => collapsed",Da(qC))])},ZC=new Sn("MAT_EXPANSION_PANEL"),kV=(()=>{let e=class e{constructor(s,a){this._template=s,this._expansionPanel=a}};e.\u0275fac=function(a){return new(a||e)(Et(ha),Et(ZC,8))},e.\u0275dir=lr({type:e,selectors:[["ng-template","matExpansionPanelContent",""]],standalone:!0});let o=e;return o})(),DV=0,$C=new Sn("MAT_EXPANSION_PANEL_DEFAULT_OPTIONS"),z8=(()=>{let e=class e extends jC{get hideToggle(){return this._hideToggle||this.accordion&&this.accordion.hideToggle}set hideToggle(s){this._hideToggle=s}get togglePosition(){return this._togglePosition||this.accordion&&this.accordion.togglePosition}set togglePosition(s){this._togglePosition=s}constructor(s,a,i,f,v,x,M){super(s,a,i),this._viewContainerRef=f,this._animationMode=x,this._hideToggle=!1,this.afterExpand=new mn,this.afterCollapse=new mn,this._inputChanges=new fn,this._headerId=`mat-expansion-panel-header-${DV++}`,this._bodyAnimationDone=new fn,this.accordion=s,this._document=v,this._bodyAnimationDone.pipe(m5((C,D)=>C.fromState===D.fromState&&C.toState===D.toState)).subscribe(C=>{C.fromState!=="void"&&(C.toState==="expanded"?this.afterExpand.emit():C.toState==="collapsed"&&this.afterCollapse.emit())}),M&&(this.hideToggle=M.hideToggle)}_hasSpacing(){return this.accordion?this.expanded&&this.accordion.displayMode==="default":!1}_getExpandedState(){return this.expanded?"expanded":"collapsed"}toggle(){this.expanded=!this.expanded}close(){this.expanded=!1}open(){this.expanded=!0}ngAfterContentInit(){this._lazyContent&&this._lazyContent._expansionPanel===this&&this.opened.pipe(Yo(null),go(()=>this.expanded&&!this._portal),No(1)).subscribe(()=>{this._portal=new Bh(this._lazyContent._template,this._viewContainerRef)})}ngOnChanges(s){this._inputChanges.next(s)}ngOnDestroy(){super.ngOnDestroy(),this._bodyAnimationDone.complete(),this._inputChanges.complete()}_containsFocus(){if(this._body){let s=this._document.activeElement,a=this._body.nativeElement;return s===a||a.contains(s)}return!1}};e.\u0275fac=function(a){return new(a||e)(Et(F8,12),Et(ts),Et(D5),Et(Jl),Et(eo),Et(yo,8),Et($C,8))},e.\u0275cmp=$i({type:e,selectors:[["mat-expansion-panel"]],contentQueries:function(a,i,f){if(a&1&&zs(f,kV,5),a&2){let v;Nn(v=zn())&&(i._lazyContent=v.first)}},viewQuery:function(a,i){if(a&1&&Br(MV,5),a&2){let f;Nn(f=zn())&&(i._body=f.first)}},hostAttrs:[1,"mat-expansion-panel"],hostVars:6,hostBindings:function(a,i){a&2&&Fr("mat-expanded",i.expanded)("_mat-animation-noopable",i._animationMode==="NoopAnimations")("mat-expansion-panel-spacing",i._hasSpacing())},inputs:{hideToggle:[wn.HasDecoratorInputTransform,"hideToggle","hideToggle",Wr],togglePosition:"togglePosition"},outputs:{afterExpand:"afterExpand",afterCollapse:"afterCollapse"},exportAs:["matExpansionPanel"],standalone:!0,features:[Qs([{provide:F8,useValue:void 0},{provide:ZC,useExisting:e}]),Es,co,Ms,Yi],ngContentSelectors:CV,decls:7,vars:4,consts:[["role","region",1,"mat-expansion-panel-content",3,"id"],["body",""],[1,"mat-expansion-panel-body"],[3,"cdkPortalOutlet"]],template:function(a,i){a&1&&(ks(AV),Pr(0),xt(1,"div",0,1),zi("@bodyExpansion.done",function(v){return i._bodyAnimationDone.next(v)}),xt(3,"div",2),Pr(4,1),ln(5,EV,0,0,"ng-template",3),It(),Pr(6,2),It()),a&2&&(Ct(),si("@bodyExpansion",i._getExpandedState())("id",i.id),vs("aria-labelledby",i._headerId),Ct(4),si("cdkPortalOutlet",i._portal))},dependencies:[Oa],styles:['.mat-expansion-panel{box-sizing:content-box;display:block;margin:0;overflow:hidden;transition:margin 225ms cubic-bezier(0.4, 0, 0.2, 1),box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);position:relative;background:var(--mat-expansion-container-background-color);color:var(--mat-expansion-container-text-color);border-radius:var(--mat-expansion-container-shape)}.mat-expansion-panel:not([class*=mat-elevation-z]){box-shadow:0px 3px 1px -2px rgba(0, 0, 0, 0.2), 0px 2px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12)}.mat-accordion .mat-expansion-panel:not(.mat-expanded),.mat-accordion .mat-expansion-panel:not(.mat-expansion-panel-spacing){border-radius:0}.mat-accordion .mat-expansion-panel:first-of-type{border-top-right-radius:var(--mat-expansion-container-shape);border-top-left-radius:var(--mat-expansion-container-shape)}.mat-accordion .mat-expansion-panel:last-of-type{border-bottom-right-radius:var(--mat-expansion-container-shape);border-bottom-left-radius:var(--mat-expansion-container-shape)}.cdk-high-contrast-active .mat-expansion-panel{outline:solid 1px}.mat-expansion-panel.ng-animate-disabled,.ng-animate-disabled .mat-expansion-panel,.mat-expansion-panel._mat-animation-noopable{transition:none}.mat-expansion-panel-content{display:flex;flex-direction:column;overflow:visible;font-family:var(--mat-expansion-container-text-font);font-size:var(--mat-expansion-container-text-size);font-weight:var(--mat-expansion-container-text-weight);line-height:var(--mat-expansion-container-text-line-height);letter-spacing:var(--mat-expansion-container-text-tracking)}.mat-expansion-panel-content[style*="visibility: hidden"] *{visibility:hidden !important}.mat-expansion-panel-body{padding:0 24px 16px}.mat-expansion-panel-spacing{margin:16px 0}.mat-accordion>.mat-expansion-panel-spacing:first-child,.mat-accordion>*:first-child:not(.mat-expansion-panel) .mat-expansion-panel-spacing{margin-top:0}.mat-accordion>.mat-expansion-panel-spacing:last-child,.mat-accordion>*:last-child:not(.mat-expansion-panel) .mat-expansion-panel-spacing{margin-bottom:0}.mat-action-row{border-top-style:solid;border-top-width:1px;display:flex;flex-direction:row;justify-content:flex-end;padding:16px 8px 16px 24px;border-top-color:var(--mat-expansion-actions-divider-color)}.mat-action-row .mat-button-base,.mat-action-row .mat-mdc-button-base{margin-left:8px}[dir=rtl] .mat-action-row .mat-button-base,[dir=rtl] .mat-action-row .mat-mdc-button-base{margin-left:0;margin-right:8px}'],encapsulation:2,data:{animation:[XC.bodyExpansion]},changeDetection:0});let o=e;return o})();var B8=(()=>{let e=class e{constructor(s,a,i,f,v,x,M){this.panel=s,this._element=a,this._focusMonitor=i,this._changeDetectorRef=f,this._animationMode=x,this._parentChangeSubscription=lo.EMPTY,this.tabIndex=0;let C=s.accordion?s.accordion._stateChanges.pipe(go(D=>!!(D.hideToggle||D.togglePosition))):$l;this.tabIndex=parseInt(M||"")||0,this._parentChangeSubscription=rl(s.opened,s.closed,C,s._inputChanges.pipe(go(D=>!!(D.hideToggle||D.disabled||D.togglePosition)))).subscribe(()=>this._changeDetectorRef.markForCheck()),s.closed.pipe(go(()=>s._containsFocus())).subscribe(()=>i.focusVia(a,"program")),v&&(this.expandedHeight=v.expandedHeight,this.collapsedHeight=v.collapsedHeight)}get disabled(){return this.panel.disabled}_toggle(){this.disabled||this.panel.toggle()}_isExpanded(){return this.panel.expanded}_getExpandedState(){return this.panel._getExpandedState()}_getPanelId(){return this.panel.id}_getTogglePosition(){return this.panel.togglePosition}_showToggle(){return!this.panel.hideToggle&&!this.panel.disabled}_getHeaderHeight(){let s=this._isExpanded();return s&&this.expandedHeight?this.expandedHeight:!s&&this.collapsedHeight?this.collapsedHeight:null}_keydown(s){switch(s.keyCode){case 32:case 13:Nh(s)||(s.preventDefault(),this._toggle());break;default:this.panel.accordion&&this.panel.accordion._handleHeaderKeydown(s);return}}focus(s,a){s?this._focusMonitor.focusVia(this._element,s,a):this._element.nativeElement.focus(a)}ngAfterViewInit(){this._focusMonitor.monitor(this._element).subscribe(s=>{s&&this.panel.accordion&&this.panel.accordion._handleHeaderFocus(this)})}ngOnDestroy(){this._parentChangeSubscription.unsubscribe(),this._focusMonitor.stopMonitoring(this._element)}};e.\u0275fac=function(a){return new(a||e)(Et(z8,1),Et(Ir),Et(h1),Et(ts),Et($C,8),Et(yo,8),C2("tabindex"))},e.\u0275cmp=$i({type:e,selectors:[["mat-expansion-panel-header"]],hostAttrs:["role","button",1,"mat-expansion-panel-header","mat-focus-indicator"],hostVars:15,hostBindings:function(a,i){a&1&&zi("click",function(){return i._toggle()})("keydown",function(v){return i._keydown(v)}),a&2&&(vs("id",i.panel._headerId)("tabindex",i.disabled?-1:i.tabIndex)("aria-controls",i._getPanelId())("aria-expanded",i._isExpanded())("aria-disabled",i.panel.disabled),ca("height",i._getHeaderHeight()),Fr("mat-expanded",i._isExpanded())("mat-expansion-toggle-indicator-after",i._getTogglePosition()==="after")("mat-expansion-toggle-indicator-before",i._getTogglePosition()==="before")("_mat-animation-noopable",i._animationMode==="NoopAnimations"))},inputs:{expandedHeight:"expandedHeight",collapsedHeight:"collapsedHeight",tabIndex:[wn.HasDecoratorInputTransform,"tabIndex","tabIndex",s=>s==null?0:vo(s)]},standalone:!0,features:[Es,Yi],ngContentSelectors:RV,decls:5,vars:3,consts:[[1,"mat-content"],["class","mat-expansion-indicator"],[1,"mat-expansion-indicator"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 -960 960 960","aria-hidden","true","focusable","false"],["d","M480-345 240-585l56-56 184 184 184-184 56 56-240 240Z"]],template:function(a,i){a&1&&(ks(PV),xt(0,"span",0),Pr(1),Pr(2,1),Pr(3,2),It(),ln(4,IV,3,1,"span",1)),a&2&&(Fr("mat-content-hide-toggle",!i._showToggle()),Ct(4),ka(4,i._showToggle()?4:-1))},styles:['.mat-expansion-panel-header{display:flex;flex-direction:row;align-items:center;padding:0 24px;border-radius:inherit;transition:height 225ms cubic-bezier(0.4, 0, 0.2, 1);height:var(--mat-expansion-header-collapsed-state-height);font-family:var(--mat-expansion-header-text-font);font-size:var(--mat-expansion-header-text-size);font-weight:var(--mat-expansion-header-text-weight);line-height:var(--mat-expansion-header-text-line-height);letter-spacing:var(--mat-expansion-header-text-tracking)}.mat-expansion-panel-header.mat-expanded{height:var(--mat-expansion-header-expanded-state-height)}.mat-expansion-panel-header[aria-disabled=true]{color:var(--mat-expansion-header-disabled-state-text-color)}.mat-expansion-panel-header:not([aria-disabled=true]){cursor:pointer}.mat-expansion-panel:not(.mat-expanded) .mat-expansion-panel-header:not([aria-disabled=true]):hover{background:var(--mat-expansion-header-hover-state-layer-color)}@media(hover: none){.mat-expansion-panel:not(.mat-expanded) .mat-expansion-panel-header:not([aria-disabled=true]):hover{background:var(--mat-expansion-container-background-color)}}.mat-expansion-panel .mat-expansion-panel-header:not([aria-disabled=true]).cdk-keyboard-focused,.mat-expansion-panel .mat-expansion-panel-header:not([aria-disabled=true]).cdk-program-focused{background:var(--mat-expansion-header-focus-state-layer-color)}.mat-expansion-panel-header._mat-animation-noopable{transition:none}.mat-expansion-panel-header:focus,.mat-expansion-panel-header:hover{outline:none}.mat-expansion-panel-header.mat-expanded:focus,.mat-expansion-panel-header.mat-expanded:hover{background:inherit}.mat-expansion-panel-header.mat-expansion-toggle-indicator-before{flex-direction:row-reverse}.mat-expansion-panel-header.mat-expansion-toggle-indicator-before .mat-expansion-indicator{margin:0 16px 0 0}[dir=rtl] .mat-expansion-panel-header.mat-expansion-toggle-indicator-before .mat-expansion-indicator{margin:0 0 0 16px}.mat-content{display:flex;flex:1;flex-direction:row;overflow:hidden}.mat-content.mat-content-hide-toggle{margin-right:8px}[dir=rtl] .mat-content.mat-content-hide-toggle{margin-right:0;margin-left:8px}.mat-expansion-toggle-indicator-before .mat-content.mat-content-hide-toggle{margin-left:24px;margin-right:0}[dir=rtl] .mat-expansion-toggle-indicator-before .mat-content.mat-content-hide-toggle{margin-right:24px;margin-left:0}.mat-expansion-panel-header-title{color:var(--mat-expansion-header-text-color)}.mat-expansion-panel-header-title,.mat-expansion-panel-header-description{display:flex;flex-grow:1;flex-basis:0;margin-right:16px;align-items:center}[dir=rtl] .mat-expansion-panel-header-title,[dir=rtl] .mat-expansion-panel-header-description{margin-right:0;margin-left:16px}.mat-expansion-panel-header[aria-disabled=true] .mat-expansion-panel-header-title,.mat-expansion-panel-header[aria-disabled=true] .mat-expansion-panel-header-description{color:inherit}.mat-expansion-panel-header-description{flex-grow:2;color:var(--mat-expansion-header-description-color)}.mat-expansion-indicator::after{border-style:solid;border-width:0 2px 2px 0;content:"";display:inline-block;padding:3px;transform:rotate(45deg);vertical-align:middle;color:var(--mat-expansion-header-indicator-color);display:inline-block;display:var(--mat-expansion-legacy-header-indicator-display, inline-block)}.mat-expansion-indicator svg{width:24px;height:24px;margin:0 -8px;vertical-align:middle;fill:var(--mat-expansion-header-indicator-color);display:none;display:var(--mat-expansion-header-indicator-display, none)}.cdk-high-contrast-active .mat-expansion-panel-content{border-top:1px solid;border-top-left-radius:0;border-top-right-radius:0}'],encapsulation:2,data:{animation:[XC.indicatorRotate]},changeDetection:0});let o=e;return o})();var YC=(()=>{let e=class e{};e.\u0275fac=function(a){return new(a||e)},e.\u0275dir=lr({type:e,selectors:[["mat-panel-title"]],hostAttrs:[1,"mat-expansion-panel-header-title"],standalone:!0});let o=e;return o})(),JC=(()=>{let e=class e extends HC{constructor(){super(...arguments),this._ownHeaders=new D2,this.hideToggle=!1,this.displayMode="default",this.togglePosition="after"}ngAfterContentInit(){this._headers.changes.pipe(Yo(this._headers)).subscribe(s=>{this._ownHeaders.reset(s.filter(a=>a.panel.accordion===this)),this._ownHeaders.notifyOnChanges()}),this._keyManager=new P5(this._ownHeaders).withWrap().withHomeAndEnd()}_handleHeaderKeydown(s){this._keyManager.onKeydown(s)}_handleHeaderFocus(s){this._keyManager.updateActiveItem(s)}ngOnDestroy(){super.ngOnDestroy(),this._keyManager?.destroy(),this._ownHeaders.destroy()}};e.\u0275fac=(()=>{let s;return function(i){return(s||(s=Bc(e)))(i||e)}})(),e.\u0275dir=lr({type:e,selectors:[["mat-accordion"]],contentQueries:function(a,i,f){if(a&1&&zs(f,B8,5),a&2){let v;Nn(v=zn())&&(i._headers=v)}},hostAttrs:[1,"mat-accordion"],hostVars:2,hostBindings:function(a,i){a&2&&Fr("mat-accordion-multi",i.multi)},inputs:{hideToggle:[wn.HasDecoratorInputTransform,"hideToggle","hideToggle",Wr],displayMode:"displayMode",togglePosition:"togglePosition"},exportAs:["matAccordion"],standalone:!0,features:[Qs([{provide:F8,useExisting:e}]),Es,co]});let o=e;return o})(),KC=(()=>{let e=class e{};e.\u0275fac=function(a){return new(a||e)},e.\u0275mod=ds({type:e}),e.\u0275inj=hs({imports:[Ss,WC,C0]});let o=e;return o})();var FV=()=>[tA],OV=()=>[import("./chunk-CALC5FGN.js").then(o=>o.LayerListComponent)],NV=()=>[import("./chunk-KG247CNG.js").then(o=>o.FindByNameComponent)];function zV(o,e){if(o&1&&(R2(0),xt(1,"span"),Bi(2),It(),k2()),o&2){let t=di();Ct(2),Or(t.txt().dxfAnalyzerInstructions)}}function BV(o,e){if(o&1&&(R2(0),xt(1,"span"),Bi(2),It(),k2()),o&2){let t=di();Ct(2),Or(t.txt().elementsInSelection(t.selection.length))}}function UV(o,e){if(o&1){let t=vr();xt(0,"app-crs-select",3),zi("selectedCRS",function(a){Pn(t);let i=di();return Rn(i.setCRS(a))}),It()}}function VV(o,e){if(o&1){let t=vr();xt(0,"app-layer-list",4),zi("selection",function(a){Pn(t);let i=di();return Rn(i.updateSelection(a))}),It()}}function GV(o,e){if(o&1){let t=vr();xt(0,"app-find-by-name",4),zi("selection",function(a){Pn(t);let i=di();return Rn(i.updateSelection(a))}),It()}}var QC=(()=>{let e=class e{constructor(){this._translationService=ai(Gc),this._resultService=ai(za),this.txt=this._translationService.translatedContent,this.selectedCRS=eA.LV95,this.selection=[],this.crsSelectVisible=!1,this.analyzeLayersVisible=!1,this.findByNameVisible=!1}updateSelection(s){return yr(this,null,function*(){this.selection=s,this.selection.length&&this._resultService.setDXFSelection(s,this.selectedCRS)})}setCRS(s){this.selectedCRS=s}};e.\u0275fac=function(a){return new(a||e)},e.\u0275cmp=$i({type:e,selectors:[["app-dxf-analyzer"]],standalone:!0,features:[Yi],decls:25,vars:8,consts:[[1,"info"],[4,"ngIf"],[3,"click"],[3,"selectedCRS"],[3,"selection"]],template:function(a,i){a&1&&(xt(0,"div",0),ln(1,zV,3,1,"ng-container",1)(2,BV,3,1,"ng-container",1),It(),xt(3,"mat-accordion")(4,"mat-expansion-panel")(5,"mat-expansion-panel-header",2),zi("click",function(){return i.crsSelectVisible=!0}),xt(6,"mat-panel-title"),Bi(7),It()(),ln(8,UV,1,0),w5(9,8,FV),It(),xt(11,"mat-expansion-panel")(12,"mat-expansion-panel-header",2),zi("click",function(){return i.analyzeLayersVisible=!0}),xt(13,"mat-panel-title"),Bi(14),It()(),ln(15,VV,1,0),w5(16,15,OV),It(),xt(18,"mat-expansion-panel")(19,"mat-expansion-panel-header",2),zi("click",function(){return i.findByNameVisible=!0}),xt(20,"mat-panel-title"),Bi(21),It()(),ln(22,GV,1,0),w5(23,22,NV),It()()),a&2&&(Ct(),si("ngIf",!i.selection.length),Ct(),si("ngIf",i.selection.length),Ct(5),Or(i.txt().selectCRS),Ct(2),S5(i.crsSelectVisible),Ct(5),Or(i.txt().analyzeLayers),Ct(2),S5(i.analyzeLayersVisible),Ct(5),Or(i.txt().findByEntityName),Ct(2),S5(i.findByNameVisible))},dependencies:[_r,Ds,ho,Eo,KC,JC,z8,B8,YC],styles:[".info[_ngcontent-%COMP%]{border-radius:5px;border:3px solid khaki;padding:10px;margin-bottom:30px;display:flex;flex-direction:column;align-items:center;gap:10px}.row[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:center;gap:10px}"]});let o=e;return o})();var d3=T2(tI());var G8=(()=>{let e=class e{constructor(){this._themeService=ai(Xc),this.center=[8.5,47.4],this.zoom=2,this.clickedMap=new mn,this.clickedFeature=new mn,this.hoveredFeature=new mn,this._darkMode=this._themeService.darkMode,this._styleId=Yl(()=>this._darkMode()?"dark-v11":"light-v11"),this._sourceIds=[],this._storeReady=new Promise(s=>{this._mapReadyPromiseResolve=s}),this._sources={},this._sourceLayers={},wl(()=>{this._map!==void 0&&this._updateStyle()})}get sources(){return this._sources}ngOnChanges(s){s.center&&this._map?.flyTo({center:this.center,essential:!0}),s.zoom&&this._map?.flyTo({center:this.center,zoom:this.zoom,essential:!0})}ngAfterViewInit(){this._init()}loadGeoJSON(s,a,i,f=!0){this.addSource(s,{type:"geojson",data:a,cluster:f},i),this.fitGeoJSONBBOX(a)}fitGeoJSONBBOX(s){return yr(this,null,function*(){let a=s.bbox;a!==void 0&&(yield this._mapReadyPromiseResolve(),this._map?.fitBounds([[a[0],a[1]],[a[2],a[3]]]))})}addSource(s,a,i,f=!0){return yr(this,null,function*(){this._sources[s]=a,yield this._mapReadyPromiseResolve(),this._map!==void 0&&(this._deleteSourceIfExists(s),this._sourceIds.push(s),this._map?.addSource(s,a),i!==void 0&&this.addSourceLayer(s,i,f))})}addSourceLayer(s,a,i=!0){this._sourceLayers[s]={layer:a,clickable:i},this._map?.addLayer(a),i&&this._setLayerEvents()}zoomToCoordinate(s){let a=this._map?.getZoom();if(!a)return;let i=a+1;this._map?.flyTo({center:s,zoom:i})}_deleteSourceIfExists(s){this._map?.getSource(s)!==void 0&&(this._map?.removeLayer(`${s}-layer`),this._map?.removeSource(s))}_init(){d3.default.accessToken="pk.eyJ1IjoibWFkc2hvbHRlbiIsImEiOiJjbHZjZGprOHQwMWxnMm5tdnZ4amVpdG85In0.FddkqYy2LDkXH8xfCNYbjg",this._map=new d3.Map({container:"map",style:this._getMapStyleURL(),center:this.center,zoom:this.zoom}),this._mapReadyPromiseResolve(),this._initEventListeners(this._map)}_initEventListeners(s){s.on("click","dxf",a=>{console.log(a)}),s.on("click",a=>{console.log(a),this.clickedMap.emit(a.lngLat)})}_getMapStyleURL(){return`mapbox://styles/mapbox/${this._styleId()}`}_updateStyle(){if(this._map===void 0)return;let s=this._map.getZoom(),a=this._map.getCenter();this._init(),setTimeout(()=>{this._reAppendLayers(),this._map?.flyTo({center:a,zoom:s})},500)}_reAppendLayers(){Object.keys(this._sources).forEach(s=>{this._map?.addSource(s,this._sources[s]),this._map?.addLayer(this._sourceLayers[s].layer)}),this._setLayerEvents()}_setLayerEvents(){Object.keys(this._sourceLayers).forEach(s=>{let a=this._sourceLayers[s],i=a.layer;a.clickable&&(this._map?.on("click",i.id,f=>{if(f.features===void 0)return;let v=f.features[0].properties;v&&!v.cluster&&this.clickedFeature.emit(f.features[0])}),this._map?.on("mouseenter",i.id,f=>{let v=this._map?.getCanvas();if(v!==void 0&&(v.style.cursor="pointer"),f.features===void 0)return;let x=f.features[0].properties;x&&!x.cluster&&this.hoveredFeature.emit(f.features[0])}),this._map?.on("mouseleave",i.id,f=>{let v=this._map?.getCanvas();v!==void 0&&(v.style.cursor=""),this.hoveredFeature.emit(void 0)})),this._map?.on("click",i.id,f=>{if(f.features===void 0)return;let v=f.features[0].properties;v&&v.cluster&&this.zoomToCoordinate(f.lngLat)})})}};e.\u0275fac=function(a){return new(a||e)},e.\u0275cmp=$i({type:e,selectors:[["lib-ng-mapbox"]],inputs:{center:"center",zoom:"zoom"},outputs:{clickedMap:"clickedMap",clickedFeature:"clickedFeature",hoveredFeature:"hoveredFeature"},standalone:!0,features:[Ms,Yi],decls:1,vars:0,consts:[["id","map"]],template:function(a,i){a&1&&Ln(0,"div",0)},dependencies:[_r],styles:["#map[_ngcontent-%COMP%]{width:inherit;height:inherit}"]});let o=e;return o})();function J8(o,e,t){for(let s in e)if(e.hasOwnProperty(s)){let a=e[s];a?o.setProperty(s,a,t?.has(s)?"important":""):o.removeProperty(s)}return o}function R1(o,e){let t=e?"":"none";J8(o.style,{"touch-action":e?"":"none","-webkit-user-drag":e?"":"none","-webkit-tap-highlight-color":e?"":"transparent","user-select":t,"-ms-user-select":t,"-webkit-user-select":t,"-moz-user-select":t})}function iI(o,e,t){J8(o.style,{position:e?"":"fixed",top:e?"":"0",opacity:e?"":"0",left:e?"":"-999em"},t)}function m3(o,e){return e&&e!="none"?o+" "+e:o}function nI(o){let e=o.toLowerCase().indexOf("ms")>-1?1:1e3;return parseFloat(o)*e}function jV(o){let e=getComputedStyle(o),t=H8(e,"transition-property"),s=t.find(v=>v==="transform"||v==="all");if(!s)return 0;let a=t.indexOf(s),i=H8(e,"transition-duration"),f=H8(e,"transition-delay");return nI(i[a])+nI(f[a])}function H8(o,e){return o.getPropertyValue(e).split(",").map(s=>s.trim())}function K8(o){let e=o.getBoundingClientRect();return{top:e.top,right:e.right,bottom:e.bottom,left:e.left,width:e.width,height:e.height,x:e.x,y:e.y}}function W8(o,e,t){let{top:s,bottom:a,left:i,right:f}=o;return t>=s&&t<=a&&e>=i&&e<=f}function _g(o,e,t){o.top+=e,o.bottom=o.top+o.height,o.left+=t,o.right=o.left+o.width}function rI(o,e,t,s){let{top:a,right:i,bottom:f,left:v,width:x,height:M}=o,C=x*e,D=M*e;return s>a-D&&s<f+D&&t>v-C&&t<i+C}var g3=class{constructor(e){this._document=e,this.positions=new Map}clear(){this.positions.clear()}cache(e){this.clear(),this.positions.set(this._document,{scrollPosition:this.getViewportScrollPosition()}),e.forEach(t=>{this.positions.set(t,{scrollPosition:{top:t.scrollTop,left:t.scrollLeft},clientRect:K8(t)})})}handleScroll(e){let t=N2(e),s=this.positions.get(t);if(!s)return null;let a=s.scrollPosition,i,f;if(t===this._document){let M=this.getViewportScrollPosition();i=M.top,f=M.left}else i=t.scrollTop,f=t.scrollLeft;let v=a.top-i,x=a.left-f;return this.positions.forEach((M,C)=>{M.clientRect&&t!==C&&t.contains(C)&&_g(M.clientRect,v,x)}),a.top=i,a.left=f,{top:v,left:x}}getViewportScrollPosition(){return{top:window.scrollY,left:window.scrollX}}};function sI(o){let e=o.cloneNode(!0),t=e.querySelectorAll("[id]"),s=o.nodeName.toLowerCase();e.removeAttribute("id");for(let a=0;a<t.length;a++)t[a].removeAttribute("id");return s==="canvas"?lI(o,e):(s==="input"||s==="select"||s==="textarea")&&aI(o,e),oI("canvas",o,e,lI),oI("input, textarea, select",o,e,aI),e}function oI(o,e,t,s){let a=e.querySelectorAll(o);if(a.length){let i=t.querySelectorAll(o);for(let f=0;f<a.length;f++)s(a[f],i[f])}}var WV=0;function aI(o,e){e.type!=="file"&&(e.value=o.value),e.type==="radio"&&e.name&&(e.name=`mat-clone-${e.name}-${WV++}`)}function lI(o,e){let t=e.getContext("2d");if(t)try{t.drawImage(o,0,0)}catch{}}var cI=c1({passive:!0}),u3=c1({passive:!1}),qV=800,j8=new Set(["position"]),q8=class{get disabled(){return this._disabled||!!(this._dropContainer&&this._dropContainer.disabled)}set disabled(e){e!==this._disabled&&(this._disabled=e,this._toggleNativeDragInteractions(),this._handles.forEach(t=>R1(t,e)))}constructor(e,t,s,a,i,f){this._config=t,this._document=s,this._ngZone=a,this._viewportRuler=i,this._dragDropRegistry=f,this._passiveTransform={x:0,y:0},this._activeTransform={x:0,y:0},this._hasStartedDragging=!1,this._moveEvents=new fn,this._pointerMoveSubscription=lo.EMPTY,this._pointerUpSubscription=lo.EMPTY,this._scrollSubscription=lo.EMPTY,this._resizeSubscription=lo.EMPTY,this._boundaryElement=null,this._nativeInteractionsEnabled=!0,this._handles=[],this._disabledHandles=new Set,this._direction="ltr",this.dragStartDelay=0,this._disabled=!1,this.beforeStarted=new fn,this.started=new fn,this.released=new fn,this.ended=new fn,this.entered=new fn,this.exited=new fn,this.dropped=new fn,this.moved=this._moveEvents,this._pointerDown=v=>{if(this.beforeStarted.next(),this._handles.length){let x=this._getTargetHandle(v);x&&!this._disabledHandles.has(x)&&!this.disabled&&this._initializeDragSequence(x,v)}else this.disabled||this._initializeDragSequence(this._rootElement,v)},this._pointerMove=v=>{let x=this._getPointerPositionOnPage(v);if(!this._hasStartedDragging){let C=Math.abs(x.x-this._pickupPositionOnPage.x),D=Math.abs(x.y-this._pickupPositionOnPage.y);if(C+D>=this._config.dragStartThreshold){let N=Date.now()>=this._dragStartTime+this._getDragStartDelay(v),j=this._dropContainer;if(!N){this._endDragSequence(v);return}(!j||!j.isDragging()&&!j.isReceiving())&&(v.preventDefault(),this._hasStartedDragging=!0,this._ngZone.run(()=>this._startDragSequence(v)))}return}v.preventDefault();let M=this._getConstrainedPointerPosition(x);if(this._hasMoved=!0,this._lastKnownPointerPosition=x,this._updatePointerDirectionDelta(M),this._dropContainer)this._updateActiveDropContainer(M,x);else{let C=this.constrainPosition?this._initialDomRect:this._pickupPositionOnPage,D=this._activeTransform;D.x=M.x-C.x+this._passiveTransform.x,D.y=M.y-C.y+this._passiveTransform.y,this._applyRootElementTransform(D.x,D.y)}this._moveEvents.observers.length&&this._ngZone.run(()=>{this._moveEvents.next({source:this,pointerPosition:M,event:v,distance:this._getDragDistance(M),delta:this._pointerDirectionDelta})})},this._pointerUp=v=>{this._endDragSequence(v)},this._nativeDragStart=v=>{if(this._handles.length){let x=this._getTargetHandle(v);x&&!this._disabledHandles.has(x)&&!this.disabled&&v.preventDefault()}else this.disabled||v.preventDefault()},this.withRootElement(e).withParent(t.parentDragRef||null),this._parentPositions=new g3(s),f.registerDragItem(this)}getPlaceholderElement(){return this._placeholder}getRootElement(){return this._rootElement}getVisibleElement(){return this.isDragging()?this.getPlaceholderElement():this.getRootElement()}withHandles(e){this._handles=e.map(s=>Fa(s)),this._handles.forEach(s=>R1(s,this.disabled)),this._toggleNativeDragInteractions();let t=new Set;return this._disabledHandles.forEach(s=>{this._handles.indexOf(s)>-1&&t.add(s)}),this._disabledHandles=t,this}withPreviewTemplate(e){return this._previewTemplate=e,this}withPlaceholderTemplate(e){return this._placeholderTemplate=e,this}withRootElement(e){let t=Fa(e);return t!==this._rootElement&&(this._rootElement&&this._removeRootElementListeners(this._rootElement),this._ngZone.runOutsideAngular(()=>{t.addEventListener("mousedown",this._pointerDown,u3),t.addEventListener("touchstart",this._pointerDown,cI),t.addEventListener("dragstart",this._nativeDragStart,u3)}),this._initialTransform=void 0,this._rootElement=t),typeof SVGElement<"u"&&this._rootElement instanceof SVGElement&&(this._ownerSVGElement=this._rootElement.ownerSVGElement),this}withBoundaryElement(e){return this._boundaryElement=e?Fa(e):null,this._resizeSubscription.unsubscribe(),e&&(this._resizeSubscription=this._viewportRuler.change(10).subscribe(()=>this._containInsideBoundaryOnResize())),this}withParent(e){return this._parentDragRef=e,this}dispose(){this._removeRootElementListeners(this._rootElement),this.isDragging()&&this._rootElement?.remove(),this._anchor?.remove(),this._destroyPreview(),this._destroyPlaceholder(),this._dragDropRegistry.removeDragItem(this),this._removeSubscriptions(),this.beforeStarted.complete(),this.started.complete(),this.released.complete(),this.ended.complete(),this.entered.complete(),this.exited.complete(),this.dropped.complete(),this._moveEvents.complete(),this._handles=[],this._disabledHandles.clear(),this._dropContainer=void 0,this._resizeSubscription.unsubscribe(),this._parentPositions.clear(),this._boundaryElement=this._rootElement=this._ownerSVGElement=this._placeholderTemplate=this._previewTemplate=this._anchor=this._parentDragRef=null}isDragging(){return this._hasStartedDragging&&this._dragDropRegistry.isDragging(this)}reset(){this._rootElement.style.transform=this._initialTransform||"",this._activeTransform={x:0,y:0},this._passiveTransform={x:0,y:0}}disableHandle(e){!this._disabledHandles.has(e)&&this._handles.indexOf(e)>-1&&(this._disabledHandles.add(e),R1(e,!0))}enableHandle(e){this._disabledHandles.has(e)&&(this._disabledHandles.delete(e),R1(e,this.disabled))}withDirection(e){return this._direction=e,this}_withDropContainer(e){this._dropContainer=e}getFreeDragPosition(){let e=this.isDragging()?this._activeTransform:this._passiveTransform;return{x:e.x,y:e.y}}setFreeDragPosition(e){return this._activeTransform={x:0,y:0},this._passiveTransform.x=e.x,this._passiveTransform.y=e.y,this._dropContainer||this._applyRootElementTransform(e.x,e.y),this}withPreviewContainer(e){return this._previewContainer=e,this}_sortFromLastPointerPosition(){let e=this._lastKnownPointerPosition;e&&this._dropContainer&&this._updateActiveDropContainer(this._getConstrainedPointerPosition(e),e)}_removeSubscriptions(){this._pointerMoveSubscription.unsubscribe(),this._pointerUpSubscription.unsubscribe(),this._scrollSubscription.unsubscribe()}_destroyPreview(){this._preview?.remove(),this._previewRef?.destroy(),this._preview=this._previewRef=null}_destroyPlaceholder(){this._placeholder?.remove(),this._placeholderRef?.destroy(),this._placeholder=this._placeholderRef=null}_endDragSequence(e){if(this._dragDropRegistry.isDragging(this)&&(this._removeSubscriptions(),this._dragDropRegistry.stopDragging(this),this._toggleNativeDragInteractions(),this._handles&&(this._rootElement.style.webkitTapHighlightColor=this._rootElementTapHighlight),!!this._hasStartedDragging))if(this.released.next({source:this,event:e}),this._dropContainer)this._dropContainer._stopScrolling(),this._animatePreviewToPlaceholder().then(()=>{this._cleanupDragArtifacts(e),this._cleanupCachedDimensions(),this._dragDropRegistry.stopDragging(this)});else{this._passiveTransform.x=this._activeTransform.x;let t=this._getPointerPositionOnPage(e);this._passiveTransform.y=this._activeTransform.y,this._ngZone.run(()=>{this.ended.next({source:this,distance:this._getDragDistance(t),dropPoint:t,event:e})}),this._cleanupCachedDimensions(),this._dragDropRegistry.stopDragging(this)}}_startDragSequence(e){gg(e)&&(this._lastTouchEventTime=Date.now()),this._toggleNativeDragInteractions();let t=this._dropContainer;if(t){let s=this._rootElement,a=s.parentNode,i=this._placeholder=this._createPlaceholderElement(),f=this._anchor=this._anchor||this._document.createComment(""),v=this._getShadowRoot();a.insertBefore(f,s),this._initialTransform=s.style.transform||"",this._preview=this._createPreviewElement(),iI(s,!1,j8),this._document.body.appendChild(a.replaceChild(i,s)),this._getPreviewInsertionPoint(a,v).appendChild(this._preview),this.started.next({source:this,event:e}),t.start(),this._initialContainer=t,this._initialIndex=t.getItemIndex(this)}else this.started.next({source:this,event:e}),this._initialContainer=this._initialIndex=void 0;this._parentPositions.cache(t?t.getScrollableParents():[])}_initializeDragSequence(e,t){this._parentDragRef&&t.stopPropagation();let s=this.isDragging(),a=gg(t),i=!a&&t.button!==0,f=this._rootElement,v=N2(t),x=!a&&this._lastTouchEventTime&&this._lastTouchEventTime+qV>Date.now(),M=a?jE(t):HE(t);if(v&&v.draggable&&t.type==="mousedown"&&t.preventDefault(),s||i||x||M)return;if(this._handles.length){let L=f.style;this._rootElementTapHighlight=L.webkitTapHighlightColor||"",L.webkitTapHighlightColor="transparent"}this._hasStartedDragging=this._hasMoved=!1,this._removeSubscriptions(),this._initialDomRect=this._rootElement.getBoundingClientRect(),this._pointerMoveSubscription=this._dragDropRegistry.pointerMove.subscribe(this._pointerMove),this._pointerUpSubscription=this._dragDropRegistry.pointerUp.subscribe(this._pointerUp),this._scrollSubscription=this._dragDropRegistry.scrolled(this._getShadowRoot()).subscribe(L=>this._updateOnScroll(L)),this._boundaryElement&&(this._boundaryRect=K8(this._boundaryElement));let C=this._previewTemplate;this._pickupPositionInElement=C&&C.template&&!C.matchSize?{x:0,y:0}:this._getPointerPositionInElement(this._initialDomRect,e,t);let D=this._pickupPositionOnPage=this._lastKnownPointerPosition=this._getPointerPositionOnPage(t);this._pointerDirectionDelta={x:0,y:0},this._pointerPositionAtLastDirectionChange={x:D.x,y:D.y},this._dragStartTime=Date.now(),this._dragDropRegistry.startDragging(this,t)}_cleanupDragArtifacts(e){iI(this._rootElement,!0,j8),this._anchor.parentNode.replaceChild(this._rootElement,this._anchor),this._destroyPreview(),this._destroyPlaceholder(),this._initialDomRect=this._boundaryRect=this._previewRect=this._initialTransform=void 0,this._ngZone.run(()=>{let t=this._dropContainer,s=t.getItemIndex(this),a=this._getPointerPositionOnPage(e),i=this._getDragDistance(a),f=t._isOverContainer(a.x,a.y);this.ended.next({source:this,distance:i,dropPoint:a,event:e}),this.dropped.next({item:this,currentIndex:s,previousIndex:this._initialIndex,container:t,previousContainer:this._initialContainer,isPointerOverContainer:f,distance:i,dropPoint:a,event:e}),t.drop(this,s,this._initialIndex,this._initialContainer,f,i,a,e),this._dropContainer=this._initialContainer})}_updateActiveDropContainer({x:e,y:t},{x:s,y:a}){let i=this._initialContainer._getSiblingContainerFromPosition(this,e,t);!i&&this._dropContainer!==this._initialContainer&&this._initialContainer._isOverContainer(e,t)&&(i=this._initialContainer),i&&i!==this._dropContainer&&this._ngZone.run(()=>{this.exited.next({item:this,container:this._dropContainer}),this._dropContainer.exit(this),this._dropContainer=i,this._dropContainer.enter(this,e,t,i===this._initialContainer&&i.sortingDisabled?this._initialIndex:void 0),this.entered.next({item:this,container:i,currentIndex:i.getItemIndex(this)})}),this.isDragging()&&(this._dropContainer._startScrollingIfNecessary(s,a),this._dropContainer._sortItem(this,e,t,this._pointerDirectionDelta),this.constrainPosition?this._applyPreviewTransform(e,t):this._applyPreviewTransform(e-this._pickupPositionInElement.x,t-this._pickupPositionInElement.y))}_createPreviewElement(){let e=this._previewTemplate,t=this.previewClass,s=e?e.template:null,a;if(s&&e){let i=e.matchSize?this._initialDomRect:null,f=e.viewContainer.createEmbeddedView(s,e.context);f.detectChanges(),a=dI(f,this._document),this._previewRef=f,e.matchSize?uI(a,i):a.style.transform=f3(this._pickupPositionOnPage.x,this._pickupPositionOnPage.y)}else a=sI(this._rootElement),uI(a,this._initialDomRect),this._initialTransform&&(a.style.transform=this._initialTransform);return J8(a.style,{"pointer-events":"none",margin:"0",position:"fixed",top:"0",left:"0","z-index":`${this._config.zIndex||1e3}`},j8),R1(a,!1),a.classList.add("cdk-drag-preview"),a.setAttribute("dir",this._direction),t&&(Array.isArray(t)?t.forEach(i=>a.classList.add(i)):a.classList.add(t)),a}_animatePreviewToPlaceholder(){if(!this._hasMoved)return Promise.resolve();let e=this._placeholder.getBoundingClientRect();this._preview.classList.add("cdk-drag-animating"),this._applyPreviewTransform(e.left,e.top);let t=jV(this._preview);return t===0?Promise.resolve():this._ngZone.runOutsideAngular(()=>new Promise(s=>{let a=f=>{(!f||N2(f)===this._preview&&f.propertyName==="transform")&&(this._preview?.removeEventListener("transitionend",a),s(),clearTimeout(i))},i=setTimeout(a,t*1.5);this._preview.addEventListener("transitionend",a)}))}_createPlaceholderElement(){let e=this._placeholderTemplate,t=e?e.template:null,s;return t?(this._placeholderRef=e.viewContainer.createEmbeddedView(t,e.context),this._placeholderRef.detectChanges(),s=dI(this._placeholderRef,this._document)):s=sI(this._rootElement),s.style.pointerEvents="none",s.classList.add("cdk-drag-placeholder"),s}_getPointerPositionInElement(e,t,s){let a=t===this._rootElement?null:t,i=a?a.getBoundingClientRect():e,f=gg(s)?s.targetTouches[0]:s,v=this._getViewportScrollPosition(),x=f.pageX-i.left-v.left,M=f.pageY-i.top-v.top;return{x:i.left-e.left+x,y:i.top-e.top+M}}_getPointerPositionOnPage(e){let t=this._getViewportScrollPosition(),s=gg(e)?e.touches[0]||e.changedTouches[0]||{pageX:0,pageY:0}:e,a=s.pageX-t.left,i=s.pageY-t.top;if(this._ownerSVGElement){let f=this._ownerSVGElement.getScreenCTM();if(f){let v=this._ownerSVGElement.createSVGPoint();return v.x=a,v.y=i,v.matrixTransform(f.inverse())}}return{x:a,y:i}}_getConstrainedPointerPosition(e){let t=this._dropContainer?this._dropContainer.lockAxis:null,{x:s,y:a}=this.constrainPosition?this.constrainPosition(e,this,this._initialDomRect,this._pickupPositionInElement):e;if(this.lockAxis==="x"||t==="x"?a=this._pickupPositionOnPage.y-(this.constrainPosition?this._pickupPositionInElement.y:0):(this.lockAxis==="y"||t==="y")&&(s=this._pickupPositionOnPage.x-(this.constrainPosition?this._pickupPositionInElement.x:0)),this._boundaryRect){let{x:i,y:f}=this.constrainPosition?{x:0,y:0}:this._pickupPositionInElement,v=this._boundaryRect,{width:x,height:M}=this._getPreviewRect(),C=v.top+f,D=v.bottom-(M-f),L=v.left+i,N=v.right-(x-i);s=hI(s,L,N),a=hI(a,C,D)}return{x:s,y:a}}_updatePointerDirectionDelta(e){let{x:t,y:s}=e,a=this._pointerDirectionDelta,i=this._pointerPositionAtLastDirectionChange,f=Math.abs(t-i.x),v=Math.abs(s-i.y);return f>this._config.pointerDirectionChangeThreshold&&(a.x=t>i.x?1:-1,i.x=t),v>this._config.pointerDirectionChangeThreshold&&(a.y=s>i.y?1:-1,i.y=s),a}_toggleNativeDragInteractions(){if(!this._rootElement||!this._handles)return;let e=this._handles.length>0||!this.isDragging();e!==this._nativeInteractionsEnabled&&(this._nativeInteractionsEnabled=e,R1(this._rootElement,e))}_removeRootElementListeners(e){e.removeEventListener("mousedown",this._pointerDown,u3),e.removeEventListener("touchstart",this._pointerDown,cI),e.removeEventListener("dragstart",this._nativeDragStart,u3)}_applyRootElementTransform(e,t){let s=f3(e,t),a=this._rootElement.style;this._initialTransform==null&&(this._initialTransform=a.transform&&a.transform!="none"?a.transform:""),a.transform=m3(s,this._initialTransform)}_applyPreviewTransform(e,t){let s=this._previewTemplate?.template?void 0:this._initialTransform,a=f3(e,t);this._preview.style.transform=m3(a,s)}_getDragDistance(e){let t=this._pickupPositionOnPage;return t?{x:e.x-t.x,y:e.y-t.y}:{x:0,y:0}}_cleanupCachedDimensions(){this._boundaryRect=this._previewRect=void 0,this._parentPositions.clear()}_containInsideBoundaryOnResize(){let{x:e,y:t}=this._passiveTransform;if(e===0&&t===0||this.isDragging()||!this._boundaryElement)return;let s=this._rootElement.getBoundingClientRect(),a=this._boundaryElement.getBoundingClientRect();if(a.width===0&&a.height===0||s.width===0&&s.height===0)return;let i=a.left-s.left,f=s.right-a.right,v=a.top-s.top,x=s.bottom-a.bottom;a.width>s.width?(i>0&&(e+=i),f>0&&(e-=f)):e=0,a.height>s.height?(v>0&&(t+=v),x>0&&(t-=x)):t=0,(e!==this._passiveTransform.x||t!==this._passiveTransform.y)&&this.setFreeDragPosition({y:t,x:e})}_getDragStartDelay(e){let t=this.dragStartDelay;return typeof t=="number"?t:gg(e)?t.touch:t?t.mouse:0}_updateOnScroll(e){let t=this._parentPositions.handleScroll(e);if(t){let s=N2(e);this._boundaryRect&&s!==this._boundaryElement&&s.contains(this._boundaryElement)&&_g(this._boundaryRect,t.top,t.left),this._pickupPositionOnPage.x+=t.left,this._pickupPositionOnPage.y+=t.top,this._dropContainer||(this._activeTransform.x-=t.left,this._activeTransform.y-=t.top,this._applyRootElementTransform(this._activeTransform.x,this._activeTransform.y))}}_getViewportScrollPosition(){return this._parentPositions.positions.get(this._document)?.scrollPosition||this._parentPositions.getViewportScrollPosition()}_getShadowRoot(){return this._cachedShadowRoot===void 0&&(this._cachedShadowRoot=Ex(this._rootElement)),this._cachedShadowRoot}_getPreviewInsertionPoint(e,t){let s=this._previewContainer||"global";if(s==="parent")return e;if(s==="global"){let a=this._document;return t||a.fullscreenElement||a.webkitFullscreenElement||a.mozFullScreenElement||a.msFullscreenElement||a.body}return Fa(s)}_getPreviewRect(){return(!this._previewRect||!this._previewRect.width&&!this._previewRect.height)&&(this._previewRect=this._preview?this._preview.getBoundingClientRect():this._initialDomRect),this._previewRect}_getTargetHandle(e){return this._handles.find(t=>e.target&&(e.target===t||t.contains(e.target)))}};function f3(o,e){return`translate3d(${Math.round(o)}px, ${Math.round(e)}px, 0)`}function hI(o,e,t){return Math.max(e,Math.min(t,o))}function gg(o){return o.type[0]==="t"}function dI(o,e){let t=o.rootNodes;if(t.length===1&&t[0].nodeType===e.ELEMENT_NODE)return t[0];let s=e.createElement("div");return t.forEach(a=>s.appendChild(a)),s}function uI(o,e){o.style.width=`${e.width}px`,o.style.height=`${e.height}px`,o.style.transform=f3(e.left,e.top)}function XV(o,e,t){let s=pI(e,o.length-1),a=pI(t,o.length-1);if(s===a)return;let i=o[s],f=a<s?-1:1;for(let v=s;v!==a;v+=f)o[v]=o[v+f];o[a]=i}function pI(o,e){return Math.max(0,Math.min(e,o))}var X8=class{constructor(e,t){this._element=e,this._dragDropRegistry=t,this._itemPositions=[],this.orientation="vertical",this._previousSwap={drag:null,delta:0,overlaps:!1}}start(e){this.withItems(e)}sort(e,t,s,a){let i=this._itemPositions,f=this._getItemIndexFromPointerPosition(e,t,s,a);if(f===-1&&i.length>0)return null;let v=this.orientation==="horizontal",x=i.findIndex(G=>G.drag===e),M=i[f],C=i[x].clientRect,D=M.clientRect,L=x>f?1:-1,N=this._getItemOffsetPx(C,D,L),j=this._getSiblingOffsetPx(x,i,L),Z=i.slice();return XV(i,x,f),i.forEach((G,H)=>{if(Z[H]===G)return;let me=G.drag===e,ne=me?N:j,fe=me?e.getPlaceholderElement():G.drag.getRootElement();G.offset+=ne,v?(fe.style.transform=m3(`translate3d(${Math.round(G.offset)}px, 0, 0)`,G.initialTransform),_g(G.clientRect,0,ne)):(fe.style.transform=m3(`translate3d(0, ${Math.round(G.offset)}px, 0)`,G.initialTransform),_g(G.clientRect,ne,0))}),this._previousSwap.overlaps=W8(D,t,s),this._previousSwap.drag=M.drag,this._previousSwap.delta=v?a.x:a.y,{previousIndex:x,currentIndex:f}}enter(e,t,s,a){let i=a==null||a<0?this._getItemIndexFromPointerPosition(e,t,s):a,f=this._activeDraggables,v=f.indexOf(e),x=e.getPlaceholderElement(),M=f[i];if(M===e&&(M=f[i+1]),!M&&(i==null||i===-1||i<f.length-1)&&this._shouldEnterAsFirstChild(t,s)&&(M=f[0]),v>-1&&f.splice(v,1),M&&!this._dragDropRegistry.isDragging(M)){let C=M.getRootElement();C.parentElement.insertBefore(x,C),f.splice(i,0,e)}else Fa(this._element).appendChild(x),f.push(e);x.style.transform="",this._cacheItemPositions()}withItems(e){this._activeDraggables=e.slice(),this._cacheItemPositions()}withSortPredicate(e){this._sortPredicate=e}reset(){this._activeDraggables.forEach(e=>{let t=e.getRootElement();if(t){let s=this._itemPositions.find(a=>a.drag===e)?.initialTransform;t.style.transform=s||""}}),this._itemPositions=[],this._activeDraggables=[],this._previousSwap.drag=null,this._previousSwap.delta=0,this._previousSwap.overlaps=!1}getActiveItemsSnapshot(){return this._activeDraggables}getItemIndex(e){return(this.orientation==="horizontal"&&this.direction==="rtl"?this._itemPositions.slice().reverse():this._itemPositions).findIndex(s=>s.drag===e)}updateOnScroll(e,t){this._itemPositions.forEach(({clientRect:s})=>{_g(s,e,t)}),this._itemPositions.forEach(({drag:s})=>{this._dragDropRegistry.isDragging(s)&&s._sortFromLastPointerPosition()})}_cacheItemPositions(){let e=this.orientation==="horizontal";this._itemPositions=this._activeDraggables.map(t=>{let s=t.getVisibleElement();return{drag:t,offset:0,initialTransform:s.style.transform||"",clientRect:K8(s)}}).sort((t,s)=>e?t.clientRect.left-s.clientRect.left:t.clientRect.top-s.clientRect.top)}_getItemOffsetPx(e,t,s){let a=this.orientation==="horizontal",i=a?t.left-e.left:t.top-e.top;return s===-1&&(i+=a?t.width-e.width:t.height-e.height),i}_getSiblingOffsetPx(e,t,s){let a=this.orientation==="horizontal",i=t[e].clientRect,f=t[e+s*-1],v=i[a?"width":"height"]*s;if(f){let x=a?"left":"top",M=a?"right":"bottom";s===-1?v-=f.clientRect[x]-i[M]:v+=i[x]-f.clientRect[M]}return v}_shouldEnterAsFirstChild(e,t){if(!this._activeDraggables.length)return!1;let s=this._itemPositions,a=this.orientation==="horizontal";if(s[0].drag!==this._activeDraggables[0]){let f=s[s.length-1].clientRect;return a?e>=f.right:t>=f.bottom}else{let f=s[0].clientRect;return a?e<=f.left:t<=f.top}}_getItemIndexFromPointerPosition(e,t,s,a){let i=this.orientation==="horizontal",f=this._itemPositions.findIndex(({drag:v,clientRect:x})=>{if(v===e)return!1;if(a){let M=i?a.x:a.y;if(v===this._previousSwap.drag&&this._previousSwap.overlaps&&M===this._previousSwap.delta)return!1}return i?t>=Math.floor(x.left)&&t<Math.floor(x.right):s>=Math.floor(x.top)&&s<Math.floor(x.bottom)});return f===-1||!this._sortPredicate(f,e)?-1:f}},fI=.05,gI=.05,Ml=function(o){return o[o.NONE=0]="NONE",o[o.UP=1]="UP",o[o.DOWN=2]="DOWN",o}(Ml||{}),pa=function(o){return o[o.NONE=0]="NONE",o[o.LEFT=1]="LEFT",o[o.RIGHT=2]="RIGHT",o}(pa||{}),Z8=class{constructor(e,t,s,a,i){this._dragDropRegistry=t,this._ngZone=a,this._viewportRuler=i,this.disabled=!1,this.sortingDisabled=!1,this.autoScrollDisabled=!1,this.autoScrollStep=2,this.enterPredicate=()=>!0,this.sortPredicate=()=>!0,this.beforeStarted=new fn,this.entered=new fn,this.exited=new fn,this.dropped=new fn,this.sorted=new fn,this.receivingStarted=new fn,this.receivingStopped=new fn,this._isDragging=!1,this._draggables=[],this._siblings=[],this._activeSiblings=new Set,this._viewportScrollSubscription=lo.EMPTY,this._verticalScrollDirection=Ml.NONE,this._horizontalScrollDirection=pa.NONE,this._stopScrollTimers=new fn,this._cachedShadowRoot=null,this._startScrollInterval=()=>{this._stopScrolling(),oE(0,tE).pipe(Ra(this._stopScrollTimers)).subscribe(()=>{let f=this._scrollNode,v=this.autoScrollStep;this._verticalScrollDirection===Ml.UP?f.scrollBy(0,-v):this._verticalScrollDirection===Ml.DOWN&&f.scrollBy(0,v),this._horizontalScrollDirection===pa.LEFT?f.scrollBy(-v,0):this._horizontalScrollDirection===pa.RIGHT&&f.scrollBy(v,0)})},this.element=Fa(e),this._document=s,this.withScrollableParents([this.element]),t.registerDropContainer(this),this._parentPositions=new g3(s),this._sortStrategy=new X8(this.element,t),this._sortStrategy.withSortPredicate((f,v)=>this.sortPredicate(f,v,this))}dispose(){this._stopScrolling(),this._stopScrollTimers.complete(),this._viewportScrollSubscription.unsubscribe(),this.beforeStarted.complete(),this.entered.complete(),this.exited.complete(),this.dropped.complete(),this.sorted.complete(),this.receivingStarted.complete(),this.receivingStopped.complete(),this._activeSiblings.clear(),this._scrollNode=null,this._parentPositions.clear(),this._dragDropRegistry.removeDropContainer(this)}isDragging(){return this._isDragging}start(){this._draggingStarted(),this._notifyReceivingSiblings()}enter(e,t,s,a){this._draggingStarted(),a==null&&this.sortingDisabled&&(a=this._draggables.indexOf(e)),this._sortStrategy.enter(e,t,s,a),this._cacheParentPositions(),this._notifyReceivingSiblings(),this.entered.next({item:e,container:this,currentIndex:this.getItemIndex(e)})}exit(e){this._reset(),this.exited.next({item:e,container:this})}drop(e,t,s,a,i,f,v,x={}){this._reset(),this.dropped.next({item:e,currentIndex:t,previousIndex:s,container:this,previousContainer:a,isPointerOverContainer:i,distance:f,dropPoint:v,event:x})}withItems(e){let t=this._draggables;return this._draggables=e,e.forEach(s=>s._withDropContainer(this)),this.isDragging()&&(t.filter(a=>a.isDragging()).every(a=>e.indexOf(a)===-1)?this._reset():this._sortStrategy.withItems(this._draggables)),this}withDirection(e){return this._sortStrategy.direction=e,this}connectedTo(e){return this._siblings=e.slice(),this}withOrientation(e){return this._sortStrategy.orientation=e,this}withScrollableParents(e){let t=Fa(this.element);return this._scrollableElements=e.indexOf(t)===-1?[t,...e]:e.slice(),this}getScrollableParents(){return this._scrollableElements}getItemIndex(e){return this._isDragging?this._sortStrategy.getItemIndex(e):this._draggables.indexOf(e)}isReceiving(){return this._activeSiblings.size>0}_sortItem(e,t,s,a){if(this.sortingDisabled||!this._domRect||!rI(this._domRect,fI,t,s))return;let i=this._sortStrategy.sort(e,t,s,a);i&&this.sorted.next({previousIndex:i.previousIndex,currentIndex:i.currentIndex,container:this,item:e})}_startScrollingIfNecessary(e,t){if(this.autoScrollDisabled)return;let s,a=Ml.NONE,i=pa.NONE;if(this._parentPositions.positions.forEach((f,v)=>{v===this._document||!f.clientRect||s||rI(f.clientRect,fI,e,t)&&([a,i]=ZV(v,f.clientRect,this._sortStrategy.direction,e,t),(a||i)&&(s=v))}),!a&&!i){let{width:f,height:v}=this._viewportRuler.getViewportSize(),x={width:f,height:v,top:0,right:f,bottom:v,left:0};a=_I(x,t),i=yI(x,e),s=window}s&&(a!==this._verticalScrollDirection||i!==this._horizontalScrollDirection||s!==this._scrollNode)&&(this._verticalScrollDirection=a,this._horizontalScrollDirection=i,this._scrollNode=s,(a||i)&&s?this._ngZone.runOutsideAngular(this._startScrollInterval):this._stopScrolling())}_stopScrolling(){this._stopScrollTimers.next()}_draggingStarted(){let e=Fa(this.element).style;this.beforeStarted.next(),this._isDragging=!0,this._initialScrollSnap=e.msScrollSnapType||e.scrollSnapType||"",e.scrollSnapType=e.msScrollSnapType="none",this._sortStrategy.start(this._draggables),this._cacheParentPositions(),this._viewportScrollSubscription.unsubscribe(),this._listenToScrollEvents()}_cacheParentPositions(){let e=Fa(this.element);this._parentPositions.cache(this._scrollableElements),this._domRect=this._parentPositions.positions.get(e).clientRect}_reset(){this._isDragging=!1;let e=Fa(this.element).style;e.scrollSnapType=e.msScrollSnapType=this._initialScrollSnap,this._siblings.forEach(t=>t._stopReceiving(this)),this._sortStrategy.reset(),this._stopScrolling(),this._viewportScrollSubscription.unsubscribe(),this._parentPositions.clear()}_isOverContainer(e,t){return this._domRect!=null&&W8(this._domRect,e,t)}_getSiblingContainerFromPosition(e,t,s){return this._siblings.find(a=>a._canReceive(e,t,s))}_canReceive(e,t,s){if(!this._domRect||!W8(this._domRect,t,s)||!this.enterPredicate(e,this))return!1;let a=this._getShadowRoot().elementFromPoint(t,s);if(!a)return!1;let i=Fa(this.element);return a===i||i.contains(a)}_startReceiving(e,t){let s=this._activeSiblings;!s.has(e)&&t.every(a=>this.enterPredicate(a,this)||this._draggables.indexOf(a)>-1)&&(s.add(e),this._cacheParentPositions(),this._listenToScrollEvents(),this.receivingStarted.next({initiator:e,receiver:this,items:t}))}_stopReceiving(e){this._activeSiblings.delete(e),this._viewportScrollSubscription.unsubscribe(),this.receivingStopped.next({initiator:e,receiver:this})}_listenToScrollEvents(){this._viewportScrollSubscription=this._dragDropRegistry.scrolled(this._getShadowRoot()).subscribe(e=>{if(this.isDragging()){let t=this._parentPositions.handleScroll(e);t&&this._sortStrategy.updateOnScroll(t.top,t.left)}else this.isReceiving()&&this._cacheParentPositions()})}_getShadowRoot(){if(!this._cachedShadowRoot){let e=Ex(Fa(this.element));this._cachedShadowRoot=e||this._document}return this._cachedShadowRoot}_notifyReceivingSiblings(){let e=this._sortStrategy.getActiveItemsSnapshot().filter(t=>t.isDragging());this._siblings.forEach(t=>t._startReceiving(this,e))}};function _I(o,e){let{top:t,bottom:s,height:a}=o,i=a*gI;return e>=t-i&&e<=t+i?Ml.UP:e>=s-i&&e<=s+i?Ml.DOWN:Ml.NONE}function yI(o,e){let{left:t,right:s,width:a}=o,i=a*gI;return e>=t-i&&e<=t+i?pa.LEFT:e>=s-i&&e<=s+i?pa.RIGHT:pa.NONE}function ZV(o,e,t,s,a){let i=_I(e,a),f=yI(e,s),v=Ml.NONE,x=pa.NONE;if(i){let M=o.scrollTop;i===Ml.UP?M>0&&(v=Ml.UP):o.scrollHeight-M>o.clientHeight&&(v=Ml.DOWN)}if(f){let M=o.scrollLeft;t==="rtl"?f===pa.RIGHT?M<0&&(x=pa.RIGHT):o.scrollWidth+M>o.clientWidth&&(x=pa.LEFT):f===pa.LEFT?M>0&&(x=pa.LEFT):o.scrollWidth-M>o.clientWidth&&(x=pa.RIGHT)}return[v,x]}var p3=c1({passive:!1,capture:!0}),$V=(()=>{let e=class e{constructor(s,a){this._ngZone=s,this._dropInstances=new Set,this._dragInstances=new Set,this._activeDragInstances=[],this._globalListeners=new Map,this._draggingPredicate=i=>i.isDragging(),this.pointerMove=new fn,this.pointerUp=new fn,this.scroll=new fn,this._preventDefaultWhileDragging=i=>{this._activeDragInstances.length>0&&i.preventDefault()},this._persistentTouchmoveListener=i=>{this._activeDragInstances.length>0&&(this._activeDragInstances.some(this._draggingPredicate)&&i.preventDefault(),this.pointerMove.next(i))},this._document=a}registerDropContainer(s){this._dropInstances.has(s)||this._dropInstances.add(s)}registerDragItem(s){this._dragInstances.add(s),this._dragInstances.size===1&&this._ngZone.runOutsideAngular(()=>{this._document.addEventListener("touchmove",this._persistentTouchmoveListener,p3)})}removeDropContainer(s){this._dropInstances.delete(s)}removeDragItem(s){this._dragInstances.delete(s),this.stopDragging(s),this._dragInstances.size===0&&this._document.removeEventListener("touchmove",this._persistentTouchmoveListener,p3)}startDragging(s,a){if(!(this._activeDragInstances.indexOf(s)>-1)&&(this._activeDragInstances.push(s),this._activeDragInstances.length===1)){let i=a.type.startsWith("touch");this._globalListeners.set(i?"touchend":"mouseup",{handler:f=>this.pointerUp.next(f),options:!0}).set("scroll",{handler:f=>this.scroll.next(f),options:!0}).set("selectstart",{handler:this._preventDefaultWhileDragging,options:p3}),i||this._globalListeners.set("mousemove",{handler:f=>this.pointerMove.next(f),options:p3}),this._ngZone.runOutsideAngular(()=>{this._globalListeners.forEach((f,v)=>{this._document.addEventListener(v,f.handler,f.options)})})}}stopDragging(s){let a=this._activeDragInstances.indexOf(s);a>-1&&(this._activeDragInstances.splice(a,1),this._activeDragInstances.length===0&&this._clearGlobalListeners())}isDragging(s){return this._activeDragInstances.indexOf(s)>-1}scrolled(s){let a=[this.scroll];return s&&s!==this._document&&a.push(new M2(i=>this._ngZone.runOutsideAngular(()=>{let v=x=>{this._activeDragInstances.length&&i.next(x)};return s.addEventListener("scroll",v,!0),()=>{s.removeEventListener("scroll",v,!0)}}))),rl(...a)}ngOnDestroy(){this._dragInstances.forEach(s=>this.removeDragItem(s)),this._dropInstances.forEach(s=>this.removeDropContainer(s)),this._clearGlobalListeners(),this.pointerMove.complete(),this.pointerUp.complete()}_clearGlobalListeners(){this._globalListeners.forEach((s,a)=>{this._document.removeEventListener(a,s.handler,s.options)}),this._globalListeners.clear()}};e.\u0275fac=function(a){return new(a||e)(Sr(Ur),Sr(eo))},e.\u0275prov=jr({token:e,factory:e.\u0275fac,providedIn:"root"});let o=e;return o})(),YV={dragStartThreshold:5,pointerDirectionChangeThreshold:5},vI=(()=>{let e=class e{constructor(s,a,i,f){this._document=s,this._ngZone=a,this._viewportRuler=i,this._dragDropRegistry=f}createDrag(s,a=YV){return new q8(s,a,this._document,this._ngZone,this._viewportRuler,this._dragDropRegistry)}createDropList(s){return new Z8(s,this._dragDropRegistry,this._document,this._ngZone,this._viewportRuler)}};e.\u0275fac=function(a){return new(a||e)(Sr(eo),Sr(Ur),Sr(z2),Sr($V))},e.\u0275prov=jr({token:e,factory:e.\u0275fac,providedIn:"root"});let o=e;return o})(),$8=new Sn("CDK_DRAG_PARENT");var Y8=new Sn("CdkDragHandle"),xI=(()=>{let e=class e{get disabled(){return this._disabled}set disabled(s){this._disabled=s,this._stateChanges.next(this)}constructor(s,a){this.element=s,this._stateChanges=new fn,this._disabled=!1,this._parentDrag=a}ngOnDestroy(){this._stateChanges.complete()}};e.\u0275fac=function(a){return new(a||e)(Et(Ir),Et($8,12))},e.\u0275dir=lr({type:e,selectors:[["","cdkDragHandle",""]],hostAttrs:[1,"cdk-drag-handle"],inputs:{disabled:[wn.HasDecoratorInputTransform,"cdkDragHandleDisabled","disabled",Wr]},standalone:!0,features:[Qs([{provide:Y8,useExisting:e}]),Es]});let o=e;return o})(),JV=new Sn("CdkDragPlaceholder");var KV=new Sn("CdkDragPreview");var QV=new Sn("CDK_DRAG_CONFIG"),eG="cdk-drag",tG=new Sn("CdkDropList"),_3=(()=>{let e=class e{get disabled(){return this._disabled||this.dropContainer&&this.dropContainer.disabled}set disabled(s){this._disabled=s,this._dragRef.disabled=this._disabled}constructor(s,a,i,f,v,x,M,C,D,L,N){this.element=s,this.dropContainer=a,this._ngZone=f,this._viewContainerRef=v,this._dir=M,this._changeDetectorRef=D,this._selfHandle=L,this._parentDrag=N,this._destroyed=new fn,this.started=new mn,this.released=new mn,this.ended=new mn,this.entered=new mn,this.exited=new mn,this.dropped=new mn,this.moved=new M2(j=>{let Z=this._dragRef.moved.pipe(ys(G=>({source:this,pointerPosition:G.pointerPosition,event:G.event,delta:G.delta,distance:G.distance}))).subscribe(j);return()=>{Z.unsubscribe()}}),this._dragRef=C.createDrag(s,{dragStartThreshold:x&&x.dragStartThreshold!=null?x.dragStartThreshold:5,pointerDirectionChangeThreshold:x&&x.pointerDirectionChangeThreshold!=null?x.pointerDirectionChangeThreshold:5,zIndex:x?.zIndex}),this._dragRef.data=this,e._dragInstances.push(this),x&&this._assignDefaults(x),a&&(this._dragRef._withDropContainer(a._dropListRef),a.addItem(this)),this._syncInputs(this._dragRef),this._handleEvents(this._dragRef)}getPlaceholderElement(){return this._dragRef.getPlaceholderElement()}getRootElement(){return this._dragRef.getRootElement()}reset(){this._dragRef.reset()}getFreeDragPosition(){return this._dragRef.getFreeDragPosition()}setFreeDragPosition(s){this._dragRef.setFreeDragPosition(s)}ngAfterViewInit(){this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.pipe(No(1),Ra(this._destroyed)).subscribe(()=>{this._updateRootElement(),this._setupHandlesListener(),this.freeDragPosition&&this._dragRef.setFreeDragPosition(this.freeDragPosition)})})}ngOnChanges(s){let a=s.rootElementSelector,i=s.freeDragPosition;a&&!a.firstChange&&this._updateRootElement(),i&&!i.firstChange&&this.freeDragPosition&&this._dragRef.setFreeDragPosition(this.freeDragPosition)}ngOnDestroy(){this.dropContainer&&this.dropContainer.removeItem(this);let s=e._dragInstances.indexOf(this);s>-1&&e._dragInstances.splice(s,1),this._ngZone.runOutsideAngular(()=>{this._destroyed.next(),this._destroyed.complete(),this._dragRef.dispose()})}_updateRootElement(){let s=this.element.nativeElement,a=s;this.rootElementSelector&&(a=s.closest!==void 0?s.closest(this.rootElementSelector):s.parentElement?.closest(this.rootElementSelector)),this._dragRef.withRootElement(a||s)}_getBoundaryElement(){let s=this.boundaryElement;return s?typeof s=="string"?this.element.nativeElement.closest(s):Fa(s):null}_syncInputs(s){s.beforeStarted.subscribe(()=>{if(!s.isDragging()){let a=this._dir,i=this.dragStartDelay,f=this._placeholderTemplate?{template:this._placeholderTemplate.templateRef,context:this._placeholderTemplate.data,viewContainer:this._viewContainerRef}:null,v=this._previewTemplate?{template:this._previewTemplate.templateRef,context:this._previewTemplate.data,matchSize:this._previewTemplate.matchSize,viewContainer:this._viewContainerRef}:null;s.disabled=this.disabled,s.lockAxis=this.lockAxis,s.dragStartDelay=typeof i=="object"&&i?i:Tu(i),s.constrainPosition=this.constrainPosition,s.previewClass=this.previewClass,s.withBoundaryElement(this._getBoundaryElement()).withPlaceholderTemplate(f).withPreviewTemplate(v).withPreviewContainer(this.previewContainer||"global"),a&&s.withDirection(a.value)}}),s.beforeStarted.pipe(No(1)).subscribe(()=>{if(this._parentDrag){s.withParent(this._parentDrag._dragRef);return}let a=this.element.nativeElement.parentElement;for(;a;){if(a.classList.contains(eG)){s.withParent(e._dragInstances.find(i=>i.element.nativeElement===a)?._dragRef||null);break}a=a.parentElement}})}_handleEvents(s){s.started.subscribe(a=>{this.started.emit({source:this,event:a.event}),this._changeDetectorRef.markForCheck()}),s.released.subscribe(a=>{this.released.emit({source:this,event:a.event})}),s.ended.subscribe(a=>{this.ended.emit({source:this,distance:a.distance,dropPoint:a.dropPoint,event:a.event}),this._changeDetectorRef.markForCheck()}),s.entered.subscribe(a=>{this.entered.emit({container:a.container.data,item:this,currentIndex:a.currentIndex})}),s.exited.subscribe(a=>{this.exited.emit({container:a.container.data,item:this})}),s.dropped.subscribe(a=>{this.dropped.emit({previousIndex:a.previousIndex,currentIndex:a.currentIndex,previousContainer:a.previousContainer.data,container:a.container.data,isPointerOverContainer:a.isPointerOverContainer,item:this,distance:a.distance,dropPoint:a.dropPoint,event:a.event})})}_assignDefaults(s){let{lockAxis:a,dragStartDelay:i,constrainPosition:f,previewClass:v,boundaryElement:x,draggingDisabled:M,rootElementSelector:C,previewContainer:D}=s;this.disabled=M??!1,this.dragStartDelay=i||0,a&&(this.lockAxis=a),f&&(this.constrainPosition=f),v&&(this.previewClass=v),x&&(this.boundaryElement=x),C&&(this.rootElementSelector=C),D&&(this.previewContainer=D)}_setupHandlesListener(){this._handles.changes.pipe(Yo(this._handles),_o(s=>{let a=s.filter(i=>i._parentDrag===this).map(i=>i.element);this._selfHandle&&this.rootElementSelector&&a.push(this.element),this._dragRef.withHandles(a)}),la(s=>rl(...s.map(a=>a._stateChanges.pipe(Yo(a))))),Ra(this._destroyed)).subscribe(s=>{let a=this._dragRef,i=s.element.nativeElement;s.disabled?a.disableHandle(i):a.enableHandle(i)})}};e._dragInstances=[],e.\u0275fac=function(a){return new(a||e)(Et(Ir),Et(tG,12),Et(eo),Et(Ur),Et(Jl),Et(QV,8),Et(Kl,8),Et(vI),Et(ts),Et(Y8,10),Et($8,12))},e.\u0275dir=lr({type:e,selectors:[["","cdkDrag",""]],contentQueries:function(a,i,f){if(a&1&&(zs(f,KV,5),zs(f,JV,5),zs(f,Y8,5)),a&2){let v;Nn(v=zn())&&(i._previewTemplate=v.first),Nn(v=zn())&&(i._placeholderTemplate=v.first),Nn(v=zn())&&(i._handles=v)}},hostAttrs:[1,"cdk-drag"],hostVars:4,hostBindings:function(a,i){a&2&&Fr("cdk-drag-disabled",i.disabled)("cdk-drag-dragging",i._dragRef.isDragging())},inputs:{data:[wn.None,"cdkDragData","data"],lockAxis:[wn.None,"cdkDragLockAxis","lockAxis"],rootElementSelector:[wn.None,"cdkDragRootElement","rootElementSelector"],boundaryElement:[wn.None,"cdkDragBoundary","boundaryElement"],dragStartDelay:[wn.None,"cdkDragStartDelay","dragStartDelay"],freeDragPosition:[wn.None,"cdkDragFreeDragPosition","freeDragPosition"],disabled:[wn.HasDecoratorInputTransform,"cdkDragDisabled","disabled",Wr],constrainPosition:[wn.None,"cdkDragConstrainPosition","constrainPosition"],previewClass:[wn.None,"cdkDragPreviewClass","previewClass"],previewContainer:[wn.None,"cdkDragPreviewContainer","previewContainer"]},outputs:{started:"cdkDragStarted",released:"cdkDragReleased",ended:"cdkDragEnded",entered:"cdkDragEntered",exited:"cdkDragExited",dropped:"cdkDragDropped",moved:"cdkDragMoved"},exportAs:["cdkDrag"],standalone:!0,features:[Qs([{provide:$8,useExisting:e}]),Es,Ms]});let o=e;return o})();var bI=(()=>{let e=class e{};e.\u0275fac=function(a){return new(a||e)},e.\u0275mod=ds({type:e}),e.\u0275inj=hs({providers:[vI],imports:[L5]});let o=e;return o})();var nG=[[["","fixedTop",""]],"*"],rG=["[fixedTop]","*"],y3=(()=>{let e=class e{constructor(){this._themeService=ai(Xc),this.darkMode=this._themeService.darkMode,this.headerHovered=!1,this.allowResize=!0,this.clickedClose=new mn}};e.\u0275fac=function(a){return new(a||e)},e.\u0275cmp=$i({type:e,selectors:[["lib-ng-dragable-window"]],inputs:{allowResize:"allowResize"},outputs:{clickedClose:"clickedClose"},standalone:!0,features:[Yi],ngContentSelectors:rG,decls:9,vars:7,consts:[["cdkDrag","",1,"window",3,"cdkDragDisabled"],[1,"btn-row",3,"mousemove","mouseleave"],["mat-icon-button","","aria-label","Close dialog",3,"click"]],template:function(a,i){a&1&&(ks(nG),xt(0,"mat-card",0)(1,"mat-card-header")(2,"div",1),zi("mousemove",function(){return i.headerHovered=!0})("mouseleave",function(){return i.headerHovered=!1}),xt(3,"button",2),zi("click",function(){return i.clickedClose.emit()}),xt(4,"mat-icon"),Bi(5,"close"),It()()(),Pr(6),It(),xt(7,"mat-card-content"),Pr(8,1),It()()),a&2&&(ca("background-color",i.darkMode()?"rgba(0,0,0,0.5)":"rgba(255,255,255,0.5)")("resize",i.allowResize?"both":"none")("overflow",i.allowResize?"auto":"hidden"),si("cdkDragDisabled",!i.headerHovered))},dependencies:[_r,M1,T1,nC,rC,ho,Hh,Eo,Na,_3],styles:[".window[_ngcontent-%COMP%]{position:absolute;top:100px;left:20px;min-width:200px;min-height:50px;max-width:80vw;z-index:10;border:1px solid}mat-card-header[_ngcontent-%COMP%]{padding:0;display:flex;flex-direction:column}.btn-row[_ngcontent-%COMP%]{width:calc(100% - 4px);display:flex;flex-direction:row;justify-content:flex-end}.btn-row[_ngcontent-%COMP%]:hover{cursor:move}mat-card-content[_ngcontent-%COMP%]{max-height:60vh;overflow-y:auto}"]});let o=e;return o})();function sG(o,e){o&1&&Pr(0)}var ib=["*"],oG=["tabListContainer"],aG=["tabList"],lG=["tabListInner"],cG=["nextPaginator"],hG=["previousPaginator"];function dG(o,e){}var uG=o=>({animationDuration:o}),pG=(o,e)=>({value:o,params:e}),fG=["tabBodyWrapper"],mG=["tabHeader"];function gG(o,e){}function _G(o,e){if(o&1&&ln(0,gG,0,0,"ng-template",10),o&2){let t=di().$implicit;si("cdkPortalOutlet",t.templateLabel)}}function yG(o,e){if(o&1&&Bi(0),o&2){let t=di().$implicit;Or(t.textLabel)}}function vG(o,e){if(o&1){let t=vr();xt(0,"div",4,5),zi("click",function(){let a=Pn(t),i=a.$implicit,f=a.$index,v=di(),x=T5(1);return Rn(v._handleClick(i,x,f))})("cdkFocusChange",function(a){let f=Pn(t).$index,v=di();return Rn(v._tabFocusChanged(a,f))}),Ln(2,"span",6)(3,"div",7),xt(4,"span",8)(5,"span",9),ln(6,_G,1,1,null,10)(7,yG,1,1),It()()()}if(o&2){let t=e.$implicit,s=e.$index,a=T5(1),i=di();Fr("mdc-tab--active",i.selectedIndex===s),si("id",i._getTabLabelId(s))("ngClass",t.labelClass)("disabled",t.disabled)("fitInkBarToContent",i.fitInkBarToContent),vs("tabIndex",i._getTabIndex(s))("aria-posinset",s+1)("aria-setsize",i._tabs.length)("aria-controls",i._getTabContentId(s))("aria-selected",i.selectedIndex===s)("aria-label",t.ariaLabel||null)("aria-labelledby",!t.ariaLabel&&t.ariaLabelledby?t.ariaLabelledby:null),Ct(3),si("matRippleTrigger",a)("matRippleDisabled",t.disabled||i.disableRipple),Ct(3),ka(6,t.templateLabel?6:7)}}function xG(o,e){o&1&&Pr(0)}function bG(o,e){if(o&1){let t=vr();xt(0,"mat-tab-body",11),zi("_onCentered",function(){Pn(t);let a=di();return Rn(a._removeTabBodyWrapperHeight())})("_onCentering",function(a){Pn(t);let i=di();return Rn(i._setTabBodyWrapperHeight(a))}),It()}if(o&2){let t=e.$implicit,s=e.$index,a=di();Fr("mat-mdc-tab-body-active",a.selectedIndex===s),si("id",a._getTabContentId(s))("ngClass",t.bodyClass)("content",t.content)("position",t.position)("origin",t.origin)("animationDuration",a.animationDuration)("preserveContent",a.preserveContent),vs("tabindex",a.contentTabIndex!=null&&a.selectedIndex===s?a.contentTabIndex:null)("aria-labelledby",a._getTabLabelId(s))("aria-hidden",a.selectedIndex!==s)}}var wG=new Sn("MatTabContent"),SG=(()=>{let e=class e{constructor(s){this.template=s}};e.\u0275fac=function(a){return new(a||e)(Et(ha))},e.\u0275dir=lr({type:e,selectors:[["","matTabContent",""]],standalone:!0,features:[Qs([{provide:wG,useExisting:e}])]});let o=e;return o})(),TG=new Sn("MatTabLabel"),TI=new Sn("MAT_TAB"),MG=(()=>{let e=class e extends JE{constructor(s,a,i){super(s,a),this._closestTab=i}};e.\u0275fac=function(a){return new(a||e)(Et(ha),Et(Jl),Et(TI,8))},e.\u0275dir=lr({type:e,selectors:[["","mat-tab-label",""],["","matTabLabel",""]],standalone:!0,features:[Qs([{provide:TG,useExisting:e}]),co]});let o=e;return o})(),MI=new Sn("MAT_TAB_GROUP"),nb=(()=>{let e=class e{get templateLabel(){return this._templateLabel}set templateLabel(s){this._setTemplateLabelInput(s)}get content(){return this._contentPortal}constructor(s,a){this._viewContainerRef=s,this._closestTabGroup=a,this.disabled=!1,this._explicitContent=void 0,this.textLabel="",this._contentPortal=null,this._stateChanges=new fn,this.position=null,this.origin=null,this.isActive=!1}ngOnChanges(s){(s.hasOwnProperty("textLabel")||s.hasOwnProperty("disabled"))&&this._stateChanges.next()}ngOnDestroy(){this._stateChanges.complete()}ngOnInit(){this._contentPortal=new Bh(this._explicitContent||this._implicitContent,this._viewContainerRef)}_setTemplateLabelInput(s){s&&s._closestTab===this&&(this._templateLabel=s)}};e.\u0275fac=function(a){return new(a||e)(Et(Jl),Et(MI,8))},e.\u0275cmp=$i({type:e,selectors:[["mat-tab"]],contentQueries:function(a,i,f){if(a&1&&(zs(f,MG,5),zs(f,SG,7,ha)),a&2){let v;Nn(v=zn())&&(i.templateLabel=v.first),Nn(v=zn())&&(i._explicitContent=v.first)}},viewQuery:function(a,i){if(a&1&&Br(ha,7),a&2){let f;Nn(f=zn())&&(i._implicitContent=f.first)}},hostAttrs:["hidden",""],inputs:{disabled:[wn.HasDecoratorInputTransform,"disabled","disabled",Wr],textLabel:[wn.None,"label","textLabel"],ariaLabel:[wn.None,"aria-label","ariaLabel"],ariaLabelledby:[wn.None,"aria-labelledby","ariaLabelledby"],labelClass:"labelClass",bodyClass:"bodyClass"},exportAs:["matTab"],standalone:!0,features:[Qs([{provide:TI,useExisting:e}]),Es,Ms,Yi],ngContentSelectors:ib,decls:1,vars:0,template:function(a,i){a&1&&(ks(),ln(0,sG,1,0,"ng-template"))},encapsulation:2});let o=e;return o})(),Q8="mdc-tab-indicator--active",wI="mdc-tab-indicator--no-transition",eb=class{constructor(e){this._items=e}hide(){this._items.forEach(e=>e.deactivateInkBar())}alignToElement(e){let t=this._items.find(a=>a.elementRef.nativeElement===e),s=this._currentItem;if(t!==s&&(s?.deactivateInkBar(),t)){let a=s?.elementRef.nativeElement.getBoundingClientRect?.();t.activateInkBar(a),this._currentItem=t}}},EG=(()=>{let e=class e{constructor(){this._elementRef=ai(Ir),this._fitToContent=!1}get fitInkBarToContent(){return this._fitToContent}set fitInkBarToContent(s){this._fitToContent!==s&&(this._fitToContent=s,this._inkBarElement&&this._appendInkBarElement())}activateInkBar(s){let a=this._elementRef.nativeElement;if(!s||!a.getBoundingClientRect||!this._inkBarContentElement){a.classList.add(Q8);return}let i=a.getBoundingClientRect(),f=s.width/i.width,v=s.left-i.left;a.classList.add(wI),this._inkBarContentElement.style.setProperty("transform",`translateX(${v}px) scaleX(${f})`),a.getBoundingClientRect(),a.classList.remove(wI),a.classList.add(Q8),this._inkBarContentElement.style.setProperty("transform","")}deactivateInkBar(){this._elementRef.nativeElement.classList.remove(Q8)}ngOnInit(){this._createInkBarElement()}ngOnDestroy(){this._inkBarElement?.remove(),this._inkBarElement=this._inkBarContentElement=null}_createInkBarElement(){let s=this._elementRef.nativeElement.ownerDocument||document,a=this._inkBarElement=s.createElement("span"),i=this._inkBarContentElement=s.createElement("span");a.className="mdc-tab-indicator",i.className="mdc-tab-indicator__content mdc-tab-indicator__content--underline",a.appendChild(this._inkBarContentElement),this._appendInkBarElement()}_appendInkBarElement(){this._inkBarElement;let s=this._fitToContent?this._elementRef.nativeElement.querySelector(".mdc-tab__content"):this._elementRef.nativeElement;s.appendChild(this._inkBarElement)}};e.\u0275fac=function(a){return new(a||e)},e.\u0275dir=lr({type:e,inputs:{fitInkBarToContent:[wn.HasDecoratorInputTransform,"fitInkBarToContent","fitInkBarToContent",vo]},features:[Es]});let o=e;return o})();var EI=(()=>{let e=class e extends EG{constructor(s){super(),this.elementRef=s,this.disabled=!1}focus(){this.elementRef.nativeElement.focus()}getOffsetLeft(){return this.elementRef.nativeElement.offsetLeft}getOffsetWidth(){return this.elementRef.nativeElement.offsetWidth}};e.\u0275fac=function(a){return new(a||e)(Et(Ir))},e.\u0275dir=lr({type:e,selectors:[["","matTabLabelWrapper",""]],hostVars:3,hostBindings:function(a,i){a&2&&(vs("aria-disabled",!!i.disabled),Fr("mat-mdc-tab-disabled",i.disabled))},inputs:{fitInkBarToContent:"fitInkBarToContent",disabled:[wn.HasDecoratorInputTransform,"disabled","disabled",Wr]},standalone:!0,features:[Es,co]});let o=e;return o})(),SI=c1({passive:!0}),AG=650,CG=100,IG=(()=>{let e=class e{get selectedIndex(){return this._selectedIndex}set selectedIndex(s){let a=isNaN(s)?0:s;this._selectedIndex!=a&&(this._selectedIndexChanged=!0,this._selectedIndex=a,this._keyManager&&this._keyManager.updateActiveItem(a))}constructor(s,a,i,f,v,x,M){this._elementRef=s,this._changeDetectorRef=a,this._viewportRuler=i,this._dir=f,this._ngZone=v,this._platform=x,this._animationMode=M,this._scrollDistance=0,this._selectedIndexChanged=!1,this._destroyed=new fn,this._showPaginationControls=!1,this._disableScrollAfter=!0,this._disableScrollBefore=!0,this._stopScrolling=new fn,this.disablePagination=!1,this._selectedIndex=0,this.selectFocusedIndex=new mn,this.indexFocused=new mn,v.runOutsideAngular(()=>{f5(s.nativeElement,"mouseleave").pipe(Ra(this._destroyed)).subscribe(()=>{this._stopInterval()})})}ngAfterViewInit(){f5(this._previousPaginator.nativeElement,"touchstart",SI).pipe(Ra(this._destroyed)).subscribe(()=>{this._handlePaginatorPress("before")}),f5(this._nextPaginator.nativeElement,"touchstart",SI).pipe(Ra(this._destroyed)).subscribe(()=>{this._handlePaginatorPress("after")})}ngAfterContentInit(){let s=this._dir?this._dir.change:Xn("ltr"),a=this._viewportRuler.change(150),i=()=>{this.updatePagination(),this._alignInkBarToSelectedTab()};this._keyManager=new P5(this._items).withHorizontalOrientation(this._getLayoutDirection()).withHomeAndEnd().withWrap().skipPredicate(()=>!1),this._keyManager.updateActiveItem(this._selectedIndex),this._ngZone.onStable.pipe(No(1)).subscribe(i),rl(s,a,this._items.changes,this._itemsResized()).pipe(Ra(this._destroyed)).subscribe(()=>{this._ngZone.run(()=>{Promise.resolve().then(()=>{this._scrollDistance=Math.max(0,Math.min(this._getMaxScrollDistance(),this._scrollDistance)),i()})}),this._keyManager.withHorizontalOrientation(this._getLayoutDirection())}),this._keyManager.change.subscribe(f=>{this.indexFocused.emit(f),this._setTabFocus(f)})}_itemsResized(){return typeof ResizeObserver!="function"?$l:this._items.changes.pipe(Yo(this._items),la(s=>new M2(a=>this._ngZone.runOutsideAngular(()=>{let i=new ResizeObserver(f=>a.next(f));return s.forEach(f=>i.observe(f.elementRef.nativeElement)),()=>{i.disconnect()}}))),hE(1),go(s=>s.some(a=>a.contentRect.width>0&&a.contentRect.height>0)))}ngAfterContentChecked(){this._tabLabelCount!=this._items.length&&(this.updatePagination(),this._tabLabelCount=this._items.length,this._changeDetectorRef.markForCheck()),this._selectedIndexChanged&&(this._scrollToLabel(this._selectedIndex),this._checkScrollingControls(),this._alignInkBarToSelectedTab(),this._selectedIndexChanged=!1,this._changeDetectorRef.markForCheck()),this._scrollDistanceChanged&&(this._updateTabScrollPosition(),this._scrollDistanceChanged=!1,this._changeDetectorRef.markForCheck())}ngOnDestroy(){this._keyManager?.destroy(),this._destroyed.next(),this._destroyed.complete(),this._stopScrolling.complete()}_handleKeydown(s){if(!Nh(s))switch(s.keyCode){case 13:case 32:if(this.focusIndex!==this.selectedIndex){let a=this._items.get(this.focusIndex);a&&!a.disabled&&(this.selectFocusedIndex.emit(this.focusIndex),this._itemSelected(s))}break;default:this._keyManager.onKeydown(s)}}_onContentChanges(){let s=this._elementRef.nativeElement.textContent;s!==this._currentTextContent&&(this._currentTextContent=s||"",this._ngZone.run(()=>{this.updatePagination(),this._alignInkBarToSelectedTab(),this._changeDetectorRef.markForCheck()}))}updatePagination(){this._checkPaginationEnabled(),this._checkScrollingControls(),this._updateTabScrollPosition()}get focusIndex(){return this._keyManager?this._keyManager.activeItemIndex:0}set focusIndex(s){!this._isValidIndex(s)||this.focusIndex===s||!this._keyManager||this._keyManager.setActiveItem(s)}_isValidIndex(s){return this._items?!!this._items.toArray()[s]:!0}_setTabFocus(s){if(this._showPaginationControls&&this._scrollToLabel(s),this._items&&this._items.length){this._items.toArray()[s].focus();let a=this._tabListContainer.nativeElement;this._getLayoutDirection()=="ltr"?a.scrollLeft=0:a.scrollLeft=a.scrollWidth-a.offsetWidth}}_getLayoutDirection(){return this._dir&&this._dir.value==="rtl"?"rtl":"ltr"}_updateTabScrollPosition(){if(this.disablePagination)return;let s=this.scrollDistance,a=this._getLayoutDirection()==="ltr"?-s:s;this._tabList.nativeElement.style.transform=`translateX(${Math.round(a)}px)`,(this._platform.TRIDENT||this._platform.EDGE)&&(this._tabListContainer.nativeElement.scrollLeft=0)}get scrollDistance(){return this._scrollDistance}set scrollDistance(s){this._scrollTo(s)}_scrollHeader(s){let a=this._tabListContainer.nativeElement.offsetWidth,i=(s=="before"?-1:1)*a/3;return this._scrollTo(this._scrollDistance+i)}_handlePaginatorClick(s){this._stopInterval(),this._scrollHeader(s)}_scrollToLabel(s){if(this.disablePagination)return;let a=this._items?this._items.toArray()[s]:null;if(!a)return;let i=this._tabListContainer.nativeElement.offsetWidth,{offsetLeft:f,offsetWidth:v}=a.elementRef.nativeElement,x,M;this._getLayoutDirection()=="ltr"?(x=f,M=x+v):(M=this._tabListInner.nativeElement.offsetWidth-f,x=M-v);let C=this.scrollDistance,D=this.scrollDistance+i;x<C?this.scrollDistance-=C-x:M>D&&(this.scrollDistance+=Math.min(M-D,x-C))}_checkPaginationEnabled(){if(this.disablePagination)this._showPaginationControls=!1;else{let s=this._tabListInner.nativeElement.scrollWidth>this._elementRef.nativeElement.offsetWidth;s||(this.scrollDistance=0),s!==this._showPaginationControls&&this._changeDetectorRef.markForCheck(),this._showPaginationControls=s}}_checkScrollingControls(){this.disablePagination?this._disableScrollAfter=this._disableScrollBefore=!0:(this._disableScrollBefore=this.scrollDistance==0,this._disableScrollAfter=this.scrollDistance==this._getMaxScrollDistance(),this._changeDetectorRef.markForCheck())}_getMaxScrollDistance(){let s=this._tabListInner.nativeElement.scrollWidth,a=this._tabListContainer.nativeElement.offsetWidth;return s-a||0}_alignInkBarToSelectedTab(){let s=this._items&&this._items.length?this._items.toArray()[this.selectedIndex]:null,a=s?s.elementRef.nativeElement:null;a?this._inkBar.alignToElement(a):this._inkBar.hide()}_stopInterval(){this._stopScrolling.next()}_handlePaginatorPress(s,a){a&&a.button!=null&&a.button!==0||(this._stopInterval(),sE(AG,CG).pipe(Ra(rl(this._stopScrolling,this._destroyed))).subscribe(()=>{let{maxScrollDistance:i,distance:f}=this._scrollHeader(s);(f===0||f>=i)&&this._stopInterval()}))}_scrollTo(s){if(this.disablePagination)return{maxScrollDistance:0,distance:0};let a=this._getMaxScrollDistance();return this._scrollDistance=Math.max(0,Math.min(a,s)),this._scrollDistanceChanged=!0,this._checkScrollingControls(),{maxScrollDistance:a,distance:this._scrollDistance}}};e.\u0275fac=function(a){return new(a||e)(Et(Ir),Et(ts),Et(z2),Et(Kl,8),Et(Ur),Et(Qo),Et(yo,8))},e.\u0275dir=lr({type:e,inputs:{disablePagination:[wn.HasDecoratorInputTransform,"disablePagination","disablePagination",Wr],selectedIndex:[wn.HasDecoratorInputTransform,"selectedIndex","selectedIndex",vo]},outputs:{selectFocusedIndex:"selectFocusedIndex",indexFocused:"indexFocused"},features:[Es]});let o=e;return o})(),PG=(()=>{let e=class e extends IG{constructor(s,a,i,f,v,x,M){super(s,a,i,f,v,x,M),this.disableRipple=!1}ngAfterContentInit(){this._inkBar=new eb(this._items),super.ngAfterContentInit()}_itemSelected(s){s.preventDefault()}};e.\u0275fac=function(a){return new(a||e)(Et(Ir),Et(ts),Et(z2),Et(Kl,8),Et(Ur),Et(Qo),Et(yo,8))},e.\u0275cmp=$i({type:e,selectors:[["mat-tab-header"]],contentQueries:function(a,i,f){if(a&1&&zs(f,EI,4),a&2){let v;Nn(v=zn())&&(i._items=v)}},viewQuery:function(a,i){if(a&1&&(Br(oG,7),Br(aG,7),Br(lG,7),Br(cG,5),Br(hG,5)),a&2){let f;Nn(f=zn())&&(i._tabListContainer=f.first),Nn(f=zn())&&(i._tabList=f.first),Nn(f=zn())&&(i._tabListInner=f.first),Nn(f=zn())&&(i._nextPaginator=f.first),Nn(f=zn())&&(i._previousPaginator=f.first)}},hostAttrs:[1,"mat-mdc-tab-header"],hostVars:4,hostBindings:function(a,i){a&2&&Fr("mat-mdc-tab-header-pagination-controls-enabled",i._showPaginationControls)("mat-mdc-tab-header-rtl",i._getLayoutDirection()=="rtl")},inputs:{disableRipple:[wn.HasDecoratorInputTransform,"disableRipple","disableRipple",Wr]},standalone:!0,features:[Es,co,Yi],ngContentSelectors:ib,decls:13,vars:10,consts:[["aria-hidden","true","type","button","mat-ripple","","tabindex","-1",1,"mat-mdc-tab-header-pagination","mat-mdc-tab-header-pagination-before",3,"matRippleDisabled","disabled","click","mousedown","touchend"],["previousPaginator",""],[1,"mat-mdc-tab-header-pagination-chevron"],[1,"mat-mdc-tab-label-container",3,"keydown"],["tabListContainer",""],["role","tablist",1,"mat-mdc-tab-list",3,"cdkObserveContent"],["tabList",""],[1,"mat-mdc-tab-labels"],["tabListInner",""],["aria-hidden","true","type","button","mat-ripple","","tabindex","-1",1,"mat-mdc-tab-header-pagination","mat-mdc-tab-header-pagination-after",3,"matRippleDisabled","disabled","mousedown","click","touchend"],["nextPaginator",""]],template:function(a,i){a&1&&(ks(),xt(0,"button",0,1),zi("click",function(){return i._handlePaginatorClick("before")})("mousedown",function(v){return i._handlePaginatorPress("before",v)})("touchend",function(){return i._stopInterval()}),Ln(2,"div",2),It(),xt(3,"div",3,4),zi("keydown",function(v){return i._handleKeydown(v)}),xt(5,"div",5,6),zi("cdkObserveContent",function(){return i._onContentChanges()}),xt(7,"div",7,8),Pr(9),It()()(),xt(10,"button",9,10),zi("mousedown",function(v){return i._handlePaginatorPress("after",v)})("click",function(){return i._handlePaginatorClick("after")})("touchend",function(){return i._stopInterval()}),Ln(12,"div",2),It()),a&2&&(Fr("mat-mdc-tab-header-pagination-disabled",i._disableScrollBefore),si("matRippleDisabled",i._disableScrollBefore||i.disableRipple)("disabled",i._disableScrollBefore||null),Ct(3),Fr("_mat-animation-noopable",i._animationMode==="NoopAnimations"),Ct(7),Fr("mat-mdc-tab-header-pagination-disabled",i._disableScrollAfter),si("matRippleDisabled",i._disableScrollAfter||i.disableRipple)("disabled",i._disableScrollAfter||null))},dependencies:[Mu,I5],styles:[".mat-mdc-tab-header{display:flex;overflow:hidden;position:relative;flex-shrink:0}.mdc-tab-indicator .mdc-tab-indicator__content{transition-duration:var(--mat-tab-animation-duration, 250ms)}.mat-mdc-tab-header-pagination{-webkit-user-select:none;user-select:none;position:relative;display:none;justify-content:center;align-items:center;min-width:32px;cursor:pointer;z-index:2;-webkit-tap-highlight-color:rgba(0,0,0,0);touch-action:none;box-sizing:content-box;background:none;border:none;outline:0;padding:0}.mat-mdc-tab-header-pagination::-moz-focus-inner{border:0}.mat-mdc-tab-header-pagination .mat-ripple-element{opacity:.12;background-color:var(--mat-tab-header-inactive-ripple-color)}.mat-mdc-tab-header-pagination-controls-enabled .mat-mdc-tab-header-pagination{display:flex}.mat-mdc-tab-header-pagination-before,.mat-mdc-tab-header-rtl .mat-mdc-tab-header-pagination-after{padding-left:4px}.mat-mdc-tab-header-pagination-before .mat-mdc-tab-header-pagination-chevron,.mat-mdc-tab-header-rtl .mat-mdc-tab-header-pagination-after .mat-mdc-tab-header-pagination-chevron{transform:rotate(-135deg)}.mat-mdc-tab-header-rtl .mat-mdc-tab-header-pagination-before,.mat-mdc-tab-header-pagination-after{padding-right:4px}.mat-mdc-tab-header-rtl .mat-mdc-tab-header-pagination-before .mat-mdc-tab-header-pagination-chevron,.mat-mdc-tab-header-pagination-after .mat-mdc-tab-header-pagination-chevron{transform:rotate(45deg)}.mat-mdc-tab-header-pagination-chevron{border-style:solid;border-width:2px 2px 0 0;height:8px;width:8px;border-color:var(--mat-tab-header-pagination-icon-color)}.mat-mdc-tab-header-pagination-disabled{box-shadow:none;cursor:default;pointer-events:none}.mat-mdc-tab-header-pagination-disabled .mat-mdc-tab-header-pagination-chevron{opacity:.4}.mat-mdc-tab-list{flex-grow:1;position:relative;transition:transform 500ms cubic-bezier(0.35, 0, 0.25, 1)}._mat-animation-noopable .mat-mdc-tab-list{transition:none}._mat-animation-noopable span.mdc-tab-indicator__content,._mat-animation-noopable span.mdc-tab__text-label{transition:none}.mat-mdc-tab-label-container{display:flex;flex-grow:1;overflow:hidden;z-index:1;border-bottom-style:solid;border-bottom-width:var(--mat-tab-header-divider-height);border-bottom-color:var(--mat-tab-header-divider-color)}.mat-mdc-tab-group-inverted-header .mat-mdc-tab-label-container{border-bottom:none;border-top-style:solid;border-top-width:var(--mat-tab-header-divider-height);border-top-color:var(--mat-tab-header-divider-color)}.mat-mdc-tab-labels{display:flex;flex:1 0 auto}[mat-align-tabs=center]>.mat-mdc-tab-header .mat-mdc-tab-labels{justify-content:center}[mat-align-tabs=end]>.mat-mdc-tab-header .mat-mdc-tab-labels{justify-content:flex-end}.mat-mdc-tab::before{margin:5px}.cdk-high-contrast-active .mat-mdc-tab[aria-disabled=true]{color:GrayText}"],encapsulation:2});let o=e;return o})(),RG=new Sn("MAT_TABS_CONFIG"),kG={translateTab:Uc("translateTab",[da("center, void, left-origin-center, right-origin-center",to({transform:"none"})),da("left",to({transform:"translate3d(-100%, 0, 0)",minHeight:"1px",visibility:"hidden"})),da("right",to({transform:"translate3d(100%, 0, 0)",minHeight:"1px",visibility:"hidden"})),La("* => left, * => right, left => center, right => center",Da("{{animationDuration}} cubic-bezier(0.35, 0, 0.25, 1)")),La("void => left-origin-center",[to({transform:"translate3d(-100%, 0, 0)",visibility:"hidden"}),Da("{{animationDuration}} cubic-bezier(0.35, 0, 0.25, 1)")]),La("void => right-origin-center",[to({transform:"translate3d(100%, 0, 0)",visibility:"hidden"}),Da("{{animationDuration}} cubic-bezier(0.35, 0, 0.25, 1)")])])},DG=(()=>{let e=class e extends Oa{constructor(s,a,i,f){super(s,a,f),this._host=i,this._centeringSub=lo.EMPTY,this._leavingSub=lo.EMPTY}ngOnInit(){super.ngOnInit(),this._centeringSub=this._host._beforeCentering.pipe(Yo(this._host._isCenterPosition(this._host._position))).subscribe(s=>{s&&!this.hasAttached()&&this.attach(this._host._content)}),this._leavingSub=this._host._afterLeavingCenter.subscribe(()=>{this._host.preserveContent||this.detach()})}ngOnDestroy(){super.ngOnDestroy(),this._centeringSub.unsubscribe(),this._leavingSub.unsubscribe()}};e.\u0275fac=function(a){return new(a||e)(Et(xx),Et(Jl),Et(A2(()=>AI)),Et(eo))},e.\u0275dir=lr({type:e,selectors:[["","matTabBodyHost",""]],standalone:!0,features:[co]});let o=e;return o})(),AI=(()=>{let e=class e{set position(s){this._positionIndex=s,this._computePositionAnimationState()}constructor(s,a,i){this._elementRef=s,this._dir=a,this._dirChangeSubscription=lo.EMPTY,this._translateTabComplete=new fn,this._onCentering=new mn,this._beforeCentering=new mn,this._afterLeavingCenter=new mn,this._onCentered=new mn(!0),this.animationDuration="500ms",this.preserveContent=!1,a&&(this._dirChangeSubscription=a.change.subscribe(f=>{this._computePositionAnimationState(f),i.markForCheck()})),this._translateTabComplete.pipe(m5((f,v)=>f.fromState===v.fromState&&f.toState===v.toState)).subscribe(f=>{this._isCenterPosition(f.toState)&&this._isCenterPosition(this._position)&&this._onCentered.emit(),this._isCenterPosition(f.fromState)&&!this._isCenterPosition(this._position)&&this._afterLeavingCenter.emit()})}ngOnInit(){this._position=="center"&&this.origin!=null&&(this._position=this._computePositionFromOrigin(this.origin))}ngOnDestroy(){this._dirChangeSubscription.unsubscribe(),this._translateTabComplete.complete()}_onTranslateTabStarted(s){let a=this._isCenterPosition(s.toState);this._beforeCentering.emit(a),a&&this._onCentering.emit(this._elementRef.nativeElement.clientHeight)}_getLayoutDirection(){return this._dir&&this._dir.value==="rtl"?"rtl":"ltr"}_isCenterPosition(s){return s=="center"||s=="left-origin-center"||s=="right-origin-center"}_computePositionAnimationState(s=this._getLayoutDirection()){this._positionIndex<0?this._position=s=="ltr"?"left":"right":this._positionIndex>0?this._position=s=="ltr"?"right":"left":this._position="center"}_computePositionFromOrigin(s){let a=this._getLayoutDirection();return a=="ltr"&&s<=0||a=="rtl"&&s>0?"left-origin-center":"right-origin-center"}};e.\u0275fac=function(a){return new(a||e)(Et(Ir),Et(Kl,8),Et(ts))},e.\u0275cmp=$i({type:e,selectors:[["mat-tab-body"]],viewQuery:function(a,i){if(a&1&&Br(Oa,5),a&2){let f;Nn(f=zn())&&(i._portalHost=f.first)}},hostAttrs:[1,"mat-mdc-tab-body"],inputs:{_content:[wn.None,"content","_content"],origin:"origin",animationDuration:"animationDuration",preserveContent:"preserveContent",position:"position"},outputs:{_onCentering:"_onCentering",_beforeCentering:"_beforeCentering",_afterLeavingCenter:"_afterLeavingCenter",_onCentered:"_onCentered"},standalone:!0,features:[Yi],decls:3,vars:6,consts:[["cdkScrollable","",1,"mat-mdc-tab-body-content"],["content",""],["matTabBodyHost",""]],template:function(a,i){a&1&&(xt(0,"div",0,1),zi("@translateTab.start",function(v){return i._onTranslateTabStarted(v)})("@translateTab.done",function(v){return i._translateTabComplete.next(v)}),ln(2,dG,0,0,"ng-template",2),It()),a&2&&si("@translateTab",CE(3,pG,i._position,AE(1,uG,i.animationDuration)))},dependencies:[DG,YE],styles:['.mat-mdc-tab-body{top:0;left:0;right:0;bottom:0;position:absolute;display:block;overflow:hidden;outline:0;flex-basis:100%}.mat-mdc-tab-body.mat-mdc-tab-body-active{position:relative;overflow-x:hidden;overflow-y:auto;z-index:1;flex-grow:1}.mat-mdc-tab-group.mat-mdc-tab-group-dynamic-height .mat-mdc-tab-body.mat-mdc-tab-body-active{overflow-y:hidden}.mat-mdc-tab-body-content{height:100%;overflow:auto}.mat-mdc-tab-group-dynamic-height .mat-mdc-tab-body-content{overflow:hidden}.mat-mdc-tab-body-content[style*="visibility: hidden"]{display:none}'],encapsulation:2,data:{animation:[kG.translateTab]}});let o=e;return o})(),LG=0,FG=!0,CI=(()=>{let e=class e{get fitInkBarToContent(){return this._fitInkBarToContent}set fitInkBarToContent(s){this._fitInkBarToContent=s,this._changeDetectorRef.markForCheck()}get selectedIndex(){return this._selectedIndex}set selectedIndex(s){this._indexToSelect=isNaN(s)?null:s}get animationDuration(){return this._animationDuration}set animationDuration(s){let a=s+"";this._animationDuration=/^\d+$/.test(a)?s+"ms":a}get contentTabIndex(){return this._contentTabIndex}set contentTabIndex(s){this._contentTabIndex=isNaN(s)?null:s}get backgroundColor(){return this._backgroundColor}set backgroundColor(s){if(!FG)throw new Error("mat-tab-group background color must be set through the Sass theming API");let a=this._elementRef.nativeElement.classList;a.remove("mat-tabs-with-background",`mat-background-${this.backgroundColor}`),s&&a.add("mat-tabs-with-background",`mat-background-${s}`),this._backgroundColor=s}constructor(s,a,i,f){this._elementRef=s,this._changeDetectorRef=a,this._animationMode=f,this._tabs=new D2,this._indexToSelect=0,this._lastFocusedTabIndex=null,this._tabBodyWrapperHeight=0,this._tabsSubscription=lo.EMPTY,this._tabLabelSubscription=lo.EMPTY,this._fitInkBarToContent=!1,this.stretchTabs=!0,this.dynamicHeight=!1,this._selectedIndex=null,this.headerPosition="above",this.disablePagination=!1,this.disableRipple=!1,this.preserveContent=!1,this.selectedIndexChange=new mn,this.focusChange=new mn,this.animationDone=new mn,this.selectedTabChange=new mn(!0),this._isServer=!ai(Qo).isBrowser,this._groupId=LG++,this.animationDuration=i&&i.animationDuration?i.animationDuration:"500ms",this.disablePagination=i&&i.disablePagination!=null?i.disablePagination:!1,this.dynamicHeight=i&&i.dynamicHeight!=null?i.dynamicHeight:!1,i?.contentTabIndex!=null&&(this.contentTabIndex=i.contentTabIndex),this.preserveContent=!!i?.preserveContent,this.fitInkBarToContent=i&&i.fitInkBarToContent!=null?i.fitInkBarToContent:!1,this.stretchTabs=i&&i.stretchTabs!=null?i.stretchTabs:!0}ngAfterContentChecked(){let s=this._indexToSelect=this._clampTabIndex(this._indexToSelect);if(this._selectedIndex!=s){let a=this._selectedIndex==null;if(!a){this.selectedTabChange.emit(this._createChangeEvent(s));let i=this._tabBodyWrapper.nativeElement;i.style.minHeight=i.clientHeight+"px"}Promise.resolve().then(()=>{this._tabs.forEach((i,f)=>i.isActive=f===s),a||(this.selectedIndexChange.emit(s),this._tabBodyWrapper.nativeElement.style.minHeight="")})}this._tabs.forEach((a,i)=>{a.position=i-s,this._selectedIndex!=null&&a.position==0&&!a.origin&&(a.origin=s-this._selectedIndex)}),this._selectedIndex!==s&&(this._selectedIndex=s,this._lastFocusedTabIndex=null,this._changeDetectorRef.markForCheck())}ngAfterContentInit(){this._subscribeToAllTabChanges(),this._subscribeToTabLabels(),this._tabsSubscription=this._tabs.changes.subscribe(()=>{let s=this._clampTabIndex(this._indexToSelect);if(s===this._selectedIndex){let a=this._tabs.toArray(),i;for(let f=0;f<a.length;f++)if(a[f].isActive){this._indexToSelect=this._selectedIndex=f,this._lastFocusedTabIndex=null,i=a[f];break}!i&&a[s]&&Promise.resolve().then(()=>{a[s].isActive=!0,this.selectedTabChange.emit(this._createChangeEvent(s))})}this._changeDetectorRef.markForCheck()})}_subscribeToAllTabChanges(){this._allTabs.changes.pipe(Yo(this._allTabs)).subscribe(s=>{this._tabs.reset(s.filter(a=>a._closestTabGroup===this||!a._closestTabGroup)),this._tabs.notifyOnChanges()})}ngOnDestroy(){this._tabs.destroy(),this._tabsSubscription.unsubscribe(),this._tabLabelSubscription.unsubscribe()}realignInkBar(){this._tabHeader&&this._tabHeader._alignInkBarToSelectedTab()}updatePagination(){this._tabHeader&&this._tabHeader.updatePagination()}focusTab(s){let a=this._tabHeader;a&&(a.focusIndex=s)}_focusChanged(s){this._lastFocusedTabIndex=s,this.focusChange.emit(this._createChangeEvent(s))}_createChangeEvent(s){let a=new tb;return a.index=s,this._tabs&&this._tabs.length&&(a.tab=this._tabs.toArray()[s]),a}_subscribeToTabLabels(){this._tabLabelSubscription&&this._tabLabelSubscription.unsubscribe(),this._tabLabelSubscription=rl(...this._tabs.map(s=>s._stateChanges)).subscribe(()=>this._changeDetectorRef.markForCheck())}_clampTabIndex(s){return Math.min(this._tabs.length-1,Math.max(s||0,0))}_getTabLabelId(s){return`mat-tab-label-${this._groupId}-${s}`}_getTabContentId(s){return`mat-tab-content-${this._groupId}-${s}`}_setTabBodyWrapperHeight(s){if(!this.dynamicHeight||!this._tabBodyWrapperHeight)return;let a=this._tabBodyWrapper.nativeElement;a.style.height=this._tabBodyWrapperHeight+"px",this._tabBodyWrapper.nativeElement.offsetHeight&&(a.style.height=s+"px")}_removeTabBodyWrapperHeight(){let s=this._tabBodyWrapper.nativeElement;this._tabBodyWrapperHeight=s.clientHeight,s.style.height="",this.animationDone.emit()}_handleClick(s,a,i){a.focusIndex=i,s.disabled||(this.selectedIndex=i)}_getTabIndex(s){let a=this._lastFocusedTabIndex??this.selectedIndex;return s===a?0:-1}_tabFocusChanged(s,a){s&&s!=="mouse"&&s!=="touch"&&(this._tabHeader.focusIndex=a)}};e.\u0275fac=function(a){return new(a||e)(Et(Ir),Et(ts),Et(RG,8),Et(yo,8))},e.\u0275cmp=$i({type:e,selectors:[["mat-tab-group"]],contentQueries:function(a,i,f){if(a&1&&zs(f,nb,5),a&2){let v;Nn(v=zn())&&(i._allTabs=v)}},viewQuery:function(a,i){if(a&1&&(Br(fG,5),Br(mG,5)),a&2){let f;Nn(f=zn())&&(i._tabBodyWrapper=f.first),Nn(f=zn())&&(i._tabHeader=f.first)}},hostAttrs:[1,"mat-mdc-tab-group"],hostVars:10,hostBindings:function(a,i){a&2&&(wu("mat-"+(i.color||"primary")),ca("--mat-tab-animation-duration",i.animationDuration),Fr("mat-mdc-tab-group-dynamic-height",i.dynamicHeight)("mat-mdc-tab-group-inverted-header",i.headerPosition==="below")("mat-mdc-tab-group-stretch-tabs",i.stretchTabs))},inputs:{color:"color",fitInkBarToContent:[wn.HasDecoratorInputTransform,"fitInkBarToContent","fitInkBarToContent",Wr],stretchTabs:[wn.HasDecoratorInputTransform,"mat-stretch-tabs","stretchTabs",Wr],dynamicHeight:[wn.HasDecoratorInputTransform,"dynamicHeight","dynamicHeight",Wr],selectedIndex:[wn.HasDecoratorInputTransform,"selectedIndex","selectedIndex",vo],headerPosition:"headerPosition",animationDuration:"animationDuration",contentTabIndex:[wn.HasDecoratorInputTransform,"contentTabIndex","contentTabIndex",vo],disablePagination:[wn.HasDecoratorInputTransform,"disablePagination","disablePagination",Wr],disableRipple:[wn.HasDecoratorInputTransform,"disableRipple","disableRipple",Wr],preserveContent:[wn.HasDecoratorInputTransform,"preserveContent","preserveContent",Wr],backgroundColor:"backgroundColor"},outputs:{selectedIndexChange:"selectedIndexChange",focusChange:"focusChange",animationDone:"animationDone",selectedTabChange:"selectedTabChange"},exportAs:["matTabGroup"],standalone:!0,features:[Qs([{provide:MI,useExisting:e}]),Es,Yi],ngContentSelectors:ib,decls:9,vars:6,consts:[[3,"selectedIndex","disableRipple","disablePagination","indexFocused","selectFocusedIndex"],["tabHeader",""],[1,"mat-mdc-tab-body-wrapper"],["tabBodyWrapper",""],["role","tab","matTabLabelWrapper","","cdkMonitorElementFocus","",1,"mdc-tab","mat-mdc-tab","mat-mdc-focus-indicator",3,"id","ngClass","disabled","fitInkBarToContent","click","cdkFocusChange"],["tabNode",""],[1,"mdc-tab__ripple"],["mat-ripple","",1,"mat-mdc-tab-ripple",3,"matRippleTrigger","matRippleDisabled"],[1,"mdc-tab__content"],[1,"mdc-tab__text-label"],[3,"cdkPortalOutlet"],["role","tabpanel",3,"id","ngClass","content","position","origin","animationDuration","preserveContent","_onCentered","_onCentering"],["class","mdc-tab mat-mdc-tab mat-mdc-focus-indicator","role","tab","matTabLabelWrapper","","cdkMonitorElementFocus","",3,"id","mdc-tab--active","ngClass","disabled","fitInkBarToContent"],["role","tabpanel",3,"id","mat-mdc-tab-body-active","ngClass","content","position","origin","animationDuration","preserveContent"]],template:function(a,i){a&1&&(ks(),xt(0,"mat-tab-header",0,1),zi("indexFocused",function(v){return i._focusChanged(v)})("selectFocusedIndex",function(v){return i.selectedIndex=v}),Js(2,vG,8,16,"div",12,Ko),It(),ln(4,xG,1,0),xt(5,"div",2,3),Js(7,bG,1,12,"mat-tab-body",13,Ko),It()),a&2&&(si("selectedIndex",i.selectedIndex||0)("disableRipple",i.disableRipple)("disablePagination",i.disablePagination),Ct(2),Ks(i._tabs),Ct(2),ka(4,i._isServer?4:-1),Ct(),Fr("_mat-animation-noopable",i._animationMode==="NoopAnimations"),Ct(2),Ks(i._tabs))},dependencies:[PG,EI,qE,Mx,Mu,Oa,AI],styles:['.mdc-tab{min-width:90px;padding-right:24px;padding-left:24px;display:flex;flex:1 0 auto;justify-content:center;box-sizing:border-box;margin:0;padding-top:0;padding-bottom:0;border:none;outline:none;text-align:center;white-space:nowrap;cursor:pointer;-webkit-appearance:none;z-index:1}.mdc-tab::-moz-focus-inner{padding:0;border:0}.mdc-tab[hidden]{display:none}.mdc-tab--min-width{flex:0 1 auto}.mdc-tab__content{display:flex;align-items:center;justify-content:center;height:inherit;pointer-events:none}.mdc-tab__text-label{transition:150ms color linear;display:inline-block;line-height:1;z-index:2}.mdc-tab__icon{transition:150ms color linear;z-index:2}.mdc-tab--stacked .mdc-tab__content{flex-direction:column;align-items:center;justify-content:center}.mdc-tab--stacked .mdc-tab__text-label{padding-top:6px;padding-bottom:4px}.mdc-tab--active .mdc-tab__text-label,.mdc-tab--active .mdc-tab__icon{transition-delay:100ms}.mdc-tab:not(.mdc-tab--stacked) .mdc-tab__icon+.mdc-tab__text-label{padding-left:8px;padding-right:0}[dir=rtl] .mdc-tab:not(.mdc-tab--stacked) .mdc-tab__icon+.mdc-tab__text-label,.mdc-tab:not(.mdc-tab--stacked) .mdc-tab__icon+.mdc-tab__text-label[dir=rtl]{padding-left:0;padding-right:8px}.mdc-tab-indicator{display:flex;position:absolute;top:0;left:0;justify-content:center;width:100%;height:100%;pointer-events:none;z-index:1}.mdc-tab-indicator__content{transform-origin:left;opacity:0}.mdc-tab-indicator__content--underline{align-self:flex-end;box-sizing:border-box;width:100%;border-top-style:solid}.mdc-tab-indicator__content--icon{align-self:center;margin:0 auto}.mdc-tab-indicator--active .mdc-tab-indicator__content{opacity:1}.mdc-tab-indicator .mdc-tab-indicator__content{transition:250ms transform cubic-bezier(0.4, 0, 0.2, 1)}.mdc-tab-indicator--no-transition .mdc-tab-indicator__content{transition:none}.mdc-tab-indicator--fade .mdc-tab-indicator__content{transition:150ms opacity linear}.mdc-tab-indicator--active.mdc-tab-indicator--fade .mdc-tab-indicator__content{transition-delay:100ms}.mat-mdc-tab-ripple{position:absolute;top:0;left:0;bottom:0;right:0;pointer-events:none}.mat-mdc-tab{-webkit-tap-highlight-color:rgba(0,0,0,0);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;text-decoration:none;background:none;font-family:var(--mat-tab-header-label-text-font);font-size:var(--mat-tab-header-label-text-size);letter-spacing:var(--mat-tab-header-label-text-tracking);line-height:var(--mat-tab-header-label-text-line-height);font-weight:var(--mat-tab-header-label-text-weight)}.mat-mdc-tab .mdc-tab-indicator__content--underline{border-color:var(--mdc-tab-indicator-active-indicator-color)}.mat-mdc-tab .mdc-tab-indicator__content--underline{border-top-width:var(--mdc-tab-indicator-active-indicator-height)}.mat-mdc-tab .mdc-tab-indicator__content--underline{border-radius:var(--mdc-tab-indicator-active-indicator-shape)}.mat-mdc-tab:not(.mdc-tab--stacked){height:var(--mdc-secondary-navigation-tab-container-height)}.mat-mdc-tab:not(:disabled).mdc-tab--active .mdc-tab__icon{fill:currentColor}.mat-mdc-tab:not(:disabled):hover.mdc-tab--active .mdc-tab__icon{fill:currentColor}.mat-mdc-tab:not(:disabled):focus.mdc-tab--active .mdc-tab__icon{fill:currentColor}.mat-mdc-tab:not(:disabled):active.mdc-tab--active .mdc-tab__icon{fill:currentColor}.mat-mdc-tab:disabled.mdc-tab--active .mdc-tab__icon{fill:currentColor}.mat-mdc-tab:not(:disabled):not(.mdc-tab--active) .mdc-tab__icon{fill:currentColor}.mat-mdc-tab:not(:disabled):hover:not(.mdc-tab--active) .mdc-tab__icon{fill:currentColor}.mat-mdc-tab:not(:disabled):focus:not(.mdc-tab--active) .mdc-tab__icon{fill:currentColor}.mat-mdc-tab:not(:disabled):active:not(.mdc-tab--active) .mdc-tab__icon{fill:currentColor}.mat-mdc-tab:disabled:not(.mdc-tab--active) .mdc-tab__icon{fill:currentColor}.mat-mdc-tab.mdc-tab{flex-grow:0}.mat-mdc-tab:hover .mdc-tab__text-label{color:var(--mat-tab-header-inactive-hover-label-text-color)}.mat-mdc-tab:focus .mdc-tab__text-label{color:var(--mat-tab-header-inactive-focus-label-text-color)}.mat-mdc-tab.mdc-tab--active .mdc-tab__text-label{color:var(--mat-tab-header-active-label-text-color)}.mat-mdc-tab.mdc-tab--active .mdc-tab__ripple::before,.mat-mdc-tab.mdc-tab--active .mat-ripple-element{background-color:var(--mat-tab-header-active-ripple-color)}.mat-mdc-tab.mdc-tab--active:hover .mdc-tab__text-label{color:var(--mat-tab-header-active-hover-label-text-color)}.mat-mdc-tab.mdc-tab--active:hover .mdc-tab-indicator__content--underline{border-color:var(--mat-tab-header-active-hover-indicator-color)}.mat-mdc-tab.mdc-tab--active:focus .mdc-tab__text-label{color:var(--mat-tab-header-active-focus-label-text-color)}.mat-mdc-tab.mdc-tab--active:focus .mdc-tab-indicator__content--underline{border-color:var(--mat-tab-header-active-focus-indicator-color)}.mat-mdc-tab.mat-mdc-tab-disabled{opacity:.4;pointer-events:none}.mat-mdc-tab.mat-mdc-tab-disabled .mdc-tab__content{pointer-events:none}.mat-mdc-tab.mat-mdc-tab-disabled .mdc-tab__ripple::before,.mat-mdc-tab.mat-mdc-tab-disabled .mat-ripple-element{background-color:var(--mat-tab-header-disabled-ripple-color)}.mat-mdc-tab .mdc-tab__ripple::before{content:"";display:block;position:absolute;top:0;left:0;right:0;bottom:0;opacity:0;pointer-events:none;background-color:var(--mat-tab-header-inactive-ripple-color)}.mat-mdc-tab .mdc-tab__text-label{color:var(--mat-tab-header-inactive-label-text-color);display:inline-flex;align-items:center}.mat-mdc-tab .mdc-tab__content{position:relative;pointer-events:auto}.mat-mdc-tab:hover .mdc-tab__ripple::before{opacity:.04}.mat-mdc-tab.cdk-program-focused .mdc-tab__ripple::before,.mat-mdc-tab.cdk-keyboard-focused .mdc-tab__ripple::before{opacity:.12}.mat-mdc-tab .mat-ripple-element{opacity:.12;background-color:var(--mat-tab-header-inactive-ripple-color)}.mat-mdc-tab-group.mat-mdc-tab-group-stretch-tabs>.mat-mdc-tab-header .mat-mdc-tab{flex-grow:1}.mat-mdc-tab-group{display:flex;flex-direction:column;max-width:100%}.mat-mdc-tab-group.mat-tabs-with-background>.mat-mdc-tab-header,.mat-mdc-tab-group.mat-tabs-with-background>.mat-mdc-tab-header-pagination{background-color:var(--mat-tab-header-with-background-background-color)}.mat-mdc-tab-group.mat-tabs-with-background.mat-primary>.mat-mdc-tab-header .mat-mdc-tab .mdc-tab__text-label{color:var(--mat-tab-header-with-background-foreground-color)}.mat-mdc-tab-group.mat-tabs-with-background.mat-primary>.mat-mdc-tab-header .mdc-tab-indicator__content--underline{border-color:var(--mat-tab-header-with-background-foreground-color)}.mat-mdc-tab-group.mat-tabs-with-background:not(.mat-primary)>.mat-mdc-tab-header .mat-mdc-tab:not(.mdc-tab--active) .mdc-tab__text-label{color:var(--mat-tab-header-with-background-foreground-color)}.mat-mdc-tab-group.mat-tabs-with-background:not(.mat-primary)>.mat-mdc-tab-header .mat-mdc-tab:not(.mdc-tab--active) .mdc-tab-indicator__content--underline{border-color:var(--mat-tab-header-with-background-foreground-color)}.mat-mdc-tab-group.mat-tabs-with-background>.mat-mdc-tab-header .mat-mdc-tab-header-pagination-chevron,.mat-mdc-tab-group.mat-tabs-with-background>.mat-mdc-tab-header .mat-mdc-focus-indicator::before,.mat-mdc-tab-group.mat-tabs-with-background>.mat-mdc-tab-header-pagination .mat-mdc-tab-header-pagination-chevron,.mat-mdc-tab-group.mat-tabs-with-background>.mat-mdc-tab-header-pagination .mat-mdc-focus-indicator::before{border-color:var(--mat-tab-header-with-background-foreground-color)}.mat-mdc-tab-group.mat-tabs-with-background>.mat-mdc-tab-header .mat-ripple-element,.mat-mdc-tab-group.mat-tabs-with-background>.mat-mdc-tab-header .mdc-tab__ripple::before,.mat-mdc-tab-group.mat-tabs-with-background>.mat-mdc-tab-header-pagination .mat-ripple-element,.mat-mdc-tab-group.mat-tabs-with-background>.mat-mdc-tab-header-pagination .mdc-tab__ripple::before{background-color:var(--mat-tab-header-with-background-foreground-color)}.mat-mdc-tab-group.mat-tabs-with-background>.mat-mdc-tab-header .mat-mdc-tab-header-pagination-chevron,.mat-mdc-tab-group.mat-tabs-with-background>.mat-mdc-tab-header-pagination .mat-mdc-tab-header-pagination-chevron{color:var(--mat-tab-header-with-background-foreground-color)}.mat-mdc-tab-group.mat-mdc-tab-group-inverted-header{flex-direction:column-reverse}.mat-mdc-tab-group.mat-mdc-tab-group-inverted-header .mdc-tab-indicator__content--underline{align-self:flex-start}.mat-mdc-tab-body-wrapper{position:relative;overflow:hidden;display:flex;transition:height 500ms cubic-bezier(0.35, 0, 0.25, 1)}.mat-mdc-tab-body-wrapper._mat-animation-noopable{transition:none !important;animation:none !important}'],encapsulation:2});let o=e;return o})(),tb=class{};var II=(()=>{let e=class e{};e.\u0275fac=function(a){return new(a||e)},e.\u0275mod=ds({type:e}),e.\u0275inj=hs({imports:[Ss,Ss]});let o=e;return o})();function NG(o,e){if(o&1){let t=vr();xt(0,"div",1)(1,"button",2),zi("click",function(){Pn(t);let a=di();return Rn(a.action())}),Bi(2),It()()}if(o&2){let t=di();Ct(2),xs(" ",t.data.action," ")}}var zG=["label"];function BG(o,e){}var UG=Math.pow(2,31)-1,yg=class{constructor(e,t){this._overlayRef=t,this._afterDismissed=new fn,this._afterOpened=new fn,this._onAction=new fn,this._dismissedByAction=!1,this.containerInstance=e,e._onExit.subscribe(()=>this._finishDismiss())}dismiss(){this._afterDismissed.closed||this.containerInstance.exit(),clearTimeout(this._durationTimeoutId)}dismissWithAction(){this._onAction.closed||(this._dismissedByAction=!0,this._onAction.next(),this._onAction.complete(),this.dismiss()),clearTimeout(this._durationTimeoutId)}closeWithAction(){this.dismissWithAction()}_dismissAfter(e){this._durationTimeoutId=setTimeout(()=>this.dismiss(),Math.min(e,UG))}_open(){this._afterOpened.closed||(this._afterOpened.next(),this._afterOpened.complete())}_finishDismiss(){this._overlayRef.dispose(),this._onAction.closed||this._onAction.complete(),this._afterDismissed.next({dismissedByAction:this._dismissedByAction}),this._afterDismissed.complete(),this._dismissedByAction=!1}afterDismissed(){return this._afterDismissed}afterOpened(){return this.containerInstance._onEnter}onAction(){return this._onAction}},PI=new Sn("MatSnackBarData"),k1=class{constructor(){this.politeness="assertive",this.announcementMessage="",this.duration=0,this.data=null,this.horizontalPosition="center",this.verticalPosition="bottom"}},VG=(()=>{let e=class e{};e.\u0275fac=function(a){return new(a||e)},e.\u0275dir=lr({type:e,selectors:[["","matSnackBarLabel",""]],hostAttrs:[1,"mat-mdc-snack-bar-label","mdc-snackbar__label"],standalone:!0});let o=e;return o})(),GG=(()=>{let e=class e{};e.\u0275fac=function(a){return new(a||e)},e.\u0275dir=lr({type:e,selectors:[["","matSnackBarActions",""]],hostAttrs:[1,"mat-mdc-snack-bar-actions","mdc-snackbar__actions"],standalone:!0});let o=e;return o})(),HG=(()=>{let e=class e{};e.\u0275fac=function(a){return new(a||e)},e.\u0275dir=lr({type:e,selectors:[["","matSnackBarAction",""]],hostAttrs:[1,"mat-mdc-snack-bar-action","mdc-snackbar__action"],standalone:!0});let o=e;return o})(),RI=(()=>{let e=class e{constructor(s,a){this.snackBarRef=s,this.data=a}action(){this.snackBarRef.dismissWithAction()}get hasAction(){return!!this.data.action}};e.\u0275fac=function(a){return new(a||e)(Et(yg),Et(PI))},e.\u0275cmp=$i({type:e,selectors:[["simple-snack-bar"]],hostAttrs:[1,"mat-mdc-simple-snack-bar"],exportAs:["matSnackBar"],standalone:!0,features:[Yi],decls:3,vars:2,consts:[["matSnackBarLabel",""],["matSnackBarActions",""],["mat-button","","matSnackBarAction","",3,"click"]],template:function(a,i){a&1&&(xt(0,"div",0),Bi(1),It(),ln(2,NG,3,1,"div",1)),a&2&&(Ct(),xs(" ",i.data.message,`
`),Ct(),ka(2,i.hasAction?2:-1))},dependencies:[Vc,VG,GG,HG],styles:[".mat-mdc-simple-snack-bar{display:flex}"],encapsulation:2,changeDetection:0});let o=e;return o})(),jG={snackBarState:Uc("state",[da("void, hidden",to({transform:"scale(0.8)",opacity:0})),da("visible",to({transform:"scale(1)",opacity:1})),La("* => visible",Da("150ms cubic-bezier(0, 0, 0.2, 1)")),La("* => void, * => hidden",Da("75ms cubic-bezier(0.4, 0.0, 1, 1)",to({opacity:0})))])},WG=0,qG=(()=>{let e=class e extends F5{constructor(s,a,i,f,v){super(),this._ngZone=s,this._elementRef=a,this._changeDetectorRef=i,this._platform=f,this.snackBarConfig=v,this._document=ai(eo),this._trackedModals=new Set,this._announceDelay=150,this._destroyed=!1,this._onAnnounce=new fn,this._onExit=new fn,this._onEnter=new fn,this._animationState="void",this._liveElementId=`mat-snack-bar-container-live-${WG++}`,this.attachDomPortal=x=>{this._assertNotAttached();let M=this._portalOutlet.attachDomPortal(x);return this._afterPortalAttached(),M},v.politeness==="assertive"&&!v.announcementMessage?this._live="assertive":v.politeness==="off"?this._live="off":this._live="polite",this._platform.FIREFOX&&(this._live==="polite"&&(this._role="status"),this._live==="assertive"&&(this._role="alert"))}attachComponentPortal(s){this._assertNotAttached();let a=this._portalOutlet.attachComponentPortal(s);return this._afterPortalAttached(),a}attachTemplatePortal(s){this._assertNotAttached();let a=this._portalOutlet.attachTemplatePortal(s);return this._afterPortalAttached(),a}onAnimationEnd(s){let{fromState:a,toState:i}=s;if((i==="void"&&a!=="void"||i==="hidden")&&this._completeExit(),i==="visible"){let f=this._onEnter;this._ngZone.run(()=>{f.next(),f.complete()})}}enter(){this._destroyed||(this._animationState="visible",this._changeDetectorRef.markForCheck(),this._changeDetectorRef.detectChanges(),this._screenReaderAnnounce())}exit(){return this._ngZone.run(()=>{this._animationState="hidden",this._changeDetectorRef.markForCheck(),this._elementRef.nativeElement.setAttribute("mat-exit",""),clearTimeout(this._announceTimeoutId)}),this._onExit}ngOnDestroy(){this._destroyed=!0,this._clearFromModals(),this._completeExit()}_completeExit(){queueMicrotask(()=>{this._onExit.next(),this._onExit.complete()})}_afterPortalAttached(){let s=this._elementRef.nativeElement,a=this.snackBarConfig.panelClass;a&&(Array.isArray(a)?a.forEach(v=>s.classList.add(v)):s.classList.add(a)),this._exposeToModals();let i=this._label.nativeElement,f="mdc-snackbar__label";i.classList.toggle(f,!i.querySelector(`.${f}`))}_exposeToModals(){let s=this._liveElementId,a=this._document.querySelectorAll('body > .cdk-overlay-container [aria-modal="true"]');for(let i=0;i<a.length;i++){let f=a[i],v=f.getAttribute("aria-owns");this._trackedModals.add(f),v?v.indexOf(s)===-1&&f.setAttribute("aria-owns",v+" "+s):f.setAttribute("aria-owns",s)}}_clearFromModals(){this._trackedModals.forEach(s=>{let a=s.getAttribute("aria-owns");if(a){let i=a.replace(this._liveElementId,"").trim();i.length>0?s.setAttribute("aria-owns",i):s.removeAttribute("aria-owns")}}),this._trackedModals.clear()}_assertNotAttached(){this._portalOutlet.hasAttached()}_screenReaderAnnounce(){this._announceTimeoutId||this._ngZone.runOutsideAngular(()=>{this._announceTimeoutId=setTimeout(()=>{let s=this._elementRef.nativeElement.querySelector("[aria-hidden]"),a=this._elementRef.nativeElement.querySelector("[aria-live]");if(s&&a){let i=null;this._platform.isBrowser&&document.activeElement instanceof HTMLElement&&s.contains(document.activeElement)&&(i=document.activeElement),s.removeAttribute("aria-hidden"),a.appendChild(s),i?.focus(),this._onAnnounce.next(),this._onAnnounce.complete()}},this._announceDelay)})}};e.\u0275fac=function(a){return new(a||e)(Et(Ur),Et(Ir),Et(ts),Et(Qo),Et(k1))},e.\u0275cmp=$i({type:e,selectors:[["mat-snack-bar-container"]],viewQuery:function(a,i){if(a&1&&(Br(Oa,7),Br(zG,7)),a&2){let f;Nn(f=zn())&&(i._portalOutlet=f.first),Nn(f=zn())&&(i._label=f.first)}},hostAttrs:[1,"mdc-snackbar","mat-mdc-snack-bar-container","mdc-snackbar--open"],hostVars:1,hostBindings:function(a,i){a&1&&ME("@state.done",function(v){return i.onAnimationEnd(v)}),a&2&&SE("@state",i._animationState)},standalone:!0,features:[co,Yi],decls:6,vars:3,consts:[[1,"mdc-snackbar__surface"],[1,"mat-mdc-snack-bar-label"],["label",""],["aria-hidden","true"],["cdkPortalOutlet",""]],template:function(a,i){a&1&&(xt(0,"div",0)(1,"div",1,2)(3,"div",3),ln(4,BG,0,0,"ng-template",4),It(),Ln(5,"div"),It()()),a&2&&(Ct(5),vs("aria-live",i._live)("role",i._role)("id",i._liveElementId))},dependencies:[Oa],styles:['.mdc-snackbar{display:none;position:fixed;right:0;bottom:0;left:0;align-items:center;justify-content:center;box-sizing:border-box;pointer-events:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mdc-snackbar--opening,.mdc-snackbar--open,.mdc-snackbar--closing{display:flex}.mdc-snackbar--open .mdc-snackbar__label,.mdc-snackbar--open .mdc-snackbar__actions{visibility:visible}.mdc-snackbar__surface{padding-left:0;padding-right:8px;display:flex;align-items:center;justify-content:flex-start;box-sizing:border-box;transform:scale(0.8);opacity:0}.mdc-snackbar__surface::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:1px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}@media screen and (forced-colors: active){.mdc-snackbar__surface::before{border-color:CanvasText}}[dir=rtl] .mdc-snackbar__surface,.mdc-snackbar__surface[dir=rtl]{padding-left:8px;padding-right:0}.mdc-snackbar--open .mdc-snackbar__surface{transform:scale(1);opacity:1;pointer-events:auto}.mdc-snackbar--closing .mdc-snackbar__surface{transform:scale(1)}.mdc-snackbar__label{padding-left:16px;padding-right:8px;width:100%;flex-grow:1;box-sizing:border-box;margin:0;visibility:hidden;padding-top:14px;padding-bottom:14px}[dir=rtl] .mdc-snackbar__label,.mdc-snackbar__label[dir=rtl]{padding-left:8px;padding-right:16px}.mdc-snackbar__label::before{display:inline;content:attr(data-mdc-snackbar-label-text)}.mdc-snackbar__actions{display:flex;flex-shrink:0;align-items:center;box-sizing:border-box;visibility:hidden}.mdc-snackbar__action+.mdc-snackbar__dismiss{margin-left:8px;margin-right:0}[dir=rtl] .mdc-snackbar__action+.mdc-snackbar__dismiss,.mdc-snackbar__action+.mdc-snackbar__dismiss[dir=rtl]{margin-left:0;margin-right:8px}.mat-mdc-snack-bar-container{margin:8px;position:static}.mat-mdc-snack-bar-container .mdc-snackbar__surface{min-width:344px}@media(max-width: 480px),(max-width: 344px){.mat-mdc-snack-bar-container .mdc-snackbar__surface{min-width:100%}}@media(max-width: 480px),(max-width: 344px){.mat-mdc-snack-bar-container{width:100vw}}.mat-mdc-snack-bar-container .mdc-snackbar__surface{max-width:672px}.mat-mdc-snack-bar-container .mdc-snackbar__surface{box-shadow:0px 3px 5px -1px rgba(0, 0, 0, 0.2), 0px 6px 10px 0px rgba(0, 0, 0, 0.14), 0px 1px 18px 0px rgba(0, 0, 0, 0.12)}.mat-mdc-snack-bar-container .mdc-snackbar__surface{background-color:var(--mdc-snackbar-container-color)}.mat-mdc-snack-bar-container .mdc-snackbar__surface{border-radius:var(--mdc-snackbar-container-shape)}.mat-mdc-snack-bar-container .mdc-snackbar__label{color:var(--mdc-snackbar-supporting-text-color)}.mat-mdc-snack-bar-container .mdc-snackbar__label{font-size:var(--mdc-snackbar-supporting-text-size);font-family:var(--mdc-snackbar-supporting-text-font);font-weight:var(--mdc-snackbar-supporting-text-weight);line-height:var(--mdc-snackbar-supporting-text-line-height)}.mat-mdc-snack-bar-container .mat-mdc-button.mat-mdc-snack-bar-action:not(:disabled){color:var(--mat-snack-bar-button-color);--mat-text-button-state-layer-color:currentColor;--mat-text-button-ripple-color:currentColor}.mat-mdc-snack-bar-container .mat-mdc-button.mat-mdc-snack-bar-action:not(:disabled) .mat-ripple-element{opacity:.1}.mat-mdc-snack-bar-container .mdc-snackbar__label::before{display:none}.mat-mdc-snack-bar-handset,.mat-mdc-snack-bar-container,.mat-mdc-snack-bar-label{flex:1 1 auto}.mat-mdc-snack-bar-handset .mdc-snackbar__surface{width:100%}'],encapsulation:2,data:{animation:[jG.snackBarState]}});let o=e;return o})();function XG(){return new k1}var ZG=new Sn("mat-snack-bar-default-options",{providedIn:"root",factory:XG}),rb=(()=>{let e=class e{get _openedSnackBarRef(){let s=this._parentSnackBar;return s?s._openedSnackBarRef:this._snackBarRefAtThisLevel}set _openedSnackBarRef(s){this._parentSnackBar?this._parentSnackBar._openedSnackBarRef=s:this._snackBarRefAtThisLevel=s}constructor(s,a,i,f,v,x){this._overlay=s,this._live=a,this._injector=i,this._breakpointObserver=f,this._parentSnackBar=v,this._defaultConfig=x,this._snackBarRefAtThisLevel=null,this.simpleSnackBarComponent=RI,this.snackBarContainerComponent=qG,this.handsetCssClass="mat-mdc-snack-bar-handset"}openFromComponent(s,a){return this._attach(s,a)}openFromTemplate(s,a){return this._attach(s,a)}open(s,a="",i){let f=Ti(Ti({},this._defaultConfig),i);return f.data={message:s,action:a},f.announcementMessage===s&&(f.announcementMessage=void 0),this.openFromComponent(this.simpleSnackBarComponent,f)}dismiss(){this._openedSnackBarRef&&this._openedSnackBarRef.dismiss()}ngOnDestroy(){this._snackBarRefAtThisLevel&&this._snackBarRefAtThisLevel.dismiss()}_attachSnackBarContainer(s,a){let i=a&&a.viewContainerRef&&a.viewContainerRef.injector,f=Jo.create({parent:i||this._injector,providers:[{provide:k1,useValue:a}]}),v=new p1(this.snackBarContainerComponent,a.viewContainerRef,f),x=s.attach(v);return x.instance.snackBarConfig=a,x.instance}_attach(s,a){let i=Ti(Ti(Ti({},new k1),this._defaultConfig),a),f=this._createOverlay(i),v=this._attachSnackBarContainer(f,i),x=new yg(v,f);if(s instanceof ha){let M=new Bh(s,null,{$implicit:i.data,snackBarRef:x});x.instance=v.attachTemplatePortal(M)}else{let M=this._createInjector(i,x),C=new p1(s,void 0,M),D=v.attachComponentPortal(C);x.instance=D.instance}return this._breakpointObserver.observe(GE.HandsetPortrait).pipe(Ra(f.detachments())).subscribe(M=>{f.overlayElement.classList.toggle(this.handsetCssClass,M.matches)}),i.announcementMessage&&v._onAnnounce.subscribe(()=>{this._live.announce(i.announcementMessage,i.politeness)}),this._animateSnackBar(x,i),this._openedSnackBarRef=x,this._openedSnackBarRef}_animateSnackBar(s,a){s.afterDismissed().subscribe(()=>{this._openedSnackBarRef==s&&(this._openedSnackBarRef=null),a.announcementMessage&&this._live.clear()}),this._openedSnackBarRef?(this._openedSnackBarRef.afterDismissed().subscribe(()=>{s.containerInstance.enter()}),this._openedSnackBarRef.dismiss()):s.containerInstance.enter(),a.duration&&a.duration>0&&s.afterOpened().subscribe(()=>s._dismissAfter(a.duration))}_createOverlay(s){let a=new B2;a.direction=s.direction;let i=this._overlay.position().global(),f=s.direction==="rtl",v=s.horizontalPosition==="left"||s.horizontalPosition==="start"&&!f||s.horizontalPosition==="end"&&f,x=!v&&s.horizontalPosition!=="center";return v?i.left("0"):x?i.right("0"):i.centerHorizontally(),s.verticalPosition==="top"?i.top("0"):i.bottom("0"),a.positionStrategy=i,this._overlay.create(a)}_createInjector(s,a){let i=s&&s.viewContainerRef&&s.viewContainerRef.injector;return Jo.create({parent:i||this._injector,providers:[{provide:yg,useValue:a},{provide:PI,useValue:s.data}]})}};e.\u0275fac=function(a){return new(a||e)(Sr(sl),Sr(WE),Sr(Jo),Sr(VE),Sr(e,12),Sr(ZG))},e.\u0275prov=jr({token:e,factory:e.\u0275fac,providedIn:"root"});let o=e;return o})();var kI=(()=>{let e=class e{};e.\u0275fac=function(a){return new(a||e)},e.\u0275mod=ds({type:e}),e.\u0275inj=hs({providers:[rb],imports:[Uh,C0,ho,Ss,RI,Ss]});let o=e;return o})();var $G=["knob"],YG=["valueIndicatorContainer"];function JG(o,e){if(o&1&&(xt(0,"div",4,5)(2,"div",6)(3,"span",7),Bi(4),It()()()),o&2){let t=di();Ct(4),Or(t.valueIndicatorText)}}var KG=["trackActive"];function QG(o,e){if(o&1&&Ln(0,"div"),o&2){let t=e.$implicit,s=e.$index,a=di(3);wu(t===0?"mdc-slider__tick-mark--active":"mdc-slider__tick-mark--inactive"),ca("transform",a._calcTickMarkTransform(s))}}function eH(o,e){if(o&1&&Js(0,QG,1,4,"div",9,Ko),o&2){let t=di(2);Ks(t._tickMarks)}}function tH(o,e){if(o&1&&(xt(0,"div",7,8),ln(2,eH,2,0),It()),o&2){let t=di();Ct(2),ka(2,t._cachedWidth?2:-1)}}function iH(o,e){if(o&1&&Ln(0,"mat-slider-visual-thumb",6),o&2){let t=di();si("discrete",t.discrete)("thumbPosition",1)("valueIndicatorText",t.startValueIndicatorText)}}var nH=["*"],cr=function(o){return o[o.START=1]="START",o[o.END=2]="END",o}(cr||{}),D1=function(o){return o[o.ACTIVE=0]="ACTIVE",o[o.INACTIVE=1]="INACTIVE",o}(D1||{}),sb=new Sn("_MatSlider"),DI=new Sn("_MatSliderThumb"),rH=new Sn("_MatSliderRangeThumb"),LI=new Sn("_MatSliderVisualThumb");var sH=(()=>{let e=class e{constructor(s,a,i,f){this._cdr=s,this._ngZone=a,this._slider=f,this._isHovered=!1,this._isActive=!1,this._isValueIndicatorVisible=!1,this._platform=ai(Qo),this._onPointerMove=v=>{if(this._sliderInput._isFocused)return;let x=this._hostElement.getBoundingClientRect(),M=this._slider._isCursorOnSliderThumb(v,x);this._isHovered=M,M?this._showHoverRipple():this._hideRipple(this._hoverRippleRef)},this._onMouseLeave=()=>{this._isHovered=!1,this._hideRipple(this._hoverRippleRef)},this._onFocus=()=>{this._hideRipple(this._hoverRippleRef),this._showFocusRipple(),this._hostElement.classList.add("mdc-slider__thumb--focused")},this._onBlur=()=>{this._isActive||this._hideRipple(this._focusRippleRef),this._isHovered&&this._showHoverRipple(),this._hostElement.classList.remove("mdc-slider__thumb--focused")},this._onDragStart=v=>{v.button===0&&(this._isActive=!0,this._showActiveRipple())},this._onDragEnd=()=>{this._isActive=!1,this._hideRipple(this._activeRippleRef),this._sliderInput._isFocused||this._hideRipple(this._focusRippleRef),this._platform.SAFARI&&this._showHoverRipple()},this._hostElement=i.nativeElement}ngAfterViewInit(){this._ripple.radius=24,this._sliderInput=this._slider._getInput(this.thumbPosition),this._sliderInputEl=this._sliderInput._hostElement;let s=this._sliderInputEl;this._ngZone.runOutsideAngular(()=>{s.addEventListener("pointermove",this._onPointerMove),s.addEventListener("pointerdown",this._onDragStart),s.addEventListener("pointerup",this._onDragEnd),s.addEventListener("pointerleave",this._onMouseLeave),s.addEventListener("focus",this._onFocus),s.addEventListener("blur",this._onBlur)})}ngOnDestroy(){let s=this._sliderInputEl;s&&(s.removeEventListener("pointermove",this._onPointerMove),s.removeEventListener("pointerdown",this._onDragStart),s.removeEventListener("pointerup",this._onDragEnd),s.removeEventListener("pointerleave",this._onMouseLeave),s.removeEventListener("focus",this._onFocus),s.removeEventListener("blur",this._onBlur))}_showHoverRipple(){this._isShowingRipple(this._hoverRippleRef)||(this._hoverRippleRef=this._showRipple({enterDuration:0,exitDuration:0}),this._hoverRippleRef?.element.classList.add("mat-mdc-slider-hover-ripple"))}_showFocusRipple(){this._isShowingRipple(this._focusRippleRef)||(this._focusRippleRef=this._showRipple({enterDuration:0,exitDuration:0},!0),this._focusRippleRef?.element.classList.add("mat-mdc-slider-focus-ripple"))}_showActiveRipple(){this._isShowingRipple(this._activeRippleRef)||(this._activeRippleRef=this._showRipple({enterDuration:225,exitDuration:400}),this._activeRippleRef?.element.classList.add("mat-mdc-slider-active-ripple"))}_isShowingRipple(s){return s?.state===Ax.FADING_IN||s?.state===Ax.VISIBLE}_showRipple(s,a){if(!this._slider.disabled&&(this._showValueIndicator(),this._slider._isRange&&this._slider._getThumb(this.thumbPosition===cr.START?cr.END:cr.START)._showValueIndicator(),!(this._slider._globalRippleOptions?.disabled&&!a)))return this._ripple.launch({animation:this._slider._noopAnimations?{enterDuration:0,exitDuration:0}:s,centered:!0,persistent:!0})}_hideRipple(s){if(s?.fadeOut(),this._isShowingAnyRipple())return;this._slider._isRange||this._hideValueIndicator();let a=this._getSibling();a._isShowingAnyRipple()||(this._hideValueIndicator(),a._hideValueIndicator())}_showValueIndicator(){this._hostElement.classList.add("mdc-slider__thumb--with-indicator")}_hideValueIndicator(){this._hostElement.classList.remove("mdc-slider__thumb--with-indicator")}_getSibling(){return this._slider._getThumb(this.thumbPosition===cr.START?cr.END:cr.START)}_getValueIndicatorContainer(){return this._valueIndicatorContainer?.nativeElement}_getKnob(){return this._knob.nativeElement}_isShowingAnyRipple(){return this._isShowingRipple(this._hoverRippleRef)||this._isShowingRipple(this._focusRippleRef)||this._isShowingRipple(this._activeRippleRef)}};e.\u0275fac=function(a){return new(a||e)(Et(ts),Et(Ur),Et(Ir),Et(sb))},e.\u0275cmp=$i({type:e,selectors:[["mat-slider-visual-thumb"]],viewQuery:function(a,i){if(a&1&&(Br(Mu,5),Br($G,5),Br(YG,5)),a&2){let f;Nn(f=zn())&&(i._ripple=f.first),Nn(f=zn())&&(i._knob=f.first),Nn(f=zn())&&(i._valueIndicatorContainer=f.first)}},hostAttrs:[1,"mdc-slider__thumb","mat-mdc-slider-visual-thumb"],inputs:{discrete:"discrete",thumbPosition:"thumbPosition",valueIndicatorText:"valueIndicatorText"},standalone:!0,features:[Qs([{provide:LI,useExisting:e}]),Yi],decls:4,vars:2,consts:[["class","mdc-slider__value-indicator-container"],[1,"mdc-slider__thumb-knob"],["knob",""],["matRipple","",1,"mat-mdc-focus-indicator",3,"matRippleDisabled"],[1,"mdc-slider__value-indicator-container"],["valueIndicatorContainer",""],[1,"mdc-slider__value-indicator"],[1,"mdc-slider__value-indicator-text"]],template:function(a,i){a&1&&(ln(0,JG,5,1,"div",0),Ln(1,"div",1,2)(3,"div",3)),a&2&&(ka(0,i.discrete?0:-1),Ct(3),si("matRippleDisabled",!0))},dependencies:[Mu],styles:[".mat-mdc-slider-visual-thumb .mat-ripple{height:100%;width:100%}.mat-mdc-slider .mdc-slider__tick-marks{justify-content:start}.mat-mdc-slider .mdc-slider__tick-marks .mdc-slider__tick-mark--active,.mat-mdc-slider .mdc-slider__tick-marks .mdc-slider__tick-mark--inactive{position:absolute;left:2px}"],encapsulation:2,changeDetection:0});let o=e;return o})(),FI=(()=>{let e=class e{get disabled(){return this._disabled}set disabled(s){this._disabled=s;let a=this._getInput(cr.END),i=this._getInput(cr.START);a&&(a.disabled=this._disabled),i&&(i.disabled=this._disabled)}get discrete(){return this._discrete}set discrete(s){this._discrete=s,this._updateValueIndicatorUIs()}get min(){return this._min}set min(s){let a=isNaN(s)?this._min:s;this._min!==a&&this._updateMin(a)}_updateMin(s){let a=this._min;this._min=s,this._isRange?this._updateMinRange({old:a,new:s}):this._updateMinNonRange(s),this._onMinMaxOrStepChange()}_updateMinRange(s){let a=this._getInput(cr.END),i=this._getInput(cr.START),f=a.value,v=i.value;i.min=s.new,a.min=Math.max(s.new,i.value),i.max=Math.min(a.max,a.value),i._updateWidthInactive(),a._updateWidthInactive(),s.new<s.old?this._onTranslateXChangeBySideEffect(a,i):this._onTranslateXChangeBySideEffect(i,a),f!==a.value&&this._onValueChange(a),v!==i.value&&this._onValueChange(i)}_updateMinNonRange(s){let a=this._getInput(cr.END);if(a){let i=a.value;a.min=s,a._updateThumbUIByValue(),this._updateTrackUI(a),i!==a.value&&this._onValueChange(a)}}get max(){return this._max}set max(s){let a=isNaN(s)?this._max:s;this._max!==a&&this._updateMax(a)}_updateMax(s){let a=this._max;this._max=s,this._isRange?this._updateMaxRange({old:a,new:s}):this._updateMaxNonRange(s),this._onMinMaxOrStepChange()}_updateMaxRange(s){let a=this._getInput(cr.END),i=this._getInput(cr.START),f=a.value,v=i.value;a.max=s.new,i.max=Math.min(s.new,a.value),a.min=i.value,a._updateWidthInactive(),i._updateWidthInactive(),s.new>s.old?this._onTranslateXChangeBySideEffect(i,a):this._onTranslateXChangeBySideEffect(a,i),f!==a.value&&this._onValueChange(a),v!==i.value&&this._onValueChange(i)}_updateMaxNonRange(s){let a=this._getInput(cr.END);if(a){let i=a.value;a.max=s,a._updateThumbUIByValue(),this._updateTrackUI(a),i!==a.value&&this._onValueChange(a)}}get step(){return this._step}set step(s){let a=isNaN(s)?this._step:s;this._step!==a&&this._updateStep(a)}_updateStep(s){this._step=s,this._isRange?this._updateStepRange():this._updateStepNonRange(),this._onMinMaxOrStepChange()}_updateStepRange(){let s=this._getInput(cr.END),a=this._getInput(cr.START),i=s.value,f=a.value,v=a.value;s.min=this._min,a.max=this._max,s.step=this._step,a.step=this._step,this._platform.SAFARI&&(s.value=s.value,a.value=a.value),s.min=Math.max(this._min,a.value),a.max=Math.min(this._max,s.value),a._updateWidthInactive(),s._updateWidthInactive(),s.value<v?this._onTranslateXChangeBySideEffect(a,s):this._onTranslateXChangeBySideEffect(s,a),i!==s.value&&this._onValueChange(s),f!==a.value&&this._onValueChange(a)}_updateStepNonRange(){let s=this._getInput(cr.END);if(s){let a=s.value;s.step=this._step,this._platform.SAFARI&&(s.value=s.value),s._updateThumbUIByValue(),a!==s.value&&this._onValueChange(s)}}constructor(s,a,i,f,v,x){this._ngZone=s,this._cdr=a,this._elementRef=i,this._dir=f,this._globalRippleOptions=v,this._disabled=!1,this._discrete=!1,this.showTickMarks=!1,this._min=0,this.disableRipple=!1,this._max=100,this._step=1,this.displayWith=M=>`${M}`,this._rippleRadius=24,this.startValueIndicatorText="",this.endValueIndicatorText="",this._isRange=!1,this._isRtl=!1,this._hasViewInitialized=!1,this._tickMarkTrackWidth=0,this._hasAnimation=!1,this._resizeTimer=null,this._platform=ai(Qo),this._knobRadius=8,this._thumbsOverlap=!1,this._noopAnimations=x==="NoopAnimations",this._dirChangeSubscription=this._dir.change.subscribe(()=>this._onDirChange()),this._isRtl=this._dir.value==="rtl"}ngAfterViewInit(){this._platform.isBrowser&&this._updateDimensions();let s=this._getInput(cr.END),a=this._getInput(cr.START);this._isRange=!!s&&!!a,this._cdr.detectChanges();let i=this._getThumb(cr.END);this._rippleRadius=i._ripple.radius,this._inputPadding=this._rippleRadius-this._knobRadius,this._isRange?this._initUIRange(s,a):this._initUINonRange(s),this._updateTrackUI(s),this._updateTickMarkUI(),this._updateTickMarkTrackUI(),this._observeHostResize(),this._cdr.detectChanges()}_initUINonRange(s){s.initProps(),s.initUI(),this._updateValueIndicatorUI(s),this._hasViewInitialized=!0,s._updateThumbUIByValue()}_initUIRange(s,a){s.initProps(),s.initUI(),a.initProps(),a.initUI(),s._updateMinMax(),a._updateMinMax(),s._updateStaticStyles(),a._updateStaticStyles(),this._updateValueIndicatorUIs(),this._hasViewInitialized=!0,s._updateThumbUIByValue(),a._updateThumbUIByValue()}ngOnDestroy(){this._dirChangeSubscription.unsubscribe(),this._resizeObserver?.disconnect(),this._resizeObserver=null}_onDirChange(){this._isRtl=this._dir.value==="rtl",this._isRange?this._onDirChangeRange():this._onDirChangeNonRange(),this._updateTickMarkUI()}_onDirChangeRange(){let s=this._getInput(cr.END),a=this._getInput(cr.START);s._setIsLeftThumb(),a._setIsLeftThumb(),s.translateX=s._calcTranslateXByValue(),a.translateX=a._calcTranslateXByValue(),s._updateStaticStyles(),a._updateStaticStyles(),s._updateWidthInactive(),a._updateWidthInactive(),s._updateThumbUIByValue(),a._updateThumbUIByValue()}_onDirChangeNonRange(){this._getInput(cr.END)._updateThumbUIByValue()}_observeHostResize(){typeof ResizeObserver>"u"||!ResizeObserver||this._ngZone.runOutsideAngular(()=>{this._resizeObserver=new ResizeObserver(()=>{this._isActive()||(this._resizeTimer&&clearTimeout(this._resizeTimer),this._onResize())}),this._resizeObserver.observe(this._elementRef.nativeElement)})}_isActive(){return this._getThumb(cr.START)._isActive||this._getThumb(cr.END)._isActive}_getValue(s=cr.END){let a=this._getInput(s);return a?a.value:this.min}_skipUpdate(){return!!(this._getInput(cr.START)?._skipUIUpdate||this._getInput(cr.END)?._skipUIUpdate)}_updateDimensions(){this._cachedWidth=this._elementRef.nativeElement.offsetWidth,this._cachedLeft=this._elementRef.nativeElement.getBoundingClientRect().left}_setTrackActiveStyles(s){let a=this._trackActive.nativeElement.style;a.left=s.left,a.right=s.right,a.transformOrigin=s.transformOrigin,a.transform=s.transform}_calcTickMarkTransform(s){return`translateX(${s*(this._tickMarkTrackWidth/(this._tickMarks.length-1))}px`}_onTranslateXChange(s){this._hasViewInitialized&&(this._updateThumbUI(s),this._updateTrackUI(s),this._updateOverlappingThumbUI(s))}_onTranslateXChangeBySideEffect(s,a){this._hasViewInitialized&&(s._updateThumbUIByValue(),a._updateThumbUIByValue())}_onValueChange(s){this._hasViewInitialized&&(this._updateValueIndicatorUI(s),this._updateTickMarkUI(),this._cdr.detectChanges())}_onMinMaxOrStepChange(){this._hasViewInitialized&&(this._updateTickMarkUI(),this._updateTickMarkTrackUI(),this._cdr.markForCheck())}_onResize(){if(this._hasViewInitialized){if(this._updateDimensions(),this._isRange){let s=this._getInput(cr.END),a=this._getInput(cr.START);s._updateThumbUIByValue(),a._updateThumbUIByValue(),s._updateStaticStyles(),a._updateStaticStyles(),s._updateMinMax(),a._updateMinMax(),s._updateWidthInactive(),a._updateWidthInactive()}else{let s=this._getInput(cr.END);s&&s._updateThumbUIByValue()}this._updateTickMarkUI(),this._updateTickMarkTrackUI(),this._cdr.detectChanges()}}_areThumbsOverlapping(){let s=this._getInput(cr.START),a=this._getInput(cr.END);return!s||!a?!1:a.translateX-s.translateX<20}_updateOverlappingThumbClassNames(s){let a=s.getSibling(),i=this._getThumb(s.thumbPosition);this._getThumb(a.thumbPosition)._hostElement.classList.remove("mdc-slider__thumb--top"),i._hostElement.classList.toggle("mdc-slider__thumb--top",this._thumbsOverlap)}_updateOverlappingThumbUI(s){!this._isRange||this._skipUpdate()||this._thumbsOverlap!==this._areThumbsOverlapping()&&(this._thumbsOverlap=!this._thumbsOverlap,this._updateOverlappingThumbClassNames(s))}_updateThumbUI(s){if(this._skipUpdate())return;let a=this._getThumb(s.thumbPosition===cr.END?cr.END:cr.START);a._hostElement.style.transform=`translateX(${s.translateX}px)`}_updateValueIndicatorUI(s){if(this._skipUpdate())return;let a=this.displayWith(s.value);if(this._hasViewInitialized?s._valuetext=a:s._hostElement.setAttribute("aria-valuetext",a),this.discrete){s.thumbPosition===cr.START?this.startValueIndicatorText=a:this.endValueIndicatorText=a;let i=this._getThumb(s.thumbPosition);a.length<3?i._hostElement.classList.add("mdc-slider__thumb--short-value"):i._hostElement.classList.remove("mdc-slider__thumb--short-value")}}_updateValueIndicatorUIs(){let s=this._getInput(cr.END),a=this._getInput(cr.START);s&&this._updateValueIndicatorUI(s),a&&this._updateValueIndicatorUI(a)}_updateTickMarkTrackUI(){if(!this.showTickMarks||this._skipUpdate())return;let s=this._step&&this._step>0?this._step:1,i=(Math.floor(this.max/s)*s-this.min)/(this.max-this.min);this._tickMarkTrackWidth=this._cachedWidth*i-6}_updateTrackUI(s){this._skipUpdate()||(this._isRange?this._updateTrackUIRange(s):this._updateTrackUINonRange(s))}_updateTrackUIRange(s){let a=s.getSibling();if(!a||!this._cachedWidth)return;let i=Math.abs(a.translateX-s.translateX)/this._cachedWidth;s._isLeftThumb&&this._cachedWidth?this._setTrackActiveStyles({left:"auto",right:`${this._cachedWidth-a.translateX}px`,transformOrigin:"right",transform:`scaleX(${i})`}):this._setTrackActiveStyles({left:`${a.translateX}px`,right:"auto",transformOrigin:"left",transform:`scaleX(${i})`})}_updateTrackUINonRange(s){this._isRtl?this._setTrackActiveStyles({left:"auto",right:"0px",transformOrigin:"right",transform:`scaleX(${1-s.fillPercentage})`}):this._setTrackActiveStyles({left:"0px",right:"auto",transformOrigin:"left",transform:`scaleX(${s.fillPercentage})`})}_updateTickMarkUI(){if(!this.showTickMarks||this.step===void 0||this.min===void 0||this.max===void 0)return;let s=this.step>0?this.step:1;this._isRange?this._updateTickMarkUIRange(s):this._updateTickMarkUINonRange(s),this._isRtl&&this._tickMarks.reverse()}_updateTickMarkUINonRange(s){let a=this._getValue(),i=Math.max(Math.floor((a-this.min)/s),0),f=Math.max(Math.floor((this.max-a)/s),0);this._isRtl?i++:f++,this._tickMarks=Array(i).fill(D1.ACTIVE).concat(Array(f).fill(D1.INACTIVE))}_updateTickMarkUIRange(s){let a=this._getValue(),i=this._getValue(cr.START),f=Math.max(Math.floor((i-this.min)/s),0),v=Math.max(Math.floor((a-i)/s)+1,0),x=Math.max(Math.floor((this.max-a)/s),0);this._tickMarks=Array(f).fill(D1.INACTIVE).concat(Array(v).fill(D1.ACTIVE),Array(x).fill(D1.INACTIVE))}_getInput(s){if(s===cr.END&&this._input)return this._input;if(this._inputs?.length)return s===cr.START?this._inputs.first:this._inputs.last}_getThumb(s){return s===cr.END?this._thumbs?.last:this._thumbs?.first}_setTransition(s){this._hasAnimation=!this._platform.IOS&&s&&!this._noopAnimations,this._elementRef.nativeElement.classList.toggle("mat-mdc-slider-with-animation",this._hasAnimation)}_isCursorOnSliderThumb(s,a){let i=a.width/2,f=a.x+i,v=a.y+i,x=s.clientX-f,M=s.clientY-v;return Math.pow(x,2)+Math.pow(M,2)<Math.pow(i,2)}};e.\u0275fac=function(a){return new(a||e)(Et(Ur),Et(ts),Et(Ir),Et(Kl,8),Et(d1,8),Et(yo,8))},e.\u0275cmp=$i({type:e,selectors:[["mat-slider"]],contentQueries:function(a,i,f){if(a&1&&(zs(f,DI,5),zs(f,rH,4)),a&2){let v;Nn(v=zn())&&(i._input=v.first),Nn(v=zn())&&(i._inputs=v)}},viewQuery:function(a,i){if(a&1&&(Br(KG,5),Br(LI,5)),a&2){let f;Nn(f=zn())&&(i._trackActive=f.first),Nn(f=zn())&&(i._thumbs=f)}},hostAttrs:[1,"mat-mdc-slider","mdc-slider"],hostVars:12,hostBindings:function(a,i){a&2&&(wu("mat-"+(i.color||"primary")),Fr("mdc-slider--range",i._isRange)("mdc-slider--disabled",i.disabled)("mdc-slider--discrete",i.discrete)("mdc-slider--tick-marks",i.showTickMarks)("_mat-animation-noopable",i._noopAnimations))},inputs:{disabled:[wn.HasDecoratorInputTransform,"disabled","disabled",Wr],discrete:[wn.HasDecoratorInputTransform,"discrete","discrete",Wr],showTickMarks:[wn.HasDecoratorInputTransform,"showTickMarks","showTickMarks",Wr],min:[wn.HasDecoratorInputTransform,"min","min",vo],color:"color",disableRipple:[wn.HasDecoratorInputTransform,"disableRipple","disableRipple",Wr],max:[wn.HasDecoratorInputTransform,"max","max",vo],step:[wn.HasDecoratorInputTransform,"step","step",vo],displayWith:"displayWith"},exportAs:["matSlider"],standalone:!0,features:[Qs([{provide:sb,useExisting:e}]),Es,Yi],ngContentSelectors:nH,decls:9,vars:5,consts:[[1,"mdc-slider__track"],[1,"mdc-slider__track--inactive"],[1,"mdc-slider__track--active"],[1,"mdc-slider__track--active_fill"],["trackActive",""],["class","mdc-slider__tick-marks"],[3,"discrete","thumbPosition","valueIndicatorText"],[1,"mdc-slider__tick-marks"],["tickMarkContainer",""],[3,"class","transform"]],template:function(a,i){a&1&&(ks(),Pr(0),xt(1,"div",0),Ln(2,"div",1),xt(3,"div",2),Ln(4,"div",3,4),It(),ln(6,tH,3,1,"div",5),It(),ln(7,iH,1,3,"mat-slider-visual-thumb",6),Ln(8,"mat-slider-visual-thumb",6)),a&2&&(Ct(6),ka(6,i.showTickMarks?6:-1),Ct(),ka(7,i._isRange?7:-1),Ct(),si("discrete",i.discrete)("thumbPosition",2)("valueIndicatorText",i.endValueIndicatorText))},dependencies:[sH],styles:['.mdc-slider{cursor:pointer;height:48px;margin:0 24px;position:relative;touch-action:pan-y}.mdc-slider .mdc-slider__track{position:absolute;top:50%;transform:translateY(-50%);width:100%}.mdc-slider .mdc-slider__track--active,.mdc-slider .mdc-slider__track--inactive{display:flex;height:100%;position:absolute;width:100%}.mdc-slider .mdc-slider__track--active{overflow:hidden}.mdc-slider .mdc-slider__track--active_fill{border-top-style:solid;box-sizing:border-box;height:100%;width:100%;position:relative;-webkit-transform-origin:left;transform-origin:left}[dir=rtl] .mdc-slider .mdc-slider__track--active_fill,.mdc-slider .mdc-slider__track--active_fill[dir=rtl]{-webkit-transform-origin:right;transform-origin:right}.mdc-slider .mdc-slider__track--inactive{left:0;top:0}.mdc-slider .mdc-slider__track--inactive::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:1px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}@media screen and (forced-colors: active){.mdc-slider .mdc-slider__track--inactive::before{border-color:CanvasText}}.mdc-slider .mdc-slider__value-indicator-container{bottom:44px;left:50%;left:var(--slider-value-indicator-container-left, 50%);pointer-events:none;position:absolute;right:var(--slider-value-indicator-container-right);transform:translateX(-50%);transform:var(--slider-value-indicator-container-transform, translateX(-50%))}.mdc-slider .mdc-slider__value-indicator{transition:transform 100ms 0ms cubic-bezier(0.4, 0, 1, 1);align-items:center;border-radius:4px;display:flex;height:32px;padding:0 12px;transform:scale(0);transform-origin:bottom}.mdc-slider .mdc-slider__value-indicator::before{border-left:6px solid rgba(0,0,0,0);border-right:6px solid rgba(0,0,0,0);border-top:6px solid;bottom:-5px;content:"";height:0;left:50%;left:var(--slider-value-indicator-caret-left, 50%);position:absolute;right:var(--slider-value-indicator-caret-right);transform:translateX(-50%);transform:var(--slider-value-indicator-caret-transform, translateX(-50%));width:0}.mdc-slider .mdc-slider__value-indicator::after{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:1px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}@media screen and (forced-colors: active){.mdc-slider .mdc-slider__value-indicator::after{border-color:CanvasText}}.mdc-slider .mdc-slider__thumb--with-indicator .mdc-slider__value-indicator-container{pointer-events:auto}.mdc-slider .mdc-slider__thumb--with-indicator .mdc-slider__value-indicator{transition:transform 100ms 0ms cubic-bezier(0, 0, 0.2, 1);transform:scale(1)}@media(prefers-reduced-motion){.mdc-slider .mdc-slider__value-indicator,.mdc-slider .mdc-slider__thumb--with-indicator .mdc-slider__value-indicator{transition:none}}.mdc-slider .mdc-slider__thumb{display:flex;left:-24px;outline:none;position:absolute;user-select:none;height:48px;width:48px}.mdc-slider .mdc-slider__thumb--top{z-index:1}.mdc-slider .mdc-slider__thumb--top .mdc-slider__thumb-knob,.mdc-slider .mdc-slider__thumb--top.mdc-slider__thumb:hover .mdc-slider__thumb-knob,.mdc-slider .mdc-slider__thumb--top.mdc-slider__thumb--focused .mdc-slider__thumb-knob{border-style:solid;border-width:1px;box-sizing:content-box}.mdc-slider .mdc-slider__thumb-knob{box-sizing:border-box;left:50%;position:absolute;top:50%;transform:translate(-50%, -50%)}.mdc-slider .mdc-slider__tick-marks{align-items:center;box-sizing:border-box;display:flex;height:100%;justify-content:space-between;padding:0 1px;position:absolute;width:100%}.mdc-slider--discrete .mdc-slider__thumb,.mdc-slider--discrete .mdc-slider__track--active_fill{transition:transform 80ms ease}@media(prefers-reduced-motion){.mdc-slider--discrete .mdc-slider__thumb,.mdc-slider--discrete .mdc-slider__track--active_fill{transition:none}}.mdc-slider--disabled{cursor:auto}.mdc-slider--disabled .mdc-slider__thumb{pointer-events:none}.mdc-slider__input{cursor:pointer;left:2px;margin:0;height:44px;opacity:0;pointer-events:none;position:absolute;top:2px;width:44px}.mat-mdc-slider{display:inline-block;box-sizing:border-box;outline:none;vertical-align:middle;margin-left:8px;margin-right:8px;width:auto;min-width:112px;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-slider .mdc-slider__thumb-knob{background-color:var(--mdc-slider-handle-color);border-color:var(--mdc-slider-handle-color)}.mat-mdc-slider .mdc-slider__thumb--top .mdc-slider__thumb-knob,.mat-mdc-slider .mdc-slider__thumb--top.mdc-slider__thumb:hover .mdc-slider__thumb-knob,.mat-mdc-slider .mdc-slider__thumb--top.mdc-slider__thumb--focused .mdc-slider__thumb-knob{border-color:#fff}.mat-mdc-slider.mdc-slider--disabled .mdc-slider__thumb-knob{background-color:var(--mdc-slider-disabled-handle-color);border-color:var(--mdc-slider-disabled-handle-color)}.mat-mdc-slider.mdc-slider--disabled .mdc-slider__thumb--top .mdc-slider__thumb-knob,.mat-mdc-slider.mdc-slider--disabled .mdc-slider__thumb--top.mdc-slider__thumb:hover .mdc-slider__thumb-knob,.mat-mdc-slider.mdc-slider--disabled .mdc-slider__thumb--top.mdc-slider__thumb--focused .mdc-slider__thumb-knob{border-color:#fff}.mat-mdc-slider .mdc-slider__thumb::before,.mat-mdc-slider .mdc-slider__thumb::after{background-color:var(--mdc-slider-handle-color)}.mat-mdc-slider .mdc-slider__thumb:hover::before,.mat-mdc-slider .mdc-slider__thumb.mdc-ripple-surface--hover::before{opacity:var(--mdc-ripple-hover-opacity)}.mat-mdc-slider .mdc-slider__thumb.mdc-ripple-upgraded--background-focused::before,.mat-mdc-slider .mdc-slider__thumb:not(.mdc-ripple-upgraded):focus::before{transition-duration:75ms;opacity:var(--mdc-ripple-focus-opacity)}.mat-mdc-slider .mdc-slider__thumb:not(.mdc-ripple-upgraded)::after{transition:opacity 150ms linear}.mat-mdc-slider .mdc-slider__thumb:not(.mdc-ripple-upgraded):active::after{transition-duration:75ms;opacity:var(--mdc-ripple-press-opacity)}.mat-mdc-slider .mdc-slider__thumb.mdc-ripple-upgraded{--mdc-ripple-fg-opacity:var(--mdc-ripple-press-opacity)}.mat-mdc-slider .mdc-slider__track--active_fill{border-color:var(--mdc-slider-active-track-color)}.mat-mdc-slider.mdc-slider--disabled .mdc-slider__track--active_fill{border-color:var(--mdc-slider-disabled-active-track-color)}.mat-mdc-slider .mdc-slider__track--inactive{background-color:var(--mdc-slider-inactive-track-color);opacity:.24}.mat-mdc-slider.mdc-slider--disabled .mdc-slider__track--inactive{background-color:var(--mdc-slider-disabled-inactive-track-color);opacity:.24}.mat-mdc-slider .mdc-slider__tick-mark--active{background-color:var(--mdc-slider-with-tick-marks-active-container-color);opacity:var(--mdc-slider-with-tick-marks-active-container-opacity)}.mat-mdc-slider.mdc-slider--disabled .mdc-slider__tick-mark--active{background-color:var(--mdc-slider-with-tick-marks-active-container-color);opacity:var(--mdc-slider-with-tick-marks-active-container-opacity)}.mat-mdc-slider .mdc-slider__tick-mark--inactive{background-color:var(--mdc-slider-with-tick-marks-inactive-container-color);opacity:var(--mdc-slider-with-tick-marks-inactive-container-opacity)}.mat-mdc-slider.mdc-slider--disabled .mdc-slider__tick-mark--inactive{background-color:var(--mdc-slider-with-tick-marks-disabled-container-color);opacity:var(--mdc-slider-with-tick-marks-inactive-container-opacity)}.mat-mdc-slider .mdc-slider__value-indicator{background-color:var(--mdc-slider-label-container-color);opacity:1}.mat-mdc-slider .mdc-slider__value-indicator::before{border-top-color:var(--mdc-slider-label-container-color)}.mat-mdc-slider .mdc-slider__value-indicator{color:var(--mdc-slider-label-label-text-color)}.mat-mdc-slider .mdc-slider__track{height:var(--mdc-slider-inactive-track-height)}.mat-mdc-slider .mdc-slider__track--active{height:var(--mdc-slider-active-track-height);top:calc((var(--mdc-slider-inactive-track-height) - var(--mdc-slider-active-track-height)) / 2)}.mat-mdc-slider .mdc-slider__track--active_fill{border-top-width:var(--mdc-slider-active-track-height)}.mat-mdc-slider .mdc-slider__track--inactive{height:var(--mdc-slider-inactive-track-height)}.mat-mdc-slider .mdc-slider__tick-mark--active,.mat-mdc-slider .mdc-slider__tick-mark--inactive{height:var(--mdc-slider-with-tick-marks-container-size);width:var(--mdc-slider-with-tick-marks-container-size)}.mat-mdc-slider.mdc-slider--disabled{opacity:0.38}.mat-mdc-slider .mdc-slider__value-indicator-text{letter-spacing:var(--mdc-slider-label-label-text-tracking);font-size:var(--mdc-slider-label-label-text-size);font-family:var(--mdc-slider-label-label-text-font);font-weight:var(--mdc-slider-label-label-text-weight);line-height:var(--mdc-slider-label-label-text-line-height)}.mat-mdc-slider .mdc-slider__track--active{border-radius:var(--mdc-slider-active-track-shape)}.mat-mdc-slider .mdc-slider__track--inactive{border-radius:var(--mdc-slider-inactive-track-shape)}.mat-mdc-slider .mdc-slider__thumb-knob{border-radius:var(--mdc-slider-handle-shape);width:var(--mdc-slider-handle-width);height:var(--mdc-slider-handle-height);border-style:solid;border-width:calc(var(--mdc-slider-handle-height) / 2) calc(var(--mdc-slider-handle-width) / 2)}.mat-mdc-slider .mdc-slider__tick-mark--active,.mat-mdc-slider .mdc-slider__tick-mark--inactive{border-radius:var(--mdc-slider-with-tick-marks-container-shape)}.mat-mdc-slider .mdc-slider__thumb:hover .mdc-slider__thumb-knob{background-color:var(--mdc-slider-hover-handle-color);border-color:var(--mdc-slider-hover-handle-color)}.mat-mdc-slider .mdc-slider__thumb:hover .mdc-slider__thumb--top .mdc-slider__thumb-knob,.mat-mdc-slider .mdc-slider__thumb:hover .mdc-slider__thumb--top.mdc-slider__thumb:hover .mdc-slider__thumb-knob,.mat-mdc-slider .mdc-slider__thumb:hover .mdc-slider__thumb--top.mdc-slider__thumb--focused .mdc-slider__thumb-knob{border-color:#fff}.mat-mdc-slider .mdc-slider__thumb--focused .mdc-slider__thumb-knob{background-color:var(--mdc-slider-focus-handle-color);border-color:var(--mdc-slider-focus-handle-color)}.mat-mdc-slider .mdc-slider__thumb--focused .mdc-slider__thumb--top .mdc-slider__thumb-knob,.mat-mdc-slider .mdc-slider__thumb--focused .mdc-slider__thumb--top.mdc-slider__thumb:hover .mdc-slider__thumb-knob,.mat-mdc-slider .mdc-slider__thumb--focused .mdc-slider__thumb--top.mdc-slider__thumb--focused .mdc-slider__thumb-knob{border-color:#fff}.mat-mdc-slider .mdc-slider__thumb:not(:disabled):active .mdc-slider__thumb--top .mdc-slider__thumb-knob,.mat-mdc-slider .mdc-slider__thumb:not(:disabled):active .mdc-slider__thumb--top.mdc-slider__thumb:hover .mdc-slider__thumb-knob,.mat-mdc-slider .mdc-slider__thumb:not(:disabled):active .mdc-slider__thumb--top.mdc-slider__thumb--focused .mdc-slider__thumb-knob{border-color:#fff}.mat-mdc-slider .mdc-slider__thumb--top .mdc-slider__thumb-knob,.mat-mdc-slider .mdc-slider__thumb--top.mdc-slider__thumb:hover .mdc-slider__thumb-knob,.mat-mdc-slider .mdc-slider__thumb--top.mdc-slider__thumb--focused .mdc-slider__thumb-knob{border-color:var(--mdc-slider-with-overlap-handle-outline-color);border-width:var(--mdc-slider-with-overlap-handle-outline-width)}.mat-mdc-slider .mdc-slider__thumb-knob{box-shadow:var(--mdc-slider-handle-elevation)}.mat-mdc-slider .mdc-slider__input{box-sizing:content-box;pointer-events:auto}.mat-mdc-slider .mdc-slider__input.mat-mdc-slider-input-no-pointer-events{pointer-events:none}.mat-mdc-slider .mdc-slider__input.mat-slider__right-input{left:auto;right:0}.mat-mdc-slider .mdc-slider__thumb,.mat-mdc-slider .mdc-slider__track--active_fill{transition-duration:0ms}.mat-mdc-slider.mat-mdc-slider-with-animation .mdc-slider__thumb,.mat-mdc-slider.mat-mdc-slider-with-animation .mdc-slider__track--active_fill{transition-duration:80ms}.mat-mdc-slider.mdc-slider--discrete .mdc-slider__thumb,.mat-mdc-slider.mdc-slider--discrete .mdc-slider__track--active_fill{transition-duration:0ms}.mat-mdc-slider.mat-mdc-slider-with-animation .mdc-slider__thumb,.mat-mdc-slider.mat-mdc-slider-with-animation .mdc-slider__track--active_fill{transition-duration:80ms}.mat-mdc-slider .mdc-slider__track,.mat-mdc-slider .mdc-slider__thumb{pointer-events:none}.mat-mdc-slider .mdc-slider__value-indicator-container{transform:var(--mat-slider-value-indicator-container-transform)}.mat-mdc-slider .mdc-slider__value-indicator{width:var(--mat-slider-value-indicator-width);height:var(--mat-slider-value-indicator-height);padding:var(--mat-slider-value-indicator-padding);opacity:var(--mat-slider-value-indicator-opacity);border-radius:var(--mat-slider-value-indicator-border-radius)}.mat-mdc-slider .mdc-slider__value-indicator::before{display:var(--mat-slider-value-indicator-caret-display)}.mat-mdc-slider .mdc-slider__value-indicator-text{width:var(--mat-slider-value-indicator-width);transform:var(--mat-slider-value-indicator-text-transform)}.mat-mdc-slider .mat-ripple .mat-ripple-element{background-color:var(--mat-slider-ripple-color)}.mat-mdc-slider .mat-ripple .mat-mdc-slider-hover-ripple{background-color:var(--mat-slider-hover-state-layer-color)}.mat-mdc-slider .mat-ripple .mat-mdc-slider-focus-ripple,.mat-mdc-slider .mat-ripple .mat-mdc-slider-active-ripple{background-color:var(--mat-slider-focus-state-layer-color)}.mat-mdc-slider._mat-animation-noopable.mdc-slider--discrete .mdc-slider__thumb,.mat-mdc-slider._mat-animation-noopable.mdc-slider--discrete .mdc-slider__track--active_fill,.mat-mdc-slider._mat-animation-noopable .mdc-slider__value-indicator{transition:none}.mat-mdc-slider .mat-mdc-focus-indicator::before{border-radius:50%}.mat-mdc-slider .mdc-slider__value-indicator{word-break:normal}.mat-mdc-slider .mdc-slider__value-indicator-text{text-align:center}.mdc-slider__thumb--focused .mat-mdc-focus-indicator::before{content:""}'],encapsulation:2,changeDetection:0});let o=e;return o})();var oH={provide:zE,useExisting:A2(()=>ob),multi:!0};var ob=(()=>{let e=class e{get value(){return vo(this._hostElement.value,0)}set value(s){s=isNaN(s)?0:s;let a=s+"";if(!this._hasSetInitialValue){this._initialValue=a;return}this._isActive||this._setValue(a)}_setValue(s){this._hostElement.value=s,this._updateThumbUIByValue(),this._slider._onValueChange(this),this._cdr.detectChanges(),this._slider._cdr.markForCheck()}get translateX(){return this._slider.min>=this._slider.max?(this._translateX=this._tickMarkOffset,this._translateX):(this._translateX===void 0&&(this._translateX=this._calcTranslateXByValue()),this._translateX)}set translateX(s){this._translateX=s}get min(){return vo(this._hostElement.min,0)}set min(s){this._hostElement.min=s+"",this._cdr.detectChanges()}get max(){return vo(this._hostElement.max,0)}set max(s){this._hostElement.max=s+"",this._cdr.detectChanges()}get step(){return vo(this._hostElement.step,0)}set step(s){this._hostElement.step=s+"",this._cdr.detectChanges()}get disabled(){return Wr(this._hostElement.disabled)}set disabled(s){this._hostElement.disabled=s,this._cdr.detectChanges(),this._slider.disabled!==this.disabled&&(this._slider.disabled=this.disabled)}get percentage(){return this._slider.min>=this._slider.max?this._slider._isRtl?1:0:(this.value-this._slider.min)/(this._slider.max-this._slider.min)}get fillPercentage(){return this._slider._cachedWidth?this._translateX===0?0:this.translateX/this._slider._cachedWidth:this._slider._isRtl?1:0}_setIsFocused(s){this._isFocused=s}constructor(s,a,i,f){this._ngZone=s,this._elementRef=a,this._cdr=i,this._slider=f,this.valueChange=new mn,this.dragStart=new mn,this.dragEnd=new mn,this.thumbPosition=cr.END,this._knobRadius=8,this._tickMarkOffset=3,this._isActive=!1,this._isFocused=!1,this._hasSetInitialValue=!1,this._destroyed=new fn,this._skipUIUpdate=!1,this._onTouchedFn=()=>{},this._isControlInitialized=!1,this._platform=ai(Qo),this._hostElement=a.nativeElement,this._ngZone.runOutsideAngular(()=>{this._hostElement.addEventListener("pointerdown",this._onPointerDown.bind(this)),this._hostElement.addEventListener("pointermove",this._onPointerMove.bind(this)),this._hostElement.addEventListener("pointerup",this._onPointerUp.bind(this))})}ngOnDestroy(){this._hostElement.removeEventListener("pointerdown",this._onPointerDown),this._hostElement.removeEventListener("pointermove",this._onPointerMove),this._hostElement.removeEventListener("pointerup",this._onPointerUp),this._destroyed.next(),this._destroyed.complete(),this.dragStart.complete(),this.dragEnd.complete()}initProps(){this._updateWidthInactive(),this.disabled!==this._slider.disabled&&(this._slider.disabled=!0),this.step=this._slider.step,this.min=this._slider.min,this.max=this._slider.max,this._initValue()}initUI(){this._updateThumbUIByValue()}_initValue(){this._hasSetInitialValue=!0,this._initialValue===void 0?this.value=this._getDefaultValue():(this._hostElement.value=this._initialValue,this._updateThumbUIByValue(),this._slider._onValueChange(this),this._cdr.detectChanges())}_getDefaultValue(){return this.min}_onBlur(){this._setIsFocused(!1),this._onTouchedFn()}_onFocus(){this._setIsFocused(!0)}_onChange(){this.valueChange.emit(this.value),this._isActive&&this._updateThumbUIByValue({withAnimation:!0})}_onInput(){this._onChangeFn?.(this.value),(this._slider.step||!this._isActive)&&this._updateThumbUIByValue({withAnimation:!0}),this._slider._onValueChange(this)}_onNgControlValueChange(){(!this._isActive||!this._isFocused)&&(this._slider._onValueChange(this),this._updateThumbUIByValue()),this._slider.disabled=this._formControl.disabled}_onPointerDown(s){if(!(this.disabled||s.button!==0)){if(this._platform.IOS){let a=this._slider._isCursorOnSliderThumb(s,this._slider._getThumb(this.thumbPosition)._hostElement.getBoundingClientRect());this._isActive=a,this._updateWidthActive(),this._slider._updateDimensions();return}this._isActive=!0,this._setIsFocused(!0),this._updateWidthActive(),this._slider._updateDimensions(),this._slider.step||this._updateThumbUIByPointerEvent(s,{withAnimation:!0}),this.disabled||(this._handleValueCorrection(s),this.dragStart.emit({source:this,parent:this._slider,value:this.value}))}}_handleValueCorrection(s){this._skipUIUpdate=!0,setTimeout(()=>{this._skipUIUpdate=!1,this._fixValue(s)},0)}_fixValue(s){let a=s.clientX-this._slider._cachedLeft,i=this._slider._cachedWidth,f=this._slider.step===0?1:this._slider.step,v=Math.floor((this._slider.max-this._slider.min)/f),x=this._slider._isRtl?1-a/i:a/i,C=Math.round(x*v)/v*(this._slider.max-this._slider.min)+this._slider.min,D=Math.round(C/f)*f,L=this.value;if(D===L){this._slider._onValueChange(this),this._slider.step>0?this._updateThumbUIByValue():this._updateThumbUIByPointerEvent(s,{withAnimation:this._slider._hasAnimation});return}this.value=D,this.valueChange.emit(this.value),this._onChangeFn?.(this.value),this._slider._onValueChange(this),this._slider.step>0?this._updateThumbUIByValue():this._updateThumbUIByPointerEvent(s,{withAnimation:this._slider._hasAnimation})}_onPointerMove(s){!this._slider.step&&this._isActive&&this._updateThumbUIByPointerEvent(s)}_onPointerUp(){this._isActive&&(this._isActive=!1,this._platform.SAFARI&&this._setIsFocused(!1),this.dragEnd.emit({source:this,parent:this._slider,value:this.value}),setTimeout(()=>this._updateWidthInactive(),this._platform.IOS?10:0))}_clamp(s){let a=this._tickMarkOffset,i=this._slider._cachedWidth-this._tickMarkOffset;return Math.max(Math.min(s,i),a)}_calcTranslateXByValue(){return this._slider._isRtl?(1-this.percentage)*(this._slider._cachedWidth-this._tickMarkOffset*2)+this._tickMarkOffset:this.percentage*(this._slider._cachedWidth-this._tickMarkOffset*2)+this._tickMarkOffset}_calcTranslateXByPointerEvent(s){return s.clientX-this._slider._cachedLeft}_updateWidthActive(){}_updateWidthInactive(){this._hostElement.style.padding=`0 ${this._slider._inputPadding}px`,this._hostElement.style.width=`calc(100% + ${this._slider._inputPadding-this._tickMarkOffset*2}px)`,this._hostElement.style.left=`-${this._slider._rippleRadius-this._tickMarkOffset}px`}_updateThumbUIByValue(s){this.translateX=this._clamp(this._calcTranslateXByValue()),this._updateThumbUI(s)}_updateThumbUIByPointerEvent(s,a){this.translateX=this._clamp(this._calcTranslateXByPointerEvent(s)),this._updateThumbUI(a)}_updateThumbUI(s){this._slider._setTransition(!!s?.withAnimation),this._slider._onTranslateXChange(this)}writeValue(s){(this._isControlInitialized||s!==null)&&(this.value=s)}registerOnChange(s){this._onChangeFn=s,this._isControlInitialized=!0}registerOnTouched(s){this._onTouchedFn=s}setDisabledState(s){this.disabled=s}focus(){this._hostElement.focus()}blur(){this._hostElement.blur()}};e.\u0275fac=function(a){return new(a||e)(Et(Ur),Et(Ir),Et(ts),Et(sb))},e.\u0275dir=lr({type:e,selectors:[["input","matSliderThumb",""]],hostAttrs:["type","range",1,"mdc-slider__input"],hostVars:1,hostBindings:function(a,i){a&1&&zi("change",function(){return i._onChange()})("input",function(){return i._onInput()})("blur",function(){return i._onBlur()})("focus",function(){return i._onFocus()}),a&2&&vs("aria-valuetext",i._valuetext)},inputs:{value:[wn.HasDecoratorInputTransform,"value","value",vo]},outputs:{valueChange:"valueChange",dragStart:"dragStart",dragEnd:"dragEnd"},exportAs:["matSliderThumb"],standalone:!0,features:[Qs([oH,{provide:DI,useExisting:e}]),Es]});let o=e;return o})();var OI=(()=>{let e=class e{};e.\u0275fac=function(a){return new(a||e)},e.\u0275mod=ds({type:e}),e.\u0275inj=hs({imports:[Ss,u1]});let o=e;return o})();function lH(o,e){if(o&1&&(xt(0,"div",2),Bi(1),It()),o&2){let t=di();Ct(),xs(" ",t.txt().noGeoDataAvailable,`
`)}}function cH(o,e){if(o&1&&(xt(0,"div",2),Bi(1),It()),o&2){let t=di();Ct(),xs(" ",t.txt().noDXFSelectionAvailable,`
`)}}function hH(o,e){if(o&1&&(xt(0,"mat-option",12),Bi(1),xt(2,"span",13),Bi(3),L2(4,"json"),It()()),o&2){let t=e.$implicit;si("value",t.key),Ct(),Or(t.key),Ct(2),xs("(ex. ",F2(4,3,t.exampleValue),")")}}function dH(o,e){if(o&1&&(xt(0,"mat-option",12),Bi(1),xt(2,"span",13),Bi(3),L2(4,"json"),It()()),o&2){let t=e.$implicit;si("value",t.key),Ct(),Or(t.key),Ct(2),xs("(ex. ",F2(4,3,t.exampleValue),")")}}function uH(o,e){if(o&1&&Ln(0,"lib-ng-simple-table",14),o&2){let t=di(2);si("data",t.matchTableData)("columnDefs",t.matchColumnDefs)("filterLabel",t.txt().filter)}}function pH(o,e){if(o&1){let t=vr();xt(0,"div",3)(1,"div",4)(2,"mat-slider",5)(3,"input",6),zi("ngModelChange",function(a){Pn(t);let i=di();return Rn(i.threshold=a)})("mousedown",function(a){Pn(t);let i=di();return Rn(i.onSliderDrag(a))}),It()(),xt(4,"span"),Bi(5),It()(),xt(6,"div",4)(7,"mat-form-field",7)(8,"mat-label"),Bi(9),It(),xt(10,"mat-select",8),zi("ngModelChange",function(a){Pn(t);let i=di();return Rn(i.dxfIdentifierProp=a)})("selectionChange",function(){Pn(t);let a=di();return Rn(a.updateTable())}),Js(11,hH,5,5,"mat-option",12,Ko),It()(),xt(13,"mat-form-field",7)(14,"mat-label"),Bi(15),It(),xt(16,"mat-select",8),zi("ngModelChange",function(a){Pn(t);let i=di();return Rn(i.geoJSONIdentifierProp=a)})("selectionChange",function(){Pn(t);let a=di();return Rn(a.updateTable())}),Js(17,dH,5,5,"mat-option",12,Ko),It()()(),xt(19,"div",4)(20,"button",9),zi("click",function(){Pn(t);let a=di();return Rn(a.filterOverlapping())}),xt(21,"mat-icon"),Bi(22,"join_inner"),It(),Bi(23),It(),xt(24,"button",10),zi("click",function(){Pn(t);let a=di();return Rn(a.matchPoints())}),xt(25,"mat-icon"),Bi(26,"link"),It(),Bi(27),It()(),ln(28,uH,1,3,"lib-ng-simple-table",11),It()}if(o&2){let t=di();Ct(3),si("ngModel",t.threshold),Ct(2),EE("",t.txt().threshold,": ",t.threshold," m"),Ct(4),Or(t.txt().dxfIdentifier),Ct(),si("ngModel",t.dxfIdentifierProp),Ct(),Ks(t.dxfProperties),Ct(4),Or(t.txt().gisIdentifier),Ct(),si("ngModel",t.geoJSONIdentifierProp),Ct(),Ks(t.geoJSONProperties),Ct(3),si("matTooltip",t.txt().intersectionOnlyTooltip)("disabled",t.intersectionProcessed),Ct(3),xs(" ",t.txt().intersectionOnly," "),Ct(),si("matTooltip",t.txt().matchPointsTooltip),Ct(3),xs(" ",t.txt().matchPoints," "),Ct(),si("ngIf",t.matchTableData.length)}}var NI=(()=>{let e=class e{constructor(){this._snackbar=ai(rb),this._translationService=ai(Gc),this._resultService=ai(za),this.results=this._resultService.results,this.txt=this._translationService.translatedContent,this.threshold=1,this.intersectionProcessed=!1,this.matchTableData=[],this.matchColumnDefs=[],this.dxfProperties=[],this.dxfIdentifierProp="handle",this.geoJSONProperties=[],this.geoJSONIdentifierProp="",wl(()=>{this._resultService.resultsUpdated();let s=this._resultService.results();s.dxfFeatures!==void 0&&s.gisFeatures!==void 0&&this._getProperties()})}filterOverlapping(){let s=this.results().dxfFeatures?.bbox,a=this.results().gisFeatures?.bbox;if(s===void 0){this._snackbar.open("No BBOX found for BBOX");return}if(a===void 0){this._snackbar.open("No BBOX found for geoJSON");return}let i=rA([s,a]),f=this.results().gisFeatures;if(f===void 0)return;let v=sA(f,i,this.threshold);i&&(v.bbox=i),this._resultService.gisFeaturesSubset=v,this.intersectionProcessed=!0}onSliderDrag(s){s.stopImmediatePropagation()}matchPoints(){return yr(this,null,function*(){yield this._resultService.matchDXFGisFeatures(this.threshold),this.updateTable()})}_getProperties(){let s=this.results().gisFeatures?.features[0].properties;s!==void 0&&(this.geoJSONProperties=Object.keys(s).map(v=>({key:v,exampleValue:s[v]})));let a=this.geoJSONProperties.map(v=>v.key);this.geoJSONIdentifierProp=a.includes("baumnummer")?"baumnummer":this.geoJSONProperties[0].key;let i=this.results().dxfFeatures?.features[0].properties;i!==void 0&&(this.dxfProperties=Object.keys(i).map(v=>({key:v,exampleValue:i[v]})));let f=this.dxfProperties.map(v=>v.key);this.dxfIdentifierProp=f.includes("handle")?"handle":this.dxfProperties[0].key}updateTable(){this.matchTableData=[],this.results().pairingResults?.successful.forEach(s=>{let a={};a.distance=Math.round(s.distance*1e3),a[this.dxfIdentifierProp]=this._formatPropValue(s.featureA.properties[this.dxfIdentifierProp]),a[this.geoJSONIdentifierProp]=this._formatPropValue(s.featureB.properties[this.geoJSONIdentifierProp]),this.matchTableData.push(a)}),this.matchColumnDefs=[new B5(this.dxfIdentifierProp,this.dxfIdentifierProp),new B5(this.geoJSONIdentifierProp,this.geoJSONIdentifierProp),new B5("distance",`${this.txt().distance} [mm]`)]}_formatPropValue(s){return typeof s=="string"?s:JSON.stringify(s)}};e.\u0275fac=function(a){return new(a||e)},e.\u0275cmp=$i({type:e,selectors:[["app-feature-mapper"]],standalone:!0,features:[Yi],decls:3,vars:3,consts:[["class","info",4,"ngIf"],["class","col",4,"ngIf"],[1,"info"],[1,"col"],[1,"row"],["min","0","max","10","step","0.2",2,"width","50%"],["matSliderThumb","",3,"ngModel","ngModelChange","mousedown"],[2,"width","100%"],[3,"ngModel","ngModelChange","selectionChange"],["mat-flat-button","",2,"width","50%",3,"matTooltip","disabled","click"],["mat-flat-button","",2,"width","50%",3,"matTooltip","click"],[3,"data","columnDefs","filterLabel",4,"ngIf"],[3,"value"],[1,"smaller"],[3,"data","columnDefs","filterLabel"]],template:function(a,i){a&1&&ln(0,lH,2,1,"div",0)(1,cH,2,1,"div",0)(2,pH,29,13,"div",1),a&2&&(si("ngIf",!i.results().gisFeatures),Ct(),si("ngIf",i.results().gisFeatures&&!i.results().dxfFeatures),Ct(),si("ngIf",i.results().gisFeatures&&i.results().dxfFeatures))},dependencies:[_r,Ds,A5,ho,Vc,Eo,Na,kI,OI,FI,ob,Oh,BE,Lh,Fh,Hc,jh,oA,Gh,z5,N5,Vh,zh,KE],styles:[".info[_ngcontent-%COMP%]{border-radius:5px;border:3px solid khaki;padding:10px;margin-bottom:30px;display:flex;flex-direction:column;align-items:center;gap:10px}.row[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;width:100%;gap:10px}.col[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px;overflow:hidden}.smaller[_ngcontent-%COMP%]{font-size:.6em}"]});let o=e;return o})();var v3=class{constructor(e,t){this.newRect=e,this.oldRect=t,this.isFirst=t==null}};var zI=(()=>{let e=class e{constructor(s,a){this.element=s,this.zone=a,this.resized=new mn,this.observer=new ResizeObserver(i=>this.zone.run(()=>this.observe(i)))}ngOnInit(){this.observer.observe(this.element.nativeElement)}ngOnDestroy(){this.observer.disconnect()}observe(s){let a=s[0],i=new v3(a.contentRect,this.oldRect);this.oldRect=a.contentRect,this.resized.emit(i)}};e.\u0275fac=function(a){return new(a||e)(Et(Ir),Et(Ur))},e.\u0275dir=lr({type:e,selectors:[["","libResized",""]],outputs:{resized:"resized"},standalone:!0});let o=e;return o})();var x3=class{constructor(){this.fonts=["assets/fonts/HanaMinA.ttf","assets/fonts/NanumGothic-Regular.ttf","assets/fonts/NotoSansDisplay-SemiCondensedLightItalic.ttf","assets/fonts/Roboto-LightItalic.ttf"],this.viewerOptions=new vg}},vg=class{constructor(){this.canvasWidth=400,this.canvasHeight=300,this.autoResize=!1,this.clearColor=new U2("black"),this.clearAlpha=0,this.canvasAlpha=!1,this.canvasPremultipliedAlpha=!0,this.antialias=!0,this.colorCorrection=!1,this.blackWhiteInversion=!0,this.pointSize=2,this.sceneOptions=new lb,this.retainParsedDxf=!1,this.preserveDrawingBuffer=!1,this.fileEncoding="utf-8"}},lb=class{constructor(){this.arcTessellationAngle=10/180*Math.PI,this.minArcTessellationSubdivisions=8,this.wireframeMesh=!1,this.suppressPaperSpace=!1,this.textOptions=new cb}},cb=class{constructor(){this.curveSubdivision=2,this.fallbackChar="\uFFFD?"}};function fH(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(o){let e=Math.random()*16|0;return(o=="x"?e:e&3|8).toString(16)})}var BI=(()=>{let e=class e{constructor(s,a){this.targetEl=s,this.renderer=a,this.displayLoading=!1,this.loadingMessage="",this.hostPosition="relative",this.uid=""}ngOnInit(){let s=this.buildLoadingContainer();this.setMessage("Hello World"),this.renderer.appendChild(this.targetEl.nativeElement,s)}ngOnChanges(s){s.displayLoading&&this.uid&&this.setVisible(this.displayLoading),s.message&&this.uid&&this.setMessage(this.loadingMessage)}setVisible(s){let i=this.targetEl.nativeElement.querySelector("."+this.uid);i&&this.renderer.setStyle(i,"display",s?"flex":"none")}buildLoadingContainer(){this.uid="loading-container-"+fH();let s=this.renderer.createElement("div");this.renderer.setStyle(s,"display",this.displayLoading?"flex":"none"),this.renderer.setStyle(s,"flex-direction","column"),this.renderer.setStyle(s,"z-index",1e3);let a=getComputedStyle(this.targetEl.nativeElement).getPropertyValue("border-radius");a&&this.renderer.setStyle(s,"border-radius",a),this.renderer.setStyle(s,"justify-content","center"),this.renderer.setStyle(s,"align-items","center"),this.renderer.addClass(s,this.uid),this.renderer.setStyle(s,"position","absolute"),this.renderer.setStyle(s,"top","0"),this.renderer.setStyle(s,"bottom","0"),this.renderer.setStyle(s,"left","0"),this.renderer.setStyle(s,"right","0"),this.renderer.setStyle(s,"border-radius","10px"),this.renderer.setStyle(s,"z-index","1000"),this.renderer.setStyle(s,"background-color","rgba(200,200,200,0.2)");let i=this.renderer.createElement("div");this.renderer.addClass(i,"lds-facebook");let f=this.renderer.createElement("div"),v=this.renderer.createElement("div"),x=this.renderer.createElement("div");this.renderer.appendChild(i,f),this.renderer.appendChild(i,v),this.renderer.appendChild(i,x),this.renderer.appendChild(s,i);let M=this.renderer.createElement("div");return this.renderer.setStyle(M,"color","#000"),this.renderer.setStyle(M,"font-size","1.8em"),this.renderer.addClass(M,"spinner-message"),M.innerHTML=this.loadingMessage,this.renderer.appendChild(s,M),s}setMessage(s){let i=this.targetEl.nativeElement.querySelector("."+this.uid);if(i){let f=i.querySelector(".spinner-message");console.log(f)}}};e.\u0275fac=function(a){return new(a||e)(Et(Ir),Et(x5))},e.\u0275dir=lr({type:e,selectors:[["","libLoadingOverlay",""]],hostVars:2,hostBindings:function(a,i){a&2&&ca("position",i.hostPosition)},inputs:{displayLoading:"displayLoading",loadingMessage:"loadingMessage"},standalone:!0,features:[Ms]});let o=e;return o})();var L1=class{constructor(){this.menuGroups=[],this.foldDirection=UI.UP}},b3=class{constructor(e){this.id=e,this.groupItems=[]}},w3=class{constructor(e,t,s){this.text=e,this.icon=t,this.callback=s}},UI=function(o){return o.UP="UP",o.DOWN="DOWN",o}(UI||{});function Yh(o){this._pointer=0,this._data=o,this._eof=!1}Yh.prototype.next=function(){var o;if(!this.hasNext())throw this._eof?new Error("Cannot call 'next' after EOF group has been read"):new Error("Unexpected end of input: EOF group not read before end of file. Ended on code "+this._data[this._pointer]);return o={code:parseInt(this._data[this._pointer])},this._pointer++,o.value=VI(o.code,this._data[this._pointer]),this._pointer++,o.code===0&&o.value==="EOF"&&(this._eof=!0),this.lastReadGroup=o,o};Yh.prototype.peek=function(){if(!this.hasNext())throw this._eof?new Error("Cannot call 'next' after EOF group has been read"):new Error("Unexpected end of input: EOF group not read before end of file. Ended on code "+this._data[this._pointer]);var o={code:parseInt(this._data[this._pointer])};return o.value=VI(o.code,this._data[this._pointer+1]),o};Yh.prototype.rewind=function(o){o=o||1,this._pointer=this._pointer-o*2};Yh.prototype.hasNext=function(){return!(this._eof||this._pointer>this._data.length-2)};Yh.prototype.isEOF=function(){return this._eof};function VI(o,e){return o<=9?e:o>=10&&o<=59?parseFloat(e.trim()):o>=60&&o<=99?parseInt(e.trim()):o>=100&&o<=109?e:o>=110&&o<=149?parseFloat(e.trim()):o>=160&&o<=179?parseInt(e.trim()):o>=210&&o<=239?parseFloat(e.trim()):o>=270&&o<=289?parseInt(e.trim()):o>=290&&o<=299?mH(e.trim()):o>=300&&o<=369?e:o>=370&&o<=389?parseInt(e.trim()):o>=390&&o<=399?e:o>=400&&o<=409?parseInt(e.trim()):o>=410&&o<=419?e:o>=420&&o<=429?parseInt(e.trim()):o>=430&&o<=439?e:o>=440&&o<=459?parseInt(e.trim()):o>=460&&o<=469?parseFloat(e.trim()):o>=470&&o<=481||o===999||o>=1e3&&o<=1009?e:o>=1010&&o<=1059?parseFloat(e.trim()):o>=1060&&o<=1071?parseInt(e.trim()):(console.log("WARNING: Group code does not have a defined type: %j",{code:o,value:e}),e)}function mH(o){if(o==="0")return!1;if(o==="1")return!0;throw TypeError("String '"+o+"' cannot be cast to Boolean type")}var S3=[0,16711680,16776960,65280,65535,255,16711935,16777215,8421504,12632256,16711680,16744319,13369344,13395558,10027008,10046540,8323072,8339263,4980736,4990502,16727808,16752511,13382400,13401958,10036736,10051404,8331008,8343359,4985600,4992806,16744192,16760703,13395456,13408614,10046464,10056268,8339200,8347455,4990464,4995366,16760576,16768895,13408512,13415014,10056192,10061132,8347392,8351551,4995328,4997670,16776960,16777087,13421568,13421670,10000384,10000460,8355584,8355647,5000192,5000230,12582656,14679935,10079232,11717734,7510016,8755276,6258432,7307071,3755008,4344870,8388352,12582783,6736896,10079334,5019648,7510092,4161280,6258495,2509824,3755046,4194048,10485631,3394560,8375398,2529280,6264908,2064128,5209919,1264640,3099686,65280,8388479,52224,6736998,38912,5019724,32512,4161343,19456,2509862,65343,8388511,52275,6737023,38950,5019743,32543,4161359,19475,2509871,65407,8388543,52326,6737049,38988,5019762,32575,4161375,19494,2509881,65471,8388575,52377,6737074,39026,5019781,32607,4161391,19513,2509890,65535,8388607,52428,6737100,39064,5019800,32639,4161407,19532,2509900,49151,8380415,39372,6730444,29336,5014936,24447,4157311,14668,2507340,32767,8372223,26316,6724044,19608,5010072,16255,4153215,9804,2505036,16383,8364031,13260,6717388,9880,5005208,8063,4149119,4940,2502476,255,8355839,204,6710988,152,5000344,127,4145023,76,2500172,4129023,10452991,3342540,8349388,2490520,6245528,2031743,5193599,1245260,3089996,8323327,12550143,6684876,10053324,4980888,7490712,4128895,6242175,2490444,3745356,12517631,14647295,10027212,11691724,7471256,8735896,6226047,7290751,3735628,4335180,16711935,16744447,13369548,13395660,9961624,9981080,8323199,8339327,4980812,4990540,16711871,16744415,13369497,13395634,9961586,9981061,8323167,8339311,4980793,4990530,16711807,16744383,13369446,13395609,9961548,9981042,8323135,8339295,4980774,4990521,16711743,16744351,13369395,13395583,9961510,9981023,8323103,8339279,4980755,4990511,3355443,5987163,8684676,11382189,14079702,16777215];var F1=T2(hb(),1),M3=class{constructor(){this.appName=null,this.appNameWarningShown=!1,this.lastString=null,this.sectionStack=[this._CreateSection()],this.failure=!1}Feed(e){if(!this.appName)return e.code==1001?(this.appName=e.value,!1):(this.appNameWarningShown||(this.appNameWarningShown=!0,F1.default.warn("XDATA section does not start with application name")),!1);if(e.code==1001)return!0;if(this.failure)return!1;if(e.code==1e3)return this.lastString&&F1.default.warn("XDATA section unused string: "+this.lastString),this.lastString=e.value,!1;let t=this._currentSection;if(e.code==1002){if(e.value=="{"){if(!this.lastString)return F1.default.warn("Unnamed XDATA section encountered"),this.failure=!0,!1;let s=this._CreateSection();return t[this.lastString]=s,this.lastString=null,this.sectionStack.push(s),!1}return e.value=="}"?this.sectionStack.length<2?(F1.default.warn("Unmatched XDATA section closing"),this.failure=!0,!1):(this.sectionStack.length=this.sectionStack.length-1,!1):(F1.default.warn("Bad XDATA section control string encountered: "+e.value),this.failure=!0,!1)}return this.lastString!==null&&(t.values.push(this._CreateValue(1e3,this.lastString)),this.lastString=null),t.values.push(this._CreateValue(e.code,e.value)),!1}Finish(e){if(!this.failure&&this.appName){let t;e.hasOwnProperty("xdata")?t=e.xdata:(t={},e.xdata=t),t[this.appName]=this.sectionStack[0]}}get _currentSection(){return this.sectionStack[this.sectionStack.length-1]}_CreateSection(){return{values:[]}}_CreateValue(e,t){return{code:e,value:t}}};function gH(o){return S3[o]}function rn(o){var e={};o.rewind();var t=o.next(),s=t.code;if(e.x=t.value,s+=10,t=o.next(),t.code!==s)throw new Error("Expected code for point value to be "+s+" but got "+t.code+".");return e.y=t.value,s+=10,t=o.next(),t.code!==s?(o.rewind(),e):(e.z=t.value,e)}function E3(o){o.rewind();let e=o.next();if(e.code!==101)throw new Error("Bad call for skipEmbeddedObject()");do e=o.next();while(e.code!==0);o.rewind()}function Rr(o,e,t){let s=null;for(;e.code>=1e3;)s==null&&(s=new M3),s.Feed(e)?(s.Finish(o),s=null):e=t.next();if(s)return s.Finish(o),t.rewind(),!0;switch(e.code){case 0:o.type=e.value;break;case 5:o.handle=e.value;break;case 6:o.lineType=e.value;break;case 8:o.layer=e.value;break;case 48:o.lineTypeScale=e.value;break;case 60:o.visible=e.value===0;break;case 62:o.colorIndex=e.value,o.color=gH(Math.abs(e.value));break;case 67:o.inPaperSpace=e.value!==0;break;case 100:break;case 330:o.ownerHandle=e.value;break;case 347:o.materialObjectHandle=e.value;break;case 370:o.lineweight=e.value;break;case 420:o.color=e.value;break;default:return!1}return!0}function xg(){}xg.ForEntityName="3DFACE";xg.prototype.parseEntity=function(o,e){var t={type:e.value,vertices:[]};for(e=o.next();e!=="EOF"&&e.code!==0;){switch(e.code){case 70:t.shape=(e.value&1)===1,t.hasContinuousLinetypePattern=(e.value&128)===128;break;case 10:t.vertices=_H(o,e),e=o.lastReadGroup;break;default:Rr(t,e,o);break}e=o.next()}return t};function _H(o,e){var t=[],s,a=!1,i=!1,f=4;for(s=0;s<=f;s++){for(var v={};e!=="EOF"&&!(e.code===0||i);){switch(e.code){case 10:case 11:case 12:case 13:if(a){i=!0;continue}v.x=e.value,a=!0;break;case 20:case 21:case 22:case 23:v.y=e.value;break;case 30:case 31:case 32:case 33:v.z=e.value;break;default:return t}e=o.next()}t.push(v),a=!1,i=!1}return o.rewind(),t}function bg(){}bg.ForEntityName="ARC";bg.prototype.parseEntity=function(o,e){var t,s;for(t={type:e.value},e=o.next();e!=="EOF"&&e.code!==0;){switch(e.code){case 10:t.center=rn(o);break;case 40:t.radius=e.value;break;case 50:t.startAngle=Math.PI/180*e.value;break;case 51:t.endAngle=Math.PI/180*e.value;break;case 210:t.extrusionDirection=rn(o);break;default:Rr(t,e,o);break}e=o.next()}return t};function wg(){}wg.ForEntityName="ATTDEF";wg.prototype.parseEntity=function(o,e){var t={type:e.value,scale:1,textStyle:"STANDARD"};for(e=o.next();e!=="EOF"&&e.code!==0;){switch(e.code){case 1:t.text=e.value;break;case 2:t.tag=e.value;break;case 3:t.prompt=e.value;break;case 7:t.textStyle=e.value;break;case 10:t.startPoint=rn(o);break;case 11:t.endPoint=rn(o);break;case 39:t.thickness=e.value;break;case 40:t.textHeight=e.value;break;case 41:t.scale=e.value;break;case 50:t.rotation=e.value;break;case 51:t.obliqueAngle=e.value;break;case 70:t.invisible=!!(e.value&1),t.constant=!!(e.value&2),t.verificationRequired=!!(e.value&4),t.preset=!!(e.value&8);break;case 71:t.backwards=!!(e.value&2),t.mirrored=!!(e.value&4);break;case 72:t.horizontalJustification=e.value;break;case 73:t.fieldLength=e.value;break;case 74:t.verticalJustification=e.value;break;case 100:break;case 101:E3(o);break;case 210:t.extrusionDirection=rn(o);break;default:Rr(t,e,o);break}e=o.next()}return t};function Sg(){}Sg.ForEntityName="ATTRIB";Sg.prototype.parseEntity=function(o,e){var t={type:e.value,scale:1,textStyle:"STANDARD"};for(e=o.next();e!=="EOF"&&e.code!==0;){switch(e.code){case 1:t.text=e.value;break;case 2:t.tag=e.value;break;case 3:t.prompt=e.value;break;case 7:t.textStyle=e.value;break;case 10:t.startPoint=rn(o);break;case 11:t.endPoint=rn(o);break;case 39:t.thickness=e.value;break;case 40:t.textHeight=e.value;break;case 41:t.scale=e.value;break;case 44:t.lineSpacingFactor=e.value;break;case 45:t.fillBoxScale=e.value;break;case 46:t.annotationHeight=e.value;break;case 50:t.rotation=e.value;break;case 51:t.obliqueAngle=e.value;break;case 63:t.backgroundFillColor=e.value;break;case 70:t.invisible=!!(e.value&1),t.constant=!!(e.value&2),t.verificationRequired=!!(e.value&4),t.preset=!!(e.value&8);break;case 71:t.attachmentPoint=e.value;break;case 72:t.horizontalJustification=e.value;break;case 73:t.lineSpacing=e.value;break;case 74:t.verticalJustification=e.value;break;case 90:t.backgroundFillSetting=e.value;break;case 100:break;case 210:t.extrusionDirection=rn(o);break;case 280:t.lockPositionFlag=e.value;break;case 340:t.hardPointerId=e.value;break;default:Rr(t,e,o);break}e=o.next()}return t};function Tg(){}Tg.ForEntityName="CIRCLE";Tg.prototype.parseEntity=function(o,e){var t,s;for(t={type:e.value},e=o.next();e!=="EOF"&&e.code!==0;){switch(e.code){case 10:t.center=rn(o);break;case 40:t.radius=e.value;break;case 50:t.startAngle=Math.PI/180*e.value;break;case 51:s=Math.PI/180*e.value,s<t.startAngle?t.angleLength=s+2*Math.PI-t.startAngle:t.angleLength=s-t.startAngle,t.endAngle=s;break;case 210:t.extrusionDirection=rn(o);break;default:Rr(t,e,o);break}e=o.next()}return t};function Mg(){}Mg.ForEntityName="DIMENSION";Mg.prototype.parseEntity=function(o,e){var t;for(t={type:e.value},e=o.next();e!=="EOF"&&e.code!==0;){switch(e.code){case 2:t.block=e.value;break;case 3:t.styleName=e.value;break;case 10:t.anchorPoint=rn(o);break;case 11:t.middleOfText=rn(o);break;case 12:t.insertionPoint=rn(o);break;case 13:t.linearOrAngularPoint1=rn(o);break;case 14:t.linearOrAngularPoint2=rn(o);break;case 15:t.diameterOrRadiusPoint=rn(o);break;case 16:t.arcPoint=rn(o);break;case 70:t.dimensionType=e.value;break;case 71:t.attachmentPoint=e.value;break;case 42:t.actualMeasurement=e.value;break;case 1:t.text=e.value;break;case 50:t.angle=e.value;break;case 53:t.textRotation=e.value;break;default:Rr(t,e,o);break}e=o.next()}return t};function Eg(){}Eg.ForEntityName="ELLIPSE";Eg.prototype.parseEntity=function(o,e){var t;for(t={type:e.value},e=o.next();e!=="EOF"&&e.code!==0;){switch(e.code){case 10:t.center=rn(o);break;case 11:t.majorAxisEndPoint=rn(o);break;case 40:t.axisRatio=e.value;break;case 41:t.startAngle=e.value;break;case 42:t.endAngle=e.value;break;case 2:t.name=e.value;break;case 210:t.extrusionDirection=rn(o);break;default:Rr(t,e,o);break}e=o.next()}return t};function Ag(){}Ag.ForEntityName="INSERT";Ag.prototype.parseEntity=function(o,e){var t;for(t={type:e.value},e=o.next();e!=="EOF"&&e.code!==0;){switch(e.code){case 2:t.name=e.value;break;case 41:t.xScale=e.value;break;case 42:t.yScale=e.value;break;case 43:t.zScale=e.value;break;case 10:t.position=rn(o);break;case 50:t.rotation=e.value;break;case 70:t.columnCount=e.value;break;case 71:t.rowCount=e.value;break;case 44:t.columnSpacing=e.value;break;case 45:t.rowSpacing=e.value;break;case 210:t.extrusionDirection=rn(o);break;default:Rr(t,e,o);break}e=o.next()}return t};function Cg(){}Cg.ForEntityName="LINE";Cg.prototype.parseEntity=function(o,e){var t={type:e.value,vertices:[]};for(e=o.next();e!=="EOF"&&e.code!==0;){switch(e.code){case 10:t.vertices.unshift(rn(o));break;case 11:t.vertices.push(rn(o));break;case 210:t.extrusionDirection=rn(o);break;case 100:break;default:Rr(t,e,o);break}e=o.next()}return t};function Ig(){}Ig.ForEntityName="LWPOLYLINE";Ig.prototype.parseEntity=function(o,e){var t={type:e.value,vertices:[]},s=0;for(e=o.next();e!=="EOF"&&e.code!==0;){switch(e.code){case 38:t.elevation=e.value;break;case 39:t.depth=e.value;break;case 70:t.shape=(e.value&1)===1,t.hasContinuousLinetypePattern=(e.value&128)===128;break;case 90:s=e.value;break;case 10:t.vertices=yH(s,o);break;case 43:e.value!==0&&(t.width=e.value);break;case 210:t.extrusionDirection=rn(o);break;default:Rr(t,e,o);break}e=o.next()}return t};function yH(o,e){if(!o||o<=0)throw Error("n must be greater than 0 vertices");var t=[],s,a=!1,i=!1,f=e.lastReadGroup;for(s=0;s<o;s++){for(var v={};f!=="EOF"&&!(f.code===0||i);){switch(f.code){case 10:if(a){i=!0;continue}v.x=f.value,a=!0;break;case 20:v.y=f.value;break;case 30:v.z=f.value;break;case 40:v.startWidth=f.value;break;case 41:v.endWidth=f.value;break;case 42:f.value!=0&&(v.bulge=f.value);break;case 91:v.id=f.value;break;default:return a&&t.push(v),e.rewind(),t}f=e.next()}t.push(v),a=!1,i=!1}return e.rewind(),t}function Pg(){}Pg.ForEntityName="MTEXT";Pg.prototype.parseEntity=function(o,e){var t={type:e.value};for(e=o.next();e!=="EOF"&&e.code!==0;){switch(e.code){case 3:case 1:t.text?t.text+=e.value:t.text=e.value;break;case 10:t.position=rn(o);break;case 11:t.direction=rn(o);break;case 40:t.height=e.value;break;case 41:t.width=e.value;break;case 44:t.lineSpacing=e.value;break;case 50:t.rotation=e.value;break;case 71:t.attachmentPoint=e.value;break;case 72:t.drawingDirection=e.value;break;case 101:E3(o);break;default:Rr(t,e,o);break}e=o.next()}return t};function Rg(){}Rg.ForEntityName="POINT";Rg.prototype.parseEntity=function(o,e){var t;for(t={type:e.value},e=o.next();e!=="EOF"&&e.code!==0;){switch(e.code){case 10:t.position=rn(o);break;case 39:t.thickness=e.value;break;case 210:t.extrusionDirection=rn(o);break;case 100:break;default:Rr(t,e,o);break}e=o.next()}return t};function kg(){}kg.ForEntityName="VERTEX";kg.prototype.parseEntity=function(o,e){var t={type:e.value};for(e=o.next();e!=="EOF"&&e.code!==0;){switch(e.code){case 10:t.x=e.value;break;case 20:t.y=e.value;break;case 30:t.z=e.value;break;case 40:break;case 41:break;case 42:e.value!=0&&(t.bulge=e.value);break;case 70:t.curveFittingVertex=(e.value&1)!==0,t.curveFitTangent=(e.value&2)!==0,t.splineVertex=(e.value&8)!==0,t.splineControlPoint=(e.value&16)!==0,t.threeDPolylineVertex=(e.value&32)!==0,t.threeDPolylineMesh=(e.value&64)!==0,t.polyfaceMeshVertex=(e.value&128)!==0;break;case 50:break;case 71:t.faces=[e.value];break;case 72:t.faces[1]=e.value;break;case 73:t.faces[2]=e.value;break;case 74:t.faces[3]=e.value;break;default:Rr(t,e,o);break}e=o.next()}return t};function Dg(){}Dg.ForEntityName="POLYLINE";Dg.prototype.parseEntity=function(o,e){var t={type:e.value,vertices:[]};for(e=o.next();e!=="EOF"&&e.code!==0;){switch(e.code){case 10:break;case 20:break;case 30:break;case 39:t.thickness=e.value;break;case 40:break;case 41:break;case 70:t.shape=(e.value&1)!==0,t.includesCurveFitVertices=(e.value&2)!==0,t.includesSplineFitVertices=(e.value&4)!==0,t.is3dPolyline=(e.value&8)!==0,t.is3dPolygonMesh=(e.value&16)!==0,t.is3dPolygonMeshClosed=(e.value&32)!==0,t.isPolyfaceMesh=(e.value&64)!==0,t.hasContinuousLinetypePattern=(e.value&128)!==0;break;case 71:break;case 72:break;case 73:break;case 74:break;case 75:break;case 210:t.extrusionDirection=rn(o);break;default:Rr(t,e,o);break}e=o.next()}return t.vertices=vH(o,e),t};function vH(o,e){for(var t=new kg,s=[];!o.isEOF();)if(e.code===0){if(e.value==="VERTEX")s.push(t.parseEntity(o,e)),e=o.lastReadGroup;else if(e.value==="SEQEND"){xH(o,e);break}}return s}function xH(o,e){var t={type:e.value};for(e=o.next();e!="EOF"&&e.code!=0;)Rr(t,e,o),e=o.next();return t}function Lg(){}Lg.ForEntityName="SOLID";Lg.prototype.parseEntity=function(o,e){var t;for(t={type:e.value},t.points=[],e=o.next();e!=="EOF"&&e.code!==0;){switch(e.code){case 10:t.points[0]=rn(o);break;case 11:t.points[1]=rn(o);break;case 12:t.points[2]=rn(o);break;case 13:t.points[3]=rn(o);break;case 210:t.extrusionDirection=rn(o);break;default:Rr(t,e,o);break}e=o.next()}return t};function Fg(){}Fg.ForEntityName="SPLINE";Fg.prototype.parseEntity=function(o,e){var t;for(t={type:e.value},e=o.next();e!=="EOF"&&e.code!==0;){switch(e.code){case 10:t.controlPoints||(t.controlPoints=[]),t.controlPoints.push(rn(o));break;case 11:t.fitPoints||(t.fitPoints=[]),t.fitPoints.push(rn(o));break;case 12:t.startTangent=rn(o);break;case 13:t.endTangent=rn(o);break;case 40:t.knotValues||(t.knotValues=[]),t.knotValues.push(e.value);break;case 70:e.value&1&&(t.closed=!0),e.value&2&&(t.periodic=!0),e.value&4&&(t.rational=!0),e.value&8&&(t.planar=!0),e.value&16&&(t.planar=!0,t.linear=!0);break;case 71:t.degreeOfSplineCurve=e.value;break;case 72:t.numberOfKnots=e.value;break;case 73:t.numberOfControlPoints=e.value;break;case 74:t.numberOfFitPoints=e.value;break;case 210:t.extrusionDirection=rn(o);break;default:Rr(t,e,o);break}e=o.next()}return t};function Og(){}Og.ForEntityName="TEXT";Og.prototype.parseEntity=function(o,e){var t;for(t={type:e.value},e=o.next();e!=="EOF"&&e.code!==0;){switch(e.code){case 10:t.startPoint=rn(o);break;case 11:t.endPoint=rn(o);break;case 40:t.textHeight=e.value;break;case 41:t.xScale=e.value;break;case 50:t.rotation=e.value;break;case 1:t.text=e.value;break;case 72:t.halign=e.value;break;case 73:t.valign=e.value;break;default:Rr(t,e,o);break}e=o.next()}return t};function Ng(){}Ng.ForEntityName="HATCH";Ng.prototype.parseEntity=function(o,e){var t;t={type:e.value};let s=0,a=0,i=0;for(e=o.next();e!=="EOF"&&e.code!==0;){for(;s>0;){let f=bH(e,o);f?(t.boundaryLoops.push(f),s--,e=o.next()):s=0}for(;a>0;){let f=wH(e,o);f?(t.definitionLines.push(f),a--,e=o.next()):a=0}for(;i>0;){let f=SH(e,o);f?(t.seedPoints.push(f),i--,e=o.next()):i=0}if(e.code===0)break;switch(e.code){case 2:t.patternName=e.value;break;case 70:t.isSolid=e.value!=0;break;case 91:s=e.value,s>0&&(t.boundaryLoops=[]);break;case 75:t.hatchStyle=e.value;break;case 76:t.patternType=e.value;break;case 52:t.patternAngle=e.value*Math.PI/180;break;case 41:t.patternScale=e.value;break;case 78:a=e.value,a>0&&(t.definitionLines=[]);break;case 98:i=e.value,i>0&&(t.seedPoints=[]);break;default:Rr(t,e,o);break}e=o.next()}return t};function bH(o,e){let t=null,s=()=>{let x={vertices:[],isClosed:!1},M=!1,C=0;for(;;){if(C>0){for(let D=0;D<C&&o.code==10;D++){let L=rn(e);o=e.next(),o.code==42&&(L.bulge=o.value,o=e.next()),x.vertices.push(L)}return x}switch(o.code){case 72:M=o.value;break;case 73:x.isClosed=o.value;break;case 93:C=o.value;break;default:return x}o=e.next()}},a=()=>{if(o.code!=72)return null;let x={type:o.value};o=e.next();let M=x.type==4;for(;;){switch(o.code){case 10:M?(x.controlPoints||(x.controlPoints=[]),x.controlPoints.push(rn(e))):x.start=rn(e);break;case 11:M?(x.fitPoints||(x.fitPoints=[]),x.fitPoints.push(rn(e))):x.end=rn(e);break;case 40:M?(x.knotValues||(x.knotValues=[]),x.knotValues.push(o.value)):x.radius=o.value;break;case 50:x.startAngle=o.value*Math.PI/180;break;case 51:x.endAngle=o.value*Math.PI/180;break;case 73:M?x.rational=o.value:x.isCcw=o.value;break;case 74:x.periodic=o.value;break;case 94:x.degreeOfSplineCurve=o.value;break;case 95:case 96:case 40:case 42:case 97:break;default:return x}o=e.next()}},i=!1,f=0,v=0;for(;;){if(!t){if(o.code!=92)return null;t={type:o.value},o=e.next()}for(t.type&2&&!i&&(t.polyline=s(),i=!0);f;){let x=a();x?(t.edges.push(x),f--):f=0}for(;v;)o.code==330?(t.sourceRefs.push(o.value),v--,o=e.next()):v=0;switch(o.code){case 93:f=o.value,f>0&&(t.edges=[]);break;case 97:v=o.value,v>0&&(t.sourceRefs=[]);break;default:return e.rewind(),t}o=e.next()}}function wH(o,e){if(o.code!=53)return null;let t={angle:o.value*Math.PI/180,base:{x:0,y:0},offset:{x:0,y:0}};o=e.next();let s=0;for(;;){switch(o.code){case 43:t.base.x=o.value;break;case 44:t.base.y=o.value;break;case 45:t.offset.x=o.value;break;case 46:t.offset.y=o.value;break;case 49:s>0&&(t.dashes.push(o.value),s--);break;case 79:s=o.value,o.value&&(t.dashes=[]);break;default:return e.rewind(),t}o=e.next()}}function SH(o,e){return o.code!=10?null:rn(e)}var TH=new Map([[140,"DIMTXT"],[142,"DIMTSZ"],[144,"DIMLFAC"],[147,"DIMGAP"],[173,"DIMSAH"],[175,"DIMSOXD"],[176,"DIMCLRD"],[177,"DIMCLRE"],[178,"DIMCLRT"],[271,"DIMDEC"],[278,"DIMDSEP"],[281,"DIMSD1"],[282,"DIMSD2"],[3,"DIMPOST"],[40,"DIMSCALE"],[41,"DIMASZ"],[42,"DIMEXO"],[44,"DIMEXE"],[45,"DIMRND"],[46,"DIMDLE"],[5,"DIMBLK"],[6,"DIMBLK1"],[7,"DIMBLK2"],[75,"DIMSE1"],[76,"DIMSE2"],[78,"DIMZIN"]]),zg=TH;var pr=T2(hb(),1);pr.default.setLevel("error");function MH(o){o.registerEntityHandler(xg),o.registerEntityHandler(bg),o.registerEntityHandler(wg),o.registerEntityHandler(Sg),o.registerEntityHandler(Tg),o.registerEntityHandler(Mg),o.registerEntityHandler(Eg),o.registerEntityHandler(Ag),o.registerEntityHandler(Cg),o.registerEntityHandler(Ig),o.registerEntityHandler(Pg),o.registerEntityHandler(Rg),o.registerEntityHandler(Dg),o.registerEntityHandler(Lg),o.registerEntityHandler(Fg),o.registerEntityHandler(Og),o.registerEntityHandler(Ng)}function Jh(){this._entityHandlers={},MH(this)}Jh.prototype.parse=function(o,e){throw new Error("read() not implemented. Use readSync()")};Jh.prototype.registerEntityHandler=function(o){var e=new o;this._entityHandlers[o.ForEntityName]=e};Jh.prototype.parseSync=function(o){return typeof o=="string"?this._parse(o):(console.error("Cannot read DXF source of type `"+typeof o),null)};Jh.prototype.parseStream=function(o,e){var t="",s=this;o.on("data",a),o.on("end",i),o.on("error",f);function a(v){t+=v}function i(){try{var v=s._parse(t)}catch(x){return e(x)}e(null,v)}function f(v){e(v)}};Jh.prototype._parse=function(o){var e,t,s={},a=0,i=o.split(/\r\n|\r|\n/g);if(e=new Yh(i),!e.hasNext())throw Error("Empty file");var f=this,v=function(){for(t=e.next();!e.isEOF();)if(t.code===0&&t.value==="SECTION"){if(t=e.next(),t.code!==2){console.error("Unexpected code %s after 0:SECTION",HI(t)),t=e.next();continue}t.value==="HEADER"?(pr.default.debug("> HEADER"),s.header=M(),pr.default.debug("<")):t.value==="BLOCKS"?(pr.default.debug("> BLOCKS"),s.blocks=C(),pr.default.debug("<")):t.value==="ENTITIES"?(pr.default.debug("> ENTITIES"),s.entities=Ee(!1),pr.default.debug("<")):t.value==="TABLES"?(pr.default.debug("> TABLES"),s.tables=L(),pr.default.debug("<")):t.value==="EOF"?pr.default.debug("EOF"):pr.default.warn("Skipping section '%s'",t.value)}else t=e.next()},x=function(Le,De){return t.code===Le&&t.value===De},M=function(){var Le=null,De=null,se={};for(t=e.next();;){if(x(0,"ENDSEC")){Le&&(se[Le]=De);break}else t.code===9?(Le&&(se[Le]=De),Le=t.value):t.code===10?De={x:t.value}:t.code===20?De.y=t.value:t.code===30?De.z=t.value:De=t.value;t=e.next()}return t=e.next(),se},C=function(){var Le={},De;for(t=e.next();t.value!=="EOF"&&!x(0,"ENDSEC");)x(0,"BLOCK")?(pr.default.debug("block {"),De=D(),pr.default.debug("}"),we(De),De.name?Le[De.name]=De:pr.default.error('block with handle "'+De.handle+'" is missing a name.')):(k0(t),t=e.next());return Le},D=function(){var Le={};for(t=e.next();t.value!=="EOF";){switch(t.code){case 1:Le.xrefPath=t.value,t=e.next();break;case 2:Le.name=t.value,t=e.next();break;case 3:Le.name2=t.value,t=e.next();break;case 5:Le.handle=t.value,t=e.next();break;case 8:Le.layer=t.value,t=e.next();break;case 10:Le.position=de(),t=e.next();break;case 67:Le.paperSpace=!!(t.value&&t.value==1),t=e.next();break;case 70:t.value!=0&&(Le.type=t.value),t=e.next();break;case 100:t=e.next();break;case 330:Le.ownerHandle=t.value,t=e.next();break;case 0:if(t.value=="ENDBLK")break;Le.entities=Ee(!0);break;default:k0(t),t=e.next()}if(x(0,"ENDBLK")){t=e.next();break}}return Le},L=function(){var Le={};for(t=e.next();t.value!=="EOF"&&!x(0,"ENDSEC");)if(x(0,"TABLE")){t=e.next();var De=fe[t.value];De?(pr.default.debug(t.value+" Table {"),Le[fe[t.value].tableName]=j(),pr.default.debug("}")):pr.default.debug("Unhandled Table "+t.value)}else t=e.next();return t=e.next(),Le};let N="ENDTAB";var j=function(){var Le=fe[t.value],De={},se=0,Ce;for(t=e.next();!x(0,N);)switch(t.code){case 5:De.handle=t.value,t=e.next();break;case 330:De.ownerHandle=t.value,t=e.next();break;case 100:t.value==="AcDbSymbolTable"||k0(t),t=e.next();break;case 70:se=t.value,t=e.next();break;case 0:t.value===Le.dxfSymbolName?De[Le.tableRecordsProperty]=Le.parseTableRecords():(k0(t),t=e.next());break;default:k0(t),t=e.next()}var Ne=De[Le.tableRecordsProperty];return Ne?(Ne.constructor===Array?Ce=Ne.length:typeof Ne=="object"&&(Ce=Object.keys(Ne).length),se!==Ce&&pr.default.warn(`Parsed ${Ce} ${Le.dxfSymbolName}'s but expected ${se}`)):De[Le.tableRecordsProperty]=[],t=e.next(),De},Z=function(){var Le=[],De={};for(pr.default.debug("ViewPort {"),t=e.next();!x(0,N);)switch(t.code){case 2:De.name=t.value,t=e.next();break;case 10:De.lowerLeftCorner=de(),t=e.next();break;case 11:De.upperRightCorner=de(),t=e.next();break;case 12:De.center=de(),t=e.next();break;case 13:De.snapBasePoint=de(),t=e.next();break;case 14:De.snapSpacing=de(),t=e.next();break;case 15:De.gridSpacing=de(),t=e.next();break;case 16:De.viewDirectionFromTarget=de(),t=e.next();break;case 17:De.viewTarget=de(),t=e.next();break;case 42:De.lensLength=t.value,t=e.next();break;case 43:De.frontClippingPlane=t.value,t=e.next();break;case 44:De.backClippingPlane=t.value,t=e.next();break;case 45:De.viewHeight=t.value,t=e.next();break;case 50:De.snapRotationAngle=t.value,t=e.next();break;case 51:De.viewTwistAngle=t.value,t=e.next();break;case 79:De.orthographicType=t.value,t=e.next();break;case 110:De.ucsOrigin=de(),t=e.next();break;case 111:De.ucsXAxis=de(),t=e.next();break;case 112:De.ucsYAxis=de(),t=e.next();break;case 110:De.ucsOrigin=de(),t=e.next();break;case 281:De.renderMode=t.value,t=e.next();break;case 281:De.defaultLightingType=t.value,t=e.next();break;case 292:De.defaultLightingOn=t.value,t=e.next();break;case 330:De.ownerHandle=t.value,t=e.next();break;case 63:case 421:case 431:De.ambientColor=t.value,t=e.next();break;case 0:t.value==="VPORT"&&(pr.default.debug("}"),Le.push(De),pr.default.debug("ViewPort {"),De={},t=e.next());break;default:k0(t),t=e.next();break}return pr.default.debug("}"),Le.push(De),Le},G=function(){var Le={},De,se={},Ce;for(pr.default.debug("LType {"),t=e.next();!x(0,"ENDTAB");)switch(t.code){case 2:se.name=t.value,De=t.value,t=e.next();break;case 3:se.description=t.value,t=e.next();break;case 73:Ce=t.value,Ce>0&&(se.pattern=[]),t=e.next();break;case 40:se.patternLength=t.value,t=e.next();break;case 49:se.pattern.push(t.value),t=e.next();break;case 0:pr.default.debug("}"),Ce>0&&Ce!==se.pattern.length&&pr.default.warn("lengths do not match on LTYPE pattern"),Le[De]=se,se={},pr.default.debug("LType {"),t=e.next();break;default:t=e.next()}return pr.default.debug("}"),Le[De]=se,Le},H=function(){var Le={},De,se={};for(pr.default.debug("Layer {"),t=e.next();!x(0,"ENDTAB");)switch(t.code){case 2:se.name=t.value,De=t.value,t=e.next();break;case 62:se.visible=t.value>=0,se.colorIndex=Math.abs(t.value),se.color=EH(se.colorIndex),t=e.next();break;case 70:se.frozen=(t.value&1)!==0||(t.value&2)!==0,t=e.next();break;case 420:se.color=t.value,t=e.next();break;case 0:t.value==="LAYER"&&(pr.default.debug("}"),Le[De]=se,pr.default.debug("Layer {"),se={},De=void 0,t=e.next());break;default:k0(t),t=e.next();break}return pr.default.debug("}"),Le[De]=se,Le},me=function(){var Le={},De,se={};for(pr.default.debug("DimStyle {"),t=e.next();!x(0,"ENDTAB");)if(zg.has(t.code))se[zg.get(t.code)]=t.value,t=e.next();else switch(t.code){case 2:se.name=t.value,De=t.value,t=e.next();break;case 0:t.value==="DIMSTYLE"&&(pr.default.debug("}"),Le[De]=se,pr.default.debug("DimStyle {"),se={},De=void 0,t=e.next());break;default:k0(t),t=e.next();break}return pr.default.debug("}"),Le[De]=se,Le},ne=function(){var Le={},De={},se;for(pr.default.debug("Style {"),t=e.next();!x(0,N);)switch(t.code){case 100:De.subClassMarker=t.value,t=e.next();break;case 2:De.styleName=t.value,se=t.value,t=e.next();break;case 70:De.standardFlag=t.value,t=e.next();break;case 40:De.fixedTextHeight=t.value,t=e.next();break;case 41:De.widthFactor=t.value,t=e.next();break;case 50:De.obliqueAngle=t.value,t=e.next();break;case 71:De.textGenerationFlag=t.value,t=e.next();break;case 42:De.lastHeight=t.value,t=e.next();break;case 3:De.font=t.value,t=e.next();break;case 4:De.bigFont=t.value,t=e.next();break;case 1071:De.extendedFont=t.value,t=e.next();break;case 0:t.value==="STYLE"&&(pr.default.debug("}"),Le[se]=De,pr.default.debug("Style {"),De={},se=void 0,t=e.next());break;default:k0(t),t=e.next();break}return pr.default.debug("}"),Le[se]=De,Le},fe={VPORT:{tableRecordsProperty:"viewPorts",tableName:"viewPort",dxfSymbolName:"VPORT",parseTableRecords:Z},LTYPE:{tableRecordsProperty:"lineTypes",tableName:"lineType",dxfSymbolName:"LTYPE",parseTableRecords:G},LAYER:{tableRecordsProperty:"layers",tableName:"layer",dxfSymbolName:"LAYER",parseTableRecords:H},DIMSTYLE:{tableRecordsProperty:"dimStyles",tableName:"dimstyle",dxfSymbolName:"DIMSTYLE",parseTableRecords:me},STYLE:{tableRecordsProperty:"styles",tableName:"style",dxfSymbolName:"STYLE",parseTableRecords:ne}},Ee=function(Le){var De=[],se=Le?"ENDBLK":"ENDSEC";for(Le||(t=e.next());;)if(t.code===0){if(t.value===se)break;var Ce,Ne=f._entityHandlers[t.value];if(Ne!=null)pr.default.debug(t.value+" {"),Ce=Ne.parseEntity(e,t),t=e.lastReadGroup,pr.default.debug("}");else{pr.default.warn("Unhandled entity "+t.value),t=e.next();continue}we(Ce),De.push(Ce)}else t=e.next();return se=="ENDSEC"&&(t=e.next()),De},de=function(){var Le={},De=t.code;if(Le.x=t.value,De+=10,t=e.next(),t.code!=De)throw new Error("Expected code for point value to be "+De+" but got "+t.code+".");return Le.y=t.value,De+=10,t=e.next(),t.code!=De?(e.rewind(),Le):(Le.z=t.value,Le)},we=function(Le){if(!Le)throw new TypeError("entity cannot be undefined or null");Le.handle||(Le.handle=a++)};return v(),s};function k0(o){pr.default.debug("unhandled group "+HI(o))}function HI(o){return o.code+":"+o.value}function EH(o){return S3[o]}var Bg=class{constructor(e,t="utf-8"){this.url=e,this.encoding=t}Fetch(e=null){return yr(this,null,function*(){let t=yield fetch(this.url),s=+t.headers.get("Content-Length"),a=t.body.getReader(),i=0,f="",v=new TextDecoder(this.encoding);for(;;){let{done:M,value:C}=yield a.read();if(M){f+=v.decode(new ArrayBuffer(0),{stream:!1});break}f+=v.decode(C,{stream:!0}),i+=C.length,e!==null&&e("fetch",i,s)}return e!==null&&e("parse",0,null),new Jh().parseSync(f)})}};var C7="161",Il={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},Pl={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},AH=0,jI=1,CH=2;var bR=1,IH=2,z0=3,cd=0,Ua=1,ic=2,sd=0,nf=1,WI=2,qI=3,XI=4,PH=5,Ou=100,RH=101,kH=102,ZI=103,$I=104,DH=200,LH=201,FH=202,OH=203,Hb=204,jb=205,NH=206,zH=207,BH=208,UH=209,VH=210,GH=211,HH=212,jH=213,WH=214,qH=0,XH=1,ZH=2,K3=3,$H=4,YH=5,JH=6,KH=7,wR=0,QH=1,ej=2,od=0,tj=1,ij=2,nj=3,rj=4,sj=5,oj=6;var YI=300,of=301,af=302,Wb=303,qb=304,E6=306,Xb=1e3,nc=1001,Zb=1002,ga=1003,JI=1004;var Ug=1005;var Ba=1006,db=1007;var zu=1008;var ad=1009,aj=1010,lj=1011,I7=1012,SR=1013,rd=1014,U0=1015,qg=1016,TR=1017,MR=1018,Bu=1020,cj=1021,rc=1023,hj=1024,dj=1025,Uu=1026,lf=1027,uj=1028,ER=1029,pj=1030,AR=1031,CR=1033,ub=33776,pb=33777,fb=33778,mb=33779,KI=35840,QI=35841,eP=35842,tP=35843,IR=36196,iP=37492,nP=37496,rP=37808,sP=37809,oP=37810,aP=37811,lP=37812,cP=37813,hP=37814,dP=37815,uP=37816,pP=37817,fP=37818,mP=37819,gP=37820,_P=37821,gb=36492,yP=36494,vP=36495,fj=36283,xP=36284,bP=36285,wP=36286;var Q3=2300,e6=2301,_b=2302,SP=2400,TP=2401,MP=2402;var PR=3e3,Vu=3001,mj=3200,gj=3201,_j=0,yj=1,Al="",Bo="srgb",G0="srgb-linear",P7="display-p3",A6="display-p3-linear",t6="linear",As="srgb",i6="rec709",n6="p3";var O1=7680;var EP=519,vj=512,xj=513,bj=514,RR=515,wj=516,Sj=517,Tj=518,Mj=519,$b=35044;var Xg="300 es",Yb=1035,V0=2e3,r6=2001,oc=class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});let s=this._listeners;s[e]===void 0&&(s[e]=[]),s[e].indexOf(t)===-1&&s[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;let s=this._listeners;return s[e]!==void 0&&s[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;let a=this._listeners[e];if(a!==void 0){let i=a.indexOf(t);i!==-1&&a.splice(i,1)}}dispatchEvent(e){if(this._listeners===void 0)return;let s=this._listeners[e.type];if(s!==void 0){e.target=this;let a=s.slice(0);for(let i=0,f=a.length;i<f;i++)a[i].call(this,e);e.target=null}}},ea=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];var yb=Math.PI/180,Jb=180/Math.PI;function ld(){let o=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,s=Math.random()*4294967295|0;return(ea[o&255]+ea[o>>8&255]+ea[o>>16&255]+ea[o>>24&255]+"-"+ea[e&255]+ea[e>>8&255]+"-"+ea[e>>16&15|64]+ea[e>>24&255]+"-"+ea[t&63|128]+ea[t>>8&255]+"-"+ea[t>>16&255]+ea[t>>24&255]+ea[s&255]+ea[s>>8&255]+ea[s>>16&255]+ea[s>>24&255]).toLowerCase()}function _a(o,e,t){return Math.max(e,Math.min(t,o))}function Ej(o,e){return(o%e+e)%e}function vb(o,e,t){return(1-t)*o+t*e}function AP(o){return(o&o-1)===0&&o!==0}function Kb(o){return Math.pow(2,Math.floor(Math.log(o)/Math.LN2))}function $c(o,e){switch(e.constructor){case Float32Array:return o;case Uint32Array:return o/4294967295;case Uint16Array:return o/65535;case Uint8Array:return o/255;case Int32Array:return Math.max(o/2147483647,-1);case Int16Array:return Math.max(o/32767,-1);case Int8Array:return Math.max(o/127,-1);default:throw new Error("Invalid component type.")}}function ps(o,e){switch(e.constructor){case Float32Array:return o;case Uint32Array:return Math.round(o*4294967295);case Uint16Array:return Math.round(o*65535);case Uint8Array:return Math.round(o*255);case Int32Array:return Math.round(o*2147483647);case Int16Array:return Math.round(o*32767);case Int8Array:return Math.round(o*127);default:throw new Error("Invalid component type.")}}var ui=class o{constructor(e=0,t=0){o.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){let t=this.x,s=this.y,a=e.elements;return this.x=a[0]*t+a[3]*s+a[6],this.y=a[1]*t+a[4]*s+a[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){let s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(e,Math.min(t,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){let t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;let s=this.dot(e)/t;return Math.acos(_a(s,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,s=this.y-e.y;return t*t+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,s){return this.x=e.x+(t.x-e.x)*s,this.y=e.y+(t.y-e.y)*s,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){let s=Math.cos(t),a=Math.sin(t),i=this.x-e.x,f=this.y-e.y;return this.x=i*s-f*a+e.x,this.y=i*a+f*s+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},Bn=class o{constructor(e,t,s,a,i,f,v,x,M){o.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,s,a,i,f,v,x,M)}set(e,t,s,a,i,f,v,x,M){let C=this.elements;return C[0]=e,C[1]=a,C[2]=v,C[3]=t,C[4]=i,C[5]=x,C[6]=s,C[7]=f,C[8]=M,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){let t=this.elements,s=e.elements;return t[0]=s[0],t[1]=s[1],t[2]=s[2],t[3]=s[3],t[4]=s[4],t[5]=s[5],t[6]=s[6],t[7]=s[7],t[8]=s[8],this}extractBasis(e,t,s){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),s.setFromMatrix3Column(this,2),this}setFromMatrix4(e){let t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let s=e.elements,a=t.elements,i=this.elements,f=s[0],v=s[3],x=s[6],M=s[1],C=s[4],D=s[7],L=s[2],N=s[5],j=s[8],Z=a[0],G=a[3],H=a[6],me=a[1],ne=a[4],fe=a[7],Ee=a[2],de=a[5],we=a[8];return i[0]=f*Z+v*me+x*Ee,i[3]=f*G+v*ne+x*de,i[6]=f*H+v*fe+x*we,i[1]=M*Z+C*me+D*Ee,i[4]=M*G+C*ne+D*de,i[7]=M*H+C*fe+D*we,i[2]=L*Z+N*me+j*Ee,i[5]=L*G+N*ne+j*de,i[8]=L*H+N*fe+j*we,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){let e=this.elements,t=e[0],s=e[1],a=e[2],i=e[3],f=e[4],v=e[5],x=e[6],M=e[7],C=e[8];return t*f*C-t*v*M-s*i*C+s*v*x+a*i*M-a*f*x}invert(){let e=this.elements,t=e[0],s=e[1],a=e[2],i=e[3],f=e[4],v=e[5],x=e[6],M=e[7],C=e[8],D=C*f-v*M,L=v*x-C*i,N=M*i-f*x,j=t*D+s*L+a*N;if(j===0)return this.set(0,0,0,0,0,0,0,0,0);let Z=1/j;return e[0]=D*Z,e[1]=(a*M-C*s)*Z,e[2]=(v*s-a*f)*Z,e[3]=L*Z,e[4]=(C*t-a*x)*Z,e[5]=(a*i-v*t)*Z,e[6]=N*Z,e[7]=(s*x-M*t)*Z,e[8]=(f*t-s*i)*Z,this}transpose(){let e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){let t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,s,a,i,f,v){let x=Math.cos(i),M=Math.sin(i);return this.set(s*x,s*M,-s*(x*f+M*v)+f+e,-a*M,a*x,-a*(-M*f+x*v)+v+t,0,0,1),this}scale(e,t){return this.premultiply(xb.makeScale(e,t)),this}rotate(e){return this.premultiply(xb.makeRotation(-e)),this}translate(e,t){return this.premultiply(xb.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){let t=Math.cos(e),s=Math.sin(e);return this.set(t,-s,0,s,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){let t=this.elements,s=e.elements;for(let a=0;a<9;a++)if(t[a]!==s[a])return!1;return!0}fromArray(e,t=0){for(let s=0;s<9;s++)this.elements[s]=e[s+t];return this}toArray(e=[],t=0){let s=this.elements;return e[t]=s[0],e[t+1]=s[1],e[t+2]=s[2],e[t+3]=s[3],e[t+4]=s[4],e[t+5]=s[5],e[t+6]=s[6],e[t+7]=s[7],e[t+8]=s[8],e}clone(){return new this.constructor().fromArray(this.elements)}},xb=new Bn;function kR(o){for(let e=o.length-1;e>=0;--e)if(o[e]>=65535)return!0;return!1}function s6(o){return document.createElementNS("http://www.w3.org/1999/xhtml",o)}function Aj(){let o=s6("canvas");return o.style.display="block",o}var CP={};function Gu(o){o in CP||(CP[o]=!0,console.warn(o))}var IP=new Bn().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),PP=new Bn().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),A3={[G0]:{transfer:t6,primaries:i6,toReference:o=>o,fromReference:o=>o},[Bo]:{transfer:As,primaries:i6,toReference:o=>o.convertSRGBToLinear(),fromReference:o=>o.convertLinearToSRGB()},[A6]:{transfer:t6,primaries:n6,toReference:o=>o.applyMatrix3(PP),fromReference:o=>o.applyMatrix3(IP)},[P7]:{transfer:As,primaries:n6,toReference:o=>o.convertSRGBToLinear().applyMatrix3(PP),fromReference:o=>o.applyMatrix3(IP).convertLinearToSRGB()}},Cj=new Set([G0,A6]),fs={enabled:!0,_workingColorSpace:G0,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(o){if(!Cj.has(o))throw new Error(`Unsupported working color space, "${o}".`);this._workingColorSpace=o},convert:function(o,e,t){if(this.enabled===!1||e===t||!e||!t)return o;let s=A3[e].toReference,a=A3[t].fromReference;return a(s(o))},fromWorkingColorSpace:function(o,e){return this.convert(o,this._workingColorSpace,e)},toWorkingColorSpace:function(o,e){return this.convert(o,e,this._workingColorSpace)},getPrimaries:function(o){return A3[o].primaries},getTransfer:function(o){return o===Al?t6:A3[o].transfer}};function rf(o){return o<.04045?o*.0773993808:Math.pow(o*.9478672986+.0521327014,2.4)}function bb(o){return o<.0031308?o*12.92:1.055*Math.pow(o,.41666)-.055}var N1,o6=class{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{N1===void 0&&(N1=s6("canvas")),N1.width=e.width,N1.height=e.height;let s=N1.getContext("2d");e instanceof ImageData?s.putImageData(e,0,0):s.drawImage(e,0,0,e.width,e.height),t=N1}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){let t=s6("canvas");t.width=e.width,t.height=e.height;let s=t.getContext("2d");s.drawImage(e,0,0,e.width,e.height);let a=s.getImageData(0,0,e.width,e.height),i=a.data;for(let f=0;f<i.length;f++)i[f]=rf(i[f]/255)*255;return s.putImageData(a,0,0),t}else if(e.data){let t=e.data.slice(0);for(let s=0;s<t.length;s++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[s]=Math.floor(rf(t[s]/255)*255):t[s]=rf(t[s]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}},Ij=0,a6=class{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:Ij++}),this.uuid=ld(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){let t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];let s={uuid:this.uuid,url:""},a=this.data;if(a!==null){let i;if(Array.isArray(a)){i=[];for(let f=0,v=a.length;f<v;f++)a[f].isDataTexture?i.push(wb(a[f].image)):i.push(wb(a[f]))}else i=wb(a);s.url=i}return t||(e.images[this.uuid]=s),s}};function wb(o){return typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&o instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&o instanceof ImageBitmap?o6.getDataURL(o):o.data?{data:Array.from(o.data),width:o.width,height:o.height,type:o.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}var Pj=0,Xu=(()=>{class o extends oc{constructor(t=o.DEFAULT_IMAGE,s=o.DEFAULT_MAPPING,a=nc,i=nc,f=Ba,v=zu,x=rc,M=ad,C=o.DEFAULT_ANISOTROPY,D=Al){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Pj++}),this.uuid=ld(),this.name="",this.source=new a6(t),this.mipmaps=[],this.mapping=s,this.channel=0,this.wrapS=a,this.wrapT=i,this.magFilter=f,this.minFilter=v,this.anisotropy=C,this.format=x,this.internalFormat=null,this.type=M,this.offset=new ui(0,0),this.repeat=new ui(1,1),this.center=new ui(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Bn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,typeof D=="string"?this.colorSpace=D:(Gu("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=D===Vu?Bo:Al),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){let s=t===void 0||typeof t=="string";if(!s&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];let a={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(a.userData=this.userData),s||(t.textures[this.uuid]=a),a}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==YI)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case Xb:t.x=t.x-Math.floor(t.x);break;case nc:t.x=t.x<0?0:1;break;case Zb:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case Xb:t.y=t.y-Math.floor(t.y);break;case nc:t.y=t.y<0?0:1;break;case Zb:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return Gu("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===Bo?Vu:PR}set encoding(t){Gu("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=t===Vu?Bo:Al}}return o.DEFAULT_IMAGE=null,o.DEFAULT_MAPPING=YI,o.DEFAULT_ANISOTROPY=1,o})(),Uo=class o{constructor(e=0,t=0,s=0,a=1){o.prototype.isVector4=!0,this.x=e,this.y=t,this.z=s,this.w=a}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,s,a){return this.x=e,this.y=t,this.z=s,this.w=a,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){let t=this.x,s=this.y,a=this.z,i=this.w,f=e.elements;return this.x=f[0]*t+f[4]*s+f[8]*a+f[12]*i,this.y=f[1]*t+f[5]*s+f[9]*a+f[13]*i,this.z=f[2]*t+f[6]*s+f[10]*a+f[14]*i,this.w=f[3]*t+f[7]*s+f[11]*a+f[15]*i,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);let t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,s,a,i,x=e.elements,M=x[0],C=x[4],D=x[8],L=x[1],N=x[5],j=x[9],Z=x[2],G=x[6],H=x[10];if(Math.abs(C-L)<.01&&Math.abs(D-Z)<.01&&Math.abs(j-G)<.01){if(Math.abs(C+L)<.1&&Math.abs(D+Z)<.1&&Math.abs(j+G)<.1&&Math.abs(M+N+H-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;let ne=(M+1)/2,fe=(N+1)/2,Ee=(H+1)/2,de=(C+L)/4,we=(D+Z)/4,Le=(j+G)/4;return ne>fe&&ne>Ee?ne<.01?(s=0,a=.707106781,i=.707106781):(s=Math.sqrt(ne),a=de/s,i=we/s):fe>Ee?fe<.01?(s=.707106781,a=0,i=.707106781):(a=Math.sqrt(fe),s=de/a,i=Le/a):Ee<.01?(s=.707106781,a=.707106781,i=0):(i=Math.sqrt(Ee),s=we/i,a=Le/i),this.set(s,a,i,t),this}let me=Math.sqrt((G-j)*(G-j)+(D-Z)*(D-Z)+(L-C)*(L-C));return Math.abs(me)<.001&&(me=1),this.x=(G-j)/me,this.y=(D-Z)/me,this.z=(L-C)/me,this.w=Math.acos((M+N+H-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){let s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(e,Math.min(t,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,s){return this.x=e.x+(t.x-e.x)*s,this.y=e.y+(t.y-e.y)*s,this.z=e.z+(t.z-e.z)*s,this.w=e.w+(t.w-e.w)*s,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}},Qb=class extends oc{constructor(e=1,t=1,s={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Uo(0,0,e,t),this.scissorTest=!1,this.viewport=new Uo(0,0,e,t);let a={width:e,height:t,depth:1};s.encoding!==void 0&&(Gu("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),s.colorSpace=s.encoding===Vu?Bo:Al),s=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Ba,depthBuffer:!0,stencilBuffer:!1,depthTexture:null,samples:0},s),this.texture=new Xu(a,s.mapping,s.wrapS,s.wrapT,s.magFilter,s.minFilter,s.format,s.type,s.anisotropy,s.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=s.generateMipmaps,this.texture.internalFormat=s.internalFormat,this.depthBuffer=s.depthBuffer,this.stencilBuffer=s.stencilBuffer,this.depthTexture=s.depthTexture,this.samples=s.samples}setSize(e,t,s=1){(this.width!==e||this.height!==t||this.depth!==s)&&(this.width=e,this.height=t,this.depth=s,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=s,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;let t=Object.assign({},e.texture.image);return this.texture.source=new a6(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}},H0=class extends Qb{constructor(e=1,t=1,s={}){super(e,t,s),this.isWebGLRenderTarget=!0}},l6=class extends Xu{constructor(e=null,t=1,s=1,a=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:s,depth:a},this.magFilter=ga,this.minFilter=ga,this.wrapR=nc,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}};var e7=class extends Xu{constructor(e=null,t=1,s=1,a=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:s,depth:a},this.magFilter=ga,this.minFilter=ga,this.wrapR=nc,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}};var ac=class{constructor(e=0,t=0,s=0,a=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=s,this._w=a}static slerpFlat(e,t,s,a,i,f,v){let x=s[a+0],M=s[a+1],C=s[a+2],D=s[a+3],L=i[f+0],N=i[f+1],j=i[f+2],Z=i[f+3];if(v===0){e[t+0]=x,e[t+1]=M,e[t+2]=C,e[t+3]=D;return}if(v===1){e[t+0]=L,e[t+1]=N,e[t+2]=j,e[t+3]=Z;return}if(D!==Z||x!==L||M!==N||C!==j){let G=1-v,H=x*L+M*N+C*j+D*Z,me=H>=0?1:-1,ne=1-H*H;if(ne>Number.EPSILON){let Ee=Math.sqrt(ne),de=Math.atan2(Ee,H*me);G=Math.sin(G*de)/Ee,v=Math.sin(v*de)/Ee}let fe=v*me;if(x=x*G+L*fe,M=M*G+N*fe,C=C*G+j*fe,D=D*G+Z*fe,G===1-v){let Ee=1/Math.sqrt(x*x+M*M+C*C+D*D);x*=Ee,M*=Ee,C*=Ee,D*=Ee}}e[t]=x,e[t+1]=M,e[t+2]=C,e[t+3]=D}static multiplyQuaternionsFlat(e,t,s,a,i,f){let v=s[a],x=s[a+1],M=s[a+2],C=s[a+3],D=i[f],L=i[f+1],N=i[f+2],j=i[f+3];return e[t]=v*j+C*D+x*N-M*L,e[t+1]=x*j+C*L+M*D-v*N,e[t+2]=M*j+C*N+v*L-x*D,e[t+3]=C*j-v*D-x*L-M*N,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,s,a){return this._x=e,this._y=t,this._z=s,this._w=a,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){let s=e._x,a=e._y,i=e._z,f=e._order,v=Math.cos,x=Math.sin,M=v(s/2),C=v(a/2),D=v(i/2),L=x(s/2),N=x(a/2),j=x(i/2);switch(f){case"XYZ":this._x=L*C*D+M*N*j,this._y=M*N*D-L*C*j,this._z=M*C*j+L*N*D,this._w=M*C*D-L*N*j;break;case"YXZ":this._x=L*C*D+M*N*j,this._y=M*N*D-L*C*j,this._z=M*C*j-L*N*D,this._w=M*C*D+L*N*j;break;case"ZXY":this._x=L*C*D-M*N*j,this._y=M*N*D+L*C*j,this._z=M*C*j+L*N*D,this._w=M*C*D-L*N*j;break;case"ZYX":this._x=L*C*D-M*N*j,this._y=M*N*D+L*C*j,this._z=M*C*j-L*N*D,this._w=M*C*D+L*N*j;break;case"YZX":this._x=L*C*D+M*N*j,this._y=M*N*D+L*C*j,this._z=M*C*j-L*N*D,this._w=M*C*D-L*N*j;break;case"XZY":this._x=L*C*D-M*N*j,this._y=M*N*D-L*C*j,this._z=M*C*j+L*N*D,this._w=M*C*D+L*N*j;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+f)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){let s=t/2,a=Math.sin(s);return this._x=e.x*a,this._y=e.y*a,this._z=e.z*a,this._w=Math.cos(s),this._onChangeCallback(),this}setFromRotationMatrix(e){let t=e.elements,s=t[0],a=t[4],i=t[8],f=t[1],v=t[5],x=t[9],M=t[2],C=t[6],D=t[10],L=s+v+D;if(L>0){let N=.5/Math.sqrt(L+1);this._w=.25/N,this._x=(C-x)*N,this._y=(i-M)*N,this._z=(f-a)*N}else if(s>v&&s>D){let N=2*Math.sqrt(1+s-v-D);this._w=(C-x)/N,this._x=.25*N,this._y=(a+f)/N,this._z=(i+M)/N}else if(v>D){let N=2*Math.sqrt(1+v-s-D);this._w=(i-M)/N,this._x=(a+f)/N,this._y=.25*N,this._z=(x+C)/N}else{let N=2*Math.sqrt(1+D-s-v);this._w=(f-a)/N,this._x=(i+M)/N,this._y=(x+C)/N,this._z=.25*N}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let s=e.dot(t)+1;return s<Number.EPSILON?(s=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=s):(this._x=0,this._y=-e.z,this._z=e.y,this._w=s)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=s),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(_a(this.dot(e),-1,1)))}rotateTowards(e,t){let s=this.angleTo(e);if(s===0)return this;let a=Math.min(1,t/s);return this.slerp(e,a),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){let s=e._x,a=e._y,i=e._z,f=e._w,v=t._x,x=t._y,M=t._z,C=t._w;return this._x=s*C+f*v+a*M-i*x,this._y=a*C+f*x+i*v-s*M,this._z=i*C+f*M+s*x-a*v,this._w=f*C-s*v-a*x-i*M,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);let s=this._x,a=this._y,i=this._z,f=this._w,v=f*e._w+s*e._x+a*e._y+i*e._z;if(v<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,v=-v):this.copy(e),v>=1)return this._w=f,this._x=s,this._y=a,this._z=i,this;let x=1-v*v;if(x<=Number.EPSILON){let N=1-t;return this._w=N*f+t*this._w,this._x=N*s+t*this._x,this._y=N*a+t*this._y,this._z=N*i+t*this._z,this.normalize(),this}let M=Math.sqrt(x),C=Math.atan2(M,v),D=Math.sin((1-t)*C)/M,L=Math.sin(t*C)/M;return this._w=f*D+this._w*L,this._x=s*D+this._x*L,this._y=a*D+this._y*L,this._z=i*D+this._z*L,this._onChangeCallback(),this}slerpQuaternions(e,t,s){return this.copy(e).slerp(t,s)}random(){let e=Math.random(),t=Math.sqrt(1-e),s=Math.sqrt(e),a=2*Math.PI*Math.random(),i=2*Math.PI*Math.random();return this.set(t*Math.cos(a),s*Math.sin(i),s*Math.cos(i),t*Math.sin(a))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},mt=class o{constructor(e=0,t=0,s=0){o.prototype.isVector3=!0,this.x=e,this.y=t,this.z=s}set(e,t,s){return s===void 0&&(s=this.z),this.x=e,this.y=t,this.z=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(RP.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(RP.setFromAxisAngle(e,t))}applyMatrix3(e){let t=this.x,s=this.y,a=this.z,i=e.elements;return this.x=i[0]*t+i[3]*s+i[6]*a,this.y=i[1]*t+i[4]*s+i[7]*a,this.z=i[2]*t+i[5]*s+i[8]*a,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){let t=this.x,s=this.y,a=this.z,i=e.elements,f=1/(i[3]*t+i[7]*s+i[11]*a+i[15]);return this.x=(i[0]*t+i[4]*s+i[8]*a+i[12])*f,this.y=(i[1]*t+i[5]*s+i[9]*a+i[13])*f,this.z=(i[2]*t+i[6]*s+i[10]*a+i[14])*f,this}applyQuaternion(e){let t=this.x,s=this.y,a=this.z,i=e.x,f=e.y,v=e.z,x=e.w,M=2*(f*a-v*s),C=2*(v*t-i*a),D=2*(i*s-f*t);return this.x=t+x*M+f*D-v*C,this.y=s+x*C+v*M-i*D,this.z=a+x*D+i*C-f*M,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){let t=this.x,s=this.y,a=this.z,i=e.elements;return this.x=i[0]*t+i[4]*s+i[8]*a,this.y=i[1]*t+i[5]*s+i[9]*a,this.z=i[2]*t+i[6]*s+i[10]*a,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){let s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(e,Math.min(t,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,s){return this.x=e.x+(t.x-e.x)*s,this.y=e.y+(t.y-e.y)*s,this.z=e.z+(t.z-e.z)*s,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){let s=e.x,a=e.y,i=e.z,f=t.x,v=t.y,x=t.z;return this.x=a*x-i*v,this.y=i*f-s*x,this.z=s*v-a*f,this}projectOnVector(e){let t=e.lengthSq();if(t===0)return this.set(0,0,0);let s=e.dot(this)/t;return this.copy(e).multiplyScalar(s)}projectOnPlane(e){return Sb.copy(this).projectOnVector(e),this.sub(Sb)}reflect(e){return this.sub(Sb.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){let t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;let s=this.dot(e)/t;return Math.acos(_a(s,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,s=this.y-e.y,a=this.z-e.z;return t*t+s*s+a*a}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,s){let a=Math.sin(t)*e;return this.x=a*Math.sin(s),this.y=Math.cos(t)*e,this.z=a*Math.cos(s),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,s){return this.x=e*Math.sin(t),this.y=s,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){let t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){let t=this.setFromMatrixColumn(e,0).length(),s=this.setFromMatrixColumn(e,1).length(),a=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=s,this.z=a,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,s=Math.sqrt(1-e**2);return this.x=s*Math.cos(t),this.y=s*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}},Sb=new mt,RP=new ac,Hu=class{constructor(e=new mt(1/0,1/0,1/0),t=new mt(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,s=e.length;t<s;t+=3)this.expandByPoint(Ql.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,s=e.count;t<s;t++)this.expandByPoint(Ql.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,s=e.length;t<s;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let s=Ql.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(s),this.max.copy(e).add(s),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);let s=e.geometry;if(s!==void 0){let i=s.getAttribute("position");if(t===!0&&i!==void 0&&e.isInstancedMesh!==!0)for(let f=0,v=i.count;f<v;f++)e.isMesh===!0?e.getVertexPosition(f,Ql):Ql.fromBufferAttribute(i,f),Ql.applyMatrix4(e.matrixWorld),this.expandByPoint(Ql);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),C3.copy(e.boundingBox)):(s.boundingBox===null&&s.computeBoundingBox(),C3.copy(s.boundingBox)),C3.applyMatrix4(e.matrixWorld),this.union(C3)}let a=e.children;for(let i=0,f=a.length;i<f;i++)this.expandByObject(a[i],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Ql),Ql.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,s;return e.normal.x>0?(t=e.normal.x*this.min.x,s=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,s=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,s+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,s+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,s+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,s+=e.normal.z*this.min.z),t<=-e.constant&&s>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Vg),I3.subVectors(this.max,Vg),z1.subVectors(e.a,Vg),B1.subVectors(e.b,Vg),U1.subVectors(e.c,Vg),Kh.subVectors(B1,z1),Qh.subVectors(U1,B1),Ru.subVectors(z1,U1);let t=[0,-Kh.z,Kh.y,0,-Qh.z,Qh.y,0,-Ru.z,Ru.y,Kh.z,0,-Kh.x,Qh.z,0,-Qh.x,Ru.z,0,-Ru.x,-Kh.y,Kh.x,0,-Qh.y,Qh.x,0,-Ru.y,Ru.x,0];return!Tb(t,z1,B1,U1,I3)||(t=[1,0,0,0,1,0,0,0,1],!Tb(t,z1,B1,U1,I3))?!1:(P3.crossVectors(Kh,Qh),t=[P3.x,P3.y,P3.z],Tb(t,z1,B1,U1,I3))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Ql).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Ql).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(D0[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),D0[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),D0[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),D0[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),D0[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),D0[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),D0[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),D0[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(D0),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},D0=[new mt,new mt,new mt,new mt,new mt,new mt,new mt,new mt],Ql=new mt,C3=new Hu,z1=new mt,B1=new mt,U1=new mt,Kh=new mt,Qh=new mt,Ru=new mt,Vg=new mt,I3=new mt,P3=new mt,ku=new mt;function Tb(o,e,t,s,a){for(let i=0,f=o.length-3;i<=f;i+=3){ku.fromArray(o,i);let v=a.x*Math.abs(ku.x)+a.y*Math.abs(ku.y)+a.z*Math.abs(ku.z),x=e.dot(ku),M=t.dot(ku),C=s.dot(ku);if(Math.max(-Math.max(x,M,C),Math.min(x,M,C))>v)return!1}return!0}var Rj=new Hu,Gg=new mt,Mb=new mt,ju=class{constructor(e=new mt,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){let s=this.center;t!==void 0?s.copy(t):Rj.setFromPoints(e).getCenter(s);let a=0;for(let i=0,f=e.length;i<f;i++)a=Math.max(a,s.distanceToSquared(e[i]));return this.radius=Math.sqrt(a),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){let t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){let s=this.center.distanceToSquared(e);return t.copy(e),s>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Gg.subVectors(e,this.center);let t=Gg.lengthSq();if(t>this.radius*this.radius){let s=Math.sqrt(t),a=(s-this.radius)*.5;this.center.addScaledVector(Gg,a/s),this.radius+=a}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(Mb.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Gg.copy(e.center).add(Mb)),this.expandByPoint(Gg.copy(e.center).sub(Mb))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}},L0=new mt,Eb=new mt,R3=new mt,ed=new mt,Ab=new mt,k3=new mt,Cb=new mt,Zg=class{constructor(e=new mt,t=new mt(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,L0)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);let s=t.dot(this.direction);return s<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,s)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){let t=L0.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(L0.copy(this.origin).addScaledVector(this.direction,t),L0.distanceToSquared(e))}distanceSqToSegment(e,t,s,a){Eb.copy(e).add(t).multiplyScalar(.5),R3.copy(t).sub(e).normalize(),ed.copy(this.origin).sub(Eb);let i=e.distanceTo(t)*.5,f=-this.direction.dot(R3),v=ed.dot(this.direction),x=-ed.dot(R3),M=ed.lengthSq(),C=Math.abs(1-f*f),D,L,N,j;if(C>0)if(D=f*x-v,L=f*v-x,j=i*C,D>=0)if(L>=-j)if(L<=j){let Z=1/C;D*=Z,L*=Z,N=D*(D+f*L+2*v)+L*(f*D+L+2*x)+M}else L=i,D=Math.max(0,-(f*L+v)),N=-D*D+L*(L+2*x)+M;else L=-i,D=Math.max(0,-(f*L+v)),N=-D*D+L*(L+2*x)+M;else L<=-j?(D=Math.max(0,-(-f*i+v)),L=D>0?-i:Math.min(Math.max(-i,-x),i),N=-D*D+L*(L+2*x)+M):L<=j?(D=0,L=Math.min(Math.max(-i,-x),i),N=L*(L+2*x)+M):(D=Math.max(0,-(f*i+v)),L=D>0?i:Math.min(Math.max(-i,-x),i),N=-D*D+L*(L+2*x)+M);else L=f>0?-i:i,D=Math.max(0,-(f*L+v)),N=-D*D+L*(L+2*x)+M;return s&&s.copy(this.origin).addScaledVector(this.direction,D),a&&a.copy(Eb).addScaledVector(R3,L),N}intersectSphere(e,t){L0.subVectors(e.center,this.origin);let s=L0.dot(this.direction),a=L0.dot(L0)-s*s,i=e.radius*e.radius;if(a>i)return null;let f=Math.sqrt(i-a),v=s-f,x=s+f;return x<0?null:v<0?this.at(x,t):this.at(v,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){let t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;let s=-(this.origin.dot(e.normal)+e.constant)/t;return s>=0?s:null}intersectPlane(e,t){let s=this.distanceToPlane(e);return s===null?null:this.at(s,t)}intersectsPlane(e){let t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let s,a,i,f,v,x,M=1/this.direction.x,C=1/this.direction.y,D=1/this.direction.z,L=this.origin;return M>=0?(s=(e.min.x-L.x)*M,a=(e.max.x-L.x)*M):(s=(e.max.x-L.x)*M,a=(e.min.x-L.x)*M),C>=0?(i=(e.min.y-L.y)*C,f=(e.max.y-L.y)*C):(i=(e.max.y-L.y)*C,f=(e.min.y-L.y)*C),s>f||i>a||((i>s||isNaN(s))&&(s=i),(f<a||isNaN(a))&&(a=f),D>=0?(v=(e.min.z-L.z)*D,x=(e.max.z-L.z)*D):(v=(e.max.z-L.z)*D,x=(e.min.z-L.z)*D),s>x||v>a)||((v>s||s!==s)&&(s=v),(x<a||a!==a)&&(a=x),a<0)?null:this.at(s>=0?s:a,t)}intersectsBox(e){return this.intersectBox(e,L0)!==null}intersectTriangle(e,t,s,a,i){Ab.subVectors(t,e),k3.subVectors(s,e),Cb.crossVectors(Ab,k3);let f=this.direction.dot(Cb),v;if(f>0){if(a)return null;v=1}else if(f<0)v=-1,f=-f;else return null;ed.subVectors(this.origin,e);let x=v*this.direction.dot(k3.crossVectors(ed,k3));if(x<0)return null;let M=v*this.direction.dot(Ab.cross(ed));if(M<0||x+M>f)return null;let C=-v*ed.dot(Cb);return C<0?null:this.at(C/f,i)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}},Po=class o{constructor(e,t,s,a,i,f,v,x,M,C,D,L,N,j,Z,G){o.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,s,a,i,f,v,x,M,C,D,L,N,j,Z,G)}set(e,t,s,a,i,f,v,x,M,C,D,L,N,j,Z,G){let H=this.elements;return H[0]=e,H[4]=t,H[8]=s,H[12]=a,H[1]=i,H[5]=f,H[9]=v,H[13]=x,H[2]=M,H[6]=C,H[10]=D,H[14]=L,H[3]=N,H[7]=j,H[11]=Z,H[15]=G,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new o().fromArray(this.elements)}copy(e){let t=this.elements,s=e.elements;return t[0]=s[0],t[1]=s[1],t[2]=s[2],t[3]=s[3],t[4]=s[4],t[5]=s[5],t[6]=s[6],t[7]=s[7],t[8]=s[8],t[9]=s[9],t[10]=s[10],t[11]=s[11],t[12]=s[12],t[13]=s[13],t[14]=s[14],t[15]=s[15],this}copyPosition(e){let t=this.elements,s=e.elements;return t[12]=s[12],t[13]=s[13],t[14]=s[14],this}setFromMatrix3(e){let t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,s){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),s.setFromMatrixColumn(this,2),this}makeBasis(e,t,s){return this.set(e.x,t.x,s.x,0,e.y,t.y,s.y,0,e.z,t.z,s.z,0,0,0,0,1),this}extractRotation(e){let t=this.elements,s=e.elements,a=1/V1.setFromMatrixColumn(e,0).length(),i=1/V1.setFromMatrixColumn(e,1).length(),f=1/V1.setFromMatrixColumn(e,2).length();return t[0]=s[0]*a,t[1]=s[1]*a,t[2]=s[2]*a,t[3]=0,t[4]=s[4]*i,t[5]=s[5]*i,t[6]=s[6]*i,t[7]=0,t[8]=s[8]*f,t[9]=s[9]*f,t[10]=s[10]*f,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){let t=this.elements,s=e.x,a=e.y,i=e.z,f=Math.cos(s),v=Math.sin(s),x=Math.cos(a),M=Math.sin(a),C=Math.cos(i),D=Math.sin(i);if(e.order==="XYZ"){let L=f*C,N=f*D,j=v*C,Z=v*D;t[0]=x*C,t[4]=-x*D,t[8]=M,t[1]=N+j*M,t[5]=L-Z*M,t[9]=-v*x,t[2]=Z-L*M,t[6]=j+N*M,t[10]=f*x}else if(e.order==="YXZ"){let L=x*C,N=x*D,j=M*C,Z=M*D;t[0]=L+Z*v,t[4]=j*v-N,t[8]=f*M,t[1]=f*D,t[5]=f*C,t[9]=-v,t[2]=N*v-j,t[6]=Z+L*v,t[10]=f*x}else if(e.order==="ZXY"){let L=x*C,N=x*D,j=M*C,Z=M*D;t[0]=L-Z*v,t[4]=-f*D,t[8]=j+N*v,t[1]=N+j*v,t[5]=f*C,t[9]=Z-L*v,t[2]=-f*M,t[6]=v,t[10]=f*x}else if(e.order==="ZYX"){let L=f*C,N=f*D,j=v*C,Z=v*D;t[0]=x*C,t[4]=j*M-N,t[8]=L*M+Z,t[1]=x*D,t[5]=Z*M+L,t[9]=N*M-j,t[2]=-M,t[6]=v*x,t[10]=f*x}else if(e.order==="YZX"){let L=f*x,N=f*M,j=v*x,Z=v*M;t[0]=x*C,t[4]=Z-L*D,t[8]=j*D+N,t[1]=D,t[5]=f*C,t[9]=-v*C,t[2]=-M*C,t[6]=N*D+j,t[10]=L-Z*D}else if(e.order==="XZY"){let L=f*x,N=f*M,j=v*x,Z=v*M;t[0]=x*C,t[4]=-D,t[8]=M*C,t[1]=L*D+Z,t[5]=f*C,t[9]=N*D-j,t[2]=j*D-N,t[6]=v*C,t[10]=Z*D+L}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(kj,e,Dj)}lookAt(e,t,s){let a=this.elements;return ll.subVectors(e,t),ll.lengthSq()===0&&(ll.z=1),ll.normalize(),td.crossVectors(s,ll),td.lengthSq()===0&&(Math.abs(s.z)===1?ll.x+=1e-4:ll.z+=1e-4,ll.normalize(),td.crossVectors(s,ll)),td.normalize(),D3.crossVectors(ll,td),a[0]=td.x,a[4]=D3.x,a[8]=ll.x,a[1]=td.y,a[5]=D3.y,a[9]=ll.y,a[2]=td.z,a[6]=D3.z,a[10]=ll.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let s=e.elements,a=t.elements,i=this.elements,f=s[0],v=s[4],x=s[8],M=s[12],C=s[1],D=s[5],L=s[9],N=s[13],j=s[2],Z=s[6],G=s[10],H=s[14],me=s[3],ne=s[7],fe=s[11],Ee=s[15],de=a[0],we=a[4],Le=a[8],De=a[12],se=a[1],Ce=a[5],Ne=a[9],zt=a[13],Ge=a[2],Xe=a[6],ht=a[10],Ot=a[14],bt=a[3],Tt=a[7],Nt=a[11],Bt=a[15];return i[0]=f*de+v*se+x*Ge+M*bt,i[4]=f*we+v*Ce+x*Xe+M*Tt,i[8]=f*Le+v*Ne+x*ht+M*Nt,i[12]=f*De+v*zt+x*Ot+M*Bt,i[1]=C*de+D*se+L*Ge+N*bt,i[5]=C*we+D*Ce+L*Xe+N*Tt,i[9]=C*Le+D*Ne+L*ht+N*Nt,i[13]=C*De+D*zt+L*Ot+N*Bt,i[2]=j*de+Z*se+G*Ge+H*bt,i[6]=j*we+Z*Ce+G*Xe+H*Tt,i[10]=j*Le+Z*Ne+G*ht+H*Nt,i[14]=j*De+Z*zt+G*Ot+H*Bt,i[3]=me*de+ne*se+fe*Ge+Ee*bt,i[7]=me*we+ne*Ce+fe*Xe+Ee*Tt,i[11]=me*Le+ne*Ne+fe*ht+Ee*Nt,i[15]=me*De+ne*zt+fe*Ot+Ee*Bt,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){let e=this.elements,t=e[0],s=e[4],a=e[8],i=e[12],f=e[1],v=e[5],x=e[9],M=e[13],C=e[2],D=e[6],L=e[10],N=e[14],j=e[3],Z=e[7],G=e[11],H=e[15];return j*(+i*x*D-a*M*D-i*v*L+s*M*L+a*v*N-s*x*N)+Z*(+t*x*N-t*M*L+i*f*L-a*f*N+a*M*C-i*x*C)+G*(+t*M*D-t*v*N-i*f*D+s*f*N+i*v*C-s*M*C)+H*(-a*v*C-t*x*D+t*v*L+a*f*D-s*f*L+s*x*C)}transpose(){let e=this.elements,t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,s){let a=this.elements;return e.isVector3?(a[12]=e.x,a[13]=e.y,a[14]=e.z):(a[12]=e,a[13]=t,a[14]=s),this}invert(){let e=this.elements,t=e[0],s=e[1],a=e[2],i=e[3],f=e[4],v=e[5],x=e[6],M=e[7],C=e[8],D=e[9],L=e[10],N=e[11],j=e[12],Z=e[13],G=e[14],H=e[15],me=D*G*M-Z*L*M+Z*x*N-v*G*N-D*x*H+v*L*H,ne=j*L*M-C*G*M-j*x*N+f*G*N+C*x*H-f*L*H,fe=C*Z*M-j*D*M+j*v*N-f*Z*N-C*v*H+f*D*H,Ee=j*D*x-C*Z*x-j*v*L+f*Z*L+C*v*G-f*D*G,de=t*me+s*ne+a*fe+i*Ee;if(de===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let we=1/de;return e[0]=me*we,e[1]=(Z*L*i-D*G*i-Z*a*N+s*G*N+D*a*H-s*L*H)*we,e[2]=(v*G*i-Z*x*i+Z*a*M-s*G*M-v*a*H+s*x*H)*we,e[3]=(D*x*i-v*L*i-D*a*M+s*L*M+v*a*N-s*x*N)*we,e[4]=ne*we,e[5]=(C*G*i-j*L*i+j*a*N-t*G*N-C*a*H+t*L*H)*we,e[6]=(j*x*i-f*G*i-j*a*M+t*G*M+f*a*H-t*x*H)*we,e[7]=(f*L*i-C*x*i+C*a*M-t*L*M-f*a*N+t*x*N)*we,e[8]=fe*we,e[9]=(j*D*i-C*Z*i-j*s*N+t*Z*N+C*s*H-t*D*H)*we,e[10]=(f*Z*i-j*v*i+j*s*M-t*Z*M-f*s*H+t*v*H)*we,e[11]=(C*v*i-f*D*i-C*s*M+t*D*M+f*s*N-t*v*N)*we,e[12]=Ee*we,e[13]=(C*Z*a-j*D*a+j*s*L-t*Z*L-C*s*G+t*D*G)*we,e[14]=(j*v*a-f*Z*a-j*s*x+t*Z*x+f*s*G-t*v*G)*we,e[15]=(f*D*a-C*v*a+C*s*x-t*D*x-f*s*L+t*v*L)*we,this}scale(e){let t=this.elements,s=e.x,a=e.y,i=e.z;return t[0]*=s,t[4]*=a,t[8]*=i,t[1]*=s,t[5]*=a,t[9]*=i,t[2]*=s,t[6]*=a,t[10]*=i,t[3]*=s,t[7]*=a,t[11]*=i,this}getMaxScaleOnAxis(){let e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],s=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],a=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,s,a))}makeTranslation(e,t,s){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,s,0,0,0,1),this}makeRotationX(e){let t=Math.cos(e),s=Math.sin(e);return this.set(1,0,0,0,0,t,-s,0,0,s,t,0,0,0,0,1),this}makeRotationY(e){let t=Math.cos(e),s=Math.sin(e);return this.set(t,0,s,0,0,1,0,0,-s,0,t,0,0,0,0,1),this}makeRotationZ(e){let t=Math.cos(e),s=Math.sin(e);return this.set(t,-s,0,0,s,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){let s=Math.cos(t),a=Math.sin(t),i=1-s,f=e.x,v=e.y,x=e.z,M=i*f,C=i*v;return this.set(M*f+s,M*v-a*x,M*x+a*v,0,M*v+a*x,C*v+s,C*x-a*f,0,M*x-a*v,C*x+a*f,i*x*x+s,0,0,0,0,1),this}makeScale(e,t,s){return this.set(e,0,0,0,0,t,0,0,0,0,s,0,0,0,0,1),this}makeShear(e,t,s,a,i,f){return this.set(1,s,i,0,e,1,f,0,t,a,1,0,0,0,0,1),this}compose(e,t,s){let a=this.elements,i=t._x,f=t._y,v=t._z,x=t._w,M=i+i,C=f+f,D=v+v,L=i*M,N=i*C,j=i*D,Z=f*C,G=f*D,H=v*D,me=x*M,ne=x*C,fe=x*D,Ee=s.x,de=s.y,we=s.z;return a[0]=(1-(Z+H))*Ee,a[1]=(N+fe)*Ee,a[2]=(j-ne)*Ee,a[3]=0,a[4]=(N-fe)*de,a[5]=(1-(L+H))*de,a[6]=(G+me)*de,a[7]=0,a[8]=(j+ne)*we,a[9]=(G-me)*we,a[10]=(1-(L+Z))*we,a[11]=0,a[12]=e.x,a[13]=e.y,a[14]=e.z,a[15]=1,this}decompose(e,t,s){let a=this.elements,i=V1.set(a[0],a[1],a[2]).length(),f=V1.set(a[4],a[5],a[6]).length(),v=V1.set(a[8],a[9],a[10]).length();this.determinant()<0&&(i=-i),e.x=a[12],e.y=a[13],e.z=a[14],ec.copy(this);let M=1/i,C=1/f,D=1/v;return ec.elements[0]*=M,ec.elements[1]*=M,ec.elements[2]*=M,ec.elements[4]*=C,ec.elements[5]*=C,ec.elements[6]*=C,ec.elements[8]*=D,ec.elements[9]*=D,ec.elements[10]*=D,t.setFromRotationMatrix(ec),s.x=i,s.y=f,s.z=v,this}makePerspective(e,t,s,a,i,f,v=V0){let x=this.elements,M=2*i/(t-e),C=2*i/(s-a),D=(t+e)/(t-e),L=(s+a)/(s-a),N,j;if(v===V0)N=-(f+i)/(f-i),j=-2*f*i/(f-i);else if(v===r6)N=-f/(f-i),j=-f*i/(f-i);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+v);return x[0]=M,x[4]=0,x[8]=D,x[12]=0,x[1]=0,x[5]=C,x[9]=L,x[13]=0,x[2]=0,x[6]=0,x[10]=N,x[14]=j,x[3]=0,x[7]=0,x[11]=-1,x[15]=0,this}makeOrthographic(e,t,s,a,i,f,v=V0){let x=this.elements,M=1/(t-e),C=1/(s-a),D=1/(f-i),L=(t+e)*M,N=(s+a)*C,j,Z;if(v===V0)j=(f+i)*D,Z=-2*D;else if(v===r6)j=i*D,Z=-1*D;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+v);return x[0]=2*M,x[4]=0,x[8]=0,x[12]=-L,x[1]=0,x[5]=2*C,x[9]=0,x[13]=-N,x[2]=0,x[6]=0,x[10]=Z,x[14]=-j,x[3]=0,x[7]=0,x[11]=0,x[15]=1,this}equals(e){let t=this.elements,s=e.elements;for(let a=0;a<16;a++)if(t[a]!==s[a])return!1;return!0}fromArray(e,t=0){for(let s=0;s<16;s++)this.elements[s]=e[s+t];return this}toArray(e=[],t=0){let s=this.elements;return e[t]=s[0],e[t+1]=s[1],e[t+2]=s[2],e[t+3]=s[3],e[t+4]=s[4],e[t+5]=s[5],e[t+6]=s[6],e[t+7]=s[7],e[t+8]=s[8],e[t+9]=s[9],e[t+10]=s[10],e[t+11]=s[11],e[t+12]=s[12],e[t+13]=s[13],e[t+14]=s[14],e[t+15]=s[15],e}},V1=new mt,ec=new Po,kj=new mt(0,0,0),Dj=new mt(1,1,1),td=new mt,D3=new mt,ll=new mt,kP=new Po,DP=new ac,Lj=(()=>{class o{constructor(t=0,s=0,a=0,i=o.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=s,this._z=a,this._order=i}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,s,a,i=this._order){return this._x=t,this._y=s,this._z=a,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,s=this._order,a=!0){let i=t.elements,f=i[0],v=i[4],x=i[8],M=i[1],C=i[5],D=i[9],L=i[2],N=i[6],j=i[10];switch(s){case"XYZ":this._y=Math.asin(_a(x,-1,1)),Math.abs(x)<.9999999?(this._x=Math.atan2(-D,j),this._z=Math.atan2(-v,f)):(this._x=Math.atan2(N,C),this._z=0);break;case"YXZ":this._x=Math.asin(-_a(D,-1,1)),Math.abs(D)<.9999999?(this._y=Math.atan2(x,j),this._z=Math.atan2(M,C)):(this._y=Math.atan2(-L,f),this._z=0);break;case"ZXY":this._x=Math.asin(_a(N,-1,1)),Math.abs(N)<.9999999?(this._y=Math.atan2(-L,j),this._z=Math.atan2(-v,C)):(this._y=0,this._z=Math.atan2(M,f));break;case"ZYX":this._y=Math.asin(-_a(L,-1,1)),Math.abs(L)<.9999999?(this._x=Math.atan2(N,j),this._z=Math.atan2(M,f)):(this._x=0,this._z=Math.atan2(-v,C));break;case"YZX":this._z=Math.asin(_a(M,-1,1)),Math.abs(M)<.9999999?(this._x=Math.atan2(-D,C),this._y=Math.atan2(-L,f)):(this._x=0,this._y=Math.atan2(x,j));break;case"XZY":this._z=Math.asin(-_a(v,-1,1)),Math.abs(v)<.9999999?(this._x=Math.atan2(N,C),this._y=Math.atan2(x,f)):(this._x=Math.atan2(-D,j),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+s)}return this._order=s,a===!0&&this._onChangeCallback(),this}setFromQuaternion(t,s,a){return kP.makeRotationFromQuaternion(t),this.setFromRotationMatrix(kP,s,a)}setFromVector3(t,s=this._order){return this.set(t.x,t.y,t.z,s)}reorder(t){return DP.setFromEuler(this),this.setFromQuaternion(DP,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],s=0){return t[s]=this._x,t[s+1]=this._y,t[s+2]=this._z,t[s+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}return o.DEFAULT_ORDER="XYZ",o})(),c6=class{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}},Fj=0,LP=new mt,G1=new ac,F0=new Po,L3=new mt,Hg=new mt,Oj=new mt,Nj=new ac,FP=new mt(1,0,0),OP=new mt(0,1,0),NP=new mt(0,0,1),zj={type:"added"},Bj={type:"removed"},dd=(()=>{class o extends oc{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Fj++}),this.uuid=ld(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=o.DEFAULT_UP.clone();let t=new mt,s=new Lj,a=new ac,i=new mt(1,1,1);function f(){a.setFromEuler(s,!1)}function v(){s.setFromQuaternion(a,void 0,!1)}s._onChange(f),a._onChange(v),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:s},quaternion:{configurable:!0,enumerable:!0,value:a},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Po},normalMatrix:{value:new Bn}}),this.matrix=new Po,this.matrixWorld=new Po,this.matrixAutoUpdate=o.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=o.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new c6,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,s){this.quaternion.setFromAxisAngle(t,s)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,s){return G1.setFromAxisAngle(t,s),this.quaternion.multiply(G1),this}rotateOnWorldAxis(t,s){return G1.setFromAxisAngle(t,s),this.quaternion.premultiply(G1),this}rotateX(t){return this.rotateOnAxis(FP,t)}rotateY(t){return this.rotateOnAxis(OP,t)}rotateZ(t){return this.rotateOnAxis(NP,t)}translateOnAxis(t,s){return LP.copy(t).applyQuaternion(this.quaternion),this.position.add(LP.multiplyScalar(s)),this}translateX(t){return this.translateOnAxis(FP,t)}translateY(t){return this.translateOnAxis(OP,t)}translateZ(t){return this.translateOnAxis(NP,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(F0.copy(this.matrixWorld).invert())}lookAt(t,s,a){t.isVector3?L3.copy(t):L3.set(t,s,a);let i=this.parent;this.updateWorldMatrix(!0,!1),Hg.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?F0.lookAt(Hg,L3,this.up):F0.lookAt(L3,Hg,this.up),this.quaternion.setFromRotationMatrix(F0),i&&(F0.extractRotation(i.matrixWorld),G1.setFromRotationMatrix(F0),this.quaternion.premultiply(G1.invert()))}add(t){if(arguments.length>1){for(let s=0;s<arguments.length;s++)this.add(arguments[s]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.parent!==null&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(zj)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let a=0;a<arguments.length;a++)this.remove(arguments[a]);return this}let s=this.children.indexOf(t);return s!==-1&&(t.parent=null,this.children.splice(s,1),t.dispatchEvent(Bj)),this}removeFromParent(){let t=this.parent;return t!==null&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),F0.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),F0.multiply(t.parent.matrixWorld)),t.applyMatrix4(F0),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,s){if(this[t]===s)return this;for(let a=0,i=this.children.length;a<i;a++){let v=this.children[a].getObjectByProperty(t,s);if(v!==void 0)return v}}getObjectsByProperty(t,s,a=[]){this[t]===s&&a.push(this);let i=this.children;for(let f=0,v=i.length;f<v;f++)i[f].getObjectsByProperty(t,s,a);return a}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Hg,t,Oj),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Hg,Nj,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);let s=this.matrixWorld.elements;return t.set(s[8],s[9],s[10]).normalize()}raycast(){}traverse(t){t(this);let s=this.children;for(let a=0,i=s.length;a<i;a++)s[a].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);let s=this.children;for(let a=0,i=s.length;a<i;a++)s[a].traverseVisible(t)}traverseAncestors(t){let s=this.parent;s!==null&&(t(s),s.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);let s=this.children;for(let a=0,i=s.length;a<i;a++){let f=s[a];(f.matrixWorldAutoUpdate===!0||t===!0)&&f.updateMatrixWorld(t)}}updateWorldMatrix(t,s){let a=this.parent;if(t===!0&&a!==null&&a.matrixWorldAutoUpdate===!0&&a.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),s===!0){let i=this.children;for(let f=0,v=i.length;f<v;f++){let x=i[f];x.matrixWorldAutoUpdate===!0&&x.updateWorldMatrix(!1,!0)}}}toJSON(t){let s=t===void 0||typeof t=="string",a={};s&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},a.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});let i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.visibility=this._visibility,i.active=this._active,i.bounds=this._bounds.map(x=>({boxInitialized:x.boxInitialized,boxMin:x.box.min.toArray(),boxMax:x.box.max.toArray(),sphereInitialized:x.sphereInitialized,sphereRadius:x.sphere.radius,sphereCenter:x.sphere.center.toArray()})),i.maxGeometryCount=this._maxGeometryCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.geometryCount=this._geometryCount,i.matricesTexture=this._matricesTexture.toJSON(t),this.boundingSphere!==null&&(i.boundingSphere={center:i.boundingSphere.center.toArray(),radius:i.boundingSphere.radius}),this.boundingBox!==null&&(i.boundingBox={min:i.boundingBox.min.toArray(),max:i.boundingBox.max.toArray()}));function f(x,M){return x[M.uuid]===void 0&&(x[M.uuid]=M.toJSON(t)),M.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(i.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=f(t.geometries,this.geometry);let x=this.geometry.parameters;if(x!==void 0&&x.shapes!==void 0){let M=x.shapes;if(Array.isArray(M))for(let C=0,D=M.length;C<D;C++){let L=M[C];f(t.shapes,L)}else f(t.shapes,M)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(f(t.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){let x=[];for(let M=0,C=this.material.length;M<C;M++)x.push(f(t.materials,this.material[M]));i.material=x}else i.material=f(t.materials,this.material);if(this.children.length>0){i.children=[];for(let x=0;x<this.children.length;x++)i.children.push(this.children[x].toJSON(t).object)}if(this.animations.length>0){i.animations=[];for(let x=0;x<this.animations.length;x++){let M=this.animations[x];i.animations.push(f(t.animations,M))}}if(s){let x=v(t.geometries),M=v(t.materials),C=v(t.textures),D=v(t.images),L=v(t.shapes),N=v(t.skeletons),j=v(t.animations),Z=v(t.nodes);x.length>0&&(a.geometries=x),M.length>0&&(a.materials=M),C.length>0&&(a.textures=C),D.length>0&&(a.images=D),L.length>0&&(a.shapes=L),N.length>0&&(a.skeletons=N),j.length>0&&(a.animations=j),Z.length>0&&(a.nodes=Z)}return a.object=i,a;function v(x){let M=[];for(let C in x){let D=x[C];delete D.metadata,M.push(D)}return M}}clone(t){return new this.constructor().copy(this,t)}copy(t,s=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),s===!0)for(let a=0;a<t.children.length;a++){let i=t.children[a];this.add(i.clone())}return this}}return o.DEFAULT_UP=new mt(0,1,0),o.DEFAULT_MATRIX_AUTO_UPDATE=!0,o.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0,o})(),tc=new mt,O0=new mt,Ib=new mt,N0=new mt,H1=new mt,j1=new mt,zP=new mt,Pb=new mt,Rb=new mt,kb=new mt,K1=class o{constructor(e=new mt,t=new mt,s=new mt){this.a=e,this.b=t,this.c=s}static getNormal(e,t,s,a){a.subVectors(s,t),tc.subVectors(e,t),a.cross(tc);let i=a.lengthSq();return i>0?a.multiplyScalar(1/Math.sqrt(i)):a.set(0,0,0)}static getBarycoord(e,t,s,a,i){tc.subVectors(a,t),O0.subVectors(s,t),Ib.subVectors(e,t);let f=tc.dot(tc),v=tc.dot(O0),x=tc.dot(Ib),M=O0.dot(O0),C=O0.dot(Ib),D=f*M-v*v;if(D===0)return i.set(0,0,0),null;let L=1/D,N=(M*x-v*C)*L,j=(f*C-v*x)*L;return i.set(1-N-j,j,N)}static containsPoint(e,t,s,a){return this.getBarycoord(e,t,s,a,N0)===null?!1:N0.x>=0&&N0.y>=0&&N0.x+N0.y<=1}static getInterpolation(e,t,s,a,i,f,v,x){return this.getBarycoord(e,t,s,a,N0)===null?(x.x=0,x.y=0,"z"in x&&(x.z=0),"w"in x&&(x.w=0),null):(x.setScalar(0),x.addScaledVector(i,N0.x),x.addScaledVector(f,N0.y),x.addScaledVector(v,N0.z),x)}static isFrontFacing(e,t,s,a){return tc.subVectors(s,t),O0.subVectors(e,t),tc.cross(O0).dot(a)<0}set(e,t,s){return this.a.copy(e),this.b.copy(t),this.c.copy(s),this}setFromPointsAndIndices(e,t,s,a){return this.a.copy(e[t]),this.b.copy(e[s]),this.c.copy(e[a]),this}setFromAttributeAndIndices(e,t,s,a){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,s),this.c.fromBufferAttribute(e,a),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return tc.subVectors(this.c,this.b),O0.subVectors(this.a,this.b),tc.cross(O0).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return o.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return o.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,s,a,i){return o.getInterpolation(e,this.a,this.b,this.c,t,s,a,i)}containsPoint(e){return o.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return o.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){let s=this.a,a=this.b,i=this.c,f,v;H1.subVectors(a,s),j1.subVectors(i,s),Pb.subVectors(e,s);let x=H1.dot(Pb),M=j1.dot(Pb);if(x<=0&&M<=0)return t.copy(s);Rb.subVectors(e,a);let C=H1.dot(Rb),D=j1.dot(Rb);if(C>=0&&D<=C)return t.copy(a);let L=x*D-C*M;if(L<=0&&x>=0&&C<=0)return f=x/(x-C),t.copy(s).addScaledVector(H1,f);kb.subVectors(e,i);let N=H1.dot(kb),j=j1.dot(kb);if(j>=0&&N<=j)return t.copy(i);let Z=N*M-x*j;if(Z<=0&&M>=0&&j<=0)return v=M/(M-j),t.copy(s).addScaledVector(j1,v);let G=C*j-N*D;if(G<=0&&D-C>=0&&N-j>=0)return zP.subVectors(i,a),v=(D-C)/(D-C+(N-j)),t.copy(a).addScaledVector(zP,v);let H=1/(G+Z+L);return f=Z*H,v=L*H,t.copy(s).addScaledVector(H1,f).addScaledVector(j1,v)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}},DR={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},id={h:0,s:0,l:0},F3={h:0,s:0,l:0};function Db(o,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?o+(e-o)*6*t:t<1/2?e:t<2/3?o+(e-o)*6*(2/3-t):o}var Er=class{constructor(e,t,s){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,s)}set(e,t,s){if(t===void 0&&s===void 0){let a=e;a&&a.isColor?this.copy(a):typeof a=="number"?this.setHex(a):typeof a=="string"&&this.setStyle(a)}else this.setRGB(e,t,s);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Bo){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,fs.toWorkingColorSpace(this,t),this}setRGB(e,t,s,a=fs.workingColorSpace){return this.r=e,this.g=t,this.b=s,fs.toWorkingColorSpace(this,a),this}setHSL(e,t,s,a=fs.workingColorSpace){if(e=Ej(e,1),t=_a(t,0,1),s=_a(s,0,1),t===0)this.r=this.g=this.b=s;else{let i=s<=.5?s*(1+t):s+t-s*t,f=2*s-i;this.r=Db(f,i,e+1/3),this.g=Db(f,i,e),this.b=Db(f,i,e-1/3)}return fs.toWorkingColorSpace(this,a),this}setStyle(e,t=Bo){function s(i){i!==void 0&&parseFloat(i)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let a;if(a=/^(\w+)\(([^\)]*)\)/.exec(e)){let i,f=a[1],v=a[2];switch(f){case"rgb":case"rgba":if(i=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(v))return s(i[4]),this.setRGB(Math.min(255,parseInt(i[1],10))/255,Math.min(255,parseInt(i[2],10))/255,Math.min(255,parseInt(i[3],10))/255,t);if(i=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(v))return s(i[4]),this.setRGB(Math.min(100,parseInt(i[1],10))/100,Math.min(100,parseInt(i[2],10))/100,Math.min(100,parseInt(i[3],10))/100,t);break;case"hsl":case"hsla":if(i=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(v))return s(i[4]),this.setHSL(parseFloat(i[1])/360,parseFloat(i[2])/100,parseFloat(i[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(a=/^\#([A-Fa-f\d]+)$/.exec(e)){let i=a[1],f=i.length;if(f===3)return this.setRGB(parseInt(i.charAt(0),16)/15,parseInt(i.charAt(1),16)/15,parseInt(i.charAt(2),16)/15,t);if(f===6)return this.setHex(parseInt(i,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=Bo){let s=DR[e.toLowerCase()];return s!==void 0?this.setHex(s,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=rf(e.r),this.g=rf(e.g),this.b=rf(e.b),this}copyLinearToSRGB(e){return this.r=bb(e.r),this.g=bb(e.g),this.b=bb(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Bo){return fs.fromWorkingColorSpace(ta.copy(this),e),Math.round(_a(ta.r*255,0,255))*65536+Math.round(_a(ta.g*255,0,255))*256+Math.round(_a(ta.b*255,0,255))}getHexString(e=Bo){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=fs.workingColorSpace){fs.fromWorkingColorSpace(ta.copy(this),t);let s=ta.r,a=ta.g,i=ta.b,f=Math.max(s,a,i),v=Math.min(s,a,i),x,M,C=(v+f)/2;if(v===f)x=0,M=0;else{let D=f-v;switch(M=C<=.5?D/(f+v):D/(2-f-v),f){case s:x=(a-i)/D+(a<i?6:0);break;case a:x=(i-s)/D+2;break;case i:x=(s-a)/D+4;break}x/=6}return e.h=x,e.s=M,e.l=C,e}getRGB(e,t=fs.workingColorSpace){return fs.fromWorkingColorSpace(ta.copy(this),t),e.r=ta.r,e.g=ta.g,e.b=ta.b,e}getStyle(e=Bo){fs.fromWorkingColorSpace(ta.copy(this),e);let t=ta.r,s=ta.g,a=ta.b;return e!==Bo?`color(${e} ${t.toFixed(3)} ${s.toFixed(3)} ${a.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(s*255)},${Math.round(a*255)})`}offsetHSL(e,t,s){return this.getHSL(id),this.setHSL(id.h+e,id.s+t,id.l+s)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,s){return this.r=e.r+(t.r-e.r)*s,this.g=e.g+(t.g-e.g)*s,this.b=e.b+(t.b-e.b)*s,this}lerpHSL(e,t){this.getHSL(id),e.getHSL(F3);let s=vb(id.h,F3.h,t),a=vb(id.s,F3.s,t),i=vb(id.l,F3.l,t);return this.setHSL(s,a,i),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){let t=this.r,s=this.g,a=this.b,i=e.elements;return this.r=i[0]*t+i[3]*s+i[6]*a,this.g=i[1]*t+i[4]*s+i[7]*a,this.b=i[2]*t+i[5]*s+i[8]*a,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}},ta=new Er;Er.NAMES=DR;var Uj=0,hd=class extends oc{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Uj++}),this.uuid=ld(),this.name="",this.type="Material",this.blending=nf,this.side=cd,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=Hb,this.blendDst=jb,this.blendEquation=Ou,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Er(0,0,0),this.blendAlpha=0,this.depthFunc=K3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=EP,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=O1,this.stencilZFail=O1,this.stencilZPass=O1,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(let t in e){let s=e[t];if(s===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}let a=this[t];if(a===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}a&&a.isColor?a.set(s):a&&a.isVector3&&s&&s.isVector3?a.copy(s):this[t]=s}}toJSON(e){let t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});let s={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.color&&this.color.isColor&&(s.color=this.color.getHex()),this.roughness!==void 0&&(s.roughness=this.roughness),this.metalness!==void 0&&(s.metalness=this.metalness),this.sheen!==void 0&&(s.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(s.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(s.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(s.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(s.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(s.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(s.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(s.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(s.shininess=this.shininess),this.clearcoat!==void 0&&(s.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(s.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(s.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(s.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(s.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,s.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(s.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(s.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(s.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(s.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(s.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(s.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(s.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(s.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(s.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(s.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(s.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(s.lightMap=this.lightMap.toJSON(e).uuid,s.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(s.aoMap=this.aoMap.toJSON(e).uuid,s.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(s.bumpMap=this.bumpMap.toJSON(e).uuid,s.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(s.normalMap=this.normalMap.toJSON(e).uuid,s.normalMapType=this.normalMapType,s.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(s.displacementMap=this.displacementMap.toJSON(e).uuid,s.displacementScale=this.displacementScale,s.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(s.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(s.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(s.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(s.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(s.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(s.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(s.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(s.combine=this.combine)),this.envMapIntensity!==void 0&&(s.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(s.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(s.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(s.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(s.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(s.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(s.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(s.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(s.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(s.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(s.size=this.size),this.shadowSide!==null&&(s.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(s.sizeAttenuation=this.sizeAttenuation),this.blending!==nf&&(s.blending=this.blending),this.side!==cd&&(s.side=this.side),this.vertexColors===!0&&(s.vertexColors=!0),this.opacity<1&&(s.opacity=this.opacity),this.transparent===!0&&(s.transparent=!0),this.blendSrc!==Hb&&(s.blendSrc=this.blendSrc),this.blendDst!==jb&&(s.blendDst=this.blendDst),this.blendEquation!==Ou&&(s.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(s.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(s.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(s.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(s.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(s.blendAlpha=this.blendAlpha),this.depthFunc!==K3&&(s.depthFunc=this.depthFunc),this.depthTest===!1&&(s.depthTest=this.depthTest),this.depthWrite===!1&&(s.depthWrite=this.depthWrite),this.colorWrite===!1&&(s.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(s.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==EP&&(s.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(s.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(s.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==O1&&(s.stencilFail=this.stencilFail),this.stencilZFail!==O1&&(s.stencilZFail=this.stencilZFail),this.stencilZPass!==O1&&(s.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(s.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(s.rotation=this.rotation),this.polygonOffset===!0&&(s.polygonOffset=!0),this.polygonOffsetFactor!==0&&(s.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(s.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(s.linewidth=this.linewidth),this.dashSize!==void 0&&(s.dashSize=this.dashSize),this.gapSize!==void 0&&(s.gapSize=this.gapSize),this.scale!==void 0&&(s.scale=this.scale),this.dithering===!0&&(s.dithering=!0),this.alphaTest>0&&(s.alphaTest=this.alphaTest),this.alphaHash===!0&&(s.alphaHash=!0),this.alphaToCoverage===!0&&(s.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(s.premultipliedAlpha=!0),this.forceSinglePass===!0&&(s.forceSinglePass=!0),this.wireframe===!0&&(s.wireframe=!0),this.wireframeLinewidth>1&&(s.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(s.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(s.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(s.flatShading=!0),this.visible===!1&&(s.visible=!1),this.toneMapped===!1&&(s.toneMapped=!1),this.fog===!1&&(s.fog=!1),Object.keys(this.userData).length>0&&(s.userData=this.userData);function a(i){let f=[];for(let v in i){let x=i[v];delete x.metadata,f.push(x)}return f}if(t){let i=a(e.textures),f=a(e.images);i.length>0&&(s.textures=i),f.length>0&&(s.images=f)}return s}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;let t=e.clippingPlanes,s=null;if(t!==null){let a=t.length;s=new Array(a);for(let i=0;i!==a;++i)s[i]=t[i].clone()}return this.clippingPlanes=s,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}},h6=class extends hd{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Er(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=wR,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}};var uo=new mt,O3=new ui,Ro=class{constructor(e,t,s=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=s,this.usage=$b,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=U0,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return Gu("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,s){e*=this.itemSize,s*=t.itemSize;for(let a=0,i=this.itemSize;a<i;a++)this.array[e+a]=t.array[s+a];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,s=this.count;t<s;t++)O3.fromBufferAttribute(this,t),O3.applyMatrix3(e),this.setXY(t,O3.x,O3.y);else if(this.itemSize===3)for(let t=0,s=this.count;t<s;t++)uo.fromBufferAttribute(this,t),uo.applyMatrix3(e),this.setXYZ(t,uo.x,uo.y,uo.z);return this}applyMatrix4(e){for(let t=0,s=this.count;t<s;t++)uo.fromBufferAttribute(this,t),uo.applyMatrix4(e),this.setXYZ(t,uo.x,uo.y,uo.z);return this}applyNormalMatrix(e){for(let t=0,s=this.count;t<s;t++)uo.fromBufferAttribute(this,t),uo.applyNormalMatrix(e),this.setXYZ(t,uo.x,uo.y,uo.z);return this}transformDirection(e){for(let t=0,s=this.count;t<s;t++)uo.fromBufferAttribute(this,t),uo.transformDirection(e),this.setXYZ(t,uo.x,uo.y,uo.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let s=this.array[e*this.itemSize+t];return this.normalized&&(s=$c(s,this.array)),s}setComponent(e,t,s){return this.normalized&&(s=ps(s,this.array)),this.array[e*this.itemSize+t]=s,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=$c(t,this.array)),t}setX(e,t){return this.normalized&&(t=ps(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=$c(t,this.array)),t}setY(e,t){return this.normalized&&(t=ps(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=$c(t,this.array)),t}setZ(e,t){return this.normalized&&(t=ps(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=$c(t,this.array)),t}setW(e,t){return this.normalized&&(t=ps(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,s){return e*=this.itemSize,this.normalized&&(t=ps(t,this.array),s=ps(s,this.array)),this.array[e+0]=t,this.array[e+1]=s,this}setXYZ(e,t,s,a){return e*=this.itemSize,this.normalized&&(t=ps(t,this.array),s=ps(s,this.array),a=ps(a,this.array)),this.array[e+0]=t,this.array[e+1]=s,this.array[e+2]=a,this}setXYZW(e,t,s,a,i){return e*=this.itemSize,this.normalized&&(t=ps(t,this.array),s=ps(s,this.array),a=ps(a,this.array),i=ps(i,this.array)),this.array[e+0]=t,this.array[e+1]=s,this.array[e+2]=a,this.array[e+3]=i,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==$b&&(e.usage=this.usage),e}};var d6=class extends Ro{constructor(e,t,s){super(new Uint16Array(e),t,s)}};var u6=class extends Ro{constructor(e,t,s){super(new Uint32Array(e),t,s)}};var sc=class extends Ro{constructor(e,t,s){super(new Float32Array(e),t,s)}};var Vj=0,El=new Po,Lb=new dd,W1=new mt,cl=new Hu,jg=new Hu,Io=new mt,Cl=class o extends oc{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Vj++}),this.uuid=ld(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(kR(e)?u6:d6)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,s=0){this.groups.push({start:e,count:t,materialIndex:s})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){let t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);let s=this.attributes.normal;if(s!==void 0){let i=new Bn().getNormalMatrix(e);s.applyNormalMatrix(i),s.needsUpdate=!0}let a=this.attributes.tangent;return a!==void 0&&(a.transformDirection(e),a.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return El.makeRotationFromQuaternion(e),this.applyMatrix4(El),this}rotateX(e){return El.makeRotationX(e),this.applyMatrix4(El),this}rotateY(e){return El.makeRotationY(e),this.applyMatrix4(El),this}rotateZ(e){return El.makeRotationZ(e),this.applyMatrix4(El),this}translate(e,t,s){return El.makeTranslation(e,t,s),this.applyMatrix4(El),this}scale(e,t,s){return El.makeScale(e,t,s),this.applyMatrix4(El),this}lookAt(e){return Lb.lookAt(e),Lb.updateMatrix(),this.applyMatrix4(Lb.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(W1).negate(),this.translate(W1.x,W1.y,W1.z),this}setFromPoints(e){let t=[];for(let s=0,a=e.length;s<a;s++){let i=e[s];t.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new sc(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Hu);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new mt(-1/0,-1/0,-1/0),new mt(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let s=0,a=t.length;s<a;s++){let i=t[s];cl.setFromBufferAttribute(i),this.morphTargetsRelative?(Io.addVectors(this.boundingBox.min,cl.min),this.boundingBox.expandByPoint(Io),Io.addVectors(this.boundingBox.max,cl.max),this.boundingBox.expandByPoint(Io)):(this.boundingBox.expandByPoint(cl.min),this.boundingBox.expandByPoint(cl.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new ju);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new mt,1/0);return}if(e){let s=this.boundingSphere.center;if(cl.setFromBufferAttribute(e),t)for(let i=0,f=t.length;i<f;i++){let v=t[i];jg.setFromBufferAttribute(v),this.morphTargetsRelative?(Io.addVectors(cl.min,jg.min),cl.expandByPoint(Io),Io.addVectors(cl.max,jg.max),cl.expandByPoint(Io)):(cl.expandByPoint(jg.min),cl.expandByPoint(jg.max))}cl.getCenter(s);let a=0;for(let i=0,f=e.count;i<f;i++)Io.fromBufferAttribute(e,i),a=Math.max(a,s.distanceToSquared(Io));if(t)for(let i=0,f=t.length;i<f;i++){let v=t[i],x=this.morphTargetsRelative;for(let M=0,C=v.count;M<C;M++)Io.fromBufferAttribute(v,M),x&&(W1.fromBufferAttribute(e,M),Io.add(W1)),a=Math.max(a,s.distanceToSquared(Io))}this.boundingSphere.radius=Math.sqrt(a),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){let e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}let s=e.array,a=t.position.array,i=t.normal.array,f=t.uv.array,v=a.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Ro(new Float32Array(4*v),4));let x=this.getAttribute("tangent").array,M=[],C=[];for(let se=0;se<v;se++)M[se]=new mt,C[se]=new mt;let D=new mt,L=new mt,N=new mt,j=new ui,Z=new ui,G=new ui,H=new mt,me=new mt;function ne(se,Ce,Ne){D.fromArray(a,se*3),L.fromArray(a,Ce*3),N.fromArray(a,Ne*3),j.fromArray(f,se*2),Z.fromArray(f,Ce*2),G.fromArray(f,Ne*2),L.sub(D),N.sub(D),Z.sub(j),G.sub(j);let zt=1/(Z.x*G.y-G.x*Z.y);isFinite(zt)&&(H.copy(L).multiplyScalar(G.y).addScaledVector(N,-Z.y).multiplyScalar(zt),me.copy(N).multiplyScalar(Z.x).addScaledVector(L,-G.x).multiplyScalar(zt),M[se].add(H),M[Ce].add(H),M[Ne].add(H),C[se].add(me),C[Ce].add(me),C[Ne].add(me))}let fe=this.groups;fe.length===0&&(fe=[{start:0,count:s.length}]);for(let se=0,Ce=fe.length;se<Ce;++se){let Ne=fe[se],zt=Ne.start,Ge=Ne.count;for(let Xe=zt,ht=zt+Ge;Xe<ht;Xe+=3)ne(s[Xe+0],s[Xe+1],s[Xe+2])}let Ee=new mt,de=new mt,we=new mt,Le=new mt;function De(se){we.fromArray(i,se*3),Le.copy(we);let Ce=M[se];Ee.copy(Ce),Ee.sub(we.multiplyScalar(we.dot(Ce))).normalize(),de.crossVectors(Le,Ce);let zt=de.dot(C[se])<0?-1:1;x[se*4]=Ee.x,x[se*4+1]=Ee.y,x[se*4+2]=Ee.z,x[se*4+3]=zt}for(let se=0,Ce=fe.length;se<Ce;++se){let Ne=fe[se],zt=Ne.start,Ge=Ne.count;for(let Xe=zt,ht=zt+Ge;Xe<ht;Xe+=3)De(s[Xe+0]),De(s[Xe+1]),De(s[Xe+2])}}computeVertexNormals(){let e=this.index,t=this.getAttribute("position");if(t!==void 0){let s=this.getAttribute("normal");if(s===void 0)s=new Ro(new Float32Array(t.count*3),3),this.setAttribute("normal",s);else for(let L=0,N=s.count;L<N;L++)s.setXYZ(L,0,0,0);let a=new mt,i=new mt,f=new mt,v=new mt,x=new mt,M=new mt,C=new mt,D=new mt;if(e)for(let L=0,N=e.count;L<N;L+=3){let j=e.getX(L+0),Z=e.getX(L+1),G=e.getX(L+2);a.fromBufferAttribute(t,j),i.fromBufferAttribute(t,Z),f.fromBufferAttribute(t,G),C.subVectors(f,i),D.subVectors(a,i),C.cross(D),v.fromBufferAttribute(s,j),x.fromBufferAttribute(s,Z),M.fromBufferAttribute(s,G),v.add(C),x.add(C),M.add(C),s.setXYZ(j,v.x,v.y,v.z),s.setXYZ(Z,x.x,x.y,x.z),s.setXYZ(G,M.x,M.y,M.z)}else for(let L=0,N=t.count;L<N;L+=3)a.fromBufferAttribute(t,L+0),i.fromBufferAttribute(t,L+1),f.fromBufferAttribute(t,L+2),C.subVectors(f,i),D.subVectors(a,i),C.cross(D),s.setXYZ(L+0,C.x,C.y,C.z),s.setXYZ(L+1,C.x,C.y,C.z),s.setXYZ(L+2,C.x,C.y,C.z);this.normalizeNormals(),s.needsUpdate=!0}}normalizeNormals(){let e=this.attributes.normal;for(let t=0,s=e.count;t<s;t++)Io.fromBufferAttribute(e,t),Io.normalize(),e.setXYZ(t,Io.x,Io.y,Io.z)}toNonIndexed(){function e(v,x){let M=v.array,C=v.itemSize,D=v.normalized,L=new M.constructor(x.length*C),N=0,j=0;for(let Z=0,G=x.length;Z<G;Z++){v.isInterleavedBufferAttribute?N=x[Z]*v.data.stride+v.offset:N=x[Z]*C;for(let H=0;H<C;H++)L[j++]=M[N++]}return new Ro(L,C,D)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let t=new o,s=this.index.array,a=this.attributes;for(let v in a){let x=a[v],M=e(x,s);t.setAttribute(v,M)}let i=this.morphAttributes;for(let v in i){let x=[],M=i[v];for(let C=0,D=M.length;C<D;C++){let L=M[C],N=e(L,s);x.push(N)}t.morphAttributes[v]=x}t.morphTargetsRelative=this.morphTargetsRelative;let f=this.groups;for(let v=0,x=f.length;v<x;v++){let M=f[v];t.addGroup(M.start,M.count,M.materialIndex)}return t}toJSON(){let e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){let x=this.parameters;for(let M in x)x[M]!==void 0&&(e[M]=x[M]);return e}e.data={attributes:{}};let t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});let s=this.attributes;for(let x in s){let M=s[x];e.data.attributes[x]=M.toJSON(e.data)}let a={},i=!1;for(let x in this.morphAttributes){let M=this.morphAttributes[x],C=[];for(let D=0,L=M.length;D<L;D++){let N=M[D];C.push(N.toJSON(e.data))}C.length>0&&(a[x]=C,i=!0)}i&&(e.data.morphAttributes=a,e.data.morphTargetsRelative=this.morphTargetsRelative);let f=this.groups;f.length>0&&(e.data.groups=JSON.parse(JSON.stringify(f)));let v=this.boundingSphere;return v!==null&&(e.data.boundingSphere={center:v.center.toArray(),radius:v.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let t={};this.name=e.name;let s=e.index;s!==null&&this.setIndex(s.clone(t));let a=e.attributes;for(let M in a){let C=a[M];this.setAttribute(M,C.clone(t))}let i=e.morphAttributes;for(let M in i){let C=[],D=i[M];for(let L=0,N=D.length;L<N;L++)C.push(D[L].clone(t));this.morphAttributes[M]=C}this.morphTargetsRelative=e.morphTargetsRelative;let f=e.groups;for(let M=0,C=f.length;M<C;M++){let D=f[M];this.addGroup(D.start,D.count,D.materialIndex)}let v=e.boundingBox;v!==null&&(this.boundingBox=v.clone());let x=e.boundingSphere;return x!==null&&(this.boundingSphere=x.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}},BP=new Po,Du=new Zg,N3=new ju,UP=new mt,q1=new mt,X1=new mt,Z1=new mt,Fb=new mt,z3=new mt,B3=new ui,U3=new ui,V3=new ui,VP=new mt,GP=new mt,HP=new mt,G3=new mt,H3=new mt,dl=class extends dd{constructor(e=new Cl,t=new h6){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){let t=this.geometry.morphAttributes,s=Object.keys(t);if(s.length>0){let a=t[s[0]];if(a!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let i=0,f=a.length;i<f;i++){let v=a[i].name||String(i);this.morphTargetInfluences.push(0),this.morphTargetDictionary[v]=i}}}}getVertexPosition(e,t){let s=this.geometry,a=s.attributes.position,i=s.morphAttributes.position,f=s.morphTargetsRelative;t.fromBufferAttribute(a,e);let v=this.morphTargetInfluences;if(i&&v){z3.set(0,0,0);for(let x=0,M=i.length;x<M;x++){let C=v[x],D=i[x];C!==0&&(Fb.fromBufferAttribute(D,e),f?z3.addScaledVector(Fb,C):z3.addScaledVector(Fb.sub(t),C))}t.add(z3)}return t}raycast(e,t){let s=this.geometry,a=this.material,i=this.matrixWorld;a!==void 0&&(s.boundingSphere===null&&s.computeBoundingSphere(),N3.copy(s.boundingSphere),N3.applyMatrix4(i),Du.copy(e.ray).recast(e.near),!(N3.containsPoint(Du.origin)===!1&&(Du.intersectSphere(N3,UP)===null||Du.origin.distanceToSquared(UP)>(e.far-e.near)**2))&&(BP.copy(i).invert(),Du.copy(e.ray).applyMatrix4(BP),!(s.boundingBox!==null&&Du.intersectsBox(s.boundingBox)===!1)&&this._computeIntersections(e,t,Du)))}_computeIntersections(e,t,s){let a,i=this.geometry,f=this.material,v=i.index,x=i.attributes.position,M=i.attributes.uv,C=i.attributes.uv1,D=i.attributes.normal,L=i.groups,N=i.drawRange;if(v!==null)if(Array.isArray(f))for(let j=0,Z=L.length;j<Z;j++){let G=L[j],H=f[G.materialIndex],me=Math.max(G.start,N.start),ne=Math.min(v.count,Math.min(G.start+G.count,N.start+N.count));for(let fe=me,Ee=ne;fe<Ee;fe+=3){let de=v.getX(fe),we=v.getX(fe+1),Le=v.getX(fe+2);a=j3(this,H,e,s,M,C,D,de,we,Le),a&&(a.faceIndex=Math.floor(fe/3),a.face.materialIndex=G.materialIndex,t.push(a))}}else{let j=Math.max(0,N.start),Z=Math.min(v.count,N.start+N.count);for(let G=j,H=Z;G<H;G+=3){let me=v.getX(G),ne=v.getX(G+1),fe=v.getX(G+2);a=j3(this,f,e,s,M,C,D,me,ne,fe),a&&(a.faceIndex=Math.floor(G/3),t.push(a))}}else if(x!==void 0)if(Array.isArray(f))for(let j=0,Z=L.length;j<Z;j++){let G=L[j],H=f[G.materialIndex],me=Math.max(G.start,N.start),ne=Math.min(x.count,Math.min(G.start+G.count,N.start+N.count));for(let fe=me,Ee=ne;fe<Ee;fe+=3){let de=fe,we=fe+1,Le=fe+2;a=j3(this,H,e,s,M,C,D,de,we,Le),a&&(a.faceIndex=Math.floor(fe/3),a.face.materialIndex=G.materialIndex,t.push(a))}}else{let j=Math.max(0,N.start),Z=Math.min(x.count,N.start+N.count);for(let G=j,H=Z;G<H;G+=3){let me=G,ne=G+1,fe=G+2;a=j3(this,f,e,s,M,C,D,me,ne,fe),a&&(a.faceIndex=Math.floor(G/3),t.push(a))}}}};function Gj(o,e,t,s,a,i,f,v){let x;if(e.side===Ua?x=s.intersectTriangle(f,i,a,!0,v):x=s.intersectTriangle(a,i,f,e.side===cd,v),x===null)return null;H3.copy(v),H3.applyMatrix4(o.matrixWorld);let M=t.ray.origin.distanceTo(H3);return M<t.near||M>t.far?null:{distance:M,point:H3.clone(),object:o}}function j3(o,e,t,s,a,i,f,v,x,M){o.getVertexPosition(v,q1),o.getVertexPosition(x,X1),o.getVertexPosition(M,Z1);let C=Gj(o,e,t,s,q1,X1,Z1,G3);if(C){a&&(B3.fromBufferAttribute(a,v),U3.fromBufferAttribute(a,x),V3.fromBufferAttribute(a,M),C.uv=K1.getInterpolation(G3,q1,X1,Z1,B3,U3,V3,new ui)),i&&(B3.fromBufferAttribute(i,v),U3.fromBufferAttribute(i,x),V3.fromBufferAttribute(i,M),C.uv1=K1.getInterpolation(G3,q1,X1,Z1,B3,U3,V3,new ui),C.uv2=C.uv1),f&&(VP.fromBufferAttribute(f,v),GP.fromBufferAttribute(f,x),HP.fromBufferAttribute(f,M),C.normal=K1.getInterpolation(G3,q1,X1,Z1,VP,GP,HP,new mt),C.normal.dot(s.direction)>0&&C.normal.multiplyScalar(-1));let D={a:v,b:x,c:M,normal:new mt,materialIndex:0};K1.getNormal(q1,X1,Z1,D.normal),C.face=D}return C}var $g=class o extends Cl{constructor(e=1,t=1,s=1,a=1,i=1,f=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:s,widthSegments:a,heightSegments:i,depthSegments:f};let v=this;a=Math.floor(a),i=Math.floor(i),f=Math.floor(f);let x=[],M=[],C=[],D=[],L=0,N=0;j("z","y","x",-1,-1,s,t,e,f,i,0),j("z","y","x",1,-1,s,t,-e,f,i,1),j("x","z","y",1,1,e,s,t,a,f,2),j("x","z","y",1,-1,e,s,-t,a,f,3),j("x","y","z",1,-1,e,t,s,a,i,4),j("x","y","z",-1,-1,e,t,-s,a,i,5),this.setIndex(x),this.setAttribute("position",new sc(M,3)),this.setAttribute("normal",new sc(C,3)),this.setAttribute("uv",new sc(D,2));function j(Z,G,H,me,ne,fe,Ee,de,we,Le,De){let se=fe/we,Ce=Ee/Le,Ne=fe/2,zt=Ee/2,Ge=de/2,Xe=we+1,ht=Le+1,Ot=0,bt=0,Tt=new mt;for(let Nt=0;Nt<ht;Nt++){let Bt=Nt*Ce-zt;for(let Yt=0;Yt<Xe;Yt++){let Wi=Yt*se-Ne;Tt[Z]=Wi*me,Tt[G]=Bt*ne,Tt[H]=Ge,M.push(Tt.x,Tt.y,Tt.z),Tt[Z]=0,Tt[G]=0,Tt[H]=de>0?1:-1,C.push(Tt.x,Tt.y,Tt.z),D.push(Yt/we),D.push(1-Nt/Le),Ot+=1}}for(let Nt=0;Nt<Le;Nt++)for(let Bt=0;Bt<we;Bt++){let Yt=L+Bt+Xe*Nt,Wi=L+Bt+Xe*(Nt+1),wt=L+(Bt+1)+Xe*(Nt+1),ei=L+(Bt+1)+Xe*Nt;x.push(Yt,Wi,ei),x.push(Wi,wt,ei),bt+=6}v.addGroup(N,bt,De),N+=bt,L+=Ot}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new o(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}};function cf(o){let e={};for(let t in o){e[t]={};for(let s in o[t]){let a=o[t][s];a&&(a.isColor||a.isMatrix3||a.isMatrix4||a.isVector2||a.isVector3||a.isVector4||a.isTexture||a.isQuaternion)?a.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][s]=null):e[t][s]=a.clone():Array.isArray(a)?e[t][s]=a.slice():e[t][s]=a}}return e}function ma(o){let e={};for(let t=0;t<o.length;t++){let s=cf(o[t]);for(let a in s)e[a]=s[a]}return e}function Hj(o){let e=[];for(let t=0;t<o.length;t++)e.push(o[t].clone());return e}function LR(o){return o.getRenderTarget()===null?o.outputColorSpace:fs.workingColorSpace}var jj={clone:cf,merge:ma},Wj=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,qj=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,lc=class extends hd{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=Wj,this.fragmentShader=qj,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1,clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=cf(e.uniforms),this.uniformsGroups=Hj(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){let t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(let a in this.uniforms){let f=this.uniforms[a].value;f&&f.isTexture?t.uniforms[a]={type:"t",value:f.toJSON(e).uuid}:f&&f.isColor?t.uniforms[a]={type:"c",value:f.getHex()}:f&&f.isVector2?t.uniforms[a]={type:"v2",value:f.toArray()}:f&&f.isVector3?t.uniforms[a]={type:"v3",value:f.toArray()}:f&&f.isVector4?t.uniforms[a]={type:"v4",value:f.toArray()}:f&&f.isMatrix3?t.uniforms[a]={type:"m3",value:f.toArray()}:f&&f.isMatrix4?t.uniforms[a]={type:"m4",value:f.toArray()}:t.uniforms[a]={value:f}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;let s={};for(let a in this.extensions)this.extensions[a]===!0&&(s[a]=!0);return Object.keys(s).length>0&&(t.extensions=s),t}},p6=class extends dd{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Po,this.projectionMatrix=new Po,this.projectionMatrixInverse=new Po,this.coordinateSystem=V0}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}},nd=new mt,jP=new ui,WP=new ui,hl=class extends p6{constructor(e=50,t=1,s=.1,a=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=s,this.far=a,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){let t=.5*this.getFilmHeight()/e;this.fov=Jb*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){let e=Math.tan(yb*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return Jb*2*Math.atan(Math.tan(yb*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,s){nd.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(nd.x,nd.y).multiplyScalar(-e/nd.z),nd.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),s.set(nd.x,nd.y).multiplyScalar(-e/nd.z)}getViewSize(e,t){return this.getViewBounds(e,jP,WP),t.subVectors(WP,jP)}setViewOffset(e,t,s,a,i,f){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=s,this.view.offsetY=a,this.view.width=i,this.view.height=f,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=this.near,t=e*Math.tan(yb*.5*this.fov)/this.zoom,s=2*t,a=this.aspect*s,i=-.5*a,f=this.view;if(this.view!==null&&this.view.enabled){let x=f.fullWidth,M=f.fullHeight;i+=f.offsetX*a/x,t-=f.offsetY*s/M,a*=f.width/x,s*=f.height/M}let v=this.filmOffset;v!==0&&(i+=e*v/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+a,t,t-s,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}},$1=-90,Y1=1,t7=class extends dd{constructor(e,t,s){super(),this.type="CubeCamera",this.renderTarget=s,this.coordinateSystem=null,this.activeMipmapLevel=0;let a=new hl($1,Y1,e,t);a.layers=this.layers,this.add(a);let i=new hl($1,Y1,e,t);i.layers=this.layers,this.add(i);let f=new hl($1,Y1,e,t);f.layers=this.layers,this.add(f);let v=new hl($1,Y1,e,t);v.layers=this.layers,this.add(v);let x=new hl($1,Y1,e,t);x.layers=this.layers,this.add(x);let M=new hl($1,Y1,e,t);M.layers=this.layers,this.add(M)}updateCoordinateSystem(){let e=this.coordinateSystem,t=this.children.concat(),[s,a,i,f,v,x]=t;for(let M of t)this.remove(M);if(e===V0)s.up.set(0,1,0),s.lookAt(1,0,0),a.up.set(0,1,0),a.lookAt(-1,0,0),i.up.set(0,0,-1),i.lookAt(0,1,0),f.up.set(0,0,1),f.lookAt(0,-1,0),v.up.set(0,1,0),v.lookAt(0,0,1),x.up.set(0,1,0),x.lookAt(0,0,-1);else if(e===r6)s.up.set(0,-1,0),s.lookAt(-1,0,0),a.up.set(0,-1,0),a.lookAt(1,0,0),i.up.set(0,0,1),i.lookAt(0,1,0),f.up.set(0,0,-1),f.lookAt(0,-1,0),v.up.set(0,-1,0),v.lookAt(0,0,1),x.up.set(0,-1,0),x.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(let M of t)this.add(M),M.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();let{renderTarget:s,activeMipmapLevel:a}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());let[i,f,v,x,M,C]=this.children,D=e.getRenderTarget(),L=e.getActiveCubeFace(),N=e.getActiveMipmapLevel(),j=e.xr.enabled;e.xr.enabled=!1;let Z=s.texture.generateMipmaps;s.texture.generateMipmaps=!1,e.setRenderTarget(s,0,a),e.render(t,i),e.setRenderTarget(s,1,a),e.render(t,f),e.setRenderTarget(s,2,a),e.render(t,v),e.setRenderTarget(s,3,a),e.render(t,x),e.setRenderTarget(s,4,a),e.render(t,M),s.texture.generateMipmaps=Z,e.setRenderTarget(s,5,a),e.render(t,C),e.setRenderTarget(D,L,N),e.xr.enabled=j,s.texture.needsPMREMUpdate=!0}},f6=class extends Xu{constructor(e,t,s,a,i,f,v,x,M,C){e=e!==void 0?e:[],t=t!==void 0?t:of,super(e,t,s,a,i,f,v,x,M,C),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}},i7=class extends H0{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;let s={width:e,height:e,depth:1},a=[s,s,s,s,s,s];t.encoding!==void 0&&(Gu("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),t.colorSpace=t.encoding===Vu?Bo:Al),this.texture=new f6(a,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:Ba}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;let s={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},a=new $g(5,5,5),i=new lc({name:"CubemapFromEquirect",uniforms:cf(s.uniforms),vertexShader:s.vertexShader,fragmentShader:s.fragmentShader,side:Ua,blending:sd});i.uniforms.tEquirect.value=t;let f=new dl(a,i),v=t.minFilter;return t.minFilter===zu&&(t.minFilter=Ba),new t7(1,10,this).update(e,f),t.minFilter=v,f.geometry.dispose(),f.material.dispose(),this}clear(e,t,s,a){let i=e.getRenderTarget();for(let f=0;f<6;f++)e.setRenderTarget(this,f),e.clear(t,s,a);e.setRenderTarget(i)}},Ob=new mt,Xj=new mt,Zj=new Bn,B0=class{constructor(e=new mt(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,s,a){return this.normal.set(e,t,s),this.constant=a,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,s){let a=Ob.subVectors(s,t).cross(Xj.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(a,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){let e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){let s=e.delta(Ob),a=this.normal.dot(s);if(a===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;let i=-(e.start.dot(this.normal)+this.constant)/a;return i<0||i>1?null:t.copy(e.start).addScaledVector(s,i)}intersectsLine(e){let t=this.distanceToPoint(e.start),s=this.distanceToPoint(e.end);return t<0&&s>0||s<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){let s=t||Zj.getNormalMatrix(e),a=this.coplanarPoint(Ob).applyMatrix4(e),i=this.normal.applyMatrix3(s).normalize();return this.constant=-a.dot(i),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}},Lu=new ju,W3=new mt,m6=class{constructor(e=new B0,t=new B0,s=new B0,a=new B0,i=new B0,f=new B0){this.planes=[e,t,s,a,i,f]}set(e,t,s,a,i,f){let v=this.planes;return v[0].copy(e),v[1].copy(t),v[2].copy(s),v[3].copy(a),v[4].copy(i),v[5].copy(f),this}copy(e){let t=this.planes;for(let s=0;s<6;s++)t[s].copy(e.planes[s]);return this}setFromProjectionMatrix(e,t=V0){let s=this.planes,a=e.elements,i=a[0],f=a[1],v=a[2],x=a[3],M=a[4],C=a[5],D=a[6],L=a[7],N=a[8],j=a[9],Z=a[10],G=a[11],H=a[12],me=a[13],ne=a[14],fe=a[15];if(s[0].setComponents(x-i,L-M,G-N,fe-H).normalize(),s[1].setComponents(x+i,L+M,G+N,fe+H).normalize(),s[2].setComponents(x+f,L+C,G+j,fe+me).normalize(),s[3].setComponents(x-f,L-C,G-j,fe-me).normalize(),s[4].setComponents(x-v,L-D,G-Z,fe-ne).normalize(),t===V0)s[5].setComponents(x+v,L+D,G+Z,fe+ne).normalize();else if(t===r6)s[5].setComponents(v,D,Z,ne).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),Lu.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{let t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),Lu.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Lu)}intersectsSprite(e){return Lu.center.set(0,0,0),Lu.radius=.7071067811865476,Lu.applyMatrix4(e.matrixWorld),this.intersectsSphere(Lu)}intersectsSphere(e){let t=this.planes,s=e.center,a=-e.radius;for(let i=0;i<6;i++)if(t[i].distanceToPoint(s)<a)return!1;return!0}intersectsBox(e){let t=this.planes;for(let s=0;s<6;s++){let a=t[s];if(W3.x=a.normal.x>0?e.max.x:e.min.x,W3.y=a.normal.y>0?e.max.y:e.min.y,W3.z=a.normal.z>0?e.max.z:e.min.z,a.distanceToPoint(W3)<0)return!1}return!0}containsPoint(e){let t=this.planes;for(let s=0;s<6;s++)if(t[s].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}};function FR(){let o=null,e=!1,t=null,s=null;function a(i,f){t(i,f),s=o.requestAnimationFrame(a)}return{start:function(){e!==!0&&t!==null&&(s=o.requestAnimationFrame(a),e=!0)},stop:function(){o.cancelAnimationFrame(s),e=!1},setAnimationLoop:function(i){t=i},setContext:function(i){o=i}}}function $j(o,e){let t=e.isWebGL2,s=new WeakMap;function a(M,C){let D=M.array,L=M.usage,N=D.byteLength,j=o.createBuffer();o.bindBuffer(C,j),o.bufferData(C,D,L),M.onUploadCallback();let Z;if(D instanceof Float32Array)Z=o.FLOAT;else if(D instanceof Uint16Array)if(M.isFloat16BufferAttribute)if(t)Z=o.HALF_FLOAT;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else Z=o.UNSIGNED_SHORT;else if(D instanceof Int16Array)Z=o.SHORT;else if(D instanceof Uint32Array)Z=o.UNSIGNED_INT;else if(D instanceof Int32Array)Z=o.INT;else if(D instanceof Int8Array)Z=o.BYTE;else if(D instanceof Uint8Array)Z=o.UNSIGNED_BYTE;else if(D instanceof Uint8ClampedArray)Z=o.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+D);return{buffer:j,type:Z,bytesPerElement:D.BYTES_PER_ELEMENT,version:M.version,size:N}}function i(M,C,D){let L=C.array,N=C._updateRange,j=C.updateRanges;if(o.bindBuffer(D,M),N.count===-1&&j.length===0&&o.bufferSubData(D,0,L),j.length!==0){for(let Z=0,G=j.length;Z<G;Z++){let H=j[Z];t?o.bufferSubData(D,H.start*L.BYTES_PER_ELEMENT,L,H.start,H.count):o.bufferSubData(D,H.start*L.BYTES_PER_ELEMENT,L.subarray(H.start,H.start+H.count))}C.clearUpdateRanges()}N.count!==-1&&(t?o.bufferSubData(D,N.offset*L.BYTES_PER_ELEMENT,L,N.offset,N.count):o.bufferSubData(D,N.offset*L.BYTES_PER_ELEMENT,L.subarray(N.offset,N.offset+N.count)),N.count=-1),C.onUploadCallback()}function f(M){return M.isInterleavedBufferAttribute&&(M=M.data),s.get(M)}function v(M){M.isInterleavedBufferAttribute&&(M=M.data);let C=s.get(M);C&&(o.deleteBuffer(C.buffer),s.delete(M))}function x(M,C){if(M.isGLBufferAttribute){let L=s.get(M);(!L||L.version<M.version)&&s.set(M,{buffer:M.buffer,type:M.type,bytesPerElement:M.elementSize,version:M.version});return}M.isInterleavedBufferAttribute&&(M=M.data);let D=s.get(M);if(D===void 0)s.set(M,a(M,C));else if(D.version<M.version){if(D.size!==M.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");i(D.buffer,M,C),D.version=M.version}}return{get:f,remove:v,update:x}}var g6=class o extends Cl{constructor(e=1,t=1,s=1,a=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:s,heightSegments:a};let i=e/2,f=t/2,v=Math.floor(s),x=Math.floor(a),M=v+1,C=x+1,D=e/v,L=t/x,N=[],j=[],Z=[],G=[];for(let H=0;H<C;H++){let me=H*L-f;for(let ne=0;ne<M;ne++){let fe=ne*D-i;j.push(fe,-me,0),Z.push(0,0,1),G.push(ne/v),G.push(1-H/x)}}for(let H=0;H<x;H++)for(let me=0;me<v;me++){let ne=me+M*H,fe=me+M*(H+1),Ee=me+1+M*(H+1),de=me+1+M*H;N.push(ne,fe,de),N.push(fe,Ee,de)}this.setIndex(N),this.setAttribute("position",new sc(j,3)),this.setAttribute("normal",new sc(Z,3)),this.setAttribute("uv",new sc(G,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new o(e.width,e.height,e.widthSegments,e.heightSegments)}},Yj=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,Jj=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,Kj=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,Qj=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,eW=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,tW=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,iW=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,nW=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,rW=`#ifdef USE_BATCHING
	attribute float batchId;
	uniform highp sampler2D batchingTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,sW=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( batchId );
#endif`,oW=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,aW=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,lW=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,cW=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,hW=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,dW=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,uW=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,pW=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,fW=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,mW=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,gW=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,_W=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,yW=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,vW=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,xW=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,bW=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,wW=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,SW=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,TW=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,MW=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,EW="gl_FragColor = linearToOutputTexel( gl_FragColor );",AW=`
const mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(
	vec3( 0.8224621, 0.177538, 0.0 ),
	vec3( 0.0331941, 0.9668058, 0.0 ),
	vec3( 0.0170827, 0.0723974, 0.9105199 )
);
const mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(
	vec3( 1.2249401, - 0.2249404, 0.0 ),
	vec3( - 0.0420569, 1.0420571, 0.0 ),
	vec3( - 0.0196376, - 0.0786361, 1.0982735 )
);
vec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {
	return vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );
}
vec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {
	return vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );
}
vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return sRGBTransferOETF( value );
}`,CW=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,IW=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,PW=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,RW=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,kW=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,DW=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,LW=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,FW=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,OW=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,NW=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,zW=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,BW=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,UW=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,VW=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,GW=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,HW=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,jW=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,WW=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,qW=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,XW=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,ZW=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,$W=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,YW=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,JW=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,KW=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,QW=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,eq=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,tq=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,iq=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,nq=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,rq=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,sq=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,oq=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,aq=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,lq=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,cq=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,hq=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,dq=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,uq=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,pq=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,fq=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,mq=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,gq=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,_q=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,yq=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,vq=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,xq=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,bq=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,wq=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,Sq=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,Tq=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,Mq=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,Eq=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,Aq=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,Cq=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,Iq=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,Pq=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,Rq=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,kq=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,Dq=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,Lq=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,Fq=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,Oq=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,Nq=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,zq=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,Bq=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,Uq=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,Vq=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,Gq=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,Hq=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,jq=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,Wq=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,qq=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,Xq=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,Zq=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,$q=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,Yq=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Jq=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,Kq=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Qq=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,eX=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,tX=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,iX=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,nX=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,rX=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,sX=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,oX=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,aX=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,lX=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,cX=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,hX=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,dX=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,uX=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,pX=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,fX=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,mX=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,gX=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,_X=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,yX=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vX=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,xX=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,bX=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,wX=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,SX=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,TX=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,MX=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,EX=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,AX=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,CX=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Tr={alphahash_fragment:Yj,alphahash_pars_fragment:Jj,alphamap_fragment:Kj,alphamap_pars_fragment:Qj,alphatest_fragment:eW,alphatest_pars_fragment:tW,aomap_fragment:iW,aomap_pars_fragment:nW,batching_pars_vertex:rW,batching_vertex:sW,begin_vertex:oW,beginnormal_vertex:aW,bsdfs:lW,iridescence_fragment:cW,bumpmap_pars_fragment:hW,clipping_planes_fragment:dW,clipping_planes_pars_fragment:uW,clipping_planes_pars_vertex:pW,clipping_planes_vertex:fW,color_fragment:mW,color_pars_fragment:gW,color_pars_vertex:_W,color_vertex:yW,common:vW,cube_uv_reflection_fragment:xW,defaultnormal_vertex:bW,displacementmap_pars_vertex:wW,displacementmap_vertex:SW,emissivemap_fragment:TW,emissivemap_pars_fragment:MW,colorspace_fragment:EW,colorspace_pars_fragment:AW,envmap_fragment:CW,envmap_common_pars_fragment:IW,envmap_pars_fragment:PW,envmap_pars_vertex:RW,envmap_physical_pars_fragment:HW,envmap_vertex:kW,fog_vertex:DW,fog_pars_vertex:LW,fog_fragment:FW,fog_pars_fragment:OW,gradientmap_pars_fragment:NW,lightmap_fragment:zW,lightmap_pars_fragment:BW,lights_lambert_fragment:UW,lights_lambert_pars_fragment:VW,lights_pars_begin:GW,lights_toon_fragment:jW,lights_toon_pars_fragment:WW,lights_phong_fragment:qW,lights_phong_pars_fragment:XW,lights_physical_fragment:ZW,lights_physical_pars_fragment:$W,lights_fragment_begin:YW,lights_fragment_maps:JW,lights_fragment_end:KW,logdepthbuf_fragment:QW,logdepthbuf_pars_fragment:eq,logdepthbuf_pars_vertex:tq,logdepthbuf_vertex:iq,map_fragment:nq,map_pars_fragment:rq,map_particle_fragment:sq,map_particle_pars_fragment:oq,metalnessmap_fragment:aq,metalnessmap_pars_fragment:lq,morphcolor_vertex:cq,morphnormal_vertex:hq,morphtarget_pars_vertex:dq,morphtarget_vertex:uq,normal_fragment_begin:pq,normal_fragment_maps:fq,normal_pars_fragment:mq,normal_pars_vertex:gq,normal_vertex:_q,normalmap_pars_fragment:yq,clearcoat_normal_fragment_begin:vq,clearcoat_normal_fragment_maps:xq,clearcoat_pars_fragment:bq,iridescence_pars_fragment:wq,opaque_fragment:Sq,packing:Tq,premultiplied_alpha_fragment:Mq,project_vertex:Eq,dithering_fragment:Aq,dithering_pars_fragment:Cq,roughnessmap_fragment:Iq,roughnessmap_pars_fragment:Pq,shadowmap_pars_fragment:Rq,shadowmap_pars_vertex:kq,shadowmap_vertex:Dq,shadowmask_pars_fragment:Lq,skinbase_vertex:Fq,skinning_pars_vertex:Oq,skinning_vertex:Nq,skinnormal_vertex:zq,specularmap_fragment:Bq,specularmap_pars_fragment:Uq,tonemapping_fragment:Vq,tonemapping_pars_fragment:Gq,transmission_fragment:Hq,transmission_pars_fragment:jq,uv_pars_fragment:Wq,uv_pars_vertex:qq,uv_vertex:Xq,worldpos_vertex:Zq,background_vert:$q,background_frag:Yq,backgroundCube_vert:Jq,backgroundCube_frag:Kq,cube_vert:Qq,cube_frag:eX,depth_vert:tX,depth_frag:iX,distanceRGBA_vert:nX,distanceRGBA_frag:rX,equirect_vert:sX,equirect_frag:oX,linedashed_vert:aX,linedashed_frag:lX,meshbasic_vert:cX,meshbasic_frag:hX,meshlambert_vert:dX,meshlambert_frag:uX,meshmatcap_vert:pX,meshmatcap_frag:fX,meshnormal_vert:mX,meshnormal_frag:gX,meshphong_vert:_X,meshphong_frag:yX,meshphysical_vert:vX,meshphysical_frag:xX,meshtoon_vert:bX,meshtoon_frag:wX,points_vert:SX,points_frag:TX,shadow_vert:MX,shadow_frag:EX,sprite_vert:AX,sprite_frag:CX},Ii={common:{diffuse:{value:new Er(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Bn},alphaMap:{value:null},alphaMapTransform:{value:new Bn},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Bn}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Bn}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Bn}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Bn},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Bn},normalScale:{value:new ui(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Bn},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Bn}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Bn}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Bn}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Er(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Er(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Bn},alphaTest:{value:0},uvTransform:{value:new Bn}},sprite:{diffuse:{value:new Er(16777215)},opacity:{value:1},center:{value:new ui(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Bn},alphaMap:{value:null},alphaMapTransform:{value:new Bn},alphaTest:{value:0}}},Zc={basic:{uniforms:ma([Ii.common,Ii.specularmap,Ii.envmap,Ii.aomap,Ii.lightmap,Ii.fog]),vertexShader:Tr.meshbasic_vert,fragmentShader:Tr.meshbasic_frag},lambert:{uniforms:ma([Ii.common,Ii.specularmap,Ii.envmap,Ii.aomap,Ii.lightmap,Ii.emissivemap,Ii.bumpmap,Ii.normalmap,Ii.displacementmap,Ii.fog,Ii.lights,{emissive:{value:new Er(0)}}]),vertexShader:Tr.meshlambert_vert,fragmentShader:Tr.meshlambert_frag},phong:{uniforms:ma([Ii.common,Ii.specularmap,Ii.envmap,Ii.aomap,Ii.lightmap,Ii.emissivemap,Ii.bumpmap,Ii.normalmap,Ii.displacementmap,Ii.fog,Ii.lights,{emissive:{value:new Er(0)},specular:{value:new Er(1118481)},shininess:{value:30}}]),vertexShader:Tr.meshphong_vert,fragmentShader:Tr.meshphong_frag},standard:{uniforms:ma([Ii.common,Ii.envmap,Ii.aomap,Ii.lightmap,Ii.emissivemap,Ii.bumpmap,Ii.normalmap,Ii.displacementmap,Ii.roughnessmap,Ii.metalnessmap,Ii.fog,Ii.lights,{emissive:{value:new Er(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Tr.meshphysical_vert,fragmentShader:Tr.meshphysical_frag},toon:{uniforms:ma([Ii.common,Ii.aomap,Ii.lightmap,Ii.emissivemap,Ii.bumpmap,Ii.normalmap,Ii.displacementmap,Ii.gradientmap,Ii.fog,Ii.lights,{emissive:{value:new Er(0)}}]),vertexShader:Tr.meshtoon_vert,fragmentShader:Tr.meshtoon_frag},matcap:{uniforms:ma([Ii.common,Ii.bumpmap,Ii.normalmap,Ii.displacementmap,Ii.fog,{matcap:{value:null}}]),vertexShader:Tr.meshmatcap_vert,fragmentShader:Tr.meshmatcap_frag},points:{uniforms:ma([Ii.points,Ii.fog]),vertexShader:Tr.points_vert,fragmentShader:Tr.points_frag},dashed:{uniforms:ma([Ii.common,Ii.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Tr.linedashed_vert,fragmentShader:Tr.linedashed_frag},depth:{uniforms:ma([Ii.common,Ii.displacementmap]),vertexShader:Tr.depth_vert,fragmentShader:Tr.depth_frag},normal:{uniforms:ma([Ii.common,Ii.bumpmap,Ii.normalmap,Ii.displacementmap,{opacity:{value:1}}]),vertexShader:Tr.meshnormal_vert,fragmentShader:Tr.meshnormal_frag},sprite:{uniforms:ma([Ii.sprite,Ii.fog]),vertexShader:Tr.sprite_vert,fragmentShader:Tr.sprite_frag},background:{uniforms:{uvTransform:{value:new Bn},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Tr.background_vert,fragmentShader:Tr.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:Tr.backgroundCube_vert,fragmentShader:Tr.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Tr.cube_vert,fragmentShader:Tr.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Tr.equirect_vert,fragmentShader:Tr.equirect_frag},distanceRGBA:{uniforms:ma([Ii.common,Ii.displacementmap,{referencePosition:{value:new mt},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Tr.distanceRGBA_vert,fragmentShader:Tr.distanceRGBA_frag},shadow:{uniforms:ma([Ii.lights,Ii.fog,{color:{value:new Er(0)},opacity:{value:1}}]),vertexShader:Tr.shadow_vert,fragmentShader:Tr.shadow_frag}};Zc.physical={uniforms:ma([Zc.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Bn},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Bn},clearcoatNormalScale:{value:new ui(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Bn},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Bn},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Bn},sheen:{value:0},sheenColor:{value:new Er(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Bn},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Bn},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Bn},transmissionSamplerSize:{value:new ui},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Bn},attenuationDistance:{value:0},attenuationColor:{value:new Er(0)},specularColor:{value:new Er(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Bn},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Bn},anisotropyVector:{value:new ui},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Bn}}]),vertexShader:Tr.meshphysical_vert,fragmentShader:Tr.meshphysical_frag};var q3={r:0,b:0,g:0};function IX(o,e,t,s,a,i,f){let v=new Er(0),x=i===!0?0:1,M,C,D=null,L=0,N=null;function j(G,H){let me=!1,ne=H.isScene===!0?H.background:null;ne&&ne.isTexture&&(ne=(H.backgroundBlurriness>0?t:e).get(ne)),ne===null?Z(v,x):ne&&ne.isColor&&(Z(ne,1),me=!0);let fe=o.xr.getEnvironmentBlendMode();fe==="additive"?s.buffers.color.setClear(0,0,0,1,f):fe==="alpha-blend"&&s.buffers.color.setClear(0,0,0,0,f),(o.autoClear||me)&&o.clear(o.autoClearColor,o.autoClearDepth,o.autoClearStencil),ne&&(ne.isCubeTexture||ne.mapping===E6)?(C===void 0&&(C=new dl(new $g(1,1,1),new lc({name:"BackgroundCubeMaterial",uniforms:cf(Zc.backgroundCube.uniforms),vertexShader:Zc.backgroundCube.vertexShader,fragmentShader:Zc.backgroundCube.fragmentShader,side:Ua,depthTest:!1,depthWrite:!1,fog:!1})),C.geometry.deleteAttribute("normal"),C.geometry.deleteAttribute("uv"),C.onBeforeRender=function(Ee,de,we){this.matrixWorld.copyPosition(we.matrixWorld)},Object.defineProperty(C.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),a.update(C)),C.material.uniforms.envMap.value=ne,C.material.uniforms.flipEnvMap.value=ne.isCubeTexture&&ne.isRenderTargetTexture===!1?-1:1,C.material.uniforms.backgroundBlurriness.value=H.backgroundBlurriness,C.material.uniforms.backgroundIntensity.value=H.backgroundIntensity,C.material.toneMapped=fs.getTransfer(ne.colorSpace)!==As,(D!==ne||L!==ne.version||N!==o.toneMapping)&&(C.material.needsUpdate=!0,D=ne,L=ne.version,N=o.toneMapping),C.layers.enableAll(),G.unshift(C,C.geometry,C.material,0,0,null)):ne&&ne.isTexture&&(M===void 0&&(M=new dl(new g6(2,2),new lc({name:"BackgroundMaterial",uniforms:cf(Zc.background.uniforms),vertexShader:Zc.background.vertexShader,fragmentShader:Zc.background.fragmentShader,side:cd,depthTest:!1,depthWrite:!1,fog:!1})),M.geometry.deleteAttribute("normal"),Object.defineProperty(M.material,"map",{get:function(){return this.uniforms.t2D.value}}),a.update(M)),M.material.uniforms.t2D.value=ne,M.material.uniforms.backgroundIntensity.value=H.backgroundIntensity,M.material.toneMapped=fs.getTransfer(ne.colorSpace)!==As,ne.matrixAutoUpdate===!0&&ne.updateMatrix(),M.material.uniforms.uvTransform.value.copy(ne.matrix),(D!==ne||L!==ne.version||N!==o.toneMapping)&&(M.material.needsUpdate=!0,D=ne,L=ne.version,N=o.toneMapping),M.layers.enableAll(),G.unshift(M,M.geometry,M.material,0,0,null))}function Z(G,H){G.getRGB(q3,LR(o)),s.buffers.color.setClear(q3.r,q3.g,q3.b,H,f)}return{getClearColor:function(){return v},setClearColor:function(G,H=1){v.set(G),x=H,Z(v,x)},getClearAlpha:function(){return x},setClearAlpha:function(G){x=G,Z(v,x)},render:j}}function PX(o,e,t,s){let a=o.getParameter(o.MAX_VERTEX_ATTRIBS),i=s.isWebGL2?null:e.get("OES_vertex_array_object"),f=s.isWebGL2||i!==null,v={},x=G(null),M=x,C=!1;function D(Ge,Xe,ht,Ot,bt){let Tt=!1;if(f){let Nt=Z(Ot,ht,Xe);M!==Nt&&(M=Nt,N(M.object)),Tt=H(Ge,Ot,ht,bt),Tt&&me(Ge,Ot,ht,bt)}else{let Nt=Xe.wireframe===!0;(M.geometry!==Ot.id||M.program!==ht.id||M.wireframe!==Nt)&&(M.geometry=Ot.id,M.program=ht.id,M.wireframe=Nt,Tt=!0)}bt!==null&&t.update(bt,o.ELEMENT_ARRAY_BUFFER),(Tt||C)&&(C=!1,Le(Ge,Xe,ht,Ot),bt!==null&&o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,t.get(bt).buffer))}function L(){return s.isWebGL2?o.createVertexArray():i.createVertexArrayOES()}function N(Ge){return s.isWebGL2?o.bindVertexArray(Ge):i.bindVertexArrayOES(Ge)}function j(Ge){return s.isWebGL2?o.deleteVertexArray(Ge):i.deleteVertexArrayOES(Ge)}function Z(Ge,Xe,ht){let Ot=ht.wireframe===!0,bt=v[Ge.id];bt===void 0&&(bt={},v[Ge.id]=bt);let Tt=bt[Xe.id];Tt===void 0&&(Tt={},bt[Xe.id]=Tt);let Nt=Tt[Ot];return Nt===void 0&&(Nt=G(L()),Tt[Ot]=Nt),Nt}function G(Ge){let Xe=[],ht=[],Ot=[];for(let bt=0;bt<a;bt++)Xe[bt]=0,ht[bt]=0,Ot[bt]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:Xe,enabledAttributes:ht,attributeDivisors:Ot,object:Ge,attributes:{},index:null}}function H(Ge,Xe,ht,Ot){let bt=M.attributes,Tt=Xe.attributes,Nt=0,Bt=ht.getAttributes();for(let Yt in Bt)if(Bt[Yt].location>=0){let wt=bt[Yt],ei=Tt[Yt];if(ei===void 0&&(Yt==="instanceMatrix"&&Ge.instanceMatrix&&(ei=Ge.instanceMatrix),Yt==="instanceColor"&&Ge.instanceColor&&(ei=Ge.instanceColor)),wt===void 0||wt.attribute!==ei||ei&&wt.data!==ei.data)return!0;Nt++}return M.attributesNum!==Nt||M.index!==Ot}function me(Ge,Xe,ht,Ot){let bt={},Tt=Xe.attributes,Nt=0,Bt=ht.getAttributes();for(let Yt in Bt)if(Bt[Yt].location>=0){let wt=Tt[Yt];wt===void 0&&(Yt==="instanceMatrix"&&Ge.instanceMatrix&&(wt=Ge.instanceMatrix),Yt==="instanceColor"&&Ge.instanceColor&&(wt=Ge.instanceColor));let ei={};ei.attribute=wt,wt&&wt.data&&(ei.data=wt.data),bt[Yt]=ei,Nt++}M.attributes=bt,M.attributesNum=Nt,M.index=Ot}function ne(){let Ge=M.newAttributes;for(let Xe=0,ht=Ge.length;Xe<ht;Xe++)Ge[Xe]=0}function fe(Ge){Ee(Ge,0)}function Ee(Ge,Xe){let ht=M.newAttributes,Ot=M.enabledAttributes,bt=M.attributeDivisors;ht[Ge]=1,Ot[Ge]===0&&(o.enableVertexAttribArray(Ge),Ot[Ge]=1),bt[Ge]!==Xe&&((s.isWebGL2?o:e.get("ANGLE_instanced_arrays"))[s.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](Ge,Xe),bt[Ge]=Xe)}function de(){let Ge=M.newAttributes,Xe=M.enabledAttributes;for(let ht=0,Ot=Xe.length;ht<Ot;ht++)Xe[ht]!==Ge[ht]&&(o.disableVertexAttribArray(ht),Xe[ht]=0)}function we(Ge,Xe,ht,Ot,bt,Tt,Nt){Nt===!0?o.vertexAttribIPointer(Ge,Xe,ht,bt,Tt):o.vertexAttribPointer(Ge,Xe,ht,Ot,bt,Tt)}function Le(Ge,Xe,ht,Ot){if(s.isWebGL2===!1&&(Ge.isInstancedMesh||Ot.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;ne();let bt=Ot.attributes,Tt=ht.getAttributes(),Nt=Xe.defaultAttributeValues;for(let Bt in Tt){let Yt=Tt[Bt];if(Yt.location>=0){let Wi=bt[Bt];if(Wi===void 0&&(Bt==="instanceMatrix"&&Ge.instanceMatrix&&(Wi=Ge.instanceMatrix),Bt==="instanceColor"&&Ge.instanceColor&&(Wi=Ge.instanceColor)),Wi!==void 0){let wt=Wi.normalized,ei=Wi.itemSize,vi=t.get(Wi);if(vi===void 0)continue;let Pi=vi.buffer,Fi=vi.type,Ri=vi.bytesPerElement,br=s.isWebGL2===!0&&(Fi===o.INT||Fi===o.UNSIGNED_INT||Wi.gpuType===SR);if(Wi.isInterleavedBufferAttribute){let Ui=Wi.data,st=Ui.stride,$r=Wi.offset;if(Ui.isInstancedInterleavedBuffer){for(let Ki=0;Ki<Yt.locationSize;Ki++)Ee(Yt.location+Ki,Ui.meshPerAttribute);Ge.isInstancedMesh!==!0&&Ot._maxInstanceCount===void 0&&(Ot._maxInstanceCount=Ui.meshPerAttribute*Ui.count)}else for(let Ki=0;Ki<Yt.locationSize;Ki++)fe(Yt.location+Ki);o.bindBuffer(o.ARRAY_BUFFER,Pi);for(let Ki=0;Ki<Yt.locationSize;Ki++)we(Yt.location+Ki,ei/Yt.locationSize,Fi,wt,st*Ri,($r+ei/Yt.locationSize*Ki)*Ri,br)}else{if(Wi.isInstancedBufferAttribute){for(let Ui=0;Ui<Yt.locationSize;Ui++)Ee(Yt.location+Ui,Wi.meshPerAttribute);Ge.isInstancedMesh!==!0&&Ot._maxInstanceCount===void 0&&(Ot._maxInstanceCount=Wi.meshPerAttribute*Wi.count)}else for(let Ui=0;Ui<Yt.locationSize;Ui++)fe(Yt.location+Ui);o.bindBuffer(o.ARRAY_BUFFER,Pi);for(let Ui=0;Ui<Yt.locationSize;Ui++)we(Yt.location+Ui,ei/Yt.locationSize,Fi,wt,ei*Ri,ei/Yt.locationSize*Ui*Ri,br)}}else if(Nt!==void 0){let wt=Nt[Bt];if(wt!==void 0)switch(wt.length){case 2:o.vertexAttrib2fv(Yt.location,wt);break;case 3:o.vertexAttrib3fv(Yt.location,wt);break;case 4:o.vertexAttrib4fv(Yt.location,wt);break;default:o.vertexAttrib1fv(Yt.location,wt)}}}}de()}function De(){Ne();for(let Ge in v){let Xe=v[Ge];for(let ht in Xe){let Ot=Xe[ht];for(let bt in Ot)j(Ot[bt].object),delete Ot[bt];delete Xe[ht]}delete v[Ge]}}function se(Ge){if(v[Ge.id]===void 0)return;let Xe=v[Ge.id];for(let ht in Xe){let Ot=Xe[ht];for(let bt in Ot)j(Ot[bt].object),delete Ot[bt];delete Xe[ht]}delete v[Ge.id]}function Ce(Ge){for(let Xe in v){let ht=v[Xe];if(ht[Ge.id]===void 0)continue;let Ot=ht[Ge.id];for(let bt in Ot)j(Ot[bt].object),delete Ot[bt];delete ht[Ge.id]}}function Ne(){zt(),C=!0,M!==x&&(M=x,N(M.object))}function zt(){x.geometry=null,x.program=null,x.wireframe=!1}return{setup:D,reset:Ne,resetDefaultState:zt,dispose:De,releaseStatesOfGeometry:se,releaseStatesOfProgram:Ce,initAttributes:ne,enableAttribute:fe,disableUnusedAttributes:de}}function RX(o,e,t,s){let a=s.isWebGL2,i;function f(C){i=C}function v(C,D){o.drawArrays(i,C,D),t.update(D,i,1)}function x(C,D,L){if(L===0)return;let N,j;if(a)N=o,j="drawArraysInstanced";else if(N=e.get("ANGLE_instanced_arrays"),j="drawArraysInstancedANGLE",N===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}N[j](i,C,D,L),t.update(D,i,L)}function M(C,D,L){if(L===0)return;let N=e.get("WEBGL_multi_draw");if(N===null)for(let j=0;j<L;j++)this.render(C[j],D[j]);else{N.multiDrawArraysWEBGL(i,C,0,D,0,L);let j=0;for(let Z=0;Z<L;Z++)j+=D[Z];t.update(j,i,1)}}this.setMode=f,this.render=v,this.renderInstances=x,this.renderMultiDraw=M}function kX(o,e,t){let s;function a(){if(s!==void 0)return s;if(e.has("EXT_texture_filter_anisotropic")===!0){let we=e.get("EXT_texture_filter_anisotropic");s=o.getParameter(we.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else s=0;return s}function i(we){if(we==="highp"){if(o.getShaderPrecisionFormat(o.VERTEX_SHADER,o.HIGH_FLOAT).precision>0&&o.getShaderPrecisionFormat(o.FRAGMENT_SHADER,o.HIGH_FLOAT).precision>0)return"highp";we="mediump"}return we==="mediump"&&o.getShaderPrecisionFormat(o.VERTEX_SHADER,o.MEDIUM_FLOAT).precision>0&&o.getShaderPrecisionFormat(o.FRAGMENT_SHADER,o.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let f=typeof WebGL2RenderingContext<"u"&&o.constructor.name==="WebGL2RenderingContext",v=t.precision!==void 0?t.precision:"highp",x=i(v);x!==v&&(console.warn("THREE.WebGLRenderer:",v,"not supported, using",x,"instead."),v=x);let M=f||e.has("WEBGL_draw_buffers"),C=t.logarithmicDepthBuffer===!0,D=o.getParameter(o.MAX_TEXTURE_IMAGE_UNITS),L=o.getParameter(o.MAX_VERTEX_TEXTURE_IMAGE_UNITS),N=o.getParameter(o.MAX_TEXTURE_SIZE),j=o.getParameter(o.MAX_CUBE_MAP_TEXTURE_SIZE),Z=o.getParameter(o.MAX_VERTEX_ATTRIBS),G=o.getParameter(o.MAX_VERTEX_UNIFORM_VECTORS),H=o.getParameter(o.MAX_VARYING_VECTORS),me=o.getParameter(o.MAX_FRAGMENT_UNIFORM_VECTORS),ne=L>0,fe=f||e.has("OES_texture_float"),Ee=ne&&fe,de=f?o.getParameter(o.MAX_SAMPLES):0;return{isWebGL2:f,drawBuffers:M,getMaxAnisotropy:a,getMaxPrecision:i,precision:v,logarithmicDepthBuffer:C,maxTextures:D,maxVertexTextures:L,maxTextureSize:N,maxCubemapSize:j,maxAttributes:Z,maxVertexUniforms:G,maxVaryings:H,maxFragmentUniforms:me,vertexTextures:ne,floatFragmentTextures:fe,floatVertexTextures:Ee,maxSamples:de}}function DX(o){let e=this,t=null,s=0,a=!1,i=!1,f=new B0,v=new Bn,x={value:null,needsUpdate:!1};this.uniform=x,this.numPlanes=0,this.numIntersection=0,this.init=function(D,L){let N=D.length!==0||L||s!==0||a;return a=L,s=D.length,N},this.beginShadows=function(){i=!0,C(null)},this.endShadows=function(){i=!1},this.setGlobalState=function(D,L){t=C(D,L,0)},this.setState=function(D,L,N){let j=D.clippingPlanes,Z=D.clipIntersection,G=D.clipShadows,H=o.get(D);if(!a||j===null||j.length===0||i&&!G)i?C(null):M();else{let me=i?0:s,ne=me*4,fe=H.clippingState||null;x.value=fe,fe=C(j,L,ne,N);for(let Ee=0;Ee!==ne;++Ee)fe[Ee]=t[Ee];H.clippingState=fe,this.numIntersection=Z?this.numPlanes:0,this.numPlanes+=me}};function M(){x.value!==t&&(x.value=t,x.needsUpdate=s>0),e.numPlanes=s,e.numIntersection=0}function C(D,L,N,j){let Z=D!==null?D.length:0,G=null;if(Z!==0){if(G=x.value,j!==!0||G===null){let H=N+Z*4,me=L.matrixWorldInverse;v.getNormalMatrix(me),(G===null||G.length<H)&&(G=new Float32Array(H));for(let ne=0,fe=N;ne!==Z;++ne,fe+=4)f.copy(D[ne]).applyMatrix4(me,v),f.normal.toArray(G,fe),G[fe+3]=f.constant}x.value=G,x.needsUpdate=!0}return e.numPlanes=Z,e.numIntersection=0,G}}function LX(o){let e=new WeakMap;function t(f,v){return v===Wb?f.mapping=of:v===qb&&(f.mapping=af),f}function s(f){if(f&&f.isTexture){let v=f.mapping;if(v===Wb||v===qb)if(e.has(f)){let x=e.get(f).texture;return t(x,f.mapping)}else{let x=f.image;if(x&&x.height>0){let M=new i7(x.height);return M.fromEquirectangularTexture(o,f),e.set(f,M),f.addEventListener("dispose",a),t(M.texture,f.mapping)}else return null}}return f}function a(f){let v=f.target;v.removeEventListener("dispose",a);let x=e.get(v);x!==void 0&&(e.delete(v),x.dispose())}function i(){e=new WeakMap}return{get:s,dispose:i}}var Yg=class extends p6{constructor(e=-1,t=1,s=1,a=-1,i=.1,f=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=s,this.bottom=a,this.near=i,this.far=f,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,s,a,i,f){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=s,this.view.offsetY=a,this.view.width=i,this.view.height=f,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),s=(this.right+this.left)/2,a=(this.top+this.bottom)/2,i=s-e,f=s+e,v=a+t,x=a-t;if(this.view!==null&&this.view.enabled){let M=(this.right-this.left)/this.view.fullWidth/this.zoom,C=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i+=M*this.view.offsetX,f=i+M*this.view.width,v-=C*this.view.offsetY,x=v-C*this.view.height}this.projectionMatrix.makeOrthographic(i,f,v,x,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}},Q1=4,qP=[.125,.215,.35,.446,.526,.582],Nu=20,Nb=new Yg,XP=new Er,zb=null,Bb=0,Ub=0,Fu=(1+Math.sqrt(5))/2,J1=1/Fu,ZP=[new mt(1,1,1),new mt(-1,1,1),new mt(1,1,-1),new mt(-1,1,-1),new mt(0,Fu,J1),new mt(0,Fu,-J1),new mt(J1,0,Fu),new mt(-J1,0,Fu),new mt(Fu,J1,0),new mt(-Fu,J1,0)],_6=class{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,s=.1,a=100){zb=this._renderer.getRenderTarget(),Bb=this._renderer.getActiveCubeFace(),Ub=this._renderer.getActiveMipmapLevel(),this._setSize(256);let i=this._allocateTargets();return i.depthBuffer=!0,this._sceneToCubeUV(e,s,a,i),t>0&&this._blur(i,0,0,t),this._applyPMREM(i),this._cleanup(i),i}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=JP(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=YP(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(zb,Bb,Ub),e.scissorTest=!1,X3(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===of||e.mapping===af?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),zb=this._renderer.getRenderTarget(),Bb=this._renderer.getActiveCubeFace(),Ub=this._renderer.getActiveMipmapLevel();let s=t||this._allocateTargets();return this._textureToCubeUV(e,s),this._applyPMREM(s),this._cleanup(s),s}_allocateTargets(){let e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,s={magFilter:Ba,minFilter:Ba,generateMipmaps:!1,type:qg,format:rc,colorSpace:G0,depthBuffer:!1},a=$P(e,t,s);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=$P(e,t,s);let{_lodMax:i}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=FX(i)),this._blurMaterial=OX(i,e,t)}return a}_compileMaterial(e){let t=new dl(this._lodPlanes[0],e);this._renderer.compile(t,Nb)}_sceneToCubeUV(e,t,s,a){let v=new hl(90,1,t,s),x=[1,-1,1,1,1,1],M=[1,1,1,-1,-1,-1],C=this._renderer,D=C.autoClear,L=C.toneMapping;C.getClearColor(XP),C.toneMapping=od,C.autoClear=!1;let N=new h6({name:"PMREM.Background",side:Ua,depthWrite:!1,depthTest:!1}),j=new dl(new $g,N),Z=!1,G=e.background;G?G.isColor&&(N.color.copy(G),e.background=null,Z=!0):(N.color.copy(XP),Z=!0);for(let H=0;H<6;H++){let me=H%3;me===0?(v.up.set(0,x[H],0),v.lookAt(M[H],0,0)):me===1?(v.up.set(0,0,x[H]),v.lookAt(0,M[H],0)):(v.up.set(0,x[H],0),v.lookAt(0,0,M[H]));let ne=this._cubeSize;X3(a,me*ne,H>2?ne:0,ne,ne),C.setRenderTarget(a),Z&&C.render(j,v),C.render(e,v)}j.geometry.dispose(),j.material.dispose(),C.toneMapping=L,C.autoClear=D,e.background=G}_textureToCubeUV(e,t){let s=this._renderer,a=e.mapping===of||e.mapping===af;a?(this._cubemapMaterial===null&&(this._cubemapMaterial=JP()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=YP());let i=a?this._cubemapMaterial:this._equirectMaterial,f=new dl(this._lodPlanes[0],i),v=i.uniforms;v.envMap.value=e;let x=this._cubeSize;X3(t,0,0,3*x,2*x),s.setRenderTarget(t),s.render(f,Nb)}_applyPMREM(e){let t=this._renderer,s=t.autoClear;t.autoClear=!1;for(let a=1;a<this._lodPlanes.length;a++){let i=Math.sqrt(this._sigmas[a]*this._sigmas[a]-this._sigmas[a-1]*this._sigmas[a-1]),f=ZP[(a-1)%ZP.length];this._blur(e,a-1,a,i,f)}t.autoClear=s}_blur(e,t,s,a,i){let f=this._pingPongRenderTarget;this._halfBlur(e,f,t,s,a,"latitudinal",i),this._halfBlur(f,e,s,s,a,"longitudinal",i)}_halfBlur(e,t,s,a,i,f,v){let x=this._renderer,M=this._blurMaterial;f!=="latitudinal"&&f!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");let C=3,D=new dl(this._lodPlanes[a],M),L=M.uniforms,N=this._sizeLods[s]-1,j=isFinite(i)?Math.PI/(2*N):2*Math.PI/(2*Nu-1),Z=i/j,G=isFinite(i)?1+Math.floor(C*Z):Nu;G>Nu&&console.warn(`sigmaRadians, ${i}, is too large and will clip, as it requested ${G} samples when the maximum is set to ${Nu}`);let H=[],me=0;for(let we=0;we<Nu;++we){let Le=we/Z,De=Math.exp(-Le*Le/2);H.push(De),we===0?me+=De:we<G&&(me+=2*De)}for(let we=0;we<H.length;we++)H[we]=H[we]/me;L.envMap.value=e.texture,L.samples.value=G,L.weights.value=H,L.latitudinal.value=f==="latitudinal",v&&(L.poleAxis.value=v);let{_lodMax:ne}=this;L.dTheta.value=j,L.mipInt.value=ne-s;let fe=this._sizeLods[a],Ee=3*fe*(a>ne-Q1?a-ne+Q1:0),de=4*(this._cubeSize-fe);X3(t,Ee,de,3*fe,2*fe),x.setRenderTarget(t),x.render(D,Nb)}};function FX(o){let e=[],t=[],s=[],a=o,i=o-Q1+1+qP.length;for(let f=0;f<i;f++){let v=Math.pow(2,a);t.push(v);let x=1/v;f>o-Q1?x=qP[f-o+Q1-1]:f===0&&(x=0),s.push(x);let M=1/(v-2),C=-M,D=1+M,L=[C,C,D,C,D,D,C,C,D,D,C,D],N=6,j=6,Z=3,G=2,H=1,me=new Float32Array(Z*j*N),ne=new Float32Array(G*j*N),fe=new Float32Array(H*j*N);for(let de=0;de<N;de++){let we=de%3*2/3-1,Le=de>2?0:-1,De=[we,Le,0,we+2/3,Le,0,we+2/3,Le+1,0,we,Le,0,we+2/3,Le+1,0,we,Le+1,0];me.set(De,Z*j*de),ne.set(L,G*j*de);let se=[de,de,de,de,de,de];fe.set(se,H*j*de)}let Ee=new Cl;Ee.setAttribute("position",new Ro(me,Z)),Ee.setAttribute("uv",new Ro(ne,G)),Ee.setAttribute("faceIndex",new Ro(fe,H)),e.push(Ee),a>Q1&&a--}return{lodPlanes:e,sizeLods:t,sigmas:s}}function $P(o,e,t){let s=new H0(o,e,t);return s.texture.mapping=E6,s.texture.name="PMREM.cubeUv",s.scissorTest=!0,s}function X3(o,e,t,s,a){o.viewport.set(e,t,s,a),o.scissor.set(e,t,s,a)}function OX(o,e,t){let s=new Float32Array(Nu),a=new mt(0,1,0);return new lc({name:"SphericalGaussianBlur",defines:{n:Nu,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${o}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:s},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:a}},vertexShader:R7(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:sd,depthTest:!1,depthWrite:!1})}function YP(){return new lc({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:R7(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:sd,depthTest:!1,depthWrite:!1})}function JP(){return new lc({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:R7(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:sd,depthTest:!1,depthWrite:!1})}function R7(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function NX(o){let e=new WeakMap,t=null;function s(v){if(v&&v.isTexture){let x=v.mapping,M=x===Wb||x===qb,C=x===of||x===af;if(M||C)if(v.isRenderTargetTexture&&v.needsPMREMUpdate===!0){v.needsPMREMUpdate=!1;let D=e.get(v);return t===null&&(t=new _6(o)),D=M?t.fromEquirectangular(v,D):t.fromCubemap(v,D),e.set(v,D),D.texture}else{if(e.has(v))return e.get(v).texture;{let D=v.image;if(M&&D&&D.height>0||C&&D&&a(D)){t===null&&(t=new _6(o));let L=M?t.fromEquirectangular(v):t.fromCubemap(v);return e.set(v,L),v.addEventListener("dispose",i),L.texture}else return null}}}return v}function a(v){let x=0,M=6;for(let C=0;C<M;C++)v[C]!==void 0&&x++;return x===M}function i(v){let x=v.target;x.removeEventListener("dispose",i);let M=e.get(x);M!==void 0&&(e.delete(x),M.dispose())}function f(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:s,dispose:f}}function zX(o){let e={};function t(s){if(e[s]!==void 0)return e[s];let a;switch(s){case"WEBGL_depth_texture":a=o.getExtension("WEBGL_depth_texture")||o.getExtension("MOZ_WEBGL_depth_texture")||o.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":a=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":a=o.getExtension("WEBGL_compressed_texture_s3tc")||o.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||o.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":a=o.getExtension("WEBGL_compressed_texture_pvrtc")||o.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:a=o.getExtension(s)}return e[s]=a,a}return{has:function(s){return t(s)!==null},init:function(s){s.isWebGL2?(t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance")):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(s){let a=t(s);return a===null&&console.warn("THREE.WebGLRenderer: "+s+" extension not supported."),a}}}function BX(o,e,t,s){let a={},i=new WeakMap;function f(D){let L=D.target;L.index!==null&&e.remove(L.index);for(let j in L.attributes)e.remove(L.attributes[j]);for(let j in L.morphAttributes){let Z=L.morphAttributes[j];for(let G=0,H=Z.length;G<H;G++)e.remove(Z[G])}L.removeEventListener("dispose",f),delete a[L.id];let N=i.get(L);N&&(e.remove(N),i.delete(L)),s.releaseStatesOfGeometry(L),L.isInstancedBufferGeometry===!0&&delete L._maxInstanceCount,t.memory.geometries--}function v(D,L){return a[L.id]===!0||(L.addEventListener("dispose",f),a[L.id]=!0,t.memory.geometries++),L}function x(D){let L=D.attributes;for(let j in L)e.update(L[j],o.ARRAY_BUFFER);let N=D.morphAttributes;for(let j in N){let Z=N[j];for(let G=0,H=Z.length;G<H;G++)e.update(Z[G],o.ARRAY_BUFFER)}}function M(D){let L=[],N=D.index,j=D.attributes.position,Z=0;if(N!==null){let me=N.array;Z=N.version;for(let ne=0,fe=me.length;ne<fe;ne+=3){let Ee=me[ne+0],de=me[ne+1],we=me[ne+2];L.push(Ee,de,de,we,we,Ee)}}else if(j!==void 0){let me=j.array;Z=j.version;for(let ne=0,fe=me.length/3-1;ne<fe;ne+=3){let Ee=ne+0,de=ne+1,we=ne+2;L.push(Ee,de,de,we,we,Ee)}}else return;let G=new(kR(L)?u6:d6)(L,1);G.version=Z;let H=i.get(D);H&&e.remove(H),i.set(D,G)}function C(D){let L=i.get(D);if(L){let N=D.index;N!==null&&L.version<N.version&&M(D)}else M(D);return i.get(D)}return{get:v,update:x,getWireframeAttribute:C}}function UX(o,e,t,s){let a=s.isWebGL2,i;function f(N){i=N}let v,x;function M(N){v=N.type,x=N.bytesPerElement}function C(N,j){o.drawElements(i,j,v,N*x),t.update(j,i,1)}function D(N,j,Z){if(Z===0)return;let G,H;if(a)G=o,H="drawElementsInstanced";else if(G=e.get("ANGLE_instanced_arrays"),H="drawElementsInstancedANGLE",G===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}G[H](i,j,v,N*x,Z),t.update(j,i,Z)}function L(N,j,Z){if(Z===0)return;let G=e.get("WEBGL_multi_draw");if(G===null)for(let H=0;H<Z;H++)this.render(N[H]/x,j[H]);else{G.multiDrawElementsWEBGL(i,j,0,v,N,0,Z);let H=0;for(let me=0;me<Z;me++)H+=j[me];t.update(H,i,1)}}this.setMode=f,this.setIndex=M,this.render=C,this.renderInstances=D,this.renderMultiDraw=L}function VX(o){let e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function s(i,f,v){switch(t.calls++,f){case o.TRIANGLES:t.triangles+=v*(i/3);break;case o.LINES:t.lines+=v*(i/2);break;case o.LINE_STRIP:t.lines+=v*(i-1);break;case o.LINE_LOOP:t.lines+=v*i;break;case o.POINTS:t.points+=v*i;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",f);break}}function a(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:a,update:s}}function GX(o,e){return o[0]-e[0]}function HX(o,e){return Math.abs(e[1])-Math.abs(o[1])}function jX(o,e,t){let s={},a=new Float32Array(8),i=new WeakMap,f=new Uo,v=[];for(let M=0;M<8;M++)v[M]=[M,0];function x(M,C,D){let L=M.morphTargetInfluences;if(e.isWebGL2===!0){let j=C.morphAttributes.position||C.morphAttributes.normal||C.morphAttributes.color,Z=j!==void 0?j.length:0,G=i.get(C);if(G===void 0||G.count!==Z){let Xe=function(){zt.dispose(),i.delete(C),C.removeEventListener("dispose",Xe)};var N=Xe;G!==void 0&&G.texture.dispose();let ne=C.morphAttributes.position!==void 0,fe=C.morphAttributes.normal!==void 0,Ee=C.morphAttributes.color!==void 0,de=C.morphAttributes.position||[],we=C.morphAttributes.normal||[],Le=C.morphAttributes.color||[],De=0;ne===!0&&(De=1),fe===!0&&(De=2),Ee===!0&&(De=3);let se=C.attributes.position.count*De,Ce=1;se>e.maxTextureSize&&(Ce=Math.ceil(se/e.maxTextureSize),se=e.maxTextureSize);let Ne=new Float32Array(se*Ce*4*Z),zt=new l6(Ne,se,Ce,Z);zt.type=U0,zt.needsUpdate=!0;let Ge=De*4;for(let ht=0;ht<Z;ht++){let Ot=de[ht],bt=we[ht],Tt=Le[ht],Nt=se*Ce*4*ht;for(let Bt=0;Bt<Ot.count;Bt++){let Yt=Bt*Ge;ne===!0&&(f.fromBufferAttribute(Ot,Bt),Ne[Nt+Yt+0]=f.x,Ne[Nt+Yt+1]=f.y,Ne[Nt+Yt+2]=f.z,Ne[Nt+Yt+3]=0),fe===!0&&(f.fromBufferAttribute(bt,Bt),Ne[Nt+Yt+4]=f.x,Ne[Nt+Yt+5]=f.y,Ne[Nt+Yt+6]=f.z,Ne[Nt+Yt+7]=0),Ee===!0&&(f.fromBufferAttribute(Tt,Bt),Ne[Nt+Yt+8]=f.x,Ne[Nt+Yt+9]=f.y,Ne[Nt+Yt+10]=f.z,Ne[Nt+Yt+11]=Tt.itemSize===4?f.w:1)}}G={count:Z,texture:zt,size:new ui(se,Ce)},i.set(C,G),C.addEventListener("dispose",Xe)}let H=0;for(let ne=0;ne<L.length;ne++)H+=L[ne];let me=C.morphTargetsRelative?1:1-H;D.getUniforms().setValue(o,"morphTargetBaseInfluence",me),D.getUniforms().setValue(o,"morphTargetInfluences",L),D.getUniforms().setValue(o,"morphTargetsTexture",G.texture,t),D.getUniforms().setValue(o,"morphTargetsTextureSize",G.size)}else{let j=L===void 0?0:L.length,Z=s[C.id];if(Z===void 0||Z.length!==j){Z=[];for(let fe=0;fe<j;fe++)Z[fe]=[fe,0];s[C.id]=Z}for(let fe=0;fe<j;fe++){let Ee=Z[fe];Ee[0]=fe,Ee[1]=L[fe]}Z.sort(HX);for(let fe=0;fe<8;fe++)fe<j&&Z[fe][1]?(v[fe][0]=Z[fe][0],v[fe][1]=Z[fe][1]):(v[fe][0]=Number.MAX_SAFE_INTEGER,v[fe][1]=0);v.sort(GX);let G=C.morphAttributes.position,H=C.morphAttributes.normal,me=0;for(let fe=0;fe<8;fe++){let Ee=v[fe],de=Ee[0],we=Ee[1];de!==Number.MAX_SAFE_INTEGER&&we?(G&&C.getAttribute("morphTarget"+fe)!==G[de]&&C.setAttribute("morphTarget"+fe,G[de]),H&&C.getAttribute("morphNormal"+fe)!==H[de]&&C.setAttribute("morphNormal"+fe,H[de]),a[fe]=we,me+=we):(G&&C.hasAttribute("morphTarget"+fe)===!0&&C.deleteAttribute("morphTarget"+fe),H&&C.hasAttribute("morphNormal"+fe)===!0&&C.deleteAttribute("morphNormal"+fe),a[fe]=0)}let ne=C.morphTargetsRelative?1:1-me;D.getUniforms().setValue(o,"morphTargetBaseInfluence",ne),D.getUniforms().setValue(o,"morphTargetInfluences",a)}}return{update:x}}function WX(o,e,t,s){let a=new WeakMap;function i(x){let M=s.render.frame,C=x.geometry,D=e.get(x,C);if(a.get(D)!==M&&(e.update(D),a.set(D,M)),x.isInstancedMesh&&(x.hasEventListener("dispose",v)===!1&&x.addEventListener("dispose",v),a.get(x)!==M&&(t.update(x.instanceMatrix,o.ARRAY_BUFFER),x.instanceColor!==null&&t.update(x.instanceColor,o.ARRAY_BUFFER),a.set(x,M))),x.isSkinnedMesh){let L=x.skeleton;a.get(L)!==M&&(L.update(),a.set(L,M))}return D}function f(){a=new WeakMap}function v(x){let M=x.target;M.removeEventListener("dispose",v),t.remove(M.instanceMatrix),M.instanceColor!==null&&t.remove(M.instanceColor)}return{update:i,dispose:f}}var y6=class extends Xu{constructor(e,t,s,a,i,f,v,x,M,C){if(C=C!==void 0?C:Uu,C!==Uu&&C!==lf)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");s===void 0&&C===Uu&&(s=rd),s===void 0&&C===lf&&(s=Bu),super(null,a,i,f,v,x,C,s,M),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=v!==void 0?v:ga,this.minFilter=x!==void 0?x:ga,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){let t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}},OR=new Xu,NR=new y6(1,1);NR.compareFunction=RR;var zR=new l6,BR=new e7,UR=new f6,KP=[],QP=[],eR=new Float32Array(16),tR=new Float32Array(9),iR=new Float32Array(4);function df(o,e,t){let s=o[0];if(s<=0||s>0)return o;let a=e*t,i=KP[a];if(i===void 0&&(i=new Float32Array(a),KP[a]=i),e!==0){s.toArray(i,0);for(let f=1,v=0;f!==e;++f)v+=t,o[f].toArray(i,v)}return i}function xo(o,e){if(o.length!==e.length)return!1;for(let t=0,s=o.length;t<s;t++)if(o[t]!==e[t])return!1;return!0}function bo(o,e){for(let t=0,s=e.length;t<s;t++)o[t]=e[t]}function C6(o,e){let t=QP[e];t===void 0&&(t=new Int32Array(e),QP[e]=t);for(let s=0;s!==e;++s)t[s]=o.allocateTextureUnit();return t}function qX(o,e){let t=this.cache;t[0]!==e&&(o.uniform1f(this.addr,e),t[0]=e)}function XX(o,e){let t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(o.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(xo(t,e))return;o.uniform2fv(this.addr,e),bo(t,e)}}function ZX(o,e){let t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(o.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(o.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(xo(t,e))return;o.uniform3fv(this.addr,e),bo(t,e)}}function $X(o,e){let t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(o.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(xo(t,e))return;o.uniform4fv(this.addr,e),bo(t,e)}}function YX(o,e){let t=this.cache,s=e.elements;if(s===void 0){if(xo(t,e))return;o.uniformMatrix2fv(this.addr,!1,e),bo(t,e)}else{if(xo(t,s))return;iR.set(s),o.uniformMatrix2fv(this.addr,!1,iR),bo(t,s)}}function JX(o,e){let t=this.cache,s=e.elements;if(s===void 0){if(xo(t,e))return;o.uniformMatrix3fv(this.addr,!1,e),bo(t,e)}else{if(xo(t,s))return;tR.set(s),o.uniformMatrix3fv(this.addr,!1,tR),bo(t,s)}}function KX(o,e){let t=this.cache,s=e.elements;if(s===void 0){if(xo(t,e))return;o.uniformMatrix4fv(this.addr,!1,e),bo(t,e)}else{if(xo(t,s))return;eR.set(s),o.uniformMatrix4fv(this.addr,!1,eR),bo(t,s)}}function QX(o,e){let t=this.cache;t[0]!==e&&(o.uniform1i(this.addr,e),t[0]=e)}function eZ(o,e){let t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(o.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(xo(t,e))return;o.uniform2iv(this.addr,e),bo(t,e)}}function tZ(o,e){let t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(o.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(xo(t,e))return;o.uniform3iv(this.addr,e),bo(t,e)}}function iZ(o,e){let t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(o.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(xo(t,e))return;o.uniform4iv(this.addr,e),bo(t,e)}}function nZ(o,e){let t=this.cache;t[0]!==e&&(o.uniform1ui(this.addr,e),t[0]=e)}function rZ(o,e){let t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(o.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(xo(t,e))return;o.uniform2uiv(this.addr,e),bo(t,e)}}function sZ(o,e){let t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(o.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(xo(t,e))return;o.uniform3uiv(this.addr,e),bo(t,e)}}function oZ(o,e){let t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(o.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(xo(t,e))return;o.uniform4uiv(this.addr,e),bo(t,e)}}function aZ(o,e,t){let s=this.cache,a=t.allocateTextureUnit();s[0]!==a&&(o.uniform1i(this.addr,a),s[0]=a);let i=this.type===o.SAMPLER_2D_SHADOW?NR:OR;t.setTexture2D(e||i,a)}function lZ(o,e,t){let s=this.cache,a=t.allocateTextureUnit();s[0]!==a&&(o.uniform1i(this.addr,a),s[0]=a),t.setTexture3D(e||BR,a)}function cZ(o,e,t){let s=this.cache,a=t.allocateTextureUnit();s[0]!==a&&(o.uniform1i(this.addr,a),s[0]=a),t.setTextureCube(e||UR,a)}function hZ(o,e,t){let s=this.cache,a=t.allocateTextureUnit();s[0]!==a&&(o.uniform1i(this.addr,a),s[0]=a),t.setTexture2DArray(e||zR,a)}function dZ(o){switch(o){case 5126:return qX;case 35664:return XX;case 35665:return ZX;case 35666:return $X;case 35674:return YX;case 35675:return JX;case 35676:return KX;case 5124:case 35670:return QX;case 35667:case 35671:return eZ;case 35668:case 35672:return tZ;case 35669:case 35673:return iZ;case 5125:return nZ;case 36294:return rZ;case 36295:return sZ;case 36296:return oZ;case 35678:case 36198:case 36298:case 36306:case 35682:return aZ;case 35679:case 36299:case 36307:return lZ;case 35680:case 36300:case 36308:case 36293:return cZ;case 36289:case 36303:case 36311:case 36292:return hZ}}function uZ(o,e){o.uniform1fv(this.addr,e)}function pZ(o,e){let t=df(e,this.size,2);o.uniform2fv(this.addr,t)}function fZ(o,e){let t=df(e,this.size,3);o.uniform3fv(this.addr,t)}function mZ(o,e){let t=df(e,this.size,4);o.uniform4fv(this.addr,t)}function gZ(o,e){let t=df(e,this.size,4);o.uniformMatrix2fv(this.addr,!1,t)}function _Z(o,e){let t=df(e,this.size,9);o.uniformMatrix3fv(this.addr,!1,t)}function yZ(o,e){let t=df(e,this.size,16);o.uniformMatrix4fv(this.addr,!1,t)}function vZ(o,e){o.uniform1iv(this.addr,e)}function xZ(o,e){o.uniform2iv(this.addr,e)}function bZ(o,e){o.uniform3iv(this.addr,e)}function wZ(o,e){o.uniform4iv(this.addr,e)}function SZ(o,e){o.uniform1uiv(this.addr,e)}function TZ(o,e){o.uniform2uiv(this.addr,e)}function MZ(o,e){o.uniform3uiv(this.addr,e)}function EZ(o,e){o.uniform4uiv(this.addr,e)}function AZ(o,e,t){let s=this.cache,a=e.length,i=C6(t,a);xo(s,i)||(o.uniform1iv(this.addr,i),bo(s,i));for(let f=0;f!==a;++f)t.setTexture2D(e[f]||OR,i[f])}function CZ(o,e,t){let s=this.cache,a=e.length,i=C6(t,a);xo(s,i)||(o.uniform1iv(this.addr,i),bo(s,i));for(let f=0;f!==a;++f)t.setTexture3D(e[f]||BR,i[f])}function IZ(o,e,t){let s=this.cache,a=e.length,i=C6(t,a);xo(s,i)||(o.uniform1iv(this.addr,i),bo(s,i));for(let f=0;f!==a;++f)t.setTextureCube(e[f]||UR,i[f])}function PZ(o,e,t){let s=this.cache,a=e.length,i=C6(t,a);xo(s,i)||(o.uniform1iv(this.addr,i),bo(s,i));for(let f=0;f!==a;++f)t.setTexture2DArray(e[f]||zR,i[f])}function RZ(o){switch(o){case 5126:return uZ;case 35664:return pZ;case 35665:return fZ;case 35666:return mZ;case 35674:return gZ;case 35675:return _Z;case 35676:return yZ;case 5124:case 35670:return vZ;case 35667:case 35671:return xZ;case 35668:case 35672:return bZ;case 35669:case 35673:return wZ;case 5125:return SZ;case 36294:return TZ;case 36295:return MZ;case 36296:return EZ;case 35678:case 36198:case 36298:case 36306:case 35682:return AZ;case 35679:case 36299:case 36307:return CZ;case 35680:case 36300:case 36308:case 36293:return IZ;case 36289:case 36303:case 36311:case 36292:return PZ}}var n7=class{constructor(e,t,s){this.id=e,this.addr=s,this.cache=[],this.type=t.type,this.setValue=dZ(t.type)}},r7=class{constructor(e,t,s){this.id=e,this.addr=s,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=RZ(t.type)}},s7=class{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,s){let a=this.seq;for(let i=0,f=a.length;i!==f;++i){let v=a[i];v.setValue(e,t[v.id],s)}}},Vb=/(\w+)(\])?(\[|\.)?/g;function nR(o,e){o.seq.push(e),o.map[e.id]=e}function kZ(o,e,t){let s=o.name,a=s.length;for(Vb.lastIndex=0;;){let i=Vb.exec(s),f=Vb.lastIndex,v=i[1],x=i[2]==="]",M=i[3];if(x&&(v=v|0),M===void 0||M==="["&&f+2===a){nR(t,M===void 0?new n7(v,o,e):new r7(v,o,e));break}else{let D=t.map[v];D===void 0&&(D=new s7(v),nR(t,D)),t=D}}}var sf=class{constructor(e,t){this.seq=[],this.map={};let s=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let a=0;a<s;++a){let i=e.getActiveUniform(t,a),f=e.getUniformLocation(t,i.name);kZ(i,f,this)}}setValue(e,t,s,a){let i=this.map[t];i!==void 0&&i.setValue(e,s,a)}setOptional(e,t,s){let a=t[s];a!==void 0&&this.setValue(e,s,a)}static upload(e,t,s,a){for(let i=0,f=t.length;i!==f;++i){let v=t[i],x=s[v.id];x.needsUpdate!==!1&&v.setValue(e,x.value,a)}}static seqWithValue(e,t){let s=[];for(let a=0,i=e.length;a!==i;++a){let f=e[a];f.id in t&&s.push(f)}return s}};function rR(o,e,t){let s=o.createShader(e);return o.shaderSource(s,t),o.compileShader(s),s}var DZ=37297,LZ=0;function FZ(o,e){let t=o.split(`
`),s=[],a=Math.max(e-6,0),i=Math.min(e+6,t.length);for(let f=a;f<i;f++){let v=f+1;s.push(`${v===e?">":" "} ${v}: ${t[f]}`)}return s.join(`
`)}function OZ(o){let e=fs.getPrimaries(fs.workingColorSpace),t=fs.getPrimaries(o),s;switch(e===t?s="":e===n6&&t===i6?s="LinearDisplayP3ToLinearSRGB":e===i6&&t===n6&&(s="LinearSRGBToLinearDisplayP3"),o){case G0:case A6:return[s,"LinearTransferOETF"];case Bo:case P7:return[s,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",o),[s,"LinearTransferOETF"]}}function sR(o,e,t){let s=o.getShaderParameter(e,o.COMPILE_STATUS),a=o.getShaderInfoLog(e).trim();if(s&&a==="")return"";let i=/ERROR: 0:(\d+)/.exec(a);if(i){let f=parseInt(i[1]);return t.toUpperCase()+`

`+a+`

`+FZ(o.getShaderSource(e),f)}else return a}function NZ(o,e){let t=OZ(e);return`vec4 ${o}( vec4 value ) { return ${t[0]}( ${t[1]}( value ) ); }`}function zZ(o,e){let t;switch(e){case tj:t="Linear";break;case ij:t="Reinhard";break;case nj:t="OptimizedCineon";break;case rj:t="ACESFilmic";break;case oj:t="AgX";break;case sj:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+o+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function BZ(o){return[o.extensionDerivatives||o.envMapCubeUVHeight||o.bumpMap||o.normalMapTangentSpace||o.clearcoatNormalMap||o.flatShading||o.alphaToCoverage||o.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(o.extensionFragDepth||o.logarithmicDepthBuffer)&&o.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",o.extensionDrawBuffers&&o.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(o.extensionShaderTextureLOD||o.envMap||o.transmission)&&o.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(ef).join(`
`)}function UZ(o){return[o.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",o.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(ef).join(`
`)}function VZ(o){let e=[];for(let t in o){let s=o[t];s!==!1&&e.push("#define "+t+" "+s)}return e.join(`
`)}function GZ(o,e){let t={},s=o.getProgramParameter(e,o.ACTIVE_ATTRIBUTES);for(let a=0;a<s;a++){let i=o.getActiveAttrib(e,a),f=i.name,v=1;i.type===o.FLOAT_MAT2&&(v=2),i.type===o.FLOAT_MAT3&&(v=3),i.type===o.FLOAT_MAT4&&(v=4),t[f]={type:i.type,location:o.getAttribLocation(e,f),locationSize:v}}return t}function ef(o){return o!==""}function oR(o,e){let t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return o.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function aR(o,e){return o.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}var HZ=/^[ \t]*#include +<([\w\d./]+)>/gm;function o7(o){return o.replace(HZ,WZ)}var jZ=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function WZ(o,e){let t=Tr[e];if(t===void 0){let s=jZ.get(e);if(s!==void 0)t=Tr[s],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,s);else throw new Error("Can not resolve #include <"+e+">")}return o7(t)}var qZ=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function lR(o){return o.replace(qZ,XZ)}function XZ(o,e,t,s){let a="";for(let i=parseInt(e);i<parseInt(t);i++)a+=s.replace(/\[\s*i\s*\]/g,"[ "+i+" ]").replace(/UNROLLED_LOOP_INDEX/g,i);return a}function cR(o){let e=`precision ${o.precision} float;
	precision ${o.precision} int;
	precision ${o.precision} sampler2D;
	precision ${o.precision} samplerCube;
	`;return o.isWebGL2&&(e+=`precision ${o.precision} sampler3D;
		precision ${o.precision} sampler2DArray;
		precision ${o.precision} sampler2DShadow;
		precision ${o.precision} samplerCubeShadow;
		precision ${o.precision} sampler2DArrayShadow;
		precision ${o.precision} isampler2D;
		precision ${o.precision} isampler3D;
		precision ${o.precision} isamplerCube;
		precision ${o.precision} isampler2DArray;
		precision ${o.precision} usampler2D;
		precision ${o.precision} usampler3D;
		precision ${o.precision} usamplerCube;
		precision ${o.precision} usampler2DArray;
		`),o.precision==="highp"?e+=`
#define HIGH_PRECISION`:o.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:o.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function ZZ(o){let e="SHADOWMAP_TYPE_BASIC";return o.shadowMapType===bR?e="SHADOWMAP_TYPE_PCF":o.shadowMapType===IH?e="SHADOWMAP_TYPE_PCF_SOFT":o.shadowMapType===z0&&(e="SHADOWMAP_TYPE_VSM"),e}function $Z(o){let e="ENVMAP_TYPE_CUBE";if(o.envMap)switch(o.envMapMode){case of:case af:e="ENVMAP_TYPE_CUBE";break;case E6:e="ENVMAP_TYPE_CUBE_UV";break}return e}function YZ(o){let e="ENVMAP_MODE_REFLECTION";if(o.envMap)switch(o.envMapMode){case af:e="ENVMAP_MODE_REFRACTION";break}return e}function JZ(o){let e="ENVMAP_BLENDING_NONE";if(o.envMap)switch(o.combine){case wR:e="ENVMAP_BLENDING_MULTIPLY";break;case QH:e="ENVMAP_BLENDING_MIX";break;case ej:e="ENVMAP_BLENDING_ADD";break}return e}function KZ(o){let e=o.envMapCubeUVHeight;if(e===null)return null;let t=Math.log2(e)-2,s=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:s,maxMip:t}}function QZ(o,e,t,s){let a=o.getContext(),i=t.defines,f=t.vertexShader,v=t.fragmentShader,x=ZZ(t),M=$Z(t),C=YZ(t),D=JZ(t),L=KZ(t),N=t.isWebGL2?"":BZ(t),j=UZ(t),Z=VZ(i),G=a.createProgram(),H,me,ne=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(H=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,Z].filter(ef).join(`
`),H.length>0&&(H+=`
`),me=[N,"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,Z].filter(ef).join(`
`),me.length>0&&(me+=`
`)):(H=[cR(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,Z,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+C:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors&&t.isWebGL2?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+x:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(ef).join(`
`),me=[N,cR(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,Z,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+M:"",t.envMap?"#define "+C:"",t.envMap?"#define "+D:"",L?"#define CUBEUV_TEXEL_WIDTH "+L.texelWidth:"",L?"#define CUBEUV_TEXEL_HEIGHT "+L.texelHeight:"",L?"#define CUBEUV_MAX_MIP "+L.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+x:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==od?"#define TONE_MAPPING":"",t.toneMapping!==od?Tr.tonemapping_pars_fragment:"",t.toneMapping!==od?zZ("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",Tr.colorspace_pars_fragment,NZ("linearToOutputTexel",t.outputColorSpace),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(ef).join(`
`)),f=o7(f),f=oR(f,t),f=aR(f,t),v=o7(v),v=oR(v,t),v=aR(v,t),f=lR(f),v=lR(v),t.isWebGL2&&t.isRawShaderMaterial!==!0&&(ne=`#version 300 es
`,H=[j,"precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+H,me=["precision mediump sampler2DArray;","#define varying in",t.glslVersion===Xg?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===Xg?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+me);let fe=ne+H+f,Ee=ne+me+v,de=rR(a,a.VERTEX_SHADER,fe),we=rR(a,a.FRAGMENT_SHADER,Ee);a.attachShader(G,de),a.attachShader(G,we),t.index0AttributeName!==void 0?a.bindAttribLocation(G,0,t.index0AttributeName):t.morphTargets===!0&&a.bindAttribLocation(G,0,"position"),a.linkProgram(G);function Le(Ne){if(o.debug.checkShaderErrors){let zt=a.getProgramInfoLog(G).trim(),Ge=a.getShaderInfoLog(de).trim(),Xe=a.getShaderInfoLog(we).trim(),ht=!0,Ot=!0;if(a.getProgramParameter(G,a.LINK_STATUS)===!1)if(ht=!1,typeof o.debug.onShaderError=="function")o.debug.onShaderError(a,G,de,we);else{let bt=sR(a,de,"vertex"),Tt=sR(a,we,"fragment");console.error("THREE.WebGLProgram: Shader Error "+a.getError()+" - VALIDATE_STATUS "+a.getProgramParameter(G,a.VALIDATE_STATUS)+`

Material Name: `+Ne.name+`
Material Type: `+Ne.type+`

Program Info Log: `+zt+`
`+bt+`
`+Tt)}else zt!==""?console.warn("THREE.WebGLProgram: Program Info Log:",zt):(Ge===""||Xe==="")&&(Ot=!1);Ot&&(Ne.diagnostics={runnable:ht,programLog:zt,vertexShader:{log:Ge,prefix:H},fragmentShader:{log:Xe,prefix:me}})}a.deleteShader(de),a.deleteShader(we),De=new sf(a,G),se=GZ(a,G)}let De;this.getUniforms=function(){return De===void 0&&Le(this),De};let se;this.getAttributes=function(){return se===void 0&&Le(this),se};let Ce=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return Ce===!1&&(Ce=a.getProgramParameter(G,DZ)),Ce},this.destroy=function(){s.releaseStatesOfProgram(this),a.deleteProgram(G),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=LZ++,this.cacheKey=e,this.usedTimes=1,this.program=G,this.vertexShader=de,this.fragmentShader=we,this}var e$=0,a7=class{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){let t=e.vertexShader,s=e.fragmentShader,a=this._getShaderStage(t),i=this._getShaderStage(s),f=this._getShaderCacheForMaterial(e);return f.has(a)===!1&&(f.add(a),a.usedTimes++),f.has(i)===!1&&(f.add(i),i.usedTimes++),this}remove(e){let t=this.materialCache.get(e);for(let s of t)s.usedTimes--,s.usedTimes===0&&this.shaderCache.delete(s.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){let t=this.materialCache,s=t.get(e);return s===void 0&&(s=new Set,t.set(e,s)),s}_getShaderStage(e){let t=this.shaderCache,s=t.get(e);return s===void 0&&(s=new l7(e),t.set(e,s)),s}},l7=class{constructor(e){this.id=e$++,this.code=e,this.usedTimes=0}};function t$(o,e,t,s,a,i,f){let v=new c6,x=new a7,M=new Set,C=[],D=a.isWebGL2,L=a.logarithmicDepthBuffer,N=a.vertexTextures,j=a.precision,Z={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function G(se){return M.add(se),se===0?"uv":`uv${se}`}function H(se,Ce,Ne,zt,Ge){let Xe=zt.fog,ht=Ge.geometry,Ot=se.isMeshStandardMaterial?zt.environment:null,bt=(se.isMeshStandardMaterial?t:e).get(se.envMap||Ot),Tt=bt&&bt.mapping===E6?bt.image.height:null,Nt=Z[se.type];se.precision!==null&&(j=a.getMaxPrecision(se.precision),j!==se.precision&&console.warn("THREE.WebGLProgram.getParameters:",se.precision,"not supported, using",j,"instead."));let Bt=ht.morphAttributes.position||ht.morphAttributes.normal||ht.morphAttributes.color,Yt=Bt!==void 0?Bt.length:0,Wi=0;ht.morphAttributes.position!==void 0&&(Wi=1),ht.morphAttributes.normal!==void 0&&(Wi=2),ht.morphAttributes.color!==void 0&&(Wi=3);let wt,ei,vi,Pi;if(Nt){let fr=Zc[Nt];wt=fr.vertexShader,ei=fr.fragmentShader}else wt=se.vertexShader,ei=se.fragmentShader,x.update(se),vi=x.getVertexShaderID(se),Pi=x.getFragmentShaderID(se);let Fi=o.getRenderTarget(),Ri=Ge.isInstancedMesh===!0,br=Ge.isBatchedMesh===!0,Ui=!!se.map,st=!!se.matcap,$r=!!bt,Ki=!!se.aoMap,yn=!!se.lightMap,Qi=!!se.bumpMap,Gn=!!se.normalMap,Fn=!!se.displacementMap,Ie=!!se.emissiveMap,be=!!se.metalnessMap,_t=!!se.roughnessMap,li=se.anisotropy>0,ze=se.clearcoat>0,te=se.iridescence>0,he=se.sheen>0,Se=se.transmission>0,He=li&&!!se.anisotropyMap,Ye=ze&&!!se.clearcoatMap,at=ze&&!!se.clearcoatNormalMap,ye=ze&&!!se.clearcoatRoughnessMap,Ve=te&&!!se.iridescenceMap,pt=te&&!!se.iridescenceThicknessMap,ut=he&&!!se.sheenColorMap,St=he&&!!se.sheenRoughnessMap,Vt=!!se.specularMap,Mi=!!se.specularColorMap,en=!!se.specularIntensityMap,Oi=Se&&!!se.transmissionMap,yi=Se&&!!se.thicknessMap,Vi=!!se.gradientMap,Pe=!!se.alphaMap,Zt=se.alphaTest>0,ni=!!se.alphaHash,gi=!!se.extensions,qi=od;se.toneMapped&&(Fi===null||Fi.isXRRenderTarget===!0)&&(qi=o.toneMapping);let $n={isWebGL2:D,shaderID:Nt,shaderType:se.type,shaderName:se.name,vertexShader:wt,fragmentShader:ei,defines:se.defines,customVertexShaderID:vi,customFragmentShaderID:Pi,isRawShaderMaterial:se.isRawShaderMaterial===!0,glslVersion:se.glslVersion,precision:j,batching:br,instancing:Ri,instancingColor:Ri&&Ge.instanceColor!==null,supportsVertexTextures:N,outputColorSpace:Fi===null?o.outputColorSpace:Fi.isXRRenderTarget===!0?Fi.texture.colorSpace:G0,alphaToCoverage:!!se.alphaToCoverage,map:Ui,matcap:st,envMap:$r,envMapMode:$r&&bt.mapping,envMapCubeUVHeight:Tt,aoMap:Ki,lightMap:yn,bumpMap:Qi,normalMap:Gn,displacementMap:N&&Fn,emissiveMap:Ie,normalMapObjectSpace:Gn&&se.normalMapType===yj,normalMapTangentSpace:Gn&&se.normalMapType===_j,metalnessMap:be,roughnessMap:_t,anisotropy:li,anisotropyMap:He,clearcoat:ze,clearcoatMap:Ye,clearcoatNormalMap:at,clearcoatRoughnessMap:ye,iridescence:te,iridescenceMap:Ve,iridescenceThicknessMap:pt,sheen:he,sheenColorMap:ut,sheenRoughnessMap:St,specularMap:Vt,specularColorMap:Mi,specularIntensityMap:en,transmission:Se,transmissionMap:Oi,thicknessMap:yi,gradientMap:Vi,opaque:se.transparent===!1&&se.blending===nf&&se.alphaToCoverage===!1,alphaMap:Pe,alphaTest:Zt,alphaHash:ni,combine:se.combine,mapUv:Ui&&G(se.map.channel),aoMapUv:Ki&&G(se.aoMap.channel),lightMapUv:yn&&G(se.lightMap.channel),bumpMapUv:Qi&&G(se.bumpMap.channel),normalMapUv:Gn&&G(se.normalMap.channel),displacementMapUv:Fn&&G(se.displacementMap.channel),emissiveMapUv:Ie&&G(se.emissiveMap.channel),metalnessMapUv:be&&G(se.metalnessMap.channel),roughnessMapUv:_t&&G(se.roughnessMap.channel),anisotropyMapUv:He&&G(se.anisotropyMap.channel),clearcoatMapUv:Ye&&G(se.clearcoatMap.channel),clearcoatNormalMapUv:at&&G(se.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:ye&&G(se.clearcoatRoughnessMap.channel),iridescenceMapUv:Ve&&G(se.iridescenceMap.channel),iridescenceThicknessMapUv:pt&&G(se.iridescenceThicknessMap.channel),sheenColorMapUv:ut&&G(se.sheenColorMap.channel),sheenRoughnessMapUv:St&&G(se.sheenRoughnessMap.channel),specularMapUv:Vt&&G(se.specularMap.channel),specularColorMapUv:Mi&&G(se.specularColorMap.channel),specularIntensityMapUv:en&&G(se.specularIntensityMap.channel),transmissionMapUv:Oi&&G(se.transmissionMap.channel),thicknessMapUv:yi&&G(se.thicknessMap.channel),alphaMapUv:Pe&&G(se.alphaMap.channel),vertexTangents:!!ht.attributes.tangent&&(Gn||li),vertexColors:se.vertexColors,vertexAlphas:se.vertexColors===!0&&!!ht.attributes.color&&ht.attributes.color.itemSize===4,pointsUvs:Ge.isPoints===!0&&!!ht.attributes.uv&&(Ui||Pe),fog:!!Xe,useFog:se.fog===!0,fogExp2:!!Xe&&Xe.isFogExp2,flatShading:se.flatShading===!0,sizeAttenuation:se.sizeAttenuation===!0,logarithmicDepthBuffer:L,skinning:Ge.isSkinnedMesh===!0,morphTargets:ht.morphAttributes.position!==void 0,morphNormals:ht.morphAttributes.normal!==void 0,morphColors:ht.morphAttributes.color!==void 0,morphTargetsCount:Yt,morphTextureStride:Wi,numDirLights:Ce.directional.length,numPointLights:Ce.point.length,numSpotLights:Ce.spot.length,numSpotLightMaps:Ce.spotLightMap.length,numRectAreaLights:Ce.rectArea.length,numHemiLights:Ce.hemi.length,numDirLightShadows:Ce.directionalShadowMap.length,numPointLightShadows:Ce.pointShadowMap.length,numSpotLightShadows:Ce.spotShadowMap.length,numSpotLightShadowsWithMaps:Ce.numSpotLightShadowsWithMaps,numLightProbes:Ce.numLightProbes,numClippingPlanes:f.numPlanes,numClipIntersection:f.numIntersection,dithering:se.dithering,shadowMapEnabled:o.shadowMap.enabled&&Ne.length>0,shadowMapType:o.shadowMap.type,toneMapping:qi,useLegacyLights:o._useLegacyLights,decodeVideoTexture:Ui&&se.map.isVideoTexture===!0&&fs.getTransfer(se.map.colorSpace)===As,premultipliedAlpha:se.premultipliedAlpha,doubleSided:se.side===ic,flipSided:se.side===Ua,useDepthPacking:se.depthPacking>=0,depthPacking:se.depthPacking||0,index0AttributeName:se.index0AttributeName,extensionDerivatives:gi&&se.extensions.derivatives===!0,extensionFragDepth:gi&&se.extensions.fragDepth===!0,extensionDrawBuffers:gi&&se.extensions.drawBuffers===!0,extensionShaderTextureLOD:gi&&se.extensions.shaderTextureLOD===!0,extensionClipCullDistance:gi&&se.extensions.clipCullDistance===!0&&s.has("WEBGL_clip_cull_distance"),extensionMultiDraw:gi&&se.extensions.multiDraw===!0&&s.has("WEBGL_multi_draw"),rendererExtensionFragDepth:D||s.has("EXT_frag_depth"),rendererExtensionDrawBuffers:D||s.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:D||s.has("EXT_shader_texture_lod"),rendererExtensionParallelShaderCompile:s.has("KHR_parallel_shader_compile"),customProgramCacheKey:se.customProgramCacheKey()};return $n.vertexUv1s=M.has(1),$n.vertexUv2s=M.has(2),$n.vertexUv3s=M.has(3),M.clear(),$n}function me(se){let Ce=[];if(se.shaderID?Ce.push(se.shaderID):(Ce.push(se.customVertexShaderID),Ce.push(se.customFragmentShaderID)),se.defines!==void 0)for(let Ne in se.defines)Ce.push(Ne),Ce.push(se.defines[Ne]);return se.isRawShaderMaterial===!1&&(ne(Ce,se),fe(Ce,se),Ce.push(o.outputColorSpace)),Ce.push(se.customProgramCacheKey),Ce.join()}function ne(se,Ce){se.push(Ce.precision),se.push(Ce.outputColorSpace),se.push(Ce.envMapMode),se.push(Ce.envMapCubeUVHeight),se.push(Ce.mapUv),se.push(Ce.alphaMapUv),se.push(Ce.lightMapUv),se.push(Ce.aoMapUv),se.push(Ce.bumpMapUv),se.push(Ce.normalMapUv),se.push(Ce.displacementMapUv),se.push(Ce.emissiveMapUv),se.push(Ce.metalnessMapUv),se.push(Ce.roughnessMapUv),se.push(Ce.anisotropyMapUv),se.push(Ce.clearcoatMapUv),se.push(Ce.clearcoatNormalMapUv),se.push(Ce.clearcoatRoughnessMapUv),se.push(Ce.iridescenceMapUv),se.push(Ce.iridescenceThicknessMapUv),se.push(Ce.sheenColorMapUv),se.push(Ce.sheenRoughnessMapUv),se.push(Ce.specularMapUv),se.push(Ce.specularColorMapUv),se.push(Ce.specularIntensityMapUv),se.push(Ce.transmissionMapUv),se.push(Ce.thicknessMapUv),se.push(Ce.combine),se.push(Ce.fogExp2),se.push(Ce.sizeAttenuation),se.push(Ce.morphTargetsCount),se.push(Ce.morphAttributeCount),se.push(Ce.numDirLights),se.push(Ce.numPointLights),se.push(Ce.numSpotLights),se.push(Ce.numSpotLightMaps),se.push(Ce.numHemiLights),se.push(Ce.numRectAreaLights),se.push(Ce.numDirLightShadows),se.push(Ce.numPointLightShadows),se.push(Ce.numSpotLightShadows),se.push(Ce.numSpotLightShadowsWithMaps),se.push(Ce.numLightProbes),se.push(Ce.shadowMapType),se.push(Ce.toneMapping),se.push(Ce.numClippingPlanes),se.push(Ce.numClipIntersection),se.push(Ce.depthPacking)}function fe(se,Ce){v.disableAll(),Ce.isWebGL2&&v.enable(0),Ce.supportsVertexTextures&&v.enable(1),Ce.instancing&&v.enable(2),Ce.instancingColor&&v.enable(3),Ce.matcap&&v.enable(4),Ce.envMap&&v.enable(5),Ce.normalMapObjectSpace&&v.enable(6),Ce.normalMapTangentSpace&&v.enable(7),Ce.clearcoat&&v.enable(8),Ce.iridescence&&v.enable(9),Ce.alphaTest&&v.enable(10),Ce.vertexColors&&v.enable(11),Ce.vertexAlphas&&v.enable(12),Ce.vertexUv1s&&v.enable(13),Ce.vertexUv2s&&v.enable(14),Ce.vertexUv3s&&v.enable(15),Ce.vertexTangents&&v.enable(16),Ce.anisotropy&&v.enable(17),Ce.alphaHash&&v.enable(18),Ce.batching&&v.enable(19),se.push(v.mask),v.disableAll(),Ce.fog&&v.enable(0),Ce.useFog&&v.enable(1),Ce.flatShading&&v.enable(2),Ce.logarithmicDepthBuffer&&v.enable(3),Ce.skinning&&v.enable(4),Ce.morphTargets&&v.enable(5),Ce.morphNormals&&v.enable(6),Ce.morphColors&&v.enable(7),Ce.premultipliedAlpha&&v.enable(8),Ce.shadowMapEnabled&&v.enable(9),Ce.useLegacyLights&&v.enable(10),Ce.doubleSided&&v.enable(11),Ce.flipSided&&v.enable(12),Ce.useDepthPacking&&v.enable(13),Ce.dithering&&v.enable(14),Ce.transmission&&v.enable(15),Ce.sheen&&v.enable(16),Ce.opaque&&v.enable(17),Ce.pointsUvs&&v.enable(18),Ce.decodeVideoTexture&&v.enable(19),Ce.alphaToCoverage&&v.enable(20),se.push(v.mask)}function Ee(se){let Ce=Z[se.type],Ne;if(Ce){let zt=Zc[Ce];Ne=jj.clone(zt.uniforms)}else Ne=se.uniforms;return Ne}function de(se,Ce){let Ne;for(let zt=0,Ge=C.length;zt<Ge;zt++){let Xe=C[zt];if(Xe.cacheKey===Ce){Ne=Xe,++Ne.usedTimes;break}}return Ne===void 0&&(Ne=new QZ(o,Ce,se,i),C.push(Ne)),Ne}function we(se){if(--se.usedTimes===0){let Ce=C.indexOf(se);C[Ce]=C[C.length-1],C.pop(),se.destroy()}}function Le(se){x.remove(se)}function De(){x.dispose()}return{getParameters:H,getProgramCacheKey:me,getUniforms:Ee,acquireProgram:de,releaseProgram:we,releaseShaderCache:Le,programs:C,dispose:De}}function i$(){let o=new WeakMap;function e(i){let f=o.get(i);return f===void 0&&(f={},o.set(i,f)),f}function t(i){o.delete(i)}function s(i,f,v){o.get(i)[f]=v}function a(){o=new WeakMap}return{get:e,remove:t,update:s,dispose:a}}function n$(o,e){return o.groupOrder!==e.groupOrder?o.groupOrder-e.groupOrder:o.renderOrder!==e.renderOrder?o.renderOrder-e.renderOrder:o.material.id!==e.material.id?o.material.id-e.material.id:o.z!==e.z?o.z-e.z:o.id-e.id}function hR(o,e){return o.groupOrder!==e.groupOrder?o.groupOrder-e.groupOrder:o.renderOrder!==e.renderOrder?o.renderOrder-e.renderOrder:o.z!==e.z?e.z-o.z:o.id-e.id}function dR(){let o=[],e=0,t=[],s=[],a=[];function i(){e=0,t.length=0,s.length=0,a.length=0}function f(D,L,N,j,Z,G){let H=o[e];return H===void 0?(H={id:D.id,object:D,geometry:L,material:N,groupOrder:j,renderOrder:D.renderOrder,z:Z,group:G},o[e]=H):(H.id=D.id,H.object=D,H.geometry=L,H.material=N,H.groupOrder=j,H.renderOrder=D.renderOrder,H.z=Z,H.group=G),e++,H}function v(D,L,N,j,Z,G){let H=f(D,L,N,j,Z,G);N.transmission>0?s.push(H):N.transparent===!0?a.push(H):t.push(H)}function x(D,L,N,j,Z,G){let H=f(D,L,N,j,Z,G);N.transmission>0?s.unshift(H):N.transparent===!0?a.unshift(H):t.unshift(H)}function M(D,L){t.length>1&&t.sort(D||n$),s.length>1&&s.sort(L||hR),a.length>1&&a.sort(L||hR)}function C(){for(let D=e,L=o.length;D<L;D++){let N=o[D];if(N.id===null)break;N.id=null,N.object=null,N.geometry=null,N.material=null,N.group=null}}return{opaque:t,transmissive:s,transparent:a,init:i,push:v,unshift:x,finish:C,sort:M}}function r$(){let o=new WeakMap;function e(s,a){let i=o.get(s),f;return i===void 0?(f=new dR,o.set(s,[f])):a>=i.length?(f=new dR,i.push(f)):f=i[a],f}function t(){o=new WeakMap}return{get:e,dispose:t}}function s$(){let o={};return{get:function(e){if(o[e.id]!==void 0)return o[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new mt,color:new Er};break;case"SpotLight":t={position:new mt,direction:new mt,color:new Er,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new mt,color:new Er,distance:0,decay:0};break;case"HemisphereLight":t={direction:new mt,skyColor:new Er,groundColor:new Er};break;case"RectAreaLight":t={color:new Er,position:new mt,halfWidth:new mt,halfHeight:new mt};break}return o[e.id]=t,t}}}function o$(){let o={};return{get:function(e){if(o[e.id]!==void 0)return o[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ui};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ui};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ui,shadowCameraNear:1,shadowCameraFar:1e3};break}return o[e.id]=t,t}}}var a$=0;function l$(o,e){return(e.castShadow?2:0)-(o.castShadow?2:0)+(e.map?1:0)-(o.map?1:0)}function c$(o,e){let t=new s$,s=o$(),a={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let C=0;C<9;C++)a.probe.push(new mt);let i=new mt,f=new Po,v=new Po;function x(C,D){let L=0,N=0,j=0;for(let Ne=0;Ne<9;Ne++)a.probe[Ne].set(0,0,0);let Z=0,G=0,H=0,me=0,ne=0,fe=0,Ee=0,de=0,we=0,Le=0,De=0;C.sort(l$);let se=D===!0?Math.PI:1;for(let Ne=0,zt=C.length;Ne<zt;Ne++){let Ge=C[Ne],Xe=Ge.color,ht=Ge.intensity,Ot=Ge.distance,bt=Ge.shadow&&Ge.shadow.map?Ge.shadow.map.texture:null;if(Ge.isAmbientLight)L+=Xe.r*ht*se,N+=Xe.g*ht*se,j+=Xe.b*ht*se;else if(Ge.isLightProbe){for(let Tt=0;Tt<9;Tt++)a.probe[Tt].addScaledVector(Ge.sh.coefficients[Tt],ht);De++}else if(Ge.isDirectionalLight){let Tt=t.get(Ge);if(Tt.color.copy(Ge.color).multiplyScalar(Ge.intensity*se),Ge.castShadow){let Nt=Ge.shadow,Bt=s.get(Ge);Bt.shadowBias=Nt.bias,Bt.shadowNormalBias=Nt.normalBias,Bt.shadowRadius=Nt.radius,Bt.shadowMapSize=Nt.mapSize,a.directionalShadow[Z]=Bt,a.directionalShadowMap[Z]=bt,a.directionalShadowMatrix[Z]=Ge.shadow.matrix,fe++}a.directional[Z]=Tt,Z++}else if(Ge.isSpotLight){let Tt=t.get(Ge);Tt.position.setFromMatrixPosition(Ge.matrixWorld),Tt.color.copy(Xe).multiplyScalar(ht*se),Tt.distance=Ot,Tt.coneCos=Math.cos(Ge.angle),Tt.penumbraCos=Math.cos(Ge.angle*(1-Ge.penumbra)),Tt.decay=Ge.decay,a.spot[H]=Tt;let Nt=Ge.shadow;if(Ge.map&&(a.spotLightMap[we]=Ge.map,we++,Nt.updateMatrices(Ge),Ge.castShadow&&Le++),a.spotLightMatrix[H]=Nt.matrix,Ge.castShadow){let Bt=s.get(Ge);Bt.shadowBias=Nt.bias,Bt.shadowNormalBias=Nt.normalBias,Bt.shadowRadius=Nt.radius,Bt.shadowMapSize=Nt.mapSize,a.spotShadow[H]=Bt,a.spotShadowMap[H]=bt,de++}H++}else if(Ge.isRectAreaLight){let Tt=t.get(Ge);Tt.color.copy(Xe).multiplyScalar(ht),Tt.halfWidth.set(Ge.width*.5,0,0),Tt.halfHeight.set(0,Ge.height*.5,0),a.rectArea[me]=Tt,me++}else if(Ge.isPointLight){let Tt=t.get(Ge);if(Tt.color.copy(Ge.color).multiplyScalar(Ge.intensity*se),Tt.distance=Ge.distance,Tt.decay=Ge.decay,Ge.castShadow){let Nt=Ge.shadow,Bt=s.get(Ge);Bt.shadowBias=Nt.bias,Bt.shadowNormalBias=Nt.normalBias,Bt.shadowRadius=Nt.radius,Bt.shadowMapSize=Nt.mapSize,Bt.shadowCameraNear=Nt.camera.near,Bt.shadowCameraFar=Nt.camera.far,a.pointShadow[G]=Bt,a.pointShadowMap[G]=bt,a.pointShadowMatrix[G]=Ge.shadow.matrix,Ee++}a.point[G]=Tt,G++}else if(Ge.isHemisphereLight){let Tt=t.get(Ge);Tt.skyColor.copy(Ge.color).multiplyScalar(ht*se),Tt.groundColor.copy(Ge.groundColor).multiplyScalar(ht*se),a.hemi[ne]=Tt,ne++}}me>0&&(e.isWebGL2?o.has("OES_texture_float_linear")===!0?(a.rectAreaLTC1=Ii.LTC_FLOAT_1,a.rectAreaLTC2=Ii.LTC_FLOAT_2):(a.rectAreaLTC1=Ii.LTC_HALF_1,a.rectAreaLTC2=Ii.LTC_HALF_2):o.has("OES_texture_float_linear")===!0?(a.rectAreaLTC1=Ii.LTC_FLOAT_1,a.rectAreaLTC2=Ii.LTC_FLOAT_2):o.has("OES_texture_half_float_linear")===!0?(a.rectAreaLTC1=Ii.LTC_HALF_1,a.rectAreaLTC2=Ii.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),a.ambient[0]=L,a.ambient[1]=N,a.ambient[2]=j;let Ce=a.hash;(Ce.directionalLength!==Z||Ce.pointLength!==G||Ce.spotLength!==H||Ce.rectAreaLength!==me||Ce.hemiLength!==ne||Ce.numDirectionalShadows!==fe||Ce.numPointShadows!==Ee||Ce.numSpotShadows!==de||Ce.numSpotMaps!==we||Ce.numLightProbes!==De)&&(a.directional.length=Z,a.spot.length=H,a.rectArea.length=me,a.point.length=G,a.hemi.length=ne,a.directionalShadow.length=fe,a.directionalShadowMap.length=fe,a.pointShadow.length=Ee,a.pointShadowMap.length=Ee,a.spotShadow.length=de,a.spotShadowMap.length=de,a.directionalShadowMatrix.length=fe,a.pointShadowMatrix.length=Ee,a.spotLightMatrix.length=de+we-Le,a.spotLightMap.length=we,a.numSpotLightShadowsWithMaps=Le,a.numLightProbes=De,Ce.directionalLength=Z,Ce.pointLength=G,Ce.spotLength=H,Ce.rectAreaLength=me,Ce.hemiLength=ne,Ce.numDirectionalShadows=fe,Ce.numPointShadows=Ee,Ce.numSpotShadows=de,Ce.numSpotMaps=we,Ce.numLightProbes=De,a.version=a$++)}function M(C,D){let L=0,N=0,j=0,Z=0,G=0,H=D.matrixWorldInverse;for(let me=0,ne=C.length;me<ne;me++){let fe=C[me];if(fe.isDirectionalLight){let Ee=a.directional[L];Ee.direction.setFromMatrixPosition(fe.matrixWorld),i.setFromMatrixPosition(fe.target.matrixWorld),Ee.direction.sub(i),Ee.direction.transformDirection(H),L++}else if(fe.isSpotLight){let Ee=a.spot[j];Ee.position.setFromMatrixPosition(fe.matrixWorld),Ee.position.applyMatrix4(H),Ee.direction.setFromMatrixPosition(fe.matrixWorld),i.setFromMatrixPosition(fe.target.matrixWorld),Ee.direction.sub(i),Ee.direction.transformDirection(H),j++}else if(fe.isRectAreaLight){let Ee=a.rectArea[Z];Ee.position.setFromMatrixPosition(fe.matrixWorld),Ee.position.applyMatrix4(H),v.identity(),f.copy(fe.matrixWorld),f.premultiply(H),v.extractRotation(f),Ee.halfWidth.set(fe.width*.5,0,0),Ee.halfHeight.set(0,fe.height*.5,0),Ee.halfWidth.applyMatrix4(v),Ee.halfHeight.applyMatrix4(v),Z++}else if(fe.isPointLight){let Ee=a.point[N];Ee.position.setFromMatrixPosition(fe.matrixWorld),Ee.position.applyMatrix4(H),N++}else if(fe.isHemisphereLight){let Ee=a.hemi[G];Ee.direction.setFromMatrixPosition(fe.matrixWorld),Ee.direction.transformDirection(H),G++}}}return{setup:x,setupView:M,state:a}}function uR(o,e){let t=new c$(o,e),s=[],a=[];function i(){s.length=0,a.length=0}function f(D){s.push(D)}function v(D){a.push(D)}function x(D){t.setup(s,D)}function M(D){t.setupView(s,D)}return{init:i,state:{lightsArray:s,shadowsArray:a,lights:t},setupLights:x,setupLightsView:M,pushLight:f,pushShadow:v}}function h$(o,e){let t=new WeakMap;function s(i,f=0){let v=t.get(i),x;return v===void 0?(x=new uR(o,e),t.set(i,[x])):f>=v.length?(x=new uR(o,e),v.push(x)):x=v[f],x}function a(){t=new WeakMap}return{get:s,dispose:a}}var c7=class extends hd{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=mj,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}},h7=class extends hd{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}},d$=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,u$=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function p$(o,e,t){let s=new m6,a=new ui,i=new ui,f=new Uo,v=new c7({depthPacking:gj}),x=new h7,M={},C=t.maxTextureSize,D={[cd]:Ua,[Ua]:cd,[ic]:ic},L=new lc({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new ui},radius:{value:4}},vertexShader:d$,fragmentShader:u$}),N=L.clone();N.defines.HORIZONTAL_PASS=1;let j=new Cl;j.setAttribute("position",new Ro(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));let Z=new dl(j,L),G=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=bR;let H=this.type;this.render=function(de,we,Le){if(G.enabled===!1||G.autoUpdate===!1&&G.needsUpdate===!1||de.length===0)return;let De=o.getRenderTarget(),se=o.getActiveCubeFace(),Ce=o.getActiveMipmapLevel(),Ne=o.state;Ne.setBlending(sd),Ne.buffers.color.setClear(1,1,1,1),Ne.buffers.depth.setTest(!0),Ne.setScissorTest(!1);let zt=H!==z0&&this.type===z0,Ge=H===z0&&this.type!==z0;for(let Xe=0,ht=de.length;Xe<ht;Xe++){let Ot=de[Xe],bt=Ot.shadow;if(bt===void 0){console.warn("THREE.WebGLShadowMap:",Ot,"has no shadow.");continue}if(bt.autoUpdate===!1&&bt.needsUpdate===!1)continue;a.copy(bt.mapSize);let Tt=bt.getFrameExtents();if(a.multiply(Tt),i.copy(bt.mapSize),(a.x>C||a.y>C)&&(a.x>C&&(i.x=Math.floor(C/Tt.x),a.x=i.x*Tt.x,bt.mapSize.x=i.x),a.y>C&&(i.y=Math.floor(C/Tt.y),a.y=i.y*Tt.y,bt.mapSize.y=i.y)),bt.map===null||zt===!0||Ge===!0){let Bt=this.type!==z0?{minFilter:ga,magFilter:ga}:{};bt.map!==null&&bt.map.dispose(),bt.map=new H0(a.x,a.y,Bt),bt.map.texture.name=Ot.name+".shadowMap",bt.camera.updateProjectionMatrix()}o.setRenderTarget(bt.map),o.clear();let Nt=bt.getViewportCount();for(let Bt=0;Bt<Nt;Bt++){let Yt=bt.getViewport(Bt);f.set(i.x*Yt.x,i.y*Yt.y,i.x*Yt.z,i.y*Yt.w),Ne.viewport(f),bt.updateMatrices(Ot,Bt),s=bt.getFrustum(),fe(we,Le,bt.camera,Ot,this.type)}bt.isPointLightShadow!==!0&&this.type===z0&&me(bt,Le),bt.needsUpdate=!1}H=this.type,G.needsUpdate=!1,o.setRenderTarget(De,se,Ce)};function me(de,we){let Le=e.update(Z);L.defines.VSM_SAMPLES!==de.blurSamples&&(L.defines.VSM_SAMPLES=de.blurSamples,N.defines.VSM_SAMPLES=de.blurSamples,L.needsUpdate=!0,N.needsUpdate=!0),de.mapPass===null&&(de.mapPass=new H0(a.x,a.y)),L.uniforms.shadow_pass.value=de.map.texture,L.uniforms.resolution.value=de.mapSize,L.uniforms.radius.value=de.radius,o.setRenderTarget(de.mapPass),o.clear(),o.renderBufferDirect(we,null,Le,L,Z,null),N.uniforms.shadow_pass.value=de.mapPass.texture,N.uniforms.resolution.value=de.mapSize,N.uniforms.radius.value=de.radius,o.setRenderTarget(de.map),o.clear(),o.renderBufferDirect(we,null,Le,N,Z,null)}function ne(de,we,Le,De){let se=null,Ce=Le.isPointLight===!0?de.customDistanceMaterial:de.customDepthMaterial;if(Ce!==void 0)se=Ce;else if(se=Le.isPointLight===!0?x:v,o.localClippingEnabled&&we.clipShadows===!0&&Array.isArray(we.clippingPlanes)&&we.clippingPlanes.length!==0||we.displacementMap&&we.displacementScale!==0||we.alphaMap&&we.alphaTest>0||we.map&&we.alphaTest>0){let Ne=se.uuid,zt=we.uuid,Ge=M[Ne];Ge===void 0&&(Ge={},M[Ne]=Ge);let Xe=Ge[zt];Xe===void 0&&(Xe=se.clone(),Ge[zt]=Xe,we.addEventListener("dispose",Ee)),se=Xe}if(se.visible=we.visible,se.wireframe=we.wireframe,De===z0?se.side=we.shadowSide!==null?we.shadowSide:we.side:se.side=we.shadowSide!==null?we.shadowSide:D[we.side],se.alphaMap=we.alphaMap,se.alphaTest=we.alphaTest,se.map=we.map,se.clipShadows=we.clipShadows,se.clippingPlanes=we.clippingPlanes,se.clipIntersection=we.clipIntersection,se.displacementMap=we.displacementMap,se.displacementScale=we.displacementScale,se.displacementBias=we.displacementBias,se.wireframeLinewidth=we.wireframeLinewidth,se.linewidth=we.linewidth,Le.isPointLight===!0&&se.isMeshDistanceMaterial===!0){let Ne=o.properties.get(se);Ne.light=Le}return se}function fe(de,we,Le,De,se){if(de.visible===!1)return;if(de.layers.test(we.layers)&&(de.isMesh||de.isLine||de.isPoints)&&(de.castShadow||de.receiveShadow&&se===z0)&&(!de.frustumCulled||s.intersectsObject(de))){de.modelViewMatrix.multiplyMatrices(Le.matrixWorldInverse,de.matrixWorld);let zt=e.update(de),Ge=de.material;if(Array.isArray(Ge)){let Xe=zt.groups;for(let ht=0,Ot=Xe.length;ht<Ot;ht++){let bt=Xe[ht],Tt=Ge[bt.materialIndex];if(Tt&&Tt.visible){let Nt=ne(de,Tt,De,se);de.onBeforeShadow(o,de,we,Le,zt,Nt,bt),o.renderBufferDirect(Le,null,zt,Nt,de,bt),de.onAfterShadow(o,de,we,Le,zt,Nt,bt)}}}else if(Ge.visible){let Xe=ne(de,Ge,De,se);de.onBeforeShadow(o,de,we,Le,zt,Xe,null),o.renderBufferDirect(Le,null,zt,Xe,de,null),de.onAfterShadow(o,de,we,Le,zt,Xe,null)}}let Ne=de.children;for(let zt=0,Ge=Ne.length;zt<Ge;zt++)fe(Ne[zt],we,Le,De,se)}function Ee(de){de.target.removeEventListener("dispose",Ee);for(let Le in M){let De=M[Le],se=de.target.uuid;se in De&&(De[se].dispose(),delete De[se])}}}function f$(o,e,t){let s=t.isWebGL2;function a(){let Pe=!1,Zt=new Uo,ni=null,gi=new Uo(0,0,0,0);return{setMask:function(qi){ni!==qi&&!Pe&&(o.colorMask(qi,qi,qi,qi),ni=qi)},setLocked:function(qi){Pe=qi},setClear:function(qi,$n,fr,mr,Mr){Mr===!0&&(qi*=mr,$n*=mr,fr*=mr),Zt.set(qi,$n,fr,mr),gi.equals(Zt)===!1&&(o.clearColor(qi,$n,fr,mr),gi.copy(Zt))},reset:function(){Pe=!1,ni=null,gi.set(-1,0,0,0)}}}function i(){let Pe=!1,Zt=null,ni=null,gi=null;return{setTest:function(qi){qi?Ri(o.DEPTH_TEST):br(o.DEPTH_TEST)},setMask:function(qi){Zt!==qi&&!Pe&&(o.depthMask(qi),Zt=qi)},setFunc:function(qi){if(ni!==qi){switch(qi){case qH:o.depthFunc(o.NEVER);break;case XH:o.depthFunc(o.ALWAYS);break;case ZH:o.depthFunc(o.LESS);break;case K3:o.depthFunc(o.LEQUAL);break;case $H:o.depthFunc(o.EQUAL);break;case YH:o.depthFunc(o.GEQUAL);break;case JH:o.depthFunc(o.GREATER);break;case KH:o.depthFunc(o.NOTEQUAL);break;default:o.depthFunc(o.LEQUAL)}ni=qi}},setLocked:function(qi){Pe=qi},setClear:function(qi){gi!==qi&&(o.clearDepth(qi),gi=qi)},reset:function(){Pe=!1,Zt=null,ni=null,gi=null}}}function f(){let Pe=!1,Zt=null,ni=null,gi=null,qi=null,$n=null,fr=null,mr=null,Mr=null;return{setTest:function(et){Pe||(et?Ri(o.STENCIL_TEST):br(o.STENCIL_TEST))},setMask:function(et){Zt!==et&&!Pe&&(o.stencilMask(et),Zt=et)},setFunc:function(et,lt,kt){(ni!==et||gi!==lt||qi!==kt)&&(o.stencilFunc(et,lt,kt),ni=et,gi=lt,qi=kt)},setOp:function(et,lt,kt){($n!==et||fr!==lt||mr!==kt)&&(o.stencilOp(et,lt,kt),$n=et,fr=lt,mr=kt)},setLocked:function(et){Pe=et},setClear:function(et){Mr!==et&&(o.clearStencil(et),Mr=et)},reset:function(){Pe=!1,Zt=null,ni=null,gi=null,qi=null,$n=null,fr=null,mr=null,Mr=null}}}let v=new a,x=new i,M=new f,C=new WeakMap,D=new WeakMap,L={},N={},j=new WeakMap,Z=[],G=null,H=!1,me=null,ne=null,fe=null,Ee=null,de=null,we=null,Le=null,De=new Er(0,0,0),se=0,Ce=!1,Ne=null,zt=null,Ge=null,Xe=null,ht=null,Ot=o.getParameter(o.MAX_COMBINED_TEXTURE_IMAGE_UNITS),bt=!1,Tt=0,Nt=o.getParameter(o.VERSION);Nt.indexOf("WebGL")!==-1?(Tt=parseFloat(/^WebGL (\d)/.exec(Nt)[1]),bt=Tt>=1):Nt.indexOf("OpenGL ES")!==-1&&(Tt=parseFloat(/^OpenGL ES (\d)/.exec(Nt)[1]),bt=Tt>=2);let Bt=null,Yt={},Wi=o.getParameter(o.SCISSOR_BOX),wt=o.getParameter(o.VIEWPORT),ei=new Uo().fromArray(Wi),vi=new Uo().fromArray(wt);function Pi(Pe,Zt,ni,gi){let qi=new Uint8Array(4),$n=o.createTexture();o.bindTexture(Pe,$n),o.texParameteri(Pe,o.TEXTURE_MIN_FILTER,o.NEAREST),o.texParameteri(Pe,o.TEXTURE_MAG_FILTER,o.NEAREST);for(let fr=0;fr<ni;fr++)s&&(Pe===o.TEXTURE_3D||Pe===o.TEXTURE_2D_ARRAY)?o.texImage3D(Zt,0,o.RGBA,1,1,gi,0,o.RGBA,o.UNSIGNED_BYTE,qi):o.texImage2D(Zt+fr,0,o.RGBA,1,1,0,o.RGBA,o.UNSIGNED_BYTE,qi);return $n}let Fi={};Fi[o.TEXTURE_2D]=Pi(o.TEXTURE_2D,o.TEXTURE_2D,1),Fi[o.TEXTURE_CUBE_MAP]=Pi(o.TEXTURE_CUBE_MAP,o.TEXTURE_CUBE_MAP_POSITIVE_X,6),s&&(Fi[o.TEXTURE_2D_ARRAY]=Pi(o.TEXTURE_2D_ARRAY,o.TEXTURE_2D_ARRAY,1,1),Fi[o.TEXTURE_3D]=Pi(o.TEXTURE_3D,o.TEXTURE_3D,1,1)),v.setClear(0,0,0,1),x.setClear(1),M.setClear(0),Ri(o.DEPTH_TEST),x.setFunc(K3),Fn(!1),Ie(jI),Ri(o.CULL_FACE),Qi(sd);function Ri(Pe){L[Pe]!==!0&&(o.enable(Pe),L[Pe]=!0)}function br(Pe){L[Pe]!==!1&&(o.disable(Pe),L[Pe]=!1)}function Ui(Pe,Zt){return N[Pe]!==Zt?(o.bindFramebuffer(Pe,Zt),N[Pe]=Zt,s&&(Pe===o.DRAW_FRAMEBUFFER&&(N[o.FRAMEBUFFER]=Zt),Pe===o.FRAMEBUFFER&&(N[o.DRAW_FRAMEBUFFER]=Zt)),!0):!1}function st(Pe,Zt){let ni=Z,gi=!1;if(Pe)if(ni=j.get(Zt),ni===void 0&&(ni=[],j.set(Zt,ni)),Pe.isWebGLMultipleRenderTargets){let qi=Pe.texture;if(ni.length!==qi.length||ni[0]!==o.COLOR_ATTACHMENT0){for(let $n=0,fr=qi.length;$n<fr;$n++)ni[$n]=o.COLOR_ATTACHMENT0+$n;ni.length=qi.length,gi=!0}}else ni[0]!==o.COLOR_ATTACHMENT0&&(ni[0]=o.COLOR_ATTACHMENT0,gi=!0);else ni[0]!==o.BACK&&(ni[0]=o.BACK,gi=!0);gi&&(t.isWebGL2?o.drawBuffers(ni):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(ni))}function $r(Pe){return G!==Pe?(o.useProgram(Pe),G=Pe,!0):!1}let Ki={[Ou]:o.FUNC_ADD,[RH]:o.FUNC_SUBTRACT,[kH]:o.FUNC_REVERSE_SUBTRACT};if(s)Ki[ZI]=o.MIN,Ki[$I]=o.MAX;else{let Pe=e.get("EXT_blend_minmax");Pe!==null&&(Ki[ZI]=Pe.MIN_EXT,Ki[$I]=Pe.MAX_EXT)}let yn={[DH]:o.ZERO,[LH]:o.ONE,[FH]:o.SRC_COLOR,[Hb]:o.SRC_ALPHA,[VH]:o.SRC_ALPHA_SATURATE,[BH]:o.DST_COLOR,[NH]:o.DST_ALPHA,[OH]:o.ONE_MINUS_SRC_COLOR,[jb]:o.ONE_MINUS_SRC_ALPHA,[UH]:o.ONE_MINUS_DST_COLOR,[zH]:o.ONE_MINUS_DST_ALPHA,[GH]:o.CONSTANT_COLOR,[HH]:o.ONE_MINUS_CONSTANT_COLOR,[jH]:o.CONSTANT_ALPHA,[WH]:o.ONE_MINUS_CONSTANT_ALPHA};function Qi(Pe,Zt,ni,gi,qi,$n,fr,mr,Mr,et){if(Pe===sd){H===!0&&(br(o.BLEND),H=!1);return}if(H===!1&&(Ri(o.BLEND),H=!0),Pe!==PH){if(Pe!==me||et!==Ce){if((ne!==Ou||de!==Ou)&&(o.blendEquation(o.FUNC_ADD),ne=Ou,de=Ou),et)switch(Pe){case nf:o.blendFuncSeparate(o.ONE,o.ONE_MINUS_SRC_ALPHA,o.ONE,o.ONE_MINUS_SRC_ALPHA);break;case WI:o.blendFunc(o.ONE,o.ONE);break;case qI:o.blendFuncSeparate(o.ZERO,o.ONE_MINUS_SRC_COLOR,o.ZERO,o.ONE);break;case XI:o.blendFuncSeparate(o.ZERO,o.SRC_COLOR,o.ZERO,o.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",Pe);break}else switch(Pe){case nf:o.blendFuncSeparate(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA,o.ONE,o.ONE_MINUS_SRC_ALPHA);break;case WI:o.blendFunc(o.SRC_ALPHA,o.ONE);break;case qI:o.blendFuncSeparate(o.ZERO,o.ONE_MINUS_SRC_COLOR,o.ZERO,o.ONE);break;case XI:o.blendFunc(o.ZERO,o.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",Pe);break}fe=null,Ee=null,we=null,Le=null,De.set(0,0,0),se=0,me=Pe,Ce=et}return}qi=qi||Zt,$n=$n||ni,fr=fr||gi,(Zt!==ne||qi!==de)&&(o.blendEquationSeparate(Ki[Zt],Ki[qi]),ne=Zt,de=qi),(ni!==fe||gi!==Ee||$n!==we||fr!==Le)&&(o.blendFuncSeparate(yn[ni],yn[gi],yn[$n],yn[fr]),fe=ni,Ee=gi,we=$n,Le=fr),(mr.equals(De)===!1||Mr!==se)&&(o.blendColor(mr.r,mr.g,mr.b,Mr),De.copy(mr),se=Mr),me=Pe,Ce=!1}function Gn(Pe,Zt){Pe.side===ic?br(o.CULL_FACE):Ri(o.CULL_FACE);let ni=Pe.side===Ua;Zt&&(ni=!ni),Fn(ni),Pe.blending===nf&&Pe.transparent===!1?Qi(sd):Qi(Pe.blending,Pe.blendEquation,Pe.blendSrc,Pe.blendDst,Pe.blendEquationAlpha,Pe.blendSrcAlpha,Pe.blendDstAlpha,Pe.blendColor,Pe.blendAlpha,Pe.premultipliedAlpha),x.setFunc(Pe.depthFunc),x.setTest(Pe.depthTest),x.setMask(Pe.depthWrite),v.setMask(Pe.colorWrite);let gi=Pe.stencilWrite;M.setTest(gi),gi&&(M.setMask(Pe.stencilWriteMask),M.setFunc(Pe.stencilFunc,Pe.stencilRef,Pe.stencilFuncMask),M.setOp(Pe.stencilFail,Pe.stencilZFail,Pe.stencilZPass)),_t(Pe.polygonOffset,Pe.polygonOffsetFactor,Pe.polygonOffsetUnits),Pe.alphaToCoverage===!0?Ri(o.SAMPLE_ALPHA_TO_COVERAGE):br(o.SAMPLE_ALPHA_TO_COVERAGE)}function Fn(Pe){Ne!==Pe&&(Pe?o.frontFace(o.CW):o.frontFace(o.CCW),Ne=Pe)}function Ie(Pe){Pe!==AH?(Ri(o.CULL_FACE),Pe!==zt&&(Pe===jI?o.cullFace(o.BACK):Pe===CH?o.cullFace(o.FRONT):o.cullFace(o.FRONT_AND_BACK))):br(o.CULL_FACE),zt=Pe}function be(Pe){Pe!==Ge&&(bt&&o.lineWidth(Pe),Ge=Pe)}function _t(Pe,Zt,ni){Pe?(Ri(o.POLYGON_OFFSET_FILL),(Xe!==Zt||ht!==ni)&&(o.polygonOffset(Zt,ni),Xe=Zt,ht=ni)):br(o.POLYGON_OFFSET_FILL)}function li(Pe){Pe?Ri(o.SCISSOR_TEST):br(o.SCISSOR_TEST)}function ze(Pe){Pe===void 0&&(Pe=o.TEXTURE0+Ot-1),Bt!==Pe&&(o.activeTexture(Pe),Bt=Pe)}function te(Pe,Zt,ni){ni===void 0&&(Bt===null?ni=o.TEXTURE0+Ot-1:ni=Bt);let gi=Yt[ni];gi===void 0&&(gi={type:void 0,texture:void 0},Yt[ni]=gi),(gi.type!==Pe||gi.texture!==Zt)&&(Bt!==ni&&(o.activeTexture(ni),Bt=ni),o.bindTexture(Pe,Zt||Fi[Pe]),gi.type=Pe,gi.texture=Zt)}function he(){let Pe=Yt[Bt];Pe!==void 0&&Pe.type!==void 0&&(o.bindTexture(Pe.type,null),Pe.type=void 0,Pe.texture=void 0)}function Se(){try{o.compressedTexImage2D.apply(o,arguments)}catch(Pe){console.error("THREE.WebGLState:",Pe)}}function He(){try{o.compressedTexImage3D.apply(o,arguments)}catch(Pe){console.error("THREE.WebGLState:",Pe)}}function Ye(){try{o.texSubImage2D.apply(o,arguments)}catch(Pe){console.error("THREE.WebGLState:",Pe)}}function at(){try{o.texSubImage3D.apply(o,arguments)}catch(Pe){console.error("THREE.WebGLState:",Pe)}}function ye(){try{o.compressedTexSubImage2D.apply(o,arguments)}catch(Pe){console.error("THREE.WebGLState:",Pe)}}function Ve(){try{o.compressedTexSubImage3D.apply(o,arguments)}catch(Pe){console.error("THREE.WebGLState:",Pe)}}function pt(){try{o.texStorage2D.apply(o,arguments)}catch(Pe){console.error("THREE.WebGLState:",Pe)}}function ut(){try{o.texStorage3D.apply(o,arguments)}catch(Pe){console.error("THREE.WebGLState:",Pe)}}function St(){try{o.texImage2D.apply(o,arguments)}catch(Pe){console.error("THREE.WebGLState:",Pe)}}function Vt(){try{o.texImage3D.apply(o,arguments)}catch(Pe){console.error("THREE.WebGLState:",Pe)}}function Mi(Pe){ei.equals(Pe)===!1&&(o.scissor(Pe.x,Pe.y,Pe.z,Pe.w),ei.copy(Pe))}function en(Pe){vi.equals(Pe)===!1&&(o.viewport(Pe.x,Pe.y,Pe.z,Pe.w),vi.copy(Pe))}function Oi(Pe,Zt){let ni=D.get(Zt);ni===void 0&&(ni=new WeakMap,D.set(Zt,ni));let gi=ni.get(Pe);gi===void 0&&(gi=o.getUniformBlockIndex(Zt,Pe.name),ni.set(Pe,gi))}function yi(Pe,Zt){let gi=D.get(Zt).get(Pe);C.get(Zt)!==gi&&(o.uniformBlockBinding(Zt,gi,Pe.__bindingPointIndex),C.set(Zt,gi))}function Vi(){o.disable(o.BLEND),o.disable(o.CULL_FACE),o.disable(o.DEPTH_TEST),o.disable(o.POLYGON_OFFSET_FILL),o.disable(o.SCISSOR_TEST),o.disable(o.STENCIL_TEST),o.disable(o.SAMPLE_ALPHA_TO_COVERAGE),o.blendEquation(o.FUNC_ADD),o.blendFunc(o.ONE,o.ZERO),o.blendFuncSeparate(o.ONE,o.ZERO,o.ONE,o.ZERO),o.blendColor(0,0,0,0),o.colorMask(!0,!0,!0,!0),o.clearColor(0,0,0,0),o.depthMask(!0),o.depthFunc(o.LESS),o.clearDepth(1),o.stencilMask(4294967295),o.stencilFunc(o.ALWAYS,0,4294967295),o.stencilOp(o.KEEP,o.KEEP,o.KEEP),o.clearStencil(0),o.cullFace(o.BACK),o.frontFace(o.CCW),o.polygonOffset(0,0),o.activeTexture(o.TEXTURE0),o.bindFramebuffer(o.FRAMEBUFFER,null),s===!0&&(o.bindFramebuffer(o.DRAW_FRAMEBUFFER,null),o.bindFramebuffer(o.READ_FRAMEBUFFER,null)),o.useProgram(null),o.lineWidth(1),o.scissor(0,0,o.canvas.width,o.canvas.height),o.viewport(0,0,o.canvas.width,o.canvas.height),L={},Bt=null,Yt={},N={},j=new WeakMap,Z=[],G=null,H=!1,me=null,ne=null,fe=null,Ee=null,de=null,we=null,Le=null,De=new Er(0,0,0),se=0,Ce=!1,Ne=null,zt=null,Ge=null,Xe=null,ht=null,ei.set(0,0,o.canvas.width,o.canvas.height),vi.set(0,0,o.canvas.width,o.canvas.height),v.reset(),x.reset(),M.reset()}return{buffers:{color:v,depth:x,stencil:M},enable:Ri,disable:br,bindFramebuffer:Ui,drawBuffers:st,useProgram:$r,setBlending:Qi,setMaterial:Gn,setFlipSided:Fn,setCullFace:Ie,setLineWidth:be,setPolygonOffset:_t,setScissorTest:li,activeTexture:ze,bindTexture:te,unbindTexture:he,compressedTexImage2D:Se,compressedTexImage3D:He,texImage2D:St,texImage3D:Vt,updateUBOMapping:Oi,uniformBlockBinding:yi,texStorage2D:pt,texStorage3D:ut,texSubImage2D:Ye,texSubImage3D:at,compressedTexSubImage2D:ye,compressedTexSubImage3D:Ve,scissor:Mi,viewport:en,reset:Vi}}function m$(o,e,t,s,a,i,f){let v=a.isWebGL2,x=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,M=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),C=new WeakMap,D,L=new WeakMap,N=!1;try{N=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function j(Ie,be){return N?new OffscreenCanvas(Ie,be):s6("canvas")}function Z(Ie,be,_t,li){let ze=1;if((Ie.width>li||Ie.height>li)&&(ze=li/Math.max(Ie.width,Ie.height)),ze<1||be===!0)if(typeof HTMLImageElement<"u"&&Ie instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&Ie instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&Ie instanceof ImageBitmap){let te=be?Kb:Math.floor,he=te(ze*Ie.width),Se=te(ze*Ie.height);D===void 0&&(D=j(he,Se));let He=_t?j(he,Se):D;return He.width=he,He.height=Se,He.getContext("2d").drawImage(Ie,0,0,he,Se),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Ie.width+"x"+Ie.height+") to ("+he+"x"+Se+")."),He}else return"data"in Ie&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Ie.width+"x"+Ie.height+")."),Ie;return Ie}function G(Ie){return AP(Ie.width)&&AP(Ie.height)}function H(Ie){return v?!1:Ie.wrapS!==nc||Ie.wrapT!==nc||Ie.minFilter!==ga&&Ie.minFilter!==Ba}function me(Ie,be){return Ie.generateMipmaps&&be&&Ie.minFilter!==ga&&Ie.minFilter!==Ba}function ne(Ie){o.generateMipmap(Ie)}function fe(Ie,be,_t,li,ze=!1){if(v===!1)return be;if(Ie!==null){if(o[Ie]!==void 0)return o[Ie];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+Ie+"'")}let te=be;if(be===o.RED&&(_t===o.FLOAT&&(te=o.R32F),_t===o.HALF_FLOAT&&(te=o.R16F),_t===o.UNSIGNED_BYTE&&(te=o.R8)),be===o.RED_INTEGER&&(_t===o.UNSIGNED_BYTE&&(te=o.R8UI),_t===o.UNSIGNED_SHORT&&(te=o.R16UI),_t===o.UNSIGNED_INT&&(te=o.R32UI),_t===o.BYTE&&(te=o.R8I),_t===o.SHORT&&(te=o.R16I),_t===o.INT&&(te=o.R32I)),be===o.RG&&(_t===o.FLOAT&&(te=o.RG32F),_t===o.HALF_FLOAT&&(te=o.RG16F),_t===o.UNSIGNED_BYTE&&(te=o.RG8)),be===o.RGBA){let he=ze?t6:fs.getTransfer(li);_t===o.FLOAT&&(te=o.RGBA32F),_t===o.HALF_FLOAT&&(te=o.RGBA16F),_t===o.UNSIGNED_BYTE&&(te=he===As?o.SRGB8_ALPHA8:o.RGBA8),_t===o.UNSIGNED_SHORT_4_4_4_4&&(te=o.RGBA4),_t===o.UNSIGNED_SHORT_5_5_5_1&&(te=o.RGB5_A1)}return(te===o.R16F||te===o.R32F||te===o.RG16F||te===o.RG32F||te===o.RGBA16F||te===o.RGBA32F)&&e.get("EXT_color_buffer_float"),te}function Ee(Ie,be,_t){return me(Ie,_t)===!0||Ie.isFramebufferTexture&&Ie.minFilter!==ga&&Ie.minFilter!==Ba?Math.log2(Math.max(be.width,be.height))+1:Ie.mipmaps!==void 0&&Ie.mipmaps.length>0?Ie.mipmaps.length:Ie.isCompressedTexture&&Array.isArray(Ie.image)?be.mipmaps.length:1}function de(Ie){return Ie===ga||Ie===JI||Ie===Ug?o.NEAREST:o.LINEAR}function we(Ie){let be=Ie.target;be.removeEventListener("dispose",we),De(be),be.isVideoTexture&&C.delete(be)}function Le(Ie){let be=Ie.target;be.removeEventListener("dispose",Le),Ce(be)}function De(Ie){let be=s.get(Ie);if(be.__webglInit===void 0)return;let _t=Ie.source,li=L.get(_t);if(li){let ze=li[be.__cacheKey];ze.usedTimes--,ze.usedTimes===0&&se(Ie),Object.keys(li).length===0&&L.delete(_t)}s.remove(Ie)}function se(Ie){let be=s.get(Ie);o.deleteTexture(be.__webglTexture);let _t=Ie.source,li=L.get(_t);delete li[be.__cacheKey],f.memory.textures--}function Ce(Ie){let be=Ie.texture,_t=s.get(Ie),li=s.get(be);if(li.__webglTexture!==void 0&&(o.deleteTexture(li.__webglTexture),f.memory.textures--),Ie.depthTexture&&Ie.depthTexture.dispose(),Ie.isWebGLCubeRenderTarget)for(let ze=0;ze<6;ze++){if(Array.isArray(_t.__webglFramebuffer[ze]))for(let te=0;te<_t.__webglFramebuffer[ze].length;te++)o.deleteFramebuffer(_t.__webglFramebuffer[ze][te]);else o.deleteFramebuffer(_t.__webglFramebuffer[ze]);_t.__webglDepthbuffer&&o.deleteRenderbuffer(_t.__webglDepthbuffer[ze])}else{if(Array.isArray(_t.__webglFramebuffer))for(let ze=0;ze<_t.__webglFramebuffer.length;ze++)o.deleteFramebuffer(_t.__webglFramebuffer[ze]);else o.deleteFramebuffer(_t.__webglFramebuffer);if(_t.__webglDepthbuffer&&o.deleteRenderbuffer(_t.__webglDepthbuffer),_t.__webglMultisampledFramebuffer&&o.deleteFramebuffer(_t.__webglMultisampledFramebuffer),_t.__webglColorRenderbuffer)for(let ze=0;ze<_t.__webglColorRenderbuffer.length;ze++)_t.__webglColorRenderbuffer[ze]&&o.deleteRenderbuffer(_t.__webglColorRenderbuffer[ze]);_t.__webglDepthRenderbuffer&&o.deleteRenderbuffer(_t.__webglDepthRenderbuffer)}if(Ie.isWebGLMultipleRenderTargets)for(let ze=0,te=be.length;ze<te;ze++){let he=s.get(be[ze]);he.__webglTexture&&(o.deleteTexture(he.__webglTexture),f.memory.textures--),s.remove(be[ze])}s.remove(be),s.remove(Ie)}let Ne=0;function zt(){Ne=0}function Ge(){let Ie=Ne;return Ie>=a.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+Ie+" texture units while this GPU supports only "+a.maxTextures),Ne+=1,Ie}function Xe(Ie){let be=[];return be.push(Ie.wrapS),be.push(Ie.wrapT),be.push(Ie.wrapR||0),be.push(Ie.magFilter),be.push(Ie.minFilter),be.push(Ie.anisotropy),be.push(Ie.internalFormat),be.push(Ie.format),be.push(Ie.type),be.push(Ie.generateMipmaps),be.push(Ie.premultiplyAlpha),be.push(Ie.flipY),be.push(Ie.unpackAlignment),be.push(Ie.colorSpace),be.join()}function ht(Ie,be){let _t=s.get(Ie);if(Ie.isVideoTexture&&Gn(Ie),Ie.isRenderTargetTexture===!1&&Ie.version>0&&_t.__version!==Ie.version){let li=Ie.image;if(li===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(li.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{ei(_t,Ie,be);return}}t.bindTexture(o.TEXTURE_2D,_t.__webglTexture,o.TEXTURE0+be)}function Ot(Ie,be){let _t=s.get(Ie);if(Ie.version>0&&_t.__version!==Ie.version){ei(_t,Ie,be);return}t.bindTexture(o.TEXTURE_2D_ARRAY,_t.__webglTexture,o.TEXTURE0+be)}function bt(Ie,be){let _t=s.get(Ie);if(Ie.version>0&&_t.__version!==Ie.version){ei(_t,Ie,be);return}t.bindTexture(o.TEXTURE_3D,_t.__webglTexture,o.TEXTURE0+be)}function Tt(Ie,be){let _t=s.get(Ie);if(Ie.version>0&&_t.__version!==Ie.version){vi(_t,Ie,be);return}t.bindTexture(o.TEXTURE_CUBE_MAP,_t.__webglTexture,o.TEXTURE0+be)}let Nt={[Xb]:o.REPEAT,[nc]:o.CLAMP_TO_EDGE,[Zb]:o.MIRRORED_REPEAT},Bt={[ga]:o.NEAREST,[JI]:o.NEAREST_MIPMAP_NEAREST,[Ug]:o.NEAREST_MIPMAP_LINEAR,[Ba]:o.LINEAR,[db]:o.LINEAR_MIPMAP_NEAREST,[zu]:o.LINEAR_MIPMAP_LINEAR},Yt={[vj]:o.NEVER,[Mj]:o.ALWAYS,[xj]:o.LESS,[RR]:o.LEQUAL,[bj]:o.EQUAL,[Tj]:o.GEQUAL,[wj]:o.GREATER,[Sj]:o.NOTEQUAL};function Wi(Ie,be,_t){if(be.type===U0&&e.has("OES_texture_float_linear")===!1&&(be.magFilter===Ba||be.magFilter===db||be.magFilter===Ug||be.magFilter===zu||be.minFilter===Ba||be.minFilter===db||be.minFilter===Ug||be.minFilter===zu)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),_t?(o.texParameteri(Ie,o.TEXTURE_WRAP_S,Nt[be.wrapS]),o.texParameteri(Ie,o.TEXTURE_WRAP_T,Nt[be.wrapT]),(Ie===o.TEXTURE_3D||Ie===o.TEXTURE_2D_ARRAY)&&o.texParameteri(Ie,o.TEXTURE_WRAP_R,Nt[be.wrapR]),o.texParameteri(Ie,o.TEXTURE_MAG_FILTER,Bt[be.magFilter]),o.texParameteri(Ie,o.TEXTURE_MIN_FILTER,Bt[be.minFilter])):(o.texParameteri(Ie,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(Ie,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),(Ie===o.TEXTURE_3D||Ie===o.TEXTURE_2D_ARRAY)&&o.texParameteri(Ie,o.TEXTURE_WRAP_R,o.CLAMP_TO_EDGE),(be.wrapS!==nc||be.wrapT!==nc)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),o.texParameteri(Ie,o.TEXTURE_MAG_FILTER,de(be.magFilter)),o.texParameteri(Ie,o.TEXTURE_MIN_FILTER,de(be.minFilter)),be.minFilter!==ga&&be.minFilter!==Ba&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),be.compareFunction&&(o.texParameteri(Ie,o.TEXTURE_COMPARE_MODE,o.COMPARE_REF_TO_TEXTURE),o.texParameteri(Ie,o.TEXTURE_COMPARE_FUNC,Yt[be.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){let li=e.get("EXT_texture_filter_anisotropic");if(be.magFilter===ga||be.minFilter!==Ug&&be.minFilter!==zu||be.type===U0&&e.has("OES_texture_float_linear")===!1||v===!1&&be.type===qg&&e.has("OES_texture_half_float_linear")===!1)return;(be.anisotropy>1||s.get(be).__currentAnisotropy)&&(o.texParameterf(Ie,li.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(be.anisotropy,a.getMaxAnisotropy())),s.get(be).__currentAnisotropy=be.anisotropy)}}function wt(Ie,be){let _t=!1;Ie.__webglInit===void 0&&(Ie.__webglInit=!0,be.addEventListener("dispose",we));let li=be.source,ze=L.get(li);ze===void 0&&(ze={},L.set(li,ze));let te=Xe(be);if(te!==Ie.__cacheKey){ze[te]===void 0&&(ze[te]={texture:o.createTexture(),usedTimes:0},f.memory.textures++,_t=!0),ze[te].usedTimes++;let he=ze[Ie.__cacheKey];he!==void 0&&(ze[Ie.__cacheKey].usedTimes--,he.usedTimes===0&&se(be)),Ie.__cacheKey=te,Ie.__webglTexture=ze[te].texture}return _t}function ei(Ie,be,_t){let li=o.TEXTURE_2D;(be.isDataArrayTexture||be.isCompressedArrayTexture)&&(li=o.TEXTURE_2D_ARRAY),be.isData3DTexture&&(li=o.TEXTURE_3D);let ze=wt(Ie,be),te=be.source;t.bindTexture(li,Ie.__webglTexture,o.TEXTURE0+_t);let he=s.get(te);if(te.version!==he.__version||ze===!0){t.activeTexture(o.TEXTURE0+_t);let Se=fs.getPrimaries(fs.workingColorSpace),He=be.colorSpace===Al?null:fs.getPrimaries(be.colorSpace),Ye=be.colorSpace===Al||Se===He?o.NONE:o.BROWSER_DEFAULT_WEBGL;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,be.flipY),o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,be.premultiplyAlpha),o.pixelStorei(o.UNPACK_ALIGNMENT,be.unpackAlignment),o.pixelStorei(o.UNPACK_COLORSPACE_CONVERSION_WEBGL,Ye);let at=H(be)&&G(be.image)===!1,ye=Z(be.image,at,!1,a.maxTextureSize);ye=Fn(be,ye);let Ve=G(ye)||v,pt=i.convert(be.format,be.colorSpace),ut=i.convert(be.type),St=fe(be.internalFormat,pt,ut,be.colorSpace,be.isVideoTexture);Wi(li,be,Ve);let Vt,Mi=be.mipmaps,en=v&&be.isVideoTexture!==!0&&St!==IR,Oi=he.__version===void 0||ze===!0,yi=te.dataReady,Vi=Ee(be,ye,Ve);if(be.isDepthTexture)St=o.DEPTH_COMPONENT,v?be.type===U0?St=o.DEPTH_COMPONENT32F:be.type===rd?St=o.DEPTH_COMPONENT24:be.type===Bu?St=o.DEPTH24_STENCIL8:St=o.DEPTH_COMPONENT16:be.type===U0&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),be.format===Uu&&St===o.DEPTH_COMPONENT&&be.type!==I7&&be.type!==rd&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),be.type=rd,ut=i.convert(be.type)),be.format===lf&&St===o.DEPTH_COMPONENT&&(St=o.DEPTH_STENCIL,be.type!==Bu&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),be.type=Bu,ut=i.convert(be.type))),Oi&&(en?t.texStorage2D(o.TEXTURE_2D,1,St,ye.width,ye.height):t.texImage2D(o.TEXTURE_2D,0,St,ye.width,ye.height,0,pt,ut,null));else if(be.isDataTexture)if(Mi.length>0&&Ve){en&&Oi&&t.texStorage2D(o.TEXTURE_2D,Vi,St,Mi[0].width,Mi[0].height);for(let Pe=0,Zt=Mi.length;Pe<Zt;Pe++)Vt=Mi[Pe],en?yi&&t.texSubImage2D(o.TEXTURE_2D,Pe,0,0,Vt.width,Vt.height,pt,ut,Vt.data):t.texImage2D(o.TEXTURE_2D,Pe,St,Vt.width,Vt.height,0,pt,ut,Vt.data);be.generateMipmaps=!1}else en?(Oi&&t.texStorage2D(o.TEXTURE_2D,Vi,St,ye.width,ye.height),yi&&t.texSubImage2D(o.TEXTURE_2D,0,0,0,ye.width,ye.height,pt,ut,ye.data)):t.texImage2D(o.TEXTURE_2D,0,St,ye.width,ye.height,0,pt,ut,ye.data);else if(be.isCompressedTexture)if(be.isCompressedArrayTexture){en&&Oi&&t.texStorage3D(o.TEXTURE_2D_ARRAY,Vi,St,Mi[0].width,Mi[0].height,ye.depth);for(let Pe=0,Zt=Mi.length;Pe<Zt;Pe++)Vt=Mi[Pe],be.format!==rc?pt!==null?en?yi&&t.compressedTexSubImage3D(o.TEXTURE_2D_ARRAY,Pe,0,0,0,Vt.width,Vt.height,ye.depth,pt,Vt.data,0,0):t.compressedTexImage3D(o.TEXTURE_2D_ARRAY,Pe,St,Vt.width,Vt.height,ye.depth,0,Vt.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):en?yi&&t.texSubImage3D(o.TEXTURE_2D_ARRAY,Pe,0,0,0,Vt.width,Vt.height,ye.depth,pt,ut,Vt.data):t.texImage3D(o.TEXTURE_2D_ARRAY,Pe,St,Vt.width,Vt.height,ye.depth,0,pt,ut,Vt.data)}else{en&&Oi&&t.texStorage2D(o.TEXTURE_2D,Vi,St,Mi[0].width,Mi[0].height);for(let Pe=0,Zt=Mi.length;Pe<Zt;Pe++)Vt=Mi[Pe],be.format!==rc?pt!==null?en?yi&&t.compressedTexSubImage2D(o.TEXTURE_2D,Pe,0,0,Vt.width,Vt.height,pt,Vt.data):t.compressedTexImage2D(o.TEXTURE_2D,Pe,St,Vt.width,Vt.height,0,Vt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):en?yi&&t.texSubImage2D(o.TEXTURE_2D,Pe,0,0,Vt.width,Vt.height,pt,ut,Vt.data):t.texImage2D(o.TEXTURE_2D,Pe,St,Vt.width,Vt.height,0,pt,ut,Vt.data)}else if(be.isDataArrayTexture)en?(Oi&&t.texStorage3D(o.TEXTURE_2D_ARRAY,Vi,St,ye.width,ye.height,ye.depth),yi&&t.texSubImage3D(o.TEXTURE_2D_ARRAY,0,0,0,0,ye.width,ye.height,ye.depth,pt,ut,ye.data)):t.texImage3D(o.TEXTURE_2D_ARRAY,0,St,ye.width,ye.height,ye.depth,0,pt,ut,ye.data);else if(be.isData3DTexture)en?(Oi&&t.texStorage3D(o.TEXTURE_3D,Vi,St,ye.width,ye.height,ye.depth),yi&&t.texSubImage3D(o.TEXTURE_3D,0,0,0,0,ye.width,ye.height,ye.depth,pt,ut,ye.data)):t.texImage3D(o.TEXTURE_3D,0,St,ye.width,ye.height,ye.depth,0,pt,ut,ye.data);else if(be.isFramebufferTexture){if(Oi)if(en)t.texStorage2D(o.TEXTURE_2D,Vi,St,ye.width,ye.height);else{let Pe=ye.width,Zt=ye.height;for(let ni=0;ni<Vi;ni++)t.texImage2D(o.TEXTURE_2D,ni,St,Pe,Zt,0,pt,ut,null),Pe>>=1,Zt>>=1}}else if(Mi.length>0&&Ve){en&&Oi&&t.texStorage2D(o.TEXTURE_2D,Vi,St,Mi[0].width,Mi[0].height);for(let Pe=0,Zt=Mi.length;Pe<Zt;Pe++)Vt=Mi[Pe],en?yi&&t.texSubImage2D(o.TEXTURE_2D,Pe,0,0,pt,ut,Vt):t.texImage2D(o.TEXTURE_2D,Pe,St,pt,ut,Vt);be.generateMipmaps=!1}else en?(Oi&&t.texStorage2D(o.TEXTURE_2D,Vi,St,ye.width,ye.height),yi&&t.texSubImage2D(o.TEXTURE_2D,0,0,0,pt,ut,ye)):t.texImage2D(o.TEXTURE_2D,0,St,pt,ut,ye);me(be,Ve)&&ne(li),he.__version=te.version,be.onUpdate&&be.onUpdate(be)}Ie.__version=be.version}function vi(Ie,be,_t){if(be.image.length!==6)return;let li=wt(Ie,be),ze=be.source;t.bindTexture(o.TEXTURE_CUBE_MAP,Ie.__webglTexture,o.TEXTURE0+_t);let te=s.get(ze);if(ze.version!==te.__version||li===!0){t.activeTexture(o.TEXTURE0+_t);let he=fs.getPrimaries(fs.workingColorSpace),Se=be.colorSpace===Al?null:fs.getPrimaries(be.colorSpace),He=be.colorSpace===Al||he===Se?o.NONE:o.BROWSER_DEFAULT_WEBGL;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,be.flipY),o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,be.premultiplyAlpha),o.pixelStorei(o.UNPACK_ALIGNMENT,be.unpackAlignment),o.pixelStorei(o.UNPACK_COLORSPACE_CONVERSION_WEBGL,He);let Ye=be.isCompressedTexture||be.image[0].isCompressedTexture,at=be.image[0]&&be.image[0].isDataTexture,ye=[];for(let Pe=0;Pe<6;Pe++)!Ye&&!at?ye[Pe]=Z(be.image[Pe],!1,!0,a.maxCubemapSize):ye[Pe]=at?be.image[Pe].image:be.image[Pe],ye[Pe]=Fn(be,ye[Pe]);let Ve=ye[0],pt=G(Ve)||v,ut=i.convert(be.format,be.colorSpace),St=i.convert(be.type),Vt=fe(be.internalFormat,ut,St,be.colorSpace),Mi=v&&be.isVideoTexture!==!0,en=te.__version===void 0||li===!0,Oi=ze.dataReady,yi=Ee(be,Ve,pt);Wi(o.TEXTURE_CUBE_MAP,be,pt);let Vi;if(Ye){Mi&&en&&t.texStorage2D(o.TEXTURE_CUBE_MAP,yi,Vt,Ve.width,Ve.height);for(let Pe=0;Pe<6;Pe++){Vi=ye[Pe].mipmaps;for(let Zt=0;Zt<Vi.length;Zt++){let ni=Vi[Zt];be.format!==rc?ut!==null?Mi?Oi&&t.compressedTexSubImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+Pe,Zt,0,0,ni.width,ni.height,ut,ni.data):t.compressedTexImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+Pe,Zt,Vt,ni.width,ni.height,0,ni.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Mi?Oi&&t.texSubImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+Pe,Zt,0,0,ni.width,ni.height,ut,St,ni.data):t.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+Pe,Zt,Vt,ni.width,ni.height,0,ut,St,ni.data)}}}else{Vi=be.mipmaps,Mi&&en&&(Vi.length>0&&yi++,t.texStorage2D(o.TEXTURE_CUBE_MAP,yi,Vt,ye[0].width,ye[0].height));for(let Pe=0;Pe<6;Pe++)if(at){Mi?Oi&&t.texSubImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+Pe,0,0,0,ye[Pe].width,ye[Pe].height,ut,St,ye[Pe].data):t.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+Pe,0,Vt,ye[Pe].width,ye[Pe].height,0,ut,St,ye[Pe].data);for(let Zt=0;Zt<Vi.length;Zt++){let gi=Vi[Zt].image[Pe].image;Mi?Oi&&t.texSubImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+Pe,Zt+1,0,0,gi.width,gi.height,ut,St,gi.data):t.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+Pe,Zt+1,Vt,gi.width,gi.height,0,ut,St,gi.data)}}else{Mi?Oi&&t.texSubImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+Pe,0,0,0,ut,St,ye[Pe]):t.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+Pe,0,Vt,ut,St,ye[Pe]);for(let Zt=0;Zt<Vi.length;Zt++){let ni=Vi[Zt];Mi?Oi&&t.texSubImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+Pe,Zt+1,0,0,ut,St,ni.image[Pe]):t.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+Pe,Zt+1,Vt,ut,St,ni.image[Pe])}}}me(be,pt)&&ne(o.TEXTURE_CUBE_MAP),te.__version=ze.version,be.onUpdate&&be.onUpdate(be)}Ie.__version=be.version}function Pi(Ie,be,_t,li,ze,te){let he=i.convert(_t.format,_t.colorSpace),Se=i.convert(_t.type),He=fe(_t.internalFormat,he,Se,_t.colorSpace);if(!s.get(be).__hasExternalTextures){let at=Math.max(1,be.width>>te),ye=Math.max(1,be.height>>te);ze===o.TEXTURE_3D||ze===o.TEXTURE_2D_ARRAY?t.texImage3D(ze,te,He,at,ye,be.depth,0,he,Se,null):t.texImage2D(ze,te,He,at,ye,0,he,Se,null)}t.bindFramebuffer(o.FRAMEBUFFER,Ie),Qi(be)?x.framebufferTexture2DMultisampleEXT(o.FRAMEBUFFER,li,ze,s.get(_t).__webglTexture,0,yn(be)):(ze===o.TEXTURE_2D||ze>=o.TEXTURE_CUBE_MAP_POSITIVE_X&&ze<=o.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&o.framebufferTexture2D(o.FRAMEBUFFER,li,ze,s.get(_t).__webglTexture,te),t.bindFramebuffer(o.FRAMEBUFFER,null)}function Fi(Ie,be,_t){if(o.bindRenderbuffer(o.RENDERBUFFER,Ie),be.depthBuffer&&!be.stencilBuffer){let li=v===!0?o.DEPTH_COMPONENT24:o.DEPTH_COMPONENT16;if(_t||Qi(be)){let ze=be.depthTexture;ze&&ze.isDepthTexture&&(ze.type===U0?li=o.DEPTH_COMPONENT32F:ze.type===rd&&(li=o.DEPTH_COMPONENT24));let te=yn(be);Qi(be)?x.renderbufferStorageMultisampleEXT(o.RENDERBUFFER,te,li,be.width,be.height):o.renderbufferStorageMultisample(o.RENDERBUFFER,te,li,be.width,be.height)}else o.renderbufferStorage(o.RENDERBUFFER,li,be.width,be.height);o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,Ie)}else if(be.depthBuffer&&be.stencilBuffer){let li=yn(be);_t&&Qi(be)===!1?o.renderbufferStorageMultisample(o.RENDERBUFFER,li,o.DEPTH24_STENCIL8,be.width,be.height):Qi(be)?x.renderbufferStorageMultisampleEXT(o.RENDERBUFFER,li,o.DEPTH24_STENCIL8,be.width,be.height):o.renderbufferStorage(o.RENDERBUFFER,o.DEPTH_STENCIL,be.width,be.height),o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.RENDERBUFFER,Ie)}else{let li=be.isWebGLMultipleRenderTargets===!0?be.texture:[be.texture];for(let ze=0;ze<li.length;ze++){let te=li[ze],he=i.convert(te.format,te.colorSpace),Se=i.convert(te.type),He=fe(te.internalFormat,he,Se,te.colorSpace),Ye=yn(be);_t&&Qi(be)===!1?o.renderbufferStorageMultisample(o.RENDERBUFFER,Ye,He,be.width,be.height):Qi(be)?x.renderbufferStorageMultisampleEXT(o.RENDERBUFFER,Ye,He,be.width,be.height):o.renderbufferStorage(o.RENDERBUFFER,He,be.width,be.height)}}o.bindRenderbuffer(o.RENDERBUFFER,null)}function Ri(Ie,be){if(be&&be.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(o.FRAMEBUFFER,Ie),!(be.depthTexture&&be.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!s.get(be.depthTexture).__webglTexture||be.depthTexture.image.width!==be.width||be.depthTexture.image.height!==be.height)&&(be.depthTexture.image.width=be.width,be.depthTexture.image.height=be.height,be.depthTexture.needsUpdate=!0),ht(be.depthTexture,0);let li=s.get(be.depthTexture).__webglTexture,ze=yn(be);if(be.depthTexture.format===Uu)Qi(be)?x.framebufferTexture2DMultisampleEXT(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.TEXTURE_2D,li,0,ze):o.framebufferTexture2D(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.TEXTURE_2D,li,0);else if(be.depthTexture.format===lf)Qi(be)?x.framebufferTexture2DMultisampleEXT(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.TEXTURE_2D,li,0,ze):o.framebufferTexture2D(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.TEXTURE_2D,li,0);else throw new Error("Unknown depthTexture format")}function br(Ie){let be=s.get(Ie),_t=Ie.isWebGLCubeRenderTarget===!0;if(Ie.depthTexture&&!be.__autoAllocateDepthBuffer){if(_t)throw new Error("target.depthTexture not supported in Cube render targets");Ri(be.__webglFramebuffer,Ie)}else if(_t){be.__webglDepthbuffer=[];for(let li=0;li<6;li++)t.bindFramebuffer(o.FRAMEBUFFER,be.__webglFramebuffer[li]),be.__webglDepthbuffer[li]=o.createRenderbuffer(),Fi(be.__webglDepthbuffer[li],Ie,!1)}else t.bindFramebuffer(o.FRAMEBUFFER,be.__webglFramebuffer),be.__webglDepthbuffer=o.createRenderbuffer(),Fi(be.__webglDepthbuffer,Ie,!1);t.bindFramebuffer(o.FRAMEBUFFER,null)}function Ui(Ie,be,_t){let li=s.get(Ie);be!==void 0&&Pi(li.__webglFramebuffer,Ie,Ie.texture,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,0),_t!==void 0&&br(Ie)}function st(Ie){let be=Ie.texture,_t=s.get(Ie),li=s.get(be);Ie.addEventListener("dispose",Le),Ie.isWebGLMultipleRenderTargets!==!0&&(li.__webglTexture===void 0&&(li.__webglTexture=o.createTexture()),li.__version=be.version,f.memory.textures++);let ze=Ie.isWebGLCubeRenderTarget===!0,te=Ie.isWebGLMultipleRenderTargets===!0,he=G(Ie)||v;if(ze){_t.__webglFramebuffer=[];for(let Se=0;Se<6;Se++)if(v&&be.mipmaps&&be.mipmaps.length>0){_t.__webglFramebuffer[Se]=[];for(let He=0;He<be.mipmaps.length;He++)_t.__webglFramebuffer[Se][He]=o.createFramebuffer()}else _t.__webglFramebuffer[Se]=o.createFramebuffer()}else{if(v&&be.mipmaps&&be.mipmaps.length>0){_t.__webglFramebuffer=[];for(let Se=0;Se<be.mipmaps.length;Se++)_t.__webglFramebuffer[Se]=o.createFramebuffer()}else _t.__webglFramebuffer=o.createFramebuffer();if(te)if(a.drawBuffers){let Se=Ie.texture;for(let He=0,Ye=Se.length;He<Ye;He++){let at=s.get(Se[He]);at.__webglTexture===void 0&&(at.__webglTexture=o.createTexture(),f.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(v&&Ie.samples>0&&Qi(Ie)===!1){let Se=te?be:[be];_t.__webglMultisampledFramebuffer=o.createFramebuffer(),_t.__webglColorRenderbuffer=[],t.bindFramebuffer(o.FRAMEBUFFER,_t.__webglMultisampledFramebuffer);for(let He=0;He<Se.length;He++){let Ye=Se[He];_t.__webglColorRenderbuffer[He]=o.createRenderbuffer(),o.bindRenderbuffer(o.RENDERBUFFER,_t.__webglColorRenderbuffer[He]);let at=i.convert(Ye.format,Ye.colorSpace),ye=i.convert(Ye.type),Ve=fe(Ye.internalFormat,at,ye,Ye.colorSpace,Ie.isXRRenderTarget===!0),pt=yn(Ie);o.renderbufferStorageMultisample(o.RENDERBUFFER,pt,Ve,Ie.width,Ie.height),o.framebufferRenderbuffer(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0+He,o.RENDERBUFFER,_t.__webglColorRenderbuffer[He])}o.bindRenderbuffer(o.RENDERBUFFER,null),Ie.depthBuffer&&(_t.__webglDepthRenderbuffer=o.createRenderbuffer(),Fi(_t.__webglDepthRenderbuffer,Ie,!0)),t.bindFramebuffer(o.FRAMEBUFFER,null)}}if(ze){t.bindTexture(o.TEXTURE_CUBE_MAP,li.__webglTexture),Wi(o.TEXTURE_CUBE_MAP,be,he);for(let Se=0;Se<6;Se++)if(v&&be.mipmaps&&be.mipmaps.length>0)for(let He=0;He<be.mipmaps.length;He++)Pi(_t.__webglFramebuffer[Se][He],Ie,be,o.COLOR_ATTACHMENT0,o.TEXTURE_CUBE_MAP_POSITIVE_X+Se,He);else Pi(_t.__webglFramebuffer[Se],Ie,be,o.COLOR_ATTACHMENT0,o.TEXTURE_CUBE_MAP_POSITIVE_X+Se,0);me(be,he)&&ne(o.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(te){let Se=Ie.texture;for(let He=0,Ye=Se.length;He<Ye;He++){let at=Se[He],ye=s.get(at);t.bindTexture(o.TEXTURE_2D,ye.__webglTexture),Wi(o.TEXTURE_2D,at,he),Pi(_t.__webglFramebuffer,Ie,at,o.COLOR_ATTACHMENT0+He,o.TEXTURE_2D,0),me(at,he)&&ne(o.TEXTURE_2D)}t.unbindTexture()}else{let Se=o.TEXTURE_2D;if((Ie.isWebGL3DRenderTarget||Ie.isWebGLArrayRenderTarget)&&(v?Se=Ie.isWebGL3DRenderTarget?o.TEXTURE_3D:o.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),t.bindTexture(Se,li.__webglTexture),Wi(Se,be,he),v&&be.mipmaps&&be.mipmaps.length>0)for(let He=0;He<be.mipmaps.length;He++)Pi(_t.__webglFramebuffer[He],Ie,be,o.COLOR_ATTACHMENT0,Se,He);else Pi(_t.__webglFramebuffer,Ie,be,o.COLOR_ATTACHMENT0,Se,0);me(be,he)&&ne(Se),t.unbindTexture()}Ie.depthBuffer&&br(Ie)}function $r(Ie){let be=G(Ie)||v,_t=Ie.isWebGLMultipleRenderTargets===!0?Ie.texture:[Ie.texture];for(let li=0,ze=_t.length;li<ze;li++){let te=_t[li];if(me(te,be)){let he=Ie.isWebGLCubeRenderTarget?o.TEXTURE_CUBE_MAP:o.TEXTURE_2D,Se=s.get(te).__webglTexture;t.bindTexture(he,Se),ne(he),t.unbindTexture()}}}function Ki(Ie){if(v&&Ie.samples>0&&Qi(Ie)===!1){let be=Ie.isWebGLMultipleRenderTargets?Ie.texture:[Ie.texture],_t=Ie.width,li=Ie.height,ze=o.COLOR_BUFFER_BIT,te=[],he=Ie.stencilBuffer?o.DEPTH_STENCIL_ATTACHMENT:o.DEPTH_ATTACHMENT,Se=s.get(Ie),He=Ie.isWebGLMultipleRenderTargets===!0;if(He)for(let Ye=0;Ye<be.length;Ye++)t.bindFramebuffer(o.FRAMEBUFFER,Se.__webglMultisampledFramebuffer),o.framebufferRenderbuffer(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0+Ye,o.RENDERBUFFER,null),t.bindFramebuffer(o.FRAMEBUFFER,Se.__webglFramebuffer),o.framebufferTexture2D(o.DRAW_FRAMEBUFFER,o.COLOR_ATTACHMENT0+Ye,o.TEXTURE_2D,null,0);t.bindFramebuffer(o.READ_FRAMEBUFFER,Se.__webglMultisampledFramebuffer),t.bindFramebuffer(o.DRAW_FRAMEBUFFER,Se.__webglFramebuffer);for(let Ye=0;Ye<be.length;Ye++){te.push(o.COLOR_ATTACHMENT0+Ye),Ie.depthBuffer&&te.push(he);let at=Se.__ignoreDepthValues!==void 0?Se.__ignoreDepthValues:!1;if(at===!1&&(Ie.depthBuffer&&(ze|=o.DEPTH_BUFFER_BIT),Ie.stencilBuffer&&(ze|=o.STENCIL_BUFFER_BIT)),He&&o.framebufferRenderbuffer(o.READ_FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.RENDERBUFFER,Se.__webglColorRenderbuffer[Ye]),at===!0&&(o.invalidateFramebuffer(o.READ_FRAMEBUFFER,[he]),o.invalidateFramebuffer(o.DRAW_FRAMEBUFFER,[he])),He){let ye=s.get(be[Ye]).__webglTexture;o.framebufferTexture2D(o.DRAW_FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,ye,0)}o.blitFramebuffer(0,0,_t,li,0,0,_t,li,ze,o.NEAREST),M&&o.invalidateFramebuffer(o.READ_FRAMEBUFFER,te)}if(t.bindFramebuffer(o.READ_FRAMEBUFFER,null),t.bindFramebuffer(o.DRAW_FRAMEBUFFER,null),He)for(let Ye=0;Ye<be.length;Ye++){t.bindFramebuffer(o.FRAMEBUFFER,Se.__webglMultisampledFramebuffer),o.framebufferRenderbuffer(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0+Ye,o.RENDERBUFFER,Se.__webglColorRenderbuffer[Ye]);let at=s.get(be[Ye]).__webglTexture;t.bindFramebuffer(o.FRAMEBUFFER,Se.__webglFramebuffer),o.framebufferTexture2D(o.DRAW_FRAMEBUFFER,o.COLOR_ATTACHMENT0+Ye,o.TEXTURE_2D,at,0)}t.bindFramebuffer(o.DRAW_FRAMEBUFFER,Se.__webglMultisampledFramebuffer)}}function yn(Ie){return Math.min(a.maxSamples,Ie.samples)}function Qi(Ie){let be=s.get(Ie);return v&&Ie.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&be.__useRenderToTexture!==!1}function Gn(Ie){let be=f.render.frame;C.get(Ie)!==be&&(C.set(Ie,be),Ie.update())}function Fn(Ie,be){let _t=Ie.colorSpace,li=Ie.format,ze=Ie.type;return Ie.isCompressedTexture===!0||Ie.isVideoTexture===!0||Ie.format===Yb||_t!==G0&&_t!==Al&&(fs.getTransfer(_t)===As?v===!1?e.has("EXT_sRGB")===!0&&li===rc?(Ie.format=Yb,Ie.minFilter=Ba,Ie.generateMipmaps=!1):be=o6.sRGBToLinear(be):(li!==rc||ze!==ad)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",_t)),be}this.allocateTextureUnit=Ge,this.resetTextureUnits=zt,this.setTexture2D=ht,this.setTexture2DArray=Ot,this.setTexture3D=bt,this.setTextureCube=Tt,this.rebindTextures=Ui,this.setupRenderTarget=st,this.updateRenderTargetMipmap=$r,this.updateMultisampleRenderTarget=Ki,this.setupDepthRenderbuffer=br,this.setupFrameBufferTexture=Pi,this.useMultisampledRTT=Qi}function g$(o,e,t){let s=t.isWebGL2;function a(i,f=Al){let v,x=fs.getTransfer(f);if(i===ad)return o.UNSIGNED_BYTE;if(i===TR)return o.UNSIGNED_SHORT_4_4_4_4;if(i===MR)return o.UNSIGNED_SHORT_5_5_5_1;if(i===aj)return o.BYTE;if(i===lj)return o.SHORT;if(i===I7)return o.UNSIGNED_SHORT;if(i===SR)return o.INT;if(i===rd)return o.UNSIGNED_INT;if(i===U0)return o.FLOAT;if(i===qg)return s?o.HALF_FLOAT:(v=e.get("OES_texture_half_float"),v!==null?v.HALF_FLOAT_OES:null);if(i===cj)return o.ALPHA;if(i===rc)return o.RGBA;if(i===hj)return o.LUMINANCE;if(i===dj)return o.LUMINANCE_ALPHA;if(i===Uu)return o.DEPTH_COMPONENT;if(i===lf)return o.DEPTH_STENCIL;if(i===Yb)return v=e.get("EXT_sRGB"),v!==null?v.SRGB_ALPHA_EXT:null;if(i===uj)return o.RED;if(i===ER)return o.RED_INTEGER;if(i===pj)return o.RG;if(i===AR)return o.RG_INTEGER;if(i===CR)return o.RGBA_INTEGER;if(i===ub||i===pb||i===fb||i===mb)if(x===As)if(v=e.get("WEBGL_compressed_texture_s3tc_srgb"),v!==null){if(i===ub)return v.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(i===pb)return v.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(i===fb)return v.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(i===mb)return v.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(v=e.get("WEBGL_compressed_texture_s3tc"),v!==null){if(i===ub)return v.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===pb)return v.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===fb)return v.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===mb)return v.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(i===KI||i===QI||i===eP||i===tP)if(v=e.get("WEBGL_compressed_texture_pvrtc"),v!==null){if(i===KI)return v.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(i===QI)return v.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(i===eP)return v.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(i===tP)return v.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(i===IR)return v=e.get("WEBGL_compressed_texture_etc1"),v!==null?v.COMPRESSED_RGB_ETC1_WEBGL:null;if(i===iP||i===nP)if(v=e.get("WEBGL_compressed_texture_etc"),v!==null){if(i===iP)return x===As?v.COMPRESSED_SRGB8_ETC2:v.COMPRESSED_RGB8_ETC2;if(i===nP)return x===As?v.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:v.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(i===rP||i===sP||i===oP||i===aP||i===lP||i===cP||i===hP||i===dP||i===uP||i===pP||i===fP||i===mP||i===gP||i===_P)if(v=e.get("WEBGL_compressed_texture_astc"),v!==null){if(i===rP)return x===As?v.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:v.COMPRESSED_RGBA_ASTC_4x4_KHR;if(i===sP)return x===As?v.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:v.COMPRESSED_RGBA_ASTC_5x4_KHR;if(i===oP)return x===As?v.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:v.COMPRESSED_RGBA_ASTC_5x5_KHR;if(i===aP)return x===As?v.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:v.COMPRESSED_RGBA_ASTC_6x5_KHR;if(i===lP)return x===As?v.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:v.COMPRESSED_RGBA_ASTC_6x6_KHR;if(i===cP)return x===As?v.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:v.COMPRESSED_RGBA_ASTC_8x5_KHR;if(i===hP)return x===As?v.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:v.COMPRESSED_RGBA_ASTC_8x6_KHR;if(i===dP)return x===As?v.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:v.COMPRESSED_RGBA_ASTC_8x8_KHR;if(i===uP)return x===As?v.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:v.COMPRESSED_RGBA_ASTC_10x5_KHR;if(i===pP)return x===As?v.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:v.COMPRESSED_RGBA_ASTC_10x6_KHR;if(i===fP)return x===As?v.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:v.COMPRESSED_RGBA_ASTC_10x8_KHR;if(i===mP)return x===As?v.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:v.COMPRESSED_RGBA_ASTC_10x10_KHR;if(i===gP)return x===As?v.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:v.COMPRESSED_RGBA_ASTC_12x10_KHR;if(i===_P)return x===As?v.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:v.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(i===gb||i===yP||i===vP)if(v=e.get("EXT_texture_compression_bptc"),v!==null){if(i===gb)return x===As?v.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:v.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(i===yP)return v.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(i===vP)return v.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(i===fj||i===xP||i===bP||i===wP)if(v=e.get("EXT_texture_compression_rgtc"),v!==null){if(i===gb)return v.COMPRESSED_RED_RGTC1_EXT;if(i===xP)return v.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(i===bP)return v.COMPRESSED_RED_GREEN_RGTC2_EXT;if(i===wP)return v.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return i===Bu?s?o.UNSIGNED_INT_24_8:(v=e.get("WEBGL_depth_texture"),v!==null?v.UNSIGNED_INT_24_8_WEBGL:null):o[i]!==void 0?o[i]:null}return{convert:a}}var d7=class extends hl{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}},tf=class extends dd{constructor(){super(),this.isGroup=!0,this.type="Group"}},_$={type:"move"},Wg=class{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new tf,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new tf,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new mt,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new mt),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new tf,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new mt,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new mt),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){let t=this._hand;if(t)for(let s of e.hand.values())this._getHandJoint(t,s)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,s){let a=null,i=null,f=null,v=this._targetRay,x=this._grip,M=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(M&&e.hand){f=!0;for(let Z of e.hand.values()){let G=t.getJointPose(Z,s),H=this._getHandJoint(M,Z);G!==null&&(H.matrix.fromArray(G.transform.matrix),H.matrix.decompose(H.position,H.rotation,H.scale),H.matrixWorldNeedsUpdate=!0,H.jointRadius=G.radius),H.visible=G!==null}let C=M.joints["index-finger-tip"],D=M.joints["thumb-tip"],L=C.position.distanceTo(D.position),N=.02,j=.005;M.inputState.pinching&&L>N+j?(M.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!M.inputState.pinching&&L<=N-j&&(M.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else x!==null&&e.gripSpace&&(i=t.getPose(e.gripSpace,s),i!==null&&(x.matrix.fromArray(i.transform.matrix),x.matrix.decompose(x.position,x.rotation,x.scale),x.matrixWorldNeedsUpdate=!0,i.linearVelocity?(x.hasLinearVelocity=!0,x.linearVelocity.copy(i.linearVelocity)):x.hasLinearVelocity=!1,i.angularVelocity?(x.hasAngularVelocity=!0,x.angularVelocity.copy(i.angularVelocity)):x.hasAngularVelocity=!1));v!==null&&(a=t.getPose(e.targetRaySpace,s),a===null&&i!==null&&(a=i),a!==null&&(v.matrix.fromArray(a.transform.matrix),v.matrix.decompose(v.position,v.rotation,v.scale),v.matrixWorldNeedsUpdate=!0,a.linearVelocity?(v.hasLinearVelocity=!0,v.linearVelocity.copy(a.linearVelocity)):v.hasLinearVelocity=!1,a.angularVelocity?(v.hasAngularVelocity=!0,v.angularVelocity.copy(a.angularVelocity)):v.hasAngularVelocity=!1,this.dispatchEvent(_$)))}return v!==null&&(v.visible=a!==null),x!==null&&(x.visible=i!==null),M!==null&&(M.visible=f!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){let s=new tf;s.matrixAutoUpdate=!1,s.visible=!1,e.joints[t.jointName]=s,e.add(s)}return e.joints[t.jointName]}},y$=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,v$=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepthEXT = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepthEXT = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`,u7=class{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,s){if(this.texture===null){let a=new Xu,i=e.properties.get(a);i.__webglTexture=t.texture,(t.depthNear!=s.depthNear||t.depthFar!=s.depthFar)&&(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=a}}render(e,t){if(this.texture!==null){if(this.mesh===null){let s=t.cameras[0].viewport,a=new lc({extensions:{fragDepth:!0},vertexShader:y$,fragmentShader:v$,uniforms:{depthColor:{value:this.texture},depthWidth:{value:s.z},depthHeight:{value:s.w}}});this.mesh=new dl(new g6(20,20),a)}e.render(this.mesh,t)}}reset(){this.texture=null,this.mesh=null}},p7=class extends oc{constructor(e,t){super();let s=this,a=null,i=1,f=null,v="local-floor",x=1,M=null,C=null,D=null,L=null,N=null,j=null,Z=new u7,G=t.getContextAttributes(),H=null,me=null,ne=[],fe=[],Ee=new ui,de=null,we=new hl;we.layers.enable(1),we.viewport=new Uo;let Le=new hl;Le.layers.enable(2),Le.viewport=new Uo;let De=[we,Le],se=new d7;se.layers.enable(1),se.layers.enable(2);let Ce=null,Ne=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(wt){let ei=ne[wt];return ei===void 0&&(ei=new Wg,ne[wt]=ei),ei.getTargetRaySpace()},this.getControllerGrip=function(wt){let ei=ne[wt];return ei===void 0&&(ei=new Wg,ne[wt]=ei),ei.getGripSpace()},this.getHand=function(wt){let ei=ne[wt];return ei===void 0&&(ei=new Wg,ne[wt]=ei),ei.getHandSpace()};function zt(wt){let ei=fe.indexOf(wt.inputSource);if(ei===-1)return;let vi=ne[ei];vi!==void 0&&(vi.update(wt.inputSource,wt.frame,M||f),vi.dispatchEvent({type:wt.type,data:wt.inputSource}))}function Ge(){a.removeEventListener("select",zt),a.removeEventListener("selectstart",zt),a.removeEventListener("selectend",zt),a.removeEventListener("squeeze",zt),a.removeEventListener("squeezestart",zt),a.removeEventListener("squeezeend",zt),a.removeEventListener("end",Ge),a.removeEventListener("inputsourceschange",Xe);for(let wt=0;wt<ne.length;wt++){let ei=fe[wt];ei!==null&&(fe[wt]=null,ne[wt].disconnect(ei))}Ce=null,Ne=null,Z.reset(),e.setRenderTarget(H),N=null,L=null,D=null,a=null,me=null,Wi.stop(),s.isPresenting=!1,e.setPixelRatio(de),e.setSize(Ee.width,Ee.height,!1),s.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(wt){i=wt,s.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(wt){v=wt,s.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return M||f},this.setReferenceSpace=function(wt){M=wt},this.getBaseLayer=function(){return L!==null?L:N},this.getBinding=function(){return D},this.getFrame=function(){return j},this.getSession=function(){return a},this.setSession=function(wt){return yr(this,null,function*(){if(a=wt,a!==null){if(H=e.getRenderTarget(),a.addEventListener("select",zt),a.addEventListener("selectstart",zt),a.addEventListener("selectend",zt),a.addEventListener("squeeze",zt),a.addEventListener("squeezestart",zt),a.addEventListener("squeezeend",zt),a.addEventListener("end",Ge),a.addEventListener("inputsourceschange",Xe),G.xrCompatible!==!0&&(yield t.makeXRCompatible()),de=e.getPixelRatio(),e.getSize(Ee),a.renderState.layers===void 0||e.capabilities.isWebGL2===!1){let ei={antialias:a.renderState.layers===void 0?G.antialias:!0,alpha:!0,depth:G.depth,stencil:G.stencil,framebufferScaleFactor:i};N=new XRWebGLLayer(a,t,ei),a.updateRenderState({baseLayer:N}),e.setPixelRatio(1),e.setSize(N.framebufferWidth,N.framebufferHeight,!1),me=new H0(N.framebufferWidth,N.framebufferHeight,{format:rc,type:ad,colorSpace:e.outputColorSpace,stencilBuffer:G.stencil})}else{let ei=null,vi=null,Pi=null;G.depth&&(Pi=G.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,ei=G.stencil?lf:Uu,vi=G.stencil?Bu:rd);let Fi={colorFormat:t.RGBA8,depthFormat:Pi,scaleFactor:i};D=new XRWebGLBinding(a,t),L=D.createProjectionLayer(Fi),a.updateRenderState({layers:[L]}),e.setPixelRatio(1),e.setSize(L.textureWidth,L.textureHeight,!1),me=new H0(L.textureWidth,L.textureHeight,{format:rc,type:ad,depthTexture:new y6(L.textureWidth,L.textureHeight,vi,void 0,void 0,void 0,void 0,void 0,void 0,ei),stencilBuffer:G.stencil,colorSpace:e.outputColorSpace,samples:G.antialias?4:0});let Ri=e.properties.get(me);Ri.__ignoreDepthValues=L.ignoreDepthValues}me.isXRRenderTarget=!0,this.setFoveation(x),M=null,f=yield a.requestReferenceSpace(v),Wi.setContext(a),Wi.start(),s.isPresenting=!0,s.dispatchEvent({type:"sessionstart"})}})},this.getEnvironmentBlendMode=function(){if(a!==null)return a.environmentBlendMode};function Xe(wt){for(let ei=0;ei<wt.removed.length;ei++){let vi=wt.removed[ei],Pi=fe.indexOf(vi);Pi>=0&&(fe[Pi]=null,ne[Pi].disconnect(vi))}for(let ei=0;ei<wt.added.length;ei++){let vi=wt.added[ei],Pi=fe.indexOf(vi);if(Pi===-1){for(let Ri=0;Ri<ne.length;Ri++)if(Ri>=fe.length){fe.push(vi),Pi=Ri;break}else if(fe[Ri]===null){fe[Ri]=vi,Pi=Ri;break}if(Pi===-1)break}let Fi=ne[Pi];Fi&&Fi.connect(vi)}}let ht=new mt,Ot=new mt;function bt(wt,ei,vi){ht.setFromMatrixPosition(ei.matrixWorld),Ot.setFromMatrixPosition(vi.matrixWorld);let Pi=ht.distanceTo(Ot),Fi=ei.projectionMatrix.elements,Ri=vi.projectionMatrix.elements,br=Fi[14]/(Fi[10]-1),Ui=Fi[14]/(Fi[10]+1),st=(Fi[9]+1)/Fi[5],$r=(Fi[9]-1)/Fi[5],Ki=(Fi[8]-1)/Fi[0],yn=(Ri[8]+1)/Ri[0],Qi=br*Ki,Gn=br*yn,Fn=Pi/(-Ki+yn),Ie=Fn*-Ki;ei.matrixWorld.decompose(wt.position,wt.quaternion,wt.scale),wt.translateX(Ie),wt.translateZ(Fn),wt.matrixWorld.compose(wt.position,wt.quaternion,wt.scale),wt.matrixWorldInverse.copy(wt.matrixWorld).invert();let be=br+Fn,_t=Ui+Fn,li=Qi-Ie,ze=Gn+(Pi-Ie),te=st*Ui/_t*be,he=$r*Ui/_t*be;wt.projectionMatrix.makePerspective(li,ze,te,he,be,_t),wt.projectionMatrixInverse.copy(wt.projectionMatrix).invert()}function Tt(wt,ei){ei===null?wt.matrixWorld.copy(wt.matrix):wt.matrixWorld.multiplyMatrices(ei.matrixWorld,wt.matrix),wt.matrixWorldInverse.copy(wt.matrixWorld).invert()}this.updateCamera=function(wt){if(a===null)return;Z.texture!==null&&(wt.near=Z.depthNear,wt.far=Z.depthFar),se.near=Le.near=we.near=wt.near,se.far=Le.far=we.far=wt.far,(Ce!==se.near||Ne!==se.far)&&(a.updateRenderState({depthNear:se.near,depthFar:se.far}),Ce=se.near,Ne=se.far,we.near=Ce,we.far=Ne,Le.near=Ce,Le.far=Ne,we.updateProjectionMatrix(),Le.updateProjectionMatrix(),wt.updateProjectionMatrix());let ei=wt.parent,vi=se.cameras;Tt(se,ei);for(let Pi=0;Pi<vi.length;Pi++)Tt(vi[Pi],ei);vi.length===2?bt(se,we,Le):se.projectionMatrix.copy(we.projectionMatrix),Nt(wt,se,ei)};function Nt(wt,ei,vi){vi===null?wt.matrix.copy(ei.matrixWorld):(wt.matrix.copy(vi.matrixWorld),wt.matrix.invert(),wt.matrix.multiply(ei.matrixWorld)),wt.matrix.decompose(wt.position,wt.quaternion,wt.scale),wt.updateMatrixWorld(!0),wt.projectionMatrix.copy(ei.projectionMatrix),wt.projectionMatrixInverse.copy(ei.projectionMatrixInverse),wt.isPerspectiveCamera&&(wt.fov=Jb*2*Math.atan(1/wt.projectionMatrix.elements[5]),wt.zoom=1)}this.getCamera=function(){return se},this.getFoveation=function(){if(!(L===null&&N===null))return x},this.setFoveation=function(wt){x=wt,L!==null&&(L.fixedFoveation=wt),N!==null&&N.fixedFoveation!==void 0&&(N.fixedFoveation=wt)},this.hasDepthSensing=function(){return Z.texture!==null};let Bt=null;function Yt(wt,ei){if(C=ei.getViewerPose(M||f),j=ei,C!==null){let vi=C.views;N!==null&&(e.setRenderTargetFramebuffer(me,N.framebuffer),e.setRenderTarget(me));let Pi=!1;vi.length!==se.cameras.length&&(se.cameras.length=0,Pi=!0);for(let Ri=0;Ri<vi.length;Ri++){let br=vi[Ri],Ui=null;if(N!==null)Ui=N.getViewport(br);else{let $r=D.getViewSubImage(L,br);Ui=$r.viewport,Ri===0&&(e.setRenderTargetTextures(me,$r.colorTexture,L.ignoreDepthValues?void 0:$r.depthStencilTexture),e.setRenderTarget(me))}let st=De[Ri];st===void 0&&(st=new hl,st.layers.enable(Ri),st.viewport=new Uo,De[Ri]=st),st.matrix.fromArray(br.transform.matrix),st.matrix.decompose(st.position,st.quaternion,st.scale),st.projectionMatrix.fromArray(br.projectionMatrix),st.projectionMatrixInverse.copy(st.projectionMatrix).invert(),st.viewport.set(Ui.x,Ui.y,Ui.width,Ui.height),Ri===0&&(se.matrix.copy(st.matrix),se.matrix.decompose(se.position,se.quaternion,se.scale)),Pi===!0&&se.cameras.push(st)}let Fi=a.enabledFeatures;if(Fi&&Fi.includes("depth-sensing")){let Ri=D.getDepthInformation(vi[0]);Ri&&Ri.isValid&&Ri.texture&&Z.init(e,Ri,a.renderState)}}for(let vi=0;vi<ne.length;vi++){let Pi=fe[vi],Fi=ne[vi];Pi!==null&&Fi!==void 0&&Fi.update(Pi,ei,M||f)}Z.render(e,se),Bt&&Bt(wt,ei),ei.detectedPlanes&&s.dispatchEvent({type:"planesdetected",data:ei}),j=null}let Wi=new FR;Wi.setAnimationLoop(Yt),this.setAnimationLoop=function(wt){Bt=wt},this.dispose=function(){}}};function x$(o,e){function t(G,H){G.matrixAutoUpdate===!0&&G.updateMatrix(),H.value.copy(G.matrix)}function s(G,H){H.color.getRGB(G.fogColor.value,LR(o)),H.isFog?(G.fogNear.value=H.near,G.fogFar.value=H.far):H.isFogExp2&&(G.fogDensity.value=H.density)}function a(G,H,me,ne,fe){H.isMeshBasicMaterial||H.isMeshLambertMaterial?i(G,H):H.isMeshToonMaterial?(i(G,H),D(G,H)):H.isMeshPhongMaterial?(i(G,H),C(G,H)):H.isMeshStandardMaterial?(i(G,H),L(G,H),H.isMeshPhysicalMaterial&&N(G,H,fe)):H.isMeshMatcapMaterial?(i(G,H),j(G,H)):H.isMeshDepthMaterial?i(G,H):H.isMeshDistanceMaterial?(i(G,H),Z(G,H)):H.isMeshNormalMaterial?i(G,H):H.isLineBasicMaterial?(f(G,H),H.isLineDashedMaterial&&v(G,H)):H.isPointsMaterial?x(G,H,me,ne):H.isSpriteMaterial?M(G,H):H.isShadowMaterial?(G.color.value.copy(H.color),G.opacity.value=H.opacity):H.isShaderMaterial&&(H.uniformsNeedUpdate=!1)}function i(G,H){G.opacity.value=H.opacity,H.color&&G.diffuse.value.copy(H.color),H.emissive&&G.emissive.value.copy(H.emissive).multiplyScalar(H.emissiveIntensity),H.map&&(G.map.value=H.map,t(H.map,G.mapTransform)),H.alphaMap&&(G.alphaMap.value=H.alphaMap,t(H.alphaMap,G.alphaMapTransform)),H.bumpMap&&(G.bumpMap.value=H.bumpMap,t(H.bumpMap,G.bumpMapTransform),G.bumpScale.value=H.bumpScale,H.side===Ua&&(G.bumpScale.value*=-1)),H.normalMap&&(G.normalMap.value=H.normalMap,t(H.normalMap,G.normalMapTransform),G.normalScale.value.copy(H.normalScale),H.side===Ua&&G.normalScale.value.negate()),H.displacementMap&&(G.displacementMap.value=H.displacementMap,t(H.displacementMap,G.displacementMapTransform),G.displacementScale.value=H.displacementScale,G.displacementBias.value=H.displacementBias),H.emissiveMap&&(G.emissiveMap.value=H.emissiveMap,t(H.emissiveMap,G.emissiveMapTransform)),H.specularMap&&(G.specularMap.value=H.specularMap,t(H.specularMap,G.specularMapTransform)),H.alphaTest>0&&(G.alphaTest.value=H.alphaTest);let me=e.get(H).envMap;if(me&&(G.envMap.value=me,G.flipEnvMap.value=me.isCubeTexture&&me.isRenderTargetTexture===!1?-1:1,G.reflectivity.value=H.reflectivity,G.ior.value=H.ior,G.refractionRatio.value=H.refractionRatio),H.lightMap){G.lightMap.value=H.lightMap;let ne=o._useLegacyLights===!0?Math.PI:1;G.lightMapIntensity.value=H.lightMapIntensity*ne,t(H.lightMap,G.lightMapTransform)}H.aoMap&&(G.aoMap.value=H.aoMap,G.aoMapIntensity.value=H.aoMapIntensity,t(H.aoMap,G.aoMapTransform))}function f(G,H){G.diffuse.value.copy(H.color),G.opacity.value=H.opacity,H.map&&(G.map.value=H.map,t(H.map,G.mapTransform))}function v(G,H){G.dashSize.value=H.dashSize,G.totalSize.value=H.dashSize+H.gapSize,G.scale.value=H.scale}function x(G,H,me,ne){G.diffuse.value.copy(H.color),G.opacity.value=H.opacity,G.size.value=H.size*me,G.scale.value=ne*.5,H.map&&(G.map.value=H.map,t(H.map,G.uvTransform)),H.alphaMap&&(G.alphaMap.value=H.alphaMap,t(H.alphaMap,G.alphaMapTransform)),H.alphaTest>0&&(G.alphaTest.value=H.alphaTest)}function M(G,H){G.diffuse.value.copy(H.color),G.opacity.value=H.opacity,G.rotation.value=H.rotation,H.map&&(G.map.value=H.map,t(H.map,G.mapTransform)),H.alphaMap&&(G.alphaMap.value=H.alphaMap,t(H.alphaMap,G.alphaMapTransform)),H.alphaTest>0&&(G.alphaTest.value=H.alphaTest)}function C(G,H){G.specular.value.copy(H.specular),G.shininess.value=Math.max(H.shininess,1e-4)}function D(G,H){H.gradientMap&&(G.gradientMap.value=H.gradientMap)}function L(G,H){G.metalness.value=H.metalness,H.metalnessMap&&(G.metalnessMap.value=H.metalnessMap,t(H.metalnessMap,G.metalnessMapTransform)),G.roughness.value=H.roughness,H.roughnessMap&&(G.roughnessMap.value=H.roughnessMap,t(H.roughnessMap,G.roughnessMapTransform)),e.get(H).envMap&&(G.envMapIntensity.value=H.envMapIntensity)}function N(G,H,me){G.ior.value=H.ior,H.sheen>0&&(G.sheenColor.value.copy(H.sheenColor).multiplyScalar(H.sheen),G.sheenRoughness.value=H.sheenRoughness,H.sheenColorMap&&(G.sheenColorMap.value=H.sheenColorMap,t(H.sheenColorMap,G.sheenColorMapTransform)),H.sheenRoughnessMap&&(G.sheenRoughnessMap.value=H.sheenRoughnessMap,t(H.sheenRoughnessMap,G.sheenRoughnessMapTransform))),H.clearcoat>0&&(G.clearcoat.value=H.clearcoat,G.clearcoatRoughness.value=H.clearcoatRoughness,H.clearcoatMap&&(G.clearcoatMap.value=H.clearcoatMap,t(H.clearcoatMap,G.clearcoatMapTransform)),H.clearcoatRoughnessMap&&(G.clearcoatRoughnessMap.value=H.clearcoatRoughnessMap,t(H.clearcoatRoughnessMap,G.clearcoatRoughnessMapTransform)),H.clearcoatNormalMap&&(G.clearcoatNormalMap.value=H.clearcoatNormalMap,t(H.clearcoatNormalMap,G.clearcoatNormalMapTransform),G.clearcoatNormalScale.value.copy(H.clearcoatNormalScale),H.side===Ua&&G.clearcoatNormalScale.value.negate())),H.iridescence>0&&(G.iridescence.value=H.iridescence,G.iridescenceIOR.value=H.iridescenceIOR,G.iridescenceThicknessMinimum.value=H.iridescenceThicknessRange[0],G.iridescenceThicknessMaximum.value=H.iridescenceThicknessRange[1],H.iridescenceMap&&(G.iridescenceMap.value=H.iridescenceMap,t(H.iridescenceMap,G.iridescenceMapTransform)),H.iridescenceThicknessMap&&(G.iridescenceThicknessMap.value=H.iridescenceThicknessMap,t(H.iridescenceThicknessMap,G.iridescenceThicknessMapTransform))),H.transmission>0&&(G.transmission.value=H.transmission,G.transmissionSamplerMap.value=me.texture,G.transmissionSamplerSize.value.set(me.width,me.height),H.transmissionMap&&(G.transmissionMap.value=H.transmissionMap,t(H.transmissionMap,G.transmissionMapTransform)),G.thickness.value=H.thickness,H.thicknessMap&&(G.thicknessMap.value=H.thicknessMap,t(H.thicknessMap,G.thicknessMapTransform)),G.attenuationDistance.value=H.attenuationDistance,G.attenuationColor.value.copy(H.attenuationColor)),H.anisotropy>0&&(G.anisotropyVector.value.set(H.anisotropy*Math.cos(H.anisotropyRotation),H.anisotropy*Math.sin(H.anisotropyRotation)),H.anisotropyMap&&(G.anisotropyMap.value=H.anisotropyMap,t(H.anisotropyMap,G.anisotropyMapTransform))),G.specularIntensity.value=H.specularIntensity,G.specularColor.value.copy(H.specularColor),H.specularColorMap&&(G.specularColorMap.value=H.specularColorMap,t(H.specularColorMap,G.specularColorMapTransform)),H.specularIntensityMap&&(G.specularIntensityMap.value=H.specularIntensityMap,t(H.specularIntensityMap,G.specularIntensityMapTransform))}function j(G,H){H.matcap&&(G.matcap.value=H.matcap)}function Z(G,H){let me=e.get(H).light;G.referencePosition.value.setFromMatrixPosition(me.matrixWorld),G.nearDistance.value=me.shadow.camera.near,G.farDistance.value=me.shadow.camera.far}return{refreshFogUniforms:s,refreshMaterialUniforms:a}}function b$(o,e,t,s){let a={},i={},f=[],v=t.isWebGL2?o.getParameter(o.MAX_UNIFORM_BUFFER_BINDINGS):0;function x(me,ne){let fe=ne.program;s.uniformBlockBinding(me,fe)}function M(me,ne){let fe=a[me.id];fe===void 0&&(j(me),fe=C(me),a[me.id]=fe,me.addEventListener("dispose",G));let Ee=ne.program;s.updateUBOMapping(me,Ee);let de=e.render.frame;i[me.id]!==de&&(L(me),i[me.id]=de)}function C(me){let ne=D();me.__bindingPointIndex=ne;let fe=o.createBuffer(),Ee=me.__size,de=me.usage;return o.bindBuffer(o.UNIFORM_BUFFER,fe),o.bufferData(o.UNIFORM_BUFFER,Ee,de),o.bindBuffer(o.UNIFORM_BUFFER,null),o.bindBufferBase(o.UNIFORM_BUFFER,ne,fe),fe}function D(){for(let me=0;me<v;me++)if(f.indexOf(me)===-1)return f.push(me),me;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function L(me){let ne=a[me.id],fe=me.uniforms,Ee=me.__cache;o.bindBuffer(o.UNIFORM_BUFFER,ne);for(let de=0,we=fe.length;de<we;de++){let Le=Array.isArray(fe[de])?fe[de]:[fe[de]];for(let De=0,se=Le.length;De<se;De++){let Ce=Le[De];if(N(Ce,de,De,Ee)===!0){let Ne=Ce.__offset,zt=Array.isArray(Ce.value)?Ce.value:[Ce.value],Ge=0;for(let Xe=0;Xe<zt.length;Xe++){let ht=zt[Xe],Ot=Z(ht);typeof ht=="number"||typeof ht=="boolean"?(Ce.__data[0]=ht,o.bufferSubData(o.UNIFORM_BUFFER,Ne+Ge,Ce.__data)):ht.isMatrix3?(Ce.__data[0]=ht.elements[0],Ce.__data[1]=ht.elements[1],Ce.__data[2]=ht.elements[2],Ce.__data[3]=0,Ce.__data[4]=ht.elements[3],Ce.__data[5]=ht.elements[4],Ce.__data[6]=ht.elements[5],Ce.__data[7]=0,Ce.__data[8]=ht.elements[6],Ce.__data[9]=ht.elements[7],Ce.__data[10]=ht.elements[8],Ce.__data[11]=0):(ht.toArray(Ce.__data,Ge),Ge+=Ot.storage/Float32Array.BYTES_PER_ELEMENT)}o.bufferSubData(o.UNIFORM_BUFFER,Ne,Ce.__data)}}}o.bindBuffer(o.UNIFORM_BUFFER,null)}function N(me,ne,fe,Ee){let de=me.value,we=ne+"_"+fe;if(Ee[we]===void 0)return typeof de=="number"||typeof de=="boolean"?Ee[we]=de:Ee[we]=de.clone(),!0;{let Le=Ee[we];if(typeof de=="number"||typeof de=="boolean"){if(Le!==de)return Ee[we]=de,!0}else if(Le.equals(de)===!1)return Le.copy(de),!0}return!1}function j(me){let ne=me.uniforms,fe=0,Ee=16;for(let we=0,Le=ne.length;we<Le;we++){let De=Array.isArray(ne[we])?ne[we]:[ne[we]];for(let se=0,Ce=De.length;se<Ce;se++){let Ne=De[se],zt=Array.isArray(Ne.value)?Ne.value:[Ne.value];for(let Ge=0,Xe=zt.length;Ge<Xe;Ge++){let ht=zt[Ge],Ot=Z(ht),bt=fe%Ee;bt!==0&&Ee-bt<Ot.boundary&&(fe+=Ee-bt),Ne.__data=new Float32Array(Ot.storage/Float32Array.BYTES_PER_ELEMENT),Ne.__offset=fe,fe+=Ot.storage}}}let de=fe%Ee;return de>0&&(fe+=Ee-de),me.__size=fe,me.__cache={},this}function Z(me){let ne={boundary:0,storage:0};return typeof me=="number"||typeof me=="boolean"?(ne.boundary=4,ne.storage=4):me.isVector2?(ne.boundary=8,ne.storage=8):me.isVector3||me.isColor?(ne.boundary=16,ne.storage=12):me.isVector4?(ne.boundary=16,ne.storage=16):me.isMatrix3?(ne.boundary=48,ne.storage=48):me.isMatrix4?(ne.boundary=64,ne.storage=64):me.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",me),ne}function G(me){let ne=me.target;ne.removeEventListener("dispose",G);let fe=f.indexOf(ne.__bindingPointIndex);f.splice(fe,1),o.deleteBuffer(a[ne.id]),delete a[ne.id],delete i[ne.id]}function H(){for(let me in a)o.deleteBuffer(a[me]);f=[],a={},i={}}return{bind:x,update:M,dispose:H}}var Jg=class{constructor(e={}){let{canvas:t=Aj(),context:s=null,depth:a=!0,stencil:i=!0,alpha:f=!1,antialias:v=!1,premultipliedAlpha:x=!0,preserveDrawingBuffer:M=!1,powerPreference:C="default",failIfMajorPerformanceCaveat:D=!1}=e;this.isWebGLRenderer=!0;let L;s!==null?L=s.getContextAttributes().alpha:L=f;let N=new Uint32Array(4),j=new Int32Array(4),Z=null,G=null,H=[],me=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=Bo,this._useLegacyLights=!1,this.toneMapping=od,this.toneMappingExposure=1;let ne=this,fe=!1,Ee=0,de=0,we=null,Le=-1,De=null,se=new Uo,Ce=new Uo,Ne=null,zt=new Er(0),Ge=0,Xe=t.width,ht=t.height,Ot=1,bt=null,Tt=null,Nt=new Uo(0,0,Xe,ht),Bt=new Uo(0,0,Xe,ht),Yt=!1,Wi=new m6,wt=!1,ei=!1,vi=null,Pi=new Po,Fi=new ui,Ri=new mt,br={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Ui(){return we===null?Ot:1}let st=s;function $r(Te,Qe){for(let ct=0;ct<Te.length;ct++){let gt=Te[ct],ft=t.getContext(gt,Qe);if(ft!==null)return ft}return null}try{let Te={alpha:!0,depth:a,stencil:i,antialias:v,premultipliedAlpha:x,preserveDrawingBuffer:M,powerPreference:C,failIfMajorPerformanceCaveat:D};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${C7}`),t.addEventListener("webglcontextlost",Vi,!1),t.addEventListener("webglcontextrestored",Pe,!1),t.addEventListener("webglcontextcreationerror",Zt,!1),st===null){let Qe=["webgl2","webgl","experimental-webgl"];if(ne.isWebGL1Renderer===!0&&Qe.shift(),st=$r(Qe,Te),st===null)throw $r(Qe)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}typeof WebGLRenderingContext<"u"&&st instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),st.getShaderPrecisionFormat===void 0&&(st.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Te){throw console.error("THREE.WebGLRenderer: "+Te.message),Te}let Ki,yn,Qi,Gn,Fn,Ie,be,_t,li,ze,te,he,Se,He,Ye,at,ye,Ve,pt,ut,St,Vt,Mi,en;function Oi(){Ki=new zX(st),yn=new kX(st,Ki,e),Ki.init(yn),Vt=new g$(st,Ki,yn),Qi=new f$(st,Ki,yn),Gn=new VX(st),Fn=new i$,Ie=new m$(st,Ki,Qi,Fn,yn,Vt,Gn),be=new LX(ne),_t=new NX(ne),li=new $j(st,yn),Mi=new PX(st,Ki,li,yn),ze=new BX(st,li,Gn,Mi),te=new WX(st,ze,li,Gn),pt=new jX(st,yn,Ie),at=new DX(Fn),he=new t$(ne,be,_t,Ki,yn,Mi,at),Se=new x$(ne,Fn),He=new r$,Ye=new h$(Ki,yn),Ve=new IX(ne,be,_t,Qi,te,L,x),ye=new p$(ne,te,yn),en=new b$(st,Gn,yn,Qi),ut=new RX(st,Ki,Gn,yn),St=new UX(st,Ki,Gn,yn),Gn.programs=he.programs,ne.capabilities=yn,ne.extensions=Ki,ne.properties=Fn,ne.renderLists=He,ne.shadowMap=ye,ne.state=Qi,ne.info=Gn}Oi();let yi=new p7(ne,st);this.xr=yi,this.getContext=function(){return st},this.getContextAttributes=function(){return st.getContextAttributes()},this.forceContextLoss=function(){let Te=Ki.get("WEBGL_lose_context");Te&&Te.loseContext()},this.forceContextRestore=function(){let Te=Ki.get("WEBGL_lose_context");Te&&Te.restoreContext()},this.getPixelRatio=function(){return Ot},this.setPixelRatio=function(Te){Te!==void 0&&(Ot=Te,this.setSize(Xe,ht,!1))},this.getSize=function(Te){return Te.set(Xe,ht)},this.setSize=function(Te,Qe,ct=!0){if(yi.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}Xe=Te,ht=Qe,t.width=Math.floor(Te*Ot),t.height=Math.floor(Qe*Ot),ct===!0&&(t.style.width=Te+"px",t.style.height=Qe+"px"),this.setViewport(0,0,Te,Qe)},this.getDrawingBufferSize=function(Te){return Te.set(Xe*Ot,ht*Ot).floor()},this.setDrawingBufferSize=function(Te,Qe,ct){Xe=Te,ht=Qe,Ot=ct,t.width=Math.floor(Te*ct),t.height=Math.floor(Qe*ct),this.setViewport(0,0,Te,Qe)},this.getCurrentViewport=function(Te){return Te.copy(se)},this.getViewport=function(Te){return Te.copy(Nt)},this.setViewport=function(Te,Qe,ct,gt){Te.isVector4?Nt.set(Te.x,Te.y,Te.z,Te.w):Nt.set(Te,Qe,ct,gt),Qi.viewport(se.copy(Nt).multiplyScalar(Ot).floor())},this.getScissor=function(Te){return Te.copy(Bt)},this.setScissor=function(Te,Qe,ct,gt){Te.isVector4?Bt.set(Te.x,Te.y,Te.z,Te.w):Bt.set(Te,Qe,ct,gt),Qi.scissor(Ce.copy(Bt).multiplyScalar(Ot).floor())},this.getScissorTest=function(){return Yt},this.setScissorTest=function(Te){Qi.setScissorTest(Yt=Te)},this.setOpaqueSort=function(Te){bt=Te},this.setTransparentSort=function(Te){Tt=Te},this.getClearColor=function(Te){return Te.copy(Ve.getClearColor())},this.setClearColor=function(){Ve.setClearColor.apply(Ve,arguments)},this.getClearAlpha=function(){return Ve.getClearAlpha()},this.setClearAlpha=function(){Ve.setClearAlpha.apply(Ve,arguments)},this.clear=function(Te=!0,Qe=!0,ct=!0){let gt=0;if(Te){let ft=!1;if(we!==null){let Qt=we.texture.format;ft=Qt===CR||Qt===AR||Qt===ER}if(ft){let Qt=we.texture.type,ji=Qt===ad||Qt===rd||Qt===I7||Qt===Bu||Qt===TR||Qt===MR,cn=Ve.getClearColor(),Ji=Ve.getClearAlpha(),Qn=cn.r,Dn=cn.g,Hn=cn.b;ji?(N[0]=Qn,N[1]=Dn,N[2]=Hn,N[3]=Ji,st.clearBufferuiv(st.COLOR,0,N)):(j[0]=Qn,j[1]=Dn,j[2]=Hn,j[3]=Ji,st.clearBufferiv(st.COLOR,0,j))}else gt|=st.COLOR_BUFFER_BIT}Qe&&(gt|=st.DEPTH_BUFFER_BIT),ct&&(gt|=st.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),st.clear(gt)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Vi,!1),t.removeEventListener("webglcontextrestored",Pe,!1),t.removeEventListener("webglcontextcreationerror",Zt,!1),He.dispose(),Ye.dispose(),Fn.dispose(),be.dispose(),_t.dispose(),te.dispose(),Mi.dispose(),en.dispose(),he.dispose(),yi.dispose(),yi.removeEventListener("sessionstart",Mr),yi.removeEventListener("sessionend",et),vi&&(vi.dispose(),vi=null),lt.stop()};function Vi(Te){Te.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),fe=!0}function Pe(){console.log("THREE.WebGLRenderer: Context Restored."),fe=!1;let Te=Gn.autoReset,Qe=ye.enabled,ct=ye.autoUpdate,gt=ye.needsUpdate,ft=ye.type;Oi(),Gn.autoReset=Te,ye.enabled=Qe,ye.autoUpdate=ct,ye.needsUpdate=gt,ye.type=ft}function Zt(Te){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",Te.statusMessage)}function ni(Te){let Qe=Te.target;Qe.removeEventListener("dispose",ni),gi(Qe)}function gi(Te){qi(Te),Fn.remove(Te)}function qi(Te){let Qe=Fn.get(Te).programs;Qe!==void 0&&(Qe.forEach(function(ct){he.releaseProgram(ct)}),Te.isShaderMaterial&&he.releaseShaderCache(Te))}this.renderBufferDirect=function(Te,Qe,ct,gt,ft,Qt){Qe===null&&(Qe=br);let ji=ft.isMesh&&ft.matrixWorld.determinant()<0,cn=Gi(Te,Qe,ct,gt,ft);Qi.setMaterial(gt,ji);let Ji=ct.index,Qn=1;if(gt.wireframe===!0){if(Ji=ze.getWireframeAttribute(ct),Ji===void 0)return;Qn=2}let Dn=ct.drawRange,Hn=ct.attributes.position,gs=Dn.start*Qn,Ls=(Dn.start+Dn.count)*Qn;Qt!==null&&(gs=Math.max(gs,Qt.start*Qn),Ls=Math.min(Ls,(Qt.start+Qt.count)*Qn)),Ji!==null?(gs=Math.max(gs,0),Ls=Math.min(Ls,Ji.count)):Hn!=null&&(gs=Math.max(gs,0),Ls=Math.min(Ls,Hn.count));let Cs=Ls-gs;if(Cs<0||Cs===1/0)return;Mi.setup(ft,gt,cn,ct,Ji);let So,as=ut;if(Ji!==null&&(So=li.get(Ji),as=St,as.setIndex(So)),ft.isMesh)gt.wireframe===!0?(Qi.setLineWidth(gt.wireframeLinewidth*Ui()),as.setMode(st.LINES)):as.setMode(st.TRIANGLES);else if(ft.isLine){let or=gt.linewidth;or===void 0&&(or=1),Qi.setLineWidth(or*Ui()),ft.isLineSegments?as.setMode(st.LINES):ft.isLineLoop?as.setMode(st.LINE_LOOP):as.setMode(st.LINE_STRIP)}else ft.isPoints?as.setMode(st.POINTS):ft.isSprite&&as.setMode(st.TRIANGLES);if(ft.isBatchedMesh)as.renderMultiDraw(ft._multiDrawStarts,ft._multiDrawCounts,ft._multiDrawCount);else if(ft.isInstancedMesh)as.renderInstances(gs,Cs,ft.count);else if(ct.isInstancedBufferGeometry){let or=ct._maxInstanceCount!==void 0?ct._maxInstanceCount:1/0,n0=Math.min(ct.instanceCount,or);as.renderInstances(gs,Cs,n0)}else as.render(gs,Cs)};function $n(Te,Qe,ct){Te.transparent===!0&&Te.side===ic&&Te.forceSinglePass===!1?(Te.side=Ua,Te.needsUpdate=!0,Gt(Te,Qe,ct),Te.side=cd,Te.needsUpdate=!0,Gt(Te,Qe,ct),Te.side=ic):Gt(Te,Qe,ct)}this.compile=function(Te,Qe,ct=null){ct===null&&(ct=Te),G=Ye.get(ct),G.init(),me.push(G),ct.traverseVisible(function(ft){ft.isLight&&ft.layers.test(Qe.layers)&&(G.pushLight(ft),ft.castShadow&&G.pushShadow(ft))}),Te!==ct&&Te.traverseVisible(function(ft){ft.isLight&&ft.layers.test(Qe.layers)&&(G.pushLight(ft),ft.castShadow&&G.pushShadow(ft))}),G.setupLights(ne._useLegacyLights);let gt=new Set;return Te.traverse(function(ft){let Qt=ft.material;if(Qt)if(Array.isArray(Qt))for(let ji=0;ji<Qt.length;ji++){let cn=Qt[ji];$n(cn,ct,ft),gt.add(cn)}else $n(Qt,ct,ft),gt.add(Qt)}),me.pop(),G=null,gt},this.compileAsync=function(Te,Qe,ct=null){let gt=this.compile(Te,Qe,ct);return new Promise(ft=>{function Qt(){if(gt.forEach(function(ji){Fn.get(ji).currentProgram.isReady()&&gt.delete(ji)}),gt.size===0){ft(Te);return}setTimeout(Qt,10)}Ki.get("KHR_parallel_shader_compile")!==null?Qt():setTimeout(Qt,10)})};let fr=null;function mr(Te){fr&&fr(Te)}function Mr(){lt.stop()}function et(){lt.start()}let lt=new FR;lt.setAnimationLoop(mr),typeof self<"u"&&lt.setContext(self),this.setAnimationLoop=function(Te){fr=Te,yi.setAnimationLoop(Te),Te===null?lt.stop():lt.start()},yi.addEventListener("sessionstart",Mr),yi.addEventListener("sessionend",et),this.render=function(Te,Qe){if(Qe!==void 0&&Qe.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(fe===!0)return;Te.matrixWorldAutoUpdate===!0&&Te.updateMatrixWorld(),Qe.parent===null&&Qe.matrixWorldAutoUpdate===!0&&Qe.updateMatrixWorld(),yi.enabled===!0&&yi.isPresenting===!0&&(yi.cameraAutoUpdate===!0&&yi.updateCamera(Qe),Qe=yi.getCamera()),Te.isScene===!0&&Te.onBeforeRender(ne,Te,Qe,we),G=Ye.get(Te,me.length),G.init(),me.push(G),Pi.multiplyMatrices(Qe.projectionMatrix,Qe.matrixWorldInverse),Wi.setFromProjectionMatrix(Pi),ei=this.localClippingEnabled,wt=at.init(this.clippingPlanes,ei),Z=He.get(Te,H.length),Z.init(),H.push(Z),kt(Te,Qe,0,ne.sortObjects),Z.finish(),ne.sortObjects===!0&&Z.sort(bt,Tt),this.info.render.frame++,wt===!0&&at.beginShadows();let ct=G.state.shadowsArray;if(ye.render(ct,Te,Qe),wt===!0&&at.endShadows(),this.info.autoReset===!0&&this.info.reset(),(yi.enabled===!1||yi.isPresenting===!1||yi.hasDepthSensing()===!1)&&Ve.render(Z,Te),G.setupLights(ne._useLegacyLights),Qe.isArrayCamera){let gt=Qe.cameras;for(let ft=0,Qt=gt.length;ft<Qt;ft++){let ji=gt[ft];Wt(Z,Te,ji,ji.viewport)}}else Wt(Z,Te,Qe);we!==null&&(Ie.updateMultisampleRenderTarget(we),Ie.updateRenderTargetMipmap(we)),Te.isScene===!0&&Te.onAfterRender(ne,Te,Qe),Mi.resetDefaultState(),Le=-1,De=null,me.pop(),me.length>0?G=me[me.length-1]:G=null,H.pop(),H.length>0?Z=H[H.length-1]:Z=null};function kt(Te,Qe,ct,gt){if(Te.visible===!1)return;if(Te.layers.test(Qe.layers)){if(Te.isGroup)ct=Te.renderOrder;else if(Te.isLOD)Te.autoUpdate===!0&&Te.update(Qe);else if(Te.isLight)G.pushLight(Te),Te.castShadow&&G.pushShadow(Te);else if(Te.isSprite){if(!Te.frustumCulled||Wi.intersectsSprite(Te)){gt&&Ri.setFromMatrixPosition(Te.matrixWorld).applyMatrix4(Pi);let ji=te.update(Te),cn=Te.material;cn.visible&&Z.push(Te,ji,cn,ct,Ri.z,null)}}else if((Te.isMesh||Te.isLine||Te.isPoints)&&(!Te.frustumCulled||Wi.intersectsObject(Te))){let ji=te.update(Te),cn=Te.material;if(gt&&(Te.boundingSphere!==void 0?(Te.boundingSphere===null&&Te.computeBoundingSphere(),Ri.copy(Te.boundingSphere.center)):(ji.boundingSphere===null&&ji.computeBoundingSphere(),Ri.copy(ji.boundingSphere.center)),Ri.applyMatrix4(Te.matrixWorld).applyMatrix4(Pi)),Array.isArray(cn)){let Ji=ji.groups;for(let Qn=0,Dn=Ji.length;Qn<Dn;Qn++){let Hn=Ji[Qn],gs=cn[Hn.materialIndex];gs&&gs.visible&&Z.push(Te,ji,gs,ct,Ri.z,Hn)}}else cn.visible&&Z.push(Te,ji,cn,ct,Ri.z,null)}}let Qt=Te.children;for(let ji=0,cn=Qt.length;ji<cn;ji++)kt(Qt[ji],Qe,ct,gt)}function Wt(Te,Qe,ct,gt){let ft=Te.opaque,Qt=Te.transmissive,ji=Te.transparent;G.setupLightsView(ct),wt===!0&&at.setGlobalState(ne.clippingPlanes,ct),Qt.length>0&&Ht(ft,Qt,Qe,ct),gt&&Qi.viewport(se.copy(gt)),ft.length>0&&Jt(ft,Qe,ct),Qt.length>0&&Jt(Qt,Qe,ct),ji.length>0&&Jt(ji,Qe,ct),Qi.buffers.depth.setTest(!0),Qi.buffers.depth.setMask(!0),Qi.buffers.color.setMask(!0),Qi.setPolygonOffset(!1)}function Ht(Te,Qe,ct,gt){if((ct.isScene===!0?ct.overrideMaterial:null)!==null)return;let Qt=yn.isWebGL2;vi===null&&(vi=new H0(1,1,{generateMipmaps:!0,type:Ki.has("EXT_color_buffer_half_float")?qg:ad,minFilter:zu,samples:Qt?4:0})),ne.getDrawingBufferSize(Fi),Qt?vi.setSize(Fi.x,Fi.y):vi.setSize(Kb(Fi.x),Kb(Fi.y));let ji=ne.getRenderTarget();ne.setRenderTarget(vi),ne.getClearColor(zt),Ge=ne.getClearAlpha(),Ge<1&&ne.setClearColor(16777215,.5),ne.clear();let cn=ne.toneMapping;ne.toneMapping=od,Jt(Te,ct,gt),Ie.updateMultisampleRenderTarget(vi),Ie.updateRenderTargetMipmap(vi);let Ji=!1;for(let Qn=0,Dn=Qe.length;Qn<Dn;Qn++){let Hn=Qe[Qn],gs=Hn.object,Ls=Hn.geometry,Cs=Hn.material,So=Hn.group;if(Cs.side===ic&&gs.layers.test(gt.layers)){let as=Cs.side;Cs.side=Ua,Cs.needsUpdate=!0,Kt(gs,ct,gt,Ls,Cs,So),Cs.side=as,Cs.needsUpdate=!0,Ji=!0}}Ji===!0&&(Ie.updateMultisampleRenderTarget(vi),Ie.updateRenderTargetMipmap(vi)),ne.setRenderTarget(ji),ne.setClearColor(zt,Ge),ne.toneMapping=cn}function Jt(Te,Qe,ct){let gt=Qe.isScene===!0?Qe.overrideMaterial:null;for(let ft=0,Qt=Te.length;ft<Qt;ft++){let ji=Te[ft],cn=ji.object,Ji=ji.geometry,Qn=gt===null?ji.material:gt,Dn=ji.group;cn.layers.test(ct.layers)&&Kt(cn,Qe,ct,Ji,Qn,Dn)}}function Kt(Te,Qe,ct,gt,ft,Qt){Te.onBeforeRender(ne,Qe,ct,gt,ft,Qt),Te.modelViewMatrix.multiplyMatrices(ct.matrixWorldInverse,Te.matrixWorld),Te.normalMatrix.getNormalMatrix(Te.modelViewMatrix),ft.onBeforeRender(ne,Qe,ct,gt,Te,Qt),ft.transparent===!0&&ft.side===ic&&ft.forceSinglePass===!1?(ft.side=Ua,ft.needsUpdate=!0,ne.renderBufferDirect(ct,Qe,gt,ft,Te,Qt),ft.side=cd,ft.needsUpdate=!0,ne.renderBufferDirect(ct,Qe,gt,ft,Te,Qt),ft.side=ic):ne.renderBufferDirect(ct,Qe,gt,ft,Te,Qt),Te.onAfterRender(ne,Qe,ct,gt,ft,Qt)}function Gt(Te,Qe,ct){Qe.isScene!==!0&&(Qe=br);let gt=Fn.get(Te),ft=G.state.lights,Qt=G.state.shadowsArray,ji=ft.state.version,cn=he.getParameters(Te,ft.state,Qt,Qe,ct),Ji=he.getProgramCacheKey(cn),Qn=gt.programs;gt.environment=Te.isMeshStandardMaterial?Qe.environment:null,gt.fog=Qe.fog,gt.envMap=(Te.isMeshStandardMaterial?_t:be).get(Te.envMap||gt.environment),Qn===void 0&&(Te.addEventListener("dispose",ni),Qn=new Map,gt.programs=Qn);let Dn=Qn.get(Ji);if(Dn!==void 0){if(gt.currentProgram===Dn&&gt.lightsStateVersion===ji)return $t(Te,cn),Dn}else cn.uniforms=he.getUniforms(Te),Te.onBuild(ct,cn,ne),Te.onBeforeCompile(cn,ne),Dn=he.acquireProgram(cn,Ji),Qn.set(Ji,Dn),gt.uniforms=cn.uniforms;let Hn=gt.uniforms;return(!Te.isShaderMaterial&&!Te.isRawShaderMaterial||Te.clipping===!0)&&(Hn.clippingPlanes=at.uniform),$t(Te,cn),gt.needsLights=bi(Te),gt.lightsStateVersion=ji,gt.needsLights&&(Hn.ambientLightColor.value=ft.state.ambient,Hn.lightProbe.value=ft.state.probe,Hn.directionalLights.value=ft.state.directional,Hn.directionalLightShadows.value=ft.state.directionalShadow,Hn.spotLights.value=ft.state.spot,Hn.spotLightShadows.value=ft.state.spotShadow,Hn.rectAreaLights.value=ft.state.rectArea,Hn.ltc_1.value=ft.state.rectAreaLTC1,Hn.ltc_2.value=ft.state.rectAreaLTC2,Hn.pointLights.value=ft.state.point,Hn.pointLightShadows.value=ft.state.pointShadow,Hn.hemisphereLights.value=ft.state.hemi,Hn.directionalShadowMap.value=ft.state.directionalShadowMap,Hn.directionalShadowMatrix.value=ft.state.directionalShadowMatrix,Hn.spotShadowMap.value=ft.state.spotShadowMap,Hn.spotLightMatrix.value=ft.state.spotLightMatrix,Hn.spotLightMap.value=ft.state.spotLightMap,Hn.pointShadowMap.value=ft.state.pointShadowMap,Hn.pointShadowMatrix.value=ft.state.pointShadowMatrix),gt.currentProgram=Dn,gt.uniformsList=null,Dn}function ri(Te){if(Te.uniformsList===null){let Qe=Te.currentProgram.getUniforms();Te.uniformsList=sf.seqWithValue(Qe.seq,Te.uniforms)}return Te.uniformsList}function $t(Te,Qe){let ct=Fn.get(Te);ct.outputColorSpace=Qe.outputColorSpace,ct.batching=Qe.batching,ct.instancing=Qe.instancing,ct.instancingColor=Qe.instancingColor,ct.skinning=Qe.skinning,ct.morphTargets=Qe.morphTargets,ct.morphNormals=Qe.morphNormals,ct.morphColors=Qe.morphColors,ct.morphTargetsCount=Qe.morphTargetsCount,ct.numClippingPlanes=Qe.numClippingPlanes,ct.numIntersection=Qe.numClipIntersection,ct.vertexAlphas=Qe.vertexAlphas,ct.vertexTangents=Qe.vertexTangents,ct.toneMapping=Qe.toneMapping}function Gi(Te,Qe,ct,gt,ft){Qe.isScene!==!0&&(Qe=br),Ie.resetTextureUnits();let Qt=Qe.fog,ji=gt.isMeshStandardMaterial?Qe.environment:null,cn=we===null?ne.outputColorSpace:we.isXRRenderTarget===!0?we.texture.colorSpace:G0,Ji=(gt.isMeshStandardMaterial?_t:be).get(gt.envMap||ji),Qn=gt.vertexColors===!0&&!!ct.attributes.color&&ct.attributes.color.itemSize===4,Dn=!!ct.attributes.tangent&&(!!gt.normalMap||gt.anisotropy>0),Hn=!!ct.morphAttributes.position,gs=!!ct.morphAttributes.normal,Ls=!!ct.morphAttributes.color,Cs=od;gt.toneMapped&&(we===null||we.isXRRenderTarget===!0)&&(Cs=ne.toneMapping);let So=ct.morphAttributes.position||ct.morphAttributes.normal||ct.morphAttributes.color,as=So!==void 0?So.length:0,or=Fn.get(gt),n0=G.state.lights;if(wt===!0&&(ei===!0||Te!==De)){let Vo=Te===De&&gt.id===Le;at.setState(gt,Te,Vo)}let rs=!1;gt.version===or.__version?(or.needsLights&&or.lightsStateVersion!==n0.state.version||or.outputColorSpace!==cn||ft.isBatchedMesh&&or.batching===!1||!ft.isBatchedMesh&&or.batching===!0||ft.isInstancedMesh&&or.instancing===!1||!ft.isInstancedMesh&&or.instancing===!0||ft.isSkinnedMesh&&or.skinning===!1||!ft.isSkinnedMesh&&or.skinning===!0||ft.isInstancedMesh&&or.instancingColor===!0&&ft.instanceColor===null||ft.isInstancedMesh&&or.instancingColor===!1&&ft.instanceColor!==null||or.envMap!==Ji||gt.fog===!0&&or.fog!==Qt||or.numClippingPlanes!==void 0&&(or.numClippingPlanes!==at.numPlanes||or.numIntersection!==at.numIntersection)||or.vertexAlphas!==Qn||or.vertexTangents!==Dn||or.morphTargets!==Hn||or.morphNormals!==gs||or.morphColors!==Ls||or.toneMapping!==Cs||yn.isWebGL2===!0&&or.morphTargetsCount!==as)&&(rs=!0):(rs=!0,or.__version=gt.version);let Ga=or.currentProgram;rs===!0&&(Ga=Gt(gt,Qe,ft));let fo=!1,qr=!1,Tn=!1,Ws=Ga.getUniforms(),wa=or.uniforms;if(Qi.useProgram(Ga.program)&&(fo=!0,qr=!0,Tn=!0),gt.id!==Le&&(Le=gt.id,qr=!0),fo||De!==Te){Ws.setValue(st,"projectionMatrix",Te.projectionMatrix),Ws.setValue(st,"viewMatrix",Te.matrixWorldInverse);let Vo=Ws.map.cameraPosition;Vo!==void 0&&Vo.setValue(st,Ri.setFromMatrixPosition(Te.matrixWorld)),yn.logarithmicDepthBuffer&&Ws.setValue(st,"logDepthBufFC",2/(Math.log(Te.far+1)/Math.LN2)),(gt.isMeshPhongMaterial||gt.isMeshToonMaterial||gt.isMeshLambertMaterial||gt.isMeshBasicMaterial||gt.isMeshStandardMaterial||gt.isShaderMaterial)&&Ws.setValue(st,"isOrthographic",Te.isOrthographicCamera===!0),De!==Te&&(De=Te,qr=!0,Tn=!0)}if(ft.isSkinnedMesh){Ws.setOptional(st,ft,"bindMatrix"),Ws.setOptional(st,ft,"bindMatrixInverse");let Vo=ft.skeleton;Vo&&(yn.floatVertexTextures?(Vo.boneTexture===null&&Vo.computeBoneTexture(),Ws.setValue(st,"boneTexture",Vo.boneTexture,Ie)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}ft.isBatchedMesh&&(Ws.setOptional(st,ft,"batchingTexture"),Ws.setValue(st,"batchingTexture",ft._matricesTexture,Ie));let r0=ct.morphAttributes;if((r0.position!==void 0||r0.normal!==void 0||r0.color!==void 0&&yn.isWebGL2===!0)&&pt.update(ft,ct,Ga),(qr||or.receiveShadow!==ft.receiveShadow)&&(or.receiveShadow=ft.receiveShadow,Ws.setValue(st,"receiveShadow",ft.receiveShadow)),gt.isMeshGouraudMaterial&&gt.envMap!==null&&(wa.envMap.value=Ji,wa.flipEnvMap.value=Ji.isCubeTexture&&Ji.isRenderTargetTexture===!1?-1:1),qr&&(Ws.setValue(st,"toneMappingExposure",ne.toneMappingExposure),or.needsLights&&kn(wa,Tn),Qt&&gt.fog===!0&&Se.refreshFogUniforms(wa,Qt),Se.refreshMaterialUniforms(wa,gt,Ot,ht,vi),sf.upload(st,ri(or),wa,Ie)),gt.isShaderMaterial&&gt.uniformsNeedUpdate===!0&&(sf.upload(st,ri(or),wa,Ie),gt.uniformsNeedUpdate=!1),gt.isSpriteMaterial&&Ws.setValue(st,"center",ft.center),Ws.setValue(st,"modelViewMatrix",ft.modelViewMatrix),Ws.setValue(st,"normalMatrix",ft.normalMatrix),Ws.setValue(st,"modelMatrix",ft.matrixWorld),gt.isShaderMaterial||gt.isRawShaderMaterial){let Vo=gt.uniformsGroups;for(let Go=0,Md=Vo.length;Go<Md;Go++)if(yn.isWebGL2){let op=Vo[Go];en.update(op,Ga),en.bind(op,Ga)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return Ga}function kn(Te,Qe){Te.ambientLightColor.needsUpdate=Qe,Te.lightProbe.needsUpdate=Qe,Te.directionalLights.needsUpdate=Qe,Te.directionalLightShadows.needsUpdate=Qe,Te.pointLights.needsUpdate=Qe,Te.pointLightShadows.needsUpdate=Qe,Te.spotLights.needsUpdate=Qe,Te.spotLightShadows.needsUpdate=Qe,Te.rectAreaLights.needsUpdate=Qe,Te.hemisphereLights.needsUpdate=Qe}function bi(Te){return Te.isMeshLambertMaterial||Te.isMeshToonMaterial||Te.isMeshPhongMaterial||Te.isMeshStandardMaterial||Te.isShadowMaterial||Te.isShaderMaterial&&Te.lights===!0}this.getActiveCubeFace=function(){return Ee},this.getActiveMipmapLevel=function(){return de},this.getRenderTarget=function(){return we},this.setRenderTargetTextures=function(Te,Qe,ct){Fn.get(Te.texture).__webglTexture=Qe,Fn.get(Te.depthTexture).__webglTexture=ct;let gt=Fn.get(Te);gt.__hasExternalTextures=!0,gt.__hasExternalTextures&&(gt.__autoAllocateDepthBuffer=ct===void 0,gt.__autoAllocateDepthBuffer||Ki.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),gt.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(Te,Qe){let ct=Fn.get(Te);ct.__webglFramebuffer=Qe,ct.__useDefaultFramebuffer=Qe===void 0},this.setRenderTarget=function(Te,Qe=0,ct=0){we=Te,Ee=Qe,de=ct;let gt=!0,ft=null,Qt=!1,ji=!1;if(Te){let Ji=Fn.get(Te);Ji.__useDefaultFramebuffer!==void 0?(Qi.bindFramebuffer(st.FRAMEBUFFER,null),gt=!1):Ji.__webglFramebuffer===void 0?Ie.setupRenderTarget(Te):Ji.__hasExternalTextures&&Ie.rebindTextures(Te,Fn.get(Te.texture).__webglTexture,Fn.get(Te.depthTexture).__webglTexture);let Qn=Te.texture;(Qn.isData3DTexture||Qn.isDataArrayTexture||Qn.isCompressedArrayTexture)&&(ji=!0);let Dn=Fn.get(Te).__webglFramebuffer;Te.isWebGLCubeRenderTarget?(Array.isArray(Dn[Qe])?ft=Dn[Qe][ct]:ft=Dn[Qe],Qt=!0):yn.isWebGL2&&Te.samples>0&&Ie.useMultisampledRTT(Te)===!1?ft=Fn.get(Te).__webglMultisampledFramebuffer:Array.isArray(Dn)?ft=Dn[ct]:ft=Dn,se.copy(Te.viewport),Ce.copy(Te.scissor),Ne=Te.scissorTest}else se.copy(Nt).multiplyScalar(Ot).floor(),Ce.copy(Bt).multiplyScalar(Ot).floor(),Ne=Yt;if(Qi.bindFramebuffer(st.FRAMEBUFFER,ft)&&yn.drawBuffers&&gt&&Qi.drawBuffers(Te,ft),Qi.viewport(se),Qi.scissor(Ce),Qi.setScissorTest(Ne),Qt){let Ji=Fn.get(Te.texture);st.framebufferTexture2D(st.FRAMEBUFFER,st.COLOR_ATTACHMENT0,st.TEXTURE_CUBE_MAP_POSITIVE_X+Qe,Ji.__webglTexture,ct)}else if(ji){let Ji=Fn.get(Te.texture),Qn=Qe||0;st.framebufferTextureLayer(st.FRAMEBUFFER,st.COLOR_ATTACHMENT0,Ji.__webglTexture,ct||0,Qn)}Le=-1},this.readRenderTargetPixels=function(Te,Qe,ct,gt,ft,Qt,ji){if(!(Te&&Te.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let cn=Fn.get(Te).__webglFramebuffer;if(Te.isWebGLCubeRenderTarget&&ji!==void 0&&(cn=cn[ji]),cn){Qi.bindFramebuffer(st.FRAMEBUFFER,cn);try{let Ji=Te.texture,Qn=Ji.format,Dn=Ji.type;if(Qn!==rc&&Vt.convert(Qn)!==st.getParameter(st.IMPLEMENTATION_COLOR_READ_FORMAT)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}let Hn=Dn===qg&&(Ki.has("EXT_color_buffer_half_float")||yn.isWebGL2&&Ki.has("EXT_color_buffer_float"));if(Dn!==ad&&Vt.convert(Dn)!==st.getParameter(st.IMPLEMENTATION_COLOR_READ_TYPE)&&!(Dn===U0&&(yn.isWebGL2||Ki.has("OES_texture_float")||Ki.has("WEBGL_color_buffer_float")))&&!Hn){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Qe>=0&&Qe<=Te.width-gt&&ct>=0&&ct<=Te.height-ft&&st.readPixels(Qe,ct,gt,ft,Vt.convert(Qn),Vt.convert(Dn),Qt)}finally{let Ji=we!==null?Fn.get(we).__webglFramebuffer:null;Qi.bindFramebuffer(st.FRAMEBUFFER,Ji)}}},this.copyFramebufferToTexture=function(Te,Qe,ct=0){let gt=Math.pow(2,-ct),ft=Math.floor(Qe.image.width*gt),Qt=Math.floor(Qe.image.height*gt);Ie.setTexture2D(Qe,0),st.copyTexSubImage2D(st.TEXTURE_2D,ct,0,0,Te.x,Te.y,ft,Qt),Qi.unbindTexture()},this.copyTextureToTexture=function(Te,Qe,ct,gt=0){let ft=Qe.image.width,Qt=Qe.image.height,ji=Vt.convert(ct.format),cn=Vt.convert(ct.type);Ie.setTexture2D(ct,0),st.pixelStorei(st.UNPACK_FLIP_Y_WEBGL,ct.flipY),st.pixelStorei(st.UNPACK_PREMULTIPLY_ALPHA_WEBGL,ct.premultiplyAlpha),st.pixelStorei(st.UNPACK_ALIGNMENT,ct.unpackAlignment),Qe.isDataTexture?st.texSubImage2D(st.TEXTURE_2D,gt,Te.x,Te.y,ft,Qt,ji,cn,Qe.image.data):Qe.isCompressedTexture?st.compressedTexSubImage2D(st.TEXTURE_2D,gt,Te.x,Te.y,Qe.mipmaps[0].width,Qe.mipmaps[0].height,ji,Qe.mipmaps[0].data):st.texSubImage2D(st.TEXTURE_2D,gt,Te.x,Te.y,ji,cn,Qe.image),gt===0&&ct.generateMipmaps&&st.generateMipmap(st.TEXTURE_2D),Qi.unbindTexture()},this.copyTextureToTexture3D=function(Te,Qe,ct,gt,ft=0){if(ne.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}let Qt=Te.max.x-Te.min.x+1,ji=Te.max.y-Te.min.y+1,cn=Te.max.z-Te.min.z+1,Ji=Vt.convert(gt.format),Qn=Vt.convert(gt.type),Dn;if(gt.isData3DTexture)Ie.setTexture3D(gt,0),Dn=st.TEXTURE_3D;else if(gt.isDataArrayTexture||gt.isCompressedArrayTexture)Ie.setTexture2DArray(gt,0),Dn=st.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}st.pixelStorei(st.UNPACK_FLIP_Y_WEBGL,gt.flipY),st.pixelStorei(st.UNPACK_PREMULTIPLY_ALPHA_WEBGL,gt.premultiplyAlpha),st.pixelStorei(st.UNPACK_ALIGNMENT,gt.unpackAlignment);let Hn=st.getParameter(st.UNPACK_ROW_LENGTH),gs=st.getParameter(st.UNPACK_IMAGE_HEIGHT),Ls=st.getParameter(st.UNPACK_SKIP_PIXELS),Cs=st.getParameter(st.UNPACK_SKIP_ROWS),So=st.getParameter(st.UNPACK_SKIP_IMAGES),as=ct.isCompressedTexture?ct.mipmaps[ft]:ct.image;st.pixelStorei(st.UNPACK_ROW_LENGTH,as.width),st.pixelStorei(st.UNPACK_IMAGE_HEIGHT,as.height),st.pixelStorei(st.UNPACK_SKIP_PIXELS,Te.min.x),st.pixelStorei(st.UNPACK_SKIP_ROWS,Te.min.y),st.pixelStorei(st.UNPACK_SKIP_IMAGES,Te.min.z),ct.isDataTexture||ct.isData3DTexture?st.texSubImage3D(Dn,ft,Qe.x,Qe.y,Qe.z,Qt,ji,cn,Ji,Qn,as.data):ct.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),st.compressedTexSubImage3D(Dn,ft,Qe.x,Qe.y,Qe.z,Qt,ji,cn,Ji,as.data)):st.texSubImage3D(Dn,ft,Qe.x,Qe.y,Qe.z,Qt,ji,cn,Ji,Qn,as),st.pixelStorei(st.UNPACK_ROW_LENGTH,Hn),st.pixelStorei(st.UNPACK_IMAGE_HEIGHT,gs),st.pixelStorei(st.UNPACK_SKIP_PIXELS,Ls),st.pixelStorei(st.UNPACK_SKIP_ROWS,Cs),st.pixelStorei(st.UNPACK_SKIP_IMAGES,So),ft===0&&gt.generateMipmaps&&st.generateMipmap(Dn),Qi.unbindTexture()},this.initTexture=function(Te){Te.isCubeTexture?Ie.setTextureCube(Te,0):Te.isData3DTexture?Ie.setTexture3D(Te,0):Te.isDataArrayTexture||Te.isCompressedArrayTexture?Ie.setTexture2DArray(Te,0):Ie.setTexture2D(Te,0),Qi.unbindTexture()},this.resetState=function(){Ee=0,de=0,we=null,Qi.reset(),Mi.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return V0}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;let t=this.getContext();t.drawingBufferColorSpace=e===P7?"display-p3":"srgb",t.unpackColorSpace=fs.workingColorSpace===A6?"display-p3":"srgb"}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===Bo?Vu:PR}set outputEncoding(e){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=e===Vu?Bo:G0}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(e){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=e}},f7=class extends Jg{};f7.prototype.isWebGL1Renderer=!0;var v6=class extends dd{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){let t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t}},m7=class{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=$b,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=ld()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return Gu("THREE.InterleavedBuffer: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,s){e*=this.stride,s*=t.stride;for(let a=0,i=this.stride;a<i;a++)this.array[e+a]=t.array[s+a];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=ld()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);let t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),s=new this.constructor(t,this.stride);return s.setUsage(this.usage),s}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=ld()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}},fa=new mt,Kg=class o{constructor(e,t,s,a=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=s,this.normalized=a}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,s=this.data.count;t<s;t++)fa.fromBufferAttribute(this,t),fa.applyMatrix4(e),this.setXYZ(t,fa.x,fa.y,fa.z);return this}applyNormalMatrix(e){for(let t=0,s=this.count;t<s;t++)fa.fromBufferAttribute(this,t),fa.applyNormalMatrix(e),this.setXYZ(t,fa.x,fa.y,fa.z);return this}transformDirection(e){for(let t=0,s=this.count;t<s;t++)fa.fromBufferAttribute(this,t),fa.transformDirection(e),this.setXYZ(t,fa.x,fa.y,fa.z);return this}getComponent(e,t){let s=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(s=$c(s,this.array)),s}setComponent(e,t,s){return this.normalized&&(s=ps(s,this.array)),this.data.array[e*this.data.stride+this.offset+t]=s,this}setX(e,t){return this.normalized&&(t=ps(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=ps(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=ps(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=ps(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=$c(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=$c(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=$c(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=$c(t,this.array)),t}setXY(e,t,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=ps(t,this.array),s=ps(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=s,this}setXYZ(e,t,s,a){return e=e*this.data.stride+this.offset,this.normalized&&(t=ps(t,this.array),s=ps(s,this.array),a=ps(a,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=s,this.data.array[e+2]=a,this}setXYZW(e,t,s,a,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=ps(t,this.array),s=ps(s,this.array),a=ps(a,this.array),i=ps(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=s,this.data.array[e+2]=a,this.data.array[e+3]=i,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");let t=[];for(let s=0;s<this.count;s++){let a=s*this.data.stride+this.offset;for(let i=0;i<this.itemSize;i++)t.push(this.data.array[a+i])}return new Ro(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new o(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");let t=[];for(let s=0;s<this.count;s++){let a=s*this.data.stride+this.offset;for(let i=0;i<this.itemSize;i++)t.push(this.data.array[a+i])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}};var x6=class extends Ro{constructor(e,t,s,a=1){super(e,t,s),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=a}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){let e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}};var g7=class extends hd{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Er(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}},pR=new mt,fR=new mt,mR=new Po,Gb=new Zg,Z3=new ju,_7=class extends dd{constructor(e=new Cl,t=new g7){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){let e=this.geometry;if(e.index===null){let t=e.attributes.position,s=[0];for(let a=1,i=t.count;a<i;a++)pR.fromBufferAttribute(t,a-1),fR.fromBufferAttribute(t,a),s[a]=s[a-1],s[a]+=pR.distanceTo(fR);e.setAttribute("lineDistance",new sc(s,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){let s=this.geometry,a=this.matrixWorld,i=e.params.Line.threshold,f=s.drawRange;if(s.boundingSphere===null&&s.computeBoundingSphere(),Z3.copy(s.boundingSphere),Z3.applyMatrix4(a),Z3.radius+=i,e.ray.intersectsSphere(Z3)===!1)return;mR.copy(a).invert(),Gb.copy(e.ray).applyMatrix4(mR);let v=i/((this.scale.x+this.scale.y+this.scale.z)/3),x=v*v,M=new mt,C=new mt,D=new mt,L=new mt,N=this.isLineSegments?2:1,j=s.index,G=s.attributes.position;if(j!==null){let H=Math.max(0,f.start),me=Math.min(j.count,f.start+f.count);for(let ne=H,fe=me-1;ne<fe;ne+=N){let Ee=j.getX(ne),de=j.getX(ne+1);if(M.fromBufferAttribute(G,Ee),C.fromBufferAttribute(G,de),Gb.distanceSqToSegment(M,C,L,D)>x)continue;L.applyMatrix4(this.matrixWorld);let Le=e.ray.origin.distanceTo(L);Le<e.near||Le>e.far||t.push({distance:Le,point:D.clone().applyMatrix4(this.matrixWorld),index:ne,face:null,faceIndex:null,object:this})}}else{let H=Math.max(0,f.start),me=Math.min(G.count,f.start+f.count);for(let ne=H,fe=me-1;ne<fe;ne+=N){if(M.fromBufferAttribute(G,ne),C.fromBufferAttribute(G,ne+1),Gb.distanceSqToSegment(M,C,L,D)>x)continue;L.applyMatrix4(this.matrixWorld);let de=e.ray.origin.distanceTo(L);de<e.near||de>e.far||t.push({distance:de,point:D.clone().applyMatrix4(this.matrixWorld),index:ne,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){let t=this.geometry.morphAttributes,s=Object.keys(t);if(s.length>0){let a=t[s[0]];if(a!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let i=0,f=a.length;i<f;i++){let v=a[i].name||String(i);this.morphTargetInfluences.push(0),this.morphTargetDictionary[v]=i}}}}},gR=new mt,_R=new mt,b6=class extends _7{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){let e=this.geometry;if(e.index===null){let t=e.attributes.position,s=[];for(let a=0,i=t.count;a<i;a+=2)gR.fromBufferAttribute(t,a),_R.fromBufferAttribute(t,a+1),s[a]=a===0?0:s[a-1],s[a+1]=s[a]+gR.distanceTo(_R);e.setAttribute("lineDistance",new sc(s,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}};var y7=class extends hd{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Er(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}},yR=new Po,v7=new Zg,$3=new ju,Y3=new mt,w6=class extends dd{constructor(e=new Cl,t=new y7){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){let s=this.geometry,a=this.matrixWorld,i=e.params.Points.threshold,f=s.drawRange;if(s.boundingSphere===null&&s.computeBoundingSphere(),$3.copy(s.boundingSphere),$3.applyMatrix4(a),$3.radius+=i,e.ray.intersectsSphere($3)===!1)return;yR.copy(a).invert(),v7.copy(e.ray).applyMatrix4(yR);let v=i/((this.scale.x+this.scale.y+this.scale.z)/3),x=v*v,M=s.index,D=s.attributes.position;if(M!==null){let L=Math.max(0,f.start),N=Math.min(M.count,f.start+f.count);for(let j=L,Z=N;j<Z;j++){let G=M.getX(j);Y3.fromBufferAttribute(D,G),vR(Y3,G,x,a,e,t,this)}}else{let L=Math.max(0,f.start),N=Math.min(D.count,f.start+f.count);for(let j=L,Z=N;j<Z;j++)Y3.fromBufferAttribute(D,j),vR(Y3,j,x,a,e,t,this)}}updateMorphTargets(){let t=this.geometry.morphAttributes,s=Object.keys(t);if(s.length>0){let a=t[s[0]];if(a!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let i=0,f=a.length;i<f;i++){let v=a[i].name||String(i);this.morphTargetInfluences.push(0),this.morphTargetDictionary[v]=i}}}}};function vR(o,e,t,s,a,i,f){let v=v7.distanceSqToPoint(o);if(v<t){let x=new mt;v7.closestPointToPoint(o,x),x.applyMatrix4(s);let M=a.ray.origin.distanceTo(x);if(M<a.near||M>a.far)return;i.push({distance:M,distanceToRay:Math.sqrt(v),point:x,index:e,face:null,object:f})}}var Qg=class extends lc{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}};function J3(o,e,t){return!o||!t&&o.constructor===e?o:typeof e.BYTES_PER_ELEMENT=="number"?new e(o):Array.prototype.slice.call(o)}function w$(o){return ArrayBuffer.isView(o)&&!(o instanceof DataView)}var hf=class{constructor(e,t,s,a){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=a!==void 0?a:new t.constructor(s),this.sampleValues=t,this.valueSize=s,this.settings=null,this.DefaultSettings_={}}evaluate(e){let t=this.parameterPositions,s=this._cachedIndex,a=t[s],i=t[s-1];e:{t:{let f;i:{n:if(!(e<a)){for(let v=s+2;;){if(a===void 0){if(e<i)break n;return s=t.length,this._cachedIndex=s,this.copySampleValue_(s-1)}if(s===v)break;if(i=a,a=t[++s],e<a)break t}f=t.length;break i}if(!(e>=i)){let v=t[1];e<v&&(s=2,i=v);for(let x=s-2;;){if(i===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(s===x)break;if(a=i,i=t[--s-1],e>=i)break t}f=s,s=0;break i}break e}for(;s<f;){let v=s+f>>>1;e<t[v]?f=v:s=v+1}if(a=t[s],i=t[s-1],i===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(a===void 0)return s=t.length,this._cachedIndex=s,this.copySampleValue_(s-1)}this._cachedIndex=s,this.intervalChanged_(s,i,a)}return this.interpolate_(s,i,e,a)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){let t=this.resultBuffer,s=this.sampleValues,a=this.valueSize,i=e*a;for(let f=0;f!==a;++f)t[f]=s[i+f];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}},x7=class extends hf{constructor(e,t,s,a){super(e,t,s,a),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:SP,endingEnd:SP}}intervalChanged_(e,t,s){let a=this.parameterPositions,i=e-2,f=e+1,v=a[i],x=a[f];if(v===void 0)switch(this.getSettings_().endingStart){case TP:i=e,v=2*t-s;break;case MP:i=a.length-2,v=t+a[i]-a[i+1];break;default:i=e,v=s}if(x===void 0)switch(this.getSettings_().endingEnd){case TP:f=e,x=2*s-t;break;case MP:f=1,x=s+a[1]-a[0];break;default:f=e-1,x=t}let M=(s-t)*.5,C=this.valueSize;this._weightPrev=M/(t-v),this._weightNext=M/(x-s),this._offsetPrev=i*C,this._offsetNext=f*C}interpolate_(e,t,s,a){let i=this.resultBuffer,f=this.sampleValues,v=this.valueSize,x=e*v,M=x-v,C=this._offsetPrev,D=this._offsetNext,L=this._weightPrev,N=this._weightNext,j=(s-t)/(a-t),Z=j*j,G=Z*j,H=-L*G+2*L*Z-L*j,me=(1+L)*G+(-1.5-2*L)*Z+(-.5+L)*j+1,ne=(-1-N)*G+(1.5+N)*Z+.5*j,fe=N*G-N*Z;for(let Ee=0;Ee!==v;++Ee)i[Ee]=H*f[C+Ee]+me*f[M+Ee]+ne*f[x+Ee]+fe*f[D+Ee];return i}},b7=class extends hf{constructor(e,t,s,a){super(e,t,s,a)}interpolate_(e,t,s,a){let i=this.resultBuffer,f=this.sampleValues,v=this.valueSize,x=e*v,M=x-v,C=(s-t)/(a-t),D=1-C;for(let L=0;L!==v;++L)i[L]=f[M+L]*D+f[x+L]*C;return i}},w7=class extends hf{constructor(e,t,s,a){super(e,t,s,a)}interpolate_(e){return this.copySampleValue_(e-1)}},cc=class{constructor(e,t,s,a){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=J3(t,this.TimeBufferType),this.values=J3(s,this.ValueBufferType),this.setInterpolation(a||this.DefaultInterpolation)}static toJSON(e){let t=e.constructor,s;if(t.toJSON!==this.toJSON)s=t.toJSON(e);else{s={name:e.name,times:J3(e.times,Array),values:J3(e.values,Array)};let a=e.getInterpolation();a!==e.DefaultInterpolation&&(s.interpolation=a)}return s.type=e.ValueTypeName,s}InterpolantFactoryMethodDiscrete(e){return new w7(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new b7(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new x7(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Q3:t=this.InterpolantFactoryMethodDiscrete;break;case e6:t=this.InterpolantFactoryMethodLinear;break;case _b:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){let s="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(s);return console.warn("THREE.KeyframeTrack:",s),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Q3;case this.InterpolantFactoryMethodLinear:return e6;case this.InterpolantFactoryMethodSmooth:return _b}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){let t=this.times;for(let s=0,a=t.length;s!==a;++s)t[s]+=e}return this}scale(e){if(e!==1){let t=this.times;for(let s=0,a=t.length;s!==a;++s)t[s]*=e}return this}trim(e,t){let s=this.times,a=s.length,i=0,f=a-1;for(;i!==a&&s[i]<e;)++i;for(;f!==-1&&s[f]>t;)--f;if(++f,i!==0||f!==a){i>=f&&(f=Math.max(f,1),i=f-1);let v=this.getValueSize();this.times=s.slice(i,f),this.values=this.values.slice(i*v,f*v)}return this}validate(){let e=!0,t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);let s=this.times,a=this.values,i=s.length;i===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let f=null;for(let v=0;v!==i;v++){let x=s[v];if(typeof x=="number"&&isNaN(x)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,v,x),e=!1;break}if(f!==null&&f>x){console.error("THREE.KeyframeTrack: Out of order keys.",this,v,x,f),e=!1;break}f=x}if(a!==void 0&&w$(a))for(let v=0,x=a.length;v!==x;++v){let M=a[v];if(isNaN(M)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,v,M),e=!1;break}}return e}optimize(){let e=this.times.slice(),t=this.values.slice(),s=this.getValueSize(),a=this.getInterpolation()===_b,i=e.length-1,f=1;for(let v=1;v<i;++v){let x=!1,M=e[v],C=e[v+1];if(M!==C&&(v!==1||M!==e[0]))if(a)x=!0;else{let D=v*s,L=D-s,N=D+s;for(let j=0;j!==s;++j){let Z=t[D+j];if(Z!==t[L+j]||Z!==t[N+j]){x=!0;break}}}if(x){if(v!==f){e[f]=e[v];let D=v*s,L=f*s;for(let N=0;N!==s;++N)t[L+N]=t[D+N]}++f}}if(i>0){e[f]=e[i];for(let v=i*s,x=f*s,M=0;M!==s;++M)t[x+M]=t[v+M];++f}return f!==e.length?(this.times=e.slice(0,f),this.values=t.slice(0,f*s)):(this.times=e,this.values=t),this}clone(){let e=this.times.slice(),t=this.values.slice(),s=this.constructor,a=new s(this.name,e,t);return a.createInterpolant=this.createInterpolant,a}};cc.prototype.TimeBufferType=Float32Array;cc.prototype.ValueBufferType=Float32Array;cc.prototype.DefaultInterpolation=e6;var Wu=class extends cc{};Wu.prototype.ValueTypeName="bool";Wu.prototype.ValueBufferType=Array;Wu.prototype.DefaultInterpolation=Q3;Wu.prototype.InterpolantFactoryMethodLinear=void 0;Wu.prototype.InterpolantFactoryMethodSmooth=void 0;var S7=class extends cc{};S7.prototype.ValueTypeName="color";var T7=class extends cc{};T7.prototype.ValueTypeName="number";var M7=class extends hf{constructor(e,t,s,a){super(e,t,s,a)}interpolate_(e,t,s,a){let i=this.resultBuffer,f=this.sampleValues,v=this.valueSize,x=(s-t)/(a-t),M=e*v;for(let C=M+v;M!==C;M+=4)ac.slerpFlat(i,0,f,M-v,f,M,x);return i}},e_=class extends cc{InterpolantFactoryMethodLinear(e){return new M7(this.times,this.values,this.getValueSize(),e)}};e_.prototype.ValueTypeName="quaternion";e_.prototype.DefaultInterpolation=e6;e_.prototype.InterpolantFactoryMethodSmooth=void 0;var qu=class extends cc{};qu.prototype.ValueTypeName="string";qu.prototype.ValueBufferType=Array;qu.prototype.DefaultInterpolation=Q3;qu.prototype.InterpolantFactoryMethodLinear=void 0;qu.prototype.InterpolantFactoryMethodSmooth=void 0;var E7=class extends cc{};E7.prototype.ValueTypeName="vector";var S6=class extends Cl{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){let e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}};var k7="\\[\\]\\.:\\/",S$=new RegExp("["+k7+"]","g"),D7="[^"+k7+"]",T$="[^"+k7.replace("\\.","")+"]",M$=/((?:WC+[\/:])*)/.source.replace("WC",D7),E$=/(WCOD+)?/.source.replace("WCOD",T$),A$=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",D7),C$=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",D7),I$=new RegExp("^"+M$+E$+A$+C$+"$"),P$=["material","materials","bones","map"],A7=class{constructor(e,t,s){let a=s||io.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,a)}getValue(e,t){this.bind();let s=this._targetGroup.nCachedObjects_,a=this._bindings[s];a!==void 0&&a.getValue(e,t)}setValue(e,t){let s=this._bindings;for(let a=this._targetGroup.nCachedObjects_,i=s.length;a!==i;++a)s[a].setValue(e,t)}bind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,s=e.length;t!==s;++t)e[t].bind()}unbind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,s=e.length;t!==s;++t)e[t].unbind()}},io=(()=>{class o{constructor(t,s,a){this.path=s,this.parsedPath=a||o.parseTrackName(s),this.node=o.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,s,a){return t&&t.isAnimationObjectGroup?new o.Composite(t,s,a):new o(t,s,a)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(S$,"")}static parseTrackName(t){let s=I$.exec(t);if(s===null)throw new Error("PropertyBinding: Cannot parse trackName: "+t);let a={nodeName:s[2],objectName:s[3],objectIndex:s[4],propertyName:s[5],propertyIndex:s[6]},i=a.nodeName&&a.nodeName.lastIndexOf(".");if(i!==void 0&&i!==-1){let f=a.nodeName.substring(i+1);P$.indexOf(f)!==-1&&(a.nodeName=a.nodeName.substring(0,i),a.objectName=f)}if(a.propertyName===null||a.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return a}static findNode(t,s){if(s===void 0||s===""||s==="."||s===-1||s===t.name||s===t.uuid)return t;if(t.skeleton){let a=t.skeleton.getBoneByName(s);if(a!==void 0)return a}if(t.children){let a=function(f){for(let v=0;v<f.length;v++){let x=f[v];if(x.name===s||x.uuid===s)return x;let M=a(x.children);if(M)return M}return null},i=a(t.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,s){t[s]=this.targetObject[this.propertyName]}_getValue_array(t,s){let a=this.resolvedProperty;for(let i=0,f=a.length;i!==f;++i)t[s++]=a[i]}_getValue_arrayElement(t,s){t[s]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,s){this.resolvedProperty.toArray(t,s)}_setValue_direct(t,s){this.targetObject[this.propertyName]=t[s]}_setValue_direct_setNeedsUpdate(t,s){this.targetObject[this.propertyName]=t[s],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,s){this.targetObject[this.propertyName]=t[s],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,s){let a=this.resolvedProperty;for(let i=0,f=a.length;i!==f;++i)a[i]=t[s++]}_setValue_array_setNeedsUpdate(t,s){let a=this.resolvedProperty;for(let i=0,f=a.length;i!==f;++i)a[i]=t[s++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,s){let a=this.resolvedProperty;for(let i=0,f=a.length;i!==f;++i)a[i]=t[s++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,s){this.resolvedProperty[this.propertyIndex]=t[s]}_setValue_arrayElement_setNeedsUpdate(t,s){this.resolvedProperty[this.propertyIndex]=t[s],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,s){this.resolvedProperty[this.propertyIndex]=t[s],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,s){this.resolvedProperty.fromArray(t,s)}_setValue_fromArray_setNeedsUpdate(t,s){this.resolvedProperty.fromArray(t,s),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,s){this.resolvedProperty.fromArray(t,s),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,s){this.bind(),this.getValue(t,s)}_setValue_unbound(t,s){this.bind(),this.setValue(t,s)}bind(){let t=this.node,s=this.parsedPath,a=s.objectName,i=s.propertyName,f=s.propertyIndex;if(t||(t=o.findNode(this.rootNode,s.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(a){let C=s.objectIndex;switch(a){case"materials":if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}t=t.material.materials;break;case"bones":if(!t.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}t=t.skeleton.bones;for(let D=0;D<t.length;D++)if(t[D].name===C){C=D;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}t=t.material.map;break;default:if(t[a]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}t=t[a]}if(C!==void 0){if(t[C]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);return}t=t[C]}}let v=t[i];if(v===void 0){let C=s.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+C+"."+i+" but it wasn't found.",t);return}let x=this.Versioning.None;this.targetObject=t,t.needsUpdate!==void 0?x=this.Versioning.NeedsUpdate:t.matrixWorldNeedsUpdate!==void 0&&(x=this.Versioning.MatrixWorldNeedsUpdate);let M=this.BindingType.Direct;if(f!==void 0){if(i==="morphTargetInfluences"){if(!t.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!t.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}t.morphTargetDictionary[f]!==void 0&&(f=t.morphTargetDictionary[f])}M=this.BindingType.ArrayElement,this.resolvedProperty=v,this.propertyIndex=f}else v.fromArray!==void 0&&v.toArray!==void 0?(M=this.BindingType.HasFromToArray,this.resolvedProperty=v):Array.isArray(v)?(M=this.BindingType.EntireArray,this.resolvedProperty=v):this.propertyName=i;this.getValue=this.GetterByBindingType[M],this.setValue=this.SetterByBindingTypeAndVersioning[M][x]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}return o.Composite=A7,o})();io.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};io.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};io.prototype.GetterByBindingType=[io.prototype._getValue_direct,io.prototype._getValue_array,io.prototype._getValue_arrayElement,io.prototype._getValue_toArray];io.prototype.SetterByBindingTypeAndVersioning=[[io.prototype._setValue_direct,io.prototype._setValue_direct_setNeedsUpdate,io.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[io.prototype._setValue_array,io.prototype._setValue_array_setNeedsUpdate,io.prototype._setValue_array_setMatrixWorldNeedsUpdate],[io.prototype._setValue_arrayElement,io.prototype._setValue_arrayElement_setNeedsUpdate,io.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[io.prototype._setValue_fromArray,io.prototype._setValue_fromArray_setNeedsUpdate,io.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var Hce=new Float32Array(1);var T6=class extends m7{constructor(e,t,s=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=s}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){let t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){let t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}};var t_=class{constructor(e=1,t=0,s=0){return this.radius=e,this.phi=t,this.theta=s,this}set(e,t,s){return this.radius=e,this.phi=t,this.theta=s,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,s){return this.radius=Math.sqrt(e*e+t*t+s*s),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,s),this.phi=Math.acos(_a(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}};var xR=new ui,M6=class{constructor(e=new ui(1/0,1/0),t=new ui(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,s=e.length;t<s;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let s=xR.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(s),this.max.copy(e).add(s),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,xR).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}};typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:C7}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=C7);var sr=class o{constructor(e,t,s,a,i){this.layerName=e??null,this.blockName=t??null,this.geometryType=s??null,this.color=a,this.lineType=i??null}Compare(e){let t=Yc(this.layerName,e.layerName);return t!==0||(t=Yc(this.blockName,e.blockName),t!==0)||(t=Yc(this.geometryType,e.geometryType),t!==0)||(t=Yc(this.color,e.color),t!==0)?t:Yc(this.lineType,e.lineType)}IsIndexed(){return this.geometryType===o.GeometryType.INDEXED_LINES||this.geometryType===o.GeometryType.INDEXED_TRIANGLES}IsInstanced(){return this.geometryType===o.GeometryType.BLOCK_INSTANCE||this.geometryType===o.GeometryType.POINT_INSTANCE}};sr.GeometryType=Object.freeze({POINTS:0,LINES:1,INDEXED_LINES:2,TRIANGLES:3,INDEXED_TRIANGLES:4,BLOCK_INSTANCE:5,POINT_INSTANCE:6});function Yc(o,e){return o===null?e===null?0:-1:e===null?1:o<e?-1:o>e?1:0}var Zu=class{constructor(e,t=16){this.type=e,this.capacity=t,this.size=0,this.buffer=new(L7(e))(t)}GetSize(){return this.size}Push(e){this._CheckGrow();let t=this.size;return this.buffer[t]=e,this.size++,t}Get(e){if(e>=this.size)throw new Error(`Index out of range: ${e}/${this.size}`);return this.buffer[e]}CopyTo(e,t,s=0,a=-1){a===-1&&(a=this.size-s);let i=new(L7(this.type))(this.buffer.buffer,s,a);e.set(i,t)}_CheckGrow(){if(this.size<this.capacity)return;this.capacity*=2;let e=new(L7(this.type))(this.capacity);e.set(this.buffer),this.buffer=e}},Va={INT8:0,UINT8:1,UINT8_CLAMPED:2,INT16:3,UINT16:4,INT32:5,UINT32:6,INT64:7,UINT64:8,FLOAT32:9,FLOAT64:10};function L7(o){switch(o){case Va.INT8:return Int8Array;case Va.UINT8:return Uint8Array;case Va.UINT8_CLAMPED:return Uint8ClampedArray;case Va.INT16:return Int16Array;case Va.UINT16:return Uint16Array;case Va.INT32:return Int32Array;case Va.UINT32:return Uint32Array;case Va.FLOAT32:return Float32Array;case Va.FLOAT64:return Float64Array;default:throw new Error("Unrecognized native type: "+o)}}var ia=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];var Xce=Math.PI/180,Zce=180/Math.PI;function GR(){let o=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,s=Math.random()*4294967295|0;return(ia[o&255]+ia[o>>8&255]+ia[o>>16&255]+ia[o>>24&255]+"-"+ia[e&255]+ia[e>>8&255]+"-"+ia[e>>16&15|64]+ia[e>>24&255]+"-"+ia[t&63|128]+ia[t>>8&255]+"-"+ia[t>>16&255]+ia[t>>24&255]+ia[s&255]+ia[s>>8&255]+ia[s>>16&255]+ia[s>>24&255]).toLowerCase()}function ya(o,e,t){return Math.max(e,Math.min(t,o))}function HR(o,e){return(o%e+e)%e}function I6(o,e,t){return(1-t)*o+t*e}var jR="",Jc="srgb",P6="srgb-linear",WR="display-p3",F7="display-p3-linear",R6="linear",O7="srgb",N7="rec709",z7="p3";var n_=2e3,B7=2001;var uf=class o{constructor(e,t,s,a,i,f,v,x,M){o.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,s,a,i,f,v,x,M)}set(e,t,s,a,i,f,v,x,M){let C=this.elements;return C[0]=e,C[1]=a,C[2]=v,C[3]=t,C[4]=i,C[5]=x,C[6]=s,C[7]=f,C[8]=M,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){let t=this.elements,s=e.elements;return t[0]=s[0],t[1]=s[1],t[2]=s[2],t[3]=s[3],t[4]=s[4],t[5]=s[5],t[6]=s[6],t[7]=s[7],t[8]=s[8],this}extractBasis(e,t,s){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),s.setFromMatrix3Column(this,2),this}setFromMatrix4(e){let t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let s=e.elements,a=t.elements,i=this.elements,f=s[0],v=s[3],x=s[6],M=s[1],C=s[4],D=s[7],L=s[2],N=s[5],j=s[8],Z=a[0],G=a[3],H=a[6],me=a[1],ne=a[4],fe=a[7],Ee=a[2],de=a[5],we=a[8];return i[0]=f*Z+v*me+x*Ee,i[3]=f*G+v*ne+x*de,i[6]=f*H+v*fe+x*we,i[1]=M*Z+C*me+D*Ee,i[4]=M*G+C*ne+D*de,i[7]=M*H+C*fe+D*we,i[2]=L*Z+N*me+j*Ee,i[5]=L*G+N*ne+j*de,i[8]=L*H+N*fe+j*we,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){let e=this.elements,t=e[0],s=e[1],a=e[2],i=e[3],f=e[4],v=e[5],x=e[6],M=e[7],C=e[8];return t*f*C-t*v*M-s*i*C+s*v*x+a*i*M-a*f*x}invert(){let e=this.elements,t=e[0],s=e[1],a=e[2],i=e[3],f=e[4],v=e[5],x=e[6],M=e[7],C=e[8],D=C*f-v*M,L=v*x-C*i,N=M*i-f*x,j=t*D+s*L+a*N;if(j===0)return this.set(0,0,0,0,0,0,0,0,0);let Z=1/j;return e[0]=D*Z,e[1]=(a*M-C*s)*Z,e[2]=(v*s-a*f)*Z,e[3]=L*Z,e[4]=(C*t-a*x)*Z,e[5]=(a*i-v*t)*Z,e[6]=N*Z,e[7]=(s*x-M*t)*Z,e[8]=(f*t-s*i)*Z,this}transpose(){let e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){let t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,s,a,i,f,v){let x=Math.cos(i),M=Math.sin(i);return this.set(s*x,s*M,-s*(x*f+M*v)+f+e,-a*M,a*x,-a*(-M*f+x*v)+v+t,0,0,1),this}scale(e,t){return this.premultiply(U7.makeScale(e,t)),this}rotate(e){return this.premultiply(U7.makeRotation(-e)),this}translate(e,t){return this.premultiply(U7.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){let t=Math.cos(e),s=Math.sin(e);return this.set(t,-s,0,s,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){let t=this.elements,s=e.elements;for(let a=0;a<9;a++)if(t[a]!==s[a])return!1;return!0}fromArray(e,t=0){for(let s=0;s<9;s++)this.elements[s]=e[s+t];return this}toArray(e=[],t=0){let s=this.elements;return e[t]=s[0],e[t+1]=s[1],e[t+2]=s[2],e[t+3]=s[3],e[t+4]=s[4],e[t+5]=s[5],e[t+6]=s[6],e[t+7]=s[7],e[t+8]=s[8],e}clone(){return new this.constructor().fromArray(this.elements)}},U7=new uf;var qR=new uf().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),XR=new uf().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),k6={[P6]:{transfer:R6,primaries:N7,toReference:o=>o,fromReference:o=>o},[Jc]:{transfer:O7,primaries:N7,toReference:o=>o.convertSRGBToLinear(),fromReference:o=>o.convertLinearToSRGB()},[F7]:{transfer:R6,primaries:z7,toReference:o=>o.applyMatrix3(XR),fromReference:o=>o.applyMatrix3(qR)},[WR]:{transfer:O7,primaries:z7,toReference:o=>o.convertSRGBToLinear().applyMatrix3(XR),fromReference:o=>o.applyMatrix3(qR).convertLinearToSRGB()}},R$=new Set([P6,F7]),Rl={enabled:!0,_workingColorSpace:P6,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(o){if(!R$.has(o))throw new Error(`Unsupported working color space, "${o}".`);this._workingColorSpace=o},convert:function(o,e,t){if(this.enabled===!1||e===t||!e||!t)return o;let s=k6[e].toReference,a=k6[t].fromReference;return a(s(o))},fromWorkingColorSpace:function(o,e){return this.convert(o,this._workingColorSpace,e)},toWorkingColorSpace:function(o,e){return this.convert(o,e,this._workingColorSpace)},getPrimaries:function(o){return k6[o].primaries},getTransfer:function(o){return o===jR?R6:k6[o].transfer}};function D6(o){return o<.04045?o*.0773993808:Math.pow(o*.9478672986+.0521327014,2.4)}function L6(o){return o<.0031308?o*12.92:1.055*Math.pow(o,.41666)-.055}var ZR={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},ud={h:0,s:0,l:0},F6={h:0,s:0,l:0};function V7(o,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?o+(e-o)*6*t:t<1/2?e:t<2/3?o+(e-o)*6*(2/3-t):o}var pf=class{constructor(e,t,s){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,s)}set(e,t,s){if(t===void 0&&s===void 0){let a=e;a&&a.isColor?this.copy(a):typeof a=="number"?this.setHex(a):typeof a=="string"&&this.setStyle(a)}else this.setRGB(e,t,s);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Jc){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Rl.toWorkingColorSpace(this,t),this}setRGB(e,t,s,a=Rl.workingColorSpace){return this.r=e,this.g=t,this.b=s,Rl.toWorkingColorSpace(this,a),this}setHSL(e,t,s,a=Rl.workingColorSpace){if(e=HR(e,1),t=ya(t,0,1),s=ya(s,0,1),t===0)this.r=this.g=this.b=s;else{let i=s<=.5?s*(1+t):s+t-s*t,f=2*s-i;this.r=V7(f,i,e+1/3),this.g=V7(f,i,e),this.b=V7(f,i,e-1/3)}return Rl.toWorkingColorSpace(this,a),this}setStyle(e,t=Jc){function s(i){i!==void 0&&parseFloat(i)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let a;if(a=/^(\w+)\(([^\)]*)\)/.exec(e)){let i,f=a[1],v=a[2];switch(f){case"rgb":case"rgba":if(i=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(v))return s(i[4]),this.setRGB(Math.min(255,parseInt(i[1],10))/255,Math.min(255,parseInt(i[2],10))/255,Math.min(255,parseInt(i[3],10))/255,t);if(i=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(v))return s(i[4]),this.setRGB(Math.min(100,parseInt(i[1],10))/100,Math.min(100,parseInt(i[2],10))/100,Math.min(100,parseInt(i[3],10))/100,t);break;case"hsl":case"hsla":if(i=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(v))return s(i[4]),this.setHSL(parseFloat(i[1])/360,parseFloat(i[2])/100,parseFloat(i[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(a=/^\#([A-Fa-f\d]+)$/.exec(e)){let i=a[1],f=i.length;if(f===3)return this.setRGB(parseInt(i.charAt(0),16)/15,parseInt(i.charAt(1),16)/15,parseInt(i.charAt(2),16)/15,t);if(f===6)return this.setHex(parseInt(i,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=Jc){let s=ZR[e.toLowerCase()];return s!==void 0?this.setHex(s,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=D6(e.r),this.g=D6(e.g),this.b=D6(e.b),this}copyLinearToSRGB(e){return this.r=L6(e.r),this.g=L6(e.g),this.b=L6(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Jc){return Rl.fromWorkingColorSpace(na.copy(this),e),Math.round(ya(na.r*255,0,255))*65536+Math.round(ya(na.g*255,0,255))*256+Math.round(ya(na.b*255,0,255))}getHexString(e=Jc){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Rl.workingColorSpace){Rl.fromWorkingColorSpace(na.copy(this),t);let s=na.r,a=na.g,i=na.b,f=Math.max(s,a,i),v=Math.min(s,a,i),x,M,C=(v+f)/2;if(v===f)x=0,M=0;else{let D=f-v;switch(M=C<=.5?D/(f+v):D/(2-f-v),f){case s:x=(a-i)/D+(a<i?6:0);break;case a:x=(i-s)/D+2;break;case i:x=(s-a)/D+4;break}x/=6}return e.h=x,e.s=M,e.l=C,e}getRGB(e,t=Rl.workingColorSpace){return Rl.fromWorkingColorSpace(na.copy(this),t),e.r=na.r,e.g=na.g,e.b=na.b,e}getStyle(e=Jc){Rl.fromWorkingColorSpace(na.copy(this),e);let t=na.r,s=na.g,a=na.b;return e!==Jc?`color(${e} ${t.toFixed(3)} ${s.toFixed(3)} ${a.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(s*255)},${Math.round(a*255)})`}offsetHSL(e,t,s){return this.getHSL(ud),this.setHSL(ud.h+e,ud.s+t,ud.l+s)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,s){return this.r=e.r+(t.r-e.r)*s,this.g=e.g+(t.g-e.g)*s,this.b=e.b+(t.b-e.b)*s,this}lerpHSL(e,t){this.getHSL(ud),e.getHSL(F6);let s=I6(ud.h,F6.h,t),a=I6(ud.s,F6.s,t),i=I6(ud.l,F6.l,t);return this.setHSL(s,a,i),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){let t=this.r,s=this.g,a=this.b,i=e.elements;return this.r=i[0]*t+i[3]*s+i[6]*a,this.g=i[1]*t+i[4]*s+i[7]*a,this.b=i[2]*t+i[5]*s+i[8]*a,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}},na=new pf;pf.NAMES=ZR;var Vr=class o{constructor(e=0,t=0){o.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){let t=this.x,s=this.y,a=e.elements;return this.x=a[0]*t+a[3]*s+a[6],this.y=a[1]*t+a[4]*s+a[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){let s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(e,Math.min(t,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){let t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;let s=this.dot(e)/t;return Math.acos(ya(s,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,s=this.y-e.y;return t*t+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,s){return this.x=e.x+(t.x-e.x)*s,this.y=e.y+(t.y-e.y)*s,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){let s=Math.cos(t),a=Math.sin(t),i=this.x-e.x,f=this.y-e.y;return this.x=i*s-f*a+e.x,this.y=i*a+f*s+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}};var O6=class{constructor(e=0,t=0,s=0,a=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=s,this._w=a}static slerpFlat(e,t,s,a,i,f,v){let x=s[a+0],M=s[a+1],C=s[a+2],D=s[a+3],L=i[f+0],N=i[f+1],j=i[f+2],Z=i[f+3];if(v===0){e[t+0]=x,e[t+1]=M,e[t+2]=C,e[t+3]=D;return}if(v===1){e[t+0]=L,e[t+1]=N,e[t+2]=j,e[t+3]=Z;return}if(D!==Z||x!==L||M!==N||C!==j){let G=1-v,H=x*L+M*N+C*j+D*Z,me=H>=0?1:-1,ne=1-H*H;if(ne>Number.EPSILON){let Ee=Math.sqrt(ne),de=Math.atan2(Ee,H*me);G=Math.sin(G*de)/Ee,v=Math.sin(v*de)/Ee}let fe=v*me;if(x=x*G+L*fe,M=M*G+N*fe,C=C*G+j*fe,D=D*G+Z*fe,G===1-v){let Ee=1/Math.sqrt(x*x+M*M+C*C+D*D);x*=Ee,M*=Ee,C*=Ee,D*=Ee}}e[t]=x,e[t+1]=M,e[t+2]=C,e[t+3]=D}static multiplyQuaternionsFlat(e,t,s,a,i,f){let v=s[a],x=s[a+1],M=s[a+2],C=s[a+3],D=i[f],L=i[f+1],N=i[f+2],j=i[f+3];return e[t]=v*j+C*D+x*N-M*L,e[t+1]=x*j+C*L+M*D-v*N,e[t+2]=M*j+C*N+v*L-x*D,e[t+3]=C*j-v*D-x*L-M*N,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,s,a){return this._x=e,this._y=t,this._z=s,this._w=a,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){let s=e._x,a=e._y,i=e._z,f=e._order,v=Math.cos,x=Math.sin,M=v(s/2),C=v(a/2),D=v(i/2),L=x(s/2),N=x(a/2),j=x(i/2);switch(f){case"XYZ":this._x=L*C*D+M*N*j,this._y=M*N*D-L*C*j,this._z=M*C*j+L*N*D,this._w=M*C*D-L*N*j;break;case"YXZ":this._x=L*C*D+M*N*j,this._y=M*N*D-L*C*j,this._z=M*C*j-L*N*D,this._w=M*C*D+L*N*j;break;case"ZXY":this._x=L*C*D-M*N*j,this._y=M*N*D+L*C*j,this._z=M*C*j+L*N*D,this._w=M*C*D-L*N*j;break;case"ZYX":this._x=L*C*D-M*N*j,this._y=M*N*D+L*C*j,this._z=M*C*j-L*N*D,this._w=M*C*D+L*N*j;break;case"YZX":this._x=L*C*D+M*N*j,this._y=M*N*D+L*C*j,this._z=M*C*j-L*N*D,this._w=M*C*D-L*N*j;break;case"XZY":this._x=L*C*D-M*N*j,this._y=M*N*D-L*C*j,this._z=M*C*j+L*N*D,this._w=M*C*D+L*N*j;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+f)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){let s=t/2,a=Math.sin(s);return this._x=e.x*a,this._y=e.y*a,this._z=e.z*a,this._w=Math.cos(s),this._onChangeCallback(),this}setFromRotationMatrix(e){let t=e.elements,s=t[0],a=t[4],i=t[8],f=t[1],v=t[5],x=t[9],M=t[2],C=t[6],D=t[10],L=s+v+D;if(L>0){let N=.5/Math.sqrt(L+1);this._w=.25/N,this._x=(C-x)*N,this._y=(i-M)*N,this._z=(f-a)*N}else if(s>v&&s>D){let N=2*Math.sqrt(1+s-v-D);this._w=(C-x)/N,this._x=.25*N,this._y=(a+f)/N,this._z=(i+M)/N}else if(v>D){let N=2*Math.sqrt(1+v-s-D);this._w=(i-M)/N,this._x=(a+f)/N,this._y=.25*N,this._z=(x+C)/N}else{let N=2*Math.sqrt(1+D-s-v);this._w=(f-a)/N,this._x=(i+M)/N,this._y=(x+C)/N,this._z=.25*N}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let s=e.dot(t)+1;return s<Number.EPSILON?(s=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=s):(this._x=0,this._y=-e.z,this._z=e.y,this._w=s)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=s),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(ya(this.dot(e),-1,1)))}rotateTowards(e,t){let s=this.angleTo(e);if(s===0)return this;let a=Math.min(1,t/s);return this.slerp(e,a),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){let s=e._x,a=e._y,i=e._z,f=e._w,v=t._x,x=t._y,M=t._z,C=t._w;return this._x=s*C+f*v+a*M-i*x,this._y=a*C+f*x+i*v-s*M,this._z=i*C+f*M+s*x-a*v,this._w=f*C-s*v-a*x-i*M,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);let s=this._x,a=this._y,i=this._z,f=this._w,v=f*e._w+s*e._x+a*e._y+i*e._z;if(v<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,v=-v):this.copy(e),v>=1)return this._w=f,this._x=s,this._y=a,this._z=i,this;let x=1-v*v;if(x<=Number.EPSILON){let N=1-t;return this._w=N*f+t*this._w,this._x=N*s+t*this._x,this._y=N*a+t*this._y,this._z=N*i+t*this._z,this.normalize(),this}let M=Math.sqrt(x),C=Math.atan2(M,v),D=Math.sin((1-t)*C)/M,L=Math.sin(t*C)/M;return this._w=f*D+this._w*L,this._x=s*D+this._x*L,this._y=a*D+this._y*L,this._z=i*D+this._z*L,this._onChangeCallback(),this}slerpQuaternions(e,t,s){return this.copy(e).slerp(t,s)}random(){let e=Math.random(),t=Math.sqrt(1-e),s=Math.sqrt(e),a=2*Math.PI*Math.random(),i=2*Math.PI*Math.random();return this.set(t*Math.cos(a),s*Math.sin(i),s*Math.cos(i),t*Math.sin(a))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}};var kr=class o{constructor(e=0,t=0,s=0){o.prototype.isVector3=!0,this.x=e,this.y=t,this.z=s}set(e,t,s){return s===void 0&&(s=this.z),this.x=e,this.y=t,this.z=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion($R.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion($R.setFromAxisAngle(e,t))}applyMatrix3(e){let t=this.x,s=this.y,a=this.z,i=e.elements;return this.x=i[0]*t+i[3]*s+i[6]*a,this.y=i[1]*t+i[4]*s+i[7]*a,this.z=i[2]*t+i[5]*s+i[8]*a,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){let t=this.x,s=this.y,a=this.z,i=e.elements,f=1/(i[3]*t+i[7]*s+i[11]*a+i[15]);return this.x=(i[0]*t+i[4]*s+i[8]*a+i[12])*f,this.y=(i[1]*t+i[5]*s+i[9]*a+i[13])*f,this.z=(i[2]*t+i[6]*s+i[10]*a+i[14])*f,this}applyQuaternion(e){let t=this.x,s=this.y,a=this.z,i=e.x,f=e.y,v=e.z,x=e.w,M=2*(f*a-v*s),C=2*(v*t-i*a),D=2*(i*s-f*t);return this.x=t+x*M+f*D-v*C,this.y=s+x*C+v*M-i*D,this.z=a+x*D+i*C-f*M,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){let t=this.x,s=this.y,a=this.z,i=e.elements;return this.x=i[0]*t+i[4]*s+i[8]*a,this.y=i[1]*t+i[5]*s+i[9]*a,this.z=i[2]*t+i[6]*s+i[10]*a,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){let s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(e,Math.min(t,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,s){return this.x=e.x+(t.x-e.x)*s,this.y=e.y+(t.y-e.y)*s,this.z=e.z+(t.z-e.z)*s,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){let s=e.x,a=e.y,i=e.z,f=t.x,v=t.y,x=t.z;return this.x=a*x-i*v,this.y=i*f-s*x,this.z=s*v-a*f,this}projectOnVector(e){let t=e.lengthSq();if(t===0)return this.set(0,0,0);let s=e.dot(this)/t;return this.copy(e).multiplyScalar(s)}projectOnPlane(e){return G7.copy(this).projectOnVector(e),this.sub(G7)}reflect(e){return this.sub(G7.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){let t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;let s=this.dot(e)/t;return Math.acos(ya(s,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,s=this.y-e.y,a=this.z-e.z;return t*t+s*s+a*a}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,s){let a=Math.sin(t)*e;return this.x=a*Math.sin(s),this.y=Math.cos(t)*e,this.z=a*Math.cos(s),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,s){return this.x=e*Math.sin(t),this.y=s,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){let t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){let t=this.setFromMatrixColumn(e,0).length(),s=this.setFromMatrixColumn(e,1).length(),a=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=s,this.z=a,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,s=Math.sqrt(1-e**2);return this.x=s*Math.cos(t),this.y=s*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}},G7=new kr,$R=new O6;var r_=class o{constructor(e,t,s,a,i,f,v,x,M,C,D,L,N,j,Z,G){o.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,s,a,i,f,v,x,M,C,D,L,N,j,Z,G)}set(e,t,s,a,i,f,v,x,M,C,D,L,N,j,Z,G){let H=this.elements;return H[0]=e,H[4]=t,H[8]=s,H[12]=a,H[1]=i,H[5]=f,H[9]=v,H[13]=x,H[2]=M,H[6]=C,H[10]=D,H[14]=L,H[3]=N,H[7]=j,H[11]=Z,H[15]=G,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new o().fromArray(this.elements)}copy(e){let t=this.elements,s=e.elements;return t[0]=s[0],t[1]=s[1],t[2]=s[2],t[3]=s[3],t[4]=s[4],t[5]=s[5],t[6]=s[6],t[7]=s[7],t[8]=s[8],t[9]=s[9],t[10]=s[10],t[11]=s[11],t[12]=s[12],t[13]=s[13],t[14]=s[14],t[15]=s[15],this}copyPosition(e){let t=this.elements,s=e.elements;return t[12]=s[12],t[13]=s[13],t[14]=s[14],this}setFromMatrix3(e){let t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,s){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),s.setFromMatrixColumn(this,2),this}makeBasis(e,t,s){return this.set(e.x,t.x,s.x,0,e.y,t.y,s.y,0,e.z,t.z,s.z,0,0,0,0,1),this}extractRotation(e){let t=this.elements,s=e.elements,a=1/ff.setFromMatrixColumn(e,0).length(),i=1/ff.setFromMatrixColumn(e,1).length(),f=1/ff.setFromMatrixColumn(e,2).length();return t[0]=s[0]*a,t[1]=s[1]*a,t[2]=s[2]*a,t[3]=0,t[4]=s[4]*i,t[5]=s[5]*i,t[6]=s[6]*i,t[7]=0,t[8]=s[8]*f,t[9]=s[9]*f,t[10]=s[10]*f,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){let t=this.elements,s=e.x,a=e.y,i=e.z,f=Math.cos(s),v=Math.sin(s),x=Math.cos(a),M=Math.sin(a),C=Math.cos(i),D=Math.sin(i);if(e.order==="XYZ"){let L=f*C,N=f*D,j=v*C,Z=v*D;t[0]=x*C,t[4]=-x*D,t[8]=M,t[1]=N+j*M,t[5]=L-Z*M,t[9]=-v*x,t[2]=Z-L*M,t[6]=j+N*M,t[10]=f*x}else if(e.order==="YXZ"){let L=x*C,N=x*D,j=M*C,Z=M*D;t[0]=L+Z*v,t[4]=j*v-N,t[8]=f*M,t[1]=f*D,t[5]=f*C,t[9]=-v,t[2]=N*v-j,t[6]=Z+L*v,t[10]=f*x}else if(e.order==="ZXY"){let L=x*C,N=x*D,j=M*C,Z=M*D;t[0]=L-Z*v,t[4]=-f*D,t[8]=j+N*v,t[1]=N+j*v,t[5]=f*C,t[9]=Z-L*v,t[2]=-f*M,t[6]=v,t[10]=f*x}else if(e.order==="ZYX"){let L=f*C,N=f*D,j=v*C,Z=v*D;t[0]=x*C,t[4]=j*M-N,t[8]=L*M+Z,t[1]=x*D,t[5]=Z*M+L,t[9]=N*M-j,t[2]=-M,t[6]=v*x,t[10]=f*x}else if(e.order==="YZX"){let L=f*x,N=f*M,j=v*x,Z=v*M;t[0]=x*C,t[4]=Z-L*D,t[8]=j*D+N,t[1]=D,t[5]=f*C,t[9]=-v*C,t[2]=-M*C,t[6]=N*D+j,t[10]=L-Z*D}else if(e.order==="XZY"){let L=f*x,N=f*M,j=v*x,Z=v*M;t[0]=x*C,t[4]=-D,t[8]=M*C,t[1]=L*D+Z,t[5]=f*C,t[9]=N*D-j,t[2]=j*D-N,t[6]=v*C,t[10]=Z*D+L}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(k$,e,D$)}lookAt(e,t,s){let a=this.elements;return ul.subVectors(e,t),ul.lengthSq()===0&&(ul.z=1),ul.normalize(),pd.crossVectors(s,ul),pd.lengthSq()===0&&(Math.abs(s.z)===1?ul.x+=1e-4:ul.z+=1e-4,ul.normalize(),pd.crossVectors(s,ul)),pd.normalize(),N6.crossVectors(ul,pd),a[0]=pd.x,a[4]=N6.x,a[8]=ul.x,a[1]=pd.y,a[5]=N6.y,a[9]=ul.y,a[2]=pd.z,a[6]=N6.z,a[10]=ul.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let s=e.elements,a=t.elements,i=this.elements,f=s[0],v=s[4],x=s[8],M=s[12],C=s[1],D=s[5],L=s[9],N=s[13],j=s[2],Z=s[6],G=s[10],H=s[14],me=s[3],ne=s[7],fe=s[11],Ee=s[15],de=a[0],we=a[4],Le=a[8],De=a[12],se=a[1],Ce=a[5],Ne=a[9],zt=a[13],Ge=a[2],Xe=a[6],ht=a[10],Ot=a[14],bt=a[3],Tt=a[7],Nt=a[11],Bt=a[15];return i[0]=f*de+v*se+x*Ge+M*bt,i[4]=f*we+v*Ce+x*Xe+M*Tt,i[8]=f*Le+v*Ne+x*ht+M*Nt,i[12]=f*De+v*zt+x*Ot+M*Bt,i[1]=C*de+D*se+L*Ge+N*bt,i[5]=C*we+D*Ce+L*Xe+N*Tt,i[9]=C*Le+D*Ne+L*ht+N*Nt,i[13]=C*De+D*zt+L*Ot+N*Bt,i[2]=j*de+Z*se+G*Ge+H*bt,i[6]=j*we+Z*Ce+G*Xe+H*Tt,i[10]=j*Le+Z*Ne+G*ht+H*Nt,i[14]=j*De+Z*zt+G*Ot+H*Bt,i[3]=me*de+ne*se+fe*Ge+Ee*bt,i[7]=me*we+ne*Ce+fe*Xe+Ee*Tt,i[11]=me*Le+ne*Ne+fe*ht+Ee*Nt,i[15]=me*De+ne*zt+fe*Ot+Ee*Bt,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){let e=this.elements,t=e[0],s=e[4],a=e[8],i=e[12],f=e[1],v=e[5],x=e[9],M=e[13],C=e[2],D=e[6],L=e[10],N=e[14],j=e[3],Z=e[7],G=e[11],H=e[15];return j*(+i*x*D-a*M*D-i*v*L+s*M*L+a*v*N-s*x*N)+Z*(+t*x*N-t*M*L+i*f*L-a*f*N+a*M*C-i*x*C)+G*(+t*M*D-t*v*N-i*f*D+s*f*N+i*v*C-s*M*C)+H*(-a*v*C-t*x*D+t*v*L+a*f*D-s*f*L+s*x*C)}transpose(){let e=this.elements,t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,s){let a=this.elements;return e.isVector3?(a[12]=e.x,a[13]=e.y,a[14]=e.z):(a[12]=e,a[13]=t,a[14]=s),this}invert(){let e=this.elements,t=e[0],s=e[1],a=e[2],i=e[3],f=e[4],v=e[5],x=e[6],M=e[7],C=e[8],D=e[9],L=e[10],N=e[11],j=e[12],Z=e[13],G=e[14],H=e[15],me=D*G*M-Z*L*M+Z*x*N-v*G*N-D*x*H+v*L*H,ne=j*L*M-C*G*M-j*x*N+f*G*N+C*x*H-f*L*H,fe=C*Z*M-j*D*M+j*v*N-f*Z*N-C*v*H+f*D*H,Ee=j*D*x-C*Z*x-j*v*L+f*Z*L+C*v*G-f*D*G,de=t*me+s*ne+a*fe+i*Ee;if(de===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let we=1/de;return e[0]=me*we,e[1]=(Z*L*i-D*G*i-Z*a*N+s*G*N+D*a*H-s*L*H)*we,e[2]=(v*G*i-Z*x*i+Z*a*M-s*G*M-v*a*H+s*x*H)*we,e[3]=(D*x*i-v*L*i-D*a*M+s*L*M+v*a*N-s*x*N)*we,e[4]=ne*we,e[5]=(C*G*i-j*L*i+j*a*N-t*G*N-C*a*H+t*L*H)*we,e[6]=(j*x*i-f*G*i-j*a*M+t*G*M+f*a*H-t*x*H)*we,e[7]=(f*L*i-C*x*i+C*a*M-t*L*M-f*a*N+t*x*N)*we,e[8]=fe*we,e[9]=(j*D*i-C*Z*i-j*s*N+t*Z*N+C*s*H-t*D*H)*we,e[10]=(f*Z*i-j*v*i+j*s*M-t*Z*M-f*s*H+t*v*H)*we,e[11]=(C*v*i-f*D*i-C*s*M+t*D*M+f*s*N-t*v*N)*we,e[12]=Ee*we,e[13]=(C*Z*a-j*D*a+j*s*L-t*Z*L-C*s*G+t*D*G)*we,e[14]=(j*v*a-f*Z*a-j*s*x+t*Z*x+f*s*G-t*v*G)*we,e[15]=(f*D*a-C*v*a+C*s*x-t*D*x-f*s*L+t*v*L)*we,this}scale(e){let t=this.elements,s=e.x,a=e.y,i=e.z;return t[0]*=s,t[4]*=a,t[8]*=i,t[1]*=s,t[5]*=a,t[9]*=i,t[2]*=s,t[6]*=a,t[10]*=i,t[3]*=s,t[7]*=a,t[11]*=i,this}getMaxScaleOnAxis(){let e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],s=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],a=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,s,a))}makeTranslation(e,t,s){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,s,0,0,0,1),this}makeRotationX(e){let t=Math.cos(e),s=Math.sin(e);return this.set(1,0,0,0,0,t,-s,0,0,s,t,0,0,0,0,1),this}makeRotationY(e){let t=Math.cos(e),s=Math.sin(e);return this.set(t,0,s,0,0,1,0,0,-s,0,t,0,0,0,0,1),this}makeRotationZ(e){let t=Math.cos(e),s=Math.sin(e);return this.set(t,-s,0,0,s,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){let s=Math.cos(t),a=Math.sin(t),i=1-s,f=e.x,v=e.y,x=e.z,M=i*f,C=i*v;return this.set(M*f+s,M*v-a*x,M*x+a*v,0,M*v+a*x,C*v+s,C*x-a*f,0,M*x-a*v,C*x+a*f,i*x*x+s,0,0,0,0,1),this}makeScale(e,t,s){return this.set(e,0,0,0,0,t,0,0,0,0,s,0,0,0,0,1),this}makeShear(e,t,s,a,i,f){return this.set(1,s,i,0,e,1,f,0,t,a,1,0,0,0,0,1),this}compose(e,t,s){let a=this.elements,i=t._x,f=t._y,v=t._z,x=t._w,M=i+i,C=f+f,D=v+v,L=i*M,N=i*C,j=i*D,Z=f*C,G=f*D,H=v*D,me=x*M,ne=x*C,fe=x*D,Ee=s.x,de=s.y,we=s.z;return a[0]=(1-(Z+H))*Ee,a[1]=(N+fe)*Ee,a[2]=(j-ne)*Ee,a[3]=0,a[4]=(N-fe)*de,a[5]=(1-(L+H))*de,a[6]=(G+me)*de,a[7]=0,a[8]=(j+ne)*we,a[9]=(G-me)*we,a[10]=(1-(L+Z))*we,a[11]=0,a[12]=e.x,a[13]=e.y,a[14]=e.z,a[15]=1,this}decompose(e,t,s){let a=this.elements,i=ff.set(a[0],a[1],a[2]).length(),f=ff.set(a[4],a[5],a[6]).length(),v=ff.set(a[8],a[9],a[10]).length();this.determinant()<0&&(i=-i),e.x=a[12],e.y=a[13],e.z=a[14],hc.copy(this);let M=1/i,C=1/f,D=1/v;return hc.elements[0]*=M,hc.elements[1]*=M,hc.elements[2]*=M,hc.elements[4]*=C,hc.elements[5]*=C,hc.elements[6]*=C,hc.elements[8]*=D,hc.elements[9]*=D,hc.elements[10]*=D,t.setFromRotationMatrix(hc),s.x=i,s.y=f,s.z=v,this}makePerspective(e,t,s,a,i,f,v=n_){let x=this.elements,M=2*i/(t-e),C=2*i/(s-a),D=(t+e)/(t-e),L=(s+a)/(s-a),N,j;if(v===n_)N=-(f+i)/(f-i),j=-2*f*i/(f-i);else if(v===B7)N=-f/(f-i),j=-f*i/(f-i);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+v);return x[0]=M,x[4]=0,x[8]=D,x[12]=0,x[1]=0,x[5]=C,x[9]=L,x[13]=0,x[2]=0,x[6]=0,x[10]=N,x[14]=j,x[3]=0,x[7]=0,x[11]=-1,x[15]=0,this}makeOrthographic(e,t,s,a,i,f,v=n_){let x=this.elements,M=1/(t-e),C=1/(s-a),D=1/(f-i),L=(t+e)*M,N=(s+a)*C,j,Z;if(v===n_)j=(f+i)*D,Z=-2*D;else if(v===B7)j=i*D,Z=-1*D;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+v);return x[0]=2*M,x[4]=0,x[8]=0,x[12]=-L,x[1]=0,x[5]=2*C,x[9]=0,x[13]=-N,x[2]=0,x[6]=0,x[10]=Z,x[14]=-j,x[3]=0,x[7]=0,x[11]=0,x[15]=1,this}equals(e){let t=this.elements,s=e.elements;for(let a=0;a<16;a++)if(t[a]!==s[a])return!1;return!0}fromArray(e,t=0){for(let s=0;s<16;s++)this.elements[s]=e[s+t];return this}toArray(e=[],t=0){let s=this.elements;return e[t]=s[0],e[t+1]=s[1],e[t+2]=s[2],e[t+3]=s[3],e[t+4]=s[4],e[t+5]=s[5],e[t+6]=s[6],e[t+7]=s[7],e[t+8]=s[8],e[t+9]=s[9],e[t+10]=s[10],e[t+11]=s[11],e[t+12]=s[12],e[t+13]=s[13],e[t+14]=s[14],e[t+15]=s[15],e}},ff=new kr,hc=new r_,k$=new kr(0,0,0),D$=new kr(1,1,1),pd=new kr,N6=new kr,ul=new kr;var Hs=class{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){let s=this.getUtoTmapping(e);return this.getPoint(s,t)}getPoints(e=5){let t=[];for(let s=0;s<=e;s++)t.push(this.getPoint(s/e));return t}getSpacedPoints(e=5){let t=[];for(let s=0;s<=e;s++)t.push(this.getPointAt(s/e));return t}getLength(){let e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;let t=[],s,a=this.getPoint(0),i=0;t.push(0);for(let f=1;f<=e;f++)s=this.getPoint(f/e),i+=s.distanceTo(a),t.push(i),a=s;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){let s=this.getLengths(),a=0,i=s.length,f;t?f=t:f=e*s[i-1];let v=0,x=i-1,M;for(;v<=x;)if(a=Math.floor(v+(x-v)/2),M=s[a]-f,M<0)v=a+1;else if(M>0)x=a-1;else{x=a;break}if(a=x,s[a]===f)return a/(i-1);let C=s[a],L=s[a+1]-C,N=(f-C)/L;return(a+N)/(i-1)}getTangent(e,t){let a=e-1e-4,i=e+1e-4;a<0&&(a=0),i>1&&(i=1);let f=this.getPoint(a),v=this.getPoint(i),x=t||(f.isVector2?new Vr:new kr);return x.copy(v).sub(f).normalize(),x}getTangentAt(e,t){let s=this.getUtoTmapping(e);return this.getTangent(s,t)}computeFrenetFrames(e,t){let s=new kr,a=[],i=[],f=[],v=new kr,x=new r_;for(let N=0;N<=e;N++){let j=N/e;a[N]=this.getTangentAt(j,new kr)}i[0]=new kr,f[0]=new kr;let M=Number.MAX_VALUE,C=Math.abs(a[0].x),D=Math.abs(a[0].y),L=Math.abs(a[0].z);C<=M&&(M=C,s.set(1,0,0)),D<=M&&(M=D,s.set(0,1,0)),L<=M&&s.set(0,0,1),v.crossVectors(a[0],s).normalize(),i[0].crossVectors(a[0],v),f[0].crossVectors(a[0],i[0]);for(let N=1;N<=e;N++){if(i[N]=i[N-1].clone(),f[N]=f[N-1].clone(),v.crossVectors(a[N-1],a[N]),v.length()>Number.EPSILON){v.normalize();let j=Math.acos(ya(a[N-1].dot(a[N]),-1,1));i[N].applyMatrix4(x.makeRotationAxis(v,j))}f[N].crossVectors(a[N],i[N])}if(t===!0){let N=Math.acos(ya(i[0].dot(i[e]),-1,1));N/=e,a[0].dot(v.crossVectors(i[0],i[e]))>0&&(N=-N);for(let j=1;j<=e;j++)i[j].applyMatrix4(x.makeRotationAxis(a[j],N*j)),f[j].crossVectors(a[j],i[j])}return{tangents:a,normals:i,binormals:f}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){let e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}};var j6={};UN(j6,{ArcCurve:()=>z6,CatmullRomCurve3:()=>U6,CubicBezierCurve:()=>mf,CubicBezierCurve3:()=>V6,EllipseCurve:()=>fd,LineCurve:()=>gf,LineCurve3:()=>G6,QuadraticBezierCurve:()=>_f,QuadraticBezierCurve3:()=>H6,SplineCurve:()=>yf});var fd=class extends Hs{constructor(e=0,t=0,s=1,a=1,i=0,f=Math.PI*2,v=!1,x=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=s,this.yRadius=a,this.aStartAngle=i,this.aEndAngle=f,this.aClockwise=v,this.aRotation=x}getPoint(e,t){let s=t||new Vr,a=Math.PI*2,i=this.aEndAngle-this.aStartAngle,f=Math.abs(i)<Number.EPSILON;for(;i<0;)i+=a;for(;i>a;)i-=a;i<Number.EPSILON&&(f?i=0:i=a),this.aClockwise===!0&&!f&&(i===a?i=-a:i=i-a);let v=this.aStartAngle+e*i,x=this.aX+this.xRadius*Math.cos(v),M=this.aY+this.yRadius*Math.sin(v);if(this.aRotation!==0){let C=Math.cos(this.aRotation),D=Math.sin(this.aRotation),L=x-this.aX,N=M-this.aY;x=L*C-N*D+this.aX,M=L*D+N*C+this.aY}return s.set(x,M)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){let e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}};var z6=class extends fd{constructor(e,t,s,a,i,f){super(e,t,s,s,a,i,f),this.isArcCurve=!0,this.type="ArcCurve"}};function q7(){let o=0,e=0,t=0,s=0;function a(i,f,v,x){o=i,e=v,t=-3*i+3*f-2*v-x,s=2*i-2*f+v+x}return{initCatmullRom:function(i,f,v,x,M){a(f,v,M*(v-i),M*(x-f))},initNonuniformCatmullRom:function(i,f,v,x,M,C,D){let L=(f-i)/M-(v-i)/(M+C)+(v-f)/C,N=(v-f)/C-(x-f)/(C+D)+(x-v)/D;L*=C,N*=C,a(f,v,L,N)},calc:function(i){let f=i*i,v=f*i;return o+e*i+t*f+s*v}}}var B6=new kr,H7=new q7,j7=new q7,W7=new q7,U6=class extends Hs{constructor(e=[],t=!1,s="centripetal",a=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=s,this.tension=a}getPoint(e,t=new kr){let s=t,a=this.points,i=a.length,f=(i-(this.closed?0:1))*e,v=Math.floor(f),x=f-v;this.closed?v+=v>0?0:(Math.floor(Math.abs(v)/i)+1)*i:x===0&&v===i-1&&(v=i-2,x=1);let M,C;this.closed||v>0?M=a[(v-1)%i]:(B6.subVectors(a[0],a[1]).add(a[0]),M=B6);let D=a[v%i],L=a[(v+1)%i];if(this.closed||v+2<i?C=a[(v+2)%i]:(B6.subVectors(a[i-1],a[i-2]).add(a[i-1]),C=B6),this.curveType==="centripetal"||this.curveType==="chordal"){let N=this.curveType==="chordal"?.5:.25,j=Math.pow(M.distanceToSquared(D),N),Z=Math.pow(D.distanceToSquared(L),N),G=Math.pow(L.distanceToSquared(C),N);Z<1e-4&&(Z=1),j<1e-4&&(j=Z),G<1e-4&&(G=Z),H7.initNonuniformCatmullRom(M.x,D.x,L.x,C.x,j,Z,G),j7.initNonuniformCatmullRom(M.y,D.y,L.y,C.y,j,Z,G),W7.initNonuniformCatmullRom(M.z,D.z,L.z,C.z,j,Z,G)}else this.curveType==="catmullrom"&&(H7.initCatmullRom(M.x,D.x,L.x,C.x,this.tension),j7.initCatmullRom(M.y,D.y,L.y,C.y,this.tension),W7.initCatmullRom(M.z,D.z,L.z,C.z,this.tension));return s.set(H7.calc(x),j7.calc(x),W7.calc(x)),s}copy(e){super.copy(e),this.points=[];for(let t=0,s=e.points.length;t<s;t++){let a=e.points[t];this.points.push(a.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,s=this.points.length;t<s;t++){let a=this.points[t];e.points.push(a.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,s=e.points.length;t<s;t++){let a=e.points[t];this.points.push(new kr().fromArray(a))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}};function X7(o,e,t,s,a){let i=(s-e)*.5,f=(a-t)*.5,v=o*o,x=o*v;return(2*t-2*s+i+f)*x+(-3*t+3*s-2*i-f)*v+i*o+t}function L$(o,e){let t=1-o;return t*t*e}function F$(o,e){return 2*(1-o)*o*e}function O$(o,e){return o*o*e}function $u(o,e,t,s){return L$(o,e)+F$(o,t)+O$(o,s)}function N$(o,e){let t=1-o;return t*t*t*e}function z$(o,e){let t=1-o;return 3*t*t*o*e}function B$(o,e){return 3*(1-o)*o*o*e}function U$(o,e){return o*o*o*e}function Yu(o,e,t,s,a){return N$(o,e)+z$(o,t)+B$(o,s)+U$(o,a)}var mf=class extends Hs{constructor(e=new Vr,t=new Vr,s=new Vr,a=new Vr){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=s,this.v3=a}getPoint(e,t=new Vr){let s=t,a=this.v0,i=this.v1,f=this.v2,v=this.v3;return s.set(Yu(e,a.x,i.x,f.x,v.x),Yu(e,a.y,i.y,f.y,v.y)),s}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}};var V6=class extends Hs{constructor(e=new kr,t=new kr,s=new kr,a=new kr){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=s,this.v3=a}getPoint(e,t=new kr){let s=t,a=this.v0,i=this.v1,f=this.v2,v=this.v3;return s.set(Yu(e,a.x,i.x,f.x,v.x),Yu(e,a.y,i.y,f.y,v.y),Yu(e,a.z,i.z,f.z,v.z)),s}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}};var gf=class extends Hs{constructor(e=new Vr,t=new Vr){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new Vr){let s=t;return e===1?s.copy(this.v2):(s.copy(this.v2).sub(this.v1),s.multiplyScalar(e).add(this.v1)),s}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new Vr){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}};var G6=class extends Hs{constructor(e=new kr,t=new kr){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new kr){let s=t;return e===1?s.copy(this.v2):(s.copy(this.v2).sub(this.v1),s.multiplyScalar(e).add(this.v1)),s}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new kr){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}};var _f=class extends Hs{constructor(e=new Vr,t=new Vr,s=new Vr){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=s}getPoint(e,t=new Vr){let s=t,a=this.v0,i=this.v1,f=this.v2;return s.set($u(e,a.x,i.x,f.x),$u(e,a.y,i.y,f.y)),s}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}};var H6=class extends Hs{constructor(e=new kr,t=new kr,s=new kr){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=s}getPoint(e,t=new kr){let s=t,a=this.v0,i=this.v1,f=this.v2;return s.set($u(e,a.x,i.x,f.x),$u(e,a.y,i.y,f.y),$u(e,a.z,i.z,f.z)),s}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}};var yf=class extends Hs{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new Vr){let s=t,a=this.points,i=(a.length-1)*e,f=Math.floor(i),v=i-f,x=a[f===0?f:f-1],M=a[f],C=a[f>a.length-2?a.length-1:f+1],D=a[f>a.length-3?a.length-1:f+2];return s.set(X7(v,x.x,M.x,C.x,D.x),X7(v,x.y,M.y,C.y,D.y)),s}copy(e){super.copy(e),this.points=[];for(let t=0,s=e.points.length;t<s;t++){let a=e.points[t];this.points.push(a.clone())}return this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,s=this.points.length;t<s;t++){let a=this.points[t];e.points.push(a.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,s=e.points.length;t<s;t++){let a=e.points[t];this.points.push(new Vr().fromArray(a))}return this}};var W6=class extends Hs{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){let e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){let s=e.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new j6[s](t,e))}return this}getPoint(e,t){let s=e*this.getLength(),a=this.getCurveLengths(),i=0;for(;i<a.length;){if(a[i]>=s){let f=a[i]-s,v=this.curves[i],x=v.getLength(),M=x===0?0:1-f/x;return v.getPointAt(M,t)}i++}return null}getLength(){let e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;let e=[],t=0;for(let s=0,a=this.curves.length;s<a;s++)t+=this.curves[s].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){let t=[];for(let s=0;s<=e;s++)t.push(this.getPoint(s/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){let t=[],s;for(let a=0,i=this.curves;a<i.length;a++){let f=i[a],v=f.isEllipseCurve?e*2:f.isLineCurve||f.isLineCurve3?1:f.isSplineCurve?e*f.points.length:e,x=f.getPoints(v);for(let M=0;M<x.length;M++){let C=x[M];s&&s.equals(C)||(t.push(C),s=C)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,s=e.curves.length;t<s;t++){let a=e.curves[t];this.curves.push(a.clone())}return this.autoClose=e.autoClose,this}toJSON(){let e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,s=this.curves.length;t<s;t++){let a=this.curves[t];e.curves.push(a.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,s=e.curves.length;t<s;t++){let a=e.curves[t];this.curves.push(new j6[a.type]().fromJSON(a))}return this}};var Ju=class extends W6{constructor(e){super(),this.type="Path",this.currentPoint=new Vr,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,s=e.length;t<s;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){let s=new gf(this.currentPoint.clone(),new Vr(e,t));return this.curves.push(s),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,s,a){let i=new _f(this.currentPoint.clone(),new Vr(e,t),new Vr(s,a));return this.curves.push(i),this.currentPoint.set(s,a),this}bezierCurveTo(e,t,s,a,i,f){let v=new mf(this.currentPoint.clone(),new Vr(e,t),new Vr(s,a),new Vr(i,f));return this.curves.push(v),this.currentPoint.set(i,f),this}splineThru(e){let t=[this.currentPoint.clone()].concat(e),s=new yf(t);return this.curves.push(s),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,s,a,i,f){let v=this.currentPoint.x,x=this.currentPoint.y;return this.absarc(e+v,t+x,s,a,i,f),this}absarc(e,t,s,a,i,f){return this.absellipse(e,t,s,s,a,i,f),this}ellipse(e,t,s,a,i,f,v,x){let M=this.currentPoint.x,C=this.currentPoint.y;return this.absellipse(e+M,t+C,s,a,i,f,v,x),this}absellipse(e,t,s,a,i,f,v,x){let M=new fd(e,t,s,a,i,f,v,x);if(this.curves.length>0){let D=M.getPoint(0);D.equals(this.currentPoint)||this.lineTo(D.x,D.y)}this.curves.push(M);let C=M.getPoint(1);return this.currentPoint.copy(C),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){let e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}};var vf=class extends Ju{constructor(e){super(e),this.uuid=GR(),this.type="Shape",this.holes=[]}getPointsHoles(e){let t=[];for(let s=0,a=this.holes.length;s<a;s++)t[s]=this.holes[s].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,s=e.holes.length;t<s;t++){let a=e.holes[t];this.holes.push(a.clone())}return this}toJSON(){let e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,s=this.holes.length;t<s;t++){let a=this.holes[t];e.holes.push(a.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,s=e.holes.length;t<s;t++){let a=e.holes[t];this.holes.push(new Ju().fromJSON(a))}return this}};var JR={triangulate:function(o,e,t=2){let s=e&&e.length,a=s?e[0]*t:o.length,i=KR(o,0,a,t,!0),f=[];if(!i||i.next===i.prev)return f;let v,x,M,C,D,L,N;if(s&&(i=W$(o,e,i,t)),o.length>80*t){v=M=o[0],x=C=o[1];for(let j=t;j<a;j+=t)D=o[j],L=o[j+1],D<v&&(v=D),L<x&&(x=L),D>M&&(M=D),L>C&&(C=L);N=Math.max(M-v,C-x),N=N!==0?32767/N:0}return s_(i,f,t,v,x,N,0),f}};function KR(o,e,t,s,a){let i,f;if(a===iY(o,e,t,s)>0)for(i=e;i<t;i+=s)f=YR(i,o[i],o[i+1],f);else for(i=t-s;i>=e;i-=s)f=YR(i,o[i],o[i+1],f);return f&&Z6(f,f.next)&&(a_(f),f=f.next),f}function Ku(o,e){if(!o)return o;e||(e=o);let t=o,s;do if(s=!1,!t.steiner&&(Z6(t,t.next)||Bs(t.prev,t,t.next)===0)){if(a_(t),t=e=t.prev,t===t.next)break;s=!0}else t=t.next;while(s||t!==e);return e}function s_(o,e,t,s,a,i,f){if(!o)return;!f&&i&&Y$(o,s,a,i);let v=o,x,M;for(;o.prev!==o.next;){if(x=o.prev,M=o.next,i?G$(o,s,a,i):V$(o)){e.push(x.i/t|0),e.push(o.i/t|0),e.push(M.i/t|0),a_(o),o=M.next,v=M.next;continue}if(o=M,o===v){f?f===1?(o=H$(Ku(o),e,t),s_(o,e,t,s,a,i,2)):f===2&&j$(o,e,t,s,a,i):s_(Ku(o),e,t,s,a,i,1);break}}}function V$(o){let e=o.prev,t=o,s=o.next;if(Bs(e,t,s)>=0)return!1;let a=e.x,i=t.x,f=s.x,v=e.y,x=t.y,M=s.y,C=a<i?a<f?a:f:i<f?i:f,D=v<x?v<M?v:M:x<M?x:M,L=a>i?a>f?a:f:i>f?i:f,N=v>x?v>M?v:M:x>M?x:M,j=s.next;for(;j!==e;){if(j.x>=C&&j.x<=L&&j.y>=D&&j.y<=N&&xf(a,v,i,x,f,M,j.x,j.y)&&Bs(j.prev,j,j.next)>=0)return!1;j=j.next}return!0}function G$(o,e,t,s){let a=o.prev,i=o,f=o.next;if(Bs(a,i,f)>=0)return!1;let v=a.x,x=i.x,M=f.x,C=a.y,D=i.y,L=f.y,N=v<x?v<M?v:M:x<M?x:M,j=C<D?C<L?C:L:D<L?D:L,Z=v>x?v>M?v:M:x>M?x:M,G=C>D?C>L?C:L:D>L?D:L,H=Z7(N,j,e,t,s),me=Z7(Z,G,e,t,s),ne=o.prevZ,fe=o.nextZ;for(;ne&&ne.z>=H&&fe&&fe.z<=me;){if(ne.x>=N&&ne.x<=Z&&ne.y>=j&&ne.y<=G&&ne!==a&&ne!==f&&xf(v,C,x,D,M,L,ne.x,ne.y)&&Bs(ne.prev,ne,ne.next)>=0||(ne=ne.prevZ,fe.x>=N&&fe.x<=Z&&fe.y>=j&&fe.y<=G&&fe!==a&&fe!==f&&xf(v,C,x,D,M,L,fe.x,fe.y)&&Bs(fe.prev,fe,fe.next)>=0))return!1;fe=fe.nextZ}for(;ne&&ne.z>=H;){if(ne.x>=N&&ne.x<=Z&&ne.y>=j&&ne.y<=G&&ne!==a&&ne!==f&&xf(v,C,x,D,M,L,ne.x,ne.y)&&Bs(ne.prev,ne,ne.next)>=0)return!1;ne=ne.prevZ}for(;fe&&fe.z<=me;){if(fe.x>=N&&fe.x<=Z&&fe.y>=j&&fe.y<=G&&fe!==a&&fe!==f&&xf(v,C,x,D,M,L,fe.x,fe.y)&&Bs(fe.prev,fe,fe.next)>=0)return!1;fe=fe.nextZ}return!0}function H$(o,e,t){let s=o;do{let a=s.prev,i=s.next.next;!Z6(a,i)&&QR(a,s,s.next,i)&&o_(a,i)&&o_(i,a)&&(e.push(a.i/t|0),e.push(s.i/t|0),e.push(i.i/t|0),a_(s),a_(s.next),s=o=i),s=s.next}while(s!==o);return Ku(s)}function j$(o,e,t,s,a,i){let f=o;do{let v=f.next.next;for(;v!==f.prev;){if(f.i!==v.i&&Q$(f,v)){let x=ek(f,v);f=Ku(f,f.next),x=Ku(x,x.next),s_(f,e,t,s,a,i,0),s_(x,e,t,s,a,i,0);return}v=v.next}f=f.next}while(f!==o)}function W$(o,e,t,s){let a=[],i,f,v,x,M;for(i=0,f=e.length;i<f;i++)v=e[i]*s,x=i<f-1?e[i+1]*s:o.length,M=KR(o,v,x,s,!1),M===M.next&&(M.steiner=!0),a.push(K$(M));for(a.sort(q$),i=0;i<a.length;i++)t=X$(a[i],t);return t}function q$(o,e){return o.x-e.x}function X$(o,e){let t=Z$(o,e);if(!t)return e;let s=ek(t,o);return Ku(s,s.next),Ku(t,t.next)}function Z$(o,e){let t=e,s=-1/0,a,i=o.x,f=o.y;do{if(f<=t.y&&f>=t.next.y&&t.next.y!==t.y){let L=t.x+(f-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(L<=i&&L>s&&(s=L,a=t.x<t.next.x?t:t.next,L===i))return a}t=t.next}while(t!==e);if(!a)return null;let v=a,x=a.x,M=a.y,C=1/0,D;t=a;do i>=t.x&&t.x>=x&&i!==t.x&&xf(f<M?i:s,f,x,M,f<M?s:i,f,t.x,t.y)&&(D=Math.abs(f-t.y)/(i-t.x),o_(t,o)&&(D<C||D===C&&(t.x>a.x||t.x===a.x&&$$(a,t)))&&(a=t,C=D)),t=t.next;while(t!==v);return a}function $$(o,e){return Bs(o.prev,o,e.prev)<0&&Bs(e.next,o,o.next)<0}function Y$(o,e,t,s){let a=o;do a.z===0&&(a.z=Z7(a.x,a.y,e,t,s)),a.prevZ=a.prev,a.nextZ=a.next,a=a.next;while(a!==o);a.prevZ.nextZ=null,a.prevZ=null,J$(a)}function J$(o){let e,t,s,a,i,f,v,x,M=1;do{for(t=o,o=null,i=null,f=0;t;){for(f++,s=t,v=0,e=0;e<M&&(v++,s=s.nextZ,!!s);e++);for(x=M;v>0||x>0&&s;)v!==0&&(x===0||!s||t.z<=s.z)?(a=t,t=t.nextZ,v--):(a=s,s=s.nextZ,x--),i?i.nextZ=a:o=a,a.prevZ=i,i=a;t=s}i.nextZ=null,M*=2}while(f>1);return o}function Z7(o,e,t,s,a){return o=(o-t)*a|0,e=(e-s)*a|0,o=(o|o<<8)&16711935,o=(o|o<<4)&252645135,o=(o|o<<2)&858993459,o=(o|o<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,o|e<<1}function K$(o){let e=o,t=o;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==o);return t}function xf(o,e,t,s,a,i,f,v){return(a-f)*(e-v)>=(o-f)*(i-v)&&(o-f)*(s-v)>=(t-f)*(e-v)&&(t-f)*(i-v)>=(a-f)*(s-v)}function Q$(o,e){return o.next.i!==e.i&&o.prev.i!==e.i&&!eY(o,e)&&(o_(o,e)&&o_(e,o)&&tY(o,e)&&(Bs(o.prev,o,e.prev)||Bs(o,e.prev,e))||Z6(o,e)&&Bs(o.prev,o,o.next)>0&&Bs(e.prev,e,e.next)>0)}function Bs(o,e,t){return(e.y-o.y)*(t.x-e.x)-(e.x-o.x)*(t.y-e.y)}function Z6(o,e){return o.x===e.x&&o.y===e.y}function QR(o,e,t,s){let a=X6(Bs(o,e,t)),i=X6(Bs(o,e,s)),f=X6(Bs(t,s,o)),v=X6(Bs(t,s,e));return!!(a!==i&&f!==v||a===0&&q6(o,t,e)||i===0&&q6(o,s,e)||f===0&&q6(t,o,s)||v===0&&q6(t,e,s))}function q6(o,e,t){return e.x<=Math.max(o.x,t.x)&&e.x>=Math.min(o.x,t.x)&&e.y<=Math.max(o.y,t.y)&&e.y>=Math.min(o.y,t.y)}function X6(o){return o>0?1:o<0?-1:0}function eY(o,e){let t=o;do{if(t.i!==o.i&&t.next.i!==o.i&&t.i!==e.i&&t.next.i!==e.i&&QR(t,t.next,o,e))return!0;t=t.next}while(t!==o);return!1}function o_(o,e){return Bs(o.prev,o,o.next)<0?Bs(o,e,o.next)>=0&&Bs(o,o.prev,e)>=0:Bs(o,e,o.prev)<0||Bs(o,o.next,e)<0}function tY(o,e){let t=o,s=!1,a=(o.x+e.x)/2,i=(o.y+e.y)/2;do t.y>i!=t.next.y>i&&t.next.y!==t.y&&a<(t.next.x-t.x)*(i-t.y)/(t.next.y-t.y)+t.x&&(s=!s),t=t.next;while(t!==o);return s}function ek(o,e){let t=new $7(o.i,o.x,o.y),s=new $7(e.i,e.x,e.y),a=o.next,i=e.prev;return o.next=e,e.prev=o,t.next=a,a.prev=t,s.next=t,t.prev=s,i.next=s,s.prev=i,s}function YR(o,e,t,s){let a=new $7(o,e,t);return s?(a.next=s.next,a.prev=s,s.next.prev=a,s.next=a):(a.prev=a,a.next=a),a}function a_(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function $7(o,e,t){this.i=o,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function iY(o,e,t,s){let a=0;for(let i=e,f=t-s;i<t;i+=s)a+=(o[f]-o[i])*(o[i+1]+o[f+1]),f=i;return a}var md=class o{static area(e){let t=e.length,s=0;for(let a=t-1,i=0;i<t;a=i++)s+=e[a].x*e[i].y-e[i].x*e[a].y;return s*.5}static isClockWise(e){return o.area(e)<0}static triangulateShape(e,t){let s=[],a=[],i=[];tk(e),ik(s,e);let f=e.length;t.forEach(tk);for(let x=0;x<t.length;x++)a.push(f),f+=t[x].length,ik(s,t[x]);let v=JR.triangulate(s,a);for(let x=0;x<v.length;x+=3)i.push(v.slice(x,x+3));return i}};function tk(o){let e=o.length;e>2&&o[e-1].equals(o[0])&&o.pop()}function ik(o,e){for(let t=0;t<e.length;t++)o.push(e[t].x),o.push(e[t].y)}var $6=class{constructor(){this.type="ShapePath",this.color=new pf,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new Ju,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,s,a){return this.currentPath.quadraticCurveTo(e,t,s,a),this}bezierCurveTo(e,t,s,a,i,f){return this.currentPath.bezierCurveTo(e,t,s,a,i,f),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(H){let me=[];for(let ne=0,fe=H.length;ne<fe;ne++){let Ee=H[ne],de=new vf;de.curves=Ee.curves,me.push(de)}return me}function s(H,me){let ne=me.length,fe=!1;for(let Ee=ne-1,de=0;de<ne;Ee=de++){let we=me[Ee],Le=me[de],De=Le.x-we.x,se=Le.y-we.y;if(Math.abs(se)>Number.EPSILON){if(se<0&&(we=me[de],De=-De,Le=me[Ee],se=-se),H.y<we.y||H.y>Le.y)continue;if(H.y===we.y){if(H.x===we.x)return!0}else{let Ce=se*(H.x-we.x)-De*(H.y-we.y);if(Ce===0)return!0;if(Ce<0)continue;fe=!fe}}else{if(H.y!==we.y)continue;if(Le.x<=H.x&&H.x<=we.x||we.x<=H.x&&H.x<=Le.x)return!0}}return fe}let a=md.isClockWise,i=this.subPaths;if(i.length===0)return[];let f,v,x,M=[];if(i.length===1)return v=i[0],x=new vf,x.curves=v.curves,M.push(x),M;let C=!a(i[0].getPoints());C=e?!C:C;let D=[],L=[],N=[],j=0,Z;L[j]=void 0,N[j]=[];for(let H=0,me=i.length;H<me;H++)v=i[H],Z=v.getPoints(),f=a(Z),f=e?!f:f,f?(!C&&L[j]&&j++,L[j]={s:new vf,p:Z},L[j].s.curves=v.curves,C&&j++,N[j]=[]):N[j].push({h:v,p:Z[0]});if(!L[0])return t(i);if(L.length>1){let H=!1,me=0;for(let ne=0,fe=L.length;ne<fe;ne++)D[ne]=[];for(let ne=0,fe=L.length;ne<fe;ne++){let Ee=N[ne];for(let de=0;de<Ee.length;de++){let we=Ee[de],Le=!0;for(let De=0;De<L.length;De++)s(we.p,L[De].p)&&(ne!==De&&me++,Le?(Le=!1,D[De].push(we)):H=!0);Le&&D[ne].push(we)}}me>0&&H===!1&&(N=D)}let G;for(let H=0,me=L.length;H<me;H++){x=L[H].s,M.push(x),G=N[H];for(let ne=0,fe=G.length;ne<fe;ne++)x.holes.push(G[ne].h)}return M}};var wo=Object.freeze({TEXT:0,ESCAPE:1,SKIP_FORMAT:2,PARAGRAPH1:3,PARAGRAPH2:4,PARAGRAPH3:5}),gd=Object.freeze({TEXT:0,SCOPE:1,PARAGRAPH:2,NON_BREAKING_SPACE:3,PARAGRAPH_ALIGNMENT:4}),nY=new Set(["L","l","O","o","K","k","P","X","~"]),rY=new Set(["f","F","p","Q","H","W","S","A","C","T"]),sY=new Set(["\\","{","}"]),j0=(()=>{class o{constructor(){this.entities=[]}Parse(t){let s=t.length,a=0,i=wo.TEXT,f=[],v=this.entities,x=0,M=this;function C(){i!==wo.TEXT||a===x||(v.push({type:gd.TEXT,content:t.slice(a,x)}),a=x)}function D(j){v.push({type:j})}function L(){let j={type:gd.SCOPE,content:[]};v.push(j),v=j.content,f.push(j)}function N(){f.length!==0&&(f.pop(),f.length===0?v=M.entities:v=f[f.length-1].content)}for(;x<s;x++){let j=t.charAt(x);switch(i){case wo.TEXT:if(j==="{"){C(),L(),a=x+1;continue}if(j==="}"){C(),N(),a=x+1;continue}if(j==="\\"){C(),i=wo.ESCAPE;continue}continue;case wo.ESCAPE:if(nY.has(j)){switch(j){case"P":D(gd.PARAGRAPH);break;case"~":D(gd.NON_BREAKING_SPACE);break}i=wo.TEXT,a=x+1;continue}if(rY.has(j)){switch(j){case"p":i=wo.PARAGRAPH1;continue}i=wo.SKIP_FORMAT;continue}sY.has(j)?a=x:a=x-1,i=wo.TEXT;continue;case wo.PARAGRAPH1:i=j==="x"?wo.PARAGRAPH2:wo.SKIP_FORMAT;continue;case wo.PARAGRAPH2:i=j==="q"?wo.PARAGRAPH3:wo.SKIP_FORMAT;continue;case wo.PARAGRAPH3:v.push({type:gd.PARAGRAPH_ALIGNMENT,alignment:j}),i=wo.SKIP_FORMAT;continue;case wo.SKIP_FORMAT:j===";"&&(a=x+1,i=wo.TEXT);continue;default:throw new Error("Unhandled state")}}C()}GetContent(){return this.entities}*GetText(){function*t(s){for(let a of s)a.type===gd.TEXT?yield a.content:a.type===gd.SCOPE&&(yield*ws(t(a.content)))}yield*ws(t(this.GetContent()))}}return o.EntityType=gd,o})();var oY=/(?:%%([dpcou%]))|(?:\\U\+([0-9a-fA-F]{4}))/g;function Kc(o){return o.replaceAll(oY,(e,t,s)=>{if(t!==void 0)switch(t){case"d":return"\xB0";case"p":return"\xB1";case"c":return"\u2205";case"o":return"";case"u":return"";case"%":return"%"}else if(s!==void 0){let a=parseInt(s,16);return isNaN(a)?e:String.fromCharCode(a)}return e})}var K7=(()=>{class o{constructor(t,s=null){this.fontFetchers=t,this.fonts=[],this.options=Object.create(o.DefaultOptions),s&&Object.assign(this.options,s),this.shapes=new Map,this.stubShapeLoaded=!1,this.stubShape=null}FetchFonts(t){return yr(this,null,function*(){if(!this.stubShapeLoaded){this.stubShapeLoaded=!0;for(let a of Array.from(this.options.fallbackChar))if(yield this.FetchFonts(a)){this.stubShape=this._CreateCharShape(a);break}}let s=!1;for(let a of t){if(a.codePointAt(0)<32)continue;let i=!1;for(let f of this.fonts)if(f.HasChar(a)){i=!0;break}if(!i){if(!this.fontFetchers)return!1;for(;this.fontFetchers.length>0;){let f=this.fontFetchers.shift(),v=yield this._FetchFont(f);if(this.fonts.push(v),v.HasChar(a)){i=!0;break}}i||(s=!0)}}return!s})}get canRender(){return this.fonts!==null&&this.fonts.length>0}GetLineWidth(t,s){let a=new l_(s);for(let i of t){let f=this._GetCharShape(i);f&&a.PushChar(i,f)}return a.GetCurrentPosition()}*Render({text:t,startPos:s,endPos:a,rotation:i=0,widthFactor:f=1,hAlign:v=0,vAlign:x=0,color:M,layer:C=null,fontSize:D}){let L=new l_(D);for(let N of t){let j=this._GetCharShape(N);j&&L.PushChar(N,j)}yield*ws(L.Render(s,a,i,f,v,x,M,C))}*RenderMText({formattedText:t,position:s,fontSize:a,width:i=null,rotation:f=0,direction:v=null,attachment:x,lineSpacing:M=1,color:C,layer:D=null}){let L=new _d(a,this._GetCharShape.bind(this));L.FeedText(t),yield*ws(L.Render(s,i,f,v,x,M,C,D))}_GetCharShape(t){let s=this.shapes.get(t);return s||(s=this._CreateCharShape(t),this.shapes.set(t,s),s)}_CreateCharShape(t){for(let s of this.fonts){let a=s.GetCharPath(t);if(a)return new Y7(s,a,this.options)}return this.stubShape}_FetchFont(t){return yr(this,null,function*(){return new J7(yield t())})}}return o.DefaultOptions={curveSubdivision:2,fallbackChar:"\uFFFD?"},o})(),Y7=class{constructor(e,t,s){if(this.font=e,this.advance=t.advance,this.bounds=t.bounds,t.path){let i=t.path.toShapes(!1);this.vertices=[],this.indices=[];for(let f of i){let D=function(L){for(let N of L)M.vertices.push(N)};var a=D;let v=f.extractPoints(s.curveSubdivision);if(!md.isClockWise(v.shape)){v.shape=v.shape.reverse();for(let L of v.holes)md.isClockWise(L)&&(v.holes[h]=L.reverse())}let x=md.triangulateShape(v.shape,v.holes),M=this,C=this.vertices.length;D(v.shape);for(let L of v.holes)D(L);for(let L of x)for(let N of L)this.indices.push(C+N)}}else this.vertices=null}GetVertices(e,t){return this.vertices.map(s=>s.clone().multiplyScalar(t).add(e))}},J7=class{constructor(e){this.data=e,this.charMap=new Map;for(let t of Object.values(e.glyphs.glyphs))t.unicode!==void 0&&this.charMap.set(String.fromCodePoint(t.unicode),t);this.scale=100/((this.data.unitsPerEm||2048)*72)}HasChar(e){return this.charMap.has(e)}GetCharPath(e){let t=this.charMap.get(e);if(!t)return null;let s=this.scale,a=new $6;for(let i of t.path.commands)switch(i.type){case"M":a.moveTo(i.x*s,i.y*s);break;case"L":a.lineTo(i.x*s,i.y*s);break;case"Q":a.quadraticCurveTo(i.x1*s,i.y1*s,i.x*s,i.y*s);break;case"C":a.bezierCurveTo(i.x1*s,i.y1*s,i.x2*s,i.y2*s,i.x*s,i.y*s);break}return{advance:t.advanceWidth*s,path:a,bounds:{xMin:t.xMin*s,xMax:t.xMax*s,yMin:t.yMin*s,yMax:t.yMax*s}}}GetKerning(e,t){let s=this.data.charToGlyphIndex(e);if(s===0)return 0;let a=this.data.charToGlyphIndex(e);return a===0?0:this.data.getKerningValue(s,a)*this.scale}},pl=Object.freeze({LEFT:0,CENTER:1,RIGHT:2,ALIGNED:3,MIDDLE:4,FIT:5}),W0=Object.freeze({BASELINE:0,BOTTOM:1,MIDDLE:2,TOP:3}),va=Object.freeze({TOP_LEFT:1,TOP_CENTER:2,TOP_RIGHT:3,MIDDLE_LEFT:4,MIDDLE_CENTER:5,MIDDLE_RIGHT:6,BOTTOM_LEFT:7,BOTTOM_CENTER:8,BOTTOM_RIGHT:9}),_d=(()=>{class o{constructor(t,s){this.fontSize=t,this.charShapeProvider=s,this.curParagraph=new o.Paragraph(this),this.paragraphs=[this.curParagraph],this.spaceShape=s(" ")}FeedText(t){function*s(i){for(let f of i)f.type===j0.EntityType.SCOPE?yield*ws(s(f.content)):yield f}let a=null;for(let i of s(t))switch(i.type){case j0.EntityType.TEXT:for(let v of i.content)v===" "?this.curParagraph.FeedSpace():this.curParagraph.FeedChar(v);break;case j0.EntityType.PARAGRAPH:this.curParagraph=new o.Paragraph(this),this.curParagraph.SetAlignment(a),this.paragraphs.push(this.curParagraph);break;case j0.EntityType.NON_BREAKING_SPACE:this.curParagraph.FeedChar(" ");break;case j0.EntityType.PARAGRAPH_ALIGNMENT:let f=null;switch(i.alignment){case"l":f=o.Paragraph.Alignment.LEFT;break;case"c":f=o.Paragraph.Alignment.CENTER;break;case"r":f=o.Paragraph.Alignment.RIGHT;break;case"d":f=o.Paragraph.Alignment.JUSTIFY;break;case"j":f=null;break}this.curParagraph.SetAlignment(f),a=f;break}}*Render(t,s,a,i,f,v,x,M){for(let G of this.paragraphs)G.BuildLines(s);if(s===null||s===0){s=0;for(let G of this.paragraphs){let H=G.GetMaxLineWidth();H>s&&(s=H)}}let C=o.Paragraph.Alignment.LEFT;switch(f){case va.TOP_CENTER:case va.MIDDLE_CENTER:case va.BOTTOM_CENTER:C=o.Paragraph.Alignment.CENTER;break;case va.TOP_RIGHT:case va.MIDDLE_RIGHT:case va.BOTTOM_RIGHT:C=o.Paragraph.Alignment.RIGHT;break}for(let G of this.paragraphs)G.ApplyAlignment(s,C);i!==null&&(a=Math.atan2(i.y,i.x)*180/Math.PI);let D=v*5*this.fontSize/3,L=0;for(let G of this.paragraphs)G.lines===null?L++:L+=G.lines.length;L*=D;let N=new ui;switch(f){case va.TOP_LEFT:break;case va.TOP_CENTER:N.x=s/2;break;case va.TOP_RIGHT:N.x=s;break;case va.MIDDLE_LEFT:N.y=-L/2;break;case va.MIDDLE_CENTER:N.x=s/2,N.y=-L/2;break;case va.MIDDLE_RIGHT:N.x=s,N.y=-L/2;break;case va.BOTTOM_LEFT:N.y=-L;break;case va.BOTTOM_CENTER:N.x=s/2,N.y=-L;break;case va.BOTTOM_RIGHT:N.x=s,N.y=-L;break;default:throw new Error("Unhandled alignment")}let j=new Bn().translate(-N.x,-N.y).rotate(-a*Math.PI/180).translate(t.x,t.y),Z=-this.fontSize;for(let G of this.paragraphs){if(G.lines===null){Z-=D;continue}for(let H of G.lines){for(let me=H.startChunkIdx;me<H.startChunkIdx+H.numChunks;me++){let ne=G.chunks[me],fe=ne.position;(me===0||me!==H.startChunkIdx)&&(fe+=ne.GetSpacingWidth());let Ee=new ui(fe,Z);Ee.applyMatrix3(j),ne.block&&(yield*ws(ne.block.Render(Ee,null,a,null,pl.LEFT,W0.BASELINE,x,M)))}Z-=D}}}}return o.Paragraph=class{constructor(e){this.textBox=e,this.chunks=[],this.curChunk=null,this.alignment=null,this.lines=null}FeedChar(e){let t=this.textBox.charShapeProvider(e);t!==null&&(this.curChunk===null&&this._AddChunk(),this.curChunk.PushChar(e,t))}FeedSpace(){(this.curChunk===null||this.curChunk.lastChar!==null)&&this._AddChunk(),this.curChunk.PushSpace()}SetAlignment(e){this.alignment=e}BuildLines(e){if(this.curChunk===null)return;this.lines=[];let t=0,s=0,a=0,i=()=>{this.lines.push(new o.Paragraph.Line(this,t,s-t,a)),t=s,a=0};for(;s<this.chunks.length;s++){let f=this.chunks[s],v=f.GetWidth(t===0||s!==t);e!==null&&e!==0&&a!==0&&a+v>e&&i(),f.position=a,a+=v}t!==s&&a!==0&&i()}GetMaxLineWidth(){if(this.lines===null)return 0;let e=0;for(let t of this.lines)t.width>e&&(e=t.width);return e}ApplyAlignment(e,t){if(this.lines)for(let s of this.lines)s.ApplyAlignment(e,t)}_AddChunk(){this.curChunk=new o.Paragraph.Chunk(this,this.textBox.fontSize,this.curChunk),this.chunks.push(this.curChunk)}},o})();_d.Paragraph.Alignment=Object.freeze({LEFT:0,CENTER:1,RIGHT:2,JUSTIFY:3});_d.Paragraph.Chunk=class{constructor(o,e,t){this.paragraph=o,this.fontSize=e,this.prevChunk=t,this.lastChar=null,this.lastShape=null,this.leadingSpaces=0,this.spaceStartKerning=null,this.spaceEndKerning=null,this.block=null,this.position=null}PushSpace(){if(this.block)throw new Error("Illegal operation");this.leadingSpaces++}PushChar(o,e){this.spaceStartKerning===null&&(this.leadingSpaces===0?(this.spaceStartKerning=0,this.spaceEndKerning=0):(this.prevChunk&&this.prevChunk.lastShape&&this.prevChunk.fontSize===this.fontSize&&this.prevChunk.lastShape.font===this.paragraph.textBox.spaceShape.font?this.spaceStartKerning=this.prevChunk.lastShape.font.GetKerning(this.prevChunk.lastChar," "):this.spaceStartKerning=0,e.font===this.paragraph.textBox.spaceShape.font?this.spaceEndKerning=e.font.GetKerning(" ",o):this.spaceEndKerning=0)),this.block===null&&(this.block=new l_(this.fontSize)),this.block.PushChar(o,e),this.lastChar=o,this.lastShape=e}GetSpacingWidth(){return(this.leadingSpaces*this.paragraph.textBox.spaceShape.advance+this.spaceStartKerning+this.spaceEndKerning)*this.fontSize}GetWidth(o){if(this.block===null)return 0;let e=this.block.GetCurrentPosition();return o&&(e+=this.GetSpacingWidth()),e}};_d.Paragraph.Line=class{constructor(o,e,t,s){this.paragraph=o,this.startChunkIdx=e,this.numChunks=t,this.width=s}ApplyAlignment(o,e){switch(this.paragraph.alignment??e){case _d.Paragraph.Alignment.LEFT:break;case _d.Paragraph.Alignment.CENTER:{let s=(o-this.width)/2;this.ForEachChunk(a=>a.position+=s);break}case _d.Paragraph.Alignment.RIGHT:{let s=o-this.width;this.ForEachChunk(a=>a.position+=s);break}case _d.Paragraph.Alignment.JUSTIFY:{let s=o-this.width;if(s<=0||this.numChunks===1)break;let a=s/(this.numChunks-1),i=0;this.ForEachChunk(f=>{f.position+=i,i+=a});break}default:throw new Error("Unhandled alignment: "+this.paragraph.alignment)}}ForEachChunk(o){for(let e=0;e<this.numChunks;e++)o(this.paragraph.chunks[this.startChunkIdx+e])}};var l_=class{constructor(e){this.fontSize=e,this.glyphs=[],this.bounds=null,this.curX=0,this.prevChar=null,this.prevFont=null}PushChar(e,t){let s;this.prevChar!==null&&this.prevFont===t.font?s=this.prevFont.GetKerning(this.prevChar,e):s=0;let a=this.curX+s*this.fontSize,i;if(t.vertices){i=t.GetVertices({x:a,y:0},this.fontSize);let f=a+t.bounds.xMin*this.fontSize,v=a+t.bounds.xMax*this.fontSize,x=t.bounds.yMin*this.fontSize,M=t.bounds.yMax*this.fontSize;this.bounds===null?this.bounds={xMin:f,xMax:v,yMin:x,yMax:M}:(f<this.bounds.xMin&&(this.bounds.xMin=f),x<this.bounds.yMin&&(this.bounds.yMin=x),v>this.bounds.xMax&&(this.bounds.xMax=v),M>this.bounds.yMax&&(this.bounds.yMax=M))}else i=null;this.curX=a+t.advance*this.fontSize,this.glyphs.push({shape:t,vertices:i}),this.prevChar=e,this.prevFont=t.font}GetCurrentPosition(){return this.curX}*Render(e,t,s,a,i,f,v,x){if(this.bounds===null)return;t=t??e,s?s*=-Math.PI/180:s=0,a=a??1,i=i??pl.LEFT,f=f??W0.BASELINE;let M=new ui,C=new ui(a,1),D=i===pl.LEFT&&f===W0.BASELINE||i===pl.FIT||i===pl.ALIGNED?new ui(e.x,e.y):new ui(t.x,t.y),L=()=>{let Z=t.x-e.x;return Z<Number.MIN_VALUE*2?a:Z/(this.bounds.xMax-this.bounds.xMin)},N=()=>-Math.atan2(t.y-e.y,t.x-e.x);switch(i){case pl.LEFT:M.x=this.bounds.xMin;break;case pl.CENTER:M.x=(this.bounds.xMax-this.bounds.xMin)/2;break;case pl.RIGHT:M.x=this.bounds.xMax;break;case pl.MIDDLE:M.x=(this.bounds.xMax-this.bounds.xMin)/2,M.y=(this.bounds.yMax-this.bounds.yMin)/2;break;case pl.ALIGNED:{let Z=L();C.x=Z,C.y=Z,s=N();break}case pl.FIT:C.x=L(),s=N();break;default:console.warn("Unrecognized hAlign value: "+i)}switch(f){case W0.BASELINE:break;case W0.BOTTOM:M.y=this.bounds.yMin;break;case W0.MIDDLE:M.y=(this.bounds.yMax-this.bounds.yMin)/2;break;case W0.TOP:M.y=this.bounds.yMax;break;default:console.warn("Unrecognized vAlign value: "+f)}let j=new Bn().translate(-M.x,-M.y).scale(C.x,C.y).rotate(s).translate(D.x,D.y);for(let Z of this.glyphs)if(Z.vertices){for(let G of Z.vertices)G.applyMatrix3(j);yield new Un({type:Un.Type.TRIANGLES,vertices:Z.vertices,indices:Z.shape.indices,layer:x,color:v})}}};var Y6=function(o){var e=o,t=function(s){var a=t.m[s];if(a.mod)return a.mod.exports;var i=a.mod={exports:{}};return a(i,i.exports),i.exports};return t.m={},t.m["./treebase"]=function(s,a){function i(){}i.prototype.clear=function(){this._root=null,this.size=0},i.prototype.find=function(v){for(var x=this._root;x!==null;){var M=this._comparator(v,x.data);if(M===0)return x.data;x=x.get_child(M>0)}return null},i.prototype.findIter=function(v){for(var x=this._root,M=this.iterator();x!==null;){var C=this._comparator(v,x.data);if(C===0)return M._cursor=x,M;M._ancestors.push(x),x=x.get_child(C>0)}return null},i.prototype.lowerBound=function(v){for(var x=this._root,M=this.iterator(),C=this._comparator;x!==null;){var D=C(v,x.data);if(D===0)return M._cursor=x,M;M._ancestors.push(x),x=x.get_child(D>0)}for(var L=M._ancestors.length-1;L>=0;--L)if(x=M._ancestors[L],C(v,x.data)<0)return M._cursor=x,M._ancestors.length=L,M;return M._ancestors.length=0,M},i.prototype.upperBound=function(v){for(var x=this.lowerBound(v),M=this._comparator;x.data()!==null&&M(x.data(),v)===0;)x.next();return x},i.prototype.min=function(){var v=this._root;if(v===null)return null;for(;v.left!==null;)v=v.left;return v.data},i.prototype.max=function(){var v=this._root;if(v===null)return null;for(;v.right!==null;)v=v.right;return v.data},i.prototype.iterator=function(){return new f(this)},i.prototype.each=function(v){for(var x=this.iterator(),M;(M=x.next())!==null;)v(M)},i.prototype.reach=function(v){for(var x=this.iterator(),M;(M=x.prev())!==null;)v(M)};function f(v){this._tree=v,this._ancestors=[],this._cursor=null}f.prototype.data=function(){return this._cursor!==null?this._cursor.data:null},f.prototype.next=function(){if(this._cursor===null){var v=this._tree._root;v!==null&&this._minNode(v)}else if(this._cursor.right===null){var x;do if(x=this._cursor,this._ancestors.length)this._cursor=this._ancestors.pop();else{this._cursor=null;break}while(this._cursor.right===x)}else this._ancestors.push(this._cursor),this._minNode(this._cursor.right);return this._cursor!==null?this._cursor.data:null},f.prototype.prev=function(){if(this._cursor===null){var v=this._tree._root;v!==null&&this._maxNode(v)}else if(this._cursor.left===null){var x;do if(x=this._cursor,this._ancestors.length)this._cursor=this._ancestors.pop();else{this._cursor=null;break}while(this._cursor.left===x)}else this._ancestors.push(this._cursor),this._maxNode(this._cursor.left);return this._cursor!==null?this._cursor.data:null},f.prototype._minNode=function(v){for(;v.left!==null;)this._ancestors.push(v),v=v.left;this._cursor=v},f.prototype._maxNode=function(v){for(;v.right!==null;)this._ancestors.push(v),v=v.right;this._cursor=v},s.exports=i},t.m.__main__=function(s,a){var i=t("./treebase");function f(D){this.data=D,this.left=null,this.right=null,this.red=!0}f.prototype.get_child=function(D){return D?this.right:this.left},f.prototype.set_child=function(D,L){D?this.right=L:this.left=L};function v(D){this._root=null,this._comparator=D,this.size=0}v.prototype=new i,v.prototype.insert=function(D){var L=!1;if(this._root===null)this._root=new f(D),L=!0,this.size++;else{var N=new f(void 0),j=0,Z=0,G=null,H=N,me=null,ne=this._root;for(H.right=this._root;;){if(ne===null?(ne=new f(D),me.set_child(j,ne),L=!0,this.size++):x(ne.left)&&x(ne.right)&&(ne.red=!0,ne.left.red=!1,ne.right.red=!1),x(ne)&&x(me)){var fe=H.right===G;ne===me.get_child(Z)?H.set_child(fe,M(G,!Z)):H.set_child(fe,C(G,!Z))}var Ee=this._comparator(ne.data,D);if(Ee===0)break;Z=j,j=Ee<0,G!==null&&(H=G),G=me,me=ne,ne=ne.get_child(j)}this._root=N.right}return this._root.red=!1,L},v.prototype.remove=function(D){if(this._root===null)return!1;var L=new f(void 0),N=L;N.right=this._root;for(var j=null,Z=null,G=null,H=1;N.get_child(H)!==null;){var me=H;Z=j,j=N,N=N.get_child(H);var ne=this._comparator(D,N.data);if(H=ne>0,ne===0&&(G=N),!x(N)&&!x(N.get_child(H))){if(x(N.get_child(!H))){var fe=M(N,H);j.set_child(me,fe),j=fe}else if(!x(N.get_child(!H))){var Ee=j.get_child(!me);if(Ee!==null)if(!x(Ee.get_child(!me))&&!x(Ee.get_child(me)))j.red=!1,Ee.red=!0,N.red=!0;else{var de=Z.right===j;x(Ee.get_child(me))?Z.set_child(de,C(j,me)):x(Ee.get_child(!me))&&Z.set_child(de,M(j,me));var we=Z.get_child(de);we.red=!0,N.red=!0,we.left.red=!1,we.right.red=!1}}}}return G!==null&&(G.data=N.data,j.set_child(j.right===N,N.get_child(N.left===null)),this.size--),this._root=L.right,this._root!==null&&(this._root.red=!1),G!==null};function x(D){return D!==null&&D.red}function M(D,L){var N=D.get_child(!L);return D.set_child(!L,N.get_child(L)),N.set_child(L,D),D.red=!0,N.red=!1,N}function C(D,L){return D.set_child(!L,M(D.get_child(!L),!L)),M(D,L)}s.exports=v},t("__main__")}(self);var Q7=class{constructor(){this.lines=[],this.triangles=[],this.texts=[]}AddLine(e,t,s=null){this.lines.push({start:e,end:t,color:s})}AddTriangles(e,t,s=null){this.triangles.push({vertices:e,indices:t,color:s})}AddText(e,t,s,a,i){this.texts.push({text:e,size:t,angle:s,color:a,position:i})}},nk={vertices:[new ui(0,0),new ui(1,-.25),new ui(1,.25)],indices:[0,1,2]},J6=class{constructor(e,t,s){this.params=e,this.styleResolver=t,this.textWidthCalculator=s,this.isValid=!0,this._CalculateGeometry()}IsValid(){return this.isValid}GetTexts(){return[this._GetText()]}GenerateLayout(){let e=new Q7,t=this.d1.distanceTo(this.d2),s=this.styleResolver("DIMCLRD"),a=this.styleResolver("DIMSCALE")??1;a==0&&(a=1);let i=this._GetText(),f=(this.styleResolver("DIMTXT")??1)*a,v=this.textWidthCalculator(i,f),x=this.styleResolver("DIMCLRT"),M=(this.styleResolver("DIMASZ")??1)*a,C=(this.styleResolver("DIMTSZ")??0)*a,D=this.params.textAnchor,L=!1,N=this.d1.clone(),j=(this.styleResolver("DIMDLE")??0)*a;j!=0&&N.add(this.vDim.clone().multiplyScalar(-j));let Z=this.d2.clone();j!=0&&Z.add(this.vDim.clone().multiplyScalar(j)),e.AddLine(N,Z,s),t<M*2&&(L=!0),D||(D=this.vDim.clone().multiplyScalar(this.d1.distanceTo(this.d2)/2).add(this.d1).add(this.vDimNorm.clone().multiplyScalar(f*.75)));let G=this.vDimNorm.angle()*180/Math.PI-90+(this.params.textRotation??0);e.AddText(i,f,G,x,D);let H=this.styleResolver("DIMCLRE"),me=(this.styleResolver("DIMEXO")??0)*a,ne=(this.styleResolver("DIMEXE")??0)*a,fe=(Ee,de)=>{let we=de.clone().sub(Ee);if(we.length()==0)return;we.normalize();let De=Ee.clone();me!=0&&De.add(we.clone().multiplyScalar(me));let se=de.clone();ne!=0&&se.add(we.clone().multiplyScalar(ne)),e.AddLine(De,se,H)};(this.styleResolver("DIMSE1")??0)||fe(this.params.p1,this.d1),(this.styleResolver("DIMSE2")??0)||fe(this.params.p2,this.d2);for(let Ee=0;Ee<2;Ee++){let de=Ee==0?this.d1:this.d2,we=Ee==1;L&&(we=!we);let Le=new Bn().identity();C>0?Le.scale(C,C):(Le.scale(M,M),we&&Le.scale(-1,1));let De=-this.vDim.angle();Le.rotate(De),Le.translate(de.x,de.y),C>0?this._CreateTick(e,Le,s):this._CreateArrowShape(e,Le,s)}return e}_CreateArrowShape(e,t,s){let a=[];for(let i of nk.vertices)a.push(i.clone().applyMatrix3(t));e.AddTriangles(a,nk.indices,s)}_CreateTick(e,t,s){e.AddLine(new ui(.5,.5).applyMatrix3(t),new ui(-.5,-.5).applyMatrix3(t),s)}_CalculateGeometry(){if(this.vBase=this.params.p2.clone().sub(this.params.p1).normalize(),this.params.isAligned)this.vDim=this.vBase;else{let e=(this.params.angle??0)*Math.PI/180;this.vDim=new ui(Math.cos(e),Math.sin(e))}this.d1=this.vDim.clone().multiplyScalar(this.params.p1.clone().sub(this.params.anchor).dot(this.vDim)).add(this.params.anchor),this.d2=this.vDim.clone().multiplyScalar(this.params.p2.clone().sub(this.params.anchor).dot(this.vDim)).add(this.params.anchor),this.d1.distanceTo(this.d2)==0&&(this.isValid=!1),this.vDim.copy(this.d2).sub(this.d1).normalize(),this.vDim.y<-this.vDim.x?this.vDimNorm=new ui(this.vDim.y,-this.vDim.x):this.vDimNorm=new ui(-this.vDim.y,this.vDim.x)}_GetText(){if(this.params.text==" ")return"";if((this.params.text??"")!=""&&this.params.text.indexOf("<>")==-1)return Kc(this.params.text);let e=this.d2.distanceTo(this.d1);e*=this.styleResolver("DIMLFAC")??1;let t=this.styleResolver("DIMRND")??0;if(t>0){let M=Math.round(e/t);e=t*M}let s=this.styleResolver("DIMZIN")??0,a=(s&4)!=0,i=(s&8)!=0,f=e.toFixed(this.styleResolver("DIMDEC")??2);i&&(f=f.replace(/.0+$/,"")),a&&(f=f.replace(/^0+/,"")),f.startsWith(".")?f="0"+f:f==""&&(f="0"),f.endsWith(".")&&(f=f.substring(0,f.length-1));let v=this.styleResolver("DIMDSEP")??".";isNaN(v)||(v=String.fromCharCode(v)),v!="."&&(f=f.replace(".",v));let x=this.styleResolver("DIMPOST")??"";return x!=""&&(x.indexOf("<>")!=-1?f=x.replaceAll("<>",f):f+=x),(this.params.text??"")!=""&&(f=this.params.text.replaceAll("<>",f)),Kc(f)}};function rk(o,e,t,s,a=!1){let i=e.clone().sub(o),f=s.clone().sub(t);if(i.lengthSq()==0||f.lengthSq()==0)return null;let v=i.cross(f);if(Math.abs(v)<=Number.EPSILON)return null;let x=t.clone().sub(o),M=x.cross(f)/v;if(!a&&(M<0||M>1))return null;let C=x.cross(i)/v;return!a&&(C<0||C>1)?null:[M,C,v]}var ey=Object.freeze({ODD_PARITY:0,OUTERMOST:1,THROUGH_ENTIRE_AREA:2}),K6=1e-4;function sk(o,e){return(o.intersection[2]>0&&e.intersection[2])>0||o.intersection[2]<0&&e.intersection[2]<0}var e9=class{constructor(e,t,s){this.style=t,this.line=s,this.lineDir=s[1].clone().sub(s[0]).normalize(),this.loops=[];for(let a=0;a<e.length;a++){let i=e[a],f=[];for(let v=0;v<i.length;v++)f.push({idx:v,start:i[v],end:i[v==i.length-1?0:v+1],loopIdx:a});this.loops.push(f)}}Calculate(){return this._ProcessEdges(),this._CreateNodes(),this.nodes.sort((e,t)=>e.intersection[0]-t.intersection[0]),this.style==ey.ODD_PARITY?this._GenerateOddParitySegments():this._GenerateThroughAllSegments()}_ProcessEdges(){for(let e of this.loops)for(let t of e){let s=t.end.clone().sub(t.start),a=s.length();if(t.isZero=a<=Number.EPSILON,t.isZero)continue;s.divideScalar(a);let i=s.cross(this.lineDir);t.isParallel=Math.abs(i)<=1e-6,!t.isParallel&&(t.intersection=rk(this.line[0],this.line[1],t.start,t.end,!0))}}_CreateNodes(){this.nodes=[];for(let e of this.loops)for(let t of e){if(t.isZero||t.isParallel||t.isProcessed||!t.intersection||t.intersection[1]<-K6||t.intersection[1]>1+K6)continue;let s=t.intersection[1]<=K6;if(s||t.intersection[1]>=1-K6){let[a,i]=this._GetConnectedEdge(t,s);if(!a)continue;if(t.isProcessed=!0,a.isProcessed=!0,i)sk(t,a)&&(t.toggle=!0,this.nodes.push(t));else{if(t.intersection[0]>a.intersection[0]){let f=a;a=t,t=f}t.suppress=!0,a.unsuppress=!0,this.nodes.push(t),sk(t,a)&&(a.toggle=!0),this.nodes.push(a)}}else t.isProcessed=!0,t.toggle=!0,this.nodes.push(t)}}_GetConnectedEdge(e,t){let s=this.loops[e.loopIdx],a=e.idx,i=!0;do{t?a==0?a=s.length-1:a--:a==s.length-1?a=0:a++;let f=s[a];if(f.isZero||f.isParallel)i=!1;else return[f,i]}while(a!=e.idx);return[null,!1]}_GenerateOddParitySegments(){let e=[],t=!1,s=0,a=null;for(let i of this.nodes)i.suppress&&s++,i.unsuppress&&s--,i.toggle&&(t=!t),s==0&&t&&(i.unsuppress||i.toggle)?a=i:(s||!t)&&a&&(i.intersection[0]-a.intersection[0]>Number.EPSILON&&e.push([a.intersection[0],i.intersection[0]]),a=null);return e}_GenerateThroughAllSegments(){let e=[],t=0,s=null,a=new Array(this.loops.length).fill(0);function i(){for(let f of a)if(f!=0)return!1;return!0}for(let f of this.nodes){f.suppress&&t++,f.unsuppress&&t--;let v=i();f.toggle&&(f.intersection[2]>0?a[f.loopIdx]++:a[f.loopIdx]--),t==0&&!i()&&(f.unsuppress||v)?s=f:(t||i())&&s&&(f.intersection[0]-s.intersection[0]>Number.EPSILON&&e.push([s.intersection[0],f.intersection[0]]),s=null)}return e}},Q6=class{boundaryLoops;style;constructor(e,t){this.boundaryLoops=e,this.style=t}ClipLine(e){return new e9(this.boundaryLoops,this.style,e).Calculate()}GetPatternTransform({seedPoint:e,angle:t,scale:s}){let a=new Bn().makeTranslation(-e.x,-e.y);return t&&a.rotate(t),(s??1)!=1&&a.scale(1/s,1/s),a}GetLineTransform({patTransform:e,basePoint:t,angle:s}){let a=e.clone();return t&&a.translate(-t.x,-t.y),s&&a.rotate(s),a}GetBoundingBox(e){let t=new M6;for(let s of this.boundaryLoops)for(let a of s)t.expandByPoint(a.clone().applyMatrix3(e));return t}};var ee=class o{constructor(e,t=null,s=!0){this.lines=e,this.name=t,this.offsetInLineSpace=s}static ParsePatFile(e){let t=e.split(/\r?\n/);if(t.length<2)throw new Error("Invalid .pat file content");let s=null,a=[];for(let i of t){if(i=i.trim(),i==""||i.startsWith(";"))continue;if(s===null){let M=i.match(/\*([^,]+)(?:,.*)?/);if(!M)throw new Error("Bad header for .pat file content");s=M[1];continue}let f=i.indexOf(";");f!=-1&&(i=i.substring(0,f).trim());let v=i.split(/\s*,\s*/);v[v.length-1]==""&&(v.length=v.length-1),v=v.map(M=>{let C=parseFloat(M);if(isNaN(C))throw new Error("Failed to parse number in .pat file: "+M);return C});let x={angle:v[0]*Math.PI/180,base:new ui(v[1],v[2]),offset:new ui(v[3],v[4])};v.length>5&&(x.dashes=v.slice(5)),a.push(x)}return new o(a,s)}},ok=new Map,ak=new Map;function ie(o,e=!0){if(!o.name)throw new Error("Anonymous pattern cannot be registered");let t=o.name.toUpperCase(),s=e?ok:ak;if(s.has(t)){console.warn(`Pattern with name ${t} is already registered`);return}s.set(t,o)}function t9(o,e=!0){return(e?ok:ak).get(o.toUpperCase())}ie(ee.ParsePatFile(`
*ACAD_ISO02W100,ACAD_ISO02W100
0, 0,0, 0,5, 12,-3
`));ie(ee.ParsePatFile(`
*ACAD_ISO03W100,ACAD_ISO03W100
0, 0,0, 0,5, 12,-18
`));ie(ee.ParsePatFile(`
*ACAD_ISO04W100,ACAD_ISO04W100
0, 0,0, 0,5, 24,-3,.5,-3
`));ie(ee.ParsePatFile(`
*ACAD_ISO05W100,ACAD_ISO05W100
0, 0,0, 0,5, 24,-3,.5,-3,.5,-3
`));ie(ee.ParsePatFile(`
*ACAD_ISO06W100,ACAD_ISO06W100
0, 0,0, 0,5, 24,-3,.5,-3,.5,-6.5
0, 0,0, 0,5, -34,.5,-3
`));ie(ee.ParsePatFile(`
*ACAD_ISO07W100,ACAD_ISO07W100
0, 0,0, 0,5, .5,-3
`));ie(ee.ParsePatFile(`
*ACAD_ISO08W100,ACAD_ISO08W100
0, 0,0, 0,5, 24,-3,6,-3
`));ie(ee.ParsePatFile(`
*ACAD_ISO09W100,ACAD_ISO09W100
0, 0,0, 0,5, 24,-3,6,-3,6,-3
`));ie(ee.ParsePatFile(`
*ACAD_ISO10W100,ACAD_ISO10W100
0, 0,0, 0,5, 12,-3,.5,-3
`));ie(ee.ParsePatFile(`
*ACAD_ISO11W100,ACAD_ISO11W100
0, 0,0, 0,5, 12,-3,12,-3,.5,-3
`));ie(ee.ParsePatFile(`
*ACAD_ISO12W100,ACAD_ISO12W100
0, 0,0, 0,5, 12,-3,.5,-3,.5,-3
`));ie(ee.ParsePatFile(`
*ACAD_ISO13W100,ACAD_ISO13W100
0, 0,0, 0,5, 12,-3,12,-3,.5,-6.5
0, 0,0, 0,5, -33.5,.5,-3
`));ie(ee.ParsePatFile(`
*ACAD_ISO14W100,ACAD_ISO14W100
0, 0,0, 0,5, 12,-3,.5,-3,.5,-6.5
0, 0,0, 0,5, -22,.5,-3
`));ie(ee.ParsePatFile(`
*ACAD_ISO15W100,ACAD_ISO15W100
0, 0,0, 0,5, 12,-3,12,-3,.5,-10
0, 0,0, 0,5, -33.5,.5,-3,.5,-3
`));ie(ee.ParsePatFile(`
*ANGLE,ANGLE
0, 0,0, 0,6.985, 5.08,-1.905
90, 0,0, 0,6.985, 5.08,-1.905
`));ie(ee.ParsePatFile(`
*ANSI31,ANSI31
45, 0,0, 0,3.175
`));ie(ee.ParsePatFile(`
*ANSI32,ANSI32
45, 0,0, 0,9.525
45, 4.49013,0, 0,9.525
`));ie(ee.ParsePatFile(`
*ANSI33,ANSI33
45, 0,0, 0,6.35
45, 4.49013,0, 0,6.35, 3.175,-1.5875
`));ie(ee.ParsePatFile(`
*ANSI34,ANSI34
45, 0,0, 0,19.05
45, 4.49013,0, 0,19.05
45, 8.98026,0, 0,19.05
45, 13.4704,0, 0,19.05
`));ie(ee.ParsePatFile(`
*ANSI35,ANSI35
45, 0,0, 0,6.35
45, 4.49013,0, 0,6.35, 7.9375,-1.5875,0,-1.5875
`));ie(ee.ParsePatFile(`
*ANSI36,ANSI36
45, 0,0, 5.55625,3.175, 7.9375,-1.5875,0,-1.5875
`));ie(ee.ParsePatFile(`
*ANSI37,ANSI37
45, 0,0, 0,3.175
135, 0,0, 0,3.175
`));ie(ee.ParsePatFile(`
*ANSI38,ANSI38
45, 0,0, 0,3.175
135, 0,0, 6.35,3.175, 7.9375,-4.7625
`));ie(ee.ParsePatFile(`
*AR-B816,AR-B816
0, 0,0, 0,203.2
90, 0,0, 203.2,203.2, 203.2,-203.2
`));ie(ee.ParsePatFile(`
*AR-B816C,AR-B816C
0, 0,0, 203.2,203.2, 396.875,-9.525
0, -203.2,9.525, 203.2,203.2, 396.875,-9.525
90, 0,0, 203.2,203.2, -212.725,193.675
90, -9.525,0, 203.2,203.2, -212.725,193.675
`));ie(ee.ParsePatFile(`
*AR-B88,AR-B88
0, 0,0, 0,203.2
90, 0,0, 203.2,101.6, 203.2,-203.2
`));ie(ee.ParsePatFile(`
*AR-BRELM,AR-BRELM
0, 0,0, 0,135.484, 193.675,-9.525
0, 0,57.15, 0,135.484, 193.675,-9.525
0, 50.8,67.7418, 0,135.484, 92.075,-9.525
0, 50.8,124.892, 0,135.484, 92.075,-9.525
90, 0,0, 0,203.2, 57.15,-78.3336
90, -9.525,0, 0,203.2, 57.15,-78.3336
90, 50.8,67.7418, 0,101.6, 57.15,-78.3336
90, 41.275,67.7418, 0,101.6, 57.15,-78.3336
`));ie(ee.ParsePatFile(`
*AR-BRSTD,AR-BRSTD
0, 0,0, 0,67.7418
90, 0,0, 67.7418,101.6, 67.7418,-67.7418
`));ie(ee.ParsePatFile(`
*AR-CONC-01,AR-CONC-01
;Optimize to replace existing AR-CONC Pattern
;By John Hyslop,    Using AutoCAD Lisp Tool
;Developed in mm as metric QCAD3 pattern
243.434949,7.62,20.32,227.18450626,113.5922544,5.67961272,-562.2816542
90,7.62,15.24,0,254,5.08,-248.92
0,5.08,15.24,0,254,2.54,-251.46
315,2.54,2.54,179.60512212,179.60512212,3.59210356,-355.61814322
206.565051,7.62,5.08,340.77676066,113.5922544,5.67961272,-562.2816542
63.434949,5.08,0,227.18450626,113.5922544,5.67961272,-562.2816542
45,50.8,10.16,179.60512212,179.60512212,7.18420458,-352.02603966
161.565051,58.42,7.62,240.9655582,80.32185358,8.03218612,-795.18633952
288.434949,55.88,15.24,562.25296744,80.32185358,8.03218612,-795.18633952
315,58.42,22.86,179.60512212,179.60512212,3.59210356,-355.61814322
206.565051,63.5,25.4,340.77676066,113.5922544,5.67961272,-562.2816542
63.434949,60.96,20.32,227.18450626,113.5922544,5.67961272,-562.2816542
270,104.14,15.24,0,254,5.08,-248.92
45,99.06,10.16,179.60512212,179.60512212,7.18420458,-352.02603966
180,104.14,10.16,0,254,5.08,-248.92
333.434949,99.06,5.08,227.18450626,113.5922544,5.67961272,-562.2816542
225,101.6,7.62,179.60512212,179.60512212,3.59210356,-355.61814322
116.565051,104.14,2.54,340.77676066,113.5922544,5.67961272,-562.2816542
198.434949,160.02,20.32,562.25296744,80.32185358,8.03218612,-795.18633952
63.434949,157.48,15.24,227.18450626,113.5922544,5.67961272,-562.2816542
333.434949,152.4,17.78,227.18450626,113.5922544,5.67961272,-562.2816542
26.565051,144.78,0,340.77676066,113.5922544,5.67961272,-562.2816542
251.565051,147.32,7.62,240.9655582,80.32185358,8.03218612,-795.18633952
116.565051,149.86,2.54,340.77676066,113.5922544,5.67961272,-562.2816542
45,170.18,2.54,179.60512212,179.60512212,7.18420458,-352.02603966
161.565051,177.8,0,240.9655582,80.32185358,8.03218612,-795.18633952
288.434949,175.26,7.62,562.25296744,80.32185358,8.03218612,-795.18633952
315,76.2,71.12,179.60512212,179.60512212,3.59210356,-355.61814322
206.565051,81.28,73.66,340.77676066,113.5922544,5.67961272,-562.2816542
63.434949,78.74,68.58,227.18450626,113.5922544,5.67961272,-562.2816542
45,27.94,20.32,179.60512212,179.60512212,7.18420458,-352.02603966
180,33.02,20.32,0,254,5.08,-248.92
270,33.02,25.4,0,254,5.08,-248.92
225,45.72,60.96,179.60512212,179.60512212,3.59210356,-355.61814322
270,45.72,66.04,0,254,5.08,-248.92
71.565051,43.18,58.42,240.9655582,80.32185358,8.03218612,-795.18633952
198.434949,25.4,53.34,562.25296744,80.32185358,8.03218612,-795.18633952
63.434949,22.86,48.26,227.18450626,113.5922544,5.67961272,-562.2816542
333.434949,17.78,50.8,227.18450626,113.5922544,5.67961272,-562.2816542
0,88.9,55.88,0,254,5.08,-248.92
225,93.98,60.96,179.60512212,179.60512212,7.18420458,-352.02603966
90,93.98,55.88,0,254,5.08,-248.92
315,114.3,43.18,179.60512212,179.60512212,3.59210356,-355.61814322
206.565051,119.38,45.72,340.77676066,113.5922544,5.67961272,-562.2816542
63.434949,116.84,40.64,227.18450626,113.5922544,5.67961272,-562.2816542
315,139.7,53.34,179.60512212,179.60512212,3.59210356,-355.61814322
270,139.7,58.42,0,254,5.08,-248.92
108.434949,142.24,50.8,562.25296744,80.32185358,8.03218612,-795.18633952
206.565051,175.26,68.58,340.77676066,113.5922544,5.67961272,-562.2816542
63.434949,172.72,63.5,227.18450626,113.5922544,5.67961272,-562.2816542
315,170.18,66.04,179.60512212,179.60512212,3.59210356,-355.61814322
333.434949,185.42,48.26,227.18450626,113.5922544,5.67961272,-562.2816542
225,187.96,50.8,179.60512212,179.60512212,3.59210356,-355.61814322
116.565051,190.5,45.72,340.77676066,113.5922544,5.67961272,-562.2816542
26.565051,208.28,38.1,340.77676066,113.5922544,5.67961272,-562.2816542
153.434949,213.36,35.56,227.18450626,113.5922544,5.67961272,-562.2816542
270,213.36,40.64,0,254,5.08,-248.92
180,236.22,43.18,0,254,2.54,-251.46
270,236.22,45.72,0,254,2.54,-251.46
45,233.68,43.18,179.60512212,179.60512212,3.59210356,-355.61814322
153.434949,236.22,60.96,227.18450626,113.5922544,5.67961272,-562.2816542
270,236.22,68.58,0,254,7.62,-246.38
45,231.14,63.5,179.60512212,179.60512212,7.18420458,-352.02603966
206.565051,231.14,88.9,340.77676066,113.5922544,5.67961272,-562.2816542
63.434949,228.6,83.82,227.18450626,113.5922544,5.67961272,-562.2816542
315,226.06,86.36,179.60512212,179.60512212,3.59210356,-355.61814322
180,165.1,73.66,0,254,5.08,-248.92
270,165.1,81.28,0,254,7.62,-246.38
56.309932,160.02,73.66,563.57539812,70.4469254,9.15809954,-906.65192304
198.434949,137.16,96.52,562.25296744,80.32185358,8.03218612,-795.18633952
71.565051,134.62,88.9,240.9655582,80.32185358,8.03218612,-795.18633952
315,129.54,93.98,179.60512212,179.60512212,7.18420458,-352.02603966
180,96.52,83.82,0,254,7.62,-246.38
270,96.52,91.44,0,254,7.62,-246.38
45,88.9,83.82,179.60512212,179.60512212,10.77630814,-348.43393864
225,83.82,109.22,179.60512212,179.60512212,7.18420458,-352.02603966
90,83.82,104.14,0,254,5.08,-248.92
0,78.74,104.14,0,254,5.08,-248.92
206.565051,40.64,99.06,340.77676066,113.5922544,5.67961272,-562.2816542
63.434949,38.1,93.98,227.18450626,113.5922544,5.67961272,-562.2816542
315,35.56,96.52,179.60512212,179.60512212,3.59210356,-355.61814322
108.434949,25.4,93.98,562.25296744,80.32185358,8.03218612,-795.18633952
341.565051,17.78,96.52,240.9655582,80.32185358,8.03218612,-795.18633952
225,22.86,101.6,179.60512212,179.60512212,7.18420458,-352.02603966
270,38.1,114.3,0,254,5.08,-248.92
45,33.02,109.22,179.60512212,179.60512212,7.18420458,-352.02603966
180,38.1,109.22,0,254,5.08,-248.92
315,91.44,119.38,179.60512212,179.60512212,3.59210356,-355.61814322
206.565051,96.52,121.92,340.77676066,113.5922544,5.67961272,-562.2816542
63.434949,93.98,116.84,227.18450626,113.5922544,5.67961272,-562.2816542
0,129.54,101.6,0,254,2.54,-251.46
225,132.08,104.14,179.60512212,179.60512212,3.59210356,-355.61814322
90,132.08,101.6,0,254,2.54,-251.46
0,175.26,96.52,0,254,5.08,-248.92
243.434949,177.8,101.6,227.18450626,113.5922544,5.67961272,-562.2816542
116.565051,180.34,96.52,340.77676066,113.5922544,5.67961272,-562.2816542
26.565051,185.42,114.3,340.77676066,113.5922544,5.67961272,-562.2816542
116.565051,187.96,109.22,340.77676066,113.5922544,5.67961272,-562.2816542
251.565051,190.5,116.84,240.9655582,80.32185358,8.03218612,-795.18633952
63.434949,223.52,91.44,227.18450626,113.5922544,5.67961272,-562.2816542
180,228.6,91.44,0,254,5.08,-248.92
296.565051,226.06,96.52,340.77676066,113.5922544,5.67961272,-562.2816542
180,228.6,137.16,0,254,7.62,-246.38
270,228.6,144.78,0,254,7.62,-246.38
45,220.98,137.16,179.60512212,179.60512212,10.77630814,-348.43393864
180,218.44,142.24,0,254,5.08,-248.92
270,218.44,147.32,0,254,5.08,-248.92
45,213.36,142.24,179.60512212,179.60512212,7.18420458,-352.02603966
243.434949,208.28,165.1,227.18450626,113.5922544,5.67961272,-562.2816542
26.565051,203.2,162.56,340.77676066,113.5922544,5.67961272,-562.2816542
135,205.74,160.02,179.60512212,179.60512212,3.59210356,-355.61814322
243.434949,170.18,152.4,227.18450626,113.5922544,5.67961272,-562.2816542
116.565051,172.72,147.32,340.77676066,113.5922544,5.67961272,-562.2816542
0,167.64,147.32,0,254,5.08,-248.92
225,157.48,154.94,179.60512212,179.60512212,7.18420458,-352.02603966
108.434949,160.02,147.32,562.25296744,80.32185358,8.03218612,-795.18633952
341.565051,152.4,149.86,240.9655582,80.32185358,8.03218612,-795.18633952
135,149.86,137.16,179.60512212,179.60512212,3.59210356,-355.61814322
243.434949,152.4,142.24,227.18450626,113.5922544,5.67961272,-562.2816542
26.565051,147.32,139.7,340.77676066,113.5922544,5.67961272,-562.2816542
180,121.92,152.4,0,254,2.54,-251.46
270,121.92,154.94,0,254,2.54,-251.46
45,119.38,152.4,179.60512212,179.60512212,3.59210356,-355.61814322
206.565051,111.76,170.18,340.77676066,113.5922544,5.67961272,-562.2816542
63.434949,109.22,165.1,227.18450626,113.5922544,5.67961272,-562.2816542
315,106.68,167.64,179.60512212,179.60512212,3.59210356,-355.61814322
225,86.36,165.1,179.60512212,179.60512212,7.18420458,-352.02603966
90,86.36,157.48,0,254,7.62,-246.38
333.434949,81.28,160.02,227.18450626,113.5922544,5.67961272,-562.2816542
180,76.2,154.94,0,254,5.08,-248.92
270,76.2,160.02,0,254,5.08,-248.92
45,71.12,154.94,179.60512212,179.60512212,7.18420458,-352.02603966
135,53.34,142.24,179.60512212,179.60512212,3.59210356,-355.61814322
243.434949,55.88,147.32,227.18450626,113.5922544,5.67961272,-562.2816542
26.565051,50.8,144.78,340.77676066,113.5922544,5.67961272,-562.2816542
180,27.94,160.02,0,254,5.08,-248.92
270,27.94,165.1,0,254,5.08,-248.92
45,22.86,160.02,179.60512212,179.60512212,7.18420458,-352.02603966
270,15.24,177.8,0,254,7.62,-246.38
45,10.16,172.72,179.60512212,179.60512212,7.18420458,-352.02603966
153.434949,15.24,170.18,227.18450626,113.5922544,5.67961272,-562.2816542
243.434949,208.28,198.12,227.18450626,113.5922544,5.67961272,-562.2816542
90,208.28,193.04,0,254,5.08,-248.92
0,205.74,193.04,0,254,2.54,-251.46
135,220.98,208.28,179.60512212,179.60512212,3.59210356,-355.61814322
243.434949,223.52,213.36,227.18450626,113.5922544,5.67961272,-562.2816542
26.565051,218.44,210.82,340.77676066,113.5922544,5.67961272,-562.2816542
180,218.44,213.36,0,254,5.08,-248.92
251.565051,220.98,220.98,240.9655582,80.32185358,8.03218612,-795.18633952
45,213.36,213.36,179.60512212,179.60512212,10.77630814,-348.43393864
153.434949,182.88,233.68,227.18450626,113.5922544,5.67961272,-562.2816542
135,165.1,185.42,179.60512212,179.60512212,3.59210356,-355.61814322
243.434949,167.64,190.5,227.18450626,113.5922544,5.67961272,-562.2816542
26.565051,162.56,187.96,340.77676066,113.5922544,5.67961272,-562.2816542
135,160.02,195.58,179.60512212,179.60512212,3.59210356,-355.61814322
251.565051,162.56,203.2,240.9655582,80.32185358,8.03218612,-795.18633952
45,157.48,198.12,179.60512212,179.60512212,7.18420458,-352.02603966
26.565051,66.04,193.04,340.77676066,113.5922544,5.67961272,-562.2816542
153.434949,71.12,190.5,227.18450626,113.5922544,5.67961272,-562.2816542
270,71.12,195.58,0,254,5.08,-248.92
90,114.3,200.66,0,254,5.08,-248.92
0,109.22,200.66,0,254,5.08,-248.92
225,114.3,205.74,179.60512212,179.60512212,7.18420458,-352.02603966
63.434949,124.46,210.82,227.18450626,113.5922544,5.67961272,-562.2816542
315,121.92,213.36,179.60512212,179.60512212,3.59210356,-355.61814322
206.565051,127,215.9,340.77676066,113.5922544,5.67961272,-562.2816542
153.434949,147.32,223.52,227.18450626,113.5922544,5.67961272,-562.2816542
270,147.32,231.14,0,254,7.62,-246.38
45,142.24,226.06,179.60512212,179.60512212,7.18420458,-352.02603966
0,71.12,236.22,0,254,7.62,-246.38
135,66.04,203.2,179.60512212,179.60512212,3.59210356,-355.61814322
270,66.04,208.28,0,254,5.08,-248.92
45,63.5,205.74,179.60512212,179.60512212,3.59210356,-355.61814322
116.565051,20.32,208.28,340.77676066,113.5922544,5.67961272,-562.2816542
333.434949,15.24,210.82,227.18450626,113.5922544,5.67961272,-562.2816542
225,17.78,213.36,179.60512212,179.60512212,3.59210356,-355.61814322
135,30.48,218.44,179.60512212,179.60512212,3.59210356,-355.61814322
243.434949,33.02,223.52,227.18450626,113.5922544,5.67961272,-562.2816542
26.565051,27.94,220.98,340.77676066,113.5922544,5.67961272,-562.2816542
0,222.21825,218.170506,0,254,0,-254
0,206.330804,232.72877,0,254,0,-254
0,208.872836,188.32957,0,254,0,-254
0,183.55056,211.532978,0,254,0,-254
0,167.663114,226.091242,0,254,0,-254
0,222.022924,134.20979,0,254,0,-254
0,206.135224,148.768054,0,254,0,-254
0,170.205146,181.692042,0,254,0,-254
0,144.88287,204.895704,0,254,0,-254
0,128.99517,219.453968,0,254,0,-254
0,208.677256,104.368854,0,254,0,-254
0,183.35498,127.572516,0,254,0,-254
0,167.467534,142.13078,0,254,0,-254
0,131.537202,175.054768,0,254,0,-254
0,106.214926,198.258176,0,254,0,-254
0,90.32748,212.81644,0,254,0,-254
0,221.827344,50.249328,0,254,0,-254
0,205.939898,64.807592,0,254,0,-254
0,170.009566,97.73158,0,254,0,-254
0,144.68729,120.934988,0,254,0,-254
0,128.799844,135.493252,0,254,0,-254
0,92.869512,168.41724,0,254,0,-254
0,67.547236,191.620902,0,254,0,-254
0,51.65979,206.179166,0,254,0,-254
0,208.48193,20.408392,0,254,0,-254
0,183.159654,43.6118,0,254,0,-254
0,167.271954,58.170064,0,254,0,-254
0,131.341876,91.094052,0,254,0,-254
0,106.0196,114.297714,0,254,0,-254
0,90.1319,128.855978,0,254,0,-254
0,54.201822,161.779966,0,254,0,-254
0,28.879546,184.983628,0,254,0,-254
0,12.991846,199.541638,0,254,0,-254
0,169.813986,13.770864,0,254,0,-254
0,144.49171,36.974526,0,254,0,-254
0,128.604264,51.53279,0,254,0,-254
0,89.821004,81.952846,0,254,0,-254
0,67.351656,107.660186,0,254,0,-254
0,51.46421,122.21845,0,254,0,-254
0,15.533878,155.142438,0,254,0,-254
0,131.146296,7.13359,0,254,0,-254
0,105.82402,30.336998,0,254,0,-254
0,89.936574,44.895262,0,254,0,-254
0,54.006242,77.81925,0,254,0,-254
0,28.683966,101.022912,0,254,0,-254
0,12.79652,115.581176,0,254,0,-254
0,92.478606,0.496062,0,254,0,-254
0,67.15633,23.699724,0,254,0,-254
0,51.26863,38.257988,0,254,0,-254
0,15.338552,71.181976,0,254,0,-254
0,28.488386,17.062196,0,254,0,-254
0,12.60094,31.62046,0,254,0,-254
0,232.573576,212.125814,0,254,0,-254
0,211.15909,204.714856,0,254,0,-254
0,197.17893,213.621112,0,254,0,-254
0,219.38234,178.422554,0,254,0,-254
0,175.76419,206.210408,0,254,0,-254
0,161.78403,215.116664,0,254,0,-254
0,183.98744,179.918106,0,254,0,-254
0,140.369544,207.705706,0,254,0,-254
0,126.389384,216.612216,0,254,0,-254
0,220.450664,135.634984,0,254,0,-254
0,206.470504,144.541494,0,254,0,-254
0,148.592794,181.413658,0,254,0,-254
0,104.974898,209.201258,0,254,0,-254
0,90.994738,218.107514,0,254,0,-254
0,228.673914,109.342936,0,254,0,-254
0,185.055764,137.130536,0,254,0,-254
0,171.075858,146.036792,0,254,0,-254
0,113.198148,182.908956,0,254,0,-254
0,69.579998,210.69681,0,254,0,-254
0,55.599838,219.603066,0,254,0,-254
0,193.279268,110.838234,0,254,0,-254
0,149.661118,138.626088,0,254,0,-254
0,135.680958,147.532344,0,254,0,-254
0,77.803248,184.404508,0,254,0,-254
0,34.185352,212.192362,0,254,0,-254
0,20.205192,221.098618,0,254,0,-254
0,229.742238,66.555366,0,254,0,-254
0,215.762078,75.461622,0,254,0,-254
0,157.884368,112.333786,0,254,0,-254
0,114.266472,140.12164,0,254,0,-254
0,100.286312,149.027896,0,254,0,-254
0,42.408602,185.90006,0,254,0,-254
0,237.965488,40.263064,0,254,0,-254
0,194.347592,68.050918,0,254,0,-254
0,180.367432,76.957174,0,254,0,-254
0,122.489722,113.829338,0,254,0,-254
0,78.871572,141.616938,0,254,0,-254
0,64.891666,150.523448,0,254,0,-254
0,7.013702,187.395612,0,254,0,-254
0,202.570842,41.758616,0,254,0,-254
0,158.952692,69.546216,0,254,0,-254
0,144.972532,78.452726,0,254,0,-254
0,87.094822,115.32489,0,254,0,-254
0,43.476926,143.11249,0,254,0,-254
0,29.496766,152.018746,0,254,0,-254
0,225.053652,6.38175,0,254,0,-254
0,167.175942,43.254168,0,254,0,-254
0,123.558046,71.041768,0,254,0,-254
0,109.577886,79.948024,0,254,0,-254
0,51.700176,116.820188,0,254,0,-254
0,8.08228,144.608042,0,254,0,-254
0,189.659006,7.877302,0,254,0,-254
0,131.781296,44.749466,0,254,0,-254
0,88.1634,72.53732,0,254,0,-254
0,74.18324,81.443576,0,254,0,-254
0,16.30553,118.31574,0,254,0,-254
0,168.24452,0.466598,0,254,0,-254
0,154.26436,9.372854,0,254,0,-254
0,96.38665,46.245018,0,254,0,-254
0,52.7685,74.032872,0,254,0,-254
0,38.78834,82.939128,0,254,0,-254
0,132.84962,1.961896,0,254,0,-254
0,118.86946,10.868406,0,254,0,-254
0,60.99175,47.74057,0,254,0,-254
0,17.373854,75.52817,0,254,0,-254
0,3.393694,84.43468,0,254,0,-254
0,97.454974,3.457448,0,254,0,-254
0,83.474814,12.363704,0,254,0,-254
0,25.597104,49.235868,0,254,0,-254
0,62.060074,4.953,0,254,0,-254
0,48.080168,13.859256,0,254,0,-254
0,26.665428,6.448552,0,254,0,-254
0,12.685268,15.354808,0,254,0,-254
0,163.20897,236.374178,0,254,0,-254
0,121.33453,230.861362,0,254,0,-254
0,96.22282,227.555298,0,254,0,-254
0,79.624174,225.370136,0,254,0,-254
0,37.749734,219.85732,0,254,0,-254
0,12.638278,216.551256,0,254,0,-254
0,229.351078,221.227142,0,254,0,-254
0,187.476638,215.714326,0,254,0,-254
0,162.364928,212.408262,0,254,0,-254
0,145.766282,210.2231,0,254,0,-254
0,103.891842,204.710284,0,254,0,-254
0,78.780132,201.40422,0,254,0,-254
0,62.18174,199.219058,0,254,0,-254
0,20.307046,193.705988,0,254,0,-254
0,228.507036,197.261226,0,254,0,-254
0,211.90839,195.076064,0,254,0,-254
0,170.03395,189.563248,0,254,0,-254
0,144.92224,186.257184,0,254,0,-254
0,128.323594,184.071768,0,254,0,-254
0,86.449154,178.558952,0,254,0,-254
0,61.337698,175.252888,0,254,0,-254
0,44.739052,173.067726,0,254,0,-254
0,2.864358,167.55491,0,254,0,-254
0,236.176058,174.415958,0,254,0,-254
0,211.064348,171.110148,0,254,0,-254
0,194.465702,168.924732,0,254,0,-254
0,152.591262,163.411916,0,254,0,-254
0,127.479552,160.105852,0,254,0,-254
0,110.88116,157.92069,0,254,0,-254
0,69.006466,152.407874,0,254,0,-254
0,43.89501,149.10181,0,254,0,-254
0,27.296364,146.916648,0,254,0,-254
0,218.73337,148.26488,0,254,0,-254
0,193.62166,144.958816,0,254,0,-254
0,177.023014,142.773654,0,254,0,-254
0,135.148574,137.260838,0,254,0,-254
0,110.037118,133.954774,0,254,0,-254
0,93.438472,131.769358,0,254,0,-254
0,51.563778,126.256542,0,254,0,-254
0,26.452322,122.950478,0,254,0,-254
0,9.853676,120.765316,0,254,0,-254
0,201.290682,122.113548,0,254,0,-254
0,176.178972,118.807738,0,254,0,-254
0,159.58058,116.622322,0,254,0,-254
0,117.705886,111.109506,0,254,0,-254
0,92.59443,107.803442,0,254,0,-254
0,75.995784,105.61828,0,254,0,-254
0,34.121344,100.105464,0,254,0,-254
0,9.009634,96.7994,0,254,0,-254
0,225.722434,101.475286,0,254,0,-254
0,183.847994,95.96247,0,254,0,-254
0,158.736538,92.656406,0,254,0,-254
0,142.137892,90.471244,0,254,0,-254
0,100.263198,84.958428,0,254,0,-254
0,75.151742,81.652364,0,254,0,-254
0,58.553096,79.466948,0,254,0,-254
0,16.678656,73.954132,0,254,0,-254
0,224.878392,77.50937,0,254,0,-254
0,208.279746,75.324208,0,254,0,-254
0,166.405306,69.811138,0,254,0,-254
0,141.29385,66.505328,0,254,0,-254
0,124.695204,64.319912,0,254,0,-254
0,82.82051,58.807096,0,254,0,-254
0,57.709054,55.501032,0,254,0,-254
0,41.110408,53.31587,0,254,0,-254
0,232.547414,54.664102,0,254,0,-254
0,207.435704,51.358038,0,254,0,-254
0,190.837312,49.172876,0,254,0,-254
0,148.962618,43.66006,0,254,0,-254
0,123.851162,40.353996,0,254,0,-254
0,107.252516,38.168834,0,254,0,-254
0,65.378076,32.656018,0,254,0,-254
0,40.266366,29.349954,0,254,0,-254
0,23.66772,27.164538,0,254,0,-254
0,215.104726,28.513024,0,254,0,-254
0,189.99327,25.20696,0,254,0,-254
0,173.394624,23.021798,0,254,0,-254
0,131.51993,17.508728,0,254,0,-254
0,106.408474,14.202918,0,254,0,-254
0,89.809828,12.017502,0,254,0,-254
0,47.935388,6.504686,0,254,0,-254
0,22.823678,3.198622,0,254,0,-254
0,6.225032,1.01346,0,254,0,-254
0,197.662038,2.361692,0,254,0,-254
0,31.866332,226.2124,0,254,0,-254
0,65.909444,230.88092,0,254,0,-254
0,31.060136,204.140054,0,254,0,-254
0,99.400106,235.125768,0,254,0,-254
0,65.103248,208.808574,0,254,0,-254
0,30.253686,182.067962,0,254,0,-254
0,98.59391,213.053422,0,254,0,-254
0,64.296798,186.736482,0,254,0,-254
0,29.44749,159.995616,0,254,0,-254
0,133.031484,218.02471,0,254,0,-254
0,97.787714,190.981076,0,254,0,-254
0,63.490602,164.664136,0,254,0,-254
0,28.641294,137.92327,0,254,0,-254
0,167.074596,222.69323,0,254,0,-254
0,132.225288,195.952364,0,254,0,-254
0,96.981264,168.90873,0,254,0,-254
0,62.684406,142.59179,0,254,0,-254
0,27.835098,115.850924,0,254,0,-254
0,200.565258,226.937824,0,254,0,-254
0,166.2684,200.620884,0,254,0,-254
0,131.419092,173.880018,0,254,0,-254
0,96.175068,146.836384,0,254,0,-254
0,61.87821,120.519444,0,254,0,-254
0,27.028902,93.778578,0,254,0,-254
0,235.002832,231.909112,0,254,0,-254
0,199.759062,204.865478,0,254,0,-254
0,165.46195,178.548538,0,254,0,-254
0,130.612642,151.807672,0,254,0,-254
0,95.368872,124.764292,0,254,0,-254
0,61.07176,98.447098,0,254,0,-254
0,26.222452,71.706232,0,254,0,-254
0,234.196636,209.836766,0,254,0,-254
0,198.952866,182.793386,0,254,0,-254
0,164.655754,156.476192,0,254,0,-254
0,129.806446,129.735326,0,254,0,-254
0,94.562676,102.691946,0,254,0,-254
0,60.265564,76.374752,0,254,0,-254
0,25.416256,49.63414,0,254,0,-254
0,233.39044,187.76442,0,254,0,-254
0,198.14667,160.72104,0,254,0,-254
0,163.849558,134.403846,0,254,0,-254
0,129.00025,107.663234,0,254,0,-254
0,93.75648,80.6196,0,254,0,-254
0,59.459368,54.30266,0,254,0,-254
0,24.61006,27.561794,0,254,0,-254
0,232.584244,165.692328,0,254,0,-254
0,197.34022,138.648694,0,254,0,-254
0,163.043362,112.331754,0,254,0,-254
0,128.194054,85.590888,0,254,0,-254
0,58.653172,32.230314,0,254,0,-254
0,23.803864,5.489448,0,254,0,-254
0,231.777794,143.619982,0,254,0,-254
0,196.534024,116.576348,0,254,0,-254
0,162.237166,90.259408,0,254,0,-254
0,127.387858,63.518542,0,254,0,-254
0,92.143834,36.474908,0,254,0,-254
0,57.846976,10.157968,0,254,0,-254
0,230.971598,121.547636,0,254,0,-254
0,195.727828,94.504002,0,254,0,-254
0,161.430716,68.187062,0,254,0,-254
0,126.581408,41.446196,0,254,0,-254
0,91.337638,14.402562,0,254,0,-254
0,230.165402,99.47529,0,254,0,-254
0,194.921632,72.431656,0,254,0,-254
0,160.62452,46.114716,0,254,0,-254
0,125.775212,19.37385,0,254,0,-254
0,229.359206,77.402944,0,254,0,-254
0,194.115436,50.359564,0,254,0,-254
0,159.818324,24.04237,0,254,0,-254
0,228.55301,55.330598,0,254,0,-254
0,193.308986,28.287218,0,254,0,-254
0,159.012128,1.970024,0,254,0,-254
0,227.74656,33.258506,0,254,0,-254
0,192.50279,6.214872,0,254,0,-254
0,226.940364,11.18616,0,254,0,-254
206.565051,254,15.24,340.77676066,113.5922544,5.67961272,-562.2816542
63.434949,251.46,10.16,227.18450626,113.5922544,5.67961272,-562.2816542
315,248.92,12.7,179.60512212,179.60512212,3.59210356,-355.61814322
206.565051,246.38,137.16,340.77676066,113.5922544,5.67961272,-562.2816542
63.434949,243.84,132.08,227.18450626,113.5922544,5.67961272,-562.2816542
315,241.3,134.62,179.60512212,179.60512212,3.59210356,-355.61814322
153.434949,254,182.88,227.18450626,113.5922544,5.67961272,-562.2816542
288.434949,251.46,190.5,562.25296744,80.32185358,8.03218612,-795.18633952
63.434949,248.92,185.42,227.18450626,113.5922544,5.67961272,-562.2816542
135,246.38,236.22,179.60512212,179.60512212,3.59210356,-355.61814322
270,246.38,241.3,0,254,5.08,-248.92
45,243.84,238.76,179.60512212,179.60512212,3.59210356,-355.61814322
0,195.58,243.84,0,254,5.08,-248.92
270,182.88,238.76,0,254,5.08,-248.92
26.565051,177.8,236.22,340.77676066,113.5922544,5.67961272,-562.2816542
0,241.457734,241.2111,0,254,0,-254
0,247.540526,194.966844,0,254,0,-254
0,244.803168,155.405582,0,254,0,-254
0,247.3452,111.006382,0,254,0,-254
0,244.607588,71.444866,0,254,0,-254
0,247.14962,27.045666,0,254,0,-254
0,246.553736,203.219304,0,254,0,-254
0,241.86515,143.045942,0,254,0,-254
0,251.156978,73.96607,0,254,0,-254
0,204.919072,241.865658,0,254,0,-254
0,179.807616,238.559594,0,254,0,-254
0,245.949724,223.412558,0,254,0,-254
0,253.618492,200.56729,0,254,0,-254
0,243.165122,127.626618,0,254,0,-254
0,242.32108,103.660448,0,254,0,-254
0,249.990102,80.815434,0,254,0,-254
0,239.536732,7.874762,0,254,0,-254
243.434949,198.12,248.92,227.18450626,113.5922544,5.67961272,-562.2816542
116.565051,200.66,243.84,340.77676066,113.5922544,5.67961272,-562.2816542
180,152.4,246.38,0,254,5.08,-248.92
270,152.4,251.46,0,254,5.08,-248.92
45,147.32,246.38,179.60512212,179.60512212,7.18420458,-352.02603966
296.565051,104.14,254,340.77676066,113.5922544,5.67961272,-562.2816542
63.434949,101.6,248.92,227.18450626,113.5922544,5.67961272,-562.2816542
180,106.68,248.92,0,254,5.08,-248.92
135,86.36,238.76,179.60512212,179.60512212,3.59210356,-355.61814322
243.434949,88.9,243.84,227.18450626,113.5922544,5.67961272,-562.2816542
26.565051,83.82,241.3,340.77676066,113.5922544,5.67961272,-562.2816542
116.565051,78.74,236.22,340.77676066,113.5922544,5.67961272,-562.2816542
225,76.2,241.3,179.60512212,179.60512212,7.18420458,-352.02603966
45,0,246.38,179.60512212,179.60512212,7.18420458,-352.02603966
161.565051,7.62,243.84,240.9655582,80.32185358,8.03218612,-795.18633952
288.434949,5.08,251.46,562.25296744,80.32185358,8.03218612,-795.18633952
0,93.065092,252.377956,0,254,0,-254
0,54.397148,245.740428,0,254,0,-254
0,15.729458,239.103154,0,254,0,-254
0,174.695866,248.997978,0,254,0,-254
0,139.30122,250.493276,0,254,0,-254
0,68.511674,253.48438,0,254,0,-254
0,113.665508,253.70663,0,254,0,-254
0,97.066862,251.521468,0,254,0,-254
0,55.192422,246.008398,0,254,0,-254
0,30.080966,242.702588,0,254,0,-254
0,13.48232,240.517172,0,254,0,-254
0,32.672528,248.284746,0,254,0,-254
0,66.71564,252.953266,0,254,0,-254
0,133.83768,240.097056,0,254,0,-254
0,167.880792,244.765576,0,254,0,-254
0,201.371454,249.01017,0,254,0,-254
0,245.485412,246.006874,0,254,0,-254
0,210.090512,247.502426,0,254,0,-254
0,246.793766,247.378474,0,254,0,-254
0,235.809282,253.981458,0,254,0,-254
`));ie(ee.ParsePatFile(`
*AR-CONC,AR-CONC
50, 0,0, 104.896,-149.807, 19.05,-209.55
355, 0,0, -51.7604,187.258, 15.24,-167.64
100.451, 15.182,-1.32825, 145.557,-176.27, 16.19,-178.09
46.1842, 0,50.8, 157.343,-224.71, 28.575,-314.325
96.6356, 22.5899,47.2965, 218.335,-264.405, 24.285,-267.135
351.184, 0,50.8, 196.679,280.887, 22.86,-251.46
21, 25.4,38.1, 104.896,-149.807, 19.05,-209.55
326, 25.4,38.1, -51.7604,187.258, 15.24,-167.64
71.4514, 38.0345,29.5779, 145.557,-176.27, 16.19,-178.09
37.5, 0,0, 53.9242,65.2018, 0,-165.608,0,-170.18,0,-168.275
7.5, 0,0, 79.3242,90.6018, 0,-97.028,0,-161.798,0,-64.135
-32.5, -56.642,0, 117.434,68.0212, 0,-63.5,0,-198.12,0,-262.89
-42.5, -82.042,0, 92.0344,118.821, 0,-82.55,0,-131.572,0,-186.69
`));ie(ee.ParsePatFile(`
*AR-HBONE,AR-HBONE
45, 0,0, 101.6,101.6, 304.8,-101.6
135, 71.842,71.842, 101.6,-101.6, 304.8,-101.6
`));ie(ee.ParsePatFile(`
*AR-PARQ1,AR-PARQ1
90, 0,0, 304.8,304.8, 304.8,-304.8
90, 50.8,0, 304.8,304.8, 304.8,-304.8
90, 101.6,0, 304.8,304.8, 304.8,-304.8
90, 152.4,0, 304.8,304.8, 304.8,-304.8
90, 203.2,0, 304.8,304.8, 304.8,-304.8
90, 254,0, 304.8,304.8, 304.8,-304.8
90, 304.8,0, 304.8,304.8, 304.8,-304.8
0, 0,304.8, 304.8,-304.8, 304.8,-304.8
0, 0,355.6, 304.8,-304.8, 304.8,-304.8
0, 0,406.4, 304.8,-304.8, 304.8,-304.8
0, 0,457.2, 304.8,-304.8, 304.8,-304.8
0, 0,508, 304.8,-304.8, 304.8,-304.8
0, 0,558.8, 304.8,-304.8, 304.8,-304.8
0, 0,609.6, 304.8,-304.8, 304.8,-304.8
`));ie(ee.ParsePatFile(`
*AR-RROOF,AR-RROOF
0, 0,0, 55.88,25.4, 381,-50.8,127,-25.4
0, 33.782,12.7, -25.4,33.782, 76.2,-8.382,152.4,-19.05
0, 12.7,21.59, 132.08,17.018, 203.2,-35.56,101.6,-25.4
`));ie(ee.ParsePatFile(`
*AR-RSHKE,AR-RSHKE
0, 0,0, 647.7,304.8, 152.4,-127,177.8,-76.2,228.6,-101.6
0, 152.4,12.7, 647.7,304.8, 127,-482.6,101.6,-152.4
0, 457.2,-19.05, 647.7,304.8, 76.2,-787.4
90, 0,0, 304.8,215.9, 292.1,-927.1
90, 152.4,0, 304.8,215.9, 285.75,-933.45
90, 279.4,0, 304.8,215.9, 266.7,-952.5
90, 457.2,-19.05, 304.8,215.9, 292.1,-927.1
90, 533.4,-19.05, 304.8,215.9, 292.1,-927.1
90, 762,0, 304.8,215.9, 279.4,-939.8
`));ie(ee.ParsePatFile(`
*AR-SAND,AR-SAND
37.5, 0,0, 28.5242,39.8018, 0,-38.608,0,-43.18,0,-41.275
7.5, 0,0, 53.9242,65.2018, 0,-20.828,0,-34.798,0,-13.335
-32.5, -31.242,0, 66.6344,42.6212, 0,-12.7,0,-45.72,0,-59.69
-42.5, -31.242,0, 41.2344,68.0212, 0,-6.35,0,-29.972,0,-34.29
`));ie(ee.ParsePatFile(`
*BARBWIRE,BARBWIRE
;By John Hyslop
;Developed in mm as metric QCAD3 pattern
315,7.62,14.224,17.960512212,17.960512212,0.359210356,-35.561814322
288.434949,6.604,17.272,56.225296744,8.032185358,3.212874194,-77.10897837
158.198591,7.874,16.764,80.18324705,4.716661636,1.36783191,-135.415354264
116.565051,8.128,16.256,34.077676066,11.35922544,0.567961272,-56.22816542
116.565051,8.636,15.24,34.077676066,11.35922544,1.135922544,-55.660204148
111.801409,11.176,9.906,56.599939124,4.716661636,1.36783191,-135.415354264
156.801409,12.954,9.144,136.74251925,3.335183322,1.934406342,-191.506230398
289.653824,11.684,12.7,297.294468148,1.708588912,3.775981526,-373.822164724
194.036243,7.874,9.144,80.085263502,6.160405002,1.047268924,-103.679614078
251.565051,8.128,9.906,24.09655582,8.032185358,0.803218612,-79.518633952
254.054604,8.636,11.684,104.668749768,3.488958224,1.84914794,-183.065643266
74.744881,8.636,11.684,104.703186326,2.22772732,2.896045516,-286.708512434
135,9.144,11.176,17.960512212,17.960512212,0.718420458,-35.202603966
180,9.906,11.176,0,25.4,0.762,-24.638
270,9.906,11.43,0,25.4,0.254,-25.146
74.054604,9.906,11.43,104.668749768,3.488958224,3.69829588,-181.216495326
161.565051,10.668,11.176,24.09655582,8.032185358,0.803218612,-79.518633952
198.434949,11.43,11.43,56.225296744,8.032185358,0.803218612,-79.518633952
258.231711,12.7,17.526,129.51095129,1.03608759,6.226886454,-616.461767582
21.801409,11.43,17.018,56.599939124,4.716661636,1.36783191,-135.415354264
75.963757,10.922,14.986,24.6416195,6.160405002,2.094537594,-102.632345154
341.565051,10.16,15.24,24.09655582,8.032185358,0.803218612,-79.518633952
45,9.398,14.478,17.960512212,17.960512212,1.077630814,-34.843393864
288.434949,9.144,15.24,56.225296744,8.032185358,0.803218612,-79.518633952
0,8.636,15.24,0,25.4,0.508,-24.892
26.565051,8.128,14.986,34.077676066,11.35922544,0.567961272,-56.22816542
78.231711,6.858,8.89,129.51095129,1.03608759,6.226886454,-616.461767582
4.085617,19.812,12.192,331.17053781,1.80967507,3.565059926,-352.940928864
0,17.526,12.192,0,25.4,2.286,-23.114
354.289407,14.986,12.446,25.273944626,2.527394488,2.552668504,-252.714172244
356.185925,11.938,13.97,25.343743064,1.689582854,3.818457184,-378.027270614
351.469234,20.32,13.97,179.600730968,1.255949228,5.136831992,-508.546377622
0,16.764,13.97,0,25.4,3.556,-21.844
14.036243,11.684,12.7,80.085263502,6.160405002,5.236344112,-99.490538636
189.865807,17.78,12.954,438.470633344,1.088016366,5.92968969,-587.039280834
180,20.32,12.954,0,25.4,2.54,-22.86
171.469234,25.4,12.192,179.600730968,1.255949228,5.136831992,-508.546377622
186.115504,25.4,14.224,230.005013954,0.901980416,3.973724844,-711.296769428
5.52754,3.499555612,13.546666582,255.265537982,0.815544724,4.394880466,-786.683623734
3.691386,0,12.192,381.844852514,0.817654956,3.84896106,-785.188047096
348.310631,0,13.208,129.51225558,0.85769704,7.522003244,-744.678315822
348.690068,0,14.224,24.906749272,4.981349956,7.770905718,-121.744189836
`));ie(ee.ParsePatFile(`
*BLOCKS-01
;By John Hyslop,    Tile2Hatch tool \xA9 CVH 2020
;Developed in mm as metric QCAD3 pattern
270,7.874,16.764,25.4,25.4,5.588,-19.812
180,2.032,2.286,0,25.4,14.478,-10.922
270,2.032,2.286,25.4,25.4,5.334,-20.066
180,2.032,22.352,0,25.4,14.478,-10.922
270,12.954,2.286,25.4,25.4,5.334,-20.066
270,22.606,8.128,25.4,25.4,5.08,-20.32
0,12.446,8.128,0,25.4,10.16,-15.24
90,12.446,3.048,25.4,25.4,5.08,-20.32
180,22.606,3.048,0,25.4,10.16,-15.24
270,17.526,21.336,25.4,25.4,12.192,-13.208
0,12.192,21.336,0,25.4,5.334,-20.066
90,12.192,9.144,25.4,25.4,12.192,-13.208
180,17.526,9.144,0,25.4,5.334,-20.066
270,3.048,0.762,25.4,25.4,8.382,-17.018
0,3.048,17.78,0,25.4,8.128,-17.272
270,11.176,0.762,25.4,25.4,8.382,-17.018
0,3.048,0.762,0,25.4,8.128,-17.272
270,11.43,17.018,25.4,25.4,6.096,-19.304
0,9.144,17.018,0,25.4,2.286,-23.114
90,9.144,10.922,25.4,25.4,6.096,-19.304
180,11.43,10.922,0,25.4,2.286,-23.114
270,11.43,10.16,25.4,25.4,8.382,-17.018
0,2.794,10.16,0,25.4,8.636,-16.764
90,2.794,1.778,25.4,25.4,8.382,-17.018
180,11.43,1.778,0,25.4,8.636,-16.764
270,22.606,10.414,25.4,25.4,1.524,-23.876
0,18.542,10.414,0,25.4,4.064,-21.336
90,18.542,8.89,25.4,25.4,1.524,-23.876
180,22.606,8.89,0,25.4,4.064,-21.336
180,1.778,10.16,0,25.4,3.556,-21.844
270,23.622,10.16,25.4,25.4,6.858,-18.542
180,1.778,3.302,0,25.4,3.556,-21.844
270,1.778,10.16,25.4,25.4,6.858,-18.542
180,2.032,20.574,0,25.4,8.636,-16.764
270,18.796,20.574,25.4,25.4,2.54,-22.86
180,2.032,18.034,0,25.4,8.636,-16.764
270,2.032,20.574,25.4,25.4,2.54,-22.86
180,7.874,16.764,0,25.4,14.986,-10.414
270,18.288,16.764,25.4,25.4,5.588,-19.812
180,7.874,11.176,0,25.4,14.986,-10.414
`));ie(ee.ParsePatFile(`
*BLOCKS-02
;By John Hyslop,    Tile2Hatch tool \xA9 CVH 2020
;Developed in mm as metric QCAD3 pattern
180,8.128,4.572,0,25.4,12.446,-12.954
270,8.128,13.97,25.4,25.4,9.398,-16.002
0,9.398,24.384,0,25.4,10.668,-14.732
0,4.318,24.892,0,25.4,4.318,-21.082
90,20.828,0,25.4,25.4,3.81,-21.59
180,23.368,0,0,25.4,2.54,-22.86
180,8.128,13.97,0,25.4,12.446,-12.954
270,21.082,13.97,25.4,25.4,9.398,-16.002
180,3.302,20.32,0,25.4,4.572,-20.828
90,3.556,14.986,25.4,25.4,4.318,-21.082
270,3.302,3.81,25.4,25.4,8.89,-16.51
180,18.034,14.986,0,25.4,14.478,-10.922
270,23.368,3.81,25.4,25.4,3.81,-21.59
0,20.828,3.81,0,25.4,2.54,-22.86
270,18.034,19.304,25.4,25.4,4.318,-21.082
0,3.556,19.304,0,25.4,14.478,-10.922
180,2.032,14.986,0,25.4,8.128,-17.272
270,2.032,19.304,25.4,25.4,4.318,-21.082
180,3.302,3.81,0,25.4,4.572,-20.828
270,24.13,3.81,25.4,25.4,8.89,-16.51
90,4.572,20.32,25.4,25.4,3.302,-22.098
180,23.114,20.32,0,25.4,18.542,-6.858
180,2.032,19.304,0,25.4,8.128,-17.272
270,19.304,19.304,25.4,25.4,4.318,-21.082
270,8.636,3.81,25.4,25.4,4.318,-21.082
0,4.318,3.81,0,25.4,4.318,-21.082
270,23.114,23.622,25.4,25.4,3.302,-22.098
0,4.572,23.622,0,25.4,18.542,-6.858
0,9.398,13.97,0,25.4,10.668,-14.732
270,9.398,13.97,25.4,25.4,14.986,-10.414
270,4.318,3.81,25.4,25.4,4.318,-21.082
270,20.066,13.97,25.4,25.4,14.986,-10.414
`));ie(ee.ParsePatFile(`
*BOX-OVERLAP
;By John Hyslop,    Tile2Hatch tool \xA9 CVH 2020
;Developed in mm as metric QCAD3 pattern
180,5.08,17.78,0,25.4,10.16,-15.24
90,5.08,5.08,25.4,25.4,15.24,-10.16
270,7.62,5.08,25.4,25.4,10.16,-15.24
180,5.08,7.62,0,25.4,10.16,-15.24
0,5.08,20.32,0,25.4,15.24,-10.16
180,20.32,5.08,0,25.4,15.24,-10.16
270,20.32,20.32,25.4,25.4,15.24,-10.16
270,17.78,5.08,25.4,25.4,10.16,-15.24
`));ie(ee.ParsePatFile(`
*BOX,BOX
90, 0,0, 0,25.4
90, 6.35,0, 0,25.4
0, 0,0, 0,25.4, -6.35,6.35
0, 0,6.35, 0,25.4, -6.35,6.35
0, 0,12.7, 0,25.4, 6.35,-6.35
0, 0,19.05, 0,25.4, 6.35,-6.35
90, 12.7,0, 0,25.4, 6.35,-6.35
90, 19.05,0, 0,25.4, 6.35,-6.35
`));ie(ee.ParsePatFile(`
*BOXJOIN-01
;By John Hyslop,    Tile2Hatch tool \xA9 CVH 2020
;Developed in mm as metric QCAD3 pattern
90,3.810000254,3.81,25.4,25.4,17.78,-7.62
0,3.810000254,21.59,0,25.4,17.78,-7.62
270,11.430000254,3.81,25.4,25.4,7.62,-17.78
180,3.810000254,11.43,0,25.4,7.62,-17.78
270,13.970000254,3.81,25.4,25.4,7.62,-17.78
180,21.590000254,3.81,0,25.4,17.78,-7.62
270,21.590000254,21.59,25.4,25.4,17.78,-7.62
180,3.810000254,13.97,0,25.4,7.62,-17.78
`));ie(ee.ParsePatFile(`
*BOXJOIN-02
;By John Hyslop,    Tile2Hatch tool \xA9 CVH 2020
;Developed in mm as metric QCAD3 pattern
90,3.810000254,13.97,25.4,25.4,7.62,-17.78
270,21.590000254,21.59,25.4,25.4,7.62,-17.78
0,13.970000254,21.59,0,25.4,7.62,-17.78
180,3.810000254,13.97,0,25.4,7.62,-17.78
90,3.810000254,3.81,25.4,25.4,7.62,-17.78
180,11.430000254,3.81,0,25.4,7.62,-17.78
180,3.810000254,11.43,0,25.4,7.62,-17.78
180,21.590000254,3.81,0,25.4,7.62,-17.78
270,21.590000254,11.43,25.4,25.4,7.62,-17.78
270,11.430000254,3.81,25.4,25.4,7.62,-17.78
270,13.970000254,3.81,25.4,25.4,7.62,-17.78
0,3.810000254,21.59,0,25.4,7.62,-17.78
`));ie(ee.ParsePatFile(`
*BRASS,BRASS
0, 0,0, 0,6.35
0, 0,3.175, 0,6.35, 3.175,-1.5875
`));ie(ee.ParsePatFile(`
*BRICK,BRICK
0, 0,0, 0,6.35
90, 0,0, 0,12.7, 6.35,-6.35
90, 6.35,0, 0,12.7, -6.35,6.35
`));ie(ee.ParsePatFile(`
*BRSTONE,BRSTONE
0, 0,0, 0,8.382
90, 22.86,0, 8.382,12.7, 8.382,-8.382
90, 20.32,0, 8.382,12.7, 8.382,-8.382
0, 22.86,1.397, 12.7,8.382, -22.86,2.54
0, 22.86,2.794, 12.7,8.382, -22.86,2.54
0, 22.86,4.191, 12.7,8.382, -22.86,2.54
0, 22.86,5.588, 12.7,8.382, -22.86,2.54
0, 22.86,6.985, 12.7,8.382, -22.86,2.54
`));ie(ee.ParsePatFile(`
*BUBBLES-01,BUBBLES-01
;By John Hyslop,    Using AutoCAD Lisp Tool
;Developed in mm as metric QCAD3 pattern
0,1.4976856,0.4251706,0,25.4,0,-25.4
0,1.5807944,0.8431022,0,25.4,0,-25.4
0,1.7177766,1.2465812,0,25.4,0,-25.4
0,1.9062192,1.6287242,0,25.4,0,-25.4
0,2.1429472,1.9830034,0,25.4,0,-25.4
0,2.4238966,2.3033736,0,25.4,0,-25.4
0,2.7442414,2.584323,0,25.4,0,-25.4
0,3.098546,2.821051,0,25.4,0,-25.4
0,3.480689,3.0094936,0,25.4,0,-25.4
0,3.884168,3.1464504,0,25.4,0,-25.4
0,4.3020742,3.2295846,0,25.4,0,-25.4
0,4.7272702,3.2574484,0,25.4,0,-25.4
0,5.1524408,3.2295846,0,25.4,0,-25.4
0,5.570347,3.1464504,0,25.4,0,-25.4
0,5.973826,3.0094936,0,25.4,0,-25.4
0,6.3559944,2.821051,0,25.4,0,-25.4
0,6.7102736,2.584323,0,25.4,0,-25.4
0,7.0306184,2.3033736,0,25.4,0,-25.4
0,7.3115678,1.9830034,0,25.4,0,-25.4
0,7.5482958,1.6287242,0,25.4,0,-25.4
0,7.7367638,1.2465812,0,25.4,0,-25.4
0,7.8737206,0.8431022,0,25.4,0,-25.4
0,7.9568548,0.4251706,0,25.4,0,-25.4
0,3.0482032,5.5942992,0,25.4,0,-25.4
0,2.9839412,5.1610768,0,25.4,0,-25.4
0,2.8775152,4.7362618,0,25.4,0,-25.4
0,2.729992,4.3239182,0,25.4,0,-25.4
0,2.5427432,3.9280338,0,25.4,0,-25.4
0,2.3175976,3.5523932,0,25.4,0,-25.4
0,2.0567142,3.2006286,0,25.4,0,-25.4
0,1.7626076,2.8761436,0,25.4,0,-25.4
0,1.4380972,2.582037,0,25.4,0,-25.4
0,1.086358,2.3211536,0,25.4,0,-25.4
0,0.7107174,2.096008,0,25.4,0,-25.4
0,0.3148076,1.9087592,0,25.4,0,-25.4
0,0.3148076,10.154666,0,25.4,0,-25.4
0,0.7107174,9.9674172,0,25.4,0,-25.4
0,1.086358,9.7422716,0,25.4,0,-25.4
0,1.4380972,9.4813882,0,25.4,0,-25.4
0,1.7626076,9.1872816,0,25.4,0,-25.4
0,2.0567142,8.8627966,0,25.4,0,-25.4
0,2.3175976,8.511032,0,25.4,0,-25.4
0,2.5427432,8.1353914,0,25.4,0,-25.4
0,2.729992,7.7394816,0,25.4,0,-25.4
0,2.8775152,7.327138,0,25.4,0,-25.4
0,2.9839412,6.902323,0,25.4,0,-25.4
0,3.0482032,6.469126,0,25.4,0,-25.4
0,3.0696916,6.0317126,0,25.4,0,-25.4
0,18.7471304,9.4569026,0,25.4,0,-25.4
0,18.6083702,9.0603324,0,25.4,0,-25.4
0,18.3848248,8.70458,0,25.4,0,-25.4
0,18.0877464,8.4074762,0,25.4,0,-25.4
0,17.731994,8.1839562,0,25.4,0,-25.4
0,17.3354238,8.0451706,0,25.4,0,-25.4
0,16.9178986,7.9981298,0,25.4,0,-25.4
0,16.5003988,8.0451706,0,25.4,0,-25.4
0,16.1038286,8.1839562,0,25.4,0,-25.4
0,15.7480762,8.4074762,0,25.4,0,-25.4
0,15.4509724,8.70458,0,25.4,0,-25.4
0,15.2274524,9.0603324,0,25.4,0,-25.4
0,15.0886668,9.4569026,0,25.4,0,-25.4
0,15.041626,9.8744024,0,25.4,0,-25.4
0,15.0886668,10.2919276,0,25.4,0,-25.4
0,15.2274524,10.6884978,0,25.4,0,-25.4
0,15.4509724,11.0442502,0,25.4,0,-25.4
0,15.7480762,11.341354,0,25.4,0,-25.4
0,16.1038286,11.564874,0,25.4,0,-25.4
0,16.5003988,11.7036342,0,25.4,0,-25.4
0,16.9178986,11.750675,0,25.4,0,-25.4
0,17.3354238,11.7036342,0,25.4,0,-25.4
0,17.731994,11.564874,0,25.4,0,-25.4
0,18.0877464,11.341354,0,25.4,0,-25.4
0,18.3848248,11.0442502,0,25.4,0,-25.4
0,18.6083702,10.6884978,0,25.4,0,-25.4
0,18.7471304,10.2919276,0,25.4,0,-25.4
0,18.7941712,9.8744024,0,25.4,0,-25.4
0,21.2068664,21.1084414,0,25.4,0,-25.4
0,20.8647792,21.3569804,0,25.4,0,-25.4
0,20.5818486,21.6712292,0,25.4,0,-25.4
0,11.7541802,19.0603632,0,25.4,0,-25.4
0,11.6505482,18.6510676,0,25.4,0,-25.4
0,11.480927,18.264378,0,25.4,0,-25.4
0,11.2499902,17.9108862,0,25.4,0,-25.4
0,10.9640116,17.6002442,0,25.4,0,-25.4
0,10.6308144,17.3409102,0,25.4,0,-25.4
0,10.2594664,17.1399454,0,25.4,0,-25.4
0,9.8601022,17.0028362,0,25.4,0,-25.4
0,9.4436184,16.9333418,0,25.4,0,-25.4
0,9.0213688,16.9333418,0,25.4,0,-25.4
0,8.6049104,17.0028362,0,25.4,0,-25.4
0,8.2055462,17.1399454,0,25.4,0,-25.4
0,7.8341982,17.3409102,0,25.4,0,-25.4
0,7.5009756,17.6002442,0,25.4,0,-25.4
0,7.2150224,17.9108862,0,25.4,0,-25.4
0,6.9840602,18.264378,0,25.4,0,-25.4
0,6.8144644,18.6510676,0,25.4,0,-25.4
0,6.710807,19.0603632,0,25.4,0,-25.4
0,6.6759328,19.481165,0,25.4,0,-25.4
0,6.710807,19.9019668,0,25.4,0,-25.4
0,6.8144644,20.3112878,0,25.4,0,-25.4
0,6.9840602,20.697952,0,25.4,0,-25.4
0,7.2150224,21.0514438,0,25.4,0,-25.4
0,7.5009756,21.3620858,0,25.4,0,-25.4
0,7.8341982,21.6214452,0,25.4,0,-25.4
0,8.2055462,21.82241,0,25.4,0,-25.4
0,10.2594664,21.82241,0,25.4,0,-25.4
0,10.6308144,21.6214452,0,25.4,0,-25.4
0,10.9640116,21.3620858,0,25.4,0,-25.4
0,11.2499902,21.0514438,0,25.4,0,-25.4
0,11.480927,20.697952,0,25.4,0,-25.4
0,11.6505482,20.3112878,0,25.4,0,-25.4
0,11.7541802,19.9019668,0,25.4,0,-25.4
0,11.7890544,19.481165,0,25.4,0,-25.4
0,20.8583784,16.4692076,0,25.4,0,-25.4
0,20.7913224,16.0457896,0,25.4,0,-25.4
0,20.6803752,15.6317442,0,25.4,0,-25.4
0,20.5267306,15.2315418,0,25.4,0,-25.4
0,20.3321158,14.8495766,0,25.4,0,-25.4
0,20.0986644,14.490065,0,25.4,0,-25.4
0,19.828891,14.1569186,0,25.4,0,-25.4
0,19.5257674,13.853795,0,25.4,0,-25.4
0,19.192621,13.5840216,0,25.4,0,-25.4
0,18.8331094,13.3505448,0,25.4,0,-25.4
0,18.4511442,13.15593,0,25.4,0,-25.4
0,18.0509418,13.0023108,0,25.4,0,-25.4
0,17.636871,12.8913636,0,25.4,0,-25.4
0,17.2134784,12.8243076,0,25.4,0,-25.4
0,16.7853868,12.8018794,0,25.4,0,-25.4
0,16.3573206,12.8243076,0,25.4,0,-25.4
0,15.9339026,12.8913636,0,25.4,0,-25.4
0,15.5198572,13.0023108,0,25.4,0,-25.4
0,15.1196548,13.15593,0,25.4,0,-25.4
0,14.7376896,13.3505448,0,25.4,0,-25.4
0,14.378178,13.5840216,0,25.4,0,-25.4
0,14.0450316,13.853795,0,25.4,0,-25.4
0,13.741908,14.1569186,0,25.4,0,-25.4
0,13.4721346,14.490065,0,25.4,0,-25.4
0,13.2386578,14.8495766,0,25.4,0,-25.4
0,13.044043,15.2315418,0,25.4,0,-25.4
0,12.8904238,15.6317442,0,25.4,0,-25.4
0,12.7794766,16.0457896,0,25.4,0,-25.4
0,12.7124206,16.4692076,0,25.4,0,-25.4
0,12.6899924,16.8972738,0,25.4,0,-25.4
0,12.7124206,17.3253654,0,25.4,0,-25.4
0,12.7794766,17.748758,0,25.4,0,-25.4
0,12.8904238,18.1628288,0,25.4,0,-25.4
0,13.044043,18.5630312,0,25.4,0,-25.4
0,13.2386578,18.9449964,0,25.4,0,-25.4
0,13.4721346,19.304508,0,25.4,0,-25.4
0,13.741908,19.6376544,0,25.4,0,-25.4
0,14.0450316,19.9407526,0,25.4,0,-25.4
0,14.378178,20.2105514,0,25.4,0,-25.4
0,14.7376896,20.4440028,0,25.4,0,-25.4
0,15.1196548,20.6386176,0,25.4,0,-25.4
0,15.5198572,20.7922368,0,25.4,0,-25.4
0,15.9339026,20.9032094,0,25.4,0,-25.4
0,16.3573206,20.9702654,0,25.4,0,-25.4
0,16.7853868,20.9926936,0,25.4,0,-25.4
0,17.2134784,20.9702654,0,25.4,0,-25.4
0,17.636871,20.9032094,0,25.4,0,-25.4
0,18.0509418,20.7922368,0,25.4,0,-25.4
0,18.4511442,20.6386176,0,25.4,0,-25.4
0,18.8331094,20.4440028,0,25.4,0,-25.4
0,19.192621,20.2105514,0,25.4,0,-25.4
0,19.5257674,19.9407526,0,25.4,0,-25.4
0,19.828891,19.6376544,0,25.4,0,-25.4
0,20.0986644,19.304508,0,25.4,0,-25.4
0,20.3321158,18.9449964,0,25.4,0,-25.4
0,20.5267306,18.5630312,0,25.4,0,-25.4
0,20.6803752,18.1628288,0,25.4,0,-25.4
0,20.7913224,17.748758,0,25.4,0,-25.4
0,20.8583784,17.3253654,0,25.4,0,-25.4
0,20.8808066,16.8972738,0,25.4,0,-25.4
0,13.3174994,9.6961452,0,25.4,0,-25.4
0,13.2480558,9.2577158,0,25.4,0,-25.4
0,13.1331716,8.8289638,0,25.4,0,-25.4
0,12.9740914,8.4145628,0,25.4,0,-25.4
0,12.7725932,8.0190594,0,25.4,0,-25.4
0,12.530836,7.6467716,0,25.4,0,-25.4
0,12.2514868,7.3018142,0,25.4,0,-25.4
0,11.9375936,6.9879464,0,25.4,0,-25.4
0,11.5926362,6.7085972,0,25.4,0,-25.4
0,11.2203738,6.46684,0,25.4,0,-25.4
0,10.824845,6.2653164,0,25.4,0,-25.4
0,10.410444,6.1062362,0,25.4,0,-25.4
0,9.981692,5.991352,0,25.4,0,-25.4
0,9.5432626,5.9219084,0,25.4,0,-25.4
0,9.0999818,5.8986928,0,25.4,0,-25.4
0,8.6567264,5.9219084,0,25.4,0,-25.4
0,8.218297,5.991352,0,25.4,0,-25.4
0,7.7895196,6.1062362,0,25.4,0,-25.4
0,7.3751186,6.2653164,0,25.4,0,-25.4
0,6.9796152,6.46684,0,25.4,0,-25.4
0,6.6073528,6.7085972,0,25.4,0,-25.4
0,6.2623954,6.9879464,0,25.4,0,-25.4
0,5.9485022,7.3018142,0,25.4,0,-25.4
0,5.669153,7.6467716,0,25.4,0,-25.4
0,5.4273958,8.0190594,0,25.4,0,-25.4
0,5.2258722,8.4145628,0,25.4,0,-25.4
0,5.0668174,8.8289638,0,25.4,0,-25.4
0,4.9519332,9.2577158,0,25.4,0,-25.4
0,4.8824896,9.6961452,0,25.4,0,-25.4
0,4.8592486,10.139426,0,25.4,0,-25.4
0,4.8824896,10.5827068,0,25.4,0,-25.4
0,4.9519332,11.0211362,0,25.4,0,-25.4
0,5.0668174,11.4498882,0,25.4,0,-25.4
0,5.2258722,11.8642892,0,25.4,0,-25.4
0,5.4273958,12.2597926,0,25.4,0,-25.4
0,5.669153,12.6320804,0,25.4,0,-25.4
0,5.9485022,12.9770378,0,25.4,0,-25.4
0,6.2623954,13.2909056,0,25.4,0,-25.4
0,6.6073528,13.5702548,0,25.4,0,-25.4
0,6.9796152,13.812012,0,25.4,0,-25.4
0,7.3751186,14.0135356,0,25.4,0,-25.4
0,7.7895196,14.1726158,0,25.4,0,-25.4
0,8.218297,14.2875,0,25.4,0,-25.4
0,8.6567264,14.3569436,0,25.4,0,-25.4
0,9.0999818,14.3801592,0,25.4,0,-25.4
0,9.5432626,14.3569436,0,25.4,0,-25.4
0,9.981692,14.2875,0,25.4,0,-25.4
0,10.410444,14.1726158,0,25.4,0,-25.4
0,10.824845,14.0135356,0,25.4,0,-25.4
0,11.2203738,13.812012,0,25.4,0,-25.4
0,11.5926362,13.5702548,0,25.4,0,-25.4
0,11.9375936,13.2909056,0,25.4,0,-25.4
0,12.2514868,12.9770378,0,25.4,0,-25.4
0,12.530836,12.6320804,0,25.4,0,-25.4
0,12.7725932,12.2597926,0,25.4,0,-25.4
0,12.9740914,11.8642892,0,25.4,0,-25.4
0,13.1331716,11.4498882,0,25.4,0,-25.4
0,13.2480558,11.0211362,0,25.4,0,-25.4
0,13.3174994,10.5827068,0,25.4,0,-25.4
0,13.3407404,10.139426,0,25.4,0,-25.4
0,21.5277192,2.3211536,0,25.4,0,-25.4
0,21.1759546,2.582037,0,25.4,0,-25.4
0,20.8514442,2.8761436,0,25.4,0,-25.4
0,20.557363,3.2006286,0,25.4,0,-25.4
0,20.2964796,3.5523932,0,25.4,0,-25.4
0,20.0713086,3.9280338,0,25.4,0,-25.4
0,19.8840852,4.3239182,0,25.4,0,-25.4
0,19.7365366,4.7362618,0,25.4,0,-25.4
0,19.630136,5.1610768,0,25.4,0,-25.4
0,19.565874,5.5942992,0,25.4,0,-25.4
0,19.5443856,6.0317126,0,25.4,0,-25.4
0,19.565874,6.469126,0,25.4,0,-25.4
0,19.630136,6.902323,0,25.4,0,-25.4
0,19.7365366,7.327138,0,25.4,0,-25.4
0,19.8840852,7.7394816,0,25.4,0,-25.4
0,20.0713086,8.1353914,0,25.4,0,-25.4
0,20.2964796,8.511032,0,25.4,0,-25.4
0,20.557363,8.8627966,0,25.4,0,-25.4
0,20.8514442,9.1872816,0,25.4,0,-25.4
0,21.1759546,9.4813882,0,25.4,0,-25.4
0,21.5277192,9.7422716,0,25.4,0,-25.4
0,6.1278008,16.064738,0,25.4,0,-25.4
0,6.0612782,15.6162756,0,25.4,0,-25.4
0,5.9511438,15.1765,0,25.4,0,-25.4
0,5.7983882,14.749653,0,25.4,0,-25.4
0,5.6045608,14.339824,0,25.4,0,-25.4
0,5.3714904,13.95095,0,25.4,0,-25.4
0,5.1014122,13.5868156,0,25.4,0,-25.4
0,4.7969678,13.2509006,0,25.4,0,-25.4
0,4.4610528,12.9464308,0,25.4,0,-25.4
0,4.0969184,12.676378,0,25.4,0,-25.4
0,3.7080444,12.4433076,0,25.4,0,-25.4
0,3.2982154,12.2494548,0,25.4,0,-25.4
0,2.8713684,12.0967246,0,25.4,0,-25.4
0,2.4315928,11.9865648,0,25.4,0,-25.4
0,1.9831304,11.9200422,0,25.4,0,-25.4
0,1.5303246,11.8977918,0,25.4,0,-25.4
0,1.0774934,11.9200422,0,25.4,0,-25.4
0,0.6290564,11.9865648,0,25.4,0,-25.4
0,0.1892808,12.0967246,0,25.4,0,-25.4
0,0.1892808,20.938363,0,25.4,0,-25.4
0,0.6290564,21.0485228,0,25.4,0,-25.4
0,1.0774934,21.1150454,0,25.4,0,-25.4
0,1.5303246,21.1372958,0,25.4,0,-25.4
0,1.9831304,21.1150454,0,25.4,0,-25.4
0,2.4315928,21.0485228,0,25.4,0,-25.4
0,2.8713684,20.938363,0,25.4,0,-25.4
0,3.2982154,20.7856328,0,25.4,0,-25.4
0,3.7080444,20.59178,0,25.4,0,-25.4
0,4.0969184,20.3587096,0,25.4,0,-25.4
0,4.4610528,20.0886568,0,25.4,0,-25.4
0,4.7969678,19.784187,0,25.4,0,-25.4
0,5.1014122,19.448272,0,25.4,0,-25.4
0,5.3714904,19.0841376,0,25.4,0,-25.4
0,5.6045608,18.6952636,0,25.4,0,-25.4
0,5.7983882,18.2854346,0,25.4,0,-25.4
0,5.9511438,17.8585876,0,25.4,0,-25.4
0,6.0612782,17.418812,0,25.4,0,-25.4
0,6.1278008,16.9703496,0,25.4,0,-25.4
0,6.1500512,16.5175438,0,25.4,0,-25.4
0,19.5946268,1.221359,0,25.4,0,-25.4
0,19.5242688,0.7469886,0,25.4,0,-25.4
0,19.4077336,0.281813,0,25.4,0,-25.4
0,10.055352,0.281813,0,25.4,0,-25.4
0,9.9388168,0.7469886,0,25.4,0,-25.4
0,9.8684588,1.221359,0,25.4,0,-25.4
0,9.844913,1.7003268,0,25.4,0,-25.4
0,9.8684588,2.1792946,0,25.4,0,-25.4
0,9.9388168,2.653665,0,25.4,0,-25.4
0,10.055352,3.1188406,0,25.4,0,-25.4
0,10.216896,3.570351,0,25.4,0,-25.4
0,10.4219248,4.0038528,0,25.4,0,-25.4
0,10.6684572,4.4151804,0,25.4,0,-25.4
0,10.954131,4.800346,0,25.4,0,-25.4
0,11.2761776,5.155692,0,25.4,0,-25.4
0,11.6314982,5.4777386,0,25.4,0,-25.4
0,12.0166892,5.763387,0,25.4,0,-25.4
0,12.4280168,6.0099448,0,25.4,0,-25.4
0,12.8615186,6.2149736,0,25.4,0,-25.4
0,13.313029,6.3765176,0,25.4,0,-25.4
0,13.7782046,6.4930528,0,25.4,0,-25.4
0,14.252575,6.5634108,0,25.4,0,-25.4
0,14.7315428,6.5869312,0,25.4,0,-25.4
0,15.2105106,6.5634108,0,25.4,0,-25.4
0,15.684881,6.4930528,0,25.4,0,-25.4
0,16.1500566,6.3765176,0,25.4,0,-25.4
0,16.601567,6.2149736,0,25.4,0,-25.4
0,17.0350688,6.0099448,0,25.4,0,-25.4
0,17.4463964,5.763387,0,25.4,0,-25.4
0,17.8315874,5.4777386,0,25.4,0,-25.4
0,18.186908,5.155692,0,25.4,0,-25.4
0,18.5089546,4.800346,0,25.4,0,-25.4
0,18.794603,4.4151804,0,25.4,0,-25.4
0,19.0411608,4.0038528,0,25.4,0,-25.4
0,19.2461896,3.570351,0,25.4,0,-25.4
0,19.4077336,3.1188406,0,25.4,0,-25.4
0,19.5242688,2.653665,0,25.4,0,-25.4
0,19.5946268,2.1792946,0,25.4,0,-25.4
0,19.6181472,1.7003268,0,25.4,0,-25.4
0,25.1624084,12.2494548,0,25.4,0,-25.4
0,24.7525794,12.4433076,0,25.4,0,-25.4
0,24.3637308,12.676378,0,25.4,0,-25.4
0,23.9995964,12.9464308,0,25.4,0,-25.4
0,23.663656,13.2509006,0,25.4,0,-25.4
0,23.3592116,13.5868156,0,25.4,0,-25.4
0,23.0891334,13.95095,0,25.4,0,-25.4
0,22.856063,14.339824,0,25.4,0,-25.4
0,22.6622356,14.749653,0,25.4,0,-25.4
0,22.5095054,15.1765,0,25.4,0,-25.4
0,22.3993456,15.6162756,0,25.4,0,-25.4
0,22.332823,16.064738,0,25.4,0,-25.4
0,22.3105726,16.5175438,0,25.4,0,-25.4
0,22.332823,16.9703496,0,25.4,0,-25.4
0,22.3993456,17.418812,0,25.4,0,-25.4
0,22.5095054,17.8585876,0,25.4,0,-25.4
0,22.6622356,18.2854346,0,25.4,0,-25.4
0,22.856063,18.6952636,0,25.4,0,-25.4
0,23.0891334,19.0841376,0,25.4,0,-25.4
0,23.3592116,19.448272,0,25.4,0,-25.4
0,23.663656,19.784187,0,25.4,0,-25.4
0,23.9995964,20.0886568,0,25.4,0,-25.4
0,24.3637308,20.3587096,0,25.4,0,-25.4
0,24.7525794,20.59178,0,25.4,0,-25.4
0,25.1624084,20.7856328,0,25.4,0,-25.4
0,24.0659412,22.037421,0,25.4,0,-25.4
0,23.854537,21.6712292,0,25.4,0,-25.4
0,23.571581,21.3569804,0,25.4,0,-25.4
0,23.2294938,21.1084414,0,25.4,0,-25.4
0,22.8432106,20.936458,0,25.4,0,-25.4
0,22.429597,20.8485486,0,25.4,0,-25.4
0,22.0067632,20.8485486,0,25.4,0,-25.4
0,21.5931496,20.936458,0,25.4,0,-25.4
0,20.370419,22.037421,0,25.4,0,-25.4
0,25.302464,1.7612106,0,25.4,0,-25.4
0,24.877649,1.65481,0,25.4,0,-25.4
0,24.444452,1.590548,0,25.4,0,-25.4
0,24.0070386,1.5690596,0,25.4,0,-25.4
0,23.5696252,1.590548,0,25.4,0,-25.4
0,23.1364028,1.65481,0,25.4,0,-25.4
0,22.7115878,1.7612106,0,25.4,0,-25.4
0,22.2992442,1.9087592,0,25.4,0,-25.4
0,21.9033598,2.096008,0,25.4,0,-25.4
0,21.9033598,9.9674172,0,25.4,0,-25.4
0,22.2992442,10.154666,0,25.4,0,-25.4
0,22.7115878,10.3022146,0,25.4,0,-25.4
0,23.1364028,10.4086152,0,25.4,0,-25.4
0,23.5696252,10.4728772,0,25.4,0,-25.4
0,24.0070386,10.4943656,0,25.4,0,-25.4
0,24.444452,10.4728772,0,25.4,0,-25.4
0,24.877649,10.4086152,0,25.4,0,-25.4
0,25.302464,10.3022146,0,25.4,0,-25.4
0,19.2461896,25.2303026,0,25.4,0,-25.4
0,19.0411608,24.7967754,0,25.4,0,-25.4
0,18.794603,24.3854732,0,25.4,0,-25.4
0,18.5089546,24.0002822,0,25.4,0,-25.4
0,18.186908,23.6449616,0,25.4,0,-25.4
0,17.8315874,23.322915,0,25.4,0,-25.4
0,17.4463964,23.0372412,0,25.4,0,-25.4
0,17.0350688,22.7907088,0,25.4,0,-25.4
0,16.601567,22.58568,0,25.4,0,-25.4
0,16.1500566,22.4241106,0,25.4,0,-25.4
0,15.684881,22.3076008,0,25.4,0,-25.4
0,15.2105106,22.2372428,0,25.4,0,-25.4
0,14.7315428,22.213697,0,25.4,0,-25.4
0,14.252575,22.2372428,0,25.4,0,-25.4
0,13.7782046,22.3076008,0,25.4,0,-25.4
0,13.313029,22.4241106,0,25.4,0,-25.4
0,12.8615186,22.58568,0,25.4,0,-25.4
0,12.4280168,22.7907088,0,25.4,0,-25.4
0,12.0166892,23.0372412,0,25.4,0,-25.4
0,11.6314982,23.322915,0,25.4,0,-25.4
0,11.2761776,23.6449616,0,25.4,0,-25.4
0,10.954131,24.0002822,0,25.4,0,-25.4
0,10.6684572,24.3854732,0,25.4,0,-25.4
0,10.4219248,24.7967754,0,25.4,0,-25.4
0,10.216896,25.2303026,0,25.4,0,-25.4
0,20.2397614,22.4395792,0,25.4,0,-25.4
0,20.1955654,22.8601016,0,25.4,0,-25.4
0,20.2397614,23.280624,0,25.4,0,-25.4
0,20.370419,23.6827822,0,25.4,0,-25.4
0,20.5818486,24.048974,0,25.4,0,-25.4
0,20.8647792,24.3631974,0,25.4,0,-25.4
0,21.2068664,24.6117364,0,25.4,0,-25.4
0,8.6049104,21.9594938,0,25.4,0,-25.4
0,9.0213688,22.0289882,0,25.4,0,-25.4
0,9.4436184,22.0289882,0,25.4,0,-25.4
0,9.8601022,21.9594938,0,25.4,0,-25.4
0,7.9568548,24.9748294,0,25.4,0,-25.4
0,7.8737206,24.5568978,0,25.4,0,-25.4
0,7.7367638,24.1534188,0,25.4,0,-25.4
0,7.5482958,23.7712758,0,25.4,0,-25.4
0,7.3115678,23.4169966,0,25.4,0,-25.4
0,7.0306184,23.0966264,0,25.4,0,-25.4
0,6.7102736,22.815677,0,25.4,0,-25.4
0,6.3559944,22.578949,0,25.4,0,-25.4
0,5.973826,22.3905064,0,25.4,0,-25.4
0,5.570347,22.2535496,0,25.4,0,-25.4
0,5.1524408,22.1704154,0,25.4,0,-25.4
0,4.7272702,22.1425516,0,25.4,0,-25.4
0,4.3020742,22.1704154,0,25.4,0,-25.4
0,3.884168,22.2535496,0,25.4,0,-25.4
0,3.480689,22.3905064,0,25.4,0,-25.4
0,3.098546,22.578949,0,25.4,0,-25.4
0,2.7442414,22.815677,0,25.4,0,-25.4
0,2.4238966,23.0966264,0,25.4,0,-25.4
0,2.1429472,23.4169966,0,25.4,0,-25.4
0,1.9062192,23.7712758,0,25.4,0,-25.4
0,1.7177766,24.1534188,0,25.4,0,-25.4
0,1.5807944,24.5568978,0,25.4,0,-25.4
0,1.4976856,24.9748294,0,25.4,0,-25.4
0,1.4697964,25.4,0,25.4,0,-25.4
0,7.9847186,25.4,0,25.4,0,-25.4
0,24.1966242,22.4395792,0,25.4,0,-25.4
0,21.5931496,24.7837452,0,25.4,0,-25.4
0,22.0067632,24.8716546,0,25.4,0,-25.4
0,22.429597,24.8716546,0,25.4,0,-25.4
0,22.8432106,24.7837452,0,25.4,0,-25.4
0,23.2294938,24.6117364,0,25.4,0,-25.4
0,23.571581,24.3631974,0,25.4,0,-25.4
0,23.854537,24.048974,0,25.4,0,-25.4
0,24.0659412,23.6827822,0,25.4,0,-25.4
0,24.1966242,23.280624,0,25.4,0,-25.4
0,24.2408202,22.8601016,0,25.4,0,-25.4
`));ie(ee.ParsePatFile(`
*BUBBLES-02,BUBBLES-02
;By John Hyslop,    Using AutoCAD Lisp Tool
;Developed in mm as metric QCAD3 pattern
0,0.315722,3.5481006,0,25.4,0,-25.4
0,0.1191006,3.162173,0,25.4,0,-25.4
0,0.1191006,4.7896018,0,25.4,0,-25.4
0,0.315722,4.4036742,0,25.4,0,-25.4
0,0.3834892,3.9758874,0,25.4,0,-25.4
0,0.9946386,13.9859512,0,25.4,0,-25.4
0,0.840232,13.5788146,0,25.4,0,-25.4
0,0.5928614,13.220446,0,25.4,0,-25.4
0,0.2669286,12.9316988,0,25.4,0,-25.4
0,0.2669286,15.9047688,0,25.4,0,-25.4
0,0.5928614,15.6160216,0,25.4,0,-25.4
0,0.840232,15.257653,0,25.4,0,-25.4
0,0.9946386,14.8505164,0,25.4,0,-25.4
0,1.0471404,14.4182338,0,25.4,0,-25.4
0,0.321437,1.5549118,0,25.4,0,-25.4
0,0.7453122,1.6269208,0,25.4,0,-25.4
0,1.1745976,1.6510254,0,25.4,0,-25.4
0,1.6039084,1.6269208,0,25.4,0,-25.4
0,2.0277836,1.5549118,0,25.4,0,-25.4
0,2.44094,1.435862,0,25.4,0,-25.4
0,2.838196,1.2713208,0,25.4,0,-25.4
0,3.214497,1.0633456,0,25.4,0,-25.4
0,3.5651694,0.8145526,0,25.4,0,-25.4
0,3.8857682,0.5280406,0,25.4,0,-25.4
0,4.1722802,0.2074418,0,25.4,0,-25.4
0,5.3785008,15.8337504,0,25.4,0,-25.4
0,5.1644804,15.4630628,0,25.4,0,-25.4
0,4.8365664,15.1879046,0,25.4,0,-25.4
0,4.434332,15.041499,0,25.4,0,-25.4
0,4.0062658,15.041499,0,25.4,0,-25.4
0,3.6040314,15.1879046,0,25.4,0,-25.4
0,3.2761174,15.4630628,0,25.4,0,-25.4
0,3.062097,15.8337504,0,25.4,0,-25.4
0,2.9877512,16.2553142,0,25.4,0,-25.4
0,3.062097,16.676878,0,25.4,0,-25.4
0,3.2761174,17.0475656,0,25.4,0,-25.4
0,3.6040314,17.3227238,0,25.4,0,-25.4
0,4.0062658,17.4691294,0,25.4,0,-25.4
0,4.434332,17.4691294,0,25.4,0,-25.4
0,4.8365664,17.3227238,0,25.4,0,-25.4
0,5.1644804,17.0475656,0,25.4,0,-25.4
0,5.3785008,16.676878,0,25.4,0,-25.4
0,5.4528212,16.2553142,0,25.4,0,-25.4
0,1.6039084,19.4068192,0,25.4,0,-25.4
0,1.1745976,19.3827146,0,25.4,0,-25.4
0,0.7453122,19.4068192,0,25.4,0,-25.4
0,8.07212,6.3135002,0,25.4,0,-25.4
0,7.9904082,5.9026552,0,25.4,0,-25.4
0,7.8557628,5.5059834,0,25.4,0,-25.4
0,7.6704952,5.130292,0,25.4,0,-25.4
0,7.437755,4.7820072,0,25.4,0,-25.4
0,7.1615554,4.4670472,0,25.4,0,-25.4
0,6.8466208,4.1908476,0,25.4,0,-25.4
0,6.4983106,3.9581328,0,25.4,0,-25.4
0,6.1226192,3.7728652,0,25.4,0,-25.4
0,5.7259474,3.6382198,0,25.4,0,-25.4
0,5.3151024,3.5564826,0,25.4,0,-25.4
0,4.89712,3.5291014,0,25.4,0,-25.4
0,4.4791122,3.5564826,0,25.4,0,-25.4
0,4.0682672,3.6382198,0,25.4,0,-25.4
0,3.6715954,3.7728652,0,25.4,0,-25.4
0,3.295904,3.9581328,0,25.4,0,-25.4
0,2.9475938,4.1908476,0,25.4,0,-25.4
0,2.6326592,4.4670472,0,25.4,0,-25.4
0,2.3564596,4.7820072,0,25.4,0,-25.4
0,2.1237448,5.130292,0,25.4,0,-25.4
0,1.9384772,5.5059834,0,25.4,0,-25.4
0,1.8038064,5.9026552,0,25.4,0,-25.4
0,1.7220946,6.3135002,0,25.4,0,-25.4
0,1.694688,6.731508,0,25.4,0,-25.4
0,1.7220946,7.1495158,0,25.4,0,-25.4
0,1.8038064,7.5603608,0,25.4,0,-25.4
0,1.9384772,7.9570072,0,25.4,0,-25.4
0,2.1237448,8.332724,0,25.4,0,-25.4
0,2.3564596,8.6810088,0,25.4,0,-25.4
0,2.6326592,8.9959434,0,25.4,0,-25.4
0,2.9475938,9.272143,0,25.4,0,-25.4
0,3.295904,9.5048832,0,25.4,0,-25.4
0,3.6715954,9.6901508,0,25.4,0,-25.4
0,4.0682672,9.8247962,0,25.4,0,-25.4
0,4.4791122,9.9065334,0,25.4,0,-25.4
0,4.89712,9.9339146,0,25.4,0,-25.4
0,5.3151024,9.9065334,0,25.4,0,-25.4
0,5.7259474,9.8247962,0,25.4,0,-25.4
0,6.1226192,9.6901508,0,25.4,0,-25.4
0,6.4983106,9.5048832,0,25.4,0,-25.4
0,6.8466208,9.272143,0,25.4,0,-25.4
0,7.1615554,8.9959434,0,25.4,0,-25.4
0,7.437755,8.6810088,0,25.4,0,-25.4
0,7.6704952,8.332724,0,25.4,0,-25.4
0,7.8557628,7.9570072,0,25.4,0,-25.4
0,7.9904082,7.5603608,0,25.4,0,-25.4
0,8.07212,7.1495158,0,25.4,0,-25.4
0,8.0995266,6.731508,0,25.4,0,-25.4
0,18.0404516,13.0813048,0,25.4,0,-25.4
0,17.9789836,12.6669292,0,25.4,0,-25.4
0,17.8771804,12.2606054,0,25.4,0,-25.4
0,17.736058,11.8661942,0,25.4,0,-25.4
0,17.5569626,11.4875056,0,25.4,0,-25.4
0,17.3416214,11.1282226,0,25.4,0,-25.4
0,17.0920664,10.7917488,0,25.4,0,-25.4
0,16.8107614,10.4813862,0,25.4,0,-25.4
0,16.5003734,10.2000558,0,25.4,0,-25.4
0,16.163925,9.9505262,0,25.4,0,-25.4
0,15.8046166,9.7351596,0,25.4,0,-25.4
0,15.4259534,9.5560642,0,25.4,0,-25.4
0,15.0315422,9.4149418,0,25.4,0,-25.4
0,14.625193,9.313164,0,25.4,0,-25.4
0,14.2108428,9.251696,0,25.4,0,-25.4
0,13.792454,9.2311474,0,25.4,0,-25.4
0,13.3740652,9.251696,0,25.4,0,-25.4
0,12.9596896,9.313164,0,25.4,0,-25.4
0,12.5533404,9.4149418,0,25.4,0,-25.4
0,12.1589292,9.5560642,0,25.4,0,-25.4
0,11.780266,9.7351596,0,25.4,0,-25.4
0,11.4209576,9.9505262,0,25.4,0,-25.4
0,11.0845092,10.2000558,0,25.4,0,-25.4
0,10.7741212,10.4813862,0,25.4,0,-25.4
0,10.4928162,10.7917488,0,25.4,0,-25.4
0,10.2432866,11.1282226,0,25.4,0,-25.4
0,10.02792,11.4875056,0,25.4,0,-25.4
0,9.8488246,11.8661942,0,25.4,0,-25.4
0,9.7077022,12.2606054,0,25.4,0,-25.4
0,9.6059244,12.6669292,0,25.4,0,-25.4
0,9.5444564,13.0813048,0,25.4,0,-25.4
0,9.5239078,13.4996936,0,25.4,0,-25.4
0,9.5444564,13.9180824,0,25.4,0,-25.4
0,9.6059244,14.332458,0,25.4,0,-25.4
0,9.7077022,14.7387818,0,25.4,0,-25.4
0,9.8488246,15.133193,0,25.4,0,-25.4
0,10.02792,15.5118816,0,25.4,0,-25.4
0,10.2432866,15.8711646,0,25.4,0,-25.4
0,10.4928162,16.2076384,0,25.4,0,-25.4
0,10.7741212,16.518001,0,25.4,0,-25.4
0,11.0845092,16.7993314,0,25.4,0,-25.4
0,11.4209576,17.048861,0,25.4,0,-25.4
0,11.780266,17.2642276,0,25.4,0,-25.4
0,12.1589292,17.443323,0,25.4,0,-25.4
0,12.5533404,17.5844454,0,25.4,0,-25.4
0,12.9596896,17.6862232,0,25.4,0,-25.4
0,13.3740652,17.7476912,0,25.4,0,-25.4
0,13.792454,17.7682398,0,25.4,0,-25.4
0,14.2108428,17.7476912,0,25.4,0,-25.4
0,14.625193,17.6862232,0,25.4,0,-25.4
0,15.0315422,17.5844454,0,25.4,0,-25.4
0,15.4259534,17.443323,0,25.4,0,-25.4
0,15.8046166,17.2642276,0,25.4,0,-25.4
0,16.163925,17.048861,0,25.4,0,-25.4
0,16.5003734,16.7993314,0,25.4,0,-25.4
0,16.8107614,16.518001,0,25.4,0,-25.4
0,17.0920664,16.2076384,0,25.4,0,-25.4
0,17.3416214,15.8711646,0,25.4,0,-25.4
0,17.5569626,15.5118816,0,25.4,0,-25.4
0,17.736058,15.133193,0,25.4,0,-25.4
0,17.8771804,14.7387818,0,25.4,0,-25.4
0,17.9789836,14.332458,0,25.4,0,-25.4
0,18.0404516,13.9180824,0,25.4,0,-25.4
0,18.0610002,13.4996936,0,25.4,0,-25.4
0,8.9792048,0.3298444,0,25.4,0,-25.4
0,8.9318846,0.7497064,0,25.4,0,-25.4
0,8.9160858,1.1719306,0,25.4,0,-25.4
0,8.9318846,1.5941294,0,25.4,0,-25.4
0,8.9792048,2.0139914,0,25.4,0,-25.4
0,9.0577416,2.429129,0,25.4,0,-25.4
0,9.1670886,2.8372562,0,25.4,0,-25.4
0,9.3066362,3.2360616,0,25.4,0,-25.4
0,9.475597,3.62331,0,25.4,0,-25.4
0,9.6730312,3.9968424,0,25.4,0,-25.4
0,9.8978212,4.3546014,0,25.4,0,-25.4
0,10.1487224,4.694555,0,25.4,0,-25.4
0,10.4243124,5.0147982,0,25.4,0,-25.4
0,10.7230672,5.3135784,0,25.4,0,-25.4
0,11.0433104,5.5891684,0,25.4,0,-25.4
0,11.383264,5.8400696,0,25.4,0,-25.4
0,11.741023,6.0648596,0,25.4,0,-25.4
0,12.1145554,6.2622684,0,25.4,0,-25.4
0,12.5018292,6.4312292,0,25.4,0,-25.4
0,12.9006346,6.5707768,0,25.4,0,-25.4
0,13.3087364,6.6801238,0,25.4,0,-25.4
0,13.723874,6.758686,0,25.4,0,-25.4
0,14.143736,6.8059808,0,25.4,0,-25.4
0,14.5659602,6.8217796,0,25.4,0,-25.4
0,14.988159,6.8059808,0,25.4,0,-25.4
0,15.408021,6.758686,0,25.4,0,-25.4
0,15.8231586,6.6801238,0,25.4,0,-25.4
0,16.2312858,6.5707768,0,25.4,0,-25.4
0,16.6300658,6.4312292,0,25.4,0,-25.4
0,17.0173396,6.2622684,0,25.4,0,-25.4
0,17.390872,6.0648596,0,25.4,0,-25.4
0,17.748631,5.8400696,0,25.4,0,-25.4
0,18.0885846,5.5891684,0,25.4,0,-25.4
0,18.4088278,5.3135784,0,25.4,0,-25.4
0,18.7075826,5.0147982,0,25.4,0,-25.4
0,18.983198,4.694555,0,25.4,0,-25.4
0,19.2340992,4.3546014,0,25.4,0,-25.4
0,19.4588892,3.9968424,0,25.4,0,-25.4
0,19.656298,3.62331,0,25.4,0,-25.4
0,19.8252588,3.2360616,0,25.4,0,-25.4
0,23.5769404,0.2074418,0,25.4,0,-25.4
0,23.8634524,0.5280406,0,25.4,0,-25.4
0,24.1840512,0.8145526,0,25.4,0,-25.4
0,24.5347236,1.0633456,0,25.4,0,-25.4
0,24.9110246,1.2713208,0,25.4,0,-25.4
0,25.3082552,1.435862,0,25.4,0,-25.4
0,25.2128274,2.8558998,0,25.4,0,-25.4
0,24.8269252,2.6592784,0,25.4,0,-25.4
0,24.399113,2.5915112,0,25.4,0,-25.4
0,23.9713262,2.6592784,0,25.4,0,-25.4
0,23.5853986,2.8558998,0,25.4,0,-25.4
0,23.2791508,3.162173,0,25.4,0,-25.4
0,23.082504,3.5481006,0,25.4,0,-25.4
0,23.0147622,3.9758874,0,25.4,0,-25.4
0,23.082504,4.4036742,0,25.4,0,-25.4
0,23.2791508,4.7896018,0,25.4,0,-25.4
0,23.5853986,5.095875,0,25.4,0,-25.4
0,23.9713262,5.2924964,0,25.4,0,-25.4
0,24.399113,5.3602636,0,25.4,0,-25.4
0,24.8269252,5.2924964,0,25.4,0,-25.4
0,25.2128274,5.095875,0,25.4,0,-25.4
0,25.2813566,12.729337,0,25.4,0,-25.4
0,24.8585736,12.6251208,0,25.4,0,-25.4
0,24.423116,12.6251208,0,25.4,0,-25.4
0,24.000333,12.729337,0,25.4,0,-25.4
0,23.614761,12.9316988,0,25.4,0,-25.4
0,23.2888028,13.220446,0,25.4,0,-25.4
0,23.0414576,13.5788146,0,25.4,0,-25.4
0,22.887051,13.9859512,0,25.4,0,-25.4
0,22.8345492,14.4182338,0,25.4,0,-25.4
0,22.887051,14.8505164,0,25.4,0,-25.4
0,23.0414576,15.257653,0,25.4,0,-25.4
0,23.2888028,15.6160216,0,25.4,0,-25.4
0,23.614761,15.9047688,0,25.4,0,-25.4
0,24.000333,16.1071306,0,25.4,0,-25.4
0,24.423116,16.2113468,0,25.4,0,-25.4
0,24.8585736,16.2113468,0,25.4,0,-25.4
0,25.2813566,16.1071306,0,25.4,0,-25.4
0,20.2000104,0.7497064,0,25.4,0,-25.4
0,20.1527156,0.3298444,0,25.4,0,-25.4
0,19.9648064,2.8372562,0,25.4,0,-25.4
0,20.0741534,2.429129,0,25.4,0,-25.4
0,20.1527156,2.0139914,0,25.4,0,-25.4
0,20.2000104,1.5941294,0,25.4,0,-25.4
0,20.2158092,1.1719306,0,25.4,0,-25.4
0,20.0741534,25.3147068,0,25.4,0,-25.4
0,19.9648064,24.906605,0,25.4,0,-25.4
0,19.8252588,24.5077996,0,25.4,0,-25.4
0,19.656298,24.1205512,0,25.4,0,-25.4
0,19.4588892,23.7469934,0,25.4,0,-25.4
0,19.2340992,23.3892344,0,25.4,0,-25.4
0,18.983198,23.0492808,0,25.4,0,-25.4
0,18.7075826,22.7290376,0,25.4,0,-25.4
0,18.4088278,22.4302828,0,25.4,0,-25.4
0,18.0885846,22.1546928,0,25.4,0,-25.4
0,17.748631,21.9037916,0,25.4,0,-25.4
0,17.390872,21.6790016,0,25.4,0,-25.4
0,17.0173396,21.4815674,0,25.4,0,-25.4
0,16.6300658,21.3126066,0,25.4,0,-25.4
0,16.2312858,21.173059,0,25.4,0,-25.4
0,15.8231586,21.063712,0,25.4,0,-25.4
0,15.408021,20.9851752,0,25.4,0,-25.4
0,14.988159,20.937855,0,25.4,0,-25.4
0,14.5659602,20.9220562,0,25.4,0,-25.4
0,14.143736,20.937855,0,25.4,0,-25.4
0,13.723874,20.9851752,0,25.4,0,-25.4
0,13.3087364,21.063712,0,25.4,0,-25.4
0,12.9006346,21.173059,0,25.4,0,-25.4
0,12.5018292,21.3126066,0,25.4,0,-25.4
0,12.1145554,21.4815674,0,25.4,0,-25.4
0,11.741023,21.6790016,0,25.4,0,-25.4
0,11.383264,21.9037916,0,25.4,0,-25.4
0,11.0433104,22.1546928,0,25.4,0,-25.4
0,10.7230672,22.4302828,0,25.4,0,-25.4
0,10.4243124,22.7290376,0,25.4,0,-25.4
0,10.1487224,23.0492808,0,25.4,0,-25.4
0,9.8978212,23.3892344,0,25.4,0,-25.4
0,9.6730312,23.7469934,0,25.4,0,-25.4
0,9.475597,24.1205512,0,25.4,0,-25.4
0,9.3066362,24.5077996,0,25.4,0,-25.4
0,9.1670886,24.906605,0,25.4,0,-25.4
0,9.0577416,25.3147068,0,25.4,0,-25.4
0,4.9846484,22.7875846,0,25.4,0,-25.4
0,4.9126394,22.3637094,0,25.4,0,-25.4
0,4.793615,21.9505276,0,25.4,0,-25.4
0,4.6290738,21.553297,0,25.4,0,-25.4
0,4.4210732,21.176996,0,25.4,0,-25.4
0,4.1722802,20.8263236,0,25.4,0,-25.4
0,3.8857682,20.5057248,0,25.4,0,-25.4
0,3.5651694,20.2192128,0,25.4,0,-25.4
0,3.214497,19.9703944,0,25.4,0,-25.4
0,2.838196,19.7624192,0,25.4,0,-25.4
0,2.44094,19.597878,0,25.4,0,-25.4
0,2.0277836,19.4788536,0,25.4,0,-25.4
0,0.321437,19.4788536,0,25.4,0,-25.4
0,4.4210732,25.2567694,0,25.4,0,-25.4
0,4.6290738,24.880443,0,25.4,0,-25.4
0,4.793615,24.4832124,0,25.4,0,-25.4
0,4.9126394,24.070056,0,25.4,0,-25.4
0,4.9846484,23.6461554,0,25.4,0,-25.4
0,5.008753,23.21687,0,25.4,0,-25.4
0,25.3082552,19.597878,0,25.4,0,-25.4
0,24.9110246,19.7624192,0,25.4,0,-25.4
0,24.5347236,19.9703944,0,25.4,0,-25.4
0,24.1840512,20.2192128,0,25.4,0,-25.4
0,23.8634524,20.5057248,0,25.4,0,-25.4
0,23.5769404,20.8263236,0,25.4,0,-25.4
0,23.3281474,21.176996,0,25.4,0,-25.4
0,23.1201468,21.553297,0,25.4,0,-25.4
0,22.9556056,21.9505276,0,25.4,0,-25.4
0,22.8365812,22.3637094,0,25.4,0,-25.4
0,22.7645722,22.7875846,0,25.4,0,-25.4
0,22.7404422,23.21687,0,25.4,0,-25.4
0,22.7645722,23.6461554,0,25.4,0,-25.4
0,22.8365812,24.070056,0,25.4,0,-25.4
0,22.9556056,24.4832124,0,25.4,0,-25.4
0,23.1201468,24.880443,0,25.4,0,-25.4
0,23.3281474,25.2567694,0,25.4,0,-25.4
`));ie(ee.ParsePatFile(`
*BUBBLES-03,BUBBLES-03
;By John Hyslop,    Using AutoCAD Lisp Tool
;Developed in mm as metric QCAD3 pattern
0,10.1887274,4.1559734,0,25.4,0,-25.4
0,10.0855526,3.6595304,0,25.4,0,-25.4
0,9.9157536,3.181731,0,25.4,0,-25.4
0,9.68248,2.7315414,0,25.4,0,-25.4
0,9.3900752,2.3172928,0,25.4,0,-25.4
0,9.0439748,1.9467068,0,25.4,0,-25.4
0,8.6506558,1.6267176,0,25.4,0,-25.4
0,8.217408,1.3632688,0,25.4,0,-25.4
0,7.752334,1.1612372,0,25.4,0,-25.4
0,7.2640952,1.0244582,0,25.4,0,-25.4
0,6.7617594,0.9553956,0,25.4,0,-25.4
0,6.2546992,0.9553956,0,25.4,0,-25.4
0,5.7523634,1.0244582,0,25.4,0,-25.4
0,5.2641246,1.1612372,0,25.4,0,-25.4
0,4.7990252,1.3632688,0,25.4,0,-25.4
0,4.3658028,1.6267176,0,25.4,0,-25.4
0,3.9724838,1.9467068,0,25.4,0,-25.4
0,3.6263834,2.3172928,0,25.4,0,-25.4
0,3.3339786,2.7315414,0,25.4,0,-25.4
0,3.100705,3.181731,0,25.4,0,-25.4
0,2.9308806,3.6595304,0,25.4,0,-25.4
0,2.8277312,4.1559734,0,25.4,0,-25.4
0,2.7931364,4.6618398,0,25.4,0,-25.4
0,2.8277312,5.1677062,0,25.4,0,-25.4
0,2.9308806,5.6641746,0,25.4,0,-25.4
0,3.100705,6.1419486,0,25.4,0,-25.4
0,3.3339786,6.5921382,0,25.4,0,-25.4
0,3.6263834,7.0063868,0,25.4,0,-25.4
0,3.9724838,7.3769728,0,25.4,0,-25.4
0,4.3658028,7.696962,0,25.4,0,-25.4
0,4.7990252,7.9604362,0,25.4,0,-25.4
0,5.2641246,8.1624424,0,25.4,0,-25.4
0,5.7523634,8.2992468,0,25.4,0,-25.4
0,6.2546992,8.368284,0,25.4,0,-25.4
0,6.7617594,8.368284,0,25.4,0,-25.4
0,7.2640952,8.2992468,0,25.4,0,-25.4
0,7.752334,8.1624424,0,25.4,0,-25.4
0,8.217408,7.9604362,0,25.4,0,-25.4
0,8.6506558,7.696962,0,25.4,0,-25.4
0,9.0439748,7.3769728,0,25.4,0,-25.4
0,9.3900752,7.0063868,0,25.4,0,-25.4
0,9.68248,6.5921382,0,25.4,0,-25.4
0,9.9157536,6.1419486,0,25.4,0,-25.4
0,10.0855526,5.6641746,0,25.4,0,-25.4
0,10.1887274,5.1677062,0,25.4,0,-25.4
0,10.2233222,4.6618398,0,25.4,0,-25.4
0,18.2143908,14.7408138,0,25.4,0,-25.4
0,17.687036,14.9496018,0,25.4,0,-25.4
0,17.1900342,15.222855,0,25.4,0,-25.4
0,16.7311578,15.55623,0,25.4,0,-25.4
0,16.317722,15.9444944,0,25.4,0,-25.4
0,15.9561784,16.3815014,0,25.4,0,-25.4
0,15.6522674,16.860393,0,25.4,0,-25.4
0,15.4107896,17.3736,0,25.4,0,-25.4
0,15.2355042,17.9130198,0,25.4,0,-25.4
0,15.1292306,18.4701434,0,25.4,0,-25.4
0,15.0936198,19.0362078,0,25.4,0,-25.4
0,15.1292306,19.6022722,0,25.4,0,-25.4
0,15.2355042,20.1593958,0,25.4,0,-25.4
0,15.4107896,20.6988156,0,25.4,0,-25.4
0,18.1163722,0.530352,0,25.4,0,-25.4
0,17.4814484,0.5615432,0,25.4,0,-25.4
0,16.8526714,0.654812,0,25.4,0,-25.4
0,16.236061,0.8092694,0,25.4,0,-25.4
0,15.6375354,1.0234168,0,25.4,0,-25.4
0,15.0629112,1.2951968,0,25.4,0,-25.4
0,14.5176748,1.6219932,0,25.4,0,-25.4
0,14.0071094,2.0006564,0,25.4,0,-25.4
0,13.5361172,2.4275542,0,25.4,0,-25.4
0,13.1092194,2.8985464,0,25.4,0,-25.4
0,12.7305562,3.4091372,0,25.4,0,-25.4
0,12.4037598,3.9543482,0,25.4,0,-25.4
0,12.1319798,4.5289978,0,25.4,0,-25.4
0,11.9178324,5.127498,0,25.4,0,-25.4
0,11.763375,5.7441084,0,25.4,0,-25.4
0,11.6701062,6.3729108,0,25.4,0,-25.4
0,11.638915,7.0078092,0,25.4,0,-25.4
0,11.6701062,7.6427076,0,25.4,0,-25.4
0,11.763375,8.2714846,0,25.4,0,-25.4
0,11.9178324,8.8881204,0,25.4,0,-25.4
0,12.1319798,9.4866206,0,25.4,0,-25.4
0,12.4037598,10.0612702,0,25.4,0,-25.4
0,12.7305562,10.6064812,0,25.4,0,-25.4
0,13.1092194,11.117072,0,25.4,0,-25.4
0,13.5361172,11.5880642,0,25.4,0,-25.4
0,14.0071094,12.0149366,0,25.4,0,-25.4
0,14.5176748,12.3936252,0,25.4,0,-25.4
0,15.0629112,12.7204216,0,25.4,0,-25.4
0,15.6375354,12.9922016,0,25.4,0,-25.4
0,16.236061,13.206349,0,25.4,0,-25.4
0,16.8526714,13.3608064,0,25.4,0,-25.4
0,17.4814484,13.4540752,0,25.4,0,-25.4
0,18.1163722,13.4852664,0,25.4,0,-25.4
0,14.3025876,16.7496744,0,25.4,0,-25.4
0,14.1946122,16.0217104,0,25.4,0,-25.4
0,14.0157962,15.3078434,0,25.4,0,-25.4
0,13.7678668,14.6149568,0,25.4,0,-25.4
0,13.453237,13.94968,0,25.4,0,-25.4
0,13.0748786,13.3184646,0,25.4,0,-25.4
0,12.6365,12.7273558,0,25.4,0,-25.4
0,12.1422922,12.1820686,0,25.4,0,-25.4
0,11.597005,11.6878608,0,25.4,0,-25.4
0,11.0058962,11.2494822,0,25.4,0,-25.4
0,10.3746808,10.8711492,0,25.4,0,-25.4
0,9.7094294,10.556494,0,25.4,0,-25.4
0,9.0165174,10.3085646,0,25.4,0,-25.4
0,8.3026504,10.1297486,0,25.4,0,-25.4
0,7.5746864,10.0217732,0,25.4,0,-25.4
0,6.8396612,9.9856544,0,25.4,0,-25.4
0,6.1046106,10.0217732,0,25.4,0,-25.4
0,5.376672,10.1297486,0,25.4,0,-25.4
0,4.662805,10.3085646,0,25.4,0,-25.4
0,3.969893,10.556494,0,25.4,0,-25.4
0,3.3046416,10.8711492,0,25.4,0,-25.4
0,2.6734008,11.2494822,0,25.4,0,-25.4
0,2.0823174,11.6878608,0,25.4,0,-25.4
0,1.5370302,12.1820686,0,25.4,0,-25.4
0,1.0428224,12.7273558,0,25.4,0,-25.4
0,0.6044184,13.3184646,0,25.4,0,-25.4
0,0.2260854,13.94968,0,25.4,0,-25.4
0,13.7678668,20.3544678,0,25.4,0,-25.4
0,14.0157962,19.6615558,0,25.4,0,-25.4
0,14.1946122,18.9476888,0,25.4,0,-25.4
0,14.3025876,18.2197502,0,25.4,0,-25.4
0,14.3387064,17.4846996,0,25.4,0,-25.4
0,25.3114302,14.6149568,0,25.4,0,-25.4
0,25.0635262,15.3078434,0,25.4,0,-25.4
0,24.8847102,16.0217104,0,25.4,0,-25.4
0,24.7767094,16.7496744,0,25.4,0,-25.4
0,24.740616,17.4846996,0,25.4,0,-25.4
0,24.7767094,18.2197502,0,25.4,0,-25.4
0,24.8847102,18.9476888,0,25.4,0,-25.4
0,25.0635262,19.6615558,0,25.4,0,-25.4
0,25.3114302,20.3544678,0,25.4,0,-25.4
0,24.090884,18.4701434,0,25.4,0,-25.4
0,23.984585,17.9130198,0,25.4,0,-25.4
0,23.809325,17.3736,0,25.4,0,-25.4
0,23.5678472,16.860393,0,25.4,0,-25.4
0,23.2639362,16.3815014,0,25.4,0,-25.4
0,22.9023926,15.9444944,0,25.4,0,-25.4
0,22.4889314,15.55623,0,25.4,0,-25.4
0,22.0300804,15.222855,0,25.4,0,-25.4
0,21.5330532,14.9496018,0,25.4,0,-25.4
0,21.0056984,14.7408138,0,25.4,0,-25.4
0,20.4563472,14.5997676,0,25.4,0,-25.4
0,19.8936356,14.528673,0,25.4,0,-25.4
0,19.3264536,14.528673,0,25.4,0,-25.4
0,18.7637674,14.5997676,0,25.4,0,-25.4
0,15.6522674,21.2120226,0,25.4,0,-25.4
0,15.9561784,21.6908888,0,25.4,0,-25.4
0,16.317722,22.1279212,0,25.4,0,-25.4
0,16.7311578,22.5161856,0,25.4,0,-25.4
0,17.1900342,22.8495606,0,25.4,0,-25.4
0,17.687036,23.1227884,0,25.4,0,-25.4
0,18.2143908,23.3315764,0,25.4,0,-25.4
0,18.7637674,23.472648,0,25.4,0,-25.4
0,19.3264536,23.5437172,0,25.4,0,-25.4
0,19.8936356,23.5437172,0,25.4,0,-25.4
0,20.4563472,23.472648,0,25.4,0,-25.4
0,21.0056984,23.3315764,0,25.4,0,-25.4
0,21.5330532,23.1227884,0,25.4,0,-25.4
0,22.0300804,22.8495606,0,25.4,0,-25.4
0,22.4889314,22.5161856,0,25.4,0,-25.4
0,22.9023926,22.1279212,0,25.4,0,-25.4
0,23.2639362,21.6908888,0,25.4,0,-25.4
0,23.5678472,21.2120226,0,25.4,0,-25.4
0,23.809325,20.6988156,0,25.4,0,-25.4
0,23.984585,20.1593958,0,25.4,0,-25.4
0,24.090884,19.6022722,0,25.4,0,-25.4
0,24.1264948,19.0362078,0,25.4,0,-25.4
0,24.5626128,6.3729108,0,25.4,0,-25.4
0,24.469344,5.7441084,0,25.4,0,-25.4
0,24.3148866,5.127498,0,25.4,0,-25.4
0,24.1007392,4.5289978,0,25.4,0,-25.4
0,23.8289592,3.9543482,0,25.4,0,-25.4
0,23.5021628,3.4091372,0,25.4,0,-25.4
0,23.1234996,2.8985464,0,25.4,0,-25.4
0,22.6966018,2.4275542,0,25.4,0,-25.4
0,22.2256096,2.0006564,0,25.4,0,-25.4
0,21.7150442,1.6219932,0,25.4,0,-25.4
0,21.1698078,1.2951968,0,25.4,0,-25.4
0,20.5951836,1.0234168,0,25.4,0,-25.4
0,19.996658,0.8092694,0,25.4,0,-25.4
0,19.3800476,0.654812,0,25.4,0,-25.4
0,18.7512706,0.5615432,0,25.4,0,-25.4
0,18.7512706,13.4540752,0,25.4,0,-25.4
0,19.3800476,13.3608064,0,25.4,0,-25.4
0,19.996658,13.206349,0,25.4,0,-25.4
0,20.5951836,12.9922016,0,25.4,0,-25.4
0,21.1698078,12.7204216,0,25.4,0,-25.4
0,21.7150442,12.3936252,0,25.4,0,-25.4
0,22.2256096,12.0149366,0,25.4,0,-25.4
0,22.6966018,11.5880642,0,25.4,0,-25.4
0,23.1234996,11.117072,0,25.4,0,-25.4
0,23.5021628,10.6064812,0,25.4,0,-25.4
0,23.8289592,10.0612702,0,25.4,0,-25.4
0,24.1007392,9.4866206,0,25.4,0,-25.4
0,24.3148866,8.8881204,0,25.4,0,-25.4
0,24.469344,8.2714846,0,25.4,0,-25.4
0,24.5626128,7.6427076,0,25.4,0,-25.4
0,24.593804,7.0078092,0,25.4,0,-25.4
0,12.6365,22.2420434,0,25.4,0,-25.4
0,13.0748786,21.65096,0,25.4,0,-25.4
0,13.453237,21.0197446,0,25.4,0,-25.4
0,0.2260854,21.0197446,0,25.4,0,-25.4
0,0.6044184,21.65096,0,25.4,0,-25.4
0,1.0428224,22.2420434,0,25.4,0,-25.4
0,1.5370302,22.7873306,0,25.4,0,-25.4
0,2.0823174,23.2815638,0,25.4,0,-25.4
0,2.6734008,23.7199424,0,25.4,0,-25.4
0,3.3046416,24.0982754,0,25.4,0,-25.4
0,3.969893,24.4129306,0,25.4,0,-25.4
0,4.662805,24.66086,0,25.4,0,-25.4
0,5.376672,24.839676,0,25.4,0,-25.4
0,6.1046106,24.9476514,0,25.4,0,-25.4
0,6.8396612,24.9837448,0,25.4,0,-25.4
0,7.5746864,24.9476514,0,25.4,0,-25.4
0,8.3026504,24.839676,0,25.4,0,-25.4
0,9.0165174,24.66086,0,25.4,0,-25.4
0,9.7094294,24.4129306,0,25.4,0,-25.4
0,10.3746808,24.0982754,0,25.4,0,-25.4
0,11.0058962,23.7199424,0,25.4,0,-25.4
0,11.597005,23.2815638,0,25.4,0,-25.4
0,12.1422922,22.7873306,0,25.4,0,-25.4
`));ie(ee.ParsePatFile(`
*CELTIC-01,CELTIC PATTERN 01
;By John Hyslop
;Developed in mm as Metric QCAD3 pattern
135,9.144,10.72444439,17.96051221,17.96051221,2.235085954,-33.68593847
135,10.72444439,9.934222194,17.96051221,17.96051221,6.565564974,-29.35545945
315,9.934222194,14.67555561,17.96051221,17.96051221,2.235085954,-33.68593847
315,7.662333418,16.15722219,17.96051221,17.96051221,6.565564974,-29.35545945
225,19.31811122,10.82322219,17.96051221,17.96051221,2.235085954,-33.68593847
225,21.98511122,12.7,17.96051221,17.96051221,7.124336526,-28.7966879
225,21.68877781,8.452555612,17.96051221,17.96051221,2.235085954,-33.68593847
225,25.146,12.7,17.96051221,17.96051221,9.35942248,-26.56160194
225,19.31811122,18.52788878,17.96051221,17.96051221,2.235085954,-33.68593847
225,21.68877781,16.15722219,17.96051221,17.96051221,2.235085954,-33.68593847
90,25.146,22.91091405,0,25.4,2.235085954,-23.16491405
0,22.91091405,22.35214249,0,25.4,2.235085954,-23.16491405
0,21.33046966,22.91091405,0,25.4,3.815530342,-21.58446966
0,20.40466658,25.146,0,25.4,4.741333418,-20.65866658
90,22.91091405,21.33046966,0,25.4,1.021672836,-24.37832716
90,25.146,20.40466658,0,25.4,1.947475912,-23.45252409
180,2.489085954,25.146,0,25.4,2.235085954,-23.16491405
90,3.047857506,22.91091405,0,25.4,2.235085954,-23.16491405
90,2.489085954,21.33046966,0,25.4,3.815530342,-21.58446966
90,0.254,20.40466658,0,25.4,4.741333418,-20.65866658
180,4.069530342,22.91091405,0,25.4,1.021672836,-24.37832716
180,4.995333418,25.146,0,25.4,1.947475912,-23.45252409
270,0.254,2.489085954,0,25.4,2.235085954,-23.16491405
180,2.489085954,3.047857506,0,25.4,2.235085954,-23.16491405
180,4.069530342,2.489085954,0,25.4,3.815530342,-21.58446966
180,4.995333418,0.254,0,25.4,4.741333418,-20.65866658
270,2.489085954,4.069530342,0,25.4,1.021672836,-24.37832716
270,0.254,4.995333418,0,25.4,1.947475912,-23.45252409
45,17.83644439,13.09511122,17.96051221,17.96051221,10.3372727,-25.58375198
45,13.09511122,7.563555612,17.96051221,17.96051221,2.235085954,-33.68593847
45,10.82322219,6.081888776,17.96051221,17.96051221,6.565564974,-29.35545945
45,4.995333418,0.254,17.96051221,17.96051221,4.889250572,-31.03177385
45,16.256,14.67555561,17.96051221,17.96051221,9.41146962,-26.5095548
45,10.72444439,9.934222194,17.96051221,17.96051221,2.235085954,-33.68593847
45,9.242777806,7.662333418,17.96051221,17.96051221,6.565564974,-29.35545945
45,4.069530342,2.489085954,17.96051221,17.96051221,3.96344775,-31.95757693
45,16.94744439,21.68877781,17.96051221,17.96051221,4.889250572,-31.03177385
45,10.72444439,16.256,17.96051221,17.96051221,2.235085954,-33.68593847
45,3.711222194,9.242777806,17.96051221,17.96051221,2.235085954,-33.68593847
45,9.934222194,14.67555561,17.96051221,17.96051221,6.565564974,-29.35545945
45,0.254,4.995333418,17.96051221,17.96051221,10.3372727,-25.58375198
45,18.52788878,20.10833342,17.96051221,17.96051221,3.96344775,-31.95757693
45,6.081888776,6.872111224,17.96051221,17.96051221,2.235085954,-33.68593847
45,13.09511122,13.88533342,17.96051221,17.96051221,2.235085954,-33.68593847
45,11.51466658,13.09511122,17.96051221,17.96051221,6.565564974,-29.35545945
45,2.489085954,4.069530342,17.96051221,17.96051221,9.41146962,-26.5095548
0,22.91091405,0.254,0,25.4,2.235085954,-23.16491405
135,17.83644439,13.09511122,17.96051221,17.96051221,2.235085954,-33.68593847
135,10.82322219,20.10833342,17.96051221,17.96051221,2.235085954,-33.68593847
135,12.30488878,17.83644439,17.96051221,17.96051221,10.3372727,-25.58375198
135,19.31811122,10.82322219,17.96051221,17.96051221,6.565564974,-29.35545945
135,25.146,4.995333418,17.96051221,17.96051221,4.889250572,-31.03177385
135,8.452555612,17.73766658,17.96051221,17.96051221,2.235085954,-33.68593847
135,10.72444439,16.256,17.96051221,17.96051221,9.41146962,-26.5095548
135,15.46577781,10.72444439,17.96051221,17.96051221,2.235085954,-33.68593847
135,17.73766658,9.242777806,17.96051221,17.96051221,6.565564974,-29.35545945
135,22.91091405,4.069530342,17.96051221,17.96051221,3.96344775,-31.95757693
135,16.15722219,3.711222194,17.96051221,17.96051221,2.235085954,-33.68593847
135,3.711222194,16.94744439,17.96051221,17.96051221,4.889250572,-31.03177385
135,20.40466658,0.254,17.96051221,17.96051221,10.3372727,-25.58375198
135,18.52788878,6.081888776,17.96051221,17.96051221,2.235085954,-33.68593847
135,5.291666582,18.52788878,17.96051221,17.96051221,3.96344775,-31.95757693
135,21.33046966,2.489085954,17.96051221,17.96051221,9.41146962,-26.5095548
270,22.35214249,2.489085954,0,25.4,2.235085954,-23.16491405
270,22.91091405,4.069530342,0,25.4,3.815530342,-21.58446966
270,25.146,4.995333418,0,25.4,4.741333418,-20.65866658
0,21.33046966,2.489085954,0,25.4,1.021672836,-24.37832716
0,20.40466658,0.254,0,25.4,1.947475912,-23.45252409
135,25.146,12.7,17.96051221,17.96051221,4.889250572,-31.03177385
45,12.7,0.254,17.96051221,17.96051221,4.889250572,-31.03177385
315,6.872111224,5.291666582,17.96051221,17.96051221,2.235085954,-33.68593847
315,6.081888776,6.872111224,17.96051221,17.96051221,9.35942248,-26.56160194
315,0.254,12.7,17.96051221,17.96051221,4.889250572,-31.03177385
225,5.291666582,18.52788878,17.96051221,17.96051221,2.235085954,-33.68593847
225,6.872111224,19.31811122,17.96051221,17.96051221,9.35942248,-26.56160194
225,12.7,25.146,17.96051221,17.96051221,4.889250572,-31.03177385
135,18.52788878,20.10833342,17.96051221,17.96051221,2.235085954,-33.68593847
135,19.31811122,18.52788878,17.96051221,17.96051221,9.35942248,-26.56160194
135,21.98511122,12.7,17.96051221,17.96051221,2.654164618,-33.26685981
45,12.7,3.414888776,17.96051221,17.96051221,2.654164618,-33.26685981
315,9.242777806,7.662333418,17.96051221,17.96051221,2.235085954,-33.68593847
315,7.662333418,8.452555612,17.96051221,17.96051221,7.124336526,-28.7966879
315,3.414888776,12.7,17.96051221,17.96051221,2.654164618,-33.26685981
225,7.662333418,16.15722219,17.96051221,17.96051221,2.235085954,-33.68593847
225,8.452555612,17.73766658,17.96051221,17.96051221,7.124336526,-28.7966879
225,12.7,21.98511122,17.96051221,17.96051221,2.654164618,-33.26685981
135,16.15722219,17.73766658,17.96051221,17.96051221,2.235085954,-33.68593847
135,17.73766658,16.94744439,17.96051221,17.96051221,7.124336526,-28.7966879
`));ie(ee.ParsePatFile(`
*CELTIC-02,CELTIC PATTERN 02
;By John Hyslop
;Developed in mm as Metric QCAD3 pattern,,,,,,
180,11.1371634,0.392662664,0,25.4,3.125672946,-22.27432705
270,25.00733734,11.1371634,0,25.4,3.125672946,-22.27432705
270,0.392662664,17.38850955,0,25.4,3.125672946,-22.27432705
180,17.38850955,25.00733734,0,25.4,3.125672946,-22.27432705
90,25.00733734,11.9185817,0,25.4,13.08875564,-12.31124436
270,25.00733734,7.230072408,0,25.4,6.837409744,-18.56259026
180,11.1371634,7.230072408,0,25.4,3.125672946,-22.27432705
180,13.4814183,8.011490454,0,25.4,9.18166439,-16.21833561
0,8.011490454,11.9185817,0,25.4,3.125672946,-22.27432705
0,4.29975391,11.1371634,0,25.4,9.18166439,-16.21833561
270,21.10024609,17.38850955,0,25.4,3.125672946,-22.27432705
270,21.88166439,21.88166439,0,25.4,9.96308269,-15.43691731
270,13.4814183,25.00733734,0,25.4,3.125672946,-22.27432705
270,18.16992759,25.00733734,0,25.4,3.125672946,-22.27432705
90,17.38850955,18.16992759,0,25.4,6.837409744,-18.56259026
90,18.16992759,8.011490454,0,25.4,3.125672946,-22.27432705
90,17.38850955,4.29975391,0,25.4,9.18166439,-16.21833561
90,14.2628366,18.16992759,0,25.4,6.837409744,-18.56259026
90,13.4814183,8.011490454,0,25.4,3.125672946,-22.27432705
90,14.2628366,4.29975391,0,25.4,9.18166439,-16.21833561
90,7.230072408,14.2628366,0,25.4,3.125672946,-22.27432705
90,7.230072408,0.392662664,0,25.4,3.125672946,-22.27432705
90,8.011490454,11.9185817,0,25.4,9.18166439,-16.21833561
90,8.011490454,0.392662664,0,25.4,6.837409744,-18.56259026
90,11.9185817,0.392662664,0,25.4,3.125672946,-22.27432705
90,11.9185817,14.2628366,0,25.4,3.125672946,-22.27432705
90,11.1371634,11.9185817,0,25.4,9.18166439,-16.21833561
90,11.1371634,0.392662664,0,25.4,6.837409744,-18.56259026
180,17.38850955,18.16992759,0,25.4,3.125672946,-22.27432705
180,3.51833561,18.16992759,0,25.4,3.125672946,-22.27432705
180,7.230072408,17.38850955,0,25.4,6.837409744,-18.56259026
180,21.10024609,17.38850955,0,25.4,9.18166439,-16.21833561
180,3.51833561,13.4814183,0,25.4,3.125672946,-22.27432705
180,7.230072408,14.2628366,0,25.4,6.837409744,-18.56259026
180,17.38850955,13.4814183,0,25.4,3.125672946,-22.27432705
180,21.10024609,14.2628366,0,25.4,9.18166439,-16.21833561
180,25.00733734,7.230072408,0,25.4,3.125672946,-22.27432705
180,25.00733734,8.011490454,0,25.4,6.837409744,-18.56259026
180,25.00733734,11.9185817,0,25.4,3.125672946,-22.27432705
180,25.00733734,11.1371634,0,25.4,6.837409744,-18.56259026
180,25.00733734,25.00733734,0,25.4,6.837409744,-18.56259026
0,11.9185817,0.392662664,0,25.4,13.08875564,-12.31124436
0,0.392662664,0.392662664,0,25.4,6.837409744,-18.56259026
270,0.392662664,13.4814183,0,25.4,13.08875564,-12.31124436
270,0.392662664,25.00733734,0,25.4,6.837409744,-18.56259026
180,13.4814183,25.00733734,0,25.4,13.08875564,-12.31124436
180,21.88166439,21.88166439,0,25.4,3.711736544,-21.68826346
90,21.88166439,3.51833561,0,25.4,3.711736544,-21.68826346
0,14.2628366,4.29975391,0,25.4,3.125672946,-22.27432705
0,11.9185817,3.51833561,0,25.4,9.96308269,-15.43691731
0,3.51833561,3.51833561,0,25.4,3.711736544,-21.68826346
270,4.29975391,11.1371634,0,25.4,3.125672946,-22.27432705
270,3.51833561,13.4814183,0,25.4,9.96308269,-15.43691731
270,3.51833561,21.88166439,0,25.4,3.711736544,-21.68826346
180,11.1371634,21.10024609,0,25.4,3.125672946,-22.27432705
180,13.4814183,21.88166439,0,25.4,9.96308269,-15.43691731
`));ie(ee.ParsePatFile(`
*CELTIC-03,CELTIC-03
;By John Hyslop,    Using AutoCAD Lisp Tool
;Developed in inch as imperial QCAD3 pattern
90,6.35,13.97,0,25.4,5.08,-20.32
90,19.05,6.35,0,25.4,5.08,-20.32
0,6.35,6.35,0,25.4,12.7,-12.7
270,6.35,11.43,0,25.4,5.08,-20.32
90,3.81,3.81,0,25.4,7.62,-17.78
180,21.59,3.81,0,25.4,17.78,-7.62
270,21.59,11.43,0,25.4,7.62,-17.78
270,21.59,21.59,0,25.4,7.62,-17.78
0,3.81,21.59,0,25.4,17.78,-7.62
90,3.81,13.97,0,25.4,7.62,-17.78
270,19.05,19.05,0,25.4,5.08,-20.32
0,6.35,19.05,0,25.4,12.7,-12.7
90,13.97,6.35,0,25.4,12.7,-12.7
90,11.43,6.35,0,25.4,12.7,-12.7
270,13.97,3.81,0,25.4,7.62,-17.78
90,11.43,-3.81,0,25.4,7.62,-17.78
180,11.43,11.43,0,25.4,22.86,-2.54
0,-11.43,13.97,0,25.4,22.86,-2.54
`));ie(ee.ParsePatFile(`
*CELTIC-04,CELTIC-04
;By John Hyslop,    Using AutoCAD Lisp Tool
;Developed in mm as metric QCAD3 pattern
45,3.81,13.97,17.960512212,17.960512212,12.57235865,-23.348666028
135,21.59,13.97,17.960512212,17.960512212,12.57235865,-23.348666028
45,12.7,2.54,17.960512212,17.960512212,12.57235865,-23.348666028
315,3.81,11.43,17.960512212,17.960512212,12.57235865,-23.348666028
135,12.7,5.08,17.960512212,17.960512212,8.980256106,-26.940768318
225,19.05,11.43,17.960512212,17.960512212,8.980256106,-26.940768318
315,12.7,20.32,17.960512212,17.960512212,8.980256106,-26.940768318
45,6.35,13.97,17.960512212,17.960512212,8.980256106,-26.940768318
90,13.97,6.35,0,25.4,12.7,-12.7
90,11.43,6.35,0,25.4,12.7,-12.7
270,13.97,3.81,0,25.4,7.62,-17.78
90,11.43,-3.81,0,25.4,7.62,-17.78
180,11.43,11.43,0,25.4,22.86,-2.54
0,-11.43,13.97,0,25.4,22.86,-2.54
`));ie(ee.ParsePatFile(`
*CIRCLES-02,CIRCLES-02
;By John Hyslop
;Developed in mm as Metric QCAD3 pattern
0,24.3609368,11.9663464,0,25.4,0,-25.4
0,24.2918742,11.2356138,0,25.4,0,-25.4
0,24.1770408,10.510647,0,25.4,0,-25.4
0,24.0169192,9.7943162,0,25.4,0,-25.4
0,23.8121444,9.0894408,0,25.4,0,-25.4
0,23.5635038,8.3988402,0,25.4,0,-25.4
0,23.271988,7.7252068,0,25.4,0,-25.4
0,22.9387654,7.0711822,0,25.4,0,-25.4
0,22.5651314,6.439408,0,25.4,0,-25.4
0,22.1525592,5.8323226,0,25.4,0,-25.4
0,21.7026744,5.252339,0,25.4,0,-25.4
0,21.2172804,4.7017432,0,25.4,0,-25.4
0,20.6982568,4.1827196,0,25.4,0,-25.4
0,20.147661,3.6973256,0,25.4,0,-25.4
0,19.5676774,3.2474408,0,25.4,0,-25.4
0,18.960592,2.8348686,0,25.4,0,-25.4
0,18.3288178,2.4612346,0,25.4,0,-25.4
0,17.6747932,2.128012,0,25.4,0,-25.4
0,17.0011598,1.8364962,0,25.4,0,-25.4
0,16.3105592,1.5878556,0,25.4,0,-25.4
0,15.6056838,1.3830808,0,25.4,0,-25.4
0,14.889353,1.2229592,0,25.4,0,-25.4
0,14.1643862,1.1081258,0,25.4,0,-25.4
0,13.4336536,1.0390632,0,25.4,0,-25.4
0,12.7,1.016,0,25.4,0,-25.4
0,11.9663464,1.0390632,0,25.4,0,-25.4
0,11.2356138,1.1081258,0,25.4,0,-25.4
0,10.510647,1.2229592,0,25.4,0,-25.4
0,9.7943162,1.3830808,0,25.4,0,-25.4
0,9.0894408,1.5878556,0,25.4,0,-25.4
0,8.3988402,1.8364962,0,25.4,0,-25.4
0,7.7252068,2.128012,0,25.4,0,-25.4
0,7.0711822,2.4612346,0,25.4,0,-25.4
0,6.439408,2.8348686,0,25.4,0,-25.4
0,5.8323226,3.2474408,0,25.4,0,-25.4
0,5.252339,3.6973256,0,25.4,0,-25.4
0,4.7017432,4.1827196,0,25.4,0,-25.4
0,4.1827196,4.7017432,0,25.4,0,-25.4
0,3.6973256,5.252339,0,25.4,0,-25.4
0,3.2474408,5.8323226,0,25.4,0,-25.4
0,2.8348686,6.439408,0,25.4,0,-25.4
0,2.4612346,7.0711822,0,25.4,0,-25.4
0,2.128012,7.7252068,0,25.4,0,-25.4
0,1.8364962,8.3988402,0,25.4,0,-25.4
0,1.5878556,9.0894408,0,25.4,0,-25.4
0,1.3830808,9.7943162,0,25.4,0,-25.4
0,1.2229592,10.510647,0,25.4,0,-25.4
0,1.1081258,11.2356138,0,25.4,0,-25.4
0,1.0390632,11.9663464,0,25.4,0,-25.4
0,1.016,12.7,0,25.4,0,-25.4
0,1.0390632,13.4336536,0,25.4,0,-25.4
0,1.1081258,14.1643862,0,25.4,0,-25.4
0,1.2229592,14.889353,0,25.4,0,-25.4
0,1.3830808,15.6056838,0,25.4,0,-25.4
0,1.5878556,16.3105592,0,25.4,0,-25.4
0,1.8364962,17.0011598,0,25.4,0,-25.4
0,2.128012,17.6747932,0,25.4,0,-25.4
0,2.4612346,18.3288178,0,25.4,0,-25.4
0,2.8348686,18.960592,0,25.4,0,-25.4
0,3.2474408,19.5676774,0,25.4,0,-25.4
0,3.6973256,20.147661,0,25.4,0,-25.4
0,4.1827196,20.6982568,0,25.4,0,-25.4
0,4.7017432,21.2172804,0,25.4,0,-25.4
0,5.252339,21.7026744,0,25.4,0,-25.4
0,5.8323226,22.1525592,0,25.4,0,-25.4
0,6.439408,22.5651314,0,25.4,0,-25.4
0,7.0711822,22.9387654,0,25.4,0,-25.4
0,7.7252068,23.271988,0,25.4,0,-25.4
0,8.3988402,23.5635038,0,25.4,0,-25.4
0,9.0894408,23.8121444,0,25.4,0,-25.4
0,9.7943162,24.0169192,0,25.4,0,-25.4
0,10.510647,24.1770408,0,25.4,0,-25.4
0,11.2356138,24.2918742,0,25.4,0,-25.4
0,11.9663464,24.3609368,0,25.4,0,-25.4
0,12.7,24.384,0,25.4,0,-25.4
0,13.4336536,24.3609368,0,25.4,0,-25.4
0,14.1643862,24.2918742,0,25.4,0,-25.4
0,14.889353,24.1770408,0,25.4,0,-25.4
0,15.6056838,24.0169192,0,25.4,0,-25.4
0,16.3105592,23.8121444,0,25.4,0,-25.4
0,17.0011598,23.5635038,0,25.4,0,-25.4
0,17.6747932,23.271988,0,25.4,0,-25.4
0,18.3288178,22.9387654,0,25.4,0,-25.4
0,18.960592,22.5651314,0,25.4,0,-25.4
0,19.5676774,22.1525592,0,25.4,0,-25.4
0,20.147661,21.7026744,0,25.4,0,-25.4
0,20.6982568,21.2172804,0,25.4,0,-25.4
0,21.2172804,20.6982568,0,25.4,0,-25.4
0,21.7026744,20.147661,0,25.4,0,-25.4
0,22.1525592,19.5676774,0,25.4,0,-25.4
0,22.5651314,18.960592,0,25.4,0,-25.4
0,22.9387654,18.3288178,0,25.4,0,-25.4
0,23.271988,17.6747932,0,25.4,0,-25.4
0,23.5635038,17.0011598,0,25.4,0,-25.4
0,23.8121444,16.3105592,0,25.4,0,-25.4
0,24.0169192,15.6056838,0,25.4,0,-25.4
0,24.1770408,14.889353,0,25.4,0,-25.4
0,24.2918742,14.1643862,0,25.4,0,-25.4
0,24.3609368,13.4336536,0,25.4,0,-25.4
0,24.384,12.7,0,25.4,0,-25.4
`));ie(ee.ParsePatFile(`
*CIRCLES,CIRCLES
;By John Hyslop
;Developed in mm as Metric QCAD3 pattern
0,23.7384082,10.9516926,0,25.4,0,-25.4
0,23.329011,9.2464382,0,25.4,0,-25.4
0,22.6578922,7.6261976,0,25.4,0,-25.4
0,21.7415618,6.1308996,0,25.4,0,-25.4
0,20.6026258,4.7973742,0,25.4,0,-25.4
0,19.2691004,3.6584382,0,25.4,0,-25.4
0,17.7738024,2.7421078,0,25.4,0,-25.4
0,16.1535618,2.070989,0,25.4,0,-25.4
0,14.4483074,1.6615918,0,25.4,0,-25.4
0,12.7,1.524,0,25.4,0,-25.4
0,10.9516926,1.6615918,0,25.4,0,-25.4
0,9.2464382,2.070989,0,25.4,0,-25.4
0,7.6261976,2.7421078,0,25.4,0,-25.4
0,6.1308996,3.6584382,0,25.4,0,-25.4
0,4.7973742,4.7973742,0,25.4,0,-25.4
0,3.6584382,6.1308996,0,25.4,0,-25.4
0,2.7421078,7.6261976,0,25.4,0,-25.4
0,2.070989,9.2464382,0,25.4,0,-25.4
0,1.6615918,10.9516926,0,25.4,0,-25.4
0,1.524,12.7,0,25.4,0,-25.4
0,1.6615918,14.4483074,0,25.4,0,-25.4
0,2.070989,16.1535618,0,25.4,0,-25.4
0,2.7421078,17.7738024,0,25.4,0,-25.4
0,3.6584382,19.2691004,0,25.4,0,-25.4
0,4.7973742,20.6026258,0,25.4,0,-25.4
0,6.1308996,21.7415618,0,25.4,0,-25.4
0,7.6261976,22.6578922,0,25.4,0,-25.4
0,9.2464382,23.329011,0,25.4,0,-25.4
0,10.9516926,23.7384082,0,25.4,0,-25.4
0,12.7,23.876,0,25.4,0,-25.4
0,14.4483074,23.7384082,0,25.4,0,-25.4
0,16.1535618,23.329011,0,25.4,0,-25.4
0,17.7738024,22.6578922,0,25.4,0,-25.4
0,19.2691004,21.7415618,0,25.4,0,-25.4
0,20.6026258,20.6026258,0,25.4,0,-25.4
0,21.7415618,19.2691004,0,25.4,0,-25.4
0,22.6578922,17.7738024,0,25.4,0,-25.4
0,23.329011,16.1535618,0,25.4,0,-25.4
0,23.7384082,14.4483074,0,25.4,0,-25.4
0,23.876,12.7,0,25.4,0,-25.4
`));ie(ee.ParsePatFile(`
*CLAY,CLAY
0, 0,0, 0,4.7625
0, 0,.79375, 0,4.7625
0, 0,1.5875, 0,4.7625
0, 0,3.175, 0,4.7625, 4.7625,-3.175
`));ie(ee.ParsePatFile(`
*CORK,CORK
0, 0,0, 0,3.175
135, 1.5875,-1.5875, 0,8.98026, 4.49013,-4.49013
135, 2.38125,-1.5875, 0,8.98026, 4.49013,-4.49013
135, 3.175,-1.5875, 0,8.98026, 4.49013,-4.49013
`));ie(ee.ParsePatFile(`
*CROSS,CROSS
0, 0,0, 6.35,6.35, 3.175,-9.525
90, 1.5875,-1.5875, 6.35,6.35, 3.175,-9.525
`));ie(ee.ParsePatFile(`
*DASH,DASH
0, 0,0, 3.175,3.175, 3.175,-3.175
`));ie(ee.ParsePatFile(`
*DOLMIT,DOLMIT
0, 0,0, 0,6.35
45, 0,0, 0,17.9605, 8.98026,-17.9605
`));ie(ee.ParsePatFile(`
*DOTS,DOTS
0, 0,0, .79375,1.5875, 0,-1.5875
`));ie(ee.ParsePatFile(`
*EARTH,EARTH
0, 0,0, 6.35,6.35, 6.35,-6.35
0, 0,2.38125, 6.35,6.35, 6.35,-6.35
0, 0,4.7625, 6.35,6.35, 6.35,-6.35
90, .79375,5.55625, 6.35,6.35, 6.35,-6.35
90, 3.175,5.55625, 6.35,6.35, 6.35,-6.35
90, 5.55625,5.55625, 6.35,6.35, 6.35,-6.35
`));ie(ee.ParsePatFile(`
*ESCHER,ESCHER
60, 0,0, -15.24,26.3965, 27.94,-2.54
180, 0,0, -15.24,26.3965, 27.94,-2.54
300, 0,0, 15.24,26.3965, 27.94,-2.54
60, 2.54,0, -15.24,26.3965, 5.08,-25.4
300, 2.54,0, 15.24,26.3965, 5.08,-25.4
60, -1.27,2.1997, -15.24,26.3965, 5.08,-25.4
180, -1.27,2.1997, -15.24,26.3965, 5.08,-25.4
300, -1.27,-2.1997, 15.24,26.3965, 5.08,-25.4
180, -1.27,-2.1997, -15.24,26.3965, 5.08,-25.4
60, -10.16,0, -15.24,26.3965, 5.08,-25.4
300, -10.16,0, 15.24,26.3965, 5.08,-25.4
60, 5.08,-8.79882, -15.24,26.3965, 5.08,-25.4
180, 5.08,-8.79882, -15.24,26.3965, 5.08,-25.4
300, 5.08,8.79882, 15.24,26.3965, 5.08,-25.4
180, 5.08,8.79882, -15.24,26.3965, 5.08,-25.4
0, 5.08,4.39941, -15.24,26.3965, 17.78,-12.7
0, 5.08,-4.39941, -15.24,26.3965, 17.78,-12.7
120, 1.27,6.59911, 15.24,26.3965, 17.78,-12.7
120, -6.35,2.1997, 15.24,26.3965, 17.78,-12.7
240, -6.35,-2.1997, 15.24,26.3965, 17.78,-12.7
240, 1.27,-6.59911, 15.24,26.3965, 17.78,-12.7
`));ie(ee.ParsePatFile(`
*EXPLOSION,EXPLOSION
;By John Hyslop
;Developed in mm as Metric QCAD3 pattern
270,11.43,2.794,0,25.4,2.794,-22.606
143.130102,12.446,2.032,91.44,5.08,1.27,-125.73
270,12.446,4.318,0,25.4,2.286,-23.114
112.380135,14.224,0,330.1971097,1.381577882,4.669733104,-462.3035852
75.256437,12.954,20.574,104.7189028,1.292825964,4.990308282,-494.0405126
287.525568,11.43,25.4,80.31173574,1.274789424,5.060914186,-501.0305006
135,1.524,12.446,17.96051221,17.96051221,2.155261374,-33.76576305
26.565051,0,11.684,34.07767607,11.35922544,1.703883816,-55.09224288
353.884496,18.288,12.446,485.2654803,0.901980416,7.152705024,-708.1177892
192.094757,25.4,13.97,234.1697095,1.774012962,7.273453068,-356.3992019
3.691386,17.526,9.652,381.8448525,0.817654956,7.890370046,-781.1466379
136.080924,24.384,3.048,916.1619403,0.677634662,9.52076582,-942.5558068
336.037511,22.098,4.064,193.4234445,2.578979348,2.501609932,-247.6593782
123.690068,24.638,0.254,35.22346245,7.04469254,4.579050024,-87.00195223
324.462322,15.748,6.604,91.53339072,2.952690056,10.924953,-207.5741086
117.645975,18.542,1.27,545.3600756,1.07143423,6.021460906,-596.1246343
326.309932,13.97,4.318,56.35753981,7.04469254,5.494860232,-86.08614228
106.38954,15.24,0,265.1799113,1.433404804,4.50089143,-445.5882554
153.434949,3.048,8.636,22.71845063,11.35922544,3.407767632,-53.38835906
64.798876,1.016,4.318,420.4426387,1.351905602,4.772226676,-472.4504468
202.619865,4.064,5.588,193.4307693,1.953846232,3.302,-326.898
59.036243,2.54,3.048,56.62883289,4.356064186,2.962123616,-145.1440546
211.75948,7.874,6.35,239.620914,1.028416028,6.273337212,-621.0603858
79.215702,6.858,1.016,413.4803361,1.188161962,5.429899732,-537.5600816
212.471192,9.652,2.794,91.56028043,1.9480911,3.31175487,-327.8637273
63.434949,8.89,1.27,22.71845063,11.35922544,1.703883816,-55.09224288
135,10.16,0,17.96051221,17.96051221,1.796051272,-34.12497315
74.357754,8.382,19.05,474.5101503,0.978371424,6.59422354,-652.8281297
333.434949,0.762,22.86,22.71845063,11.35922544,8.51941908,-48.27670761
110.556045,4.572,12.7,136.7508764,2.97284521,10.85088483,-206.1668104
330.945396,0,15.24,56.74251999,2.467066186,5.23018004,-256.2788255
99.462322,16.002,20.828,129.4477627,4.175734346,4.635065152,-149.8671031
222.70939,19.304,23.876,35.89232217,1.435692836,4.493718724,-444.8781539
74.744881,18.542,21.082,104.7031863,2.22772732,2.896045516,-286.7085124
208.61046,24.13,24.13,261.5011486,2.027140726,6.365221712,-311.8958659
62.744672,19.812,15.748,56.79200478,0.684240948,9.428841188,-933.4552873
212.275644,24.638,18.796,331.1735533,1.130285268,5.70794007,-565.0860682
55.00798,22.86,16.256,91.55735943,2.080849026,3.100465224,-306.9460475
158.198591,25.4,15.24,80.18324705,4.716661636,2.73566382,-134.0475224
51.911227,14.986,12.954,741.8363621,0.540303212,11.9407018,-1182.12948
153.434949,16.51,12.192,22.71845063,11.35922544,1.703883816,-55.09224288
35.537678,14.732,10.922,126.9656711,2.952690056,2.18499055,-216.3140711
129.289407,19.304,5.334,198.3722919,1.78713765,7.220036614,-353.7817918
322.30576,13.716,9.652,416.5899728,0.9135745,7.061931012,-699.1311588
77.905243,12.954,6.096,129.5029455,1.774012962,3.636726534,-360.0359284
282.994617,12.192,9.398,104.709577,1.903810518,3.388782656,-335.4894845
62.525568,8.89,3.048,56.78897304,0.901412218,7.157213524,-708.564129
267.137595,9.144,8.128,25.36830944,1.268415548,5.086345936,-503.5482576
12.994617,2.54,6.604,104.709577,1.903810518,6.777565312,-332.1007018
211.75948,7.874,9.906,239.620914,1.028416028,6.273337212,-621.0603858
318.366461,5.588,11.938,269.9974641,2.109355192,3.05856513,-302.7979372
189.462322,7.112,12.192,129.4477627,4.175734346,1.545021802,-152.9571465
297.299572,3.048,20.066,829.3009284,0.728095572,8.860923858,-877.231464
132.273689,8.128,14.478,35.8803669,1.708588912,7.551962798,-370.0461832
282.994617,7.366,17.78,104.709577,1.903810518,3.388782656,-335.4894845
140.194429,10.414,15.24,162.6068376,3.252136752,3.967606746,-194.4127349
268.363423,10.668,24.13,25.38963909,0.725418158,8.893627882,-880.4691552
102.200469,12.7,14.732,597.8446202,0.67098164,9.615166444,-951.9014896
250.016893,14.732,20.32,80.29253258,2.170068558,5.9459876,-291.3533901
84.559668,14.224,14.986,280.549586,1.20407557,5.358135842,-530.4554512
222.184443,22.352,22.352,377.597688,0.588158336,10.96915408,-1085.946248
`));ie(ee.ParsePatFile(`
*FLEX,FLEX
0, 0,0, 0,6.35, 6.35,-6.35
45, 6.35,0, 4.49013,4.49013, 1.5875,-5.80526,1.5875,-8.98026
`));ie(ee.ParsePatFile(`
*GRASS,GRASS
90, 0,0, 17.9605,17.9605, 4.7625,-31.1585
45, 0,0, 0,25.4, 4.7625,-20.6375
135, 0,0, 0,25.4, 4.7625,-20.6375
`));ie(ee.ParsePatFile(`
*GRATE,GRATE
0, 0,0, 0,.79375
90, 0,0, 0,3.175
`));ie(ee.ParsePatFile(`
*GRAVEL-01,GRAVEL-01
;Optimize to replace existing GRAVEL Pattern
;By John Hyslop,    Using AutoCAD Lisp Tool
;Developed in mm as metric QCAD3 pattern
159.443955,4.064,3.302,80.266818638,2.97284521,4.340353778,-212.677341218
114.775141,5.588,0,56.76841453,1.774012962,3.636726534,-360.03592839
249.443955,8.128,2.032,80.266818638,2.97284521,2.170177016,-214.847518234
186.009006,12.954,2.54,230.002940044,1.329496706,4.852663142,-480.413655376
165.963757,18.034,1.27,24.6416195,6.160405002,5.236344112,-99.490538636
101.309932,18.288,0,104.608346536,4.981349956,1.29515108,-128.219944728
243.434949,21.336,3.556,22.718450626,11.35922544,3.975728904,-52.820397788
355.426079,12.446,3.302,331.173933536,1.012764294,6.370287488,-630.658471472
300.256437,10.668,6.35,148.094892532,1.828332132,3.528680776,-349.33939657
228.012788,15.24,11.43,305.850675318,1.887967014,6.834440992,-334.887609878
180,21.844,11.43,0,25.4,6.604,-18.796
303.690068,15.748,15.748,35.223462446,7.04469254,3.66324007,-87.917762188
225,18.288,18.288,17.960512212,17.960512212,3.592102544,-32.328922134
110.224859,2.032,5.842,217.014069654,1.254416592,5.143108078,-509.167692864
177.273689,7.366,5.588,25.371250756,1.20815481,5.340044184,-528.664375232
217.69424,12.954,9.906,289.603117008,0.9135745,7.061931012,-699.131158758
252.255328,14.986,16.256,586.403737782,0.967663038,6.667197486,-660.05256356
301.429566,12.192,20.828,387.712303314,1.20407557,5.358135842,-530.455451152
355.236358,6.096,21.336,25.312262304,2.109355192,6.117130006,-299.739372326
43.66778,0.508,16.002,35.911314766,0.83514692,7.725108502,-764.785732808
87.273689,0.254,10.668,25.371250756,1.20815481,5.340044184,-528.664375232
30.963757,15.748,18.034,91.477345366,4.356064186,4.443185424,-143.662992836
291.801409,14.732,20.574,56.599939124,4.716661636,2.73566382,-134.047522354
203.198591,16.51,21.336,56.698117744,3.335183322,1.934406342,-191.506230398
161.565051,19.558,20.32,24.09655582,8.032185358,3.212874194,-77.10897837
4.969741,10.16,22.352,280.550012686,1.100196174,5.864045422,-580.540490682
16.38954,0,20.574,265.179911346,1.433404804,4.50089143,-445.58825538
197.354025,25.4,4.826,80.307559222,1.515237,4.25781597,-421.523771378
74.054604,24.13,5.588,104.668749768,3.488958224,3.69829588,-181.216495326
27.645975,18.796,2.794,545.360075648,1.07143423,6.021460906,-596.124634266
145.304846,25.146,9.144,91.566911862,1.60643697,4.016092552,-397.593170268
353.157227,17.78,12.7,434.77679618,1.008762778,6.395556678,-633.160101724
171.469234,23.368,17.526,179.600730968,1.255949228,5.136831992,-508.546377622
138.814075,25.4,15.748,234.164238554,2.389431086,2.700057084,-267.30564649
90,25.4,14.224,0,25.4,1.524,-23.876
60.945396,24.13,11.938,56.742519992,2.467066186,2.61509002,-258.893915536
343.61046,21.082,21.844,184.909235464,1.433404804,4.50089143,-445.58825538
293.198591,19.558,25.4,56.698117744,3.335183322,3.868812684,-189.571824056
48.012788,16.002,22.86,305.850675318,1.887967014,3.417220496,-338.304830374
312.510447,7.366,25.4,35.887120758,1.560309554,4.134820534,-409.347222706
70.346176,4.318,21.844,80.303678102,1.708588912,3.775981526,-373.822164724
`));ie(ee.ParsePatFile(`
*GRAVEL,GRAVEL
228.0128, 18.288,25.4, 305.851,1.88796, 3.41721,-338.305
184.9697, 16.002,22.86, -305.855,1.1002, 5.86405,-580.54
132.5104, 10.16,22.352, -377.595,1.56032, 4.13482,-409.347
267.2737, .254,16.002, -508.633,1.20815, 5.34005,-528.664
292.8337, 0,10.668, -330.198,1.23208, 5.23634,-518.398
357.2737, 2.032,5.842, -508.633,1.20815, 5.34005,-528.664
37.6942, 7.366,5.588, -416.59,.913587, 7.06194,-699.131
72.2553, 12.954,9.906, 586.404,.967664, 6.6672,-660.053
121.4296, 14.986,16.256, 387.712,1.20409, 5.35813,-530.455
175.2364, 12.192,20.828, -280.544,2.10934, 6.11713,-299.739
222.3974, 6.096,21.336, 413.481,.815543, 7.91078,-783.168
138.8141, 25.4,15.748, 234.164,2.38943, 2.70005,-267.306
171.4692, 23.368,17.526, -334.082,1.25595, 5.13682,-508.546
225, 18.288,18.288, 17.9605,17.9605, 3.59209,-32.3289
203.1986, 16.51,21.336, -136.743,3.33517, 1.93441,-191.506
291.8014, 14.732,20.574, -80.1833,4.71665, 2.73566,-134.048
30.9638, 15.748,18.034, 91.4773,4.35607, 4.4432,-143.663
161.5651, 19.558,20.32, -56.2253,8.03219, 3.21287,-77.109
16.3895, 0,20.574, 265.18,1.4334, 4.50088,-445.588
70.3462, 4.318,21.844, -297.294,1.70858, 3.77599,-373.822
293.1986, 19.558,25.4, -136.743,3.33517, 3.8688,-189.572
343.6105, 21.082,21.844, -265.18,1.4334, 4.50088,-445.588
339.444, 0,4.826, -136.751,2.97284, 4.34035,-212.677
294.7751, 4.064,3.302, -306.904,1.77401, 3.63672,-360.036
66.8014, 19.812,0, 136.743,3.33517, 3.8688,-189.572
17.354, 21.336,3.556, -345.474,1.51524, 4.25783,-421.524
69.444, 7.366,0, -136.751,2.97284, 2.17018,-214.848
101.3099, 18.288,0, 104.608,4.98135, 1.29515,-128.22
165.9638, 18.034,1.27, -80.0853,6.16041, 5.23634,-99.4905
186.009, 12.954,2.54, -255.263,1.32949, 4.85267,-480.414
303.6901, 15.748,15.748, -56.3575,7.04469, 3.66324,-87.9178
353.1572, 17.78,12.7, 434.777,1.00876, 6.39557,-633.16
60.9454, 24.13,11.938, -204.766,2.46708, 2.61508,-258.894
90, 25.4,14.224, 25.4,25.4, 1.524,-23.876
120.2564, 12.446,3.302, -204.773,1.82834, 3.52867,-349.339
48.0128, 10.668,6.35, 305.851,1.88796, 6.83443,-334.888
0, 15.24,11.43, 25.4,25.4, 6.604,-18.796
325.3048, 21.844,11.43, -310.042,1.60645, 4.0161,-397.593
254.0546, 25.146,9.144, 104.669,3.48897, 3.69829,-181.217
207.646, 24.13,5.588, 545.36,1.07142, 6.02145,-596.125
175.4261, 18.796,2.794, 331.174,1.01277, 6.37029,-630.658
175.4261, 18.796,2.794, 331.174,1.01277, 6.37029,-630.658
`));ie(ee.ParsePatFile(`
*HATCH-DOTS
;By John Hyslop,    Tile2Hatch tool \xA9 CVH 2020
;Developed in mm as metric QCAD3 pattern
225,14.364914374,2.934914374,17.960512212,17.960512212,11.492295278,-24.428729146
225,6.359242552,5.089242552,17.960512212,17.960512212,16.19060262,-19.730421804
225,3.281299762,9.631299762,17.960512212,17.960512212,18.261173282,-17.659851142
225,19.161365538,5.191365538,17.960512212,17.960512212,11.492295278,-24.428729146
225,7.864421914,4.054421914,17.960512212,17.960512212,16.85579052,-19.065234158
225,2.841461932,11.731461932,17.960512212,17.960512212,20.609227006,-15.311797418
225,9.631299762,3.281299762,17.960512212,17.960512212,18.261173282,-17.659851142
225,2.934914374,14.364914374,17.960512212,17.960512212,11.492295278,-24.428729146
225,5.089242552,6.359242552,17.960512212,17.960512212,16.19060262,-19.730421804
225,11.731462186,2.841462186,17.960512212,17.960512212,20.60922726,-15.311797164
225,5.191365538,19.161365538,17.960512212,17.960512212,11.492295278,-24.428729146
225,4.054421914,7.864421914,17.960512212,17.960512212,16.85579052,-19.065234158
`));ie(ee.ParsePatFile(`
*HATCH-SQRS
;By John Hyslop,    Tile2Hatch tool \xA9 CVH 2020
;Developed in mm as metric QCAD3 pattern
225,2.794,9.144,17.960512212,17.960512212,7.902625292,-28.018399132
225,2.794,21.844,17.960512212,17.960512212,7.902625292,-28.018399132
225,2.794,6.604,17.960512212,17.960512212,13.290779108,-22.630245316
225,19.304,2.794,17.960512212,17.960512212,7.902625292,-28.018399132
225,2.794,14.224,17.960512212,17.960512212,7.902625292,-28.018399132
225,2.794,11.684,17.960512212,17.960512212,7.902625292,-28.018399132
225,6.604,2.794,17.960512212,17.960512212,13.290779108,-22.630245316
225,2.794,19.304,17.960512212,17.960512212,7.902625292,-28.018399132
225,2.794,4.064,17.960512212,17.960512212,9.698676564,-26.22234786
225,4.064,2.794,17.960512212,17.960512212,9.698676564,-26.22234786
225,11.684,2.794,17.960512212,17.960512212,7.902625292,-28.018399132
225,14.224,2.794,17.960512212,17.960512212,7.902625292,-28.018399132
225,9.144,2.794,17.960512212,17.960512212,7.902625292,-28.018399132
225,21.844,2.794,17.960512212,17.960512212,7.902625292,-28.018399132
225,2.794,16.764,17.960512212,17.960512212,7.902625292,-28.018399132
225,16.764,2.794,17.960512212,17.960512212,7.902625292,-28.018399132
`));ie(ee.ParsePatFile(`
*HEX,HEX
0, 0,0, 0,5.49926, 3.175,-6.35
120, 0,0, 0,5.49926, 3.175,-6.35
60, 3.175,0, 0,5.49926, 3.175,-6.35
`));ie(ee.ParsePatFile(`
*HEXAGONS
;By John Hyslop,    Tile2Hatch tool \xA9 CVH 2020
;Developed in mm as metric QCAD3 pattern
239.931417,5.587999746,25.399999492,204.778078632,1.15693825,5.576441984,-552.067817376
239.931417,22.606,4.826,204.778078632,1.15693825,5.576441984,-552.067817376
300.068583,19.812000254,25.399999492,352.866180728,1.15693825,5.576441984,-552.067817376
60.068488,3.048,12.7,204.780260492,0.667036766,9.672031964,-957.531152498
119.931512,7.874,4.318,762.42292397,0.667036766,9.67203171,-957.531152498
300.068583,2.794,4.826,352.866180728,1.15693825,5.576441984,-552.067817376
180,2.794,4.826,0,25.4,5.587998984,-19.812001016
299.931512,17.526,21.082,762.42292397,0.667036766,9.67203171,-957.531152498
0,7.874,21.082,0,25.4,9.652,-15.748
180,17.526,4.318,0,25.4,9.652,-15.748
240.068488,22.352,12.7,204.780260492,0.667036766,9.672031964,-957.531152498
180,2.794,20.574,0,25.4,5.587998984,-19.812001016
`));ie(ee.ParsePatFile(`
*HEXJOIN-01
;By John Hyslop,    Tile2Hatch tool \xA9 CVH 2020
;Developed in mm as metric QCAD3 pattern
45,3.81,16.51,17.960512212,17.960512212,7.184204834,-28.73681959
270,21.59,16.51,25.4,25.4,7.62,-17.78
315,16.51,21.59,17.960512212,17.960512212,7.184204834,-28.73681959
180,16.51,3.81,0,25.4,7.62,-17.78
270,13.97,3.81,25.4,25.4,7.62,-17.78
90,3.81,8.89,25.4,25.4,7.62,-17.78
135,8.89,3.81,17.960512212,17.960512212,7.184204834,-28.73681959
180,3.81,13.97,0,25.4,7.62,-17.78
270,11.43,3.81,25.4,25.4,7.62,-17.78
180,3.81,11.43,0,25.4,7.62,-17.78
225,21.59,8.89,17.960512212,17.960512212,7.184204834,-28.73681959
0,8.89,21.59,0,25.4,7.62,-17.78
`));ie(ee.ParsePatFile(`
*HEXJOIN-02
;By John Hyslop,    Tile2Hatch tool \xA9 CVH 2020
;Developed in mm as metric QCAD3 pattern
270,21.59,11.43,25.4,25.4,2.54,-22.86
315,16.51,21.59,17.960512212,17.960512212,7.184204834,-28.73681959
270,13.97,3.81,25.4,25.4,7.62,-17.78
180,3.81,13.97,0,25.4,7.62,-17.78
180,16.51,3.81,0,25.4,2.54,-22.86
45,3.81,16.51,17.960512212,17.960512212,7.184204834,-28.73681959
90,3.81,13.97,25.4,25.4,2.54,-22.86
180,3.81,11.43,0,25.4,7.62,-17.78
180,11.43,3.81,0,25.4,2.54,-22.86
270,11.43,3.81,25.4,25.4,7.62,-17.78
90,3.81,8.89,25.4,25.4,2.54,-22.86
0,13.97,21.59,0,25.4,2.54,-22.86
135,8.89,3.81,17.960512212,17.960512212,7.184204834,-28.73681959
0,8.89,21.59,0,25.4,2.54,-22.86
225,21.59,8.89,17.960512212,17.960512212,7.184204834,-28.73681959
270,21.59,16.51,25.4,25.4,2.54,-22.86
`));ie(ee.ParsePatFile(`
*HOLLY,HOLLY
;By John Hyslop
;Developed in mm as Metric QCAD3 pattern
99.462322,20.32,2.794,129.4477627,4.175734346,1.545021802,-152.9571465
74.744881,17.018,2.032,104.7031863,2.22772732,2.896045516,-286.7085124
68.198591,13.462,3.81,80.18324705,4.716661636,2.73566382,-134.0475224
270,14.732,9.398,0,25.4,1.778,-23.622
248.198591,19.05,8.89,80.18324705,4.716661636,2.73566382,-134.0475224
45,20.32,5.08,17.96051221,17.96051221,2.155261374,-33.76576305
351.869898,22.86,3.302,25.14471705,3.592102544,1.796051272,-177.8090711
0,21.844,3.302,0,25.4,1.016,-24.384
26.565051,20.828,2.794,34.07767607,11.35922544,1.135922544,-55.66020415
45,20.32,2.286,17.96051221,17.96051221,0.718420458,-35.20260397
341.565051,19.558,2.54,24.09655582,8.032185358,0.803218612,-79.51863395
0,18.542,2.54,0,25.4,1.016,-24.384
26.565051,18.034,2.286,34.07767607,11.35922544,0.567961272,-56.22816542
26.565051,17.526,2.032,34.07767607,11.35922544,0.567961272,-56.22816542
53.130102,16.764,1.016,91.44,5.08,1.27,-125.73
270,16.764,2.032,0,25.4,1.016,-24.384
303.690068,16.256,2.794,35.22346245,7.04469254,0.915809954,-90.6651923
315,15.748,3.302,17.96051221,17.96051221,0.718420458,-35.20260397
345.963757,14.732,3.556,24.6416195,6.160405002,1.047268924,-103.6796141
0,13.716,3.556,0,25.4,1.016,-24.384
33.690068,12.954,3.048,35.22346245,7.04469254,0.915809954,-90.6651923
255.963757,13.208,4.064,24.6416195,6.160405002,1.047268924,-103.6796141
281.309932,12.954,5.334,104.6083465,4.981349956,1.29515108,-128.2199447
284.036243,12.7,6.35,80.0852635,6.160405002,1.047268924,-103.6796141
296.565051,12.192,7.366,34.07767607,11.35922544,1.135922544,-55.66020415
303.690068,11.684,8.128,35.22346245,7.04469254,0.915809954,-90.6651923
180,12.7,8.128,0,25.4,1.016,-24.384
180,13.462,8.128,0,25.4,0.762,-24.638
213.690068,14.224,8.636,35.22346245,7.04469254,0.915809954,-90.6651923
243.434949,14.478,9.144,22.71845063,11.35922544,0.567961272,-56.22816542
251.565051,14.732,9.906,24.09655582,8.032185358,0.803218612,-79.51863395
108.434949,14.986,9.144,56.22529674,8.032185358,0.803218612,-79.51863395
135,15.494,8.636,17.96051221,17.96051221,0.718420458,-35.20260397
153.434949,16.002,8.382,22.71845063,11.35922544,0.567961272,-56.22816542
161.565051,16.764,8.128,24.09655582,8.032185358,0.803218612,-79.51863395
180,17.526,8.128,0,25.4,0.762,-24.638
198.434949,18.288,8.382,56.22529674,8.032185358,0.803218612,-79.51863395
225,18.796,8.89,17.96051221,17.96051221,0.718420458,-35.20260397
251.565051,19.05,9.652,24.09655582,8.032185358,0.803218612,-79.51863395
108.434949,19.304,8.89,56.22529674,8.032185358,0.803218612,-79.51863395
116.565051,19.812,7.874,34.07767607,11.35922544,1.135922544,-55.66020415
135,20.574,7.112,17.96051221,17.96051221,1.077630814,-34.84339386
161.565051,21.336,6.858,24.09655582,8.032185358,0.803218612,-79.51863395
180,22.098,6.858,0,25.4,0.762,-24.638
90,22.098,6.096,0,25.4,0.762,-24.638
111.801409,22.606,4.826,56.59993912,4.716661636,1.36783191,-135.4153543
126.869898,23.368,3.81,35.56,5.08,1.27,-125.73
149.036243,24.638,3.048,56.62883289,4.356064186,1.481061808,-146.6251165
338.587031,11.684,8.128,627.3335515,0.463661252,13.91447154,-1377.532674
338.198591,20.32,17.526,80.18324705,4.716661636,1.36783191,-135.4153543
323.972627,18.034,15.748,218.4910814,1.867445084,3.454773634,-342.0225773
315,15.24,13.462,17.96051221,17.96051221,2.873681832,-33.04734259
135,14.732,13.97,17.96051221,17.96051221,1.796051272,-34.12497315
126.869898,17.272,16.51,35.56,5.08,2.54,-124.46
105.945396,19.558,18.288,80.24604144,3.488958224,1.84914794,-183.0656433
30.963757,22.098,20.32,91.47734537,4.356064186,1.481061808,-146.6251165
14.036243,21.082,20.066,80.0852635,6.160405002,1.047268924,-103.6796141
0,20.32,20.066,0,25.4,0.762,-24.638
341.565051,19.558,20.32,24.09655582,8.032185358,0.803218612,-79.51863395
333.434949,19.05,20.574,22.71845063,11.35922544,0.567961272,-56.22816542
63.434949,18.796,20.066,22.71845063,11.35922544,0.567961272,-56.22816542
45,18.288,19.558,17.96051221,17.96051221,0.718420458,-35.20260397
33.690068,17.526,19.05,35.22346245,7.04469254,0.915809954,-90.6651923
18.434949,16.764,18.796,56.22529674,8.032185358,0.803218612,-79.51863395
0,16.002,18.796,0,25.4,0.762,-24.638
341.565051,15.24,19.05,24.09655582,8.032185358,0.803218612,-79.51863395
108.434949,15.494,18.288,56.22529674,8.032185358,0.803218612,-79.51863395
90,15.494,17.526,0,25.4,0.762,-24.638
75.963757,15.24,16.51,24.6416195,6.160405002,1.047268924,-103.6796141
45,14.478,15.748,17.96051221,17.96051221,1.077630814,-34.84339386
14.036243,13.462,15.494,80.0852635,6.160405002,1.047268924,-103.6796141
0,12.7,15.494,0,25.4,0.762,-24.638
126.869898,13.462,14.478,35.56,5.08,1.27,-125.73
90,13.462,13.716,0,25.4,0.762,-24.638
75.963757,13.208,12.7,24.6416195,6.160405002,1.047268924,-103.6796141
56.309932,12.7,11.938,56.35753981,7.04469254,0.915809954,-90.6651923
191.309932,13.97,12.192,104.6083465,4.981349956,1.29515108,-128.2199447
168.690068,15.24,11.938,24.90674927,4.981349956,1.29515108,-128.2199447
161.565051,16.764,11.43,24.09655582,8.032185358,1.60643697,-78.71541559
143.130102,17.78,10.668,91.44,5.08,1.27,-125.73
270,17.78,10.922,0,25.4,0.254,-25.146
270,17.78,11.684,0,25.4,0.762,-24.638
243.434949,18.288,12.7,22.71845063,11.35922544,1.135922544,-55.66020415
213.690068,19.05,13.208,35.22346245,7.04469254,0.915809954,-90.6651923
198.434949,19.812,13.462,56.22529674,8.032185358,0.803218612,-79.51863395
180,20.828,13.462,0,25.4,1.016,-24.384
146.309932,21.59,12.954,56.35753981,7.04469254,0.915809954,-90.6651923
303.690068,21.082,13.716,35.22346245,7.04469254,0.915809954,-90.6651923
270,21.082,14.478,0,25.4,0.762,-24.638
270,21.082,15.494,0,25.4,1.016,-24.384
243.434949,21.59,16.51,22.71845063,11.35922544,1.135922544,-55.66020415
225,22.098,17.018,17.96051221,17.96051221,0.718420458,-35.20260397
296.565051,21.844,17.526,34.07767607,11.35922544,0.567961272,-56.22816542
270,21.844,18.034,0,25.4,0.508,-24.892
255.963757,22.098,19.05,24.6416195,6.160405002,1.047268924,-103.6796141
243.434949,22.606,20.066,22.71845063,11.35922544,1.135922544,-55.66020415
233.130102,23.368,21.082,91.44,5.08,1.27,-125.73
40.601295,12.7,11.938,35.81521869,2.755016842,14.05058582,-220.1258435
195.945396,6.604,13.716,80.24604144,3.488958224,1.84914794,-183.0656433
5.194429,7.366,13.97,255.2564824,2.29960805,2.805521694,-277.7466482
19.983107,7.112,17.272,217.0068451,2.170068558,2.9729938,-294.3263839
185.710593,5.842,17.272,229.9928961,2.527394488,2.552668504,-252.7141722
164.054604,5.588,20.066,104.6687498,3.488958224,1.84914794,-183.0656433
45,6.858,20.066,17.96051221,17.96051221,1.436840916,-34.48418351
90,5.334,23.368,0,25.4,1.016,-24.384
75.963757,5.08,22.352,24.6416195,6.160405002,1.047268924,-103.6796141
243.434949,7.874,11.938,22.71845063,11.35922544,1.135922544,-55.66020415
236.309932,8.382,12.7,56.35753981,7.04469254,0.915809954,-90.6651923
225,9.144,13.462,17.96051221,17.96051221,1.077630814,-34.84339386
213.690068,9.906,13.97,35.22346245,7.04469254,0.915809954,-90.6651923
189.462322,11.43,14.224,129.4477627,4.175734346,1.545021802,-152.9571465
333.434949,10.922,14.478,22.71845063,11.35922544,0.567961272,-56.22816542
326.309932,10.16,14.986,56.35753981,7.04469254,0.915809954,-90.6651923
303.690068,9.652,15.748,35.22346245,7.04469254,0.915809954,-90.6651923
270,9.652,16.764,0,25.4,1.016,-24.384
251.565051,9.906,17.526,24.09655582,8.032185358,0.803218612,-79.51863395
236.309932,10.414,18.288,56.35753981,7.04469254,0.915809954,-90.6651923
213.690068,11.176,18.796,35.22346245,7.04469254,0.915809954,-90.6651923
0,10.16,18.796,0,25.4,1.016,-24.384
333.434949,9.144,19.304,22.71845063,11.35922544,1.135922544,-55.66020415
306.869898,8.382,20.32,35.56,5.08,1.27,-125.73
284.036243,8.128,21.336,80.0852635,6.160405002,1.047268924,-103.6796141
341.565051,7.366,21.59,24.09655582,8.032185358,0.803218612,-79.51863395
326.309932,6.604,22.098,56.35753981,7.04469254,0.915809954,-90.6651923
303.690068,6.096,22.86,35.22346245,7.04469254,0.915809954,-90.6651923
296.565051,5.334,24.384,34.07767607,11.35922544,1.703883816,-55.09224288
56.309932,4.572,21.59,56.35753981,7.04469254,0.915809954,-90.6651923
45,4.064,21.082,17.96051221,17.96051221,0.718420458,-35.20260397
33.690068,3.302,20.574,35.22346245,7.04469254,0.915809954,-90.6651923
116.565051,3.556,20.066,34.07767607,11.35922544,0.567961272,-56.22816542
108.434949,3.81,19.304,56.22529674,8.032185358,0.803218612,-79.51863395
90,3.81,18.288,0,25.4,1.016,-24.384
63.434949,3.302,17.272,22.71845063,11.35922544,1.135922544,-55.66020415
33.690068,2.54,16.764,35.22346245,7.04469254,0.915809954,-90.6651923
165.963757,3.556,16.51,24.6416195,6.160405002,1.047268924,-103.6796141
143.130102,4.572,15.748,91.44,5.08,1.27,-125.73
116.565051,5.08,14.732,34.07767607,11.35922544,1.135922544,-55.66020415
75.963757,4.826,13.716,24.6416195,6.160405002,1.047268924,-103.6796141
63.434949,4.318,12.7,22.71845063,11.35922544,1.135922544,-55.66020415
180,5.334,12.7,0,25.4,1.016,-24.384
165.963757,6.35,12.446,24.6416195,6.160405002,1.047268924,-103.6796141
135,6.858,11.938,17.96051221,17.96051221,0.718420458,-35.20260397
116.565051,7.366,10.922,34.07767607,11.35922544,1.135922544,-55.66020415
278.583621,5.334,24.384,847.7664863,0.473877386,13.61449474,-1347.834983
104.036243,7.62,5.08,80.0852635,6.160405002,1.047268924,-103.6796141
123.690068,8.128,4.318,35.22346245,7.04469254,0.915809954,-90.6651923
153.434949,9.144,3.81,22.71845063,11.35922544,1.135922544,-55.66020415
180,9.906,3.81,0,25.4,0.762,-24.638
206.565051,10.922,4.318,34.07767607,11.35922544,1.135922544,-55.66020415
236.309932,11.43,5.08,56.35753981,7.04469254,0.915809954,-90.6651923
255.963757,11.684,6.096,24.6416195,6.160405002,1.047268924,-103.6796141
288.434949,11.43,6.858,56.22529674,8.032185358,0.803218612,-79.51863395
303.690068,10.922,7.62,35.22346245,7.04469254,0.915809954,-90.6651923
333.434949,9.906,8.128,22.71845063,11.35922544,1.135922544,-55.66020415
0,9.144,8.128,0,25.4,0.762,-24.638
26.565051,8.128,7.62,34.07767607,11.35922544,1.135922544,-55.66020415
56.309932,7.62,6.858,56.35753981,7.04469254,0.915809954,-90.6651923
71.565051,7.366,6.096,24.09655582,8.032185358,0.803218612,-79.51863395
104.036243,4.064,7.874,80.0852635,6.160405002,1.047268924,-103.6796141
123.690068,4.572,7.112,35.22346245,7.04469254,0.915809954,-90.6651923
153.434949,5.588,6.604,22.71845063,11.35922544,1.135922544,-55.66020415
180,6.35,6.604,0,25.4,0.762,-24.638
206.565051,7.366,7.112,34.07767607,11.35922544,1.135922544,-55.66020415
236.309932,7.874,7.874,56.35753981,7.04469254,0.915809954,-90.6651923
255.963757,8.128,8.89,24.6416195,6.160405002,1.047268924,-103.6796141
288.434949,7.874,9.652,56.22529674,8.032185358,0.803218612,-79.51863395
303.690068,7.366,10.414,35.22346245,7.04469254,0.915809954,-90.6651923
333.434949,6.35,10.922,22.71845063,11.35922544,1.135922544,-55.66020415
0,5.588,10.922,0,25.4,0.762,-24.638
26.565051,4.572,10.414,34.07767607,11.35922544,1.135922544,-55.66020415
56.309932,4.064,9.652,56.35753981,7.04469254,0.915809954,-90.6651923
71.565051,3.81,8.89,24.09655582,8.032185358,0.803218612,-79.51863395
104.036243,8.636,9.652,80.0852635,6.160405002,1.047268924,-103.6796141
123.690068,9.144,8.89,35.22346245,7.04469254,0.915809954,-90.6651923
153.434949,10.16,8.382,22.71845063,11.35922544,1.135922544,-55.66020415
180,10.922,8.382,0,25.4,0.762,-24.638
206.565051,11.938,8.89,34.07767607,11.35922544,1.135922544,-55.66020415
236.309932,12.446,9.652,56.35753981,7.04469254,0.915809954,-90.6651923
255.963757,12.7,10.668,24.6416195,6.160405002,1.047268924,-103.6796141
288.434949,12.446,11.43,56.22529674,8.032185358,0.803218612,-79.51863395
303.690068,11.938,12.192,35.22346245,7.04469254,0.915809954,-90.6651923
333.434949,10.922,12.7,22.71845063,11.35922544,1.135922544,-55.66020415
0,10.16,12.7,0,25.4,0.762,-24.638
26.565051,9.144,12.192,34.07767607,11.35922544,1.135922544,-55.66020415
56.309932,8.636,11.43,56.35753981,7.04469254,0.915809954,-90.6651923
71.565051,8.382,10.668,24.09655582,8.032185358,0.803218612,-79.51863395
`));ie(ee.ParsePatFile(`
*HONEY,HONEY
0, 0,0, 4.7625,2.74963, 3.175,-6.35
120, 0,0, 4.7625,2.74963, 3.175,-6.35
60, 0,0, 4.7625,2.74963, -6.35,3.175
`));ie(ee.ParsePatFile(`
*HOUND,HOUND
0, 0,0, 6.35,1.5875, 25.4,-12.7
90, 0,0, -6.35,1.5875, 25.4,-12.7
`));ie(ee.ParsePatFile(`
*INSUL,INSUL
0, 0,0, 0,9.525
0, 0,3.175, 0,9.525, 3.175,-3.175
0, 0,6.35, 0,9.525, 3.175,-3.175
`));ie(ee.ParsePatFile(`
*JIS_LC_20,JIS_LC_20
45, 0,0, 0,20
45, .4,0, 0,20
`));ie(ee.ParsePatFile(`
*JIS_LC_20A,JIS_LC_20A
45, 0,0, 0,20
45, 1,0, 0,20
`));ie(ee.ParsePatFile(`
*JIS_LC_8,JIS_LC_8
45, 0,0, 0,7.8
45, .4,0, 0,7.8
`));ie(ee.ParsePatFile(`
*JIS_LC_8A,JIS_LC_8A
45, 0,0, 0,7.8
45, 1,0, 0,7.8
`));ie(ee.ParsePatFile(`
*JIS_RC_10,JIS_RC_10
45, 0,0, 0,10
45, .725,0, 0,10
45, 1.45,0, 0,10
`));ie(ee.ParsePatFile(`
*JIS_RC_15,JIS_RC_15
45, 0,0, 0,15
45, .725,0, 0,15
45, 1.45,0, 0,15
`));ie(ee.ParsePatFile(`
*JIS_RC_18,JIS_RC_18
45, 0,0, 0,18
45, 1,0, 0,18
45, 2,0, 0,18
`));ie(ee.ParsePatFile(`
*JIS_RC_30,JIS_RC_30
45, 0,0, 0,30
45, 1,0, 0,30
45, 2,0, 0,30
`));ie(ee.ParsePatFile(`
*JIS_STN_1E,JIS_STN_1E
45, 0,0, 0,1
45, .705,0, 0,1, 1,-.5
`));ie(ee.ParsePatFile(`
*JIS_STN_2.5,JIS_STN_2.5
45, 0,0, 0,2.5
45, 1.765,0, 0,2.5, 1.2,-.5
`));ie(ee.ParsePatFile(`
*JIS_WOOD,JIS_WOOD
45, 0,0, 0,.70710678
`));ie(ee.ParsePatFile(`
*LATTICE-01
;By John Hyslop,    Tile2Hatch tool \xA9 CVH 2020
;Developed in mm as metric QCAD3 pattern
180,2.162738626,10.16,0,25.4,4.325477252,-21.074522748
270,15.24,2.162738626,25.4,25.4,4.325477252,-21.074522748
270,10.16,2.162738626,25.4,25.4,4.325477252,-21.074522748
135,12.7,6.80694346,17.960512212,17.960512212,8.334040482,-27.586983942
225,18.59305654,12.7,17.960512212,17.960512212,8.334040482,-27.586983942
45,2.162738626,15.24,17.960512212,17.960512212,11.309835394,-24.61118903
180,2.162738626,15.24,0,25.4,4.325477252,-21.074522748
315,12.7,18.59305654,17.960512212,17.960512212,8.334040482,-27.586983942
45,6.80694346,12.7,17.960512212,17.960512212,8.334040482,-27.586983942
315,15.24,23.237261374,17.960512212,17.960512212,11.309835394,-24.61118903
45,15.24,2.162738626,17.960512212,17.960512212,11.309835394,-24.61118903
315,2.162738626,10.16,17.960512212,17.960512212,11.309835394,-24.61118903
`));ie(ee.ParsePatFile(`
*LATTICE-02
;By John Hyslop,    Tile2Hatch tool \xA9 CVH 2020
;Developed in mm as metric QCAD3 pattern
180,9.736666582,9.736666582,0,25.4,19.473333164,-5.926666836
270,15.663333418,25.4,25.4,25.4,25.4;,0 Removed 0 IT RENDERS A POINT
180,9.736666582,15.663333418,0,25.4,19.473333164,-5.926666836
270,9.736666582,25.4,25.4,25.4,25.4;,0 Removed 0 IT RENDERS A POINT
`));ie(ee.ParsePatFile(`
*LATTICE-03
;By John Hyslop,    Tile2Hatch tool \xA9 CVH 2020
;Developed in mm as metric QCAD3 pattern
180,9.736666582,9.736666582,0,25.4,19.473333164,-5.926666836
180,9.736666582,15.663333418,0,25.4,19.473333164,-5.926666836
270,15.663333418,9.736666582,25.4,25.4,19.473333164,-5.926666836
270,9.736666582,9.736666582,25.4,25.4,19.473333164,-5.926666836
`));ie(ee.ParsePatFile(`
*LATTICE-04
;By John Hyslop,    Tile2Hatch tool \xA9 CVH 2020
;Developed in mm as metric QCAD3 pattern
296.565051,3.894666582,11.684,34.077676066,11.35922544,28.776704194,-28.019422498
296.565051,8.636000254,14.054666582,34.077676066,11.35922544,28.776704194,-28.019422498
206.565051,11.684,21.505333418,34.077676066,11.35922544,28.776704194,-28.019422498
206.565051,14.054666582,16.763999746,34.077676066,11.35922544,28.776704194,-28.019422498
`));ie(ee.ParsePatFile(`
*LATTICE-05,LATTICE-05
;By John Hyslop
;Developed in mm as Metric QCAD3 pattern
0,19.685,1.905,0,25.4,3.81,-21.59
180,5.715,23.495,0,25.4,3.81,-21.59
180,15.875,5.715,0,25.4,10.16,-15.24
180,15.875,1.905,0,25.4,13.97,-11.43
270,15.875,5.715,0,25.4,3.81,-21.59
270,19.685,19.685,0,25.4,17.78,-7.62
270,23.495,23.495,0,25.4,21.59,-3.81
0,9.525,19.685,0,25.4,10.16,-15.24
0,9.525,23.495,0,25.4,13.97,-11.43
90,9.525,19.685,0,25.4,3.81,-21.59
90,5.715,5.715,0,25.4,17.78,-7.62
90,1.905,1.905,0,25.4,21.59,-3.81
`));ie(ee.ParsePatFile(`
*LATTICE-06,LATTICE-06
;By John Hyslop
;Developed in mm as Metric QCAD3 pattern
180,15.875,9.525,0,25.4,6.35,-19.05
270,15.875,15.875,0,25.4,6.35,-19.05
0,9.525,15.875,0,25.4,6.35,-19.05
90,9.525,9.525,0,25.4,6.35,-19.05
0,19.685,1.905,0,25.4,3.81,-21.59
180,5.715,23.495,0,25.4,3.81,-21.59
180,15.875,5.715,0,25.4,10.16,-15.24
180,15.875,1.905,0,25.4,13.97,-11.43
270,15.875,5.715,0,25.4,3.81,-21.59
270,19.685,19.685,0,25.4,17.78,-7.62
270,23.495,23.495,0,25.4,21.59,-3.81
0,9.525,19.685,0,25.4,10.16,-15.24
0,9.525,23.495,0,25.4,13.97,-11.43
90,9.525,19.685,0,25.4,3.81,-21.59
90,5.715,5.715,0,25.4,17.78,-7.62
90,1.905,1.905,0,25.4,21.59,-3.81
`));ie(ee.ParsePatFile(`
*LATTICE-07
;By John Hyslop,    Tile2Hatch tool \xA9 CVH 2020
;Developed in mm as metric QCAD3 pattern
270,17.568333418,17.568333164,25.4,25.4,22.436666582,-2.963333418
270,20.531666836,17.568333164,25.4,25.4,22.436666582,-2.963333418
270,4.868333164,4.868333418,25.4,25.4,22.436666582,-2.963333418
270,7.831666582,4.868333418,25.4,25.4,22.436666582,-2.963333418
180,17.568333418,7.831666582,0,25.4,22.436666582,-2.963333418
180,17.568333418,4.868333164,0,25.4,22.436666582,-2.963333418
180,4.868333418,20.531666836,0,25.4,22.436666582,-2.963333418
180,4.868333418,17.568333418,0,25.4,22.436666582,-2.963333418
`));ie(ee.ParsePatFile(`
*LEAF-01,LEAF-01
;By John Hyslop,    Using AutoCAD Lisp Tool
;Developed in mm as metric QCAD3 pattern
83.659808,22.86,5.08,25.244646742,2.804960862,2.30006779,-227.706714766
26.565051,22.352,4.826,34.077676066,11.35922544,0.567961272,-56.22816542
14.036243,21.336,4.572,80.085263502,6.160405002,1.047268924,-103.679614078
315,21.336,4.572,17.960512212,17.960512212,1.436840916,-34.484183508
83.659808,21.336,4.572,25.244646742,2.804960862,2.30006779,-227.706714766
0,20.066,4.572,0,25.4,1.27,-24.13
345.963757,20.828,3.048,24.6416195,6.160405002,1.047268924,-103.679614078
326.309932,20.066,3.556,56.357539812,7.04469254,0.915809954,-90.665192304
303.690068,19.558,4.318,35.223462446,7.04469254,0.915809954,-90.665192304
18.434949,18.796,4.064,56.225296744,8.032185358,0.803218612,-79.518633952
288.434949,18.542,4.826,56.225296744,8.032185358,0.803218612,-79.518633952
180,19.558,4.826,0,25.4,1.016,-24.384
258.690068,19.812,6.096,24.906749272,4.981349956,1.29515108,-128.219944728
243.434949,20.066,6.604,22.718450626,11.35922544,0.567961272,-56.22816542
225,20.828,7.366,17.960512212,17.960512212,1.077630814,-34.843393864
213.690068,21.59,7.874,35.223462446,7.04469254,0.915809954,-90.665192304
191.309932,22.86,8.128,104.608346536,4.981349956,1.29515108,-128.219944728
128.659808,7.62,10.668,35.701322044,3.966813504,1.626393496,-161.0129622
143.130102,8.636,9.906,91.44,5.08,1.27,-125.73
153.434949,9.652,9.398,22.718450626,11.35922544,1.135922544,-55.660204148
192.528808,9.652,9.398,104.69063898,2.755016842,2.341764176,-231.834664854
105.945396,9.652,9.398,80.246041438,3.488958224,1.84914794,-183.065643266
153.434949,10.668,8.89,22.718450626,11.35922544,1.135922544,-55.660204148
149.036243,11.938,8.128,56.628832894,4.356064186,1.481061808,-146.625116452
95.710593,11.938,8.128,229.992896122,2.527394488,2.552668504,-252.714172244
194.931417,11.938,8.128,289.599936166,1.636157764,3.94314045,-390.37089693
135,12.954,7.112,17.960512212,17.960512212,1.436840916,-34.484183508
123.690068,13.462,6.35,35.223462446,7.04469254,0.915809954,-90.665192304
199.653824,13.462,6.35,297.294468148,1.708588912,3.775981526,-373.822164724
71.565051,13.462,6.35,24.09655582,8.032185358,2.409655582,-77.912196982
119.054604,14.732,4.064,204.766485564,2.467066186,2.61509002,-258.893915536
288.434949,14.732,3.556,56.225296744,8.032185358,1.60643697,-78.715415594
21.801409,13.462,3.048,56.599939124,4.716661636,1.36783191,-135.415354264
11.309932,12.192,2.794,104.608346536,4.981349956,1.29515108,-128.219944728
0,11.43,2.794,0,25.4,0.762,-24.638
341.565051,9.906,3.302,24.09655582,8.032185358,1.60643697,-78.715415594
326.309932,8.382,4.318,56.357539812,7.04469254,1.831620162,-89.74938235
308.659808,7.366,5.588,35.701322044,3.966813504,1.626393496,-161.0129622
300.963757,6.604,6.858,91.477345366,4.356064186,1.481061808,-146.625116452
285.945396,6.096,8.636,80.246041438,3.488958224,1.84914794,-183.065643266
270,6.096,10.414,0,25.4,1.778,-23.622
279.462322,5.842,11.938,129.447762694,4.175734346,1.545021802,-152.95714646
285.945396,5.334,13.716,80.246041438,3.488958224,1.84914794,-183.065643266
123.690068,5.842,12.954,35.223462446,7.04469254,0.915809954,-90.665192304
161.565051,6.604,12.7,24.09655582,8.032185358,0.803218612,-79.518633952
171.869898,8.382,12.446,25.144717046,3.592102544,1.796051272,-177.809071102
171.869898,10.16,12.192,25.144717046,3.592102544,1.796051272,-177.809071102
161.565051,11.684,11.684,24.09655582,8.032185358,1.60643697,-78.715415594
161.565051,13.208,11.176,24.09655582,8.032185358,1.60643697,-78.715415594
146.309932,14.732,10.16,56.357539812,7.04469254,1.831620162,-89.74938235
119.744881,15.748,8.382,148.072666262,3.150482142,2.047813532,-202.733533318
111.801409,16.256,7.112,56.599939124,4.716661636,1.36783191,-135.415354264
90,16.256,6.096,0,25.4,1.016,-24.384
75.963757,16.002,5.08,24.6416195,6.160405002,1.047268924,-103.679614078
56.309932,15.494,4.318,56.357539812,7.04469254,0.915809954,-90.665192304
63.434949,15.24,3.81,22.718450626,11.35922544,0.567961272,-56.22816542
126.869898,16.002,2.794,35.56,5.08,1.27,-125.73
45,15.24,2.032,17.960512212,17.960512212,1.077630814,-34.843393864
233.130102,22.606,1.016,91.44,5.08,1.27,-125.73
258.690068,1.778,1.27,24.906749272,4.981349956,1.29515108,-128.219944728
258.690068,3.556,1.27,24.906749272,4.981349956,1.29515108,-128.219944728
198.434949,6.604,0.508,56.225296744,8.032185358,1.60643697,-78.715415594
225,7.874,0.508,17.960512212,17.960512212,0.718420458,-35.202603966
198.434949,8.636,0.762,56.225296744,8.032185358,0.803218612,-79.518633952
348.690068,7.366,1.016,24.906749272,4.981349956,1.29515108,-128.219944728
345.963757,6.35,1.27,24.6416195,6.160405002,1.047268924,-103.679614078
333.434949,5.334,1.778,22.718450626,11.35922544,1.135922544,-55.660204148
333.434949,3.81,2.54,22.718450626,11.35922544,1.703883816,-55.092242876
348.690068,2.54,2.794,24.906749272,4.981349956,1.29515108,-128.219944728
0,1.778,2.794,0,25.4,0.762,-24.638
8.130102,0,2.54,154.460405328,3.592102544,1.796051272,-177.809071102
236.309932,0.508,5.842,56.357539812,7.04469254,0.915809954,-90.665192304
236.309932,1.016,6.604,56.357539812,7.04469254,0.915809954,-90.665192304
213.690068,1.778,7.112,35.223462446,7.04469254,0.915809954,-90.665192304
0,0.762,7.112,0,25.4,1.016,-24.384
326.309932,0,7.62,56.357539812,7.04469254,0.915809954,-90.665192304
18.434949,0,6.604,56.225296744,8.032185358,0.803218612,-79.518633952
0,0,13.97,0,25.4,1.778,-23.622
14.036243,2.54,15.494,80.085263502,6.160405002,1.047268924,-103.679614078
21.801409,1.27,14.986,56.599939124,4.716661636,1.36783191,-135.415354264
30.963757,0,14.224,91.477345366,4.356064186,1.481061808,-146.625116452
254.054604,0.508,16.764,104.668749768,3.488958224,1.84914794,-183.065643266
158.198591,1.27,17.526,80.18324705,4.716661636,1.36783191,-135.415354264
153.434949,2.794,16.764,22.718450626,11.35922544,1.703883816,-55.092242876
158.198591,4.064,16.256,80.18324705,4.716661636,1.36783191,-135.415354264
180,5.334,16.256,0,25.4,1.27,-24.13
33.690068,4.572,15.748,35.223462446,7.04469254,0.915809954,-90.665192304
45,4.064,15.24,17.960512212,17.960512212,0.718420458,-35.202603966
53.130102,3.302,14.224,91.44,5.08,1.27,-125.73
56.309932,2.286,12.7,56.357539812,7.04469254,1.831620162,-89.74938235
51.340192,1.27,11.43,126.938033652,3.966813504,1.626393496,-161.0129622
38.659808,0,10.414,35.701322044,3.966813504,1.626393496,-161.0129622
180,20.828,12.192,0,25.4,2.54,-22.86
310.601295,20.828,12.192,35.815218692,2.755016842,2.341764176,-231.834664854
82.405357,20.828,12.192,204.774468022,1.678479244,3.843717484,-380.528029646
180,21.336,12.192,0,25.4,0.508,-24.892
194.036243,22.352,12.446,80.085263502,6.160405002,1.047268924,-103.679614078
198.434949,23.114,12.7,56.225296744,8.032185358,0.803218612,-79.518633952
0,21.082,9.398,0,25.4,2.032,-23.368
348.690068,19.812,9.652,24.906749272,4.981349956,1.29515108,-128.219944728
321.340192,18.542,10.668,126.938033652,3.966813504,1.626393496,-161.0129622
300.963757,17.78,11.938,91.477345366,4.356064186,1.481061808,-146.625116452
21.801409,16.51,11.43,56.599939124,4.716661636,1.36783191,-135.415354264
284.036243,16.256,12.446,80.085263502,6.160405002,1.047268924,-103.679614078
180,17.78,12.446,0,25.4,1.524,-23.876
261.869898,18.034,14.224,25.144717046,3.592102544,1.796051272,-177.809071102
248.198591,18.542,15.494,80.18324705,4.716661636,1.36783191,-135.415354264
225,19.558,16.51,17.960512212,17.960512212,1.436840916,-34.484183508
216.869898,20.574,17.272,35.56,5.08,1.27,-125.73
198.434949,22.86,18.034,56.225296744,8.032185358,2.409655582,-77.912196982
153.434949,9.144,16.51,22.718450626,11.35922544,1.703883816,-55.092242876
170.537678,10.668,16.256,25.054405568,4.175734346,1.545021802,-152.95714646
188.130102,12.446,16.51,154.460405328,3.592102544,1.796051272,-177.809071102
201.801409,13.716,17.018,56.599939124,4.716661636,1.36783191,-135.415354264
219.805571,15.24,18.288,35.773504272,3.252136752,1.9838035,-196.396538372
18.434949,24.638,6.35,56.225296744,8.032185358,0.803218612,-79.518633952
33.690068,23.876,5.842,35.223462446,7.04469254,0.915809954,-90.665192304
0,23.876,5.842,0,25.4,1.016,-24.384
80.537678,23.876,5.842,25.054405568,4.175734346,1.545021802,-152.95714646
36.869898,22.86,5.08,35.56,5.08,1.27,-125.73
341.565051,22.86,5.08,24.09655582,8.032185358,1.60643697,-78.715415594
53.130102,24.638,4.064,91.44,5.08,1.27,-125.73
38.659808,23.368,3.048,35.701322044,3.966813504,1.626393496,-161.0129622
9.462322,21.844,2.794,129.447762694,4.175734346,1.545021802,-152.95714646
180,24.13,8.128,0,25.4,1.27,-24.13
158.198591,25.4,7.62,80.18324705,4.716661636,1.36783191,-135.415354264
216.869898,23.622,1.778,35.56,5.08,1.27,-125.73
206.565051,24.638,2.286,34.077676066,11.35922544,1.135922544,-55.660204148
198.434949,25.4,2.54,56.225296744,8.032185358,0.803218612,-79.518633952
90,24.638,0,0,25.4,0.508,-24.892
26.565051,24.384,13.462,34.077676066,11.35922544,1.135922544,-55.660204148
56.309932,24.384,13.462,56.357539812,7.04469254,1.831620162,-89.74938235
36.869898,24.384,13.462,35.56,5.08,1.27,-125.73
30.963757,23.114,12.7,91.477345366,4.356064186,1.481061808,-146.625116452
78.690068,23.114,12.7,24.906749272,4.981349956,3.885452986,-125.629642822
156.037511,25.4,11.684,193.423444496,2.578979348,2.501609932,-247.659378188
30.963757,24.13,9.652,91.477345366,4.356064186,1.481061808,-146.625116452
14.036243,23.114,9.398,80.085263502,6.160405002,1.047268924,-103.679614078
180,25.4,18.034,0,25.4,2.54,-22.86
0,21.844,22.098,0,25.4,2.286,-23.114
11.309932,24.13,22.098,104.608346536,4.981349956,1.29515108,-128.219944728
135,25.4,20.828,17.960512212,17.960512212,1.796051272,-34.124973152
0,24.384,19.304,0,25.4,1.016,-24.384
345.963757,23.368,19.558,24.6416195,6.160405002,1.047268924,-103.679614078
333.434949,22.352,20.066,22.718450626,11.35922544,1.135922544,-55.660204148
315,21.844,20.574,17.960512212,17.960512212,0.718420458,-35.202603966
306.869898,21.082,21.59,35.56,5.08,1.27,-125.73
11.309932,19.812,21.336,104.608346536,4.981349956,1.29515108,-128.219944728
284.036243,19.558,22.352,80.085263502,6.160405002,1.047268924,-103.679614078
180,21.082,22.352,0,25.4,1.524,-23.876
14.036243,16.51,22.606,80.085263502,6.160405002,1.047268924,-103.679614078
18.434949,15.748,22.352,56.225296744,8.032185358,0.803218612,-79.518633952
33.690068,14.986,21.844,35.223462446,7.04469254,0.915809954,-90.665192304
230.194429,16.51,19.812,162.6068376,3.252136752,1.9838035,-196.396538372
239.036243,17.272,21.082,56.628832894,4.356064186,1.481061808,-146.625116452
236.309932,18.288,22.606,56.357539812,7.04469254,1.831620162,-89.74938235
213.690068,19.05,23.114,35.223462446,7.04469254,0.915809954,-90.665192304
198.434949,19.812,23.368,56.225296744,8.032185358,0.803218612,-79.518633952
0,18.796,23.368,0,25.4,1.016,-24.384
345.963757,17.78,23.622,24.6416195,6.160405002,1.047268924,-103.679614078
261.869898,21.336,24.13,25.144717046,3.592102544,1.796051272,-177.809071102
248.198591,21.844,25.4,80.18324705,4.716661636,1.36783191,-135.415354264
36.869898,13.97,21.082,35.56,5.08,1.27,-125.73
0,13.97,21.082,0,25.4,2.032,-23.368
78.690068,13.97,21.082,24.906749272,4.981349956,2.590301906,-126.924793648
33.690068,13.208,20.574,35.223462446,7.04469254,0.915809954,-90.665192304
30.963757,11.938,19.812,91.477345366,4.356064186,1.481061808,-146.625116452
336.037511,11.938,19.812,193.423444496,2.578979348,2.501609932,-247.659378188
79.380345,11.938,19.812,283.976346702,1.560309554,4.134820534,-409.347222706
26.565051,10.922,19.304,34.077676066,11.35922544,1.135922544,-55.660204148
9.462322,9.398,19.05,129.447762694,4.175734346,1.545021802,-152.95714646
318.814075,9.398,19.05,234.164238554,2.389431086,2.700057084,-267.30564649
82.405357,9.398,19.05,204.774468022,1.678479244,3.843717484,-380.528029646
0,8.382,19.05,0,25.4,1.016,-24.384
0,7.366,19.05,0,25.4,1.016,-24.384
0,5.08,19.304,0,25.4,1.524,-23.876
104.036243,5.334,18.288,80.085263502,6.160405002,1.047268924,-103.679614078
201.801409,6.604,18.796,56.599939124,4.716661636,1.36783191,-135.415354264
123.690068,7.62,17.272,35.223462446,7.04469254,1.831620162,-89.74938235
338.198591,16.51,24.13,80.18324705,4.716661636,1.36783191,-135.415354264
333.434949,14.986,24.892,22.718450626,11.35922544,1.703883816,-55.092242876
348.690068,13.716,25.146,24.906749272,4.981349956,1.29515108,-128.219944728
0,11.684,25.146,0,25.4,2.032,-23.368
18.434949,10.16,24.638,56.225296744,8.032185358,1.60643697,-78.715415594
26.565051,8.636,23.876,34.077676066,11.35922544,1.703883816,-55.092242876
45,7.366,22.606,17.960512212,17.960512212,1.796051272,-34.124973152
71.565051,6.858,21.082,24.09655582,8.032185358,1.60643697,-78.715415594
81.869898,6.604,19.304,25.144717046,3.592102544,1.796051272,-177.809071102
;0,5.08,19.304,0,25.4,1.524,-23.876
315,0,20.828,17.960512212,17.960512212,0.718420458,-35.202603966
198.434949,0.762,22.606,56.225296744,8.032185358,0.803218612,-79.518633952
343.300756,0.762,22.606,184.898786158,2.432878802,2.651837978,-262.531947376
74.744881,0.762,22.606,104.703186326,2.22772732,2.896045516,-286.708512434
206.565051,1.27,22.86,34.077676066,11.35922544,0.567961272,-56.22816542
213.690068,2.032,23.368,35.223462446,7.04469254,0.915809954,-90.665192304
216.869898,3.048,24.13,35.56,5.08,1.27,-125.73
352.874984,3.048,24.13,25.203858152,3.150482142,2.047813532,-202.733533318
78.690068,3.048,24.13,24.906749272,4.981349956,1.29515108,-128.219944728
213.690068,3.81,24.638,35.223462446,7.04469254,0.915809954,-90.665192304
213.690068,4.572,25.146,35.223462446,7.04469254,0.915809954,-90.665192304
206.565051,5.08,25.4,34.077676066,11.35922544,0.567961272,-56.22816542
45,7.112,25.146,17.960512212,17.960512212,0.359210356,-35.561814322
56.309932,6.604,24.384,56.357539812,7.04469254,0.915809954,-90.665192304
56.309932,5.588,22.86,56.357539812,7.04469254,1.831620162,-89.74938235
53.130102,4.826,21.844,91.44,5.08,1.27,-125.73
45,3.556,20.574,17.960512212,17.960512212,1.796051272,-34.124973152
36.869898,2.54,19.812,35.56,5.08,1.27,-125.73
18.434949,1.016,19.304,56.225296744,8.032185358,1.60643697,-78.715415594
0,0,19.304,0,25.4,1.016,-24.384
81.253838,24.13,22.098,179.594740378,1.931126186,3.340848284,-330.743991038
`));ie(ee.ParsePatFile(`
*LEAF-02,LEAF-02
;By John Hyslop,    Using AutoCAD Lisp Tool
;Developed in mm as metric QCAD3 pattern
303.690068,19.558,4.318,35.223462446,7.04469254,0.915809954,-90.665192304
18.434949,18.796,4.064,56.225296744,8.032185358,0.803218612,-79.518633952
288.434949,18.542,4.826,56.225296744,8.032185358,0.803218612,-79.518633952
180,19.558,4.826,0,25.4,1.016,-24.384
258.690068,19.812,6.096,24.906749272,4.981349956,1.29515108,-128.219944728
243.434949,20.066,6.604,22.718450626,11.35922544,0.567961272,-56.22816542
288.434949,14.732,3.556,56.225296744,8.032185358,1.60643697,-78.715415594
21.801409,13.462,3.048,56.599939124,4.716661636,1.36783191,-135.415354264
11.309932,12.192,2.794,104.608346536,4.981349956,1.29515108,-128.219944728
0,11.43,2.794,0,25.4,0.762,-24.638
341.565051,9.906,3.302,24.09655582,8.032185358,1.60643697,-78.715415594
326.309932,8.382,4.318,56.357539812,7.04469254,1.831620162,-89.74938235
308.659808,7.366,5.588,35.701322044,3.966813504,1.626393496,-161.0129622
300.963757,6.604,6.858,91.477345366,4.356064186,1.481061808,-146.625116452
285.945396,6.096,8.636,80.246041438,3.488958224,1.84914794,-183.065643266
270,6.096,10.414,0,25.4,1.778,-23.622
279.462322,5.842,11.938,129.447762694,4.175734346,1.545021802,-152.95714646
285.945396,5.334,13.716,80.246041438,3.488958224,1.84914794,-183.065643266
123.690068,5.842,12.954,35.223462446,7.04469254,0.915809954,-90.665192304
161.565051,6.604,12.7,24.09655582,8.032185358,0.803218612,-79.518633952
171.869898,8.382,12.446,25.144717046,3.592102544,1.796051272,-177.809071102
171.869898,10.16,12.192,25.144717046,3.592102544,1.796051272,-177.809071102
161.565051,11.684,11.684,24.09655582,8.032185358,1.60643697,-78.715415594
161.565051,13.208,11.176,24.09655582,8.032185358,1.60643697,-78.715415594
146.309932,14.732,10.16,56.357539812,7.04469254,1.831620162,-89.74938235
119.744881,15.748,8.382,148.072666262,3.150482142,2.047813532,-202.733533318
111.801409,16.256,7.112,56.599939124,4.716661636,1.36783191,-135.415354264
90,16.256,6.096,0,25.4,1.016,-24.384
75.963757,16.002,5.08,24.6416195,6.160405002,1.047268924,-103.679614078
56.309932,15.494,4.318,56.357539812,7.04469254,0.915809954,-90.665192304
63.434949,15.24,3.81,22.718450626,11.35922544,0.567961272,-56.22816542
126.869898,16.002,2.794,35.56,5.08,1.27,-125.73
45,15.24,2.032,17.960512212,17.960512212,1.077630814,-34.843393864
225,7.874,0.508,17.960512212,17.960512212,0.718420458,-35.202603966
198.434949,8.636,0.762,56.225296744,8.032185358,0.803218612,-79.518633952
348.690068,7.366,1.016,24.906749272,4.981349956,1.29515108,-128.219944728
345.963757,6.35,1.27,24.6416195,6.160405002,1.047268924,-103.679614078
333.434949,5.334,1.778,22.718450626,11.35922544,1.135922544,-55.660204148
333.434949,3.81,2.54,22.718450626,11.35922544,1.703883816,-55.092242876
348.690068,2.54,2.794,24.906749272,4.981349956,1.29515108,-128.219944728
0,1.778,2.794,0,25.4,0.762,-24.638
8.130102,0,2.54,154.460405328,3.592102544,1.796051272,-177.809071102
236.309932,0.508,5.842,56.357539812,7.04469254,0.915809954,-90.665192304
236.309932,1.016,6.604,56.357539812,7.04469254,0.915809954,-90.665192304
213.690068,1.778,7.112,35.223462446,7.04469254,0.915809954,-90.665192304
0,0.762,7.112,0,25.4,1.016,-24.384
326.309932,0,7.62,56.357539812,7.04469254,0.915809954,-90.665192304
158.198591,1.27,17.526,80.18324705,4.716661636,1.36783191,-135.415354264
153.434949,2.794,16.764,22.718450626,11.35922544,1.703883816,-55.092242876
158.198591,4.064,16.256,80.18324705,4.716661636,1.36783191,-135.415354264
180,5.334,16.256,0,25.4,1.27,-24.13
33.690068,4.572,15.748,35.223462446,7.04469254,0.915809954,-90.665192304
45,4.064,15.24,17.960512212,17.960512212,0.718420458,-35.202603966
53.130102,3.302,14.224,91.44,5.08,1.27,-125.73
56.309932,2.286,12.7,56.357539812,7.04469254,1.831620162,-89.74938235
51.340192,1.27,11.43,126.938033652,3.966813504,1.626393496,-161.0129622
38.659808,0,10.414,35.701322044,3.966813504,1.626393496,-161.0129622
321.340192,18.542,10.668,126.938033652,3.966813504,1.626393496,-161.0129622
300.963757,17.78,11.938,91.477345366,4.356064186,1.481061808,-146.625116452
21.801409,16.51,11.43,56.599939124,4.716661636,1.36783191,-135.415354264
284.036243,16.256,12.446,80.085263502,6.160405002,1.047268924,-103.679614078
180,17.78,12.446,0,25.4,1.524,-23.876
261.869898,18.034,14.224,25.144717046,3.592102544,1.796051272,-177.809071102
248.198591,18.542,15.494,80.18324705,4.716661636,1.36783191,-135.415354264
225,19.558,16.51,17.960512212,17.960512212,1.436840916,-34.484183508
284.036243,19.558,22.352,80.085263502,6.160405002,1.047268924,-103.679614078
0,5.08,19.304,0,25.4,1.524,-23.876
104.036243,5.334,18.288,80.085263502,6.160405002,1.047268924,-103.679614078
201.801409,6.604,18.796,56.599939124,4.716661636,1.36783191,-135.415354264
123.690068,7.62,17.272,35.223462446,7.04469254,1.831620162,-89.74938235
153.434949,9.144,16.51,22.718450626,11.35922544,1.703883816,-55.092242876
170.537678,10.668,16.256,25.054405568,4.175734346,1.545021802,-152.95714646
188.130102,12.446,16.51,154.460405328,3.592102544,1.796051272,-177.809071102
201.801409,13.716,17.018,56.599939124,4.716661636,1.36783191,-135.415354264
219.805571,15.24,18.288,35.773504272,3.252136752,1.9838035,-196.396538372
230.194429,16.51,19.812,162.6068376,3.252136752,1.9838035,-196.396538372
239.036243,17.272,21.082,56.628832894,4.356064186,1.481061808,-146.625116452
236.309932,18.288,22.606,56.357539812,7.04469254,1.831620162,-89.74938235
213.690068,19.05,23.114,35.223462446,7.04469254,0.915809954,-90.665192304
198.434949,19.812,23.368,56.225296744,8.032185358,0.803218612,-79.518633952
0,18.796,23.368,0,25.4,1.016,-24.384
345.963757,17.78,23.622,24.6416195,6.160405002,1.047268924,-103.679614078
338.198591,16.51,24.13,80.18324705,4.716661636,1.36783191,-135.415354264
45,7.366,22.606,17.960512212,17.960512212,1.796051272,-34.124973152
71.565051,6.858,21.082,24.09655582,8.032185358,1.60643697,-78.715415594
81.869898,6.604,19.304,25.144717046,3.592102544,1.796051272,-177.809071102
;0,5.08,19.304,0,25.4,1.524,-23.876
53.130102,4.826,21.844,91.44,5.08,1.27,-125.73
45,3.556,20.574,17.960512212,17.960512212,1.796051272,-34.124973152
36.869898,2.54,19.812,35.56,5.08,1.27,-125.73
18.434949,1.016,19.304,56.225296744,8.032185358,1.60643697,-78.715415594
0,0,19.304,0,25.4,1.016,-24.384
0,24.384,19.304,0,25.4,1.016,-24.384
345.963757,23.368,19.558,24.6416195,6.160405002,1.047268924,-103.679614078
333.434949,22.352,20.066,22.718450626,11.35922544,1.135922544,-55.660204148
315,21.844,20.574,17.960512212,17.960512212,0.718420458,-35.202603966
306.869898,21.082,21.59,35.56,5.08,1.27,-125.73
11.309932,19.812,21.336,104.608346536,4.981349956,1.29515108,-128.219944728
180,21.082,22.352,0,25.4,1.524,-23.876
261.869898,21.336,24.13,25.144717046,3.592102544,1.796051272,-177.809071102
248.198591,21.844,25.4,80.18324705,4.716661636,1.36783191,-135.415354264
333.434949,14.986,24.892,22.718450626,11.35922544,1.703883816,-55.092242876
348.690068,13.716,25.146,24.906749272,4.981349956,1.29515108,-128.219944728
0,11.684,25.146,0,25.4,2.032,-23.368
18.434949,10.16,24.638,56.225296744,8.032185358,1.60643697,-78.715415594
26.565051,8.636,23.876,34.077676066,11.35922544,1.703883816,-55.092242876
45,7.112,25.146,17.960512212,17.960512212,0.359210356,-35.561814322
56.309932,6.604,24.384,56.357539812,7.04469254,0.915809954,-90.665192304
56.309932,5.588,22.86,56.357539812,7.04469254,1.831620162,-89.74938235
53.130102,24.638,4.064,91.44,5.08,1.27,-125.73
38.659808,23.368,3.048,35.701322044,3.966813504,1.626393496,-161.0129622
9.462322,21.844,2.794,129.447762694,4.175734346,1.545021802,-152.95714646
345.963757,20.828,3.048,24.6416195,6.160405002,1.047268924,-103.679614078
326.309932,20.066,3.556,56.357539812,7.04469254,0.915809954,-90.665192304
225,20.828,7.366,17.960512212,17.960512212,1.077630814,-34.843393864
213.690068,21.59,7.874,35.223462446,7.04469254,0.915809954,-90.665192304
191.309932,22.86,8.128,104.608346536,4.981349956,1.29515108,-128.219944728
180,24.13,8.128,0,25.4,1.27,-24.13
158.198591,25.4,7.62,80.18324705,4.716661636,1.36783191,-135.415354264
233.130102,22.606,1.016,91.44,5.08,1.27,-125.73
216.869898,23.622,1.778,35.56,5.08,1.27,-125.73
206.565051,24.638,2.286,34.077676066,11.35922544,1.135922544,-55.660204148
198.434949,25.4,2.54,56.225296744,8.032185358,0.803218612,-79.518633952
30.963757,24.13,9.652,91.477345366,4.356064186,1.481061808,-146.625116452
14.036243,23.114,9.398,80.085263502,6.160405002,1.047268924,-103.679614078
0,21.082,9.398,0,25.4,2.032,-23.368
348.690068,19.812,9.652,24.906749272,4.981349956,1.29515108,-128.219944728
216.869898,20.574,17.272,35.56,5.08,1.27,-125.73
198.434949,22.86,18.034,56.225296744,8.032185358,2.409655582,-77.912196982
180,25.4,18.034,0,25.4,2.54,-22.86
`));ie(ee.ParsePatFile(`
*LEAF-03,LEAF-03
;By John Hyslop,    Using AutoCAD Lisp Tool
;Developed in mm as metric QCAD3 pattern
344.054604,21.844,9.652,104.668749768,3.488958224,1.84914794,-183.065643266
338.198591,20.574,10.16,80.18324705,4.716661636,1.36783191,-135.415354264
326.309932,19.05,11.176,56.357539812,7.04469254,1.831620162,-89.74938235
320.194429,17.526,12.446,162.6068376,3.252136752,1.9838035,-196.396538372
308.659808,16.51,13.716,35.701322044,3.966813504,1.626393496,-161.0129622
300.963757,15.748,14.986,91.477345366,4.356064186,1.481061808,-146.625116452
293.198591,14.986,16.764,56.698117744,3.335183322,1.934406342,-191.506230398
281.309932,14.732,18.034,104.608346536,4.981349956,1.29515108,-128.219944728
276.340192,14.478,20.32,204.76213556,2.804960862,2.30006779,-227.706714766
270,14.478,21.59,0,25.4,1.27,-24.13
257.471192,14.986,23.876,129.485790304,2.755016842,2.341764176,-231.834664854
164.054604,16.764,23.368,104.668749768,3.488958224,1.84914794,-183.065643266
158.198591,18.034,22.86,80.18324705,4.716661636,1.36783191,-135.415354264
146.309932,19.558,21.844,56.357539812,7.04469254,1.831620162,-89.74938235
140.194429,21.082,20.574,162.6068376,3.252136752,1.9838035,-196.396538372
125.537678,22.352,18.796,126.965671138,2.952690056,2.18499055,-216.314071054
116.565051,23.368,16.764,34.077676066,11.35922544,2.271845088,-54.524281604
105.945396,23.876,14.986,80.246041438,3.488958224,1.84914794,-183.065643266
97.125016,24.13,12.954,179.577488698,3.150482142,2.047813532,-202.733533318
90,24.13,11.43,0,25.4,1.524,-23.876
77.471192,23.622,9.144,129.485790304,2.755016842,2.341764176,-231.834664854
195.945396,3.556,9.652,80.246041438,3.488958224,1.84914794,-183.065643266
201.801409,4.826,10.16,56.599939124,4.716661636,1.36783191,-135.415354264
213.690068,6.35,11.176,35.223462446,7.04469254,1.831620162,-89.74938235
219.805571,7.874,12.446,35.773504272,3.252136752,1.9838035,-196.396538372
231.340192,8.89,13.716,126.938033652,3.966813504,1.626393496,-161.0129622
239.036243,9.652,14.986,56.628832894,4.356064186,1.481061808,-146.625116452
246.801409,10.414,16.764,136.74251925,3.335183322,1.934406342,-191.506230398
258.690068,10.668,18.034,24.906749272,4.981349956,1.29515108,-128.219944728
263.659808,10.922,20.32,25.244646742,2.804960862,2.30006779,-227.706714766
270,10.922,21.59,0,25.4,1.27,-24.13
282.528808,10.414,23.876,104.69063898,2.755016842,2.341764176,-231.834664854
15.945396,8.636,23.368,80.246041438,3.488958224,1.84914794,-183.065643266
21.801409,7.366,22.86,56.599939124,4.716661636,1.36783191,-135.415354264
33.690068,5.842,21.844,35.223462446,7.04469254,1.831620162,-89.74938235
39.805571,4.318,20.574,35.773504272,3.252136752,1.9838035,-196.396538372
54.462322,3.048,18.796,91.53339072,2.952690056,2.18499055,-216.314071054
63.434949,2.032,16.764,22.718450626,11.35922544,2.271845088,-54.524281604
74.054604,1.524,14.986,104.668749768,3.488958224,1.84914794,-183.065643266
82.874984,1.27,12.954,25.203858152,3.150482142,2.047813532,-202.733533318
90,1.27,11.43,0,25.4,1.524,-23.876
102.528808,1.778,9.144,104.69063898,2.755016842,2.341764176,-231.834664854
128.659808,5.334,3.81,35.701322044,3.966813504,1.626393496,-161.0129622
146.309932,6.858,2.794,56.357539812,7.04469254,1.831620162,-89.74938235
153.434949,8.382,2.032,22.718450626,11.35922544,1.703883816,-55.092242876
164.054604,10.16,1.524,104.668749768,3.488958224,1.84914794,-183.065643266
171.869898,11.938,1.27,25.144717046,3.592102544,1.796051272,-177.809071102
180,13.462,1.27,0,25.4,1.524,-23.876
188.130102,15.24,1.524,154.460405328,3.592102544,1.796051272,-177.809071102
195.945396,17.018,2.032,80.246041438,3.488958224,1.84914794,-183.065643266
206.565051,18.542,2.794,34.077676066,11.35922544,1.703883816,-55.092242876
218.659808,19.812,3.81,35.701322044,3.966813504,1.626393496,-161.0129622
225,21.082,5.08,17.960512212,17.960512212,1.796051272,-34.124973152
315,19.812,6.35,17.960512212,17.960512212,1.796051272,-34.124973152
321.340192,18.542,7.366,126.938033652,3.966813504,1.626393496,-161.0129622
336.801409,16.764,8.128,136.74251925,3.335183322,1.934406342,-191.506230398
341.565051,15.24,8.636,24.09655582,8.032185358,1.60643697,-78.715415594
351.869898,13.462,8.89,25.144717046,3.592102544,1.796051272,-177.809071102
0,11.938,8.89,0,25.4,1.524,-23.876
8.130102,10.16,8.636,154.460405328,3.592102544,1.796051272,-177.809071102
18.434949,8.636,8.128,56.225296744,8.032185358,1.60643697,-78.715415594
23.198591,6.858,7.366,56.698117744,3.335183322,1.934406342,-191.506230398
38.659808,5.588,6.35,35.701322044,3.966813504,1.626393496,-161.0129622
45,4.318,5.08,17.960512212,17.960512212,1.796051272,-34.124973152
`));ie(ee.ParsePatFile(`
*LINE,LINE
0, 0,0, 0,3.175
`));ie(ee.ParsePatFile(`
*LOOPLINKS,LOOPLINKS
;By John Hyslop,    Using AutoCAD Lisp Tool
;Developed in mm as metric QCAD3 pattern
206.565051,13.462,17.018,34.077676066,11.35922544,0.567961272,-56.22816542
243.434949,13.716,17.526,22.718450626,11.35922544,0.567961272,-56.22816542
116.565051,11.938,17.018,34.077676066,11.35922544,0.567961272,-56.22816542
153.434949,12.446,16.764,22.718450626,11.35922544,0.567961272,-56.22816542
180,12.954,16.764,0,25.4,0.508,-24.892
258.690068,4.826,14.986,24.906749272,4.981349956,1.29515108,-128.219944728
251.565051,5.08,15.748,24.09655582,8.032185358,0.803218612,-79.518633952
243.434949,5.588,16.764,22.718450626,11.35922544,1.135922544,-55.660204148
230.194429,6.858,18.288,162.6068376,3.252136752,1.9838035,-196.396538372
225,7.874,19.304,17.960512212,17.960512212,1.436840916,-34.484183508
209.744881,9.652,20.32,148.072666262,3.150482142,2.047813532,-202.733533318
194.036243,11.684,20.828,80.085263502,6.160405002,2.094537594,-102.632345154
251.565051,7.112,15.24,24.09655582,8.032185358,1.60643697,-78.715415594
239.036243,7.874,16.51,56.628832894,4.356064186,1.481061808,-146.625116452
225,8.89,17.526,17.960512212,17.960512212,1.436840916,-34.484183508
210.963757,10.16,18.288,91.477345366,4.356064186,1.481061808,-146.625116452
198.434949,11.684,18.796,56.225296744,8.032185358,1.60643697,-78.715415594
116.565051,17.018,11.938,34.077676066,11.35922544,0.567961272,-56.22816542
153.434949,17.526,11.684,22.718450626,11.35922544,0.567961272,-56.22816542
26.565051,17.018,13.462,34.077676066,11.35922544,0.567961272,-56.22816542
63.434949,16.764,12.954,22.718450626,11.35922544,0.567961272,-56.22816542
90,16.764,12.446,0,25.4,0.508,-24.892
168.690068,14.986,20.574,24.906749272,4.981349956,1.29515108,-128.219944728
161.565051,15.748,20.32,24.09655582,8.032185358,0.803218612,-79.518633952
153.434949,16.764,19.812,22.718450626,11.35922544,1.135922544,-55.660204148
140.194429,18.288,18.542,162.6068376,3.252136752,1.9838035,-196.396538372
135,19.304,17.526,17.960512212,17.960512212,1.436840916,-34.484183508
119.744881,20.32,15.748,148.072666262,3.150482142,2.047813532,-202.733533318
104.036243,20.828,13.716,80.085263502,6.160405002,2.094537594,-102.632345154
161.565051,15.24,18.288,24.09655582,8.032185358,1.60643697,-78.715415594
149.036243,16.51,17.526,56.628832894,4.356064186,1.481061808,-146.625116452
135,17.526,16.51,17.960512212,17.960512212,1.436840916,-34.484183508
120.963757,18.288,15.24,91.477345366,4.356064186,1.481061808,-146.625116452
108.434949,18.796,13.716,56.225296744,8.032185358,1.60643697,-78.715415594
26.565051,11.938,8.382,34.077676066,11.35922544,0.567961272,-56.22816542
63.434949,11.684,7.874,22.718450626,11.35922544,0.567961272,-56.22816542
296.565051,13.462,8.382,34.077676066,11.35922544,0.567961272,-56.22816542
333.434949,12.954,8.636,22.718450626,11.35922544,0.567961272,-56.22816542
0,12.446,8.636,0,25.4,0.508,-24.892
78.690068,20.574,10.414,24.906749272,4.981349956,1.29515108,-128.219944728
71.565051,20.32,9.652,24.09655582,8.032185358,0.803218612,-79.518633952
63.434949,19.812,8.636,22.718450626,11.35922544,1.135922544,-55.660204148
50.194429,18.542,7.112,162.6068376,3.252136752,1.9838035,-196.396538372
45,17.526,6.096,17.960512212,17.960512212,1.436840916,-34.484183508
29.744881,15.748,5.08,148.072666262,3.150482142,2.047813532,-202.733533318
14.036243,13.716,4.572,80.085263502,6.160405002,2.094537594,-102.632345154
71.565051,18.288,10.16,24.09655582,8.032185358,1.60643697,-78.715415594
59.036243,17.526,8.89,56.628832894,4.356064186,1.481061808,-146.625116452
45,16.51,7.874,17.960512212,17.960512212,1.436840916,-34.484183508
30.963757,15.24,7.112,91.477345366,4.356064186,1.481061808,-146.625116452
18.434949,13.716,6.604,56.225296744,8.032185358,1.60643697,-78.715415594
296.565051,8.382,13.462,34.077676066,11.35922544,0.567961272,-56.22816542
333.434949,7.874,13.716,22.718450626,11.35922544,0.567961272,-56.22816542
206.565051,8.382,11.938,34.077676066,11.35922544,0.567961272,-56.22816542
243.434949,8.636,12.446,22.718450626,11.35922544,0.567961272,-56.22816542
270,8.636,12.954,0,25.4,0.508,-24.892
348.690068,10.414,4.826,24.906749272,4.981349956,1.29515108,-128.219944728
341.565051,9.652,5.08,24.09655582,8.032185358,0.803218612,-79.518633952
333.434949,8.636,5.588,22.718450626,11.35922544,1.135922544,-55.660204148
320.194429,7.112,6.858,162.6068376,3.252136752,1.9838035,-196.396538372
315,6.096,7.874,17.960512212,17.960512212,1.436840916,-34.484183508
299.744881,5.08,9.652,148.072666262,3.150482142,2.047813532,-202.733533318
284.036243,4.572,11.684,80.085263502,6.160405002,2.094537594,-102.632345154
341.565051,10.16,7.112,24.09655582,8.032185358,1.60643697,-78.715415594
329.036243,8.89,7.874,56.628832894,4.356064186,1.481061808,-146.625116452
315,7.874,8.89,17.960512212,17.960512212,1.436840916,-34.484183508
300.963757,7.112,10.16,91.477345366,4.356064186,1.481061808,-146.625116452
288.434949,6.604,11.684,56.225296744,8.032185358,1.60643697,-78.715415594
90,11.684,-7.874,0,25.4,15.748,-9.652
270,13.716,7.874,0,25.4,15.748,-9.652
180,7.874,11.684,0,25.4,15.748,-9.652
0,-7.874,13.716,0,25.4,15.748,-9.652
`));ie(ee.ParsePatFile(`
*MAZE-01
;By John Hyslop,    Tile2Hatch tool \xA9 CVH 2020
;Developed in mm as metric QCAD3 pattern
180,24.13,23.368,0,25.4,6.35,-19.05
90,24.13,13.97,25.4,25.4,9.398,-16.002
90,21.082,13.97,25.4,25.4,6.35,-19.05
0,17.78,10.668,0,25.4,2.794,-22.606
180,14.478,20.32,0,25.4,9.652,-15.748
270,14.478,23.368,25.4,25.4,3.048,-22.352
0,1.778,23.368,0,25.4,12.7,-12.7
90,24.13,7.366,25.4,25.4,3.302,-22.098
180,11.43,1.27,0,25.4,9.652,-15.748
0,17.78,7.366,0,25.4,6.35,-19.05
270,11.43,4.318,25.4,25.4,3.048,-22.352
0,4.826,4.318,0,25.4,6.604,-18.796
90,17.78,4.318,25.4,25.4,3.048,-22.352
270,4.826,20.32,25.4,25.4,16.002,-9.398
0,7.874,7.366,0,25.4,6.604,-18.796
270,7.874,17.272,25.4,25.4,9.906,-15.494
180,17.78,17.272,0,25.4,9.906,-15.494
270,17.78,23.368,25.4,25.4,6.096,-19.304
180,24.13,4.318,0,25.4,6.35,-19.05
90,24.13,1.27,25.4,25.4,3.048,-22.352
0,14.478,1.27,0,25.4,9.652,-15.748
270,14.478,10.668,25.4,25.4,9.398,-16.002
270,17.78,13.97,25.4,25.4,3.302,-22.098
0,11.43,13.97,0,25.4,6.35,-19.05
90,11.43,10.668,25.4,25.4,3.302,-22.098
90,1.778,1.27,25.4,25.4,22.098,-3.302
`));ie(ee.ParsePatFile(`
*MAZE-02
;By John Hyslop,    Tile2Hatch tool \xA9 CVH 2020
;Developed in mm as metric QCAD3 pattern
270,22.859999746,2.54,25.4,25.4,2.54,-22.86
0,17.779999746,2.54,0,25.4,5.08,-20.32
90,0,7.62,25.4,25.4,12.7,-12.7
270,22.859999746,22.86,25.4,25.4,12.7,-12.7
270,7.619999746,22.86,25.4,25.4,2.54,-22.86
180,7.619999746,22.86,0,25.4,10.16,-15.24
0,5.079999746,5.08,0,25.4,3.81,-21.59
90,5.079999746,7.62,25.4,25.4,5.08,-20.32
180,12.699999746,7.62,0,25.4,7.62,-17.78
90,12.699999746,2.54,25.4,25.4,5.08,-20.32
270,17.779999746,5.08,25.4,25.4,2.54,-22.86
0,15.239999746,5.08,0,25.4,2.54,-22.86
270,15.239999746,7.62,25.4,25.4,2.54,-22.86
180,17.779999746,7.62,0,25.4,2.54,-22.86
270,15.239999746,15.24,25.4,25.4,2.54,-22.86
0,7.619999746,15.24,0,25.4,7.62,-17.78
90,7.619999746,10.16,25.4,25.4,5.08,-20.32
180,17.779999746,10.16,0,25.4,10.16,-15.24
180,15.239999746,12.7,0,25.4,5.08,-20.32
270,20.319999746,20.32,25.4,25.4,12.7,-12.7
0,2.539999746,2.54,0,25.4,10.16,-15.24
0,2.539999746,20.32,0,25.4,17.78,-7.62
270,2.539999746,5.08,25.4,25.4,2.54,-22.86
90,2.539999746,7.62,25.4,25.4,12.7,-12.7
180,2.539999746,5.08,0,25.4,7.62,-17.78
180,0,7.62,0,25.4,5.080000254,-20.319999746
180,7.619999746,0,0,25.4,7.62,-17.78
270,17.779999746,17.78,25.4,25.4,5.08,-20.32
0,10.159999746,0,0,25.4,10.16,-15.24
0,5.079999746,17.78,0,25.4,12.7,-12.7
90,5.079999746,15.24,25.4,25.4,2.54,-22.86
270,15.239999746,2.54,25.4,25.4,2.54,-22.86
0,10.159999746,22.86,0,25.4,10.16,-15.24
270,10.159999746,25.4,25.4,25.4,2.54,-22.86
`));ie(ee.ParsePatFile(`
*MUDST,MUDST
0, 0,0, 12.7,6.35, 6.35,-6.35,0,-6.35,0,-6.35
`));ie(ee.ParsePatFile(`
*NET,NET
0, 0,0, 0,3.175
90, 0,0, 0,3.175
`));ie(ee.ParsePatFile(`
*NET3,NET3
0, 0,0, 0,3.175
60, 0,0, 0,3.175
120, 0,0, 0,3.175
`));ie(ee.ParsePatFile(`
*PLAST,PLAST
0, 0,0, 0,6.35
0, 0,.79375, 0,6.35
0, 0,1.5875, 0,6.35
`));ie(ee.ParsePatFile(`
*PLASTI,PLASTI
0, 0,0, 0,6.35
0, 0,.79375, 0,6.35
0, 0,1.5875, 0,6.35
0, 0,3.96875, 0,6.35
`));ie(ee.ParsePatFile(`
*QCAD-LOGO
;By John Hyslop,    Line 101 modified by CVH to fix left side of pencil drift when hatching far from Origin
;Developed in mm as metric QCAD3 pattern
243.434949,20.32,9.144,22.718450626,11.35922544,0.567961272,-56.22816542
248.198591,20.828,10.414,80.18324705,4.716661636,1.36783191,-135.415354264
263.659808,21.082,12.7,25.244646742,2.804960862,2.30006779,-227.706714766
276.340192,20.828,14.986,204.76213556,2.804960862,2.30006779,-227.706714766
290.556045,20.066,17.018,136.750876358,2.97284521,2.170177016,-214.847518234
310.601295,18.542,18.796,35.815218692,2.755016842,2.341764176,-231.834664854
324.462322,16.764,20.066,91.53339072,2.952690056,2.18499055,-216.314071054
336.801409,14.986,20.828,136.74251925,3.335183322,1.934406342,-191.506230398
351.869898,13.208,21.082,25.144717046,3.592102544,1.796051272,-177.809071102
26.565051,15.494,4.572,34.077676066,11.35922544,1.703883816,-55.092242876
7.125016,13.462,4.318,179.577488698,3.150482142,2.047813532,-202.733533318
0,11.43,4.318,0,25.4,2.032,-23.368
344.054604,9.652,4.826,104.668749768,3.488958224,1.84914794,-183.065643266
336.801409,7.874,5.588,136.74251925,3.335183322,1.934406342,-191.506230398
320.194429,6.35,6.858,162.6068376,3.252136752,1.9838035,-196.396538372
308.659808,5.334,8.128,35.701322044,3.966813504,1.626393496,-161.0129622
293.198591,4.572,9.906,56.698117744,3.335183322,1.934406342,-191.506230398
285.945396,4.064,11.684,80.246041438,3.488958224,1.84914794,-183.065643266
270,4.064,13.208,0,25.4,1.524,-23.876
261.869898,4.318,14.986,25.144717046,3.592102544,1.796051272,-177.809071102
246.801409,5.08,16.764,136.74251925,3.335183322,1.934406342,-191.506230398
234.462322,6.35,18.542,91.53339072,2.952690056,2.18499055,-216.314071054
219.805571,7.874,19.812,35.773504272,3.252136752,1.9838035,-196.396538372
206.565051,9.398,20.574,34.077676066,11.35922544,1.703883816,-55.092242876
195.945396,11.176,21.082,80.246041438,3.488958224,1.84914794,-183.065643266
180,12.192,21.082,0,25.4,1.016,-24.384
180,13.208,21.082,0,25.4,1.016,-24.384
233.130102,23.368,6.858,91.44,5.08,1.27,-125.73
248.198591,23.876,8.128,80.18324705,4.716661636,1.36783191,-135.415354264
248.198591,24.384,9.398,80.18324705,4.716661636,1.36783191,-135.415354264
260.537678,24.638,10.922,25.054405568,4.175734346,1.545021802,-152.95714646
261.869898,24.892,12.7,25.144717046,3.592102544,1.796051272,-177.809071102
278.130102,24.638,14.478,154.460405328,3.592102544,1.796051272,-177.809071102
279.462322,24.384,16.002,129.447762694,4.175734346,1.545021802,-152.95714646
288.434949,23.876,17.526,56.225296744,8.032185358,1.60643697,-78.715415594
299.744881,22.86,19.304,148.072666262,3.150482142,2.047813532,-202.733533318
308.659808,21.844,20.574,35.701322044,3.966813504,1.626393496,-161.0129622
315,20.574,21.844,17.960512212,17.960512212,1.796051272,-34.124973152
321.340192,19.304,22.86,126.938033652,3.966813504,1.626393496,-161.0129622
329.036243,18.034,23.622,56.628832894,4.356064186,1.481061808,-146.625116452
338.198591,16.764,24.13,80.18324705,4.716661636,1.36783191,-135.415354264
338.198591,15.494,24.638,80.18324705,4.716661636,1.36783191,-135.415354264
350.537678,13.97,24.892,25.054405568,4.175734346,1.545021802,-152.95714646
0,12.7,24.892,0,25.4,1.27,-24.13
0,11.43,24.892,0,25.4,1.27,-24.13
11.309932,10.16,24.638,104.608346536,4.981349956,1.29515108,-128.219944728
14.036243,9.144,24.384,80.085263502,6.160405002,1.047268924,-103.679614078
21.801409,7.874,23.876,56.599939124,4.716661636,1.36783191,-135.415354264
21.801409,6.604,23.368,56.599939124,4.716661636,1.36783191,-135.415354264
36.869898,5.588,22.606,35.56,5.08,1.27,-125.73
36.869898,4.572,21.844,35.56,5.08,1.27,-125.73
33.690068,19.05,2.286,35.223462446,7.04469254,0.915809954,-90.665192304
26.565051,17.526,1.524,34.077676066,11.35922544,1.703883816,-55.092242876
21.801409,16.256,1.016,56.599939124,4.716661636,1.36783191,-135.415354264
11.309932,14.986,0.762,104.608346536,4.981349956,1.29515108,-128.219944728
8.130102,13.208,0.508,154.460405328,3.592102544,1.796051272,-177.809071102
0,11.684,0.508,0,25.4,1.524,-23.876
350.537678,10.16,0.762,25.054405568,4.175734346,1.545021802,-152.95714646
348.690068,8.89,1.016,24.906749272,4.981349956,1.29515108,-128.219944728
338.198591,7.62,1.524,80.18324705,4.716661636,1.36783191,-135.415354264
333.434949,6.604,2.032,22.718450626,11.35922544,1.135922544,-55.660204148
323.130102,5.588,2.794,91.44,5.08,1.27,-125.73
323.130102,4.572,3.556,91.44,5.08,1.27,-125.73
315,3.556,4.572,17.960512212,17.960512212,1.436840916,-34.484183508
306.869898,2.794,5.588,35.56,5.08,1.27,-125.73
306.869898,2.032,6.604,35.56,5.08,1.27,-125.73
296.565051,1.524,7.62,34.077676066,11.35922544,1.135922544,-55.660204148
291.801409,1.016,8.89,56.599939124,4.716661636,1.36783191,-135.415354264
281.309932,0.762,10.16,104.608346536,4.981349956,1.29515108,-128.219944728
281.309932,0.508,11.43,104.608346536,4.981349956,1.29515108,-128.219944728
270,0.508,12.7,0,25.4,1.27,-24.13
270,0.508,13.97,0,25.4,1.27,-24.13
258.690068,0.762,15.24,24.906749272,4.981349956,1.29515108,-128.219944728
258.690068,1.016,16.51,24.906749272,4.981349956,1.29515108,-128.219944728
248.198591,1.524,17.78,80.18324705,4.716661636,1.36783191,-135.415354264
243.434949,2.032,18.796,22.718450626,11.35922544,1.135922544,-55.660204148
233.130102,2.794,19.812,91.44,5.08,1.27,-125.73
233.130102,3.556,20.828,91.44,5.08,1.27,-125.73
225,4.572,21.844,17.960512212,17.960512212,1.436840916,-34.484183508
0,8.89,5.334,0,25.4,7.366,-18.034
180,14.224,9.906,0,25.4,1.016,-24.384
270,14.224,11.176,0,25.4,1.27,-24.13
180,15.748,11.176,0,25.4,1.524,-23.876
270,15.748,12.192,0,25.4,1.016,-24.384
270,24.892,2.794,0,25.4,0.254,-25.146
270,24.892,3.302,0,25.4,0.508,-24.892
45,20.828,2.032,17.960512212,17.960512212,3.592102544,-32.328922134
225,22.86,5.08,17.960512212,17.960512212,3.592102544,-32.328922134
45,20.066,2.794,17.960512212,17.960512212,3.592102544,-32.328922134
0,13.8209782,14.218285,0,25.4,0,-25.4
0,14.9935692,16.1227008,0,25.4,0,-25.4
0,16.2642042,18.3038496,0,25.4,0,-25.4
135,24.892,3.302,17.960512212,17.960512212,12.57235865,-23.348666028
56.309932,24.384,1.778,56.357539812,7.04469254,0.915809954,-90.665192304
45,23.876,1.27,17.960512212,17.960512212,0.718420458,-35.202603966
33.690068,23.114,0.762,35.223462446,7.04469254,0.915809954,-90.665192304
18.434949,22.352,0.508,56.225296744,8.032185358,0.803218612,-79.518633952
135.806929,22.352,0.508,-35.917462074,0.505879862,12.753228494,-1262.569616842
289.983107,12.192,12.192,217.006845132,2.170068558,2.9729938,-294.326383914
338.198591,13.462,13.208,80.18324705,4.716661636,2.73566382,-134.047522354
105.945396,12.192,12.192,80.246041438,3.488958224,1.84914794,-183.065643266
218.659808,13.462,13.208,35.701322044,3.966813504,1.626393496,-161.0129622
336.801409,11.684,13.97,136.74251925,3.335183322,1.934406342,-191.506230398
56.309932,16.764,19.177,56.357539812,7.04469254,0.457905104,-91.123097408
239.036243,12.065,11.049,56.628832894,4.356064186,0.740530904,-147.365647356
236.309932,14.478,15.24,56.357539812,7.04469254,0.457905104,-91.123097408
236.309932,15.748,17.272,56.357539812,7.04469254,0.457905104,-91.123097408
0,11.684,10.414,0,25.4,0,-25.4
0,12.446,8.636,0,25.4,0.508,-24.892
0,13.716,8.636,0,25.4,0,-25.4
0,11.43,8.636,0,25.4,0,-25.4
0,9.144,8.636,0,25.4,0,-25.4
0,6.858,8.636,0,25.4,0,-25.4
180,6.096,8.636,0,25.4,0.762,-24.638
180,8.382,8.636,0,25.4,0.762,-24.638
180,10.668,8.636,0,25.4,0.762,-24.638
239.036243,11.43,9.906,56.628832894,4.356064186,1.481061808,-146.625116452
0,11.176,11.176,0,25.4,1.27,-24.13
341.565051,10.414,11.43,24.09655582,8.032185358,0.803218612,-79.518633952
315,9.906,11.938,17.960512212,17.960512212,0.718420458,-35.202603966
296.565051,9.652,12.446,34.077676066,11.35922544,0.567961272,-56.22816542
180,9.652,12.446,0,25.4,5.334,-20.066
240.068488,14.478,20.828,204.780260492,0.667036766,9.672031964,-957.531152498
0,16.002,12.446,0,25.4,4.572,-20.828
240.255119,19.05,17.78,56.708680588,3.150482142,6.143440342,-198.637906508
`));ie(ee.ParsePatFile(`
*REDBACK,REDBACK
;By John Hyslop
;Developed in mm as Metric QCAD3 pattern
63.434949,18.542,19.812,22.71845063,11.35922544,0.567961272,-56.22816542
33.690068,17.78,19.304,35.22346245,7.04469254,0.915809954,-90.6651923
75.963757,17.526,18.288,24.6416195,6.160405002,1.047268924,-103.6796141
0,16.764,18.288,0,25.4,0.762,-24.638
108.434949,17.018,17.526,56.22529674,8.032185358,0.803218612,-79.51863395
90,17.018,17.272,0,25.4,0.254,-25.146
0,13.716,14.478,0,25.4,0.254,-25.146
270,13.716,14.732,0,25.4,0.254,-25.146
225,13.97,14.986,17.96051221,17.96051221,0.359210356,-35.56181432
180,14.224,14.986,0,25.4,0.254,-25.146
315,13.97,15.24,17.96051221,17.96051221,0.359210356,-35.56181432
15.524111,9.398,13.97,184.9097925,1.359630758,4.745111668,-469.7660475
0,8.89,13.97,0,25.4,0.508,-24.892
45,8.636,13.716,17.96051221,17.96051221,0.359210356,-35.56181432
0,7.874,13.716,0,25.4,0.762,-24.638
26.565051,4.826,12.192,34.07767607,11.35922544,3.407767632,-53.38835906
0,4.572,12.192,0,25.4,0.254,-25.146
33.690068,3.81,11.684,35.22346245,7.04469254,0.915809954,-90.6651923
32.005383,1.778,10.414,91.54141687,2.692394666,2.396231174,-237.2268895
45,1.524,10.16,17.96051221,17.96051221,0.359210356,-35.56181432
270,1.524,10.414,0,25.4,0.254,-25.146
225,1.778,10.668,17.96051221,17.96051221,0.359210356,-35.56181432
213.690068,4.064,12.192,35.22346245,7.04469254,2.747430116,-88.8335724
243.434949,4.318,12.7,22.71845063,11.35922544,0.567961272,-56.22816542
205.016893,8.128,14.478,56.77539445,1.534470134,4.20444803,-416.2403639
189.462322,9.652,14.732,129.4477627,4.175734346,1.545021802,-152.9571465
194.036243,10.668,14.986,80.0852635,6.160405002,1.047268924,-103.6796141
194.036243,12.7,15.494,80.0852635,6.160405002,2.094537594,-102.6323452
198.434949,14.224,16.002,56.22529674,8.032185358,1.60643697,-78.71541559
6.340192,11.938,15.748,204.7621356,2.804960862,2.30006779,-227.7067148
315,11.684,16.002,17.96051221,17.96051221,0.359210356,-35.56181432
45,11.43,15.748,17.96051221,17.96051221,0.359210356,-35.56181432
23.198591,9.652,14.986,56.69811774,3.335183322,1.934406342,-191.5062304
0,8.89,14.986,0,25.4,0.762,-24.638
45,8.128,14.224,17.96051221,17.96051221,1.077630814,-34.84339386
236.309932,8.636,14.986,56.35753981,7.04469254,0.915809954,-90.6651923
206.565051,9.144,15.24,34.07767607,11.35922544,0.567961272,-56.22816542
206.565051,10.668,16.002,34.07767607,11.35922544,1.703883816,-55.09224288
206.565051,11.176,16.256,34.07767607,11.35922544,0.567961272,-56.22816542
206.565051,11.684,16.51,34.07767607,11.35922544,0.567961272,-56.22816542
180,14.478,16.51,0,25.4,2.794,-22.606
225,14.732,16.764,17.96051221,17.96051221,0.359210356,-35.56181432
321.340192,13.462,17.78,126.9380337,3.966813504,1.626393496,-161.0129622
296.565051,13.208,18.288,34.07767607,11.35922544,0.567961272,-56.22816542
285.945396,12.7,20.066,80.24604144,3.488958224,1.84914794,-183.0656433
254.054604,13.208,21.844,104.6687498,3.488958224,1.84914794,-183.0656433
135,13.462,21.59,17.96051221,17.96051221,0.359210356,-35.56181432
90,13.462,20.828,0,25.4,0.762,-24.638
71.565051,13.208,20.066,24.09655582,8.032185358,0.803218612,-79.51863395
105.945396,13.716,18.288,80.24604144,3.488958224,1.84914794,-183.0656433
135,14.732,17.272,17.96051221,17.96051221,1.436840916,-34.48418351
180,14.986,17.272,0,25.4,0.254,-25.146
270,14.986,17.526,0,25.4,0.254,-25.146
270,14.986,18.034,0,25.4,0.508,-24.892
296.565051,14.732,18.542,34.07767607,11.35922544,0.567961272,-56.22816542
278.130102,14.478,20.32,154.4604053,3.592102544,1.796051272,-177.8090711
251.565051,14.732,21.082,24.09655582,8.032185358,0.803218612,-79.51863395
225,14.986,21.336,17.96051221,17.96051221,0.359210356,-35.56181432
225,15.24,21.59,17.96051221,17.96051221,0.359210356,-35.56181432
243.434949,15.494,22.098,22.71845063,11.35922544,0.567961272,-56.22816542
243.434949,16.002,23.114,22.71845063,11.35922544,1.135922544,-55.66020415
243.434949,16.51,24.13,22.71845063,11.35922544,1.135922544,-55.66020415
225,16.764,24.384,17.96051221,17.96051221,0.359210356,-35.56181432
168.690068,20.574,23.622,24.90674927,4.981349956,3.885452986,-125.6296428
355.601295,17.272,23.876,25.32518405,1.9480911,3.31175487,-327.8637273
56.309932,16.764,23.114,56.35753981,7.04469254,0.915809954,-90.6651923
56.309932,16.256,22.352,56.35753981,7.04469254,0.915809954,-90.6651923
63.434949,16.002,21.844,22.71845063,11.35922544,0.567961272,-56.22816542
56.309932,15.494,21.082,56.35753981,7.04469254,0.915809954,-90.6651923
71.565051,15.24,20.32,24.09655582,8.032185358,0.803218612,-79.51863395
90,15.24,20.066,0,25.4,0.254,-25.146
90,15.24,19.558,0,25.4,0.508,-24.892
90,15.24,18.796,0,25.4,0.762,-24.638
225,15.494,19.05,17.96051221,17.96051221,0.359210356,-35.56181432
243.434949,15.748,19.558,22.71845063,11.35922544,0.567961272,-56.22816542
225,16.002,19.812,17.96051221,17.96051221,0.359210356,-35.56181432
206.565051,16.51,20.066,34.07767607,11.35922544,0.567961272,-56.22816542
206.565051,17.018,20.32,34.07767607,11.35922544,0.567961272,-56.22816542
180,17.526,20.32,0,25.4,0.508,-24.892
180,18.034,20.32,0,25.4,0.508,-24.892
180,18.796,20.32,0,25.4,0.762,-24.638
153.434949,19.304,20.066,22.71845063,11.35922544,0.567961272,-56.22816542
135,19.558,19.812,17.96051221,17.96051221,0.359210356,-35.56181432
135,14.224,14.224,17.96051221,17.96051221,0.359210356,-35.56181432
26.565051,19.558,18.796,34.07767607,11.35922544,0.567961272,-56.22816542
56.309932,19.05,18.034,56.35753981,7.04469254,0.915809954,-90.6651923
14.036243,18.034,17.78,80.0852635,6.160405002,1.047268924,-103.6796141
90,18.034,17.018,0,25.4,0.762,-24.638
341.565051,17.272,17.272,24.09655582,8.032185358,0.803218612,-79.51863395
0,17.018,17.272,0,25.4,0.254,-25.146
90,14.224,13.97,0,25.4,0.254,-25.146
180,14.478,13.97,0,25.4,0.254,-25.146
225,14.732,14.224,17.96051221,17.96051221,0.359210356,-35.56181432
270,14.732,14.478,0,25.4,0.254,-25.146
135,14.986,14.224,17.96051221,17.96051221,0.359210356,-35.56181432
74.475889,13.716,9.652,289.6013664,1.359630758,4.745111668,-469.7660475
90,13.716,9.144,0,25.4,0.508,-24.892
45,13.462,8.89,17.96051221,17.96051221,0.359210356,-35.56181432
90,13.462,8.128,0,25.4,0.762,-24.638
63.434949,11.938,5.08,22.71845063,11.35922544,3.407767632,-53.38835906
90,11.938,4.826,0,25.4,0.254,-25.146
56.309932,11.43,4.064,56.35753981,7.04469254,0.915809954,-90.6651923
57.994617,10.16,2.032,148.0817038,2.692394666,2.396231174,-237.2268895
45,9.906,1.778,17.96051221,17.96051221,0.359210356,-35.56181432
180,10.16,1.778,0,25.4,0.254,-25.146
225,10.414,2.032,17.96051221,17.96051221,0.359210356,-35.56181432
236.309932,11.938,4.318,56.35753981,7.04469254,2.747430116,-88.8335724
206.565051,12.446,4.572,34.07767607,11.35922544,0.567961272,-56.22816542
244.983107,14.224,8.382,363.6694177,1.534470134,4.20444803,-416.2403639
260.537678,14.478,9.906,25.05440557,4.175734346,1.545021802,-152.9571465
255.963757,14.732,10.922,24.6416195,6.160405002,1.047268924,-103.6796141
255.963757,15.24,12.954,24.6416195,6.160405002,2.094537594,-102.6323452
251.565051,15.748,14.478,24.09655582,8.032185358,1.60643697,-78.71541559
83.659808,15.494,12.192,25.24464674,2.804960862,2.30006779,-227.7067148
135,15.748,11.938,17.96051221,17.96051221,0.359210356,-35.56181432
45,15.494,11.684,17.96051221,17.96051221,0.359210356,-35.56181432
66.801409,14.732,9.906,136.7425193,3.335183322,1.934406342,-191.5062304
90,14.732,9.144,0,25.4,0.762,-24.638
45,13.97,8.382,17.96051221,17.96051221,1.077630814,-34.84339386
213.690068,14.732,8.89,35.22346245,7.04469254,0.915809954,-90.6651923
243.434949,14.986,9.398,22.71845063,11.35922544,0.567961272,-56.22816542
243.434949,15.748,10.922,22.71845063,11.35922544,1.703883816,-55.09224288
243.434949,16.002,11.43,22.71845063,11.35922544,0.567961272,-56.22816542
243.434949,16.256,11.938,22.71845063,11.35922544,0.567961272,-56.22816542
270,16.256,14.732,0,25.4,2.794,-22.606
225,16.51,14.986,17.96051221,17.96051221,0.359210356,-35.56181432
128.659808,17.526,13.716,35.70132204,3.966813504,1.626393496,-161.0129622
153.434949,18.034,13.462,22.71845063,11.35922544,0.567961272,-56.22816542
164.054604,19.812,12.954,104.6687498,3.488958224,1.84914794,-183.0656433
195.945396,21.59,13.462,80.24604144,3.488958224,1.84914794,-183.0656433
315,21.336,13.716,17.96051221,17.96051221,0.359210356,-35.56181432
0,20.574,13.716,0,25.4,0.762,-24.638
18.434949,19.812,13.462,56.22529674,8.032185358,0.803218612,-79.51863395
344.054604,18.034,13.97,104.6687498,3.488958224,1.84914794,-183.0656433
315,17.018,14.986,17.96051221,17.96051221,1.436840916,-34.48418351
270,17.018,15.24,0,25.4,0.254,-25.146
180,17.272,15.24,0,25.4,0.254,-25.146
180,17.78,15.24,0,25.4,0.508,-24.892
153.434949,18.288,14.986,22.71845063,11.35922544,0.567961272,-56.22816542
171.869898,20.066,14.732,25.14471705,3.592102544,1.796051272,-177.8090711
198.434949,20.828,14.986,56.22529674,8.032185358,0.803218612,-79.51863395
225,21.082,15.24,17.96051221,17.96051221,0.359210356,-35.56181432
225,21.336,15.494,17.96051221,17.96051221,0.359210356,-35.56181432
206.565051,21.844,15.748,34.07767607,11.35922544,0.567961272,-56.22816542
206.565051,22.86,16.256,34.07767607,11.35922544,1.135922544,-55.66020415
206.565051,23.876,16.764,34.07767607,11.35922544,1.135922544,-55.66020415
225,24.13,17.018,17.96051221,17.96051221,0.359210356,-35.56181432
281.309932,23.368,20.828,104.6083465,4.981349956,3.885452986,-125.6296428
94.398705,23.622,17.526,305.8502981,1.9480911,3.31175487,-327.8637273
33.690068,22.86,17.018,35.22346245,7.04469254,0.915809954,-90.6651923
33.690068,22.098,16.51,35.22346245,7.04469254,0.915809954,-90.6651923
26.565051,21.59,16.256,34.07767607,11.35922544,0.567961272,-56.22816542
33.690068,20.828,15.748,35.22346245,7.04469254,0.915809954,-90.6651923
18.434949,20.066,15.494,56.22529674,8.032185358,0.803218612,-79.51863395
0,19.812,15.494,0,25.4,0.254,-25.146
0,19.304,15.494,0,25.4,0.508,-24.892
0,18.542,15.494,0,25.4,0.762,-24.638
225,18.796,15.748,17.96051221,17.96051221,0.359210356,-35.56181432
206.565051,19.304,16.002,34.07767607,11.35922544,0.567961272,-56.22816542
225,19.558,16.256,17.96051221,17.96051221,0.359210356,-35.56181432
243.434949,19.812,16.764,22.71845063,11.35922544,0.567961272,-56.22816542
243.434949,20.066,17.272,22.71845063,11.35922544,0.567961272,-56.22816542
270,20.066,17.78,0,25.4,0.508,-24.892
270,20.066,18.288,0,25.4,0.508,-24.892
270,20.066,19.05,0,25.4,0.762,-24.638
296.565051,19.812,19.558,34.07767607,11.35922544,0.567961272,-56.22816542
315,19.558,19.812,17.96051221,17.96051221,0.359210356,-35.56181432
`));ie(ee.ParsePatFile(`
*SACNCR,SACNCR
45, 0,0, 0,2.38125
45, 1.6838,0, 0,2.38125, 0,-2.38125
`));ie(ee.ParsePatFile(`
*SCAFFOLD
;By John Hyslop,    Tile2Hatch tool \xA9 CVH 2020
;Developed in mm as metric QCAD3 pattern
270,19.304,21.336,25.4,25.4,0.508,-24.892
326.3099325,6.604,4.064,56.357539812,7.04469254,14.652960026,-76.928042486
90,6.096,12.446,25.4,25.4,0.508,-24.892
270,6.35,4.064,25.4,25.4,8.128,-17.272
146.3099325,6.096,21.336,56.357539812,7.04469254,14.65296028,-76.928041978
180,19.304,12.446,0,25.4,0.508,-24.892
270,18.796,4.572,25.4,25.4,0.508,-24.892
0,18.796,21.336,0,25.4,0.508,-24.892
90,6.35,12.954,25.4,25.4,7.874,-17.526
270,19.304,12.954,25.4,25.4,0.508,-24.892
0,6.604,4.318,0,25.4,12.192,-13.208
0,6.096,12.954,0,25.4,0.508,-24.892
180,19.304,4.572,0,25.4,0.508,-24.892
90,18.796,20.828,25.4,25.4,0.508,-24.892
212.855722,6.096,12.446,514.310608918,0.444520828,14.513605212,-1436.846928942
147.144278,6.096,4.572,937.049925236,0.444520828,14.513605212,-1436.846928942
213.6900675,6.096,4.064,35.223462446,7.04469254,14.652959772,-76.928042486
180,6.096,4.318,0,25.4,12.192,-13.208
0,6.604,21.082,0,25.4,12.192,-13.208
90,6.604,4.064,25.4,25.4,0.508,-24.892
180,19.304,20.828,0,25.4,0.508,-24.892
90,18.796,12.446,25.4,25.4,0.508,-24.892
147.144278,18.796,4.572,937.049925236,0.444520828,14.513605466,-1436.846928688
0,6.096,4.064,0,25.4,0.508,-24.892
0,6.604,12.7,0,25.4,12.192,-13.208
270,6.604,21.336,25.4,25.4,0.508,-24.892
90,19.05,4.572,25.4,25.4,7.874,-17.526
212.855722,18.796,20.828,514.310608918,0.444520828,14.513605466,-1436.846928688
180,6.604,12.446,0,25.4,0.508,-24.892
270,6.096,4.572,25.4,25.4,0.508,-24.892
0,6.096,21.336,0,25.4,0.508,-24.892
270,6.604,12.954,25.4,25.4,0.508,-24.892
270,19.05,20.828,25.4,25.4,7.874,-17.526
32.855722,6.604,4.572,514.310608918,0.444520828,14.513605466,-1436.846928688
180,6.604,4.572,0,25.4,0.508,-24.892
0,18.796,12.954,0,25.4,0.508,-24.892
90,19.304,4.064,25.4,25.4,0.508,-24.892
90,6.096,20.828,25.4,25.4,0.508,-24.892
180,6.096,21.082,0,25.4,12.192,-13.208
147.144278,6.096,12.954,937.049925236,0.444520828,14.513605212,-1436.846928942
180,6.096,12.7,0,25.4,12.192,-13.208
270,6.35,12.446,25.4,25.4,7.874,-17.526
212.855722,6.096,20.828,514.310608918,0.444520828,14.513605466,-1436.846928688
0,18.796,4.064,0,25.4,0.508,-24.892
270,19.05,4.064,25.4,25.4,8.128,-17.272
180,6.604,20.828,0,25.4,0.508,-24.892
213.6900675,18.796,4.064,35.223462446,7.04469254,14.652960026,-76.928042486
327.144278,6.604,20.828,937.049925236,0.444520828,14.513605466,-1436.846928688
`));ie(ee.ParsePatFile(`
*SQUARE,SQUARE
0, 0,0, 0,3.175, 3.175,-3.175
90, 0,0, 0,3.175, 3.175,-3.175
`));ie(ee.ParsePatFile(`
*SQUIGGLE-01,SQUIGGLE-01
;By John Hyslop,    Using AutoCAD Lisp Tool
;Developed in mm as metric QCAD3 pattern
45,2.794,-9.906,17.960512212,17.960512212,28.377609234,-7.54341519
56.309932,1.778,13.97,56.357539812,7.04469254,1.831620162,-89.74938235
81.869898,1.524,12.192,25.144717046,3.592102544,1.796051272,-177.809071102
99.462322,1.778,10.668,129.447762694,4.175734346,1.545021802,-152.95714646
123.690068,2.794,9.144,35.223462446,7.04469254,1.831620162,-89.74938235
146.309932,4.318,8.128,56.357539812,7.04469254,1.831620162,-89.74938235
170.537678,5.842,7.874,25.054405568,4.175734346,1.545021802,-152.95714646
188.130102,7.62,8.128,154.460405328,3.592102544,1.796051272,-177.809071102
213.690068,9.144,9.144,35.223462446,7.04469254,1.831620162,-89.74938235
225,16.51,16.51,17.960512212,17.960512212,10.417097022,-25.503927402
213.690068,18.034,17.526,35.223462446,7.04469254,1.831620162,-89.74938235
189.462322,19.558,17.78,129.447762694,4.175734346,1.545021802,-152.95714646
171.869898,21.336,17.526,25.144717046,3.592102544,1.796051272,-177.809071102
146.309932,22.86,16.51,56.357539812,7.04469254,1.831620162,-89.74938235
123.690068,23.876,14.986,35.223462446,7.04469254,1.831620162,-89.74938235
99.462322,24.13,13.462,129.447762694,4.175734346,1.545021802,-152.95714646
81.869898,23.876,11.684,25.144717046,3.592102544,1.796051272,-177.809071102
56.309932,22.86,10.16,56.357539812,7.04469254,1.831620162,-89.74938235
`));ie(ee.ParsePatFile(`
*SQUIGGLE-02,SQUIGGLE-02
;By John Hyslop,    Using AutoCAD Lisp Tool
;Developed in mm as metric QCAD3 pattern
75.963757,25.146,4.064,24.6416195,6.160405002,1.047268924,-103.679614078
63.434949,24.638,3.048,22.718450626,11.35922544,1.135922544,-55.660204148
45,23.876,2.286,17.960512212,17.960512212,1.077630814,-34.843393864
14.036243,22.86,2.032,80.085263502,6.160405002,1.047268924,-103.679614078
0,21.59,2.032,0,25.4,1.27,-24.13
345.963757,20.574,2.286,24.6416195,6.160405002,1.047268924,-103.679614078
315,19.812,3.048,17.960512212,17.960512212,1.077630814,-34.843393864
296.565051,19.304,4.064,34.077676066,11.35922544,1.135922544,-55.660204148
284.036243,19.05,5.08,80.085263502,6.160405002,1.047268924,-103.679614078
281.309932,18.796,21.59,104.608346536,4.981349956,1.29515108,-128.219944728
303.690068,18.288,22.352,35.223462446,7.04469254,0.915809954,-90.665192304
315,17.526,23.114,17.960512212,17.960512212,1.077630814,-34.843393864
345.963757,16.51,23.368,24.6416195,6.160405002,1.047268924,-103.679614078
0,15.24,23.368,0,25.4,1.27,-24.13
14.036243,14.224,23.114,80.085263502,6.160405002,1.047268924,-103.679614078
45,13.462,22.352,17.960512212,17.960512212,1.077630814,-34.843393864
56.309932,12.954,21.59,56.357539812,7.04469254,0.915809954,-90.665192304
78.690068,12.7,20.32,24.906749272,4.981349956,1.29515108,-128.219944728
75.963757,12.446,4.064,24.6416195,6.160405002,1.047268924,-103.679614078
63.434949,11.938,3.048,22.718450626,11.35922544,1.135922544,-55.660204148
45,11.176,2.286,17.960512212,17.960512212,1.077630814,-34.843393864
14.036243,10.16,2.032,80.085263502,6.160405002,1.047268924,-103.679614078
0,8.89,2.032,0,25.4,1.27,-24.13
345.963757,7.874,2.286,24.6416195,6.160405002,1.047268924,-103.679614078
315,7.112,3.048,17.960512212,17.960512212,1.077630814,-34.843393864
296.565051,6.604,4.064,34.077676066,11.35922544,1.135922544,-55.660204148
284.036243,6.35,5.08,80.085263502,6.160405002,1.047268924,-103.679614078
281.309932,6.096,21.59,104.608346536,4.981349956,1.29515108,-128.219944728
303.690068,5.588,22.352,35.223462446,7.04469254,0.915809954,-90.665192304
315,4.826,23.114,17.960512212,17.960512212,1.077630814,-34.843393864
345.963757,3.81,23.368,24.6416195,6.160405002,1.047268924,-103.679614078
0,2.54,23.368,0,25.4,1.27,-24.13
14.036243,1.524,23.114,80.085263502,6.160405002,1.047268924,-103.679614078
45,0.762,22.352,17.960512212,17.960512212,1.077630814,-34.843393864
56.309932,0.254,21.59,56.357539812,7.04469254,0.915809954,-90.665192304
78.690068,0,20.32,24.906749272,4.981349956,1.29515108,-128.219944728
270,19.05,20.32,0,25.4,15.24,-10.16
270,12.7,20.32,0,25.4,15.24,-10.16
270,6.35,20.32,0,25.4,15.24,-10.16
270,0,20.32,0,25.4,15.24,-10.16
`));ie(ee.ParsePatFile(`
*STARS,STARS
0, 0,0, 0,5.49926, 3.175,-3.175
60, 0,0, 0,5.49926, 3.175,-3.175
120, 1.5875,2.74963, 0,5.49926, 3.175,-3.175
`));ie(ee.ParsePatFile(`
*STEEL,STEEL
45, 0,0, 0,3.175
45, 0,1.5875, 0,3.175
`));ie(ee.ParsePatFile(`
*SWAMP,SWAMP
0, 0,0, 12.7,21.997, 3.175,-22.225
90, 1.5875,0, 21.997,12.7, 1.5875,-42.4066
90, 1.98438,0, 21.997,12.7, 1.27,-42.7241
90, 1.19062,0, 21.997,12.7, 1.27,-42.7241
60, 2.38125,0, 12.7,21.997, 1.016,-24.384
120, .79375,0, 12.7,21.997, 1.016,-24.384
`));ie(ee.ParsePatFile(`
*TRANS,TRANS
0, 0,0, 0,6.35
0, 0,3.175, 0,6.35, 3.175,-3.175
`));ie(ee.ParsePatFile(`
*TRI-OVERLAP
;By John Hyslop,    Tile2Hatch tool \xA9 CVH 2020
;Developed in mm as metric QCAD3 pattern
59.641885,2.286000254,3.81,1206.700468992,0.313103514,20.605334202,-2039.928082188
300.358115,12.7,21.590000254,853.832947398,0.313103514,20.605334202,-2039.928082188
180,9.129485678,15.494,0,25.4,18.258981262,-7.141018738
59.036243,22.737590288,4.452650734,56.628832894,4.356064186,5.17479407,-142.931383936
180,23.114,3.81,0,25.4,20.827999746,-4.572000254
300.963757,0,8.89,91.477345366,4.356064186,5.174794324,-142.931383682
300.784147,3.048,3.81,148.105450296,0.464280504,13.89591328,-1375.695350204
239.215853,22.352,3.81,1241.485813188,0.464280504,13.89591328,-1375.695350204
`));ie(ee.ParsePatFile(`
*TRIANG,TRIANG
60, 0,0, 4.7625,8.24889, 4.7625,-4.7625
120, 0,0, 4.76250001,8.24889, 4.7625,-4.7625
0, -2.38125,4.12445, 4.7625,8.24889, 4.7625,-4.7625
`));ie(ee.ParsePatFile(`
*WEATHERBOARD,WEATHERBOARD
; By John Hyslop,    Manually Entered QCAD3 pattern
; Developed in mm as metric QCAD3 pattern
; Metric Hatch Scale 1 Makes 152mm horizontally placed boards
; with a 13mm offset line to simulate a rounded edge
0,0,0,0,152
0,0,13,0,152
`));ie(ee.ParsePatFile(`
*WEAVING,WEAVING
;By John Hyslop,    Using AutoCAD Lisp Tool
;Developed in mm as metric QCAD3 pattern
90,22.86,5.08,0,25.4,1.27,-24.13
75.963757,22.352,3.048,24.6416195,6.160405002,2.094537594,-102.632345154
66.801409,21.59,1.27,136.74251925,3.335183322,1.934406342,-191.506230398
54.462322,20.32,-0.508,91.53339072,2.952690056,2.18499055,-216.314071054
56.309932,19.304,-2.032,56.357539812,7.04469254,1.831620162,-89.74938235
90,20.066,5.588,0,25.4,1.778,-23.622
80.537678,19.812,4.064,25.054405568,4.175734346,1.545021802,-152.95714646
63.434949,19.05,2.54,22.718450626,11.35922544,1.703883816,-55.092242876
56.309932,18.034,1.016,56.357539812,7.04469254,1.831620162,-89.74938235
56.309932,17.018,-0.508,56.357539812,7.04469254,1.831620162,-89.74938235
333.434949,21.844,6.858,22.718450626,11.35922544,1.703883816,-55.092242876
344.054604,20.066,7.366,104.668749768,3.488958224,1.84914794,-183.065643266
0,18.034,7.366,0,25.4,2.032,-23.368
9.462322,16.51,7.112,129.447762694,4.175734346,1.545021802,-152.95714646
26.565051,14.986,6.35,34.077676066,11.35922544,1.703883816,-55.092242876
38.659808,13.716,5.334,35.701322044,3.966813504,1.626393496,-161.0129622
36.869898,11.684,3.81,35.56,5.08,2.54,-124.46
20.556045,9.652,3.048,136.750876358,2.97284521,2.170177016,-214.847518234
330.255119,23.114,9.398,56.708680588,3.150482142,2.047813532,-202.733533318
344.054604,21.336,9.906,104.668749768,3.488958224,1.84914794,-183.065643266
352.874984,19.304,10.16,25.203858152,3.150482142,2.047813532,-202.733533318
0,17.526,10.16,0,25.4,1.778,-23.622
14.036243,15.494,9.652,80.085263502,6.160405002,2.094537594,-102.632345154
26.565051,13.462,8.636,34.077676066,11.35922544,2.271845088,-54.524281604
33.690068,11.938,7.62,35.223462446,7.04469254,1.831620162,-89.74938235
35.537678,10.16,6.35,126.965671138,2.952690056,2.18499055,-216.314071054
0,5.08,2.54,0,25.4,1.27,-24.13
348.690068,3.81,2.794,24.906749272,4.981349956,1.29515108,-128.219944728
341.565051,3.048,3.048,24.09655582,8.032185358,0.803218612,-79.518633952
336.801409,1.27,3.81,136.74251925,3.335183322,1.934406342,-191.506230398
326.309932,-0.254,4.826,56.357539812,7.04469254,1.831620162,-89.74938235
324.462322,-2.032,6.096,91.53339072,2.952690056,2.18499055,-216.314071054
0,5.588,5.334,0,25.4,1.778,-23.622
350.537678,4.064,5.588,25.054405568,4.175734346,1.545021802,-152.95714646
333.434949,2.54,6.35,22.718450626,11.35922544,1.703883816,-55.092242876
326.309932,1.016,7.366,56.357539812,7.04469254,1.831620162,-89.74938235
326.309932,-0.508,8.382,56.357539812,7.04469254,1.831620162,-89.74938235
60.255119,16.002,23.114,56.708680588,3.150482142,2.047813532,-202.733533318
180,20.066,20.066,0,25.4,2.032,-23.368
164.054604,21.844,19.558,104.668749768,3.488958224,1.84914794,-183.065643266
153.434949,23.368,18.796,22.718450626,11.35922544,1.703883816,-55.092242876
330.255119,23.114,22.098,56.708680588,3.150482142,2.047813532,-202.733533318
345.963757,21.082,22.606,24.6416195,6.160405002,2.094537594,-102.632345154
352.874984,19.05,22.86,25.203858152,3.150482142,2.047813532,-202.733533318
60.255119,18.288,21.59,56.708680588,3.150482142,2.047813532,-202.733533318
80.537678,18.034,20.066,25.054405568,4.175734346,1.545021802,-152.95714646
90,18.034,18.034,0,25.4,2.032,-23.368
104.036243,18.542,16.002,80.085263502,6.160405002,2.094537594,-102.632345154
116.565051,19.304,14.478,34.077676066,11.35922544,1.703883816,-55.092242876
129.805571,20.574,12.954,35.773504272,3.252136752,1.9838035,-196.396538372
123.690068,21.59,11.43,35.223462446,7.04469254,1.831620162,-89.74938235
113.198591,22.352,9.652,56.698117744,3.335183322,1.934406342,-191.506230398
309.805571,18.034,11.684,35.773504272,3.252136752,1.9838035,-196.396538372
305.537678,16.764,13.462,126.965671138,2.952690056,2.18499055,-216.314071054
299.744881,15.748,15.24,148.072666262,3.150482142,2.047813532,-202.733533318
285.945396,15.24,17.018,80.246041438,3.488958224,1.84914794,-183.065643266
270,15.24,19.304,0,25.4,2.286,-23.114
74.054604,15.494,21.336,104.668749768,3.488958224,1.84914794,-183.065643266
82.874984,15.24,19.304,25.203858152,3.150482142,2.047813532,-202.733533318
39.805571,13.716,18.034,35.773504272,3.252136752,1.9838035,-196.396538372
35.537678,11.938,16.764,126.965671138,2.952690056,2.18499055,-216.314071054
33.690068,10.414,15.748,35.223462446,7.04469254,1.831620162,-89.74938235
15.945396,8.636,15.24,80.246041438,3.488958224,1.84914794,-183.065643266
6.340192,6.35,14.986,204.76213556,2.804960862,2.30006779,-227.706714766
350.537678,4.826,15.24,25.054405568,4.175734346,1.545021802,-152.95714646
344.054604,3.048,15.748,104.668749768,3.488958224,1.84914794,-183.065643266
23.198591,13.97,21.59,56.698117744,3.335183322,1.934406342,-191.506230398
29.744881,12.192,20.574,148.072666262,3.150482142,2.047813532,-202.733533318
39.805571,10.668,19.304,35.773504272,3.252136752,1.9838035,-196.396538372
29.744881,8.89,18.288,148.072666262,3.150482142,2.047813532,-202.733533318
7.125016,6.858,18.034,179.577488698,3.150482142,2.047813532,-202.733533318
0,5.334,18.034,0,25.4,1.524,-23.876
344.054604,3.556,18.542,104.668749768,3.488958224,1.84914794,-183.065643266
333.434949,2.54,19.05,22.718450626,11.35922544,1.135922544,-55.660204148
234.462322,7.874,-0.254,91.53339072,2.952690056,2.18499055,-216.314071054
240.255119,8.89,1.524,56.708680588,3.150482142,2.047813532,-202.733533318
243.434949,9.906,3.556,22.718450626,11.35922544,2.271845088,-54.524281604
262.874984,10.16,5.588,25.203858152,3.150482142,2.047813532,-202.733533318
270,10.16,7.62,0,25.4,2.032,-23.368
282.528808,9.652,9.906,104.69063898,2.755016842,2.341764176,-231.834664854
293.198591,8.89,11.684,56.698117744,3.335183322,1.934406342,-191.506230398
309.805571,7.62,13.208,35.773504272,3.252136752,1.9838035,-196.396538372
305.537678,6.35,14.986,126.965671138,2.952690056,2.18499055,-216.314071054
270,5.334,19.812,0,25.4,1.778,-23.622
254.054604,5.842,21.59,104.668749768,3.488958224,1.84914794,-183.065643266
246.801409,6.604,23.368,136.74251925,3.335183322,1.934406342,-191.506230398
236.309932,5.334,1.016,56.357539812,7.04469254,1.831620162,-89.74938235
234.462322,6.604,2.794,91.53339072,2.952690056,2.18499055,-216.314071054
249.443955,7.366,4.826,80.266818638,2.97284521,2.170177016,-214.847518234
270,7.366,6.858,0,25.4,2.032,-23.368
278.130102,7.112,8.636,154.460405328,3.592102544,1.796051272,-177.809071102
296.565051,6.096,10.668,34.077676066,11.35922544,2.271845088,-54.524281604
309.805571,4.826,12.192,35.773504272,3.252136752,1.9838035,-196.396538372
303.690068,3.81,13.716,35.223462446,7.04469254,1.831620162,-89.74938235
290.556045,3.048,15.748,136.750876358,2.97284521,2.170177016,-214.847518234
341.565051,1.524,16.256,24.09655582,8.032185358,1.60643697,-78.715415594
324.462322,-0.254,17.526,91.53339072,2.952690056,2.18499055,-216.314071054
324.462322,-2.032,18.796,91.53339072,2.952690056,2.18499055,-216.314071054
146.309932,1.016,20.066,56.357539812,7.04469254,1.831620162,-89.74938235
146.309932,2.54,19.05,56.357539812,7.04469254,1.831620162,-89.74938235
262.874984,2.794,21.082,25.203858152,3.150482142,2.047813532,-202.733533318
255.963757,3.302,23.114,24.6416195,6.160405002,2.094537594,-102.632345154
240.255119,4.318,24.892,56.708680588,3.150482142,2.047813532,-202.733533318
`));ie(ee.ParsePatFile(`
*WIRE-FENCE
;By John Hyslop,    Tile2Hatch tool \xA9 CVH 2020
;Developed in mm as metric QCAD3 pattern
315,11.684,12.7,17.960512212,17.960512212,1.186955462,-34.734068962
315,13.353142966,14.332857034,17.960512212,17.960512212,1.231577928,-34.689446496
3.731397,12.767918076,14.294690232,381.845330542,0.55100347,0.586467966,-1170.2956782
183.17983,11.77579941,14.229987034,432.544118908,1.408938508,23.016097986,-434.888914066
183.17983,11.714581854,13.209697736,432.544118908,1.408938508,23.012451308,-434.892560744
153.434949,13.208,12.954,22.718450626,11.35922544,0.567961272,-56.22816542
266.593556,13.208,12.954,432.546308388,0.301846742,25.69937837,-2111.67704156
266.593556,14.224,13.462,432.546308388,0.301846742,25.69937837,-2111.67704156
2.602562,12.523304392,11.860695608,534.003174054,1.153354564,0.622066574,-558.754908396
`));ie(ee.ParsePatFile(`
*XMASTREE-01,XMASTREE-01
;By John Hyslop
;Developed in mm as metric QCAD3 pattern
180,1.016,24.13,0,25.4,1.016,-24.384
90,1.016,20.828,0,25.4,3.302,-22.098
180,8.382,20.828,0,25.4,7.366,-18.034
49.763642,5.588,17.526,198.374734568,1.491539308,4.325464044,-428.2209495
180,7.112,17.526,0,25.4,1.524,-23.876
51.340192,4.064,13.716,126.938033652,3.966813504,4.879180742,-157.760174954
180,5.588,13.716,0,25.4,1.524,-23.876
52.431408,3.048,10.414,126.990557296,1.548665432,4.165909626,-412.425064658
180,4.318,10.414,0,25.4,1.27,-24.13
53.130102,2.032,7.366,91.44,5.08,3.81,-123.19
180,3.302,7.366,0,25.4,1.27,-24.13
53.972627,1.27,4.572,218.491081432,1.867445084,3.454773634,-342.02257732
180,2.54,4.572,0,25.4,1.27,-24.13
54.462322,0,1.016,91.53339072,2.952690056,4.369981354,-214.129080504
0,24.384,24.13,0,25.4,1.016,-24.384
90,24.384,20.828,0,25.4,3.302,-22.098
0,17.018,20.828,0,25.4,7.366,-18.034
130.236358,19.812,17.526,234.17167923,1.491539308,4.325464044,-428.2209495
0,18.288,17.526,0,25.4,1.524,-23.876
128.659808,21.336,13.716,35.701322044,3.966813504,4.879180742,-157.760174954
0,19.812,13.716,0,25.4,1.524,-23.876
127.568592,22.352,10.414,289.600417242,1.548665432,4.165909626,-412.425064658
0,21.082,10.414,0,25.4,1.27,-24.13
126.869898,23.368,7.366,35.56,5.08,3.81,-123.19
0,22.098,7.366,0,25.4,1.27,-24.13
126.027373,24.13,4.572,126.986269522,1.867445084,3.454773634,-342.02257732
0,22.86,4.572,0,25.4,1.27,-24.13
125.537678,25.4,1.016,126.965671138,2.952690056,4.369981354,-214.129080504
0,11.684,1.016,0,25.4,1.016,-24.384
270,11.684,4.318,0,25.4,3.302,-22.098
0,4.318,4.318,0,25.4,7.366,-18.034
229.763642,7.112,7.62,198.374734568,1.491539308,4.325464044,-428.2209495
0,5.588,7.62,0,25.4,1.524,-23.876
231.340192,8.636,11.43,126.938033652,3.966813504,4.879180742,-157.760174954
0,7.112,11.43,0,25.4,1.524,-23.876
232.431408,9.652,14.732,126.990557296,1.548665432,4.165909626,-412.425064658
0,8.382,14.732,0,25.4,1.27,-24.13
233.130102,10.668,17.78,91.44,5.08,3.81,-123.19
0,9.398,17.78,0,25.4,1.27,-24.13
233.972627,11.43,20.574,218.491081432,1.867445084,3.454773634,-342.02257732
0,10.16,20.574,0,25.4,1.27,-24.13
234.462322,12.7,24.13,91.53339072,2.952690056,4.369981354,-214.129080504
180,13.716,1.016,0,25.4,1.016,-24.384
270,13.716,4.318,0,25.4,3.302,-22.098
180,21.082,4.318,0,25.4,7.366,-18.034
310.236358,18.288,7.62,234.17167923,1.491539308,4.325464044,-428.2209495
180,19.812,7.62,0,25.4,1.524,-23.876
308.659808,16.764,11.43,35.701322044,3.966813504,4.879180742,-157.760174954
180,18.288,11.43,0,25.4,1.524,-23.876
307.568592,15.748,14.732,289.600417242,1.548665432,4.165909626,-412.425064658
180,17.018,14.732,0,25.4,1.27,-24.13
306.869898,14.732,17.78,35.56,5.08,3.81,-123.19
180,16.002,17.78,0,25.4,1.27,-24.13
306.027373,13.97,20.574,126.986269522,1.867445084,3.454773634,-342.02257732
180,15.24,20.574,0,25.4,1.27,-24.13
305.537678,12.7,24.13,126.965671138,2.952690056,4.369981354,-214.129080504
`));ie(ee.ParsePatFile(`
*XMASTREE-02,XMASTREE-02
;By John Hyslop
;Developed in mm as metric QCAD3 pattern
180,1.016,6.604,0,25.4,1.016,-24.384
90,1.016,3.302,0,25.4,3.302,-22.098
180,8.382,3.302,0,25.4,7.366,-18.034
49.763642,5.588,0,198.374734568,1.491539308,4.325464044,-428.2209495
180,7.112,25.4,0,25.4,1.524,-23.876
51.340192,4.064,21.59,126.938033652,3.966813504,4.879180742,-157.760174954
180,5.588,21.59,0,25.4,1.524,-23.876
52.431408,3.048,18.288,126.990557296,1.548665432,4.165909626,-412.425064658
180,4.318,18.288,0,25.4,1.27,-24.13
53.130102,2.032,15.24,91.44,5.08,3.81,-123.19
180,3.302,15.24,0,25.4,1.27,-24.13
53.972627,1.27,12.446,218.491081432,1.867445084,3.454773634,-342.02257732
180,2.54,12.446,0,25.4,1.27,-24.13
54.462322,0,8.89,91.53339072,2.952690056,4.369981354,-214.129080504
0,24.384,6.604,0,25.4,1.016,-24.384
90,24.384,3.302,0,25.4,3.302,-22.098
0,17.018,3.302,0,25.4,7.366,-18.034
130.236358,19.812,0,234.17167923,1.491539308,4.325464044,-428.2209495
0,18.288,25.4,0,25.4,1.524,-23.876
128.659808,21.336,21.59,35.701322044,3.966813504,4.879180742,-157.760174954
0,19.812,21.59,0,25.4,1.524,-23.876
127.568592,22.352,18.288,289.600417242,1.548665432,4.165909626,-412.425064658
0,21.082,18.288,0,25.4,1.27,-24.13
126.869898,23.368,15.24,35.56,5.08,3.81,-123.19
0,22.098,15.24,0,25.4,1.27,-24.13
126.027373,24.13,12.446,126.986269522,1.867445084,3.454773634,-342.02257732
0,22.86,12.446,0,25.4,1.27,-24.13
125.537678,25.4,8.89,126.965671138,2.952690056,4.369981354,-214.129080504
0,11.684,2.286,0,25.4,1.016,-24.384
270,11.684,5.588,0,25.4,3.302,-22.098
0,4.318,5.588,0,25.4,7.366,-18.034
229.763642,7.112,8.89,198.374734568,1.491539308,4.325464044,-428.2209495
0,5.588,8.89,0,25.4,1.524,-23.876
231.340192,8.636,12.7,126.938033652,3.966813504,4.879180742,-157.760174954
0,7.112,12.7,0,25.4,1.524,-23.876
232.431408,9.652,16.002,126.990557296,1.548665432,4.165909626,-412.425064658
0,8.382,16.002,0,25.4,1.27,-24.13
233.130102,10.668,19.05,91.44,5.08,3.81,-123.19
0,9.398,19.05,0,25.4,1.27,-24.13
233.972627,11.43,21.844,218.491081432,1.867445084,3.454773634,-342.02257732
0,10.16,21.844,0,25.4,1.27,-24.13
234.462322,12.7,25.4,91.53339072,2.952690056,4.369981354,-214.129080504
180,13.716,2.286,0,25.4,1.016,-24.384
270,13.716,5.588,0,25.4,3.302,-22.098
180,21.082,5.588,0,25.4,7.366,-18.034
310.236358,18.288,8.89,234.17167923,1.491539308,4.325464044,-428.2209495
180,19.812,8.89,0,25.4,1.524,-23.876
308.659808,16.764,12.7,35.701322044,3.966813504,4.879180742,-157.760174954
180,18.288,12.7,0,25.4,1.524,-23.876
307.568592,15.748,16.002,289.600417242,1.548665432,4.165909626,-412.425064658
180,17.018,16.002,0,25.4,1.27,-24.13
306.869898,14.732,19.05,35.56,5.08,3.81,-123.19
180,16.002,19.05,0,25.4,1.27,-24.13
306.027373,13.97,21.844,126.986269522,1.867445084,3.454773634,-342.02257732
180,15.24,21.844,0,25.4,1.27,-24.13
305.537678,12.7,25.4,126.965671138,2.952690056,4.369981354,-214.129080504
`));ie(ee.ParsePatFile(`
*ZIGZAG,ZIGZAG
0, 0,0, 3.175,3.175, 3.175,-3.175
90, 3.175,0, 3.175,3.175, 3.175,-3.175
`));ie(ee.ParsePatFile(`
*ACAD_ISO02W100,ACAD_ISO02W100
0, 0,0, 0,5, 12,-3
`),!1);ie(ee.ParsePatFile(`
*ACAD_ISO03W100,ACAD_ISO03W100
0, 0,0, 0,5, 12,-18
`),!1);ie(ee.ParsePatFile(`
*ACAD_ISO04W100,ACAD_ISO04W100
0, 0,0, 0,5, 24,-3,.5,-3
`),!1);ie(ee.ParsePatFile(`
*ACAD_ISO05W100,ACAD_ISO05W100
0, 0,0, 0,5, 24,-3,.5,-3,.5,-3
`),!1);ie(ee.ParsePatFile(`
*ACAD_ISO06W100,ACAD_ISO06W100
0, 0,0, 0,5, 24,-3,.5,-3,.5,-6.5
0, 0,0, 0,5, -34,.5,-3
`),!1);ie(ee.ParsePatFile(`
*ACAD_ISO07W100,ACAD_ISO07W100
0, 0,0, 0,5, .5,-3
`),!1);ie(ee.ParsePatFile(`
*ACAD_ISO08W100,ACAD_ISO08W100
0, 0,0, 0,5, 24,-3,6,-3
`),!1);ie(ee.ParsePatFile(`
*ACAD_ISO09W100,ACAD_ISO09W100
0, 0,0, 0,5, 24,-3,6,-3,6,-3
`),!1);ie(ee.ParsePatFile(`
*ACAD_ISO10W100,ACAD_ISO10W100
0, 0,0, 0,5, 12,-3,.5,-3
`),!1);ie(ee.ParsePatFile(`
*ACAD_ISO11W100,ACAD_ISO11W100
0, 0,0, 0,5, 12,-3,12,-3,.5,-3
`),!1);ie(ee.ParsePatFile(`
*ACAD_ISO12W100,ACAD_ISO12W100
0, 0,0, 0,5, 12,-3,.5,-3,.5,-3
`),!1);ie(ee.ParsePatFile(`
*ACAD_ISO13W100,ACAD_ISO13W100
0, 0,0, 0,5, 12,-3,12,-3,.5,-6.5
0, 0,0, 0,5, -33.5,.5,-3
`),!1);ie(ee.ParsePatFile(`
*ACAD_ISO14W100,ACAD_ISO14W100
0, 0,0, 0,5, 12,-3,.5,-3,.5,-6.5
0, 0,0, 0,5, -22,.5,-3
`),!1);ie(ee.ParsePatFile(`
*ACAD_ISO15W100,ACAD_ISO15W100
0, 0,0, 0,5, 12,-3,12,-3,.5,-10
0, 0,0, 0,5, -33.5,.5,-3,.5,-3
`),!1);ie(ee.ParsePatFile(`
*ANGLE,ANGLE
0, 0,0, 0,.275, .2,-.075
90, 0,0, 0,.275, .2,-.075
`),!1);ie(ee.ParsePatFile(`
*ANSI31,ANSI31
45, 0,0, 0,.125
`),!1);ie(ee.ParsePatFile(`
*ANSI32,ANSI32
45, 0,0, 0,.375
45, .1767767,0, 0,.375
`),!1);ie(ee.ParsePatFile(`
*ANSI33,ANSI33
45, 0,0, 0,.25
45, .1767767,0, 0,.25, .125,-.0625
`),!1);ie(ee.ParsePatFile(`
*ANSI34,ANSI34
45, 0,0, 0,.75
45, .1767767,0, 0,.75
45, .35355339,0, 0,.75
45, .53033009,0, 0,.75
`),!1);ie(ee.ParsePatFile(`
*ANSI35,ANSI35
45, 0,0, 0,.25
45, .1767767,0, 0,.25, .3125,-.0625,0,-.0625
`),!1);ie(ee.ParsePatFile(`
*ANSI36,ANSI36
45, 0,0, .21875,.125, .3125,-.0625,0,-.0625
`),!1);ie(ee.ParsePatFile(`
*ANSI37,ANSI37
45, 0,0, 0,.125
135, 0,0, 0,.125
`),!1);ie(ee.ParsePatFile(`
*ANSI38,ANSI38
45, 0,0, 0,.125
135, 0,0, .25,.125, .3125,-.1875
`),!1);ie(ee.ParsePatFile(`
*AR-B816C,AR-B816C
0, 0,0, 8,8, 15.625,-.375
0, -8,.375, 8,8, 15.625,-.375
90, 0,0, 8,8, -8.375,7.625
90, -.375,0, 8,8, -8.375,7.625
`),!1);ie(ee.ParsePatFile(`
*AR-B816,AR-B816
0, 0,0, 0,8
90, 0,0, 8,8, 8,-8
`),!1);ie(ee.ParsePatFile(`
*AR-B88,AR-B88
0, 0,0, 0,8
90, 0,0, 8,4, 8,-8
`),!1);ie(ee.ParsePatFile(`
*AR-BRELM,AR-BRELM
0, 0,0, 0,5.334, 7.625,-.375
0, 0,2.25, 0,5.334, 7.625,-.375
0, 2,2.667, 0,5.334, 3.625,-.375
0, 2,4.917, 0,5.334, 3.625,-.375
90, 0,0, 0,8, 2.25,-3.084
90, -.375,0, 0,8, 2.25,-3.084
90, 2,2.667, 0,4, 2.25,-3.084
90, 1.625,2.667, 0,4, 2.25,-3.084
`),!1);ie(ee.ParsePatFile(`
*AR-BRSTD,AR-BRSTD
0, 0,0, 0,2.667
90, 0,0, 2.667,4, 2.667,-2.667
`),!1);ie(ee.ParsePatFile(`
*AR-CONC-01,AR-CONC-01
;Optimize to replace existing AR-CONC Pattern
;By John Hyslop,    Using AutoCAD Lisp Tool
;Developed in inch as imperial QCAD3 pattern
243.434949,0.3,0.8,8.9442719,4.472136,0.2236068,-22.137073
90,0.3,0.6,0,10,0.2,-9.8
0,0.2,0.6,0,10,0.1,-9.9
315,0.1,0.1,7.0710678,7.0710678,0.1414214,-14.0007143
206.565051,0.3,0.2,13.4164079,4.472136,0.2236068,-22.137073
63.434949,0.2,0,8.9442719,4.472136,0.2236068,-22.137073
45,2,0.4,7.0710678,7.0710678,0.2828427,-13.8592929
161.565051,2.3,0.3,9.486833,3.1622777,0.3162278,-31.3065488
288.434949,2.2,0.6,22.1359436,3.1622777,0.3162278,-31.3065488
315,2.3,0.9,7.0710678,7.0710678,0.1414214,-14.0007143
206.565051,2.5,1,13.4164079,4.472136,0.2236068,-22.137073
63.434949,2.4,0.8,8.9442719,4.472136,0.2236068,-22.137073
270,4.1,0.6,0,10,0.2,-9.8
45,3.9,0.4,7.0710678,7.0710678,0.2828427,-13.8592929
180,4.1,0.4,0,10,0.2,-9.8
333.434949,3.9,0.2,8.9442719,4.472136,0.2236068,-22.137073
225,4,0.3,7.0710678,7.0710678,0.1414214,-14.0007143
116.565051,4.1,0.1,13.4164079,4.472136,0.2236068,-22.137073
198.434949,6.3,0.8,22.1359436,3.1622777,0.3162278,-31.3065488
63.434949,6.2,0.6,8.9442719,4.472136,0.2236068,-22.137073
333.434949,6,0.7,8.9442719,4.472136,0.2236068,-22.137073
26.565051,5.7,0,13.4164079,4.472136,0.2236068,-22.137073
251.565051,5.8,0.3,9.486833,3.1622777,0.3162278,-31.3065488
116.565051,5.9,0.1,13.4164079,4.472136,0.2236068,-22.137073
45,6.7,0.1,7.0710678,7.0710678,0.2828427,-13.8592929
161.565051,7,0,9.486833,3.1622777,0.3162278,-31.3065488
288.434949,6.9,0.3,22.1359436,3.1622777,0.3162278,-31.3065488
315,3,2.8,7.0710678,7.0710678,0.1414214,-14.0007143
206.565051,3.2,2.9,13.4164079,4.472136,0.2236068,-22.137073
63.434949,3.1,2.7,8.9442719,4.472136,0.2236068,-22.137073
45,1.1,0.8,7.0710678,7.0710678,0.2828427,-13.8592929
180,1.3,0.8,0,10,0.2,-9.8
270,1.3,1,0,10,0.2,-9.8
225,1.8,2.4,7.0710678,7.0710678,0.1414214,-14.0007143
270,1.8,2.6,0,10,0.2,-9.8
71.565051,1.7,2.3,9.486833,3.1622777,0.3162278,-31.3065488
198.434949,1,2.1,22.1359436,3.1622777,0.3162278,-31.3065488
63.434949,0.9,1.9,8.9442719,4.472136,0.2236068,-22.137073
333.434949,0.7,2,8.9442719,4.472136,0.2236068,-22.137073
0,3.5,2.2,0,10,0.2,-9.8
225,3.7,2.4,7.0710678,7.0710678,0.2828427,-13.8592929
90,3.7,2.2,0,10,0.2,-9.8
315,4.5,1.7,7.0710678,7.0710678,0.1414214,-14.0007143
206.565051,4.7,1.8,13.4164079,4.472136,0.2236068,-22.137073
63.434949,4.6,1.6,8.9442719,4.472136,0.2236068,-22.137073
315,5.5,2.1,7.0710678,7.0710678,0.1414214,-14.0007143
270,5.5,2.3,0,10,0.2,-9.8
108.434949,5.6,2,22.1359436,3.1622777,0.3162278,-31.3065488
206.565051,6.9,2.7,13.4164079,4.472136,0.2236068,-22.137073
63.434949,6.8,2.5,8.9442719,4.472136,0.2236068,-22.137073
315,6.7,2.6,7.0710678,7.0710678,0.1414214,-14.0007143
333.434949,7.3,1.9,8.9442719,4.472136,0.2236068,-22.137073
225,7.4,2,7.0710678,7.0710678,0.1414214,-14.0007143
116.565051,7.5,1.8,13.4164079,4.472136,0.2236068,-22.137073
26.565051,8.2,1.5,13.4164079,4.472136,0.2236068,-22.137073
153.434949,8.4,1.4,8.9442719,4.472136,0.2236068,-22.137073
270,8.4,1.6,0,10,0.2,-9.8
180,9.3,1.7,0,10,0.1,-9.9
270,9.3,1.8,0,10,0.1,-9.9
45,9.2,1.7,7.0710678,7.0710678,0.1414214,-14.0007143
153.434949,9.3,2.4,8.9442719,4.472136,0.2236068,-22.137073
270,9.3,2.7,0,10,0.3,-9.7
45,9.1,2.5,7.0710678,7.0710678,0.2828427,-13.8592929
206.565051,9.1,3.5,13.4164079,4.472136,0.2236068,-22.137073
63.434949,9,3.3,8.9442719,4.472136,0.2236068,-22.137073
315,8.9,3.4,7.0710678,7.0710678,0.1414214,-14.0007143
180,6.5,2.9,0,10,0.2,-9.8
270,6.5,3.2,0,10,0.3,-9.7
56.309932,6.3,2.9,22.1880078,2.773501,0.3605551,-35.6949576
198.434949,5.4,3.8,22.1359436,3.1622777,0.3162278,-31.3065488
71.565051,5.3,3.5,9.486833,3.1622777,0.3162278,-31.3065488
315,5.1,3.7,7.0710678,7.0710678,0.2828427,-13.8592929
180,3.8,3.3,0,10,0.3,-9.7
270,3.8,3.6,0,10,0.3,-9.7
45,3.5,3.3,7.0710678,7.0710678,0.4242641,-13.7178716
225,3.3,4.3,7.0710678,7.0710678,0.2828427,-13.8592929
90,3.3,4.1,0,10,0.2,-9.8
0,3.1,4.1,0,10,0.2,-9.8
206.565051,1.6,3.9,13.4164079,4.472136,0.2236068,-22.137073
63.434949,1.5,3.7,8.9442719,4.472136,0.2236068,-22.137073
315,1.4,3.8,7.0710678,7.0710678,0.1414214,-14.0007143
108.434949,1,3.7,22.1359436,3.1622777,0.3162278,-31.3065488
341.565051,0.7,3.8,9.486833,3.1622777,0.3162278,-31.3065488
225,0.9,4,7.0710678,7.0710678,0.2828427,-13.8592929
270,1.5,4.5,0,10,0.2,-9.8
45,1.3,4.3,7.0710678,7.0710678,0.2828427,-13.8592929
180,1.5,4.3,0,10,0.2,-9.8
315,3.6,4.7,7.0710678,7.0710678,0.1414214,-14.0007143
206.565051,3.8,4.8,13.4164079,4.472136,0.2236068,-22.137073
63.434949,3.7,4.6,8.9442719,4.472136,0.2236068,-22.137073
0,5.1,4,0,10,0.1,-9.9
225,5.2,4.1,7.0710678,7.0710678,0.1414214,-14.0007143
90,5.2,4,0,10,0.1,-9.9
0,6.9,3.8,0,10,0.2,-9.8
243.434949,7,4,8.9442719,4.472136,0.2236068,-22.137073
116.565051,7.1,3.8,13.4164079,4.472136,0.2236068,-22.137073
26.565051,7.3,4.5,13.4164079,4.472136,0.2236068,-22.137073
116.565051,7.4,4.3,13.4164079,4.472136,0.2236068,-22.137073
251.565051,7.5,4.6,9.486833,3.1622777,0.3162278,-31.3065488
63.434949,8.8,3.6,8.9442719,4.472136,0.2236068,-22.137073
180,9,3.6,0,10,0.2,-9.8
296.565051,8.9,3.8,13.4164079,4.472136,0.2236068,-22.137073
180,9,5.4,0,10,0.3,-9.7
270,9,5.7,0,10,0.3,-9.7
45,8.7,5.4,7.0710678,7.0710678,0.4242641,-13.7178716
180,8.6,5.6,0,10,0.2,-9.8
270,8.6,5.8,0,10,0.2,-9.8
45,8.4,5.6,7.0710678,7.0710678,0.2828427,-13.8592929
243.434949,8.2,6.5,8.9442719,4.472136,0.2236068,-22.137073
26.565051,8,6.4,13.4164079,4.472136,0.2236068,-22.137073
135,8.1,6.3,7.0710678,7.0710678,0.1414214,-14.0007143
243.434949,6.7,6,8.9442719,4.472136,0.2236068,-22.137073
116.565051,6.8,5.8,13.4164079,4.472136,0.2236068,-22.137073
0,6.6,5.8,0,10,0.2,-9.8
225,6.2,6.1,7.0710678,7.0710678,0.2828427,-13.8592929
108.434949,6.3,5.8,22.1359436,3.1622777,0.3162278,-31.3065488
341.565051,6,5.9,9.486833,3.1622777,0.3162278,-31.3065488
135,5.9,5.4,7.0710678,7.0710678,0.1414214,-14.0007143
243.434949,6,5.6,8.9442719,4.472136,0.2236068,-22.137073
26.565051,5.8,5.5,13.4164079,4.472136,0.2236068,-22.137073
180,4.8,6,0,10,0.1,-9.9
270,4.8,6.1,0,10,0.1,-9.9
45,4.7,6,7.0710678,7.0710678,0.1414214,-14.0007143
206.565051,4.4,6.7,13.4164079,4.472136,0.2236068,-22.137073
63.434949,4.3,6.5,8.9442719,4.472136,0.2236068,-22.137073
315,4.2,6.6,7.0710678,7.0710678,0.1414214,-14.0007143
225,3.4,6.5,7.0710678,7.0710678,0.2828427,-13.8592929
90,3.4,6.2,0,10,0.3,-9.7
333.434949,3.2,6.3,8.9442719,4.472136,0.2236068,-22.137073
180,3,6.1,0,10,0.2,-9.8
270,3,6.3,0,10,0.2,-9.8
45,2.8,6.1,7.0710678,7.0710678,0.2828427,-13.8592929
135,2.1,5.6,7.0710678,7.0710678,0.1414214,-14.0007143
243.434949,2.2,5.8,8.9442719,4.472136,0.2236068,-22.137073
26.565051,2,5.7,13.4164079,4.472136,0.2236068,-22.137073
180,1.1,6.3,0,10,0.2,-9.8
270,1.1,6.5,0,10,0.2,-9.8
45,0.9,6.3,7.0710678,7.0710678,0.2828427,-13.8592929
270,0.6,7,0,10,0.3,-9.7
45,0.4,6.8,7.0710678,7.0710678,0.2828427,-13.8592929
153.434949,0.6,6.7,8.9442719,4.472136,0.2236068,-22.137073
243.434949,8.2,7.8,8.9442719,4.472136,0.2236068,-22.137073
90,8.2,7.6,0,10,0.2,-9.8
0,8.1,7.6,0,10,0.1,-9.9
135,8.7,8.2,7.0710678,7.0710678,0.1414214,-14.0007143
243.434949,8.8,8.4,8.9442719,4.472136,0.2236068,-22.137073
26.565051,8.6,8.3,13.4164079,4.472136,0.2236068,-22.137073
180,8.6,8.4,0,10,0.2,-9.8
251.565051,8.7,8.7,9.486833,3.1622777,0.3162278,-31.3065488
45,8.4,8.4,7.0710678,7.0710678,0.4242641,-13.7178716
153.434949,7.2,9.2,8.9442719,4.472136,0.2236068,-22.137073
135,6.5,7.3,7.0710678,7.0710678,0.1414214,-14.0007143
243.434949,6.6,7.5,8.9442719,4.472136,0.2236068,-22.137073
26.565051,6.4,7.4,13.4164079,4.472136,0.2236068,-22.137073
135,6.3,7.7,7.0710678,7.0710678,0.1414214,-14.0007143
251.565051,6.4,8,9.486833,3.1622777,0.3162278,-31.3065488
45,6.2,7.8,7.0710678,7.0710678,0.2828427,-13.8592929
26.565051,2.6,7.6,13.4164079,4.472136,0.2236068,-22.137073
153.434949,2.8,7.5,8.9442719,4.472136,0.2236068,-22.137073
270,2.8,7.7,0,10,0.2,-9.8
90,4.5,7.9,0,10,0.2,-9.8
0,4.3,7.9,0,10,0.2,-9.8
225,4.5,8.1,7.0710678,7.0710678,0.2828427,-13.8592929
63.434949,4.9,8.3,8.9442719,4.472136,0.2236068,-22.137073
315,4.8,8.4,7.0710678,7.0710678,0.1414214,-14.0007143
206.565051,5,8.5,13.4164079,4.472136,0.2236068,-22.137073
153.434949,5.8,8.8,8.9442719,4.472136,0.2236068,-22.137073
270,5.8,9.1,0,10,0.3,-9.7
45,5.6,8.9,7.0710678,7.0710678,0.2828427,-13.8592929
0,2.8,9.3,0,10,0.3,-9.7
135,2.6,8,7.0710678,7.0710678,0.1414214,-14.0007143
270,2.6,8.2,0,10,0.2,-9.8
45,2.5,8.1,7.0710678,7.0710678,0.1414214,-14.0007143
116.565051,0.8,8.2,13.4164079,4.472136,0.2236068,-22.137073
333.434949,0.6,8.3,8.9442719,4.472136,0.2236068,-22.137073
225,0.7,8.4,7.0710678,7.0710678,0.1414214,-14.0007143
135,1.2,8.6,7.0710678,7.0710678,0.1414214,-14.0007143
243.434949,1.3,8.8,8.9442719,4.472136,0.2236068,-22.137073
26.565051,1.1,8.7,13.4164079,4.472136,0.2236068,-22.137073
0,8.74875,8.58939,0,10,0,-10
0,8.12326,9.16255,0,10,0,-10
0,8.22334,7.41455,0,10,0,-10
0,7.2264,8.32807,0,10,0,-10
0,6.60091,8.90123,0,10,0,-10
0,8.74106,5.28385,0,10,0,-10
0,8.11556,5.85701,0,10,0,-10
0,6.70099,7.15323,0,10,0,-10
0,5.70405,8.06676,0,10,0,-10
0,5.07855,8.63992,0,10,0,-10
0,8.21564,4.10901,0,10,0,-10
0,7.2187,5.02254,0,10,0,-10
0,6.59321,5.5957,0,10,0,-10
0,5.17863,6.89192,0,10,0,-10
0,4.18169,7.80544,0,10,0,-10
0,3.5562,8.3786,0,10,0,-10
0,8.73336,1.97832,0,10,0,-10
0,8.10787,2.55148,0,10,0,-10
0,6.69329,3.8477,0,10,0,-10
0,5.69635,4.76122,0,10,0,-10
0,5.07086,5.33438,0,10,0,-10
0,3.65628,6.6306,0,10,0,-10
0,2.65934,7.54413,0,10,0,-10
0,2.03385,8.11729,0,10,0,-10
0,8.20795,0.80348,0,10,0,-10
0,7.21101,1.717,0,10,0,-10
0,6.58551,2.29016,0,10,0,-10
0,5.17094,3.58638,0,10,0,-10
0,4.174,4.49991,0,10,0,-10
0,3.5485,5.07307,0,10,0,-10
0,2.13393,6.36929,0,10,0,-10
0,1.13699,7.28282,0,10,0,-10
0,0.51149,7.85597,0,10,0,-10
0,6.68559,0.54216,0,10,0,-10
0,5.68865,1.45569,0,10,0,-10
0,5.06316,2.02885,0,10,0,-10
0,3.53626,3.22649,0,10,0,-10
0,2.65164,4.23859,0,10,0,-10
0,2.02615,4.81175,0,10,0,-10
0,0.61157,6.10797,0,10,0,-10
0,5.16324,0.28085,0,10,0,-10
0,4.1663,1.19437,0,10,0,-10
0,3.54081,1.76753,0,10,0,-10
0,2.12623,3.06375,0,10,0,-10
0,1.12929,3.97728,0,10,0,-10
0,0.5038,4.55044,0,10,0,-10
0,3.64089,0.01953,0,10,0,-10
0,2.64395,0.93306,0,10,0,-10
0,2.01845,1.50622,0,10,0,-10
0,0.60388,2.80244,0,10,0,-10
0,1.12159,0.67174,0,10,0,-10
0,0.4961,1.2449,0,10,0,-10
0,9.15644,8.35141,0,10,0,-10
0,8.31335,8.05964,0,10,0,-10
0,7.76295,8.41028,0,10,0,-10
0,8.6371,7.02451,0,10,0,-10
0,6.91985,8.11852,0,10,0,-10
0,6.36945,8.46916,0,10,0,-10
0,7.2436,7.08339,0,10,0,-10
0,5.52636,8.17739,0,10,0,-10
0,4.97596,8.52804,0,10,0,-10
0,8.67916,5.33996,0,10,0,-10
0,8.12876,5.69061,0,10,0,-10
0,5.85011,7.14227,0,10,0,-10
0,4.13287,8.23627,0,10,0,-10
0,3.58247,8.58691,0,10,0,-10
0,9.00291,4.30484,0,10,0,-10
0,7.28566,5.39884,0,10,0,-10
0,6.73527,5.74948,0,10,0,-10
0,4.45662,7.20114,0,10,0,-10
0,2.73937,8.29515,0,10,0,-10
0,2.18897,8.64579,0,10,0,-10
0,7.60942,4.36371,0,10,0,-10
0,5.89217,5.45772,0,10,0,-10
0,5.34177,5.80836,0,10,0,-10
0,3.06312,7.26002,0,10,0,-10
0,1.34588,8.35403,0,10,0,-10
0,0.79548,8.70467,0,10,0,-10
0,9.04497,2.62029,0,10,0,-10
0,8.49457,2.97093,0,10,0,-10
0,6.21592,4.42259,0,10,0,-10
0,4.49868,5.5166,0,10,0,-10
0,3.94828,5.86724,0,10,0,-10
0,1.66963,7.3189,0,10,0,-10
0,9.36872,1.58516,0,10,0,-10
0,7.65148,2.67917,0,10,0,-10
0,7.10108,3.02981,0,10,0,-10
0,4.82243,4.48147,0,10,0,-10
0,3.10518,5.57547,0,10,0,-10
0,2.55479,5.92612,0,10,0,-10
0,0.27613,7.37778,0,10,0,-10
0,7.97523,1.64404,0,10,0,-10
0,6.25798,2.73804,0,10,0,-10
0,5.70758,3.08869,0,10,0,-10
0,3.42893,4.54035,0,10,0,-10
0,1.71169,5.63435,0,10,0,-10
0,1.16129,5.98499,0,10,0,-10
0,8.86038,0.25125,0,10,0,-10
0,6.58173,1.70292,0,10,0,-10
0,4.86449,2.79692,0,10,0,-10
0,4.31409,3.14756,0,10,0,-10
0,2.03544,4.59922,0,10,0,-10
0,0.3182,5.69323,0,10,0,-10
0,7.46689,0.31013,0,10,0,-10
0,5.18824,1.76179,0,10,0,-10
0,3.471,2.8558,0,10,0,-10
0,2.9206,3.20644,0,10,0,-10
0,0.64195,4.6581,0,10,0,-10
0,6.6238,0.01837,0,10,0,-10
0,6.0734,0.36901,0,10,0,-10
0,3.79475,1.82067,0,10,0,-10
0,2.0775,2.91468,0,10,0,-10
0,1.5271,3.26532,0,10,0,-10
0,5.2303,0.07724,0,10,0,-10
0,4.6799,0.42789,0,10,0,-10
0,2.40125,1.87955,0,10,0,-10
0,0.68401,2.97355,0,10,0,-10
0,0.13361,3.3242,0,10,0,-10
0,3.83681,0.13612,0,10,0,-10
0,3.28641,0.48676,0,10,0,-10
0,1.00776,1.93842,0,10,0,-10
0,2.44331,0.195,0,10,0,-10
0,1.89292,0.54564,0,10,0,-10
0,1.04982,0.25388,0,10,0,-10
0,0.49942,0.60452,0,10,0,-10
0,6.42555,9.30607,0,10,0,-10
0,4.77695,9.08903,0,10,0,-10
0,3.7883,8.95887,0,10,0,-10
0,3.13481,8.87284,0,10,0,-10
0,1.48621,8.6558,0,10,0,-10
0,0.49757,8.52564,0,10,0,-10
0,9.02957,8.70973,0,10,0,-10
0,7.38097,8.49269,0,10,0,-10
0,6.39232,8.36253,0,10,0,-10
0,5.73883,8.2765,0,10,0,-10
0,4.09023,8.05946,0,10,0,-10
0,3.10158,7.9293,0,10,0,-10
0,2.4481,7.84327,0,10,0,-10
0,0.79949,7.62622,0,10,0,-10
0,8.99634,7.76619,0,10,0,-10
0,8.34285,7.68016,0,10,0,-10
0,6.69425,7.46312,0,10,0,-10
0,5.7056,7.33296,0,10,0,-10
0,5.05211,7.24692,0,10,0,-10
0,3.40351,7.02988,0,10,0,-10
0,2.41487,6.89972,0,10,0,-10
0,1.76138,6.81369,0,10,0,-10
0,0.11277,6.59665,0,10,0,-10
0,9.29827,6.86677,0,10,0,-10
0,8.30962,6.73662,0,10,0,-10
0,7.65613,6.65058,0,10,0,-10
0,6.00753,6.43354,0,10,0,-10
0,5.01888,6.30338,0,10,0,-10
0,4.3654,6.21735,0,10,0,-10
0,2.71679,6.00031,0,10,0,-10
0,1.72815,5.87015,0,10,0,-10
0,1.07466,5.78412,0,10,0,-10
0,8.61155,5.8372,0,10,0,-10
0,7.6229,5.70704,0,10,0,-10
0,6.96941,5.62101,0,10,0,-10
0,5.32081,5.40397,0,10,0,-10
0,4.33217,5.27381,0,10,0,-10
0,3.67868,5.18777,0,10,0,-10
0,2.03007,4.97073,0,10,0,-10
0,1.04143,4.84057,0,10,0,-10
0,0.38794,4.75454,0,10,0,-10
0,7.92483,4.80762,0,10,0,-10
0,6.93618,4.67747,0,10,0,-10
0,6.2827,4.59143,0,10,0,-10
0,4.63409,4.37439,0,10,0,-10
0,3.64545,4.24423,0,10,0,-10
0,2.99196,4.1582,0,10,0,-10
0,1.34336,3.94116,0,10,0,-10
0,0.35471,3.811,0,10,0,-10
0,8.88671,3.99509,0,10,0,-10
0,7.23811,3.77805,0,10,0,-10
0,6.24947,3.64789,0,10,0,-10
0,5.59598,3.56186,0,10,0,-10
0,3.94737,3.34482,0,10,0,-10
0,2.95873,3.21466,0,10,0,-10
0,2.30524,3.12862,0,10,0,-10
0,0.65664,2.91158,0,10,0,-10
0,8.85348,3.05155,0,10,0,-10
0,8.19999,2.96552,0,10,0,-10
0,6.55139,2.74847,0,10,0,-10
0,5.56275,2.61832,0,10,0,-10
0,4.90926,2.53228,0,10,0,-10
0,3.26065,2.31524,0,10,0,-10
0,2.27201,2.18508,0,10,0,-10
0,1.61852,2.09905,0,10,0,-10
0,9.15541,2.15213,0,10,0,-10
0,8.16676,2.02197,0,10,0,-10
0,7.51328,1.93594,0,10,0,-10
0,5.86467,1.7189,0,10,0,-10
0,4.87603,1.58874,0,10,0,-10
0,4.22254,1.50271,0,10,0,-10
0,2.57394,1.28567,0,10,0,-10
0,1.58529,1.15551,0,10,0,-10
0,0.9318,1.06947,0,10,0,-10
0,8.46869,1.12256,0,10,0,-10
0,7.48005,0.9924,0,10,0,-10
0,6.82656,0.90637,0,10,0,-10
0,5.17795,0.68932,0,10,0,-10
0,4.18931,0.55917,0,10,0,-10
0,3.53582,0.47313,0,10,0,-10
0,1.88722,0.25609,0,10,0,-10
0,0.89857,0.12593,0,10,0,-10
0,0.24508,0.0399,0,10,0,-10
0,7.78197,0.09298,0,10,0,-10
0,1.25458,8.906,0,10,0,-10
0,2.59486,9.0898,0,10,0,-10
0,1.22284,8.03701,0,10,0,-10
0,3.91339,9.25692,0,10,0,-10
0,2.56312,8.22081,0,10,0,-10
0,1.19109,7.16803,0,10,0,-10
0,3.88165,8.38793,0,10,0,-10
0,2.53137,7.35183,0,10,0,-10
0,1.15935,6.29904,0,10,0,-10
0,5.23746,8.58365,0,10,0,-10
0,3.84991,7.51894,0,10,0,-10
0,2.49963,6.48284,0,10,0,-10
0,1.12761,5.43005,0,10,0,-10
0,6.57774,8.76745,0,10,0,-10
0,5.20572,7.71466,0,10,0,-10
0,3.81816,6.64995,0,10,0,-10
0,2.46789,5.61385,0,10,0,-10
0,1.09587,4.56106,0,10,0,-10
0,7.89627,8.93456,0,10,0,-10
0,6.546,7.89846,0,10,0,-10
0,5.17398,6.84567,0,10,0,-10
0,3.78642,5.78096,0,10,0,-10
0,2.43615,4.74486,0,10,0,-10
0,1.06413,3.69207,0,10,0,-10
0,9.25208,9.13028,0,10,0,-10
0,7.86453,8.06557,0,10,0,-10
0,6.51425,7.02947,0,10,0,-10
0,5.14223,5.97668,0,10,0,-10
0,3.75468,4.91198,0,10,0,-10
0,2.4044,3.87587,0,10,0,-10
0,1.03238,2.82308,0,10,0,-10
0,9.22034,8.26129,0,10,0,-10
0,7.83279,7.19659,0,10,0,-10
0,6.48251,6.16048,0,10,0,-10
0,5.11049,5.10769,0,10,0,-10
0,3.72294,4.04299,0,10,0,-10
0,2.37266,3.00688,0,10,0,-10
0,1.00064,1.9541,0,10,0,-10
0,9.1886,7.3923,0,10,0,-10
0,7.80105,6.3276,0,10,0,-10
0,6.45077,5.29149,0,10,0,-10
0,5.07875,4.23871,0,10,0,-10
0,3.6912,3.174,0,10,0,-10
0,2.34092,2.1379,0,10,0,-10
0,0.9689,1.08511,0,10,0,-10
0,9.15686,6.52332,0,10,0,-10
0,7.7693,5.45861,0,10,0,-10
0,6.41903,4.42251,0,10,0,-10
0,5.04701,3.36972,0,10,0,-10
0,2.30918,1.26891,0,10,0,-10
0,0.93716,0.21612,0,10,0,-10
0,9.12511,5.65433,0,10,0,-10
0,7.73756,4.58962,0,10,0,-10
0,6.38729,3.55352,0,10,0,-10
0,5.01527,2.50073,0,10,0,-10
0,3.62771,1.43602,0,10,0,-10
0,2.27744,0.39992,0,10,0,-10
0,9.09337,4.78534,0,10,0,-10
0,7.70582,3.72063,0,10,0,-10
0,6.35554,2.68453,0,10,0,-10
0,4.98352,1.63174,0,10,0,-10
0,3.59597,0.56703,0,10,0,-10
0,9.06163,3.91635,0,10,0,-10
0,7.67408,2.85164,0,10,0,-10
0,6.3238,1.81554,0,10,0,-10
0,4.95178,0.76275,0,10,0,-10
0,9.02989,3.04736,0,10,0,-10
0,7.64234,1.98266,0,10,0,-10
0,6.29206,0.94655,0,10,0,-10
0,8.99815,2.17837,0,10,0,-10
0,7.61059,1.11367,0,10,0,-10
0,6.26032,0.07756,0,10,0,-10
0,8.9664,1.30939,0,10,0,-10
0,7.57885,0.24468,0,10,0,-10
0,8.93466,0.4404,0,10,0,-10
206.565051,10,0.6,13.4164079,4.472136,0.2236068,-22.137073
63.434949,9.9,0.4,8.9442719,4.472136,0.2236068,-22.137073
315,9.8,0.5,7.0710678,7.0710678,0.1414214,-14.0007143
206.565051,9.7,5.4,13.4164079,4.472136,0.2236068,-22.137073
63.434949,9.6,5.2,8.9442719,4.472136,0.2236068,-22.137073
315,9.5,5.3,7.0710678,7.0710678,0.1414214,-14.0007143
153.434949,10,7.2,8.9442719,4.472136,0.2236068,-22.137073
288.434949,9.9,7.5,22.1359436,3.1622777,0.3162278,-31.3065488
63.434949,9.8,7.3,8.9442719,4.472136,0.2236068,-22.137073
135,9.7,9.3,7.0710678,7.0710678,0.1414214,-14.0007143
270,9.7,9.5,0,10,0.2,-9.8
45,9.6,9.4,7.0710678,7.0710678,0.1414214,-14.0007143
0,7.7,9.6,0,10,0.2,-9.8
270,7.2,9.4,0,10,0.2,-9.8
26.565051,7,9.3,13.4164079,4.472136,0.2236068,-22.137073
0,9.50621,9.4965,0,10,0,-10
0,9.74569,7.67586,0,10,0,-10
0,9.63792,6.11833,0,10,0,-10
0,9.738,4.37033,0,10,0,-10
0,9.63022,2.81279,0,10,0,-10
0,9.7303,1.06479,0,10,0,-10
0,9.70684,8.00076,0,10,0,-10
0,9.52225,5.63173,0,10,0,-10
0,9.88807,2.91205,0,10,0,-10
0,8.06768,9.52227,0,10,0,-10
0,7.07904,9.39211,0,10,0,-10
0,9.68306,8.79577,0,10,0,-10
0,9.98498,7.89635,0,10,0,-10
0,9.57343,5.02467,0,10,0,-10
0,9.5402,4.08112,0,10,0,-10
0,9.84213,3.18171,0,10,0,-10
0,9.43058,0.31003,0,10,0,-10
243.434949,7.8,9.8,8.9442719,4.472136,0.2236068,-22.137073
116.565051,7.9,9.6,13.4164079,4.472136,0.2236068,-22.137073
180,6,9.7,0,10,0.2,-9.8
270,6,9.9,0,10,0.2,-9.8
45,5.8,9.7,7.0710678,7.0710678,0.2828427,-13.8592929
296.565051,4.1,10,13.4164079,4.472136,0.2236068,-22.137073
63.434949,4,9.8,8.9442719,4.472136,0.2236068,-22.137073
180,4.2,9.8,0,10,0.2,-9.8
135,3.4,9.4,7.0710678,7.0710678,0.1414214,-14.0007143
243.434949,3.5,9.6,8.9442719,4.472136,0.2236068,-22.137073
26.565051,3.3,9.5,13.4164079,4.472136,0.2236068,-22.137073
116.565051,3.1,9.3,13.4164079,4.472136,0.2236068,-22.137073
225,3,9.5,7.0710678,7.0710678,0.2828427,-13.8592929
45,0,9.7,7.0710678,7.0710678,0.2828427,-13.8592929
161.565051,0.3,9.6,9.486833,3.1622777,0.3162278,-31.3065488
288.434949,0.2,9.9,22.1359436,3.1622777,0.3162278,-31.3065488
0,3.66398,9.93614,0,10,0,-10
0,2.14162,9.67482,0,10,0,-10
0,0.61927,9.41351,0,10,0,-10
0,6.87779,9.80307,0,10,0,-10
0,5.4843,9.86194,0,10,0,-10
0,2.69731,9.9797,0,10,0,-10
0,4.47502,9.98845,0,10,0,-10
0,3.82153,9.90242,0,10,0,-10
0,2.17293,9.68537,0,10,0,-10
0,1.18429,9.55522,0,10,0,-10
0,0.5308,9.46918,0,10,0,-10
0,1.28632,9.77499,0,10,0,-10
0,2.6266,9.95879,0,10,0,-10
0,5.2692,9.45264,0,10,0,-10
0,6.60948,9.63644,0,10,0,-10
0,7.92801,9.80355,0,10,0,-10
0,9.66478,9.68531,0,10,0,-10
0,8.27128,9.74419,0,10,0,-10
0,9.71629,9.73931,0,10,0,-10
0,9.28383,9.99927,0,10,0,-10
`),!1);ie(ee.ParsePatFile(`
*AR-CONC,AR-CONC
50, 0,0, 4.12975034,-5.89789472, .75,-8.25
355, 0,0, -2.03781207,7.3723684, .6,-6.6
100.4514, .5977168,-.0522934, 5.7305871,-6.9397673, .6374019,-7.01142112
46.1842, 0,2, 6.19462551,-8.84684208, 1.125,-12.375
96.6356, .88936745,1.86206693, 8.59588071,-10.40965104, .95610288,-10.51713
351.1842, 0,2, 7.74328189,11.0585526, .9,-9.9
21, 1,1.5, 4.12975034,-5.89789472, .75,-8.25
326, 1,1.5, -2.03781207,7.3723684, .6,-6.6
71.4514, 1.49742233,1.16448394, 5.7305871,-6.9397673, .6374019,-7.01142112
37.5, 0,0, 2.123,2.567, 0,-6.52,0,-6.7,0,-6.625
7.5, 0,0, 3.123,3.567, 0,-3.82,0,-6.37,0,-2.525
-32.5, -2.23,0, 4.6234,2.678, 0,-2.5,0,-7.8,0,-10.35
-42.5, -3.23,0, 3.6234,4.678, 0,-3.25,0,-5.18,0,-7.35
`),!1);ie(ee.ParsePatFile(`
*AR-HBONE,AR-HBONE
45, 0,0, 4,4, 12,-4
135, 2.82842713,2.82842713, 4,-4, 12,-4
`),!1);ie(ee.ParsePatFile(`
*AR-PARQ1,AR-PARQ1
90, 0,0, 12,12, 12,-12
90, 2,0, 12,12, 12,-12
90, 4,0, 12,12, 12,-12
90, 6,0, 12,12, 12,-12
90, 8,0, 12,12, 12,-12
90, 10,0, 12,12, 12,-12
90, 12,0, 12,12, 12,-12
0, 0,12, 12,-12, 12,-12
0, 0,14, 12,-12, 12,-12
0, 0,16, 12,-12, 12,-12
0, 0,18, 12,-12, 12,-12
0, 0,20, 12,-12, 12,-12
0, 0,22, 12,-12, 12,-12
0, 0,24, 12,-12, 12,-12
`),!1);ie(ee.ParsePatFile(`
*AR-RROOF,AR-RROOF
0, 0,0, 2.2,1, 15,-2,5,-1
0, 1.33,.5, -1,1.33, 3,-.33,6,-.75
0, .5,.85, 5.2,.67, 8,-1.4,4,-1
`),!1);ie(ee.ParsePatFile(`
*AR-RSHKE,AR-RSHKE
0, 0,0, 25.5,12, 6,-5,7,-3,9,-4
0, 6,.5, 25.5,12, 5,-19,4,-6
0, 18,-.75, 25.5,12, 3,-31
90, 0,0, 12,8.5, 11.5,-36.5
90, 6,0, 12,8.5, 11.25,-36.75
90, 11,0, 12,8.5, 10.5,-37.5
90, 18,-.75, 12,8.5, 11.5,-36.5
90, 21,-.75, 12,8.5, 11.5,-36.5
90, 30,0, 12,8.5, 11,-37
`),!1);ie(ee.ParsePatFile(`
*AR-SAND,AR-SAND
37.5, 0,0, 1.123,1.567, 0,-1.52,0,-1.7,0,-1.625
7.5, 0,0, 2.123,2.567, 0,-.82,0,-1.37,0,-.525
-32.5, -1.23,0, 2.6234,1.678, 0,-.5,0,-1.8,0,-2.35
-42.5, -1.23,0, 1.6234,2.678, 0,-.25,0,-1.18,0,-1.35
`),!1);ie(ee.ParsePatFile(`
*BARBWIRE,BARBWIRE
;By John Hyslop
;Developed in inch as imperial QCAD3 pattern
315,0.3,0.56,0.70710678,0.70710678,0.01414214,-1.40007143
288.434949,0.26,0.68,2.21359436,0.31622777,0.12649111,-3.03578655
158.198591,0.31,0.66,3.15682075,0.18569534,0.05385165,-5.33131316
116.565051,0.32,0.64,1.34164079,0.4472136,0.02236068,-2.2137073
116.565051,0.34,0.6,1.34164079,0.4472136,0.04472136,-2.19134662
111.801409,0.44,0.39,2.22834406,0.18569534,0.05385165,-5.33131316
156.801409,0.51,0.36,5.38356375,0.13130643,0.07615773,-7.53961537
289.653824,0.46,0.5,11.70450662,0.06726728,0.14866069,-14.71740806
194.036243,0.31,0.36,3.15296313,0.24253563,0.04123106,-4.08187457
251.565051,0.32,0.39,0.9486833,0.31622777,0.03162278,-3.13065488
254.054604,0.34,0.46,4.12081692,0.13736056,0.0728011,-7.20730879
74.744881,0.34,0.46,4.12217269,0.0877058,0.11401754,-11.28773671
135,0.36,0.44,0.70710678,0.70710678,0.02828427,-1.38592929
180,0.39,0.44,0,1,0.03,-0.97
270,0.39,0.45,0,1,0.01,-0.99
74.054604,0.39,0.45,4.12081692,0.13736056,0.1456022,-7.13450769
161.565051,0.42,0.44,0.9486833,0.31622777,0.03162278,-3.13065488
198.434949,0.45,0.45,2.21359436,0.31622777,0.03162278,-3.13065488
258.231711,0.5,0.69,5.09885635,0.04079085,0.24515301,-24.27014833
21.801409,0.45,0.67,2.22834406,0.18569534,0.05385165,-5.33131316
75.963757,0.43,0.59,0.9701425,0.24253563,0.08246211,-4.04064351
341.565051,0.4,0.6,0.9486833,0.31622777,0.03162278,-3.13065488
45,0.37,0.57,0.70710678,0.70710678,0.04242641,-1.37178716
288.434949,0.36,0.6,2.21359436,0.31622777,0.03162278,-3.13065488
0,0.34,0.6,0,1,0.02,-0.98
26.565051,0.32,0.59,1.34164079,0.4472136,0.02236068,-2.2137073
78.231711,0.27,0.35,5.09885635,0.04079085,0.24515301,-24.27014833
4.085617,0.78,0.48,13.03821015,0.07124705,0.14035669,-13.89531216
0,0.69,0.48,0,1,0.09,-0.91
354.289407,0.59,0.49,0.99503719,0.09950372,0.10049876,-9.94937686
356.185925,0.47,0.55,0.99778516,0.06651901,0.15033296,-14.88296341
351.469234,0.8,0.55,7.07089492,0.04944682,0.20223748,-20.02151093
0,0.66,0.55,0,1,0.14,-0.86
14.036243,0.46,0.5,3.15296313,0.24253563,0.20615528,-3.91695034
189.865807,0.7,0.51,17.26262336,0.04283529,0.23345235,-23.11178271
180,0.8,0.51,0,1,0.1,-0.9
171.469234,1,0.48,7.07089492,0.04944682,0.20223748,-20.02151093
186.115504,1,0.56,9.05531551,0.03551104,0.15644586,-28.00380982
5.52754,0.13777778,0.53333333,10.04982433,0.03210806,0.17302679,-30.97179621
3.691386,0,0.48,15.03326191,0.03219114,0.1515339,-30.91291524
348.310631,0,0.52,5.0989077,0.0337676,0.29614186,-29.31804393
348.690068,0,0.56,0.98058068,0.19611614,0.30594117,-4.79307834
`),!1);ie(ee.ParsePatFile(`
*BLOCKS-01,BLOCKS-01 verbose
;By John Hyslop,    Tile2Hatch tool \xA9 CVH 2020
;Developed in inch as imperial QCAD3 pattern
270,0.31,0.66,1,1,0.22,-0.78
180,0.08,0.09,0,1,0.57,-0.43
270,0.08,0.09,1,1,0.21,-0.79
180,0.08,0.88,0,1,0.57,-0.43
270,0.51,0.09,1,1,0.21,-0.79
270,0.89,0.32,1,1,0.2,-0.8
0,0.49,0.32,0,1,0.4,-0.6
90,0.49,0.12,1,1,0.2,-0.8
180,0.89,0.12,0,1,0.4,-0.6
270,0.69,0.84,1,1,0.48,-0.52
0,0.48,0.84,0,1,0.21,-0.79
90,0.48,0.36,1,1,0.48,-0.52
180,0.69,0.36,0,1,0.21,-0.79
270,0.12,0.03,1,1,0.33,-0.67
0,0.12,0.7,0,1,0.32,-0.68
270,0.44,0.03,1,1,0.33,-0.67
0,0.12,0.03,0,1,0.32,-0.68
270,0.45,0.67,1,1,0.24,-0.76
0,0.36,0.67,0,1,0.09,-0.91
90,0.36,0.43,1,1,0.24,-0.76
180,0.45,0.43,0,1,0.09,-0.91
270,0.45,0.4,1,1,0.33,-0.67
0,0.11,0.4,0,1,0.34,-0.66
90,0.11,0.07,1,1,0.33,-0.67
180,0.45,0.07,0,1,0.34,-0.66
270,0.89,0.41,1,1,0.06,-0.94
0,0.73,0.41,0,1,0.16,-0.84
90,0.73,0.35,1,1,0.06,-0.94
180,0.89,0.35,0,1,0.16,-0.84
180,0.07,0.4,0,1,0.14,-0.86
270,0.93,0.4,1,1,0.27,-0.73
180,0.07,0.13,0,1,0.14,-0.86
270,0.07,0.4,1,1,0.27,-0.73
180,0.08,0.81,0,1,0.34,-0.66
270,0.74,0.81,1,1,0.1,-0.9
180,0.08,0.71,0,1,0.34,-0.66
270,0.08,0.81,1,1,0.1,-0.9
180,0.31,0.66,0,1,0.59,-0.41
270,0.72,0.66,1,1,0.22,-0.78
180,0.31,0.44,0,1,0.59,-0.41
`),!1);ie(ee.ParsePatFile(`
*BLOCKS-02,BLOCKS-02 verbose
;By John Hyslop,    Tile2Hatch tool \xA9 CVH 2020
;Developed in inch as imperial QCAD3 pattern
180,0.32,0.18,0,1,0.49,-0.51
270,0.32,0.55,1,1,0.37,-0.63
0,0.37,0.96,0,1,0.42,-0.58
0,0.17,0.98,0,1,0.17,-0.83
90,0.82,0,1,1,0.15,-0.85
180,0.92,0,0,1,0.1,-0.9
180,0.32,0.55,0,1,0.49,-0.51
270,0.83,0.55,1,1,0.37,-0.63
180,0.13,0.8,0,1,0.18,-0.82
90,0.14,0.59,1,1,0.17,-0.83
270,0.13,0.15,1,1,0.35,-0.65
180,0.71,0.59,0,1,0.57,-0.43
270,0.92,0.15,1,1,0.15,-0.85
0,0.82,0.15,0,1,0.1,-0.9
270,0.71,0.76,1,1,0.17,-0.83
0,0.14,0.76,0,1,0.57,-0.43
180,0.08,0.59,0,1,0.32,-0.68
270,0.08,0.76,1,1,0.17,-0.83
180,0.13,0.15,0,1,0.18,-0.82
270,0.95,0.15,1,1,0.35,-0.65
90,0.18,0.8,1,1,0.13,-0.87
180,0.91,0.8,0,1,0.73,-0.27
180,0.08,0.76,0,1,0.32,-0.68
270,0.76,0.76,1,1,0.17,-0.83
270,0.34,0.15,1,1,0.17,-0.83
0,0.17,0.15,0,1,0.17,-0.83
270,0.91,0.93,1,1,0.13,-0.87
0,0.18,0.93,0,1,0.73,-0.27
0,0.37,0.55,0,1,0.42,-0.58
270,0.37,0.55,1,1,0.59,-0.41
270,0.17,0.15,1,1,0.17,-0.83
270,0.79,0.55,1,1,0.59,-0.41
`),!1);ie(ee.ParsePatFile(`
*BOXJOIN-01,BOXJOIN-01 verbose
;By John Hyslop,    Tile2Hatch tool \xA9 CVH 2020
;Developed in inch as imperial QCAD3 pattern
90,0.15000001,0.15,1,1,0.7,-0.3
0,0.15000001,0.85,0,1,0.7,-0.3
270,0.45000001,0.15,1,1,0.3,-0.7
180,0.15000001,0.45,0,1,0.3,-0.7
270,0.55000001,0.15,1,1,0.3,-0.7
180,0.85000001,0.15,0,1,0.7,-0.3
270,0.85000001,0.85,1,1,0.7,-0.3
180,0.15000001,0.55,0,1,0.3,-0.7
`),!1);ie(ee.ParsePatFile(`
*BOXJOIN-02,BOXJOIN-02 verbose
;By John Hyslop,    Tile2Hatch tool \xA9 CVH 2020
;Developed in inch as imperial QCAD3 pattern
90,0.15000001,0.55,1,1,0.3,-0.7
270,0.85000001,0.85,1,1,0.3,-0.7
0,0.55000001,0.85,0,1,0.3,-0.7
180,0.15000001,0.55,0,1,0.3,-0.7
90,0.15000001,0.15,1,1,0.3,-0.7
180,0.45000001,0.15,0,1,0.3,-0.7
180,0.15000001,0.45,0,1,0.3,-0.7
180,0.85000001,0.15,0,1,0.3,-0.7
270,0.85000001,0.45,1,1,0.3,-0.7
270,0.45000001,0.15,1,1,0.3,-0.7
270,0.55000001,0.15,1,1,0.3,-0.7
0,0.15000001,0.85,0,1,0.3,-0.7
`),!1);ie(ee.ParsePatFile(`
*BOX,BOX
90, 0,0, 0,1
90, .25,0, 0,1
0, 0,0, 0,1, -.25,.25
0, 0,.25, 0,1, -.25,.25
0, 0,.5, 0,1, .25,-.25
0, 0,.75, 0,1, .25,-.25
90, .5,0, 0,1, .25,-.25
90, .75,0, 0,1, .25,-.25
`),!1);ie(ee.ParsePatFile(`
*BOX-OVERLAP,BOX-OVERLAP verbose
;By John Hyslop,    Tile2Hatch tool \xA9 CVH 2020
;Developed in inch as imperial QCAD3 pattern
180,0.2,0.7,0,1,0.4,-0.6
90,0.2,0.2,1,1,0.6,-0.4
270,0.3,0.2,1,1,0.4,-0.6
180,0.2,0.3,0,1,0.4,-0.6
0,0.2,0.8,0,1,0.6,-0.4
180,0.8,0.2,0,1,0.6,-0.4
270,0.8,0.8,1,1,0.6,-0.4
270,0.7,0.2,1,1,0.4,-0.6
`),!1);ie(ee.ParsePatFile(`
*BRASS,BRASS
0, 0,0, 0,.25
0, 0,.125, 0,.25, .125,-.0625
`),!1);ie(ee.ParsePatFile(`
*BRICK,BRICK
0, 0,0, 0,.25
90, 0,0, 0,.5, .25,-.25
90, .25,0, 0,.5, -.25,.25
`),!1);ie(ee.ParsePatFile(`
*BRSTONE,BRSTONE
0, 0,0, 0,.33
90, .9,0, .33,.5, .33,-.33
90, .8,0, .33,.5, .33,-.33
0, .9,.055, .5,.33, -.9,.1
0, .9,.11, .5,.33, -.9,.1
0, .9,.165, .5,.33, -.9,.1
0, .9,.22, .5,.33, -.9,.1
0, .9,.275, .5,.33, -.9,.1
`),!1);ie(ee.ParsePatFile(`
*BUBBLES-01,BUBBLES-01
;By John Hyslop,    Using AutoCAD Lisp Tool
;Developed in inch as imperial QCAD3 pattern
0,0.058964,0.016739,0,1,0,-1
0,0.062236,0.033193,0,1,0,-1
0,0.067629,0.049078,0,1,0,-1
0,0.075048,0.064123,0,1,0,-1
0,0.084368,0.078071,0,1,0,-1
0,0.095429,0.090684,0,1,0,-1
0,0.108041,0.101745,0,1,0,-1
0,0.12199,0.111065,0,1,0,-1
0,0.137035,0.118484,0,1,0,-1
0,0.15292,0.123876,0,1,0,-1
0,0.169373,0.127149,0,1,0,-1
0,0.186113,0.128246,0,1,0,-1
0,0.202852,0.127149,0,1,0,-1
0,0.219305,0.123876,0,1,0,-1
0,0.23519,0.118484,0,1,0,-1
0,0.250236,0.111065,0,1,0,-1
0,0.264184,0.101745,0,1,0,-1
0,0.276796,0.090684,0,1,0,-1
0,0.287857,0.078071,0,1,0,-1
0,0.297177,0.064123,0,1,0,-1
0,0.304597,0.049078,0,1,0,-1
0,0.309989,0.033193,0,1,0,-1
0,0.313262,0.016739,0,1,0,-1
0,0.120008,0.220248,0,1,0,-1
0,0.117478,0.203192,0,1,0,-1
0,0.113288,0.186467,0,1,0,-1
0,0.10748,0.170233,0,1,0,-1
0,0.100108,0.154647,0,1,0,-1
0,0.091244,0.139858,0,1,0,-1
0,0.080973,0.126009,0,1,0,-1
0,0.069394,0.113234,0,1,0,-1
0,0.056618,0.101655,0,1,0,-1
0,0.04277,0.091384,0,1,0,-1
0,0.027981,0.08252,0,1,0,-1
0,0.012394,0.075148,0,1,0,-1
0,0.012394,0.39979,0,1,0,-1
0,0.027981,0.392418,0,1,0,-1
0,0.04277,0.383554,0,1,0,-1
0,0.056618,0.373283,0,1,0,-1
0,0.069394,0.361704,0,1,0,-1
0,0.080973,0.348929,0,1,0,-1
0,0.091244,0.33508,0,1,0,-1
0,0.100108,0.320291,0,1,0,-1
0,0.10748,0.304704,0,1,0,-1
0,0.113288,0.28847,0,1,0,-1
0,0.117478,0.271745,0,1,0,-1
0,0.120008,0.25469,0,1,0,-1
0,0.120854,0.237469,0,1,0,-1
0,0.738076,0.372319,0,1,0,-1
0,0.732613,0.356706,0,1,0,-1
0,0.723812,0.3427,0,1,0,-1
0,0.712116,0.331003,0,1,0,-1
0,0.69811,0.322203,0,1,0,-1
0,0.682497,0.316739,0,1,0,-1
0,0.666059,0.314887,0,1,0,-1
0,0.649622,0.316739,0,1,0,-1
0,0.634009,0.322203,0,1,0,-1
0,0.620003,0.331003,0,1,0,-1
0,0.608306,0.3427,0,1,0,-1
0,0.599506,0.356706,0,1,0,-1
0,0.594042,0.372319,0,1,0,-1
0,0.59219,0.388756,0,1,0,-1
0,0.594042,0.405194,0,1,0,-1
0,0.599506,0.420807,0,1,0,-1
0,0.608306,0.434813,0,1,0,-1
0,0.620003,0.44651,0,1,0,-1
0,0.634009,0.45531,0,1,0,-1
0,0.649622,0.460773,0,1,0,-1
0,0.666059,0.462625,0,1,0,-1
0,0.682497,0.460773,0,1,0,-1
0,0.69811,0.45531,0,1,0,-1
0,0.712116,0.44651,0,1,0,-1
0,0.723812,0.434813,0,1,0,-1
0,0.732613,0.420807,0,1,0,-1
0,0.738076,0.405194,0,1,0,-1
0,0.739928,0.388756,0,1,0,-1
0,0.834916,0.831041,0,1,0,-1
0,0.821448,0.840826,0,1,0,-1
0,0.810309,0.853198,0,1,0,-1
0,0.462763,0.750408,0,1,0,-1
0,0.458683,0.734294,0,1,0,-1
0,0.452005,0.71907,0,1,0,-1
0,0.442913,0.705153,0,1,0,-1
0,0.431654,0.692923,0,1,0,-1
0,0.418536,0.682713,0,1,0,-1
0,0.403916,0.674801,0,1,0,-1
0,0.388193,0.669403,0,1,0,-1
0,0.371796,0.666667,0,1,0,-1
0,0.355172,0.666667,0,1,0,-1
0,0.338776,0.669403,0,1,0,-1
0,0.323053,0.674801,0,1,0,-1
0,0.308433,0.682713,0,1,0,-1
0,0.295314,0.692923,0,1,0,-1
0,0.284056,0.705153,0,1,0,-1
0,0.274963,0.71907,0,1,0,-1
0,0.268286,0.734294,0,1,0,-1
0,0.264205,0.750408,0,1,0,-1
0,0.262832,0.766975,0,1,0,-1
0,0.264205,0.783542,0,1,0,-1
0,0.268286,0.799657,0,1,0,-1
0,0.274963,0.81488,0,1,0,-1
0,0.284056,0.828797,0,1,0,-1
0,0.295314,0.841027,0,1,0,-1
0,0.308433,0.851238,0,1,0,-1
0,0.323053,0.85915,0,1,0,-1
0,0.403916,0.85915,0,1,0,-1
0,0.418536,0.851238,0,1,0,-1
0,0.431654,0.841027,0,1,0,-1
0,0.442913,0.828797,0,1,0,-1
0,0.452005,0.81488,0,1,0,-1
0,0.458683,0.799657,0,1,0,-1
0,0.462763,0.783542,0,1,0,-1
0,0.464136,0.766975,0,1,0,-1
0,0.821196,0.648394,0,1,0,-1
0,0.818556,0.631724,0,1,0,-1
0,0.814188,0.615423,0,1,0,-1
0,0.808139,0.599667,0,1,0,-1
0,0.800477,0.584629,0,1,0,-1
0,0.791286,0.570475,0,1,0,-1
0,0.780665,0.557359,0,1,0,-1
0,0.768731,0.545425,0,1,0,-1
0,0.755615,0.534804,0,1,0,-1
0,0.741461,0.525612,0,1,0,-1
0,0.726423,0.51795,0,1,0,-1
0,0.710667,0.511902,0,1,0,-1
0,0.694365,0.507534,0,1,0,-1
0,0.677696,0.504894,0,1,0,-1
0,0.660842,0.504011,0,1,0,-1
0,0.643989,0.504894,0,1,0,-1
0,0.627319,0.507534,0,1,0,-1
0,0.611018,0.511902,0,1,0,-1
0,0.595262,0.51795,0,1,0,-1
0,0.580224,0.525612,0,1,0,-1
0,0.56607,0.534804,0,1,0,-1
0,0.552954,0.545425,0,1,0,-1
0,0.54102,0.557359,0,1,0,-1
0,0.530399,0.570475,0,1,0,-1
0,0.521207,0.584629,0,1,0,-1
0,0.513545,0.599667,0,1,0,-1
0,0.507497,0.615423,0,1,0,-1
0,0.503129,0.631724,0,1,0,-1
0,0.500489,0.648394,0,1,0,-1
0,0.499606,0.665247,0,1,0,-1
0,0.500489,0.682101,0,1,0,-1
0,0.503129,0.69877,0,1,0,-1
0,0.507497,0.715072,0,1,0,-1
0,0.513545,0.730828,0,1,0,-1
0,0.521207,0.745866,0,1,0,-1
0,0.530399,0.76002,0,1,0,-1
0,0.54102,0.773136,0,1,0,-1
0,0.552954,0.785069,0,1,0,-1
0,0.56607,0.795691,0,1,0,-1
0,0.580224,0.804882,0,1,0,-1
0,0.595262,0.812544,0,1,0,-1
0,0.611018,0.818592,0,1,0,-1
0,0.627319,0.822961,0,1,0,-1
0,0.643989,0.825601,0,1,0,-1
0,0.660842,0.826484,0,1,0,-1
0,0.677696,0.825601,0,1,0,-1
0,0.694365,0.822961,0,1,0,-1
0,0.710667,0.818592,0,1,0,-1
0,0.726423,0.812544,0,1,0,-1
0,0.741461,0.804882,0,1,0,-1
0,0.755615,0.795691,0,1,0,-1
0,0.768731,0.785069,0,1,0,-1
0,0.780665,0.773136,0,1,0,-1
0,0.791286,0.76002,0,1,0,-1
0,0.800477,0.745866,0,1,0,-1
0,0.808139,0.730828,0,1,0,-1
0,0.814188,0.715072,0,1,0,-1
0,0.818556,0.69877,0,1,0,-1
0,0.821196,0.682101,0,1,0,-1
0,0.822079,0.665247,0,1,0,-1
0,0.524311,0.381738,0,1,0,-1
0,0.521577,0.364477,0,1,0,-1
0,0.517054,0.347597,0,1,0,-1
0,0.510791,0.331282,0,1,0,-1
0,0.502858,0.315711,0,1,0,-1
0,0.49334,0.301054,0,1,0,-1
0,0.482342,0.287473,0,1,0,-1
0,0.469984,0.275116,0,1,0,-1
0,0.456403,0.264118,0,1,0,-1
0,0.441747,0.2546,0,1,0,-1
0,0.426175,0.246666,0,1,0,-1
0,0.40986,0.240403,0,1,0,-1
0,0.39298,0.23588,0,1,0,-1
0,0.375719,0.233146,0,1,0,-1
0,0.358267,0.232232,0,1,0,-1
0,0.340816,0.233146,0,1,0,-1
0,0.323555,0.23588,0,1,0,-1
0,0.306674,0.240403,0,1,0,-1
0,0.290359,0.246666,0,1,0,-1
0,0.274788,0.2546,0,1,0,-1
0,0.260132,0.264118,0,1,0,-1
0,0.246551,0.275116,0,1,0,-1
0,0.234193,0.287473,0,1,0,-1
0,0.223195,0.301054,0,1,0,-1
0,0.213677,0.315711,0,1,0,-1
0,0.205743,0.331282,0,1,0,-1
0,0.199481,0.347597,0,1,0,-1
0,0.194958,0.364477,0,1,0,-1
0,0.192224,0.381738,0,1,0,-1
0,0.191309,0.39919,0,1,0,-1
0,0.192224,0.416642,0,1,0,-1
0,0.194958,0.433903,0,1,0,-1
0,0.199481,0.450783,0,1,0,-1
0,0.205743,0.467098,0,1,0,-1
0,0.213677,0.482669,0,1,0,-1
0,0.223195,0.497326,0,1,0,-1
0,0.234193,0.510907,0,1,0,-1
0,0.246551,0.523264,0,1,0,-1
0,0.260132,0.534262,0,1,0,-1
0,0.274788,0.54378,0,1,0,-1
0,0.290359,0.551714,0,1,0,-1
0,0.306674,0.557977,0,1,0,-1
0,0.323555,0.5625,0,1,0,-1
0,0.340816,0.565234,0,1,0,-1
0,0.358267,0.566148,0,1,0,-1
0,0.375719,0.565234,0,1,0,-1
0,0.39298,0.5625,0,1,0,-1
0,0.40986,0.557977,0,1,0,-1
0,0.426175,0.551714,0,1,0,-1
0,0.441747,0.54378,0,1,0,-1
0,0.456403,0.534262,0,1,0,-1
0,0.469984,0.523264,0,1,0,-1
0,0.482342,0.510907,0,1,0,-1
0,0.49334,0.497326,0,1,0,-1
0,0.502858,0.482669,0,1,0,-1
0,0.510791,0.467098,0,1,0,-1
0,0.517054,0.450783,0,1,0,-1
0,0.521577,0.433903,0,1,0,-1
0,0.524311,0.416642,0,1,0,-1
0,0.525226,0.39919,0,1,0,-1
0,0.847548,0.091384,0,1,0,-1
0,0.833699,0.101655,0,1,0,-1
0,0.820923,0.113234,0,1,0,-1
0,0.809345,0.126009,0,1,0,-1
0,0.799074,0.139858,0,1,0,-1
0,0.790209,0.154647,0,1,0,-1
0,0.782838,0.170233,0,1,0,-1
0,0.777029,0.186467,0,1,0,-1
0,0.77284,0.203192,0,1,0,-1
0,0.77031,0.220248,0,1,0,-1
0,0.769464,0.237469,0,1,0,-1
0,0.77031,0.25469,0,1,0,-1
0,0.77284,0.271745,0,1,0,-1
0,0.777029,0.28847,0,1,0,-1
0,0.782838,0.304704,0,1,0,-1
0,0.790209,0.320291,0,1,0,-1
0,0.799074,0.33508,0,1,0,-1
0,0.809345,0.348929,0,1,0,-1
0,0.820923,0.361704,0,1,0,-1
0,0.833699,0.373283,0,1,0,-1
0,0.847548,0.383554,0,1,0,-1
0,0.241252,0.63247,0,1,0,-1
0,0.238633,0.614814,0,1,0,-1
0,0.234297,0.5975,0,1,0,-1
0,0.228283,0.580695,0,1,0,-1
0,0.220652,0.56456,0,1,0,-1
0,0.211476,0.54925,0,1,0,-1
0,0.200843,0.534914,0,1,0,-1
0,0.188857,0.521689,0,1,0,-1
0,0.175632,0.509702,0,1,0,-1
0,0.161296,0.49907,0,1,0,-1
0,0.145986,0.489894,0,1,0,-1
0,0.129851,0.482262,0,1,0,-1
0,0.113046,0.476249,0,1,0,-1
0,0.095732,0.471912,0,1,0,-1
0,0.078076,0.469293,0,1,0,-1
0,0.060249,0.468417,0,1,0,-1
0,0.042421,0.469293,0,1,0,-1
0,0.024766,0.471912,0,1,0,-1
0,0.007452,0.476249,0,1,0,-1
0,0.007452,0.824345,0,1,0,-1
0,0.024766,0.828682,0,1,0,-1
0,0.042421,0.831301,0,1,0,-1
0,0.060249,0.832177,0,1,0,-1
0,0.078076,0.831301,0,1,0,-1
0,0.095732,0.828682,0,1,0,-1
0,0.113046,0.824345,0,1,0,-1
0,0.129851,0.818332,0,1,0,-1
0,0.145986,0.8107,0,1,0,-1
0,0.161296,0.801524,0,1,0,-1
0,0.175632,0.790892,0,1,0,-1
0,0.188857,0.778905,0,1,0,-1
0,0.200843,0.76568,0,1,0,-1
0,0.211476,0.751344,0,1,0,-1
0,0.220652,0.736034,0,1,0,-1
0,0.228283,0.719899,0,1,0,-1
0,0.234297,0.703094,0,1,0,-1
0,0.238633,0.68578,0,1,0,-1
0,0.241252,0.668124,0,1,0,-1
0,0.242128,0.650297,0,1,0,-1
0,0.771442,0.048085,0,1,0,-1
0,0.768672,0.029409,0,1,0,-1
0,0.764084,0.011095,0,1,0,-1
0,0.39588,0.011095,0,1,0,-1
0,0.391292,0.029409,0,1,0,-1
0,0.388522,0.048085,0,1,0,-1
0,0.387595,0.066942,0,1,0,-1
0,0.388522,0.085799,0,1,0,-1
0,0.391292,0.104475,0,1,0,-1
0,0.39588,0.122789,0,1,0,-1
0,0.40224,0.140565,0,1,0,-1
0,0.410312,0.157632,0,1,0,-1
0,0.420018,0.173826,0,1,0,-1
0,0.431265,0.18899,0,1,0,-1
0,0.443944,0.20298,0,1,0,-1
0,0.457933,0.215659,0,1,0,-1
0,0.473098,0.226905,0,1,0,-1
0,0.489292,0.236612,0,1,0,-1
0,0.506359,0.244684,0,1,0,-1
0,0.524135,0.251044,0,1,0,-1
0,0.542449,0.255632,0,1,0,-1
0,0.561125,0.258402,0,1,0,-1
0,0.579982,0.259328,0,1,0,-1
0,0.598839,0.258402,0,1,0,-1
0,0.617515,0.255632,0,1,0,-1
0,0.635829,0.251044,0,1,0,-1
0,0.653605,0.244684,0,1,0,-1
0,0.670672,0.236612,0,1,0,-1
0,0.686866,0.226905,0,1,0,-1
0,0.702031,0.215659,0,1,0,-1
0,0.71602,0.20298,0,1,0,-1
0,0.728699,0.18899,0,1,0,-1
0,0.739945,0.173826,0,1,0,-1
0,0.749652,0.157632,0,1,0,-1
0,0.757724,0.140565,0,1,0,-1
0,0.764084,0.122789,0,1,0,-1
0,0.768672,0.104475,0,1,0,-1
0,0.771442,0.085799,0,1,0,-1
0,0.772368,0.066942,0,1,0,-1
0,0.990646,0.482262,0,1,0,-1
0,0.974511,0.489894,0,1,0,-1
0,0.959202,0.49907,0,1,0,-1
0,0.944866,0.509702,0,1,0,-1
0,0.93164,0.521689,0,1,0,-1
0,0.919654,0.534914,0,1,0,-1
0,0.909021,0.54925,0,1,0,-1
0,0.899845,0.56456,0,1,0,-1
0,0.892214,0.580695,0,1,0,-1
0,0.886201,0.5975,0,1,0,-1
0,0.881864,0.614814,0,1,0,-1
0,0.879245,0.63247,0,1,0,-1
0,0.878369,0.650297,0,1,0,-1
0,0.879245,0.668124,0,1,0,-1
0,0.881864,0.68578,0,1,0,-1
0,0.886201,0.703094,0,1,0,-1
0,0.892214,0.719899,0,1,0,-1
0,0.899845,0.736034,0,1,0,-1
0,0.909021,0.751344,0,1,0,-1
0,0.919654,0.76568,0,1,0,-1
0,0.93164,0.778905,0,1,0,-1
0,0.944866,0.790892,0,1,0,-1
0,0.959202,0.801524,0,1,0,-1
0,0.974511,0.8107,0,1,0,-1
0,0.990646,0.818332,0,1,0,-1
0,0.947478,0.867615,0,1,0,-1
0,0.939155,0.853198,0,1,0,-1
0,0.928015,0.840826,0,1,0,-1
0,0.914547,0.831041,0,1,0,-1
0,0.899339,0.82427,0,1,0,-1
0,0.883055,0.820809,0,1,0,-1
0,0.866408,0.820809,0,1,0,-1
0,0.850124,0.82427,0,1,0,-1
0,0.801985,0.867615,0,1,0,-1
0,0.99616,0.069339,0,1,0,-1
0,0.979435,0.06515,0,1,0,-1
0,0.96238,0.06262,0,1,0,-1
0,0.945159,0.061774,0,1,0,-1
0,0.927938,0.06262,0,1,0,-1
0,0.910882,0.06515,0,1,0,-1
0,0.894157,0.069339,0,1,0,-1
0,0.877923,0.075148,0,1,0,-1
0,0.862337,0.08252,0,1,0,-1
0,0.862337,0.392418,0,1,0,-1
0,0.877923,0.39979,0,1,0,-1
0,0.894157,0.405599,0,1,0,-1
0,0.910882,0.409788,0,1,0,-1
0,0.927938,0.412318,0,1,0,-1
0,0.945159,0.413164,0,1,0,-1
0,0.96238,0.412318,0,1,0,-1
0,0.979435,0.409788,0,1,0,-1
0,0.99616,0.405599,0,1,0,-1
0,0.757724,0.993319,0,1,0,-1
0,0.749652,0.976251,0,1,0,-1
0,0.739945,0.960058,0,1,0,-1
0,0.728699,0.944893,0,1,0,-1
0,0.71602,0.930904,0,1,0,-1
0,0.702031,0.918225,0,1,0,-1
0,0.686866,0.906978,0,1,0,-1
0,0.670672,0.897272,0,1,0,-1
0,0.653605,0.8892,0,1,0,-1
0,0.635829,0.882839,0,1,0,-1
0,0.617515,0.878252,0,1,0,-1
0,0.598839,0.875482,0,1,0,-1
0,0.579982,0.874555,0,1,0,-1
0,0.561125,0.875482,0,1,0,-1
0,0.542449,0.878252,0,1,0,-1
0,0.524135,0.882839,0,1,0,-1
0,0.506359,0.8892,0,1,0,-1
0,0.489292,0.897272,0,1,0,-1
0,0.473098,0.906978,0,1,0,-1
0,0.457933,0.918225,0,1,0,-1
0,0.443944,0.930904,0,1,0,-1
0,0.431265,0.944893,0,1,0,-1
0,0.420018,0.960058,0,1,0,-1
0,0.410312,0.976251,0,1,0,-1
0,0.40224,0.993319,0,1,0,-1
0,0.796841,0.883448,0,1,0,-1
0,0.795101,0.900004,0,1,0,-1
0,0.796841,0.91656,0,1,0,-1
0,0.801985,0.932393,0,1,0,-1
0,0.810309,0.94681,0,1,0,-1
0,0.821448,0.959181,0,1,0,-1
0,0.834916,0.968966,0,1,0,-1
0,0.338776,0.864547,0,1,0,-1
0,0.355172,0.867283,0,1,0,-1
0,0.371796,0.867283,0,1,0,-1
0,0.388193,0.864547,0,1,0,-1
0,0.313262,0.983261,0,1,0,-1
0,0.309989,0.966807,0,1,0,-1
0,0.304597,0.950922,0,1,0,-1
0,0.297177,0.935877,0,1,0,-1
0,0.287857,0.921929,0,1,0,-1
0,0.276796,0.909316,0,1,0,-1
0,0.264184,0.898255,0,1,0,-1
0,0.250236,0.888935,0,1,0,-1
0,0.23519,0.881516,0,1,0,-1
0,0.219305,0.876124,0,1,0,-1
0,0.202852,0.872851,0,1,0,-1
0,0.186113,0.871754,0,1,0,-1
0,0.169373,0.872851,0,1,0,-1
0,0.15292,0.876124,0,1,0,-1
0,0.137035,0.881516,0,1,0,-1
0,0.12199,0.888935,0,1,0,-1
0,0.108041,0.898255,0,1,0,-1
0,0.095429,0.909316,0,1,0,-1
0,0.084368,0.921929,0,1,0,-1
0,0.075048,0.935877,0,1,0,-1
0,0.067629,0.950922,0,1,0,-1
0,0.062236,0.966807,0,1,0,-1
0,0.058964,0.983261,0,1,0,-1
0,0.057866,1,0,1,0,-1
0,0.314359,1,0,1,0,-1
0,0.952623,0.883448,0,1,0,-1
0,0.850124,0.975738,0,1,0,-1
0,0.866408,0.979199,0,1,0,-1
0,0.883055,0.979199,0,1,0,-1
0,0.899339,0.975738,0,1,0,-1
0,0.914547,0.968966,0,1,0,-1
0,0.928015,0.959181,0,1,0,-1
0,0.939155,0.94681,0,1,0,-1
0,0.947478,0.932393,0,1,0,-1
0,0.952623,0.91656,0,1,0,-1
0,0.954363,0.900004,0,1,0,-1
`),!1);ie(ee.ParsePatFile(`
*BUBBLES-02,BUBBLES-02
;By John Hyslop,    Using AutoCAD Lisp Tool
;Developed in inch as imperial QCAD3 pattern
0,0.01243,0.139689,0,1,0,-1
0,0.004689,0.124495,0,1,0,-1
0,0.004689,0.188567,0,1,0,-1
0,0.01243,0.173373,0,1,0,-1
0,0.015098,0.156531,0,1,0,-1
0,0.039159,0.550628,0,1,0,-1
0,0.03308,0.534599,0,1,0,-1
0,0.023341,0.52049,0,1,0,-1
0,0.010509,0.509122,0,1,0,-1
0,0.010509,0.626172,0,1,0,-1
0,0.023341,0.614804,0,1,0,-1
0,0.03308,0.600695,0,1,0,-1
0,0.039159,0.584666,0,1,0,-1
0,0.041226,0.567647,0,1,0,-1
0,0.012655,0.061217,0,1,0,-1
0,0.029343,0.064052,0,1,0,-1
0,0.046244,0.065001,0,1,0,-1
0,0.063146,0.064052,0,1,0,-1
0,0.079834,0.061217,0,1,0,-1
0,0.0961,0.05653,0,1,0,-1
0,0.11174,0.050052,0,1,0,-1
0,0.126555,0.041864,0,1,0,-1
0,0.140361,0.032069,0,1,0,-1
0,0.152983,0.020789,0,1,0,-1
0,0.164263,0.008167,0,1,0,-1
0,0.211752,0.623376,0,1,0,-1
0,0.203326,0.608782,0,1,0,-1
0,0.190416,0.597949,0,1,0,-1
0,0.17458,0.592185,0,1,0,-1
0,0.157727,0.592185,0,1,0,-1
0,0.141891,0.597949,0,1,0,-1
0,0.128981,0.608782,0,1,0,-1
0,0.120555,0.623376,0,1,0,-1
0,0.117628,0.639973,0,1,0,-1
0,0.120555,0.65657,0,1,0,-1
0,0.128981,0.671164,0,1,0,-1
0,0.141891,0.681997,0,1,0,-1
0,0.157727,0.687761,0,1,0,-1
0,0.17458,0.687761,0,1,0,-1
0,0.190416,0.681997,0,1,0,-1
0,0.203326,0.671164,0,1,0,-1
0,0.211752,0.65657,0,1,0,-1
0,0.214678,0.639973,0,1,0,-1
0,0.063146,0.764048,0,1,0,-1
0,0.046244,0.763099,0,1,0,-1
0,0.029343,0.764048,0,1,0,-1
0,0.3178,0.248563,0,1,0,-1
0,0.314583,0.232388,0,1,0,-1
0,0.309282,0.216771,0,1,0,-1
0,0.301988,0.20198,0,1,0,-1
0,0.292825,0.188268,0,1,0,-1
0,0.281951,0.175868,0,1,0,-1
0,0.269552,0.164994,0,1,0,-1
0,0.255839,0.155832,0,1,0,-1
0,0.241048,0.148538,0,1,0,-1
0,0.225431,0.143237,0,1,0,-1
0,0.209256,0.140019,0,1,0,-1
0,0.1928,0.138941,0,1,0,-1
0,0.176343,0.140019,0,1,0,-1
0,0.160168,0.143237,0,1,0,-1
0,0.144551,0.148538,0,1,0,-1
0,0.12976,0.155832,0,1,0,-1
0,0.116047,0.164994,0,1,0,-1
0,0.103648,0.175868,0,1,0,-1
0,0.092774,0.188268,0,1,0,-1
0,0.083612,0.20198,0,1,0,-1
0,0.076318,0.216771,0,1,0,-1
0,0.071016,0.232388,0,1,0,-1
0,0.067799,0.248563,0,1,0,-1
0,0.06672,0.26502,0,1,0,-1
0,0.067799,0.281477,0,1,0,-1
0,0.071016,0.297652,0,1,0,-1
0,0.076318,0.313268,0,1,0,-1
0,0.083612,0.32806,0,1,0,-1
0,0.092774,0.341772,0,1,0,-1
0,0.103648,0.354171,0,1,0,-1
0,0.116047,0.365045,0,1,0,-1
0,0.12976,0.374208,0,1,0,-1
0,0.144551,0.381502,0,1,0,-1
0,0.160168,0.386803,0,1,0,-1
0,0.176343,0.390021,0,1,0,-1
0,0.1928,0.391099,0,1,0,-1
0,0.209256,0.390021,0,1,0,-1
0,0.225431,0.386803,0,1,0,-1
0,0.241048,0.381502,0,1,0,-1
0,0.255839,0.374208,0,1,0,-1
0,0.269552,0.365045,0,1,0,-1
0,0.281951,0.354171,0,1,0,-1
0,0.292825,0.341772,0,1,0,-1
0,0.301988,0.32806,0,1,0,-1
0,0.309282,0.313268,0,1,0,-1
0,0.314583,0.297652,0,1,0,-1
0,0.3178,0.281477,0,1,0,-1
0,0.318879,0.26502,0,1,0,-1
0,0.710254,0.515012,0,1,0,-1
0,0.707834,0.498698,0,1,0,-1
0,0.703826,0.482701,0,1,0,-1
0,0.69827,0.467173,0,1,0,-1
0,0.691219,0.452264,0,1,0,-1
0,0.682741,0.438119,0,1,0,-1
0,0.672916,0.424872,0,1,0,-1
0,0.661841,0.412653,0,1,0,-1
0,0.649621,0.401577,0,1,0,-1
0,0.636375,0.391753,0,1,0,-1
0,0.622229,0.383274,0,1,0,-1
0,0.607321,0.376223,0,1,0,-1
0,0.591793,0.370667,0,1,0,-1
0,0.575795,0.36666,0,1,0,-1
0,0.559482,0.36424,0,1,0,-1
0,0.54301,0.363431,0,1,0,-1
0,0.526538,0.36424,0,1,0,-1
0,0.510224,0.36666,0,1,0,-1
0,0.494226,0.370667,0,1,0,-1
0,0.478698,0.376223,0,1,0,-1
0,0.46379,0.383274,0,1,0,-1
0,0.449644,0.391753,0,1,0,-1
0,0.436398,0.401577,0,1,0,-1
0,0.424178,0.412653,0,1,0,-1
0,0.413103,0.424872,0,1,0,-1
0,0.403279,0.438119,0,1,0,-1
0,0.3948,0.452264,0,1,0,-1
0,0.387749,0.467173,0,1,0,-1
0,0.382193,0.482701,0,1,0,-1
0,0.378186,0.498698,0,1,0,-1
0,0.375766,0.515012,0,1,0,-1
0,0.374957,0.531484,0,1,0,-1
0,0.375766,0.547956,0,1,0,-1
0,0.378186,0.56427,0,1,0,-1
0,0.382193,0.580267,0,1,0,-1
0,0.387749,0.595795,0,1,0,-1
0,0.3948,0.610704,0,1,0,-1
0,0.403279,0.624849,0,1,0,-1
0,0.413103,0.638096,0,1,0,-1
0,0.424178,0.650315,0,1,0,-1
0,0.436398,0.661391,0,1,0,-1
0,0.449644,0.671215,0,1,0,-1
0,0.46379,0.679694,0,1,0,-1
0,0.478698,0.686745,0,1,0,-1
0,0.494226,0.692301,0,1,0,-1
0,0.510224,0.696308,0,1,0,-1
0,0.526538,0.698728,0,1,0,-1
0,0.54301,0.699537,0,1,0,-1
0,0.559482,0.698728,0,1,0,-1
0,0.575795,0.696308,0,1,0,-1
0,0.591793,0.692301,0,1,0,-1
0,0.607321,0.686745,0,1,0,-1
0,0.622229,0.679694,0,1,0,-1
0,0.636375,0.671215,0,1,0,-1
0,0.649621,0.661391,0,1,0,-1
0,0.661841,0.650315,0,1,0,-1
0,0.672916,0.638096,0,1,0,-1
0,0.682741,0.624849,0,1,0,-1
0,0.691219,0.610704,0,1,0,-1
0,0.69827,0.595795,0,1,0,-1
0,0.703826,0.580267,0,1,0,-1
0,0.707834,0.56427,0,1,0,-1
0,0.710254,0.547956,0,1,0,-1
0,0.711063,0.531484,0,1,0,-1
0,0.353512,0.012986,0,1,0,-1
0,0.351649,0.029516,0,1,0,-1
0,0.351027,0.046139,0,1,0,-1
0,0.351649,0.062761,0,1,0,-1
0,0.353512,0.079291,0,1,0,-1
0,0.356604,0.095635,0,1,0,-1
0,0.360909,0.111703,0,1,0,-1
0,0.366403,0.127404,0,1,0,-1
0,0.373055,0.14265,0,1,0,-1
0,0.380828,0.157356,0,1,0,-1
0,0.389678,0.171441,0,1,0,-1
0,0.399556,0.184825,0,1,0,-1
0,0.410406,0.197433,0,1,0,-1
0,0.422168,0.209196,0,1,0,-1
0,0.434776,0.220046,0,1,0,-1
0,0.44816,0.229924,0,1,0,-1
0,0.462245,0.238774,0,1,0,-1
0,0.476951,0.246546,0,1,0,-1
0,0.492198,0.253198,0,1,0,-1
0,0.507899,0.258692,0,1,0,-1
0,0.523966,0.262997,0,1,0,-1
0,0.54031,0.26609,0,1,0,-1
0,0.55684,0.267952,0,1,0,-1
0,0.573463,0.268574,0,1,0,-1
0,0.590085,0.267952,0,1,0,-1
0,0.606615,0.26609,0,1,0,-1
0,0.622959,0.262997,0,1,0,-1
0,0.639027,0.258692,0,1,0,-1
0,0.654727,0.253198,0,1,0,-1
0,0.669974,0.246546,0,1,0,-1
0,0.68468,0.238774,0,1,0,-1
0,0.698765,0.229924,0,1,0,-1
0,0.712149,0.220046,0,1,0,-1
0,0.724757,0.209196,0,1,0,-1
0,0.736519,0.197433,0,1,0,-1
0,0.74737,0.184825,0,1,0,-1
0,0.757248,0.171441,0,1,0,-1
0,0.766098,0.157356,0,1,0,-1
0,0.77387,0.14265,0,1,0,-1
0,0.780522,0.127404,0,1,0,-1
0,0.928226,0.008167,0,1,0,-1
0,0.939506,0.020789,0,1,0,-1
0,0.952128,0.032069,0,1,0,-1
0,0.965934,0.041864,0,1,0,-1
0,0.980749,0.050052,0,1,0,-1
0,0.996388,0.05653,0,1,0,-1
0,0.992631,0.112437,0,1,0,-1
0,0.977438,0.104696,0,1,0,-1
0,0.960595,0.102028,0,1,0,-1
0,0.943753,0.104696,0,1,0,-1
0,0.928559,0.112437,0,1,0,-1
0,0.916502,0.124495,0,1,0,-1
0,0.90876,0.139689,0,1,0,-1
0,0.906093,0.156531,0,1,0,-1
0,0.90876,0.173373,0,1,0,-1
0,0.916502,0.188567,0,1,0,-1
0,0.928559,0.200625,0,1,0,-1
0,0.943753,0.208366,0,1,0,-1
0,0.960595,0.211034,0,1,0,-1
0,0.977438,0.208366,0,1,0,-1
0,0.992631,0.200625,0,1,0,-1
0,0.995329,0.501155,0,1,0,-1
0,0.978684,0.497052,0,1,0,-1
0,0.96154,0.497052,0,1,0,-1
0,0.944895,0.501155,0,1,0,-1
0,0.929715,0.509122,0,1,0,-1
0,0.916882,0.52049,0,1,0,-1
0,0.907144,0.534599,0,1,0,-1
0,0.901065,0.550628,0,1,0,-1
0,0.898998,0.567647,0,1,0,-1
0,0.901065,0.584666,0,1,0,-1
0,0.907144,0.600695,0,1,0,-1
0,0.916882,0.614804,0,1,0,-1
0,0.929715,0.626172,0,1,0,-1
0,0.944895,0.634139,0,1,0,-1
0,0.96154,0.638242,0,1,0,-1
0,0.978684,0.638242,0,1,0,-1
0,0.995329,0.634139,0,1,0,-1
0,0.795276,0.029516,0,1,0,-1
0,0.793414,0.012986,0,1,0,-1
0,0.786016,0.111703,0,1,0,-1
0,0.790321,0.095635,0,1,0,-1
0,0.793414,0.079291,0,1,0,-1
0,0.795276,0.062761,0,1,0,-1
0,0.795898,0.046139,0,1,0,-1
0,0.790321,0.996642,0,1,0,-1
0,0.786016,0.980575,0,1,0,-1
0,0.780522,0.964874,0,1,0,-1
0,0.77387,0.949628,0,1,0,-1
0,0.766098,0.934921,0,1,0,-1
0,0.757248,0.920836,0,1,0,-1
0,0.74737,0.907452,0,1,0,-1
0,0.736519,0.894844,0,1,0,-1
0,0.724757,0.883082,0,1,0,-1
0,0.712149,0.872232,0,1,0,-1
0,0.698765,0.862354,0,1,0,-1
0,0.68468,0.853504,0,1,0,-1
0,0.669974,0.845731,0,1,0,-1
0,0.654727,0.839079,0,1,0,-1
0,0.639027,0.833585,0,1,0,-1
0,0.622959,0.82928,0,1,0,-1
0,0.606615,0.826188,0,1,0,-1
0,0.590085,0.824325,0,1,0,-1
0,0.573463,0.823703,0,1,0,-1
0,0.55684,0.824325,0,1,0,-1
0,0.54031,0.826188,0,1,0,-1
0,0.523966,0.82928,0,1,0,-1
0,0.507899,0.833585,0,1,0,-1
0,0.492198,0.839079,0,1,0,-1
0,0.476951,0.845731,0,1,0,-1
0,0.462245,0.853504,0,1,0,-1
0,0.44816,0.862354,0,1,0,-1
0,0.434776,0.872232,0,1,0,-1
0,0.422168,0.883082,0,1,0,-1
0,0.410406,0.894844,0,1,0,-1
0,0.399556,0.907452,0,1,0,-1
0,0.389678,0.920836,0,1,0,-1
0,0.380828,0.934921,0,1,0,-1
0,0.373055,0.949628,0,1,0,-1
0,0.366403,0.964874,0,1,0,-1
0,0.360909,0.980575,0,1,0,-1
0,0.356604,0.996642,0,1,0,-1
0,0.196246,0.897149,0,1,0,-1
0,0.193411,0.880461,0,1,0,-1
0,0.188725,0.864194,0,1,0,-1
0,0.182247,0.848555,0,1,0,-1
0,0.174058,0.83374,0,1,0,-1
0,0.164263,0.819934,0,1,0,-1
0,0.152983,0.807312,0,1,0,-1
0,0.140361,0.796032,0,1,0,-1
0,0.126555,0.786236,0,1,0,-1
0,0.11174,0.778048,0,1,0,-1
0,0.0961,0.77157,0,1,0,-1
0,0.079834,0.766884,0,1,0,-1
0,0.012655,0.766884,0,1,0,-1
0,0.174058,0.994361,0,1,0,-1
0,0.182247,0.979545,0,1,0,-1
0,0.188725,0.963906,0,1,0,-1
0,0.193411,0.94764,0,1,0,-1
0,0.196246,0.930951,0,1,0,-1
0,0.197195,0.91405,0,1,0,-1
0,0.996388,0.77157,0,1,0,-1
0,0.980749,0.778048,0,1,0,-1
0,0.965934,0.786236,0,1,0,-1
0,0.952128,0.796032,0,1,0,-1
0,0.939506,0.807312,0,1,0,-1
0,0.928226,0.819934,0,1,0,-1
0,0.918431,0.83374,0,1,0,-1
0,0.910242,0.848555,0,1,0,-1
0,0.903764,0.864194,0,1,0,-1
0,0.899078,0.880461,0,1,0,-1
0,0.896243,0.897149,0,1,0,-1
0,0.895293,0.91405,0,1,0,-1
0,0.896243,0.930951,0,1,0,-1
0,0.899078,0.94764,0,1,0,-1
0,0.903764,0.963906,0,1,0,-1
0,0.910242,0.979545,0,1,0,-1
0,0.918431,0.994361,0,1,0,-1
`),!1);ie(ee.ParsePatFile(`
*BUBBLES-03,BUBBLES-03
;By John Hyslop,    Using AutoCAD Lisp Tool
;Developed in inch as imperial QCAD3 pattern
0,0.401131,0.163621,0,1,0,-1
0,0.397069,0.144076,0,1,0,-1
0,0.390384,0.125265,0,1,0,-1
0,0.3812,0.107541,0,1,0,-1
0,0.369688,0.091232,0,1,0,-1
0,0.356062,0.076642,0,1,0,-1
0,0.340577,0.064044,0,1,0,-1
0,0.32352,0.053672,0,1,0,-1
0,0.30521,0.045718,0,1,0,-1
0,0.285988,0.040333,0,1,0,-1
0,0.266211,0.037614,0,1,0,-1
0,0.246248,0.037614,0,1,0,-1
0,0.226471,0.040333,0,1,0,-1
0,0.207249,0.045718,0,1,0,-1
0,0.188938,0.053672,0,1,0,-1
0,0.171882,0.064044,0,1,0,-1
0,0.156397,0.076642,0,1,0,-1
0,0.142771,0.091232,0,1,0,-1
0,0.131259,0.107541,0,1,0,-1
0,0.122075,0.125265,0,1,0,-1
0,0.115389,0.144076,0,1,0,-1
0,0.111328,0.163621,0,1,0,-1
0,0.109966,0.183537,0,1,0,-1
0,0.111328,0.203453,0,1,0,-1
0,0.115389,0.222999,0,1,0,-1
0,0.122075,0.241809,0,1,0,-1
0,0.131259,0.259533,0,1,0,-1
0,0.142771,0.275842,0,1,0,-1
0,0.156397,0.290432,0,1,0,-1
0,0.171882,0.30303,0,1,0,-1
0,0.188938,0.313403,0,1,0,-1
0,0.207249,0.321356,0,1,0,-1
0,0.226471,0.326742,0,1,0,-1
0,0.246248,0.32946,0,1,0,-1
0,0.266211,0.32946,0,1,0,-1
0,0.285988,0.326742,0,1,0,-1
0,0.30521,0.321356,0,1,0,-1
0,0.32352,0.313403,0,1,0,-1
0,0.340577,0.30303,0,1,0,-1
0,0.356062,0.290432,0,1,0,-1
0,0.369688,0.275842,0,1,0,-1
0,0.3812,0.259533,0,1,0,-1
0,0.390384,0.241809,0,1,0,-1
0,0.397069,0.222999,0,1,0,-1
0,0.401131,0.203453,0,1,0,-1
0,0.402493,0.183537,0,1,0,-1
0,0.717102,0.580347,0,1,0,-1
0,0.69634,0.588567,0,1,0,-1
0,0.676773,0.599325,0,1,0,-1
0,0.658707,0.61245,0,1,0,-1
0,0.64243,0.627736,0,1,0,-1
0,0.628196,0.644941,0,1,0,-1
0,0.616231,0.663795,0,1,0,-1
0,0.606724,0.684,0,1,0,-1
0,0.599823,0.705237,0,1,0,-1
0,0.595639,0.727171,0,1,0,-1
0,0.594237,0.749457,0,1,0,-1
0,0.595639,0.771743,0,1,0,-1
0,0.599823,0.793677,0,1,0,-1
0,0.606724,0.814914,0,1,0,-1
0,0.713243,0.02088,0,1,0,-1
0,0.688246,0.022108,0,1,0,-1
0,0.663491,0.02578,0,1,0,-1
0,0.639215,0.031861,0,1,0,-1
0,0.615651,0.040292,0,1,0,-1
0,0.593028,0.050992,0,1,0,-1
0,0.571562,0.063858,0,1,0,-1
0,0.551461,0.078766,0,1,0,-1
0,0.532918,0.095573,0,1,0,-1
0,0.516111,0.114116,0,1,0,-1
0,0.501203,0.134218,0,1,0,-1
0,0.488337,0.155683,0,1,0,-1
0,0.477637,0.178307,0,1,0,-1
0,0.469206,0.20187,0,1,0,-1
0,0.463125,0.226146,0,1,0,-1
0,0.459453,0.250902,0,1,0,-1
0,0.458225,0.275898,0,1,0,-1
0,0.459453,0.300894,0,1,0,-1
0,0.463125,0.325649,0,1,0,-1
0,0.469206,0.349926,0,1,0,-1
0,0.477637,0.373489,0,1,0,-1
0,0.488337,0.396113,0,1,0,-1
0,0.501203,0.417578,0,1,0,-1
0,0.516111,0.43768,0,1,0,-1
0,0.532918,0.456223,0,1,0,-1
0,0.551461,0.473029,0,1,0,-1
0,0.571562,0.487938,0,1,0,-1
0,0.593028,0.500804,0,1,0,-1
0,0.615651,0.511504,0,1,0,-1
0,0.639215,0.519935,0,1,0,-1
0,0.663491,0.526016,0,1,0,-1
0,0.688246,0.529688,0,1,0,-1
0,0.713243,0.530916,0,1,0,-1
0,0.563094,0.659436,0,1,0,-1
0,0.558843,0.630776,0,1,0,-1
0,0.551803,0.602671,0,1,0,-1
0,0.542042,0.575392,0,1,0,-1
0,0.529655,0.5492,0,1,0,-1
0,0.514759,0.524349,0,1,0,-1
0,0.4975,0.501077,0,1,0,-1
0,0.478043,0.479609,0,1,0,-1
0,0.456575,0.460152,0,1,0,-1
0,0.433303,0.442893,0,1,0,-1
0,0.408452,0.427998,0,1,0,-1
0,0.382261,0.41561,0,1,0,-1
0,0.354981,0.405849,0,1,0,-1
0,0.326876,0.398809,0,1,0,-1
0,0.298216,0.394558,0,1,0,-1
0,0.269278,0.393136,0,1,0,-1
0,0.240339,0.394558,0,1,0,-1
0,0.21168,0.398809,0,1,0,-1
0,0.183575,0.405849,0,1,0,-1
0,0.156295,0.41561,0,1,0,-1
0,0.130104,0.427998,0,1,0,-1
0,0.105252,0.442893,0,1,0,-1
0,0.081981,0.460152,0,1,0,-1
0,0.060513,0.479609,0,1,0,-1
0,0.041056,0.501077,0,1,0,-1
0,0.023796,0.524349,0,1,0,-1
0,0.008901,0.5492,0,1,0,-1
0,0.542042,0.801357,0,1,0,-1
0,0.551803,0.774077,0,1,0,-1
0,0.558843,0.745972,0,1,0,-1
0,0.563094,0.717313,0,1,0,-1
0,0.564516,0.688374,0,1,0,-1
0,0.996513,0.575392,0,1,0,-1
0,0.986753,0.602671,0,1,0,-1
0,0.979713,0.630776,0,1,0,-1
0,0.975461,0.659436,0,1,0,-1
0,0.97404,0.688374,0,1,0,-1
0,0.975461,0.717313,0,1,0,-1
0,0.979713,0.745972,0,1,0,-1
0,0.986753,0.774077,0,1,0,-1
0,0.996513,0.801357,0,1,0,-1
0,0.94846,0.727171,0,1,0,-1
0,0.944275,0.705237,0,1,0,-1
0,0.937375,0.684,0,1,0,-1
0,0.927868,0.663795,0,1,0,-1
0,0.915903,0.644941,0,1,0,-1
0,0.901669,0.627736,0,1,0,-1
0,0.885391,0.61245,0,1,0,-1
0,0.867326,0.599325,0,1,0,-1
0,0.847758,0.588567,0,1,0,-1
0,0.826996,0.580347,0,1,0,-1
0,0.805368,0.574794,0,1,0,-1
0,0.783214,0.571995,0,1,0,-1
0,0.760884,0.571995,0,1,0,-1
0,0.738731,0.574794,0,1,0,-1
0,0.616231,0.835119,0,1,0,-1
0,0.628196,0.853972,0,1,0,-1
0,0.64243,0.871178,0,1,0,-1
0,0.658707,0.886464,0,1,0,-1
0,0.676773,0.899589,0,1,0,-1
0,0.69634,0.910346,0,1,0,-1
0,0.717102,0.918566,0,1,0,-1
0,0.738731,0.92412,0,1,0,-1
0,0.760884,0.926918,0,1,0,-1
0,0.783214,0.926918,0,1,0,-1
0,0.805368,0.92412,0,1,0,-1
0,0.826996,0.918566,0,1,0,-1
0,0.847758,0.910346,0,1,0,-1
0,0.867326,0.899589,0,1,0,-1
0,0.885391,0.886464,0,1,0,-1
0,0.901669,0.871178,0,1,0,-1
0,0.915903,0.853972,0,1,0,-1
0,0.927868,0.835119,0,1,0,-1
0,0.937375,0.814914,0,1,0,-1
0,0.944275,0.793677,0,1,0,-1
0,0.94846,0.771743,0,1,0,-1
0,0.949862,0.749457,0,1,0,-1
0,0.967032,0.250902,0,1,0,-1
0,0.96336,0.226146,0,1,0,-1
0,0.957279,0.20187,0,1,0,-1
0,0.948848,0.178307,0,1,0,-1
0,0.938148,0.155683,0,1,0,-1
0,0.925282,0.134218,0,1,0,-1
0,0.910374,0.114116,0,1,0,-1
0,0.893567,0.095573,0,1,0,-1
0,0.875024,0.078766,0,1,0,-1
0,0.854923,0.063858,0,1,0,-1
0,0.833457,0.050992,0,1,0,-1
0,0.810834,0.040292,0,1,0,-1
0,0.78727,0.031861,0,1,0,-1
0,0.762994,0.02578,0,1,0,-1
0,0.738239,0.022108,0,1,0,-1
0,0.738239,0.529688,0,1,0,-1
0,0.762994,0.526016,0,1,0,-1
0,0.78727,0.519935,0,1,0,-1
0,0.810834,0.511504,0,1,0,-1
0,0.833457,0.500804,0,1,0,-1
0,0.854923,0.487938,0,1,0,-1
0,0.875024,0.473029,0,1,0,-1
0,0.893567,0.456223,0,1,0,-1
0,0.910374,0.43768,0,1,0,-1
0,0.925282,0.417578,0,1,0,-1
0,0.938148,0.396113,0,1,0,-1
0,0.948848,0.373489,0,1,0,-1
0,0.957279,0.349926,0,1,0,-1
0,0.96336,0.325649,0,1,0,-1
0,0.967032,0.300894,0,1,0,-1
0,0.96826,0.275898,0,1,0,-1
0,0.4975,0.875671,0,1,0,-1
0,0.514759,0.8524,0,1,0,-1
0,0.529655,0.827549,0,1,0,-1
0,0.008901,0.827549,0,1,0,-1
0,0.023796,0.8524,0,1,0,-1
0,0.041056,0.875671,0,1,0,-1
0,0.060513,0.897139,0,1,0,-1
0,0.081981,0.916597,0,1,0,-1
0,0.105252,0.933856,0,1,0,-1
0,0.130104,0.948751,0,1,0,-1
0,0.156295,0.961139,0,1,0,-1
0,0.183575,0.9709,0,1,0,-1
0,0.21168,0.97794,0,1,0,-1
0,0.240339,0.982191,0,1,0,-1
0,0.269278,0.983612,0,1,0,-1
0,0.298216,0.982191,0,1,0,-1
0,0.326876,0.97794,0,1,0,-1
0,0.354981,0.9709,0,1,0,-1
0,0.382261,0.961139,0,1,0,-1
0,0.408452,0.948751,0,1,0,-1
0,0.433303,0.933856,0,1,0,-1
0,0.456575,0.916597,0,1,0,-1
0,0.478043,0.897139,0,1,0,-1
`),!1);ie(ee.ParsePatFile(`
*CELTIC-01,CELTIC PATTERN 01
;By John Hyslop
;Developed in inch as imperial QCAD3 pattern
135,0.36,0.42222222,0.70710678,0.70710678,0.08799551,-1.32621805
135,0.42222222,0.39111111,0.70710678,0.70710678,0.25848681,-1.15572675
315,0.39111111,0.57777778,0.70710678,0.70710678,0.08799551,-1.32621805
315,0.30166667,0.63611111,0.70710678,0.70710678,0.25848681,-1.15572675
225,0.76055556,0.42611111,0.70710678,0.70710678,0.08799551,-1.32621805
225,0.86555556,0.5,0.70710678,0.70710678,0.28048569,-1.13372787
225,0.85388889,0.33277778,0.70710678,0.70710678,0.08799551,-1.32621805
225,0.99,0.5,0.70710678,0.70710678,0.3684812,-1.04573236
225,0.76055556,0.72944444,0.70710678,0.70710678,0.08799551,-1.32621805
225,0.85388889,0.63611111,0.70710678,0.70710678,0.08799551,-1.32621805
90,0.99,0.90200449,0,1,0.08799551,-0.91200449
0,0.90200449,0.88000561,0,1,0.08799551,-0.91200449
0,0.83978227,0.90200449,0,1,0.15021773,-0.84978227
0,0.80333333,0.99,0,1,0.18666667,-0.81333333
90,0.90200449,0.83978227,0,1,0.04022334,-0.95977666
90,0.99,0.80333333,0,1,0.07667228,-0.92332772
180,0.09799551,0.99,0,1,0.08799551,-0.91200449
90,0.11999439,0.90200449,0,1,0.08799551,-0.91200449
90,0.09799551,0.83978227,0,1,0.15021773,-0.84978227
90,0.01,0.80333333,0,1,0.18666667,-0.81333333
180,0.16021773,0.90200449,0,1,0.04022334,-0.95977666
180,0.19666667,0.99,0,1,0.07667228,-0.92332772
270,0.01,0.09799551,0,1,0.08799551,-0.91200449
180,0.09799551,0.11999439,0,1,0.08799551,-0.91200449
180,0.16021773,0.09799551,0,1,0.15021773,-0.84978227
180,0.19666667,0.01,0,1,0.18666667,-0.81333333
270,0.09799551,0.16021773,0,1,0.04022334,-0.95977666
270,0.01,0.19666667,0,1,0.07667228,-0.92332772
45,0.70222222,0.51555556,0.70710678,0.70710678,0.40697924,-1.00723433
45,0.51555556,0.29777778,0.70710678,0.70710678,0.08799551,-1.32621805
45,0.42611111,0.23944444,0.70710678,0.70710678,0.25848681,-1.15572675
45,0.19666667,0.01,0.70710678,0.70710678,0.19249018,-1.22172338
45,0.64,0.57777778,0.70710678,0.70710678,0.3705303,-1.04368326
45,0.42222222,0.39111111,0.70710678,0.70710678,0.08799551,-1.32621805
45,0.36388889,0.30166667,0.70710678,0.70710678,0.25848681,-1.15572675
45,0.16021773,0.09799551,0.70710678,0.70710678,0.15604125,-1.25817232
45,0.66722222,0.85388889,0.70710678,0.70710678,0.19249018,-1.22172338
45,0.42222222,0.64,0.70710678,0.70710678,0.08799551,-1.32621805
45,0.14611111,0.36388889,0.70710678,0.70710678,0.08799551,-1.32621805
45,0.39111111,0.57777778,0.70710678,0.70710678,0.25848681,-1.15572675
45,0.01,0.19666667,0.70710678,0.70710678,0.40697924,-1.00723433
45,0.72944444,0.79166667,0.70710678,0.70710678,0.15604125,-1.25817232
45,0.23944444,0.27055556,0.70710678,0.70710678,0.08799551,-1.32621805
45,0.51555556,0.54666667,0.70710678,0.70710678,0.08799551,-1.32621805
45,0.45333333,0.51555556,0.70710678,0.70710678,0.25848681,-1.15572675
45,0.09799551,0.16021773,0.70710678,0.70710678,0.3705303,-1.04368326
0,0.90200449,0.01,0,1,0.08799551,-0.91200449
135,0.70222222,0.51555556,0.70710678,0.70710678,0.08799551,-1.32621805
135,0.42611111,0.79166667,0.70710678,0.70710678,0.08799551,-1.32621805
135,0.48444444,0.70222222,0.70710678,0.70710678,0.40697924,-1.00723433
135,0.76055556,0.42611111,0.70710678,0.70710678,0.25848681,-1.15572675
135,0.99,0.19666667,0.70710678,0.70710678,0.19249018,-1.22172338
135,0.33277778,0.69833333,0.70710678,0.70710678,0.08799551,-1.32621805
135,0.42222222,0.64,0.70710678,0.70710678,0.3705303,-1.04368326
135,0.60888889,0.42222222,0.70710678,0.70710678,0.08799551,-1.32621805
135,0.69833333,0.36388889,0.70710678,0.70710678,0.25848681,-1.15572675
135,0.90200449,0.16021773,0.70710678,0.70710678,0.15604125,-1.25817232
135,0.63611111,0.14611111,0.70710678,0.70710678,0.08799551,-1.32621805
135,0.14611111,0.66722222,0.70710678,0.70710678,0.19249018,-1.22172338
135,0.80333333,0.01,0.70710678,0.70710678,0.40697924,-1.00723433
135,0.72944444,0.23944444,0.70710678,0.70710678,0.08799551,-1.32621805
135,0.20833333,0.72944444,0.70710678,0.70710678,0.15604125,-1.25817232
135,0.83978227,0.09799551,0.70710678,0.70710678,0.3705303,-1.04368326
270,0.88000561,0.09799551,0,1,0.08799551,-0.91200449
270,0.90200449,0.16021773,0,1,0.15021773,-0.84978227
270,0.99,0.19666667,0,1,0.18666667,-0.81333333
0,0.83978227,0.09799551,0,1,0.04022334,-0.95977666
0,0.80333333,0.01,0,1,0.07667228,-0.92332772
135,0.99,0.5,0.70710678,0.70710678,0.19249018,-1.22172338
45,0.5,0.01,0.70710678,0.70710678,0.19249018,-1.22172338
315,0.27055556,0.20833333,0.70710678,0.70710678,0.08799551,-1.32621805
315,0.23944444,0.27055556,0.70710678,0.70710678,0.3684812,-1.04573236
315,0.01,0.5,0.70710678,0.70710678,0.19249018,-1.22172338
225,0.20833333,0.72944444,0.70710678,0.70710678,0.08799551,-1.32621805
225,0.27055556,0.76055556,0.70710678,0.70710678,0.3684812,-1.04573236
225,0.5,0.99,0.70710678,0.70710678,0.19249018,-1.22172338
135,0.72944444,0.79166667,0.70710678,0.70710678,0.08799551,-1.32621805
135,0.76055556,0.72944444,0.70710678,0.70710678,0.3684812,-1.04573236
135,0.86555556,0.5,0.70710678,0.70710678,0.10449467,-1.30971889
45,0.5,0.13444444,0.70710678,0.70710678,0.10449467,-1.30971889
315,0.36388889,0.30166667,0.70710678,0.70710678,0.08799551,-1.32621805
315,0.30166667,0.33277778,0.70710678,0.70710678,0.28048569,-1.13372787
315,0.13444444,0.5,0.70710678,0.70710678,0.10449467,-1.30971889
225,0.30166667,0.63611111,0.70710678,0.70710678,0.08799551,-1.32621805
225,0.33277778,0.69833333,0.70710678,0.70710678,0.28048569,-1.13372787
225,0.5,0.86555556,0.70710678,0.70710678,0.10449467,-1.30971889
135,0.63611111,0.69833333,0.70710678,0.70710678,0.08799551,-1.32621805
135,0.69833333,0.66722222,0.70710678,0.70710678,0.28048569,-1.13372787
`),!1);ie(ee.ParsePatFile(`
*CELTIC-02,CELTIC PATTERN 02
;By John Hyslop
;Developed in inch as imperial QCAD3 pattern
180,0.438471,0.01545916,0,1,0.12305799,-0.87694201
270,0.98454084,0.438471,0,1,0.12305799,-0.87694201
270,0.01545916,0.68458699,0,1,0.12305799,-0.87694201
180,0.68458699,0.98454084,0,1,0.12305799,-0.87694201
90,0.98454084,0.4692355,0,1,0.51530534,-0.48469466
270,0.98454084,0.28464852,0,1,0.26918936,-0.73081064
180,0.438471,0.28464852,0,1,0.12305799,-0.87694201
180,0.5307645,0.31541301,0,1,0.36148285,-0.63851715
0,0.31541301,0.4692355,0,1,0.12305799,-0.87694201
0,0.16928165,0.438471,0,1,0.36148285,-0.63851715
270,0.83071835,0.68458699,0,1,0.12305799,-0.87694201
270,0.86148285,0.86148285,0,1,0.39224735,-0.60775265
270,0.5307645,0.98454084,0,1,0.12305799,-0.87694201
270,0.71535148,0.98454084,0,1,0.12305799,-0.87694201
90,0.68458699,0.71535148,0,1,0.26918936,-0.73081064
90,0.71535148,0.31541301,0,1,0.12305799,-0.87694201
90,0.68458699,0.16928165,0,1,0.36148285,-0.63851715
90,0.561529,0.71535148,0,1,0.26918936,-0.73081064
90,0.5307645,0.31541301,0,1,0.12305799,-0.87694201
90,0.561529,0.16928165,0,1,0.36148285,-0.63851715
90,0.28464852,0.561529,0,1,0.12305799,-0.87694201
90,0.28464852,0.01545916,0,1,0.12305799,-0.87694201
90,0.31541301,0.4692355,0,1,0.36148285,-0.63851715
90,0.31541301,0.01545916,0,1,0.26918936,-0.73081064
90,0.4692355,0.01545916,0,1,0.12305799,-0.87694201
90,0.4692355,0.561529,0,1,0.12305799,-0.87694201
90,0.438471,0.4692355,0,1,0.36148285,-0.63851715
90,0.438471,0.01545916,0,1,0.26918936,-0.73081064
180,0.68458699,0.71535148,0,1,0.12305799,-0.87694201
180,0.13851715,0.71535148,0,1,0.12305799,-0.87694201
180,0.28464852,0.68458699,0,1,0.26918936,-0.73081064
180,0.83071835,0.68458699,0,1,0.36148285,-0.63851715
180,0.13851715,0.5307645,0,1,0.12305799,-0.87694201
180,0.28464852,0.561529,0,1,0.26918936,-0.73081064
180,0.68458699,0.5307645,0,1,0.12305799,-0.87694201
180,0.83071835,0.561529,0,1,0.36148285,-0.63851715
180,0.98454084,0.28464852,0,1,0.12305799,-0.87694201
180,0.98454084,0.31541301,0,1,0.26918936,-0.73081064
180,0.98454084,0.4692355,0,1,0.12305799,-0.87694201
180,0.98454084,0.438471,0,1,0.26918936,-0.73081064
180,0.98454084,0.98454084,0,1,0.26918936,-0.73081064
0,0.4692355,0.01545916,0,1,0.51530534,-0.48469466
0,0.01545916,0.01545916,0,1,0.26918936,-0.73081064
270,0.01545916,0.5307645,0,1,0.51530534,-0.48469466
270,0.01545916,0.98454084,0,1,0.26918936,-0.73081064
180,0.5307645,0.98454084,0,1,0.51530534,-0.48469466
180,0.86148285,0.86148285,0,1,0.14613136,-0.85386864
90,0.86148285,0.13851715,0,1,0.14613136,-0.85386864
0,0.561529,0.16928165,0,1,0.12305799,-0.87694201
0,0.4692355,0.13851715,0,1,0.39224735,-0.60775265
0,0.13851715,0.13851715,0,1,0.14613136,-0.85386864
270,0.16928165,0.438471,0,1,0.12305799,-0.87694201
270,0.13851715,0.5307645,0,1,0.39224735,-0.60775265
270,0.13851715,0.86148285,0,1,0.14613136,-0.85386864
180,0.438471,0.83071835,0,1,0.12305799,-0.87694201
180,0.5307645,0.86148285,0,1,0.39224735,-0.60775265
`),!1);ie(ee.ParsePatFile(`
*CELTIC-03,CELTIC-03
;By John Hyslop,    Using AutoCAD Lisp Tool
;Developed in inch as imperial QCAD3 pattern
90,6.35,13.97,0,25.4,5.08,-20.32
90,19.05,6.35,0,25.4,5.08,-20.32
0,6.35,6.35,0,25.4,12.7,-12.7
270,6.35,11.43,0,25.4,5.08,-20.32
90,3.81,3.81,0,25.4,7.62,-17.78
180,21.59,3.81,0,25.4,17.78,-7.62
270,21.59,11.43,0,25.4,7.62,-17.78
270,21.59,21.59,0,25.4,7.62,-17.78
0,3.81,21.59,0,25.4,17.78,-7.62
90,3.81,13.97,0,25.4,7.62,-17.78
270,19.05,19.05,0,25.4,5.08,-20.32
0,6.35,19.05,0,25.4,12.7,-12.7
90,13.97,6.35,0,25.4,12.7,-12.7
90,11.43,6.35,0,25.4,12.7,-12.7
270,13.97,3.81,0,25.4,7.62,-17.78
90,11.43,-3.81,0,25.4,7.62,-17.78
180,11.43,11.43,0,25.4,22.86,-2.54
0,-11.43,13.97,0,25.4,22.86,-2.54
`),!1);ie(ee.ParsePatFile(`
*CELTIC-04,CELTIC-04
;By John Hyslop,    Using AutoCAD Lisp Tool
;Developed in mm as metric QCAD3 pattern
45,3.81,13.97,17.960512212,17.960512212,12.57235865,-23.348666028
135,21.59,13.97,17.960512212,17.960512212,12.57235865,-23.348666028
45,12.7,2.54,17.960512212,17.960512212,12.57235865,-23.348666028
315,3.81,11.43,17.960512212,17.960512212,12.57235865,-23.348666028
135,12.7,5.08,17.960512212,17.960512212,8.980256106,-26.940768318
225,19.05,11.43,17.960512212,17.960512212,8.980256106,-26.940768318
315,12.7,20.32,17.960512212,17.960512212,8.980256106,-26.940768318
45,6.35,13.97,17.960512212,17.960512212,8.980256106,-26.940768318
90,13.97,6.35,0,25.4,12.7,-12.7
90,11.43,6.35,0,25.4,12.7,-12.7
270,13.97,3.81,0,25.4,7.62,-17.78
90,11.43,-3.81,0,25.4,7.62,-17.78
180,11.43,11.43,0,25.4,22.86,-2.54
0,-11.43,13.97,0,25.4,22.86,-2.54
`),!1);ie(ee.ParsePatFile(`
*CIRCLES-02,CIRCLES-02
;By John Hyslop
;Developed in inch as imperial QCAD3 pattern
0,0.959092,0.471116,0,1,0,-1
0,0.956373,0.442347,0,1,0,-1
0,0.951852,0.413805,0,1,0,-1
0,0.945548,0.385603,0,1,0,-1
0,0.937486,0.357852,0,1,0,-1
0,0.927697,0.330663,0,1,0,-1
0,0.91622,0.304142,0,1,0,-1
0,0.903101,0.278393,0,1,0,-1
0,0.888391,0.25352,0,1,0,-1
0,0.872148,0.229619,0,1,0,-1
0,0.854436,0.206785,0,1,0,-1
0,0.835326,0.185108,0,1,0,-1
0,0.814892,0.164674,0,1,0,-1
0,0.793215,0.145564,0,1,0,-1
0,0.770381,0.127852,0,1,0,-1
0,0.74648,0.111609,0,1,0,-1
0,0.721607,0.096899,0,1,0,-1
0,0.695858,0.08378,0,1,0,-1
0,0.669337,0.072303,0,1,0,-1
0,0.642148,0.062514,0,1,0,-1
0,0.614397,0.054452,0,1,0,-1
0,0.586195,0.048148,0,1,0,-1
0,0.557653,0.043627,0,1,0,-1
0,0.528884,0.040908,0,1,0,-1
0,0.5,0.04,0,1,0,-1
0,0.471116,0.040908,0,1,0,-1
0,0.442347,0.043627,0,1,0,-1
0,0.413805,0.048148,0,1,0,-1
0,0.385603,0.054452,0,1,0,-1
0,0.357852,0.062514,0,1,0,-1
0,0.330663,0.072303,0,1,0,-1
0,0.304142,0.08378,0,1,0,-1
0,0.278393,0.096899,0,1,0,-1
0,0.25352,0.111609,0,1,0,-1
0,0.229619,0.127852,0,1,0,-1
0,0.206785,0.145564,0,1,0,-1
0,0.185108,0.164674,0,1,0,-1
0,0.164674,0.185108,0,1,0,-1
0,0.145564,0.206785,0,1,0,-1
0,0.127852,0.229619,0,1,0,-1
0,0.111609,0.25352,0,1,0,-1
0,0.096899,0.278393,0,1,0,-1
0,0.08378,0.304142,0,1,0,-1
0,0.072303,0.330663,0,1,0,-1
0,0.062514,0.357852,0,1,0,-1
0,0.054452,0.385603,0,1,0,-1
0,0.048148,0.413805,0,1,0,-1
0,0.043627,0.442347,0,1,0,-1
0,0.040908,0.471116,0,1,0,-1
0,0.04,0.5,0,1,0,-1
0,0.040908,0.528884,0,1,0,-1
0,0.043627,0.557653,0,1,0,-1
0,0.048148,0.586195,0,1,0,-1
0,0.054452,0.614397,0,1,0,-1
0,0.062514,0.642148,0,1,0,-1
0,0.072303,0.669337,0,1,0,-1
0,0.08378,0.695858,0,1,0,-1
0,0.096899,0.721607,0,1,0,-1
0,0.111609,0.74648,0,1,0,-1
0,0.127852,0.770381,0,1,0,-1
0,0.145564,0.793215,0,1,0,-1
0,0.164674,0.814892,0,1,0,-1
0,0.185108,0.835326,0,1,0,-1
0,0.206785,0.854436,0,1,0,-1
0,0.229619,0.872148,0,1,0,-1
0,0.25352,0.888391,0,1,0,-1
0,0.278393,0.903101,0,1,0,-1
0,0.304142,0.91622,0,1,0,-1
0,0.330663,0.927697,0,1,0,-1
0,0.357852,0.937486,0,1,0,-1
0,0.385603,0.945548,0,1,0,-1
0,0.413805,0.951852,0,1,0,-1
0,0.442347,0.956373,0,1,0,-1
0,0.471116,0.959092,0,1,0,-1
0,0.5,0.96,0,1,0,-1
0,0.528884,0.959092,0,1,0,-1
0,0.557653,0.956373,0,1,0,-1
0,0.586195,0.951852,0,1,0,-1
0,0.614397,0.945548,0,1,0,-1
0,0.642148,0.937486,0,1,0,-1
0,0.669337,0.927697,0,1,0,-1
0,0.695858,0.91622,0,1,0,-1
0,0.721607,0.903101,0,1,0,-1
0,0.74648,0.888391,0,1,0,-1
0,0.770381,0.872148,0,1,0,-1
0,0.793215,0.854436,0,1,0,-1
0,0.814892,0.835326,0,1,0,-1
0,0.835326,0.814892,0,1,0,-1
0,0.854436,0.793215,0,1,0,-1
0,0.872148,0.770381,0,1,0,-1
0,0.888391,0.74648,0,1,0,-1
0,0.903101,0.721607,0,1,0,-1
0,0.91622,0.695858,0,1,0,-1
0,0.927697,0.669337,0,1,0,-1
0,0.937486,0.642148,0,1,0,-1
0,0.945548,0.614397,0,1,0,-1
0,0.951852,0.586195,0,1,0,-1
0,0.956373,0.557653,0,1,0,-1
0,0.959092,0.528884,0,1,0,-1
0,0.96,0.5,0,1,0,-1
`),!1);ie(ee.ParsePatFile(`
*CIRCLES,CIRCLES
;By John Hyslop
;Developed in inch as imperial QCAD3 pattern
0,0.934583,0.431169,0,1,0,-1
0,0.918465,0.364033,0,1,0,-1
0,0.892043,0.300244,0,1,0,-1
0,0.855967,0.241374,0,1,0,-1
0,0.811127,0.188873,0,1,0,-1
0,0.758626,0.144033,0,1,0,-1
0,0.699756,0.107957,0,1,0,-1
0,0.635967,0.081535,0,1,0,-1
0,0.568831,0.065417,0,1,0,-1
0,0.5,0.06,0,1,0,-1
0,0.431169,0.065417,0,1,0,-1
0,0.364033,0.081535,0,1,0,-1
0,0.300244,0.107957,0,1,0,-1
0,0.241374,0.144033,0,1,0,-1
0,0.188873,0.188873,0,1,0,-1
0,0.144033,0.241374,0,1,0,-1
0,0.107957,0.300244,0,1,0,-1
0,0.081535,0.364033,0,1,0,-1
0,0.065417,0.431169,0,1,0,-1
0,0.06,0.5,0,1,0,-1
0,0.065417,0.568831,0,1,0,-1
0,0.081535,0.635967,0,1,0,-1
0,0.107957,0.699756,0,1,0,-1
0,0.144033,0.758626,0,1,0,-1
0,0.188873,0.811127,0,1,0,-1
0,0.241374,0.855967,0,1,0,-1
0,0.300244,0.892043,0,1,0,-1
0,0.364033,0.918465,0,1,0,-1
0,0.431169,0.934583,0,1,0,-1
0,0.5,0.94,0,1,0,-1
0,0.568831,0.934583,0,1,0,-1
0,0.635967,0.918465,0,1,0,-1
0,0.699756,0.892043,0,1,0,-1
0,0.758626,0.855967,0,1,0,-1
0,0.811127,0.811127,0,1,0,-1
0,0.855967,0.758626,0,1,0,-1
0,0.892043,0.699756,0,1,0,-1
0,0.918465,0.635967,0,1,0,-1
0,0.934583,0.568831,0,1,0,-1
0,0.94,0.5,0,1,0,-1
`),!1);ie(ee.ParsePatFile(`
*CLAY,CLAY
0, 0,0, 0,.1875
0, 0,.03125, 0,.1875
0, 0,.0625, 0,.1875
0, 0,.125, 0,.1875, .1875,-.125
`),!1);ie(ee.ParsePatFile(`
*CORK,CORK
0, 0,0, 0,.125
135, .0625,-.0625, 0,.35355339, .1767767,-.1767767
135, .09375,-.0625, 0,.35355339, .1767767,-.1767767
135, .125,-.0625, 0,.35355339, .1767767,-.1767767
`),!1);ie(ee.ParsePatFile(`
*CROSS,CROSS
0, 0,0, .25,.25, .125,-.375
90, .0625,-.0625, .25,.25, .125,-.375
`),!1);ie(ee.ParsePatFile(`
*DASH,DASH
0, 0,0, .125,.125, .125,-.125
`),!1);ie(ee.ParsePatFile(`
*DOLMIT,DOLMIT
0, 0,0, 0,.25
45, 0,0, 0,.70710678, .35355339,-.70710768
`),!1);ie(ee.ParsePatFile(`
*DOTS,DOTS
0, 0,0, .03125,.0625, 0,-.0625
`),!1);ie(ee.ParsePatFile(`
*EARTH,EARTH
0, 0,0, .25,.25, .25,-.25
0, 0,.09375, .25,.25, .25,-.25
0, 0,.1875, .25,.25, .25,-.25
90, .03125,.21875, .25,.25, .25,-.25
90, .125,.21875, .25,.25, .25,-.25
90, .21875,.21875, .25,.25, .25,-.25
`),!1);ie(ee.ParsePatFile(`
*ESCHER,ESCHER
60, 0,0, -.6,1.03923048, 1.1,-.1
180, 0,0, -.6,1.03923048, 1.1,-.1
300, 0,0, .6,1.03923048, 1.1,-.1
60, .1,0, -.6,1.03923048, .2,-1
300, .1,0, .6,1.03923048, .2,-1
60, -.05,.08660254, -.6,1.03923048, .2,-1
180, -.05,.08660254, -.6,1.03923048, .2,-1
300, -.05,-.08660254, .6,1.03923048, .2,-1
180, -.05,-.08660254, -.6,1.03923048, .2,-1
60, -.4,0, -.6,1.03923048, .2,-1
300, -.4,0, .6,1.03923048, .2,-1
60, .2,-.34641016, -.6,1.03923048, .2,-1
180, .2,-.34641016, -.6,1.03923048, .2,-1
300, .2,.34641016, .6,1.03923048, .2,-1
180, .2,.34641016, -.6,1.03923048, .2,-1
0, .2,.17320508, -.6,1.03923048, .7,-.5
0, .2,-.17320508, -.6,1.03923048, .7,-.5
120, .05,.25980762, .6,1.03923048, .7,-.5
120, -.25,.08660254, .6,1.03923048, .7,-.5
240, -.25,-.08660254, .6,1.03923048, .7,-.5
240, .05,-.25980762, .6,1.03923048, .7,-.5
`),!1);ie(ee.ParsePatFile(`
*EXPLOSION,EXPLOSION
;By John Hyslop
;Developed in inch as imperial QCAD3 pattern
270,0.45,0.11,0,1,0.11,-0.89
143.130102,0.49,0.08,3.6,0.2,0.05,-4.95
270,0.49,0.17,0,1,0.09,-0.91
112.380135,0.56,0,12.99988621,0.05439283,0.18384776,-18.20092855
75.256437,0.51,0.81,4.12279145,0.05089866,0.19646883,-19.45041388
287.525568,0.45,1,3.16187936,0.05018856,0.19924859,-19.72561026
135,0.06,0.49,0.70710678,0.70710678,0.08485281,-1.32936075
26.565051,0,0.46,1.34164079,0.4472136,0.06708204,-2.16898594
353.884496,0.72,0.49,19.10494017,0.03551104,0.28160256,-27.87865312
192.094757,1,0.55,9.2192799,0.06984303,0.28635642,-14.03146464
3.691386,0.69,0.38,15.03326191,0.03219114,0.31064449,-30.75380464
136.080924,0.96,0.12,36.06936773,0.02667853,0.3748333,-37.10849633
336.037511,0.87,0.16,7.61509624,0.10153462,0.09848858,-9.75036922
123.690068,0.97,0.01,1.38675049,0.2773501,0.18027756,-3.42527371
324.462322,0.62,0.26,3.6036768,0.11624764,0.43011626,-8.172209
117.645975,0.73,0.05,21.47086912,0.04218245,0.23706539,-23.46947379
326.309932,0.55,0.17,2.21880078,0.2773501,0.21633308,-3.3892182
106.38954,0.6,0,10.44015399,0.05643326,0.17720045,-17.5428447
153.434949,0.12,0.34,0.89442719,0.4472136,0.13416408,-2.1019039
64.798876,0.04,0.17,16.55285979,0.05322463,0.18788294,-18.60041129
202.619865,0.16,0.22,7.61538462,0.07692308,0.13,-12.87
59.036243,0.1,0.12,2.22948161,0.17149859,0.11661904,-5.71433286
211.75948,0.31,0.25,9.43389425,0.04048882,0.24698178,-24.45119629
79.215702,0.27,0.04,16.27875339,0.04677803,0.21377558,-21.16378274
212.471192,0.38,0.11,3.60473545,0.0766965,0.13038405,-12.90802076
63.434949,0.35,0.05,0.89442719,0.4472136,0.06708204,-2.16898594
135,0.4,0,0.70710678,0.70710678,0.07071068,-1.34350288
74.357754,0.33,0.75,18.68150198,0.03851856,0.2596151,-25.70189487
333.434949,0.03,0.9,0.89442719,0.4472136,0.3354102,-1.90065778
110.556045,0.18,0.5,5.38389277,0.11704115,0.42720019,-8.11680356
330.945396,0,0.6,2.23395748,0.09712859,0.2059126,-10.08971754
99.462322,0.63,0.82,5.09636861,0.16439899,0.18248288,-5.90027965
222.70939,0.76,0.94,1.41308355,0.05652334,0.17691806,-17.51488795
74.744881,0.73,0.83,4.12217269,0.0877058,0.11401754,-11.28773671
208.61046,0.95,0.95,10.29532081,0.07980869,0.25059928,-12.2793648
62.744672,0.78,0.62,2.2359057,0.02693862,0.37121422,-36.75020816
212.275644,0.97,0.74,13.03832887,0.04449942,0.22472205,-22.247483
55.00798,0.9,0.64,3.60462045,0.08192319,0.12206556,-12.08449006
158.198591,1,0.6,3.15682075,0.18569534,0.1077033,-5.27746151
51.911227,0.59,0.51,29.20615599,0.02127178,0.47010637,-46.54053072
153.434949,0.65,0.48,0.89442719,0.4472136,0.06708204,-2.16898594
35.537678,0.58,0.43,4.99864847,0.11624764,0.08602325,-8.51630201
129.289407,0.76,0.21,7.80993275,0.07035975,0.28425341,-13.928417
322.30576,0.54,0.38,16.40118003,0.0359675,0.27802878,-27.52484877
77.905243,0.51,0.24,5.09854116,0.06984303,0.14317821,-14.17464285
282.994617,0.48,0.37,4.12242429,0.07495317,0.13341664,-13.20824742
62.525568,0.35,0.12,2.23578634,0.03548867,0.28178006,-27.89622555
267.137595,0.36,0.32,0.99875234,0.04993762,0.20024984,-19.82473455
12.994617,0.1,0.26,4.12242429,0.07495317,0.26683328,-13.07483078
211.75948,0.31,0.39,9.43389425,0.04048882,0.24698178,-24.45119629
318.366461,0.22,0.47,10.62982142,0.08304548,0.12041595,-11.92117863
189.462322,0.28,0.48,5.09636861,0.16439899,0.06082763,-6.0219349
297.299572,0.12,0.79,32.64964285,0.02866518,0.34885527,-34.53667181
132.273689,0.32,0.57,1.41261287,0.06726728,0.29732137,-14.56874737
282.994617,0.29,0.7,4.12242429,0.07495317,0.13341664,-13.20824742
140.194429,0.41,0.6,6.401844,0.12803688,0.15620499,-7.65404468
268.363423,0.42,0.95,0.99959209,0.02855977,0.35014283,-34.66413997
102.200469,0.5,0.58,23.53718977,0.0264166,0.37854986,-37.4764366
250.016893,0.58,0.8,3.16112333,0.08543577,0.234094,-11.47060591
84.559668,0.56,0.59,11.04525929,0.04740455,0.21095023,-20.88407288
222.184443,0.88,0.88,14.86605071,0.02315584,0.43185646,-42.75378931
`),!1);ie(ee.ParsePatFile(`
*FLEX,FLEX
0, 0,0, 0,.25, .25,-.25
45, .25,0, .1767767,.1767767, .0625,-.22855339,.0625,-.35355339
`),!1);ie(ee.ParsePatFile(`
*GRASS,GRASS
90, 0,0, .70710678,.70710678, .1875,-1.22671356
45, 0,0, 0,1, .1875,-.8125
135, 0,0, 0,1, .1875,-.8125
`),!1);ie(ee.ParsePatFile(`
*GRATE,GRATE
0, 0,0, 0,.03125
90, 0,0, 0,.125
`),!1);ie(ee.ParsePatFile(`
*GRAVEL-01,GRAVEL-01
;Optimize to replace existing GRAVEL Pattern
;By John Hyslop,    Using AutoCAD Lisp Tool
;Developed in inch as imperial QCAD3 pattern
159.443955,0.16,0.13,3.16011097,0.11704115,0.17088007,-8.37312367
114.775141,0.22,0,2.23497695,0.06984303,0.14317821,-14.17464285
249.443955,0.32,0.08,3.16011097,0.11704115,0.08544004,-8.45856371
186.009006,0.51,0.1,9.05523386,0.05234239,0.19104973,-18.91392344
165.963757,0.71,0.05,0.9701425,0.24253563,0.20615528,-3.91695034
101.309932,0.72,0,4.11843884,0.19611614,0.0509902,-5.04802932
243.434949,0.84,0.14,0.89442719,0.4472136,0.15652476,-2.07954322
355.426079,0.49,0.13,13.03834384,0.03987261,0.25079872,-24.82907368
300.256437,0.42,0.25,5.83050758,0.07198158,0.13892444,-13.75351955
228.012788,0.6,0.45,12.04136517,0.07432941,0.26907248,-13.18455157
180,0.86,0.45,0,1,0.26,-0.74
303.690068,0.62,0.62,1.38675049,0.2773501,0.14422205,-3.46132922
225,0.72,0.72,0.70710678,0.70710678,0.14142136,-1.27279221
110.224859,0.08,0.23,8.54386101,0.04938648,0.20248457,-20.04597216
177.273689,0.29,0.22,0.99886814,0.04756515,0.21023796,-20.81355808
217.69424,0.51,0.39,11.40169752,0.0359675,0.27802878,-27.52484877
252.255328,0.59,0.64,23.08676133,0.03809697,0.26248809,-25.9863214
301.429566,0.48,0.82,15.26426391,0.04740455,0.21095023,-20.88407288
355.236358,0.24,0.84,0.99654576,0.08304548,0.24083189,-11.80076269
43.66778,0.02,0.63,1.41383129,0.0328798,0.30413813,-30.10967452
87.273689,0.01,0.42,0.99886814,0.04756515,0.21023796,-20.81355808
30.963757,0.62,0.71,3.60147029,0.17149859,0.17492856,-5.65602334
291.801409,0.58,0.81,2.22834406,0.18569534,0.1077033,-5.27746151
203.198591,0.65,0.84,2.23220936,0.13130643,0.07615773,-7.53961537
161.565051,0.77,0.8,0.9486833,0.31622777,0.12649111,-3.03578655
4.969741,0.4,0.88,11.04527609,0.04331481,0.23086793,-22.85592483
16.38954,0,0.81,10.44015399,0.05643326,0.17720045,-17.5428447
197.354025,1,0.19,3.16171493,0.059655,0.16763055,-16.59542407
74.054604,0.95,0.22,4.12081692,0.13736056,0.1456022,-7.13450769
27.645975,0.74,0.11,21.47086912,0.04218245,0.23706539,-23.46947379
145.304846,0.99,0.36,3.60499653,0.06324555,0.15811388,-15.65327442
353.157227,0.7,0.5,17.1171967,0.03971507,0.25179357,-24.92756306
171.469234,0.92,0.69,7.07089492,0.04944682,0.20223748,-20.02151093
138.814075,1,0.62,9.21906451,0.09407209,0.10630146,-10.52384435
90,1,0.56,0,1,0.06,-0.94
60.945396,0.95,0.47,2.23395748,0.09712859,0.1029563,-10.19267384
343.61046,0.83,0.86,7.27989116,0.05643326,0.17720045,-17.5428447
293.198591,0.77,1,2.23220936,0.13130643,0.15231546,-7.46345764
48.012788,0.63,0.9,12.04136517,0.07432941,0.13453624,-13.31908781
312.510447,0.29,1,1.41287877,0.06142951,0.16278821,-16.11603239
70.346176,0.17,0.86,3.16156213,0.06726728,0.14866069,-14.71740806
`),!1);ie(ee.ParsePatFile(`
*GRAVEL,GRAVEL
228.0128, .72,1, 12.041365,.074329, .134536,-13.319088
184.9697, .63,.9, -12.041517,.043315, .230868,-22.855925
132.5104, .4,.88, -14.865942,.06143, .162788,-16.116032
267.2737, .01,.63, -20.024928,.047565, .210238,-20.813558
292.8337, 0,.42, -12.99991,.048507, .206155,-20.409373
357.2737, .08,.23, -20.024928,.047565, .210238,-20.813558
37.6942, .29,.22, -16.40118,.035968, .278029,-27.524849
72.2553, .51,.39, 23.086761,.038097, .262488,-25.986321
121.4296, .59,.64, 15.264264,.047405, .21095,-20.884073
175.2364, .48,.82, -11.045049,.083045, .240832,-11.800763
222.3974, .24,.84, 16.278789,.032108, .311448,-30.833375
138.8141, 1,.62, 9.219065,.094072, .106301,-10.523844
171.4692, .92,.69, -13.152853,.049447, .202237,-20.021511
225, .72,.72, .707107,.707107, .141421,-1.272792
203.1986, .65,.84, -5.383564,.131306, .076158,-7.539615
291.8014, .58,.81, -3.156821,.185695, .107703,-5.277462
30.9638, .62,.71, 3.60147,.171499, .174929,-5.656023
161.5651, .77,.8, -2.213594,.316228, .126491,-3.035787
16.3895, 0,.81, 10.440154,.056433, .1772,-17.542845
70.3462, .17,.86, -11.704507,.067267, .148661,-14.717408
293.1986, .77,1, -5.383564,.131306, .152315,-7.463458
343.6105, .83,.86, -10.440154,.056433, .1772,-17.542845
339.444, 0,.19, -5.383893,.117041, .17088,-8.373124
294.7751, .16,.13, -12.082844,.069843, .143178,-14.174643
66.8014, .78,0, 5.383564,.131306, .152315,-7.463458
17.354, .84,.14, -13.60134,.059655, .167631,-16.595424
69.444, .29,0, -5.383893,.117041, .08544,-8.458564
101.3099, .72,0, 4.118439,.196116, .05099,-5.048029
165.9638, .71,.05, -3.152963,.242536, .206155,-3.91695
186.009, .51,.1, -10.049739,.052342, .19105,-18.913923
303.6901, .62,.62, -2.218801,.27735, .144222,-3.461329
353.1572, .7,.5, 17.117197,.039715, .251794,-24.927563
60.9454, .95,.47, -8.061673,.097129, .102956,-10.192674
90, 1,.56, 1,1, .06,-.94
120.2564, .49,.13, -8.061936,.071982, .138924,-13.75352
48.0128, .42,.25, 12.041365,.074329, .269072,-13.184552
0, .6,.45, 1,1, .26,-.74
325.3048, .86,.45, -12.206392,.063246, .158114,-15.653274
254.0546, .99,.36, 4.120817,.137361, .145602,-7.134508
207.646, .95,.22, 21.470869,.042182, .237065,-23.469474
175.4261, .74,.11, 13.038344,.039873, .250799,-24.829074
`),!1);ie(ee.ParsePatFile(`
*HATCH-DOTS,HATCH-DOTS verbose
;By John Hyslop,    Tile2Hatch tool \xA9 CVH 2020
;Developed in inch as imperial QCAD3 pattern
225,0.56554781,0.11554781,0.70710678,0.70710678,0.45245257,-0.96176099
225,0.25036388,0.20036388,0.70710678,0.70710678,0.6374253,-0.77678826
225,0.12918503,0.37918503,0.70710678,0.70710678,0.71894383,-0.69526973
225,0.75438447,0.20438447,0.70710678,0.70710678,0.45245257,-0.96176099
225,0.30962291,0.15962291,0.70710678,0.70710678,0.6636138,-0.75059977
225,0.11186858,0.46186858,0.70710678,0.70710678,0.81138689,-0.60282667
225,0.37918503,0.12918503,0.70710678,0.70710678,0.71894383,-0.69526973
225,0.11554781,0.56554781,0.70710678,0.70710678,0.45245257,-0.96176099
225,0.20036388,0.25036388,0.70710678,0.70710678,0.6374253,-0.77678826
225,0.46186859,0.11186859,0.70710678,0.70710678,0.8113869,-0.60282666
225,0.20438447,0.75438447,0.70710678,0.70710678,0.45245257,-0.96176099
225,0.15962291,0.30962291,0.70710678,0.70710678,0.6636138,-0.75059977
`),!1);ie(ee.ParsePatFile(`
*HATCH-SQRS,HATCH-SQRS verbose
;By John Hyslop,    Tile2Hatch tool \xA9 CVH 2020
;Developed in inch as imperial QCAD3 pattern
225,0.11,0.36,0.70710678,0.70710678,0.31112698,-1.10308658
225,0.11,0.86,0.70710678,0.70710678,0.31112698,-1.10308658
225,0.11,0.26,0.70710678,0.70710678,0.52325902,-0.89095454
225,0.76,0.11,0.70710678,0.70710678,0.31112698,-1.10308658
225,0.11,0.56,0.70710678,0.70710678,0.31112698,-1.10308658
225,0.11,0.46,0.70710678,0.70710678,0.31112698,-1.10308658
225,0.26,0.11,0.70710678,0.70710678,0.52325902,-0.89095454
225,0.11,0.76,0.70710678,0.70710678,0.31112698,-1.10308658
225,0.11,0.16,0.70710678,0.70710678,0.38183766,-1.0323759
225,0.16,0.11,0.70710678,0.70710678,0.38183766,-1.0323759
225,0.46,0.11,0.70710678,0.70710678,0.31112698,-1.10308658
225,0.56,0.11,0.70710678,0.70710678,0.31112698,-1.10308658
225,0.36,0.11,0.70710678,0.70710678,0.31112698,-1.10308658
225,0.86,0.11,0.70710678,0.70710678,0.31112698,-1.10308658
225,0.11,0.66,0.70710678,0.70710678,0.31112698,-1.10308658
225,0.66,0.11,0.70710678,0.70710678,0.31112698,-1.10308658
`),!1);ie(ee.ParsePatFile(`
*HEXAGONS,HEXAGONS verbose
;By John Hyslop,    Tile2Hatch tool \xA9 CVH 2020
;Developed in inch as imperial QCAD3 pattern
239.931417,0.21999999,0.99999998,8.06212908,0.04554875,0.21954496,-21.73495344
239.931417,0.89,0.19,8.06212908,0.04554875,0.21954496,-21.73495344
300.068583,0.78000001,0.99999998,13.89236932,0.04554875,0.21954496,-21.73495344
60.068488,0.12,0.5,8.06221498,0.02626129,0.38078866,-37.69807687
119.931512,0.31,0.17,30.01665055,0.02626129,0.38078865,-37.69807687
300.068583,0.11,0.19,13.89236932,0.04554875,0.21954496,-21.73495344
180,0.11,0.19,0,1,0.21999996,-0.78000004
299.931512,0.69,0.83,30.01665055,0.02626129,0.38078865,-37.69807687
0,0.31,0.83,0,1,0.38,-0.62
180,0.69,0.17,0,1,0.38,-0.62
240.068488,0.88,0.5,8.06221498,0.02626129,0.38078866,-37.69807687
180,0.11,0.81,0,1,0.21999996,-0.78000004
`),!1);ie(ee.ParsePatFile(`
*HEXJOIN-01,HEXJOIN-01 verbose
;By John Hyslop,    Tile2Hatch tool \xA9 CVH 2020
;Developed in inch as imperial QCAD3 pattern
45,0.15,0.65,0.70710678,0.70710678,0.28284271,-1.13137085
270,0.85,0.65,1,1,0.3,-0.7
315,0.65,0.85,0.70710678,0.70710678,0.28284271,-1.13137085
180,0.65,0.15,0,1,0.3,-0.7
270,0.55,0.15,1,1,0.3,-0.7
90,0.15,0.35,1,1,0.3,-0.7
135,0.35,0.15,0.70710678,0.70710678,0.28284271,-1.13137085
180,0.15,0.55,0,1,0.3,-0.7
270,0.45,0.15,1,1,0.3,-0.7
180,0.15,0.45,0,1,0.3,-0.7
225,0.85,0.35,0.70710678,0.70710678,0.28284271,-1.13137085
0,0.35,0.85,0,1,0.3,-0.7
`),!1);ie(ee.ParsePatFile(`
*HEXJOIN-02,HEXJOIN-02 verbose
;By John Hyslop,    Tile2Hatch tool \xA9 CVH 2020
;Developed in inch as imperial QCAD3 pattern
270,0.85,0.45,1,1,0.1,-0.9
315,0.65,0.85,0.70710678,0.70710678,0.28284271,-1.13137085
270,0.55,0.15,1,1,0.3,-0.7
180,0.15,0.55,0,1,0.3,-0.7
180,0.65,0.15,0,1,0.1,-0.9
45,0.15,0.65,0.70710678,0.70710678,0.28284271,-1.13137085
90,0.15,0.55,1,1,0.1,-0.9
180,0.15,0.45,0,1,0.3,-0.7
180,0.45,0.15,0,1,0.1,-0.9
270,0.45,0.15,1,1,0.3,-0.7
90,0.15,0.35,1,1,0.1,-0.9
0,0.55,0.85,0,1,0.1,-0.9
135,0.35,0.15,0.70710678,0.70710678,0.28284271,-1.13137085
0,0.35,0.85,0,1,0.1,-0.9
225,0.85,0.35,0.70710678,0.70710678,0.28284271,-1.13137085
270,0.85,0.65,1,1,0.1,-0.9
`),!1);ie(ee.ParsePatFile(`
*HEX,HEX
0, 0,0, 0,.21650635, .125,-.25
120, 0,0, 0,.21650635, .125,-.25
60, .125,0, 0,.21650635, .125,-.25
`),!1);ie(ee.ParsePatFile(`
*HOLLY,HOLLY
;By John Hyslop
;Developed in inch as imperial QCAD3 pattern
99.462322,0.8,0.11,5.09636861,0.16439899,0.06082763,-6.0219349
74.744881,0.67,0.08,4.12217269,0.0877058,0.11401754,-11.28773671
68.198591,0.53,0.15,3.15682075,0.18569534,0.1077033,-5.27746151
270,0.58,0.37,0,1,0.07,-0.93
248.198591,0.75,0.35,3.15682075,0.18569534,0.1077033,-5.27746151
45,0.8,0.2,0.70710678,0.70710678,0.08485281,-1.32936075
351.869898,0.9,0.13,0.98994949,0.14142136,0.07071068,-7.00035713
0,0.86,0.13,0,1,0.04,-0.96
26.565051,0.82,0.11,1.34164079,0.4472136,0.04472136,-2.19134662
45,0.8,0.09,0.70710678,0.70710678,0.02828427,-1.38592929
341.565051,0.77,0.1,0.9486833,0.31622777,0.03162278,-3.13065488
0,0.73,0.1,0,1,0.04,-0.96
26.565051,0.71,0.09,1.34164079,0.4472136,0.02236068,-2.2137073
26.565051,0.69,0.08,1.34164079,0.4472136,0.02236068,-2.2137073
53.130102,0.66,0.04,3.6,0.2,0.05,-4.95
270,0.66,0.08,0,1,0.04,-0.96
303.690068,0.64,0.11,1.38675049,0.2773501,0.03605551,-3.56949576
315,0.62,0.13,0.70710678,0.70710678,0.02828427,-1.38592929
345.963757,0.58,0.14,0.9701425,0.24253563,0.04123106,-4.08187457
0,0.54,0.14,0,1,0.04,-0.96
33.690068,0.51,0.12,1.38675049,0.2773501,0.03605551,-3.56949576
255.963757,0.52,0.16,0.9701425,0.24253563,0.04123106,-4.08187457
281.309932,0.51,0.21,4.11843884,0.19611614,0.0509902,-5.04802932
284.036243,0.5,0.25,3.15296313,0.24253563,0.04123106,-4.08187457
296.565051,0.48,0.29,1.34164079,0.4472136,0.04472136,-2.19134662
303.690068,0.46,0.32,1.38675049,0.2773501,0.03605551,-3.56949576
180,0.5,0.32,0,1,0.04,-0.96
180,0.53,0.32,0,1,0.03,-0.97
213.690068,0.56,0.34,1.38675049,0.2773501,0.03605551,-3.56949576
243.434949,0.57,0.36,0.89442719,0.4472136,0.02236068,-2.2137073
251.565051,0.58,0.39,0.9486833,0.31622777,0.03162278,-3.13065488
108.434949,0.59,0.36,2.21359436,0.31622777,0.03162278,-3.13065488
135,0.61,0.34,0.70710678,0.70710678,0.02828427,-1.38592929
153.434949,0.63,0.33,0.89442719,0.4472136,0.02236068,-2.2137073
161.565051,0.66,0.32,0.9486833,0.31622777,0.03162278,-3.13065488
180,0.69,0.32,0,1,0.03,-0.97
198.434949,0.72,0.33,2.21359436,0.31622777,0.03162278,-3.13065488
225,0.74,0.35,0.70710678,0.70710678,0.02828427,-1.38592929
251.565051,0.75,0.38,0.9486833,0.31622777,0.03162278,-3.13065488
108.434949,0.76,0.35,2.21359436,0.31622777,0.03162278,-3.13065488
116.565051,0.78,0.31,1.34164079,0.4472136,0.04472136,-2.19134662
135,0.81,0.28,0.70710678,0.70710678,0.04242641,-1.37178716
161.565051,0.84,0.27,0.9486833,0.31622777,0.03162278,-3.13065488
180,0.87,0.27,0,1,0.03,-0.97
90,0.87,0.24,0,1,0.03,-0.97
111.801409,0.89,0.19,2.22834406,0.18569534,0.05385165,-5.33131316
126.869898,0.92,0.15,1.4,0.2,0.05,-4.95
149.036243,0.97,0.12,2.22948161,0.17149859,0.05830952,-5.77264238
338.587031,0.46,0.32,24.69817132,0.01825438,0.54781384,-54.23356986
338.198591,0.8,0.69,3.15682075,0.18569534,0.05385165,-5.33131316
323.972627,0.71,0.62,8.60201108,0.07352146,0.13601471,-13.4654558
315,0.6,0.53,0.70710678,0.70710678,0.11313708,-1.30107648
135,0.58,0.55,0.70710678,0.70710678,0.07071068,-1.34350288
126.869898,0.68,0.65,1.4,0.2,0.1,-4.9
105.945396,0.77,0.72,3.15929297,0.13736056,0.0728011,-7.20730879
30.963757,0.87,0.8,3.60147029,0.17149859,0.05830952,-5.77264238
14.036243,0.83,0.79,3.15296313,0.24253563,0.04123106,-4.08187457
0,0.8,0.79,0,1,0.03,-0.97
341.565051,0.77,0.8,0.9486833,0.31622777,0.03162278,-3.13065488
333.434949,0.75,0.81,0.89442719,0.4472136,0.02236068,-2.2137073
63.434949,0.74,0.79,0.89442719,0.4472136,0.02236068,-2.2137073
45,0.72,0.77,0.70710678,0.70710678,0.02828427,-1.38592929
33.690068,0.69,0.75,1.38675049,0.2773501,0.03605551,-3.56949576
18.434949,0.66,0.74,2.21359436,0.31622777,0.03162278,-3.13065488
0,0.63,0.74,0,1,0.03,-0.97
341.565051,0.6,0.75,0.9486833,0.31622777,0.03162278,-3.13065488
108.434949,0.61,0.72,2.21359436,0.31622777,0.03162278,-3.13065488
90,0.61,0.69,0,1,0.03,-0.97
75.963757,0.6,0.65,0.9701425,0.24253563,0.04123106,-4.08187457
45,0.57,0.62,0.70710678,0.70710678,0.04242641,-1.37178716
14.036243,0.53,0.61,3.15296313,0.24253563,0.04123106,-4.08187457
0,0.5,0.61,0,1,0.03,-0.97
126.869898,0.53,0.57,1.4,0.2,0.05,-4.95
90,0.53,0.54,0,1,0.03,-0.97
75.963757,0.52,0.5,0.9701425,0.24253563,0.04123106,-4.08187457
56.309932,0.5,0.47,2.21880078,0.2773501,0.03605551,-3.56949576
191.309932,0.55,0.48,4.11843884,0.19611614,0.0509902,-5.04802932
168.690068,0.6,0.47,0.98058068,0.19611614,0.0509902,-5.04802932
161.565051,0.66,0.45,0.9486833,0.31622777,0.06324555,-3.09903211
143.130102,0.7,0.42,3.6,0.2,0.05,-4.95
270,0.7,0.43,0,1,0.01,-0.99
270,0.7,0.46,0,1,0.03,-0.97
243.434949,0.72,0.5,0.89442719,0.4472136,0.04472136,-2.19134662
213.690068,0.75,0.52,1.38675049,0.2773501,0.03605551,-3.56949576
198.434949,0.78,0.53,2.21359436,0.31622777,0.03162278,-3.13065488
180,0.82,0.53,0,1,0.04,-0.96
146.309932,0.85,0.51,2.21880078,0.2773501,0.03605551,-3.56949576
303.690068,0.83,0.54,1.38675049,0.2773501,0.03605551,-3.56949576
270,0.83,0.57,0,1,0.03,-0.97
270,0.83,0.61,0,1,0.04,-0.96
243.434949,0.85,0.65,0.89442719,0.4472136,0.04472136,-2.19134662
225,0.87,0.67,0.70710678,0.70710678,0.02828427,-1.38592929
296.565051,0.86,0.69,1.34164079,0.4472136,0.02236068,-2.2137073
270,0.86,0.71,0,1,0.02,-0.98
255.963757,0.87,0.75,0.9701425,0.24253563,0.04123106,-4.08187457
243.434949,0.89,0.79,0.89442719,0.4472136,0.04472136,-2.19134662
233.130102,0.92,0.83,3.6,0.2,0.05,-4.95
40.601295,0.5,0.47,1.41004798,0.10846523,0.55317267,-8.66637179
195.945396,0.26,0.54,3.15929297,0.13736056,0.0728011,-7.20730879
5.194429,0.29,0.55,10.04946781,0.09053575,0.11045361,-10.93490741
19.983107,0.28,0.68,8.54357658,0.08543577,0.117047,-11.58765291
185.710593,0.23,0.68,9.05483843,0.09950372,0.10049876,-9.94937686
164.054604,0.22,0.79,4.12081692,0.13736056,0.0728011,-7.20730879
45,0.27,0.79,0.70710678,0.70710678,0.05656854,-1.35764502
90,0.21,0.92,0,1,0.04,-0.96
75.963757,0.2,0.88,0.9701425,0.24253563,0.04123106,-4.08187457
243.434949,0.31,0.47,0.89442719,0.4472136,0.04472136,-2.19134662
236.309932,0.33,0.5,2.21880078,0.2773501,0.03605551,-3.56949576
225,0.36,0.53,0.70710678,0.70710678,0.04242641,-1.37178716
213.690068,0.39,0.55,1.38675049,0.2773501,0.03605551,-3.56949576
189.462322,0.45,0.56,5.09636861,0.16439899,0.06082763,-6.0219349
333.434949,0.43,0.57,0.89442719,0.4472136,0.02236068,-2.2137073
326.309932,0.4,0.59,2.21880078,0.2773501,0.03605551,-3.56949576
303.690068,0.38,0.62,1.38675049,0.2773501,0.03605551,-3.56949576
270,0.38,0.66,0,1,0.04,-0.96
251.565051,0.39,0.69,0.9486833,0.31622777,0.03162278,-3.13065488
236.309932,0.41,0.72,2.21880078,0.2773501,0.03605551,-3.56949576
213.690068,0.44,0.74,1.38675049,0.2773501,0.03605551,-3.56949576
0,0.4,0.74,0,1,0.04,-0.96
333.434949,0.36,0.76,0.89442719,0.4472136,0.04472136,-2.19134662
306.869898,0.33,0.8,1.4,0.2,0.05,-4.95
284.036243,0.32,0.84,3.15296313,0.24253563,0.04123106,-4.08187457
341.565051,0.29,0.85,0.9486833,0.31622777,0.03162278,-3.13065488
326.309932,0.26,0.87,2.21880078,0.2773501,0.03605551,-3.56949576
303.690068,0.24,0.9,1.38675049,0.2773501,0.03605551,-3.56949576
296.565051,0.21,0.96,1.34164079,0.4472136,0.06708204,-2.16898594
56.309932,0.18,0.85,2.21880078,0.2773501,0.03605551,-3.56949576
45,0.16,0.83,0.70710678,0.70710678,0.02828427,-1.38592929
33.690068,0.13,0.81,1.38675049,0.2773501,0.03605551,-3.56949576
116.565051,0.14,0.79,1.34164079,0.4472136,0.02236068,-2.2137073
108.434949,0.15,0.76,2.21359436,0.31622777,0.03162278,-3.13065488
90,0.15,0.72,0,1,0.04,-0.96
63.434949,0.13,0.68,0.89442719,0.4472136,0.04472136,-2.19134662
33.690068,0.1,0.66,1.38675049,0.2773501,0.03605551,-3.56949576
165.963757,0.14,0.65,0.9701425,0.24253563,0.04123106,-4.08187457
143.130102,0.18,0.62,3.6,0.2,0.05,-4.95
116.565051,0.2,0.58,1.34164079,0.4472136,0.04472136,-2.19134662
75.963757,0.19,0.54,0.9701425,0.24253563,0.04123106,-4.08187457
63.434949,0.17,0.5,0.89442719,0.4472136,0.04472136,-2.19134662
180,0.21,0.5,0,1,0.04,-0.96
165.963757,0.25,0.49,0.9701425,0.24253563,0.04123106,-4.08187457
135,0.27,0.47,0.70710678,0.70710678,0.02828427,-1.38592929
116.565051,0.29,0.43,1.34164079,0.4472136,0.04472136,-2.19134662
278.583621,0.21,0.96,33.37663332,0.01865659,0.53600373,-53.0643694
104.036243,0.3,0.2,3.15296313,0.24253563,0.04123106,-4.08187457
123.690068,0.32,0.17,1.38675049,0.2773501,0.03605551,-3.56949576
153.434949,0.36,0.15,0.89442719,0.4472136,0.04472136,-2.19134662
180,0.39,0.15,0,1,0.03,-0.97
206.565051,0.43,0.17,1.34164079,0.4472136,0.04472136,-2.19134662
236.309932,0.45,0.2,2.21880078,0.2773501,0.03605551,-3.56949576
255.963757,0.46,0.24,0.9701425,0.24253563,0.04123106,-4.08187457
288.434949,0.45,0.27,2.21359436,0.31622777,0.03162278,-3.13065488
303.690068,0.43,0.3,1.38675049,0.2773501,0.03605551,-3.56949576
333.434949,0.39,0.32,0.89442719,0.4472136,0.04472136,-2.19134662
0,0.36,0.32,0,1,0.03,-0.97
26.565051,0.32,0.3,1.34164079,0.4472136,0.04472136,-2.19134662
56.309932,0.3,0.27,2.21880078,0.2773501,0.03605551,-3.56949576
71.565051,0.29,0.24,0.9486833,0.31622777,0.03162278,-3.13065488
104.036243,0.16,0.31,3.15296313,0.24253563,0.04123106,-4.08187457
123.690068,0.18,0.28,1.38675049,0.2773501,0.03605551,-3.56949576
153.434949,0.22,0.26,0.89442719,0.4472136,0.04472136,-2.19134662
180,0.25,0.26,0,1,0.03,-0.97
206.565051,0.29,0.28,1.34164079,0.4472136,0.04472136,-2.19134662
236.309932,0.31,0.31,2.21880078,0.2773501,0.03605551,-3.56949576
255.963757,0.32,0.35,0.9701425,0.24253563,0.04123106,-4.08187457
288.434949,0.31,0.38,2.21359436,0.31622777,0.03162278,-3.13065488
303.690068,0.29,0.41,1.38675049,0.2773501,0.03605551,-3.56949576
333.434949,0.25,0.43,0.89442719,0.4472136,0.04472136,-2.19134662
0,0.22,0.43,0,1,0.03,-0.97
26.565051,0.18,0.41,1.34164079,0.4472136,0.04472136,-2.19134662
56.309932,0.16,0.38,2.21880078,0.2773501,0.03605551,-3.56949576
71.565051,0.15,0.35,0.9486833,0.31622777,0.03162278,-3.13065488
104.036243,0.34,0.38,3.15296313,0.24253563,0.04123106,-4.08187457
123.690068,0.36,0.35,1.38675049,0.2773501,0.03605551,-3.56949576
153.434949,0.4,0.33,0.89442719,0.4472136,0.04472136,-2.19134662
180,0.43,0.33,0,1,0.03,-0.97
206.565051,0.47,0.35,1.34164079,0.4472136,0.04472136,-2.19134662
236.309932,0.49,0.38,2.21880078,0.2773501,0.03605551,-3.56949576
255.963757,0.5,0.42,0.9701425,0.24253563,0.04123106,-4.08187457
288.434949,0.49,0.45,2.21359436,0.31622777,0.03162278,-3.13065488
303.690068,0.47,0.48,1.38675049,0.2773501,0.03605551,-3.56949576
333.434949,0.43,0.5,0.89442719,0.4472136,0.04472136,-2.19134662
0,0.4,0.5,0,1,0.03,-0.97
26.565051,0.36,0.48,1.34164079,0.4472136,0.04472136,-2.19134662
56.309932,0.34,0.45,2.21880078,0.2773501,0.03605551,-3.56949576
71.565051,0.33,0.42,0.9486833,0.31622777,0.03162278,-3.13065488
`),!1);ie(ee.ParsePatFile(`
*HONEY,HONEY
0, 0,0, .1875,.10825317, .125,-.25
120, 0,0, .1875,.10825317, .125,-.25
60, 0,0, .1875,.10825317, -.25,.125
`),!1);ie(ee.ParsePatFile(`
*HOUND,HOUND
0, 0,0, .25,.0625, 1,-.5
90, 0,0, -.25,.0625, 1,-.5
`),!1);ie(ee.ParsePatFile(`
*INSUL,INSUL
0, 0,0, 0,.375
0, 0,.125, 0,.375, .125,-.125
0, 0,.25, 0,.375, .125,-.125
`),!1);ie(ee.ParsePatFile(`
*LATTICE-01,LATTICE-01 verbose
;By John Hyslop,    Tile2Hatch tool \xA9 CVH 2020
;Developed in inch as imperial QCAD3 pattern
180,0.08514719,0.4,0,1,0.17029438,-0.82970562
270,0.6,0.08514719,1,1,0.17029438,-0.82970562
270,0.4,0.08514719,1,1,0.17029438,-0.82970562
135,0.5,0.2679899,0.70710678,0.70710678,0.32811183,-1.08610173
225,0.7320101,0.5,0.70710678,0.70710678,0.32811183,-1.08610173
45,0.08514719,0.6,0.70710678,0.70710678,0.44526911,-0.96894445
180,0.08514719,0.6,0,1,0.17029438,-0.82970562
315,0.5,0.7320101,0.70710678,0.70710678,0.32811183,-1.08610173
45,0.2679899,0.5,0.70710678,0.70710678,0.32811183,-1.08610173
315,0.6,0.91485281,0.70710678,0.70710678,0.44526911,-0.96894445
45,0.6,0.08514719,0.70710678,0.70710678,0.44526911,-0.96894445
315,0.08514719,0.4,0.70710678,0.70710678,0.44526911,-0.96894445
`),!1);ie(ee.ParsePatFile(`
*LATTICE-02,LATTICE-02 verbose
;By John Hyslop,    Tile2Hatch tool \xA9 CVH 2020
;Developed in inch as imperial QCAD3 pattern
180,0.38333333,0.38333333,0,1,0.76666666,-0.23333334
270,0.61666667,1,1,1,1;,0 Removed 0 IT RENDERS A POINT
180,0.38333333,0.61666667,0,1,0.76666666,-0.23333334
270,0.38333333,1,1,1,1,;0 Removed 0 IT RENDERS A POINT
`),!1);ie(ee.ParsePatFile(`
*LATTICE-03,LATTICE-03 verbose
;By John Hyslop,    Tile2Hatch tool \xA9 CVH 2020
;Developed in inch as imperial QCAD3 pattern
180,0.38333333,0.38333333,0,1,0.76666666,-0.23333334
180,0.38333333,0.61666667,0,1,0.76666666,-0.23333334
270,0.61666667,0.38333333,1,1,0.76666666,-0.23333334
270,0.38333333,0.38333333,1,1,0.76666666,-0.23333334
`),!1);ie(ee.ParsePatFile(`
*LATTICE-04,LATTICE-04 verbose
;By John Hyslop,    Tile2Hatch tool \xA9 CVH 2020
;Developed in inch as imperial QCAD3 pattern
296.565051,0.15333333,0.46,1.34164079,0.4472136,1.13294111,-1.10312687
296.565051,0.34000001,0.55333333,1.34164079,0.4472136,1.13294111,-1.10312687
206.565051,0.46,0.84666667,1.34164079,0.4472136,1.13294111,-1.10312687
206.565051,0.55333333,0.65999999,1.34164079,0.4472136,1.13294111,-1.10312687
`),!1);ie(ee.ParsePatFile(`
*LATTICE-05,LATTICE-05
;By John Hyslop
;Developed in inch as imperial QCAD3 pattern
0,0.775,0.075,0,1,0.15,-0.85
180,0.225,0.925,0,1,0.15,-0.85
180,0.625,0.225,0,1,0.4,-0.6
180,0.625,0.075,0,1,0.55,-0.45
270,0.625,0.225,0,1,0.15,-0.85
270,0.775,0.775,0,1,0.7,-0.3
270,0.925,0.925,0,1,0.85,-0.15
0,0.375,0.775,0,1,0.4,-0.6
0,0.375,0.925,0,1,0.55,-0.45
90,0.375,0.775,0,1,0.15,-0.85
90,0.225,0.225,0,1,0.7,-0.3
90,0.075,0.075,0,1,0.85,-0.15
`),!1);ie(ee.ParsePatFile(`
*LATTICE-06,LATTICE-06
;By John Hyslop
;Developed in inch as imperial QCAD3 pattern
180,0.625,0.375,0,1,0.25,-0.75
270,0.625,0.625,0,1,0.25,-0.75
0,0.375,0.625,0,1,0.25,-0.75
90,0.375,0.375,0,1,0.25,-0.75
0,0.775,0.075,0,1,0.15,-0.85
180,0.225,0.925,0,1,0.15,-0.85
180,0.625,0.225,0,1,0.4,-0.6
180,0.625,0.075,0,1,0.55,-0.45
270,0.625,0.225,0,1,0.15,-0.85
270,0.775,0.775,0,1,0.7,-0.3
270,0.925,0.925,0,1,0.85,-0.15
0,0.375,0.775,0,1,0.4,-0.6
0,0.375,0.925,0,1,0.55,-0.45
90,0.375,0.775,0,1,0.15,-0.85
90,0.225,0.225,0,1,0.7,-0.3
90,0.075,0.075,0,1,0.85,-0.15
`),!1);ie(ee.ParsePatFile(`
*LATTICE-07, verbose comment
;By John Hyslop,    Tile2Hatch tool \xA9 CVH 2020
;Developed in inch as imperial QCAD3 pattern
270,0.69166667,0.69166666,1,1,0.88333333,-0.11666667
270,0.80833334,0.69166666,1,1,0.88333333,-0.11666667
270,0.19166666,0.19166667,1,1,0.88333333,-0.11666667
270,0.30833333,0.19166667,1,1,0.88333333,-0.11666667
180,0.69166667,0.30833333,0,1,0.88333333,-0.11666667
180,0.69166667,0.19166666,0,1,0.88333333,-0.11666667
180,0.19166667,0.80833334,0,1,0.88333333,-0.11666667
180,0.19166667,0.69166667,0,1,0.88333333,-0.11666667
`),!1);ie(ee.ParsePatFile(`
*LEAF-01,LEAF-01
;By John Hyslop,    Using AutoCAD Lisp Tool
;Developed in inch as imperial QCAD3 pattern
83.659808,0.9,0.2,0.99388373,0.11043153,0.09055385,-8.96483129
26.565051,0.88,0.19,1.34164079,0.4472136,0.02236068,-2.2137073
14.036243,0.84,0.18,3.15296313,0.24253563,0.04123106,-4.08187457
315,0.84,0.18,0.70710678,0.70710678,0.05656854,-1.35764502
83.659808,0.84,0.18,0.99388373,0.11043153,0.09055385,-8.96483129
0,0.79,0.18,0,1,0.05,-0.95
345.963757,0.82,0.12,0.9701425,0.24253563,0.04123106,-4.08187457
326.309932,0.79,0.14,2.21880078,0.2773501,0.03605551,-3.56949576
303.690068,0.77,0.17,1.38675049,0.2773501,0.03605551,-3.56949576
18.434949,0.74,0.16,2.21359436,0.31622777,0.03162278,-3.13065488
288.434949,0.73,0.19,2.21359436,0.31622777,0.03162278,-3.13065488
180,0.77,0.19,0,1,0.04,-0.96
258.690068,0.78,0.24,0.98058068,0.19611614,0.0509902,-5.04802932
243.434949,0.79,0.26,0.89442719,0.4472136,0.02236068,-2.2137073
225,0.82,0.29,0.70710678,0.70710678,0.04242641,-1.37178716
213.690068,0.85,0.31,1.38675049,0.2773501,0.03605551,-3.56949576
191.309932,0.9,0.32,4.11843884,0.19611614,0.0509902,-5.04802932
128.659808,0.3,0.42,1.40556386,0.15617376,0.06403124,-6.339093
143.130102,0.34,0.39,3.6,0.2,0.05,-4.95
153.434949,0.38,0.37,0.89442719,0.4472136,0.04472136,-2.19134662
192.528808,0.38,0.37,4.1216787,0.10846523,0.09219544,-9.12734901
105.945396,0.38,0.37,3.15929297,0.13736056,0.0728011,-7.20730879
153.434949,0.42,0.35,0.89442719,0.4472136,0.04472136,-2.19134662
149.036243,0.47,0.32,2.22948161,0.17149859,0.05830952,-5.77264238
95.710593,0.47,0.32,9.05483843,0.09950372,0.10049876,-9.94937686
194.931417,0.47,0.32,11.40157229,0.06441566,0.15524175,-15.36893295
135,0.51,0.28,0.70710678,0.70710678,0.05656854,-1.35764502
123.690068,0.53,0.25,1.38675049,0.2773501,0.03605551,-3.56949576
199.653824,0.53,0.25,11.70450662,0.06726728,0.14866069,-14.71740806
71.565051,0.53,0.25,0.9486833,0.31622777,0.09486833,-3.06740933
119.054604,0.58,0.16,8.06167266,0.09712859,0.1029563,-10.19267384
288.434949,0.58,0.14,2.21359436,0.31622777,0.06324555,-3.09903211
21.801409,0.53,0.12,2.22834406,0.18569534,0.05385165,-5.33131316
11.309932,0.48,0.11,4.11843884,0.19611614,0.0509902,-5.04802932
0,0.45,0.11,0,1,0.03,-0.97
341.565051,0.39,0.13,0.9486833,0.31622777,0.06324555,-3.09903211
326.309932,0.33,0.17,2.21880078,0.2773501,0.07211103,-3.53344025
308.659808,0.29,0.22,1.40556386,0.15617376,0.06403124,-6.339093
300.963757,0.26,0.27,3.60147029,0.17149859,0.05830952,-5.77264238
285.945396,0.24,0.34,3.15929297,0.13736056,0.0728011,-7.20730879
270,0.24,0.41,0,1,0.07,-0.93
279.462322,0.23,0.47,5.09636861,0.16439899,0.06082763,-6.0219349
285.945396,0.21,0.54,3.15929297,0.13736056,0.0728011,-7.20730879
123.690068,0.23,0.51,1.38675049,0.2773501,0.03605551,-3.56949576
161.565051,0.26,0.5,0.9486833,0.31622777,0.03162278,-3.13065488
171.869898,0.33,0.49,0.98994949,0.14142136,0.07071068,-7.00035713
171.869898,0.4,0.48,0.98994949,0.14142136,0.07071068,-7.00035713
161.565051,0.46,0.46,0.9486833,0.31622777,0.06324555,-3.09903211
161.565051,0.52,0.44,0.9486833,0.31622777,0.06324555,-3.09903211
146.309932,0.58,0.4,2.21880078,0.2773501,0.07211103,-3.53344025
119.744881,0.62,0.33,5.82963253,0.12403473,0.08062258,-7.98163517
111.801409,0.64,0.28,2.22834406,0.18569534,0.05385165,-5.33131316
90,0.64,0.24,0,1,0.04,-0.96
75.963757,0.63,0.2,0.9701425,0.24253563,0.04123106,-4.08187457
56.309932,0.61,0.17,2.21880078,0.2773501,0.03605551,-3.56949576
63.434949,0.6,0.15,0.89442719,0.4472136,0.02236068,-2.2137073
126.869898,0.63,0.11,1.4,0.2,0.05,-4.95
45,0.6,0.08,0.70710678,0.70710678,0.04242641,-1.37178716
233.130102,0.89,0.04,3.6,0.2,0.05,-4.95
258.690068,0.07,0.05,0.98058068,0.19611614,0.0509902,-5.04802932
258.690068,0.14,0.05,0.98058068,0.19611614,0.0509902,-5.04802932
198.434949,0.26,0.02,2.21359436,0.31622777,0.06324555,-3.09903211
225,0.31,0.02,0.70710678,0.70710678,0.02828427,-1.38592929
198.434949,0.34,0.03,2.21359436,0.31622777,0.03162278,-3.13065488
348.690068,0.29,0.04,0.98058068,0.19611614,0.0509902,-5.04802932
345.963757,0.25,0.05,0.9701425,0.24253563,0.04123106,-4.08187457
333.434949,0.21,0.07,0.89442719,0.4472136,0.04472136,-2.19134662
333.434949,0.15,0.1,0.89442719,0.4472136,0.06708204,-2.16898594
348.690068,0.1,0.11,0.98058068,0.19611614,0.0509902,-5.04802932
0,0.07,0.11,0,1,0.03,-0.97
8.130102,0,0.1,6.08111832,0.14142136,0.07071068,-7.00035713
236.309932,0.02,0.23,2.21880078,0.2773501,0.03605551,-3.56949576
236.309932,0.04,0.26,2.21880078,0.2773501,0.03605551,-3.56949576
213.690068,0.07,0.28,1.38675049,0.2773501,0.03605551,-3.56949576
0,0.03,0.28,0,1,0.04,-0.96
326.309932,0,0.3,2.21880078,0.2773501,0.03605551,-3.56949576
18.434949,0,0.26,2.21359436,0.31622777,0.03162278,-3.13065488
0,0,0.55,0,1,0.07,-0.93
14.036243,0.1,0.61,3.15296313,0.24253563,0.04123106,-4.08187457
21.801409,0.05,0.59,2.22834406,0.18569534,0.05385165,-5.33131316
30.963757,0,0.56,3.60147029,0.17149859,0.05830952,-5.77264238
254.054604,0.02,0.66,4.12081692,0.13736056,0.0728011,-7.20730879
158.198591,0.05,0.69,3.15682075,0.18569534,0.05385165,-5.33131316
153.434949,0.11,0.66,0.89442719,0.4472136,0.06708204,-2.16898594
158.198591,0.16,0.64,3.15682075,0.18569534,0.05385165,-5.33131316
180,0.21,0.64,0,1,0.05,-0.95
33.690068,0.18,0.62,1.38675049,0.2773501,0.03605551,-3.56949576
45,0.16,0.6,0.70710678,0.70710678,0.02828427,-1.38592929
53.130102,0.13,0.56,3.6,0.2,0.05,-4.95
56.309932,0.09,0.5,2.21880078,0.2773501,0.07211103,-3.53344025
51.340192,0.05,0.45,4.99756038,0.15617376,0.06403124,-6.339093
38.659808,0,0.41,1.40556386,0.15617376,0.06403124,-6.339093
180,0.82,0.48,0,1,0.1,-0.9
310.601295,0.82,0.48,1.41004798,0.10846523,0.09219544,-9.12734901
82.405357,0.82,0.48,8.06198693,0.06608186,0.15132746,-14.98141849
180,0.84,0.48,0,1,0.02,-0.98
194.036243,0.88,0.49,3.15296313,0.24253563,0.04123106,-4.08187457
198.434949,0.91,0.5,2.21359436,0.31622777,0.03162278,-3.13065488
0,0.83,0.37,0,1,0.08,-0.92
348.690068,0.78,0.38,0.98058068,0.19611614,0.0509902,-5.04802932
321.340192,0.73,0.42,4.99756038,0.15617376,0.06403124,-6.339093
300.963757,0.7,0.47,3.60147029,0.17149859,0.05830952,-5.77264238
21.801409,0.65,0.45,2.22834406,0.18569534,0.05385165,-5.33131316
284.036243,0.64,0.49,3.15296313,0.24253563,0.04123106,-4.08187457
180,0.7,0.49,0,1,0.06,-0.94
261.869898,0.71,0.56,0.98994949,0.14142136,0.07071068,-7.00035713
248.198591,0.73,0.61,3.15682075,0.18569534,0.05385165,-5.33131316
225,0.77,0.65,0.70710678,0.70710678,0.05656854,-1.35764502
216.869898,0.81,0.68,1.4,0.2,0.05,-4.95
198.434949,0.9,0.71,2.21359436,0.31622777,0.09486833,-3.06740933
153.434949,0.36,0.65,0.89442719,0.4472136,0.06708204,-2.16898594
170.537678,0.42,0.64,0.98639392,0.16439899,0.06082763,-6.0219349
188.130102,0.49,0.65,6.08111832,0.14142136,0.07071068,-7.00035713
201.801409,0.54,0.67,2.22834406,0.18569534,0.05385165,-5.33131316
219.805571,0.6,0.72,1.40840568,0.12803688,0.0781025,-7.73214718
18.434949,0.97,0.25,2.21359436,0.31622777,0.03162278,-3.13065488
33.690068,0.94,0.23,1.38675049,0.2773501,0.03605551,-3.56949576
0,0.94,0.23,0,1,0.04,-0.96
80.537678,0.94,0.23,0.98639392,0.16439899,0.06082763,-6.0219349
36.869898,0.9,0.2,1.4,0.2,0.05,-4.95
341.565051,0.9,0.2,0.9486833,0.31622777,0.06324555,-3.09903211
53.130102,0.97,0.16,3.6,0.2,0.05,-4.95
38.659808,0.92,0.12,1.40556386,0.15617376,0.06403124,-6.339093
9.462322,0.86,0.11,5.09636861,0.16439899,0.06082763,-6.0219349
180,0.95,0.32,0,1,0.05,-0.95
158.198591,1,0.3,3.15682075,0.18569534,0.05385165,-5.33131316
216.869898,0.93,0.07,1.4,0.2,0.05,-4.95
206.565051,0.97,0.09,1.34164079,0.4472136,0.04472136,-2.19134662
198.434949,1,0.1,2.21359436,0.31622777,0.03162278,-3.13065488
90,0.97,0,0,1,0.02,-0.98
26.565051,0.96,0.53,1.34164079,0.4472136,0.04472136,-2.19134662
56.309932,0.96,0.53,2.21880078,0.2773501,0.07211103,-3.53344025
36.869898,0.96,0.53,1.4,0.2,0.05,-4.95
30.963757,0.91,0.5,3.60147029,0.17149859,0.05830952,-5.77264238
78.690068,0.91,0.5,0.98058068,0.19611614,0.15297059,-4.94604893
156.037511,1,0.46,7.61509624,0.10153462,0.09848858,-9.75036922
30.963757,0.95,0.38,3.60147029,0.17149859,0.05830952,-5.77264238
14.036243,0.91,0.37,3.15296313,0.24253563,0.04123106,-4.08187457
180,1,0.71,0,1,0.1,-0.9
0,0.86,0.87,0,1,0.09,-0.91
11.309932,0.95,0.87,4.11843884,0.19611614,0.0509902,-5.04802932
135,1,0.82,0.70710678,0.70710678,0.07071068,-1.34350288
0,0.96,0.76,0,1,0.04,-0.96
345.963757,0.92,0.77,0.9701425,0.24253563,0.04123106,-4.08187457
333.434949,0.88,0.79,0.89442719,0.4472136,0.04472136,-2.19134662
315,0.86,0.81,0.70710678,0.70710678,0.02828427,-1.38592929
306.869898,0.83,0.85,1.4,0.2,0.05,-4.95
11.309932,0.78,0.84,4.11843884,0.19611614,0.0509902,-5.04802932
284.036243,0.77,0.88,3.15296313,0.24253563,0.04123106,-4.08187457
180,0.83,0.88,0,1,0.06,-0.94
14.036243,0.65,0.89,3.15296313,0.24253563,0.04123106,-4.08187457
18.434949,0.62,0.88,2.21359436,0.31622777,0.03162278,-3.13065488
33.690068,0.59,0.86,1.38675049,0.2773501,0.03605551,-3.56949576
230.194429,0.65,0.78,6.401844,0.12803688,0.0781025,-7.73214718
239.036243,0.68,0.83,2.22948161,0.17149859,0.05830952,-5.77264238
236.309932,0.72,0.89,2.21880078,0.2773501,0.07211103,-3.53344025
213.690068,0.75,0.91,1.38675049,0.2773501,0.03605551,-3.56949576
198.434949,0.78,0.92,2.21359436,0.31622777,0.03162278,-3.13065488
0,0.74,0.92,0,1,0.04,-0.96
345.963757,0.7,0.93,0.9701425,0.24253563,0.04123106,-4.08187457
261.869898,0.84,0.95,0.98994949,0.14142136,0.07071068,-7.00035713
248.198591,0.86,1,3.15682075,0.18569534,0.05385165,-5.33131316
36.869898,0.55,0.83,1.4,0.2,0.05,-4.95
0,0.55,0.83,0,1,0.08,-0.92
78.690068,0.55,0.83,0.98058068,0.19611614,0.10198039,-4.99703912
33.690068,0.52,0.81,1.38675049,0.2773501,0.03605551,-3.56949576
30.963757,0.47,0.78,3.60147029,0.17149859,0.05830952,-5.77264238
336.037511,0.47,0.78,7.61509624,0.10153462,0.09848858,-9.75036922
79.380345,0.47,0.78,11.18017113,0.06142951,0.16278821,-16.11603239
26.565051,0.43,0.76,1.34164079,0.4472136,0.04472136,-2.19134662
9.462322,0.37,0.75,5.09636861,0.16439899,0.06082763,-6.0219349
318.814075,0.37,0.75,9.21906451,0.09407209,0.10630146,-10.52384435
82.405357,0.37,0.75,8.06198693,0.06608186,0.15132746,-14.98141849
0,0.33,0.75,0,1,0.04,-0.96
0,0.29,0.75,0,1,0.04,-0.96
0,0.2,0.76,0,1,0.06,-0.94
104.036243,0.21,0.72,3.15296313,0.24253563,0.04123106,-4.08187457
201.801409,0.26,0.74,2.22834406,0.18569534,0.05385165,-5.33131316
123.690068,0.3,0.68,1.38675049,0.2773501,0.07211103,-3.53344025
338.198591,0.65,0.95,3.15682075,0.18569534,0.05385165,-5.33131316
333.434949,0.59,0.98,0.89442719,0.4472136,0.06708204,-2.16898594
348.690068,0.54,0.99,0.98058068,0.19611614,0.0509902,-5.04802932
0,0.46,0.99,0,1,0.08,-0.92
18.434949,0.4,0.97,2.21359436,0.31622777,0.06324555,-3.09903211
26.565051,0.34,0.94,1.34164079,0.4472136,0.06708204,-2.16898594
45,0.29,0.89,0.70710678,0.70710678,0.07071068,-1.34350288
71.565051,0.27,0.83,0.9486833,0.31622777,0.06324555,-3.09903211
81.869898,0.26,0.76,0.98994949,0.14142136,0.07071068,-7.00035713
;0,0.2,0.76,0,1,0.06,-0.94
315,0,0.82,0.70710678,0.70710678,0.02828427,-1.38592929
198.434949,0.03,0.89,2.21359436,0.31622777,0.03162278,-3.13065488
343.300756,0.03,0.89,7.27947977,0.09578263,0.10440307,-10.33590344
74.744881,0.03,0.89,4.12217269,0.0877058,0.11401754,-11.28773671
206.565051,0.05,0.9,1.34164079,0.4472136,0.02236068,-2.2137073
213.690068,0.08,0.92,1.38675049,0.2773501,0.03605551,-3.56949576
216.869898,0.12,0.95,1.4,0.2,0.05,-4.95
352.874984,0.12,0.95,0.99227788,0.12403473,0.08062258,-7.98163517
78.690068,0.12,0.95,0.98058068,0.19611614,0.0509902,-5.04802932
213.690068,0.15,0.97,1.38675049,0.2773501,0.03605551,-3.56949576
213.690068,0.18,0.99,1.38675049,0.2773501,0.03605551,-3.56949576
206.565051,0.2,1,1.34164079,0.4472136,0.02236068,-2.2137073
45,0.28,0.99,0.70710678,0.70710678,0.01414214,-1.40007143
56.309932,0.26,0.96,2.21880078,0.2773501,0.03605551,-3.56949576
56.309932,0.22,0.9,2.21880078,0.2773501,0.07211103,-3.53344025
53.130102,0.19,0.86,3.6,0.2,0.05,-4.95
45,0.14,0.81,0.70710678,0.70710678,0.07071068,-1.34350288
36.869898,0.1,0.78,1.4,0.2,0.05,-4.95
18.434949,0.04,0.76,2.21359436,0.31622777,0.06324555,-3.09903211
0,0,0.76,0,1,0.04,-0.96
81.253838,0.95,0.87,7.07065907,0.07602859,0.13152946,-13.02141697
`),!1);ie(ee.ParsePatFile(`
*LEAF-02,LEAF-02
;By John Hyslop,    Using AutoCAD Lisp Tool
;Developed in inch as imperial QCAD3 pattern
303.690068,0.77,0.17,1.38675049,0.2773501,0.03605551,-3.56949576
18.434949,0.74,0.16,2.21359436,0.31622777,0.03162278,-3.13065488
288.434949,0.73,0.19,2.21359436,0.31622777,0.03162278,-3.13065488
180,0.77,0.19,0,1,0.04,-0.96
258.690068,0.78,0.24,0.98058068,0.19611614,0.0509902,-5.04802932
243.434949,0.79,0.26,0.89442719,0.4472136,0.02236068,-2.2137073
288.434949,0.58,0.14,2.21359436,0.31622777,0.06324555,-3.09903211
21.801409,0.53,0.12,2.22834406,0.18569534,0.05385165,-5.33131316
11.309932,0.48,0.11,4.11843884,0.19611614,0.0509902,-5.04802932
0,0.45,0.11,0,1,0.03,-0.97
341.565051,0.39,0.13,0.9486833,0.31622777,0.06324555,-3.09903211
326.309932,0.33,0.17,2.21880078,0.2773501,0.07211103,-3.53344025
308.659808,0.29,0.22,1.40556386,0.15617376,0.06403124,-6.339093
300.963757,0.26,0.27,3.60147029,0.17149859,0.05830952,-5.77264238
285.945396,0.24,0.34,3.15929297,0.13736056,0.0728011,-7.20730879
270,0.24,0.41,0,1,0.07,-0.93
279.462322,0.23,0.47,5.09636861,0.16439899,0.06082763,-6.0219349
285.945396,0.21,0.54,3.15929297,0.13736056,0.0728011,-7.20730879
123.690068,0.23,0.51,1.38675049,0.2773501,0.03605551,-3.56949576
161.565051,0.26,0.5,0.9486833,0.31622777,0.03162278,-3.13065488
171.869898,0.33,0.49,0.98994949,0.14142136,0.07071068,-7.00035713
171.869898,0.4,0.48,0.98994949,0.14142136,0.07071068,-7.00035713
161.565051,0.46,0.46,0.9486833,0.31622777,0.06324555,-3.09903211
161.565051,0.52,0.44,0.9486833,0.31622777,0.06324555,-3.09903211
146.309932,0.58,0.4,2.21880078,0.2773501,0.07211103,-3.53344025
119.744881,0.62,0.33,5.82963253,0.12403473,0.08062258,-7.98163517
111.801409,0.64,0.28,2.22834406,0.18569534,0.05385165,-5.33131316
90,0.64,0.24,0,1,0.04,-0.96
75.963757,0.63,0.2,0.9701425,0.24253563,0.04123106,-4.08187457
56.309932,0.61,0.17,2.21880078,0.2773501,0.03605551,-3.56949576
63.434949,0.6,0.15,0.89442719,0.4472136,0.02236068,-2.2137073
126.869898,0.63,0.11,1.4,0.2,0.05,-4.95
45,0.6,0.08,0.70710678,0.70710678,0.04242641,-1.37178716
225,0.31,0.02,0.70710678,0.70710678,0.02828427,-1.38592929
198.434949,0.34,0.03,2.21359436,0.31622777,0.03162278,-3.13065488
348.690068,0.29,0.04,0.98058068,0.19611614,0.0509902,-5.04802932
345.963757,0.25,0.05,0.9701425,0.24253563,0.04123106,-4.08187457
333.434949,0.21,0.07,0.89442719,0.4472136,0.04472136,-2.19134662
333.434949,0.15,0.1,0.89442719,0.4472136,0.06708204,-2.16898594
348.690068,0.1,0.11,0.98058068,0.19611614,0.0509902,-5.04802932
0,0.07,0.11,0,1,0.03,-0.97
8.130102,0,0.1,6.08111832,0.14142136,0.07071068,-7.00035713
236.309932,0.02,0.23,2.21880078,0.2773501,0.03605551,-3.56949576
236.309932,0.04,0.26,2.21880078,0.2773501,0.03605551,-3.56949576
213.690068,0.07,0.28,1.38675049,0.2773501,0.03605551,-3.56949576
0,0.03,0.28,0,1,0.04,-0.96
326.309932,0,0.3,2.21880078,0.2773501,0.03605551,-3.56949576
158.198591,0.05,0.69,3.15682075,0.18569534,0.05385165,-5.33131316
153.434949,0.11,0.66,0.89442719,0.4472136,0.06708204,-2.16898594
158.198591,0.16,0.64,3.15682075,0.18569534,0.05385165,-5.33131316
180,0.21,0.64,0,1,0.05,-0.95
33.690068,0.18,0.62,1.38675049,0.2773501,0.03605551,-3.56949576
45,0.16,0.6,0.70710678,0.70710678,0.02828427,-1.38592929
53.130102,0.13,0.56,3.6,0.2,0.05,-4.95
56.309932,0.09,0.5,2.21880078,0.2773501,0.07211103,-3.53344025
51.340192,0.05,0.45,4.99756038,0.15617376,0.06403124,-6.339093
38.659808,0,0.41,1.40556386,0.15617376,0.06403124,-6.339093
321.340192,0.73,0.42,4.99756038,0.15617376,0.06403124,-6.339093
300.963757,0.7,0.47,3.60147029,0.17149859,0.05830952,-5.77264238
21.801409,0.65,0.45,2.22834406,0.18569534,0.05385165,-5.33131316
284.036243,0.64,0.49,3.15296313,0.24253563,0.04123106,-4.08187457
180,0.7,0.49,0,1,0.06,-0.94
261.869898,0.71,0.56,0.98994949,0.14142136,0.07071068,-7.00035713
248.198591,0.73,0.61,3.15682075,0.18569534,0.05385165,-5.33131316
225,0.77,0.65,0.70710678,0.70710678,0.05656854,-1.35764502
284.036243,0.77,0.88,3.15296313,0.24253563,0.04123106,-4.08187457
0,0.2,0.76,0,1,0.06,-0.94
104.036243,0.21,0.72,3.15296313,0.24253563,0.04123106,-4.08187457
201.801409,0.26,0.74,2.22834406,0.18569534,0.05385165,-5.33131316
123.690068,0.3,0.68,1.38675049,0.2773501,0.07211103,-3.53344025
153.434949,0.36,0.65,0.89442719,0.4472136,0.06708204,-2.16898594
170.537678,0.42,0.64,0.98639392,0.16439899,0.06082763,-6.0219349
188.130102,0.49,0.65,6.08111832,0.14142136,0.07071068,-7.00035713
201.801409,0.54,0.67,2.22834406,0.18569534,0.05385165,-5.33131316
219.805571,0.6,0.72,1.40840568,0.12803688,0.0781025,-7.73214718
230.194429,0.65,0.78,6.401844,0.12803688,0.0781025,-7.73214718
239.036243,0.68,0.83,2.22948161,0.17149859,0.05830952,-5.77264238
236.309932,0.72,0.89,2.21880078,0.2773501,0.07211103,-3.53344025
213.690068,0.75,0.91,1.38675049,0.2773501,0.03605551,-3.56949576
198.434949,0.78,0.92,2.21359436,0.31622777,0.03162278,-3.13065488
0,0.74,0.92,0,1,0.04,-0.96
345.963757,0.7,0.93,0.9701425,0.24253563,0.04123106,-4.08187457
338.198591,0.65,0.95,3.15682075,0.18569534,0.05385165,-5.33131316
45,0.29,0.89,0.70710678,0.70710678,0.07071068,-1.34350288
71.565051,0.27,0.83,0.9486833,0.31622777,0.06324555,-3.09903211
81.869898,0.26,0.76,0.98994949,0.14142136,0.07071068,-7.00035713
;0,0.2,0.76,0,1,0.06,-0.94
53.130102,0.19,0.86,3.6,0.2,0.05,-4.95
45,0.14,0.81,0.70710678,0.70710678,0.07071068,-1.34350288
36.869898,0.1,0.78,1.4,0.2,0.05,-4.95
18.434949,0.04,0.76,2.21359436,0.31622777,0.06324555,-3.09903211
0,0,0.76,0,1,0.04,-0.96
0,0.96,0.76,0,1,0.04,-0.96
345.963757,0.92,0.77,0.9701425,0.24253563,0.04123106,-4.08187457
333.434949,0.88,0.79,0.89442719,0.4472136,0.04472136,-2.19134662
315,0.86,0.81,0.70710678,0.70710678,0.02828427,-1.38592929
306.869898,0.83,0.85,1.4,0.2,0.05,-4.95
11.309932,0.78,0.84,4.11843884,0.19611614,0.0509902,-5.04802932
180,0.83,0.88,0,1,0.06,-0.94
261.869898,0.84,0.95,0.98994949,0.14142136,0.07071068,-7.00035713
248.198591,0.86,1,3.15682075,0.18569534,0.05385165,-5.33131316
333.434949,0.59,0.98,0.89442719,0.4472136,0.06708204,-2.16898594
348.690068,0.54,0.99,0.98058068,0.19611614,0.0509902,-5.04802932
0,0.46,0.99,0,1,0.08,-0.92
18.434949,0.4,0.97,2.21359436,0.31622777,0.06324555,-3.09903211
26.565051,0.34,0.94,1.34164079,0.4472136,0.06708204,-2.16898594
45,0.28,0.99,0.70710678,0.70710678,0.01414214,-1.40007143
56.309932,0.26,0.96,2.21880078,0.2773501,0.03605551,-3.56949576
56.309932,0.22,0.9,2.21880078,0.2773501,0.07211103,-3.53344025
53.130102,0.97,0.16,3.6,0.2,0.05,-4.95
38.659808,0.92,0.12,1.40556386,0.15617376,0.06403124,-6.339093
9.462322,0.86,0.11,5.09636861,0.16439899,0.06082763,-6.0219349
345.963757,0.82,0.12,0.9701425,0.24253563,0.04123106,-4.08187457
326.309932,0.79,0.14,2.21880078,0.2773501,0.03605551,-3.56949576
225,0.82,0.29,0.70710678,0.70710678,0.04242641,-1.37178716
213.690068,0.85,0.31,1.38675049,0.2773501,0.03605551,-3.56949576
191.309932,0.9,0.32,4.11843884,0.19611614,0.0509902,-5.04802932
180,0.95,0.32,0,1,0.05,-0.95
158.198591,1,0.3,3.15682075,0.18569534,0.05385165,-5.33131316
233.130102,0.89,0.04,3.6,0.2,0.05,-4.95
216.869898,0.93,0.07,1.4,0.2,0.05,-4.95
206.565051,0.97,0.09,1.34164079,0.4472136,0.04472136,-2.19134662
198.434949,1,0.1,2.21359436,0.31622777,0.03162278,-3.13065488
30.963757,0.95,0.38,3.60147029,0.17149859,0.05830952,-5.77264238
14.036243,0.91,0.37,3.15296313,0.24253563,0.04123106,-4.08187457
0,0.83,0.37,0,1,0.08,-0.92
348.690068,0.78,0.38,0.98058068,0.19611614,0.0509902,-5.04802932
216.869898,0.81,0.68,1.4,0.2,0.05,-4.95
198.434949,0.9,0.71,2.21359436,0.31622777,0.09486833,-3.06740933
180,1,0.71,0,1,0.1,-0.9
`),!1);ie(ee.ParsePatFile(`
*LEAF-03,LEAF-03
;By John Hyslop,    Using AutoCAD Lisp Tool
;Developed in inch as imperial QCAD3 pattern
344.054604,0.86,0.38,4.12081692,0.13736056,0.0728011,-7.20730879
338.198591,0.81,0.4,3.15682075,0.18569534,0.05385165,-5.33131316
326.309932,0.75,0.44,2.21880078,0.2773501,0.07211103,-3.53344025
320.194429,0.69,0.49,6.401844,0.12803688,0.0781025,-7.73214718
308.659808,0.65,0.54,1.40556386,0.15617376,0.06403124,-6.339093
300.963757,0.62,0.59,3.60147029,0.17149859,0.05830952,-5.77264238
293.198591,0.59,0.66,2.23220936,0.13130643,0.07615773,-7.53961537
281.309932,0.58,0.71,4.11843884,0.19611614,0.0509902,-5.04802932
276.340192,0.57,0.8,8.0615014,0.11043153,0.09055385,-8.96483129
270,0.57,0.85,0,1,0.05,-0.95
257.471192,0.59,0.94,5.09786576,0.10846523,0.09219544,-9.12734901
164.054604,0.66,0.92,4.12081692,0.13736056,0.0728011,-7.20730879
158.198591,0.71,0.9,3.15682075,0.18569534,0.05385165,-5.33131316
146.309932,0.77,0.86,2.21880078,0.2773501,0.07211103,-3.53344025
140.194429,0.83,0.81,6.401844,0.12803688,0.0781025,-7.73214718
125.537678,0.88,0.74,4.99864847,0.11624764,0.08602325,-8.51630201
116.565051,0.92,0.66,1.34164079,0.4472136,0.08944272,-2.14662526
105.945396,0.94,0.59,3.15929297,0.13736056,0.0728011,-7.20730879
97.125016,0.95,0.51,7.06997987,0.12403473,0.08062258,-7.98163517
90,0.95,0.45,0,1,0.06,-0.94
77.471192,0.93,0.36,5.09786576,0.10846523,0.09219544,-9.12734901
195.945396,0.14,0.38,3.15929297,0.13736056,0.0728011,-7.20730879
201.801409,0.19,0.4,2.22834406,0.18569534,0.05385165,-5.33131316
213.690068,0.25,0.44,1.38675049,0.2773501,0.07211103,-3.53344025
219.805571,0.31,0.49,1.40840568,0.12803688,0.0781025,-7.73214718
231.340192,0.35,0.54,4.99756038,0.15617376,0.06403124,-6.339093
239.036243,0.38,0.59,2.22948161,0.17149859,0.05830952,-5.77264238
246.801409,0.41,0.66,5.38356375,0.13130643,0.07615773,-7.53961537
258.690068,0.42,0.71,0.98058068,0.19611614,0.0509902,-5.04802932
263.659808,0.43,0.8,0.99388373,0.11043153,0.09055385,-8.96483129
270,0.43,0.85,0,1,0.05,-0.95
282.528808,0.41,0.94,4.1216787,0.10846523,0.09219544,-9.12734901
15.945396,0.34,0.92,3.15929297,0.13736056,0.0728011,-7.20730879
21.801409,0.29,0.9,2.22834406,0.18569534,0.05385165,-5.33131316
33.690068,0.23,0.86,1.38675049,0.2773501,0.07211103,-3.53344025
39.805571,0.17,0.81,1.40840568,0.12803688,0.0781025,-7.73214718
54.462322,0.12,0.74,3.6036768,0.11624764,0.08602325,-8.51630201
63.434949,0.08,0.66,0.89442719,0.4472136,0.08944272,-2.14662526
74.054604,0.06,0.59,4.12081692,0.13736056,0.0728011,-7.20730879
82.874984,0.05,0.51,0.99227788,0.12403473,0.08062258,-7.98163517
90,0.05,0.45,0,1,0.06,-0.94
102.528808,0.07,0.36,4.1216787,0.10846523,0.09219544,-9.12734901
128.659808,0.21,0.15,1.40556386,0.15617376,0.06403124,-6.339093
146.309932,0.27,0.11,2.21880078,0.2773501,0.07211103,-3.53344025
153.434949,0.33,0.08,0.89442719,0.4472136,0.06708204,-2.16898594
164.054604,0.4,0.06,4.12081692,0.13736056,0.0728011,-7.20730879
171.869898,0.47,0.05,0.98994949,0.14142136,0.07071068,-7.00035713
180,0.53,0.05,0,1,0.06,-0.94
188.130102,0.6,0.06,6.08111832,0.14142136,0.07071068,-7.00035713
195.945396,0.67,0.08,3.15929297,0.13736056,0.0728011,-7.20730879
206.565051,0.73,0.11,1.34164079,0.4472136,0.06708204,-2.16898594
218.659808,0.78,0.15,1.40556386,0.15617376,0.06403124,-6.339093
225,0.83,0.2,0.70710678,0.70710678,0.07071068,-1.34350288
315,0.78,0.25,0.70710678,0.70710678,0.07071068,-1.34350288
321.340192,0.73,0.29,4.99756038,0.15617376,0.06403124,-6.339093
336.801409,0.66,0.32,5.38356375,0.13130643,0.07615773,-7.53961537
341.565051,0.6,0.34,0.9486833,0.31622777,0.06324555,-3.09903211
351.869898,0.53,0.35,0.98994949,0.14142136,0.07071068,-7.00035713
0,0.47,0.35,0,1,0.06,-0.94
8.130102,0.4,0.34,6.08111832,0.14142136,0.07071068,-7.00035713
18.434949,0.34,0.32,2.21359436,0.31622777,0.06324555,-3.09903211
23.198591,0.27,0.29,2.23220936,0.13130643,0.07615773,-7.53961537
38.659808,0.22,0.25,1.40556386,0.15617376,0.06403124,-6.339093
45,0.17,0.2,0.70710678,0.70710678,0.07071068,-1.34350288
`),!1);ie(ee.ParsePatFile(`
*LINE,LINE
0, 0,0, 0,.125
`),!1);ie(ee.ParsePatFile(`
*LOOPLINKS,LOOPLINKS
;By John Hyslop,    Using AutoCAD Lisp Tool
;Developed in inch as imperial QCAD3 pattern
206.565051,0.53,0.67,1.34164079,0.4472136,0.02236068,-2.2137073
243.434949,0.54,0.69,0.89442719,0.4472136,0.02236068,-2.2137073
116.565051,0.47,0.67,1.34164079,0.4472136,0.02236068,-2.2137073
153.434949,0.49,0.66,0.89442719,0.4472136,0.02236068,-2.2137073
180,0.51,0.66,0,1,0.02,-0.98
258.690068,0.19,0.59,0.98058068,0.19611614,0.0509902,-5.04802932
251.565051,0.2,0.62,0.9486833,0.31622777,0.03162278,-3.13065488
243.434949,0.22,0.66,0.89442719,0.4472136,0.04472136,-2.19134662
230.194429,0.27,0.72,6.401844,0.12803688,0.0781025,-7.73214718
225,0.31,0.76,0.70710678,0.70710678,0.05656854,-1.35764502
209.744881,0.38,0.8,5.82963253,0.12403473,0.08062258,-7.98163517
194.036243,0.46,0.82,3.15296313,0.24253563,0.08246211,-4.04064351
251.565051,0.28,0.6,0.9486833,0.31622777,0.06324555,-3.09903211
239.036243,0.31,0.65,2.22948161,0.17149859,0.05830952,-5.77264238
225,0.35,0.69,0.70710678,0.70710678,0.05656854,-1.35764502
210.963757,0.4,0.72,3.60147029,0.17149859,0.05830952,-5.77264238
198.434949,0.46,0.74,2.21359436,0.31622777,0.06324555,-3.09903211
116.565051,0.67,0.47,1.34164079,0.4472136,0.02236068,-2.2137073
153.434949,0.69,0.46,0.89442719,0.4472136,0.02236068,-2.2137073
26.565051,0.67,0.53,1.34164079,0.4472136,0.02236068,-2.2137073
63.434949,0.66,0.51,0.89442719,0.4472136,0.02236068,-2.2137073
90,0.66,0.49,0,1,0.02,-0.98
168.690068,0.59,0.81,0.98058068,0.19611614,0.0509902,-5.04802932
161.565051,0.62,0.8,0.9486833,0.31622777,0.03162278,-3.13065488
153.434949,0.66,0.78,0.89442719,0.4472136,0.04472136,-2.19134662
140.194429,0.72,0.73,6.401844,0.12803688,0.0781025,-7.73214718
135,0.76,0.69,0.70710678,0.70710678,0.05656854,-1.35764502
119.744881,0.8,0.62,5.82963253,0.12403473,0.08062258,-7.98163517
104.036243,0.82,0.54,3.15296313,0.24253563,0.08246211,-4.04064351
161.565051,0.6,0.72,0.9486833,0.31622777,0.06324555,-3.09903211
149.036243,0.65,0.69,2.22948161,0.17149859,0.05830952,-5.77264238
135,0.69,0.65,0.70710678,0.70710678,0.05656854,-1.35764502
120.963757,0.72,0.6,3.60147029,0.17149859,0.05830952,-5.77264238
108.434949,0.74,0.54,2.21359436,0.31622777,0.06324555,-3.09903211
26.565051,0.47,0.33,1.34164079,0.4472136,0.02236068,-2.2137073
63.434949,0.46,0.31,0.89442719,0.4472136,0.02236068,-2.2137073
296.565051,0.53,0.33,1.34164079,0.4472136,0.02236068,-2.2137073
333.434949,0.51,0.34,0.89442719,0.4472136,0.02236068,-2.2137073
0,0.49,0.34,0,1,0.02,-0.98
78.690068,0.81,0.41,0.98058068,0.19611614,0.0509902,-5.04802932
71.565051,0.8,0.38,0.9486833,0.31622777,0.03162278,-3.13065488
63.434949,0.78,0.34,0.89442719,0.4472136,0.04472136,-2.19134662
50.194429,0.73,0.28,6.401844,0.12803688,0.0781025,-7.73214718
45,0.69,0.24,0.70710678,0.70710678,0.05656854,-1.35764502
29.744881,0.62,0.2,5.82963253,0.12403473,0.08062258,-7.98163517
14.036243,0.54,0.18,3.15296313,0.24253563,0.08246211,-4.04064351
71.565051,0.72,0.4,0.9486833,0.31622777,0.06324555,-3.09903211
59.036243,0.69,0.35,2.22948161,0.17149859,0.05830952,-5.77264238
45,0.65,0.31,0.70710678,0.70710678,0.05656854,-1.35764502
30.963757,0.6,0.28,3.60147029,0.17149859,0.05830952,-5.77264238
18.434949,0.54,0.26,2.21359436,0.31622777,0.06324555,-3.09903211
296.565051,0.33,0.53,1.34164079,0.4472136,0.02236068,-2.2137073
333.434949,0.31,0.54,0.89442719,0.4472136,0.02236068,-2.2137073
206.565051,0.33,0.47,1.34164079,0.4472136,0.02236068,-2.2137073
243.434949,0.34,0.49,0.89442719,0.4472136,0.02236068,-2.2137073
270,0.34,0.51,0,1,0.02,-0.98
348.690068,0.41,0.19,0.98058068,0.19611614,0.0509902,-5.04802932
341.565051,0.38,0.2,0.9486833,0.31622777,0.03162278,-3.13065488
333.434949,0.34,0.22,0.89442719,0.4472136,0.04472136,-2.19134662
320.194429,0.28,0.27,6.401844,0.12803688,0.0781025,-7.73214718
315,0.24,0.31,0.70710678,0.70710678,0.05656854,-1.35764502
299.744881,0.2,0.38,5.82963253,0.12403473,0.08062258,-7.98163517
284.036243,0.18,0.46,3.15296313,0.24253563,0.08246211,-4.04064351
341.565051,0.4,0.28,0.9486833,0.31622777,0.06324555,-3.09903211
329.036243,0.35,0.31,2.22948161,0.17149859,0.05830952,-5.77264238
315,0.31,0.35,0.70710678,0.70710678,0.05656854,-1.35764502
300.963757,0.28,0.4,3.60147029,0.17149859,0.05830952,-5.77264238
288.434949,0.26,0.46,2.21359436,0.31622777,0.06324555,-3.09903211
90,0.46,-0.31,0,1,0.62,-0.38
270,0.54,0.31,0,1,0.62,-0.38
180,0.31,0.46,0,1,0.62,-0.38
0,-0.31,0.54,0,1,0.62,-0.38
`),!1);ie(ee.ParsePatFile(`
*MAZE-01,MAZE-01 verbose
;By John Hyslop,    Tile2Hatch tool \xA9 CVH 2020
;Developed in inch as imperial QCAD3 pattern
180,0.95,0.92,0,1,0.25,-0.75
90,0.95,0.55,1,1,0.37,-0.63
90,0.83,0.55,1,1,0.25,-0.75
0,0.7,0.42,0,1,0.11,-0.89
180,0.57,0.8,0,1,0.38,-0.62
270,0.57,0.92,1,1,0.12,-0.88
0,0.07,0.92,0,1,0.5,-0.5
90,0.95,0.29,1,1,0.13,-0.87
180,0.45,0.05,0,1,0.38,-0.62
0,0.7,0.29,0,1,0.25,-0.75
270,0.45,0.17,1,1,0.12,-0.88
0,0.19,0.17,0,1,0.26,-0.74
90,0.7,0.17,1,1,0.12,-0.88
270,0.19,0.8,1,1,0.63,-0.37
0,0.31,0.29,0,1,0.26,-0.74
270,0.31,0.68,1,1,0.39,-0.61
180,0.7,0.68,0,1,0.39,-0.61
270,0.7,0.92,1,1,0.24,-0.76
180,0.95,0.17,0,1,0.25,-0.75
90,0.95,0.05,1,1,0.12,-0.88
0,0.57,0.05,0,1,0.38,-0.62
270,0.57,0.42,1,1,0.37,-0.63
270,0.7,0.55,1,1,0.13,-0.87
0,0.45,0.55,0,1,0.25,-0.75
90,0.45,0.42,1,1,0.13,-0.87
90,0.07,0.05,1,1,0.87,-0.13
`),!1);ie(ee.ParsePatFile(`
*MAZE-02,MAZE-02 verbose
;By John Hyslop,    Tile2Hatch tool \xA9 CVH 2020
;Developed in inch as imperial QCAD3 pattern
270,0.89999999,0.1,1,1,0.1,-0.9
0,0.69999999,0.1,0,1,0.2,-0.8
90,0,0.3,1,1,0.5,-0.5
270,0.89999999,0.9,1,1,0.5,-0.5
270,0.29999999,0.9,1,1,0.1,-0.9
180,0.29999999,0.9,0,1,0.4,-0.6
0,0.19999999,0.2,0,1,0.15,-0.85
90,0.19999999,0.3,1,1,0.2,-0.8
180,0.49999999,0.3,0,1,0.3,-0.7
90,0.49999999,0.1,1,1,0.2,-0.8
270,0.69999999,0.2,1,1,0.1,-0.9
0,0.59999999,0.2,0,1,0.1,-0.9
270,0.59999999,0.3,1,1,0.1,-0.9
180,0.69999999,0.3,0,1,0.1,-0.9
270,0.59999999,0.6,1,1,0.1,-0.9
0,0.29999999,0.6,0,1,0.3,-0.7
90,0.29999999,0.4,1,1,0.2,-0.8
180,0.69999999,0.4,0,1,0.4,-0.6
180,0.59999999,0.5,0,1,0.2,-0.8
270,0.79999999,0.8,1,1,0.5,-0.5
0,0.09999999,0.1,0,1,0.4,-0.6
0,0.09999999,0.8,0,1,0.7,-0.3
270,0.09999999,0.2,1,1,0.1,-0.9
90,0.09999999,0.3,1,1,0.5,-0.5
180,0.09999999,0.2,0,1,0.3,-0.7
180,0,0.3,0,1,0.20000001,-0.79999999
180,0.29999999,0,0,1,0.3,-0.7
270,0.69999999,0.7,1,1,0.2,-0.8
0,0.39999999,0,0,1,0.4,-0.6
0,0.19999999,0.7,0,1,0.5,-0.5
90,0.19999999,0.6,1,1,0.1,-0.9
270,0.59999999,0.1,1,1,0.1,-0.9
0,0.39999999,0.9,0,1,0.4,-0.6
270,0.39999999,1,1,1,0.1,-0.9
`),!1);ie(ee.ParsePatFile(`
*MUDST,MUDST
0, 0,0, .5,.25, .25,-.25,0,-.25,0,-.25
`),!1);ie(ee.ParsePatFile(`
*NET3,NET3
0, 0,0, 0,.125
60, 0,0, 0,.125
120, 0,0, 0,.125
`),!1);ie(ee.ParsePatFile(`
*NET,NET
0, 0,0, 0,.125
90, 0,0, 0,.125
`),!1);ie(ee.ParsePatFile(`
*PLASTI,PLASTI
0, 0,0, 0,.25
0, 0,.03125, 0,.25
0, 0,.0625, 0,.25
0, 0,.15625, 0,.25
`),!1);ie(ee.ParsePatFile(`
*PLAST,PLAST
0, 0,0, 0,.25
0, 0,.03125, 0,.25
0, 0,.0625, 0,.25
`),!1);ie(ee.ParsePatFile(`
*QCAD-LOGO,QCAD-LOGO
;By John Hyslop, Line 101 modified by CVH to fix left side of pencil drift when hatching far from Origin
;Developed in inch as imperial QCAD3 pattern
243.434949,0.8,0.36,0.89442719,0.4472136,0.02236068,-2.2137073
248.198591,0.82,0.41,3.15682075,0.18569534,0.05385165,-5.33131316
263.659808,0.83,0.5,0.99388373,0.11043153,0.09055385,-8.96483129
276.340192,0.82,0.59,8.0615014,0.11043153,0.09055385,-8.96483129
290.556045,0.79,0.67,5.38389277,0.11704115,0.08544004,-8.45856371
310.601295,0.73,0.74,1.41004798,0.10846523,0.09219544,-9.12734901
324.462322,0.66,0.79,3.6036768,0.11624764,0.08602325,-8.51630201
336.801409,0.59,0.82,5.38356375,0.13130643,0.07615773,-7.53961537
351.869898,0.52,0.83,0.98994949,0.14142136,0.07071068,-7.00035713
26.565051,0.61,0.18,1.34164079,0.4472136,0.06708204,-2.16898594
7.125016,0.53,0.17,7.06997987,0.12403473,0.08062258,-7.98163517
0,0.45,0.17,0,1,0.08,-0.92
344.054604,0.38,0.19,4.12081692,0.13736056,0.0728011,-7.20730879
336.801409,0.31,0.22,5.38356375,0.13130643,0.07615773,-7.53961537
320.194429,0.25,0.27,6.401844,0.12803688,0.0781025,-7.73214718
308.659808,0.21,0.32,1.40556386,0.15617376,0.06403124,-6.339093
293.198591,0.18,0.39,2.23220936,0.13130643,0.07615773,-7.53961537
285.945396,0.16,0.46,3.15929297,0.13736056,0.0728011,-7.20730879
270,0.16,0.52,0,1,0.06,-0.94
261.869898,0.17,0.59,0.98994949,0.14142136,0.07071068,-7.00035713
246.801409,0.2,0.66,5.38356375,0.13130643,0.07615773,-7.53961537
234.462322,0.25,0.73,3.6036768,0.11624764,0.08602325,-8.51630201
219.805571,0.31,0.78,1.40840568,0.12803688,0.0781025,-7.73214718
206.565051,0.37,0.81,1.34164079,0.4472136,0.06708204,-2.16898594
195.945396,0.44,0.83,3.15929297,0.13736056,0.0728011,-7.20730879
180,0.48,0.83,0,1,0.04,-0.96
180,0.52,0.83,0,1,0.04,-0.96
233.130102,0.92,0.27,3.6,0.2,0.05,-4.95
248.198591,0.94,0.32,3.15682075,0.18569534,0.05385165,-5.33131316
248.198591,0.96,0.37,3.15682075,0.18569534,0.05385165,-5.33131316
260.537678,0.97,0.43,0.98639392,0.16439899,0.06082763,-6.0219349
261.869898,0.98,0.5,0.98994949,0.14142136,0.07071068,-7.00035713
278.130102,0.97,0.57,6.08111832,0.14142136,0.07071068,-7.00035713
279.462322,0.96,0.63,5.09636861,0.16439899,0.06082763,-6.0219349
288.434949,0.94,0.69,2.21359436,0.31622777,0.06324555,-3.09903211
299.744881,0.9,0.76,5.82963253,0.12403473,0.08062258,-7.98163517
308.659808,0.86,0.81,1.40556386,0.15617376,0.06403124,-6.339093
315,0.81,0.86,0.70710678,0.70710678,0.07071068,-1.34350288
321.340192,0.76,0.9,4.99756038,0.15617376,0.06403124,-6.339093
329.036243,0.71,0.93,2.22948161,0.17149859,0.05830952,-5.77264238
338.198591,0.66,0.95,3.15682075,0.18569534,0.05385165,-5.33131316
338.198591,0.61,0.97,3.15682075,0.18569534,0.05385165,-5.33131316
350.537678,0.55,0.98,0.98639392,0.16439899,0.06082763,-6.0219349
0,0.5,0.98,0,1,0.05,-0.95
0,0.45,0.98,0,1,0.05,-0.95
11.309932,0.4,0.97,4.11843884,0.19611614,0.0509902,-5.04802932
14.036243,0.36,0.96,3.15296313,0.24253563,0.04123106,-4.08187457
21.801409,0.31,0.94,2.22834406,0.18569534,0.05385165,-5.33131316
21.801409,0.26,0.92,2.22834406,0.18569534,0.05385165,-5.33131316
36.869898,0.22,0.89,1.4,0.2,0.05,-4.95
36.869898,0.18,0.86,1.4,0.2,0.05,-4.95
33.690068,0.75,0.09,1.38675049,0.2773501,0.03605551,-3.56949576
26.565051,0.69,0.06,1.34164079,0.4472136,0.06708204,-2.16898594
21.801409,0.64,0.04,2.22834406,0.18569534,0.05385165,-5.33131316
11.309932,0.59,0.03,4.11843884,0.19611614,0.0509902,-5.04802932
8.130102,0.52,0.02,6.08111832,0.14142136,0.07071068,-7.00035713
0,0.46,0.02,0,1,0.06,-0.94
350.537678,0.4,0.03,0.98639392,0.16439899,0.06082763,-6.0219349
348.690068,0.35,0.04,0.98058068,0.19611614,0.0509902,-5.04802932
338.198591,0.3,0.06,3.15682075,0.18569534,0.05385165,-5.33131316
333.434949,0.26,0.08,0.89442719,0.4472136,0.04472136,-2.19134662
323.130102,0.22,0.11,3.6,0.2,0.05,-4.95
323.130102,0.18,0.14,3.6,0.2,0.05,-4.95
315,0.14,0.18,0.70710678,0.70710678,0.05656854,-1.35764502
306.869898,0.11,0.22,1.4,0.2,0.05,-4.95
306.869898,0.08,0.26,1.4,0.2,0.05,-4.95
296.565051,0.06,0.3,1.34164079,0.4472136,0.04472136,-2.19134662
291.801409,0.04,0.35,2.22834406,0.18569534,0.05385165,-5.33131316
281.309932,0.03,0.4,4.11843884,0.19611614,0.0509902,-5.04802932
281.309932,0.02,0.45,4.11843884,0.19611614,0.0509902,-5.04802932
270,0.02,0.5,0,1,0.05,-0.95
270,0.02,0.55,0,1,0.05,-0.95
258.690068,0.03,0.6,0.98058068,0.19611614,0.0509902,-5.04802932
258.690068,0.04,0.65,0.98058068,0.19611614,0.0509902,-5.04802932
248.198591,0.06,0.7,3.15682075,0.18569534,0.05385165,-5.33131316
243.434949,0.08,0.74,0.89442719,0.4472136,0.04472136,-2.19134662
233.130102,0.11,0.78,3.6,0.2,0.05,-4.95
233.130102,0.14,0.82,3.6,0.2,0.05,-4.95
225,0.18,0.86,0.70710678,0.70710678,0.05656854,-1.35764502
0,0.35,0.21,0,1,0.29,-0.71
180,0.56,0.39,0,1,0.04,-0.96
270,0.56,0.44,0,1,0.05,-0.95
180,0.62,0.44,0,1,0.06,-0.94
270,0.62,0.48,0,1,0.04,-0.96
270,0.98,0.11,0,1,0.01,-0.99
270,0.98,0.13,0,1,0.02,-0.98
45,0.82,0.08,0.70710678,0.70710678,0.14142136,-1.27279221
225,0.9,0.2,0.70710678,0.70710678,0.14142136,-1.27279221
45,0.79,0.11,0.70710678,0.70710678,0.14142136,-1.27279221
0,0.544133,0.559775,0,1,0,-1
0,0.590298,0.634752,0,1,0,-1
0,0.640323,0.720624,0,1,0,-1
135,0.98,0.13,0.70710678,0.70710678,0.49497475,-0.91923882
56.309932,0.96,0.07,2.21880078,0.2773501,0.03605551,-3.56949576
45,0.94,0.05,0.70710678,0.70710678,0.02828427,-1.38592929
33.690068,0.91,0.03,1.38675049,0.2773501,0.03605551,-3.56949576
18.434949,0.88,0.02,2.21359436,0.31622777,0.03162278,-3.13065488
135.806929,0.88,0.02,-1.41407331,0.01991653,0.50209561,-49.70746523
289.983107,0.48,0.48,8.54357658,0.08543577,0.117047,-11.58765291
338.198591,0.53,0.52,3.15682075,0.18569534,0.1077033,-5.27746151
105.945396,0.48,0.48,3.15929297,0.13736056,0.0728011,-7.20730879
218.659808,0.53,0.52,1.40556386,0.15617376,0.06403124,-6.339093
336.801409,0.46,0.55,5.38356375,0.13130643,0.07615773,-7.53961537
56.309932,0.66,0.755,2.21880078,0.2773501,0.01802776,-3.58752352
239.036243,0.475,0.435,2.22948161,0.17149859,0.02915476,-5.80179714
236.309932,0.57,0.6,2.21880078,0.2773501,0.01802776,-3.58752352
236.309932,0.62,0.68,2.21880078,0.2773501,0.01802776,-3.58752352
0,0.46,0.41,0,1,0,-1
0,0.49,0.34,0,1,0.02,-0.98
0,0.54,0.34,0,1,0,-1
0,0.45,0.34,0,1,0,-1
0,0.36,0.34,0,1,0,-1
0,0.27,0.34,0,1,0,-1
180,0.24,0.34,0,1,0.03,-0.97
180,0.33,0.34,0,1,0.03,-0.97
180,0.42,0.34,0,1,0.03,-0.97
239.036243,0.45,0.39,2.22948161,0.17149859,0.05830952,-5.77264238
0,0.44,0.44,0,1,0.05,-0.95
341.565051,0.41,0.45,0.9486833,0.31622777,0.03162278,-3.13065488
315,0.39,0.47,0.70710678,0.70710678,0.02828427,-1.38592929
296.565051,0.38,0.49,1.34164079,0.4472136,0.02236068,-2.2137073
180,0.38,0.49,0,1,0.21,-0.79
240.068488,0.57,0.82,8.06221498,0.02626129,0.38078866,-37.69807687
0,0.63,0.49,0,1,0.18,-0.82
240.255119,0.75,0.7,2.23262522,0.12403473,0.24186773,-7.82039002
`),!1);ie(ee.ParsePatFile(`
*REDBACK,REDBACK
;By John Hyslop
;Developed in inch as imperial QCAD3 pattern
63.434949,0.73,0.78,0.89442719,0.4472136,0.02236068,-2.2137073
33.690068,0.7,0.76,1.38675049,0.2773501,0.03605551,-3.56949576
75.963757,0.69,0.72,0.9701425,0.24253563,0.04123106,-4.08187457
0,0.66,0.72,0,1,0.03,-0.97
108.434949,0.67,0.69,2.21359436,0.31622777,0.03162278,-3.13065488
90,0.67,0.68,0,1,0.01,-0.99
0,0.54,0.57,0,1,0.01,-0.99
270,0.54,0.58,0,1,0.01,-0.99
225,0.55,0.59,0.70710678,0.70710678,0.01414214,-1.40007143
180,0.56,0.59,0,1,0.01,-0.99
315,0.55,0.6,0.70710678,0.70710678,0.01414214,-1.40007143
15.524111,0.37,0.55,7.27991309,0.05352877,0.18681542,-18.49472628
0,0.35,0.55,0,1,0.02,-0.98
45,0.34,0.54,0.70710678,0.70710678,0.01414214,-1.40007143
0,0.31,0.54,0,1,0.03,-0.97
26.565051,0.19,0.48,1.34164079,0.4472136,0.13416408,-2.1019039
0,0.18,0.48,0,1,0.01,-0.99
33.690068,0.15,0.46,1.38675049,0.2773501,0.03605551,-3.56949576
32.005383,0.07,0.41,3.60399279,0.10599979,0.09433981,-9.33964132
45,0.06,0.4,0.70710678,0.70710678,0.01414214,-1.40007143
270,0.06,0.41,0,1,0.01,-0.99
225,0.07,0.42,0.70710678,0.70710678,0.01414214,-1.40007143
213.690068,0.16,0.48,1.38675049,0.2773501,0.10816654,-3.49738474
243.434949,0.17,0.5,0.89442719,0.4472136,0.02236068,-2.2137073
205.016893,0.32,0.57,2.23525175,0.06041221,0.16552945,-16.3874159
189.462322,0.38,0.58,5.09636861,0.16439899,0.06082763,-6.0219349
194.036243,0.42,0.59,3.15296313,0.24253563,0.04123106,-4.08187457
194.036243,0.5,0.61,3.15296313,0.24253563,0.08246211,-4.04064351
198.434949,0.56,0.63,2.21359436,0.31622777,0.06324555,-3.09903211
6.340192,0.47,0.62,8.0615014,0.11043153,0.09055385,-8.96483129
315,0.46,0.63,0.70710678,0.70710678,0.01414214,-1.40007143
45,0.45,0.62,0.70710678,0.70710678,0.01414214,-1.40007143
23.198591,0.38,0.59,2.23220936,0.13130643,0.07615773,-7.53961537
0,0.35,0.59,0,1,0.03,-0.97
45,0.32,0.56,0.70710678,0.70710678,0.04242641,-1.37178716
236.309932,0.34,0.59,2.21880078,0.2773501,0.03605551,-3.56949576
206.565051,0.36,0.6,1.34164079,0.4472136,0.02236068,-2.2137073
206.565051,0.42,0.63,1.34164079,0.4472136,0.06708204,-2.16898594
206.565051,0.44,0.64,1.34164079,0.4472136,0.02236068,-2.2137073
206.565051,0.46,0.65,1.34164079,0.4472136,0.02236068,-2.2137073
180,0.57,0.65,0,1,0.11,-0.89
225,0.58,0.66,0.70710678,0.70710678,0.01414214,-1.40007143
321.340192,0.53,0.7,4.99756038,0.15617376,0.06403124,-6.339093
296.565051,0.52,0.72,1.34164079,0.4472136,0.02236068,-2.2137073
285.945396,0.5,0.79,3.15929297,0.13736056,0.0728011,-7.20730879
254.054604,0.52,0.86,4.12081692,0.13736056,0.0728011,-7.20730879
135,0.53,0.85,0.70710678,0.70710678,0.01414214,-1.40007143
90,0.53,0.82,0,1,0.03,-0.97
71.565051,0.52,0.79,0.9486833,0.31622777,0.03162278,-3.13065488
105.945396,0.54,0.72,3.15929297,0.13736056,0.0728011,-7.20730879
135,0.58,0.68,0.70710678,0.70710678,0.05656854,-1.35764502
180,0.59,0.68,0,1,0.01,-0.99
270,0.59,0.69,0,1,0.01,-0.99
270,0.59,0.71,0,1,0.02,-0.98
296.565051,0.58,0.73,1.34164079,0.4472136,0.02236068,-2.2137073
278.130102,0.57,0.8,6.08111832,0.14142136,0.07071068,-7.00035713
251.565051,0.58,0.83,0.9486833,0.31622777,0.03162278,-3.13065488
225,0.59,0.84,0.70710678,0.70710678,0.01414214,-1.40007143
225,0.6,0.85,0.70710678,0.70710678,0.01414214,-1.40007143
243.434949,0.61,0.87,0.89442719,0.4472136,0.02236068,-2.2137073
243.434949,0.63,0.91,0.89442719,0.4472136,0.04472136,-2.19134662
243.434949,0.65,0.95,0.89442719,0.4472136,0.04472136,-2.19134662
225,0.66,0.96,0.70710678,0.70710678,0.01414214,-1.40007143
168.690068,0.81,0.93,0.98058068,0.19611614,0.15297059,-4.94604893
355.601295,0.68,0.94,0.99705449,0.0766965,0.13038405,-12.90802076
56.309932,0.66,0.91,2.21880078,0.2773501,0.03605551,-3.56949576
56.309932,0.64,0.88,2.21880078,0.2773501,0.03605551,-3.56949576
63.434949,0.63,0.86,0.89442719,0.4472136,0.02236068,-2.2137073
56.309932,0.61,0.83,2.21880078,0.2773501,0.03605551,-3.56949576
71.565051,0.6,0.8,0.9486833,0.31622777,0.03162278,-3.13065488
90,0.6,0.79,0,1,0.01,-0.99
90,0.6,0.77,0,1,0.02,-0.98
90,0.6,0.74,0,1,0.03,-0.97
225,0.61,0.75,0.70710678,0.70710678,0.01414214,-1.40007143
243.434949,0.62,0.77,0.89442719,0.4472136,0.02236068,-2.2137073
225,0.63,0.78,0.70710678,0.70710678,0.01414214,-1.40007143
206.565051,0.65,0.79,1.34164079,0.4472136,0.02236068,-2.2137073
206.565051,0.67,0.8,1.34164079,0.4472136,0.02236068,-2.2137073
180,0.69,0.8,0,1,0.02,-0.98
180,0.71,0.8,0,1,0.02,-0.98
180,0.74,0.8,0,1,0.03,-0.97
153.434949,0.76,0.79,0.89442719,0.4472136,0.02236068,-2.2137073
135,0.77,0.78,0.70710678,0.70710678,0.01414214,-1.40007143
135,0.56,0.56,0.70710678,0.70710678,0.01414214,-1.40007143
26.565051,0.77,0.74,1.34164079,0.4472136,0.02236068,-2.2137073
56.309932,0.75,0.71,2.21880078,0.2773501,0.03605551,-3.56949576
14.036243,0.71,0.7,3.15296313,0.24253563,0.04123106,-4.08187457
90,0.71,0.67,0,1,0.03,-0.97
341.565051,0.68,0.68,0.9486833,0.31622777,0.03162278,-3.13065488
0,0.67,0.68,0,1,0.01,-0.99
90,0.56,0.55,0,1,0.01,-0.99
180,0.57,0.55,0,1,0.01,-0.99
225,0.58,0.56,0.70710678,0.70710678,0.01414214,-1.40007143
270,0.58,0.57,0,1,0.01,-0.99
135,0.59,0.56,0.70710678,0.70710678,0.01414214,-1.40007143
74.475889,0.54,0.38,11.4016286,0.05352877,0.18681542,-18.49472628
90,0.54,0.36,0,1,0.02,-0.98
45,0.53,0.35,0.70710678,0.70710678,0.01414214,-1.40007143
90,0.53,0.32,0,1,0.03,-0.97
63.434949,0.47,0.2,0.89442719,0.4472136,0.13416408,-2.1019039
90,0.47,0.19,0,1,0.01,-0.99
56.309932,0.45,0.16,2.21880078,0.2773501,0.03605551,-3.56949576
57.994617,0.4,0.08,5.82998834,0.10599979,0.09433981,-9.33964132
45,0.39,0.07,0.70710678,0.70710678,0.01414214,-1.40007143
180,0.4,0.07,0,1,0.01,-0.99
225,0.41,0.08,0.70710678,0.70710678,0.01414214,-1.40007143
236.309932,0.47,0.17,2.21880078,0.2773501,0.10816654,-3.49738474
206.565051,0.49,0.18,1.34164079,0.4472136,0.02236068,-2.2137073
244.983107,0.56,0.33,14.31769361,0.06041221,0.16552945,-16.3874159
260.537678,0.57,0.39,0.98639392,0.16439899,0.06082763,-6.0219349
255.963757,0.58,0.43,0.9701425,0.24253563,0.04123106,-4.08187457
255.963757,0.6,0.51,0.9701425,0.24253563,0.08246211,-4.04064351
251.565051,0.62,0.57,0.9486833,0.31622777,0.06324555,-3.09903211
83.659808,0.61,0.48,0.99388373,0.11043153,0.09055385,-8.96483129
135,0.62,0.47,0.70710678,0.70710678,0.01414214,-1.40007143
45,0.61,0.46,0.70710678,0.70710678,0.01414214,-1.40007143
66.801409,0.58,0.39,5.38356375,0.13130643,0.07615773,-7.53961537
90,0.58,0.36,0,1,0.03,-0.97
45,0.55,0.33,0.70710678,0.70710678,0.04242641,-1.37178716
213.690068,0.58,0.35,1.38675049,0.2773501,0.03605551,-3.56949576
243.434949,0.59,0.37,0.89442719,0.4472136,0.02236068,-2.2137073
243.434949,0.62,0.43,0.89442719,0.4472136,0.06708204,-2.16898594
243.434949,0.63,0.45,0.89442719,0.4472136,0.02236068,-2.2137073
243.434949,0.64,0.47,0.89442719,0.4472136,0.02236068,-2.2137073
270,0.64,0.58,0,1,0.11,-0.89
225,0.65,0.59,0.70710678,0.70710678,0.01414214,-1.40007143
128.659808,0.69,0.54,1.40556386,0.15617376,0.06403124,-6.339093
153.434949,0.71,0.53,0.89442719,0.4472136,0.02236068,-2.2137073
164.054604,0.78,0.51,4.12081692,0.13736056,0.0728011,-7.20730879
195.945396,0.85,0.53,3.15929297,0.13736056,0.0728011,-7.20730879
315,0.84,0.54,0.70710678,0.70710678,0.01414214,-1.40007143
0,0.81,0.54,0,1,0.03,-0.97
18.434949,0.78,0.53,2.21359436,0.31622777,0.03162278,-3.13065488
344.054604,0.71,0.55,4.12081692,0.13736056,0.0728011,-7.20730879
315,0.67,0.59,0.70710678,0.70710678,0.05656854,-1.35764502
270,0.67,0.6,0,1,0.01,-0.99
180,0.68,0.6,0,1,0.01,-0.99
180,0.7,0.6,0,1,0.02,-0.98
153.434949,0.72,0.59,0.89442719,0.4472136,0.02236068,-2.2137073
171.869898,0.79,0.58,0.98994949,0.14142136,0.07071068,-7.00035713
198.434949,0.82,0.59,2.21359436,0.31622777,0.03162278,-3.13065488
225,0.83,0.6,0.70710678,0.70710678,0.01414214,-1.40007143
225,0.84,0.61,0.70710678,0.70710678,0.01414214,-1.40007143
206.565051,0.86,0.62,1.34164079,0.4472136,0.02236068,-2.2137073
206.565051,0.9,0.64,1.34164079,0.4472136,0.04472136,-2.19134662
206.565051,0.94,0.66,1.34164079,0.4472136,0.04472136,-2.19134662
225,0.95,0.67,0.70710678,0.70710678,0.01414214,-1.40007143
281.309932,0.92,0.82,4.11843884,0.19611614,0.15297059,-4.94604893
94.398705,0.93,0.69,12.04135032,0.0766965,0.13038405,-12.90802076
33.690068,0.9,0.67,1.38675049,0.2773501,0.03605551,-3.56949576
33.690068,0.87,0.65,1.38675049,0.2773501,0.03605551,-3.56949576
26.565051,0.85,0.64,1.34164079,0.4472136,0.02236068,-2.2137073
33.690068,0.82,0.62,1.38675049,0.2773501,0.03605551,-3.56949576
18.434949,0.79,0.61,2.21359436,0.31622777,0.03162278,-3.13065488
0,0.78,0.61,0,1,0.01,-0.99
0,0.76,0.61,0,1,0.02,-0.98
0,0.73,0.61,0,1,0.03,-0.97
225,0.74,0.62,0.70710678,0.70710678,0.01414214,-1.40007143
206.565051,0.76,0.63,1.34164079,0.4472136,0.02236068,-2.2137073
225,0.77,0.64,0.70710678,0.70710678,0.01414214,-1.40007143
243.434949,0.78,0.66,0.89442719,0.4472136,0.02236068,-2.2137073
243.434949,0.79,0.68,0.89442719,0.4472136,0.02236068,-2.2137073
270,0.79,0.7,0,1,0.02,-0.98
270,0.79,0.72,0,1,0.02,-0.98
270,0.79,0.75,0,1,0.03,-0.97
296.565051,0.78,0.77,1.34164079,0.4472136,0.02236068,-2.2137073
315,0.77,0.78,0.70710678,0.70710678,0.01414214,-1.40007143
`),!1);ie(ee.ParsePatFile(`
*SACNCR,SACNCR
45, 0,0, 0,.09375
45, .06629126,0, 0,.09375, 0,-.09375
`),!1);ie(ee.ParsePatFile(`
*SCAFFOLD, verbose comment
;By John Hyslop,    Tile2Hatch tool \xA9 CVH 2020
;Developed in inch as imperial QCAD3 pattern
270,0.76,0.84,1,1,0.02,-0.98
326.3099325,0.26,0.16,2.21880078,0.2773501,0.57688819,-3.02866309
90,0.24,0.49,1,1,0.02,-0.98
270,0.25,0.16,1,1,0.32,-0.68
146.3099325,0.24,0.84,2.21880078,0.2773501,0.5768882,-3.02866307
180,0.76,0.49,0,1,0.02,-0.98
270,0.74,0.18,1,1,0.02,-0.98
0,0.74,0.84,0,1,0.02,-0.98
90,0.25,0.51,1,1,0.31,-0.69
270,0.76,0.51,1,1,0.02,-0.98
0,0.26,0.17,0,1,0.48,-0.52
0,0.24,0.51,0,1,0.02,-0.98
180,0.76,0.18,0,1,0.02,-0.98
90,0.74,0.82,1,1,0.02,-0.98
212.855722,0.24,0.49,20.24844917,0.01750082,0.57140178,-56.56877673
147.144278,0.24,0.18,36.89172934,0.01750082,0.57140178,-56.56877673
213.6900675,0.24,0.16,1.38675049,0.2773501,0.57688818,-3.02866309
180,0.24,0.17,0,1,0.48,-0.52
0,0.26,0.83,0,1,0.48,-0.52
90,0.26,0.16,1,1,0.02,-0.98
180,0.76,0.82,0,1,0.02,-0.98
90,0.74,0.49,1,1,0.02,-0.98
147.144278,0.74,0.18,36.89172934,0.01750082,0.57140179,-56.56877672
0,0.24,0.16,0,1,0.02,-0.98
0,0.26,0.5,0,1,0.48,-0.52
270,0.26,0.84,1,1,0.02,-0.98
90,0.75,0.18,1,1,0.31,-0.69
212.855722,0.74,0.82,20.24844917,0.01750082,0.57140179,-56.56877672
180,0.26,0.49,0,1,0.02,-0.98
270,0.24,0.18,1,1,0.02,-0.98
0,0.24,0.84,0,1,0.02,-0.98
270,0.26,0.51,1,1,0.02,-0.98
270,0.75,0.82,1,1,0.31,-0.69
32.855722,0.26,0.18,20.24844917,0.01750082,0.57140179,-56.56877672
180,0.26,0.18,0,1,0.02,-0.98
0,0.74,0.51,0,1,0.02,-0.98
90,0.76,0.16,1,1,0.02,-0.98
90,0.24,0.82,1,1,0.02,-0.98
180,0.24,0.83,0,1,0.48,-0.52
147.144278,0.24,0.51,36.89172934,0.01750082,0.57140178,-56.56877673
180,0.24,0.5,0,1,0.48,-0.52
270,0.25,0.49,1,1,0.31,-0.69
212.855722,0.24,0.82,20.24844917,0.01750082,0.57140179,-56.56877672
0,0.74,0.16,0,1,0.02,-0.98
270,0.75,0.16,1,1,0.32,-0.68
180,0.26,0.82,0,1,0.02,-0.98
213.6900675,0.74,0.16,1.38675049,0.2773501,0.57688819,-3.02866309
327.144278,0.26,0.82,36.89172934,0.01750082,0.57140179,-56.56877672
`),!1);ie(ee.ParsePatFile(`
*SQUARE,SQUARE
0, 0,0, 0,.125, .125,-.125
90, 0,0, 0,.125, .125,-.125
`),!1);ie(ee.ParsePatFile(`
*SQUIGGLE-01,SQUIGGLE-01
;By John Hyslop,    Using AutoCAD Lisp Tool
;Developed in inch as imperial QCAD3 pattern
45,0.11,-0.39,0.70710678,0.70710678,1.11722871,-0.29698485
56.309932,0.07,0.55,2.21880078,0.2773501,0.07211103,-3.53344025
81.869898,0.06,0.48,0.98994949,0.14142136,0.07071068,-7.00035713
99.462322,0.07,0.42,5.09636861,0.16439899,0.06082763,-6.0219349
123.690068,0.11,0.36,1.38675049,0.2773501,0.07211103,-3.53344025
146.309932,0.17,0.32,2.21880078,0.2773501,0.07211103,-3.53344025
170.537678,0.23,0.31,0.98639392,0.16439899,0.06082763,-6.0219349
188.130102,0.3,0.32,6.08111832,0.14142136,0.07071068,-7.00035713
213.690068,0.36,0.36,1.38675049,0.2773501,0.07211103,-3.53344025
225,0.65,0.65,0.70710678,0.70710678,0.41012193,-1.00409163
213.690068,0.71,0.69,1.38675049,0.2773501,0.07211103,-3.53344025
189.462322,0.77,0.7,5.09636861,0.16439899,0.06082763,-6.0219349
171.869898,0.84,0.69,0.98994949,0.14142136,0.07071068,-7.00035713
146.309932,0.9,0.65,2.21880078,0.2773501,0.07211103,-3.53344025
123.690068,0.94,0.59,1.38675049,0.2773501,0.07211103,-3.53344025
99.462322,0.95,0.53,5.09636861,0.16439899,0.06082763,-6.0219349
81.869898,0.94,0.46,0.98994949,0.14142136,0.07071068,-7.00035713
56.309932,0.9,0.4,2.21880078,0.2773501,0.07211103,-3.53344025
`),!1);ie(ee.ParsePatFile(`
*SQUIGGLE-02,SQUIGGLE-02
;By John Hyslop,    Using AutoCAD Lisp Tool
;Developed in inch as imperial QCAD3 pattern
75.963757,0.99,0.16,0.9701425,0.24253563,0.04123106,-4.08187457
63.434949,0.97,0.12,0.89442719,0.4472136,0.04472136,-2.19134662
45,0.94,0.09,0.70710678,0.70710678,0.04242641,-1.37178716
14.036243,0.9,0.08,3.15296313,0.24253563,0.04123106,-4.08187457
0,0.85,0.08,0,1,0.05,-0.95
345.963757,0.81,0.09,0.9701425,0.24253563,0.04123106,-4.08187457
315,0.78,0.12,0.70710678,0.70710678,0.04242641,-1.37178716
296.565051,0.76,0.16,1.34164079,0.4472136,0.04472136,-2.19134662
284.036243,0.75,0.2,3.15296313,0.24253563,0.04123106,-4.08187457
281.309932,0.74,0.85,4.11843884,0.19611614,0.0509902,-5.04802932
303.690068,0.72,0.88,1.38675049,0.2773501,0.03605551,-3.56949576
315,0.69,0.91,0.70710678,0.70710678,0.04242641,-1.37178716
345.963757,0.65,0.92,0.9701425,0.24253563,0.04123106,-4.08187457
0,0.6,0.92,0,1,0.05,-0.95
14.036243,0.56,0.91,3.15296313,0.24253563,0.04123106,-4.08187457
45,0.53,0.88,0.70710678,0.70710678,0.04242641,-1.37178716
56.309932,0.51,0.85,2.21880078,0.2773501,0.03605551,-3.56949576
78.690068,0.5,0.8,0.98058068,0.19611614,0.0509902,-5.04802932
75.963757,0.49,0.16,0.9701425,0.24253563,0.04123106,-4.08187457
63.434949,0.47,0.12,0.89442719,0.4472136,0.04472136,-2.19134662
45,0.44,0.09,0.70710678,0.70710678,0.04242641,-1.37178716
14.036243,0.4,0.08,3.15296313,0.24253563,0.04123106,-4.08187457
0,0.35,0.08,0,1,0.05,-0.95
345.963757,0.31,0.09,0.9701425,0.24253563,0.04123106,-4.08187457
315,0.28,0.12,0.70710678,0.70710678,0.04242641,-1.37178716
296.565051,0.26,0.16,1.34164079,0.4472136,0.04472136,-2.19134662
284.036243,0.25,0.2,3.15296313,0.24253563,0.04123106,-4.08187457
281.309932,0.24,0.85,4.11843884,0.19611614,0.0509902,-5.04802932
303.690068,0.22,0.88,1.38675049,0.2773501,0.03605551,-3.56949576
315,0.19,0.91,0.70710678,0.70710678,0.04242641,-1.37178716
345.963757,0.15,0.92,0.9701425,0.24253563,0.04123106,-4.08187457
0,0.1,0.92,0,1,0.05,-0.95
14.036243,0.06,0.91,3.15296313,0.24253563,0.04123106,-4.08187457
45,0.03,0.88,0.70710678,0.70710678,0.04242641,-1.37178716
56.309932,0.01,0.85,2.21880078,0.2773501,0.03605551,-3.56949576
78.690068,0,0.8,0.98058068,0.19611614,0.0509902,-5.04802932
270,0.75,0.8,0,1,0.6,-0.4
270,0.5,0.8,0,1,0.6,-0.4
270,0.25,0.8,0,1,0.6,-0.4
270,0,0.8,0,1,0.6,-0.4
`),!1);ie(ee.ParsePatFile(`
*STARS,STARS
0, 0,0, 0,.21650635, .125,-.125
60, 0,0, 0,.21650635, .125,-.125
120, .0625,.10825318, 0,.21650635, .125,-.125
`),!1);ie(ee.ParsePatFile(`
*STEEL,STEEL
45, 0,0, 0,.125
45, 0,.0625, 0,.125
`),!1);ie(ee.ParsePatFile(`
*SWAMP,SWAMP
0, 0,0, .5,.8660254, .125,-.875
90, .0625,0, .8660254,.5, .0625,-1.66955081
90, .078125,0, .8660254,.5, .05,-1.68205081
90, .046875,0, .8660254,.5, .05,-1.68205081
60, .09375,0, .5,.8660254, .04,-.96
120, .03125,0, .5,.8660254, .04,-.96
`),!1);ie(ee.ParsePatFile(`
*TRANS,TRANS
0, 0,0, 0,.25
0, 0,.125, 0,.25, .125,-.125
`),!1);ie(ee.ParsePatFile(`
*TRIANG,TRIANG
60, 0,0, .1875,.32475953, .1875,-.1875
120, 0,0, .1875,.32475953, .1875,-.1875
0, -.09375,.16237976, .1875,.32475953, .1875,-.1875
`),!1);ie(ee.ParsePatFile(`
*TRI-OVERLAP,TRI-OVERLAP verbose
;By John Hyslop,    Tile2Hatch tool \xA9 CVH 2020
;Developed in inch as imperial QCAD3 pattern
59.641885,0.09000001,0.15,47.50789248,0.01232691,0.81123363,-80.31212922
300.358115,0.5,0.85000001,33.61547037,0.01232691,0.81123363,-80.31212922
180,0.35942857,0.61,0,1,0.71885753,-0.28114247
59.036243,0.89518072,0.17530121,2.22948161,0.17149859,0.20373205,-5.62721984
180,0.91,0.15,0,1,0.81999999,-0.18000001
300.963757,0,0.35,3.60147029,0.17149859,0.20373206,-5.62721983
300.784147,0.12,0.15,5.83092324,0.01827876,0.5470832,-54.16123426
239.215853,0.88,0.15,48.87739422,0.01827876,0.5470832,-54.16123426
`),!1);ie(ee.ParsePatFile(`
*WEATHERBOARD,WEATHERBOARD
; By John Hyslop,    Manually Entered QCAD3 pattern
; Developed in inch as imperial QCAD3 pattern
; Imperial Hatch Scale 1 Makes 6inch horizontally placed boards
; with a 0.5in offset line to simulate a rounded edge
0,0,0,0,6
0,0,0.5,0,6
`),!1);ie(ee.ParsePatFile(`
*WEAVING,WEAVING
;By John Hyslop,    Using AutoCAD Lisp Tool
;Developed in inch as imperial QCAD3 pattern
90,0.9,0.2,0,1,0.05,-0.95
75.963757,0.88,0.12,0.9701425,0.24253563,0.08246211,-4.04064351
66.801409,0.85,0.05,5.38356375,0.13130643,0.07615773,-7.53961537
54.462322,0.8,-0.02,3.6036768,0.11624764,0.08602325,-8.51630201
56.309932,0.76,-0.08,2.21880078,0.2773501,0.07211103,-3.53344025
90,0.79,0.22,0,1,0.07,-0.93
80.537678,0.78,0.16,0.98639392,0.16439899,0.06082763,-6.0219349
63.434949,0.75,0.1,0.89442719,0.4472136,0.06708204,-2.16898594
56.309932,0.71,0.04,2.21880078,0.2773501,0.07211103,-3.53344025
56.309932,0.67,-0.02,2.21880078,0.2773501,0.07211103,-3.53344025
333.434949,0.86,0.27,0.89442719,0.4472136,0.06708204,-2.16898594
344.054604,0.79,0.29,4.12081692,0.13736056,0.0728011,-7.20730879
0,0.71,0.29,0,1,0.08,-0.92
9.462322,0.65,0.28,5.09636861,0.16439899,0.06082763,-6.0219349
26.565051,0.59,0.25,1.34164079,0.4472136,0.06708204,-2.16898594
38.659808,0.54,0.21,1.40556386,0.15617376,0.06403124,-6.339093
36.869898,0.46,0.15,1.4,0.2,0.1,-4.9
20.556045,0.38,0.12,5.38389277,0.11704115,0.08544004,-8.45856371
330.255119,0.91,0.37,2.23262522,0.12403473,0.08062258,-7.98163517
344.054604,0.84,0.39,4.12081692,0.13736056,0.0728011,-7.20730879
352.874984,0.76,0.4,0.99227788,0.12403473,0.08062258,-7.98163517
0,0.69,0.4,0,1,0.07,-0.93
14.036243,0.61,0.38,3.15296313,0.24253563,0.08246211,-4.04064351
26.565051,0.53,0.34,1.34164079,0.4472136,0.08944272,-2.14662526
33.690068,0.47,0.3,1.38675049,0.2773501,0.07211103,-3.53344025
35.537678,0.4,0.25,4.99864847,0.11624764,0.08602325,-8.51630201
0,0.2,0.1,0,1,0.05,-0.95
348.690068,0.15,0.11,0.98058068,0.19611614,0.0509902,-5.04802932
341.565051,0.12,0.12,0.9486833,0.31622777,0.03162278,-3.13065488
336.801409,0.05,0.15,5.38356375,0.13130643,0.07615773,-7.53961537
326.309932,-0.01,0.19,2.21880078,0.2773501,0.07211103,-3.53344025
324.462322,-0.08,0.24,3.6036768,0.11624764,0.08602325,-8.51630201
0,0.22,0.21,0,1,0.07,-0.93
350.537678,0.16,0.22,0.98639392,0.16439899,0.06082763,-6.0219349
333.434949,0.1,0.25,0.89442719,0.4472136,0.06708204,-2.16898594
326.309932,0.04,0.29,2.21880078,0.2773501,0.07211103,-3.53344025
326.309932,-0.02,0.33,2.21880078,0.2773501,0.07211103,-3.53344025
60.255119,0.63,0.91,2.23262522,0.12403473,0.08062258,-7.98163517
180,0.79,0.79,0,1,0.08,-0.92
164.054604,0.86,0.77,4.12081692,0.13736056,0.0728011,-7.20730879
153.434949,0.92,0.74,0.89442719,0.4472136,0.06708204,-2.16898594
330.255119,0.91,0.87,2.23262522,0.12403473,0.08062258,-7.98163517
345.963757,0.83,0.89,0.9701425,0.24253563,0.08246211,-4.04064351
352.874984,0.75,0.9,0.99227788,0.12403473,0.08062258,-7.98163517
60.255119,0.72,0.85,2.23262522,0.12403473,0.08062258,-7.98163517
80.537678,0.71,0.79,0.98639392,0.16439899,0.06082763,-6.0219349
90,0.71,0.71,0,1,0.08,-0.92
104.036243,0.73,0.63,3.15296313,0.24253563,0.08246211,-4.04064351
116.565051,0.76,0.57,1.34164079,0.4472136,0.06708204,-2.16898594
129.805571,0.81,0.51,1.40840568,0.12803688,0.0781025,-7.73214718
123.690068,0.85,0.45,1.38675049,0.2773501,0.07211103,-3.53344025
113.198591,0.88,0.38,2.23220936,0.13130643,0.07615773,-7.53961537
309.805571,0.71,0.46,1.40840568,0.12803688,0.0781025,-7.73214718
305.537678,0.66,0.53,4.99864847,0.11624764,0.08602325,-8.51630201
299.744881,0.62,0.6,5.82963253,0.12403473,0.08062258,-7.98163517
285.945396,0.6,0.67,3.15929297,0.13736056,0.0728011,-7.20730879
270,0.6,0.76,0,1,0.09,-0.91
74.054604,0.61,0.84,4.12081692,0.13736056,0.0728011,-7.20730879
82.874984,0.6,0.76,0.99227788,0.12403473,0.08062258,-7.98163517
39.805571,0.54,0.71,1.40840568,0.12803688,0.0781025,-7.73214718
35.537678,0.47,0.66,4.99864847,0.11624764,0.08602325,-8.51630201
33.690068,0.41,0.62,1.38675049,0.2773501,0.07211103,-3.53344025
15.945396,0.34,0.6,3.15929297,0.13736056,0.0728011,-7.20730879
6.340192,0.25,0.59,8.0615014,0.11043153,0.09055385,-8.96483129
350.537678,0.19,0.6,0.98639392,0.16439899,0.06082763,-6.0219349
344.054604,0.12,0.62,4.12081692,0.13736056,0.0728011,-7.20730879
23.198591,0.55,0.85,2.23220936,0.13130643,0.07615773,-7.53961537
29.744881,0.48,0.81,5.82963253,0.12403473,0.08062258,-7.98163517
39.805571,0.42,0.76,1.40840568,0.12803688,0.0781025,-7.73214718
29.744881,0.35,0.72,5.82963253,0.12403473,0.08062258,-7.98163517
7.125016,0.27,0.71,7.06997987,0.12403473,0.08062258,-7.98163517
0,0.21,0.71,0,1,0.06,-0.94
344.054604,0.14,0.73,4.12081692,0.13736056,0.0728011,-7.20730879
333.434949,0.1,0.75,0.89442719,0.4472136,0.04472136,-2.19134662
234.462322,0.31,-0.01,3.6036768,0.11624764,0.08602325,-8.51630201
240.255119,0.35,0.06,2.23262522,0.12403473,0.08062258,-7.98163517
243.434949,0.39,0.14,0.89442719,0.4472136,0.08944272,-2.14662526
262.874984,0.4,0.22,0.99227788,0.12403473,0.08062258,-7.98163517
270,0.4,0.3,0,1,0.08,-0.92
282.528808,0.38,0.39,4.1216787,0.10846523,0.09219544,-9.12734901
293.198591,0.35,0.46,2.23220936,0.13130643,0.07615773,-7.53961537
309.805571,0.3,0.52,1.40840568,0.12803688,0.0781025,-7.73214718
305.537678,0.25,0.59,4.99864847,0.11624764,0.08602325,-8.51630201
270,0.21,0.78,0,1,0.07,-0.93
254.054604,0.23,0.85,4.12081692,0.13736056,0.0728011,-7.20730879
246.801409,0.26,0.92,5.38356375,0.13130643,0.07615773,-7.53961537
236.309932,0.21,0.04,2.21880078,0.2773501,0.07211103,-3.53344025
234.462322,0.26,0.11,3.6036768,0.11624764,0.08602325,-8.51630201
249.443955,0.29,0.19,3.16011097,0.11704115,0.08544004,-8.45856371
270,0.29,0.27,0,1,0.08,-0.92
278.130102,0.28,0.34,6.08111832,0.14142136,0.07071068,-7.00035713
296.565051,0.24,0.42,1.34164079,0.4472136,0.08944272,-2.14662526
309.805571,0.19,0.48,1.40840568,0.12803688,0.0781025,-7.73214718
303.690068,0.15,0.54,1.38675049,0.2773501,0.07211103,-3.53344025
290.556045,0.12,0.62,5.38389277,0.11704115,0.08544004,-8.45856371
341.565051,0.06,0.64,0.9486833,0.31622777,0.06324555,-3.09903211
324.462322,-0.01,0.69,3.6036768,0.11624764,0.08602325,-8.51630201
324.462322,-0.08,0.74,3.6036768,0.11624764,0.08602325,-8.51630201
146.309932,0.04,0.79,2.21880078,0.2773501,0.07211103,-3.53344025
146.309932,0.1,0.75,2.21880078,0.2773501,0.07211103,-3.53344025
262.874984,0.11,0.83,0.99227788,0.12403473,0.08062258,-7.98163517
255.963757,0.13,0.91,0.9701425,0.24253563,0.08246211,-4.04064351
240.255119,0.17,0.98,2.23262522,0.12403473,0.08062258,-7.98163517
`),!1);ie(ee.ParsePatFile(`
*WIRE-FENCE,WIRE-FENCE verbose
;By John Hyslop,    Tile2Hatch tool \xA9 CVH 2020
;Developed in inch as imperial QCAD3 pattern
315,0.46,0.5,0.70710678,0.70710678,0.04673053,-1.36748303
315,0.52571429,0.56428571,0.70710678,0.70710678,0.04848732,-1.36572624
3.731397,0.50267394,0.56278308,15.03328073,0.02169305,0.02308929,-46.074633
183.17983,0.46361415,0.56023571,17.02929602,0.05547002,0.90614559,-17.12161079
183.17983,0.46120401,0.52006684,17.02929602,0.05547002,0.90600202,-17.12175436
153.434949,0.52,0.51,0.89442719,0.4472136,0.02236068,-2.2137073
266.593556,0.52,0.51,17.02938222,0.01188373,1.01178655,-83.1368914
266.593556,0.56,0.53,17.02938222,0.01188373,1.01178655,-83.1368914
2.602562,0.49304348,0.46695652,21.02374701,0.04540766,0.02449081,-21.99822474
`),!1);ie(ee.ParsePatFile(`
*XMASTREE-01,XMASTREE-01
;By John Hyslop
;Developed in inch as imperial QCAD3 pattern
180,0.04,0.95,0,1,0.04,-0.96
90,0.04,0.82,0,1,0.13,-0.87
180,0.33,0.82,0,1,0.29,-0.71
49.763642,0.22,0.69,7.81002892,0.05872202,0.17029386,-16.8590925
180,0.28,0.69,0,1,0.06,-0.94
51.340192,0.16,0.54,4.99756038,0.15617376,0.19209373,-6.21103051
180,0.22,0.54,0,1,0.06,-0.94
52.431408,0.12,0.41,4.99962824,0.06097108,0.16401219,-16.23720727
180,0.17,0.41,0,1,0.05,-0.95
53.130102,0.08,0.29,3.6,0.2,0.15,-4.85
180,0.13,0.29,0,1,0.05,-0.95
53.972627,0.05,0.18,8.60201108,0.07352146,0.13601471,-13.4654558
180,0.1,0.18,0,1,0.05,-0.95
54.462322,0,0.04,3.6036768,0.11624764,0.17204651,-8.43027876
0,0.96,0.95,0,1,0.04,-0.96
90,0.96,0.82,0,1,0.13,-0.87
0,0.67,0.82,0,1,0.29,-0.71
130.236358,0.78,0.69,9.21935745,0.05872202,0.17029386,-16.8590925
0,0.72,0.69,0,1,0.06,-0.94
128.659808,0.84,0.54,1.40556386,0.15617376,0.19209373,-6.21103051
0,0.78,0.54,0,1,0.06,-0.94
127.568592,0.88,0.41,11.40159123,0.06097108,0.16401219,-16.23720727
0,0.83,0.41,0,1,0.05,-0.95
126.869898,0.92,0.29,1.4,0.2,0.15,-4.85
0,0.87,0.29,0,1,0.05,-0.95
126.027373,0.95,0.18,4.99945943,0.07352146,0.13601471,-13.4654558
0,0.9,0.18,0,1,0.05,-0.95
125.537678,1,0.04,4.99864847,0.11624764,0.17204651,-8.43027876
0,0.46,0.04,0,1,0.04,-0.96
270,0.46,0.17,0,1,0.13,-0.87
0,0.17,0.17,0,1,0.29,-0.71
229.763642,0.28,0.3,7.81002892,0.05872202,0.17029386,-16.8590925
0,0.22,0.3,0,1,0.06,-0.94
231.340192,0.34,0.45,4.99756038,0.15617376,0.19209373,-6.21103051
0,0.28,0.45,0,1,0.06,-0.94
232.431408,0.38,0.58,4.99962824,0.06097108,0.16401219,-16.23720727
0,0.33,0.58,0,1,0.05,-0.95
233.130102,0.42,0.7,3.6,0.2,0.15,-4.85
0,0.37,0.7,0,1,0.05,-0.95
233.972627,0.45,0.81,8.60201108,0.07352146,0.13601471,-13.4654558
0,0.4,0.81,0,1,0.05,-0.95
234.462322,0.5,0.95,3.6036768,0.11624764,0.17204651,-8.43027876
180,0.54,0.04,0,1,0.04,-0.96
270,0.54,0.17,0,1,0.13,-0.87
180,0.83,0.17,0,1,0.29,-0.71
310.236358,0.72,0.3,9.21935745,0.05872202,0.17029386,-16.8590925
180,0.78,0.3,0,1,0.06,-0.94
308.659808,0.66,0.45,1.40556386,0.15617376,0.19209373,-6.21103051
180,0.72,0.45,0,1,0.06,-0.94
307.568592,0.62,0.58,11.40159123,0.06097108,0.16401219,-16.23720727
180,0.67,0.58,0,1,0.05,-0.95
306.869898,0.58,0.7,1.4,0.2,0.15,-4.85
180,0.63,0.7,0,1,0.05,-0.95
306.027373,0.55,0.81,4.99945943,0.07352146,0.13601471,-13.4654558
180,0.6,0.81,0,1,0.05,-0.95
305.537678,0.5,0.95,4.99864847,0.11624764,0.17204651,-8.43027876
`),!1);ie(ee.ParsePatFile(`
*XMASTREE-02,XMASTREE-02
;By John Hyslop
;Developed in inch as imperial QCAD3 pattern
180,0.04,0.26,0,1,0.04,-0.96
90,0.04,0.13,0,1,0.13,-0.87
180,0.33,0.13,0,1,0.29,-0.71
49.763642,0.22,0,7.81002892,0.05872202,0.17029386,-16.8590925
180,0.28,1,0,1,0.06,-0.94
51.340192,0.16,0.85,4.99756038,0.15617376,0.19209373,-6.21103051
180,0.22,0.85,0,1,0.06,-0.94
52.431408,0.12,0.72,4.99962824,0.06097108,0.16401219,-16.23720727
180,0.17,0.72,0,1,0.05,-0.95
53.130102,0.08,0.6,3.6,0.2,0.15,-4.85
180,0.13,0.6,0,1,0.05,-0.95
53.972627,0.05,0.49,8.60201108,0.07352146,0.13601471,-13.4654558
180,0.1,0.49,0,1,0.05,-0.95
54.462322,0,0.35,3.6036768,0.11624764,0.17204651,-8.43027876
0,0.96,0.26,0,1,0.04,-0.96
90,0.96,0.13,0,1,0.13,-0.87
0,0.67,0.13,0,1,0.29,-0.71
130.236358,0.78,0,9.21935745,0.05872202,0.17029386,-16.8590925
0,0.72,1,0,1,0.06,-0.94
128.659808,0.84,0.85,1.40556386,0.15617376,0.19209373,-6.21103051
0,0.78,0.85,0,1,0.06,-0.94
127.568592,0.88,0.72,11.40159123,0.06097108,0.16401219,-16.23720727
0,0.83,0.72,0,1,0.05,-0.95
126.869898,0.92,0.6,1.4,0.2,0.15,-4.85
0,0.87,0.6,0,1,0.05,-0.95
126.027373,0.95,0.49,4.99945943,0.07352146,0.13601471,-13.4654558
0,0.9,0.49,0,1,0.05,-0.95
125.537678,1,0.35,4.99864847,0.11624764,0.17204651,-8.43027876
0,0.46,0.09,0,1,0.04,-0.96
270,0.46,0.22,0,1,0.13,-0.87
0,0.17,0.22,0,1,0.29,-0.71
229.763642,0.28,0.35,7.81002892,0.05872202,0.17029386,-16.8590925
0,0.22,0.35,0,1,0.06,-0.94
231.340192,0.34,0.5,4.99756038,0.15617376,0.19209373,-6.21103051
0,0.28,0.5,0,1,0.06,-0.94
232.431408,0.38,0.63,4.99962824,0.06097108,0.16401219,-16.23720727
0,0.33,0.63,0,1,0.05,-0.95
233.130102,0.42,0.75,3.6,0.2,0.15,-4.85
0,0.37,0.75,0,1,0.05,-0.95
233.972627,0.45,0.86,8.60201108,0.07352146,0.13601471,-13.4654558
0,0.4,0.86,0,1,0.05,-0.95
234.462322,0.5,1,3.6036768,0.11624764,0.17204651,-8.43027876
180,0.54,0.09,0,1,0.04,-0.96
270,0.54,0.22,0,1,0.13,-0.87
180,0.83,0.22,0,1,0.29,-0.71
310.236358,0.72,0.35,9.21935745,0.05872202,0.17029386,-16.8590925
180,0.78,0.35,0,1,0.06,-0.94
308.659808,0.66,0.5,1.40556386,0.15617376,0.19209373,-6.21103051
180,0.72,0.5,0,1,0.06,-0.94
307.568592,0.62,0.63,11.40159123,0.06097108,0.16401219,-16.23720727
180,0.67,0.63,0,1,0.05,-0.95
306.869898,0.58,0.75,1.4,0.2,0.15,-4.85
180,0.63,0.75,0,1,0.05,-0.95
306.027373,0.55,0.86,4.99945943,0.07352146,0.13601471,-13.4654558
180,0.6,0.86,0,1,0.05,-0.95
305.537678,0.5,1,4.99864847,0.11624764,0.17204651,-8.43027876
`),!1);ie(ee.ParsePatFile(`
*ZIGZAG,ZIGZAG
0, 0,0, .125,.125, .125,-.125
90, .125,0, .125,.125, .125,-.125
`),!1);var Qu=65536,aY=15*Math.PI/180,lk="__point_shape",lY=1024,ck=4,cY=2e4,hY=2e4,hk={DIMTXT:function(){return 2.5},DIMASZ:2.5,DIMCLRD:0,DIMCLRE:0,DIMCLRT:0,DIMDEC:2,DIMDLE:0,DIMDSEP:46,DIMEXE:1.25,DIMEXO:.625,DIMFXL:1,DIMFXLON:!1,DIMGAP:.625,DIMLFAC:1,DIMRND:0,DIMSAH:0,DIMSCALE:1,DIMSD1:0,DIMSD2:0,DIMSE1:0,DIMSE2:0,DIMSOXD:!1,DIMTSZ:0,DIMZIN:8},tp=class o{constructor(e){this.options=Object.create(o.DefaultOptions),e&&Object.assign(this.options,e.sceneOptions),this.origin=null,this.batches=new Y6((t,s)=>t.key.Compare(s.key)),this.layers=new Map,this.blocks=new Map,this.dimStyles=new Map,this.vars=new Map,this.fontStyles=new Map,this.inserts=new Map,this.bounds=null,this.pointShapeBlock=null,this.numBlocksFlattened=0,this.numEntitiesFiltered=0}Build(e,t){return yr(this,null,function*(){let s=e.header||{};for(let[a,i]of Object.entries(s))a.startsWith("$")&&this.vars.set(a.slice(1),i);if(this.angBase=this.vars.get("ANGBASE")??0,this.angDir=this.vars.get("ANGDIR")??0,this.pdSize=this.vars.get("PDSIZE")??0,this.isMetric=(this.vars.get("MEASUREMENT")??1)==1,e.tables&&e.tables.layer)for(let[,a]of Object.entries(e.tables.layer.layers))a.displayName=Kc(a.name),this.layers.set(a.name,a);if(e.tables&&e.tables.dimstyle)for(let[,a]of Object.entries(e.tables.dimstyle.dimStyles))this.dimStyles.set(a.name,a);if(e.tables&&e.tables.style)for(let[,a]of Object.entries(e.tables.style.styles))this.fontStyles.set(a.styleName,a);if(e.blocks)for(let[,a]of Object.entries(e.blocks))this.blocks.set(a.name,new ty(a));this.textRenderer=new K7(t,this.options.textOptions),this.hasMissingChars=!1,yield this._FetchFonts(e);for(let a of e.entities)this._FilterEntity(a)&&(a.type==="INSERT"?(this.inserts.set(a.handle,a),this.blocks.get(a.name)?.RegisterInsert(a)):a.type=="DIMENSION"&&(a.block??null)!==null&&this.blocks.get(a.block)?.RegisterInsert(a));for(let a of this.blocks.values()){if(a.data.hasOwnProperty("entities")){let i=a.DefinitionContext();for(let f of a.data.entities)this._FilterEntity(f)&&this._ProcessDxfEntity(f,i)}a.SetFlatten()&&this.numBlocksFlattened++}console.log(`${this.numBlocksFlattened} blocks flattened`);for(let a of e.entities){if(!this._FilterEntity(a)){this.numEntitiesFiltered++;continue}this._ProcessDxfEntity(a)}console.log(`${this.numEntitiesFiltered} entities filtered`),this.scene=this._BuildScene(),delete this.batches,delete this.layers,delete this.blocks,delete this.textRenderer})}_FilterEntity(e){return!this.options.suppressPaperSpace||!e.inPaperSpace}_FetchFonts(e){return yr(this,null,function*(){function t(a){return a.type==="TEXT"||a.type==="MTEXT"||a.type==="DIMENSION"||a.type==="ATTDEF"||a.type==="ATTRIB"}let s=a=>yr(this,null,function*(){if(!this._FilterEntity(a))return;let i;if(a.type==="TEXT"||a.type==="ATTRIB"||a.type==="ATTDEF")i=yield this.textRenderer.FetchFonts(Kc(a.text));else if(a.type==="MTEXT"){let f=new j0;f.Parse(a.text),i=!0;for(let v of f.GetText())if(!(yield this.textRenderer.FetchFonts(Kc(v)))){i=!1;break}}else if(a.type==="DIMENSION"){i=!0;let f=this._CreateLinearDimension(a);if(f){for(let v of f.GetTexts())if(!(yield this.textRenderer.FetchFonts(v))){i=!1;break}}}else throw new Error("Bad entity type");return i||(this.hasMissingChars=!0),i});for(let a of e.entities)if(t(a)&&!(yield s(a)))return;for(let a of this.blocks.values())if(a.data.hasOwnProperty("entities")){for(let i of a.data.entities)if(t(i)&&!(yield s(i)))return}})}_ProcessDxfEntity(e,t=null){let s;switch(e.type){case"LINE":s=this._DecomposeLine(e,t);break;case"POLYLINE":case"LWPOLYLINE":s=this._DecomposePolyline(e,t);break;case"ARC":s=this._DecomposeArc(e,t);break;case"CIRCLE":s=this._DecomposeCircle(e,t);break;case"ELLIPSE":s=this._DecomposeEllipse(e,t);break;case"POINT":s=this._DecomposePoint(e,t);break;case"SPLINE":s=this._DecomposeSpline(e,t);break;case"INSERT":this._ProcessInsert(e,t);return;case"TEXT":s=this._DecomposeText(e,t);break;case"MTEXT":s=this._DecomposeMText(e,t);break;case"3DFACE":s=this._Decompose3DFace(e,t);break;case"SOLID":s=this._DecomposeSolid(e,t);break;case"DIMENSION":s=this._DecomposeDimension(e,t);break;case"ATTRIB":s=this._DecomposeAttribute(e,t);break;case"HATCH":s=this._DecomposeHatch(e,t);break;default:console.log("Unhandled entity type: "+e.type);return}for(let a of s)this._ProcessEntity(a,t)}_ProcessEntity(e,t=null){switch(e.type){case Un.Type.POINTS:this._ProcessPoints(e,t);break;case Un.Type.LINE_SEGMENTS:this._ProcessLineSegments(e,t);break;case Un.Type.POLYLINE:this._ProcessPolyline(e,t);break;case Un.Type.TRIANGLES:this._ProcessTriangles(e,t);break;default:throw new Error("Unhandled entity type: "+e.type)}}_GetLineType(e,t=null,s=null){return 0}_IsPlainLine(e){return!(e.startWidth||e.endWidth)}*_DecomposeLine(e,t){if(e.vertices.length!==2)return;let s=this._GetEntityLayer(e,t),a=this._GetEntityColor(e,t);yield new Un({type:Un.Type.LINE_SEGMENTS,vertices:e.vertices,layer:s,color:a,lineType:this._GetLineType(e,e.vertices[0])})}_GenerateBulgeVertices(e,t,s,a){let i=4*Math.atan(a),f=Math.abs(i);if(f<this.options.arcTessellationAngle){e.push(new ui(s.x,s.y));return}let v=i/2,x=Math.sin(v),M=Math.cos(v),C={x:s.x-t.x,y:s.y-t.y},D=C.x*C.x+C.y*C.y;if(D<Number.MIN_VALUE*2)return;let L=Math.sqrt(D),N=L/2/x;C.x/=L,C.y/=L;let j={x:(C.x*x-C.y*M)*N+t.x,y:(C.x*M+C.y*x)*N+t.y},Z=Math.floor(f/this.options.arcTessellationAngle);if(Z<this.options.minArcTessellationSubdivisions&&(Z=this.options.minArcTessellationSubdivisions),Z>1){let G=Math.atan2(t.y-j.y,t.x-j.x),H=i/Z;i<0&&(N=-N);for(let me=1;me<Z;me++){let ne=G+me*H,fe=new ui(j.x+N*Math.cos(ne),j.y+N*Math.sin(ne));e.push(fe)}}e.push(new ui(s.x,s.y))}_GenerateArcVertices({vertices:e,center:t,radius:s,startAngle:a=null,endAngle:i=null,tessellationAngle:f=null,yRadius:v=null,transform:x=null,rotation:M=null,ccwAngleDir:C=!0}){if(!t||!s)return;f||(f=this.options.arcTessellationAngle),v===null&&(v=s),a==null?a=0:a+=this.angBase;let D=!1;if(i==null?(i=a+2*Math.PI,D=!0):i+=this.angBase,!C){let G=a;a=-i,i=-G}for(;i<=a;)i+=Math.PI*2;let L=i-a,N=Math.floor(L/f);N===0&&(N=1);let j=L/N,Z=null;M&&(Z=new Bn().makeRotation(M));for(let G=0;G<=N&&!(G===N&&D);G++){let H;C?H=a+G*j:H=a+(N-G)*j;let me=new ui(s*Math.cos(H),v*Math.sin(H));Z&&me.applyMatrix3(Z),me.add(t),x&&me.applyMatrix3(x),e.push(me)}}*_DecomposeArc(e,t){let s=this._GetEntityColor(e,t),a=this._GetEntityLayer(e,t),i=this._GetLineType(e,null,t),f=[];this._GenerateArcVertices({vertices:f,center:e.center,radius:e.radius,startAngle:e.startAngle,endAngle:e.endAngle,transform:this._GetEntityExtrusionTransform(e)}),yield new Un({type:Un.Type.POLYLINE,vertices:f,layer:a,color:s,lineType:i,shape:e.endAngle===void 0})}*_DecomposeCircle(e,t){let s=this._GetEntityColor(e,t),a=this._GetEntityLayer(e,t),i=this._GetLineType(e,null,t),f=[];this._GenerateArcVertices({vertices:f,center:e.center,radius:e.radius,transform:this._GetEntityExtrusionTransform(e)}),yield new Un({type:Un.Type.POLYLINE,vertices:f,layer:a,color:s,lineType:i,shape:!0})}*_DecomposeEllipse(e,t){let s=this._GetEntityColor(e,t),a=this._GetEntityLayer(e,t),i=this._GetLineType(e,null,t),f=[],v=Math.sqrt(e.majorAxisEndPoint.x*e.majorAxisEndPoint.x+e.majorAxisEndPoint.y*e.majorAxisEndPoint.y),x=v*e.axisRatio,M=Math.atan2(e.majorAxisEndPoint.y,e.majorAxisEndPoint.x),C=e.startAngle??0,D=e.endAngle??C+2*Math.PI;for(;D<=C;)D+=Math.PI*2;let L=(e.endAngle??null)===null||Math.abs(D-C-2*Math.PI)<1e-6;this._GenerateArcVertices({vertices:f,center:e.center,radius:v,startAngle:e.startAngle,endAngle:L?null:e.endAngle,yRadius:x,rotation:M,ccwAngleDir:!this._GetEntityExtrusionTransform(e)}),yield new Un({type:Un.Type.POLYLINE,vertices:f,layer:a,color:s,lineType:i,shape:L})}*_DecomposePoint(e,t){if(this.pdMode===xa.NONE||this.pdMode!==xa.DOT&&this.pdSize<=0)return;let s=this._GetEntityColor(e,t),a=this._GetEntityLayer(e,t),i=this.pdMode&xa.MARK_MASK;if((this.pdMode&xa.SHAPE_MASK)!==0){let x=new sr(a,lk,sr.GeometryType.POINT_INSTANCE,s,0);this._GetBatch(x).PushVertex(this._TransformVertex(e.position)),this._CreatePointShapeBlock();return}if(i===xa.DOT){yield new Un({type:Un.Type.POINTS,vertices:[e.position],layer:a,color:s,lineType:null});return}let v=[];this._CreatePointMarker(v,i,e.position),yield new Un({type:Un.Type.LINE_SEGMENTS,vertices:v,layer:a,color:s,lineType:null})}*_DecomposeAttribute(e,t){if(!this.textRenderer.canRender)return;let s=this.inserts.get(e.ownerHandle),a=this._GetEntityLayer(s??e,t),i=this._GetEntityColor(s??e,t);yield*ws(this.textRenderer.Render({text:Kc(e.text),fontSize:e.textHeight*e.scale,startPos:e.startPoint,endPos:e.endPoint,rotation:e.rotation,hAlign:e.horizontalJustification,vAlign:e.verticalJustification,color:i,layer:a}))}_CreatePointMarker(e,t,s=null){let a=this;function i(f,v){e.push({x:(s?.x??0)+f*a.pdSize*.5,y:(s?.y??0)+v*a.pdSize*.5})}switch(t){case xa.PLUS:i(0,1.5),i(0,-1.5),i(-1.5,0),i(1.5,0);break;case xa.CROSS:i(-1,1),i(1,-1),i(1,1),i(-1,-1);break;case xa.TICK:i(0,1),i(0,0);break;default:console.warn("Unsupported point display type: "+t)}}_CreatePointShapeBlock(){if(this.pointShapeBlock)return;this.pointShapeBlock=new ty({name:lk,position:{x:0,y:0}}),this.pointShapeBlock.offset=new ui(0,0);let e=this.pointShapeBlock.DefinitionContext(),t=this.pdMode&xa.MARK_MASK;if(t!==xa.DOT&&t!==xa.NONE){let s=[];this._CreatePointMarker(s,t);let a=new Un({type:Un.Type.LINE_SEGMENTS,vertices:s,color:fl.BY_BLOCK});this._ProcessEntity(a,e)}if(this.pdMode&xa.SQUARE){let s=this.pdSize*.5,a=[{x:-s,y:s},{x:s,y:s},{x:s,y:-s},{x:-s,y:-s}],i=new Un({type:Un.Type.POLYLINE,vertices:a,color:fl.BY_BLOCK,shape:!0});this._ProcessEntity(i,e)}if(this.pdMode&xa.CIRCLE){let s=[];this._GenerateArcVertices({vertices:s,center:{x:0,y:0},radius:this.pdSize*.5,tessellationAngle:aY});let a=new Un({type:Un.Type.POLYLINE,vertices:s,color:fl.BY_BLOCK,shape:!0});this._ProcessEntity(a,e)}}*_Decompose3DFace(e,t){yield*ws(this._DecomposeFace(e,e.vertices,t,this.options.wireframeMesh))}*_DecomposeSolid(e,t){yield*ws(this._DecomposeFace(e,e.points,t,!1,this._GetEntityExtrusionTransform(e)))}*_DecomposeFace(e,t,s,a,i=null){let f=this._GetEntityLayer(e,s),v=this._GetEntityColor(e,s);function x(Z,G,H){let me=new ui().subVectors(G,Z),ne=new ui().subVectors(H,Z);return Math.abs(me.cross(ne))>Number.EPSILON}let M=new ui(t[0].x,t[0].y),C=new ui(t[1].x,t[1].y),D=new ui(t[2].x,t[2].y),L=null,N=x(M,C,D),j=!1;if(t.length>3&&(L=new ui(t[3].x,t[3].y),j=x(C,L,D),i&&L.applyMatrix3(i)),i&&(M.applyMatrix3(i),C.applyMatrix3(i),D.applyMatrix3(i)),!(!N&&!j))if(a){let Z=[];N&&!j?Z.push(M,C,D):!N&&j?Z.push(C,L,D):Z.push(M,C,L,D),yield new Un({type:Un.Type.POLYLINE,vertices:Z,layer:f,color:v,shape:!0})}else{let Z=[],G=[];N&&(Z.push(M,C,D),G.push(0,1,2)),j&&(N?G.push(1,2,3):(Z.push(C,D),G.push(0,1,2)),Z.push(L)),yield new Un({type:Un.Type.TRIANGLES,vertices:Z,indices:G,layer:f,color:v})}}*_DecomposeText(e,t){if(!this.textRenderer.canRender)return;let s=this._GetEntityLayer(e,t),a=this._GetEntityColor(e,t);yield*ws(this.textRenderer.Render({text:Kc(e.text),fontSize:e.textHeight,startPos:e.startPoint,endPos:e.endPoint,rotation:e.rotation,hAlign:e.halign,vAlign:e.valign,widthFactor:e.xScale,color:a,layer:s}))}*_DecomposeMText(e,t){if(!this.textRenderer.canRender)return;let s=this._GetEntityLayer(e,t),a=this._GetEntityColor(e,t),i=new j0;i.Parse(Kc(e.text)),yield*ws(this.textRenderer.RenderMText({formattedText:i.GetContent(),fontSize:e.height,position:e.position,rotation:e.rotation,direction:e.direction,attachment:e.attachmentPoint,lineSpacing:e.lineSpacing,width:e.width,color:a,layer:s}))}_CreateLinearDimension(e){let t=(e.dimensionType||0)&15;if(t!=0&&t!=1||!e.linearOrAngularPoint1||!e.linearOrAngularPoint2||!e.anchorPoint)return null;let s=null;e.hasOwnProperty("styleName")&&(s=this.dimStyles.get(e.styleName));let a=new J6({p1:new ui().copy(e.linearOrAngularPoint1),p2:new ui().copy(e.linearOrAngularPoint2),anchor:new ui().copy(e.anchorPoint),isAligned:t==1,angle:e.angle,text:e.text,textAnchor:e.middleOfText?new ui().copy(e.middleOfText):null,textRotation:e.textRotation},i=>this._GetDimStyleValue(i,e,s),(i,f)=>this.textRenderer.GetLineWidth(i,f));return a.IsValid?a:(console.warn("Invalid dimension geometry detected for "+e.handle),null)}*_DecomposeDimension(e,t){if((e.block??null)!==null&&this.blocks.has(e.block)){let x={name:e.block,position:{x:0,y:0},layer:e.layer,color:e.color,colorIndex:e.colorIndex};this._ProcessInsert(x,t);return}let s=this._CreateLinearDimension(e);if(!s)return;let a=this._GetEntityLayer(e,t),i=this._GetEntityColor(e,t),f=this._GetEntityExtrusionTransform(e),v=s.GenerateLayout();for(let x of v.lines){let M=[];f&&(x.start.applyMatrix3(f),x.end.applyMatrix3(f)),M.push(x.start,x.end),yield new Un({type:Un.Type.LINE_SEGMENTS,vertices:M,layer:a,color:x.color??i})}for(let x of v.triangles){if(f)for(let M of x.vertices)M.applyMatrix3(f);yield new Un({type:Un.Type.TRIANGLES,vertices:x.vertices,indices:x.indices,layer:a,color:x.color??i})}if(this.textRenderer.canRender)for(let x of v.texts)f&&x.position.applyMatrix3(f),yield*ws(this.textRenderer.Render({text:x.text,fontSize:x.size,startPos:x.position,rotation:x.angle,hAlign:pl.CENTER,vAlign:W0.MIDDLE,color:x.color??i,layer:a}))}*_DecomposeHatch(e,t){if(e.isSolid)return;let s=e.hatchStyle??0;if(s!=ey.ODD_PARITY&&s!=ey.THROUGH_ENTIRE_AREA)return;let a=this._GetHatchBoundaryLoops(e);if(a.length==0){console.warn("HATCH entity with empty boundary loops array (perhaps some loop types are not implemented yet)");return}let i=new Q6(a,s),f=this._GetEntityLayer(e,t),v=this._GetEntityColor(e,t),x=this._GetEntityExtrusionTransform(e),M=null;if(e.patternName&&(M=t9(e.patternName,this.isMetric),M||console.log(`Hatch pattern with name ${e.patternName} not found (metric: ${this.isMetric})`)),M==null&&e.definitionLines&&(M=new ee(e.definitionLines,null,!1)),M==null&&(M=t9("ANSI31")),!M)return;let C=e.seedPoints?e.seedPoints:[{x:0,y:0}];for(let N of C){let j=i.GetPatternTransform({seedPoint:N,angle:e.patternAngle,scale:e.patternScale});for(let Z of M.lines){let G,H;if(M.offsetInLineSpace)G=Z.offset.x,H=Z.offset.y;else{let De=Math.sin(-(Z.angle??0)),se=Math.cos(-(Z.angle??0));G=Z.offset.x*se-Z.offset.y*De,H=Z.offset.x*De+Z.offset.y*se}H<0&&(H=-H,G=-G);let me=i.GetLineTransform({patTransform:j,basePoint:Z.base,angle:Z.angle??0}),ne=i.GetBoundingBox(me),fe=(ne.max.x-ne.min.x)*.05,Ee,de;if(H==0?(Ee=0,de=0):(Ee=Math.ceil(ne.min.y/H),de=Math.floor(ne.max.y/H)),de-Ee>cY){console.warn("Too many lines produced by hatching pattern");continue}let we;if(Z.dashes&&Z.dashes.length>1){we=0;for(let De of Z.dashes)De<0?we-=De:we+=De}else we=null;let Le=me.clone().invert();for(let De=Ee;De<=de;De++){let Tt=function(Yt){return(Yt-Ne)/Ge},Nt=function(Yt){let Wi=Ot.clone().multiplyScalar(Yt[0]).add(Xe),wt=Ot.clone().multiplyScalar(Yt[1]).add(Xe);return x&&(Wi.applyMatrix3(x),wt.applyMatrix3(x)),Yt[1]-Yt[0]<=Number.EPSILON?new Un({type:Un.Type.POINTS,vertices:[Wi],layer:f,color:v}):new Un({type:Un.Type.LINE_SEGMENTS,vertices:[Wi,wt],layer:f,color:v})};var D=Tt,L=Nt;let se=De*H,Ce=De*G,Ne=ne.min.x-fe,zt=ne.max.x+fe,Ge=zt-Ne,Xe=new ui(Ne,se).applyMatrix3(Le),ht=new ui(zt,se).applyMatrix3(Le),Ot=ht.clone().sub(Xe),bt=i.ClipLine([Xe,ht]);function*Bt(Yt,Wi){for(let wt of bt){if(wt[0]>=Wi)return;if(wt[1]<=Yt)continue;let ei=Math.max(Yt,wt[0]),vi=Math.min(Wi,wt[1]);yield[ei,vi],Yt=vi}}if(we!==null){let Yt=Math.floor((Ne-Ce)/we),Wi=Math.floor((zt-Ce)/we);if(Wi-Yt>=hY){console.warn("Too many segments produced by hatching pattern line");continue}for(let wt=Yt;wt<=Wi;wt++){let ei=Tt(Ce+wt*we);for(let vi of Z.dashes){let Pi=vi<0;Pi&&(vi=-vi);let Fi=vi/Ge;if(!Pi)for(let Ri of Bt(ei,ei+Fi))yield Nt(Ri);ei+=Fi}}}else for(let Yt of bt)yield Nt(Yt)}}}}_GetHatchBoundaryLoops(e){if(!e.boundaryLoops)return[];let t=[],s=(a,i)=>{let f=i.length;if(f!=0){if(a.length==0)a.push(i[0]);else{let v=a[a.length-1];(v.x!=i[0].x||v.y!=i[0].y)&&a.push(i[0])}for(let v=1;v<f;v++)a.push(i[v])}};for(let a of e.boundaryLoops){let i=[];if(a.type&2)for(let f=0;f<a.polyline.vertices.length;f++){let v=a.polyline.vertices[f];if((v.bulge??0)==0)i.push(new ui(v.x,v.y));else{(a.polyline.vertices[f==0?a.polyline.vertices.length-1:f-1].bulge??0)==0&&i.push(new ui(v.x,v.y));let M=a.polyline.vertices[f==a.polyline.vertices.length-1?0:f+1];this._GenerateBulgeVertices(i,v,M,v.bulge)}}else if(a.edges&&a.edges.length>0)for(let f of a.edges)switch(f.type){case 1:s(i,[new ui(f.start.x,f.start.y),new ui(f.end.x,f.end.y)]);break;case 2:{let C=[];this._GenerateArcVertices({vertices:C,center:f.start,radius:f.radius,startAngle:f.startAngle,endAngle:f.endAngle,ccwAngleDir:f.isCcw}),s(i,C);break}case 3:{let C=f.start,D=f.end,L=Math.sqrt(D.x*D.x+D.y*D.y),N=f.radius,j=L*N,Z=Math.atan2(D.y,D.x),G=[];if(this._GenerateArcVertices({vertices:G,center:C,radius:L,startAngle:f.startAngle,endAngle:f.endAngle,yRadius:j,ccwAngleDir:f.isCcw}),Z!==0){let H=Math.cos(Z),me=Math.sin(Z);for(let ne of G){let fe=ne.x-C.x,Ee=ne.y-C.y;ne.x=fe*H-Ee*me+C.x,ne.y=fe*me+Ee*H+C.y}}s(i,G);break}case 4:let v=f.controlPoints.map(C=>[C.x,C.y]),x=v.length*ck,M=1/x;for(let C=0;C<=x;C++){let D=this._InterpolateSpline(C*M,f.degreeOfSplineCurve,v,f.knotValues);i.push(new ui(D[0],D[1]))}break;default:console.warn("Unhandled hatch boundary loop edge type: "+f.type)}if(i.length>2){let f=i[0],v=i[i.length-1];v.x==f.x&&v.y==f.y&&(i.length=i.length-1)}i.length>2&&t.push(i)}return t}_GetDimStyleValue(e,t,s){let a=t?.xdata?.ACAD?.DSTYLE?.values;if(a){let i=!0,f=!1;for(let v of a){if(i){if(v.code!=1070)break;zg.get(v.value)==e&&(f=!0)}else if(f)return v.value;i=!i}}if(s&&s.hasOwnProperty(e))return s[e];if(this.vars.has(e))return this.vars.get(e);if(hk.hasOwnProperty(e)){let i=hk[e];return i instanceof Function?i.call(this):i}return null}_ProcessInsert(e,t=null){if(t){if(t.name===e.name){console.warn("Recursive block reference: "+t.name);return}let M=this.blocks.get(e.name);if(!M){console.warn("Unresolved nested block reference: "+e.name);return}let C=t.NestedBlockContext(M,e);if(M.data.entities)for(let D of M.data.entities)this._ProcessDxfEntity(D,C);return}let s=this.blocks.get(e.name);if(!s){console.warn("Unresolved block reference in INSERT: "+e.name);return}if(!s.HasGeometry())return;let a=this._GetEntityLayer(e,null),i=this._GetEntityColor(e,null),f=this._GetLineType(e,null,null),v=s.InstantiationContext().GetInsertionTransform(e),x=s.bounds;if(this._UpdateBounds(new ui(x.minX,x.minY).applyMatrix3(v)),this._UpdateBounds(new ui(x.maxX,x.maxY).applyMatrix3(v)),this._UpdateBounds(new ui(x.minX,x.maxY).applyMatrix3(v)),this._UpdateBounds(new ui(x.maxX,x.minY).applyMatrix3(v)),v.translate(-this.origin.x,-this.origin.y),s.flatten)for(let M of s.batches)this._FlattenBatch(M,a,i,f,v);else{let M=new sr(a,e.name,sr.GeometryType.BLOCK_INSTANCE,i,f);this._GetBatch(M).PushInstanceTransform(v)}}_FlattenBatch(e,t,s,a,i){let f=this.layers.get(t),v,x=0;e.key.color===fl.BY_BLOCK?v=s:e.key.color===fl.BY_LAYER?v=f?.color??0:v=e.key.color;let M=new sr(t,null,e.key.geometryType,v,x);this._GetBatch(M).Merge(e,i)}*_GenerateShapedPolyline(e,t,s,a,i){yield new Un({type:Un.Type.POLYLINE,vertices:e,layer:t,color:s,lineType:a,shape:i})}_MirrorEntityVertices(e,t=null){if(!e.extrusionDirection||e.extrusionDirection.z>=0)return t??e.vertices;(!t||t===e.vertices)&&(t=e.vertices.slice());let s=t.length;for(let a=0;a<s;a++){let i=t[a],f={x:-i.x};for(let v in i)i.hasOwnProperty(v)&&v!=="x"&&(f[v]=i[v]);t[a]=f}return t}*_DecomposePolyline(e,t=null){if(e.isPolyfaceMesh){yield*ws(this._DecomposePolyfaceMesh(e,t));return}let s,a;if(e.includesCurveFitVertices||e.includesSplineFitVertices?(s=e.vertices.filter(N=>N.splineVertex||N.curveFittingVertex),a=s.length):(s=e.vertices,a=e.vertices.length),a<2)return;s=this._MirrorEntityVertices(e,s);let i=this._GetEntityColor(e,t),f=this._GetEntityLayer(e,t),v=this,x=0,M=this._IsPlainLine(s[0]),C=this._GetLineType(e,s[0],t),D=null;function*L(N){if(N===x)return;let j=!1,Z=D;N===a&&x===0?(j=!0,Z===null&&(Z=s)):N===a-1&&x===0?Z===null&&(Z=s):N===a?Z===null&&(Z=s.slice(x,N),Z.push(s[0])):Z===null&&(Z=s.slice(x,N+1)),M?yield new Un({type:Un.Type.POLYLINE,vertices:Z,layer:f,color:i,lineType:C,shape:j}):yield*ws(v._GenerateShapedPolyline(Z,f,i,C,j)),x=N,N!==a&&(M=v._IsPlainLine(s[N]),C=v._GetLineType(e,s[N])),D=null}for(let N=1;N<=a;N++){let j=s[N-1],Z;if(N===a){if(!e.shape){yield*ws(L(N-1));break}Z=s[0]}else Z=s[N];if(j.bulge&&M?(D===null&&(D=s.slice(x,N)),this._GenerateBulgeVertices(D,j,Z,j.bulge)):D!==null&&D.push(Z),N===a){yield*ws(L(N));break}let G=this._IsPlainLine(Z),H=this._GetLineType(e,Z);(G!==M||M&&H!==C)&&(yield*ws(L(N)))}}*_DecomposePolyfaceMesh(e,t=null){let s=this._GetEntityLayer(e,t),a=this._GetEntityColor(e,t),i=[],f=[];for(let M of e.vertices)if(M.faces){let C={indices:[],hiddenEdges:[]};for(let D of M.faces){if(D==0)break;C.indices.push(D<0?-D-1:D-1),C.hiddenEdges.push(D<0)}(C.indices.length==3||C.indices.length==4)&&f.push(C)}else i.push(new ui(M.x,M.y));let v=[],x=(M,C)=>{if(v.length>0){let D=v[v.length-1];if(D.indices[D.indices.length-1]==M){D.indices.push(C);return}D.indices[0]==D.indices[D.indices.length-1]&&(D.isClosed=!0)}v.push({indices:[M,C],isClosed:!1})};for(let M of f)if(this.options.wireframeMesh)for(let C=0;C<M.indices.length;C++){if(M.hiddenEdges[C])continue;let D=C<M.indices.length-1?C+1:0;x(M.indices[C],M.indices[D])}else{let C;M.indices.length==3?C=M.indices:C=[M.indices[0],M.indices[1],M.indices[2],M.indices[0],M.indices[2],M.indices[3]],yield new Un({type:Un.Type.TRIANGLES,vertices:i,indices:C,layer:s,color:a})}if(this.options.wireframeMesh)for(let M of v)if(M.length==2)yield new Un({type:Un.Type.LINE_SEGMENTS,vertices:[i[M.indices[0]],i[M.indices[1]]],layer:s,color:a});else{let C=[];for(let D of M.indices)C.push(i[D]);yield new Un({type:Un.Type.POLYLINE,vertices:C,layer:s,color:a,shape:M.isClosed})}}*_DecomposeSpline(e,t=null){let s=this._GetEntityColor(e,t),a=this._GetEntityLayer(e,t),i=this._GetLineType(e,null,t);if(!e.controlPoints)return;let f=e.controlPoints.map(C=>[C.x,C.y]),v=[],x=f.length*ck,M=1/x;for(let C=0;C<=x;C++){let D=this._InterpolateSpline(C*M,e.degreeOfSplineCurve,f,e.knotValues);v.push({x:D[0],y:D[1]})}yield new Un({type:Un.Type.POLYLINE,vertices:v,layer:a,color:s,lineType:i})}_InterpolateSpline(e,t,s,a=null,i=null){let f,v,x,M,C=s.length,D=s[0].length;if(t<1)throw new Error("Degree must be at least 1 (linear)");if(t>C-1)throw new Error("Degree must be less than or equal to point count - 1");if(!i)for(i=[],f=0;f<C;f++)i[f]=1;if(a){if(a.length!==C+t+1)throw new Error("Bad knot vector length")}else for(a=[],f=0;f<C+t+1;f++)a[f]=f;let L=[t,a.length-1-t],N=a[L[0]],j=a[L[1]];for(e=e*(j-N)+N,e<N?e=N:e>j&&(e=j),x=L[0];x<L[1]&&!(e>=a[x]&&e<=a[x+1]);x++);let Z=[];for(f=0;f<C;f++){for(Z[f]=[],v=0;v<D;v++)Z[f][v]=s[f][v]*i[f];Z[f][D]=i[f]}let G;for(M=1;M<=t+1;M++)for(f=x;f>x-t-1+M;f--)for(G=(e-a[f])/(a[f+t+1-M]-a[f]),v=0;v<D+1;v++)Z[f][v]=(1-G)*Z[f-1][v]+G*Z[f][v];let H=[];for(f=0;f<D;f++)H[f]=Z[x][f]/Z[x][D];return H}_ProcessPoints(e,t=null){let s=new sr(e.layer,t?.name,sr.GeometryType.POINTS,e.color,0),a=this._GetBatch(s);for(let i of e.vertices)a.PushVertex(this._TransformVertex(i,t))}_ProcessLineSegments(e,t=null){if(e.vertices.length%2!==0)throw Error("Even number of vertices expected");let s=new sr(e.layer,t?.name,sr.GeometryType.LINES,e.color,e.lineType),a=this._GetBatch(s);for(let i of e.vertices)a.PushVertex(this._TransformVertex(i,t))}_ProcessPolyline(e,t=null){if(e.vertices.length<2)return;let s=e.vertices.length;if(s<=3){let f=new sr(e.layer,t?.name,sr.GeometryType.LINES,e.color,e.lineType),v=this._GetBatch(f),x=null;for(let M of e.vertices)x!==null&&(v.PushVertex(this._TransformVertex(x,t)),v.PushVertex(this._TransformVertex(M,t))),x=M;e.shape&&s>2&&(v.PushVertex(this._TransformVertex(e.vertices[s-1],t)),v.PushVertex(this._TransformVertex(e.vertices[0],t)));return}let a=new sr(e.layer,t?.name,sr.GeometryType.INDEXED_LINES,e.color,e.lineType),i=this._GetBatch(a);for(let f of e._IterateLineChunks()){let v=i.PushChunk(f.verticesCount);for(let x of f.vertices)v.PushVertex(this._TransformVertex(x,t));for(let x of f.indices)v.PushIndex(x);v.Finish()}}_ProcessTriangles(e,t=null){if(e.vertices.length<3)return;if(e.indices.length%3!==0){console.error("Unexpected size of indices array: "+e.indices.length);return}let s=new sr(e.layer,t?.name,sr.GeometryType.INDEXED_TRIANGLES,e.color,0),i=this._GetBatch(s).PushChunk(e.vertices.length);for(let f of e.vertices)i.PushVertex(this._TransformVertex(f,t));for(let f of e.indices)i.PushIndex(f);i.Finish()}_GetEntityColor(e,t=null){let s=fl.BY_LAYER;if(e.colorIndex===0?s=fl.BY_BLOCK:e.colorIndex===256?s=fl.BY_LAYER:e.hasOwnProperty("color")&&(s=e.color),t)return s;if(s===fl.BY_LAYER||s===fl.BY_BLOCK){if(e.hasOwnProperty("layer")){let a=this.layers.get(e.layer);if(a)return a.color}}else return s;return 0}_GetEntityLayer(e,t=null){return t?null:e.hasOwnProperty("layer")?e.layer:"0"}_GetEntityExtrusionTransform(e){return!e.hasOwnProperty("extrusionDirection")||e.extrusionDirection.z>0?null:new Bn().scale(-1,1)}_GetBatch(e){let t=this.batches.find({key:e});if(t!==null)return t;if(t=new n9(e),this.batches.insert(t),e.blockName!==null&&!e.IsInstanced()){let s=this.blocks.get(e.blockName);s&&s.batches.push(t)}return t}_TransformVertex(e,t=null){return t?t.TransformVertex(e):(this._UpdateBounds(e),{x:e.x-this.origin.x,y:e.y-this.origin.y})}_UpdateBounds(e){this.bounds===null?this.bounds={minX:e.x,maxX:e.x,minY:e.y,maxY:e.y}:(e.x<this.bounds.minX?this.bounds.minX=e.x:e.x>this.bounds.maxX&&(this.bounds.maxX=e.x),e.y<this.bounds.minY?this.bounds.minY=e.y:e.y>this.bounds.maxY&&(this.bounds.maxY=e.y)),this.origin===null&&(this.origin={x:e.x,y:e.y})}_BuildScene(){let e=0,t=0,s=0;this.batches.each(f=>{e+=f.GetVerticesBufferSize(),t+=f.GetIndicesBufferSize(),s+=f.GetTransformsSize()});let a={vertices:new ArrayBuffer(e),indices:new ArrayBuffer(t),transforms:new ArrayBuffer(s),batches:[],layers:[],origin:this.origin,bounds:this.bounds,hasMissingChars:this.hasMissingChars},i={vertices:new Float32Array(a.vertices),verticesOffset:0,indices:new Uint16Array(a.indices),indicesOffset:0,transforms:new Float32Array(a.transforms),transformsOffset:0};this.batches.each(f=>{a.batches.push(f.Serialize(i))});for(let f of this.layers.values())a.layers.push({name:f.name,displayName:f.displayName,color:f.color});return a.pointShapeHasDot=(this.pdMode&xa.MARK_MASK)===xa.DOT,a}},n9=class{constructor(e){this.key=e,e.IsIndexed()?this.chunks=[]:e.geometryType===sr.GeometryType.BLOCK_INSTANCE?this.transforms=new Zu(Va.FLOAT32):this.vertices=new Zu(Va.FLOAT32)}PushVertex(e){let t=this.vertices.Push(e.x);return this.vertices.Push(e.y),t}PushInstanceTransform(e){for(let t=0;t<2;t++)for(let s=0;s<3;s++)this.transforms.Push(e.elements[s*3+t])}PushChunk(e){if(e>Qu)throw new Error("Vertices count exceeds chunk limit: "+e);let t=null,s=0;for(let a of this.chunks){let i=Qu-a.vertices.GetSize()/2;i<e||(t===null||i<s)&&(t=a,s=i)}return t===null&&(t=this._NewChunk(e)),new s9(t,e)}Merge(e,t=null){if(this.key.geometryType!==e.key.geometryType)throw new Error(`Rendering batch merging geometry type mismatch: ${this.key.geometryType} !== ${e.key.geometryType}`);if(this.key.IsInstanced())throw new Error("Attempted to merge instanced batch");if(this.key.IsIndexed())for(let s of e.chunks){let a=s.vertices.size,i=this.PushChunk(a/2);for(let v=0;v<a;v+=2){let x=new ui(s.vertices.Get(v),s.vertices.Get(v+1));t&&x.applyMatrix3(t),i.PushVertex(x)}let f=s.indices.size;for(let v=0;v<f;v++)i.PushIndex(s.indices.Get(v));i.Finish()}else{let s=e.vertices.size;for(let a=0;a<s;a+=2){let i=new ui(e.vertices.Get(a),e.vertices.Get(a+1));t&&i.applyMatrix3(t),this.PushVertex(i)}}}GetVerticesBufferSize(){if(this.key.IsIndexed()){let e=0;for(let t of this.chunks)e+=t.vertices.GetSize();return e*Float32Array.BYTES_PER_ELEMENT}else return this.key.geometryType===sr.GeometryType.BLOCK_INSTANCE?0:this.vertices.GetSize()*Float32Array.BYTES_PER_ELEMENT}GetIndicesBufferSize(){if(this.key.IsIndexed()){let e=0;for(let t of this.chunks)e+=t.indices.GetSize();return e*Uint16Array.BYTES_PER_ELEMENT}else return 0}GetTransformsSize(){return this.key.geometryType===sr.GeometryType.BLOCK_INSTANCE?this.transforms.GetSize()*Float32Array.BYTES_PER_ELEMENT:0}Serialize(e){if(this.key.IsIndexed()){let t={key:this.key,chunks:[]};for(let s of this.chunks)t.chunks.push(s.Serialize(e));return t}else if(this.key.geometryType===sr.GeometryType.BLOCK_INSTANCE){let t=this.transforms.GetSize(),s={key:this.key,transformsOffset:e.transformsOffset,transformsSize:t};return this.transforms.CopyTo(e.transforms,e.transformsOffset),e.transformsOffset+=t,s}else{let t=this.vertices.GetSize(),s={key:this.key,verticesOffset:e.verticesOffset,verticesSize:t};return this.vertices.CopyTo(e.vertices,e.verticesOffset),e.verticesOffset+=t,s}}_NewChunk(e){let t=new r9(e);return this.chunks.push(t),t}},ty=class{constructor(e){this.data=e,this.useCount=0,this.nestedUseCount=0,this.verticesCount=0,this.offset=null,this.batches=[],this.flatten=!1,this.bounds=null}SetFlatten(){return this.HasGeometry()?(this.flatten=this.useCount===1||this.useCount*this.verticesCount<=lY,this.flatten):!1}HasGeometry(){return this.offset!==null}RegisterInsert(e){this.useCount++}RegisterNestedUse(e){this.nestedUseCount++}DefinitionContext(){return new ep(this,ep.Type.DEFINITION)}InstantiationContext(){return new ep(this,ep.Type.INSTANTIATION)}UpdateBounds(e){this.bounds===null?this.bounds={minX:e.x,maxX:e.x,minY:e.y,maxY:e.y}:(e.x<this.bounds.minX?this.bounds.minX=e.x:e.x>this.bounds.maxX&&(this.bounds.maxX=e.x),e.y<this.bounds.minY?this.bounds.minY=e.y:e.y>this.bounds.maxY&&(this.bounds.maxY=e.y))}},ep=class o{constructor(e,t){this.block=e,this.type=t,this.origin=this.block.data.position,this.transform=new Bn}get name(){return this.block.data.name}TransformVertex(e){let t=new ui(e.x,e.y).applyMatrix3(this.transform);if(this.type!==o.Type.DEFINITION&&this.type!==o.Type.NESTED_DEFINITION)throw new Error("Unexpected transform type");if(this.block.verticesCount++,this.block.offset===null){this.block.offset=t;let s=new ui;return this.block.UpdateBounds(s),s}return t.sub(this.block.offset),this.block.UpdateBounds(t),t}GetInsertionTransform(e){let t=new Bn().translate(-this.origin.x,-this.origin.y),s=e.yScale||1,a=e.xScale||1,i=-(e.rotation||0)*Math.PI/180,f=e.position.x,v=e.position.y;if(t.scale(a,s),t.rotate(i),t.translate(f,v),e.extrusionDirection&&e.extrusionDirection.z<0&&t.scale(-1,1),this.type!==o.Type.INSTANTIATION)return t;let x=new Bn().translate(this.block.offset.x,this.block.offset.y);return t.multiply(x)}NestedBlockContext(e,t){e.RegisterNestedUse(this.block);let a=new o(e,o.Type.NESTED_DEFINITION).GetInsertionTransform(t),i=new o(this.block,o.Type.NESTED_DEFINITION);return i.transform=new Bn().multiplyMatrices(this.transform,a),i}};ep.Type=Object.freeze({DEFINITION:0,NESTED_DEFINITION:1,INSTANTIATION:2});var r9=class{constructor(e){e<16&&(e=16),this.indices=new Zu(Va.UINT16,e*2),this.vertices=new Zu(Va.FLOAT32,e*2)}Serialize(e){let t={};{let s=this.vertices.GetSize();t.verticesOffset=e.verticesOffset,t.verticesSize=s,this.vertices.CopyTo(e.vertices,e.verticesOffset),e.verticesOffset+=s}{let s=this.indices.GetSize();t.indicesOffset=e.indicesOffset,t.indicesSize=s,this.indices.CopyTo(e.indices,e.indicesOffset),e.indicesOffset+=s}return t}},s9=class{constructor(e,t){this.chunk=e,this.verticesCount=t,this.verticesOffset=this.chunk.vertices.GetSize()/2,this.numVerticesPushed=0}PushVertex(e){if(this.numVerticesPushed===this.verticesCount)throw new Error;this.chunk.vertices.Push(e.x),this.chunk.vertices.Push(e.y),this.numVerticesPushed++}PushIndex(e){if(e<0||e>=this.verticesCount)throw new Error(`Index out of range: ${e}/${this.verticesCount}`);this.chunk.indices.Push(e+this.verticesOffset)}Finish(){if(this.numVerticesPushed!==this.verticesCount)throw new Error(`Not all vertices pushed: ${this.numVerticesPushed}/${this.verticesCount}`)}},Un=class{constructor({type:e,vertices:t,indices:s=null,layer:a=null,color:i,lineType:f=0,shape:v=!1}){this.type=e,this.vertices=t,this.indices=s,this.layer=a,this.color=i,this.lineType=f,this.shape=v}*_IterateVertices(e,t){for(let s=e;s<e+t;s++)yield this.vertices[s]}*_IterateLineChunks(){let e=this.vertices.length;if(e<2)return;let t=this;for(let s=0;s<=e;s+=Qu){let a=e-s,i;if(a>Qu?(a=Qu,i=!1):i=!0,i&&this.shape&&s>0&&a===Qu&&(i=!1),s===e&&!this.shape)break;let f,v,x;a<2?(a===1&&this.shape?f=function*(){yield this.vertices[s],yield this.vertices[0]}():a===1?f=function*(){yield this.vertices[s-1],yield this.vertices[s]}():f=function*(){yield this.vertices[e-1],yield this.vertices[0]}(),v=i9(2,!1),x=2):i&&this.shape&&s>0&&a<Qu?(f=function*(){yield*ws(t._IterateVertices(s,a)),yield this.vertices[0]}(),v=i9(a+1,!1),x=a+1):(f=this._IterateVertices(s,a),v=i9(a,i&&s===0&&this.shape),x=a),yield{verticesCount:x,vertices:f,indices:v}}}};Un.Type=Object.freeze({POINTS:0,LINE_SEGMENTS:1,POLYLINE:2,TRIANGLES:3});function*i9(o,e){for(let t=0;t<o-1;t++)yield t,yield t+1;e&&o>2&&(yield o-1,yield 0)}var xa=Object.freeze({DOT:0,NONE:1,PLUS:2,CROSS:3,TICK:4,MARK_MASK:15,CIRCLE:32,SQUARE:64,SHAPE_MASK:240}),fl=Object.freeze({BY_LAYER:-1,BY_BLOCK:-2});tp.DefaultOptions={arcTessellationAngle:10/180*Math.PI,minArcTessellationSubdivisions:8,wireframeMesh:!1,suppressPaperSpace:!1,textOptions:K7.DefaultOptions};String.prototype.codePointAt||function(){var o=function(){try{var t={},s=Object.defineProperty,a=s(t,t,t)&&s}catch{}return a}(),e=function(t){if(this==null)throw TypeError();var s=String(this),a=s.length,i=t?Number(t):0;if(i!=i&&(i=0),!(i<0||i>=a)){var f=s.charCodeAt(i),v;return f>=55296&&f<=56319&&a>i+1&&(v=s.charCodeAt(i+1),v>=56320&&v<=57343)?(f-55296)*1024+v-56320+65536:f}};o?o(String.prototype,"codePointAt",{value:e,configurable:!0,writable:!0}):String.prototype.codePointAt=e}();var T9=0,Yk=-3;function d_(){this.table=new Uint16Array(16),this.trans=new Uint16Array(288)}function dY(o,e){this.source=o,this.sourceIndex=0,this.tag=0,this.bitcount=0,this.dest=e,this.destLen=0,this.ltree=new d_,this.dtree=new d_}var Jk=new d_,Kk=new d_,M9=new Uint8Array(30),E9=new Uint16Array(30),Qk=new Uint8Array(30),eD=new Uint16Array(30),uY=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),dk=new d_,Qc=new Uint8Array(320);function tD(o,e,t,s){var a,i;for(a=0;a<t;++a)o[a]=0;for(a=0;a<30-t;++a)o[a+t]=a/t|0;for(i=s,a=0;a<30;++a)e[a]=i,i+=1<<o[a]}function pY(o,e){var t;for(t=0;t<7;++t)o.table[t]=0;for(o.table[7]=24,o.table[8]=152,o.table[9]=112,t=0;t<24;++t)o.trans[t]=256+t;for(t=0;t<144;++t)o.trans[24+t]=t;for(t=0;t<8;++t)o.trans[168+t]=280+t;for(t=0;t<112;++t)o.trans[176+t]=144+t;for(t=0;t<5;++t)e.table[t]=0;for(e.table[5]=32,t=0;t<32;++t)e.trans[t]=t}var uk=new Uint16Array(16);function o9(o,e,t,s){var a,i;for(a=0;a<16;++a)o.table[a]=0;for(a=0;a<s;++a)o.table[e[t+a]]++;for(o.table[0]=0,i=0,a=0;a<16;++a)uk[a]=i,i+=o.table[a];for(a=0;a<s;++a)e[t+a]&&(o.trans[uk[e[t+a]]++]=a)}function fY(o){o.bitcount--||(o.tag=o.source[o.sourceIndex++],o.bitcount=7);var e=o.tag&1;return o.tag>>>=1,e}function e0(o,e,t){if(!e)return t;for(;o.bitcount<24;)o.tag|=o.source[o.sourceIndex++]<<o.bitcount,o.bitcount+=8;var s=o.tag&65535>>>16-e;return o.tag>>>=e,o.bitcount-=e,s+t}function m9(o,e){for(;o.bitcount<24;)o.tag|=o.source[o.sourceIndex++]<<o.bitcount,o.bitcount+=8;var t=0,s=0,a=0,i=o.tag;do s=2*s+(i&1),i>>>=1,++a,t+=e.table[a],s-=e.table[a];while(s>=0);return o.tag=i,o.bitcount-=a,e.trans[t+s]}function mY(o,e,t){var s,a,i,f,v,x;for(s=e0(o,5,257),a=e0(o,5,1),i=e0(o,4,4),f=0;f<19;++f)Qc[f]=0;for(f=0;f<i;++f){var M=e0(o,3,0);Qc[uY[f]]=M}for(o9(dk,Qc,0,19),v=0;v<s+a;){var C=m9(o,dk);switch(C){case 16:var D=Qc[v-1];for(x=e0(o,2,3);x;--x)Qc[v++]=D;break;case 17:for(x=e0(o,3,3);x;--x)Qc[v++]=0;break;case 18:for(x=e0(o,7,11);x;--x)Qc[v++]=0;break;default:Qc[v++]=C;break}}o9(e,Qc,0,s),o9(t,Qc,s,a)}function pk(o,e,t){for(;;){var s=m9(o,e);if(s===256)return T9;if(s<256)o.dest[o.destLen++]=s;else{var a,i,f,v;for(s-=257,a=e0(o,M9[s],E9[s]),i=m9(o,t),f=o.destLen-e0(o,Qk[i],eD[i]),v=f;v<f+a;++v)o.dest[o.destLen++]=o.dest[v]}}}function gY(o){for(var e,t,s;o.bitcount>8;)o.sourceIndex--,o.bitcount-=8;if(e=o.source[o.sourceIndex+1],e=256*e+o.source[o.sourceIndex],t=o.source[o.sourceIndex+3],t=256*t+o.source[o.sourceIndex+2],e!==(~t&65535))return Yk;for(o.sourceIndex+=4,s=e;s;--s)o.dest[o.destLen++]=o.source[o.sourceIndex++];return o.bitcount=0,T9}function _Y(o,e){var t=new dY(o,e),s,a,i;do{switch(s=fY(t),a=e0(t,2,0),a){case 0:i=gY(t);break;case 1:i=pk(t,Jk,Kk);break;case 2:mY(t,t.ltree,t.dtree),i=pk(t,t.ltree,t.dtree);break;default:i=Yk}if(i!==T9)throw new Error("Data error")}while(!s);return t.destLen<t.dest.length?typeof t.dest.slice=="function"?t.dest.slice(0,t.destLen):t.dest.subarray(0,t.destLen):t.dest}pY(Jk,Kk);tD(M9,E9,4,3);tD(Qk,eD,2,1);M9[28]=0;E9[28]=258;var yY=_Y;function bf(o,e,t,s,a){return Math.pow(1-a,3)*o+3*Math.pow(1-a,2)*a*e+3*(1-a)*Math.pow(a,2)*t+Math.pow(a,3)*s}function Z0(){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN}Z0.prototype.isEmpty=function(){return isNaN(this.x1)||isNaN(this.y1)||isNaN(this.x2)||isNaN(this.y2)};Z0.prototype.addPoint=function(o,e){typeof o=="number"&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=o,this.x2=o),o<this.x1&&(this.x1=o),o>this.x2&&(this.x2=o)),typeof e=="number"&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=e,this.y2=e),e<this.y1&&(this.y1=e),e>this.y2&&(this.y2=e))};Z0.prototype.addX=function(o){this.addPoint(o,null)};Z0.prototype.addY=function(o){this.addPoint(null,o)};Z0.prototype.addBezier=function(o,e,t,s,a,i,f,v){var x=[o,e],M=[t,s],C=[a,i],D=[f,v];this.addPoint(o,e),this.addPoint(f,v);for(var L=0;L<=1;L++){var N=6*x[L]-12*M[L]+6*C[L],j=-3*x[L]+9*M[L]-9*C[L]+3*D[L],Z=3*M[L]-3*x[L];if(j===0){if(N===0)continue;var G=-Z/N;0<G&&G<1&&(L===0&&this.addX(bf(x[L],M[L],C[L],D[L],G)),L===1&&this.addY(bf(x[L],M[L],C[L],D[L],G)));continue}var H=Math.pow(N,2)-4*Z*j;if(!(H<0)){var me=(-N+Math.sqrt(H))/(2*j);0<me&&me<1&&(L===0&&this.addX(bf(x[L],M[L],C[L],D[L],me)),L===1&&this.addY(bf(x[L],M[L],C[L],D[L],me)));var ne=(-N-Math.sqrt(H))/(2*j);0<ne&&ne<1&&(L===0&&this.addX(bf(x[L],M[L],C[L],D[L],ne)),L===1&&this.addY(bf(x[L],M[L],C[L],D[L],ne)))}}};Z0.prototype.addQuad=function(o,e,t,s,a,i){var f=o+.6666666666666666*(t-o),v=e+2/3*(s-e),x=f+1/3*(a-o),M=v+1/3*(i-e);this.addBezier(o,e,f,v,x,M,a,i)};function po(){this.commands=[],this.fill="black",this.stroke=null,this.strokeWidth=1}po.prototype.moveTo=function(o,e){this.commands.push({type:"M",x:o,y:e})};po.prototype.lineTo=function(o,e){this.commands.push({type:"L",x:o,y:e})};po.prototype.curveTo=po.prototype.bezierCurveTo=function(o,e,t,s,a,i){this.commands.push({type:"C",x1:o,y1:e,x2:t,y2:s,x:a,y:i})};po.prototype.quadTo=po.prototype.quadraticCurveTo=function(o,e,t,s){this.commands.push({type:"Q",x1:o,y1:e,x:t,y:s})};po.prototype.close=po.prototype.closePath=function(){this.commands.push({type:"Z"})};po.prototype.extend=function(o){if(o.commands)o=o.commands;else if(o instanceof Z0){var e=o;this.moveTo(e.x1,e.y1),this.lineTo(e.x2,e.y1),this.lineTo(e.x2,e.y2),this.lineTo(e.x1,e.y2),this.close();return}Array.prototype.push.apply(this.commands,o)};po.prototype.getBoundingBox=function(){for(var o=new Z0,e=0,t=0,s=0,a=0,i=0;i<this.commands.length;i++){var f=this.commands[i];switch(f.type){case"M":o.addPoint(f.x,f.y),e=s=f.x,t=a=f.y;break;case"L":o.addPoint(f.x,f.y),s=f.x,a=f.y;break;case"Q":o.addQuad(s,a,f.x1,f.y1,f.x,f.y),s=f.x,a=f.y;break;case"C":o.addBezier(s,a,f.x1,f.y1,f.x2,f.y2,f.x,f.y),s=f.x,a=f.y;break;case"Z":s=e,a=t;break;default:throw new Error("Unexpected path command "+f.type)}}return o.isEmpty()&&o.addPoint(0,0),o};po.prototype.draw=function(o){o.beginPath();for(var e=0;e<this.commands.length;e+=1){var t=this.commands[e];t.type==="M"?o.moveTo(t.x,t.y):t.type==="L"?o.lineTo(t.x,t.y):t.type==="C"?o.bezierCurveTo(t.x1,t.y1,t.x2,t.y2,t.x,t.y):t.type==="Q"?o.quadraticCurveTo(t.x1,t.y1,t.x,t.y):t.type==="Z"&&o.closePath()}this.fill&&(o.fillStyle=this.fill,o.fill()),this.stroke&&(o.strokeStyle=this.stroke,o.lineWidth=this.strokeWidth,o.stroke())};po.prototype.toPathData=function(o){o=o!==void 0?o:2;function e(f){return Math.round(f)===f?""+Math.round(f):f.toFixed(o)}function t(){for(var f=arguments,v="",x=0;x<arguments.length;x+=1){var M=f[x];M>=0&&x>0&&(v+=" "),v+=e(M)}return v}for(var s="",a=0;a<this.commands.length;a+=1){var i=this.commands[a];i.type==="M"?s+="M"+t(i.x,i.y):i.type==="L"?s+="L"+t(i.x,i.y):i.type==="C"?s+="C"+t(i.x1,i.y1,i.x2,i.y2,i.x,i.y):i.type==="Q"?s+="Q"+t(i.x1,i.y1,i.x,i.y):i.type==="Z"&&(s+="Z")}return s};po.prototype.toSVG=function(o){var e='<path d="';return e+=this.toPathData(o),e+='"',this.fill&&this.fill!=="black"&&(this.fill===null?e+=' fill="none"':e+=' fill="'+this.fill+'"'),this.stroke&&(e+=' stroke="'+this.stroke+'" stroke-width="'+this.strokeWidth+'"'),e+="/>",e};po.prototype.toDOMElement=function(o){var e=this.toPathData(o),t=document.createElementNS("http://www.w3.org/2000/svg","path");return t.setAttribute("d",e),t};function iD(o){throw new Error(o)}function fk(o,e){o||iD(e)}var Zn={fail:iD,argument:fk,assert:fk},mk=32768,gk=2147483648,Sf={},Li={},nr={};function fc(o){return function(){return o}}Li.BYTE=function(o){return Zn.argument(o>=0&&o<=255,"Byte value should be between 0 and 255."),[o]};nr.BYTE=fc(1);Li.CHAR=function(o){return[o.charCodeAt(0)]};nr.CHAR=fc(1);Li.CHARARRAY=function(o){typeof o>"u"&&(o="",console.warn("Undefined CHARARRAY encountered and treated as an empty string. This is probably caused by a missing glyph name."));for(var e=[],t=0;t<o.length;t+=1)e[t]=o.charCodeAt(t);return e};nr.CHARARRAY=function(o){return typeof o>"u"?0:o.length};Li.USHORT=function(o){return[o>>8&255,o&255]};nr.USHORT=fc(2);Li.SHORT=function(o){return o>=mk&&(o=-(2*mk-o)),[o>>8&255,o&255]};nr.SHORT=fc(2);Li.UINT24=function(o){return[o>>16&255,o>>8&255,o&255]};nr.UINT24=fc(3);Li.ULONG=function(o){return[o>>24&255,o>>16&255,o>>8&255,o&255]};nr.ULONG=fc(4);Li.LONG=function(o){return o>=gk&&(o=-(2*gk-o)),[o>>24&255,o>>16&255,o>>8&255,o&255]};nr.LONG=fc(4);Li.FIXED=Li.ULONG;nr.FIXED=nr.ULONG;Li.FWORD=Li.SHORT;nr.FWORD=nr.SHORT;Li.UFWORD=Li.USHORT;nr.UFWORD=nr.USHORT;Li.LONGDATETIME=function(o){return[0,0,0,0,o>>24&255,o>>16&255,o>>8&255,o&255]};nr.LONGDATETIME=fc(8);Li.TAG=function(o){return Zn.argument(o.length===4,"Tag should be exactly 4 ASCII characters."),[o.charCodeAt(0),o.charCodeAt(1),o.charCodeAt(2),o.charCodeAt(3)]};nr.TAG=fc(4);Li.Card8=Li.BYTE;nr.Card8=nr.BYTE;Li.Card16=Li.USHORT;nr.Card16=nr.USHORT;Li.OffSize=Li.BYTE;nr.OffSize=nr.BYTE;Li.SID=Li.USHORT;nr.SID=nr.USHORT;Li.NUMBER=function(o){return o>=-107&&o<=107?[o+139]:o>=108&&o<=1131?(o=o-108,[(o>>8)+247,o&255]):o>=-1131&&o<=-108?(o=-o-108,[(o>>8)+251,o&255]):o>=-32768&&o<=32767?Li.NUMBER16(o):Li.NUMBER32(o)};nr.NUMBER=function(o){return Li.NUMBER(o).length};Li.NUMBER16=function(o){return[28,o>>8&255,o&255]};nr.NUMBER16=fc(3);Li.NUMBER32=function(o){return[29,o>>24&255,o>>16&255,o>>8&255,o&255]};nr.NUMBER32=fc(5);Li.REAL=function(o){var e=o.toString(),t=/\.(\d*?)(?:9{5,20}|0{5,20})\d{0,2}(?:e(.+)|$)/.exec(e);if(t){var s=parseFloat("1e"+((t[2]?+t[2]:0)+t[1].length));e=(Math.round(o*s)/s).toString()}for(var a="",i=0,f=e.length;i<f;i+=1){var v=e[i];v==="e"?a+=e[++i]==="-"?"c":"b":v==="."?a+="a":v==="-"?a+="e":a+=v}a+=a.length&1?"f":"ff";for(var x=[30],M=0,C=a.length;M<C;M+=2)x.push(parseInt(a.substr(M,2),16));return x};nr.REAL=function(o){return Li.REAL(o).length};Li.NAME=Li.CHARARRAY;nr.NAME=nr.CHARARRAY;Li.STRING=Li.CHARARRAY;nr.STRING=nr.CHARARRAY;Sf.UTF8=function(o,e,t){for(var s=[],a=t,i=0;i<a;i++,e+=1)s[i]=o.getUint8(e);return String.fromCharCode.apply(null,s)};Sf.UTF16=function(o,e,t){for(var s=[],a=t/2,i=0;i<a;i++,e+=2)s[i]=o.getUint16(e);return String.fromCharCode.apply(null,s)};Li.UTF16=function(o){for(var e=[],t=0;t<o.length;t+=1){var s=o.charCodeAt(t);e[e.length]=s>>8&255,e[e.length]=s&255}return e};nr.UTF16=function(o){return o.length*2};var g9={"x-mac-croatian":"\xC4\xC5\xC7\xC9\xD1\xD6\xDC\xE1\xE0\xE2\xE4\xE3\xE5\xE7\xE9\xE8\xEA\xEB\xED\xEC\xEE\xEF\xF1\xF3\xF2\xF4\xF6\xF5\xFA\xF9\xFB\xFC\u2020\xB0\xA2\xA3\xA7\u2022\xB6\xDF\xAE\u0160\u2122\xB4\xA8\u2260\u017D\xD8\u221E\xB1\u2264\u2265\u2206\xB5\u2202\u2211\u220F\u0161\u222B\xAA\xBA\u03A9\u017E\xF8\xBF\xA1\xAC\u221A\u0192\u2248\u0106\xAB\u010C\u2026\xA0\xC0\xC3\xD5\u0152\u0153\u0110\u2014\u201C\u201D\u2018\u2019\xF7\u25CA\uF8FF\xA9\u2044\u20AC\u2039\u203A\xC6\xBB\u2013\xB7\u201A\u201E\u2030\xC2\u0107\xC1\u010D\xC8\xCD\xCE\xCF\xCC\xD3\xD4\u0111\xD2\xDA\xDB\xD9\u0131\u02C6\u02DC\xAF\u03C0\xCB\u02DA\xB8\xCA\xE6\u02C7","x-mac-cyrillic":"\u0410\u0411\u0412\u0413\u0414\u0415\u0416\u0417\u0418\u0419\u041A\u041B\u041C\u041D\u041E\u041F\u0420\u0421\u0422\u0423\u0424\u0425\u0426\u0427\u0428\u0429\u042A\u042B\u042C\u042D\u042E\u042F\u2020\xB0\u0490\xA3\xA7\u2022\xB6\u0406\xAE\xA9\u2122\u0402\u0452\u2260\u0403\u0453\u221E\xB1\u2264\u2265\u0456\xB5\u0491\u0408\u0404\u0454\u0407\u0457\u0409\u0459\u040A\u045A\u0458\u0405\xAC\u221A\u0192\u2248\u2206\xAB\xBB\u2026\xA0\u040B\u045B\u040C\u045C\u0455\u2013\u2014\u201C\u201D\u2018\u2019\xF7\u201E\u040E\u045E\u040F\u045F\u2116\u0401\u0451\u044F\u0430\u0431\u0432\u0433\u0434\u0435\u0436\u0437\u0438\u0439\u043A\u043B\u043C\u043D\u043E\u043F\u0440\u0441\u0442\u0443\u0444\u0445\u0446\u0447\u0448\u0449\u044A\u044B\u044C\u044D\u044E","x-mac-gaelic":"\xC4\xC5\xC7\xC9\xD1\xD6\xDC\xE1\xE0\xE2\xE4\xE3\xE5\xE7\xE9\xE8\xEA\xEB\xED\xEC\xEE\xEF\xF1\xF3\xF2\xF4\xF6\xF5\xFA\xF9\xFB\xFC\u2020\xB0\xA2\xA3\xA7\u2022\xB6\xDF\xAE\xA9\u2122\xB4\xA8\u2260\xC6\xD8\u1E02\xB1\u2264\u2265\u1E03\u010A\u010B\u1E0A\u1E0B\u1E1E\u1E1F\u0120\u0121\u1E40\xE6\xF8\u1E41\u1E56\u1E57\u027C\u0192\u017F\u1E60\xAB\xBB\u2026\xA0\xC0\xC3\xD5\u0152\u0153\u2013\u2014\u201C\u201D\u2018\u2019\u1E61\u1E9B\xFF\u0178\u1E6A\u20AC\u2039\u203A\u0176\u0177\u1E6B\xB7\u1EF2\u1EF3\u204A\xC2\xCA\xC1\xCB\xC8\xCD\xCE\xCF\xCC\xD3\xD4\u2663\xD2\xDA\xDB\xD9\u0131\xDD\xFD\u0174\u0175\u1E84\u1E85\u1E80\u1E81\u1E82\u1E83","x-mac-greek":"\xC4\xB9\xB2\xC9\xB3\xD6\xDC\u0385\xE0\xE2\xE4\u0384\xA8\xE7\xE9\xE8\xEA\xEB\xA3\u2122\xEE\xEF\u2022\xBD\u2030\xF4\xF6\xA6\u20AC\xF9\xFB\xFC\u2020\u0393\u0394\u0398\u039B\u039E\u03A0\xDF\xAE\xA9\u03A3\u03AA\xA7\u2260\xB0\xB7\u0391\xB1\u2264\u2265\xA5\u0392\u0395\u0396\u0397\u0399\u039A\u039C\u03A6\u03AB\u03A8\u03A9\u03AC\u039D\xAC\u039F\u03A1\u2248\u03A4\xAB\xBB\u2026\xA0\u03A5\u03A7\u0386\u0388\u0153\u2013\u2015\u201C\u201D\u2018\u2019\xF7\u0389\u038A\u038C\u038E\u03AD\u03AE\u03AF\u03CC\u038F\u03CD\u03B1\u03B2\u03C8\u03B4\u03B5\u03C6\u03B3\u03B7\u03B9\u03BE\u03BA\u03BB\u03BC\u03BD\u03BF\u03C0\u03CE\u03C1\u03C3\u03C4\u03B8\u03C9\u03C2\u03C7\u03C5\u03B6\u03CA\u03CB\u0390\u03B0\xAD","x-mac-icelandic":"\xC4\xC5\xC7\xC9\xD1\xD6\xDC\xE1\xE0\xE2\xE4\xE3\xE5\xE7\xE9\xE8\xEA\xEB\xED\xEC\xEE\xEF\xF1\xF3\xF2\xF4\xF6\xF5\xFA\xF9\xFB\xFC\xDD\xB0\xA2\xA3\xA7\u2022\xB6\xDF\xAE\xA9\u2122\xB4\xA8\u2260\xC6\xD8\u221E\xB1\u2264\u2265\xA5\xB5\u2202\u2211\u220F\u03C0\u222B\xAA\xBA\u03A9\xE6\xF8\xBF\xA1\xAC\u221A\u0192\u2248\u2206\xAB\xBB\u2026\xA0\xC0\xC3\xD5\u0152\u0153\u2013\u2014\u201C\u201D\u2018\u2019\xF7\u25CA\xFF\u0178\u2044\u20AC\xD0\xF0\xDE\xFE\xFD\xB7\u201A\u201E\u2030\xC2\xCA\xC1\xCB\xC8\xCD\xCE\xCF\xCC\xD3\xD4\uF8FF\xD2\xDA\xDB\xD9\u0131\u02C6\u02DC\xAF\u02D8\u02D9\u02DA\xB8\u02DD\u02DB\u02C7","x-mac-inuit":"\u1403\u1404\u1405\u1406\u140A\u140B\u1431\u1432\u1433\u1434\u1438\u1439\u1449\u144E\u144F\u1450\u1451\u1455\u1456\u1466\u146D\u146E\u146F\u1470\u1472\u1473\u1483\u148B\u148C\u148D\u148E\u1490\u1491\xB0\u14A1\u14A5\u14A6\u2022\xB6\u14A7\xAE\xA9\u2122\u14A8\u14AA\u14AB\u14BB\u14C2\u14C3\u14C4\u14C5\u14C7\u14C8\u14D0\u14EF\u14F0\u14F1\u14F2\u14F4\u14F5\u1505\u14D5\u14D6\u14D7\u14D8\u14DA\u14DB\u14EA\u1528\u1529\u152A\u152B\u152D\u2026\xA0\u152E\u153E\u1555\u1556\u1557\u2013\u2014\u201C\u201D\u2018\u2019\u1558\u1559\u155A\u155D\u1546\u1547\u1548\u1549\u154B\u154C\u1550\u157F\u1580\u1581\u1582\u1583\u1584\u1585\u158F\u1590\u1591\u1592\u1593\u1594\u1595\u1671\u1672\u1673\u1674\u1675\u1676\u1596\u15A0\u15A1\u15A2\u15A3\u15A4\u15A5\u15A6\u157C\u0141\u0142","x-mac-ce":"\xC4\u0100\u0101\xC9\u0104\xD6\xDC\xE1\u0105\u010C\xE4\u010D\u0106\u0107\xE9\u0179\u017A\u010E\xED\u010F\u0112\u0113\u0116\xF3\u0117\xF4\xF6\xF5\xFA\u011A\u011B\xFC\u2020\xB0\u0118\xA3\xA7\u2022\xB6\xDF\xAE\xA9\u2122\u0119\xA8\u2260\u0123\u012E\u012F\u012A\u2264\u2265\u012B\u0136\u2202\u2211\u0142\u013B\u013C\u013D\u013E\u0139\u013A\u0145\u0146\u0143\xAC\u221A\u0144\u0147\u2206\xAB\xBB\u2026\xA0\u0148\u0150\xD5\u0151\u014C\u2013\u2014\u201C\u201D\u2018\u2019\xF7\u25CA\u014D\u0154\u0155\u0158\u2039\u203A\u0159\u0156\u0157\u0160\u201A\u201E\u0161\u015A\u015B\xC1\u0164\u0165\xCD\u017D\u017E\u016A\xD3\xD4\u016B\u016E\xDA\u016F\u0170\u0171\u0172\u0173\xDD\xFD\u0137\u017B\u0141\u017C\u0122\u02C7",macintosh:"\xC4\xC5\xC7\xC9\xD1\xD6\xDC\xE1\xE0\xE2\xE4\xE3\xE5\xE7\xE9\xE8\xEA\xEB\xED\xEC\xEE\xEF\xF1\xF3\xF2\xF4\xF6\xF5\xFA\xF9\xFB\xFC\u2020\xB0\xA2\xA3\xA7\u2022\xB6\xDF\xAE\xA9\u2122\xB4\xA8\u2260\xC6\xD8\u221E\xB1\u2264\u2265\xA5\xB5\u2202\u2211\u220F\u03C0\u222B\xAA\xBA\u03A9\xE6\xF8\xBF\xA1\xAC\u221A\u0192\u2248\u2206\xAB\xBB\u2026\xA0\xC0\xC3\xD5\u0152\u0153\u2013\u2014\u201C\u201D\u2018\u2019\xF7\u25CA\xFF\u0178\u2044\u20AC\u2039\u203A\uFB01\uFB02\u2021\xB7\u201A\u201E\u2030\xC2\xCA\xC1\xCB\xC8\xCD\xCE\xCF\xCC\xD3\xD4\uF8FF\xD2\xDA\xDB\xD9\u0131\u02C6\u02DC\xAF\u02D8\u02D9\u02DA\xB8\u02DD\u02DB\u02C7","x-mac-romanian":"\xC4\xC5\xC7\xC9\xD1\xD6\xDC\xE1\xE0\xE2\xE4\xE3\xE5\xE7\xE9\xE8\xEA\xEB\xED\xEC\xEE\xEF\xF1\xF3\xF2\xF4\xF6\xF5\xFA\xF9\xFB\xFC\u2020\xB0\xA2\xA3\xA7\u2022\xB6\xDF\xAE\xA9\u2122\xB4\xA8\u2260\u0102\u0218\u221E\xB1\u2264\u2265\xA5\xB5\u2202\u2211\u220F\u03C0\u222B\xAA\xBA\u03A9\u0103\u0219\xBF\xA1\xAC\u221A\u0192\u2248\u2206\xAB\xBB\u2026\xA0\xC0\xC3\xD5\u0152\u0153\u2013\u2014\u201C\u201D\u2018\u2019\xF7\u25CA\xFF\u0178\u2044\u20AC\u2039\u203A\u021A\u021B\u2021\xB7\u201A\u201E\u2030\xC2\xCA\xC1\xCB\xC8\xCD\xCE\xCF\xCC\xD3\xD4\uF8FF\xD2\xDA\xDB\xD9\u0131\u02C6\u02DC\xAF\u02D8\u02D9\u02DA\xB8\u02DD\u02DB\u02C7","x-mac-turkish":"\xC4\xC5\xC7\xC9\xD1\xD6\xDC\xE1\xE0\xE2\xE4\xE3\xE5\xE7\xE9\xE8\xEA\xEB\xED\xEC\xEE\xEF\xF1\xF3\xF2\xF4\xF6\xF5\xFA\xF9\xFB\xFC\u2020\xB0\xA2\xA3\xA7\u2022\xB6\xDF\xAE\xA9\u2122\xB4\xA8\u2260\xC6\xD8\u221E\xB1\u2264\u2265\xA5\xB5\u2202\u2211\u220F\u03C0\u222B\xAA\xBA\u03A9\xE6\xF8\xBF\xA1\xAC\u221A\u0192\u2248\u2206\xAB\xBB\u2026\xA0\xC0\xC3\xD5\u0152\u0153\u2013\u2014\u201C\u201D\u2018\u2019\xF7\u25CA\xFF\u0178\u011E\u011F\u0130\u0131\u015E\u015F\u2021\xB7\u201A\u201E\u2030\xC2\xCA\xC1\xCB\xC8\xCD\xCE\xCF\xCC\xD3\xD4\uF8FF\xD2\xDA\xDB\xD9\uF8A0\u02C6\u02DC\xAF\u02D8\u02D9\u02DA\xB8\u02DD\u02DB\u02C7"};Sf.MACSTRING=function(o,e,t,s){var a=g9[s];if(a!==void 0){for(var i="",f=0;f<t;f++){var v=o.getUint8(e+f);v<=127?i+=String.fromCharCode(v):i+=a[v&127]}return i}};var ny=typeof WeakMap=="function"&&new WeakMap,ry,vY=function(o){if(!ry){ry={};for(var e in g9)ry[e]=new String(e)}var t=ry[o];if(t!==void 0){if(ny){var s=ny.get(t);if(s!==void 0)return s}var a=g9[o];if(a!==void 0){for(var i={},f=0;f<a.length;f++)i[a.charCodeAt(f)]=f+128;return ny&&ny.set(t,i),i}}};Li.MACSTRING=function(o,e){var t=vY(e);if(t!==void 0){for(var s=[],a=0;a<o.length;a++){var i=o.charCodeAt(a);if(i>=128&&(i=t[i],i===void 0))return;s[a]=i}return s}};nr.MACSTRING=function(o,e){var t=Li.MACSTRING(o,e);return t!==void 0?t.length:0};function _9(o){return o>=-128&&o<=127}function xY(o,e,t){for(var s=0,a=o.length;e<a&&s<64&&o[e]===0;)++e,++s;return t.push(128|s-1),e}function bY(o,e,t){for(var s=0,a=o.length,i=e;i<a&&s<64;){var f=o[i];if(!_9(f)||f===0&&i+1<a&&o[i+1]===0)break;++i,++s}t.push(s-1);for(var v=e;v<i;++v)t.push(o[v]+256&255);return i}function wY(o,e,t){for(var s=0,a=o.length,i=e;i<a&&s<64;){var f=o[i];if(f===0||_9(f)&&i+1<a&&_9(o[i+1]))break;++i,++s}t.push(64|s-1);for(var v=e;v<i;++v){var x=o[v];t.push(x+65536>>8&255,x+256&255)}return i}Li.VARDELTAS=function(o){for(var e=0,t=[];e<o.length;){var s=o[e];s===0?e=xY(o,e,t):s>=-128&&s<=127?e=bY(o,e,t):e=wY(o,e,t)}return t};Li.INDEX=function(o){for(var e=1,t=[e],s=[],a=0;a<o.length;a+=1){var i=Li.OBJECT(o[a]);Array.prototype.push.apply(s,i),e+=i.length,t.push(e)}if(s.length===0)return[0,0];for(var f=[],v=1+Math.floor(Math.log(e)/Math.log(2))/8|0,x=[void 0,Li.BYTE,Li.USHORT,Li.UINT24,Li.ULONG][v],M=0;M<t.length;M+=1){var C=x(t[M]);Array.prototype.push.apply(f,C)}return Array.prototype.concat(Li.Card16(o.length),Li.OffSize(v),f,s)};nr.INDEX=function(o){return Li.INDEX(o).length};Li.DICT=function(o){for(var e=[],t=Object.keys(o),s=t.length,a=0;a<s;a+=1){var i=parseInt(t[a],0),f=o[i];e=e.concat(Li.OPERAND(f.value,f.type)),e=e.concat(Li.OPERATOR(i))}return e};nr.DICT=function(o){return Li.DICT(o).length};Li.OPERATOR=function(o){return o<1200?[o]:[12,o-1200]};Li.OPERAND=function(o,e){var t=[];if(Array.isArray(e))for(var s=0;s<e.length;s+=1)Zn.argument(o.length===e.length,"Not enough arguments given for type"+e),t=t.concat(Li.OPERAND(o[s],e[s]));else if(e==="SID")t=t.concat(Li.NUMBER(o));else if(e==="offset")t=t.concat(Li.NUMBER32(o));else if(e==="number")t=t.concat(Li.NUMBER(o));else if(e==="real")t=t.concat(Li.REAL(o));else throw new Error("Unknown operand type "+e);return t};Li.OP=Li.BYTE;nr.OP=nr.BYTE;var sy=typeof WeakMap=="function"&&new WeakMap;Li.CHARSTRING=function(o){if(sy){var e=sy.get(o);if(e!==void 0)return e}for(var t=[],s=o.length,a=0;a<s;a+=1){var i=o[a];t=t.concat(Li[i.type](i.value))}return sy&&sy.set(o,t),t};nr.CHARSTRING=function(o){return Li.CHARSTRING(o).length};Li.OBJECT=function(o){var e=Li[o.type];return Zn.argument(e!==void 0,"No encoding function for type "+o.type),e(o.value)};nr.OBJECT=function(o){var e=nr[o.type];return Zn.argument(e!==void 0,"No sizeOf function for type "+o.type),e(o.value)};Li.TABLE=function(o){for(var e=[],t=o.fields.length,s=[],a=[],i=0;i<t;i+=1){var f=o.fields[i],v=Li[f.type];Zn.argument(v!==void 0,"No encoding function for field type "+f.type+" ("+f.name+")");var x=o[f.name];x===void 0&&(x=f.value);var M=v(x);f.type==="TABLE"?(a.push(e.length),e=e.concat([0,0]),s.push(M)):e=e.concat(M)}for(var C=0;C<s.length;C+=1){var D=a[C],L=e.length;Zn.argument(L<65536,"Table "+o.tableName+" too big."),e[D]=L>>8,e[D+1]=L&255,e=e.concat(s[C])}return e};nr.TABLE=function(o){for(var e=0,t=o.fields.length,s=0;s<t;s+=1){var a=o.fields[s],i=nr[a.type];Zn.argument(i!==void 0,"No sizeOf function for field type "+a.type+" ("+a.name+")");var f=o[a.name];f===void 0&&(f=a.value),e+=i(f),a.type==="TABLE"&&(e+=2)}return e};Li.RECORD=Li.TABLE;nr.RECORD=nr.TABLE;Li.LITERAL=function(o){return o};nr.LITERAL=function(o){return o.length};function ko(o,e,t){if(e.length&&(e[0].name!=="coverageFormat"||e[0].value===1))for(var s=0;s<e.length;s+=1){var a=e[s];this[a.name]=a.value}if(this.tableName=o,this.fields=e,t)for(var i=Object.keys(t),f=0;f<i.length;f+=1){var v=i[f],x=t[v];this[v]!==void 0&&(this[v]=x)}}ko.prototype.encode=function(){return Li.TABLE(this)};ko.prototype.sizeOf=function(){return nr.TABLE(this)};function u_(o,e,t){t===void 0&&(t=e.length);var s=new Array(e.length+1);s[0]={name:o+"Count",type:"USHORT",value:t};for(var a=0;a<e.length;a++)s[a+1]={name:o+a,type:"USHORT",value:e[a]};return s}function y9(o,e,t){var s=e.length,a=new Array(s+1);a[0]={name:o+"Count",type:"USHORT",value:s};for(var i=0;i<s;i++)a[i+1]={name:o+i,type:"TABLE",value:t(e[i],i)};return a}function p_(o,e,t){var s=e.length,a=[];a[0]={name:o+"Count",type:"USHORT",value:s};for(var i=0;i<s;i++)a=a.concat(t(e[i],i));return a}function hy(o){o.format===1?ko.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:1}].concat(u_("glyph",o.glyphs))):o.format===2?ko.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:2}].concat(p_("rangeRecord",o.ranges,function(e){return[{name:"startGlyphID",type:"USHORT",value:e.start},{name:"endGlyphID",type:"USHORT",value:e.end},{name:"startCoverageIndex",type:"USHORT",value:e.index}]}))):Zn.assert(!1,"Coverage format must be 1 or 2.")}hy.prototype=Object.create(ko.prototype);hy.prototype.constructor=hy;function dy(o){ko.call(this,"scriptListTable",p_("scriptRecord",o,function(e,t){var s=e.script,a=s.defaultLangSys;return Zn.assert(!!a,"Unable to write GSUB: script "+e.tag+" has no default language system."),[{name:"scriptTag"+t,type:"TAG",value:e.tag},{name:"script"+t,type:"TABLE",value:new ko("scriptTable",[{name:"defaultLangSys",type:"TABLE",value:new ko("defaultLangSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:a.reqFeatureIndex}].concat(u_("featureIndex",a.featureIndexes)))}].concat(p_("langSys",s.langSysRecords,function(i,f){var v=i.langSys;return[{name:"langSysTag"+f,type:"TAG",value:i.tag},{name:"langSys"+f,type:"TABLE",value:new ko("langSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:v.reqFeatureIndex}].concat(u_("featureIndex",v.featureIndexes)))}]})))}]}))}dy.prototype=Object.create(ko.prototype);dy.prototype.constructor=dy;function uy(o){ko.call(this,"featureListTable",p_("featureRecord",o,function(e,t){var s=e.feature;return[{name:"featureTag"+t,type:"TAG",value:e.tag},{name:"feature"+t,type:"TABLE",value:new ko("featureTable",[{name:"featureParams",type:"USHORT",value:s.featureParams}].concat(u_("lookupListIndex",s.lookupListIndexes)))}]}))}uy.prototype=Object.create(ko.prototype);uy.prototype.constructor=uy;function py(o,e){ko.call(this,"lookupListTable",y9("lookup",o,function(t){var s=e[t.lookupType];return Zn.assert(!!s,"Unable to write GSUB lookup type "+t.lookupType+" tables."),new ko("lookupTable",[{name:"lookupType",type:"USHORT",value:t.lookupType},{name:"lookupFlag",type:"USHORT",value:t.lookupFlag}].concat(y9("subtable",t.subtables,s)))}))}py.prototype=Object.create(ko.prototype);py.prototype.constructor=py;var Xi={Table:ko,Record:ko,Coverage:hy,ScriptList:dy,FeatureList:uy,LookupList:py,ushortList:u_,tableList:y9,recordList:p_};function _k(o,e){return o.getUint8(e)}function fy(o,e){return o.getUint16(e,!1)}function SY(o,e){return o.getInt16(e,!1)}function A9(o,e){return o.getUint32(e,!1)}function nD(o,e){var t=o.getInt16(e,!1),s=o.getUint16(e+2,!1);return t+s/65535}function TY(o,e){for(var t="",s=e;s<e+4;s+=1)t+=String.fromCharCode(o.getInt8(s));return t}function MY(o,e,t){for(var s=0,a=0;a<t;a+=1)s<<=8,s+=o.getUint8(e+a);return s}function EY(o,e,t){for(var s=[],a=e;a<t;a+=1)s.push(o.getUint8(a));return s}function AY(o){for(var e="",t=0;t<o.length;t+=1)e+=String.fromCharCode(o[t]);return e}var CY={byte:1,uShort:2,short:2,uLong:4,fixed:4,longDateTime:8,tag:4};function Pt(o,e){this.data=o,this.offset=e,this.relativeOffset=0}Pt.prototype.parseByte=function(){var o=this.data.getUint8(this.offset+this.relativeOffset);return this.relativeOffset+=1,o};Pt.prototype.parseChar=function(){var o=this.data.getInt8(this.offset+this.relativeOffset);return this.relativeOffset+=1,o};Pt.prototype.parseCard8=Pt.prototype.parseByte;Pt.prototype.parseUShort=function(){var o=this.data.getUint16(this.offset+this.relativeOffset);return this.relativeOffset+=2,o};Pt.prototype.parseCard16=Pt.prototype.parseUShort;Pt.prototype.parseSID=Pt.prototype.parseUShort;Pt.prototype.parseOffset16=Pt.prototype.parseUShort;Pt.prototype.parseShort=function(){var o=this.data.getInt16(this.offset+this.relativeOffset);return this.relativeOffset+=2,o};Pt.prototype.parseF2Dot14=function(){var o=this.data.getInt16(this.offset+this.relativeOffset)/16384;return this.relativeOffset+=2,o};Pt.prototype.parseULong=function(){var o=A9(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,o};Pt.prototype.parseOffset32=Pt.prototype.parseULong;Pt.prototype.parseFixed=function(){var o=nD(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,o};Pt.prototype.parseString=function(o){var e=this.data,t=this.offset+this.relativeOffset,s="";this.relativeOffset+=o;for(var a=0;a<o;a++)s+=String.fromCharCode(e.getUint8(t+a));return s};Pt.prototype.parseTag=function(){return this.parseString(4)};Pt.prototype.parseLongDateTime=function(){var o=A9(this.data,this.offset+this.relativeOffset+4);return o-=2082844800,this.relativeOffset+=8,o};Pt.prototype.parseVersion=function(o){var e=fy(this.data,this.offset+this.relativeOffset),t=fy(this.data,this.offset+this.relativeOffset+2);return this.relativeOffset+=4,o===void 0&&(o=4096),e+t/o/10};Pt.prototype.skip=function(o,e){e===void 0&&(e=1),this.relativeOffset+=CY[o]*e};Pt.prototype.parseULongList=function(o){o===void 0&&(o=this.parseULong());for(var e=new Array(o),t=this.data,s=this.offset+this.relativeOffset,a=0;a<o;a++)e[a]=t.getUint32(s),s+=4;return this.relativeOffset+=o*4,e};Pt.prototype.parseOffset16List=Pt.prototype.parseUShortList=function(o){o===void 0&&(o=this.parseUShort());for(var e=new Array(o),t=this.data,s=this.offset+this.relativeOffset,a=0;a<o;a++)e[a]=t.getUint16(s),s+=2;return this.relativeOffset+=o*2,e};Pt.prototype.parseShortList=function(o){for(var e=new Array(o),t=this.data,s=this.offset+this.relativeOffset,a=0;a<o;a++)e[a]=t.getInt16(s),s+=2;return this.relativeOffset+=o*2,e};Pt.prototype.parseByteList=function(o){for(var e=new Array(o),t=this.data,s=this.offset+this.relativeOffset,a=0;a<o;a++)e[a]=t.getUint8(s++);return this.relativeOffset+=o,e};Pt.prototype.parseList=function(o,e){e||(e=o,o=this.parseUShort());for(var t=new Array(o),s=0;s<o;s++)t[s]=e.call(this);return t};Pt.prototype.parseList32=function(o,e){e||(e=o,o=this.parseULong());for(var t=new Array(o),s=0;s<o;s++)t[s]=e.call(this);return t};Pt.prototype.parseRecordList=function(o,e){e||(e=o,o=this.parseUShort());for(var t=new Array(o),s=Object.keys(e),a=0;a<o;a++){for(var i={},f=0;f<s.length;f++){var v=s[f],x=e[v];i[v]=x.call(this)}t[a]=i}return t};Pt.prototype.parseRecordList32=function(o,e){e||(e=o,o=this.parseULong());for(var t=new Array(o),s=Object.keys(e),a=0;a<o;a++){for(var i={},f=0;f<s.length;f++){var v=s[f],x=e[v];i[v]=x.call(this)}t[a]=i}return t};Pt.prototype.parseStruct=function(o){if(typeof o=="function")return o.call(this);for(var e=Object.keys(o),t={},s=0;s<e.length;s++){var a=e[s],i=o[a];t[a]=i.call(this)}return t};Pt.prototype.parseValueRecord=function(o){if(o===void 0&&(o=this.parseUShort()),o!==0){var e={};return o&1&&(e.xPlacement=this.parseShort()),o&2&&(e.yPlacement=this.parseShort()),o&4&&(e.xAdvance=this.parseShort()),o&8&&(e.yAdvance=this.parseShort()),o&16&&(e.xPlaDevice=void 0,this.parseShort()),o&32&&(e.yPlaDevice=void 0,this.parseShort()),o&64&&(e.xAdvDevice=void 0,this.parseShort()),o&128&&(e.yAdvDevice=void 0,this.parseShort()),e}};Pt.prototype.parseValueRecordList=function(){for(var o=this.parseUShort(),e=this.parseUShort(),t=new Array(e),s=0;s<e;s++)t[s]=this.parseValueRecord(o);return t};Pt.prototype.parsePointer=function(o){var e=this.parseOffset16();if(e>0)return new Pt(this.data,this.offset+e).parseStruct(o)};Pt.prototype.parsePointer32=function(o){var e=this.parseOffset32();if(e>0)return new Pt(this.data,this.offset+e).parseStruct(o)};Pt.prototype.parseListOfLists=function(o){for(var e=this.parseOffset16List(),t=e.length,s=this.relativeOffset,a=new Array(t),i=0;i<t;i++){var f=e[i];if(f===0){a[i]=void 0;continue}if(this.relativeOffset=f,o){for(var v=this.parseOffset16List(),x=new Array(v.length),M=0;M<v.length;M++)this.relativeOffset=f+v[M],x[M]=o.call(this);a[i]=x}else a[i]=this.parseUShortList()}return this.relativeOffset=s,a};Pt.prototype.parseCoverage=function(){var o=this.offset+this.relativeOffset,e=this.parseUShort(),t=this.parseUShort();if(e===1)return{format:1,glyphs:this.parseUShortList(t)};if(e===2){for(var s=new Array(t),a=0;a<t;a++)s[a]={start:this.parseUShort(),end:this.parseUShort(),index:this.parseUShort()};return{format:2,ranges:s}}throw new Error("0x"+o.toString(16)+": Coverage format must be 1 or 2.")};Pt.prototype.parseClassDef=function(){var o=this.offset+this.relativeOffset,e=this.parseUShort();if(e===1)return{format:1,startGlyph:this.parseUShort(),classes:this.parseUShortList()};if(e===2)return{format:2,ranges:this.parseRecordList({start:Pt.uShort,end:Pt.uShort,classId:Pt.uShort})};throw new Error("0x"+o.toString(16)+": ClassDef format must be 1 or 2.")};Pt.list=function(o,e){return function(){return this.parseList(o,e)}};Pt.list32=function(o,e){return function(){return this.parseList32(o,e)}};Pt.recordList=function(o,e){return function(){return this.parseRecordList(o,e)}};Pt.recordList32=function(o,e){return function(){return this.parseRecordList32(o,e)}};Pt.pointer=function(o){return function(){return this.parsePointer(o)}};Pt.pointer32=function(o){return function(){return this.parsePointer32(o)}};Pt.tag=Pt.prototype.parseTag;Pt.byte=Pt.prototype.parseByte;Pt.uShort=Pt.offset16=Pt.prototype.parseUShort;Pt.uShortList=Pt.prototype.parseUShortList;Pt.uLong=Pt.offset32=Pt.prototype.parseULong;Pt.uLongList=Pt.prototype.parseULongList;Pt.struct=Pt.prototype.parseStruct;Pt.coverage=Pt.prototype.parseCoverage;Pt.classDef=Pt.prototype.parseClassDef;var yk={reserved:Pt.uShort,reqFeatureIndex:Pt.uShort,featureIndexes:Pt.uShortList};Pt.prototype.parseScriptList=function(){return this.parsePointer(Pt.recordList({tag:Pt.tag,script:Pt.pointer({defaultLangSys:Pt.pointer(yk),langSysRecords:Pt.recordList({tag:Pt.tag,langSys:Pt.pointer(yk)})})}))||[]};Pt.prototype.parseFeatureList=function(){return this.parsePointer(Pt.recordList({tag:Pt.tag,feature:Pt.pointer({featureParams:Pt.offset16,lookupListIndexes:Pt.uShortList})}))||[]};Pt.prototype.parseLookupList=function(o){return this.parsePointer(Pt.list(Pt.pointer(function(){var e=this.parseUShort();Zn.argument(1<=e&&e<=9,"GPOS/GSUB lookup type "+e+" unknown.");var t=this.parseUShort(),s=t&16;return{lookupType:e,lookupFlag:t,subtables:this.parseList(Pt.pointer(o[e])),markFilteringSet:s?this.parseUShort():void 0}})))||[]};Pt.prototype.parseFeatureVariationsList=function(){return this.parsePointer32(function(){var o=this.parseUShort(),e=this.parseUShort();Zn.argument(o===1&&e<1,"GPOS/GSUB feature variations table unknown.");var t=this.parseRecordList32({conditionSetOffset:Pt.offset32,featureTableSubstitutionOffset:Pt.offset32});return t})||[]};var on={getByte:_k,getCard8:_k,getUShort:fy,getCard16:fy,getShort:SY,getULong:A9,getFixed:nD,getTag:TY,getOffset:MY,getBytes:EY,bytesToString:AY,Parser:Pt};function IY(o,e){e.parseUShort(),o.length=e.parseULong(),o.language=e.parseULong();var t;o.groupCount=t=e.parseULong(),o.glyphIndexMap={};for(var s=0;s<t;s+=1)for(var a=e.parseULong(),i=e.parseULong(),f=e.parseULong(),v=a;v<=i;v+=1)o.glyphIndexMap[v]=f,f++}function PY(o,e,t,s,a){o.length=e.parseUShort(),o.language=e.parseUShort();var i;o.segCount=i=e.parseUShort()>>1,e.skip("uShort",3),o.glyphIndexMap={};for(var f=new on.Parser(t,s+a+14),v=new on.Parser(t,s+a+16+i*2),x=new on.Parser(t,s+a+16+i*4),M=new on.Parser(t,s+a+16+i*6),C=s+a+16+i*8,D=0;D<i-1;D+=1)for(var L=void 0,N=f.parseUShort(),j=v.parseUShort(),Z=x.parseShort(),G=M.parseUShort(),H=j;H<=N;H+=1)G!==0?(C=M.offset+M.relativeOffset-2,C+=G,C+=(H-j)*2,L=on.getUShort(t,C),L!==0&&(L=L+Z&65535)):L=H+Z&65535,o.glyphIndexMap[H]=L}function RY(o,e){var t={};t.version=on.getUShort(o,e),Zn.argument(t.version===0,"cmap table version should be 0."),t.numTables=on.getUShort(o,e+2);for(var s=-1,a=t.numTables-1;a>=0;a-=1){var i=on.getUShort(o,e+4+a*8),f=on.getUShort(o,e+4+a*8+2);if(i===3&&(f===0||f===1||f===10)||i===0&&(f===0||f===1||f===2||f===3||f===4)){s=on.getULong(o,e+4+a*8+4);break}}if(s===-1)throw new Error("No valid cmap sub-tables found.");var v=new on.Parser(o,e+s);if(t.format=v.parseUShort(),t.format===12)IY(t,v);else if(t.format===4)PY(t,v,o,e,s);else throw new Error("Only format 4 and 12 cmap tables are supported (found format "+t.format+").");return t}function kY(o,e,t){o.segments.push({end:e,start:e,delta:-(e-t),offset:0,glyphIndex:t})}function DY(o){o.segments.push({end:65535,start:65535,delta:1,offset:0})}function LY(o){var e=!0,t;for(t=o.length-1;t>0;t-=1){var s=o.get(t);if(s.unicode>65535){console.log("Adding CMAP format 12 (needed!)"),e=!1;break}}var a=[{name:"version",type:"USHORT",value:0},{name:"numTables",type:"USHORT",value:e?1:2},{name:"platformID",type:"USHORT",value:3},{name:"encodingID",type:"USHORT",value:1},{name:"offset",type:"ULONG",value:e?12:20}];e||(a=a.concat([{name:"cmap12PlatformID",type:"USHORT",value:3},{name:"cmap12EncodingID",type:"USHORT",value:10},{name:"cmap12Offset",type:"ULONG",value:0}])),a=a.concat([{name:"format",type:"USHORT",value:4},{name:"cmap4Length",type:"USHORT",value:0},{name:"language",type:"USHORT",value:0},{name:"segCountX2",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);var i=new Xi.Table("cmap",a);for(i.segments=[],t=0;t<o.length;t+=1){for(var f=o.get(t),v=0;v<f.unicodes.length;v+=1)kY(i,f.unicodes[v],t);i.segments=i.segments.sort(function(me,ne){return me.start-ne.start})}DY(i);var x=i.segments.length,M=0,C=[],D=[],L=[],N=[],j=[],Z=[];for(t=0;t<x;t+=1){var G=i.segments[t];G.end<=65535&&G.start<=65535?(C=C.concat({name:"end_"+t,type:"USHORT",value:G.end}),D=D.concat({name:"start_"+t,type:"USHORT",value:G.start}),L=L.concat({name:"idDelta_"+t,type:"SHORT",value:G.delta}),N=N.concat({name:"idRangeOffset_"+t,type:"USHORT",value:G.offset}),G.glyphId!==void 0&&(j=j.concat({name:"glyph_"+t,type:"USHORT",value:G.glyphId}))):M+=1,!e&&G.glyphIndex!==void 0&&(Z=Z.concat({name:"cmap12Start_"+t,type:"ULONG",value:G.start}),Z=Z.concat({name:"cmap12End_"+t,type:"ULONG",value:G.end}),Z=Z.concat({name:"cmap12Glyph_"+t,type:"ULONG",value:G.glyphIndex}))}if(i.segCountX2=(x-M)*2,i.searchRange=Math.pow(2,Math.floor(Math.log(x-M)/Math.log(2)))*2,i.entrySelector=Math.log(i.searchRange/2)/Math.log(2),i.rangeShift=i.segCountX2-i.searchRange,i.fields=i.fields.concat(C),i.fields.push({name:"reservedPad",type:"USHORT",value:0}),i.fields=i.fields.concat(D),i.fields=i.fields.concat(L),i.fields=i.fields.concat(N),i.fields=i.fields.concat(j),i.cmap4Length=14+C.length*2+2+D.length*2+L.length*2+N.length*2+j.length*2,!e){var H=16+Z.length*4;i.cmap12Offset=12+2*2+4+i.cmap4Length,i.fields=i.fields.concat([{name:"cmap12Format",type:"USHORT",value:12},{name:"cmap12Reserved",type:"USHORT",value:0},{name:"cmap12Length",type:"ULONG",value:H},{name:"cmap12Language",type:"ULONG",value:0},{name:"cmap12nGroups",type:"ULONG",value:Z.length/3}]),i.fields=i.fields.concat(Z)}return i}var rD={parse:RY,make:LY},ly=[".notdef","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","endash","dagger","daggerdbl","periodcentered","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","questiondown","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","ring","cedilla","hungarumlaut","ogonek","caron","emdash","AE","ordfeminine","Lslash","Oslash","OE","ordmasculine","ae","dotlessi","lslash","oslash","oe","germandbls","onesuperior","logicalnot","mu","trademark","Eth","onehalf","plusminus","Thorn","onequarter","divide","brokenbar","degree","thorn","threequarters","twosuperior","registered","minus","eth","multiply","threesuperior","copyright","Aacute","Acircumflex","Adieresis","Agrave","Aring","Atilde","Ccedilla","Eacute","Ecircumflex","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Ntilde","Oacute","Ocircumflex","Odieresis","Ograve","Otilde","Scaron","Uacute","Ucircumflex","Udieresis","Ugrave","Yacute","Ydieresis","Zcaron","aacute","acircumflex","adieresis","agrave","aring","atilde","ccedilla","eacute","ecircumflex","edieresis","egrave","iacute","icircumflex","idieresis","igrave","ntilde","oacute","ocircumflex","odieresis","ograve","otilde","scaron","uacute","ucircumflex","udieresis","ugrave","yacute","ydieresis","zcaron","exclamsmall","Hungarumlautsmall","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","266 ff","onedotenleader","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","commasuperior","threequartersemdash","periodsuperior","questionsmall","asuperior","bsuperior","centsuperior","dsuperior","esuperior","isuperior","lsuperior","msuperior","nsuperior","osuperior","rsuperior","ssuperior","tsuperior","ff","ffi","ffl","parenleftinferior","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","exclamdownsmall","centoldstyle","Lslashsmall","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","Dotaccentsmall","Macronsmall","figuredash","hypheninferior","Ogoneksmall","Ringsmall","Cedillasmall","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","zerosuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall","001.000","001.001","001.002","001.003","Black","Bold","Book","Light","Medium","Regular","Roman","Semibold"],FY=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","","endash","dagger","daggerdbl","periodcentered","","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","","questiondown","","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","","ring","cedilla","","hungarumlaut","ogonek","caron","emdash","","","","","","","","","","","","","","","","","AE","","ordfeminine","","","","","Lslash","Oslash","OE","ordmasculine","","","","","","ae","","","","dotlessi","","","lslash","oslash","oe","germandbls"],OY=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclamsmall","Hungarumlautsmall","","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","twodotenleader","onedotenleader","comma","hyphen","period","fraction","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","colon","semicolon","commasuperior","threequartersemdash","periodsuperior","questionsmall","","asuperior","bsuperior","centsuperior","dsuperior","esuperior","","","isuperior","","","lsuperior","msuperior","nsuperior","osuperior","","","rsuperior","ssuperior","tsuperior","","ff","fi","fl","ffi","ffl","parenleftinferior","","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdownsmall","centoldstyle","Lslashsmall","","","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","","Dotaccentsmall","","","Macronsmall","","","figuredash","hypheninferior","","","Ogoneksmall","Ringsmall","Cedillasmall","","","","onequarter","onehalf","threequarters","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","","","zerosuperior","onesuperior","twosuperior","threesuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall"],np=[".notdef",".null","nonmarkingreturn","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quotesingle","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","grave","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","Adieresis","Aring","Ccedilla","Eacute","Ntilde","Odieresis","Udieresis","aacute","agrave","acircumflex","adieresis","atilde","aring","ccedilla","eacute","egrave","ecircumflex","edieresis","iacute","igrave","icircumflex","idieresis","ntilde","oacute","ograve","ocircumflex","odieresis","otilde","uacute","ugrave","ucircumflex","udieresis","dagger","degree","cent","sterling","section","bullet","paragraph","germandbls","registered","copyright","trademark","acute","dieresis","notequal","AE","Oslash","infinity","plusminus","lessequal","greaterequal","yen","mu","partialdiff","summation","product","pi","integral","ordfeminine","ordmasculine","Omega","ae","oslash","questiondown","exclamdown","logicalnot","radical","florin","approxequal","Delta","guillemotleft","guillemotright","ellipsis","nonbreakingspace","Agrave","Atilde","Otilde","OE","oe","endash","emdash","quotedblleft","quotedblright","quoteleft","quoteright","divide","lozenge","ydieresis","Ydieresis","fraction","currency","guilsinglleft","guilsinglright","fi","fl","daggerdbl","periodcentered","quotesinglbase","quotedblbase","perthousand","Acircumflex","Ecircumflex","Aacute","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Oacute","Ocircumflex","apple","Ograve","Uacute","Ucircumflex","Ugrave","dotlessi","circumflex","tilde","macron","breve","dotaccent","ring","cedilla","hungarumlaut","ogonek","caron","Lslash","lslash","Scaron","scaron","Zcaron","zcaron","brokenbar","Eth","eth","Yacute","yacute","Thorn","thorn","minus","multiply","onesuperior","twosuperior","threesuperior","onehalf","onequarter","threequarters","franc","Gbreve","gbreve","Idotaccent","Scedilla","scedilla","Cacute","cacute","Ccaron","ccaron","dcroat"];function sD(o){this.font=o}sD.prototype.charToGlyphIndex=function(o){var e=o.codePointAt(0),t=this.font.glyphs;if(t){for(var s=0;s<t.length;s+=1)for(var a=t.get(s),i=0;i<a.unicodes.length;i+=1)if(a.unicodes[i]===e)return s}return null};function oD(o){this.cmap=o}oD.prototype.charToGlyphIndex=function(o){return this.cmap.glyphIndexMap[o.codePointAt(0)]||0};function my(o,e){this.encoding=o,this.charset=e}my.prototype.charToGlyphIndex=function(o){var e=o.codePointAt(0),t=this.encoding[e];return this.charset.indexOf(t)};function C9(o){switch(o.version){case 1:this.names=np.slice();break;case 2:this.names=new Array(o.numberOfGlyphs);for(var e=0;e<o.numberOfGlyphs;e++)o.glyphNameIndex[e]<np.length?this.names[e]=np[o.glyphNameIndex[e]]:this.names[e]=o.names[o.glyphNameIndex[e]-np.length];break;case 2.5:this.names=new Array(o.numberOfGlyphs);for(var t=0;t<o.numberOfGlyphs;t++)this.names[t]=np[t+o.glyphNameIndex[t]];break;case 3:this.names=[];break;default:this.names=[];break}}C9.prototype.nameToGlyphIndex=function(o){return this.names.indexOf(o)};C9.prototype.glyphIndexToName=function(o){return this.names[o]};function NY(o){for(var e,t=o.tables.cmap.glyphIndexMap,s=Object.keys(t),a=0;a<s.length;a+=1){var i=s[a],f=t[i];e=o.glyphs.get(f),e.addUnicode(parseInt(i))}for(var v=0;v<o.glyphs.length;v+=1)e=o.glyphs.get(v),o.cffEncoding?o.isCIDFont?e.name="gid"+v:e.name=o.cffEncoding.charset[v]:o.glyphNames.names&&(e.name=o.glyphNames.glyphIndexToName(v))}function zY(o){o._IndexToUnicodeMap={};for(var e=o.tables.cmap.glyphIndexMap,t=Object.keys(e),s=0;s<t.length;s+=1){var a=t[s],i=e[a];o._IndexToUnicodeMap[i]===void 0?o._IndexToUnicodeMap[i]={unicodes:[parseInt(a)]}:o._IndexToUnicodeMap[i].unicodes.push(parseInt(a))}}function BY(o,e){e.lowMemory?zY(o):NY(o)}function UY(o,e,t,s,a){o.beginPath(),o.moveTo(e,t),o.lineTo(s,a),o.stroke()}var ip={line:UY};function VY(o,e){var t=e||new po;return{configurable:!0,get:function(){return typeof t=="function"&&(t=t()),t},set:function(s){t=s}}}function ml(o){this.bindConstructorValues(o)}ml.prototype.bindConstructorValues=function(o){this.index=o.index||0,this.name=o.name||null,this.unicode=o.unicode||void 0,this.unicodes=o.unicodes||o.unicode!==void 0?[o.unicode]:[],"xMin"in o&&(this.xMin=o.xMin),"yMin"in o&&(this.yMin=o.yMin),"xMax"in o&&(this.xMax=o.xMax),"yMax"in o&&(this.yMax=o.yMax),"advanceWidth"in o&&(this.advanceWidth=o.advanceWidth),Object.defineProperty(this,"path",VY(this,o.path))};ml.prototype.addUnicode=function(o){this.unicodes.length===0&&(this.unicode=o),this.unicodes.push(o)};ml.prototype.getBoundingBox=function(){return this.path.getBoundingBox()};ml.prototype.getPath=function(o,e,t,s,a){o=o!==void 0?o:0,e=e!==void 0?e:0,t=t!==void 0?t:72;var i,f;s||(s={});var v=s.xScale,x=s.yScale;if(s.hinting&&a&&a.hinting&&(f=this.path&&a.hinting.exec(this,t)),f)i=a.hinting.getCommands(f),o=Math.round(o),e=Math.round(e),v=x=1;else{i=this.path.commands;var M=1/(this.path.unitsPerEm||1e3)*t;v===void 0&&(v=M),x===void 0&&(x=M)}for(var C=new po,D=0;D<i.length;D+=1){var L=i[D];L.type==="M"?C.moveTo(o+L.x*v,e+-L.y*x):L.type==="L"?C.lineTo(o+L.x*v,e+-L.y*x):L.type==="Q"?C.quadraticCurveTo(o+L.x1*v,e+-L.y1*x,o+L.x*v,e+-L.y*x):L.type==="C"?C.curveTo(o+L.x1*v,e+-L.y1*x,o+L.x2*v,e+-L.y2*x,o+L.x*v,e+-L.y*x):L.type==="Z"&&C.closePath()}return C};ml.prototype.getContours=function(){if(this.points===void 0)return[];for(var o=[],e=[],t=0;t<this.points.length;t+=1){var s=this.points[t];e.push(s),s.lastPointOfContour&&(o.push(e),e=[])}return Zn.argument(e.length===0,"There are still points left in the current contour."),o};ml.prototype.getMetrics=function(){for(var o=this.path.commands,e=[],t=[],s=0;s<o.length;s+=1){var a=o[s];a.type!=="Z"&&(e.push(a.x),t.push(a.y)),(a.type==="Q"||a.type==="C")&&(e.push(a.x1),t.push(a.y1)),a.type==="C"&&(e.push(a.x2),t.push(a.y2))}var i={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,t),xMax:Math.max.apply(null,e),yMax:Math.max.apply(null,t),leftSideBearing:this.leftSideBearing};return isFinite(i.xMin)||(i.xMin=0),isFinite(i.xMax)||(i.xMax=this.advanceWidth),isFinite(i.yMin)||(i.yMin=0),isFinite(i.yMax)||(i.yMax=0),i.rightSideBearing=this.advanceWidth-i.leftSideBearing-(i.xMax-i.xMin),i};ml.prototype.draw=function(o,e,t,s,a){this.getPath(e,t,s,a).draw(o)};ml.prototype.drawPoints=function(o,e,t,s){function a(D,L,N,j){o.beginPath();for(var Z=0;Z<D.length;Z+=1)o.moveTo(L+D[Z].x*j,N+D[Z].y*j),o.arc(L+D[Z].x*j,N+D[Z].y*j,2,0,Math.PI*2,!1);o.closePath(),o.fill()}e=e!==void 0?e:0,t=t!==void 0?t:0,s=s!==void 0?s:24;for(var i=1/this.path.unitsPerEm*s,f=[],v=[],x=this.path,M=0;M<x.commands.length;M+=1){var C=x.commands[M];C.x!==void 0&&f.push({x:C.x,y:-C.y}),C.x1!==void 0&&v.push({x:C.x1,y:-C.y1}),C.x2!==void 0&&v.push({x:C.x2,y:-C.y2})}o.fillStyle="blue",a(f,e,t,i),o.fillStyle="red",a(v,e,t,i)};ml.prototype.drawMetrics=function(o,e,t,s){var a;e=e!==void 0?e:0,t=t!==void 0?t:0,s=s!==void 0?s:24,a=1/this.path.unitsPerEm*s,o.lineWidth=1,o.strokeStyle="black",ip.line(o,e,-1e4,e,1e4),ip.line(o,-1e4,t,1e4,t);var i=this.xMin||0,f=this.yMin||0,v=this.xMax||0,x=this.yMax||0,M=this.advanceWidth||0;o.strokeStyle="blue",ip.line(o,e+i*a,-1e4,e+i*a,1e4),ip.line(o,e+v*a,-1e4,e+v*a,1e4),ip.line(o,-1e4,t+-f*a,1e4,t+-f*a),ip.line(o,-1e4,t+-x*a,1e4,t+-x*a),o.strokeStyle="green",ip.line(o,e+M*a,-1e4,e+M*a,1e4)};function oy(o,e,t){Object.defineProperty(o,e,{get:function(){return o.path,o[t]},set:function(s){o[t]=s},enumerable:!0,configurable:!0})}function I9(o,e){if(this.font=o,this.glyphs={},Array.isArray(e))for(var t=0;t<e.length;t++){var s=e[t];s.path.unitsPerEm=o.unitsPerEm,this.glyphs[t]=s}this.length=e&&e.length||0}I9.prototype.get=function(o){if(this.glyphs[o]===void 0){this.font._push(o),typeof this.glyphs[o]=="function"&&(this.glyphs[o]=this.glyphs[o]());var e=this.glyphs[o],t=this.font._IndexToUnicodeMap[o];if(t)for(var s=0;s<t.unicodes.length;s++)e.addUnicode(t.unicodes[s]);this.font.cffEncoding?this.font.isCIDFont?e.name="gid"+o:e.name=this.font.cffEncoding.charset[o]:this.font.glyphNames.names&&(e.name=this.font.glyphNames.glyphIndexToName(o)),this.glyphs[o].advanceWidth=this.font._hmtxTableData[o].advanceWidth,this.glyphs[o].leftSideBearing=this.font._hmtxTableData[o].leftSideBearing}else typeof this.glyphs[o]=="function"&&(this.glyphs[o]=this.glyphs[o]());return this.glyphs[o]};I9.prototype.push=function(o,e){this.glyphs[o]=e,this.length++};function GY(o,e){return new ml({index:e,font:o})}function HY(o,e,t,s,a,i){return function(){var f=new ml({index:e,font:o});return f.path=function(){t(f,s,a);var v=i(o.glyphs,f);return v.unitsPerEm=o.unitsPerEm,v},oy(f,"xMin","_xMin"),oy(f,"xMax","_xMax"),oy(f,"yMin","_yMin"),oy(f,"yMax","_yMax"),f}}function jY(o,e,t,s){return function(){var a=new ml({index:e,font:o});return a.path=function(){var i=t(o,a,s);return i.unitsPerEm=o.unitsPerEm,i},a}}var i0={GlyphSet:I9,glyphLoader:GY,ttfGlyphLoader:HY,cffGlyphLoader:jY};function aD(o,e){if(o===e)return!0;if(Array.isArray(o)&&Array.isArray(e)){if(o.length!==e.length)return!1;for(var t=0;t<o.length;t+=1)if(!aD(o[t],e[t]))return!1;return!0}else return!1}function v9(o){var e;return o.length<1240?e=107:o.length<33900?e=1131:e=32768,e}function xd(o,e,t){var s=[],a=[],i=on.getCard16(o,e),f,v;if(i!==0){var x=on.getByte(o,e+2);f=e+(i+1)*x+2;for(var M=e+3,C=0;C<i+1;C+=1)s.push(on.getOffset(o,M,x)),M+=x;v=f+s[i]}else v=e+2;for(var D=0;D<s.length-1;D+=1){var L=on.getBytes(o,f+s[D],f+s[D+1]);t&&(L=t(L)),a.push(L)}return{objects:a,startOffset:e,endOffset:v}}function WY(o,e){var t=[],s=on.getCard16(o,e),a,i;if(s!==0){var f=on.getByte(o,e+2);a=e+(s+1)*f+2;for(var v=e+3,x=0;x<s+1;x+=1)t.push(on.getOffset(o,v,f)),v+=f;i=a+t[s]}else i=e+2;return{offsets:t,startOffset:e,endOffset:i}}function qY(o,e,t,s,a){var i=on.getCard16(t,s),f=0;if(i!==0){var v=on.getByte(t,s+2);f=s+(i+1)*v+2}var x=on.getBytes(t,f+e[o],f+e[o+1]);return a&&(x=a(x)),x}function XY(o){for(var e="",t=15,s=["0","1","2","3","4","5","6","7","8","9",".","E","E-",null,"-"];;){var a=o.parseByte(),i=a>>4,f=a&15;if(i===t||(e+=s[i],f===t))break;e+=s[f]}return parseFloat(e)}function ZY(o,e){var t,s,a,i;if(e===28)return t=o.parseByte(),s=o.parseByte(),t<<8|s;if(e===29)return t=o.parseByte(),s=o.parseByte(),a=o.parseByte(),i=o.parseByte(),t<<24|s<<16|a<<8|i;if(e===30)return XY(o);if(e>=32&&e<=246)return e-139;if(e>=247&&e<=250)return t=o.parseByte(),(e-247)*256+t+108;if(e>=251&&e<=254)return t=o.parseByte(),-(e-251)*256-t-108;throw new Error("Invalid b0 "+e)}function $Y(o){for(var e={},t=0;t<o.length;t+=1){var s=o[t][0],a=o[t][1],i=void 0;if(a.length===1?i=a[0]:i=a,e.hasOwnProperty(s)&&!isNaN(e[s]))throw new Error("Object "+e+" already has key "+s);e[s]=i}return e}function lD(o,e,t){e=e!==void 0?e:0;var s=new on.Parser(o,e),a=[],i=[];for(t=t!==void 0?t:o.length;s.relativeOffset<t;){var f=s.parseByte();f<=21?(f===12&&(f=1200+s.parseByte()),a.push([f,i]),i=[]):i.push(ZY(s,f))}return $Y(a)}function h_(o,e){return e<=390?e=ly[e]:e=o[e-391],e}function cD(o,e,t){for(var s={},a,i=0;i<e.length;i+=1){var f=e[i];if(Array.isArray(f.type)){var v=[];v.length=f.type.length;for(var x=0;x<f.type.length;x++)a=o[f.op]!==void 0?o[f.op][x]:void 0,a===void 0&&(a=f.value!==void 0&&f.value[x]!==void 0?f.value[x]:null),f.type[x]==="SID"&&(a=h_(t,a)),v[x]=a;s[f.name]=v}else a=o[f.op],a===void 0&&(a=f.value!==void 0?f.value:null),f.type==="SID"&&(a=h_(t,a)),s[f.name]=a}return s}function YY(o,e){var t={};return t.formatMajor=on.getCard8(o,e),t.formatMinor=on.getCard8(o,e+1),t.size=on.getCard8(o,e+2),t.offsetSize=on.getCard8(o,e+3),t.startOffset=e,t.endOffset=e+4,t}var hD=[{name:"version",op:0,type:"SID"},{name:"notice",op:1,type:"SID"},{name:"copyright",op:1200,type:"SID"},{name:"fullName",op:2,type:"SID"},{name:"familyName",op:3,type:"SID"},{name:"weight",op:4,type:"SID"},{name:"isFixedPitch",op:1201,type:"number",value:0},{name:"italicAngle",op:1202,type:"number",value:0},{name:"underlinePosition",op:1203,type:"number",value:-100},{name:"underlineThickness",op:1204,type:"number",value:50},{name:"paintType",op:1205,type:"number",value:0},{name:"charstringType",op:1206,type:"number",value:2},{name:"fontMatrix",op:1207,type:["real","real","real","real","real","real"],value:[.001,0,0,.001,0,0]},{name:"uniqueId",op:13,type:"number"},{name:"fontBBox",op:5,type:["number","number","number","number"],value:[0,0,0,0]},{name:"strokeWidth",op:1208,type:"number",value:0},{name:"xuid",op:14,type:[],value:null},{name:"charset",op:15,type:"offset",value:0},{name:"encoding",op:16,type:"offset",value:0},{name:"charStrings",op:17,type:"offset",value:0},{name:"private",op:18,type:["number","offset"],value:[0,0]},{name:"ros",op:1230,type:["SID","SID","number"]},{name:"cidFontVersion",op:1231,type:"number",value:0},{name:"cidFontRevision",op:1232,type:"number",value:0},{name:"cidFontType",op:1233,type:"number",value:0},{name:"cidCount",op:1234,type:"number",value:8720},{name:"uidBase",op:1235,type:"number"},{name:"fdArray",op:1236,type:"offset"},{name:"fdSelect",op:1237,type:"offset"},{name:"fontName",op:1238,type:"SID"}],dD=[{name:"subrs",op:19,type:"offset",value:0},{name:"defaultWidthX",op:20,type:"number",value:0},{name:"nominalWidthX",op:21,type:"number",value:0}];function JY(o,e){var t=lD(o,0,o.byteLength);return cD(t,hD,e)}function uD(o,e,t,s){var a=lD(o,e,t);return cD(a,dD,s)}function vk(o,e,t,s){for(var a=[],i=0;i<t.length;i+=1){var f=new DataView(new Uint8Array(t[i]).buffer),v=JY(f,s);v._subrs=[],v._subrsBias=0,v._defaultWidthX=0,v._nominalWidthX=0;var x=v.private[0],M=v.private[1];if(x!==0&&M!==0){var C=uD(o,M+e,x,s);if(v._defaultWidthX=C.defaultWidthX,v._nominalWidthX=C.nominalWidthX,C.subrs!==0){var D=M+C.subrs,L=xd(o,D+e);v._subrs=L.objects,v._subrsBias=v9(v._subrs)}v._privateDict=C}a.push(v)}return a}function KY(o,e,t,s){var a,i,f=new on.Parser(o,e);t-=1;var v=[".notdef"],x=f.parseCard8();if(x===0)for(var M=0;M<t;M+=1)a=f.parseSID(),v.push(h_(s,a));else if(x===1)for(;v.length<=t;){a=f.parseSID(),i=f.parseCard8();for(var C=0;C<=i;C+=1)v.push(h_(s,a)),a+=1}else if(x===2)for(;v.length<=t;){a=f.parseSID(),i=f.parseCard16();for(var D=0;D<=i;D+=1)v.push(h_(s,a)),a+=1}else throw new Error("Unknown charset format "+x);return v}function QY(o,e,t){var s,a={},i=new on.Parser(o,e),f=i.parseCard8();if(f===0)for(var v=i.parseCard8(),x=0;x<v;x+=1)s=i.parseCard8(),a[s]=x;else if(f===1){var M=i.parseCard8();s=1;for(var C=0;C<M;C+=1)for(var D=i.parseCard8(),L=i.parseCard8(),N=D;N<=D+L;N+=1)a[N]=s,s+=1}else throw new Error("Unknown encoding format "+f);return new my(a,t)}function xk(o,e,t){var s,a,i,f,v=new po,x=[],M=0,C=!1,D=!1,L=0,N=0,j,Z,G,H;if(o.isCIDFont){var me=o.tables.cff.topDict._fdSelect[e.index],ne=o.tables.cff.topDict._fdArray[me];j=ne._subrs,Z=ne._subrsBias,G=ne._defaultWidthX,H=ne._nominalWidthX}else j=o.tables.cff.topDict._subrs,Z=o.tables.cff.topDict._subrsBias,G=o.tables.cff.topDict._defaultWidthX,H=o.tables.cff.topDict._nominalWidthX;var fe=G;function Ee(Le,De){D&&v.closePath(),v.moveTo(Le,De),D=!0}function de(){var Le;Le=x.length%2!==0,Le&&!C&&(fe=x.shift()+H),M+=x.length>>1,x.length=0,C=!0}function we(Le){for(var De,se,Ce,Ne,zt,Ge,Xe,ht,Ot,bt,Tt,Nt,Bt=0;Bt<Le.length;){var Yt=Le[Bt];switch(Bt+=1,Yt){case 1:de();break;case 3:de();break;case 4:x.length>1&&!C&&(fe=x.shift()+H,C=!0),N+=x.pop(),Ee(L,N);break;case 5:for(;x.length>0;)L+=x.shift(),N+=x.shift(),v.lineTo(L,N);break;case 6:for(;x.length>0&&(L+=x.shift(),v.lineTo(L,N),x.length!==0);)N+=x.shift(),v.lineTo(L,N);break;case 7:for(;x.length>0&&(N+=x.shift(),v.lineTo(L,N),x.length!==0);)L+=x.shift(),v.lineTo(L,N);break;case 8:for(;x.length>0;)s=L+x.shift(),a=N+x.shift(),i=s+x.shift(),f=a+x.shift(),L=i+x.shift(),N=f+x.shift(),v.curveTo(s,a,i,f,L,N);break;case 10:zt=x.pop()+Z,Ge=j[zt],Ge&&we(Ge);break;case 11:return;case 12:switch(Yt=Le[Bt],Bt+=1,Yt){case 35:s=L+x.shift(),a=N+x.shift(),i=s+x.shift(),f=a+x.shift(),Xe=i+x.shift(),ht=f+x.shift(),Ot=Xe+x.shift(),bt=ht+x.shift(),Tt=Ot+x.shift(),Nt=bt+x.shift(),L=Tt+x.shift(),N=Nt+x.shift(),x.shift(),v.curveTo(s,a,i,f,Xe,ht),v.curveTo(Ot,bt,Tt,Nt,L,N);break;case 34:s=L+x.shift(),a=N,i=s+x.shift(),f=a+x.shift(),Xe=i+x.shift(),ht=f,Ot=Xe+x.shift(),bt=f,Tt=Ot+x.shift(),Nt=N,L=Tt+x.shift(),v.curveTo(s,a,i,f,Xe,ht),v.curveTo(Ot,bt,Tt,Nt,L,N);break;case 36:s=L+x.shift(),a=N+x.shift(),i=s+x.shift(),f=a+x.shift(),Xe=i+x.shift(),ht=f,Ot=Xe+x.shift(),bt=f,Tt=Ot+x.shift(),Nt=bt+x.shift(),L=Tt+x.shift(),v.curveTo(s,a,i,f,Xe,ht),v.curveTo(Ot,bt,Tt,Nt,L,N);break;case 37:s=L+x.shift(),a=N+x.shift(),i=s+x.shift(),f=a+x.shift(),Xe=i+x.shift(),ht=f+x.shift(),Ot=Xe+x.shift(),bt=ht+x.shift(),Tt=Ot+x.shift(),Nt=bt+x.shift(),Math.abs(Tt-L)>Math.abs(Nt-N)?L=Tt+x.shift():N=Nt+x.shift(),v.curveTo(s,a,i,f,Xe,ht),v.curveTo(Ot,bt,Tt,Nt,L,N);break;default:console.log("Glyph "+e.index+": unknown operator 1200"+Yt),x.length=0}break;case 14:x.length>0&&!C&&(fe=x.shift()+H,C=!0),D&&(v.closePath(),D=!1);break;case 18:de();break;case 19:case 20:de(),Bt+=M+7>>3;break;case 21:x.length>2&&!C&&(fe=x.shift()+H,C=!0),N+=x.pop(),L+=x.pop(),Ee(L,N);break;case 22:x.length>1&&!C&&(fe=x.shift()+H,C=!0),L+=x.pop(),Ee(L,N);break;case 23:de();break;case 24:for(;x.length>2;)s=L+x.shift(),a=N+x.shift(),i=s+x.shift(),f=a+x.shift(),L=i+x.shift(),N=f+x.shift(),v.curveTo(s,a,i,f,L,N);L+=x.shift(),N+=x.shift(),v.lineTo(L,N);break;case 25:for(;x.length>6;)L+=x.shift(),N+=x.shift(),v.lineTo(L,N);s=L+x.shift(),a=N+x.shift(),i=s+x.shift(),f=a+x.shift(),L=i+x.shift(),N=f+x.shift(),v.curveTo(s,a,i,f,L,N);break;case 26:for(x.length%2&&(L+=x.shift());x.length>0;)s=L,a=N+x.shift(),i=s+x.shift(),f=a+x.shift(),L=i,N=f+x.shift(),v.curveTo(s,a,i,f,L,N);break;case 27:for(x.length%2&&(N+=x.shift());x.length>0;)s=L+x.shift(),a=N,i=s+x.shift(),f=a+x.shift(),L=i+x.shift(),N=f,v.curveTo(s,a,i,f,L,N);break;case 28:De=Le[Bt],se=Le[Bt+1],x.push((De<<24|se<<16)>>16),Bt+=2;break;case 29:zt=x.pop()+o.gsubrsBias,Ge=o.gsubrs[zt],Ge&&we(Ge);break;case 30:for(;x.length>0&&(s=L,a=N+x.shift(),i=s+x.shift(),f=a+x.shift(),L=i+x.shift(),N=f+(x.length===1?x.shift():0),v.curveTo(s,a,i,f,L,N),x.length!==0);)s=L+x.shift(),a=N,i=s+x.shift(),f=a+x.shift(),N=f+x.shift(),L=i+(x.length===1?x.shift():0),v.curveTo(s,a,i,f,L,N);break;case 31:for(;x.length>0&&(s=L+x.shift(),a=N,i=s+x.shift(),f=a+x.shift(),N=f+x.shift(),L=i+(x.length===1?x.shift():0),v.curveTo(s,a,i,f,L,N),x.length!==0);)s=L,a=N+x.shift(),i=s+x.shift(),f=a+x.shift(),L=i+x.shift(),N=f+(x.length===1?x.shift():0),v.curveTo(s,a,i,f,L,N);break;default:Yt<32?console.log("Glyph "+e.index+": unknown operator "+Yt):Yt<247?x.push(Yt-139):Yt<251?(De=Le[Bt],Bt+=1,x.push((Yt-247)*256+De+108)):Yt<255?(De=Le[Bt],Bt+=1,x.push(-(Yt-251)*256-De-108)):(De=Le[Bt],se=Le[Bt+1],Ce=Le[Bt+2],Ne=Le[Bt+3],Bt+=4,x.push((De<<24|se<<16|Ce<<8|Ne)/65536))}}}return we(t),e.advanceWidth=fe,v}function eJ(o,e,t,s){var a=[],i,f=new on.Parser(o,e),v=f.parseCard8();if(v===0)for(var x=0;x<t;x++){if(i=f.parseCard8(),i>=s)throw new Error("CFF table CID Font FDSelect has bad FD index value "+i+" (FD count "+s+")");a.push(i)}else if(v===3){var M=f.parseCard16(),C=f.parseCard16();if(C!==0)throw new Error("CFF Table CID Font FDSelect format 3 range has bad initial GID "+C);for(var D,L=0;L<M;L++){if(i=f.parseCard8(),D=f.parseCard16(),i>=s)throw new Error("CFF table CID Font FDSelect has bad FD index value "+i+" (FD count "+s+")");if(D>t)throw new Error("CFF Table CID Font FDSelect format 3 range has bad GID "+D);for(;C<D;C++)a.push(i);C=D}if(D!==t)throw new Error("CFF Table CID Font FDSelect format 3 range has bad final GID "+D)}else throw new Error("CFF Table CID Font FDSelect table has unsupported format "+v);return a}function tJ(o,e,t,s){t.tables.cff={};var a=YY(o,e),i=xd(o,a.endOffset,on.bytesToString),f=xd(o,i.endOffset),v=xd(o,f.endOffset,on.bytesToString),x=xd(o,v.endOffset);t.gsubrs=x.objects,t.gsubrsBias=v9(t.gsubrs);var M=vk(o,e,f.objects,v.objects);if(M.length!==1)throw new Error("CFF table has too many fonts in 'FontSet' - count of fonts NameIndex.length = "+M.length);var C=M[0];if(t.tables.cff.topDict=C,C._privateDict&&(t.defaultWidthX=C._privateDict.defaultWidthX,t.nominalWidthX=C._privateDict.nominalWidthX),C.ros[0]!==void 0&&C.ros[1]!==void 0&&(t.isCIDFont=!0),t.isCIDFont){var D=C.fdArray,L=C.fdSelect;if(D===0||L===0)throw new Error("Font is marked as a CID font, but FDArray and/or FDSelect information is missing");D+=e;var N=xd(o,D),j=vk(o,e,N.objects,v.objects);C._fdArray=j,L+=e,C._fdSelect=eJ(o,L,t.numGlyphs,j.length)}var Z=e+C.private[1],G=uD(o,Z,C.private[0],v.objects);if(t.defaultWidthX=G.defaultWidthX,t.nominalWidthX=G.nominalWidthX,G.subrs!==0){var H=Z+G.subrs,me=xd(o,H);t.subrs=me.objects,t.subrsBias=v9(t.subrs)}else t.subrs=[],t.subrsBias=0;var ne;s.lowMemory?(ne=WY(o,e+C.charStrings),t.nGlyphs=ne.offsets.length):(ne=xd(o,e+C.charStrings),t.nGlyphs=ne.objects.length);var fe=KY(o,e+C.charset,t.nGlyphs,v.objects);if(C.encoding===0?t.cffEncoding=new my(FY,fe):C.encoding===1?t.cffEncoding=new my(OY,fe):t.cffEncoding=QY(o,e+C.encoding,fe),t.encoding=t.encoding||t.cffEncoding,t.glyphs=new i0.GlyphSet(t),s.lowMemory)t._push=function(we){var Le=qY(we,ne.offsets,o,e+C.charStrings);t.glyphs.push(we,i0.cffGlyphLoader(t,we,xk,Le))};else for(var Ee=0;Ee<t.nGlyphs;Ee+=1){var de=ne.objects[Ee];t.glyphs.push(Ee,i0.cffGlyphLoader(t,Ee,xk,de))}}function pD(o,e){var t,s=ly.indexOf(o);return s>=0&&(t=s),s=e.indexOf(o),s>=0?t=s+ly.length:(t=ly.length+e.length,e.push(o)),t}function iJ(){return new Xi.Record("Header",[{name:"major",type:"Card8",value:1},{name:"minor",type:"Card8",value:0},{name:"hdrSize",type:"Card8",value:4},{name:"major",type:"Card8",value:1}])}function nJ(o){var e=new Xi.Record("Name INDEX",[{name:"names",type:"INDEX",value:[]}]);e.names=[];for(var t=0;t<o.length;t+=1)e.names.push({name:"name_"+t,type:"NAME",value:o[t]});return e}function fD(o,e,t){for(var s={},a=0;a<o.length;a+=1){var i=o[a],f=e[i.name];f!==void 0&&!aD(f,i.value)&&(i.type==="SID"&&(f=pD(f,t)),s[i.op]={name:i.name,type:i.type,value:f})}return s}function bk(o,e){var t=new Xi.Record("Top DICT",[{name:"dict",type:"DICT",value:{}}]);return t.dict=fD(hD,o,e),t}function wk(o){var e=new Xi.Record("Top DICT INDEX",[{name:"topDicts",type:"INDEX",value:[]}]);return e.topDicts=[{name:"topDict_0",type:"TABLE",value:o}],e}function rJ(o){var e=new Xi.Record("String INDEX",[{name:"strings",type:"INDEX",value:[]}]);e.strings=[];for(var t=0;t<o.length;t+=1)e.strings.push({name:"string_"+t,type:"STRING",value:o[t]});return e}function sJ(){return new Xi.Record("Global Subr INDEX",[{name:"subrs",type:"INDEX",value:[]}])}function oJ(o,e){for(var t=new Xi.Record("Charsets",[{name:"format",type:"Card8",value:0}]),s=0;s<o.length;s+=1){var a=o[s],i=pD(a,e);t.fields.push({name:"glyph_"+s,type:"SID",value:i})}return t}function aJ(o){var e=[],t=o.path;e.push({name:"width",type:"NUMBER",value:o.advanceWidth});for(var s=0,a=0,i=0;i<t.commands.length;i+=1){var f=void 0,v=void 0,x=t.commands[i];if(x.type==="Q"){var M=.3333333333333333,C=2/3;x={type:"C",x:x.x,y:x.y,x1:Math.round(M*s+C*x.x1),y1:Math.round(M*a+C*x.y1),x2:Math.round(M*x.x+C*x.x1),y2:Math.round(M*x.y+C*x.y1)}}if(x.type==="M")f=Math.round(x.x-s),v=Math.round(x.y-a),e.push({name:"dx",type:"NUMBER",value:f}),e.push({name:"dy",type:"NUMBER",value:v}),e.push({name:"rmoveto",type:"OP",value:21}),s=Math.round(x.x),a=Math.round(x.y);else if(x.type==="L")f=Math.round(x.x-s),v=Math.round(x.y-a),e.push({name:"dx",type:"NUMBER",value:f}),e.push({name:"dy",type:"NUMBER",value:v}),e.push({name:"rlineto",type:"OP",value:5}),s=Math.round(x.x),a=Math.round(x.y);else if(x.type==="C"){var D=Math.round(x.x1-s),L=Math.round(x.y1-a),N=Math.round(x.x2-x.x1),j=Math.round(x.y2-x.y1);f=Math.round(x.x-x.x2),v=Math.round(x.y-x.y2),e.push({name:"dx1",type:"NUMBER",value:D}),e.push({name:"dy1",type:"NUMBER",value:L}),e.push({name:"dx2",type:"NUMBER",value:N}),e.push({name:"dy2",type:"NUMBER",value:j}),e.push({name:"dx",type:"NUMBER",value:f}),e.push({name:"dy",type:"NUMBER",value:v}),e.push({name:"rrcurveto",type:"OP",value:8}),s=Math.round(x.x),a=Math.round(x.y)}}return e.push({name:"endchar",type:"OP",value:14}),e}function lJ(o){for(var e=new Xi.Record("CharStrings INDEX",[{name:"charStrings",type:"INDEX",value:[]}]),t=0;t<o.length;t+=1){var s=o.get(t),a=aJ(s);e.charStrings.push({name:s.name,type:"CHARSTRING",value:a})}return e}function cJ(o,e){var t=new Xi.Record("Private DICT",[{name:"dict",type:"DICT",value:{}}]);return t.dict=fD(dD,o,e),t}function hJ(o,e){for(var t=new Xi.Table("CFF ",[{name:"header",type:"RECORD"},{name:"nameIndex",type:"RECORD"},{name:"topDictIndex",type:"RECORD"},{name:"stringIndex",type:"RECORD"},{name:"globalSubrIndex",type:"RECORD"},{name:"charsets",type:"RECORD"},{name:"charStringsIndex",type:"RECORD"},{name:"privateDict",type:"RECORD"}]),s=1/e.unitsPerEm,a={version:e.version,fullName:e.fullName,familyName:e.familyName,weight:e.weightName,fontBBox:e.fontBBox||[0,0,0,0],fontMatrix:[s,0,0,s,0,0],charset:999,encoding:0,charStrings:999,private:[0,999]},i={},f=[],v,x=1;x<o.length;x+=1)v=o.get(x),f.push(v.name);var M=[];t.header=iJ(),t.nameIndex=nJ([e.postScriptName]);var C=bk(a,M);t.topDictIndex=wk(C),t.globalSubrIndex=sJ(),t.charsets=oJ(f,M),t.charStringsIndex=lJ(o),t.privateDict=cJ(i,M),t.stringIndex=rJ(M);var D=t.header.sizeOf()+t.nameIndex.sizeOf()+t.topDictIndex.sizeOf()+t.stringIndex.sizeOf()+t.globalSubrIndex.sizeOf();return a.charset=D,a.encoding=0,a.charStrings=a.charset+t.charsets.sizeOf(),a.private[1]=a.charStrings+t.charStringsIndex.sizeOf(),C=bk(a,M),t.topDictIndex=wk(C),t}var mD={parse:tJ,make:hJ};function dJ(o,e){var t={},s=new on.Parser(o,e);return t.version=s.parseVersion(),t.fontRevision=Math.round(s.parseFixed()*1e3)/1e3,t.checkSumAdjustment=s.parseULong(),t.magicNumber=s.parseULong(),Zn.argument(t.magicNumber===1594834165,"Font header has wrong magic number."),t.flags=s.parseUShort(),t.unitsPerEm=s.parseUShort(),t.created=s.parseLongDateTime(),t.modified=s.parseLongDateTime(),t.xMin=s.parseShort(),t.yMin=s.parseShort(),t.xMax=s.parseShort(),t.yMax=s.parseShort(),t.macStyle=s.parseUShort(),t.lowestRecPPEM=s.parseUShort(),t.fontDirectionHint=s.parseShort(),t.indexToLocFormat=s.parseShort(),t.glyphDataFormat=s.parseShort(),t}function uJ(o){var e=Math.round(new Date().getTime()/1e3)+2082844800,t=e;return o.createdTimestamp&&(t=o.createdTimestamp+2082844800),new Xi.Table("head",[{name:"version",type:"FIXED",value:65536},{name:"fontRevision",type:"FIXED",value:65536},{name:"checkSumAdjustment",type:"ULONG",value:0},{name:"magicNumber",type:"ULONG",value:1594834165},{name:"flags",type:"USHORT",value:0},{name:"unitsPerEm",type:"USHORT",value:1e3},{name:"created",type:"LONGDATETIME",value:t},{name:"modified",type:"LONGDATETIME",value:e},{name:"xMin",type:"SHORT",value:0},{name:"yMin",type:"SHORT",value:0},{name:"xMax",type:"SHORT",value:0},{name:"yMax",type:"SHORT",value:0},{name:"macStyle",type:"USHORT",value:0},{name:"lowestRecPPEM",type:"USHORT",value:0},{name:"fontDirectionHint",type:"SHORT",value:2},{name:"indexToLocFormat",type:"SHORT",value:0},{name:"glyphDataFormat",type:"SHORT",value:0}],o)}var gD={parse:dJ,make:uJ};function pJ(o,e){var t={},s=new on.Parser(o,e);return t.version=s.parseVersion(),t.ascender=s.parseShort(),t.descender=s.parseShort(),t.lineGap=s.parseShort(),t.advanceWidthMax=s.parseUShort(),t.minLeftSideBearing=s.parseShort(),t.minRightSideBearing=s.parseShort(),t.xMaxExtent=s.parseShort(),t.caretSlopeRise=s.parseShort(),t.caretSlopeRun=s.parseShort(),t.caretOffset=s.parseShort(),s.relativeOffset+=8,t.metricDataFormat=s.parseShort(),t.numberOfHMetrics=s.parseUShort(),t}function fJ(o){return new Xi.Table("hhea",[{name:"version",type:"FIXED",value:65536},{name:"ascender",type:"FWORD",value:0},{name:"descender",type:"FWORD",value:0},{name:"lineGap",type:"FWORD",value:0},{name:"advanceWidthMax",type:"UFWORD",value:0},{name:"minLeftSideBearing",type:"FWORD",value:0},{name:"minRightSideBearing",type:"FWORD",value:0},{name:"xMaxExtent",type:"FWORD",value:0},{name:"caretSlopeRise",type:"SHORT",value:1},{name:"caretSlopeRun",type:"SHORT",value:0},{name:"caretOffset",type:"SHORT",value:0},{name:"reserved1",type:"SHORT",value:0},{name:"reserved2",type:"SHORT",value:0},{name:"reserved3",type:"SHORT",value:0},{name:"reserved4",type:"SHORT",value:0},{name:"metricDataFormat",type:"SHORT",value:0},{name:"numberOfHMetrics",type:"USHORT",value:0}],o)}var _D={parse:pJ,make:fJ};function mJ(o,e,t,s,a){for(var i,f,v=new on.Parser(o,e),x=0;x<s;x+=1){x<t&&(i=v.parseUShort(),f=v.parseShort());var M=a.get(x);M.advanceWidth=i,M.leftSideBearing=f}}function gJ(o,e,t,s,a){o._hmtxTableData={};for(var i,f,v=new on.Parser(e,t),x=0;x<a;x+=1)x<s&&(i=v.parseUShort(),f=v.parseShort()),o._hmtxTableData[x]={advanceWidth:i,leftSideBearing:f}}function _J(o,e,t,s,a,i,f){f.lowMemory?gJ(o,e,t,s,a):mJ(e,t,s,a,i)}function yJ(o){for(var e=new Xi.Table("hmtx",[]),t=0;t<o.length;t+=1){var s=o.get(t),a=s.advanceWidth||0,i=s.leftSideBearing||0;e.fields.push({name:"advanceWidth_"+t,type:"USHORT",value:a}),e.fields.push({name:"leftSideBearing_"+t,type:"SHORT",value:i})}return e}var yD={parse:_J,make:yJ};function vJ(o){for(var e=new Xi.Table("ltag",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"numTags",type:"ULONG",value:o.length}]),t="",s=12+o.length*4,a=0;a<o.length;++a){var i=t.indexOf(o[a]);i<0&&(i=t.length,t+=o[a]),e.fields.push({name:"offset "+a,type:"USHORT",value:s+i}),e.fields.push({name:"length "+a,type:"USHORT",value:o[a].length})}return e.fields.push({name:"stringPool",type:"CHARARRAY",value:t}),e}function xJ(o,e){var t=new on.Parser(o,e),s=t.parseULong();Zn.argument(s===1,"Unsupported ltag table version."),t.skip("uLong",1);for(var a=t.parseULong(),i=[],f=0;f<a;f++){for(var v="",x=e+t.parseUShort(),M=t.parseUShort(),C=x;C<x+M;++C)v+=String.fromCharCode(o.getInt8(C));i.push(v)}return i}var vD={make:vJ,parse:xJ};function bJ(o,e){var t={},s=new on.Parser(o,e);return t.version=s.parseVersion(),t.numGlyphs=s.parseUShort(),t.version===1&&(t.maxPoints=s.parseUShort(),t.maxContours=s.parseUShort(),t.maxCompositePoints=s.parseUShort(),t.maxCompositeContours=s.parseUShort(),t.maxZones=s.parseUShort(),t.maxTwilightPoints=s.parseUShort(),t.maxStorage=s.parseUShort(),t.maxFunctionDefs=s.parseUShort(),t.maxInstructionDefs=s.parseUShort(),t.maxStackElements=s.parseUShort(),t.maxSizeOfInstructions=s.parseUShort(),t.maxComponentElements=s.parseUShort(),t.maxComponentDepth=s.parseUShort()),t}function wJ(o){return new Xi.Table("maxp",[{name:"version",type:"FIXED",value:20480},{name:"numGlyphs",type:"USHORT",value:o}])}var xD={parse:bJ,make:wJ},bD=["copyright","fontFamily","fontSubfamily","uniqueID","fullName","version","postScriptName","trademark","manufacturer","designer","description","manufacturerURL","designerURL","license","licenseURL","reserved","preferredFamily","preferredSubfamily","compatibleFullName","sampleText","postScriptFindFontName","wwsFamily","wwsSubfamily"],wD={0:"en",1:"fr",2:"de",3:"it",4:"nl",5:"sv",6:"es",7:"da",8:"pt",9:"no",10:"he",11:"ja",12:"ar",13:"fi",14:"el",15:"is",16:"mt",17:"tr",18:"hr",19:"zh-Hant",20:"ur",21:"hi",22:"th",23:"ko",24:"lt",25:"pl",26:"hu",27:"es",28:"lv",29:"se",30:"fo",31:"fa",32:"ru",33:"zh",34:"nl-BE",35:"ga",36:"sq",37:"ro",38:"cz",39:"sk",40:"si",41:"yi",42:"sr",43:"mk",44:"bg",45:"uk",46:"be",47:"uz",48:"kk",49:"az-Cyrl",50:"az-Arab",51:"hy",52:"ka",53:"mo",54:"ky",55:"tg",56:"tk",57:"mn-CN",58:"mn",59:"ps",60:"ks",61:"ku",62:"sd",63:"bo",64:"ne",65:"sa",66:"mr",67:"bn",68:"as",69:"gu",70:"pa",71:"or",72:"ml",73:"kn",74:"ta",75:"te",76:"si",77:"my",78:"km",79:"lo",80:"vi",81:"id",82:"tl",83:"ms",84:"ms-Arab",85:"am",86:"ti",87:"om",88:"so",89:"sw",90:"rw",91:"rn",92:"ny",93:"mg",94:"eo",128:"cy",129:"eu",130:"ca",131:"la",132:"qu",133:"gn",134:"ay",135:"tt",136:"ug",137:"dz",138:"jv",139:"su",140:"gl",141:"af",142:"br",143:"iu",144:"gd",145:"gv",146:"ga",147:"to",148:"el-polyton",149:"kl",150:"az",151:"nn"},SJ={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:5,11:1,12:4,13:0,14:6,15:0,16:0,17:0,18:0,19:2,20:4,21:9,22:21,23:3,24:29,25:29,26:29,27:29,28:29,29:0,30:0,31:4,32:7,33:25,34:0,35:0,36:0,37:0,38:29,39:29,40:0,41:5,42:7,43:7,44:7,45:7,46:7,47:7,48:7,49:7,50:4,51:24,52:23,53:7,54:7,55:7,56:7,57:27,58:7,59:4,60:4,61:4,62:4,63:26,64:9,65:9,66:9,67:13,68:13,69:11,70:10,71:12,72:17,73:16,74:14,75:15,76:18,77:19,78:20,79:22,80:30,81:0,82:0,83:0,84:4,85:28,86:28,87:28,88:0,89:0,90:0,91:0,92:0,93:0,94:0,128:0,129:0,130:0,131:0,132:0,133:0,134:0,135:7,136:4,137:26,138:0,139:0,140:0,141:0,142:0,143:28,144:0,145:0,146:0,147:0,148:6,149:0,150:0,151:0},SD={1078:"af",1052:"sq",1156:"gsw",1118:"am",5121:"ar-DZ",15361:"ar-BH",3073:"ar",2049:"ar-IQ",11265:"ar-JO",13313:"ar-KW",12289:"ar-LB",4097:"ar-LY",6145:"ary",8193:"ar-OM",16385:"ar-QA",1025:"ar-SA",10241:"ar-SY",7169:"aeb",14337:"ar-AE",9217:"ar-YE",1067:"hy",1101:"as",2092:"az-Cyrl",1068:"az",1133:"ba",1069:"eu",1059:"be",2117:"bn",1093:"bn-IN",8218:"bs-Cyrl",5146:"bs",1150:"br",1026:"bg",1027:"ca",3076:"zh-HK",5124:"zh-MO",2052:"zh",4100:"zh-SG",1028:"zh-TW",1155:"co",1050:"hr",4122:"hr-BA",1029:"cs",1030:"da",1164:"prs",1125:"dv",2067:"nl-BE",1043:"nl",3081:"en-AU",10249:"en-BZ",4105:"en-CA",9225:"en-029",16393:"en-IN",6153:"en-IE",8201:"en-JM",17417:"en-MY",5129:"en-NZ",13321:"en-PH",18441:"en-SG",7177:"en-ZA",11273:"en-TT",2057:"en-GB",1033:"en",12297:"en-ZW",1061:"et",1080:"fo",1124:"fil",1035:"fi",2060:"fr-BE",3084:"fr-CA",1036:"fr",5132:"fr-LU",6156:"fr-MC",4108:"fr-CH",1122:"fy",1110:"gl",1079:"ka",3079:"de-AT",1031:"de",5127:"de-LI",4103:"de-LU",2055:"de-CH",1032:"el",1135:"kl",1095:"gu",1128:"ha",1037:"he",1081:"hi",1038:"hu",1039:"is",1136:"ig",1057:"id",1117:"iu",2141:"iu-Latn",2108:"ga",1076:"xh",1077:"zu",1040:"it",2064:"it-CH",1041:"ja",1099:"kn",1087:"kk",1107:"km",1158:"quc",1159:"rw",1089:"sw",1111:"kok",1042:"ko",1088:"ky",1108:"lo",1062:"lv",1063:"lt",2094:"dsb",1134:"lb",1071:"mk",2110:"ms-BN",1086:"ms",1100:"ml",1082:"mt",1153:"mi",1146:"arn",1102:"mr",1148:"moh",1104:"mn",2128:"mn-CN",1121:"ne",1044:"nb",2068:"nn",1154:"oc",1096:"or",1123:"ps",1045:"pl",1046:"pt",2070:"pt-PT",1094:"pa",1131:"qu-BO",2155:"qu-EC",3179:"qu",1048:"ro",1047:"rm",1049:"ru",9275:"smn",4155:"smj-NO",5179:"smj",3131:"se-FI",1083:"se",2107:"se-SE",8251:"sms",6203:"sma-NO",7227:"sms",1103:"sa",7194:"sr-Cyrl-BA",3098:"sr",6170:"sr-Latn-BA",2074:"sr-Latn",1132:"nso",1074:"tn",1115:"si",1051:"sk",1060:"sl",11274:"es-AR",16394:"es-BO",13322:"es-CL",9226:"es-CO",5130:"es-CR",7178:"es-DO",12298:"es-EC",17418:"es-SV",4106:"es-GT",18442:"es-HN",2058:"es-MX",19466:"es-NI",6154:"es-PA",15370:"es-PY",10250:"es-PE",20490:"es-PR",3082:"es",1034:"es",21514:"es-US",14346:"es-UY",8202:"es-VE",2077:"sv-FI",1053:"sv",1114:"syr",1064:"tg",2143:"tzm",1097:"ta",1092:"tt",1098:"te",1054:"th",1105:"bo",1055:"tr",1090:"tk",1152:"ug",1058:"uk",1070:"hsb",1056:"ur",2115:"uz-Cyrl",1091:"uz",1066:"vi",1106:"cy",1160:"wo",1157:"sah",1144:"ii",1130:"yo"};function TJ(o,e,t){switch(o){case 0:if(e===65535)return"und";if(t)return t[e];break;case 1:return wD[e];case 3:return SD[e]}}var x9="utf-16",MJ={0:"macintosh",1:"x-mac-japanese",2:"x-mac-chinesetrad",3:"x-mac-korean",6:"x-mac-greek",7:"x-mac-cyrillic",9:"x-mac-devanagai",10:"x-mac-gurmukhi",11:"x-mac-gujarati",12:"x-mac-oriya",13:"x-mac-bengali",14:"x-mac-tamil",15:"x-mac-telugu",16:"x-mac-kannada",17:"x-mac-malayalam",18:"x-mac-sinhalese",19:"x-mac-burmese",20:"x-mac-khmer",21:"x-mac-thai",22:"x-mac-lao",23:"x-mac-georgian",24:"x-mac-armenian",25:"x-mac-chinesesimp",26:"x-mac-tibetan",27:"x-mac-mongolian",28:"x-mac-ethiopic",29:"x-mac-ce",30:"x-mac-vietnamese",31:"x-mac-extarabic"},EJ={15:"x-mac-icelandic",17:"x-mac-turkish",18:"x-mac-croatian",24:"x-mac-ce",25:"x-mac-ce",26:"x-mac-ce",27:"x-mac-ce",28:"x-mac-ce",30:"x-mac-icelandic",37:"x-mac-romanian",38:"x-mac-ce",39:"x-mac-ce",40:"x-mac-ce",143:"x-mac-inuit",146:"x-mac-gaelic"};function TD(o,e,t){switch(o){case 0:return x9;case 1:return EJ[t]||MJ[e];case 3:if(e===1||e===10)return x9;break}}function AJ(o,e,t){for(var s={},a=new on.Parser(o,e),i=a.parseUShort(),f=a.parseUShort(),v=a.offset+a.parseUShort(),x=0;x<f;x++){var M=a.parseUShort(),C=a.parseUShort(),D=a.parseUShort(),L=a.parseUShort(),N=bD[L]||L,j=a.parseUShort(),Z=a.parseUShort(),G=TJ(M,D,t),H=TD(M,C,D);if(H!==void 0&&G!==void 0){var me=void 0;if(H===x9?me=Sf.UTF16(o,v+Z,j):me=Sf.MACSTRING(o,v+Z,j,H),me){var ne=s[N];ne===void 0&&(ne=s[N]={}),ne[G]=me}}}var fe=0;return i===1&&(fe=a.parseUShort()),s}function a9(o){var e={};for(var t in o)e[o[t]]=parseInt(t);return e}function Sk(o,e,t,s,a,i){return new Xi.Record("NameRecord",[{name:"platformID",type:"USHORT",value:o},{name:"encodingID",type:"USHORT",value:e},{name:"languageID",type:"USHORT",value:t},{name:"nameID",type:"USHORT",value:s},{name:"length",type:"USHORT",value:a},{name:"offset",type:"USHORT",value:i}])}function CJ(o,e){var t=o.length,s=e.length-t+1;e:for(var a=0;a<s;a++)for(;a<s;a++){for(var i=0;i<t;i++)if(e[a+i]!==o[i])continue e;return a}return-1}function Tk(o,e){var t=CJ(o,e);if(t<0){t=e.length;for(var s=0,a=o.length;s<a;++s)e.push(o[s])}return t}function IJ(o,e){var t,s=[],a={},i=a9(bD);for(var f in o){var v=i[f];if(v===void 0&&(v=f),t=parseInt(v),isNaN(t))throw new Error('Name table entry "'+f+'" does not exist, see nameTableNames for complete list.');a[t]=o[f],s.push(t)}for(var x=a9(wD),M=a9(SD),C=[],D=[],L=0;L<s.length;L++){t=s[L];var N=a[t];for(var j in N){var Z=N[j],G=1,H=x[j],me=SJ[H],ne=TD(G,me,H),fe=Li.MACSTRING(Z,ne);fe===void 0&&(G=0,H=e.indexOf(j),H<0&&(H=e.length,e.push(j)),me=4,fe=Li.UTF16(Z));var Ee=Tk(fe,D);C.push(Sk(G,me,H,t,fe.length,Ee));var de=M[j];if(de!==void 0){var we=Li.UTF16(Z),Le=Tk(we,D);C.push(Sk(3,1,de,t,we.length,Le))}}}C.sort(function(Ce,Ne){return Ce.platformID-Ne.platformID||Ce.encodingID-Ne.encodingID||Ce.languageID-Ne.languageID||Ce.nameID-Ne.nameID});for(var De=new Xi.Table("name",[{name:"format",type:"USHORT",value:0},{name:"count",type:"USHORT",value:C.length},{name:"stringOffset",type:"USHORT",value:6+C.length*12}]),se=0;se<C.length;se++)De.fields.push({name:"record_"+se,type:"RECORD",value:C[se]});return De.fields.push({name:"strings",type:"LITERAL",value:D}),De}var MD={parse:AJ,make:IJ},b9=[{begin:0,end:127},{begin:128,end:255},{begin:256,end:383},{begin:384,end:591},{begin:592,end:687},{begin:688,end:767},{begin:768,end:879},{begin:880,end:1023},{begin:11392,end:11519},{begin:1024,end:1279},{begin:1328,end:1423},{begin:1424,end:1535},{begin:42240,end:42559},{begin:1536,end:1791},{begin:1984,end:2047},{begin:2304,end:2431},{begin:2432,end:2559},{begin:2560,end:2687},{begin:2688,end:2815},{begin:2816,end:2943},{begin:2944,end:3071},{begin:3072,end:3199},{begin:3200,end:3327},{begin:3328,end:3455},{begin:3584,end:3711},{begin:3712,end:3839},{begin:4256,end:4351},{begin:6912,end:7039},{begin:4352,end:4607},{begin:7680,end:7935},{begin:7936,end:8191},{begin:8192,end:8303},{begin:8304,end:8351},{begin:8352,end:8399},{begin:8400,end:8447},{begin:8448,end:8527},{begin:8528,end:8591},{begin:8592,end:8703},{begin:8704,end:8959},{begin:8960,end:9215},{begin:9216,end:9279},{begin:9280,end:9311},{begin:9312,end:9471},{begin:9472,end:9599},{begin:9600,end:9631},{begin:9632,end:9727},{begin:9728,end:9983},{begin:9984,end:10175},{begin:12288,end:12351},{begin:12352,end:12447},{begin:12448,end:12543},{begin:12544,end:12591},{begin:12592,end:12687},{begin:43072,end:43135},{begin:12800,end:13055},{begin:13056,end:13311},{begin:44032,end:55215},{begin:55296,end:57343},{begin:67840,end:67871},{begin:19968,end:40959},{begin:57344,end:63743},{begin:12736,end:12783},{begin:64256,end:64335},{begin:64336,end:65023},{begin:65056,end:65071},{begin:65040,end:65055},{begin:65104,end:65135},{begin:65136,end:65279},{begin:65280,end:65519},{begin:65520,end:65535},{begin:3840,end:4095},{begin:1792,end:1871},{begin:1920,end:1983},{begin:3456,end:3583},{begin:4096,end:4255},{begin:4608,end:4991},{begin:5024,end:5119},{begin:5120,end:5759},{begin:5760,end:5791},{begin:5792,end:5887},{begin:6016,end:6143},{begin:6144,end:6319},{begin:10240,end:10495},{begin:40960,end:42127},{begin:5888,end:5919},{begin:66304,end:66351},{begin:66352,end:66383},{begin:66560,end:66639},{begin:118784,end:119039},{begin:119808,end:120831},{begin:1044480,end:1048573},{begin:65024,end:65039},{begin:917504,end:917631},{begin:6400,end:6479},{begin:6480,end:6527},{begin:6528,end:6623},{begin:6656,end:6687},{begin:11264,end:11359},{begin:11568,end:11647},{begin:19904,end:19967},{begin:43008,end:43055},{begin:65536,end:65663},{begin:65856,end:65935},{begin:66432,end:66463},{begin:66464,end:66527},{begin:66640,end:66687},{begin:66688,end:66735},{begin:67584,end:67647},{begin:68096,end:68191},{begin:119552,end:119647},{begin:73728,end:74751},{begin:119648,end:119679},{begin:7040,end:7103},{begin:7168,end:7247},{begin:7248,end:7295},{begin:43136,end:43231},{begin:43264,end:43311},{begin:43312,end:43359},{begin:43520,end:43615},{begin:65936,end:65999},{begin:66e3,end:66047},{begin:66208,end:66271},{begin:127024,end:127135}];function PJ(o){for(var e=0;e<b9.length;e+=1){var t=b9[e];if(o>=t.begin&&o<t.end)return e}return-1}function RJ(o,e){var t={},s=new on.Parser(o,e);t.version=s.parseUShort(),t.xAvgCharWidth=s.parseShort(),t.usWeightClass=s.parseUShort(),t.usWidthClass=s.parseUShort(),t.fsType=s.parseUShort(),t.ySubscriptXSize=s.parseShort(),t.ySubscriptYSize=s.parseShort(),t.ySubscriptXOffset=s.parseShort(),t.ySubscriptYOffset=s.parseShort(),t.ySuperscriptXSize=s.parseShort(),t.ySuperscriptYSize=s.parseShort(),t.ySuperscriptXOffset=s.parseShort(),t.ySuperscriptYOffset=s.parseShort(),t.yStrikeoutSize=s.parseShort(),t.yStrikeoutPosition=s.parseShort(),t.sFamilyClass=s.parseShort(),t.panose=[];for(var a=0;a<10;a++)t.panose[a]=s.parseByte();return t.ulUnicodeRange1=s.parseULong(),t.ulUnicodeRange2=s.parseULong(),t.ulUnicodeRange3=s.parseULong(),t.ulUnicodeRange4=s.parseULong(),t.achVendID=String.fromCharCode(s.parseByte(),s.parseByte(),s.parseByte(),s.parseByte()),t.fsSelection=s.parseUShort(),t.usFirstCharIndex=s.parseUShort(),t.usLastCharIndex=s.parseUShort(),t.sTypoAscender=s.parseShort(),t.sTypoDescender=s.parseShort(),t.sTypoLineGap=s.parseShort(),t.usWinAscent=s.parseUShort(),t.usWinDescent=s.parseUShort(),t.version>=1&&(t.ulCodePageRange1=s.parseULong(),t.ulCodePageRange2=s.parseULong()),t.version>=2&&(t.sxHeight=s.parseShort(),t.sCapHeight=s.parseShort(),t.usDefaultChar=s.parseUShort(),t.usBreakChar=s.parseUShort(),t.usMaxContent=s.parseUShort()),t}function kJ(o){return new Xi.Table("OS/2",[{name:"version",type:"USHORT",value:3},{name:"xAvgCharWidth",type:"SHORT",value:0},{name:"usWeightClass",type:"USHORT",value:0},{name:"usWidthClass",type:"USHORT",value:0},{name:"fsType",type:"USHORT",value:0},{name:"ySubscriptXSize",type:"SHORT",value:650},{name:"ySubscriptYSize",type:"SHORT",value:699},{name:"ySubscriptXOffset",type:"SHORT",value:0},{name:"ySubscriptYOffset",type:"SHORT",value:140},{name:"ySuperscriptXSize",type:"SHORT",value:650},{name:"ySuperscriptYSize",type:"SHORT",value:699},{name:"ySuperscriptXOffset",type:"SHORT",value:0},{name:"ySuperscriptYOffset",type:"SHORT",value:479},{name:"yStrikeoutSize",type:"SHORT",value:49},{name:"yStrikeoutPosition",type:"SHORT",value:258},{name:"sFamilyClass",type:"SHORT",value:0},{name:"bFamilyType",type:"BYTE",value:0},{name:"bSerifStyle",type:"BYTE",value:0},{name:"bWeight",type:"BYTE",value:0},{name:"bProportion",type:"BYTE",value:0},{name:"bContrast",type:"BYTE",value:0},{name:"bStrokeVariation",type:"BYTE",value:0},{name:"bArmStyle",type:"BYTE",value:0},{name:"bLetterform",type:"BYTE",value:0},{name:"bMidline",type:"BYTE",value:0},{name:"bXHeight",type:"BYTE",value:0},{name:"ulUnicodeRange1",type:"ULONG",value:0},{name:"ulUnicodeRange2",type:"ULONG",value:0},{name:"ulUnicodeRange3",type:"ULONG",value:0},{name:"ulUnicodeRange4",type:"ULONG",value:0},{name:"achVendID",type:"CHARARRAY",value:"XXXX"},{name:"fsSelection",type:"USHORT",value:0},{name:"usFirstCharIndex",type:"USHORT",value:0},{name:"usLastCharIndex",type:"USHORT",value:0},{name:"sTypoAscender",type:"SHORT",value:0},{name:"sTypoDescender",type:"SHORT",value:0},{name:"sTypoLineGap",type:"SHORT",value:0},{name:"usWinAscent",type:"USHORT",value:0},{name:"usWinDescent",type:"USHORT",value:0},{name:"ulCodePageRange1",type:"ULONG",value:0},{name:"ulCodePageRange2",type:"ULONG",value:0},{name:"sxHeight",type:"SHORT",value:0},{name:"sCapHeight",type:"SHORT",value:0},{name:"usDefaultChar",type:"USHORT",value:0},{name:"usBreakChar",type:"USHORT",value:0},{name:"usMaxContext",type:"USHORT",value:0}],o)}var w9={parse:RJ,make:kJ,unicodeRanges:b9,getUnicodeRange:PJ};function DJ(o,e){var t={},s=new on.Parser(o,e);switch(t.version=s.parseVersion(),t.italicAngle=s.parseFixed(),t.underlinePosition=s.parseShort(),t.underlineThickness=s.parseShort(),t.isFixedPitch=s.parseULong(),t.minMemType42=s.parseULong(),t.maxMemType42=s.parseULong(),t.minMemType1=s.parseULong(),t.maxMemType1=s.parseULong(),t.version){case 1:t.names=np.slice();break;case 2:t.numberOfGlyphs=s.parseUShort(),t.glyphNameIndex=new Array(t.numberOfGlyphs);for(var a=0;a<t.numberOfGlyphs;a++)t.glyphNameIndex[a]=s.parseUShort();t.names=[];for(var i=0;i<t.numberOfGlyphs;i++)if(t.glyphNameIndex[i]>=np.length){var f=s.parseChar();t.names.push(s.parseString(f))}break;case 2.5:t.numberOfGlyphs=s.parseUShort(),t.offset=new Array(t.numberOfGlyphs);for(var v=0;v<t.numberOfGlyphs;v++)t.offset[v]=s.parseChar();break}return t}function LJ(){return new Xi.Table("post",[{name:"version",type:"FIXED",value:196608},{name:"italicAngle",type:"FIXED",value:0},{name:"underlinePosition",type:"FWORD",value:0},{name:"underlineThickness",type:"FWORD",value:0},{name:"isFixedPitch",type:"ULONG",value:0},{name:"minMemType42",type:"ULONG",value:0},{name:"maxMemType42",type:"ULONG",value:0},{name:"minMemType1",type:"ULONG",value:0},{name:"maxMemType1",type:"ULONG",value:0}])}var ED={parse:DJ,make:LJ},dc=new Array(9);dc[1]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();if(t===1)return{substFormat:1,coverage:this.parsePointer(Pt.coverage),deltaGlyphId:this.parseUShort()};if(t===2)return{substFormat:2,coverage:this.parsePointer(Pt.coverage),substitute:this.parseOffset16List()};Zn.assert(!1,"0x"+e.toString(16)+": lookup type 1 format must be 1 or 2.")};dc[2]=function(){var e=this.parseUShort();return Zn.argument(e===1,"GSUB Multiple Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(Pt.coverage),sequences:this.parseListOfLists()}};dc[3]=function(){var e=this.parseUShort();return Zn.argument(e===1,"GSUB Alternate Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(Pt.coverage),alternateSets:this.parseListOfLists()}};dc[4]=function(){var e=this.parseUShort();return Zn.argument(e===1,"GSUB ligature table identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(Pt.coverage),ligatureSets:this.parseListOfLists(function(){return{ligGlyph:this.parseUShort(),components:this.parseUShortList(this.parseUShort()-1)}})}};var wf={sequenceIndex:Pt.uShort,lookupListIndex:Pt.uShort};dc[5]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();if(t===1)return{substFormat:t,coverage:this.parsePointer(Pt.coverage),ruleSets:this.parseListOfLists(function(){var i=this.parseUShort(),f=this.parseUShort();return{input:this.parseUShortList(i-1),lookupRecords:this.parseRecordList(f,wf)}})};if(t===2)return{substFormat:t,coverage:this.parsePointer(Pt.coverage),classDef:this.parsePointer(Pt.classDef),classSets:this.parseListOfLists(function(){var i=this.parseUShort(),f=this.parseUShort();return{classes:this.parseUShortList(i-1),lookupRecords:this.parseRecordList(f,wf)}})};if(t===3){var s=this.parseUShort(),a=this.parseUShort();return{substFormat:t,coverages:this.parseList(s,Pt.pointer(Pt.coverage)),lookupRecords:this.parseRecordList(a,wf)}}Zn.assert(!1,"0x"+e.toString(16)+": lookup type 5 format must be 1, 2 or 3.")};dc[6]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();if(t===1)return{substFormat:1,coverage:this.parsePointer(Pt.coverage),chainRuleSets:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(wf)}})};if(t===2)return{substFormat:2,coverage:this.parsePointer(Pt.coverage),backtrackClassDef:this.parsePointer(Pt.classDef),inputClassDef:this.parsePointer(Pt.classDef),lookaheadClassDef:this.parsePointer(Pt.classDef),chainClassSet:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(wf)}})};if(t===3)return{substFormat:3,backtrackCoverage:this.parseList(Pt.pointer(Pt.coverage)),inputCoverage:this.parseList(Pt.pointer(Pt.coverage)),lookaheadCoverage:this.parseList(Pt.pointer(Pt.coverage)),lookupRecords:this.parseRecordList(wf)};Zn.assert(!1,"0x"+e.toString(16)+": lookup type 6 format must be 1, 2 or 3.")};dc[7]=function(){var e=this.parseUShort();Zn.argument(e===1,"GSUB Extension Substitution subtable identifier-format must be 1");var t=this.parseUShort(),s=new Pt(this.data,this.offset+this.parseULong());return{substFormat:1,lookupType:t,extension:dc[t].call(s)}};dc[8]=function(){var e=this.parseUShort();return Zn.argument(e===1,"GSUB Reverse Chaining Contextual Single Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(Pt.coverage),backtrackCoverage:this.parseList(Pt.pointer(Pt.coverage)),lookaheadCoverage:this.parseList(Pt.pointer(Pt.coverage)),substitutes:this.parseUShortList()}};function FJ(o,e){e=e||0;var t=new Pt(o,e),s=t.parseVersion(1);return Zn.argument(s===1||s===1.1,"Unsupported GSUB table version."),s===1?{version:s,scripts:t.parseScriptList(),features:t.parseFeatureList(),lookups:t.parseLookupList(dc)}:{version:s,scripts:t.parseScriptList(),features:t.parseFeatureList(),lookups:t.parseLookupList(dc),variations:t.parseFeatureVariationsList()}}var Tf=new Array(9);Tf[1]=function(e){return e.substFormat===1?new Xi.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Xi.Coverage(e.coverage)},{name:"deltaGlyphID",type:"USHORT",value:e.deltaGlyphId}]):new Xi.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:2},{name:"coverage",type:"TABLE",value:new Xi.Coverage(e.coverage)}].concat(Xi.ushortList("substitute",e.substitute)))};Tf[2]=function(e){return Zn.assert(e.substFormat===1,"Lookup type 2 substFormat must be 1."),new Xi.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Xi.Coverage(e.coverage)}].concat(Xi.tableList("seqSet",e.sequences,function(t){return new Xi.Table("sequenceSetTable",Xi.ushortList("sequence",t))})))};Tf[3]=function(e){return Zn.assert(e.substFormat===1,"Lookup type 3 substFormat must be 1."),new Xi.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Xi.Coverage(e.coverage)}].concat(Xi.tableList("altSet",e.alternateSets,function(t){return new Xi.Table("alternateSetTable",Xi.ushortList("alternate",t))})))};Tf[4]=function(e){return Zn.assert(e.substFormat===1,"Lookup type 4 substFormat must be 1."),new Xi.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Xi.Coverage(e.coverage)}].concat(Xi.tableList("ligSet",e.ligatureSets,function(t){return new Xi.Table("ligatureSetTable",Xi.tableList("ligature",t,function(s){return new Xi.Table("ligatureTable",[{name:"ligGlyph",type:"USHORT",value:s.ligGlyph}].concat(Xi.ushortList("component",s.components,s.components.length+1)))}))})))};Tf[6]=function(e){if(e.substFormat===1){var t=new Xi.Table("chainContextTable",[{name:"substFormat",type:"USHORT",value:e.substFormat},{name:"coverage",type:"TABLE",value:new Xi.Coverage(e.coverage)}].concat(Xi.tableList("chainRuleSet",e.chainRuleSets,function(i){return new Xi.Table("chainRuleSetTable",Xi.tableList("chainRule",i,function(f){var v=Xi.ushortList("backtrackGlyph",f.backtrack,f.backtrack.length).concat(Xi.ushortList("inputGlyph",f.input,f.input.length+1)).concat(Xi.ushortList("lookaheadGlyph",f.lookahead,f.lookahead.length)).concat(Xi.ushortList("substitution",[],f.lookupRecords.length));return f.lookupRecords.forEach(function(x,M){v=v.concat({name:"sequenceIndex"+M,type:"USHORT",value:x.sequenceIndex}).concat({name:"lookupListIndex"+M,type:"USHORT",value:x.lookupListIndex})}),new Xi.Table("chainRuleTable",v)}))})));return t}else if(e.substFormat===2)Zn.assert(!1,"lookup type 6 format 2 is not yet supported.");else if(e.substFormat===3){var s=[{name:"substFormat",type:"USHORT",value:e.substFormat}];s.push({name:"backtrackGlyphCount",type:"USHORT",value:e.backtrackCoverage.length}),e.backtrackCoverage.forEach(function(i,f){s.push({name:"backtrackCoverage"+f,type:"TABLE",value:new Xi.Coverage(i)})}),s.push({name:"inputGlyphCount",type:"USHORT",value:e.inputCoverage.length}),e.inputCoverage.forEach(function(i,f){s.push({name:"inputCoverage"+f,type:"TABLE",value:new Xi.Coverage(i)})}),s.push({name:"lookaheadGlyphCount",type:"USHORT",value:e.lookaheadCoverage.length}),e.lookaheadCoverage.forEach(function(i,f){s.push({name:"lookaheadCoverage"+f,type:"TABLE",value:new Xi.Coverage(i)})}),s.push({name:"substitutionCount",type:"USHORT",value:e.lookupRecords.length}),e.lookupRecords.forEach(function(i,f){s=s.concat({name:"sequenceIndex"+f,type:"USHORT",value:i.sequenceIndex}).concat({name:"lookupListIndex"+f,type:"USHORT",value:i.lookupListIndex})});var a=new Xi.Table("chainContextTable",s);return a}Zn.assert(!1,"lookup type 6 format must be 1, 2 or 3.")};function OJ(o){return new Xi.Table("GSUB",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new Xi.ScriptList(o.scripts)},{name:"features",type:"TABLE",value:new Xi.FeatureList(o.features)},{name:"lookups",type:"TABLE",value:new Xi.LookupList(o.lookups,Tf)}])}var AD={parse:FJ,make:OJ};function NJ(o,e){var t=new on.Parser(o,e),s=t.parseULong();Zn.argument(s===1,"Unsupported META table version."),t.parseULong(),t.parseULong();for(var a=t.parseULong(),i={},f=0;f<a;f++){var v=t.parseTag(),x=t.parseULong(),M=t.parseULong(),C=Sf.UTF8(o,e+x,M);i[v]=C}return i}function zJ(o){var e=Object.keys(o).length,t="",s=16+e*12,a=new Xi.Table("meta",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"offset",type:"ULONG",value:s},{name:"numTags",type:"ULONG",value:e}]);for(var i in o){var f=t.length;t+=o[i],a.fields.push({name:"tag "+i,type:"TAG",value:i}),a.fields.push({name:"offset "+i,type:"ULONG",value:s+f}),a.fields.push({name:"length "+i,type:"ULONG",value:o[i].length})}return a.fields.push({name:"stringPool",type:"CHARARRAY",value:t}),a}var CD={parse:NJ,make:zJ};function Mk(o){return Math.log(o)/Math.log(2)|0}function P9(o){for(;o.length%4!==0;)o.push(0);for(var e=0,t=0;t<o.length;t+=4)e+=(o[t]<<24)+(o[t+1]<<16)+(o[t+2]<<8)+o[t+3];return e%=Math.pow(2,32),e}function Ek(o,e,t,s){return new Xi.Record("Table Record",[{name:"tag",type:"TAG",value:o!==void 0?o:""},{name:"checkSum",type:"ULONG",value:e!==void 0?e:0},{name:"offset",type:"ULONG",value:t!==void 0?t:0},{name:"length",type:"ULONG",value:s!==void 0?s:0}])}function ID(o){var e=new Xi.Table("sfnt",[{name:"version",type:"TAG",value:"OTTO"},{name:"numTables",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);e.tables=o,e.numTables=o.length;var t=Math.pow(2,Mk(e.numTables));e.searchRange=16*t,e.entrySelector=Mk(t),e.rangeShift=e.numTables*16-e.searchRange;for(var s=[],a=[],i=e.sizeOf()+Ek().sizeOf()*e.numTables;i%4!==0;)i+=1,a.push({name:"padding",type:"BYTE",value:0});for(var f=0;f<o.length;f+=1){var v=o[f];Zn.argument(v.tableName.length===4,"Table name"+v.tableName+" is invalid.");var x=v.sizeOf(),M=Ek(v.tableName,P9(v.encode()),i,x);for(s.push({name:M.tag+" Table Record",type:"RECORD",value:M}),a.push({name:v.tableName+" table",type:"RECORD",value:v}),i+=x,Zn.argument(!isNaN(i),"Something went wrong calculating the offset.");i%4!==0;)i+=1,a.push({name:"padding",type:"BYTE",value:0})}return s.sort(function(C,D){return C.value.tag>D.value.tag?1:-1}),e.fields=e.fields.concat(s),e.fields=e.fields.concat(a),e}function Ak(o,e,t){for(var s=0;s<e.length;s+=1){var a=o.charToGlyphIndex(e[s]);if(a>0){var i=o.glyphs.get(a);return i.getMetrics()}}return t}function BJ(o){for(var e=0,t=0;t<o.length;t+=1)e+=o[t];return e/o.length}function UJ(o){for(var e=[],t=[],s=[],a=[],i=[],f=[],v=[],x,M=0,C=0,D=0,L=0,N=0,j=0;j<o.glyphs.length;j+=1){var Z=o.glyphs.get(j),G=Z.unicode|0;if(isNaN(Z.advanceWidth))throw new Error("Glyph "+Z.name+" ("+j+"): advanceWidth is not a number.");(x>G||x===void 0)&&G>0&&(x=G),M<G&&(M=G);var H=w9.getUnicodeRange(G);if(H<32)C|=1<<H;else if(H<64)D|=1<<H-32;else if(H<96)L|=1<<H-64;else if(H<123)N|=1<<H-96;else throw new Error("Unicode ranges bits > 123 are reserved for internal usage");if(Z.name!==".notdef"){var me=Z.getMetrics();e.push(me.xMin),t.push(me.yMin),s.push(me.xMax),a.push(me.yMax),f.push(me.leftSideBearing),v.push(me.rightSideBearing),i.push(Z.advanceWidth)}}var ne={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,t),xMax:Math.max.apply(null,s),yMax:Math.max.apply(null,a),advanceWidthMax:Math.max.apply(null,i),advanceWidthAvg:BJ(i),minLeftSideBearing:Math.min.apply(null,f),maxLeftSideBearing:Math.max.apply(null,f),minRightSideBearing:Math.min.apply(null,v)};ne.ascender=o.ascender,ne.descender=o.descender;var fe=gD.make({flags:3,unitsPerEm:o.unitsPerEm,xMin:ne.xMin,yMin:ne.yMin,xMax:ne.xMax,yMax:ne.yMax,lowestRecPPEM:3,createdTimestamp:o.createdTimestamp}),Ee=_D.make({ascender:ne.ascender,descender:ne.descender,advanceWidthMax:ne.advanceWidthMax,minLeftSideBearing:ne.minLeftSideBearing,minRightSideBearing:ne.minRightSideBearing,xMaxExtent:ne.maxLeftSideBearing+(ne.xMax-ne.xMin),numberOfHMetrics:o.glyphs.length}),de=xD.make(o.glyphs.length),we=w9.make(Object.assign({xAvgCharWidth:Math.round(ne.advanceWidthAvg),usFirstCharIndex:x,usLastCharIndex:M,ulUnicodeRange1:C,ulUnicodeRange2:D,ulUnicodeRange3:L,ulUnicodeRange4:N,sTypoAscender:ne.ascender,sTypoDescender:ne.descender,sTypoLineGap:0,usWinAscent:ne.yMax,usWinDescent:Math.abs(ne.yMin),ulCodePageRange1:1,sxHeight:Ak(o,"xyvw",{yMax:Math.round(ne.ascender/2)}).yMax,sCapHeight:Ak(o,"HIKLEFJMNTZBDPRAGOQSUVWXY",ne).yMax,usDefaultChar:o.hasChar(" ")?32:0,usBreakChar:o.hasChar(" ")?32:0},o.tables.os2)),Le=yD.make(o.glyphs),De=rD.make(o.glyphs),se=o.getEnglishName("fontFamily"),Ce=o.getEnglishName("fontSubfamily"),Ne=se+" "+Ce,zt=o.getEnglishName("postScriptName");zt||(zt=se.replace(/\s/g,"")+"-"+Ce);var Ge={};for(var Xe in o.names)Ge[Xe]=o.names[Xe];Ge.uniqueID||(Ge.uniqueID={en:o.getEnglishName("manufacturer")+":"+Ne}),Ge.postScriptName||(Ge.postScriptName={en:zt}),Ge.preferredFamily||(Ge.preferredFamily=o.names.fontFamily),Ge.preferredSubfamily||(Ge.preferredSubfamily=o.names.fontSubfamily);var ht=[],Ot=MD.make(Ge,ht),bt=ht.length>0?vD.make(ht):void 0,Tt=ED.make(),Nt=mD.make(o.glyphs,{version:o.getEnglishName("version"),fullName:Ne,familyName:se,weightName:Ce,postScriptName:zt,unitsPerEm:o.unitsPerEm,fontBBox:[0,ne.yMin,ne.ascender,ne.advanceWidthMax]}),Bt=o.metas&&Object.keys(o.metas).length>0?CD.make(o.metas):void 0,Yt=[fe,Ee,de,we,Ot,De,Tt,Nt,Le];bt&&Yt.push(bt),o.tables.gsub&&Yt.push(AD.make(o.tables.gsub)),Bt&&Yt.push(Bt);for(var Wi=ID(Yt),wt=Wi.encode(),ei=P9(wt),vi=Wi.fields,Pi=!1,Fi=0;Fi<vi.length;Fi+=1)if(vi[Fi].name==="head table"){vi[Fi].value.checkSumAdjustment=2981146554-ei,Pi=!0;break}if(!Pi)throw new Error("Could not find head table with checkSum to adjust.");return Wi}var VJ={make:ID,fontToTable:UJ,computeCheckSum:P9};function l9(o,e){for(var t=0,s=o.length-1;t<=s;){var a=t+s>>>1,i=o[a].tag;if(i===e)return a;i<e?t=a+1:s=a-1}return-t-1}function Ck(o,e){for(var t=0,s=o.length-1;t<=s;){var a=t+s>>>1,i=o[a];if(i===e)return a;i<e?t=a+1:s=a-1}return-t-1}function Ik(o,e){for(var t,s=0,a=o.length-1;s<=a;){var i=s+a>>>1;t=o[i];var f=t.start;if(f===e)return t;f<e?s=i+1:a=i-1}if(s>0)return t=o[s-1],e>t.end?0:t}function m_(o,e){this.font=o,this.tableName=e}m_.prototype={searchTag:l9,binSearch:Ck,getTable:function(o){var e=this.font.tables[this.tableName];return!e&&o&&(e=this.font.tables[this.tableName]=this.createDefaultTable()),e},getScriptNames:function(){var o=this.getTable();return o?o.scripts.map(function(e){return e.tag}):[]},getDefaultScriptName:function(){var o=this.getTable();if(o){for(var e=!1,t=0;t<o.scripts.length;t++){var s=o.scripts[t].tag;if(s==="DFLT")return s;s==="latn"&&(e=!0)}if(e)return"latn"}},getScriptTable:function(o,e){var t=this.getTable(e);if(t){o=o||"DFLT";var s=t.scripts,a=l9(t.scripts,o);if(a>=0)return s[a].script;if(e){var i={tag:o,script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}};return s.splice(-1-a,0,i),i.script}}},getLangSysTable:function(o,e,t){var s=this.getScriptTable(o,t);if(s){if(!e||e==="dflt"||e==="DFLT")return s.defaultLangSys;var a=l9(s.langSysRecords,e);if(a>=0)return s.langSysRecords[a].langSys;if(t){var i={tag:e,langSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]}};return s.langSysRecords.splice(-1-a,0,i),i.langSys}}},getFeatureTable:function(o,e,t,s){var a=this.getLangSysTable(o,e,s);if(a){for(var i,f=a.featureIndexes,v=this.font.tables[this.tableName].features,x=0;x<f.length;x++)if(i=v[f[x]],i.tag===t)return i.feature;if(s){var M=v.length;return Zn.assert(M===0||t>=v[M-1].tag,"Features must be added in alphabetical order."),i={tag:t,feature:{params:0,lookupListIndexes:[]}},v.push(i),f.push(M),i.feature}}},getLookupTables:function(o,e,t,s,a){var i=this.getFeatureTable(o,e,t,a),f=[];if(i){for(var v,x=i.lookupListIndexes,M=this.font.tables[this.tableName].lookups,C=0;C<x.length;C++)v=M[x[C]],v.lookupType===s&&f.push(v);if(f.length===0&&a){v={lookupType:s,lookupFlag:0,subtables:[],markFilteringSet:void 0};var D=M.length;return M.push(v),x.push(D),[v]}}return f},getGlyphClass:function(o,e){switch(o.format){case 1:return o.startGlyph<=e&&e<o.startGlyph+o.classes.length?o.classes[e-o.startGlyph]:0;case 2:var t=Ik(o.ranges,e);return t?t.classId:0}},getCoverageIndex:function(o,e){switch(o.format){case 1:var t=Ck(o.glyphs,e);return t>=0?t:-1;case 2:var s=Ik(o.ranges,e);return s?s.index+e-s.start:-1}},expandCoverage:function(o){if(o.format===1)return o.glyphs;for(var e=[],t=o.ranges,s=0;s<t.length;s++)for(var a=t[s],i=a.start,f=a.end,v=i;v<=f;v++)e.push(v);return e}};function g_(o){m_.call(this,o,"gpos")}g_.prototype=m_.prototype;g_.prototype.init=function(){var o=this.getDefaultScriptName();this.defaultKerningTables=this.getKerningTables(o)};g_.prototype.getKerningValue=function(o,e,t){for(var s=0;s<o.length;s++)for(var a=o[s].subtables,i=0;i<a.length;i++){var f=a[i],v=this.getCoverageIndex(f.coverage,e);if(!(v<0))switch(f.posFormat){case 1:for(var x=f.pairSets[v],M=0;M<x.length;M++){var C=x[M];if(C.secondGlyph===t)return C.value1&&C.value1.xAdvance||0}break;case 2:var D=this.getGlyphClass(f.classDef1,e),L=this.getGlyphClass(f.classDef2,t),N=f.classRecords[D][L];return N.value1&&N.value1.xAdvance||0}}return 0};g_.prototype.getKerningTables=function(o,e){if(this.font.tables.gpos)return this.getLookupTables(o,e,"kern",2)};function gl(o){m_.call(this,o,"gsub")}function GJ(o,e){var t=o.length;if(t!==e.length)return!1;for(var s=0;s<t;s++)if(o[s]!==e[s])return!1;return!0}function R9(o,e,t){for(var s=o.subtables,a=0;a<s.length;a++){var i=s[a];if(i.substFormat===e)return i}if(t)return s.push(t),t}gl.prototype=m_.prototype;gl.prototype.createDefaultTable=function(){return{version:1,scripts:[{tag:"DFLT",script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}}],features:[],lookups:[]}};gl.prototype.getSingle=function(o,e,t){for(var s=[],a=this.getLookupTables(e,t,o,1),i=0;i<a.length;i++)for(var f=a[i].subtables,v=0;v<f.length;v++){var x=f[v],M=this.expandCoverage(x.coverage),C=void 0;if(x.substFormat===1){var D=x.deltaGlyphId;for(C=0;C<M.length;C++){var L=M[C];s.push({sub:L,by:L+D})}}else{var N=x.substitute;for(C=0;C<M.length;C++)s.push({sub:M[C],by:N[C]})}}return s};gl.prototype.getMultiple=function(o,e,t){for(var s=[],a=this.getLookupTables(e,t,o,2),i=0;i<a.length;i++)for(var f=a[i].subtables,v=0;v<f.length;v++){var x=f[v],M=this.expandCoverage(x.coverage),C=void 0;for(C=0;C<M.length;C++){var D=M[C],L=x.sequences[C];s.push({sub:D,by:L})}}return s};gl.prototype.getAlternates=function(o,e,t){for(var s=[],a=this.getLookupTables(e,t,o,3),i=0;i<a.length;i++)for(var f=a[i].subtables,v=0;v<f.length;v++)for(var x=f[v],M=this.expandCoverage(x.coverage),C=x.alternateSets,D=0;D<M.length;D++)s.push({sub:M[D],by:C[D]});return s};gl.prototype.getLigatures=function(o,e,t){for(var s=[],a=this.getLookupTables(e,t,o,4),i=0;i<a.length;i++)for(var f=a[i].subtables,v=0;v<f.length;v++)for(var x=f[v],M=this.expandCoverage(x.coverage),C=x.ligatureSets,D=0;D<M.length;D++)for(var L=M[D],N=C[D],j=0;j<N.length;j++){var Z=N[j];s.push({sub:[L].concat(Z.components),by:Z.ligGlyph})}return s};gl.prototype.addSingle=function(o,e,t,s){var a=this.getLookupTables(t,s,o,1,!0)[0],i=R9(a,2,{substFormat:2,coverage:{format:1,glyphs:[]},substitute:[]});Zn.assert(i.coverage.format===1,"Single: unable to modify coverage table format "+i.coverage.format);var f=e.sub,v=this.binSearch(i.coverage.glyphs,f);v<0&&(v=-1-v,i.coverage.glyphs.splice(v,0,f),i.substitute.splice(v,0,0)),i.substitute[v]=e.by};gl.prototype.addMultiple=function(o,e,t,s){Zn.assert(e.by instanceof Array&&e.by.length>1,'Multiple: "by" must be an array of two or more ids');var a=this.getLookupTables(t,s,o,2,!0)[0],i=R9(a,1,{substFormat:1,coverage:{format:1,glyphs:[]},sequences:[]});Zn.assert(i.coverage.format===1,"Multiple: unable to modify coverage table format "+i.coverage.format);var f=e.sub,v=this.binSearch(i.coverage.glyphs,f);v<0&&(v=-1-v,i.coverage.glyphs.splice(v,0,f),i.sequences.splice(v,0,0)),i.sequences[v]=e.by};gl.prototype.addAlternate=function(o,e,t,s){var a=this.getLookupTables(t,s,o,3,!0)[0],i=R9(a,1,{substFormat:1,coverage:{format:1,glyphs:[]},alternateSets:[]});Zn.assert(i.coverage.format===1,"Alternate: unable to modify coverage table format "+i.coverage.format);var f=e.sub,v=this.binSearch(i.coverage.glyphs,f);v<0&&(v=-1-v,i.coverage.glyphs.splice(v,0,f),i.alternateSets.splice(v,0,0)),i.alternateSets[v]=e.by};gl.prototype.addLigature=function(o,e,t,s){var a=this.getLookupTables(t,s,o,4,!0)[0],i=a.subtables[0];i||(i={substFormat:1,coverage:{format:1,glyphs:[]},ligatureSets:[]},a.subtables[0]=i),Zn.assert(i.coverage.format===1,"Ligature: unable to modify coverage table format "+i.coverage.format);var f=e.sub[0],v=e.sub.slice(1),x={ligGlyph:e.by,components:v},M=this.binSearch(i.coverage.glyphs,f);if(M>=0){for(var C=i.ligatureSets[M],D=0;D<C.length;D++)if(GJ(C[D].components,v))return;C.push(x)}else M=-1-M,i.coverage.glyphs.splice(M,0,f),i.ligatureSets.splice(M,0,[x])};gl.prototype.getFeature=function(o,e,t){if(/ss\d\d/.test(o))return this.getSingle(o,e,t);switch(o){case"aalt":case"salt":return this.getSingle(o,e,t).concat(this.getAlternates(o,e,t));case"dlig":case"liga":case"rlig":return this.getLigatures(o,e,t);case"ccmp":return this.getMultiple(o,e,t).concat(this.getLigatures(o,e,t));case"stch":return this.getMultiple(o,e,t)}};gl.prototype.add=function(o,e,t,s){if(/ss\d\d/.test(o))return this.addSingle(o,e,t,s);switch(o){case"aalt":case"salt":return typeof e.by=="number"?this.addSingle(o,e,t,s):this.addAlternate(o,e,t,s);case"dlig":case"liga":case"rlig":return this.addLigature(o,e,t,s);case"ccmp":return e.by instanceof Array?this.addMultiple(o,e,t,s):this.addLigature(o,e,t,s)}};function HJ(){return typeof window<"u"}function PD(o){for(var e=new ArrayBuffer(o.length),t=new Uint8Array(e),s=0;s<o.length;++s)t[s]=o[s];return e}function jJ(o){for(var e=new Buffer(o.byteLength),t=new Uint8Array(o),s=0;s<e.length;++s)e[s]=t[s];return e}function c_(o,e){if(!o)throw e}function Pk(o,e,t,s,a){var i;return(e&s)>0?(i=o.parseByte(),e&a||(i=-i),i=t+i):(e&a)>0?i=t:i=t+o.parseShort(),i}function RD(o,e,t){var s=new on.Parser(e,t);o.numberOfContours=s.parseShort(),o._xMin=s.parseShort(),o._yMin=s.parseShort(),o._xMax=s.parseShort(),o._yMax=s.parseShort();var a,i;if(o.numberOfContours>0){for(var f=o.endPointIndices=[],v=0;v<o.numberOfContours;v+=1)f.push(s.parseUShort());o.instructionLength=s.parseUShort(),o.instructions=[];for(var x=0;x<o.instructionLength;x+=1)o.instructions.push(s.parseByte());var M=f[f.length-1]+1;a=[];for(var C=0;C<M;C+=1)if(i=s.parseByte(),a.push(i),(i&8)>0)for(var D=s.parseByte(),L=0;L<D;L+=1)a.push(i),C+=1;if(Zn.argument(a.length===M,"Bad flags."),f.length>0){var N=[],j;if(M>0){for(var Z=0;Z<M;Z+=1)i=a[Z],j={},j.onCurve=!!(i&1),j.lastPointOfContour=f.indexOf(Z)>=0,N.push(j);for(var G=0,H=0;H<M;H+=1)i=a[H],j=N[H],j.x=Pk(s,i,G,2,16),G=j.x;for(var me=0,ne=0;ne<M;ne+=1)i=a[ne],j=N[ne],j.y=Pk(s,i,me,4,32),me=j.y}o.points=N}else o.points=[]}else if(o.numberOfContours===0)o.points=[];else{o.isComposite=!0,o.points=[],o.components=[];for(var fe=!0;fe;){a=s.parseUShort();var Ee={glyphIndex:s.parseUShort(),xScale:1,scale01:0,scale10:0,yScale:1,dx:0,dy:0};(a&1)>0?(a&2)>0?(Ee.dx=s.parseShort(),Ee.dy=s.parseShort()):Ee.matchedPoints=[s.parseUShort(),s.parseUShort()]:(a&2)>0?(Ee.dx=s.parseChar(),Ee.dy=s.parseChar()):Ee.matchedPoints=[s.parseByte(),s.parseByte()],(a&8)>0?Ee.xScale=Ee.yScale=s.parseF2Dot14():(a&64)>0?(Ee.xScale=s.parseF2Dot14(),Ee.yScale=s.parseF2Dot14()):(a&128)>0&&(Ee.xScale=s.parseF2Dot14(),Ee.scale01=s.parseF2Dot14(),Ee.scale10=s.parseF2Dot14(),Ee.yScale=s.parseF2Dot14()),o.components.push(Ee),fe=!!(a&32)}if(a&256){o.instructionLength=s.parseUShort(),o.instructions=[];for(var de=0;de<o.instructionLength;de+=1)o.instructions.push(s.parseByte())}}}function c9(o,e){for(var t=[],s=0;s<o.length;s+=1){var a=o[s],i={x:e.xScale*a.x+e.scale01*a.y+e.dx,y:e.scale10*a.x+e.yScale*a.y+e.dy,onCurve:a.onCurve,lastPointOfContour:a.lastPointOfContour};t.push(i)}return t}function WJ(o){for(var e=[],t=[],s=0;s<o.length;s+=1){var a=o[s];t.push(a),a.lastPointOfContour&&(e.push(t),t=[])}return Zn.argument(t.length===0,"There are still points left in the current contour."),e}function kD(o){var e=new po;if(!o)return e;for(var t=WJ(o),s=0;s<t.length;++s){var a=t[s],i=null,f=a[a.length-1],v=a[0];if(f.onCurve)e.moveTo(f.x,f.y);else if(v.onCurve)e.moveTo(v.x,v.y);else{var x={x:(f.x+v.x)*.5,y:(f.y+v.y)*.5};e.moveTo(x.x,x.y)}for(var M=0;M<a.length;++M)if(i=f,f=v,v=a[(M+1)%a.length],f.onCurve)e.lineTo(f.x,f.y);else{var C=i,D=v;i.onCurve||(C={x:(f.x+i.x)*.5,y:(f.y+i.y)*.5}),v.onCurve||(D={x:(f.x+v.x)*.5,y:(f.y+v.y)*.5}),e.quadraticCurveTo(f.x,f.y,D.x,D.y)}e.closePath()}return e}function DD(o,e){if(e.isComposite)for(var t=0;t<e.components.length;t+=1){var s=e.components[t],a=o.get(s.glyphIndex);if(a.getPath(),a.points){var i=void 0;if(s.matchedPoints===void 0)i=c9(a.points,s);else{if(s.matchedPoints[0]>e.points.length-1||s.matchedPoints[1]>a.points.length-1)throw Error("Matched points out of range in "+e.name);var f=e.points[s.matchedPoints[0]],v=a.points[s.matchedPoints[1]],x={xScale:s.xScale,scale01:s.scale01,scale10:s.scale10,yScale:s.yScale,dx:0,dy:0};v=c9([v],x)[0],x.dx=f.x-v.x,x.dy=f.y-v.y,i=c9(a.points,x)}e.points=e.points.concat(i)}}return kD(e.points)}function qJ(o,e,t,s){for(var a=new i0.GlyphSet(s),i=0;i<t.length-1;i+=1){var f=t[i],v=t[i+1];f!==v?a.push(i,i0.ttfGlyphLoader(s,i,RD,o,e+f,DD)):a.push(i,i0.glyphLoader(s,i))}return a}function XJ(o,e,t,s){var a=new i0.GlyphSet(s);return s._push=function(i){var f=t[i],v=t[i+1];f!==v?a.push(i,i0.ttfGlyphLoader(s,i,RD,o,e+f,DD)):a.push(i,i0.glyphLoader(s,i))},a}function ZJ(o,e,t,s,a){return a.lowMemory?XJ(o,e,t,s):qJ(o,e,t,s)}var LD={getPath:kD,parse:ZJ},FD,sp,OD,S9;function ND(o){this.font=o,this.getCommands=function(e){return LD.getPath(e).commands},this._fpgmState=this._prepState=void 0,this._errorState=0}function $J(o){return o}function zD(o){return Math.sign(o)*Math.round(Math.abs(o))}function YJ(o){return Math.sign(o)*Math.round(Math.abs(o*2))/2}function JJ(o){return Math.sign(o)*(Math.round(Math.abs(o)+.5)-.5)}function KJ(o){return Math.sign(o)*Math.ceil(Math.abs(o))}function QJ(o){return Math.sign(o)*Math.floor(Math.abs(o))}var BD=function(o){var e=this.srPeriod,t=this.srPhase,s=this.srThreshold,a=1;return o<0&&(o=-o,a=-1),o+=s-t,o=Math.trunc(o/e)*e,o+=t,o<0?t*a:o*a},t0={x:1,y:0,axis:"x",distance:function(o,e,t,s){return(t?o.xo:o.x)-(s?e.xo:e.x)},interpolate:function(o,e,t,s){var a,i,f,v,x,M,C;if(!s||s===this){if(a=o.xo-e.xo,i=o.xo-t.xo,x=e.x-e.xo,M=t.x-t.xo,f=Math.abs(a),v=Math.abs(i),C=f+v,C===0){o.x=o.xo+(x+M)/2;return}o.x=o.xo+(x*v+M*f)/C;return}if(a=s.distance(o,e,!0,!0),i=s.distance(o,t,!0,!0),x=s.distance(e,e,!1,!0),M=s.distance(t,t,!1,!0),f=Math.abs(a),v=Math.abs(i),C=f+v,C===0){t0.setRelative(o,o,(x+M)/2,s,!0);return}t0.setRelative(o,o,(x*v+M*f)/C,s,!0)},normalSlope:Number.NEGATIVE_INFINITY,setRelative:function(o,e,t,s,a){if(!s||s===this){o.x=(a?e.xo:e.x)+t;return}var i=a?e.xo:e.x,f=a?e.yo:e.y,v=i+t*s.x,x=f+t*s.y;o.x=v+(o.y-x)/s.normalSlope},slope:0,touch:function(o){o.xTouched=!0},touched:function(o){return o.xTouched},untouch:function(o){o.xTouched=!1}},q0={x:0,y:1,axis:"y",distance:function(o,e,t,s){return(t?o.yo:o.y)-(s?e.yo:e.y)},interpolate:function(o,e,t,s){var a,i,f,v,x,M,C;if(!s||s===this){if(a=o.yo-e.yo,i=o.yo-t.yo,x=e.y-e.yo,M=t.y-t.yo,f=Math.abs(a),v=Math.abs(i),C=f+v,C===0){o.y=o.yo+(x+M)/2;return}o.y=o.yo+(x*v+M*f)/C;return}if(a=s.distance(o,e,!0,!0),i=s.distance(o,t,!0,!0),x=s.distance(e,e,!1,!0),M=s.distance(t,t,!1,!0),f=Math.abs(a),v=Math.abs(i),C=f+v,C===0){q0.setRelative(o,o,(x+M)/2,s,!0);return}q0.setRelative(o,o,(x*v+M*f)/C,s,!0)},normalSlope:0,setRelative:function(o,e,t,s,a){if(!s||s===this){o.y=(a?e.yo:e.y)+t;return}var i=a?e.xo:e.x,f=a?e.yo:e.y,v=i+t*s.x,x=f+t*s.y;o.y=x+s.normalSlope*(o.x-v)},slope:Number.POSITIVE_INFINITY,touch:function(o){o.yTouched=!0},touched:function(o){return o.yTouched},untouch:function(o){o.yTouched=!1}};Object.freeze(t0);Object.freeze(q0);function __(o,e){this.x=o,this.y=e,this.axis=void 0,this.slope=e/o,this.normalSlope=-o/e,Object.freeze(this)}__.prototype.distance=function(o,e,t,s){return this.x*t0.distance(o,e,t,s)+this.y*q0.distance(o,e,t,s)};__.prototype.interpolate=function(o,e,t,s){var a,i,f,v,x,M,C;if(f=s.distance(o,e,!0,!0),v=s.distance(o,t,!0,!0),a=s.distance(e,e,!1,!0),i=s.distance(t,t,!1,!0),x=Math.abs(f),M=Math.abs(v),C=x+M,C===0){this.setRelative(o,o,(a+i)/2,s,!0);return}this.setRelative(o,o,(a*M+i*x)/C,s,!0)};__.prototype.setRelative=function(o,e,t,s,a){s=s||this;var i=a?e.xo:e.x,f=a?e.yo:e.y,v=i+t*s.x,x=f+t*s.y,M=s.normalSlope,C=this.slope,D=o.x,L=o.y;o.x=(C*D-M*v+x-L)/(C-M),o.y=C*(o.x-D)+L};__.prototype.touch=function(o){o.xTouched=!0,o.yTouched=!0};function y_(o,e){var t=Math.sqrt(o*o+e*e);return o/=t,e/=t,o===1&&e===0?t0:o===0&&e===1?q0:new __(o,e)}function X0(o,e,t,s){this.x=this.xo=Math.round(o*64)/64,this.y=this.yo=Math.round(e*64)/64,this.lastPointOfContour=t,this.onCurve=s,this.prevPointOnContour=void 0,this.nextPointOnContour=void 0,this.xTouched=!1,this.yTouched=!1,Object.preventExtensions(this)}X0.prototype.nextTouched=function(o){for(var e=this.nextPointOnContour;!o.touched(e)&&e!==this;)e=e.nextPointOnContour;return e};X0.prototype.prevTouched=function(o){for(var e=this.prevPointOnContour;!o.touched(e)&&e!==this;)e=e.prevPointOnContour;return e};var f_=Object.freeze(new X0(0,0)),eK={cvCutIn:17/16,deltaBase:9,deltaShift:.125,loop:1,minDis:1,autoFlip:!0};function bd(o,e){switch(this.env=o,this.stack=[],this.prog=e,o){case"glyf":this.zp0=this.zp1=this.zp2=1,this.rp0=this.rp1=this.rp2=0;case"prep":this.fv=this.pv=this.dpv=t0,this.round=zD}}ND.prototype.exec=function(o,e){if(typeof e!="number")throw new Error("Point size is not a number!");if(!(this._errorState>2)){var t=this.font,s=this._prepState;if(!s||s.ppem!==e){var a=this._fpgmState;if(!a){bd.prototype=eK,a=this._fpgmState=new bd("fpgm",t.tables.fpgm),a.funcs=[],a.font=t,exports.DEBUG&&(console.log("---EXEC FPGM---"),a.step=-1);try{sp(a)}catch(M){console.log("Hinting error in FPGM:"+M),this._errorState=3;return}}bd.prototype=a,s=this._prepState=new bd("prep",t.tables.prep),s.ppem=e;var i=t.tables.cvt;if(i)for(var f=s.cvt=new Array(i.length),v=e/t.unitsPerEm,x=0;x<i.length;x++)f[x]=i[x]*v;else s.cvt=[];exports.DEBUG&&(console.log("---EXEC PREP---"),s.step=-1);try{sp(s)}catch(M){this._errorState<2&&console.log("Hinting error in PREP:"+M),this._errorState=2}}if(!(this._errorState>1))try{return OD(o,s)}catch(M){this._errorState<1&&(console.log("Hinting error:"+M),console.log("Note: further hinting errors are silenced")),this._errorState=1;return}}};OD=function(o,e){var t=e.ppem/e.font.unitsPerEm,s=t,a=o.components,i,f,v;if(bd.prototype=e,!a)v=new bd("glyf",o.instructions),exports.DEBUG&&(console.log("---EXEC GLYPH---"),v.step=-1),S9(o,v,t,s),f=v.gZone;else{var x=e.font;f=[],i=[];for(var M=0;M<a.length;M++){var C=a[M],D=x.glyphs.get(C.glyphIndex);v=new bd("glyf",D.instructions),exports.DEBUG&&(console.log("---EXEC COMP "+M+"---"),v.step=-1),S9(D,v,t,s);for(var L=Math.round(C.dx*t),N=Math.round(C.dy*s),j=v.gZone,Z=v.contours,G=0;G<j.length;G++){var H=j[G];H.xTouched=H.yTouched=!1,H.xo=H.x=H.x+L,H.yo=H.y=H.y+N}var me=f.length;f.push.apply(f,j);for(var ne=0;ne<Z.length;ne++)i.push(Z[ne]+me)}o.instructions&&!v.inhibitGridFit&&(v=new bd("glyf",o.instructions),v.gZone=v.z0=v.z1=v.z2=f,v.contours=i,f.push(new X0(0,0),new X0(Math.round(o.advanceWidth*t),0)),exports.DEBUG&&(console.log("---EXEC COMPOSITE---"),v.step=-1),sp(v),f.length-=2)}return f};S9=function(o,e,t,s){for(var a=o.points||[],i=a.length,f=e.gZone=e.z0=e.z1=e.z2=[],v=e.contours=[],x,M=0;M<i;M++)x=a[M],f[M]=new X0(x.x*t,x.y*s,x.lastPointOfContour,x.onCurve);for(var C,D,L=0;L<i;L++)x=f[L],C||(C=x,v.push(L)),x.lastPointOfContour?(x.nextPointOnContour=C,C.prevPointOnContour=x,C=void 0):(D=f[L+1],x.nextPointOnContour=D,D.prevPointOnContour=x);if(!e.inhibitGridFit){if(exports.DEBUG){console.log("PROCESSING GLYPH",e.stack);for(var N=0;N<i;N++)console.log(N,f[N].x,f[N].y)}if(f.push(new X0(0,0),new X0(Math.round(o.advanceWidth*t),0)),sp(e),f.length-=2,exports.DEBUG){console.log("FINISHED GLYPH",e.stack);for(var j=0;j<i;j++)console.log(j,f[j].x,f[j].y)}}};sp=function(o){var e=o.prog;if(e){var t=e.length,s;for(o.ip=0;o.ip<t;o.ip++){if(exports.DEBUG&&o.step++,s=FD[e[o.ip]],!s)throw new Error("unknown instruction: 0x"+Number(e[o.ip]).toString(16));s(o)}}};function gy(o){for(var e=o.tZone=new Array(o.gZone.length),t=0;t<e.length;t++)e[t]=new X0(0,0)}function UD(o,e){var t=o.prog,s=o.ip,a=1,i;do if(i=t[++s],i===88)a++;else if(i===89)a--;else if(i===64)s+=t[s+1]+1;else if(i===65)s+=2*t[s+1]+1;else if(i>=176&&i<=183)s+=i-176+1;else if(i>=184&&i<=191)s+=(i-184+1)*2;else if(e&&a===1&&i===27)break;while(a>0);o.ip=s}function Rk(o,e){exports.DEBUG&&console.log(e.step,"SVTCA["+o.axis+"]"),e.fv=e.pv=e.dpv=o}function kk(o,e){exports.DEBUG&&console.log(e.step,"SPVTCA["+o.axis+"]"),e.pv=e.dpv=o}function Dk(o,e){exports.DEBUG&&console.log(e.step,"SFVTCA["+o.axis+"]"),e.fv=o}function Lk(o,e){var t=e.stack,s=t.pop(),a=t.pop(),i=e.z2[s],f=e.z1[a];exports.DEBUG&&console.log("SPVTL["+o+"]",s,a);var v,x;o?(v=i.y-f.y,x=f.x-i.x):(v=f.x-i.x,x=f.y-i.y),e.pv=e.dpv=y_(v,x)}function Fk(o,e){var t=e.stack,s=t.pop(),a=t.pop(),i=e.z2[s],f=e.z1[a];exports.DEBUG&&console.log("SFVTL["+o+"]",s,a);var v,x;o?(v=i.y-f.y,x=f.x-i.x):(v=f.x-i.x,x=f.y-i.y),e.fv=y_(v,x)}function tK(o){var e=o.stack,t=e.pop(),s=e.pop();exports.DEBUG&&console.log(o.step,"SPVFS[]",t,s),o.pv=o.dpv=y_(s,t)}function iK(o){var e=o.stack,t=e.pop(),s=e.pop();exports.DEBUG&&console.log(o.step,"SPVFS[]",t,s),o.fv=y_(s,t)}function nK(o){var e=o.stack,t=o.pv;exports.DEBUG&&console.log(o.step,"GPV[]"),e.push(t.x*16384),e.push(t.y*16384)}function rK(o){var e=o.stack,t=o.fv;exports.DEBUG&&console.log(o.step,"GFV[]"),e.push(t.x*16384),e.push(t.y*16384)}function sK(o){o.fv=o.pv,exports.DEBUG&&console.log(o.step,"SFVTPV[]")}function oK(o){var e=o.stack,t=e.pop(),s=e.pop(),a=e.pop(),i=e.pop(),f=e.pop(),v=o.z0,x=o.z1,M=v[t],C=v[s],D=x[a],L=x[i],N=o.z2[f];exports.DEBUG&&console.log("ISECT[], ",t,s,a,i,f);var j=M.x,Z=M.y,G=C.x,H=C.y,me=D.x,ne=D.y,fe=L.x,Ee=L.y,de=(j-G)*(ne-Ee)-(Z-H)*(me-fe),we=j*H-Z*G,Le=me*Ee-ne*fe;N.x=(we*(me-fe)-Le*(j-G))/de,N.y=(we*(ne-Ee)-Le*(Z-H))/de}function aK(o){o.rp0=o.stack.pop(),exports.DEBUG&&console.log(o.step,"SRP0[]",o.rp0)}function lK(o){o.rp1=o.stack.pop(),exports.DEBUG&&console.log(o.step,"SRP1[]",o.rp1)}function cK(o){o.rp2=o.stack.pop(),exports.DEBUG&&console.log(o.step,"SRP2[]",o.rp2)}function hK(o){var e=o.stack.pop();switch(exports.DEBUG&&console.log(o.step,"SZP0[]",e),o.zp0=e,e){case 0:o.tZone||gy(o),o.z0=o.tZone;break;case 1:o.z0=o.gZone;break;default:throw new Error("Invalid zone pointer")}}function dK(o){var e=o.stack.pop();switch(exports.DEBUG&&console.log(o.step,"SZP1[]",e),o.zp1=e,e){case 0:o.tZone||gy(o),o.z1=o.tZone;break;case 1:o.z1=o.gZone;break;default:throw new Error("Invalid zone pointer")}}function uK(o){var e=o.stack.pop();switch(exports.DEBUG&&console.log(o.step,"SZP2[]",e),o.zp2=e,e){case 0:o.tZone||gy(o),o.z2=o.tZone;break;case 1:o.z2=o.gZone;break;default:throw new Error("Invalid zone pointer")}}function pK(o){var e=o.stack.pop();switch(exports.DEBUG&&console.log(o.step,"SZPS[]",e),o.zp0=o.zp1=o.zp2=e,e){case 0:o.tZone||gy(o),o.z0=o.z1=o.z2=o.tZone;break;case 1:o.z0=o.z1=o.z2=o.gZone;break;default:throw new Error("Invalid zone pointer")}}function fK(o){o.loop=o.stack.pop(),exports.DEBUG&&console.log(o.step,"SLOOP[]",o.loop)}function mK(o){exports.DEBUG&&console.log(o.step,"RTG[]"),o.round=zD}function gK(o){exports.DEBUG&&console.log(o.step,"RTHG[]"),o.round=JJ}function _K(o){var e=o.stack.pop();exports.DEBUG&&console.log(o.step,"SMD[]",e),o.minDis=e/64}function yK(o){exports.DEBUG&&console.log(o.step,"ELSE[]"),UD(o,!1)}function vK(o){var e=o.stack.pop();exports.DEBUG&&console.log(o.step,"JMPR[]",e),o.ip+=e-1}function xK(o){var e=o.stack.pop();exports.DEBUG&&console.log(o.step,"SCVTCI[]",e),o.cvCutIn=e/64}function bK(o){var e=o.stack;exports.DEBUG&&console.log(o.step,"DUP[]"),e.push(e[e.length-1])}function h9(o){exports.DEBUG&&console.log(o.step,"POP[]"),o.stack.pop()}function wK(o){exports.DEBUG&&console.log(o.step,"CLEAR[]"),o.stack.length=0}function SK(o){var e=o.stack,t=e.pop(),s=e.pop();exports.DEBUG&&console.log(o.step,"SWAP[]"),e.push(t),e.push(s)}function TK(o){var e=o.stack;exports.DEBUG&&console.log(o.step,"DEPTH[]"),e.push(e.length)}function MK(o){var e=o.stack,t=e.pop(),s=e.pop();exports.DEBUG&&console.log(o.step,"LOOPCALL[]",t,s);var a=o.ip,i=o.prog;o.prog=o.funcs[t];for(var f=0;f<s;f++)sp(o),exports.DEBUG&&console.log(++o.step,f+1<s?"next loopcall":"done loopcall",f);o.ip=a,o.prog=i}function EK(o){var e=o.stack.pop();exports.DEBUG&&console.log(o.step,"CALL[]",e);var t=o.ip,s=o.prog;o.prog=o.funcs[e],sp(o),o.ip=t,o.prog=s,exports.DEBUG&&console.log(++o.step,"returning from",e)}function AK(o){var e=o.stack,t=e.pop();exports.DEBUG&&console.log(o.step,"CINDEX[]",t),e.push(e[e.length-t])}function CK(o){var e=o.stack,t=e.pop();exports.DEBUG&&console.log(o.step,"MINDEX[]",t),e.push(e.splice(e.length-t,1)[0])}function IK(o){if(o.env!=="fpgm")throw new Error("FDEF not allowed here");var e=o.stack,t=o.prog,s=o.ip,a=e.pop(),i=s;for(exports.DEBUG&&console.log(o.step,"FDEF[]",a);t[++s]!==45;);o.ip=s,o.funcs[a]=t.slice(i+1,s)}function Ok(o,e){var t=e.stack.pop(),s=e.z0[t],a=e.fv,i=e.pv;exports.DEBUG&&console.log(e.step,"MDAP["+o+"]",t);var f=i.distance(s,f_);o&&(f=e.round(f)),a.setRelative(s,f_,f,i),a.touch(s),e.rp0=e.rp1=t}function Nk(o,e){var t=e.z2,s=t.length-2,a,i,f;exports.DEBUG&&console.log(e.step,"IUP["+o.axis+"]");for(var v=0;v<s;v++)a=t[v],!o.touched(a)&&(i=a.prevTouched(o),i!==a&&(f=a.nextTouched(o),i===f&&o.setRelative(a,a,o.distance(i,i,!1,!0),o,!0),o.interpolate(a,i,f,o)))}function zk(o,e){for(var t=e.stack,s=o?e.rp1:e.rp2,a=(o?e.z0:e.z1)[s],i=e.fv,f=e.pv,v=e.loop,x=e.z2;v--;){var M=t.pop(),C=x[M],D=f.distance(a,a,!1,!0);i.setRelative(C,C,D,f),i.touch(C),exports.DEBUG&&console.log(e.step,(e.loop>1?"loop "+(e.loop-v)+": ":"")+"SHP["+(o?"rp1":"rp2")+"]",M)}e.loop=1}function Bk(o,e){var t=e.stack,s=o?e.rp1:e.rp2,a=(o?e.z0:e.z1)[s],i=e.fv,f=e.pv,v=t.pop(),x=e.z2[e.contours[v]],M=x;exports.DEBUG&&console.log(e.step,"SHC["+o+"]",v);var C=f.distance(a,a,!1,!0);do M!==a&&i.setRelative(M,M,C,f),M=M.nextPointOnContour;while(M!==x)}function Uk(o,e){var t=e.stack,s=o?e.rp1:e.rp2,a=(o?e.z0:e.z1)[s],i=e.fv,f=e.pv,v=t.pop();exports.DEBUG&&console.log(e.step,"SHZ["+o+"]",v);var x;switch(v){case 0:x=e.tZone;break;case 1:x=e.gZone;break;default:throw new Error("Invalid zone")}for(var M,C=f.distance(a,a,!1,!0),D=x.length-2,L=0;L<D;L++)M=x[L],i.setRelative(M,M,C,f)}function PK(o){for(var e=o.stack,t=o.loop,s=o.fv,a=e.pop()/64,i=o.z2;t--;){var f=e.pop(),v=i[f];exports.DEBUG&&console.log(o.step,(o.loop>1?"loop "+(o.loop-t)+": ":"")+"SHPIX[]",f,a),s.setRelative(v,v,a),s.touch(v)}o.loop=1}function RK(o){for(var e=o.stack,t=o.rp1,s=o.rp2,a=o.loop,i=o.z0[t],f=o.z1[s],v=o.fv,x=o.dpv,M=o.z2;a--;){var C=e.pop(),D=M[C];exports.DEBUG&&console.log(o.step,(o.loop>1?"loop "+(o.loop-a)+": ":"")+"IP[]",C,t,"<->",s),v.interpolate(D,i,f,x),v.touch(D)}o.loop=1}function Vk(o,e){var t=e.stack,s=t.pop()/64,a=t.pop(),i=e.z1[a],f=e.z0[e.rp0],v=e.fv,x=e.pv;v.setRelative(i,f,s,x),v.touch(i),exports.DEBUG&&console.log(e.step,"MSIRP["+o+"]",s,a),e.rp1=e.rp0,e.rp2=a,o&&(e.rp0=a)}function kK(o){for(var e=o.stack,t=o.rp0,s=o.z0[t],a=o.loop,i=o.fv,f=o.pv,v=o.z1;a--;){var x=e.pop(),M=v[x];exports.DEBUG&&console.log(o.step,(o.loop>1?"loop "+(o.loop-a)+": ":"")+"ALIGNRP[]",x),i.setRelative(M,s,0,f),i.touch(M)}o.loop=1}function DK(o){exports.DEBUG&&console.log(o.step,"RTDG[]"),o.round=YJ}function Gk(o,e){var t=e.stack,s=t.pop(),a=t.pop(),i=e.z0[a],f=e.fv,v=e.pv,x=e.cvt[s];exports.DEBUG&&console.log(e.step,"MIAP["+o+"]",s,"(",x,")",a);var M=v.distance(i,f_);o&&(Math.abs(M-x)<e.cvCutIn&&(M=x),M=e.round(M)),f.setRelative(i,f_,M,v),e.zp0===0&&(i.xo=i.x,i.yo=i.y),f.touch(i),e.rp0=e.rp1=a}function LK(o){var e=o.prog,t=o.ip,s=o.stack,a=e[++t];exports.DEBUG&&console.log(o.step,"NPUSHB[]",a);for(var i=0;i<a;i++)s.push(e[++t]);o.ip=t}function FK(o){var e=o.ip,t=o.prog,s=o.stack,a=t[++e];exports.DEBUG&&console.log(o.step,"NPUSHW[]",a);for(var i=0;i<a;i++){var f=t[++e]<<8|t[++e];f&32768&&(f=-((f^65535)+1)),s.push(f)}o.ip=e}function OK(o){var e=o.stack,t=o.store;t||(t=o.store=[]);var s=e.pop(),a=e.pop();exports.DEBUG&&console.log(o.step,"WS",s,a),t[a]=s}function NK(o){var e=o.stack,t=o.store,s=e.pop();exports.DEBUG&&console.log(o.step,"RS",s);var a=t&&t[s]||0;e.push(a)}function zK(o){var e=o.stack,t=e.pop(),s=e.pop();exports.DEBUG&&console.log(o.step,"WCVTP",t,s),o.cvt[s]=t/64}function BK(o){var e=o.stack,t=e.pop();exports.DEBUG&&console.log(o.step,"RCVT",t),e.push(o.cvt[t]*64)}function Hk(o,e){var t=e.stack,s=t.pop(),a=e.z2[s];exports.DEBUG&&console.log(e.step,"GC["+o+"]",s),t.push(e.dpv.distance(a,f_,o,!1)*64)}function jk(o,e){var t=e.stack,s=t.pop(),a=t.pop(),i=e.z1[s],f=e.z0[a],v=e.dpv.distance(f,i,o,o);exports.DEBUG&&console.log(e.step,"MD["+o+"]",s,a,"->",v),e.stack.push(Math.round(v*64))}function UK(o){exports.DEBUG&&console.log(o.step,"MPPEM[]"),o.stack.push(o.ppem)}function VK(o){exports.DEBUG&&console.log(o.step,"FLIPON[]"),o.autoFlip=!0}function GK(o){var e=o.stack,t=e.pop(),s=e.pop();exports.DEBUG&&console.log(o.step,"LT[]",t,s),e.push(s<t?1:0)}function HK(o){var e=o.stack,t=e.pop(),s=e.pop();exports.DEBUG&&console.log(o.step,"LTEQ[]",t,s),e.push(s<=t?1:0)}function jK(o){var e=o.stack,t=e.pop(),s=e.pop();exports.DEBUG&&console.log(o.step,"GT[]",t,s),e.push(s>t?1:0)}function WK(o){var e=o.stack,t=e.pop(),s=e.pop();exports.DEBUG&&console.log(o.step,"GTEQ[]",t,s),e.push(s>=t?1:0)}function qK(o){var e=o.stack,t=e.pop(),s=e.pop();exports.DEBUG&&console.log(o.step,"EQ[]",t,s),e.push(t===s?1:0)}function XK(o){var e=o.stack,t=e.pop(),s=e.pop();exports.DEBUG&&console.log(o.step,"NEQ[]",t,s),e.push(t!==s?1:0)}function ZK(o){var e=o.stack,t=e.pop();exports.DEBUG&&console.log(o.step,"ODD[]",t),e.push(Math.trunc(t)%2?1:0)}function $K(o){var e=o.stack,t=e.pop();exports.DEBUG&&console.log(o.step,"EVEN[]",t),e.push(Math.trunc(t)%2?0:1)}function YK(o){var e=o.stack.pop();exports.DEBUG&&console.log(o.step,"IF[]",e),e||(UD(o,!0),exports.DEBUG&&console.log(o.step,"EIF[]"))}function JK(o){exports.DEBUG&&console.log(o.step,"EIF[]")}function KK(o){var e=o.stack,t=e.pop(),s=e.pop();exports.DEBUG&&console.log(o.step,"AND[]",t,s),e.push(t&&s?1:0)}function QK(o){var e=o.stack,t=e.pop(),s=e.pop();exports.DEBUG&&console.log(o.step,"OR[]",t,s),e.push(t||s?1:0)}function eQ(o){var e=o.stack,t=e.pop();exports.DEBUG&&console.log(o.step,"NOT[]",t),e.push(t?0:1)}function d9(o,e){var t=e.stack,s=t.pop(),a=e.fv,i=e.pv,f=e.ppem,v=e.deltaBase+(o-1)*16,x=e.deltaShift,M=e.z0;exports.DEBUG&&console.log(e.step,"DELTAP["+o+"]",s,t);for(var C=0;C<s;C++){var D=t.pop(),L=t.pop(),N=v+((L&240)>>4);if(N===f){var j=(L&15)-8;j>=0&&j++,exports.DEBUG&&console.log(e.step,"DELTAPFIX",D,"by",j*x);var Z=M[D];a.setRelative(Z,Z,j*x,i)}}}function tQ(o){var e=o.stack,t=e.pop();exports.DEBUG&&console.log(o.step,"SDB[]",t),o.deltaBase=t}function iQ(o){var e=o.stack,t=e.pop();exports.DEBUG&&console.log(o.step,"SDS[]",t),o.deltaShift=Math.pow(.5,t)}function nQ(o){var e=o.stack,t=e.pop(),s=e.pop();exports.DEBUG&&console.log(o.step,"ADD[]",t,s),e.push(s+t)}function rQ(o){var e=o.stack,t=e.pop(),s=e.pop();exports.DEBUG&&console.log(o.step,"SUB[]",t,s),e.push(s-t)}function sQ(o){var e=o.stack,t=e.pop(),s=e.pop();exports.DEBUG&&console.log(o.step,"DIV[]",t,s),e.push(s*64/t)}function oQ(o){var e=o.stack,t=e.pop(),s=e.pop();exports.DEBUG&&console.log(o.step,"MUL[]",t,s),e.push(s*t/64)}function aQ(o){var e=o.stack,t=e.pop();exports.DEBUG&&console.log(o.step,"ABS[]",t),e.push(Math.abs(t))}function lQ(o){var e=o.stack,t=e.pop();exports.DEBUG&&console.log(o.step,"NEG[]",t),e.push(-t)}function cQ(o){var e=o.stack,t=e.pop();exports.DEBUG&&console.log(o.step,"FLOOR[]",t),e.push(Math.floor(t/64)*64)}function hQ(o){var e=o.stack,t=e.pop();exports.DEBUG&&console.log(o.step,"CEILING[]",t),e.push(Math.ceil(t/64)*64)}function ay(o,e){var t=e.stack,s=t.pop();exports.DEBUG&&console.log(e.step,"ROUND[]"),t.push(e.round(s/64)*64)}function dQ(o){var e=o.stack,t=e.pop(),s=e.pop();exports.DEBUG&&console.log(o.step,"WCVTF[]",t,s),o.cvt[s]=t*o.ppem/o.font.unitsPerEm}function u9(o,e){var t=e.stack,s=t.pop(),a=e.ppem,i=e.deltaBase+(o-1)*16,f=e.deltaShift;exports.DEBUG&&console.log(e.step,"DELTAC["+o+"]",s,t);for(var v=0;v<s;v++){var x=t.pop(),M=t.pop(),C=i+((M&240)>>4);if(C===a){var D=(M&15)-8;D>=0&&D++;var L=D*f;exports.DEBUG&&console.log(e.step,"DELTACFIX",x,"by",L),e.cvt[x]+=L}}}function uQ(o){var e=o.stack.pop();exports.DEBUG&&console.log(o.step,"SROUND[]",e),o.round=BD;var t;switch(e&192){case 0:t=.5;break;case 64:t=1;break;case 128:t=2;break;default:throw new Error("invalid SROUND value")}switch(o.srPeriod=t,e&48){case 0:o.srPhase=0;break;case 16:o.srPhase=.25*t;break;case 32:o.srPhase=.5*t;break;case 48:o.srPhase=.75*t;break;default:throw new Error("invalid SROUND value")}e&=15,e===0?o.srThreshold=0:o.srThreshold=(e/8-.5)*t}function pQ(o){var e=o.stack.pop();exports.DEBUG&&console.log(o.step,"S45ROUND[]",e),o.round=BD;var t;switch(e&192){case 0:t=Math.sqrt(2)/2;break;case 64:t=Math.sqrt(2);break;case 128:t=2*Math.sqrt(2);break;default:throw new Error("invalid S45ROUND value")}switch(o.srPeriod=t,e&48){case 0:o.srPhase=0;break;case 16:o.srPhase=.25*t;break;case 32:o.srPhase=.5*t;break;case 48:o.srPhase=.75*t;break;default:throw new Error("invalid S45ROUND value")}e&=15,e===0?o.srThreshold=0:o.srThreshold=(e/8-.5)*t}function fQ(o){exports.DEBUG&&console.log(o.step,"ROFF[]"),o.round=$J}function mQ(o){exports.DEBUG&&console.log(o.step,"RUTG[]"),o.round=KJ}function gQ(o){exports.DEBUG&&console.log(o.step,"RDTG[]"),o.round=QJ}function _Q(o){var e=o.stack.pop();exports.DEBUG&&console.log(o.step,"SCANCTRL[]",e)}function Wk(o,e){var t=e.stack,s=t.pop(),a=t.pop(),i=e.z2[s],f=e.z1[a];exports.DEBUG&&console.log(e.step,"SDPVTL["+o+"]",s,a);var v,x;o?(v=i.y-f.y,x=f.x-i.x):(v=f.x-i.x,x=f.y-i.y),e.dpv=y_(v,x)}function yQ(o){var e=o.stack,t=e.pop(),s=0;exports.DEBUG&&console.log(o.step,"GETINFO[]",t),t&1&&(s=35),t&32&&(s|=4096),e.push(s)}function vQ(o){var e=o.stack,t=e.pop(),s=e.pop(),a=e.pop();exports.DEBUG&&console.log(o.step,"ROLL[]"),e.push(s),e.push(t),e.push(a)}function xQ(o){var e=o.stack,t=e.pop(),s=e.pop();exports.DEBUG&&console.log(o.step,"MAX[]",t,s),e.push(Math.max(s,t))}function bQ(o){var e=o.stack,t=e.pop(),s=e.pop();exports.DEBUG&&console.log(o.step,"MIN[]",t,s),e.push(Math.min(s,t))}function wQ(o){var e=o.stack.pop();exports.DEBUG&&console.log(o.step,"SCANTYPE[]",e)}function SQ(o){var e=o.stack.pop(),t=o.stack.pop();switch(exports.DEBUG&&console.log(o.step,"INSTCTRL[]",e,t),e){case 1:o.inhibitGridFit=!!t;return;case 2:o.ignoreCvt=!!t;return;default:throw new Error("invalid INSTCTRL[] selector")}}function yd(o,e){var t=e.stack,s=e.prog,a=e.ip;exports.DEBUG&&console.log(e.step,"PUSHB["+o+"]");for(var i=0;i<o;i++)t.push(s[++a]);e.ip=a}function vd(o,e){var t=e.ip,s=e.prog,a=e.stack;exports.DEBUG&&console.log(e.ip,"PUSHW["+o+"]");for(var i=0;i<o;i++){var f=s[++t]<<8|s[++t];f&32768&&(f=-((f^65535)+1)),a.push(f)}e.ip=t}function sn(o,e,t,s,a,i){var f=i.stack,v=o&&f.pop(),x=f.pop(),M=i.rp0,C=i.z0[M],D=i.z1[x],L=i.minDis,N=i.fv,j=i.dpv,Z,G,H,me;G=Z=j.distance(D,C,!0,!0),H=G>=0?1:-1,G=Math.abs(G),o&&(me=i.cvt[v],s&&Math.abs(G-me)<i.cvCutIn&&(G=me)),t&&G<L&&(G=L),s&&(G=i.round(G)),N.setRelative(D,C,H*G,j),N.touch(D),exports.DEBUG&&console.log(i.step,(o?"MIRP[":"MDRP[")+(e?"M":"m")+(t?">":"_")+(s?"R":"_")+(a===0?"Gr":a===1?"Bl":a===2?"Wh":"")+"]",o?v+"("+i.cvt[v]+","+me+")":"",x,"(d =",Z,"->",H*G,")"),i.rp1=i.rp0,i.rp2=x,e&&(i.rp0=x)}FD=[Rk.bind(void 0,q0),Rk.bind(void 0,t0),kk.bind(void 0,q0),kk.bind(void 0,t0),Dk.bind(void 0,q0),Dk.bind(void 0,t0),Lk.bind(void 0,0),Lk.bind(void 0,1),Fk.bind(void 0,0),Fk.bind(void 0,1),tK,iK,nK,rK,sK,oK,aK,lK,cK,hK,dK,uK,pK,fK,mK,gK,_K,yK,vK,xK,void 0,void 0,bK,h9,wK,SK,TK,AK,CK,void 0,void 0,void 0,MK,EK,IK,void 0,Ok.bind(void 0,0),Ok.bind(void 0,1),Nk.bind(void 0,q0),Nk.bind(void 0,t0),zk.bind(void 0,0),zk.bind(void 0,1),Bk.bind(void 0,0),Bk.bind(void 0,1),Uk.bind(void 0,0),Uk.bind(void 0,1),PK,RK,Vk.bind(void 0,0),Vk.bind(void 0,1),kK,DK,Gk.bind(void 0,0),Gk.bind(void 0,1),LK,FK,OK,NK,zK,BK,Hk.bind(void 0,0),Hk.bind(void 0,1),void 0,jk.bind(void 0,0),jk.bind(void 0,1),UK,void 0,VK,void 0,void 0,GK,HK,jK,WK,qK,XK,ZK,$K,YK,JK,KK,QK,eQ,d9.bind(void 0,1),tQ,iQ,nQ,rQ,sQ,oQ,aQ,lQ,cQ,hQ,ay.bind(void 0,0),ay.bind(void 0,1),ay.bind(void 0,2),ay.bind(void 0,3),void 0,void 0,void 0,void 0,dQ,d9.bind(void 0,2),d9.bind(void 0,3),u9.bind(void 0,1),u9.bind(void 0,2),u9.bind(void 0,3),uQ,pQ,void 0,void 0,fQ,void 0,mQ,gQ,h9,h9,void 0,void 0,void 0,void 0,void 0,_Q,Wk.bind(void 0,0),Wk.bind(void 0,1),yQ,void 0,vQ,xQ,bQ,wQ,SQ,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,yd.bind(void 0,1),yd.bind(void 0,2),yd.bind(void 0,3),yd.bind(void 0,4),yd.bind(void 0,5),yd.bind(void 0,6),yd.bind(void 0,7),yd.bind(void 0,8),vd.bind(void 0,1),vd.bind(void 0,2),vd.bind(void 0,3),vd.bind(void 0,4),vd.bind(void 0,5),vd.bind(void 0,6),vd.bind(void 0,7),vd.bind(void 0,8),sn.bind(void 0,0,0,0,0,0),sn.bind(void 0,0,0,0,0,1),sn.bind(void 0,0,0,0,0,2),sn.bind(void 0,0,0,0,0,3),sn.bind(void 0,0,0,0,1,0),sn.bind(void 0,0,0,0,1,1),sn.bind(void 0,0,0,0,1,2),sn.bind(void 0,0,0,0,1,3),sn.bind(void 0,0,0,1,0,0),sn.bind(void 0,0,0,1,0,1),sn.bind(void 0,0,0,1,0,2),sn.bind(void 0,0,0,1,0,3),sn.bind(void 0,0,0,1,1,0),sn.bind(void 0,0,0,1,1,1),sn.bind(void 0,0,0,1,1,2),sn.bind(void 0,0,0,1,1,3),sn.bind(void 0,0,1,0,0,0),sn.bind(void 0,0,1,0,0,1),sn.bind(void 0,0,1,0,0,2),sn.bind(void 0,0,1,0,0,3),sn.bind(void 0,0,1,0,1,0),sn.bind(void 0,0,1,0,1,1),sn.bind(void 0,0,1,0,1,2),sn.bind(void 0,0,1,0,1,3),sn.bind(void 0,0,1,1,0,0),sn.bind(void 0,0,1,1,0,1),sn.bind(void 0,0,1,1,0,2),sn.bind(void 0,0,1,1,0,3),sn.bind(void 0,0,1,1,1,0),sn.bind(void 0,0,1,1,1,1),sn.bind(void 0,0,1,1,1,2),sn.bind(void 0,0,1,1,1,3),sn.bind(void 0,1,0,0,0,0),sn.bind(void 0,1,0,0,0,1),sn.bind(void 0,1,0,0,0,2),sn.bind(void 0,1,0,0,0,3),sn.bind(void 0,1,0,0,1,0),sn.bind(void 0,1,0,0,1,1),sn.bind(void 0,1,0,0,1,2),sn.bind(void 0,1,0,0,1,3),sn.bind(void 0,1,0,1,0,0),sn.bind(void 0,1,0,1,0,1),sn.bind(void 0,1,0,1,0,2),sn.bind(void 0,1,0,1,0,3),sn.bind(void 0,1,0,1,1,0),sn.bind(void 0,1,0,1,1,1),sn.bind(void 0,1,0,1,1,2),sn.bind(void 0,1,0,1,1,3),sn.bind(void 0,1,1,0,0,0),sn.bind(void 0,1,1,0,0,1),sn.bind(void 0,1,1,0,0,2),sn.bind(void 0,1,1,0,0,3),sn.bind(void 0,1,1,0,1,0),sn.bind(void 0,1,1,0,1,1),sn.bind(void 0,1,1,0,1,2),sn.bind(void 0,1,1,0,1,3),sn.bind(void 0,1,1,1,0,0),sn.bind(void 0,1,1,1,0,1),sn.bind(void 0,1,1,1,0,2),sn.bind(void 0,1,1,1,0,3),sn.bind(void 0,1,1,1,1,0),sn.bind(void 0,1,1,1,1,1),sn.bind(void 0,1,1,1,1,2),sn.bind(void 0,1,1,1,1,3)];function Mf(o){this.char=o,this.state={},this.activeState=null}function k9(o,e,t){this.contextName=t,this.startIndex=o,this.endOffset=e}function TQ(o,e,t){this.contextName=o,this.openRange=null,this.ranges=[],this.checkStart=e,this.checkEnd=t}function uc(o,e){this.context=o,this.index=e,this.length=o.length,this.current=o[e],this.backtrack=o.slice(0,e),this.lookahead=o.slice(e+1)}function _y(o){this.eventId=o,this.subscribers=[]}function MQ(o){var e=this,t=["start","end","next","newToken","contextStart","contextEnd","insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD","updateContextsRanges"];t.forEach(function(a){Object.defineProperty(e.events,a,{value:new _y(a)})}),o&&t.forEach(function(a){var i=o[a];typeof i=="function"&&e.events[a].subscribe(i)});var s=["insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD"];s.forEach(function(a){e.events[a].subscribe(e.updateContextsRanges)})}function js(o){this.tokens=[],this.registeredContexts={},this.contextCheckers=[],this.events={},this.registeredModifiers=[],MQ.call(this,o)}Mf.prototype.setState=function(o,e){return this.state[o]=e,this.activeState={key:o,value:this.state[o]},this.activeState};Mf.prototype.getState=function(o){return this.state[o]||null};js.prototype.inboundIndex=function(o){return o>=0&&o<this.tokens.length};js.prototype.composeRUD=function(o){var e=this,t=!0,s=o.map(function(i){return e[i[0]].apply(e,i.slice(1).concat(t))}),a=function(i){return typeof i=="object"&&i.hasOwnProperty("FAIL")};if(s.every(a))return{FAIL:"composeRUD: one or more operations hasn't completed successfully",report:s.filter(a)};this.dispatch("composeRUD",[s.filter(function(i){return!a(i)})])};js.prototype.replaceRange=function(o,e,t,s){e=e!==null?e:this.tokens.length;var a=t.every(function(f){return f instanceof Mf});if(!isNaN(o)&&this.inboundIndex(o)&&a){var i=this.tokens.splice.apply(this.tokens,[o,e].concat(t));return s||this.dispatch("replaceToken",[o,e,t]),[i,t]}else return{FAIL:"replaceRange: invalid tokens or startIndex."}};js.prototype.replaceToken=function(o,e,t){if(!isNaN(o)&&this.inboundIndex(o)&&e instanceof Mf){var s=this.tokens.splice(o,1,e);return t||this.dispatch("replaceToken",[o,e]),[s[0],e]}else return{FAIL:"replaceToken: invalid token or index."}};js.prototype.removeRange=function(o,e,t){e=isNaN(e)?this.tokens.length:e;var s=this.tokens.splice(o,e);return t||this.dispatch("removeRange",[s,o,e]),s};js.prototype.removeToken=function(o,e){if(!isNaN(o)&&this.inboundIndex(o)){var t=this.tokens.splice(o,1);return e||this.dispatch("removeToken",[t,o]),t}else return{FAIL:"removeToken: invalid token index."}};js.prototype.insertToken=function(o,e,t){var s=o.every(function(a){return a instanceof Mf});return s?(this.tokens.splice.apply(this.tokens,[e,0].concat(o)),t||this.dispatch("insertToken",[o,e]),o):{FAIL:"insertToken: invalid token(s)."}};js.prototype.registerModifier=function(o,e,t){this.events.newToken.subscribe(function(s,a){var i=[s,a],f=e===null||e.apply(this,i)===!0,v=[s,a];if(f){var x=t.apply(this,v);s.setState(o,x)}}),this.registeredModifiers.push(o)};_y.prototype.subscribe=function(o){return typeof o=="function"?this.subscribers.push(o)-1:{FAIL:"invalid '"+this.eventId+"' event handler"}};_y.prototype.unsubscribe=function(o){this.subscribers.splice(o,1)};uc.prototype.setCurrentIndex=function(o){this.index=o,this.current=this.context[o],this.backtrack=this.context.slice(0,o),this.lookahead=this.context.slice(o+1)};uc.prototype.get=function(o){switch(!0){case o===0:return this.current;case(o<0&&Math.abs(o)<=this.backtrack.length):return this.backtrack.slice(o)[0];case(o>0&&o<=this.lookahead.length):return this.lookahead[o-1];default:return null}};js.prototype.rangeToText=function(o){if(o instanceof k9)return this.getRangeTokens(o).map(function(e){return e.char}).join("")};js.prototype.getText=function(){return this.tokens.map(function(o){return o.char}).join("")};js.prototype.getContext=function(o){var e=this.registeredContexts[o];return e||null};js.prototype.on=function(o,e){var t=this.events[o];return t?t.subscribe(e):null};js.prototype.dispatch=function(o,e){var t=this,s=this.events[o];s instanceof _y&&s.subscribers.forEach(function(a){a.apply(t,e||[])})};js.prototype.registerContextChecker=function(o,e,t){if(this.getContext(o))return{FAIL:"context name '"+o+"' is already registered."};if(typeof e!="function")return{FAIL:"missing context start check."};if(typeof t!="function")return{FAIL:"missing context end check."};var s=new TQ(o,e,t);return this.registeredContexts[o]=s,this.contextCheckers.push(s),s};js.prototype.getRangeTokens=function(o){var e=o.startIndex+o.endOffset;return[].concat(this.tokens.slice(o.startIndex,e))};js.prototype.getContextRanges=function(o){var e=this.getContext(o);return e?e.ranges:{FAIL:"context checker '"+o+"' is not registered."}};js.prototype.resetContextsRanges=function(){var o=this.registeredContexts;for(var e in o)if(o.hasOwnProperty(e)){var t=o[e];t.ranges=[]}};js.prototype.updateContextsRanges=function(){this.resetContextsRanges();for(var o=this.tokens.map(function(s){return s.char}),e=0;e<o.length;e++){var t=new uc(o,e);this.runContextCheck(t)}this.dispatch("updateContextsRanges",[this.registeredContexts])};js.prototype.setEndOffset=function(o,e){var t=this.getContext(e).openRange.startIndex,s=new k9(t,o,e),a=this.getContext(e).ranges;return s.rangeId=e+"."+a.length,a.push(s),this.getContext(e).openRange=null,s};js.prototype.runContextCheck=function(o){var e=this,t=o.index;this.contextCheckers.forEach(function(s){var a=s.contextName,i=e.getContext(a).openRange;if(!i&&s.checkStart(o)&&(i=new k9(t,null,a),e.getContext(a).openRange=i,e.dispatch("contextStart",[a,t])),i&&s.checkEnd(o)){var f=t-i.startIndex+1,v=e.setEndOffset(f,a);e.dispatch("contextEnd",[a,v])}})};js.prototype.tokenize=function(o){this.tokens=[],this.resetContextsRanges();var e=Array.from(o);this.dispatch("start");for(var t=0;t<e.length;t++){var s=e[t],a=new uc(e,t);this.dispatch("next",[a]),this.runContextCheck(a);var i=new Mf(s);this.tokens.push(i),this.dispatch("newToken",[i,a])}return this.dispatch("end",[this.tokens]),this.tokens};function wd(o){return/[\u0600-\u065F\u066A-\u06D2\u06FA-\u06FF]/.test(o)}function VD(o){return/[\u0630\u0690\u0621\u0631\u0661\u0671\u0622\u0632\u0672\u0692\u06C2\u0623\u0673\u0693\u06C3\u0624\u0694\u06C4\u0625\u0675\u0695\u06C5\u06E5\u0676\u0696\u06C6\u0627\u0677\u0697\u06C7\u0648\u0688\u0698\u06C8\u0689\u0699\u06C9\u068A\u06CA\u066B\u068B\u06CB\u068C\u068D\u06CD\u06FD\u068E\u06EE\u06FE\u062F\u068F\u06CF\u06EF]/.test(o)}function Sd(o){return/[\u0600-\u0605\u060C-\u060E\u0610-\u061B\u061E\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED]/.test(o)}function cy(o){return/[A-z]/.test(o)}function EQ(o){return/\s/.test(o)}function _l(o){this.font=o,this.features={}}function rp(o){this.id=o.id,this.tag=o.tag,this.substitution=o.substitution}function v_(o,e){if(!o)return-1;switch(e.format){case 1:return e.glyphs.indexOf(o);case 2:for(var t=e.ranges,s=0;s<t.length;s++){var a=t[s];if(o>=a.start&&o<=a.end){var i=o-a.start;return a.index+i}}break;default:return-1}return-1}function AQ(o,e){var t=v_(o,e.coverage);return t===-1?null:o+e.deltaGlyphId}function CQ(o,e){var t=v_(o,e.coverage);return t===-1?null:e.substitute[t]}function p9(o,e){for(var t=[],s=0;s<o.length;s++){var a=o[s],i=e.current;i=Array.isArray(i)?i[0]:i;var f=v_(i,a);f!==-1&&t.push(f)}return t.length!==o.length?-1:t}function IQ(o,e){var t=e.inputCoverage.length+e.lookaheadCoverage.length+e.backtrackCoverage.length;if(o.context.length<t)return[];var s=p9(e.inputCoverage,o);if(s===-1)return[];var a=e.inputCoverage.length-1;if(o.lookahead.length<e.lookaheadCoverage.length)return[];for(var i=o.lookahead.slice(a);i.length&&Sd(i[0].char);)i.shift();var f=new uc(i,0),v=p9(e.lookaheadCoverage,f),x=[].concat(o.backtrack);for(x.reverse();x.length&&Sd(x[0].char);)x.shift();if(x.length<e.backtrackCoverage.length)return[];var M=new uc(x,0),C=p9(e.backtrackCoverage,M),D=s.length===e.inputCoverage.length&&v.length===e.lookaheadCoverage.length&&C.length===e.backtrackCoverage.length,L=[];if(D)for(var N=0;N<e.lookupRecords.length;N++)for(var j=e.lookupRecords[N],Z=j.lookupListIndex,G=this.getLookupByIndex(Z),H=0;H<G.subtables.length;H++){var me=G.subtables[H],ne=this.getLookupMethod(G,me),fe=this.getSubstitutionType(G,me);if(fe==="12")for(var Ee=0;Ee<s.length;Ee++){var de=o.get(Ee),we=ne(de);we&&L.push(we)}}return L}function PQ(o,e){var t=o.current,s=v_(t,e.coverage);if(s===-1)return null;for(var a,i=e.ligatureSets[s],f=0;f<i.length;f++){a=i[f];for(var v=0;v<a.components.length;v++){var x=o.lookahead[v],M=a.components[v];if(x!==M)break;if(v===a.components.length-1)return a}}return null}function RQ(o,e){var t=v_(o,e.coverage);return t===-1?null:e.sequences[t]}_l.prototype.getDefaultScriptFeaturesIndexes=function(){for(var o=this.font.tables.gsub.scripts,e=0;e<o.length;e++){var t=o[e];if(t.tag==="DFLT")return t.script.defaultLangSys.featureIndexes}return[]};_l.prototype.getScriptFeaturesIndexes=function(o){var e=this.font.tables;if(!e.gsub)return[];if(!o)return this.getDefaultScriptFeaturesIndexes();for(var t=this.font.tables.gsub.scripts,s=0;s<t.length;s++){var a=t[s];if(a.tag===o&&a.script.defaultLangSys)return a.script.defaultLangSys.featureIndexes;var i=a.langSysRecords;if(i)for(var f=0;f<i.length;f++){var v=i[f];if(v.tag===o){var x=v.langSys;return x.featureIndexes}}}return this.getDefaultScriptFeaturesIndexes()};_l.prototype.mapTagsToFeatures=function(o,e){for(var t={},s=0;s<o.length;s++){var a=o[s].tag,i=o[s].feature;t[a]=i}this.features[e].tags=t};_l.prototype.getScriptFeatures=function(o){var e=this.features[o];if(this.features.hasOwnProperty(o))return e;var t=this.getScriptFeaturesIndexes(o);if(!t)return null;var s=this.font.tables.gsub;return e=t.map(function(a){return s.features[a]}),this.features[o]=e,this.mapTagsToFeatures(e,o),e};_l.prototype.getSubstitutionType=function(o,e){var t=o.lookupType.toString(),s=e.substFormat.toString();return t+s};_l.prototype.getLookupMethod=function(o,e){var t=this,s=this.getSubstitutionType(o,e);switch(s){case"11":return function(a){return AQ.apply(t,[a,e])};case"12":return function(a){return CQ.apply(t,[a,e])};case"63":return function(a){return IQ.apply(t,[a,e])};case"41":return function(a){return PQ.apply(t,[a,e])};case"21":return function(a){return RQ.apply(t,[a,e])};default:throw new Error("lookupType: "+o.lookupType+" - substFormat: "+e.substFormat+" is not yet supported")}};_l.prototype.lookupFeature=function(o){var e=o.contextParams,t=e.index,s=this.getFeature({tag:o.tag,script:o.script});if(!s)return new Error("font '"+this.font.names.fullName.en+"' doesn't support feature '"+o.tag+"' for script '"+o.script+"'.");for(var a=this.getFeatureLookups(s),i=[].concat(e.context),f=0;f<a.length;f++)for(var v=a[f],x=this.getLookupSubtables(v),M=0;M<x.length;M++){var C=x[M],D=this.getSubstitutionType(v,C),L=this.getLookupMethod(v,C),N=void 0;switch(D){case"11":N=L(e.current),N&&i.splice(t,1,new rp({id:11,tag:o.tag,substitution:N}));break;case"12":N=L(e.current),N&&i.splice(t,1,new rp({id:12,tag:o.tag,substitution:N}));break;case"63":N=L(e),Array.isArray(N)&&N.length&&i.splice(t,1,new rp({id:63,tag:o.tag,substitution:N}));break;case"41":N=L(e),N&&i.splice(t,1,new rp({id:41,tag:o.tag,substitution:N}));break;case"21":N=L(e.current),N&&i.splice(t,1,new rp({id:21,tag:o.tag,substitution:N}));break}e=new uc(i,t),!(Array.isArray(N)&&!N.length)&&(N=null)}return i.length?i:null};_l.prototype.supports=function(o){if(!o.script)return!1;this.getScriptFeatures(o.script);var e=this.features.hasOwnProperty(o.script);if(!o.tag)return e;var t=this.features[o.script].some(function(s){return s.tag===o.tag});return e&&t};_l.prototype.getLookupSubtables=function(o){return o.subtables||null};_l.prototype.getLookupByIndex=function(o){var e=this.font.tables.gsub.lookups;return e[o]||null};_l.prototype.getFeatureLookups=function(o){return o.lookupListIndexes.map(this.getLookupByIndex.bind(this))};_l.prototype.getFeature=function(e){if(!this.font)return{FAIL:"No font was found"};this.features.hasOwnProperty(e.script)||this.getScriptFeatures(e.script);var t=this.features[e.script];return t?t.tags[e.tag]?this.features[e.script].tags[e.tag]:null:{FAIL:"No feature for script "+e.script}};function kQ(o){var e=o.current,t=o.get(-1);return t===null&&wd(e)||!wd(t)&&wd(e)}function DQ(o){var e=o.get(1);return e===null||!wd(e)}var LQ={startCheck:kQ,endCheck:DQ};function FQ(o){var e=o.current,t=o.get(-1);return(wd(e)||Sd(e))&&!wd(t)}function OQ(o){var e=o.get(1);switch(!0){case e===null:return!0;case(!wd(e)&&!Sd(e)):var t=EQ(e);if(!t)return!0;if(t){var s=!1;if(s=o.lookahead.some(function(a){return wd(a)||Sd(a)}),!s)return!0}break;default:return!1}}var NQ={startCheck:FQ,endCheck:OQ};function zQ(o,e,t){e[t].setState(o.tag,o.substitution)}function BQ(o,e,t){e[t].setState(o.tag,o.substitution)}function UQ(o,e,t){o.substitution.forEach(function(s,a){var i=e[t+a];i.setState(o.tag,s)})}function VQ(o,e,t){var s=e[t];s.setState(o.tag,o.substitution.ligGlyph);for(var a=o.substitution.components.length,i=0;i<a;i++)s=e[t+i+1],s.setState("deleted",!0)}var qk={11:zQ,12:BQ,63:UQ,41:VQ};function D9(o,e,t){o instanceof rp&&qk[o.id]&&qk[o.id](o,e,t)}function GQ(o){for(var e=[].concat(o.backtrack),t=e.length-1;t>=0;t--){var s=e[t],a=VD(s),i=Sd(s);if(!a&&!i)return!0;if(a)return!1}return!1}function HQ(o){if(VD(o.current))return!1;for(var e=0;e<o.lookahead.length;e++){var t=o.lookahead[e],s=Sd(t);if(!s)return!0}return!1}function jQ(o){var e=this,t="arab",s=this.featuresTags[t],a=this.tokenizer.getRangeTokens(o);if(a.length!==1){var i=new uc(a.map(function(v){return v.getState("glyphIndex")}),0),f=new uc(a.map(function(v){return v.char}),0);a.forEach(function(v,x){if(!Sd(v.char)){i.setCurrentIndex(x),f.setCurrentIndex(x);var M=0;GQ(f)&&(M|=1),HQ(f)&&(M|=2);var C;switch(M){case 1:C="fina";break;case 2:C="init";break;case 3:C="medi";break}if(s.indexOf(C)!==-1){var D=e.query.lookupFeature({tag:C,script:t,contextParams:i});if(D instanceof Error)return console.info(D.message);D.forEach(function(L,N){L instanceof rp&&(D9(L,a,N),i.context[N]=L.substitution)})}}})}}function Xk(o,e){var t=o.map(function(s){return s.activeState.value});return new uc(t,e||0)}function WQ(o){var e=this,t="arab",s=this.tokenizer.getRangeTokens(o),a=Xk(s);a.context.forEach(function(i,f){a.setCurrentIndex(f);var v=e.query.lookupFeature({tag:"rlig",script:t,contextParams:a});v.length&&(v.forEach(function(x){return D9(x,s,f)}),a=Xk(s))})}function qQ(o){var e=o.current,t=o.get(-1);return t===null&&cy(e)||!cy(t)&&cy(e)}function XQ(o){var e=o.get(1);return e===null||!cy(e)}var ZQ={startCheck:qQ,endCheck:XQ};function Zk(o,e){var t=o.map(function(s){return s.activeState.value});return new uc(t,e||0)}function $Q(o){var e=this,t="latn",s=this.tokenizer.getRangeTokens(o),a=Zk(s);a.context.forEach(function(i,f){a.setCurrentIndex(f);var v=e.query.lookupFeature({tag:"liga",script:t,contextParams:a});v.length&&(v.forEach(function(x){return D9(x,s,f)}),a=Zk(s))})}function mc(o){this.baseDir=o||"ltr",this.tokenizer=new js,this.featuresTags={}}mc.prototype.setText=function(o){this.text=o};mc.prototype.contextChecks={latinWordCheck:ZQ,arabicWordCheck:LQ,arabicSentenceCheck:NQ};function f9(o){var e=this.contextChecks[o+"Check"];return this.tokenizer.registerContextChecker(o,e.startCheck,e.endCheck)}function YQ(){return f9.call(this,"latinWord"),f9.call(this,"arabicWord"),f9.call(this,"arabicSentence"),this.tokenizer.tokenize(this.text)}function JQ(){var o=this,e=this.tokenizer.getContextRanges("arabicSentence");e.forEach(function(t){var s=o.tokenizer.getRangeTokens(t);o.tokenizer.replaceRange(t.startIndex,t.endOffset,s.reverse())})}mc.prototype.registerFeatures=function(o,e){var t=this,s=e.filter(function(a){return t.query.supports({script:o,tag:a})});this.featuresTags.hasOwnProperty(o)?this.featuresTags[o]=this.featuresTags[o].concat(s):this.featuresTags[o]=s};mc.prototype.applyFeatures=function(o,e){if(!o)throw new Error("No valid font was provided to apply features");this.query||(this.query=new _l(o));for(var t=0;t<e.length;t++){var s=e[t];this.query.supports({script:s.script})&&this.registerFeatures(s.script,s.tags)}};mc.prototype.registerModifier=function(o,e,t){this.tokenizer.registerModifier(o,e,t)};function L9(){if(this.tokenizer.registeredModifiers.indexOf("glyphIndex")===-1)throw new Error("glyphIndex modifier is required to apply arabic presentation features.")}function KQ(){var o=this,e="arab";if(this.featuresTags.hasOwnProperty(e)){L9.call(this);var t=this.tokenizer.getContextRanges("arabicWord");t.forEach(function(s){jQ.call(o,s)})}}function QQ(){var o=this,e="arab";if(this.featuresTags.hasOwnProperty(e)){var t=this.featuresTags[e];if(t.indexOf("rlig")!==-1){L9.call(this);var s=this.tokenizer.getContextRanges("arabicWord");s.forEach(function(a){WQ.call(o,a)})}}}function eee(){var o=this,e="latn";if(this.featuresTags.hasOwnProperty(e)){var t=this.featuresTags[e];if(t.indexOf("liga")!==-1){L9.call(this);var s=this.tokenizer.getContextRanges("latinWord");s.forEach(function(a){$Q.call(o,a)})}}}mc.prototype.checkContextReady=function(o){return!!this.tokenizer.getContext(o)};mc.prototype.applyFeaturesToContexts=function(){this.checkContextReady("arabicWord")&&(KQ.call(this),QQ.call(this)),this.checkContextReady("latinWord")&&eee.call(this),this.checkContextReady("arabicSentence")&&JQ.call(this)};mc.prototype.processText=function(o){(!this.text||this.text!==o)&&(this.setText(o),YQ.call(this),this.applyFeaturesToContexts())};mc.prototype.getBidiText=function(o){return this.processText(o),this.tokenizer.getText()};mc.prototype.getTextGlyphs=function(o){this.processText(o);for(var e=[],t=0;t<this.tokenizer.tokens.length;t++){var s=this.tokenizer.tokens[t];if(!s.state.deleted){var a=s.activeState.value;e.push(Array.isArray(a)?a[0]:a)}}return e};function ms(o){o=o||{},o.tables=o.tables||{},o.empty||(c_(o.familyName,"When creating a new Font object, familyName is required."),c_(o.styleName,"When creating a new Font object, styleName is required."),c_(o.unitsPerEm,"When creating a new Font object, unitsPerEm is required."),c_(o.ascender,"When creating a new Font object, ascender is required."),c_(o.descender<=0,"When creating a new Font object, negative descender value is required."),this.names={fontFamily:{en:o.familyName||" "},fontSubfamily:{en:o.styleName||" "},fullName:{en:o.fullName||o.familyName+" "+o.styleName},postScriptName:{en:o.postScriptName||(o.familyName+o.styleName).replace(/\s/g,"")},designer:{en:o.designer||" "},designerURL:{en:o.designerURL||" "},manufacturer:{en:o.manufacturer||" "},manufacturerURL:{en:o.manufacturerURL||" "},license:{en:o.license||" "},licenseURL:{en:o.licenseURL||" "},version:{en:o.version||"Version 0.1"},description:{en:o.description||" "},copyright:{en:o.copyright||" "},trademark:{en:o.trademark||" "}},this.unitsPerEm=o.unitsPerEm||1e3,this.ascender=o.ascender,this.descender=o.descender,this.createdTimestamp=o.createdTimestamp,this.tables=Object.assign(o.tables,{os2:Object.assign({usWeightClass:o.weightClass||this.usWeightClasses.MEDIUM,usWidthClass:o.widthClass||this.usWidthClasses.MEDIUM,fsSelection:o.fsSelection||this.fsSelectionValues.REGULAR},o.tables.os2)})),this.supported=!0,this.glyphs=new i0.GlyphSet(this,o.glyphs||[]),this.encoding=new sD(this),this.position=new g_(this),this.substitution=new gl(this),this.tables=this.tables||{},this._push=null,this._hmtxTableData={},Object.defineProperty(this,"hinting",{get:function(){if(this._hinting)return this._hinting;if(this.outlinesFormat==="truetype")return this._hinting=new ND(this)}})}ms.prototype.hasChar=function(o){return this.encoding.charToGlyphIndex(o)!==null};ms.prototype.charToGlyphIndex=function(o){return this.encoding.charToGlyphIndex(o)};ms.prototype.charToGlyph=function(o){var e=this.charToGlyphIndex(o),t=this.glyphs.get(e);return t||(t=this.glyphs.get(0)),t};ms.prototype.updateFeatures=function(o){return this.defaultRenderOptions.features.map(function(e){return e.script==="latn"?{script:"latn",tags:e.tags.filter(function(t){return o[t]})}:e})};ms.prototype.stringToGlyphs=function(o,e){var t=this,s=new mc,a=function(D){return t.charToGlyphIndex(D.char)};s.registerModifier("glyphIndex",null,a);var i=e?this.updateFeatures(e.features):this.defaultRenderOptions.features;s.applyFeatures(this,i);for(var f=s.getTextGlyphs(o),v=f.length,x=new Array(v),M=this.glyphs.get(0),C=0;C<v;C+=1)x[C]=this.glyphs.get(f[C])||M;return x};ms.prototype.nameToGlyphIndex=function(o){return this.glyphNames.nameToGlyphIndex(o)};ms.prototype.nameToGlyph=function(o){var e=this.nameToGlyphIndex(o),t=this.glyphs.get(e);return t||(t=this.glyphs.get(0)),t};ms.prototype.glyphIndexToName=function(o){return this.glyphNames.glyphIndexToName?this.glyphNames.glyphIndexToName(o):""};ms.prototype.getKerningValue=function(o,e){o=o.index||o,e=e.index||e;var t=this.position.defaultKerningTables;return t?this.position.getKerningValue(t,o,e):this.kerningPairs[o+","+e]||0};ms.prototype.defaultRenderOptions={kerning:!0,features:[{script:"arab",tags:["init","medi","fina","rlig"]},{script:"latn",tags:["liga","rlig"]}]};ms.prototype.forEachGlyph=function(o,e,t,s,a,i){e=e!==void 0?e:0,t=t!==void 0?t:0,s=s!==void 0?s:72,a=Object.assign({},this.defaultRenderOptions,a);var f=1/this.unitsPerEm*s,v=this.stringToGlyphs(o,a),x;if(a.kerning){var M=a.script||this.position.getDefaultScriptName();x=this.position.getKerningTables(M,a.language)}for(var C=0;C<v.length;C+=1){var D=v[C];if(i.call(this,D,e,t,s,a),D.advanceWidth&&(e+=D.advanceWidth*f),a.kerning&&C<v.length-1){var L=x?this.position.getKerningValue(x,D.index,v[C+1].index):this.getKerningValue(D,v[C+1]);e+=L*f}a.letterSpacing?e+=a.letterSpacing*s:a.tracking&&(e+=a.tracking/1e3*s)}return e};ms.prototype.getPath=function(o,e,t,s,a){var i=new po;return this.forEachGlyph(o,e,t,s,a,function(f,v,x,M){var C=f.getPath(v,x,M,a,this);i.extend(C)}),i};ms.prototype.getPaths=function(o,e,t,s,a){var i=[];return this.forEachGlyph(o,e,t,s,a,function(f,v,x,M){var C=f.getPath(v,x,M,a,this);i.push(C)}),i};ms.prototype.getAdvanceWidth=function(o,e,t){return this.forEachGlyph(o,0,0,e,t,function(){})};ms.prototype.draw=function(o,e,t,s,a,i){this.getPath(e,t,s,a,i).draw(o)};ms.prototype.drawPoints=function(o,e,t,s,a,i){this.forEachGlyph(e,t,s,a,i,function(f,v,x,M){f.drawPoints(o,v,x,M)})};ms.prototype.drawMetrics=function(o,e,t,s,a,i){this.forEachGlyph(e,t,s,a,i,function(f,v,x,M){f.drawMetrics(o,v,x,M)})};ms.prototype.getEnglishName=function(o){var e=this.names[o];if(e)return e.en};ms.prototype.validate=function(){var o=this;function e(s,a){}function t(s){var a=o.getEnglishName(s);a&&a.trim().length>0}t("fontFamily"),t("weightName"),t("manufacturer"),t("copyright"),t("version"),this.unitsPerEm>0};ms.prototype.toTables=function(){return VJ.fontToTable(this)};ms.prototype.toBuffer=function(){return console.warn("Font.toBuffer is deprecated. Use Font.toArrayBuffer instead."),this.toArrayBuffer()};ms.prototype.toArrayBuffer=function(){for(var o=this.toTables(),e=o.encode(),t=new ArrayBuffer(e.length),s=new Uint8Array(t),a=0;a<e.length;a++)s[a]=e[a];return t};ms.prototype.download=function(o){var e=this.getEnglishName("fontFamily"),t=this.getEnglishName("fontSubfamily");o=o||e.replace(/\s/g,"")+"-"+t+".otf";var s=this.toArrayBuffer();if(HJ())if(window.URL=window.URL||window.webkitURL,window.URL){var a=new DataView(s),i=new Blob([a],{type:"font/opentype"}),f=document.createElement("a");f.href=window.URL.createObjectURL(i),f.download=o;var v=document.createEvent("MouseEvents");v.initEvent("click",!0,!1),f.dispatchEvent(v)}else console.warn("Font file could not be downloaded. Try using a different browser.");else{var x=iy(),M=jJ(s);x.writeFileSync(o,M)}};ms.prototype.fsSelectionValues={ITALIC:1,UNDERSCORE:2,NEGATIVE:4,OUTLINED:8,STRIKEOUT:16,BOLD:32,REGULAR:64,USER_TYPO_METRICS:128,WWS:256,OBLIQUE:512};ms.prototype.usWidthClasses={ULTRA_CONDENSED:1,EXTRA_CONDENSED:2,CONDENSED:3,SEMI_CONDENSED:4,MEDIUM:5,SEMI_EXPANDED:6,EXPANDED:7,EXTRA_EXPANDED:8,ULTRA_EXPANDED:9};ms.prototype.usWeightClasses={THIN:100,EXTRA_LIGHT:200,LIGHT:300,NORMAL:400,MEDIUM:500,SEMI_BOLD:600,BOLD:700,EXTRA_BOLD:800,BLACK:900};function GD(o,e){var t=JSON.stringify(o),s=256;for(var a in e){var i=parseInt(a);if(!(!i||i<256)){if(JSON.stringify(e[a])===t)return i;s<=i&&(s=i+1)}}return e[s]=o,s}function tee(o,e,t){var s=GD(e.name,t);return[{name:"tag_"+o,type:"TAG",value:e.tag},{name:"minValue_"+o,type:"FIXED",value:e.minValue<<16},{name:"defaultValue_"+o,type:"FIXED",value:e.defaultValue<<16},{name:"maxValue_"+o,type:"FIXED",value:e.maxValue<<16},{name:"flags_"+o,type:"USHORT",value:0},{name:"nameID_"+o,type:"USHORT",value:s}]}function iee(o,e,t){var s={},a=new on.Parser(o,e);return s.tag=a.parseTag(),s.minValue=a.parseFixed(),s.defaultValue=a.parseFixed(),s.maxValue=a.parseFixed(),a.skip("uShort",1),s.name=t[a.parseUShort()]||{},s}function nee(o,e,t,s){for(var a=GD(e.name,s),i=[{name:"nameID_"+o,type:"USHORT",value:a},{name:"flags_"+o,type:"USHORT",value:0}],f=0;f<t.length;++f){var v=t[f].tag;i.push({name:"axis_"+o+" "+v,type:"FIXED",value:e.coordinates[v]<<16})}return i}function ree(o,e,t,s){var a={},i=new on.Parser(o,e);a.name=s[i.parseUShort()]||{},i.skip("uShort",1),a.coordinates={};for(var f=0;f<t.length;++f)a.coordinates[t[f].tag]=i.parseFixed();return a}function see(o,e){var t=new Xi.Table("fvar",[{name:"version",type:"ULONG",value:65536},{name:"offsetToData",type:"USHORT",value:0},{name:"countSizePairs",type:"USHORT",value:2},{name:"axisCount",type:"USHORT",value:o.axes.length},{name:"axisSize",type:"USHORT",value:20},{name:"instanceCount",type:"USHORT",value:o.instances.length},{name:"instanceSize",type:"USHORT",value:4+o.axes.length*4}]);t.offsetToData=t.sizeOf();for(var s=0;s<o.axes.length;s++)t.fields=t.fields.concat(tee(s,o.axes[s],e));for(var a=0;a<o.instances.length;a++)t.fields=t.fields.concat(nee(a,o.instances[a],o.axes,e));return t}function oee(o,e,t){var s=new on.Parser(o,e),a=s.parseULong();Zn.argument(a===65536,"Unsupported fvar table version.");var i=s.parseOffset16();s.skip("uShort",1);for(var f=s.parseUShort(),v=s.parseUShort(),x=s.parseUShort(),M=s.parseUShort(),C=[],D=0;D<f;D++)C.push(iee(o,e+i+D*v,t));for(var L=[],N=e+i+f*v,j=0;j<x;j++)L.push(ree(o,N+j*M,C,t));return{axes:C,instances:L}}var aee={make:see,parse:oee},lee=function(){return{coverage:this.parsePointer(Pt.coverage),attachPoints:this.parseList(Pt.pointer(Pt.uShortList))}},cee=function(){var o=this.parseUShort();if(Zn.argument(o===1||o===2||o===3,"Unsupported CaretValue table version."),o===1)return{coordinate:this.parseShort()};if(o===2)return{pointindex:this.parseShort()};if(o===3)return{coordinate:this.parseShort()}},hee=function(){return this.parseList(Pt.pointer(cee))},dee=function(){return{coverage:this.parsePointer(Pt.coverage),ligGlyphs:this.parseList(Pt.pointer(hee))}},uee=function(){return this.parseUShort(),this.parseList(Pt.pointer(Pt.coverage))};function pee(o,e){e=e||0;var t=new Pt(o,e),s=t.parseVersion(1);Zn.argument(s===1||s===1.2||s===1.3,"Unsupported GDEF table version.");var a={version:s,classDef:t.parsePointer(Pt.classDef),attachList:t.parsePointer(lee),ligCaretList:t.parsePointer(dee),markAttachClassDef:t.parsePointer(Pt.classDef)};return s>=1.2&&(a.markGlyphSets=t.parsePointer(uee)),a}var fee={parse:pee},pc=new Array(10);pc[1]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();if(t===1)return{posFormat:1,coverage:this.parsePointer(Pt.coverage),value:this.parseValueRecord()};if(t===2)return{posFormat:2,coverage:this.parsePointer(Pt.coverage),values:this.parseValueRecordList()};Zn.assert(!1,"0x"+e.toString(16)+": GPOS lookup type 1 format must be 1 or 2.")};pc[2]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();Zn.assert(t===1||t===2,"0x"+e.toString(16)+": GPOS lookup type 2 format must be 1 or 2.");var s=this.parsePointer(Pt.coverage),a=this.parseUShort(),i=this.parseUShort();if(t===1)return{posFormat:t,coverage:s,valueFormat1:a,valueFormat2:i,pairSets:this.parseList(Pt.pointer(Pt.list(function(){return{secondGlyph:this.parseUShort(),value1:this.parseValueRecord(a),value2:this.parseValueRecord(i)}})))};if(t===2){var f=this.parsePointer(Pt.classDef),v=this.parsePointer(Pt.classDef),x=this.parseUShort(),M=this.parseUShort();return{posFormat:t,coverage:s,valueFormat1:a,valueFormat2:i,classDef1:f,classDef2:v,class1Count:x,class2Count:M,classRecords:this.parseList(x,Pt.list(M,function(){return{value1:this.parseValueRecord(a),value2:this.parseValueRecord(i)}}))}}};pc[3]=function(){return{error:"GPOS Lookup 3 not supported"}};pc[4]=function(){return{error:"GPOS Lookup 4 not supported"}};pc[5]=function(){return{error:"GPOS Lookup 5 not supported"}};pc[6]=function(){return{error:"GPOS Lookup 6 not supported"}};pc[7]=function(){return{error:"GPOS Lookup 7 not supported"}};pc[8]=function(){return{error:"GPOS Lookup 8 not supported"}};pc[9]=function(){return{error:"GPOS Lookup 9 not supported"}};function mee(o,e){e=e||0;var t=new Pt(o,e),s=t.parseVersion(1);return Zn.argument(s===1||s===1.1,"Unsupported GPOS table version "+s),s===1?{version:s,scripts:t.parseScriptList(),features:t.parseFeatureList(),lookups:t.parseLookupList(pc)}:{version:s,scripts:t.parseScriptList(),features:t.parseFeatureList(),lookups:t.parseLookupList(pc),variations:t.parseFeatureVariationsList()}}var gee=new Array(10);function _ee(o){return new Xi.Table("GPOS",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new Xi.ScriptList(o.scripts)},{name:"features",type:"TABLE",value:new Xi.FeatureList(o.features)},{name:"lookups",type:"TABLE",value:new Xi.LookupList(o.lookups,gee)}])}var yee={parse:mee,make:_ee};function vee(o){var e={};o.skip("uShort");var t=o.parseUShort();Zn.argument(t===0,"Unsupported kern sub-table version."),o.skip("uShort",2);var s=o.parseUShort();o.skip("uShort",3);for(var a=0;a<s;a+=1){var i=o.parseUShort(),f=o.parseUShort(),v=o.parseShort();e[i+","+f]=v}return e}function xee(o){var e={};o.skip("uShort");var t=o.parseULong();t>1&&console.warn("Only the first kern subtable is supported."),o.skip("uLong");var s=o.parseUShort(),a=s&255;if(o.skip("uShort"),a===0){var i=o.parseUShort();o.skip("uShort",3);for(var f=0;f<i;f+=1){var v=o.parseUShort(),x=o.parseUShort(),M=o.parseShort();e[v+","+x]=M}}return e}function bee(o,e){var t=new on.Parser(o,e),s=t.parseUShort();if(s===0)return vee(t);if(s===1)return xee(t);throw new Error("Unsupported kern table version ("+s+").")}var wee={parse:bee};function See(o,e,t,s){for(var a=new on.Parser(o,e),i=s?a.parseUShort:a.parseULong,f=[],v=0;v<t+1;v+=1){var x=i.call(a);s&&(x*=2),f.push(x)}return f}var Tee={parse:See};function Mee(o,e){var t=iy();t.readFile(o,function(s,a){if(s)return e(s.message);e(null,PD(a))})}function Eee(o,e){var t=new XMLHttpRequest;t.open("get",o,!0),t.responseType="arraybuffer",t.onload=function(){return t.response?e(null,t.response):e("Font could not be loaded: "+t.statusText)},t.onerror=function(){e("Font could not be loaded")},t.send()}function $k(o,e){for(var t=[],s=12,a=0;a<e;a+=1){var i=on.getTag(o,s),f=on.getULong(o,s+4),v=on.getULong(o,s+8),x=on.getULong(o,s+12);t.push({tag:i,checksum:f,offset:v,length:x,compression:!1}),s+=16}return t}function Aee(o,e){for(var t=[],s=44,a=0;a<e;a+=1){var i=on.getTag(o,s),f=on.getULong(o,s+4),v=on.getULong(o,s+8),x=on.getULong(o,s+12),M=void 0;v<x?M="WOFF":M=!1,t.push({tag:i,offset:f,compression:M,compressedLength:v,length:x}),s+=20}return t}function no(o,e){if(e.compression==="WOFF"){var t=new Uint8Array(o.buffer,e.offset+2,e.compressedLength-2),s=new Uint8Array(e.length);if(yY(t,s),s.byteLength!==e.length)throw new Error("Decompression error: "+e.tag+" decompressed length doesn't match recorded length");var a=new DataView(s.buffer,0);return{data:a,offset:0}}else return{data:o,offset:e.offset}}function F9(o,e){e=e??{};var t,s,a=new ms({empty:!0}),i=new DataView(o,0),f,v=[],x=on.getTag(i,0);if(x==="\0\0\0"||x==="true"||x==="typ1")a.outlinesFormat="truetype",f=on.getUShort(i,4),v=$k(i,f);else if(x==="OTTO")a.outlinesFormat="cff",f=on.getUShort(i,4),v=$k(i,f);else if(x==="wOFF"){var M=on.getTag(i,4);if(M==="\0\0\0")a.outlinesFormat="truetype";else if(M==="OTTO")a.outlinesFormat="cff";else throw new Error("Unsupported OpenType flavor "+x);f=on.getUShort(i,12),v=Aee(i,f)}else throw new Error("Unsupported OpenType signature "+x);for(var C,D,L,N,j,Z,G,H,me,ne,fe,Ee,de=0;de<f;de+=1){var we=v[de],Le=void 0;switch(we.tag){case"cmap":Le=no(i,we),a.tables.cmap=rD.parse(Le.data,Le.offset),a.encoding=new oD(a.tables.cmap);break;case"cvt ":Le=no(i,we),Ee=new on.Parser(Le.data,Le.offset),a.tables.cvt=Ee.parseShortList(we.length/2);break;case"fvar":D=we;break;case"fpgm":Le=no(i,we),Ee=new on.Parser(Le.data,Le.offset),a.tables.fpgm=Ee.parseByteList(we.length);break;case"head":Le=no(i,we),a.tables.head=gD.parse(Le.data,Le.offset),a.unitsPerEm=a.tables.head.unitsPerEm,t=a.tables.head.indexToLocFormat;break;case"hhea":Le=no(i,we),a.tables.hhea=_D.parse(Le.data,Le.offset),a.ascender=a.tables.hhea.ascender,a.descender=a.tables.hhea.descender,a.numberOfHMetrics=a.tables.hhea.numberOfHMetrics;break;case"hmtx":G=we;break;case"ltag":Le=no(i,we),s=vD.parse(Le.data,Le.offset);break;case"maxp":Le=no(i,we),a.tables.maxp=xD.parse(Le.data,Le.offset),a.numGlyphs=a.tables.maxp.numGlyphs;break;case"name":ne=we;break;case"OS/2":Le=no(i,we),a.tables.os2=w9.parse(Le.data,Le.offset);break;case"post":Le=no(i,we),a.tables.post=ED.parse(Le.data,Le.offset),a.glyphNames=new C9(a.tables.post);break;case"prep":Le=no(i,we),Ee=new on.Parser(Le.data,Le.offset),a.tables.prep=Ee.parseByteList(we.length);break;case"glyf":L=we;break;case"loca":me=we;break;case"CFF ":C=we;break;case"kern":H=we;break;case"GDEF":N=we;break;case"GPOS":j=we;break;case"GSUB":Z=we;break;case"meta":fe=we;break}}var De=no(i,ne);if(a.tables.name=MD.parse(De.data,De.offset,s),a.names=a.tables.name,L&&me){var se=t===0,Ce=no(i,me),Ne=Tee.parse(Ce.data,Ce.offset,a.numGlyphs,se),zt=no(i,L);a.glyphs=LD.parse(zt.data,zt.offset,Ne,a,e)}else if(C){var Ge=no(i,C);mD.parse(Ge.data,Ge.offset,a,e)}else throw new Error("Font doesn't contain TrueType or CFF outlines.");var Xe=no(i,G);if(yD.parse(a,Xe.data,Xe.offset,a.numberOfHMetrics,a.numGlyphs,a.glyphs,e),BY(a,e),H){var ht=no(i,H);a.kerningPairs=wee.parse(ht.data,ht.offset)}else a.kerningPairs={};if(N){var Ot=no(i,N);a.tables.gdef=fee.parse(Ot.data,Ot.offset)}if(j){var bt=no(i,j);a.tables.gpos=yee.parse(bt.data,bt.offset),a.position.init()}if(Z){var Tt=no(i,Z);a.tables.gsub=AD.parse(Tt.data,Tt.offset)}if(D){var Nt=no(i,D);a.tables.fvar=aee.parse(Nt.data,Nt.offset,a.names)}if(fe){var Bt=no(i,fe);a.tables.meta=CD.parse(Bt.data,Bt.offset),a.metas=a.tables.meta}return a}function Cee(o,e,t){t=t??{};var s=typeof window>"u",a=s&&!t.isUrl?Mee:Eee;return new Promise(function(i,f){a(o,function(v,x){if(v){if(e)return e(v);f(v)}var M;try{M=F9(x,t)}catch(C){if(e)return e(C,null);f(C)}if(e)return e(null,M);i(M)})})}function Iee(o,e){var t=iy(),s=t.readFileSync(o);return F9(PD(s),e)}var Pee=Object.freeze({__proto__:null,Font:ms,Glyph:ml,Path:po,BoundingBox:Z0,_parse:on,parse:F9,load:Cee,loadSync:Iee}),HD=Pee;var x_="DxfWorkerMsg",O9=(()=>{class o{constructor(t,s=!1){this.worker=t,s?t.onmessage=this._ProcessRequest.bind(this):t&&(t.addEventListener("message",this._ProcessResponse.bind(this),!1),t.addEventListener("error",this._OnError.bind(this),!1),this.reqSeq=1,this.requests=new Map,this.progressCbk=null)}Load(t,s,a,i){return yr(this,null,function*(){return this.worker?this._SendRequest(o.WorkerMsg.LOAD,{url:t,fonts:s,options:this._CloneOptions(a)},i):this._Load(t,s,a,i)})}Destroy(t=!1){return yr(this,null,function*(){this.worker&&(t||(yield this._SendRequest(o.WorkerMsg.DESTROY)),this.worker.terminate())})}_ProcessRequest(t){return yr(this,null,function*(){let s=t.data;if(s.signature!==x_){console.log("Message with bad signature",s);return}let a={seq:s.seq,type:s.type,signature:x_},i=[];try{a.data=yield this._ProcessRequestMessage(s.type,s.data,i,s.seq)}catch(f){console.error(f),a.error=String(f)}this.worker.postMessage(a,i),s.type===o.WorkerMsg.DESTROY&&(this.worker.onmessage=null,this.worker.close(),this.worker=null)})}_ProcessRequestMessage(t,s,a,i){return yr(this,null,function*(){switch(t){case o.WorkerMsg.LOAD:{let{scene:f,dxf:v}=yield this._Load(s.url,s.fonts,s.options,(x,M,C)=>this._SendProgress(i,x,M,C));return a.push(f.vertices),a.push(f.indices),a.push(f.transforms),{scene:f,dxf:v}}case o.WorkerMsg.DESTROY:return null;default:throw"Unknown message type: "+t}})}_ProcessResponse(t){return yr(this,null,function*(){let s=t.data;if(s.signature!==x_){console.log("Message with bad signature",s);return}let a=s.seq,i=this.requests.get(a);if(!i){console.error("Unmatched message sequence: ",a);return}let f=s.data;if(s.type===o.WorkerMsg.PROGRESS&&i.progressCbk){i.progressCbk(f.phase,f.size,f.totalSize);return}this.requests.delete(a),s.hasOwnProperty("error")?i.SetError(s.error):i.SetResponse(f)})}_OnError(t){return yr(this,null,function*(){console.error("DxfWorker worker error",t);let s=Array.from(this.requests.values);this.requests.clear(),s.forEach(a=>a.SetError(t))})}_SendRequest(t,s=null,a=null){return yr(this,null,function*(){let i=this.reqSeq++,f=new o.Request(i,a);return this.requests.set(i,f),this.worker.postMessage({seq:i,type:t,data:s,signature:x_}),yield f.GetResponse()})}_SendProgress(t,s,a,i){this.worker.postMessage({seq:t,type:o.WorkerMsg.PROGRESS,data:{phase:s,size:a,totalSize:i},signature:x_})}_Load(t,s,a,i){return yr(this,null,function*(){let f;s?f=this._CreateFontFetchers(s,i):f=[];let v=yield new Bg(t,a.fileEncoding).Fetch(i);i&&i("prepare",0,null);let x=new tp(a);return yield x.Build(v,f),{scene:x.scene,dxf:a.retainParsedDxf===!0?v:void 0}})}_CreateFontFetchers(t,s){function a(f){return function(){return yr(this,null,function*(){s&&s("font",0,null);let v=yield fetch(f).then(x=>x.arrayBuffer());return s&&s("prepare",0,null),HD.parse(v)})}}let i=[];for(let f of t)i.push(a(f));return i}_CloneOptions(t){if(Array.isArray(t))return t.map(s=>this._CloneOptions(s));if(typeof t=="object"&&t!==null){let s={};for(let a in t)s[a]=this._CloneOptions(t[a]);return s}else return t}}return o.WorkerMsg={LOAD:"LOAD",PROGRESS:"PROGRESS",DESTROY:"DESTROY"},o.Request=class{constructor(e,t){this.seq=e,this.progressCbk=t,this.promise=new Promise((s,a)=>{this._Resolve=s,this._Reject=a})}GetResponse(){return yr(this,null,function*(){return yield this.promise})}SetResponse(e){this._Resolve(e)}SetError(e){this._Reject(e)}},o})();var b_=class{constructor(e,t,s,a){this.instanceType=e,this.geometryType=t??null,this.color=s,this.lineType=a??null}Compare(e){let t=Yc(this.instanceType,e.instanceType);return t!==0||(t=Yc(this.geometryType,e.geometryType),t!==0)||(t=Yc(this.color,e.color),t!==0)?t:Yc(this.lineType,e.lineType)}};var Ef=function(o,e){e===void 0&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),e===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=o,this.domElement=e,this.enabled=!0,this.target=new mt,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.mouseZoomSpeedFactor=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:Il.ROTATE,MIDDLE:Il.DOLLY,RIGHT:Il.PAN},this.touches={ONE:Pl.ROTATE,TWO:Pl.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return M.phi},this.getAzimuthalAngle=function(){return M.theta},this.listenToKeyEvents=function(ye){ye.addEventListener("keydown",he),this._domElementKeyEvents=ye},this.saveState=function(){t.target0.copy(t.target),t.position0.copy(t.object.position),t.zoom0=t.object.zoom},this.reset=function(){t.target.copy(t.target0),t.object.position.copy(t.position0),t.object.zoom=t.zoom0,t.object.updateProjectionMatrix(),t.dispatchEvent(s),t.update(),v=f.NONE},this.update=function(){var ye=new mt,Ve=new ac().setFromUnitVectors(o.up,new mt(0,1,0)),pt=Ve.clone().invert(),ut=new mt,St=new ac,Vt=2*Math.PI;return function(){var en=t.object.position;ye.copy(en).sub(t.target),ye.applyQuaternion(Ve),M.setFromVector3(ye),t.autoRotate&&v===f.NONE&&se(Le()),t.enableDamping?(M.theta+=C.theta*t.dampingFactor,M.phi+=C.phi*t.dampingFactor):(M.theta+=C.theta,M.phi+=C.phi);var Oi=t.minAzimuthAngle,yi=t.maxAzimuthAngle;return isFinite(Oi)&&isFinite(yi)&&(Oi<-Math.PI?Oi+=Vt:Oi>Math.PI&&(Oi-=Vt),yi<-Math.PI?yi+=Vt:yi>Math.PI&&(yi-=Vt),Oi<=yi?M.theta=Math.max(Oi,Math.min(yi,M.theta)):M.theta=M.theta>(Oi+yi)/2?Math.max(Oi,M.theta):Math.min(yi,M.theta)),M.phi=Math.max(t.minPolarAngle,Math.min(t.maxPolarAngle,M.phi)),M.makeSafe(),M.radius*=D,M.radius=Math.max(t.minDistance,Math.min(t.maxDistance,M.radius)),t.enableDamping===!0?t.target.addScaledVector(L,t.dampingFactor):t.target.add(L),ye.setFromSpherical(M),ye.applyQuaternion(pt),en.copy(t.target).add(ye),t.object.lookAt(t.target),t.enableDamping===!0?(C.theta*=1-t.dampingFactor,C.phi*=1-t.dampingFactor,L.multiplyScalar(1-t.dampingFactor)):(C.set(0,0,0),L.set(0,0,0)),D=1,N||ut.distanceToSquared(t.object.position)>x||8*(1-St.dot(t.object.quaternion))>x?(t.dispatchEvent(s),ut.copy(t.object.position),St.copy(t.object.quaternion),N=!1,!0):!1}}(),this.dispose=function(){t.domElement.removeEventListener("contextmenu",at),t.domElement.removeEventListener("pointerdown",Fn),t.domElement.removeEventListener("wheel",te),t.domElement.removeEventListener("touchstart",Se),t.domElement.removeEventListener("touchend",Ye),t.domElement.removeEventListener("touchmove",He),t.domElement.ownerDocument.removeEventListener("pointermove",Ie),t.domElement.ownerDocument.removeEventListener("pointerup",be),t._domElementKeyEvents!==null&&t._domElementKeyEvents.removeEventListener("keydown",he)};var t=this,s={type:"change"},a={type:"start"},i={type:"end"},f={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},v=f.NONE,x=1e-6,M=new t_,C=new t_,D=1,L=new mt,N=!1,j=new ui,Z=new ui,G=new ui,H=new ui,me=new ui,ne=new ui,fe=new ui,Ee=new ui,de=new ui,we=new ui;function Le(){return 2*Math.PI/60/60*t.autoRotateSpeed}function De(ye){return Math.pow(.95,t.zoomSpeed*(ye?t.mouseZoomSpeedFactor:1))}function se(ye){C.theta-=ye}function Ce(ye){C.phi-=ye}var Ne=function(){var ye=new mt;return function(pt,ut){ye.setFromMatrixColumn(ut,0),ye.multiplyScalar(-pt),L.add(ye)}}(),zt=function(){var ye=new mt;return function(pt,ut){t.screenSpacePanning===!0?ye.setFromMatrixColumn(ut,1):(ye.setFromMatrixColumn(ut,0),ye.crossVectors(t.object.up,ye)),ye.multiplyScalar(pt),L.add(ye)}}(),Ge=function(){var ye=new mt;return function(pt,ut){var St=t.domElement;if(t.object.isPerspectiveCamera){var Vt=t.object.position;ye.copy(Vt).sub(t.target);var Mi=ye.length();Mi*=Math.tan(t.object.fov/2*Math.PI/180),Ne(2*pt*Mi/St.clientHeight,t.object.matrix),zt(2*ut*Mi/St.clientHeight,t.object.matrix)}else t.object.isOrthographicCamera?(Ne(pt*(t.object.right-t.object.left)/t.object.zoom/St.clientWidth/window.devicePixelRatio,t.object.matrix),zt(ut*(t.object.top-t.object.bottom)/t.object.zoom/St.clientHeight/window.devicePixelRatio,t.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),t.enablePan=!1)}}();function Xe(ye,Ve){let pt=(Ve.x-t.domElement.width/2)*(ye-1)/ye,ut=(Ve.y-t.domElement.height/2)*(ye-1)/ye;Ge(-pt,-ut)}function ht(ye,Ve){if(t.object.isPerspectiveCamera)D/=ye;else if(t.object.isOrthographicCamera){let pt=Math.max(t.minZoom,Math.min(t.maxZoom,t.object.zoom*ye));Xe(pt/t.object.zoom,Ve),t.object.zoom=pt,t.object.updateProjectionMatrix(),N=!0}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),t.enableZoom=!1}function Ot(ye,Ve){if(t.object.isPerspectiveCamera)D*=ye;else if(t.object.isOrthographicCamera){let pt=Math.max(t.minZoom,Math.min(t.maxZoom,t.object.zoom/ye));Xe(pt/t.object.zoom,Ve),t.object.zoom=pt,t.object.updateProjectionMatrix(),N=!0}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),t.enableZoom=!1}function bt(ye){j.set(ye.clientX,ye.clientY)}function Tt(ye){let Ve=t.domElement.getBoundingClientRect();fe.set(ye.clientX-Ve.left,ye.clientY-Ve.top),Ee.set(ye.clientX,ye.clientY)}function Nt(ye){H.set(ye.clientX,ye.clientY)}function Bt(ye){Z.set(ye.clientX,ye.clientY),G.subVectors(Z,j).multiplyScalar(t.rotateSpeed);var Ve=t.domElement;se(2*Math.PI*G.x/Ve.clientHeight),Ce(2*Math.PI*G.y/Ve.clientHeight),j.copy(Z),t.update()}function Yt(ye){de.set(ye.clientX,ye.clientY),we.subVectors(de,Ee),we.y>0?ht(De(!0),fe):we.y<0&&Ot(De(!0),fe),Ee.copy(de),t.update()}function Wi(ye){me.set(ye.clientX,ye.clientY),ne.subVectors(me,H).multiplyScalar(t.panSpeed*window.devicePixelRatio),Ge(ne.x,ne.y),H.copy(me),t.update()}function wt(){}function ei(ye){let Ve=t.domElement.getBoundingClientRect(),pt=new ui((ye.clientX-Ve.left)*window.devicePixelRatio,(ye.clientY-Ve.top)*window.devicePixelRatio);ye.deltaY<0?Ot(De(),pt):ye.deltaY>0&&ht(De(),pt),t.update()}function vi(ye){var Ve=!1;switch(ye.keyCode){case t.keys.UP:Ge(0,t.keyPanSpeed),Ve=!0;break;case t.keys.BOTTOM:Ge(0,-t.keyPanSpeed),Ve=!0;break;case t.keys.LEFT:Ge(t.keyPanSpeed,0),Ve=!0;break;case t.keys.RIGHT:Ge(-t.keyPanSpeed,0),Ve=!0;break}Ve&&(ye.preventDefault(),t.update())}function Pi(ye){if(ye.touches.length==1)j.set(ye.touches[0].pageX,ye.touches[0].pageY);else{var Ve=.5*(ye.touches[0].pageX+ye.touches[1].pageX),pt=.5*(ye.touches[0].pageY+ye.touches[1].pageY);j.set(Ve,pt)}}function Fi(ye){if(ye.touches.length==1)H.set(ye.touches[0].pageX,ye.touches[0].pageY);else{var Ve=.5*(ye.touches[0].pageX+ye.touches[1].pageX),pt=.5*(ye.touches[0].pageY+ye.touches[1].pageY);H.set(Ve,pt)}}function Ri(ye){let Ve=t.domElement.getBoundingClientRect();fe.set((ye.touches[0].clientX+ye.touches[1].clientX)/2-Ve.left,(ye.touches[0].clientY+ye.touches[1].clientY)/2-Ve.top).multiplyScalar(window.devicePixelRatio);var pt=ye.touches[0].pageX-ye.touches[1].pageX,ut=ye.touches[0].pageY-ye.touches[1].pageY,St=Math.sqrt(pt*pt+ut*ut);Ee.set(0,St)}function br(ye){t.enableZoom&&Ri(ye),t.enablePan&&Fi(ye)}function Ui(ye){t.enableZoom&&Ri(ye),t.enableRotate&&Pi(ye)}function st(ye){if(ye.touches.length==1)Z.set(ye.touches[0].pageX,ye.touches[0].pageY);else{var Ve=.5*(ye.touches[0].pageX+ye.touches[1].pageX),pt=.5*(ye.touches[0].pageY+ye.touches[1].pageY);Z.set(Ve,pt)}G.subVectors(Z,j).multiplyScalar(t.rotateSpeed);var ut=t.domElement;se(2*Math.PI*G.x/ut.clientHeight),Ce(2*Math.PI*G.y/ut.clientHeight),j.copy(Z)}function $r(ye){if(ye.touches.length==1)me.set(ye.touches[0].pageX,ye.touches[0].pageY);else{var Ve=.5*(ye.touches[0].pageX+ye.touches[1].pageX),pt=.5*(ye.touches[0].pageY+ye.touches[1].pageY);me.set(Ve,pt)}ne.subVectors(me,H).multiplyScalar(t.panSpeed*window.devicePixelRatio),Ge(ne.x,ne.y),H.copy(me)}function Ki(ye){var Ve=ye.touches[0].pageX-ye.touches[1].pageX,pt=ye.touches[0].pageY-ye.touches[1].pageY,ut=Math.sqrt(Ve*Ve+pt*pt);de.set(0,ut),we.set(0,de.y/Ee.y),ht(we.y,fe),Ee.copy(de)}function yn(ye){t.enableZoom&&Ki(ye),t.enablePan&&$r(ye)}function Qi(ye){t.enableZoom&&Ki(ye),t.enableRotate&&st(ye)}function Gn(){}function Fn(ye){if(t.enabled!==!1)switch(ye.pointerType){case"mouse":case"pen":_t(ye);break}}function Ie(ye){if(t.enabled!==!1)switch(ye.pointerType){case"mouse":case"pen":li(ye);break}}function be(ye){switch(ye.pointerType){case"mouse":case"pen":ze(ye);break}}function _t(ye){ye.preventDefault(),t.domElement.focus?t.domElement.focus():window.focus();var Ve;switch(ye.button){case 0:Ve=t.mouseButtons.LEFT;break;case 1:Ve=t.mouseButtons.MIDDLE;break;case 2:Ve=t.mouseButtons.RIGHT;break;default:Ve=-1}switch(Ve){case Il.DOLLY:if(t.enableZoom===!1)return;Tt(ye),v=f.DOLLY;break;case Il.ROTATE:if(ye.ctrlKey||ye.metaKey||ye.shiftKey){if(t.enablePan===!1)return;Nt(ye),v=f.PAN}else{if(t.enableRotate===!1)return;bt(ye),v=f.ROTATE}break;case Il.PAN:if(ye.ctrlKey||ye.metaKey||ye.shiftKey){if(t.enableRotate===!1)return;bt(ye),v=f.ROTATE}else{if(t.enablePan===!1)return;Nt(ye),v=f.PAN}break;default:v=f.NONE}v!==f.NONE&&(t.domElement.ownerDocument.addEventListener("pointermove",Ie),t.domElement.ownerDocument.addEventListener("pointerup",be),t.dispatchEvent(a))}function li(ye){if(t.enabled!==!1)switch(ye.preventDefault(),v){case f.ROTATE:if(t.enableRotate===!1)return;Bt(ye);break;case f.DOLLY:if(t.enableZoom===!1)return;Yt(ye);break;case f.PAN:if(t.enablePan===!1)return;Wi(ye);break}}function ze(ye){t.domElement.ownerDocument.removeEventListener("pointermove",Ie),t.domElement.ownerDocument.removeEventListener("pointerup",be),t.enabled!==!1&&(t.dispatchEvent(i),v=f.NONE)}function te(ye){t.enabled===!1||t.enableZoom===!1||v!==f.NONE&&v!==f.ROTATE||(ye.preventDefault(),ye.stopPropagation(),t.dispatchEvent(a),ei(ye),t.dispatchEvent(i))}function he(ye){t.enabled===!1||t.enablePan===!1||vi(ye)}function Se(ye){if(t.enabled!==!1){switch(ye.preventDefault(),ye.touches.length){case 1:switch(t.touches.ONE){case Pl.ROTATE:if(t.enableRotate===!1)return;Pi(ye),v=f.TOUCH_ROTATE;break;case Pl.PAN:if(t.enablePan===!1)return;Fi(ye),v=f.TOUCH_PAN;break;default:v=f.NONE}break;case 2:switch(t.touches.TWO){case Pl.DOLLY_PAN:if(t.enableZoom===!1&&t.enablePan===!1)return;br(ye),v=f.TOUCH_DOLLY_PAN;break;case Pl.DOLLY_ROTATE:if(t.enableZoom===!1&&t.enableRotate===!1)return;Ui(ye),v=f.TOUCH_DOLLY_ROTATE;break;default:v=f.NONE}break;default:v=f.NONE}v!==f.NONE&&t.dispatchEvent(a)}}function He(ye){if(t.enabled!==!1)switch(ye.preventDefault(),ye.stopPropagation(),v){case f.TOUCH_ROTATE:if(t.enableRotate===!1)return;st(ye),t.update();break;case f.TOUCH_PAN:if(t.enablePan===!1)return;$r(ye),t.update();break;case f.TOUCH_DOLLY_PAN:if(t.enableZoom===!1&&t.enablePan===!1)return;yn(ye),t.update();break;case f.TOUCH_DOLLY_ROTATE:if(t.enableZoom===!1&&t.enableRotate===!1)return;Qi(ye),t.update();break;default:v=f.NONE}}function Ye(ye){t.enabled!==!1&&(t.dispatchEvent(i),v=f.NONE)}function at(ye){t.enabled!==!1&&ye.preventDefault()}t.domElement.addEventListener("contextmenu",at),t.domElement.addEventListener("pointerdown",Fn),t.domElement.addEventListener("wheel",te),t.domElement.addEventListener("touchstart",Se),t.domElement.addEventListener("touchend",Ye),t.domElement.addEventListener("touchmove",He),this.update()};Ef.prototype=Object.create(oc.prototype);Ef.prototype.constructor=Ef;var N9=function(o,e){Ef.call(this,o,e),this.screenSpacePanning=!1,this.mouseButtons.LEFT=Il.PAN,this.mouseButtons.RIGHT=Il.ROTATE,this.touches.ONE=Pl.PAN,this.touches.TWO=Pl.DOLLY_ROTATE};N9.prototype=Object.create(oc.prototype);N9.prototype.constructor=N9;var yy=Object.freeze({INFO:"info",WARN:"warn",ERROR:"error"}),Td=class o{constructor(e,t=null){this.domContainer=e,this.options=Object.create(o.DefaultOptions),t&&Object.assign(this.options,t),t=this.options,this.clearColor=this.options.clearColor.getHex(),this.scene=new v6;try{this.renderer=new Jg({alpha:t.canvasAlpha,premultipliedAlpha:t.canvasPremultipliedAlpha,antialias:t.antialias,depth:!1,preserveDrawingBuffer:t.preserveDrawingBuffer})}catch(i){console.log("Failed to create renderer: "+i),this.renderer=null;return}let s=this.renderer;s.sortObjects=!1,s.setPixelRatio(window.devicePixelRatio);let a=this.camera=new Yg(-1,1,1,-1,.1,2);a.position.z=1,a.position.x=0,a.position.y=0,this.simpleColorMaterial=[],this.simplePointMaterial=[];for(let i=0;i<ba.MAX;i++)this.simpleColorMaterial[i]=this._CreateSimpleColorMaterial(i),this.simplePointMaterial[i]=this._CreateSimplePointMaterial(i);s.setClearColor(t.clearColor,t.clearAlpha),t.autoResize?(this.canvasWidth=e.clientWidth,this.canvasHeight=e.clientHeight,e.style.position="relative"):(this.canvasWidth=t.canvasWidth,this.canvasHeight=t.canvasHeight,this.resizeObserver=null),s.setSize(this.canvasWidth,this.canvasHeight),this.canvas=s.domElement,e.style.display="block",t.autoResize&&(this.canvas.style.position="absolute",this.resizeObserver=new ResizeObserver(i=>this._OnResize(i[0])),this.resizeObserver.observe(e)),e.appendChild(this.canvas),this.canvas.addEventListener("pointerdown",this._OnPointerEvent.bind(this)),this.canvas.addEventListener("pointerup",this._OnPointerEvent.bind(this)),this.Render(),this.materials=new Y6((i,f)=>i.key.Compare(f.key)),this.layers=new Map,this.blocks=new Map,this.worker=null}HasRenderer(){return!!this.renderer}GetRenderer(){return this.renderer}GetCanvas(){return this.canvas}GetDxf(){return this.parsedDxf}SetSize(e,t){this._EnsureRenderer();let s=e/this.canvasWidth,a=t/this.canvasHeight,i=this.camera,f=(i.left+i.right)/2,v=(i.bottom+i.top)/2,x=i.right-i.left,M=i.top-i.bottom;i.left=f-s*x/2,i.right=f+s*x/2,i.bottom=v-a*M/2,i.top=v+a*M/2,i.updateProjectionMatrix(),this.canvasWidth=e,this.canvasHeight=t,this.renderer.setSize(e,t),this.controls&&this.controls.update(),this._Emit("resized",{width:e,height:t}),this._Emit("viewChanged"),this.Render()}Load(i){return yr(this,arguments,function*({url:e,fonts:t=null,progressCbk:s=null,workerFactory:a=null}){if(e==null)throw new Error("`url` parameter is not specified");this._EnsureRenderer(),this.Clear(),this.worker=new O9(a?a():null);let{scene:f,dxf:v}=yield this.worker.Load(e,t,this.options,s);yield this.worker.Destroy(),this.worker=null,this.parsedDxf=v,this.origin=f.origin,this.bounds=f.bounds,this.hasMissingChars=f.hasMissingChars;for(let x of f.layers)this.layers.set(x.name,new U9(x.name,x.displayName,x.color));for(let x of f.batches)if(x.key.blockName!==null&&x.key.geometryType!==sr.GeometryType.BLOCK_INSTANCE&&x.key.geometryType!==sr.GeometryType.POINT_INSTANCE){let M=this.blocks.get(x.key.blockName);M||(M=new V9,this.blocks.set(x.key.blockName,M)),M.PushBatch(new vy(this,f,x))}console.log(`DXF scene:
                     ${f.batches.length} batches,
                     ${this.layers.size} layers,
                     ${this.blocks.size} blocks,
                     vertices ${f.vertices.byteLength} B,
                     indices ${f.indices.byteLength} B
                     transforms ${f.transforms.byteLength} B`);for(let x of f.batches)this._LoadBatch(f,x);this._Emit("loaded"),f.bounds?this.FitView(f.bounds.minX-f.origin.x,f.bounds.maxX-f.origin.x,f.bounds.minY-f.origin.y,f.bounds.maxY-f.origin.y):this._Message("Empty document",yy.WARN),this.hasMissingChars&&this._Message("Some characters cannot be properly displayed due to missing fonts",yy.WARN),this._CreateControls(),this.Render()})}Render(){this._EnsureRenderer(),this.renderer.render(this.scene,this.camera)}GetLayers(){let e=[];for(let t of this.layers.values())e.push({name:t.name,displayName:t.displayName,color:this._TransformColor(t.color)});return e}ShowLayer(e,t){this._EnsureRenderer();let s=this.layers.get(e);if(s){for(let a of s.objects)a.visible=t;this.Render()}}Clear(){this._EnsureRenderer(),this.worker&&(this.worker.Destroy(!0),this.worker=null),this.controls&&(this.controls.dispose(),this.controls=null),this.scene.clear();for(let e of this.layers.values())e.Dispose();this.layers.clear(),this.blocks.clear(),this.materials.each(e=>e.material.dispose()),this.materials.clear(),this.SetView({x:0,y:0},2),this._Emit("cleared"),this.Render()}Destroy(){if(this.HasRenderer()){this.resizeObserver&&this.resizeObserver.disconnect(),this.Clear(),this._Emit("destroyed");for(let e of this.simplePointMaterial)e.dispose();for(let e of this.simpleColorMaterial)e.dispose();this.simplePointMaterial=null,this.simpleColorMaterial=null,this.renderer.dispose(),this.renderer=null}}SetView(e,t){let s=this.canvasWidth/this.canvasHeight,a=t/s,i=this.camera;i.left=-t/2,i.right=t/2,i.top=a/2,i.bottom=-a/2,i.zoom=1,i.position.set(e.x,e.y,1),i.rotation.set(0,0,0),i.updateMatrix(),i.updateProjectionMatrix(),this._Emit("viewChanged")}FitView(e,t,s,a,i=.1){let f=this.canvasWidth/this.canvasHeight,v=t-e,x=a-s,M={x:e+v/2,y:s+x/2};x*f>v&&(v=x*f),v<=Number.MIN_VALUE*2&&(v=1),this.SetView(M,v*(1+i))}GetScene(){return this.scene}GetCamera(){return this.camera}GetOrigin(){return this.origin}GetBounds(){return this.bounds}Subscribe(e,t){this._EnsureRenderer(),this.canvas.addEventListener(z9+e,t)}Unsubscribe(e,t){this._EnsureRenderer(),this.canvas.removeEventListener(z9+e,t)}_EnsureRenderer(){if(!this.HasRenderer())throw new Error("WebGL renderer not available. Probable WebGL context loss, try refreshing the page.")}_CreateControls(){let e=this.controls=new Ef(this.camera,this.canvas);e.enableRotate=!1,e.mouseButtons={LEFT:Il.PAN,MIDDLE:Il.DOLLY},e.touches={ONE:Pl.PAN,TWO:Pl.DOLLY_PAN},e.zoomSpeed=3,e.mouseZoomSpeedFactor=.05,e.target=new mt(this.camera.position.x,this.camera.position.y,0),e.addEventListener("change",()=>{this._Emit("viewChanged"),this.Render()}),e.update()}_Emit(e,t=null){this.canvas.dispatchEvent(new CustomEvent(z9+e,{detail:t}))}_Message(e,t=yy.INFO){this._Emit("message",{message:e,level:t})}_OnPointerEvent(e){let t=e.target.getBoundingClientRect(),s={x:e.clientX-t.left,y:e.clientY-t.top};this._Emit(e.type,{domEvent:e,canvasCoord:s,position:this._CanvasToSceneCoord(s.x,s.y)})}_CanvasToSceneCoord(e,t){let s=new mt(e*2/this.canvasWidth-1,-t*2/this.canvasHeight+1,1).unproject(this.camera);return{x:s.x,y:s.y}}_OnResize(e){this.SetSize(Math.floor(e.contentRect.width),Math.floor(e.contentRect.height))}_LoadBatch(e,t){if(t.key.blockName!==null&&t.key.geometryType!==sr.GeometryType.BLOCK_INSTANCE&&t.key.geometryType!==sr.GeometryType.POINT_INSTANCE)return;let s=new vy(this,e,t).CreateObjects(),a=this.layers.get(t.key.layerName);for(let i of s)this.scene.add(i),a&&a.PushObject(i)}_GetSimpleColorMaterial(e,t=ba.NONE){let s=new b_(t,null,e,0),a=this.materials.find({key:s});return a!==null||(a={key:s,material:this._CreateSimpleColorMaterialInstance(e,t)},this.materials.insert(a)),a.material}_CreateSimpleColorMaterial(e=ba.NONE){let t=this._GenerateShaders(e,!1);return new Qg({uniforms:{color:{value:new Er(16711935)}},vertexShader:t.vertex,fragmentShader:t.fragment,depthTest:!1,depthWrite:!1,glslVersion:Xg,side:ic})}_CreateSimpleColorMaterialInstance(e,t=ba.NONE){let a=this.simpleColorMaterial[t].clone();return a.uniforms.color={value:new Er(e)},a}_GetSimplePointMaterial(e,t=ba.NONE){let s=new b_(t,sr.GeometryType.POINTS,e,0),a=this.materials.find({key:s});return a!==null||(a={key:s,material:this._CreateSimplePointMaterialInstance(e,this.options.pointSize,t)},this.materials.insert(a)),a.material}_CreateSimplePointMaterial(e=ba.NONE){let t=this._GenerateShaders(e,!0);return new Qg({uniforms:{color:{value:new Er(16711935)},pointSize:{value:2}},vertexShader:t.vertex,fragmentShader:t.fragment,depthTest:!1,depthWrite:!1,glslVersion:Xg})}_CreateSimplePointMaterialInstance(e,t=2,s=ba.NONE){let i=this.simplePointMaterial[s].clone();return i.uniforms.color={value:new Er(e)},i.uniforms.size={value:t},i}_GenerateShaders(e,t){let s=e===ba.FULL?`
            /* First row. */
            in vec3 instanceTransform0;
            /* Second row. */
            in vec3 instanceTransform1;
            `:"",a=e===ba.FULL?`
            pos.xy = mat2(instanceTransform0[0], instanceTransform1[0],
                          instanceTransform0[1], instanceTransform1[1]) * pos.xy +
                     vec2(instanceTransform0[2], instanceTransform1[2]);
            `:"",i=e===ba.POINT?`
            in vec2 instanceTransform;
            `:"",f=e===ba.POINT?`
            pos.xy += instanceTransform;
            `:"";return{vertex:`

            precision highp float;
            precision highp int;
            in vec2 position;
            ${s}
            ${i}
            uniform mat4 modelViewMatrix;
            uniform mat4 projectionMatrix;
            ${t?"uniform float pointSize;":""}

            void main() {
                vec4 pos = vec4(position, 0.0, 1.0);
                ${a}
                ${f}
                gl_Position = projectionMatrix * modelViewMatrix * pos;
                ${t?"gl_PointSize = pointSize;":""}
            }
            `,fragment:`

            precision highp float;
            precision highp int;
            uniform vec3 color;
            out vec4 fragColor;

            void main() {
                fragColor = vec4(color, 1.0);
            }
            `}}_TransformColor(e){if(!this.options.colorCorrection&&!this.options.blackWhiteInversion)return e;let t=xy(this.clearColor);if(e===16777215&&t>=.8)return 0;if(e===0&&t<=.2)return 16777215;if(!this.options.colorCorrection)return e;let s=xy(e),a=1.5,i=Ree(e,this.clearColor);if((i>=1?i:1/i)<a){let v;t>.5?v=t/2:v=t*2,v>s?e=kee(e,v/s):e=Dee(e,s/v)}return e}};Td.MessageLevel=yy;Td.DefaultOptions={canvasWidth:400,canvasHeight:300,autoResize:!1,clearColor:new Er("#000"),clearAlpha:1,canvasAlpha:!1,canvasPremultipliedAlpha:!0,antialias:!0,colorCorrection:!1,blackWhiteInversion:!0,pointSize:2,sceneOptions:tp.DefaultOptions,retainParsedDxf:!1,preserveDrawingBuffer:!1,fileEncoding:"utf-8"};Td.SetupWorker=function(){new O9(self,!0)};var ba=Object.freeze({NONE:0,FULL:1,POINT:2,MAX:3}),vy=class{constructor(e,t,s){if(this.viewer=e,this.key=s.key,s.hasOwnProperty("verticesOffset")){let a=new Float32Array(t.vertices,s.verticesOffset*Float32Array.BYTES_PER_ELEMENT,s.verticesSize);(this.key.geometryType!==sr.GeometryType.POINT_INSTANCE||t.pointShapeHasDot)&&(this.vertices=new Ro(a,2)),this.key.geometryType===sr.GeometryType.POINT_INSTANCE&&(this.transforms=new x6(a,2))}if(s.hasOwnProperty("chunks")){this.chunks=[];for(let a of s.chunks){let i=new Float32Array(t.vertices,a.verticesOffset*Float32Array.BYTES_PER_ELEMENT,a.verticesSize),f=new Uint16Array(t.indices,a.indicesOffset*Uint16Array.BYTES_PER_ELEMENT,a.indicesSize);this.chunks.push({vertices:new Ro(i,2),indices:new Ro(f,1)})}}if(s.hasOwnProperty("transformsOffset")){let a=new Float32Array(t.transforms,s.transformsOffset*Float32Array.BYTES_PER_ELEMENT,s.transformsSize),i=new T6(a,6);this.transforms0=new Kg(i,3,0),this.transforms1=new Kg(i,3,3)}if(this.key.geometryType===sr.GeometryType.BLOCK_INSTANCE||this.key.geometryType===sr.GeometryType.POINT_INSTANCE){let a=this.viewer.layers.get(this.key.layerName);a?this.layerColor=a.color:this.layerColor=0}}GetInstanceType(){switch(this.key.geometryType){case sr.GeometryType.BLOCK_INSTANCE:return ba.FULL;case sr.GeometryType.POINT_INSTANCE:return ba.POINT;default:return ba.NONE}}*CreateObjects(e=null){if(this.key.geometryType===sr.GeometryType.BLOCK_INSTANCE||this.key.geometryType===sr.GeometryType.POINT_INSTANCE){if(e!==null)throw new Error("Unexpected instance batch specified for instance batch");yield*ws(this._CreateBlockInstanceObjects());return}yield*ws(this._CreateObjects(e))}*_CreateObjects(e){let t=e?e._GetInstanceColor(this.key.color):this.key.color,a=(this.key.geometryType===sr.GeometryType.POINTS||this.key.geometryType===sr.GeometryType.POINT_INSTANCE?this.viewer._GetSimplePointMaterial:this.viewer._GetSimpleColorMaterial).call(this.viewer,this.viewer._TransformColor(t),e?.GetInstanceType()??ba.NONE),i;switch(this.key.geometryType){case sr.GeometryType.POINTS:case sr.GeometryType.POINT_INSTANCE:i=w6;break;case sr.GeometryType.LINES:case sr.GeometryType.INDEXED_LINES:i=b6;break;case sr.GeometryType.TRIANGLES:case sr.GeometryType.INDEXED_TRIANGLES:i=dl;break;default:throw new Error("Unexpected geometry type:"+this.key.geometryType)}function f(v,x){let M=e?new S6:new Cl;M.setAttribute("position",v),e?._SetInstanceTransformAttribute(M),x&&M.setIndex(x);let C=new i(M,a);return C.frustumCulled=!1,C.matrixAutoUpdate=!1,C}if(this.chunks)for(let v of this.chunks)yield f(v.vertices,v.indices);else yield f(this.vertices)}_SetInstanceTransformAttribute(e){if(!e.isInstancedBufferGeometry)throw new Error("InstancedBufferGeometry expected");this.key.geometryType===sr.GeometryType.POINT_INSTANCE?e.setAttribute("instanceTransform",this.transforms):(e.setAttribute("instanceTransform0",this.transforms0),e.setAttribute("instanceTransform1",this.transforms1))}*_CreateBlockInstanceObjects(){let e=this.viewer.blocks.get(this.key.blockName);if(e){for(let t of e.batches)yield*ws(t.CreateObjects(this));this.hasOwnProperty("vertices")&&(yield*ws(this._CreateObjects()))}}_GetInstanceColor(e){return e===fl.BY_BLOCK?this.key.color:e===fl.BY_LAYER?this.layerColor:e}},U9=class{constructor(e,t,s){this.name=e,this.displayName=t,this.color=s,this.objects=[]}PushObject(e){this.objects.push(e)}Dispose(){for(let e of this.objects)e.geometry.dispose();this.objects=null}},V9=class{constructor(){this.batches=[]}PushBatch(e){this.batches.push(e)}},z9="__dxf_";function Af(o){return o<=.03928?o/12.92:Math.pow((o+.055)/1.055,2.4)}function B9(o){return o<.003?o*12.92:Math.pow(o,1/2.4)*1.055-.055}function xy(o){let e=Af(((o&16711680)>>>16)/255),t=Af(((o&65280)>>>8)/255),s=Af((o&255)/255);return e*.2126+t*.7152+s*.0722}function Ree(o,e){return(xy(o)+.05)/(xy(e)+.05)}function jD({h:o,l:e,s:t}){let s,a,i;if(t===0)s=a=i=e;else{let v=function(C,D,L){return L<0&&(L+=1),L>1&&(L-=1),L<1/6?C+(D-C)*6*L:L<1/2?D:L<2/3?C+(D-C)*(2/3-L)*6:C};var f=v;let x=e<.5?e*(1+t):e+t-e*t,M=2*e-x;s=v(M,x,o+1/3),a=v(M,x,o),i=v(M,x,o-1/3)}return Math.min(Math.floor(B9(s)*256),255)<<16|Math.min(Math.floor(B9(a)*256),255)<<8|Math.min(Math.floor(B9(i)*256),255)}function WD(o){let e=Af(((o&16711680)>>>16)/255),t=Af(((o&65280)>>>8)/255),s=Af((o&255)/255),a=Math.max(e,t,s),i=Math.min(e,t,s),f,v,x=(a+i)/2;if(a===i)f=v=0;else{let M=a-i;switch(v=x>.5?M/(2-a-i):M/(a+i),a){case e:f=(t-s)/M+(t<s?6:0);break;case t:f=(s-e)/M+2;break;case s:f=(e-t)/M+4;break}f/=6}return{h:f,l:x,s:v}}function kee(o,e){let t=WD(o);return t.l*=e,t.l>1&&(t.l=1),jD(t)}function Dee(o,e){let t=WD(o);return t.l/=e,jD(t)}var qD=(()=>{let e=class e{constructor(){this._theme=ai(Xc),this._viewerOptions=new vg,this._loadedFiles=[]}ngOnDestroy(){this._dxfViewer?.Destroy(),this._loadedFiles=[]}set viewerOptions(s){let a=this._theme.darkMode();s.clearColor=a?new U2("black"):new U2("white"),this._viewerOptions=s}set canvas(s){this._canvas=s}buildViewer(){if(this._canvas===void 0){console.error("Canvas not set");return}this._dxfViewer=new Td(this._canvas,this._viewerOptions)}resize(s){this._dxfViewer!=null&&(this._dxfViewer.SetSize(s.width,s.height),this._dxfViewer.Render())}getLayers(){if(this._dxfViewer==null)return[];let s=[];for(let a of this._dxfViewer.GetLayers()){let i={name:a.name,displayName:a.displayName,color:this.getCssColor(a.color),checked:!0,toggleCheck:()=>{i.checked=!i.checked,this._dxfViewer?.ShowLayer(i.name,i.checked)}};s.push(i)}return s}load(s,a,i){return yr(this,null,function*(){this._dxfViewer!=null&&(yield this._dxfViewer.Load({url:s,fonts:a,progressCbk:i?.bind(this),workerFactory:null}),this._loadedFiles.push({url:s,fonts:a}))})}getCssColor(s){if(s===void 0)return"red";let a=s.toString(16);for(;a.length<6;)a="0"+a;return"#"+a}};e.\u0275fac=function(a){return new(a||e)},e.\u0275prov=jr({token:e,factory:e.\u0275fac,providedIn:"root"});let o=e;return o})();function Lee(o,e){if(o&1){let t=vr();xt(0,"div",6)(1,"input",7),zi("change",function(){let i=Pn(t).$implicit,f=di(2);return Rn(f.toggleLayer(i))}),It(),Bi(2),Ln(3,"div",9),It()}if(o&2){let t=e.$implicit;Ct(),si("checked",t.checked),Ct(),xs(" ",t.displayName," "),Ct(),ca("background-color",t.color)}}function Fee(o,e){if(o&1){let t=vr();xt(0,"div",1)(1,"div",2)(2,"div",3)(3,"span"),Bi(4,"Layers"),It(),xt(5,"button",4),zi("click",function(){Pn(t);let a=di();return Rn(a.toggleVisibility())}),xt(6,"mat-icon"),Bi(7,"close"),It()()(),xt(8,"div",5)(9,"div",6)(10,"input",7),zi("change",function(){Pn(t);let a=di();return Rn(a.toggleAll())}),It()(),ln(11,Lee,4,4,"div",8),It()()()}if(o&2){let t=di();Ct(10),si("checked",t.allLayersOn),Ct(),si("ngForOf",t.layers)}}var G9=(()=>{let e=class e{constructor(){this.visible=!0,this.layers=[],this.allLayersOn=!0}toggleVisibility(){this.visible=!this.visible}toggleLayer(s){s.toggleCheck(),this.allLayersOn&&(this.allLayersOn=!1)}toggleAll(){this.allLayersOn?(this.layers.forEach(s=>{s.checked&&s.toggleCheck()}),this.allLayersOn=!1):(this.layers.forEach(s=>{s.checked||s.toggleCheck()}),this.allLayersOn=!0)}};e.\u0275fac=function(a){return new(a||e)},e.\u0275cmp=$i({type:e,selectors:[["lib-layers"]],inputs:{visible:"visible",layers:"layers"},standalone:!0,features:[Yi],decls:1,vars:1,consts:[["class","container","cdkDrag","","cdkDragBoundary",".bim-viewer-container",4,"ngIf"],["cdkDrag","","cdkDragBoundary",".bim-viewer-container",1,"container"],[1,"menu"],["cdkDragHandle","",1,"top-bar"],["mat-icon-button","","mat-small-icon-button","","aria-label","Close menu",3,"click"],[1,"scroll-zone"],[1,"item"],["type","checkbox",3,"checked","change"],["class","item",4,"ngFor","ngForOf"],[1,"color-box"]],template:function(a,i){a&1&&ln(0,Fee,12,2,"div",0),a&2&&si("ngIf",i.visible)},dependencies:[_r,E5,Ds,Eo,Na,ho,Hh,bI,_3,xI],styles:[".container[_ngcontent-%COMP%]{position:absolute;top:10px;left:10px;max-height:400px;max-width:50vw;min-width:200px;z-index:10;background-color:#353535cc;border-radius:5px}.menu[_ngcontent-%COMP%]{display:flex;flex-direction:column;color:#fff;height:100%;gap:10px;padding:10px}.top-bar[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;align-items:center;font-size:1em;font-weight:600;cursor:move}.category[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2px}.scroll-zone[_ngcontent-%COMP%]{max-height:300px;overflow-y:auto}.doc[_ngcontent-%COMP%]{font-size:.8em}.doc[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:1em}.header[_ngcontent-%COMP%]{font-size:.8em;font-weight:500}.item[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;gap:5px}.menu[_ngcontent-%COMP%]{display:flex;flex-direction:column;color:#fff;background-color:#353535e6;gap:10px;padding:10px;border-radius:5px}input[_ngcontent-%COMP%]{border:1px solid white;background-color:#555;padding:3px;color:#fff}.color-box[_ngcontent-%COMP%]{height:12px;width:12px;border:1px solid #fff;border-radius:5px}"]});let o=e;return o})();function Oee(o,e){if(o&1){let t=vr();xt(0,"mat-icon",5),zi("click",function(){let i=Pn(t).$implicit,f=di(2);return Rn(f.handleItemClick(i))}),Bi(1),It()}if(o&2){let t=e.$implicit,s=di(2);si("matTooltip",t.text)("matTooltipPosition",s.settings.foldDirection==="UP"?"above":"below"),Ct(),xs(" ",t.icon," ")}}function Nee(o,e){if(o&1&&(xt(0,"div",3),ln(1,Oee,2,3,"mat-icon",4),It()),o&2){let t=e.$implicit;Ct(),si("ngForOf",t.groupItems)}}var XD=(()=>{let e=class e{constructor(){this.settings=new L1}handleItemClick(s){s.subItems?.length||s.callback()}};e.\u0275fac=function(a){return new(a||e)},e.\u0275cmp=$i({type:e,selectors:[["lib-icon-menu"]],inputs:{settings:"settings"},standalone:!0,features:[Yi],decls:3,vars:1,consts:[[1,"container"],[1,"menu-container"],["class","group-container",4,"ngFor","ngForOf"],[1,"group-container"],["class","btn",3,"matTooltip","matTooltipPosition","click",4,"ngFor","ngForOf"],[1,"btn",3,"matTooltip","matTooltipPosition","click"]],template:function(a,i){a&1&&(xt(0,"div",0)(1,"div",1),ln(2,Nee,2,1,"div",2),It()()),a&2&&(Ct(2),si("ngForOf",i.settings.menuGroups))},dependencies:[_r,E5,Eo,Na,Hc,jh],encapsulation:2});let o=e;return o})();var zee=["canvas"];function Bee(o,e){if(o&1&&Ln(0,"lib-icon-menu",4),o&2){let t=di();si("settings",t.menuSettings)}}var ZD=(()=>{let e=class e{constructor(){this._service=ai(qD),this._cdref=ai(ts),this.settings=new x3,this._viewerReady=new Promise(s=>{this._viewerReadyPromiseResolve=s}),this.isLoading=!1,this.loadingMessage="",this.layers=[],this.layersMenuOpen=!1}set content(s){if(s){let a=s.nativeElement;this._service.canvas=a,this._service.viewerOptions=this.settings.viewerOptions,this._service.buildViewer(),this._viewerReadyPromiseResolve()}}ngOnInit(){this.menuSettings=this.buildMenu()}ngOnChanges(s){return yr(this,null,function*(){s.settings&&(this._service.viewerOptions=this.settings.viewerOptions),this.fileURL!==void 0&&(yield this.loadFile(this.fileURL))})}buildMenu(){let s=new L1,a=new b3("visibility");s.menuGroups=[a];let i=new w3("Show layers","layers",()=>{this.layersComponent.toggleVisibility()});return a.groupItems=[i],s}loadFile(s){return yr(this,null,function*(){yield this._viewerReadyPromiseResolve(),this.isLoading=!0,this._cdref.detectChanges();try{this._service.load(s,this.settings.fonts)}catch(a){console.warn(a)}finally{this.isLoading=!1}this.layers=this._service.getLayers()})}trackProgress(s){switch(s){case"font":this.loadingMessage="Fetching fonts...";break;case"fetch":this.loadingMessage="Fetching file...";break;case"parse":this.loadingMessage="Parsing file...";break;case"prepare":this.loadingMessage="Preparing rendering data...";break}this._cdref.detectChanges()}onResized(s){this._service.resize(s.newRect)}};e.\u0275fac=function(a){return new(a||e)},e.\u0275cmp=$i({type:e,selectors:[["lib-dxf-viewer"]],viewQuery:function(a,i){if(a&1&&(Br(zee,5),Br(G9,5)),a&2){let f;Nn(f=zn())&&(i.content=f.first),Nn(f=zn())&&(i.layersComponent=f.first)}},inputs:{fileURL:"fileURL",settings:"settings"},standalone:!0,features:[Ms,Yi],decls:4,vars:5,consts:[["libLoadingOverlay","","libResized","",1,"canvas",3,"displayLoading","loadingMessage","resized"],["canvas",""],["class","menu",3,"settings",4,"ngIf"],[3,"layers","visible"],[1,"menu",3,"settings"]],template:function(a,i){a&1&&(xt(0,"div",0,1),zi("resized",function(v){return i.onResized(v)}),It(),ln(2,Bee,1,1,"lib-icon-menu",2),Ln(3,"lib-layers",3)),a&2&&(si("displayLoading",i.isLoading)("loadingMessage",i.loadingMessage),Ct(2),si("ngIf",i.menuSettings),Ct(),si("layers",i.layers)("visible",i.layersMenuOpen))},dependencies:[_r,Ds,zI,BI,G9,XD],styles:[".canvas[_ngcontent-%COMP%]{overflow:hidden;width:100%;height:100%}.menu[_ngcontent-%COMP%]{position:absolute;bottom:20px;left:50%;right:50%}"]});let o=e;return o})();function Uee(o,e){if(o&1){let t=vr();xt(0,"mat-list-item")(1,"button",2),zi("click",function(){let i=Pn(t).$implicit;return Rn(i.click())}),Bi(2),It()()}if(o&2){let t=e.$implicit,s;Ct(),si("matTooltip",(s=t.description)!==null&&s!==void 0?s:""),Ct(),xs(" ",t.label," ")}}function Vee(o,e){if(o&1){let t=vr();xt(0,"mat-list-item")(1,"button",2),zi("click",function(){let i=Pn(t).$implicit;return Rn(i.click())}),Bi(2),It()()}if(o&2){let t=e.$implicit,s;Ct(),si("matTooltip",(s=t.description)!==null&&s!==void 0?s:""),Ct(),xs(" ",t.label," ")}}function Gee(o,e){if(o&1){let t=vr();xt(0,"mat-list-item")(1,"button",2),zi("click",function(){let i=Pn(t).$implicit;return Rn(i.click())}),Bi(2),It()()}if(o&2){let t=e.$implicit,s;Ct(),si("matTooltip",(s=t.description)!==null&&s!==void 0?s:""),Ct(),xs(" ",t.label," ")}}var $D=(()=>{let e=class e{constructor(){this._translationService=ai(Gc),this._resultService=ai(za),this.cadOptions=[],this.gisOptions=[],this.mappingOptions=[],this.txt=this._translationService.translatedContent,this.results=this._resultService.results,wl(()=>{this._resultService.resultsUpdated(),this._update()})}_update(){this.cadOptions=[],this.gisOptions=[],this.results().subsetDXF&&(this.cadOptions.push({label:this.txt().downloadSelectionGeoJSON,description:this.txt().downloadSelectionGeoJSONTooltip,click:()=>this._resultService.downloadSelectedDXFAsGeoJSON()}),this.cadOptions.push({label:this.txt().downloadSelectionDXF,description:this.txt().downloadSelectionDXFTooltip,click:()=>this._resultService.downloadSubsetDXF()}),this.cadOptions.push({label:this.txt().downloadDXFSubsetRDF,description:this.txt().downloadDXFSubsetRDFTooltip,click:()=>this._resultService.downloadDXFSubsetRDF()})),this.results().fullDXF&&this.cadOptions.push({label:this.txt().downloadDXFTextsRDF,description:this.txt().downloadDXFTextsRDFTooltip,click:()=>this._resultService.downloadDXFTextsRDF()}),this.results().gisFeatures&&this.gisOptions.push({label:this.txt().gisToRDFDownload,description:this.txt().gisToRDFDownloadTooltip,click:()=>this._resultService.downloadGISAsRDF()}),this.results().pairingResults&&(this.mappingOptions.push({label:this.txt().downloadMappings,description:this.txt().downloadMappingsTooltip,click:()=>this._resultService.downloadMappings()}),this.mappingOptions.push({label:this.txt().downloadUnmappable,description:this.txt().downloadUnmappableTooltip,click:()=>this._resultService.downloadUnmapped()}))}};e.\u0275fac=function(a){return new(a||e)},e.\u0275cmp=$i({type:e,selectors:[["app-result-exporter"]],standalone:!0,features:[Yi],decls:16,vars:3,consts:[[1,"col"],["mat-subheader",""],["mat-stroked-button","",2,"width","100%",3,"matTooltip","click"]],template:function(a,i){a&1&&(xt(0,"div",0)(1,"mat-list")(2,"div",1),Bi(3),It(),Js(4,Uee,3,2,"mat-list-item",null,Ko),Ln(6,"mat-divider"),xt(7,"div",1),Bi(8),It(),Js(9,Vee,3,2,"mat-list-item",null,Ko),Ln(11,"mat-divider"),xt(12,"div",1),Bi(13),It(),Js(14,Gee,3,2,"mat-list-item",null,Ko),It()()),a&2&&(Ct(3),Or(i.txt().gis),Ct(),Ks(i.gisOptions),Ct(4),Or(i.txt().cad),Ct(),Ks(i.cadOptions),Ct(4),Or(i.txt().mapping),Ct(),Ks(i.mappingOptions))},dependencies:[_r,ho,Vc,s3,uC,pC,fC,lC,Hc,jh]});let o=e;return o})();function Hee(o,e){if(o&1&&(xt(0,"div",3)(1,"span"),Bi(2),It()()),o&2){let t=di(2);Ct(2),Or(t.txt().initialInstructions)}}function jee(o,e){if(o&1){let t=vr();xt(0,"button",5),zi("click",function(){Pn(t);let a=di(2);return Rn(a.uploadDXF())}),xt(1,"mat-icon"),Bi(2,"upload"),It(),Bi(3),It()}if(o&2){let t=di(2);si("matTooltip",t.txt().uploadDXFTooltip),Ct(3),xs(" ",t.txt().uploadDXF," ")}}function Wee(o,e){if(o&1){let t=vr();xt(0,"button",5),zi("click",function(){Pn(t);let a=di(2);return Rn(a.uploadGeoJSON())}),xt(1,"mat-icon"),Bi(2,"upload"),It(),Bi(3),It()}if(o&2){let t=di(2);si("matTooltip",t.txt().uploadGeoJSONTooltip),Ct(3),xs(" ",t.txt().uploadGeoJSON," ")}}function qee(o,e){if(o&1&&(xt(0,"div",1),ln(1,Hee,3,1,"div",2),xt(2,"div",3),ln(3,jee,4,2,"button",4)(4,Wee,4,2,"button",4),It()()),o&2){let t=di();Ct(),si("ngIf",t.pristine()),Ct(2),si("ngIf",!t.dxfLoaded()),Ct(),si("ngIf",!t.geoJSONLoaded())}}var YD=(()=>{let e=class e{constructor(){this._translationService=ai(Gc),this._resultService=ai(za),this.txt=this._translationService.translatedContent,this.dxfLoaded=Yl(()=>this._resultService.resultsUpdated()&&this._resultService.results().fullDXF!==void 0),this.geoJSONLoaded=Yl(()=>this._resultService.resultsUpdated()&&this._resultService.results().gisFeatures!==void 0),this.pristine=Yl(()=>this._resultService.resultsUpdated()&&this._resultService.results().gisFeatures===void 0&&this._resultService.results().fullDXF===void 0)}uploadDXF(){return yr(this,null,function*(){this._resultService.uploadDXF()})}uploadGeoJSON(){return yr(this,null,function*(){yield this._resultService.uploadGeoJSON()})}};e.\u0275fac=function(a){return new(a||e)},e.\u0275cmp=$i({type:e,selectors:[["app-upload"]],standalone:!0,features:[Yi],decls:1,vars:1,consts:[["class","col",4,"ngIf"],[1,"col"],["class","row",4,"ngIf"],[1,"row"],["mat-flat-button","","style","width: 50%",3,"matTooltip","click",4,"ngIf"],["mat-flat-button","",2,"width","50%",3,"matTooltip","click"]],template:function(a,i){a&1&&ln(0,qee,5,3,"div",0),a&2&&si("ngIf",!i.dxfLoaded()||!i.geoJSONLoaded())},dependencies:[_r,Ds,ho,Vc,Hc,jh,Eo,Na],styles:[".row[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;width:100%;gap:10px}.col[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px;padding:20px}"]});let o=e;return o})();var Xee=new Sn("MAT_PROGRESS_BAR_DEFAULT_OPTIONS");var KD=(()=>{let e=class e{constructor(s,a,i,f,v){this._elementRef=s,this._ngZone=a,this._changeDetectorRef=i,this._animationMode=f,this._isNoopAnimation=!1,this._defaultColor="primary",this._value=0,this._bufferValue=0,this.animationEnd=new mn,this._mode="determinate",this._transitionendHandler=x=>{this.animationEnd.observers.length===0||!x.target||!x.target.classList.contains("mdc-linear-progress__primary-bar")||(this.mode==="determinate"||this.mode==="buffer")&&this._ngZone.run(()=>this.animationEnd.next({value:this.value}))},this._isNoopAnimation=f==="NoopAnimations",v&&(v.color&&(this.color=this._defaultColor=v.color),this.mode=v.mode||this.mode)}get color(){return this._color||this._defaultColor}set color(s){this._color=s}get value(){return this._value}set value(s){this._value=JD(s||0),this._changeDetectorRef.markForCheck()}get bufferValue(){return this._bufferValue||0}set bufferValue(s){this._bufferValue=JD(s||0),this._changeDetectorRef.markForCheck()}get mode(){return this._mode}set mode(s){this._mode=s,this._changeDetectorRef.markForCheck()}ngAfterViewInit(){this._ngZone.runOutsideAngular(()=>{this._elementRef.nativeElement.addEventListener("transitionend",this._transitionendHandler)})}ngOnDestroy(){this._elementRef.nativeElement.removeEventListener("transitionend",this._transitionendHandler)}_getPrimaryBarTransform(){return`scaleX(${this._isIndeterminate()?1:this.value/100})`}_getBufferBarFlexBasis(){return`${this.mode==="buffer"?this.bufferValue:100}%`}_isIndeterminate(){return this.mode==="indeterminate"||this.mode==="query"}};e.\u0275fac=function(a){return new(a||e)(Et(Ir),Et(Ur),Et(ts),Et(yo,8),Et(Xee,8))},e.\u0275cmp=$i({type:e,selectors:[["mat-progress-bar"]],hostAttrs:["role","progressbar","aria-valuemin","0","aria-valuemax","100","tabindex","-1",1,"mat-mdc-progress-bar","mdc-linear-progress"],hostVars:10,hostBindings:function(a,i){a&2&&(vs("aria-valuenow",i._isIndeterminate()?null:i.value)("mode",i.mode),wu("mat-"+i.color),Fr("_mat-animation-noopable",i._isNoopAnimation)("mdc-linear-progress--animation-ready",!i._isNoopAnimation)("mdc-linear-progress--indeterminate",i._isIndeterminate()))},inputs:{color:"color",value:[wn.HasDecoratorInputTransform,"value","value",vo],bufferValue:[wn.HasDecoratorInputTransform,"bufferValue","bufferValue",vo],mode:"mode"},outputs:{animationEnd:"animationEnd"},exportAs:["matProgressBar"],standalone:!0,features:[Es,Yi],decls:7,vars:4,consts:[["aria-hidden","true",1,"mdc-linear-progress__buffer"],[1,"mdc-linear-progress__buffer-bar"],[1,"mdc-linear-progress__buffer-dots"],["aria-hidden","true",1,"mdc-linear-progress__bar","mdc-linear-progress__primary-bar"],[1,"mdc-linear-progress__bar-inner"],["aria-hidden","true",1,"mdc-linear-progress__bar","mdc-linear-progress__secondary-bar"]],template:function(a,i){a&1&&(xt(0,"div",0),Ln(1,"div",1)(2,"div",2),It(),xt(3,"div",3),Ln(4,"span",4),It(),xt(5,"div",5),Ln(6,"span",4),It()),a&2&&(Ct(),ca("flex-basis",i._getBufferBarFlexBasis()),Ct(2),ca("transform",i._getPrimaryBarTransform()))},styles:[`@keyframes mdc-linear-progress-primary-indeterminate-translate{0%{transform:translateX(0)}20%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(0)}59.15%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(var(--mdc-linear-progress-primary-half))}100%{transform:translateX(var(--mdc-linear-progress-primary-full))}}@keyframes mdc-linear-progress-primary-indeterminate-scale{0%{transform:scaleX(0.08)}36.65%{animation-timing-function:cubic-bezier(0.334731, 0.12482, 0.785844, 1);transform:scaleX(0.08)}69.15%{animation-timing-function:cubic-bezier(0.06, 0.11, 0.6, 1);transform:scaleX(0.661479)}100%{transform:scaleX(0.08)}}@keyframes mdc-linear-progress-secondary-indeterminate-translate{0%{animation-timing-function:cubic-bezier(0.15, 0, 0.515058, 0.409685);transform:translateX(0)}25%{animation-timing-function:cubic-bezier(0.31033, 0.284058, 0.8, 0.733712);transform:translateX(var(--mdc-linear-progress-secondary-quarter))}48.35%{animation-timing-function:cubic-bezier(0.4, 0.627035, 0.6, 0.902026);transform:translateX(var(--mdc-linear-progress-secondary-half))}100%{transform:translateX(var(--mdc-linear-progress-secondary-full))}}@keyframes mdc-linear-progress-secondary-indeterminate-scale{0%{animation-timing-function:cubic-bezier(0.205028, 0.057051, 0.57661, 0.453971);transform:scaleX(0.08)}19.15%{animation-timing-function:cubic-bezier(0.152313, 0.196432, 0.648374, 1.004315);transform:scaleX(0.457104)}44.15%{animation-timing-function:cubic-bezier(0.257759, -0.003163, 0.211762, 1.38179);transform:scaleX(0.72796)}100%{transform:scaleX(0.08)}}@keyframes mdc-linear-progress-primary-indeterminate-translate-reverse{0%{transform:translateX(0)}20%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(0)}59.15%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(var(--mdc-linear-progress-primary-half-neg))}100%{transform:translateX(var(--mdc-linear-progress-primary-full-neg))}}@keyframes mdc-linear-progress-secondary-indeterminate-translate-reverse{0%{animation-timing-function:cubic-bezier(0.15, 0, 0.515058, 0.409685);transform:translateX(0)}25%{animation-timing-function:cubic-bezier(0.31033, 0.284058, 0.8, 0.733712);transform:translateX(var(--mdc-linear-progress-secondary-quarter-neg))}48.35%{animation-timing-function:cubic-bezier(0.4, 0.627035, 0.6, 0.902026);transform:translateX(var(--mdc-linear-progress-secondary-half-neg))}100%{transform:translateX(var(--mdc-linear-progress-secondary-full-neg))}}@keyframes mdc-linear-progress-buffering-reverse{from{transform:translateX(-10px)}}.mdc-linear-progress{position:relative;width:100%;transform:translateZ(0);outline:1px solid rgba(0,0,0,0);overflow-x:hidden;transition:opacity 250ms 0ms cubic-bezier(0.4, 0, 0.6, 1)}@media screen and (forced-colors: active){.mdc-linear-progress{outline-color:CanvasText}}.mdc-linear-progress__bar{position:absolute;top:0;bottom:0;margin:auto 0;width:100%;animation:none;transform-origin:top left;transition:transform 250ms 0ms cubic-bezier(0.4, 0, 0.6, 1)}.mdc-linear-progress__bar-inner{display:inline-block;position:absolute;width:100%;animation:none;border-top-style:solid}.mdc-linear-progress__buffer{display:flex;position:absolute;top:0;bottom:0;margin:auto 0;width:100%;overflow:hidden}.mdc-linear-progress__buffer-dots{background-repeat:repeat-x;flex:auto;transform:rotate(180deg);-webkit-mask-image:url("data:image/svg+xml,%3Csvg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' enable-background='new 0 0 5 2' xml:space='preserve' viewBox='0 0 5 2' preserveAspectRatio='xMinYMin slice'%3E%3Ccircle cx='1' cy='1' r='1'/%3E%3C/svg%3E");mask-image:url("data:image/svg+xml,%3Csvg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' enable-background='new 0 0 5 2' xml:space='preserve' viewBox='0 0 5 2' preserveAspectRatio='xMinYMin slice'%3E%3Ccircle cx='1' cy='1' r='1'/%3E%3C/svg%3E");animation:mdc-linear-progress-buffering 250ms infinite linear}.mdc-linear-progress__buffer-bar{flex:0 1 100%;transition:flex-basis 250ms 0ms cubic-bezier(0.4, 0, 0.6, 1)}.mdc-linear-progress__primary-bar{transform:scaleX(0)}.mdc-linear-progress__secondary-bar{display:none}.mdc-linear-progress--indeterminate .mdc-linear-progress__bar{transition:none}.mdc-linear-progress--indeterminate .mdc-linear-progress__primary-bar{left:-145.166611%}.mdc-linear-progress--indeterminate .mdc-linear-progress__secondary-bar{left:-54.888891%;display:block}.mdc-linear-progress--indeterminate.mdc-linear-progress--animation-ready .mdc-linear-progress__primary-bar{animation:mdc-linear-progress-primary-indeterminate-translate 2s infinite linear}.mdc-linear-progress--indeterminate.mdc-linear-progress--animation-ready .mdc-linear-progress__primary-bar>.mdc-linear-progress__bar-inner{animation:mdc-linear-progress-primary-indeterminate-scale 2s infinite linear}.mdc-linear-progress--indeterminate.mdc-linear-progress--animation-ready .mdc-linear-progress__secondary-bar{animation:mdc-linear-progress-secondary-indeterminate-translate 2s infinite linear}.mdc-linear-progress--indeterminate.mdc-linear-progress--animation-ready .mdc-linear-progress__secondary-bar>.mdc-linear-progress__bar-inner{animation:mdc-linear-progress-secondary-indeterminate-scale 2s infinite linear}[dir=rtl] .mdc-linear-progress:not([dir=ltr]) .mdc-linear-progress__bar,.mdc-linear-progress[dir=rtl]:not([dir=ltr]) .mdc-linear-progress__bar{right:0;-webkit-transform-origin:center right;transform-origin:center right}[dir=rtl] .mdc-linear-progress:not([dir=ltr]).mdc-linear-progress--animation-ready .mdc-linear-progress__primary-bar,.mdc-linear-progress[dir=rtl]:not([dir=ltr]).mdc-linear-progress--animation-ready .mdc-linear-progress__primary-bar{animation-name:mdc-linear-progress-primary-indeterminate-translate-reverse}[dir=rtl] .mdc-linear-progress:not([dir=ltr]).mdc-linear-progress--animation-ready .mdc-linear-progress__secondary-bar,.mdc-linear-progress[dir=rtl]:not([dir=ltr]).mdc-linear-progress--animation-ready .mdc-linear-progress__secondary-bar{animation-name:mdc-linear-progress-secondary-indeterminate-translate-reverse}[dir=rtl] .mdc-linear-progress:not([dir=ltr]) .mdc-linear-progress__buffer-dots,.mdc-linear-progress[dir=rtl]:not([dir=ltr]) .mdc-linear-progress__buffer-dots{animation:mdc-linear-progress-buffering-reverse 250ms infinite linear;transform:rotate(0)}[dir=rtl] .mdc-linear-progress:not([dir=ltr]).mdc-linear-progress--indeterminate .mdc-linear-progress__primary-bar,.mdc-linear-progress[dir=rtl]:not([dir=ltr]).mdc-linear-progress--indeterminate .mdc-linear-progress__primary-bar{right:-145.166611%;left:auto}[dir=rtl] .mdc-linear-progress:not([dir=ltr]).mdc-linear-progress--indeterminate .mdc-linear-progress__secondary-bar,.mdc-linear-progress[dir=rtl]:not([dir=ltr]).mdc-linear-progress--indeterminate .mdc-linear-progress__secondary-bar{right:-54.888891%;left:auto}.mdc-linear-progress--closed{opacity:0}.mdc-linear-progress--closed-animation-off .mdc-linear-progress__buffer-dots{animation:none}.mdc-linear-progress--closed-animation-off.mdc-linear-progress--indeterminate .mdc-linear-progress__bar,.mdc-linear-progress--closed-animation-off.mdc-linear-progress--indeterminate .mdc-linear-progress__bar .mdc-linear-progress__bar-inner{animation:none}@keyframes mdc-linear-progress-buffering{from{transform:rotate(180deg) translateX(calc(var(--mdc-linear-progress-track-height) * -2.5))}}.mdc-linear-progress__bar-inner{border-color:var(--mdc-linear-progress-active-indicator-color)}.mdc-linear-progress__buffer-dots{background-color:var(--mdc-linear-progress-track-color)}@media(forced-colors: active){.mdc-linear-progress__buffer-dots{background-color:ButtonBorder}}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){.mdc-linear-progress__buffer-dots{background-color:rgba(0,0,0,0);background-image:url("data:image/svg+xml,%3Csvg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' enable-background='new 0 0 5 2' xml:space='preserve' viewBox='0 0 5 2' preserveAspectRatio='none slice'%3E%3Ccircle cx='1' cy='1' r='1' fill='rgba(244, 67, 54, 0.25)'/%3E%3C/svg%3E")}}.mdc-linear-progress__buffer-bar{background-color:var(--mdc-linear-progress-track-color)}.mdc-linear-progress{height:max(var(--mdc-linear-progress-track-height), var(--mdc-linear-progress-active-indicator-height))}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){.mdc-linear-progress{height:4px}}.mdc-linear-progress__bar{height:var(--mdc-linear-progress-active-indicator-height)}.mdc-linear-progress__bar-inner{border-top-width:var(--mdc-linear-progress-active-indicator-height)}.mdc-linear-progress__buffer{height:var(--mdc-linear-progress-track-height)}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){.mdc-linear-progress__buffer-dots{background-size:10px var(--mdc-linear-progress-track-height)}}.mdc-linear-progress__buffer{border-radius:var(--mdc-linear-progress-track-shape)}.mat-mdc-progress-bar{display:block;text-align:start;--mdc-linear-progress-primary-half: 83.67142%;--mdc-linear-progress-primary-full: 200.611057%;--mdc-linear-progress-secondary-quarter: 37.651913%;--mdc-linear-progress-secondary-half: 84.386165%;--mdc-linear-progress-secondary-full: 160.277782%;--mdc-linear-progress-primary-half-neg: -83.67142%;--mdc-linear-progress-primary-full-neg: -200.611057%;--mdc-linear-progress-secondary-quarter-neg: -37.651913%;--mdc-linear-progress-secondary-half-neg: -84.386165%;--mdc-linear-progress-secondary-full-neg: -160.277782%}.mat-mdc-progress-bar[mode=query]{transform:scaleX(-1)}.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__buffer-dots,.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__primary-bar,.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__secondary-bar,.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__bar-inner.mdc-linear-progress__bar-inner{animation:none}.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__primary-bar,.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__buffer-bar{transition:transform 1ms}`],encapsulation:2,changeDetection:0});let o=e;return o})();function JD(o,e=0,t=100){return Math.max(e,Math.min(t,o))}var QD=(()=>{let e=class e{};e.\u0275fac=function(a){return new(a||e)},e.\u0275mod=ds({type:e}),e.\u0275inj=hs({imports:[Ss]});let o=e;return o})();function $ee(o,e){o&1&&Ln(0,"mat-progress-bar",1)}var eL=(()=>{let e=class e{constructor(){this._resultService=ai(za),this.processing=this._resultService.processing}};e.\u0275fac=function(a){return new(a||e)},e.\u0275cmp=$i({type:e,selectors:[["app-processing-bar"]],standalone:!0,features:[Yi],decls:1,vars:1,consts:[["mode","indeterminate",4,"ngIf"],["mode","indeterminate"]],template:function(a,i){a&1&&ln(0,$ee,1,0,"mat-progress-bar",0),a&2&&si("ngIf",i.processing())},dependencies:[_r,Ds,QD,KD]});let o=e;return o})();function Yee(o,e){if(o&1&&(xt(0,"div",1)(1,"span",2),Bi(2),It(),xt(3,"span",3),Bi(4),L2(5,"json"),It()()),o&2){let t=e.$implicit,s=di();Ct(2),Or(t),Ct(2),Or(F2(5,2,s.object[t]))}}var tL=(()=>{let e=class e{constructor(){this.keys=[]}ngOnChanges(){console.log(this.object),this.keys=Object.keys(this.object)}};e.\u0275fac=function(a){return new(a||e)},e.\u0275cmp=$i({type:e,selectors:[["lib-list-object-values"]],inputs:{object:"object"},standalone:!0,features:[Ms,Yi],decls:3,vars:0,consts:[[1,"col"],[1,"row"],[1,"property"],[1,"value"],["class","row"]],template:function(a,i){a&1&&(xt(0,"div",0),Js(1,Yee,6,4,"div",4,Ko),It()),a&2&&(Ct(),Ks(i.keys))},dependencies:[_r,A5],styles:[".col[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}.row[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;gap:20px}.property[_ngcontent-%COMP%]{font-size:.8em}"]});let o=e;return o})();var aL=T2(j9());function sL(o,e){let t=0,s=0,a=0,i=0,f=()=>{document.onmouseup=null,document.onmousemove=null,o.classList.remove("drag")},v=M=>{M.preventDefault(),t=a-M.clientX,s=i-M.clientY,a=M.clientX,i=M.clientY,o.style.top=`${o.offsetTop-s}px`,o.style.left=`${o.offsetLeft-t}px`},x=M=>{M.preventDefault(),a=M.clientX,i=M.clientY,o.classList.add("drag"),document.onmouseup=f,document.onmousemove=v};e.onmousedown=x}var oL=T2(j9()),W9=class{constructor(){this.backgroundColor="rgba(0, 0, 0, 0.8)",this.textColor="white",this.textSize="0.8em",this.borderWidth="2px",this.borderRadius="5px",this.borderColor="#000",this.padding="10px",this.showCloseButton=!0}},wy=class{constructor(e){this._parentDiv=e,this._windowDiv=document.createElement("div"),this._infoDiv=document.createElement("div"),this._contentDiv=document.createElement("div"),this._styles=new W9,this.events=new oL.EventEmitter,this._createLegendDiv()}setContent(e){this.clearContent(),this._contentDiv?.appendChild(e)}clearContent(){this._contentDiv.innerHTML=""}setVisibility(e){this._windowDiv.style.display=e?"flex":"none"}setPosition(e="70px",t="20px"){this._windowDiv.style.top=e,this._windowDiv.style.left=t}setInfoText(e){this._infoDiv.style.display="flex",this._infoDiv.innerText=e}hideInfoText(){this._infoDiv.style.display="none"}_createLegendDiv(){this._windowDiv.id="dragable",this._windowDiv.style.zIndex="100",this._windowDiv.style.position="absolute",this._windowDiv.style.display="flex",this._windowDiv.style.flexDirection="column",this._windowDiv.style.top="70px",this._windowDiv.style.left="20px",this._windowDiv.style.zIndex="100",this._windowDiv.style.fontSize=this._styles.textSize,this._windowDiv.style.color=this._styles.textColor,this._windowDiv.style.borderRadius=this._styles.borderRadius,this._windowDiv.style.padding=this._styles.padding,this._windowDiv.style.backgroundColor=this._styles.backgroundColor,this._windowDiv.style.maxWidth="50vw",this._windowDiv.style.maxHeight="500px",this._parentDiv.appendChild(this._windowDiv);let e=document.createElement("div");if(this._windowDiv.id="dragzone",e.style.display="flex",e.style.justifyContent="flex-end",e.style.marginBottom="10px",e.style.alignItems="center",e.style.cursor="move",e.style.borderTopLeftRadius=this._styles.borderRadius,e.style.borderTopRightRadius=this._styles.borderRadius,e.style.width="100%",this._windowDiv.appendChild(e),sL(this._windowDiv,e),this._styles.showCloseButton){let t=document.createElement("span");t.classList.add("material-icons"),t.style.pointerEvents="auto",t.style.cursor="pointer",t.addEventListener("click",()=>{this.setVisibility(!1),this.events.emit("clickedClose")}),t.style.fontSize=this._styles.textSize,t.innerText="close",e.appendChild(t)}this._infoDiv.style.display="none",this._infoDiv.style.marginBottom="10px",this._infoDiv.style.maxWidth="200px",this._infoDiv.style.fontStyle="oblique",this._infoDiv.style.fontSize="0.9em",this._windowDiv.appendChild(this._infoDiv),this._contentDiv.style.overflowY="auto",this._windowDiv.appendChild(this._contentDiv),this._windowDiv.addEventListener("mousedown",t=>{t.stopPropagation()})}};var q9=class{constructor(){this.boxRadius="2px",this.clickable=!0}},Sy=class o extends wy{constructor(e){super(e),this._items=[],this._legendStyles=new q9,this.events=new aL.EventEmitter}static getInstance(e){return this._instance?this._instance:(this._instance=new o(e),this._instance)}setItems(e){this._items=e,this._createColorLegend()}_createColorLegend(){this._legend=document.createElement("div"),this._legend.style.display="flex",this._legend.style.flexDirection="column",this._legend.style.gap="5px",this._items.forEach(e=>{let t=document.createElement("div");t.style.display="flex",t.style.width="100%",t.style.flexDirection="row",t.style.alignItems="center",t.style.gap="10px",this._legendStyles.clickable&&(t.style.cursor="pointer",t.addEventListener("click",()=>this.events.emit("clickedRow",e))),this._legend?.appendChild(t);let s=document.createElement("div");s.style.width="15px",s.style.height="15px",s.style.backgroundColor=e.color,s.style.borderRadius=this._legendStyles.boxRadius,t.appendChild(s);let a=document.createElement("div");a.innerText=e.text,t.appendChild(a)}),this.setContent(this._legend)}};function ete(o,e){if(o&1){let t=vr();xt(0,"lib-ng-dragable-window",2),zi("clickedClose",function(){Pn(t);let a=di();return Rn(a.selectedFeature=void 0)}),Ln(1,"lib-list-object-values",3),It()}if(o&2){let t=di();Ct(),si("object",t.selectedFeature.properties)}}var lL=(()=>{let e=class e{constructor(){this._resultService=ai(za),this.lngLat=[12.5114245,55.6713366],this.zoom=2,this._geoJSONLoaded=!1,this._dxfEntitiesLoaded=!1,this._dxfPlotColor="rgba(255,0,0,0.5)",this._gisPlotColor="rgba(0,0,255,0.5)",wl(()=>{this._resultService.resultsUpdated();let s=this._resultService.results();s.gisFeatures!==void 0&&s.gisFeaturesSubset===void 0?(this.plotGISFeatures(s.gisFeatures),this._updateColorLegend()):s.gisFeaturesSubset!==void 0&&(this.plotGISFeatures(s.gisFeaturesSubset,!1),this._updateColorLegend()),s.dxfFeatures!==void 0&&this.mapFromDXF(s.dxfFeatures)})}plotGISFeatures(s,a=!0){let i={id:"geojson-layer",type:"circle",source:"geojson",paint:{"circle-radius":4,"circle-stroke-width":2,"circle-color":this._gisPlotColor,"circle-stroke-color":"white"}};this.mapbox.loadGeoJSON("geojson",s,i,a),this._geoJSONLoaded=!0}mapFromDXF(s){this.dxfFeatureCollection=s;let a={id:"dxf-layer",type:"circle",source:"dxf",paint:{"circle-radius":4,"circle-stroke-width":2,"circle-color":this._dxfPlotColor,"circle-stroke-color":"white"}};this.mapbox.loadGeoJSON("dxf",s,a,!1),this._dxfEntitiesLoaded=!0,this._updateColorLegend()}_updateColorLegend(){let s=[];this._geoJSONLoaded&&s.push({color:this._gisPlotColor,text:"geoJSON",id:"geojson"}),this._dxfEntitiesLoaded&&s.push({color:this._dxfPlotColor,text:"DXF",id:"dxf"}),this._colorLegend=Sy.getInstance(document.body),this._colorLegend?.setItems(s),this._colorLegend.setPosition("calc(100vh - 120px)","calc(100vw - 120px)")}};e.\u0275fac=function(a){return new(a||e)},e.\u0275cmp=$i({type:e,selectors:[["app-map"]],viewQuery:function(a,i){if(a&1&&Br(G8,5),a&2){let f;Nn(f=zn())&&(i.mapbox=f.first)}},standalone:!0,features:[Yi],decls:2,vars:3,consts:[[3,"center","zoom","clickedFeature"],["id","props",3,"clickedClose",4,"ngIf"],["id","props",3,"clickedClose"],[3,"object"]],template:function(a,i){a&1&&(xt(0,"lib-ng-mapbox",0),zi("clickedFeature",function(v){return i.selectedFeature=v}),It(),ln(1,ete,2,1,"lib-ng-dragable-window",1)),a&2&&(si("center",i.lngLat)("zoom",i.zoom),Ct(),si("ngIf",i.selectedFeature))},dependencies:[_r,Ds,G8,y3,tL],styles:["#props[_ngcontent-%COMP%]{position:absolute;top:0;width:200px;right:400px;max-height:400px}lib-ng-mapbox[_ngcontent-%COMP%]{position:absolute;top:0;right:0;left:0;height:100vh}"]});let o=e;return o})();var tte=["appWindow"];function ite(o,e){if(o&1&&(xt(0,"mat-tab-group")(1,"mat-tab",8),Ln(2,"app-dxf-analyzer"),It(),xt(3,"mat-tab",8),Ln(4,"app-feature-mapper"),It(),xt(5,"mat-tab",8),Ln(6,"app-result-exporter"),It()()),o&2){let t=di(2);Ct(),si("label",t.txt().dxfExtract),Ct(2),si("label",t.txt().mapping),Ct(2),si("label",t.txt().export)}}function nte(o,e){if(o&1){let t=vr();xt(0,"lib-ng-dragable-window",4),zi("clickedClose",function(){Pn(t);let a=di();return Rn(a.showUIWindow=!1)}),xt(1,"div",5),Ln(2,"app-upload")(3,"app-processing-bar"),It(),xt(4,"div",6),ln(5,ite,7,3,"mat-tab-group",7),It()()}if(o&2){let t=di();Ct(5),si("ngIf",t.dxfLoaded())}}function rte(o,e){if(o&1&&Ln(0,"lib-dxf-viewer",11),o&2){let t=di(2);si("fileURL",t.results().subsetDXFURL)}}function ste(o,e){if(o&1){let t=vr();xt(0,"lib-ng-dragable-window",9),zi("clickedClose",function(){Pn(t);let a=di();return Rn(a.showDXF=!1)}),ln(1,rte,1,1,"lib-dxf-viewer",10),It()}if(o&2){let t=di();Ct(),si("ngIf",t.results().subsetDXFURL)}}var cL=(()=>{let e=class e{constructor(){this._dxfProcessor=ai(nA),this._resultService=ai(za),this._translationService=ai(Gc),this.txt=this._translationService.translatedContent,this.language=this._translationService.language,this.languages=this._translationService.languages,this.dxfLoaded=Yl(()=>this._resultService.resultsUpdated()&&this._resultService.results().fullDXF!==void 0),this.dxfFeaturesSelected=Yl(()=>this._resultService.resultsUpdated()&&this._resultService.results().dxfFeatures!==void 0),this.results=this._resultService.results,this.processing=!1,this.dxfEntitiesLoaded=!1,this.showUIWindow=!0,this.dxfEntities=[],this.showDXF=!1,wl(()=>{this._resultService.resultsUpdated();let s=this._resultService.results();s.gisFeatures!==void 0&&s.gisFeaturesSubset===void 0&&(this.showUIWindow=!0),s.dxfFeatures!==void 0&&(this.showDXF=!0)})}handleLanguageChange(s){this._translationService.language=s}updateDXFView(s){let a=this._dxfProcessor.extractSubset(s);iA(a,"subset.dxf"),this.dxfEntities=s}};e.\u0275fac=function(a){return new(a||e)},e.\u0275cmp=$i({type:e,selectors:[["app-root"]],viewQuery:function(a,i){if(a&1&&Br(tte,5),a&2){let f;Nn(f=zn())&&(i.appWindow=f.first)}},standalone:!0,features:[Yi],decls:6,vars:6,consts:[[3,"title","info","languageOptions","seletcedLanguage","changedLanguage"],[3,"clickedClose",4,"ngIf"],["id","geometry",3,"clickedClose",4,"ngIf"],["appWindow",""],[3,"clickedClose"],["fixedTop",""],[1,"col",2,"width","500px"],[4,"ngIf"],[3,"label"],["id","geometry",3,"clickedClose"],[3,"fileURL",4,"ngIf"],[3,"fileURL"]],template:function(a,i){a&1&&(xt(0,"lib-ng-demo-layout",0),zi("changedLanguage",function(v){return i.handleLanguageChange(v)}),It(),ln(1,nte,6,1,"lib-ng-dragable-window",1)(2,ste,2,1,"lib-ng-dragable-window",2),R2(3,null,3),Ln(5,"app-map"),k2()),a&2&&(si("title",i.txt().title)("info",i.txt().info)("languageOptions",i.languages)("seletcedLanguage",i.language()),Ct(),si("ngIf",i.showUIWindow),Ct(),si("ngIf",i.showDXF))},dependencies:[_r,Ds,GC,QC,ho,Eo,y3,II,nb,CI,NI,Hc,ZD,$D,YD,eL,lL],styles:[".row[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;width:100%;gap:10px}.col[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}  .mat-mdc-tab-body-wrapper{margin-top:20px!important}#geometry[_ngcontent-%COMP%]{position:absolute;top:0;width:200px;right:400px}"]});let o=e;return o})();OE(cL,iC).catch(o=>console.error(o));
